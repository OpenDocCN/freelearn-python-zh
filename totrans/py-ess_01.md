# 第一章. 入门

Python 在某些计算机上作为操作系统的一部分提供。在其他计算机上，我们需要添加 Python 程序和相关工具。安装相当简单，但我们仍将回顾细节，以确保每个人都有一个共同的基础。

一旦我们有了 Python，我们需要确认 Python 确实存在。在某些情况下，我们将有多个 Python 版本可用。我们需要确保我们使用的是 Python 3.4 或更新的版本。为了确认 Python 可用，我们将在 Python 的`>>>`提示符下进行一些交互。

为了扩展剩余章节的基础，我们将查看一些 Python 语法的必要规则。这并不是完整的，但它将帮助我们编写脚本和学习语言。在我们有更多机会处理简单和复合语句之后，详细的语法规则将变得有意义。

我们还将查看 Python“生态系统”，从内置的标准库开始。本书中我们将强调标准库，有两个原因。首先，它非常庞大——我们需要的很多东西已经在我们的电脑上了。其次，更重要的是，研究这个库是学习 Python 编程细节的最佳方式。

除了内置库之外，我们将查看**Python 包索引**（**PyPI**）。如果我们无法在标准库中找到合适的模块，第二个地方寻找扩展的地方是 PyPI—[`pypi.python.org`](https://pypi.python.org)。

# 安装或升级

要在 Windows 上使用 Python，我们必须安装 Python。对于 Mac OS X 和 Linux，Python 版本已经存在；我们通常会想要添加一个更新的版本到预装的 Python 中。

可用的 Python 有两个显著不同的版本：

+   Python 2.x

+   Python 3.x

本书关于 Python 3.4。我们不会涉及 Python 2.x。有几个明显的差异。重要的是 Python 2.x 在底层有点混乱。Python 3 反映了某些基本改进。这些改进是以牺牲两个版本的语言在几个领域必须不兼容为代价的。

Python 社区正在继续保留 Python 2.x。这样做对那些被旧软件困住的人来说是一种帮助。大多数开发者正在向前推进使用 Python 3，因为它是一个明显的改进。

在我们开始之前，了解 Python 是否已经安装是很重要的。检查 Python 是否已经安装的一般测试是获取一个操作系统命令提示符。对于 Windows，使用命令提示符；对于 Mac OS X 或 Linux，使用终端工具。我们将展示 Mac OS X 终端的提示。它看起来像这样：

```py
MacBookPro-SLott:~ slott$ python3
Python 3.3.4 (v3.3.4:7ff62415e426, Feb  9 2014, 00:29:34)
[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>>

```

我们已经展示了 OS 提示符`MacBookPro-SLott:~ slott$`。我们输入了`python3`命令，这在 Linux 和 Mac OS X 中很常见。在 Windows 中，我们通常会输入`python`。响应是三行介绍，然后是`>>>`提示符。输入`exit`并按*回车*键以获取有关如何退出 Python 的一些有用建议。这个例子展示了 Python 3.3，这有点过时了。不需要升级。

来自操作系统的某种“命令未找到”错误意味着我们没有 Python，因此我们需要进行安装。

如果我们收到一条以类似“Python 2.7.6”开头的 Python 消息，我们就需要进行升级。

下一个部分将介绍 Windows 安装。之后，我们将查看 Mac OS X，然后我们将看到 Linux 升级。在某些情况下，我们可能在 Windows 桌面上开发软件，但最终目标是大型集中式 Linux 服务器。这两个环境中的 Python 文件可以相同，因此 Python 在多个平台上的使用不会非常复杂或令人困惑。

## 在 Windows 上安装 Python

Python 可以在许多 Windows 版本上运行。有一些较旧的、使用较少的 Windows 版本没有活跃支持的 Python 版本。例如，Windows 2000 不受支持。

安装 Python 的一般步骤相当简单。我们将下载一个安装程序并做一些准备工作。然后我们将启动安装程序。一旦完成，我们就可以开始运行了。

要找到安装程序，从这里开始：

[`www.python.org/downloads/`](https://www.python.org/downloads/)

网络服务器应该检测到您的操作系统，并提供一个带有“下载 Python 3.4.x”等变体的按钮。点击此按钮开始下载。

要查看可用的选项，[`www.python.org/downloads/windows/`](https://www.python.org/downloads/windows/)路径提供了所有活跃支持的 Python 版本。这将显示一个较旧版本的列表。有两个安装程序可用：

+   Windows x86 MSI 安装程序

+   Windows x86-64 MSI 安装程序

如果我们有一台非常旧的电脑，我们可能需要 32 位版本。大多数现代电脑都将有 64 位 CPU。如果有疑问，64 位是默认选择。

双击`.msi`文件以启动安装程序。这将从询问是为您自己安装 Python 还是为所有用户安装 Python 的问题开始。如果您有适当的权限，所有用户选项是合适的。在共享电脑上，如果没有适当的权限，您只能为自己安装。

![在 Windows 上安装 Python](img/B03671_01_01.jpg)

第二页将要求输入安装目录。请小心选择安装路径，并避免在文件名中使用空格。

### 提示

不要将 Python 安装到名称中包含空格的目录中。避免使用“程序文件”和“我的文档”等名称。空格可能会引起难以诊断的问题。

将 Python 安装到具有简短、无空格名称的简单目录中，如`C:\python34`。

![在 Windows 上安装 Python](img/B03671_01_02.jpg)

文件名中的空格不是一般问题，但在开始时可能会有些尴尬。有许多方法可以处理文件名中的空格。然而，在学习一门新的编程语言时，减少这些尴尬的问题很重要，这样我们就可以专注于重要的话题。

下一页还将显示一个可以安装的组件菜单；请求所有内容是最简单的。没有充分的理由关闭任何可选组件。我们将查看需要**Tcl/Tk**包的 IDLE 开发工具，因此确保它是安装的一部分很重要。

在许多情况下，此列表中的最后一个选项会将系统环境变量更新为包括`PATH`变量中的 Python。这默认是禁用的，但如果您打算在 Windows 中编写 BAT 文件，这可能很有帮助。

![在 Windows 上安装 Python](img/B03671_01_03.jpg)

除了基本的 Python 解释器外，Windows 帮助安装程序非常有用。这是一个单独的下载，需要快速安装。安装完成后，我们可以使用*F1*键调出所有的 Python 文档。

Python 安装完成后，*使用读取-评估-打印循环（REPL）*部分将展示如何开始与 Python 交互。

### 考虑一些替代方案

我们将关注 Python 的一个特定实现，称为**CPython**。我们在这里所做的区分是，Python（抽象语言）可以被各种具体的 Python 运行时或实现处理。CPython 实现是用可移植的 C 编写的，并且可以重新编译用于许多操作系统。这种实现通常非常快。

对于 Windows 开发者来说，还有一个名为**Iron Python**的替代实现。它与 Windows .NET 开发环境紧密集成。它具有与 Visual Studio 一起工作的优势。它的缺点是基于 Python 2.7 语言。

Windows 用户还有另一个选择，即使用**Python Tools for Visual Studio**（**PTVS**）。这将允许你在 Visual Studio 中使用 Python 3.4。对于习惯于 Visual Studio 的开发者来说，这可能很有帮助。

其他 Python 实现包括 Jython、Stackless Python 和 PyPy。这些替代方案适用于所有操作系统，因此我们将在*查看其他 Python 解释器*部分稍后讨论这些。

## 在 Mac OS X 上升级到 Python 3.4

Python 在所有版本的 Mac OS X 上运行。结果是 Mac OS X 依赖于 Python。然而，它依赖于 Python 2.7，因此我们需要添加 Python 3.4。

在 Mac OS X 上安装 Python 的一般步骤相当简单。我们将下载一个磁盘镜像（`.dmg`）安装程序并进行一些准备。然后我们将启动磁盘镜像中的安装程序。一旦完成，我们就可以开始使用了。

要查找安装程序，请从这里开始：

[`www.python.org/downloads/`](https://www.python.org/downloads/)

网络服务器应检测您的操作系统，并提供一个带有“下载 Python 3.4.x”变体的按钮。点击此按钮并下载 `.dmg` 文件。

要查看可用的选项，[`www.python.org/downloads/mac-osx/`](https://www.python.org/downloads/mac-osx/) 路径提供了 Mac OS X 所支持的所有活跃版本的 Python。这将显示 Python 旧版本的替代方案。

下载完成后，`.dmg` 设备可用后，双击 `.mpkg` 安装程序文件以启动安装程序。

![在 Mac OS X 中升级到 Python 3.4](img/B03671_01_04.jpg)

点击 **继续** 将会依次进入 **阅读我**、**许可协议**、**目标选择** 和 **安装类型** 窗口。有一个 **自定义** 按钮允许我们打开或关闭选项。我们不需要这样做——默认安装是理想的。

我们需要提供有权管理此计算机的用户的用户名和密码。这不会删除 Mac OS X 使用的现有 Python。它将添加另一个 Python 版本。这意味着我们将至少有两个 Python 版本。我们将专注于使用 Python 3，忽略内置的 Python，即 Python 2。

要使用 Python 3，我们必须在终端窗口的操作系统提示符中输入 `python3`。如果我们有 *两个* Python 3.3 和 Python 3.4，我们可以在命令提示符中输入更具体的 `python3.4` 来指定我们正在使用 Python 3 的哪个版本。通常，`python3` 命令将是 Python 3 的最新版本。不带版本号的 `python` 命令将是 Mac OS X 所需的 Python 2.x。

### 添加 Tkinter 包

Python 依赖于名为 Tkinter 的库来提供编写具有 GUI 的程序的支持。此包依赖于 Tcl/Tk。详细信息请见以下链接：

[`www.python.org/download/mac/tcltk/`](https://www.python.org/download/mac/tcltk/)

总结来说，我们需要安装版本 8.5.17 或更高版本。请参阅 [`www.python.org/download/mac/tcltk/#activetcl-8-5-17-0`](https://www.python.org/download/mac/tcltk/#activetcl-8-5-17-0)。这将提供 Python 将使用的图形环境。我们必须安装 Tcl/Tk，以便 `tkinter` 包能够工作。

下载 `.dmg` 文件并打开 `.pkg` 文件后，我们将看到此窗口：

![添加 Tkinter 包](img/B03671_01_05.jpg)

我们将查看需要 `tkinter` 的 IDLE 开发工具，因此这个额外的安装是必不可少的。

如果我们避免使用 `tkinter`，就可以避免这个额外的下载。一些开发者更喜欢使用 Active State Komodo 编辑器作为他们的开发工具；这不需要 Tcl/Tk。此外，还有许多不需要 `tkinter` 的附加 GUI 框架。

## 在 Linux 中升级到 Python 3.4

对于 Linux，最新的 Python 可能已经安装。当我们输入`python3`时，我们可能会看到已经有一个有用的版本可用。在这种情况下，我们已经准备好开始。在某些情况下，操作系统可能只安装了较旧的 Python（可能比 2.7 旧）。在这种情况下，我们需要升级。

对于 Linux 发行版，升级 Python 有两条路径：

+   安装预构建的包：许多发行版已经提供了适当的包。我们可以使用包管理器（如`yum`或`RPM`）来定位和安装必要的 Python 包。在某些情况下，可能会有额外的依赖项，导致一系列的下载和安装。由于 Python 3.4 相对较新，可能没有很多针对您特定 Linux 分发的预构建包。详细信息请参阅[`docs.python.org/3/using/unix.html#on-linux`](https://docs.python.org/3/using/unix.html#on-linux)。

+   从源代码构建：大多数 Linux 发行版都包含了 GNU C 编译器。我们可以下载 Python 源代码，配置构建脚本，并使用`make`和`make install`来构建 Python。这可能需要升级一些 Linux 库，以确保您的 Linux 安装具有对 Python 3.4 所需的支持。安装步骤总结为`./configure`、`make`和`sudo make altinstall`。详细信息请参阅[`docs.python.org/3/using/unix.html#building-python`](https://docs.python.org/3/using/unix.html#building-python)。

当我们使用`altinstall`时，最终会安装两个 Python 版本。我们将有一个较旧的 Python 版本，可以使用`python`命令来运行。通常，`python3`命令会链接到 Python 3 的最新版本。如果我们需要明确指定，可以使用`python3.4`命令来选择特定的版本。

与 Mac OS X 安装类似，添加 Python `tkinter`包很重要。有时，这可能是基本包之外的。这可能会导致升级 Tcl/Tk，进而导致更多的下载和安装。在其他时候，Linux 发行版可能已经有一个最新的 Tcl/Tk 环境，无需做更多操作。

如果我们避免使用`tkinter`，就可以避免额外的 Tcl/Tk 下载。如前所述，许多开发者更喜欢使用 Active State Komodo 编辑器作为他们的开发工具；这不需要`tkinter`。此外，还有许多不以`tkinter`为基础的 GUI 框架。

# 使用读取-评估-打印循环（REPL）

一旦安装了 Python 3，我们可以通过一些基本的 Python 交互来确保一切正常工作。从长远来看，我们将使用其他工具来创建 Python 程序。一开始，我们将直接在命令行上进行交互。

Python 的**读取-评估-打印循环**（**REPL**）是 Python 编程的基础。更复杂的事情——比如编写应用程序脚本或网络服务器——本质上与与 REPL 的交互相同：Python 程序从我们的应用程序脚本文件或网络服务器脚本文件中读取语句并评估这些语句。

这条基本规则是 Python 非常吸引人的特性之一。我们可以编写复杂的脚本，或者我们可以通过交互式解释器（REPL）与语言交互；语言是相同的。

## 确认一切正常

为了确认一切正常，我们将从命令行提示符启动 Python 解释器。它可能看起来像这样：

```py
MacBookPro-SLott:~ slott$ python3
Python 3.3.4 (v3.3.4:7ff62415e426, Feb  9 2014, 00:29:34)
[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>>

```

获取命令提示符的细节因操作系统而异。在这个示例中，我们展示了 Mac OS X 终端工具。我们输入了 `python3` 命令，以确保我们运行的是新的 Python 版本，而不是内置的 Python 2。

介绍信息列出了四个被纳入交互式 Python 环境的特殊用途对象。还有两个，`quit` 和 `exit`，也是可用的。这些只在 REPL 交互式环境中存在；它们不能在程序中使用。

我们将在稍后的单独部分查看如何获取帮助，即 *与帮助子系统交互*。然而，其他对象会产生有用的信息片段，并且是确保一切正常工作的理想方式。在 `>>>` 提示符下输入 `copyright`、`credits` 或 `license` 以确认 Python 正在运行。

## 执行简单的算术运算

REPL 循环打印每个语句的结果，允许我们以交互方式使用 Python。为了清楚地了解这意味着什么，我们应该定义构成语言中的**语句**的内容。我们将避免 Python 语言定义的严格形式，并提供一个快速的非正式定义相关语句类型。

Python 语言有大约 20 种语句。一个表达式——本身就是一个语句。除非表达式的值为 `None`，否则 REPL 会显示表达式的值。我们经常使用表达式语句来评估执行输入和输出的函数。

这个简单的表达式语句允许我们在 Python `>>>` 提示符下执行以下操作：

```py
>>> 355/113
3.1415929203539825
```

我们可以输入任何算术表达式。Python 会评估该表达式，如果结果不是 `None`，我们就会看到结果。在这个例子中，我们展示了真正的除法运算符 `/`。

我们将在第二章*简单数据类型*中查看各种数据类型和运算符。目前，我们将识别 Python 的几个特性。Python 有各种类型的数字，包括整数、浮点数和复数。大多数值都会被正确地强制转换为具有更高精度的值。看看这些例子：

```py
>>> 2 * 3.14 * 8j
50.24j
>>> _ **2
(-2524.0576+0j)
```

第一个表达式计算了一个包含整数 `2`、浮点数 `3.14` 和复数 `8j` 的值。我们使用了 `*` 运算符进行乘法。结果是复数，`50.24j`。

第二个表达式使用了 `_` 变量。这是一个独特的功能，仅限于 REPL。每个表达式的结果都隐式地分配给这个变量。我们可以在表达式中使用 `_` 来引用上一个表达式的结果。这仅在 REPL 中有效；它永远不会是脚本的一部分。

当我们计算 `_ **2` 时，我们平方了 `50.24j`。这是 -2524.0576。由于源值是一个复数，结果也是一个复数，即使该复数的虚部为零。这在 Python 中很典型——操作数值的数据类型通常决定了运算符的结果的数据类型。当存在不同类型的数字时，值会根据我们在第二章中将要看到的规则进行强制转换，*简单数据类型*。

有一个值得注意的例外是操作数的类型与结果的类型相匹配的规则。真正的除法运算符 `/` 从整数操作数产生浮点结果。另一方面，整除运算符 `//` 反映了操作数的类型。例如：

```py
>>> 355 / 113
3.1415929203539825
>>> 355 // 113
3
```

我们有这两个除法运算符，这样我们就可以明确指定我们想要执行哪种除法。这使我们免去了编写额外代码来显式强制转换结果的需要。

## 将结果分配给变量

简单的赋值语句不会产生可见的输出：

```py
>>> v = 23
```

这将创建变量 `v` 并将其值设为 23。我们可以通过使用一个非常小的表达式语句来检查这一点。该表达式只是变量名：

```py
>>> v
23
```

当我们评估一个非常简单的表达式，例如 `v`，我们看到变量的值。

Python 的交互式解释器（REPL）有着深远的影响。也许最重要的后果是，几乎所有 Python 编程的例子都像是我们在 `>>>` 提示符下输入代码一样提供的。对于非常复杂和高级的包的文档，会写成我们打算交互式使用该包的样子。在大多数情况下，我们将编写应用程序；我们实际上在 `>>>` 提示符下不会做很多。但通过简化复杂性以到达可以交互式执行的内容的想法在 Python 社区中无处不在。

## 使用导入添加功能

Python 的重要部分之一是存在一个庞大的附加功能库。使用外部库意味着核心语言可以保持相当简单。我们可以导入我们需要的任何附加功能，避免未使用功能的杂乱和复杂性。

`import`语句用于将额外的函数、类和对象合并到程序或交互式环境中。这个语句有多种变体。例如，我们可能想使用一些更复杂的数学函数。我们可以在 Python 文档中搜索并发现这些函数定义在`math`库中。我们可以像这样包含并使用它们：

```py
>>> import math
>>> math.pi
3.141592653589793
>>> math.sin( math.pi/6 )
0.49999999999999994
```

在这个例子中，我们导入了`math`库。我们评估了`math.pi`来查看这个库中定义的一个常量。我们评估了![使用 import 添加功能](img/B03671_01_06.jpg)。结果是几乎（但不完全）是 1/2。

这也向我们展示了一个关于浮点数的重要事实——它们只是近似值。这与 Python 本身无关——这是数字计算的一般特性。强调这一点关于浮点数的事实非常重要。

### 小贴士

浮点数只是近似值。它们不是精确的。它们不是具有无限精度的无理数的抽象数学理想。

我们将在第二章“简单数据类型”中回到浮点数的话题。现在，我们想专注于外部库。

Python 中有一个重要的库模块，名为`this`。要查看`this`模块，请在`>>>`提示符下输入`import this`，如下所示：

```py
>>> import this
```

另一个同样重要的模块是`antigravity`。

```py
>>> import antigravity
```

我们将把这些模块的探索留给读者作为练习。我们不想破坏乐趣！更多的手舞足蹈的解释不如亲身体验有帮助。有关此主题的更多信息，请参阅[`xkcd.com/413/`](http://xkcd.com/413/)。

我们总结一下，指出“Python”这个名字与蒙提·派森（Monty Python）有很大关系，与蛇无关。

# 与帮助子系统交互

Python 的交互式帮助工具提供了大量关于模块、类、函数和对象的有用信息。帮助系统是一个与 Python 的 REPL（交互式解释器）不同的环境；它提供独特的提示来明确这一点。

有三种帮助模式，每种模式都有其独特的提示：

+   我们将看到 Python 帮助环境的`help>`提示符。当我们不带参数值评估`help()`函数时，我们将进入 Python 的帮助环境。我们可以输入不同的主题，了解各种 Python 特性。当我们输入`quit`作为主题时，我们将返回到 REPL。

+   在 Windows 环境下，我们会看到`-- More --`提示：当我们在一个 Windows 环境中评估类似`help(int)`的内容时，输出将使用 MS-DOS 的**more**命令来显示。要获取更多信息，请输入`?`以获取关于如何翻页`help()`输出的帮助。在 Windows 命令行中，输入`more /?`将提供关于**more**命令如何帮助您翻页长文件的其他信息。

+   在 Mac OS X 和 Linux 中，我们会看到 `:` 提示符。当我们使用特定的参数值评估 `help()` 函数——例如，`help(float)`——在 Mac OS X 或 Linux 中，我们会得到使用 **less** 程序显示的输出。有关更多信息，请在查看 `help()` 输出时输入 `h` 以获取帮助。在命令提示符中，输入 `less -?` 以获取有关 **less** 程序如何工作的更多信息。

Python 模块还有其他方法可以查看文档。例如，在 IDLE 中，有一个类浏览器和路径浏览器，可以显示有关模块和文件的文档。这是基于内置的 `help()` 函数，但它是在一个单独的窗口中显示的。

## 使用 pydoc 程序

Python 包含了 pydoc 应用程序，我们用它来查看文档。这个应用程序是我们从操作系统命令提示符中运行的。我们不会从 Python `>>>` 提示符中使用它；我们是从操作系统提示符中使用它。在开发过程中，我们可能希望只保留一个终端窗口来显示模块文档。

`pydoc` 程序有两种操作模式：

+   它可以显示有关特定包或模块的一些文档。这将使用适当的程序（在 Windows 上是 **more**，在其他情况下是 **less**）来显示给定对象的文档。以下是如何显示 `math` 模块的文档：

    ```py
    MacBookPro-SLott:~ slott$ python3 -m pydoc math

    ```

+   它可以启动一个文档网络服务器。这将启动一个服务器（并启动一个浏览器）来查看 Python 模块文档。当我们使用它时，我们将有一个看起来像这样的会话：

    ```py
    MacBookPro-SLott:~ slott$ python3 -m pydoc -b
    Server ready at http://localhost:50177/
    Server commands: [b]rowser, [q]uit
    server> q
    Server stopped

    ```

第二个示例将启动一个网络服务器以及一个浏览器。浏览器将显示 pydoc 生成的文档。这是从模块和包结构以及嵌入在 Python 代码中的文档字符串中派生出来的。当我们完成阅读文档后，我们输入 `q` 来退出网络服务器。

当我们编写 Python 包、模块、类和函数时，我们可以（并且应该）为 `pydoc`/`help()` 文档提供内容。这些文档字符串是我们编程的一部分，与拥有正确工作的程序一样重要。我们将在 第十四章 *完善——单元测试、打包和文档* 中查看这些嵌入的文档。

# 创建简单的脚本文件

虽然我们可以从 REPL 使用所有 Python，但这并不是生成最终应用程序的好方法。我们用 Python 做的大部分工作将通过脚本文件完成。我们将在 第十二章 *脚本、模块、包、库和应用* 中详细查看脚本文件。现在，我们将查看一些功能。

脚本文件必须遵循一些规则：

+   内容必须是纯文本。虽然有些人更喜欢 ASCII 编码，但 Python 3 可以轻松处理 UTF-8 以及大多数操作系统特定的变体，如 Mac OS Roman 或 Windows CP-1252。强烈建议使用可移植的编码 UTF-8。

+   Python 可以处理 Mac OS X、Linux 换行符 (`\n`)，以及 Windows CR-LF (`\r\n`)。只有少数 Windows 工具，如记事本，坚持使用 CR-LF 行结束符；大多数其他编程编辑器可以灵活地识别行结束符。除非你真的必须使用记事本，否则通常最好使用 Unix 风格的换行符行结束符。

+   文件名应该是合法的 Python 标识符。这不是一个要求，但如果我们遵循这个建议，它将给我们带来相当大的灵活性。语言参考手册的第 2.3 节提供了构成标识符的详细规则。这些规则的总结是，标识符必须以字母（或规范化为字母的 Unicode 字符）或 `_` 开头。接着是字母、数字和 `_` 字符。重要的是我们应该避免在文件名中使用 Python 操作符或分隔符。特别是，我们应该避免使用连字符（`-`），这在某些 Python 环境中可能会成为问题。操作系统文件名比 Python 标识符有更灵活的规则，操作系统有方法来转义与操作系统相关的标点符号；当我们限制文件名为有效的 Python 标识符——字母、数字和 `_` 时，我们会感到最满意。

+   文件扩展名应该是 `.py`。同样，这也不是必需的，但遵循这个规则非常有帮助。

例如，我们将尝试关注像 `test_1_2.py` 这样的名称。我们不太容易使用名为 `test-1.2.py` 的文件；基本名称不是一个有效的标识符——这个名字看起来像是一个 Python 表达式。虽然第二个名称对于顶层脚本来说是可接受的，但它不能作为一个模块或包使用。

在下一节中，我们将探讨一些 Python 语法规则。现在，我们可以创建一个名为 `ex_1.py` 的简单脚本文件，它只有一行：

```py
print("π≈", 355/113)
```

我们也可以使用 `"\u03c0\u2248"` 来代替 `"π≈"`。字符串 `"\N{GREEK SMALL LETTER PI}\N{ALMOST EQUAL TO}"` 也会起作用。

一旦我们有了这个文件，我们就可以按照以下方式让 Python 执行该文件：

```py
MacBookPro-SLott:Chapter_1 slott$ python3 ex_1.py
π≈ 3.1415929203539825

```

我们已经提供了一个文件名，`ex_1.py`，作为 `python3` 程序的位置参数。Python 读取文件并执行每一行。我们看到的输出是 `print()` 函数打印到控制台的文字。

Python 会使用普通的操作系统规则来定位文件，从当前工作目录开始查找文件。这适用于任何类型的文件名。

如果我们遵循了文件的命名规则——文件名是一个标识符，扩展名是 `.py`——我们也可以使用以下命令来执行一个 Python 模块：

```py
MacBookPro-SLott:Chapter_1 slott$ python3 -m ex_1
π≈ 3.1415929203539825

```

`-m ex_1` 选项强制 Python 搜索名为 `ex_1` 的模块。与此模块关联的文件名为 `ex_1.py`。Python 有一个用于查找请求模块的搜索路径。除非做出特殊安排，Python 将首先搜索本地目录，然后搜索库目录。这允许我们使用简单、统一的语法运行我们的脚本和 Python 的内置应用。它还允许我们通过修改 `PYTHONPATH` 环境变量来添加我们自己的应用和模块。

我们将在 第十二章 *脚本、模块、包、库和应用* 中查看搜索路径。搜索路径的详细文档是 `site` 包的一部分。

## 简化的语法规则

Python 的语法规则在 *Python 语言参考* 手册的第二部分中定义。我们将在 第三章 *表达式和输出* 中详细讨论这些规则。

Python 有大约 20 种语句。以下是对规则的快速总结：

+   几乎所有语句都以 Python 关键字开头，如 `pass`、`if` 和 `def`。表达式语句和赋值语句是例外。

+   Python 有两种语句类型——单行 **简单** 语句和多行 **复合** 语句。

+   简单语句必须在单行内完成。赋值语句是简单语句。它以一个或多个用户提供的标识符开始，包括 `=` 赋值符号或类似 `+=` 的增强变体。表达式语句也是简单的。

+   复合语句使用缩进来表示嵌入在整体语句中的语句序列。标准缩进是四个空格。大多数开发者将他们的编辑器设置为将制表符替换为四个空格。不一致地使用空格和制表符会导致难以看到的语法错误，因为默认情况下制表符和空格都是不可见的。避免使用制表符通常更容易调试问题。

+   复合语句包括类和函数定义——定义体的内容是缩进的。if 语句和 for 以及 while 循环是包含条件或重复执行缩进语句序列的复合语句的例子。

+   括号 `(` 和 `)` 必须匹配。一个逻辑行上的单个语句可以跨越多个物理行，直到括号 `(` 和 `)` 匹配。

实际上，Python 程序由一行一条语句组成。行的末尾是语句的终止符。我们有几种扩展语句的技术。最常见的技术是基于 Python 的要求，即括号 `(` 和 `)` 必须匹配。

例如，我们可以编写如下代码：

```py
print(
   "Hello world",
   "π≈",
   355/113
)
```

### 小贴士

**下载示例代码**

您可以从[`www.packtpub.com`](http://www.packtpub.com)下载您购买的所有 Packt 出版物的示例代码文件。如果您在其他地方购买了这本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

我们使用`(`和`)`将单个逻辑行扩展到四行物理行。一个后果是，我们在 REPL 中输入的简单语句不得缩进。前导空格会导致问题，因为前导空格用于显示哪些语句在复合语句内部。

这的另一个后果是间接的。Python 从开始到结束逐行执行脚本文件。这意味着复杂的 Python 程序将首先有一系列定义，而“主要”的处理部分通常在最后。

Python 的注释以`#`开头，并在行尾结束。这遵循了各种 Linux 壳的相同规则。由于 Python 文档字符串是通过`pydoc`和`help()`处理的，因此大多数文档实际上是在包、模块、类或函数定义的开始处以单独的字符串字面量呈现。我们将在第十四章*完善 - 单元测试、打包和文档*中查看这些文档字符串。`#`注释使用得很少。

# Python 生态系统

Python 编程环境有两个广泛的主题领域：

+   语言本身

+   扩展包。我们可以进一步将扩展包细分为：

    +   标准库包

    +   更多的扩展包的 Python 生态系统

当我们安装 Python 时，我们安装了语言以及标准库中的数百个扩展包。我们将在第十二章*脚本、模块、包、库和应用*中回到标准库。Python 生态系统是无限的。好消息是 PyPI 使得查找包相对容易。

## 通过附加组件进行扩展的想法

Python 的设计包括一个小核心语言，可以通过导入额外的功能来扩展。语言参考手册描述了 20 个语句；只有 19 个运算符。我们的想法是，我们可以对一个小语言被正确实现、完整和一致有很大的信心。

标准库文档包含 37 章，并描述了数百个扩展包。有许多功能可以帮助我们解决独特的问题。通常可以看到导入大量标准库包的 Python 程序。

我们将看到`import`语句的两种常见变体：

+   `import math`

+   `from math import sqrt, sin`

第一个版本导入了整个 `math` 模块，并在全局命名空间中创建了一个模块对象。该模块中的各种类和函数名称必须使用正确的命名空间进行限定。限定名称看起来类似于 `math.sqrt()` 或 `math.sin()`。

虽然第二个版本也导入了 `math` 模块，但它只将给定的名称引入到全局命名空间中。这些名称不需要限定符。我们可以像使用内置函数一样使用 `sqrt()` 和 `sin()`。然而，`math` 模块对象不可用，因为它没有被引入到全局命名空间中。

导入只发生一次。Python 跟踪导入的模块，并且不会再次导入一个模块。这允许我们自由地按需导入模块，而不用担心模块之间的顺序或其他隐晦的依赖关系。

为了确认这个一次性导入规则，尝试以下操作：

```py
>>> import this
>>> import this
```

第二次的行为不同，因为模块已经被导入了一次。

## 使用 Python 包索引 – PyPI

许多 Python 模块的开发者会将他们的作品注册到 PyPI 上。这个网站位于 [`pypi.python.org/`](http://pypi.python.org/)。这是寻找可能帮助解决特定问题的模块的第二个地方。

首先要查找的地方总是标准库。

PyPI 网页提供了一个方便的搜索表单，以及一个浏览器，可以显示按照九个不同的元数据变量组织的软件包。在许多情况下，一本书或博客文章可能会提供一个直接路径，例如：[`pypi.python.org/pypi/Sphinx/1.3b2`](https://pypi.python.org/pypi/Sphinx/1.3b2)。这确保了可以下载和安装正确的版本。

从 PyPI 下载和安装软件有三种常见方式：

+   使用 `pip`

+   使用 `easy_install`

+   手动

通常，我们会使用 `pip` 或 `easy_install` 等工具来安装几乎所有软件。然而，偶尔我们也可能需要手动安装。

一些模块可能涉及 Python 的二进制扩展。这些通常是 C 语言源代码，因此必须编译才能使用。对于 Windows（C 编译器很少见），通常需要找到一个包含预构建二进制的 `.msi` 安装程序。对于 Mac OS X 和 Linux，C 源代码可以作为安装过程的一部分进行编译。

在大型、复杂的数值和科学软件包的情况下——特别是 `numpy` 和 `scipy`——构建过程可能变得相当复杂：通常比 `pip` 或 `easy_install` 能够处理的更复杂。这些软件包有许多额外的性能库；构建包括 FORTRAN 和 C 的模块。在这种情况下，使用预构建的特定于操作系统的分发；`pip` 不是这个过程的一部分。

安装额外的包将需要管理员权限。因此，我们将展示 `sudo` 命令作为提醒，说明在 Mac OS X 和 Linux 上这是必需的。Windows 用户可以简单地忽略 `sudo` 命令的存在。

### 使用 pip 收集模块

`pip` 程序是 Python 3.4 的一部分。它是 Python3 的附加组件。要使用 `pip` 安装一个包，我们通常使用以下命令之一：

```py
prompt$ sudo pip3.4 install some-package

```

对于 Mac OS X 或 Linux，我们需要使用 `sudo` 命令以便拥有管理员权限。Windows 用户可以省略这一步。

`pip` 程序将在 PyPI 上搜索名为 `some-package` 的包。将使用已安装的 Python 版本和操作系统信息来定位适合该平台的最新和最佳版本。文件将被下载，并自动运行包中包含的 Python `setup.py` 文件来安装它。

对于 Mac OS X 和 Linux 用户，值得注意的是，操作系统所需的 Python 版本通常没有配置 `pip`。拥有内置 Python 2.7 和 Python 3.4 的 Mac OS X 用户通常可以使用默认的 `pip` 命令而没有任何问题，因为不会为 Python 2 配置 `pip`。

如果有人同时安装了 Python 3.3 和 Python 3.4，并且为 Python 3.3 安装了 `pip`，他们必须选择他们想要使用的版本。使用 `pip3.3` 或 `pip3.4` 命令将使用为给定 Python 版本配置的 `pip` 命令之一。默认的 `pip` 命令可能链接到最后安装的版本——这是我们不应该猜测的。

`pip` 程序具有许多其他功能，可以卸载包并跟踪哪些包被添加到初始 Python 安装中。`pip` 程序还可以创建您新创建的可安装包。

### 使用 easy_install 添加模块

`easy_install` 包也是 Python 3.4 的一部分。它是 `setuptools` 包的一部分。我们使用 `easy_install` 如下安装一个包：

```py
prompt$ sudo easy_install-3.3 some_package

```

对于 Mac OS X 或 Linux，我们需要使用 `sudo` 命令以便拥有管理员权限。Windows 用户可以省略这一步。

`easy_install` 程序与 `pip` 类似——它将在 PyPI 上搜索名为 `some-package` 的包。将使用已安装的 Python 版本和操作系统信息来定位适合该平台的版本。文件将被下载。其中之一是 `setup.py` 脚本；这将自动运行以完成安装。

### 手动安装模块

在罕见的情况下，我们可能有一个不在 PyPI 上的包，无法通过 `pip` 或 `easy_install` 定位。在这种情况下，我们通常有两个或三个步骤的安装过程：

1.  **下载**：我们需要安全地下载该软件包。在许多情况下，我们可以使用 `https` 或 `ftps` 以确保使用安全的套接字。如果我们无法确保连接的安全性，我们可能需要检查文件的 md5 签名，以确保我们的下载完整且未被篡改。

1.  **解压**：如果 Python 软件包被压缩成单个 ZIP 或 TAR 文件，我们需要将下载的文件解压或解包到临时目录中。

1.  **设置**：许多为手动安装设计的 Python 包都包含一个 `setup.py` 文件，它将执行最终的安装。我们需要运行类似以下的命令：

    ```py
    sudo python3 setup.py install

    ```

这个包括最终命令在内的步骤序列是由 `pip` 和 `easy_install` 自动化的。我们已经展示了在 Mac OS X 和 Linux 上使用 `sudo` 命令来确保管理员权限可用。Windows 用户只需简单地去掉这个命令即可。

`setup.py` 脚本使用 Python 的 `distutils` 包来定义必须安装到 Python 库目录结构中的内容。`install` 选项说明了我们对下载的软件包要做什么。大多数时候，我们会安装，所以这是最常见的选项之一。

在罕见的情况下，一个包可能只包含一个模块文件。可能没有 `setup.py` 文件。在这种情况下，我们将手动将文件复制到我们自己的 `site-packages` 目录中。

# 查看其他 Python 解释器

本书将专注于一种称为 CPython 的特定 Python 实现。这意味着 Python（抽象语言）可以被各种具体的 Python 运行时或实现处理。CPython 实现是用可移植的 C 编写的，并且可以重新编译以适应许多操作系统。

Python 可以嵌入到应用程序中。这意味着一个复杂的应用程序可以包含整个 Python 语言，作为编写脚本来定制给定应用程序的一种方式。一个例子是 Ganglia 监控系统 ([`ganglia.sourceforge.net`](http://ganglia.sourceforge.net))。Python 是系统的一部分；我们可以使用与 Ganglia 组件交互的 Python 脚本来定制其行为。在这本书中，我们不会深入探讨这类应用程序；我们将专注于独立的 Python 实现。

有几种替代的 Python 实现。在本章的 *在 Windows 上安装 Python* 部分中，我们提到 IronPython ([`ironpython.net`](http://ironpython.net)) 和 PTVS ([`pytools.codeplex.com`](http://pytools.codeplex.com)) 可用。这些提供了与 .NET 框架更紧密的集成。

我们可能还会遇到更多的实现：

+   **Jython**：这是用 Java 编写的 Python 解释器版本，它在 Java 虚拟机 (JVM) 上运行。请参阅 [`www.jython.org`](http://www.jython.org)。该项目专注于 Python 2.7。

+   **PyPy**：这是一个用 Python 编写的 Python 解释器版本。请参阅[`pypy.org`](http://pypy.org)。通过 RPython 转换工具链打破了“Python 写在 Python 中”的循环，它创建了一个非常复杂的 Python 程序实现。这可以为各种长时间运行的应用程序，如 Web 服务器，提供显著的性能提升。

+   **无栈**：这个版本的 Python 与 CPython 的线程模型不同。请参阅[`www.stackless.com`](http://www.stackless.com)。这个版本可以为多线程服务器提供显著的性能提升。

由于 Python 源代码易于获取，寻找优化机会相当容易。这种语言相对简单，允许实验以查看实现中的变化可能产生的影响。

# 摘要

我们已经探讨了安装或升级 Python，以便我们可以使用 3.3 或 3.4 版本，并且我们简要地探讨了 Windows、Mac OS X 和 Linux 之间的细微差别。操作系统变体之间的主要差异是 Windows 缺乏 Python，而 Mac OS X 和 Linux 通常已经预装了 Python 版本。操作系统之间几乎没有其他差异。

我们已经探讨了使用 REPL 进行的一些基本交互。我们查看了一些简单的表达式和内置的 `help()` 子系统。

我们已经探讨了 `import` 语句如何扩展我们的 Python 运行时环境的基本功能，并且我们也介绍了更大的 Python 生态系统。我们可以使用 `pip`（和 `easy_install`）工具来扩展我们的 Python 库。PyPI 是大多数 Python 扩展模块的中心仓库。

在下一章中，我们将详细探讨 Python 的数值类型。Python 的数字构成了一种遵循数学中整数、有理数、实数和复数概念的“塔”。我们将探讨数学运算符以及一些用于处理数字的标准库。

我们还将探讨一些更复杂的数据类型，包括特定的元组、字符串和冻结集合。这些相对简单，因为它们是不可变的。正如普通数字的情况一样，这些更复杂对象的值也不会改变。
