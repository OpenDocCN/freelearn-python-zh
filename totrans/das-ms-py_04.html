<html><head></head><body>
        

                            
                    <h1 class="header-title">Basic Best Practices</h1>
                
            
            
                
<p>In the previous chapter, we saw how to put together a Python package of code and data. In this chapter, we're going to look at some rather simple things we can do that will make our lives as Python programmers simpler overall. We'll switch gears and look at version control, which will help us to collaborate with other programmers and serve as an undo buffer for the whole lifetime of a project. We're going to look at Python's built-in virtual environment tool, venv, which allows us to keep our programs and dependencies separate from each other and the software installed on our overall system.</p>
<p>You'll learn how to structure our docstrings for maximum utility, how to add Rich Text formatting to them, and how to export them into hyperlinked HTML documentation for viewing in a web browser. You'll also see one more cool advantage we can get from docstrings by actually executing the examples we include in our documentation and making sure they agree with what the code actually does.</p>
<p>In this chapter, we'll cover the following topics:</p>
<ul>
<li>PEP 8 and writing readable code</li>
<li>Using version control</li>
<li>Using venv to create a stable and isolated work area</li>
<li>Getting the most out of docstrings</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">PEP 8 and writing readable code</h1>
                
            
            
                
<p>In this section, we'll take a quick look at how to format our code so that it'll be easy to read when we come back to it at some later date or when somebody else has to work with it. We will specifically take a look at indentation rules, the Python code style guide, and finally, the standard naming convention.</p>
<p><strong>Python Enhancement Proposals</strong> or <strong>PEPs</strong> are the documents that establish standards in the Python community. Most PEPs describe new features for Python or Python's standard library, but a few of them are more nebulous. PEP 8 is one of those; it tells us what the Python community considers to be well-written, readable code.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">PEP 8 — guidelines for Python code</h1>
                
            
            
                
<p>The very first rule PEP 8 introduces is that rules/guidelines in PEP 8 should only apply when they make our code easier to read. This means we should apply PEP 8 to enhance the readability of the code and to make it less complex. For example, if we're working on a project that was already written with a different coding style (that is, it is already easy to read), we should use that project style for new code. If the PEP 8 rules somehow make the code harder to read or make it complex while writing the code, we should ignore those rules. As Guido Van Rossum, the creator of Python, has noted:</p>
<div><em>Code</em> <em>is read more often than it is written</em>.</div>
<p>Code should always be written in a way that promotes readability.</p>
<p>For more information on PEP 8 rules and guidelines, you can refer to the following link:<br/>
<a href="https://www.python.org/dev/peps/pep-0008/">https://www.python.org/dev/peps/pep-0008/</a>. </p>
<p>To know when to ignore a particular guideline, you can follow the <em>A Foolish Consistency is the Hobgoblin of Little Minds</em> article at the following link:<br/>
<a href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Code indentation</h1>
                
            
            
                
<p>As programmers, when we read code we look at how it's indented to tell us how the code blocks are nested. However, most other programming languages use actual symbols to tell the language parser where a block begins and ends. In coding, the same information in two different places is a violation of the basic best practices of any programming language. So, Python omits the beginning and ending block markers and uses indentation (as shown in the following code screenshot) to inform the parser as well as the programmer:</p>
<div><img height="151" width="341" class="image-border" src="img/d6ffd557-be03-4213-ba16-8e9820c338f1.jpg"/></div>
<p>There is one problem that arises from that, though!</p>
<p>There are different ways of encoding indentation in a text file. These are as follows:</p>
<ul style="padding-left: 5px">
<li>Use Space characters</li>
<li>Tab characters</li>
<li>A combination of both</li>
</ul>
<p>The codes we're looking at in the preceding code image mixes spaces and tabs, which, in Python 2 was valid, but a terrible idea, and which, in Python 3, is a syntax error. I've configured the editor to highlight tab characters in color, so we can easily see which indentation comes from spaces and which comes from tabs, to see why mixing spaces and tabs is not good, even when it's allowed.</p>
<p>All we have to do is change the tab width and it will look something like the following code image:</p>
<div><img height="133" width="245" class="image-border" src="img/e84779a7-6bb4-4097-a00a-4260142de33b.jpg"/></div>
<p>Even though the indentation looked good in the previous code image, now it's clearly wrong. There's no ambiguity if all indentation comes from tab characters. So, using only tabs is valid, even in Python 3. However, it is the recommendation of PEP 8 and the Python community that we always use exactly four spaces to indicate one level of indentation. Any halfway decent editor can insert those spaces for us when we press the Tab key. There are several more recommendations, which we're going to go through quickly in the next sub-section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Formatting recommendations</h1>
                
            
            
                
<p>The code in the following screenshot demonstrates almost all the PEP 8 formatting recommendations:</p>
<div><img height="355" width="839" class="image-border" src="img/5cbe77b4-8c6f-4db6-901a-7cef90e2bf66.jpg"/></div>
<p>I'll now walk us through the recommendations one by one:</p>
<ul style="padding-left: 5px">
<li>PEP 8 recommends that a single line of code should not exceed a width of 79 characters</li>
</ul>
<p>While this is consistent with displaying the code on a standard text mode interface, the primary reason for this rule in the modern world of widescreens and resizable windows is that it helps with reading. Even in contexts that have nothing to do with programming, layout designers prefer to limit line width.</p>
<ul style="padding-left: 5px">
<li>Import statements should be placed at the top of the file, with standard library imports first, third-party imports next, and then imports from other modules within the same project</li>
<li>There should be a blank line between each group of imports</li>
<li>Classes and functions at the top level should have two blank lines separating them.</li>
<li>Methods within a class should have one blank line separating them</li>
<li>Within a function or method, blank lines should be used to indicate separation between conceptual groupings of code</li>
<li>Don't insert extra spaces before or after parentheses, brackets, or braces; and don't insert spaces before commas or colons</li>
<li>Always put a single space on either side of a binary operator, such as <kbd>+</kbd> or <kbd>/</kbd></li>
<li>Don't put more than one statement on the same line, which is occasionally possible, but never a good idea</li>
<li>Comments should be written in human language, using that language's correct grammar</li>
</ul>
<p>Preferably, that language should be English if you're going to allow your source code into the wild because this language is common to the majority of Python programmers.</p>
<ul style="padding-left: 5px">
<li>Comments should also precede the section of code they described and be indented to the same level</li>
<li>Every public module, class, function, or method should have a properly formatted docstring</li>
</ul>
<p>We'll look at what properly formatted means for docstrings in the <em>Getting the most out of docstrings</em> section of this chapter.</p>
<p>Let's move on to picking names for variables, functions, methods, classes, modules, packages, and so on.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Naming conventions</h1>
                
            
            
                
<p>The overriding rule of Python naming conventions is that the naming style for an object should make it plain how the object is used, not what the object is underneath. This means, for example, that a top-level function, which is called to create new objects and which therefore behaves like a class, should be named like a class.</p>
<ul>
<li><strong>Packages and modules</strong>: These should have reasonably short names consisting entirely of lowercase letters, and in the case of modules, underscores.</li>
<li><strong>Classes</strong>: These should be named with a capitalized first letter and capitals at the start of every new word within the name. This is sometimes also called camel case. Exceptions should be classes and so they should follow the class naming convention, but they should also end with the word <kbd>Error</kbd>.</li>
<li><strong>Functions</strong>, <strong>methods</strong>, <strong>instance variables</strong>, and <strong>global variables</strong>: These all should be lower case, with underscores separating the words. If they are meant to be internal rather than part of the public interface, their names should begin with a single underscore.
<ul>
<li>The first parameter of an instance method should always be named self. Named <strong>constant</strong> values should be written in all capital letters, with underscores separating the words.</li>
</ul>
</li>
</ul>
<p>That's it for PEP 8 and the formatting rules that most Python programmers expect other people's code to follow. Now, let's move on to talking about nuts and bolts with a discussion of version control.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using version control</h1>
                
            
            
                
<p>Version control is one of the fundamental tools for programmers in the modern world. It helps us with almost every aspect of a project, in one way or another. There are many version control systems and each of them is a topic in itself, so we're going to narrow our focus here and talk about how to do a few particularly useful things, using a specific version control system called Git.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Initializing Git</h1>
                
            
            
                
<p>The first thing we need to do to use Git, after installing it of course, is to set up a folder as our <kbd>Git repository</kbd>. This only takes a couple of commands on the command line, as shown here:</p>
<div><img height="57" width="459" class="image-border" src="img/f66424f9-95fe-485d-b159-89106a7d77bd.jpg"/></div>
<p>After that, we move to the folders where we want the repository to be, that is, <kbd>git init</kbd> and <kbd>git add</kbd>. Once we've initialized the repository, we add any files that we've already created to it with the <kbd>git add</kbd> command. Then, we create our first safe point in the code with the <kbd>git commit -a</kbd> command, as shown here:</p>
<pre>
<strong>git commit -a<br/></strong>
</pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Committing the changes in Git</h1>
                
            
            
                
<p>The <kbd>git commit -a</kbd> commit command tells Git to commit all the changes that have been made:</p>
<div><img height="145" width="457" class="aligncenter size-full wp-image-1089 image-border" src="img/1cd7114b-98b8-4ce2-bb35-01c66b55eaa5.jpg"/></div>
<p>In the future, if we add new files to the project, we should also use <kbd>git add</kbd> to tell Git to start tracking them. Any time you want Git to remember the current state of our project, we run <kbd>git commit -a</kbd> again.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Undoing the changes</h1>
                
            
            
                
<p>The nice thing about having old project states saved away is that we can go back to them.</p>
<p>For example, let's say we have made some changes in our <kbd>file.txt</kbd> file from <kbd>moo cow</kbd> to <kbd>moo aardvark</kbd>, as shown in the following screenshots:</p>
<div><img height="64" width="136" class="aligncenter size-full wp-image-1090 image-border" src="img/cdcb6853-b147-44b2-b4a9-6327a6dad98d.jpg"/></div>
<div><img height="55" width="323" class="aligncenter size-full wp-image-1091 image-border" src="img/2c7faeb6-03a2-4d2f-8e6d-0dedfc07e17c.jpg"/></div>
<p>If we want to revert a file to a previous state, undoing everything we've done to that file since a particular commit, we just use the <kbd>git log</kbd> command to find the identifier for that commit:</p>
<pre>
<strong>git log</strong>
</pre>
<p>This will lead us to our commit, as shown here:</p>
<div><img height="97" width="381" class="aligncenter size-full wp-image-1092 image-border" src="img/051956b2-d5de-4b8a-a742-edcc9cea7400.jpg"/></div>
<p>Then, we use the <kbd>git checkout</kbd> command to undo our changes. To use the <kbd>git checkout</kbd> command, we just need to enter the commit and the filename and you will get to undo the changes, as shown here:</p>
<div><img height="44" width="435" class="aligncenter size-full wp-image-964 image-border" src="img/3eff2b33-1d76-4b82-902f-f988d59d35c1.jpg"/></div>
<p>If we later change our minds, we can redo the changes in the same way. The ability to undo on the project level is great, but it's even more useful to make provisional changes to our code and then decide, once the changes are done, whether or not we really want them in our main code. That's what branches are for.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Branches</h1>
                
            
            
                
<p>We can make a new branch with <kbd>git checkout -b</kbd>, which will create the branch and switch to it automatically:</p>
<div><img height="34" width="262" class="aligncenter size-full wp-image-965 image-border" src="img/a5377626-1f05-4271-bbfe-eec7cbe38c6e.jpg"/></div>
<p>When we're in the branch, any code changes we make are associated with a branch, and when we leave the branch, they go away. This can be shown in the following example.</p>
<p>Let's say we want to change the <kbd>moo cow</kbd> to <kbd>moo horse</kbd>. For this, we'll run the following command to open up Emacs and edit the text file:</p>
<pre>
<strong>$ emacs file.txt</strong>
</pre>
<div><strong><img height="52" width="316" class="aligncenter size-full wp-image-1093 image-border" src="img/a054b692-dd3e-4cda-89c8-1b3193dfc2a2.jpg"/></strong></div>
<p>We'll then make the changes we want in the file:</p>
<div><img height="42" width="315" class="aligncenter size-full wp-image-1094 image-border" src="img/34c3bfba-d4cc-447b-b79c-4de115ef32a7.jpg"/></div>
<p>We can then commit the file to the branch using the <kbd>git commit -a</kbd> command and add a commit message to keep track of the changes that we've made:</p>
<div><img height="114" width="478" class="aligncenter size-full wp-image-1095 image-border" src="img/eb30482a-0d56-43a9-b2f0-225504d211de.jpg"/></div>
<p>You'll see a record of those changes to show what's been committed:</p>
<div><img height="47" width="350" class="aligncenter size-full wp-image-969 image-border" src="img/99f154f5-e06b-4ec4-85c3-b314f52ba4b0.jpg"/></div>
<p>You can then switch back to the master version using the <kbd>git checkout master</kbd> command to see the original files without any changes, and when we re-enter the branch, those changes come back:</p>
<div><img height="28" width="217" class="aligncenter size-full wp-image-974 image-border" src="img/fe541818-0d84-455e-8746-17c79a6e1003.jpg"/></div>
<p>This means that we can still work on bug fixes in our main branch while we are working on new features in their own development branches. For example, here we can enter the same text file and change the animal to a dog, leaving a comment explaining what we've done:</p>
<p><img height="51" width="461" class="aligncenter size-full wp-image-1096 image-border" src="img/8eae197d-9405-4da6-a7c5-d208fdf9ac55.jpg"/></p>
<p>Then, when we commit that file, we'll also leave a message stating that we've just made a bugfix:</p>
<p><img height="117" width="504" class="aligncenter size-full wp-image-1097 image-border" src="img/82e5165c-754e-4940-baa4-27be50fb609b.jpg"/></p>
<p>As always, we commit the file using the <kbd>git commit</kbd> -a command, and we are shown a record of the changes, as follows:</p>
<div><img height="45" width="333" class="aligncenter size-full wp-image-977 image-border" src="img/1b2e675b-10a5-48aa-84c0-47ccbd9cb47f.jpg"/></div>
<p>When we're finally happy with a feature, we can merge it into the main branch.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Merging codes</h1>
                
            
            
                
<p>To merge code from a different branch, all we have to do is to use the <kbd>git merge</kbd> command from inside the branch we're merging to and give it the name of the branch we're merging from. If the two branches cannot be automatically combined, Git will do it for us:</p>
<div><img height="201" width="483" class="alignnone size-full wp-image-1032 image-border" src="img/227c83bb-d526-4625-b1c2-c694e48326ad.png"/></div>
<p>That's usually all there is to it, but sometimes there are overlapping changes in both branches; when that happens, Git knows it's not smart enough to handle the merger on its own.</p>
<p>When we run <kbd>git merge</kbd>, it will notify us that there are conflicts. Then, we can use <kbd>git mergetool</kbd> to start up the merge resolution tool:</p>
<div><img height="186" width="506" class="aligncenter size-full wp-image-1098 image-border" src="img/e435b720-5edf-4f00-a205-11fd3782d20c.jpg"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">The mergetool command</h1>
                
            
            
                
<p>The merge resolution tool lets us use our greater intelligence to resolve the conflict, as shown here:</p>
<div><img height="104" width="1098" class="aligncenter size-full wp-image-1099 image-border" src="img/0b844b5a-5a12-4902-98b8-72006f8342ad.jpg"/></div>
<p>The <kbd>moo cow</kbd> should be changed to <kbd>moo horse</kbd> to avoid the conflict:</p>
<div><img height="56" width="612" class="aligncenter size-full wp-image-1100 image-border" src="img/cd30f82a-d0c3-44fb-8254-ac921997414a.jpg"/></div>
<p>After the required changes, go to File and quit the interface.</p>
<p>Once that's done, we use the <kbd>git commit</kbd> command to finalize our changes, as shown in the following screenshot.</p>
<div><img height="276" width="757" class="alignnone size-full wp-image-1040 image-border" src="img/8acc4bef-6b14-4e67-bc20-37ca33770644.png"/></div>
<p>The <kbd>mergetool</kbd> command is a smart command that looks for several different tools that exist on various operating systems and picks one of them that it hopes is the best choice for you.</p>
<p>In the present case, it has picked a tool called <kbd>meld</kbd>, which is also written in Python incidentally, for me to use to fix the ambiguity.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">The pull command</h1>
                
            
            
                
<p>Git can do something very similar to combine code from other repositories into our own. The command for that is <kbd>git pull</kbd>, rather than <kbd>git merge</kbd>, and instead of a branch name, we provide the URL or pathname to a different repository, as shown here:</p>
<div><img height="20" width="461" class="alignnone size-full wp-image-1041 image-border" src="img/39c85324-5650-4bc6-9aaf-a23d297ae2e8.png"/></div>
<p>But otherwise, it functions in the same way. This is an incredibly useful feature because it allows us to easily collaborate with other coders, both locally and around the world.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using venv to create a stable and isolated work area</h1>
                
            
            
                
<p>When we're working on a project, we usually like the parts of the project that aren't our own code to stay the same. We might have a good reason to install a new version of Python or updated library on our system, but we don't really want those things to change within our development environment. Even more so, we can easily find ourselves targeting entirely different and incompatible system configurations with different projects. We need a way to set aside an area for each project that is separate and can be configured for the specific needs of that project. That's what we call a virtual environment.</p>
<p>The venv tool that's built in to Python 3.3, and later, creates a virtual environment for us. Each virtual environment created by venv knows which version of Python it should be using and has its own package library, which means that as far as Python code is concerned, it's basically disconnected from the rest of the system.</p>
<p>We can install, uninstall, and update packages on the system and the code inside the virtual environment won't even notice. We can install new versions of Python and the code inside the virtual environment won't notice. The only thing we can't safely do at the system level is uninstalling the version of Python that the virtual environment is based on.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a virtual environment</h1>
                
            
            
                
<p>Creating a virtual environment for a new project is easy; we just open the command line and go to the folder where we want the project folder to reside. Then, we use the version of Python that we want the virtual environment to use to run the venv tool:</p>
<div><img height="27" width="270" class="alignnone size-full wp-image-1042 image-border" src="img/2544e884-ecbe-40e2-9136-2cd5754cbf6e.png"/></div>
<p>When we call venv, we tell it the name we want to give to the project folder. The venv tool will create the project folder and populate it with the files needed to support the virtual environment:</p>
<div><img height="71" width="271" class="alignnone size-full wp-image-1044 image-border" src="img/53a206ad-0e8f-41fd-8489-e1b1b6c105fe.png"/></div>
<p>Each time we actually want to work inside the virtual environment, we should activate it. This will make whatever changes are needed, so that the contents of the virtual environment override the system-level defaults.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Activating a virtual environment</h1>
                
            
            
                
<p>To activate a virtual environment, we open a command line and go to the folder containing the virtual environment:</p>
<div><img height="33" width="182" class="alignnone size-full wp-image-1046 image-border" src="img/76583a08-77b0-4b7a-a5e5-9c81fc460d7d.png"/></div>
<p>Then, execute the activation command. The specific activation command we're using depends on the operating system.</p>
<p>On most Unix-style systems, including Macintosh, we use the <kbd>$ source bin\activate</kbd> command (as shown in the preceding screengrab). On Windows, we run <kbd>Scripts\activate.bat</kbd>.</p>
<p>We are operating inside an activated virtual environment, pip automatically knows it should manage packages for that environment:</p>
<div><img height="204" width="517" class="alignnone size-full wp-image-1049 image-border" src="img/cddec0aa-7780-4447-acd9-7f778c3efc2d.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">pip in virtual environments</h1>
                
            
            
                
<p>Initially, the virtual environment contains only the Python standard library and a couple of utilities, including pip itself.</p>
<p>However, we can use <kbd>pip</kbd> to install the third-party packages that we're going to use on the project. When we looked at pip, you learned about its <kbd>--user</kbd> command-line option, which installs the package into a personal package library instead of the system library.</p>
<p>Installing the package into a personal package library, instead of the system library, is never necessary when installing into a virtual environment because the virtual environment has changed where the default installation location is.</p>
<p>Now that everything is set up, we can begin work. We shouldn't delete any of the files or folders created by venv or pip. However, other than that, we're free to create files and folders as needed for our project. It is often useful to create a subdirectory to contain our working code.</p>
<p>Now that you learned how to use the simple, but useful, venv tool to isolate our coding projects from each other and from most changes to our development system, let's turn to another useful best practice, docstrings.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting the most out of docstrings</h1>
                
            
            
                
<p>In this section, we will take a look at how to format docstrings for maximum readability and how to transform them into structured and formatted documentation. We're also going to look at how to make examples in the documentation testable so that the documentation is never out of date.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">PEP 257 and docutils</h1>
                
            
            
                
<p>PEP 257 documents the expectations of Python programmers and tools with respect to docstrings. The basic rules are quite simple. These are as follows:</p>
<p>The documentation is available at <a href="https://www.python.org/dev/peps/pep-0257/">https://www.python.org/dev/peps/pep-0257/</a>.</p>
<ul>
<li>Use triple quotes to delimit the docstring. Triple quotes are how Python expresses the idea of a multiline text string.</li>
<li>The closing triple quotes should be on a line of their own if your docstring is longer than one line.</li>
<li>The first line should present a short description of the thing being documented, such as "return the distance between n-points a and b."</li>
</ul>
<p>After the first line, we can either end the docstring or insert a blank line, followed by a more in-depth description of the documented object, containing descriptions of parameters, attributes, usage semantics examples, and so on (refer to the following screenshot):</p>
<div><img height="137" width="510" class="alignnone size-full wp-image-1050 image-border" src="img/ec67a7e5-b391-45ba-abc0-09f0b02cea0e.png"/></div>
<p>The reason for this layout is that many tools show the first line of the docstring as a popup, tooltip, or otherwise presented as a quick reference. The text after the blank line is presented when detailed documentation is requested. The docstring processing tools are smart about indentation, so it's safe and encouraged to indent our docstrings, so that they match up with the rest of the code block that they're describing.</p>
<p>Those basic rules are all that are required to make our docstrings interact well with Python's <kbd>pydoc</kbd> and help tools with IDEs, and so on. But they don't give us any way of creating well-formatted standalone documentation. That's where Sphinx comes into play.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Sphinx</h1>
                
            
            
                
<p>Sphinx is a tool that can process Python source code and standalone documentation files and generate nicely formatted documentation in a number of formats, notably HTML. Sphinx, like other Python documentation tools, recognizes a markup language called <kbd>reStructuredText</kbd>, which is intentionally readable and informative, even when its markup is presented as plaintext rather than being interpreted.</p>
<div><kbd>reStructuredText</kbd> can be found at the following link: <a href="https://docs.python.org/devguide/documenting.html#reStructuredText-primer">https://docs.python.org/devguide/documenting.html#reStructuredText-primer</a>.</div>
<p>reStructuredText documents are still readable in a simple text editor, but when we feed them through a tool such as Sphinx they make the end result richer. The reStructuredText syntax is based on the conventions that developed on the internet before actual rich text was widely available in email and real-time chat.</p>
<p>So, for example, words are emphasized by putting an asterisk (<kbd>*text*</kbd>) at each end and emphasized further by making that into two asterisks (<kbd>**text**</kbd>). Paragraphs are marked by placing a blank line between them.</p>
<p>There are syntaxes for lists, headings, and so on, all plainly readable in text mode. The syntax is nicely described in the Python developer's guide, but we're going to concentrate on a few bits of markup that do a lot to enhance the documentation for modules and packages. We actually saw one of those bits of markup earlier.</p>
<p>When our docstrings make reference to a local variable, such as a function parameter, that reference should be enclosed in asterisks to emphasize it and make it distinct from the normal text of the documentation. The names of modules, classes, functions, methods, attributes, exceptions, global variables, and constants should all be marked properly, so that Sphinx can cross-reference them and create links to their documentation.</p>
<p>All of these object types share a similar syntax, which is that we put a type identifying keyword between colons, immediately followed by the name of the object in back quotes:</p>
<div><img height="53" width="498" class="alignnone size-full wp-image-1135 image-border" src="img/b6a50fec-5b59-4ee3-855c-e3780d4e1051.png"/></div>
<p>As you saw in the preceding example with classes and methods, we used the keywords class for <kbd>classes</kbd> and <kbd>meth</kbd> for methods. Other keywords available are: <kbd>mod</kbd> for modules, <kbd>func</kbd> for functions, <kbd>attr</kbd> for attributes, <kbd>data</kbd> for variables, and <kbd>const</kbd> for constants.</p>
<p>That's enough reStructuresText syntax to make a big difference in the quality of our documentation. So, we're going to leave it there and go on to talk about how to actually use the Sphinx tool. If it's not already installed, we can install it using <kbd>pip</kbd>, as shown in the following command:</p>
<pre>
<strong>(sphinx) $ python3 -m pip install sphinx</strong>
</pre>
<p>Sphinx can do a lot more, so it's worth working through the tutorial on<br/>
<a href="https://www.sphinx-doc.org/en/stable/tutorial.html" target="_blank">https://www.sphinx-doc.org/en/stable/tutorial.html</a>.<br/>It's quite nice.</p>
<p>For our own purposes though, all we're interested in is turning docstrings into HTML. So, we'll work through that process in the next sub-section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Turning docstrings into HTML</h1>
                
            
            
                
<p>We're going to generate HTML documentation for our example package, which is just a docstring example. We start by going to the directory that contains our package directory. Once there, we run <kbd>sphinx-quickstart</kbd> to set things up. </p>
<div><img height="188" width="497" class="alignnone size-full wp-image-1055 image-border" src="img/e58f0e7e-3c9b-4145-b352-b24e3edd85a8.png"/></div>
<p>The first thing that <kbd>sphinx-quickstart</kbd> asks is what the root path for the documentation should be. I find that it works well to use a folder called <kbd>docs</kbd> for this, so I suggest typing in <kbd>docs</kbd> for the root path:</p>
<div><img height="201" width="522" class="alignnone size-full wp-image-1057 image-border" src="img/57a68d82-89a0-487c-beda-11827c630f93.png"/></div>
<div><p>The <kbd>sphinx-quickstart</kbd> command will ask several more questions, which we can answer as we like, and then eventually it will ask if we want to enable the autodoc plugin; we will enable it by entering yes (<kbd>y</kbd>):</p>
<p> </p>
<div><img height="412" width="525" class="image-border" src="img/ba5c2263-90ba-4736-933e-a24f5b7c26aa.png"/></div>
<p>The rest of the questions are not so important for our purposes. After answering all the questions, the <kbd>sphinx-quickstart</kbd> command is completed as shown in the following screenshot: </p>
<div><img style="text-align: center;color: #333333;font-size: 1em" height="406" width="516" class="alignnone size-full wp-image-1060 image-border" src="img/c7e22da1-93c7-4d6d-9130-9611452a901f.png"/></div>
<p>Once <kbd>sphinx-quickstart</kbd> is completed, we'll want to run <kbd>sphinx-apidoc -o</kbd> with our directory to automatically generate Sphinx or Sphinx source files describing our package:</p>
<img height="586" width="1184" class="alignnone size-full wp-image-1064 image-border" src="img/d7e4c475-ee44-4405-aad8-89355a0be4ab.png"/></div>
<p>Our docstrings are extracted and incorporated into these source files.</p>
<p>Finally, when we want to generate the HTML we can construct it by running <kbd>make html</kbd> from the command line. Sphinx will translate its source files, including the ones automatically generated by <kbd>sphinx-apidoc</kbd> into HTML and store the result in the build directory that we specified when we were going through the <kbd>sphinx-quickstart</kbd> questions.</p>
<p>If we edit our source code and want to update the HTML documentation, we can usually do it simply by running the following command again:</p>
<pre>
<strong>(sphinx) $ make html<br/></strong>
</pre>
<p>If we've made major changes to the package structure, we'll need to run the <kbd>sphinx-apidoc</kbd> command again as well:</p>
<pre>
<strong>(sphinx) $ sphinx-apidoc -o docs/ example/<br/></strong>
</pre>
<p>So, Sphinx can be used as a documentation compiler, which turns our docstrings source code into HTML-compiled code.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using doctest to test documentation examples</h1>
                
            
            
                
<p>Including examples of use in our docstrings is common, but if we're not careful, those examples can get left behind when the code changes, and the wrong documentation is worse than no documentation. Fortunately, we have a tool that can check whether the documentation agrees with the code by running the examples from our documentation and seeing what happens. That tool is called <strong>doctest</strong>.</p>
<p>To enable doctest to recognize our examples as things it can test, all we have to do is include the Python interactive shell prompt into our example. In the simplest and most common case, that just means putting a <kbd>&gt;&gt;&gt;</kbd> symbol in front of each statement, as shown in the following screenshot. For multi-line statements, we prefix the continuation line with a <kbd>...</kbd> symbol:</p>
<div><img height="256" width="337" class="alignnone size-full wp-image-1071 image-border" src="img/6dd6e73d-25de-4916-bc5a-5373f2ad476b.png"/></div>
<p>After each statement, we should write down the expected result of the statement, written the same way the interactive shell would write it. In other words, if we copy and paste directly from the interactive shell, we've created an example that doctest can recognize. So, writing doctest is pretty straightforward.</p>
<p>There's a decent chance of writing a doctest into our docstrings, even if we didn't know the doctest tool exists. As an added bonus, Sphinx recognizes doctest and formats it appropriately too. So, if we're going to include code examples in our docstrings, the way to do it is explained in the following section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Testing examples using doctest</h1>
                
            
            
                
<p>To test the code example using doctest, we just need to run the following command:</p>
<pre>
<strong>$ python3 -m doctest example.py -v</strong>
</pre>
<p>We will get the following output:</p>
<div><img height="298" width="244" class="alignnone size-full wp-image-1068 image-border" src="img/fe6cd367-a947-47f3-9709-ce3a3d8a69bf.png"/></div>
<p>Having doctest run all the examples in a file and report back whether they worked is easy. We just run the doctest utility from the command line and tell it which files we were interested in. The <kbd>-v</kbd> option in the command makes it pull out extra information, which isn't necessary, but often is helpful.</p>
<p>All we see in the preceding example is a lack of error messages rather than any confirmation that everything worked or is tested.</p>
<p>There are other ways of running doctests including a Sphinx plugin that sphinx-quickstart asks us whether we want. It's also possible to integrate doctests into a test suite for Python's standard unit test library, or to use an integrated test runner called nos to find an excuse to execute them; doctests directly will do for our purposes in such cases, though.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">What it means when a code example fails</h1>
                
            
            
                
<p>Now, what happens if a doctest fails, but after looking at it we see that the documentation and example are actually correct? Well, that means our code is incorrect. Believe it or not, this is a very good thing. I don't mean that having an error is a good thing, but that error was there whether we found it or not. Finding it and having a test on hand that will let us check whether we've succeeded in fixing it, though, is definitely good.</p>
<p>So, doctest ties our code and documentation together, so that they stay synchronized and serve to double-check each other. That's a very useful docstring trick.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, you learned about writing readable code, version control to keep track of our code, and about the venv tool and the isolated virtual environments it creates. You learned how to format our docstrings to take advantage of automated tools, such as IDEs and the Sphinx documentation compiler. You also learned about writing examples into our documentation and how to use the doctest tool to check whether the examples and code are synchronized</p>
<p>In the next chapter, you'll get to learn how to turn a package into a program that can be run from the command line.</p>


            

            
        
    </body></html>