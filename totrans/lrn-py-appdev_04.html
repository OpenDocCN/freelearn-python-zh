<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Documentation and Best Practices</h1></div></div></div><p>So far, the focus was on developing the code and getting the first release out the door. We have not talked about another vital aspect of application development, the documentation and coding standards. Although the code base is still quite manageable, before it is too late, we should learn techniques to improve code readability. In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding the basics of the <strong>reStructuredText</strong> (<strong>RST</strong>) format and how to use it for writing docstrings</li><li class="listitem" style="list-style-type: disc">Learning how to create HTML documentation for the code using the <strong>Sphinx</strong> document generator</li><li class="listitem" style="list-style-type: disc">Covering some important coding standards for writing the Python code</li><li class="listitem" style="list-style-type: disc">Using <strong>Pylint</strong> to evaluate how well we are doing in following these guidelines</li></ul></div><p>As you can guess from the preceding topics, we are taking a short break from coding to learn these very important concepts.</p><div><img src="img/B05034_04_01.jpg" alt="Documentation and Best Practices"/></div><div><table border="1"><colgroup><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<em>If you are well aware of the code, you might find documentation unnecessary. But imagine you are assigned a different project that has a big code base with very little documentation. How will you feel? Of course, you will have to review the code anyway to get familiar with it. But your productivity will take a blow if it is not well documented. The time you spend understanding such code also depends on how well it has been written. This is where the coding standard aspect comes into the picture.</em>
</p>
</td></tr></tbody></table></div><p>In summary, never ignore coding standards and documentation. Make sure you follow these guidelines while the code is being developed. It is also important to maintain the documentation and not to over document. Let's start by learning techniques to create good documentation for a Python project.</p><div><div><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Documenting the code</h1></div></div></div><p>There are, broadly, three levels of <a id="id236" class="indexterm"/>documentation. At the top, you have project- or <a id="id237" class="indexterm"/>
<strong>distribution-level documentation</strong>. It<a id="id238" class="indexterm"/> is intended to give high-level information on a project, such as installation instructions, licensing terms, and so on. In <a class="link" href="ch03.html" title="Chapter 3. Modularize, Package, Deploy!">Chapter 3</a>, <em>Modularize, Package, Deploy!</em>, you already had a flavor of this documentation. We created the <code class="literal">README</code> and <code class="literal">LICENSE</code> files to go along with the distribution. Additionally, you can add more files to make the documentation comprehensive, such as <code class="literal">INSTALL</code>, <code class="literal">TODO</code>, <code class="literal">RELEASENOTES</code>, <code class="literal">CREDITS</code>, and so on.</p><p>The second level is the <a id="id239" class="indexterm"/>
<strong>API-level documentation</strong>. It summarizes how a function, method, <a id="id240" class="indexterm"/>class, or module should be used. Python docstrings, which we will learn next, are used to generate API-level documentation.</p><p>The third level of <a id="id241" class="indexterm"/>documentation<a id="id242" class="indexterm"/> is in the form of <a id="id243" class="indexterm"/>
<strong>code comments</strong>. Such comments help explain how a piece of code works.</p><p>
<strong>Sphinx</strong>
<a id="id244" class="indexterm"/> is a document generation tool for Python that is used to create project- and API-level documentations. In this chapter, we will use Sphinx to create API-level documentation from the docstrings. But, before jumping into this topic, let's first understand what docstrings in Python are.</p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>
<strong>Python Enhancement Proposals (PEPs)</strong>
<a id="id245" class="indexterm"/> provide a way to propose and document various design standards for the Python language. There are several PEPs, and each one is identified by a permanent number. For example, <em>PEP 8</em>, <em>PEP 257</em>, <em>PEP 287</em>, and so on.</p><p>
<em>PEP 257</em> documents the guidelines to write docstrings, whereas <em>PEP 287</em> provides information on the reStructuredText docstring format (more on the reStructuredText format later in the chapter).</p><p>The purpose of this chapter is not to repeat what is already documented by these PEPs. We will refer to these guidelines whenever appropriate in the sections to follow. For a comprehensive<a id="id246" class="indexterm"/> understanding of these and other PEPs, check out <a class="ulink" href="https://www.python.org/dev/peps">https://www.python.org/dev/peps</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec64"/>Docstrings</h2></div></div></div><p>A docstring<a id="id247" class="indexterm"/> or document string is a string literal used to describe a class, method, function, or module. The purpose of a docstring is to briefly describe features of the code. It is different than a comment that elaborates details on the internal working of a piece of code. It can be accessed using the built-in attribute, <code class="literal">__doc__</code>. Let's write an example to illustrate this concept. Open the Python interpreter and write the following trivial function:</p><div><pre class="programlisting">
<strong>&gt;&gt;&gt; def get_number(): </strong>
<strong>...     return 10</strong>
<strong>... </strong>
<strong>&gt;&gt;&gt;</strong>
</pre></div><p>Let's see what the <code class="literal">__doc__</code> attribute for this function stores:</p><div><pre class="programlisting">
<strong>&gt;&gt;&gt; get_number.__doc__ </strong>
<strong>&gt;&gt;&gt; </strong>
</pre></div><p>The <code class="literal">__doc__</code> attribute for the function is an empty string as we have not written any documentation for this function. Now let's write a docstring for the function and print this attribute again:</p><div><pre class="programlisting">
<strong>&gt;&gt;&gt; def get_number(): </strong>
<strong>...     """Return a special number""" </strong>
<strong>...     return 10 </strong>
<strong>... </strong>
<strong>&gt;&gt;&gt; get_number.__doc__ </strong>
<strong>'Return a special number'</strong>
</pre></div><p>The <code class="literal">__doc__</code> attribute now shows the docstring for the function. As can be seen, a docstring is represented differently than a comment. It is surrounded by triple double quotes (recommended style), <code class="literal">"""Return a special number"""</code>, or triple single quotes, <code class="literal">'''Return a special number'''</code>, and is written as the first statement of that class, method, function, or module.</p><div><div><h3 class="title"><a id="tip26"/>Tip</h3><p>
<strong>PEP 257</strong>
</p><p>The simple example shown in the previous code is that of a single-line docstring. Similarly, you can have multi-line docstrings. Review the PEP 257 convention<a id="id248" class="indexterm"/> (<a class="ulink" href="https://www.python.org/dev/peps/pep-0257">https://www.python.org/dev/peps/pep-0257</a>) for further details.</p></div></div><p>To generate<a id="id249" class="indexterm"/> effective documentation using Sphinx, the docstring should be written in a markup language known as reStructuredText. Let's understand the basics of this format next.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec65"/>Introduction to reStructuredText</h2></div></div></div><p>
<strong>reStructuredText</strong> (<strong>RST</strong>), <a id="id250" class="indexterm"/>defines a simple markup syntax, mainly for Python documentation. It is a part of the Python documentation processing system called <a id="id251" class="indexterm"/>
<strong>docutils</strong> (<a class="ulink" href="http://docutils.sourceforge.net/index.html">http://docutils.sourceforge.net/index.html</a>).</p><div><div><h3 class="title"><a id="tip27"/>Tip</h3><p>
<strong>RST</strong>
</p><p>Does this sound familiar? In <a class="link" href="ch03.html" title="Chapter 3. Modularize, Package, Deploy!">Chapter 3</a>, <em>Modularize, Package, Deploy</em>, without much elaboration, we created a <code class="literal">README</code> file with the RST format. In that chapter, refer to the section <em>Prepare the distribution</em> for more information. This section will give you a bare <a id="id252" class="indexterm"/>minimum introduction to the RST syntax. For further reading, comprehensive documentation is available at <a class="ulink" href="http://docutils.sourceforge.net/rst.html">http://docutils.sourceforge.net/rst.html</a>.</p></div></div><p>Let's review some of the most frequently used features of RST.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec24"/>Section headings</h3></div></div></div><p>To distinguish a section <a id="id253" class="indexterm"/>title from the rest of the text, it is decorated with<a id="id254" class="indexterm"/> an underline created using any one of the non-alpha numeric characters, such as <code class="literal">~~~~</code>, <code class="literal">====</code>, <code class="literal">–---</code>, or <code class="literal">####</code>. The decorated underline should be of the same length (or longer) as the heading text, as shown in the following example header:</p><div><pre class="programlisting">1. Introduction
----------------</pre></div><p>Here, dashes (<code class="literal">---</code>) are used to decorate the heading. Suppose this is considered as the <em>Heading 1</em> style in the document; any subsequent use of this decorator will result in the same style. In the following screenshot, the RST syntax is shown in the left column; the right column shows how it will be displayed in a browser:</p><div><img src="img/B05034_04_02.jpg" alt="Section headings"/></div><div><div><h3 class="title"><a id="tip28"/>Tip</h3><p>
<strong>Try it yourself!</strong>
</p><p>You can use <a id="id255" class="indexterm"/>online RST editors, such as <a class="ulink" href="http://rst.ninjs.org">http://rst.ninjs.org</a>, to quickly test how your RST file will be processed.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec25"/>Paragraphs</h3></div></div></div><p>To create a <a id="id256" class="indexterm"/>paragraph, simply write one. When done, leave at least one blank line at the end of it. Also, if you indent a paragraph in the RST file, it will appear as an indented block in the browser. Here is the RST syntax to write two paragraphs:</p><div><pre class="programlisting">para1. Just write the sentences in the para 
and end it by adding one or more blank line.
 
  
    para2 . blah blah blah. 
    ...more stuff in paragraph 2 See how it gets appended.. </pre></div><p>As an exercise, use any online RST editor and see how it will appear in a web browser.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec26"/>Text styles</h3></div></div></div><p>You can apply a different <a id="id257" class="indexterm"/>text style inside a paragraph or to the body text. Decorate the text with double asterisks to make it appear bold, for example, <code class="literal">**bold_text**</code>. Similarly, a single asterisk decoration, <code class="literal">*italics_text*</code>, is used for <em>italics</em> style.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec27"/>Code snippets</h3></div></div></div><p>RST provides various <a id="id258" class="indexterm"/>directives to process formatted document blocks. The <code class="literal">code-block</code> directive is specified with syntax, for example, <code class="literal">.. code-block::</code>. Note that there is a space between the word <code class="literal">code-block</code> and the two preceding dots. The <code class="literal">code-block</code> directive can be specified along with the code language to construct a literal block. In the sample RST shown next, we have specified Python as the code language:</p><div><pre class="programlisting">.. code-block:: python 

    from wargame.attackoftheorcs import AttackOfTheOrcs 
    game = AttackOfTheOrcs() 
    game.play() </pre></div><p>The argument to the <code class="literal">code-block</code> directive is specified as <code class="literal">python</code>. It tells the document generator that it is Python syntax. Additionally, note that there should be a blank line after the directive before writing the actual code. You can also use the <code class="literal">code</code> directive, <code class="literal">.. code::</code>, to represent a piece of code. For the syntax highlighting, a Python package called <strong>Pygments</strong>
<a id="id259" class="indexterm"/> is required. We'll talk more on this later, when we learn about the Sphinx document generator.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec28"/>Mathematical equations</h3></div></div></div><p>The <code class="literal">math</code> directive<a id="id260" class="indexterm"/> is used to write mathematical equation. Note that you need to leave a blank space before and after the mathematical equation block. The following syntax (the left column) is one way to represent a mathematical formula. The right column shows how it will be displayed in a web browser:</p><div><img src="img/B05034_04_03.jpg" alt="Mathematical equations"/></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec29"/>Bullets and numbering</h3></div></div></div><p>Bullets <a id="id261" class="indexterm"/>can be added using any of the following characters: <code class="literal">*</code>, <code class="literal">+</code>, or <code class="literal">-</code>. It is required to have at least one blank line, immediately before the first bullet and immediately after the last bullet item:</p><div><pre class="programlisting">Text before the bullet points. A blank line follows...

* First bullet item
  Some continuation text for first bullet, 
  Note that its alignment should match the bullet it is part of.  
* second bullet item
* last bullet item

Text after the bullets. Again needs a blank line after the last bullet. </pre></div><p>Similarly, you can specify a<a id="id262" class="indexterm"/> numbered list, as follows:</p><div><pre class="programlisting">Text before the enumerated list. A blank line follows...

1. item 1
2. item 2
   some continuation stuff in item 2
3. item 3

Text after the enumerated lust. Again needs a blank line after the last item. </pre></div><div><div><h3 class="title"><a id="tip29"/>Tip</h3><p>
<strong>Key things to remember</strong>
</p><p>The RST syntax requires you to leave blank lines between different style blocks. For example, when you write a code snippet, a mathematical equation, or a paragraph, you need one blank line before and after these documentation blocks. RST is indentation sensitive.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec66"/>Dosctrings using RST</h2></div></div></div><p>To generate <a id="id263" class="indexterm"/>nice-looking documentation for our application, we need to first write docstrings in the RST format. The <em>PEP 287</em> proposes guidelines to write docstrings using the RST format. For a comprehensive <a id="id264" class="indexterm"/>description, check out <a class="ulink" href="https://www.python.org/dev/peps/pep-0287">https://www.python.org/dev/peps/pep-0287</a>. Here, we will discuss some of the most important things to remember when you write docstrings. To illustrate the concept, let's write a docstring for the <code class="literal">wargame/hut.py</code> module. The documentation is also provided in the supplementary code for the chapter. </p><p>The following code screenshot has a sample class-level docstring for the <code class="literal">Hut</code> class:</p><div><img src="img/B05034_04_09.jpg" alt="Dosctrings using RST"/></div><p>Let's review this syntax now:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The documentation standard<a id="id265" class="indexterm"/> recommends a one-line summary separated by a blank line before the next descriptive block.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">:arg</code> fields describe the input arguments for this class, as given in the <code class="literal">__init__</code> method. You can also use the <code class="literal">:param</code> field for this.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">:ivar</code> field is used to describe the instance variables for the class. You can, optionally, specify the type of the instance variable on the same line, for example:<div><pre class="programlisting">:ivar int number: A number assigned to this hut.
:ivar AbstractGameUnit occupant: The occupant of...</pre></div><p>When Sphinx generates the HTML documentation, the instance variable type will be displayed next to its name. It will also try to create a link to that type.</p></li><li class="listitem" style="list-style-type: disc">The <code class="literal">.. seealso::</code> field directive is used to reference anything related to this class that you feel is important.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">:py:meth:</code> field is used for cross-referencing methods. Note that the method name should be bound by the back quotes (symbol <code class="literal">`</code>).</li><li class="listitem" style="list-style-type: disc">Observe that we have not written any docstring for the <code class="literal">__init__</code> method. The guidelines suggest that you either write a docstring for the class or for its <code class="literal">__init__</code> method. For simplicity, let's follow the style just illustrated, where the docstring is written at the class level.</li></ul></div><div><div><h3 class="title"><a id="tip30"/>Tip</h3><p>When Sphinx generates the documentation, by default, it ignores the docstring for the <code class="literal">__init__</code> method. You can change this default behavior using the <code class="literal">autodoc-skip-member</code> event inside <code class="literal">conf.py</code>. For more information, check out <a class="ulink" href="http://sphinx-doc.org/ext/autodoc.html#skipping-members">http://sphinx-doc.org/ext/autodoc.html#skipping-members</a>.</p></div></div><p>Sphinx-generated HTML documentation for the <code class="literal">Hut</code> class will appear as shown in the following screenshot. You will learn how to create such documentation shortly!</p><div><img src="img/B05034_04_10.jpg" alt="Dosctrings using RST"/></div><p>What was just presented should serve as a basic example. There is a lot more that you can do with RST and Sphinx. The following table lists some of the most commonly used features (directives, information fields, and syntax) to write docstrings. Use these fields in the same way as<a id="id266" class="indexterm"/> illustrated in the preceding example. For comprehensive documentation, visit the Sphinx<a id="id267" class="indexterm"/> website (<a class="ulink" href="http://sphinx-doc.org">http://sphinx-doc.org</a>).</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Information field or directive</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">:param</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Parameter description.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">:arg</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used to describe input arguments.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">:key</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Keyword description.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">:type</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Type of the parameter or argument, for example, <code class="literal">int</code>, <code class="literal">string</code>, and so on. You can also use the alternate syntax, for example:</p>
<p>
</p><div><pre class="programlisting">:param type param_name: description </pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">:ivar</code> or <code class="literal">:var</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Any variable description. Generally used for instance variables.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">:vartype</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Variable type description.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">:py:meth:</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">:py:func:</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">:py:class:</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">:py:attr:</code></li></ul></div>
</td><td style="text-align: left" valign="top">
<p>Syntax to cross-reference a Python method, function, class, or attribute receptively. For example, <code class="literal">:py:meth:`MyClassA.method_a`</code> will be shown as <code class="literal">MyClassA.method_a()</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.. code::</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Any code samples can be included here. The section under this directive is processed as a code block by the Sphinx document generator.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.. todo::</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Use this directive to list the TODO items.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.. note::</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Document anything worthy of mentioning using the notes directive.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.. warning::</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Directive to write warnings in the docstring. The warning block will be generally rendered with a light red background.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.. seealso::</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Use this <a id="id268" class="indexterm"/>directive to reference anything (a method, a function, and so on) related to the code for which you are writing the docstring.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec67"/>Docstring formatting styles</h2></div></div></div><p>In this chapter, we <a id="id269" class="indexterm"/>will only use the default RST format to write the docstrings. Various projects follow their own convention to write docstrings. Many of these styles are compatible with the Sphinx document generator.</p><p>The<a id="id270" class="indexterm"/> <em>Google Python Style Guide</em> (<a class="ulink" href="https://google.github.io/styleguide/pyguide.html">https://google.github.io/styleguide/pyguide.html</a>) will be briefly discussed here. This style is widely used because of the simplicity it offers. It will become obvious when you see the following code screenshot. It is the same docstring we wrote for the <code class="literal">Hut</code> class, rewritten using the <em>Google Python Style Guide</em>:</p><div><img src="img/B05034_04_11.jpg" alt="Docstring formatting styles"/></div><p>For this to work with Sphinx, you need to install <a id="id271" class="indexterm"/>
<strong>napoleon</strong>, an extension for Sphinx. It is essentially a pre-processor that parses and converts the Google style docstrings into the RST format. Check out <a class="ulink" href="https://pypi.python.org/pypi/sphinxcontrib-napoleon/">https://pypi.python.org/pypi/sphinxcontrib-napoleon/</a> for installation instructions for napoleon<a id="id272" class="indexterm"/>. Examples on the Google Python documentation style can be found on the napoleon documentation page, <a class="ulink" href="http://sphinxcontrib-napoleon.readthedocs.org">http://sphinxcontrib-napoleon.readthedocs.org</a>.</p><div><div><h3 class="title"><a id="tip31"/>Tip</h3><p>The <strong>Numpy</strong> style of documentation is another popular style used within the Python community. It is also supported by the napoleon extension. Check out <a class="ulink" href="http://sphinxcontrib-napoleon.readthedocs.org">http://sphinxcontrib-napoleon.readthedocs.org</a> for further details.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec68"/>Automatically creating docstring stubs</h2></div></div></div><p>This is bit of an <a id="id273" class="indexterm"/>advanced topic, mainly because it needs some background in using command-line tools such as <a id="id274" class="indexterm"/>
<strong>patch</strong>.</p><p>In many situations, you do not even have the basic docstrings written for the functions, methods, and classes. Or, you might be following a Google docstring style but now you would like to switch to a different one, say a basic RST style. The open source tool <a id="id275" class="indexterm"/>
<strong>pyment</strong> is meant for such scenarios. It can be used to create or update docstrings and also to convert between some common formatting styles, such as RST, Google docstring, and <a id="id276" class="indexterm"/>
<strong>numpydoc</strong>.</p><div><div><h3 class="title"><a id="tip32"/>Tip</h3><p>Read it again…the tool's name is "pyment" and not "payment" (not to be confused with the Python package <code class="literal">Pygment</code>). This tool is available on GitHub (<a class="ulink" href="https://github.com/dadadel/pyment">https://github.com/dadadel/pyment</a>). It was not available on the PyPi website at the time this chapter was written. So you might not be able to install it using the pip <code class="literal">$pip install pyment</code> command.</p></div></div><p>As pyment is not<a id="id277" class="indexterm"/> available using pip, the installation instructions are different. Follow the install instructions on the <a id="id278" class="indexterm"/>GitHub project homepage (<a class="ulink" href="https://github.com/dadadel/pyment">https://github.com/dadadel/pyment</a>). The alternative install instructions, which do not require the use of Git, are provided here:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the ZIP archive of pyment from the project homepage.</li><li class="listitem">Extract this ZIP file to some folder, for example, <code class="literal">pyment-master</code>.</li><li class="listitem">Open the command prompt and execute the following commands:<div><pre class="programlisting">
<strong>$ cd  pyment-master</strong>
<strong>$ python setup.py install</strong>
</pre></div></li></ol></div><p>The last command should install pyment in the same directory where you have the Python executable. Depending on where your Python is installed, you may need to execute the preceding command as an administrator. After the installation, run this tool from the command line as follows:</p><div><pre class="programlisting">
<strong>$ pyment hut.py</strong>
</pre></div><p>This generates a patch file called <code class="literal">hut.py.patch</code> where the basic docstring stubs are written.</p><div><div><h3 class="title"><a id="tip33"/>Tip</h3><p>Here, it is important to note that pyment will only create a basic docstring stub. It is our responsibility to fill in the blanks. Put another way, we should further improve these docstrings by writing the appropriate summary of the function or method—a one-liner on what each input argument (if any) does and so on.</p></div></div><p>Next, you are expected to merge this patch with the main file, <code class="literal">hut.py</code>. On Linux, use the following <code class="literal">patch</code> command<a id="id279" class="indexterm"/> (check out <a class="ulink" href="https://en.wikipedia.org/wiki/Patch_(Unix)">https://en.wikipedia.org/wiki/Patch_(Unix)</a> for more details) to merge the generated docstrings with the main file:</p><div><pre class="programlisting">
<strong>$ patch hut.py hut.py.patch </strong>
<strong>patching file hut.py </strong>
</pre></div><div><div><h3 class="title"><a id="tip34"/>Tip</h3><p>
<strong>Windows users</strong>
</p><p>The <code class="literal">patch</code> command described here is a Unix command. On Windows, patching a file might not be straightforward. Here are a few options that can be used to apply a patch:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Gnu utilities for win32</strong>: This <a id="id280" class="indexterm"/>will also install a bunch of other utility tools commonly seen on the Unix platform. Use the <code class="literal">patch.exe</code> executable to apply patches. You can check out these utilities at (<a class="ulink" href="http://unxutils.sourceforge.net">http://unxutils.sourceforge.net</a>).</li><li class="listitem" style="list-style-type: disc"><strong>python-patch</strong>: Check out this<a id="id281" class="indexterm"/> cross-platform Python utility at <a class="ulink" href="https://github.com/techtonik/python-patch">https://github.com/techtonik/python-patch</a>.</li><li class="listitem" style="list-style-type: disc"><strong>TortoiseMerge</strong>: It is a <a id="id282" class="indexterm"/>GUI tool used to apply patches (<a class="ulink" href="https://tortoisesvn.net/docs/release/TortoiseMerge_en/tmerge-dug.html">https://tortoisesvn.net/docs/release/TortoiseMerge_en/tmerge-dug.html</a>).</li></ul></div></div></div><p>With this, the <code class="literal">hut.py</code> module should show the basic docstring stubs. We have developed a basic understanding on creating docstrings. Let's take the documentation to the next level using Sphinx.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec69"/>Generating documentation with Sphinx</h2></div></div></div><p>Sphinx is the <em>de facto</em> standard document <a id="id283" class="indexterm"/>generation tool for Python. Do not confuse it with a docstring. A docstring is something you write to summarize the behavior of an object. For example, a class docstring typically lists instance variables and public methods depending on your project's documentation guideline.</p><p>Sphinx uses such docstrings, or any RST file, to create nice-looking documentation. It can generate documentation in various output formats, such as HTML, PDF, and so on. Let's follow a step-by-step approach to generate API documentation in HTML format with Sphinx.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec30"/>Step 1 – Installing Sphinx using pip</h3></div></div></div><p>Sphinx can be installed <a id="id284" class="indexterm"/>using pip, as shown in the following command line:</p><div><pre class="programlisting">
<strong>$ pip install Sphinx</strong>
</pre></div><div><div><h3 class="title"><a id="tip35"/>Tip</h3><p>pip is the package manager used to install Python packages. Refer to <a class="link" href="ch01.html" title="Chapter 1. Developing Simple Applications">Chapter 1</a>, <em>Developing Simple Applications</em> for more information on pip.</p></div></div><p>This creates four <a id="id285" class="indexterm"/>executable scripts, <code class="literal">sphinx-autogen</code>, <code class="literal">sphinx-apidoc</code>, <code class="literal">sphinx-build</code>, and <code class="literal">sphinx-quickstart</code>.</p><div><div><h3 class="title"><a id="tip36"/>Tip</h3><p>On Linux, these executable are placed at the same location as your Python executable. For instance, if Python is available as <code class="literal">/usr/bin/python</code>, Sphinx executables can be accessed from the same location. On Windows OS, the Sphinx executables are put in the <code class="literal">Scripts</code> directory. It is the same directory where you have <code class="literal">pip.exe</code>. Refer to <a class="link" href="ch01.html" title="Chapter 1. Developing Simple Applications">Chapter 1</a>, <em>Developing Simple Applications</em> for further details.</p></div></div><p>For syntax highlighting the code, Sphinx uses a tool called <a id="id286" class="indexterm"/>
<strong>Pygments</strong> (<a class="ulink" href="http://pygments.org">http://pygments.org</a>). Install this package using pip, if it is not already provided in your Python distribution:</p><div><pre class="programlisting">
<strong>$ pip install pygments</strong>
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec31"/>Step 2 – cd to the source directory</h3></div></div></div><p>In <a class="link" href="ch03.html" title="Chapter 3. Modularize, Package, Deploy!">Chapter 3</a>, <em>Modularize, Package, Deploy</em>, we created a Python package by the name of <code class="literal">wargame</code>, containing all the<a id="id287" class="indexterm"/> modules. Open a terminal window and <code class="literal">cd</code> to this directory. The directory contents are shown in the following screenshot of the terminal window:</p><div><img src="img/B05034_04_04.jpg" alt="Step 2 – cd to the source directory"/></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec32"/>Step 3 – Running sphinx-quickstart</h3></div></div></div><p>As the name suggests, this <a id="id288" class="indexterm"/>script will get you started with Sphinx. It sets up a directory where the documentation files will be placed and also creates a default configuration file, <code class="literal">conf.py</code>. Run the following command:</p><div><pre class="programlisting">
<strong>$ sphinx-quickstart</strong>
</pre></div><p>When you run this tool, it will ask you several questions to complete the basic setup. Choose the default answers for most of the questions by pressing the <em>return</em> key on Mac or <em>Enter</em> key for other systems. We will customize the answers for a few questions, shown next. The first prompt asks for the directory to place the documentation in. We will create a new directory called <code class="literal">docs</code> for this purpose:</p><div><pre class="programlisting">
<strong>&gt; Root path for the documentation [.]: docs </strong>

<strong>&gt; Separate source and build directories (y/n) [n]: y </strong>

<strong>&gt; Project name: wargame</strong>

<strong>&gt; Author name(s): Your_Name </strong>

<strong>&gt; Project version: 2.0.0 </strong>

<strong>Please indicate if you want to use one of the following Sphinx extensions: </strong>
<strong>&gt; autodoc: automatically insert docstrings from modules (y/n) [n]: y</strong>
</pre></div><p>The last answer enables the <code class="literal">autodoc</code> extension of Sphinx. This extension will help us create the documentation from the docstrings created earlier. Leave the rest of the questions with the default answers. In the end, <code class="literal">sphinx-quickstart</code> prints the following summary information:</p><div><img src="img/B05034_04_05.jpg" alt="Step 3 – Running sphinx-quickstart"/></div><p>The directory structure created by this script is shown in the next screenshot:</p><div><img src="img/B05034_04_06.jpg" alt="Step 3 – Running sphinx-quickstart"/></div><p>The generated <code class="literal">Makefile</code> (Linux/Mac) and <code class="literal">make.bat</code> (Windows OS) will be used in the final section of this <a id="id289" class="indexterm"/>topic, <em>Step 6 – Building the documentation</em>. The <code class="literal">docs/source</code> directory is where we need to put all the RST files (or the documentation source files). By default, it creates an empty <code class="literal">index.rst</code> file. It also contains a file, <code class="literal">conf.py</code>, which will be discussed next.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec33"/>Step 4 – Updating conf.py</h3></div></div></div><p>The <code class="literal">sphinx-quickstart</code> script<a id="id290" class="indexterm"/> creates a build configuration file, <code class="literal">conf.py</code>. Here, it is located at <code class="literal">docs/source/conf.py</code>. This is the file where all the customization for Sphinx is defined. For example, you can specify which Sphinx extensions to use while generating the documentation. In the previous step, we enabled the <code class="literal">autodoc</code> extension to include the documentation from docstrings. It is represented in <code class="literal">conf.py</code> as:</p><div><pre class="programlisting">extensions = [   'sphinx.ext.autodoc', ]</pre></div><p>To take care of some warnings related to the <code class="literal">.. todo::</code> directive, add the following to the <code class="literal">extensions</code> list (you can also specify this during <code class="literal">sphinx-quickstart</code>):</p><div><pre class="programlisting">extensions = [   'sphinx.ext.autodoc', 'sphinx.ext.todo', ]</pre></div><p>We just need to make a small change in this file. As our source code is not in the <code class="literal">docs</code> directory, we will need to add an appropriate path to avoid import errors while generating the documentation. Uncomment the following line of code. You should find this line immediately after the <code class="literal">import</code> statements:</p><div><pre class="programlisting">#sys.path.insert(0, os.path.abspath('.'))</pre></div><p>You also need specify the full path to the directory containing the <code class="literal">wargame</code> package on your system. An example is shown in the following code:</p><div><pre class="programlisting">sys.path.insert(0,   
  os.path.abspath('/home/book/wargame_distribution')
)</pre></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec34"/>Step 5 – Running sphinx-apidoc</h3></div></div></div><p>Now, it is time to<a id="id291" class="indexterm"/> create the documentation source files (RST files) using the <code class="literal">sphinx-apidoc</code> tool. This tool uses the <code class="literal">autodoc</code> extension to extract the documentation from the docstrings. The syntax is as follows:</p><div><pre class="programlisting">
<strong>$</strong> <strong>sphinx-apidoc [options] -o &lt;outputdir&gt; &lt;sourcedir&gt; [pathnames …]</strong>
</pre></div><p>In the terminal window, run the following commands (make sure you are in the <code class="literal">docs</code> directory, using <code class="literal">cd</code>, before running the following command):</p><div><pre class="programlisting">
<strong>$</strong> <strong>sphinx-apidoc  -o source/ ../</strong>
</pre></div><p>The <code class="literal">-o</code> argument specifies the output directory where the generated RST files will be placed. In this case, the output directory is the directory by the name of <code class="literal">source</code>. This is a counterintuitive name, but remember that the <code class="literal">source</code> directory is where we keep the documentation source files. In the next step, these files will be used to create the final output (such as HTML files). The second argument represents the directory path where we have the Python code. In this case, the directory path is specified relative to the current working directory. Alternatively, you can also specify the full path, for example:</p><div><pre class="programlisting">
<strong>$</strong> <strong>sphinx-apidoc  -o source/  /home/book/wargame_distribution</strong>
</pre></div><p>The command-line output after running this tool is shown next:</p><div><img src="img/B05034_04_07.jpg" alt="Step 5 – Running sphinx-apidoc"/></div><div><div><h3 class="title"><a id="tip37"/>Tip</h3><p>As an exercise, review the auto-generated file, <code class="literal">source/wargame.rst</code>. It contains the <code class="literal">automodule</code> directive of the <code class="literal">autodoc</code> extension. For further details, refer to the Sphinx documentation (<a class="ulink" href="http://sphinx-doc.org/ext/autodoc.html">http://sphinx-doc.org/ext/autodoc.html</a>).</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec35"/>Step 6 – Building the documentation</h3></div></div></div><p>The previous step created all <a id="id292" class="indexterm"/>the raw material we will need to create nice-looking documentation! There are two ways to create HTML documentation. The first option makes use of the <code class="literal">sphinx-build</code> tool and the other option uses the <code class="literal">Makefile</code> we created earlier. Let's discuss these options next.</p><div><div><div><div><h4 class="title"><a id="ch04lvl4sec03"/>Using sphinx-build</h4></div></div></div><p>The <code class="literal">sphinx-build</code> tool<a id="id293" class="indexterm"/> makes it trivial to generate the final documentation. Run the following command while it is still in the <code class="literal">docs</code> directory:</p><div><pre class="programlisting">
<strong>$ sphinx-build source build</strong>
</pre></div><p>The first argument is the source directory where we have all the RST files, and the second argument is the directory where the final HTML documentation will be created. Open the <code class="literal">docs/build/index.html</code> file in a web browser and navigate through the links to view the documentation!</p><div><img src="img/B05034_04_08.jpg" alt="Using sphinx-build"/></div></div><div><div><div><div><h4 class="title"><a id="ch04lvl4sec04"/>Using Makefile</h4></div></div></div><p>An alternative to <code class="literal">sphinx-build</code> is to use the <code class="literal">Makefile</code> (or <code class="literal">make.bat</code>) created <a id="id294" class="indexterm"/>in <em>Step 3 – Running sphinx-quickstart</em>. On Linux, type the following commands (first move to the <code class="literal">docs/source</code> directory using <code class="literal">cd</code>):</p><div><pre class="programlisting">
<strong>$ cd /home/book/wargame_distribution/wargame/docs/source</strong>
<strong>$ make html </strong>
</pre></div><p>The last command creates HTML documentation in the <code class="literal">docs/build</code> directory. If you are using Windows OS, use <code class="literal">make.bat</code>, for example:</p><div><pre class="programlisting">
<strong>&gt; make.bat  html</strong>
</pre></div><p>Now that you have learned how to write good documentation, let's proceed further and see what guidelines should you follow while writing your Python code.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Python coding standards</h1></div></div></div><p>Coding standards serve as <a id="id295" class="indexterm"/>guidelines to write good quality code. Complying with these standards can have a significant impact on code readability, and in general on the life of the code.</p><div><div><h3 class="title"><a id="tip38"/>Tip</h3><p>
<strong>PEP 8 Style Guide for Python Code</strong>
</p><p>The <em>PEP 8</em> convention provides<a id="id296" class="indexterm"/> a style guide for writing Python code. If you are working on a project that follows its own set of coding conventions, rather than enforcing the <em>PEP 8</em> standards, you should adhere to the project-specific conventions. What matters the most is consistency. For any new project, you are strongly recommended to use the <em>PEP 8</em> style guide. In this section, we will <a id="id297" class="indexterm"/>cover a bare minimum set of guidelines that you should be aware of. For a comprehensive overview, check out <a class="ulink" href="https://www.python.org/dev/peps/pep-0008">https://www.python.org/dev/peps/pep-0008</a>.</p></div></div><p>The following table lists some of the important <a id="id298" class="indexterm"/>guidelines documented in <em>PEP 8</em> to write Python code:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>PEP 8 Style Guide For Python Code</p>
</th><th style="text-align: left" valign="bottom">
<p>Details</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Use four spaces per indentation level</p>
</td><td style="text-align: left" valign="top">
<p>This can be set as a preference in most Python editors.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Use spaces instead of tabs for indenting</p>
</td><td style="text-align: left" valign="top">
<p>Mixed use of tabs and spaces is not allowed in Python 3. Most editors have an option to convert tabs to spaces.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Limit maximum line length to 79 characters</p>
</td><td style="text-align: left" valign="top">
<p>This may vary across projects. Some projects follow a limit of 80 characters. The illustrations in this book use an 80-column limit. Most editors will give you an option to draw a line at a specified column that serves as a visual indication.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Put all <code class="literal">import</code> statements at the top of the file </p>
</td><td style="text-align: left" valign="top">
<p>Don't put <code class="literal">import</code> statements inside the class or function bodies. Bring those out and put them at the top.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>One <code class="literal">import</code> statement per line </p>
</td><td style="text-align: left" valign="top">
<p>An <a id="id299" class="indexterm"/>exception to this guideline is that, if you are importing multiple objects from a single module, it is OK to use a single import for all. The following imports are acceptable:</p>
<p>
</p><div><pre class="programlisting">import os
import sys
from numpy import trapz, polyfit</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Module names</p>
</td><td style="text-align: left" valign="top">
<p>Try to keep these short. They should be all lowercase. For example:</p>
<p>
<code class="literal">attackoftheorcs.py</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Class names</p>
</td><td style="text-align: left" valign="top">
<p>Use <strong>UpperCamelCase</strong>
<a id="id300" class="indexterm"/> with the first letter of every word capitalized. For example:</p>
<p>
</p><div><pre class="programlisting">class AttackOfTheOrcs:</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Function and method names</p>
</td><td style="text-align: left" valign="top">
<p>These should be in all lowercase; use underscores if it improves readability. For example:</p>
<p>
</p><div><pre class="programlisting">def show_game_mission(self):</pre></div><p>
</p>
<p>Avoid the following <a id="id301" class="indexterm"/>style: <code class="literal">showGameMission</code> (<strong>lowerCamelCase</strong>). Use such names only if you are working on a project that uses this convention. This might surprise you if you are coming from a different programming background, such as C++. Using underscores in the method and function names is the Pythonic way.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Comparing with <code class="literal">None</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Always compare a variable against <code class="literal">None</code> like this:</p>
<p>
</p><div><pre class="programlisting">if my_var is None:
    # do something</pre></div><p>
</p>
<p>Or like this:</p>
<p>
</p><div><pre class="programlisting">if my_var is not None: 
    # do something else. </pre></div><p>
</p>
<p>Never compare it like this:</p>
<p>
<code class="literal">if my_var == None</code> OR  <code class="literal">my_var != None</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Exceptions:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">When catching an exception, specify the exception type instead of just using the bare <code class="literal">except</code> clause.</li><li class="listitem" style="list-style-type: disc">Use the <code class="literal">Exception</code> class to derive exceptions instead of using the <code class="literal">BaseException</code> class.</li><li class="listitem" style="list-style-type: disc">Avoid writing a lot of code inside a single <code class="literal">try</code> clause; doing so makes it difficult to isolate the bugs.</li></ul></div>
</td><td style="text-align: left" valign="top">
<p>Refer<a id="id302" class="indexterm"/> to <a class="link" href="ch02.html" title="Chapter 2. Dealing with Exceptions">Chapter 2</a>, <em>Dealing with Exceptions</em>, which discusses some of these guidelines.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Public and non-public attributes:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Non-public attributes should have a leading underscore.</li><li class="listitem" style="list-style-type: disc">When in doubt, make attributes non-public.</li></ul></div>
</td><td style="text-align: left" valign="top">
<p>As discussed in</p>
<p>
<a class="link" href="ch01.html" title="Chapter 1. Developing Simple Applications">Chapter 1</a>, <em>Developing Simple Applications</em>, Python does not enforce any rule to make non-public attributes inaccessible to the outside world. However, a good practice is to refrain from using non-public attributes outside the scope. If you are unsure whether it should be scoped as public or non-public, as a starter, make it non-public. Later, change it to a public attribute if necessary. Refer to <a class="link" href="ch05.html" title="Chapter 5. Unit Testing and Refactoring">Chapter 5,</a>
<em> Unit Testing and Refactoring</em>, where we discuss the testing strategies for a non-public method, <code class="literal">_occupy_huts</code>.</p>
</td></tr></tbody></table></div><p>As mentioned earlier, this is just a representative sample of the comprehensive <em>PEP 8</em> guidelines. Read the <em>PEP 8</em> documentation for further details.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Code analysis – How well are we doing?</h1></div></div></div><p>In this section, we will talk about tools that help<a id="id303" class="indexterm"/> to detect coding standard violations.</p><div><img src="img/B05034_04_12.jpg" alt="Code analysis – How well are we doing?"/></div><div><table border="1"><colgroup><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<em>Good to have you back, Sir Foo! You've been awfully quiet, hope you are following along. You</em>
<a id="id304" class="indexterm"/>
<em> have raised a valid concern. Developers might get overwhelmed while trying to adhere to so many guidelines. Initially, it could appear like a challenge but practice should make you perfect. That said, there is still a likelihood that you will forget a guideline. Luckily, there are tools available that not only detect coding standard violations, but also inspect the code for errors. Some tools also try to reformat the code to adhere to coding standards. Let's learn that next.</em>
</p>
</td></tr></tbody></table></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec70"/>Code analysis using IDE</h2></div></div></div><p>Some popular Python <strong>integrated development environments</strong> (<strong>IDEs</strong>)<a id="id305" class="indexterm"/> were listed in <a class="link" href="ch01.html" title="Chapter 1. Developing Simple Applications">Chapter 1</a>, <em>Developing Simple Applications</em>. Before looking at any of the inspection tools discussed next, start with your<a id="id306" class="indexterm"/> IDE. Many IDEs come well equipped with code inspection and reformatting tools. For example, PyCharm Community Edition has excellent support for code inspections. The following screenshot shows some options offered under the <strong>Code</strong> menu:</p><div><img src="img/B05034_04_13.jpg" alt="Code analysis using IDE"/></div><p>Using an IDE with a <a id="id307" class="indexterm"/>good code analysis tool has a major advantage. It can help you detect the problems as you write the code. The tool can continuously monitor the code for common coding violations and show a visual indication of the error or warning next to the code. Typically, this indication appears just how a spellchecker shows spelling mistakes in a word processor. These timely indications help immensely in addressing common coding mistakes right when they occur.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec71"/>Pylint</h2></div></div></div><p>
<strong>Pylint</strong>
<a id="id308" class="indexterm"/> is a tool that inspects the code for errors and also warns you about coding standard violations. It is integrated with several <a id="id309" class="indexterm"/>IDEs (check out <a class="ulink" href="http://docs.pylint.org/ide-integration">http://docs.pylint.org/ide-integration</a> for a list of IDEs and editors where Pylint is either available or can be installed as a plugin). We will see how to use Pylint as a command-line tool. First, install it using pip—depending on your Python installation, you might need administrative access in order to install it:</p><div><pre class="programlisting">
<strong>$ pip install pylint </strong>
</pre></div><p>This installs <code class="literal">pylint</code> (or <code class="literal">pylint.exe</code> on Windows) at the same location where you have Python executable. Now, you should be able to use this tool from the command line. On Linux, the syntax is as follows:</p><div><pre class="programlisting">
<strong>$ pylint module_name.py</strong>
</pre></div><p>Where <code class="literal">module_name.py</code> is the file you want to check for errors and coding style problems. When you run <code class="literal">pylint</code> from the command line, it prints a detailed report of the analysis. This report has information on coding style, warnings, errors, and refactoring needs. In the end, it rates your code on a scale out of 10.</p><p>You can also customize the default settings to fit to your project needs. This is done using a configuration file. On Linux, run the following command in a terminal:</p><div><pre class="programlisting">
<strong>$ pylint --generate-rcfile &gt; ~/.pylintrc</strong>
</pre></div><p>This creates a <a id="id310" class="indexterm"/>default template for your Pylint configuration and saves it in your <code class="literal">$HOME </code>directory (<code class="literal">~/.pylintrc</code>). Even on Windows OS, this file can be created in your user's home directory Alternatively, you can specify the <code class="literal">PYLINTRC</code> environment variable, which holds the complete path to the file.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec36"/>Pylint in action</h3></div></div></div><p>It is time for <a id="id311" class="indexterm"/>some action. Run the Pylint code analysis on the <code class="literal">wargame/hut.py</code> file. Recall that in an earlier section, <em>Dosctrings using RST</em>, we added a class-level docstring. That's pretty much the documentation we have for this file. Pylint will not like this so be prepared to get beaten up!</p><div><pre class="programlisting">
<strong>$ cd wargame</strong>
<strong>$ pylint hut.py</strong>
</pre></div><p>The last command prints a detailed report on the command line. Let's see what we have got. The following screenshot shows the final report—the code has been rated <strong>5.00</strong> out of <strong>10</strong> points:</p><div><img src="img/B05034_04_14.jpg" alt="Pylint in action"/></div><p>That's pretty bad! Let's<a id="id312" class="indexterm"/> look at where we can improve by reviewing the report Pylint has generated. In the report, it complains about an <code class="literal">import</code> error. Well, there is nothing wrong with the imports. Clearly, it is missing the Python directory <code class="literal">PATH</code>. This can be fixed by editing the <code class="literal">.pythonrc</code> file. Look for a commented line that reads <code class="literal">init-hook</code> (it should appear near the beginning of the file). Uncomment it and write the following code:</p><div><pre class="programlisting">init-hook='import sys; sys.path.append("/path/to/wargame/")' </pre></div><p>Replace <code class="literal">/path/to/wargame</code> with the actual path on your system to the <code class="literal">wargame</code> directory. With this change, rerun Pylint on this file. The new evaluation is shown next:</p><div><img src="img/B05034_04_15.jpg" alt="Pylint in action"/></div><p>Not bad! Just fixing the <a id="id313" class="indexterm"/>import error has already improved the score by <strong>2.50</strong> points. Let's review the generated report one more time. At the beginning of the report, Pylint lists all the issues present in the file. In this case, it complains about missing docstrings for the module and the methods of the class. The other thing it is not happy about is the <code class="literal">import</code> statement, <code class="literal">from __future__ import print_function</code>, as the first line of the module.</p><div><div><h3 class="title"><a id="tip39"/>Tip</h3><p>
<strong>PEP 236 convention</strong>
</p><p>Although<a id="id314" class="indexterm"/> the <code class="literal">__future__</code> <code class="literal">import</code> statement must appear as the first line, the exception to this rule is a module docstring. A module docstring can be written before writing a <code class="literal">__future__</code> <code class="literal">import</code> statement. Review the <em>PEP 236</em> convention (<a class="ulink" href="https://www.python.org/dev/peps/pep-0236">https://www.python.org/dev/peps/pep-0236</a>) for more information.</p></div></div><p>We can easily fix both these issues. A reworked module docstring along with the rearranged <code class="literal">__future__ import</code> statement is shown in the following code screenshot:</p><div><img src="img/B05034_04_16.jpg" alt="Pylint in action"/></div><p>Let's see how are we <a id="id315" class="indexterm"/>doing by running Pylint again after this change:</p><div><img src="img/B05034_04_17.jpg" alt="Pylint in action"/></div><p>Yey! We have got full <a id="id316" class="indexterm"/>points for this module! Follow the similar process to improve the rest of the code. As an exercise, add the docstrings for the class methods. You can also download <code class="literal">wargame/hut.py</code> from the supplementary material for this chapter, which already has all the docstrings written.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec37"/>PEP8 and AutoPEP8</h3></div></div></div><p>
<strong>pep8</strong>
<a id="id317" class="indexterm"/> is another tool that inspects the code to check whether it confirms to the <em>PEP 8</em> coding style guide. It can be installed using pip as follows:</p><div><pre class="programlisting">
<strong>$ pip install pep8</strong>
</pre></div><p>To know how to use pep8, visit the <a id="id318" class="indexterm"/>project page (<a class="ulink" href="https://pypi.python.org/pypi/pep8">https://pypi.python.org/pypi/pep8</a>). There is another handy tool called <strong>autopep8</strong>
<a id="id319" class="indexterm"/> that will automatically reformat the code to confirm to the style recommended by <em>PEP 8</em> guidelines. This tool can also be installed using pip:</p><div><pre class="programlisting">
<strong>$ pip install autopep8</strong>
</pre></div><p>Note that this tool requires pep8 to be installed. Check out <a class="ulink" href="https://pypi.python.org/pypi/autopep8">https://pypi.python.org/pypi/autopep8</a> for more information and usage examples.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Exercise</h1></div></div></div><p>In this chapter, you learned how to document code, use Sphinx to generate documentation, and analyze the code using tools such as Pylint. Here is an exercise that covers these three aspects:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Download the code illustrated in <a class="link" href="ch03.html" title="Chapter 3. Modularize, Package, Deploy!">Chapter 3</a>, <em>Modularize, Package, Deploy</em> (you can also use your own Python code instead).</li><li class="listitem" style="list-style-type: disc">Write docstrings for this code (be sure to write docstrings at module, class, and method/function levels). You can use the default RST format to write the docstring or choose the <em>Google Python Style Guide</em>.</li><li class="listitem" style="list-style-type: disc">Generate an HTML documentation using Sphinx.</li><li class="listitem" style="list-style-type: disc">Run code analysis, using Pylint or any other tool, to fix coding errors and style problems.</li></ul></div><p>The supporting code for this chapter is already documented to an extent. You can use this code as a reference and also try to improve the existing documentation further.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Summary</h1></div></div></div><p>You learned how to document the code using the RST format. The chapter introduced the Sphinx document generator that was used to create an HTML documentation for our application code. You also learned about some important Python coding standards that helped improve readability. Finally, we saw how to check our application code for errors and style violations using code analysis.</p><p>In an ideal world, you wish your code fully confirms to the coding convention. Often, that is not the case for various reasons, ranging from new team members to tight project deadlines. Sometimes, to make it compliant with the coding standards, you will need to refactor it at a later stage. While doing so, you will also need to make sure no functionality gets broken. This is accomplished by writing unit tests. We will study these inter-related aspects in the next chapter.</p></div></body></html>