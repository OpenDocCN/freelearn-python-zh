<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Using Python for Automation and Productivity"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Using Python for Automation and Productivity</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using Tkinter to create graphical user interfaces</li><li class="listitem" style="list-style-type: disc">Creating a graphical Start menu application</li><li class="listitem" style="list-style-type: disc">Displaying photo information in an application</li><li class="listitem" style="list-style-type: disc">Organizing your photos automatically</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Introduction</h1></div></div></div><p>Until now, we have focused purely on command-line applications; however, there is much more to the Raspberry Pi than just the command line. By using <span class="strong"><strong>graphical user interfaces</strong></span> (<span class="strong"><strong>GUIs</strong></span>), it is<a class="indexterm" id="id255"/> often easier to obtain input from a user and provide feedback in a more natural way. After all, we continuously process multiple inputs and outputs all the time, so why limit ourselves to the procedural format of the command line when we don't have to?</p><p>Fortunately, Python can support this. Much like other programming languages, such as Visual Basic and C/C++/C#, this can be achieved using prebuilt objects that provide standard controls. We will use a module called <a class="indexterm" id="id256"/>
<span class="strong"><strong>Tkinter</strong></span> which provides a good range<a class="indexterm" id="id257"/> of controls (also referred to as <span class="strong"><strong>widgets</strong></span>) and tools for creating graphical applications.</p><p>First, we will take our previous example, the <code class="literal">encryptdecrypt.py</code> module discussed in the <span class="emphasis"><em>How to do it…</em></span> section in the <span class="emphasis"><em>Working with text and strings</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Starting with Python Strings, Files, and Menus">Chapter 2</a>, <span class="emphasis"><em>Starting with Python Strings, Files, and Menus</em></span>, and demonstrate how useful modules can be written and reused in a variety of ways. This is a test of good coding practice. We should aim to write code that can be tested thoroughly and then reused in many places.</p><p>Next, we will extend our previous examples by creating a small graphical Start menu application to run our favorite applications from.</p><p>Then, we will explore using <span class="strong"><strong>classes</strong></span> within our applications to display and then to organize photos.</p></div></div>
<div class="section" title="Using Tkinter to create graphical user interfaces"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Using Tkinter to create graphical user interfaces</h1></div></div></div><p>We will create a small GUI to allow the user to enter information, and the program can then be used to <a class="indexterm" id="id258"/>encrypt and decrypt<a class="indexterm" id="id259"/> it.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec64"/>Getting ready</h2></div></div></div><p>You will need to ensure that you have completed the instructions in the <span class="emphasis"><em>There's more…</em></span> section of the <span class="emphasis"><em>Working with text and strings</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Starting with Python Strings, Files, and Menus">Chapter 2</a>, <span class="emphasis"><em>Starting with Python Strings, Files, and Menus</em></span>, where we created the reusable <code class="literal">encryptdecrypt.py</code> module. You must ensure that this file is placed in the same directory as the following script.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>Since we are using Tkinter (one of many available add-ons of Python), we need to ensure that it is installed. It should be installed by default on the standard Raspbian image. We can confirm it is installed by importing it from the Python prompt, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python3</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; import tkinter</strong></span>
</pre></div><p>If it is not installed, an <code class="literal">ImportError</code> exception will be raised, in which case you can install it using the following command (use <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Z</em></span> to exit the Python prompt):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install python3-tk</strong></span>
</pre></div><p>If the module did load, you can use the following command to read more about the module (use <span class="emphasis"><em>Q</em></span> to quit when you are done reading):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt;help(tkinter)</strong></span>
</pre></div><p>You can also get information about all the classes, functions, and methods within the module using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt;help(tkinter.Button)</strong></span>
</pre></div><p>The following <code class="literal">dir</code> command will list any valid commands or variables that are in the scope of the module:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt;dir(tkinter.Button)</strong></span>
</pre></div><p>You will see that our own modules will have the information about the functions marked by triple quotes; this will show up if we use the <code class="literal">help</code> command.</p></div></div><p>The<a class="indexterm" id="id260"/> command line will not be <a class="indexterm" id="id261"/>able to display the graphical displays created in this chapter, so you will have to start the Raspberry Pi desktop (using the command <code class="literal">startx</code>), or if you are using it remotely, ensure you have <span class="strong"><strong>X11 Forwarding</strong></span> enabled and an <span class="strong"><strong>X server</strong></span> running (see <a class="link" href="ch01.html" title="Chapter 1. Getting Started with a Raspberry Pi Computer">Chapter 1</a>, <span class="emphasis"><em>Getting Started with a Raspberry Pi Computer</em></span>).</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec65"/>How to do it…</h2></div></div></div><p>We will use the <code class="literal">tkinter</code> module to produce a GUI for the <code class="literal">encryptdecrypt.py</code> script we wrote in the previous chapter.</p><p>To generate the GUI we will create the following <code class="literal">tkencryptdecrypt.py</code> script:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#tkencryptdecrypt.py
import encryptdecrypt as ENC
import tkinter as TK

def encryptButton():
    encryptvalue.set(ENC.encryptText(encryptvalue.get(),
                                     keyvalue.get()))

def decryptButton():
    encryptvalue.set(ENC.encryptText(encryptvalue.get(),
                                     -keyvalue.get()))
#Define Tkinter application
root=TK.Tk()
root.title("Encrypt/Decrypt GUI")
#Set control &amp; test value
encryptvalue = TK.StringVar()
encryptvalue.set("My Message") 
keyvalue = TK.IntVar()
keyvalue.set(20)
prompt="Enter message to encrypt:"
key="Key:"

label1=TK.Label(root,text=prompt,width=len(prompt),bg='green')
textEnter=TK.Entry(root,textvariable=encryptvalue,
                   width=len(prompt))
encryptButton=TK.Button(root,text="Encrypt",command=encryptButton)
decryptButton=TK.Button(root,text="Decrypt",command=decryptButton)
label2=TK.Label(root,text=key,width=len(key))
keyEnter=TK.Entry(root,textvariable=keyvalue,width=8)
#Set layout
label1.grid(row=0,columnspan=2,sticky=TK.E+TK.W)
textEnter.grid(row=1,columnspan=2,sticky=TK.E+TK.W)
encryptButton.grid(row=2,column=0,sticky=TK.E)
decryptButton.grid(row=2,column=1,sticky=TK.W)
label2.grid(row=3,column=0,sticky=TK.E)
keyEnter.grid(row=3,column=1,sticky=TK.W)

TK.mainloop()
#End</pre></div><p>Run the script using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python3 tkencryptdecrypt</strong></span>
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec66"/>How it works…</h2></div></div></div><p>We start <a class="indexterm" id="id262"/>by importing two <a class="indexterm" id="id263"/>modules; the first is our own <code class="literal">encryptdecrypt</code> module and the second is the <code class="literal">tkinter</code> module. To make it easier to see which items have come from where, we use <code class="literal">ENC</code>/<code class="literal">TK</code>. If you want to avoid the extra reference, you can use <code class="literal">from &lt;module_name&gt; import *</code> to refer to the module items directly.</p><p>The <code class="literal">encryptButton()</code> and <code class="literal">decryptButton()</code> functions will be called when we click on the <span class="strong"><strong>Encrypt</strong></span> and <span class="strong"><strong>Decrypt</strong></span> buttons; they are explained in the following sections.</p><p>The main Tkinter window is created using the <code class="literal">Tk()</code> command, which returns the main window where all the widgets/controls can be placed.</p><p>We will define six controls as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Label</code>: This displays the prompt <span class="strong"><strong>Enter message to encrypt:</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Entry</code>: This provides a textbox to receive the user's message to be encrypted</li><li class="listitem" style="list-style-type: disc"><code class="literal">Button</code>: This is an <span class="strong"><strong>Encrypt</strong></span> button to trigger the message to be encrypted</li><li class="listitem" style="list-style-type: disc"><code class="literal">Button</code>: This is a <span class="strong"><strong>Decrypt</strong></span> button to reverse the encryption</li><li class="listitem" style="list-style-type: disc"><code class="literal">Label</code>: This displays the <span class="strong"><strong>Key:</strong></span> field to prompt the user for an encryption key value</li><li class="listitem" style="list-style-type: disc"><code class="literal">Entry</code>: This provides a second textbox to receive values for the encryption keys</li></ul></div><p>These controls will produce a GUI similar to the one shown in the following screenshot:</p><div class="mediaobject"><img alt="How it works…" src="graphics/6623OT_03_1.jpg"/><div class="caption"><p>The GUI to encrypt/decrypt messages</p></div></div><p>Let's take a look at the first <code class="literal">label1</code> definition:</p><div class="informalexample"><pre class="programlisting">label1=TK.Label(root,text=prompt,width=len(prompt),bg='green')</pre></div><p>All controls<a class="indexterm" id="id264"/> must be linked to the<a class="indexterm" id="id265"/> application window; hence, we have to specify our Tkinter window <code class="literal">root</code>. The text used for the label is set by <code class="literal">text</code>; in this case, we have set it to a string named <code class="literal">prompt</code>, which has been defined previously with the text we require. We also set the <code class="literal">width</code> to match the number of characters of the message (while not essential, it provides a neater result if we add more text to our labels later), and finally, we set the background color using <code class="literal">bg='green'</code>.</p><p>Next, we define the text <code class="literal">Entry</code> box for our message:</p><div class="informalexample"><pre class="programlisting">textEnter=TK.Entry(root,textvariable=encryptvalue,
                   width=len(prompt))</pre></div><p>We will define <code class="literal">textvariable</code>—a useful way to link a variable to the contents of the box—which is a special string variable. We could access the <code class="literal">text</code> directly using <code class="literal">textEnter.get()</code>, but we shall use a <code class="literal">Tkinter StringVar()</code> object instead to access it indirectly. If required, this will allow us to separate the data we are processing from the code that handles the GUI layout. The <code class="literal">enycrptvalue</code> variable automatically updates the <code class="literal">Entry</code> widget it is linked to whenever the <code class="literal">.set()</code> command is used (and the <code class="literal">.get()</code> command obtains the latest value from the <code class="literal">Entry</code> widget).</p><p>Next, we have our two <code class="literal">Button</code> widgets, <span class="strong"><strong>Encrypt</strong></span> and <span class="strong"><strong>Decrypt</strong></span>, as follows:</p><div class="informalexample"><pre class="programlisting">encryptButton=TK.Button(root,text="Encrypt",command=encryptButton)
decryptButton=TK.Button(root,text="Decrypt",command=decryptButton)</pre></div><p>In this case, we can set a function to be called when the <code class="literal">Button</code> widget is clicked by setting the <code class="literal">command</code> attribute. We can define the two functions that will be called when each button is clicked. In the following code snippet, we have the <code class="literal">encryptButton()</code> function, which will set the <code class="literal">encryptvalue StringVar</code> that controls the contents of the first <code class="literal">Entry</code> box. This string is set to the result we get by calling <code class="literal">ENC.encryptText()</code> with the message we want to encrypt (the current value of <code class="literal">encryptvalue</code>) and the <code class="literal">keyvalue</code> variable. The <code class="literal">decrypt()</code> function is exactly the same, except we make the <code class="literal">keyvalue</code> variable negative to decrypt the message:</p><div class="informalexample"><pre class="programlisting">def encryptButton():
    encryptvalue.set(ENC.encryptText(encryptvalue.get(),
                                     keyvalue.get()))</pre></div><p>We then <a class="indexterm" id="id266"/>set the final <code class="literal">Label</code> <a class="indexterm" id="id267"/>and <code class="literal">Entry</code> widgets in a similar way. Note that <code class="literal">textvariable</code> can also be an integer (numerical value) if required, but there is no built-in check to ensure that only numbers can be entered. You will get a <code class="literal">ValueError</code> exception when the <code class="literal">.get()</code> command is used.</p><p>After we have defined all the widgets to be used in the Tkinter window, we have to set the layout. There are three ways to define the layout in Tkinter: place, pack, and grid.</p><p>The place layout allows us to specify the positions and sizes using exact pixel positions. The pack layout places the items in the window in the order that they have been added in. The grid layout allows us to place the items in a specific layout. It is recommended that you avoid the place layout wherever possible since any small change to one item can have a knock-on effect on the positions and sizes of all the other items; the other layouts account for this by determining their positions relative to the other items in the window.</p><p>We will place the items as laid out in the following screenshot:</p><div class="mediaobject"><img alt="How it works…" src="graphics/6623OT_03_2.jpg"/><div class="caption"><p>Grid layout for the Encrypt/Decrypt GUI</p></div></div><p>The positions of first two items in the GUI are set using the following code:</p><div class="informalexample"><pre class="programlisting">label1.grid(row=0,columnspan=2,sticky= TK.E+TK.W)
textEnter.grid(row=1,columnspan=2,sticky= TK.E+TK.W)</pre></div><p>We can specify that the first <code class="literal">Label</code> and <code class="literal">Entry</code> box will span both columns (<code class="literal">columnspan=2</code>), and we can set the sticky values to ensure they span right to the edges. This is achieved by setting both the <code class="literal">TK.E</code> for the east and <code class="literal">TK.W</code> for the west sides. We'd use <code class="literal">TK.N</code> for the<a class="indexterm" id="id268"/> north and <code class="literal">TK.S</code> for the<a class="indexterm" id="id269"/> south sides if we needed to do the same vertically. If the <code class="literal">column</code> value is not specified, the grid function defaults to <code class="literal">column=0</code>. The other items are similarly defined.</p><p>The last step is to call <code class="literal">TK.mainloop()</code>, which allows Tkinter to run; this allows the buttons to be monitored for clicks and Tkinter to call the functions linked to them.</p></div></div>
<div class="section" title="Creating a graphical application &#x2013; Start menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Creating a graphical application – Start menu</h1></div></div></div><p>The example in this recipe shows how we can define our own variations of the Tkinter objects to <a class="indexterm" id="id270"/>generate custom controls and dynamically<a class="indexterm" id="id271"/> construct a menu with them. We will also take a quick look at using threads to allow other tasks to continue to function while a particular task is being executed.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec67"/>Getting ready</h2></div></div></div><p>To view the GUI display, you will need a monitor displaying the Raspberry Pi desktop, or need to be connected to another computer running the X server.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>How to do it…</h2></div></div></div><p>To create a graphical Start menu application, create the following <code class="literal">graphicmenu.py</code> script:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
# graphicmenu.py
import tkinter as tk
from subprocess import call
import threading

#Define applications ["Display name","command"]
leafpad = ["Leafpad","leafpad"]
scratch = ["Scratch","scratch"]
pistore = ["Pi Store","pistore"]
app_list = [leafpad,scratch,pistore]
APP_NAME = 0
APP_CMD  = 1

class runApplictionThread(threading.Thread):
    def __init__(self,app_cmd):
        threading.Thread.__init__(self)
        self.cmd = app_cmd
    def run(self):
        #Run the command, if valid
        try:
            call(self.cmd)
        except:
            print ("Unable to run: %s" % self.cmd)

class appButtons:
    def __init__(self,gui,app_index):
        #Add the buttons to window
        btn = tk.Button(gui, text=app_list[app_index][APP_NAME],
                        width=30, command=self.startApp)
        btn.pack()
        self.app_cmd=app_list[app_index][APP_CMD]
    def startApp(self):
        print ("APP_CMD: %s" % self.app_cmd)
        runApplictionThread(self.app_cmd).start()       

root = tk.Tk()
root.title("App Menu")
prompt = '      Select an application      '
label1 = tk.Label(root, text=prompt, width=len(prompt), bg='green')
label1.pack()
#Create menu buttons from app_list
for index, app in enumerate(app_list):
    appButtons(root,index)
#Run the tk window
root.mainloop()
#End</pre></div><p>The<a class="indexterm" id="id272"/> previous code produces the following<a class="indexterm" id="id273"/> application:</p><div class="mediaobject"><img alt="How to do it…" src="graphics/6623OT_03_3.jpg"/><div class="caption"><p>The App Menu GUI</p></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec69"/>How it works…</h2></div></div></div><p>We create the Tkinter window as we did before; however, instead of defining all the items separately, we create a special class for the application buttons.</p><p>The <span class="strong"><strong>class</strong></span> we <a class="indexterm" id="id274"/>create acts as a blueprint or specification <a class="indexterm" id="id275"/>of what we want the <code class="literal">appButtons</code> items to include. Each item will consist of a string value for <code class="literal">app_cmd</code>, a function called <code class="literal">startApp()</code>, and an <code class="literal">__init__()</code> function. The <code class="literal">__init__()</code> function is a special function (called<a class="indexterm" id="id276"/> a <span class="strong"><strong>constructor</strong></span>) that is called when we create an <code class="literal">appButtons</code> item; it will allow us to create any setup that is required.</p><p>In this case, the <code class="literal">__init__()</code> function allows us to create a new Tkinter button with the text to be set to an item in <code class="literal">app_list</code> and the command to be called in the <code class="literal">startApp()</code> function when the button is clicked. The <code class="literal">self</code> keyword is used so that the command called will be the one that is part of the item; this means that each button will call a locally defined function that has access to the local data of the item.</p><p>We set the value of <code class="literal">self.app_cmd</code> to the command from <code class="literal">app_list</code> and make it ready for use by the <code class="literal">startApp()</code> function. We now create the <code class="literal">startApp()</code> function. If we run the application command here directly, the Tkinter window will freeze until the application we have opened is closed again. To avoid this, we <a class="indexterm" id="id277"/>can use the Python <span class="strong"><strong>Threading</strong></span> module, which allows us to perform multiple actions at the same time.</p><p>The <code class="literal">runApplicationThread()</code> class is created using the <code class="literal">threading.Thread</code> class as a template—this inherits all the features of the <code class="literal">threading.Thread</code> class in a new class. Just like our previous class, we provide an <code class="literal">__init__()</code> function for this as well. We first call the <code class="literal">__init__()</code> function of the inherited class to ensure it is set up correctly, and then we store the <code class="literal">app_cmd</code> value in <code class="literal">self.cmd</code>. After the <code class="literal">runApplicationThread()</code> function has been created and initialized, the <code class="literal">start()</code> function is called. This function is part of <code class="literal">threading.Thread</code>, which our class can use. When the <code class="literal">start()</code> function is called, it will create a separate application thread (that is, simulate running two things at the same time), allowing Tkinter to continue monitoring button clicks while executing the <code class="literal">run()</code> function within the class.</p><p>Therefore, we can place the code in the <code class="literal">run()</code> function to run the required application (using <code class="literal">call(self.cmd)</code>).</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec70"/>There's more…</h2></div></div></div><p>One aspect that makes Python particularly powerful is that it supports the programming techniques used in <span class="strong"><strong>Object-Orientated Design</strong></span> (<span class="strong"><strong>OOD</strong></span>). This is commonly used by modern programming <a class="indexterm" id="id278"/>languages to help translate the tasks we want our program to perform into meaningful constructs and structures in code. The principle of OOD lies in the fact that we think of most problems consisting of several objects (a GUI window, a button, and so on) that interact with each other to produce a desired result.</p><p>In the previous<a class="indexterm" id="id279"/> section, we found that we can use classes<a class="indexterm" id="id280"/> to create standardized objects that can be reused multiple times. We created an <code class="literal">appButton</code> class, which generated an object with all the features of the class, including its own personal version of <code class="literal">app_cmd</code> that will be used by the <code class="literal">startApp() </code>function. Another object of the <code class="literal">appButton</code> type will have its own unrelated <code class="literal">[app_cmd]</code> data that its <code class="literal">startApp()</code> function will use. </p><p>You can see that classes are useful to keep together a collection of related variables and functions in a single object, and the class will hold its own data in one place. Having multiple objects of the same type (class), each with their own functions and data inside them, results in better program structure. The traditional approach would be to keep all the information in one place and send each item back and forth for various functions to process; however, this may become cumbersome in large systems.</p><p>The following diagram shows the organization of related functions and data:</p><div class="mediaobject"><img alt="There's more…" src="graphics/6623OT_03_4.jpg"/><div class="caption"><p>Related functions and data can be organized into classes and objects</p></div></div><p>So far, we have used Python modules to separate parts of our programs into different files; this allows us to conceptually separate different parts of the program (an interface, encoder/decoder, or library of classes, such as Tkinter). Modules can provide code to control a particular bit of hardware, define an interface for the Internet, or provide a library of common functionality; however, its most important function is to control the interface (the collection of functions, variables, and classes that are available when the item is imported). A well implemented module should have a clear interface that is centered around how it is used, rather than how it is implemented. This allows you to create multiple modules that can be swapped and changed easily since they share the same interface. In our previous example, imagine how easy it would be to change the <code class="literal">encryptdecrypt</code> module for another one just by supporting <code class="literal">encryptText(input_text,key)</code>. Complex functionality can be <a class="indexterm" id="id281"/>split into smaller, manageable blocks <a class="indexterm" id="id282"/>that can be reused in multiple applications.</p><p>Python makes use of classes and modules all the time. Each time you import a library, such as <code class="literal">sys</code> or Tkinter, or convert a value using <code class="literal">value.str()</code> and iterate through a list using <code class="literal">for...in</code>, you can use them without worrying about the details. You don't have to use classes or modules in every bit of code you write, but they are useful tools to keep in your programmer's toolbox for times when they fit what you are doing.</p><p>We will understand how classes and modules allow us to produce well-structured code that is easier to test and maintain by using them in the examples of this book.</p></div></div>
<div class="section" title="Displaying photo information in an application"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Displaying photo information in an application</h1></div></div></div><p>In this <a class="indexterm" id="id283"/>example, we shall create a utility<a class="indexterm" id="id284"/> class to handle photos that can be used by other applications (as a module) to access photo metadata and display preview images easily.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec71"/>Getting ready</h2></div></div></div><p>The following<a class="indexterm" id="id285"/> script makes use of <span class="strong"><strong>Python Image Library</strong></span> (<span class="strong"><strong>PIL</strong></span>); a<a class="indexterm" id="id286"/> compatible version for Python 3 is <span class="strong"><strong>Pillow</strong></span>.</p><p>Pillow has not been included in the Raspbian repository (used by <code class="literal">apt-get</code>); therefore, we will need to install <a class="indexterm" id="id287"/>Pillow using a <span class="strong"><strong>Python Package Manager</strong></span> <a class="indexterm" id="id288"/>called <span class="strong"><strong>PIP</strong></span>.</p><p>To install packages for Python 3, we will use the Python 3 version of PIP (this requires 50 MB of available space).</p><p>The following commands can be used to install PIP:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get update</strong></span>
<span class="strong"><strong>sudo apt-get install python3-pip</strong></span>
</pre></div><p>Before you use PIP, ensure that you have installed <code class="literal">libjpeg-dev</code> to allow Pillow to handle JPEG files. You can do this using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install libjpeg-dev</strong></span>
</pre></div><p>Now you can install Pillow using the following PIP command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo pip-3.2 install pillow</strong></span>
</pre></div><p>PIP also makes it easy to uninstall packages using <code class="literal">uninstall</code> instead of <code class="literal">install</code>.</p><p>Finally, you can confirm that it has installed successfully by running <code class="literal">python3</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt;import PIL</strong></span>
<span class="strong"><strong>&gt;&gt;&gt;help(PIL)</strong></span>
</pre></div><p>You should not get any errors and see lots of information about PIL and its uses (press <span class="emphasis"><em>Q</em></span> to finish). Check the version installed as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;PIL.PILLOW_VERSION</strong></span>
</pre></div><p>You should see <code class="literal">2.7.0</code> (or similar).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>PIP can also be used with Python 2 by installing pip-2.x using the following command:</p><p>
<span class="strong"><strong>sudo apt-get install python-pip</strong></span>
</p><p>Any packages installed using <code class="literal">sudo pip install</code> will be installed just for Python 2.</p></div></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec72"/>How to do it…</h2></div></div></div><p>To display <a class="indexterm" id="id289"/>photo information in an application, create<a class="indexterm" id="id290"/> the following <code class="literal">photohandler.py</code> script:</p><div class="informalexample"><pre class="programlisting">##!/usr/bin/python3
#photohandler.py
from PIL import Image
from PIL import ExifTags
import datetime
import os

#set module values
previewsize=240,240
defaultimagepreview="./preview.ppm"
filedate_to_use="Exif DateTime"
#Define expected inputs
ARG_IMAGEFILE=1
ARG_LENGTH=2
    
class Photo:
    def __init__(self,filename):
        """Class constructor"""
        self.filename=filename
        self.filevalid=False
        self.exifvalid=False
        img=self.initImage()
        if self.filevalid==True:
            self.initExif(img)
            self.initDates()
    
    def initImage(self):
        """opens the image and confirms if valid, returns Image"""
        try:
            img=Image.open(self.filename)
            self.filevalid=True
        except IOError:
            print ("Target image not found/valid %s" %
                   (self.filename))
            img=None
            self.filevalid=False
        return img
        
    def initExif(self,image):
        """gets any Exif data from the photo"""
        try:
            self.exif_info={
                ExifTags.TAGS[x]:y
                for x,y in image._getexif().items()
                if x in ExifTags.TAGS
            }
            self.exifvalid=True
        except AttributeError:
            print ("Image has no Exif Tags")
            self.exifvalid=False

            
    def initDates(self):
        """determines the date the photo was taken"""
        #Gather all the times available into YYYY-MM-DD format
        self.filedates={}
        if self.exifvalid:
            #Get the date info from Exif info
            exif_ids=["DateTime","DateTimeOriginal",
                      "DateTimeDigitized"]
            for id in exif_ids:
                dateraw=self.exif_info[id]
                self.filedates["Exif "+id]=
                                dateraw[:10].replace(":","-")
        modtimeraw = os.path.getmtime(self.filename)
        self.filedates["File ModTime"]="%s" %
            datetime.datetime.fromtimestamp(modtimeraw).date()
        createtimeraw = os.path.getctime(self.filename)
        self.filedates["File CreateTime"]="%s" %
            datetime.datetime.fromtimestamp(createtimeraw).date()

    def getDate(self):
        """returns the date the image was taken"""
        try:
            date = self.filedates[filedate_to_use]
        except KeyError:
            print ("Exif Date not found")
            date = self.filedates["File ModTime"]
        return date
        
    def previewPhoto(self):
        """creates a thumbnail image suitable for tk to display"""
        imageview=self.initImage()
        imageview=imageview.convert('RGB')
        imageview.thumbnail(previewsize,Image.ANTIALIAS)
        imageview.save(defaultimagepreview,format='ppm')
        return defaultimagepreview        </pre></div><p>The previous<a class="indexterm" id="id291"/> code defines our <code class="literal">Photo</code> class; it is<a class="indexterm" id="id292"/> of no use to us until we run it in the <span class="emphasis"><em>There's more…</em></span> section and in the next example.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec73"/>How it works…</h2></div></div></div><p>We define a general class called <code class="literal">Photo</code>; it contains details about itself and provides functions to access <span class="strong"><strong>Exchangeable Image File Format</strong></span> (<span class="strong"><strong>EXIF</strong></span>) information and generate a preview<a class="indexterm" id="id293"/> image.</p><p>In the <code class="literal">__init__()</code> function, we set values for our class variables and call <code class="literal">self.initImage()</code>, which will open the image using the <code class="literal">Image()</code> function from the PIL. We then call <code class="literal">self.initExif()</code> and <code class="literal">self.initDates()</code> and set a flag to indicate whether the file was valid or not. If not valid, the <code class="literal">Image()</code> function would raise an <code class="literal">IOError</code> exception.</p><p>The <code class="literal">initExif()</code> function uses PIL to read the EXIF data from the <code class="literal">img</code> object, as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">self.exif_info={
                ExifTags.TAGS[id]:y
                for id,y in image._getexif().items()
                if id in ExifTags.TAGS
               }</pre></div><p>The previous code is a series of compound statements that result in <code class="literal">self.exif_info</code> being populated with a dictionary of tag names and their related values.</p><p>
<code class="literal">ExifTag.TAGS</code> is a dictionary that contains a list of possible tag names linked with their IDs, as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">ExifTag.TAGS={
4096: 'RelatedImageFileFormat',
513: 'JpegIFOffset',
514: 'JpegIFByteCount',
40963: 'ExifImageHeight',
…etc…}</pre></div><p>The <code class="literal">image._getexif()</code> function returns a dictionary that contains all the values set by the camera of the image, each linked to their relevant IDs, as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">Image._getexif()={
256: 3264,
257: 2448,
37378: (281, 100),
36867: '2016:09:28 22:38:08',
…etc…}</pre></div><p>The <code class="literal">for</code> loop will go through each item in the image's EXIF value dictionary and check for its occurrence in the <code class="literal">ExifTags.TAGS</code> dictionary; the result will get stored in <code class="literal">self.exif_info</code>. The code for this is as follows:</p><div class="informalexample"><pre class="programlisting">self.exif_info={
'YResolution': (72, 1),
 'ResolutionUnit': 2,
 'ExposureMode': 0, 
'Flash': 24,
…etc…}</pre></div><p>Again, if there are no exceptions, we set a flag to indicate that the EXIF data is valid, or if there is no EXIF data, we raise an <code class="literal">AttributeError</code> exception.</p><p>The <code class="literal">initDates()</code> function allows us to gather all the possible file dates and dates from the EXIF data so that we can select one of them as the date we wish to use for the file. For example, it allows us to rename all the images to a filename in the standard date format. We create a <code class="literal">self.filedates</code> dictionary that we populate with three dates extracted from the EXIF information. We then add the filesystem dates (created and modified) just in case no EXIF data is available. The <code class="literal">os</code> module allows us to use <code class="literal">os.path.getctime()</code> and <code class="literal">os.path.getmtime()</code> to obtain an epoch value of the file creation—it can also be the date and time when the file was moved—and file modification—when it was last written to (for example, it often refers to the date when the picture was taken). The epoch value is the number of seconds since January 1, 1970, but we can use <code class="literal">datetime.datetime.fromtimestamp()</code> to convert it into years, months, days, hours, and seconds. Adding <code class="literal">date()</code> simply limits it to years, months, and days.</p><p>Now if the <code class="literal">Photo</code> class was to be used by another module, and we wished to know the date of the<a class="indexterm" id="id294"/> image that was taken, we could look<a class="indexterm" id="id295"/> at the <code class="literal">self.dates</code> dictionary and pick out a suitable date. However, this would require the programmer to know how the <code class="literal">self.dates</code> values are arranged, and if we later changed how they are stored, it would break their program. For this reason, it is recommended that we access data in a class through access functions so the implementation is independent of the interfaces (this process is known <a class="indexterm" id="id296"/>as <span class="strong"><strong>encapsulation</strong></span>). We provide a function that returns a date when called; the programmer does not need to know that it could be one of the five available dates or even that they are stored as epoch values. Using a function, we can ensure that the interface will remain the same no matter how the data is stored or collected.</p><p>Finally, the last function we want the <code class="literal">Photo</code> class to provide is <code class="literal">previewPhoto()</code>. This function provides a method to generate a small thumbnail image and save it as a <span class="strong"><strong>Portable Pixmap Format</strong></span> (<span class="strong"><strong>PPM</strong></span>) file. As we will discover in a moment, Tkinter allows us to place images on<a class="indexterm" id="id297"/> its <code class="literal">Canvas</code> widget, but unfortunately, it does not support JPGs (and only supports GIF or PPM) directly. Therefore, we simply save a small copy of the image we want to display in the PPM format—with the added caveat that the image pallet must be converted to RGB too—and then get Tkinter to load it onto the <code class="literal">Canvas</code> when required.</p><p>To summarize, the <code class="literal">Photo</code> class we have created is as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Operations</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">__init__(self,filename)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a class="indexterm" id="id298"/> the object initialization function</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">initImage(self)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a class="indexterm" id="id299"/> returns <code class="literal">img</code>, a PIL-type image object</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">initExif(self,image)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id300"/>extracts all the EXIF information, if any is present</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">initDates(self)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id301"/>creates a dictionary of all the dates available from the file and photo information</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getDate(self)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id302"/>returns a string of the date when the photo was taken/created</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">previewPhoto(self)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a class="indexterm" id="id303"/> returns a string of the filename of the previewed thumbnail</p>
</td></tr></tbody></table></div><p>The<a class="indexterm" id="id304"/> properties and their respective descriptions<a class="indexterm" id="id305"/> are as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Properties</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.filename</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The<a class="indexterm" id="id306"/> filename of the photo</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.filevalid</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a class="indexterm" id="id307"/> is set to <code class="literal">True</code> if the file is opened successfully</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.exifvalid</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is <a class="indexterm" id="id308"/>set to <code class="literal">True</code> if the photo contains EXIF information</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.exif_info</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id309"/>contains the EXIF information from the photo</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.filedates</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id310"/>contains a dictionary of the available dates from the file and photo information</p>
</td></tr></tbody></table></div><p>To test the<a class="indexterm" id="id311"/> new class, we will create some test code <a class="indexterm" id="id312"/>to confirm that everything is working as we expect; see the following section.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec74"/>There's more…</h2></div></div></div><p>We previously created the <code class="literal">Photo</code> class. Now we can add some test code to our module to ensure that it functions as we expect. We can use the <code class="literal">__name__ ="__main__"</code> attribute as before to detect whether the module has been run directly or not.</p><p>We can add the subsequent section of code at the end of the <code class="literal">photohandler.py</code> script to produce the following test application, which looks as follows:</p><div class="mediaobject"><img alt="There's more…" src="graphics/6623OT_03_5.jpg"/><div class="caption"><p>The Photo View Demo application</p></div></div><p>Add <a class="indexterm" id="id313"/>the <a class="indexterm" id="id314"/>following code at the end of <code class="literal">photohandler.py</code>:</p><div class="informalexample"><pre class="programlisting">#Module test code
def dispPreview(aPhoto):
    """Create a test GUI"""
    import tkinter as TK

    #Define the app window
    app = TK.Tk()
    app.title("Photo View Demo")
   
    #Define TK objects
    # create an empty canvas object the same size as the image
    canvas = TK.Canvas(app, width=previewsize[0],
                       height=previewsize[1])
    canvas.grid(row=0,rowspan=2)
    # Add list box to display the photo data
    #(including xyscroll bars)
    photoInfo=TK.Variable()
    lbPhotoInfo=TK.Listbox(app,listvariable=photoInfo,
                           height=18,width=45,
                           font=("monospace",10))
    yscroll=TK.Scrollbar(command=lbPhotoInfo.yview,
                         orient=TK.VERTICAL)
    xscroll=TK.Scrollbar(command=lbPhotoInfo.xview,
                         orient=TK.HORIZONTAL)
    lbPhotoInfo.configure(xscrollcommand=xscroll.set,
                          yscrollcommand=yscroll.set)
    lbPhotoInfo.grid(row=0,column=1,sticky=TK.N+TK.S)
    yscroll.grid(row=0,column=2,sticky=TK.N+TK.S)
    xscroll.grid(row=1,column=1,sticky=TK.N+TK.E+TK.W)
    
    # Generate the preview image
    preview_filename = aPhoto.previewPhoto()
    photoImg = TK.PhotoImage(file=preview_filename)
    # anchor image to NW corner
    canvas.create_image(0,0, anchor=TK.NW, image=photoImg) 
    
    # Populate infoList with dates and exif data
    infoList=[]
    for key,value in aPhoto.filedates.items():
        infoList.append(key.ljust(25) + value)
    if aPhoto.exifvalid:
        for key,value in aPhoto.exif_info.items():
           infoList.append(key.ljust(25) + str(value))
    # Set listvariable with the infoList
    photoInfo.set(tuple(infoList))

    app.mainloop()

def main():
    """called only when run directly, allowing module testing"""
    import sys
    #Check the arguments
    if len(sys.argv) == ARG_LENGTH:
        print ("Command: %s" %(sys.argv))
        #Create an instance of the Photo class
        viewPhoto = Photo(sys.argv[ARG_IMAGEFILE])
        #Test the module by running a GUI
        if viewPhoto.filevalid==True:
            dispPreview(viewPhoto)
    else:
        print ("Usage: photohandler.py imagefile")

if __name__=='__main__':
  main()
#End</pre></div><p>The previous test code will run the <code class="literal">main()</code> function, which takes the filename of a photo to use and create a new <code class="literal">Photo</code> object called <code class="literal">viewPhoto</code>. If <code class="literal">viewPhoto</code> is opened successfully, we will call <code class="literal">dispPreview()</code> to display the image and its details.</p><p>The <code class="literal">dispPreview()</code> function creates four Tkinter widgets to be displayed: a <code class="literal">Canvas</code> to load the thumbnail image, a <code class="literal">Listbox</code> widget to display the photo information, and two scroll bars to control the <code class="literal">Listbox</code>. First, we create a <code class="literal">Canvas</code> widget the size of the thumbnail image (<code class="literal">previewsize</code>).</p><p>Next, we<a class="indexterm" id="id315"/> create <code class="literal">photoInfo</code>, which will be<a class="indexterm" id="id316"/> our <code class="literal">listvariable</code> parameter linked to the <code class="literal">Listbox</code> widget. Since Tkinter doesn't provide a <code class="literal">ListVar()</code> function to create a suitable item, we use the generic type <code class="literal">TK.Variable()</code> and then ensure we convert it to a tuple type before setting the value. The <code class="literal">Listbox</code> widget gets added; we need to make sure that the <code class="literal">listvariable</code> parameter is set to <code class="literal">photoInfo</code> and also set the font to <code class="literal">monospace</code>. This will allow us to line up our data values using spaces, as <code class="literal">monospace</code> is a fixed width font, so each character takes up the same width as any other.</p><p>We define the two scroll bars, linking them to the <code class="literal">Listbox</code> widget, by setting the <code class="literal">Scrollbar</code> command parameters for vertical and horizontal scroll bars to <code class="literal">lbPhotoInfo.yview</code> and <code class="literal">lbPhotoInfo.xview</code>. Then, we adjust the parameters of the <code class="literal">Listbox</code> using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  lbPhotoInfo.configure(xscrollcommand=xscroll.set, </strong></span>
<span class="strong"><strong>                             yscrollcommand=yscroll.set)</strong></span>
</pre></div><p>The <code class="literal">configure</code> command allows us to add or change the widget's parameters after it has been created, in this case linking the two scroll bars so the <code class="literal">Listbox</code> widget can also control them if the user scrolls within the list.</p><p>As before, we make use of the grid layout to ensure that the <code class="literal">Listbox</code> widget has the two scroll bars placed correctly next to it and the <code class="literal">Canvas</code> widget is to the left of the <code class="literal">Listbox</code> widget.</p><p>We now use the <code class="literal">Photo</code> object to create the <code class="literal">preview.ppm</code> thumbnail file (using the <code class="literal">aPhoto.previewPhoto()</code> function) and create a <code class="literal">TK.PhotoImage</code> object that can then be added to the <code class="literal">Canvas</code> widget with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>canvas.create_image(0,0, anchor=TK.NW, image=photoImg)</strong></span>
</pre></div><p>Finally, we use the date information that the <code class="literal">Photo</code> class gathers and the EXIF information (ensuring it is valid first) to populate the <code class="literal">Listbox</code> widget. We do this by converting each item into a list of strings that are spaced out using <code class="literal">.ljust(25)</code>—it adds a left justification to the name and pads it out to make the string 25 characters wide. Once we have the list, we convert it to a tuple type and set the <code class="literal">listvariable</code> (<code class="literal">photoInfo</code>) parameter.</p><p>As always, we call <code class="literal">app.mainloop()</code> to start the monitoring for events to respond to.</p></div></div>
<div class="section" title="Organizing your photos automatically"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Organizing your photos automatically</h1></div></div></div><p>Now that we have a class that allows us to gather information about photos, we can apply this information to perform useful tasks. In this case, we will use the file information to automatically<a class="indexterm" id="id317"/> organize a folder full of photos into a subset of folders based on the dates the photos were taken on. The following screenshot shows the output of the script:</p><div class="mediaobject"><img alt="Organizing your photos automatically" src="graphics/6623OT_03_6.jpg"/><div class="caption"><p>The application will use the photo's information to sort pictures into folders by the date on which they were taken</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec75"/>Getting ready</h2></div></div></div><p>You will need a selection of photos placed in a folder on the Raspberry Pi. Alternatively, you can insert a USB memory stick or a card reader with photos on it—they will be located in <code class="literal">/mnt/</code>. However, please make sure you test the scripts with a copy of your photos first, just in case there are any problems.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec76"/>How to do it…</h2></div></div></div><p>Create the following script in <code class="literal">filehandler.py</code> to automatically organize your photos:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#filehandler.py
import os
import shutil
import photohandler as PH
from operator import itemgetter

FOLDERSONLY=True
DEBUG=True
defaultpath=""
NAME=0
DATE=1

class FileList:
  def __init__(self,folder):
    """Class constructor"""
    self.folder=folder
    self.listFileDates()

  def getPhotoNamedates(self):
    """returns the list of filenames and dates"""
    return self.photo_namedates

  def listFileDates(self):
    """Generate list of filenames and dates"""
    self.photo_namedates = list()
    if os.path.isdir(self.folder):
      for filename in os.listdir(self.folder):
        if filename.lower().endswith(".jpg"):
          aPhoto = PH.Photo(os.path.join(self.folder,filename))
          if aPhoto.filevalid:
            if (DEBUG):print("NameDate: %s %s"%
                             (filename,aPhoto.getDate()))
            self.photo_namedates.append((filename,
                                         aPhoto.getDate()))
            self.photo_namedates = sorted(self.photo_namedates,
                                    key=lambda date: date[DATE])

  def genFolders(self):
    """function to generate folders"""
    for i,namedate in enumerate(self.getPhotoNamedates()):
      #Remove the - from the date format
      new_folder=namedate[DATE].replace("-","")
      newpath = os.path.join(self.folder,new_folder)
      #If path does not exist create folder
      if not os.path.exists(newpath):
        if (DEBUG):print ("New Path: %s" % newpath)
        os.makedirs(newpath)
      if (DEBUG):print ("Found file: %s move to %s" %
                        (namedate[NAME],newpath))
      src_file = os.path.join(self.folder,namedate[NAME])
      dst_file = os.path.join(newpath,namedate[NAME])
      try:
        if (DEBUG):print ("File moved %s to %s" %
                          (src_file, dst_file))
        if (FOLDERSONLY==False):shutil.move(src_file, dst_file)
      except IOError:
        print ("Skipped: File not found")

def main():
  """called only when run directly, allowing module testing"""
  import tkinter as TK
  from tkinter import filedialog
  app = TK.Tk()
  app.withdraw()
  dirname = TK.filedialog.askdirectory(parent=app,
      initialdir=defaultpath,
      title='Select your pictures folder')
  if dirname != "":
    ourFileList=FileList(dirname)
    ourFileList.genFolders()

if __name__=="__main__":
  main()
#End</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec77"/>How it works…</h2></div></div></div><p>We shall make<a class="indexterm" id="id318"/> a class called <code class="literal">FileList</code>; it will make use of the <code class="literal">Photo</code> class to manage the photos within a specific folder. There are two main steps for this: we first need to find all the images within the folder, and then generate a list containing both the filename and the photo date. We will use this information to generate new subfolders and move the photos into these folders.</p><p>When we create the <code class="literal">FileList</code> object, we will create the list using <code class="literal">listFileDates()</code>. We will then confirm that the folder provided is valid and use <code class="literal">os.listdir</code> to obtain the full list of files within the directory. We will check that each file is a <code class="literal">.jpg</code> file and obtain each photo's date (using the function defined in the <code class="literal">Photo</code> class). Next, we will add the filename and date as a tuple to the <code class="literal">self.photo_namedates</code> list.</p><p>Finally, we will use the built-in <code class="literal">sorted</code> function to place all the files in order of their date. While we don't need to do this here, this function would make it easier to remove duplicate dates if we <a class="indexterm" id="id319"/>were to use this module elsewhere.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>The <code class="literal">sorted</code> function requires the list to be sorted, and in this case, we want to sort it by the <code class="literal">date</code> values.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sorted(self.photo_namedates,key=lambda date: date[DATE])</strong></span>
</pre></div><p>We will substitute <code class="literal">date[DATE]</code> with <code class="literal">lambda date:</code> as the value to sort by.</p></div></div><p>Once the <code class="literal">FileList</code> object has been initialized, we can use it by calling <code class="literal">genFolders()</code>. First, we convert the date text into a suitable format for our folders (YYYYMMDD), allowing our folders to be easily sorted in order of their date. Next, it will create the folders within the current directory if they don't already exist. Finally, it will move each of the files into the required subfolder.</p><p>We end up with our <code class="literal">FileList</code> class that is ready to be tested:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Operations</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">__init__(self,folder)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a class="indexterm" id="id320"/> is the object initialization function</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getPhotoNamedates(self)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id321"/>returns a list of the filenames of the dates of the photos</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">listFileDates(self)</code> </p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id322"/>creates a list of the filenames and dates of the photos in the folder</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">genFolders(self)</code> </p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id323"/>creates new folders based on a photo's date and moves the files into them</p>
</td></tr></tbody></table></div><p>The properties are listed as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Properties</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.folder</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The<a class="indexterm" id="id324"/> folder we are working with</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.photo_namedates</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a class="indexterm" id="id325"/> contains a list of the filenames and dates</p>
</td></tr></tbody></table></div><p>The <code class="literal">FileList</code> class encapsulates all the functions and the relevant data together, keeping everything in <a class="indexterm" id="id326"/>one logical place:</p><div class="mediaobject"><img alt="How it works…" src="graphics/6623OT_03_7.jpg"/><div class="caption"><p>Tkinter filediaglog.askdirectory() is used to select the photo directory</p></div></div><p>To test this, we use the Tkinter <code class="literal">filedialog.askdirectory()</code> widget to allow us to select a target directory of pictures. We use <code class="literal">app.withdrawn()</code> to hide the main Tkinter window since it isn't required this time. We just need to create a new <code class="literal">FileList</code> object and then call <code class="literal">genFolders()</code> to move all our photos to new locations!</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note37"/>Note</h3><p>Two additional flags have been defined in this script that provide an extra control for testing. <code class="literal">DEBUG</code> allows us to enable or disable extra debugging messages by setting them to either <code class="literal">True</code> or <code class="literal">False</code>. Furthermore, from this, <code class="literal">FOLDERSONLY</code> when set to <code class="literal">True</code> only generates the folders and doesn't move the files (this is helpful for testing whether the new subfolders are correct).</p></div></div><p>Once you have run the script, you can check if all the folders have been created correctly. Finally, change <code class="literal">FOLDERSONLY</code> to <code class="literal">True</code>, and your program will automatically move and organize your photos according to their dates the next time. It is recommended that you only run this on a copy of your photos, just in case you get an error.</p></div></div></body></html>