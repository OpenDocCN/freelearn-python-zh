<html><head></head><body>
<div><h1 class="chapterNumber">1</h1>
<h1 class="chapterTitle" id="_idParaDest-20">Building a Blog Application</h1>
<p class="normal">In this book, you will learn how to build professional-grade web projects using Django. This initial chapter will guide you through the essential building blocks of a Django application, from installation to deployment. If you haven’t set up Django on your machine yet, the <em class="italic">Installing Django</em> section will walk you through the installation process.</p>
<p class="normal">Before starting our first Django project, let’s go over what you are about to learn. This chapter will give you a general overview of the framework. It will guide you through the different major components to create a fully functional web application: models, templates, views, and URLs. You will gain an understanding of how Django works and how the different framework components interact.</p>
<p class="normal">You will also learn the difference between Django projects and applications, and you will learn about the most important Django settings. You will build a simple blog application that allows users to navigate through all published posts and read individual posts. You will also create a simple administration interface to manage and publish posts. In the next two chapters, you will extend the blog application with more advanced functionalities.</p>
<p class="normal">Consider this chapter as your roadmap for constructing a fully-fledged Django application. Don’t be concerned if some components or concepts appear unclear at first. The different framework components will be explored in detail throughout this book.</p>
<p class="normal">This chapter will cover the following topics:</p>
<ul>
<li class="bulletList">Installing Python</li>
<li class="bulletList">Creating a Python virtual environment</li>
<li class="bulletList">Installing Django</li>
<li class="bulletList">Creating and configuring a Django project</li>
<li class="bulletList">Building a Django application</li>
<li class="bulletList">Designing data models</li>
<li class="bulletList">Creating and applying model migrations</li>
<li class="bulletList">Setting up an administration site for your models</li>
<li class="bulletList">Working with QuerySets and model managers</li>
<li class="bulletList">Building views, templates, and URLs</li>
<li class="bulletList">Understanding the Django request/response cycle</li>
</ul>
<p class="normal">You will start by installing Python on your machine.</p>
<p class="normal">The source code for this chapter can be found at <a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01</a>.</p>
<p class="normal">All Python packages used in this chapter are included in the <code class="inlineCode">requirements.txt</code> file in the source code for the chapter. You can follow the instructions to install each Python package in the following sections, or you can install all the requirements at once with the command <code class="inlineCode">python -m pip install -r requirements.txt</code>.</p>
<h1 class="heading-1" id="_idParaDest-21">Installing Python</h1>
<p class="normal">Django 5.0 supports Python 3.10, 3.11, and 3.12. In the<a id="_idIndexMarker000"/> examples in this book, we will use Python 3.12.</p>
<p class="normal">If you’re using Linux or macOS, you probably have Python installed. If you’re using Windows, you can download a Python installer from the <a href="http://python.org">python.org</a> website. You can download Python for your OS from <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a>.</p>
<p class="normal">Open the command-line shell prompt of your machine. If you are using macOS, press <em class="keystroke">Command + spacebar</em> to open Spotlight and write <strong class="screenText">Terminal</strong> to open <code class="inlineCode">Terminal.app</code>. If you are using Windows, open the <strong class="screenText">Start</strong> menu and type <code class="inlineCode">powers</code> into the search box. Then, click on the <strong class="screenText">Windows PowerShell</strong> application to open it. Alternatively, you can use the more basic command prompt by typing <code class="inlineCode">cmd</code> into the search box and clicking on the <strong class="screenText">Command Prompt</strong> application to open it.</p>
<p class="normal">Verify that Python 3 is installed on your machine by typing the following command in the shell prompt:</p>
<pre class="programlisting con"><code class="hljs-con">python3 --version
</code></pre>
<p class="normal">If you see the following, then Python 3 is installed on your computer:</p>
<pre class="programlisting con"><code class="hljs-con">Python 3.12.3
</code></pre>
<p class="normal">If you get an error, try the <code class="inlineCode">python</code> command instead of <code class="inlineCode">python3</code>. If you use Windows, it’s recommended that you replace <code class="inlineCode">python</code> with the <code class="inlineCode">py</code> command.</p>
<p class="normal">If your installed Python version is lower than 3.12, or if Python is not installed on your computer, download Python 3.12 from <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a> and follow the instructions to install it. On the download site, you can find Python installers for Windows, macOS, and Linux.</p>
<p class="normal">Throughout this book, when Python is referenced in the shell prompt, we will use the <code class="inlineCode">python</code> command, though some systems may require using <code class="inlineCode">python3</code>. If you are using Linux or macOS and your system’s Python is Python 2, you will need to use <code class="inlineCode">python3</code> to use the Python 3 version you installed. Note that Python 2 reached end-of-life in January 2020 and shouldn’t be used anymore.</p>
<p class="normal">In Windows, <code class="inlineCode">python</code> is the Python executable of your default Python installation, whereas <code class="inlineCode">py</code> is the Python launcher. The Python launcher for Windows was introduced in Python 3.3. It detects what Python versions are installed on your machine and it automatically delegates to the latest version. </p>
<p class="normal">If you use Windows, you should use the <code class="inlineCode">py</code> command. You can<a id="_idIndexMarker001"/> read more about the Windows Python launcher at <a href="https://docs.python.org/3/using/windows.html#launcher">https://docs.python.org/3/using/windows.html#launcher</a>.</p>
<p class="normal">Next, you are going to create a Python environment for your project and install the necessary Python libraries.</p>
<h1 class="heading-1" id="_idParaDest-22">Creating a Python virtual environment</h1>
<p class="normal">When you write<a id="_idIndexMarker002"/> Python applications, you will usually use packages and modules that are not included in the standard Python library. You may have Python applications that require a different version of the same module. However, only a specific version of a module can be installed system-wide. If you upgrade a module version for an application, you might end up breaking other applications that require an older version of that module.</p>
<p class="normal">To address this issue, you can use Python virtual environments. With virtual environments, you can install Python modules in an isolated location rather than installing them system-wide. Each virtual environment has its own Python binary and can have its own independent set of installed Python packages in its site-packages directory.</p>
<p class="normal">Since version 3.3, Python comes with the <code class="inlineCode">venv</code> library, which provides support for creating lightweight virtual environments. By using the Python <code class="inlineCode">venv</code> module to create isolated Python environments, you can use different package versions for different projects. Another advantage of using <code class="inlineCode">venv</code> is that you won’t need any administrative privileges to install Python packages.</p>
<p class="normal">If you are using Linux or macOS, create an isolated environment with the following command:</p>
<pre class="programlisting con"><code class="hljs-con">python -m venv my_env
</code></pre>
<p class="normal">Remember to use <code class="inlineCode">python3</code> instead of <code class="inlineCode">python</code> if your system comes with Python 2 and you installed Python 3.</p>
<p class="normal">If you are using<a id="_idIndexMarker003"/> Windows, use the following command instead:</p>
<pre class="programlisting con"><code class="hljs-con">py -m venv my_env
</code></pre>
<p class="normal">This will use the Python launcher in Windows.</p>
<p class="normal">The previous command will create a Python environment in a new directory named <code class="inlineCode">my_env</code>. Any Python libraries you install while your virtual environment is active will go into the <code class="inlineCode">my_env/lib/python3.12/site-packages</code> directory.</p>
<p class="normal">If you are using Linux or macOS, run the following command to activate your virtual environment:</p>
<pre class="programlisting con"><code class="hljs-con">source my_env/bin/activate
</code></pre>
<p class="normal">If you are using Windows, use the following command instead:</p>
<pre class="programlisting con"><code class="hljs-con">.\my_env\Scripts\activate
</code></pre>
<p class="normal">The shell prompt will include the name of the active virtual environment enclosed in parentheses, like this:</p>
<pre class="programlisting con"><code class="hljs-con">(my_env) zenx@pc:~ zenx$
</code></pre>
<p class="normal">You can deactivate your environment at any time with the <code class="inlineCode">deactivate</code> command. You can find more<a id="_idIndexMarker004"/> information about <code class="inlineCode">venv</code> at <a href="https://docs.python.org/3/library/venv.html">https://docs.python.org/3/library/venv.html</a>.</p>
<h1 class="heading-1" id="_idParaDest-23">Installing Django</h1>
<p class="normal">If you have already<a id="_idIndexMarker005"/> installed Django 5.0, you can skip this section and jump directly to the <em class="italic">Creating your first project</em> section.</p>
<p class="normal">Django comes as a Python module and thus can be installed in any Python environment. If you haven’t installed Django yet, the following is a quick guide to installing it on your machine.</p>
<h2 class="heading-2" id="_idParaDest-24">Installing Django with pip</h2>
<p class="normal">The <code class="inlineCode">pip</code> package <a id="_idIndexMarker006"/>management system is the preferred method of installing <a id="_idIndexMarker007"/>Django. Python 3.12 comes with <code class="inlineCode">pip</code> preinstalled, but you can find <code class="inlineCode">pip</code> installation instructions at <a href="https://pip.pypa.io/en/stable/installation/">https://pip.pypa.io/en/stable/installation/</a>.</p>
<p class="normal">Run the following command at the shell prompt to install Django with <code class="inlineCode">pip</code>:</p>
<pre class="programlisting con"><code class="hljs-con">python -m pip install Django~=5.0.4
</code></pre>
<p class="normal">This will install Django’s latest 5.0 version in the Python <code class="inlineCode">site-packages</code> directory of your virtual environment.</p>
<p class="normal">Now we will check whether Django has been successfully installed. Run the following command in a shell prompt:</p>
<pre class="programlisting con"><code class="hljs-con">python -m django --version
</code></pre>
<p class="normal">If you get an output that starts with <code class="inlineCode">5.0</code>, Django has been successfully installed on your machine. If you get the message <code class="inlineCode">No module named Django</code>, Django is not installed on your machine. If you have issues installing Django, you can review the different installation options described at <a href="https://docs.djangoproject.com/en/5.0/intro/install/">https://docs.djangoproject.com/en/5.0/intro/install/</a>.</p>
<p class="normal">All Python packages used in this chapter are included in the <code class="inlineCode">requirements.txt</code> file in the source code for the chapter, mentioned above. You can follow the instructions to install each Python package in the following sections, or you can install all requirements at once with<a id="_idIndexMarker008"/> the <a id="_idIndexMarker009"/>command <code class="inlineCode">pip install -r requirements.txt</code>.</p>
<h1 class="heading-1" id="_idParaDest-25">Django overview</h1>
<p class="normal">Django is a framework <a id="_idIndexMarker010"/>consisting of a set of components that solve common web development problems. Django components are loosely coupled, which means they can be managed independently. This helps separate the responsibilities of the different layers of the framework; the database layer knows nothing about how the data is displayed, the template system knows nothing about web requests, and so on.</p>
<p class="normal">Django offers maximum code reusability by<a id="_idIndexMarker011"/> following the <strong class="keyWord">DRY</strong> (<strong class="keyWord">don’t repeat yourself</strong>) principle. Django also fosters rapid development and allows you to use less code by taking advantage of Python’s dynamic capabilities, such as introspection.</p>
<p class="normal">You can read more about Django’s design philosophies at <a href="https://docs.djangoproject.com/en/5.0/misc/design-philosophies/">https://docs.djangoproject.com/en/5.0/misc/design-philosophies/</a>.</p>
<h2 class="heading-2" id="_idParaDest-26">Main framework components</h2>
<p class="normal">Django <a id="_idIndexMarker012"/>follows the <strong class="keyWord">MTV</strong> (<strong class="keyWord">Model-Template-View</strong>) pattern. It is a <a id="_idIndexMarker013"/>slightly similar pattern to the well-known <strong class="keyWord">MVC</strong> (<strong class="keyWord">Model-View-Controller</strong>) pattern, where<a id="_idIndexMarker014"/> the template acts as the view and the framework itself acts as the controller.</p>
<p class="normal">The responsibilities in the Django MTV pattern are divided as follows:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Model</strong>: This defines the logical data structure and is the data handler between the database and the view.</li>
<li class="bulletList"><strong class="keyWord">Template</strong>: This is the presentation layer. Django uses a plain-text template system that keeps everything that the browser renders.</li>
<li class="bulletList"><strong class="keyWord">View</strong>: This communicates with the database via the model and transfers the data to the template for viewing.</li>
</ul>
<p class="normal">The framework itself acts as the controller. It sends a request to the appropriate view, according to the Django <strong class="keyWord">URL</strong> configuration.</p>
<p class="normal">When developing any Django project, you will always work with models, views, templates, and<a id="_idIndexMarker015"/> URLs. In this chapter, you will learn how they fit together.</p>
<h2 class="heading-2" id="_idParaDest-27">The Django architecture</h2>
<p class="normal"><em class="italic">Figure 1.1</em> shows how <a id="_idIndexMarker016"/>Django processes requests and how the request/response cycle is managed with the different main Django components – URLs, views, models, and templates:</p>
<figure class="mediaobject"><img alt="Diagram  Description automatically generated" src="img/B21088_01_01.png"/></figure>
<p class="packt_figref">Figure 1.1: The Django architecture</p>
<p class="normal">This is how Django handles HTTP requests and generates responses:</p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1">A web browser requests a page by its URL and the web server passes the HTTP request to Django.</li>
<li class="numberedList">Django runs through its configured URL patterns and stops at the first one that matches the requested URL.</li>
<li class="numberedList">Django executes the view that corresponds to the matched URL pattern.</li>
<li class="numberedList">The view potentially uses data models to retrieve information from the database.</li>
<li class="numberedList">Data models provide data definitions and behaviors. They are used to query the database.</li>
<li class="numberedList">The view renders a template (usually HTML) to display the data and returns it with an HTTP response.</li>
</ol>
<p class="normal">We will get back to the Django request/response cycle at the end of this chapter in the <em class="italic">The request/response cycle</em> section.</p>
<p class="normal">Django also includes hooks in the request/response process, which are called middleware. Middleware has been intentionally left out of this diagram for the sake of simplicity. You will use middleware in different examples of this book, and you will learn how to create custom middleware in <em class="italic">Chapter 17</em>, <em class="italic">Going Live</em>.</p>
<p class="normal">We have covered <a id="_idIndexMarker017"/>the foundational elements of Django and how it processes requests. Let’s explore the new features introduced in Django 5.</p>
<h2 class="heading-2" id="_idParaDest-28">New features in Django 5</h2>
<p class="normal">Django 5 introduces <a id="_idIndexMarker018"/>several key features that you will use in the examples of this book. This version also deprecates certain features and eliminates previously deprecated functionalities. Django 5.0 presents the following new major features:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Facet filters in the administration site</strong>: Facet filters can be added now to the administration site. When enabled, facet counts are displayed for applied filters in the admin object list. This feature is presented in the <em class="italic">Added facet counts to filters</em> section of this chapter.</li>
<li class="bulletList"><strong class="keyWord">Simplified templates for form field rendering</strong>: Form field rendering has been simplified with the capability to define field groups with associated templates. This aims to make the process of rendering related elements of a Django form field, such as labels, widgets, help text, and errors, more streamlined. An example of using field groups can be found in the <em class="italic">Creating templates for the comment form</em> section of <em class="italic">Chapter 2, Enhancing Your Blog and Adding Social Features</em>.</li>
<li class="bulletList"><strong class="keyWord">Database-computed default values</strong>: Django adds database-computed default values. An example of this feature is presented in the <em class="italic">Adding datetime fields</em> section of this chapter.</li>
<li class="bulletList"><strong class="keyWord">Database-generated model fields</strong>: This is a new type of field that enables you to create database-generated columns. An expression is used to automatically set the field value each time the model is changed. The field value is set using the <code class="inlineCode">GENERATED</code> <code class="inlineCode">ALWAYS</code> SQL syntax.</li>
<li class="bulletList"><strong class="keyWord">More options for declaring model field choices</strong>: Fields that support choices no longer require accessing the <code class="inlineCode">.choices</code> attribute to access enumeration types. A mapping or callable instead of an iterable can be used directly to expand enumeration types. Choices with enumeration types in this book have been updated to reflect these changes. An instance of this can be found in <a id="_idIndexMarker019"/>the <em class="italic">Adding a status field</em> section of this chapter.</li>
</ul>
<p class="normal">Django 5 also comes with some improvements in asynchronous support<strong class="keyWord">. Asynchronous Server Gateway Interface</strong> (<strong class="keyWord">ASGI</strong>) support<a id="_idIndexMarker020"/> was first introduced in Django 3 and improved in Django 4.1 with asynchronous handlers for class-based views and an asynchronous ORM interface. Django 5 adds asynchronous functions to the authentication framework, provides support for asynchronous signal dispatching, and adds asynchronous support to multiple built-in decorators.</p>
<p class="normal">Django 5.0 drops support for Python 3.8 and 3.9.</p>
<p class="normal">You can read the complete list of changes in the Django 5.0 release notes at <a href="https://docs.djangoproject.com/en/5.0/releases/5.0/">https://docs.djangoproject.com/en/5.0/releases/5.0/</a>.</p>
<p class="normal">As a time-based release, there are no drastic changes in Django 5, making it straightforward to upgrade Django 4 applications to the 5.0 release.</p>
<p class="normal">If you want to quickly upgrade an existing Django project to the 5.0 release, you can use the <code class="inlineCode">django-upgrade</code> tool. This package rewrites the files of your project by applying fixers up to a target version. You can find instructions to use <code class="inlineCode">django-upgrade</code> at <a href="https://github.com/adamchainz/django-upgrade">https://github.com/adamchainz/django-upgrade</a>.</p>
<p class="normal">The <code class="inlineCode">django-upgrade</code> tool is inspired by the <code class="inlineCode">pyupgrade</code> package. You can use <code class="inlineCode">pyupgrade</code> to automatically upgrade syntax for newer versions of Python. You can find more information <a id="_idIndexMarker021"/>about <code class="inlineCode">pyupgrade</code> at <a href="https://github.com/asottile/pyupgrade">https://github.com/asottile/pyupgrade</a>.</p>
<h1 class="heading-1" id="_idParaDest-29">Creating your first project</h1>
<p class="normal">Your first Django<a id="_idIndexMarker022"/> project will consist of a blog application. This will offer you a solid introduction to Django’s capabilities and functionalities.</p>
<p class="normal">Blogging is the perfect starting point to build a complete Django project, given its wide range of required features, from basic content management to advanced functionalities like commenting, post sharing, search, and post recommendations. The blog project will be covered in the first three chapters of this book.</p>
<p class="normal">In this chapter, we will start by creating the Django project and a Django application for the blog. We will then create our data models and synchronize them to the database. Finally, we will create an administration site for the blog, and we will build the views, templates, and URLs.</p>
<p class="normal"><em class="italic">Figure 1.2</em> shows a representation of the blog application pages that you will create:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_02.png"/></figure>
<p class="packt_figref">Figure 1.2: Diagram of functionalities built in Chapter 1</p>
<p class="normal">The blog application will consist of a list of posts including the post title, publishing date, author, a post excerpt, and a link to read the post. The post list page will be implemented with the <code class="inlineCode">post_list</code> view. You will learn how to create views in this chapter.</p>
<p class="normal">When readers click on the link of a post in the post list page, they will be redirected to a single (detail) view of a post. The detail view will display the title, publishing date, author, and the complete post body.</p>
<p class="normal">Let’s start by creating the Django project for our blog. Django provides a command that allows you to create an initial project file structure.</p>
<p class="normal">Run the following command in your shell prompt:</p>
<pre class="programlisting con"><code class="hljs-con">django-admin startproject mysite
</code></pre>
<p class="normal">This will create a<a id="_idIndexMarker023"/> Django project with the name <code class="inlineCode">mysite</code>.</p>
<div><p class="normal">Avoid naming projects after built-in Python or Django modules in order to prevent conflicts.</p>
</div>
<p class="normal">Let’s take a look at the generated project structure:</p>
<pre class="programlisting con"><code class="hljs-con">mysite/
    manage.py
    mysite/
      __init__.py
      asgi.py
      settings.py
      urls.py
      wsgi.py
</code></pre>
<p class="normal">The outer <code class="inlineCode">mysite/</code> directory is the container for our project. It contains the following files:</p>
<ul>
<li class="bulletList"><code class="inlineCode">manage.py</code>: This is a command-line utility used to interact with your project. You won’t usually need to edit this file.</li>
<li class="bulletList"><code class="inlineCode">mysite/</code>: This is the Python package for your project, which consists of the following files:<ul>
<li class="bulletList"><code class="inlineCode">__init__.py</code>: An empty file that tells Python to treat the <code class="inlineCode">mysite</code> directory as a Python module.</li>
<li class="bulletList"><code class="inlineCode">asgi.py</code>: This is the configuration to run your project as an ASGI application with ASGI-compatible web servers. ASGI is the emerging Python standard for asynchronous web servers and applications.</li>
<li class="bulletList"><code class="inlineCode">settings.py</code>: This indicates settings and configuration for your project and contains initial default settings.</li>
<li class="bulletList"><code class="inlineCode">urls.py</code>: This is the place where your URL patterns live. Each URL defined here is mapped to a view.</li>
<li class="bulletList"><code class="inlineCode">wsgi.py</code>: This is<a id="_idIndexMarker024"/> the configuration to run your project as a <strong class="keyWord">Web Server Gateway Interface</strong> (<strong class="keyWord">WSGI</strong>) application with WSGI-compatible<a id="_idIndexMarker025"/> web servers.</li>
</ul>
</li>
</ul>
<h2 class="heading-2" id="_idParaDest-30">Applying initial database migrations</h2>
<p class="normal">Django applications<a id="_idIndexMarker026"/> require a database to store data. The <code class="inlineCode">settings.py</code> file contains the database configuration for your project in the <code class="inlineCode">DATABASES</code> setting. The default configuration is a SQLite3 database. SQLite comes bundled with Python 3 and can be used in any of your Python applications. SQLite is a lightweight database that you can use with Django for development. If you plan to deploy your application in a production environment, you should use a full-featured database, such as PostgreSQL, MySQL, or Oracle. You can find more information about how to get your database running with Django at <a href="https://docs.djangoproject.com/en/5.0/topics/install/#database-installation">https://docs.djangoproject.com/en/5.0/topics/install/#database-installation</a>.</p>
<p class="normal">Your <code class="inlineCode">settings.py</code> file also includes a list named <code class="inlineCode">INSTALLED_APPS</code> that contains common Django applications that are added to your project by default. We will go through these applications later in the <em class="italic">Project settings</em> section.</p>
<p class="normal">Django applications contain data models that are mapped to database tables. You will create your own models in the <em class="italic">Creating the blog data models</em> section. To complete the project setup, you need to create the tables associated with the models of the default Django applications included in the <code class="inlineCode">INSTALLED_APPS</code> setting. Django comes with a system that helps you manage database migrations.</p>
<p class="normal">Open the shell prompt and run the following commands:</p>
<pre class="programlisting con"><code class="hljs-con">cd mysite
python manage.py migrate
</code></pre>
<p class="normal">You will see an output that ends with the following lines:</p>
<pre class="programlisting con"><code class="hljs-con">Applying contenttypes.0001_initial... OK
Applying auth.0001_initial... OK
Applying admin.0001_initial... OK
Applying admin.0002_logentry_remove_auto_add... OK
Applying admin.0003_logentry_add_action_flag_choices... OK
Applying contenttypes.0002_remove_content_type_name... OK
Applying auth.0002_alter_permission_name_max_length... OK
Applying auth.0003_alter_user_email_max_length... OK
Applying auth.0004_alter_user_username_opts... OK
Applying auth.0005_alter_user_last_login_null... OK
Applying auth.0006_require_contenttypes_0002... OK
Applying auth.0007_alter_validators_add_error_messages... OK
Applying auth.0008_alter_user_username_max_length... OK
Applying auth.0009_alter_user_last_name_max_length... OK
Applying auth.0010_alter_group_name_max_length... OK
Applying auth.0011_update_proxy_permissions... OK
Applying auth.0012_alter_user_first_name_max_length... OK
Applying sessions.0001_initial... OK
</code></pre>
<p class="normal">The preceding lines are the database migrations that are applied by Django. By applying the initial migrations, the tables for the applications listed in the <code class="inlineCode">INSTALLED_APPS</code> setting are created in<a id="_idIndexMarker027"/> the database.</p>
<p class="normal">You will learn more about the <code class="inlineCode">migrate</code> management command in the <em class="italic">Creating and applying migrations</em> section of this chapter.</p>
<h2 class="heading-2" id="_idParaDest-31">Running the development server</h2>
<p class="normal">Django comes with<a id="_idIndexMarker028"/> a lightweight web server to run your code quickly, without needing to spend time configuring a production server. When you run the Django development server, it keeps checking for changes in your code. It reloads automatically, freeing you from manually reloading it after code changes. However, it might not notice some actions, such as adding new files to your project, so you will have to restart the server manually in these cases.</p>
<p class="normal">Start the development server by typing the following command in the shell prompt:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py runserver
</code></pre>
<p class="normal">You should see something like this:</p>
<pre class="programlisting con"><code class="hljs-con">Watching for file changes with StatReloader
Performing system checks...
System check identified no issues (0 silenced).
January 01, 2024 - 10:00:00
Django version 5.0, using settings 'mysite.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre>
<p class="normal">Now, open <code class="inlineCode">http://127.0.0.1:8000/</code> in your browser. You should see a page stating that the project is <a id="_idIndexMarker029"/>successfully running, as shown in <em class="italic">Figure 1.3</em>:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_03.png"/></figure>
<p class="packt_figref">Figure 1.3: The default page of the Django development server</p>
<p class="normal">The preceding screenshot indicates that Django is running. If you take a look at your console, you will see the <code class="inlineCode">GET</code> request performed by your browser:</p>
<pre class="programlisting con"><code class="hljs-con">[01/Jan/2024 10:00:15] "GET / HTTP/1.1" 200 16351
</code></pre>
<p class="normal">Each HTTP request is logged in the console by the development server. Any error that occurs while running the development server will also appear in the console.</p>
<p class="normal">You can run the Django development server on a custom host and port or tell Django to load a specific settings file, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py runserver 127.0.0.1:8001 --settings=mysite.settings
</code></pre>
<div><p class="normal">When you have to deal with multiple environments that require different configurations, you can create a different settings file for each environment.</p>
</div>
<p class="normal">This server is only intended for development and is not suitable for production use. To deploy Django in a production environment, you should run it as a WSGI application using a web server, such as Apache, Gunicorn, or uWSGI, or as an ASGI application using a server such as Daphne <a id="_idIndexMarker030"/>or Uvicorn. You can find more information on how to deploy Django with different web servers at <a href="https://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/">https://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/</a>.</p>
<p class="normal"><em class="italic">Chapter 17</em>, <em class="italic">Going Live</em>, explains how to set up a production environment for your Django projects.</p>
<h2 class="heading-2" id="_idParaDest-32">Project settings</h2>
<p class="normal">Let’s open the <code class="inlineCode">settings.py</code> file <a id="_idIndexMarker031"/>and take a look at the configuration of the project. There are several settings that Django includes in this file, but these are only part of all the available Django settings. You can see all the settings and their default values at <a href="https://docs.djangoproject.com/en/5.0/ref/settings/">https://docs.djangoproject.com/en/5.0/ref/settings/</a>.</p>
<p class="normal">Let’s review some of the project settings:</p>
<ul>
<li class="bulletList"><code class="inlineCode">DEBUG</code> is a Boolean that turns the debug mode of the project on and off. If it is set to <code class="inlineCode">True</code>, Django will display detailed error pages when an uncaught exception is thrown by your application. When you move to a production environment, remember that you have to set it to <code class="inlineCode">False</code>. Never deploy a site into production with <code class="inlineCode">DEBUG</code> turned on because you will expose sensitive project-related data.</li>
<li class="bulletList"><code class="inlineCode">ALLOWED_HOSTS</code> is not applied while debug mode is on or when the tests are run. Once you move your site to production and set <code class="inlineCode">DEBUG</code> to <code class="inlineCode">False</code>, you will have to add your domain/host to this setting to allow it to serve your Django site.</li>
<li class="bulletList"><code class="inlineCode">INSTALLED_APPS</code> is a setting you will have to edit for all projects. This setting tells Django which applications are active for this site. By default, Django includes the following applications:<ul>
<li class="bulletList"><code class="inlineCode">django.contrib.admin</code>: An administration site.</li>
<li class="bulletList"><code class="inlineCode">django.contrib.auth</code>: An authentication framework.</li>
<li class="bulletList"><code class="inlineCode">django.contrib.contenttypes</code>: A framework for handling content types.</li>
<li class="bulletList"><code class="inlineCode">django.contrib.sessions</code>: A session framework.</li>
<li class="bulletList"><code class="inlineCode">django.contrib.messages</code>: A messaging framework.</li>
<li class="bulletList"><code class="inlineCode">django.contrib.staticfiles</code>: A framework for managing static files, such as CSS, JavaScript files, and images.</li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode">MIDDLEWARE</code> is a list that contains middleware to be executed.</li>
<li class="bulletList"><code class="inlineCode">ROOT_URLCONF</code> indicates the Python module where the root URL patterns of your application are defined.</li>
<li class="bulletList"><code class="inlineCode">DATABASES</code> is a dictionary that contains the settings for all the databases to be used in the project. There must always be a default database. The default configuration uses a SQLite3 database.</li>
<li class="bulletList"><code class="inlineCode">LANGUAGE_CODE</code> defines the default language code for this Django site.</li>
<li class="bulletList"><code class="inlineCode">USE_TZ</code> tells Django to activate/deactivate timezone support. Django comes with support for timezone-aware datetimes. This setting is set to <code class="inlineCode">True</code> when you create a new project using the <code class="inlineCode">startproject</code> management command.</li>
</ul>
<p class="normal">Don’t worry if <a id="_idIndexMarker032"/>you don’t understand much about what you’re seeing here. You will learn more about the different Django settings in the following chapters.</p>
<h2 class="heading-2" id="_idParaDest-33">Projects and applications</h2>
<p class="normal">Throughout this <a id="_idIndexMarker033"/>book, you will encounter the terms <strong class="keyWord">project</strong> and <strong class="keyWord">application</strong> over and over. In Django, a project is considered a Django installation with some settings. An application is a group of models, views, templates, and URLs. Applications interact with the framework to provide specific functionalities and may be reused in various projects. You can think of a project as your website, which contains several applications, such as a blog, wiki, or forum, that can also be used by other Django projects.</p>
<p class="normal"><em class="italic">Figure 1.4</em> shows the structure of a Django project:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_04.png"/></figure>
<p class="packt_figref">Figure 1.4: The Django project/application structure</p>
<h2 class="heading-2" id="_idParaDest-34">Creating an application</h2>
<p class="normal">Let’s create our first<a id="_idIndexMarker034"/> Django application. We will build a blog application from scratch.</p>
<p class="normal">Run the following command in the shell prompt from the project’s root directory:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py startapp blog
</code></pre>
<p class="normal">This will create the basic structure of the application, which will look like this:</p>
<pre class="programlisting con"><code class="hljs-con">blog/
    __init__.py
    admin.py
    apps.py
    migrations/
        __init__.py
    models.py
    tests.py
    views.py
</code></pre>
<p class="normal">These files are as follows:</p>
<ul>
<li class="bulletList"><code class="inlineCode">__init__.py</code>: This is an empty file that tells Python to treat the <code class="inlineCode">blog</code> directory as a Python module.</li>
<li class="bulletList"><code class="inlineCode">admin.py</code>: This is where you register models to include them in the Django administration site—using this site is optional.</li>
<li class="bulletList"><code class="inlineCode">apps.py</code>: This includes the main configuration of the <code class="inlineCode">blog</code> application.</li>
<li class="bulletList"><code class="inlineCode">migrations</code>: This directory will contain database migrations of the application. Migrations allow Django to track your model changes and synchronize the database accordingly. This directory contains an empty <code class="inlineCode">__init__.py</code> file.</li>
<li class="bulletList"><code class="inlineCode">models.py</code>: This includes the data models of your application; all Django applications need to have a <code class="inlineCode">models.py</code> file but it can be left empty.</li>
<li class="bulletList"><code class="inlineCode">tests.py</code>: This is where you can add tests for your application.</li>
<li class="bulletList"><code class="inlineCode">views.py</code>: The logic of your application goes here; each view receives an HTTP<a id="_idIndexMarker035"/> request, processes it, and returns a response.</li>
</ul>
<p class="normal">With the application structure ready, we can start building the data models for the blog.</p>
<h1 class="heading-1" id="_idParaDest-35">Creating the blog data models</h1>
<p class="normal">Remember that a <a id="_idIndexMarker036"/>Python object is a collection of data and methods. Classes are the blueprint for bundling data and functionality together. Creating a new class creates a new type of object, allowing you to create instances of that type.</p>
<p class="normal">A Django model is a source of information about the behaviors of your data. It consists of a Python class that subclasses <code class="inlineCode">django.db.models.Model</code>. Each model maps to a single database table, where each attribute of the class represents a database field. </p>
<p class="normal">When you create a model, Django will provide you with a practical API to query objects in the database easily.</p>
<p class="normal">We will define the database models for our blog application. Then, we will generate the database migrations for the models to create the corresponding database tables. When applying the migrations, Django will create a table for each model defined in the <code class="inlineCode">models.py</code> file of <a id="_idIndexMarker037"/>the application.</p>
<h2 class="heading-2" id="_idParaDest-36">Creating the Post model</h2>
<p class="normal">First, we will<a id="_idIndexMarker038"/> define a <code class="inlineCode">Post</code> model that will allow us to store<a id="_idIndexMarker039"/> blog posts in the database.</p>
<p class="normal">Add the following lines to the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
<strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Post</strong><strong class="hljs-slc">(models.Model):</strong>
<strong class="hljs-slc">    title = models.CharField(max_length=</strong><strong class="hljs-number-slc">250</strong><strong class="hljs-slc">)</strong>
<strong class="hljs-slc">    slug = models.SlugField(max_length=</strong><strong class="hljs-number-slc">250</strong><strong class="hljs-slc">)</strong>
<strong class="hljs-slc">    body = models.TextField()</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">def</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">__str__</strong><strong class="hljs-slc">(</strong><strong class="hljs-params-slc">self</strong><strong class="hljs-slc">):</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> self.title</strong>
</code></pre>
<p class="normal">This is the data model for blog posts. Posts will have a title, a short label called <code class="inlineCode">slug</code>, and a body. Let’s take a look at the fields of this model:</p>
<ul>
<li class="bulletList"><code class="inlineCode">title</code>: This is the field for the post title. This is a <code class="inlineCode">CharField</code> field that translates into a <code class="inlineCode">VARCHAR</code> column in the SQL database.</li>
<li class="bulletList"><code class="inlineCode">slug</code>: This is a <code class="inlineCode">SlugField</code> field that translates into a <code class="inlineCode">VARCHAR</code> column in the SQL database. A slug is a short label that contains only letters, numbers, underscores, or hyphens. A post with the title <em class="italic">Django Reinhardt: A legend of Jazz </em>could have a slug like <em class="italic">django-reinhardt-legend-jazz</em>. We will use the <code class="inlineCode">slug</code> field to build beautiful, SEO-friendly URLs for blog posts in <em class="italic">Chapter 2, Enhancing Your Blog with Advanced Features</em>.</li>
<li class="bulletList"><code class="inlineCode">body</code>: This is the field for storing the body of the post. This is a <code class="inlineCode">TextField</code> field that translates into a <code class="inlineCode">TEXT</code> column in the SQL database.</li>
</ul>
<p class="normal">We have also added a <code class="inlineCode">__str__()</code> method to the model class. This is the default Python method to return a string with the human-readable representation of the object. Django will use this method to display the name of the object in many places, such as the Django administration site.</p>
<p class="normal">Let’s take a look at how the model and its fields will be translated into a database table and columns. The following diagram shows the <code class="inlineCode">Post</code> model and the corresponding database table that Django will create when we synchronize the model to the database:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_05.png"/></figure>
<p class="packt_figref">Figure 1.5: Initial Post model and database table correspondence</p>
<p class="normal">Django will create a database column for each of the model fields: <code class="inlineCode">title</code>, <code class="inlineCode">slug</code>, and <code class="inlineCode">body</code>. You can see how each field type corresponds to a database data type.</p>
<p class="normal">By default, Django adds an auto-incrementing primary key field to each model. The field type for this field is specified in each application configuration or globally in the <code class="inlineCode">DEFAULT_AUTO_FIELD</code> setting. When creating an application with the <code class="inlineCode">startapp</code> command, the default value for <code class="inlineCode">DEFAULT_AUTO_FIELD</code> is <code class="inlineCode">BigAutoField</code>. This is a 64-bit integer that automatically increments according to available IDs. If you don’t specify a primary key for your model, Django adds this field automatically. You can also define one of the model fields to be the primary key by setting <code class="inlineCode">primary_key=True</code> on it.</p>
<p class="normal">We will expand<a id="_idIndexMarker040"/> the <code class="inlineCode">Post</code> model with additional fields <a id="_idIndexMarker041"/>and behaviors. Once complete, we will synchronize it to the database by creating a database migration and applying it.</p>
<h2 class="heading-2" id="_idParaDest-37">Adding datetime fields</h2>
<p class="normal">We will continue<a id="_idIndexMarker042"/> by adding different datetime <a id="_idIndexMarker043"/>fields to the <code class="inlineCode">Post</code> model. Each post will be published at a specific date and time. Therefore, we need a field to store the publication date and time. We also want to store the date and time when the <code class="inlineCode">Post</code> object was created and when it was last modified.</p>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application to make it look like this; the new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
<strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> django.utils </strong><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> timezone</strong>
class Post(models.Model):
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250)
    body = models.TextField()
<strong class="hljs-slc">    publish = models.DateTimeField(default=timezone.now)</strong>
def __str__(self):
        return self.title
</code></pre>
<p class="normal">We have added a <code class="inlineCode">publish</code> field to the <code class="inlineCode">Post</code> model. This is a <code class="inlineCode">DateTimeField</code> field that translates into a <code class="inlineCode">DATETIME</code> column in the SQL database. We will use it to store the date and time when the post was published. We use Django’s <code class="inlineCode">timezone.now</code> method as the default value for the field. Note that we imported the <code class="inlineCode">timezone</code> module to use this method. <code class="inlineCode">timezone.now</code> returns the current datetime in a timezone-aware format. You can think of it as a timezone-aware version of the standard Python <code class="inlineCode">datetime.now</code> method.</p>
<p class="normal">Another method to<a id="_idIndexMarker044"/> define default values for model fields is<a id="_idIndexMarker045"/> using database-computed default values. Introduced in Django 5, this feature allows you to use underlaying database functions to generate default values. For instance, the following code uses the database server’s current date and time as the default for the <code class="inlineCode">publish</code> field:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
from django.db.models.functions import Now
class Post(models.Model):
    # ...
    publish = models.DateTimeField(db_default=Now())
</code></pre>
<p class="normal">To use database-generated default values, we use the <code class="inlineCode">db_default</code> attribute instead of <code class="inlineCode">default</code>. In this example, we use the <code class="inlineCode">Now</code> database function. It serves a similar purpose to <code class="inlineCode">default=timezone.now</code>, but instead of a Python-generated datetime, it uses the <code class="inlineCode">NOW()</code> database function to produce the initial value. You can read more about the <code class="inlineCode">db_default</code> attribute at <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default">https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default</a>. You can find all available database functions at <a href="https://docs.djangoproject.com/en/5.0/ref/models/database-functions/">https://docs.djangoproject.com/en/5.0/ref/models/database-functions/</a>.</p>
<p class="normal">Let’s continue with the previous version of the field:</p>
<pre class="programlisting code"><code class="hljs-code">class Post(models.Model):
    # ...
    publish = models.DateTimeField(default=timezone.now)
</code></pre>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application and add the following lines highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
from django.utils import timezone
class Post(models.Model):
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
<strong class="hljs-slc">    created = models.DateTimeField(auto_now_add=</strong><strong class="hljs-literal-slc">True</strong><strong class="hljs-slc">)</strong>
<strong class="hljs-slc">    updated = models.DateTimeField(auto_now=</strong><strong class="hljs-literal-slc">True</strong><strong class="hljs-slc">)</strong>
def __str__(self):
        return self.title
</code></pre>
<p class="normal">We have <a id="_idIndexMarker046"/>added<a id="_idIndexMarker047"/> the following fields to the <code class="inlineCode">Post</code> model:</p>
<ul>
<li class="bulletList"><code class="inlineCode">created</code>: This is a <code class="inlineCode">DateTimeField</code> field. We will use it to store the date and time when the post was created. By using <code class="inlineCode">auto_now_add</code>, the date will be saved automatically when creating an object.</li>
<li class="bulletList"><code class="inlineCode">updated</code>: This is a <code class="inlineCode">DateTimeField</code> field. We will use it to store the last date and time when the post was updated. By using <code class="inlineCode">auto_now</code>, the date will be updated automatically when saving an object.</li>
</ul>
<div><p class="normal">Utilizing the <code class="inlineCode">auto_now_add</code> and <code class="inlineCode">auto_now</code> datetime fields in your Django models is highly<a id="_idIndexMarker048"/> beneficial for tracking the creation and last modification times of objects.</p>
</div>
<h2 class="heading-2" id="_idParaDest-38">Defining a default sort order</h2>
<p class="normal">Blog posts are <a id="_idIndexMarker049"/>typically presented in reverse <a id="_idIndexMarker050"/>chronological order, showing the newest posts first. For our model, we will define a default ordering. This ordering takes effect when retrieving objects from the database unless a specific order is indicated in the query.</p>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application as shown below. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
from django.utils import timezone
class Post(models.Model):
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=True)
    updated = models.DateTimeField(auto_now=True)
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Meta</strong><strong class="hljs-slc">:</strong>
<strong class="hljs-slc">        ordering = [</strong><strong class="hljs-string-slc">'-publish'</strong><strong class="hljs-slc">]</strong>
def __str__(self):
        return self.title
</code></pre>
<p class="normal">We have added a <code class="inlineCode">Meta</code> class inside the model. This class defines metadata for the model. We use the <code class="inlineCode">ordering</code> attribute to tell Django that it should sort results by the <code class="inlineCode">publish</code> field. This ordering will apply by default for database queries when no specific order is provided in the query. We indicate descending order by using a hyphen before the field name, <code class="inlineCode">-publish</code>. Posts will be returned in reverse chronological order by default.</p>
<h2 class="heading-2" id="_idParaDest-39">Adding a database index</h2>
<p class="normal">Let’s define a<a id="_idIndexMarker051"/> database index for the <code class="inlineCode">publish</code> field. This <a id="_idIndexMarker052"/>will improve performance for query filtering or ordering results by this field. We expect many queries to take advantage of this index since we are using the <code class="inlineCode">publish</code> field to order results by default.</p>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application and make it look like this; the new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
from django.utils import timezone
class Post(models.Model):
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=True)
    updated = models.DateTimeField(auto_now=True)
    class Meta:
        ordering = ['-publish']
<strong class="hljs-slc">        indexes = [</strong>
<strong class="hljs-slc">            models.Index(fields=[</strong><strong class="hljs-string-slc">'-publish'</strong><strong class="hljs-slc">]),</strong>
<strong class="hljs-slc">        ]</strong>
def __str__(self):
        return self.title
</code></pre>
<p class="normal">We have added the <code class="inlineCode">indexes</code> option to the model’s <code class="inlineCode">Meta</code> class. This option allows you to define database indexes for your model, which could comprise one or multiple fields, in ascending or descending order, or functional expressions and database functions. We have added an index for the <code class="inlineCode">publish</code> field. We use a hyphen before the field name to define the index specifically in descending order. The creation of this index will be included in the database migrations that we will generate later for our blog models.</p>
<div><p class="normal">Index ordering is not supported on MySQL. If you use MySQL for the database, a descending index will be created as a normal index.</p>
</div>
<p class="normal">You can find <a id="_idIndexMarker053"/>more<a id="_idIndexMarker054"/> information about how to define indexes for models at <a href="https://docs.djangoproject.com/en/5.0/ref/models/indexes/">https://docs.djangoproject.com/en/5.0/ref/models/indexes/</a>.</p>
<h2 class="heading-2" id="_idParaDest-40">Activating the application</h2>
<p class="normal">We need to<a id="_idIndexMarker055"/> activate the <code class="inlineCode">blog</code> application in the project for Django to keep track of the application and be able to create database tables for its models.</p>
<p class="normal">Edit the <code class="inlineCode">settings.py</code> file and add <code class="inlineCode">blog.apps.BlogConfig</code> to the <code class="inlineCode">INSTALLED_APPS</code> setting. It should look like this; the new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
<strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'blog.apps.BlogConfig'</strong><strong class="hljs-slc">,</strong>
]
</code></pre>
<p class="normal">The <code class="inlineCode">BlogConfig</code> class is the application configuration. Now Django knows that the application is<a id="_idIndexMarker056"/> active for this project and will be able to load the application models.</p>
<h2 class="heading-2" id="_idParaDest-41">Adding a status field</h2>
<p class="normal">A common functionality <a id="_idIndexMarker057"/>for blogs is to save posts as a draft<a id="_idIndexMarker058"/> until ready for publication. We will add a <code class="inlineCode">status</code> field to our model that will allow us to manage the status of blog posts. We will be using the <em class="italic">Draft</em> and <em class="italic">Published</em> statuses for posts.</p>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application to make it look as follows. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.db import models
from django.utils import timezone
class Post(models.Model):
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Status</strong><strong class="hljs-slc">(models.TextChoices):</strong>
<strong class="hljs-slc">        DRAFT = </strong><strong class="hljs-string-slc">'DF'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'Draft'</strong>
<strong class="hljs-slc">        PUBLISHED = </strong><strong class="hljs-string-slc">'PB'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'Published'</strong>
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=True)
    updated = models.DateTimeField(auto_now=True)
<strong class="hljs-slc">    status = models.CharField(</strong>
<strong class="hljs-slc">        max_length=</strong><strong class="hljs-number-slc">2</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">        choices=Status,</strong>
<strong class="hljs-slc">        default=Status.DRAFT</strong>
<strong class="hljs-slc">    )</strong>
class Meta:
        ordering = ['-publish']
        indexes = [
            models.Index(fields=['-publish']),
        ]
    def __str__(self):
        return self.title
</code></pre>
<p class="normal">We have defined the enumeration class <code class="inlineCode">Status</code> by subclassing <code class="inlineCode">models.TextChoices</code>. The available choices for the post status are <code class="inlineCode">DRAFT</code> and <code class="inlineCode">PUBLISHED</code>. Their respective values are <code class="inlineCode">DF</code> and <code class="inlineCode">PB</code>, and their labels or readable names are <em class="italic">Draft</em> and <em class="italic">Published</em>.</p>
<p class="normal">Django provides enumeration types that you can subclass to define choices simply. These are based on the <code class="inlineCode">enum</code> object of Python’s standard library. You can read more about <code class="inlineCode">enum</code> at <a href="https://docs.python.org/3/library/enum.html">https://docs.python.org/3/library/enum.html</a>.</p>
<p class="normal">Django enumeration types present some modifications over <code class="inlineCode">enum</code>. You can learn about those differences at <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types">https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types</a>.</p>
<p class="normal">We can access <code class="inlineCode">Post.Status.choices</code> to obtain the available choices, <code class="inlineCode">Post.Status.names</code> to obtain the names of the choices, <code class="inlineCode">Post.Status.labels</code> to obtain the human-readable names, and <code class="inlineCode">Post.Status.values</code> to obtain the actual values of the choices.</p>
<p class="normal">We have also added a<a id="_idIndexMarker059"/> new <code class="inlineCode">status</code> field to the model that is an <a id="_idIndexMarker060"/>instance of <code class="inlineCode">CharField</code>. It includes a <code class="inlineCode">choices</code> parameter to limit the value of the field to the choices in <code class="inlineCode">Status</code>. We have also set a default value for the field using the <code class="inlineCode">default</code> parameter. We use <code class="inlineCode">DRAFT</code> as the default choice for this field.</p>
<div><p class="normal">It’s a good practice to define choices inside the model class and use the enumeration types. This will allow you to easily reference choice labels, values, or names from anywhere in your code. You can import the <code class="inlineCode">Post</code> model and use <code class="inlineCode">Post.Status.DRAFT</code> as a reference for the <em class="italic">Draft</em> status anywhere in your code.</p>
</div>
<p class="normal">Let’s take a look at how to interact with status choices.</p>
<p class="normal">Run the following command in the shell prompt to open the Python shell:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py shell
</code></pre>
<p class="normal">Then, type the following lines:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; from blog.models import Post
&gt;&gt;&gt; Post.Status.choices
</code></pre>
<p class="normal">You will obtain the <code class="inlineCode">enum</code> choices with value-label pairs, like this:</p>
<pre class="programlisting con"><code class="hljs-con">[('DF', 'Draft'), ('PB', 'Published')]
</code></pre>
<p class="normal">Type the following line:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.Status.labels
</code></pre>
<p class="normal">You will get the human-readable names of the <code class="inlineCode">enum</code> members, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">['Draft', 'Published']
</code></pre>
<p class="normal">Type the following line:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.Status.values
</code></pre>
<p class="normal">You will get <a id="_idIndexMarker061"/>the<a id="_idIndexMarker062"/> values of the <code class="inlineCode">enum</code> members, as follows. These are the values that can be stored in the database for the <code class="inlineCode">status</code> field:</p>
<pre class="programlisting con"><code class="hljs-con">['DF', 'PB']
</code></pre>
<p class="normal">Type the following line:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.Status.names
</code></pre>
<p class="normal">You will get the names of the choices, like this:</p>
<pre class="programlisting con"><code class="hljs-con">['DRAFT', 'PUBLISHED']
</code></pre>
<p class="normal">You can access a specific lookup enumeration member with <code class="inlineCode">Post.Status.PUBLISHED</code> and you can access its <code class="inlineCode">.name</code> and <code class="inlineCode">.value</code> properties as well.</p>
<h2 class="heading-2" id="_idParaDest-42">Adding a many-to-one relationship</h2>
<p class="normal">Posts are always <a id="_idIndexMarker063"/>written by an author. We will create a relationship between users and posts that will indicate which user wrote which posts. Django comes with an authentication framework that handles user accounts. The Django authentication framework comes in the <code class="inlineCode">django.contrib.auth</code> package and contains a <code class="inlineCode">User</code> model. To define the relationship between users and posts, we will use the <code class="inlineCode">AUTH_USER_MODEL</code> setting, which points to <code class="inlineCode">auth.User</code> by default. This setting allows you to specify a different user model for your project.</p>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of the <code class="inlineCode">blog</code> application to make it look as follows. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code"><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> django.conf </strong><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> settings</strong>
from django.db import models
from django.utils import timezone
class Post(models.Model):
    class Status(models.TextChoices):
        DRAFT = 'DF', 'Draft'
        PUBLISHED = 'PB', 'Published'
    title = models.CharField(max_length=250)
    slug = models.SlugField(max_length=250)
<strong class="hljs-slc">    author = models.ForeignKey(</strong>
<strong class="hljs-slc">        settings.AUTH_USER_MODEL,</strong>
<strong class="hljs-slc">        on_delete=models.CASCADE,</strong>
<strong class="hljs-slc">        related_name=</strong><strong class="hljs-string-slc">'blog_posts'</strong>
<strong class="hljs-slc">    )</strong>
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=True)
    updated = models.DateTimeField(auto_now=True)
    status = models.CharField(
        max_length=2,
        choices=Status,
        default=Status.DRAFT
    )
    class Meta:
        ordering = ['-publish']
        indexes = [
            models.Index(fields=['-publish']),
        ]
    def __str__(self):
        return self.title
</code></pre>
<p class="normal">We have imported the project’s settings and we have added an <code class="inlineCode">author</code> field to the <code class="inlineCode">Post</code> model. This field defines a many-to-one relationship with the default user model, meaning that each post is written by a user, and a user can write any number of posts. For this field, Django will create a foreign key in the database using the primary key of the related model.</p>
<p class="normal">The <code class="inlineCode">on_delete</code> parameter specifies the behavior to adopt when the referenced object is deleted. This is not specific to Django; it is a SQL standard. Using <code class="inlineCode">CASCADE</code>, you specify that when the referenced user is deleted, the database will also delete all related blog posts. You can take a look at all the possible options at <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.ForeignKey.on_delete">https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.ForeignKey.on_delete</a>.</p>
<p class="normal">We use <code class="inlineCode">related_name</code> to specify the name of the reverse relationship, from <code class="inlineCode">User</code> to <code class="inlineCode">Post</code>. This will allow us to access related objects easily from a user object by using the <code class="inlineCode">user.blog_posts</code> notation. We will learn more about this later.</p>
<p class="normal">Django comes with different types of fields that you can use to define your models. You can find all field <a id="_idIndexMarker064"/>types at <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/">https://docs.djangoproject.com/en/5.0/ref/models/fields/</a>.</p>
<p class="normal">The <code class="inlineCode">Post</code> model is now complete, and we can now synchronize it to the database.</p>
<h2 class="heading-2" id="_idParaDest-43">Creating and applying migrations</h2>
<p class="normal">Now that we have <a id="_idIndexMarker065"/>a data model for blog posts, we need to create the corresponding database table. Django comes with a migration system that tracks the changes made to models and enables them to propagate into the database.</p>
<p class="normal">The <code class="inlineCode">migrate</code> command applies migrations for all applications listed in <code class="inlineCode">INSTALLED_APPS</code>. It synchronizes the database with the current models and existing migrations.</p>
<p class="normal">First, we will need to create an initial migration for our <code class="inlineCode">Post</code> model.</p>
<p class="normal">Run the following command in the shell prompt from the root directory of your project:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py makemigrations blog
</code></pre>
<p class="normal">You should get an output similar to the following one:</p>
<pre class="programlisting con"><code class="hljs-con">Migrations for 'blog':
    blog/migrations/0001_initial.py
        - Create model Post
        - Create index blog_post_publish_bb7600_idx on field(s)
          -publish of model post
</code></pre>
<p class="normal">Django just created the <code class="inlineCode">0001_initial.py</code> file inside the <code class="inlineCode">migrations</code> directory of the <code class="inlineCode">blog</code> application. This migration contains the SQL statements to create the database table for the <code class="inlineCode">Post</code> model and the definition of the database index for the <code class="inlineCode">publish</code> field.</p>
<p class="normal">You can take a look at the file contents to see how the migration is defined. A migration specifies dependencies on other migrations and operations to perform in the database to synchronize it with model changes.</p>
<p class="normal">Let’s take a look at the SQL code that Django will execute in the database to create the table for your model. The <code class="inlineCode">sqlmigrate</code> command takes the migration names and returns their SQL without executing it.</p>
<p class="normal">Run the following<a id="_idIndexMarker066"/> command from the shell prompt to inspect the SQL output of your first migration:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py sqlmigrate blog 0001
</code></pre>
<p class="normal">The output should look as follows:</p>
<pre class="programlisting con"><code class="hljs-con">BEGIN;
--
-- Create model Post
--
CREATE TABLE "blog_post" (
  "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT,
  "title" varchar(250) NOT NULL,
  "slug" varchar(250) NOT NULL,
  "body" text NOT NULL,
  "publish" datetime NOT NULL,
  "created" datetime NOT NULL,
  "updated" datetime NOT NULL,
  "status" varchar(10) NOT NULL,
  "author_id" integer NOT NULL REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create blog_post_publish_bb7600_idx on field(s) -publish of model post
--
CREATE INDEX "blog_post_publish_bb7600_idx" ON "blog_post" ("publish" DESC);
CREATE INDEX "blog_post_slug_b95473f2" ON "blog_post" ("slug");
CREATE INDEX "blog_post_author_id_dd7a8485" ON "blog_post" ("author_id");
COMMIT;
</code></pre>
<p class="normal">The exact output depends on the database you are using. The preceding output is generated for SQLite. As you can see in the output, Django generates the table names by combining the application name and the lowercase name of the model (<code class="inlineCode">blog_post</code>), but you can also specify a custom database name for your model in the <code class="inlineCode">Meta</code> class of the model using the <code class="inlineCode">db_table</code> attribute.</p>
<p class="normal">Django creates an auto-incremental <code class="inlineCode">id</code> column that is used as the primary key for each model, but you can also override this by specifying <code class="inlineCode">primary_key=True</code> on one of your model fields. The default <code class="inlineCode">id</code> column consists of an integer that is incremented automatically. This <a id="_idIndexMarker067"/>column corresponds to the <code class="inlineCode">id</code> field that is automatically added to your model.</p>
<p class="normal">The following three database indexes are created:</p>
<ul>
<li class="bulletList">An index in descending order on the <code class="inlineCode">publish</code> column. This is the index we explicitly defined with the <code class="inlineCode">indexes</code> option of the model’s <code class="inlineCode">Meta</code> class.</li>
<li class="bulletList">An index on the <code class="inlineCode">slug</code> column because <code class="inlineCode">SlugField</code> fields imply an index by default.</li>
<li class="bulletList">An index on the <code class="inlineCode">author_id</code> column because <code class="inlineCode">ForeignKey</code> fields imply an index by default.</li>
</ul>
<p class="normal">Let’s compare the <code class="inlineCode">Post</code> model with its corresponding database <code class="inlineCode">blog_post</code> table:</p>
<figure class="mediaobject"><img alt="Table  Description automatically generated with medium confidence" src="img/B21088_01_06.png"/></figure>
<p class="packt_figref">Figure 1.6: Complete Post model and database table correspondence</p>
<p class="normal"><em class="italic">Figure 1.6</em> shows how the model fields correspond to database table columns.</p>
<p class="normal">Let’s sync the database with the new model.</p>
<p class="normal">Execute the following command in the shell prompt to apply the existing migrations:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py migrate
</code></pre>
<p class="normal">You will get an output that ends with the following line:</p>
<pre class="programlisting con"><code class="hljs-con">Applying blog.0001_initial... OK
</code></pre>
<p class="normal">We just applied migrations for the applications listed in <code class="inlineCode">INSTALLED_APPS</code>, including the <code class="inlineCode">blog</code> application. After applying the migrations, the database reflects the current status of the models.</p>
<p class="normal">If you edit the <code class="inlineCode">models.py</code> file in order to add, remove, or change the fields of existing models, or if you <a id="_idIndexMarker068"/>add new models, you will have to create a new migration using the <code class="inlineCode">makemigrations</code> command. Each migration allows Django to keep track of model changes. Then, you will have to apply the migration using the <code class="inlineCode">migrate</code> command to keep the database in sync with your models.</p>
<h1 class="heading-1" id="_idParaDest-44">Creating an administration site for models</h1>
<p class="normal">Now that the <code class="inlineCode">Post</code> model is <a id="_idIndexMarker069"/>in sync with the database, we can create a simple administration site to manage blog posts.</p>
<p class="normal">Django comes with a built-in administration interface that is very useful for editing content. The Django site is built dynamically by reading the model metadata and providing a production-ready interface for editing content. You can use it out of the box, configuring how you want your models to be displayed in it.</p>
<p class="normal">The <code class="inlineCode">django.contrib.admin</code> application is already included in the <code class="inlineCode">INSTALLED_APPS</code> setting, so you don’t need to add it.</p>
<h2 class="heading-2" id="_idParaDest-45">Creating a superuser</h2>
<p class="normal">First, you will need to <a id="_idIndexMarker070"/>create a user to manage the administration site. Run the following command:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py createsuperuser
</code></pre>
<p class="normal">You will see the following output. Enter your desired username, email, and password, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">Username (leave blank to use 'admin'): admin
Email address: admin@admin.com
Password: ********
Password (again): ********
</code></pre>
<p class="normal">Then, you will see the following success message:</p>
<pre class="programlisting con"><code class="hljs-con">Superuser created successfully.
</code></pre>
<p class="normal">We just created an administrator user with the highest permissions.</p>
<h2 class="heading-2" id="_idParaDest-46">The Django administration site</h2>
<p class="normal">Start the <a id="_idIndexMarker071"/>development server with the following command:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py runserver
</code></pre>
<p class="normal">Open <code class="inlineCode">http://127.0.0.1:8000/admin/</code> in your browser. You should see the administration login page, as shown in <em class="italic">Figure 1.7</em>:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_07.png"/></figure>
<p class="packt_figref">Figure 1.7: The Django administration site login screen</p>
<p class="normal">Log in using the<a id="_idIndexMarker072"/> credentials of the user you created in the preceding step. You will see the administration site index page, as shown in <em class="italic">Figure 1.8</em>:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_08.png"/></figure>
<p class="packt_figref">Figure 1.8: The Django administration site index page</p>
<p class="normal">The <code class="inlineCode">Group</code> and <code class="inlineCode">User</code> models that you can see in the preceding screenshot are part of the Django authentication framework located in <code class="inlineCode">django.contrib.auth</code>. If you click on <strong class="keyWord">Users</strong>, you will see<a id="_idIndexMarker073"/> the user you created previously.</p>
<h2 class="heading-2" id="_idParaDest-47">Adding models to the administration site</h2>
<p class="normal">Let’s add your blog <a id="_idIndexMarker074"/>models to the administration <a id="_idIndexMarker075"/>site. Edit the <code class="inlineCode">admin.py</code> file of the <code class="inlineCode">blog</code> application and make it look like this; the new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.contrib import admin
<strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> .models </strong><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> Post</strong>
<strong class="hljs-slc">admin.site.register(Post)</strong>
</code></pre>
<p class="normal">Now, reload the administration site in your browser. You should see your <code class="inlineCode">Post</code> model on the site, as follows:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_09.png"/></figure>
<p class="packt_figref">Figure 1.9: The Post model of the blog application included in the Django administration site index page</p>
<p class="normal">That was easy, right? When you register a model in the Django administration site, you get a user-friendly interface generated by introspecting your models that allows you to list, edit, create, and delete objects in a simple way.</p>
<p class="normal">Click on the <strong class="screenText">Add</strong> link beside <strong class="screenText">Posts</strong> to add a new post. You will note the form that Django has generated dynamically for your model, as shown in <em class="italic">Figure 1.10</em>:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_10.png"/></figure>
<p class="packt_figref">Figure 1.10: The Django administration site edit form for the Post model</p>
<p class="normal">Django uses<a id="_idIndexMarker076"/> different <a id="_idIndexMarker077"/>form widgets for each type of field. Even complex fields, such as <code class="inlineCode">DateTimeField</code>, are displayed with an easy interface, such as a JavaScript date picker.</p>
<p class="normal">Fill in the form and click on the <strong class="screenText">SAVE</strong> button. You should be redirected to the post list page with a success message and the post you just created, as shown in <em class="italic">Figure 1.11</em>:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_11.png"/></figure>
<p class="packt_figref">Figure 1.11: The Django administration site list view for the Post model with an added successfully message</p>
<h2 class="heading-2" id="_idParaDest-48">Customizing how models are displayed</h2>
<p class="normal">Now, we will <a id="_idIndexMarker078"/>take a look at how to customize the administration site.</p>
<p class="normal">Edit the <code class="inlineCode">admin.py</code> file of your <code class="inlineCode">blog</code> application and change it, as follows. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.contrib import admin
from .models import Post
<strong class="hljs-meta-slc">@admin.register(</strong><strong class="hljs-params-slc">Post</strong><strong class="hljs-meta-slc">)</strong>
<strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">PostAdmin</strong><strong class="hljs-slc">(admin.ModelAdmin):</strong>
<strong class="hljs-slc">    list_display = [</strong><strong class="hljs-string-slc">'title'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'slug'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'author'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'publish'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'status'</strong><strong class="hljs-slc">]</strong>
</code></pre>
<p class="normal">We are telling the Django administration site that the model is registered in the site using a custom class that inherits from <code class="inlineCode">ModelAdmin</code>. In this class, we can include information about how to display the model on the administration site and how to interact with it.</p>
<p class="normal">The <code class="inlineCode">list_display</code> attribute allows you to set the fields of your model that you want to display on the administration object list page. The <code class="inlineCode">@admin.register()</code> decorator performs the same function as the <code class="inlineCode">admin.site.register()</code> function that you replaced, registering the <code class="inlineCode">ModelAdmin</code> class that it decorates.</p>
<p class="normal">Let’s customize the <code class="inlineCode">admin</code> model with some more options.</p>
<p class="normal">Edit the <code class="inlineCode">admin.py</code> file of your <code class="inlineCode">blog</code> application and change it, as follows. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.contrib import admin
from .models import Post
@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['title', 'slug', 'author', 'publish', 'status']
<strong class="hljs-slc">    list_filter = [</strong><strong class="hljs-string-slc">'status'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'created'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'publish'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'author'</strong><strong class="hljs-slc">]</strong>
<strong class="hljs-slc">    search_fields = [</strong><strong class="hljs-string-slc">'</strong><strong class="hljs-string-slc">title'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'body'</strong><strong class="hljs-slc">]</strong>
<strong class="hljs-slc">    prepopulated_fields = {</strong><strong class="hljs-string-slc">'slug'</strong><strong class="hljs-slc">: (</strong><strong class="hljs-string-slc">'title'</strong><strong class="hljs-slc">,)}</strong>
<strong class="hljs-slc">    raw_id_fields = [</strong><strong class="hljs-string-slc">'author'</strong><strong class="hljs-slc">]</strong>
<strong class="hljs-slc">    date_hierarchy = </strong><strong class="hljs-string-slc">'publish'</strong>
<strong class="hljs-slc">    ordering = [</strong><strong class="hljs-string-slc">'status'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'publish'</strong><strong class="hljs-slc">]</strong>
</code></pre>
<p class="normal">Return to your <a id="_idIndexMarker079"/>browser and reload the post list page. Now, it will look like this:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_12.png"/></figure>
<p class="packt_figref">Figure 1.12: The Django administration site custom list view for the Post model</p>
<p class="normal">You can see that the fields displayed on the post list page are the ones we specified in the <code class="inlineCode">list_display</code> attribute. The list page now includes a right sidebar that allows you to filter the results by the fields included in the <code class="inlineCode">list_filter</code> attribute. Filters for <code class="inlineCode">ForeignKey</code> fields like <code class="inlineCode">author</code> are only displayed in the sidebar if more than one object exists in the database.</p>
<p class="normal">A search bar has appeared on the page. This is because we have defined a list of searchable fields using the <code class="inlineCode">search_fields</code> attribute. Just below the search bar, there are navigation links to navigate through a date hierarchy; this has been defined by the <code class="inlineCode">date_hierarchy</code> attribute. You can also see that the posts are ordered by <strong class="screenText">STATUS</strong> and <strong class="screenText">PUBLISH</strong> columns by default. We have specified the default sorting criteria using the <code class="inlineCode">ordering</code> attribute.</p>
<p class="normal">Next, click on the <strong class="screenText">ADD POST</strong> link. You will also note some changes here. As you type the title of a new post, the <code class="inlineCode">slug</code> field is filled in automatically. You have told Django to prepopulate the <code class="inlineCode">slug</code> field with the input of the <code class="inlineCode">title</code> field using the <code class="inlineCode">prepopulated_fields</code> attribute:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_13.png"/></figure>
<p class="packt_figref">Figure 1.13: The slug model is now automatically prepopulated as you type in the title</p>
<p class="normal">Also, the <code class="inlineCode">author</code> field is<a id="_idIndexMarker080"/> now displayed with a lookup widget, which can be much better than an input selection drop-down when you have thousands of users. This is achieved with the <code class="inlineCode">raw_id_fields</code> attribute and it looks like this:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_14.png"/></figure>
<p class="packt_figref">Figure 1.14: The widget to select related objects for the Author field of the Post model</p>
<h2 class="heading-2" id="_idParaDest-49">Adding facet counts to filters</h2>
<p class="normal">Django 5.0 introduces <a id="_idIndexMarker081"/>facet filters to the <a id="_idIndexMarker082"/>administration site, showcasing facet counts. These counts indicate the number of objects corresponding to each specific filter, making it easier to identify matching objects in the admin changelist view. Next, we are going to make sure facet filters are always displayed for the <code class="inlineCode">PostAdmin</code> admin model.</p>
<p class="normal">Edit the <code class="inlineCode">admin.py</code> file of your <code class="inlineCode">blog</code> application and add the following line highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.contrib import admin
from .models import Post
@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['title', 'slug', 'author', 'publish', 'status']
    list_filter = ['status', 'created', 'publish', 'author']
    search_fields = ['title', 'body']
    prepopulated_fields = {'slug': ('title',)}
    raw_id_fields = ['author']
    date_hierarchy = 'publish'
    ordering = ['status', 'publish']
<strong class="hljs-slc">    show_facets = admin.ShowFacets.ALWAYS</strong>
</code></pre>
<p class="normal">Create some posts using the administration site and access <code class="inlineCode">http://127.0.0.1:8000/admin/blog/post/</code>. The filters should now include total facet counts, as shown in <em class="italic">Figure 1.15</em>:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_15.png"/></figure>
<p class="packt_figref">Figure 1.15: Status field filters including facet counts</p>
<p class="normal">With a few lines of code, we have customized the way the model is displayed on the administration site. There are plenty of ways to customize and extend the Django administration site; you will learn more about these later in this book.</p>
<p class="normal">You can find <a id="_idIndexMarker083"/>more<a id="_idIndexMarker084"/> information about the Django administration site at <a href="https://docs.djangoproject.com/en/5.0/ref/contrib/admin/">https://docs.djangoproject.com/en/5.0/ref/contrib/admin/</a>.</p>
<h1 class="heading-1" id="_idParaDest-50">Working with QuerySets and managers</h1>
<p class="normal">Now that we<a id="_idIndexMarker085"/> have<a id="_idIndexMarker086"/> a fully functional administration site to manage blog posts, it is a good time to learn how to read and write content to the database programmatically.</p>
<p class="normal">The Django <strong class="keyWord">object-relational mapper</strong> (<strong class="keyWord">ORM</strong>) is a<a id="_idIndexMarker087"/> powerful database abstraction API that lets you create, retrieve, update, and delete objects easily. An ORM allows you to generate SQL queries using the object-oriented paradigm of Python. You can think of it as a way to interact with your database in a Pythonic fashion instead of writing raw SQL queries.</p>
<p class="normal">The ORM maps your models to database tables and provides you with a simple Pythonic interface to interact with your database. The ORM generates SQL queries and maps the results to model objects. The Django ORM is compatible with MySQL, PostgreSQL, SQLite, Oracle, and MariaDB.</p>
<p class="normal">Remember that you can define the database of your project in the <code class="inlineCode">DATABASES</code> setting of your project’s <code class="inlineCode">settings.py</code> file. Django can work with multiple databases at a time, and you can program database routers to create custom data routing schemes.</p>
<p class="normal">Once you have created your data models, Django gives you a free API to interact with them. You can find the model API reference of the official documentation at <a href="https://docs.djangoproject.com/en/5.0/ref/models/">https://docs.djangoproject.com/en/5.0/ref/models/</a>.</p>
<p class="normal">The Django ORM is based on QuerySets. A QuerySet is a collection of database queries to retrieve objects from your database. You can apply filters to QuerySets to narrow down the query results based on given parameters. The QuerySet equates to a <code class="inlineCode">SELECT</code> SQL statement and the filters are limiting SQL clauses such as <code class="inlineCode">WHERE</code> or <code class="inlineCode">LIMIT</code>.</p>
<p class="normal">Next, you are going to learn how to build and execute QuerySets.</p>
<h2 class="heading-2" id="_idParaDest-51">Creating objects</h2>
<p class="normal">Run the following <a id="_idIndexMarker088"/>command in the shell prompt to open the <a id="_idIndexMarker089"/>Python shell:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py shell
</code></pre>
<p class="normal">Then, type the following lines:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; from django.contrib.auth.models import User
&gt;&gt;&gt; from blog.models import Post
&gt;&gt;&gt; user = User.objects.get(username='admin')
&gt;&gt;&gt; post = Post(title='Another post',
...             slug='another-post',
...             body='Post body.',
...             author=user)
&gt;&gt;&gt; post.save()
</code></pre>
<p class="normal">Let’s analyze what this code does.</p>
<p class="normal">First, we are retrieving the <code class="inlineCode">user</code> object with the username <code class="inlineCode">admin</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; user = User.objects.get(username='admin')
</code></pre>
<p class="normal">The <code class="inlineCode">get()</code> method allows us to retrieve a single object from the database. This method executes a <code class="inlineCode">SELECT</code> SQL statement behind the scenes. Note that this method expects a result that matches the query. If no results are returned by the database, this method will raise a <code class="inlineCode">DoesNotExist</code> exception, and if the database returns more than one result, it will raise a <code class="inlineCode">MultipleObjectsReturned</code> exception. Both exceptions are attributes of the model class that the query is being performed on.</p>
<p class="normal">Then, we create a <code class="inlineCode">Post</code> instance with a custom title, slug, and body, and set the user that we previously retrieved as the author of the post:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; post = Post(title='Another post', slug='another-post', body='Post body.', author=user)
</code></pre>
<p class="normal">This object is in memory and not persisted to the database; we created a Python object that can be used during runtime but is not saved into the database.</p>
<p class="normal">Finally, we are saving the <code class="inlineCode">Post</code> object in the database using the <code class="inlineCode">save()</code> method:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; post.save()
</code></pre>
<p class="normal">This action performs an <code class="inlineCode">INSERT</code> SQL statement behind the scenes.</p>
<p class="normal">We created an object in memory first and then persisted it to the database. However, you can create the object and persist it to the database in a single operation using the <code class="inlineCode">create()</code> method, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.create(title='One more post',
                    slug='one-more-post',
                    body='Post body.',
                    author=user)
</code></pre>
<p class="normal">In certain situations, you might need to fetch an object from the database or create it if it’s absent. The <code class="inlineCode">get_or_create()</code> method facilitates this by either retrieving an object or creating it if not found. This method returns a tuple with the object retrieved and a Boolean indicating whether a new object was created. The following code attempts to retrieve a <code class="inlineCode">User</code> object <a id="_idIndexMarker090"/>with the username <code class="inlineCode">user2</code>, and if it doesn’t exist, it<a id="_idIndexMarker091"/> will create one:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; user, created = User.objects.get_or_create(username='user2')
</code></pre>
<h2 class="heading-2" id="_idParaDest-52">Updating objects</h2>
<p class="normal">Now, change the<a id="_idIndexMarker092"/> title of the previous <code class="inlineCode">Post</code> object to something<a id="_idIndexMarker093"/> different and save the object again:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; post.title = 'New title'
&gt;&gt;&gt; post.save()
</code></pre>
<p class="normal">This time, the <code class="inlineCode">save()</code> method performs an <code class="inlineCode">UPDATE</code> SQL statement.</p>
<div><p class="normal">The changes you make to a model object are not persisted to the database until you call the <code class="inlineCode">save()</code> method.</p>
</div>
<h2 class="heading-2" id="_idParaDest-53">Retrieving objects</h2>
<p class="normal">You already<a id="_idIndexMarker094"/> know<a id="_idIndexMarker095"/> how to retrieve a single object from the database using the <code class="inlineCode">get()</code> method. We accessed this method using <code class="inlineCode">Post.objects.get()</code>. Each Django model has at least one manager, and the default manager is called <code class="inlineCode">objects</code>. You get a QuerySet object using your model manager.</p>
<p class="normal">To retrieve all objects from a table, we use the <code class="inlineCode">all()</code> method on the default <code class="inlineCode">objects</code> manager, like this:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; all_posts = Post.objects.all()
</code></pre>
<p class="normal">This is how we create a QuerySet that returns all objects in the database. Note that this QuerySet has not been executed yet. Django QuerySets are <em class="italic">lazy</em>, which means they are only evaluated when they are forced to. This behavior makes QuerySets very efficient. If you don’t assign the QuerySet to a variable but, instead, write it directly on the Python shell, the SQL statement<a id="_idIndexMarker096"/> of the QuerySet is executed because<a id="_idIndexMarker097"/> you are forcing it to generate output:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.all()
&lt;QuerySet [&lt;Post: Who was Django Reinhardt?&gt;, &lt;Post: New title&gt;]&gt;
</code></pre>
<h2 class="heading-2" id="_idParaDest-54">Filtering objects</h2>
<p class="normal">To filter a QuerySet, you <a id="_idIndexMarker098"/>can use the <code class="inlineCode">filter()</code> method of the <a id="_idIndexMarker099"/>manager. This method allows you to specify the content of a SQL <code class="inlineCode">WHERE</code> clause by using field lookups.</p>
<p class="normal">For example, you can use the following to filter <code class="inlineCode">Post</code> objects by their <code class="inlineCode">title</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title='Who was Django Reinhardt?')
</code></pre>
<p class="normal">This QuerySet will return all posts with the exact title <em class="italic">Who was Django Reinhardt?</em>. Let’s review the SQL statement generated with this QuerySet. Run the following code in the shell:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; posts = Post.objects.filter(title='Who was Django Reinhardt?')
&gt;&gt;&gt; print(posts.query)
</code></pre>
<p class="normal">By printing the <code class="inlineCode">query</code> attribute of the QuerySet, we can get the SQL produced by it:</p>
<pre class="programlisting con"><code class="hljs-con">SELECT "blog_post"."id", "blog_post"."title", "blog_post"."slug", "blog_post"."author_id", "blog_post"."body", "blog_post"."publish", "blog_post"."created", "blog_post"."updated", "blog_post"."status" FROM "blog_post" WHERE "blog_post"."title" = Who was Django Reinhardt? ORDER BY "blog_post"."publish" DESC
</code></pre>
<p class="normal">The generated <code class="inlineCode">WHERE</code> clause performs an exact match on the <code class="inlineCode">title</code> column. The <code class="inlineCode">ORDER BY</code> clause specifies the default order defined in the <code class="inlineCode">ordering</code> attribute of the <code class="inlineCode">Post</code> model’s <code class="inlineCode">Meta</code> options since we haven’t provided any specific ordering in the QuerySet. You will learn about<a id="_idIndexMarker100"/> ordering in a bit. Note that the <code class="inlineCode">query</code> attribute is <a id="_idIndexMarker101"/>not part of the QuerySet public API.</p>
<h2 class="heading-2" id="_idParaDest-55">Using field lookups</h2>
<p class="normal">The <a id="_idIndexMarker102"/>previous QuerySet example consists of a filter lookup with an exact match. The QuerySet interface provides you with multiple lookup <a id="_idIndexMarker103"/>types. Two underscores are used to define the lookup type, with the format <code class="inlineCode">field__lookup</code>. For example, the following lookup produces an exact match:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id__exact=1)
</code></pre>
<p class="normal">When no specific lookup type is provided, the lookup type is assumed to be <code class="inlineCode">exact</code>. The following lookup is equivalent to the previous one:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id=1)
</code></pre>
<p class="normal">Let’s take a look at other common lookup types. You can generate a case-insensitive lookup with <code class="inlineCode">iexact</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title__iexact='who was django reinhardt?')
</code></pre>
<p class="normal">You can also filter objects using a containment test. The <code class="inlineCode">contains</code> lookup translates to a SQL lookup using the <code class="inlineCode">LIKE</code> operator:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title__contains='Django')
</code></pre>
<p class="normal">The equivalent SQL clause is <code class="inlineCode">WHERE title LIKE '%Django%'</code>. A case-insensitive version is also available, named <code class="inlineCode">icontains</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title__icontains='django')
</code></pre>
<p class="normal">You can check for a given iterable (often a list, tuple, or another QuerySet object) with the <code class="inlineCode">in</code> lookup. The following example retrieves posts with an <code class="inlineCode">id</code> that is <code class="inlineCode">1</code> or <code class="inlineCode">3</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id__in=[1, 3])
</code></pre>
<p class="normal">The following example shows the greater than (<code class="inlineCode">gt</code>) lookup:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id__gt=3)
</code></pre>
<p class="normal">The equivalent SQL clause is <code class="inlineCode">WHERE ID &gt; 3</code>.</p>
<p class="normal">This example shows the greater than or equal to lookup:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id__gte=3)
</code></pre>
<p class="normal">This one shows the less than lookup:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id__lt=3)
</code></pre>
<p class="normal">This shows the less than or equal to lookup:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id__lte=3)
</code></pre>
<p class="normal">A case-sensitive/insensitive starts-with lookup can be performed with the <code class="inlineCode">startswith</code> and <code class="inlineCode">istartswith</code> lookup types, respectively:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title__istartswith='who')
</code></pre>
<p class="normal">A case-sensitive/insensitive ends-with lookup can be performed with the <code class="inlineCode">endswith</code> and <code class="inlineCode">iendswith</code> lookup types, respectively:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title__iendswith='reinhardt?')
</code></pre>
<p class="normal">There are also <a id="_idIndexMarker104"/>different lookup types for date lookups. An <a id="_idIndexMarker105"/>exact date lookup can be performed as follows:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; from datetime import date
&gt;&gt;&gt; Post.objects.filter(publish__date=date(2024, 1, 31))
</code></pre>
<p class="normal">This shows how to filter a <code class="inlineCode">DateField</code> or <code class="inlineCode">DateTimeField</code> field by year:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__year=2024)
</code></pre>
<p class="normal">You can also filter by month:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__month=1)
</code></pre>
<p class="normal">And you can filter by day:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__day=1)
</code></pre>
<p class="normal">You can chain additional lookups to <code class="inlineCode">date</code>, <code class="inlineCode">year</code>, <code class="inlineCode">month</code>, and <code class="inlineCode">day</code>. For example, here is a lookup for a value greater than a given date:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__date__gt=date(2024, 1, 1))
</code></pre>
<p class="normal">To lookup related object fields, you also use the two-underscores notation. For example, to retrieve the posts written by the user with the <code class="inlineCode">admin</code> username, use the following:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(author__username='admin')
</code></pre>
<p class="normal">You can also chain additional lookups for the related fields. For example, to retrieve posts written by any user with a username that starts with <code class="inlineCode">ad</code>, use the following:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(author__username__starstwith='ad')
</code></pre>
<p class="normal">You can also filter by multiple fields. For example, the following QuerySet retrieves all posts published <a id="_idIndexMarker106"/>in 2024 by<a id="_idIndexMarker107"/> the author with the username <code class="inlineCode">admin</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__year=2024, author__username='admin')
</code></pre>
<h2 class="heading-2" id="_idParaDest-56">Chaining filters</h2>
<p class="normal">The result of a filtered<a id="_idIndexMarker108"/> QuerySet is another QuerySet object. This allows you to chain QuerySets together. You can build an equivalent QuerySet to the previous one by chaining multiple filters:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__year=2024) \
&gt;&gt;&gt;             .filter(author__username='admin')
</code></pre>
<h2 class="heading-2" id="_idParaDest-57">Excluding objects</h2>
<p class="normal">You can exclude<a id="_idIndexMarker109"/> certain results from your QuerySet by using<a id="_idIndexMarker110"/> the <code class="inlineCode">exclude()</code> method<a id="_idIndexMarker111"/> of the manager. For example, you can retrieve all posts published in 2024 whose titles don’t start with <code class="inlineCode">Why</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(publish__year=2024) \
&gt;&gt;&gt;             .exclude(title__startswith='Why')
</code></pre>
<h2 class="heading-2" id="_idParaDest-58">Ordering objects</h2>
<p class="normal">The default<a id="_idIndexMarker112"/> order<a id="_idIndexMarker113"/> is defined in the <code class="inlineCode">ordering</code> option of the model’s <code class="inlineCode">Meta</code>. You can override the default ordering using the <code class="inlineCode">order_by()</code> method of the manager. For example, you can retrieve all objects ordered by their <code class="inlineCode">title</code>, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.order_by('title')
</code></pre>
<p class="normal">Ascending order is implied. You can indicate descending order with a negative sign prefix, like this:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.order_by('-title')
</code></pre>
<p class="normal">You can order by multiple fields. The following example orders objects by <code class="inlineCode">author</code> first and then <code class="inlineCode">title</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.order_by('author', 'title')
</code></pre>
<p class="normal">To order <a id="_idIndexMarker114"/>randomly, use<a id="_idIndexMarker115"/> the string <code class="inlineCode">'?'</code>, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.order_by('?')
</code></pre>
<h2 class="heading-2" id="_idParaDest-59">Limiting QuerySets</h2>
<p class="normal">You can limit a QuerySet to a<a id="_idIndexMarker116"/> certain number of results by using a subset of Python’s array-slicing syntax. For example, the following QuerySet limits the results to 5 objects:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.all()[:5]
</code></pre>
<p class="normal">This translates to a SQL <code class="inlineCode">LIMIT 5</code> clause. Note that negative indexing is not supported.</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.all()[3:6]
</code></pre>
<p class="normal">The preceding translates to a SQL <code class="inlineCode">OFFSET 3 LIMIT 6</code> clause, to return the fourth through sixth objects.</p>
<p class="normal">To retrieve a single object, you can use an index instead of a slice. For example, use the following to retrieve the first object of posts in random order:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.order_by('?')[0]
</code></pre>
<h2 class="heading-2" id="_idParaDest-60">Counting objects</h2>
<p class="normal">The <code class="inlineCode">count()</code> method counts<a id="_idIndexMarker117"/> the total number of objects matching<a id="_idIndexMarker118"/> the QuerySet and returns an integer. This method translates to a <code class="inlineCode">SELECT COUNT(*)</code> SQL statement. The following example returns the total number of posts with an <code class="inlineCode">id</code> lower than <code class="inlineCode">3</code>:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(id_lt=3).count()
2
</code></pre>
<h2 class="heading-2" id="_idParaDest-61">Checking if an object exists</h2>
<p class="normal">The <code class="inlineCode">exists()</code> method<a id="_idIndexMarker119"/> allows you to check if a QuerySet contains <a id="_idIndexMarker120"/>any results. This method returns <code class="inlineCode">True</code> if the QuerySet contains any items and <code class="inlineCode">False</code> otherwise. For example, you can check if there are any posts with a <code class="inlineCode">title</code> that starts with <em class="italic">Why</em> using the following QuerySet:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; Post.objects.filter(title__startswith='Why').exists()
False
</code></pre>
<h2 class="heading-2" id="_idParaDest-62">Deleting objects</h2>
<p class="normal">If you want to <a id="_idIndexMarker121"/>delete an object, you can do it from an object<a id="_idIndexMarker122"/> instance using the <code class="inlineCode">delete()</code> method, as follows:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; post = Post.objects.get(id=1)
&gt;&gt;&gt; post.delete()
</code></pre>
<p class="normal">Note that deleting objects will also delete any dependent relationships for <code class="inlineCode">ForeignKey</code> objects defined with <code class="inlineCode">on_delete</code> set to <code class="inlineCode">CASCADE</code>.</p>
<h2 class="heading-2" id="_idParaDest-63">Complex lookups with Q objects</h2>
<p class="normal">Field lookups <a id="_idIndexMarker123"/>using <code class="inlineCode">filter()</code> are joined with<a id="_idIndexMarker124"/> a SQL <code class="inlineCode">AND</code> operator. For example, <code class="inlineCode">filter(field1='foo</code> <code class="inlineCode">', field2='bar')</code> will retrieve objects where <code class="inlineCode">field1</code> is <em class="italic">foo</em> <strong class="keyWord">and</strong> <code class="inlineCode">field2</code> is <em class="italic">bar</em>. If you need to build more complex queries, such as queries with <code class="inlineCode">OR</code> statements, you can use <code class="inlineCode">Q</code> objects.</p>
<p class="normal">A <code class="inlineCode">Q</code> object allows you to encapsulate a collection of field lookups. You can compose statements by combining <code class="inlineCode">Q</code> objects with the <code class="inlineCode">&amp;</code> (and), <code class="inlineCode">|</code> (or), and <code class="inlineCode">^</code> (xor) operators.</p>
<p class="normal">For example, the following code retrieves posts with a title that starts with the string <em class="italic">who</em> <strong class="keyWord">or</strong> <em class="italic">why</em> (case-insensitive):</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; from django.db.models import Q
&gt;&gt;&gt; starts_who = Q(title__istartswith='who')
&gt;&gt;&gt; starts_why = Q(title__istartswith='why')
&gt;&gt;&gt; Post.objects.filter(starts_who | starts_why)
</code></pre>
<p class="normal">In this case, we use the <code class="inlineCode">|</code> operator to build an <code class="inlineCode">OR</code> statement.</p>
<p class="normal">You can<a id="_idIndexMarker125"/> read<a id="_idIndexMarker126"/> more about <code class="inlineCode">Q</code> objects at <a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects">https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects</a>.</p>
<h2 class="heading-2" id="_idParaDest-64">When QuerySets are evaluated</h2>
<p class="normal">Creating a QuerySet <a id="_idIndexMarker127"/>doesn’t involve any database activity until it is evaluated. QuerySets will usually return another unevaluated QuerySet. You can concatenate as many filters as you like to a QuerySet, and you will not hit the database until the QuerySet is evaluated. When a QuerySet is evaluated, it translates into a SQL query to the database.</p>
<p class="normal">QuerySets are only evaluated in the following cases:</p>
<ul>
<li class="bulletList">The first time you iterate over them</li>
<li class="bulletList">When you slice them, for instance, <code class="inlineCode">Post.objects.all()[:3]</code></li>
<li class="bulletList">When you pickle or cache them</li>
<li class="bulletList">When you call <code class="inlineCode">repr()</code> or <code class="inlineCode">len()</code> on them</li>
<li class="bulletList">When you explicitly call <code class="inlineCode">list()</code> on them</li>
<li class="bulletList">When you test them in a statement, such as <code class="inlineCode">bool()</code>, <code class="inlineCode">or</code>, <code class="inlineCode">and</code>, or <code class="inlineCode">if</code></li>
</ul>
<h2 class="heading-2" id="_idParaDest-65">More on QuerySets</h2>
<p class="normal">You will use<a id="_idIndexMarker128"/> QuerySets in all the project examples featured in this book. You will learn how to generate aggregates over QuerySets in the <em class="italic">Retrieving posts by similarity</em> section of <em class="italic">Chapter 3, Extending Your Blog Application</em>.</p>
<p class="normal">You will learn how to optimize QuerySets in the <em class="italic">Optimizing QuerySets that involve related objects</em> section in <em class="italic">Chapter 7, Tracking User Actions</em>.</p>
<p class="normal">The QuerySet API reference is located at <a href="https://docs.djangoproject.com/en/5.0/ref/models/querysets/">https://docs.djangoproject.com/en/5.0/ref/models/querysets/</a>.</p>
<p class="normal">You can read more about making queries with the Django ORM at <a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/">https://docs.djangoproject.com/en/5.0/topics/db/queries/</a>.</p>
<h2 class="heading-2" id="_idParaDest-66">Creating model managers</h2>
<p class="normal">The default manager <a id="_idIndexMarker129"/>for every model is the <code class="inlineCode">objects</code> manager. This manager retrieves all the objects in the database. However, we can define custom managers for models.</p>
<p class="normal">Let’s create a custom manager to retrieve all posts that have a <code class="inlineCode">PUBLISHED</code> status.</p>
<p class="normal">There are two ways to add or customize managers for your models: you can add extra manager methods to an existing manager or create a new manager by modifying the initial QuerySet that the manager returns. The first method provides you with a QuerySet notation like <code class="inlineCode">Post.objects.my_manager()</code>, and the latter provides you with a QuerySet notation like <code class="inlineCode">Post.my_manager.all()</code>.</p>
<p class="normal">We will choose the second method to implement a manager that will allow us to retrieve posts using the notation <code class="inlineCode">Post.published.all()</code>.</p>
<p class="normal">Edit the <code class="inlineCode">models.py</code> file of your <code class="inlineCode">blog</code> application to add the custom manager, as follows. The new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code"><strong class="hljs-keyword-slc">class</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">PublishedManager</strong><strong class="hljs-slc">(models.Manager):</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">def</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">get_queryset</strong><strong class="hljs-slc">(</strong><strong class="hljs-params-slc">self</strong><strong class="hljs-slc">):</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> (</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">super</strong><strong class="hljs-slc">().get_queryset().</strong><strong class="hljs-built_in-slc">filter</strong><strong class="hljs-slc">(status=Post.Status.PUBLISHED)</strong>
<strong class="hljs-slc">        )</strong>
class Post(models.Model):
    # model fields
# ...
<strong class="hljs-slc">    objects = models.Manager() </strong><strong class="hljs-comment-slc"># The default manager.</strong>
<strong class="hljs-slc">    published = PublishedManager() </strong><strong class="hljs-comment-slc"># Our custom manager.</strong>
class Meta:
        ordering = ['-publish']
        indexes = [
            models.Index(fields=['-publish']),
        ]
    def __str__(self):
        return self.title
</code></pre>
<p class="normal">The first manager declared in a model becomes the default manager. You can use the <code class="inlineCode">Meta</code> attribute <code class="inlineCode">default_manager_name</code> to specify a different default manager. If no manager is defined in the model, Django automatically creates the <code class="inlineCode">objects</code> default manager for it. If you declare any managers for your model but you want to keep the <code class="inlineCode">objects</code> manager as well, you have to add it explicitly to your model. In the preceding code, we have added the default <code class="inlineCode">objects</code> manager and the <code class="inlineCode">published</code> custom manager to the <code class="inlineCode">Post</code> model.</p>
<p class="normal">The <code class="inlineCode">get_queryset()</code> method of a manager returns the QuerySet that will be executed. We have overridden this method to build a custom QuerySet that filters posts by their status and returns a successive QuerySet that only includes posts with the <code class="inlineCode">PUBLISHED</code> status.</p>
<p class="normal">We have now defined a custom manager for the <code class="inlineCode">Post</code> model. Let’s test it!</p>
<p class="normal">Start the development server again with the following command in the shell prompt:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py shell
</code></pre>
<p class="normal">Now, you can import the <code class="inlineCode">Post</code> model and retrieve all published posts whose title starts with <code class="inlineCode">Who</code>, executing the following QuerySet:</p>
<pre class="programlisting con"><code class="hljs-con">&gt;&gt;&gt; from blog.models import Post
&gt;&gt;&gt; Post.published.filter(title__startswith='Who')
</code></pre>
<p class="normal">To obtain results<a id="_idIndexMarker130"/> for this QuerySet, make sure to set the <code class="inlineCode">status</code> field to <code class="inlineCode">PUBLISHED</code> in the <code class="inlineCode">Post</code> object whose <code class="inlineCode">title</code> starts with the string <em class="italic">Who</em>.</p>
<h1 class="heading-1" id="_idParaDest-67">Building list and detail views</h1>
<p class="normal">Now that you <a id="_idIndexMarker131"/>understand how to use the ORM, you are ready to build the views of the <code class="inlineCode">blog</code> application. A Django view is just a Python function that receives a web request and returns a web response. All the logic to return the desired response goes inside the view.</p>
<p class="normal">First, you will create your application views, then you will define a URL pattern for each view, and finally, you will create HTML templates to render the data generated by the views. Each view will render a template, passing variables to it, and will return an HTTP response with the rendered output.</p>
<h2 class="heading-2" id="_idParaDest-68">Creating list and detail views </h2>
<p class="normal">Let’s start by <a id="_idIndexMarker132"/>creating a view to display the list of posts.</p>
<p class="normal">Edit the <code class="inlineCode">views.py</code> file of the <code class="inlineCode">blog</code> application and make it look like this; the new lines are highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.shortcuts import render
<strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> .models </strong><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> Post</strong>
<strong class="hljs-keyword-slc">def</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">post_list</strong><strong class="hljs-slc">(</strong><strong class="hljs-params-slc">request</strong><strong class="hljs-slc">):</strong>
<strong class="hljs-slc">    posts = Post.published.</strong><strong class="hljs-built_in-slc">all</strong><strong class="hljs-slc">()</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> render(</strong>
<strong class="hljs-slc">        request,</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'blog/post/list.html'</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">        {</strong><strong class="hljs-string-slc">'posts'</strong><strong class="hljs-slc">: posts}</strong>
<strong class="hljs-slc">    )</strong>
</code></pre>
<p class="normal">This is our very first Django view. The <code class="inlineCode">post_list</code> view takes the <code class="inlineCode">request</code> object as the only parameter. This parameter is required by all views.</p>
<p class="normal">In this view, we retrieve all the posts with the <code class="inlineCode">PUBLISHED</code> status using the <code class="inlineCode">published</code> manager that we created previously.</p>
<p class="normal">Finally, we use the <code class="inlineCode">render()</code> shortcut provided by Django to render the list of posts with the given template. This function takes the <code class="inlineCode">request</code> object, the template path, and the context variables to render the given template. It returns an <code class="inlineCode">HttpResponse</code> object with the rendered text (normally HTML code).</p>
<p class="normal">The <code class="inlineCode">render()</code> shortcut takes the request context into account, so any variable set by the template context processors is accessible by the given template. Template context processors are just callables that set variables into the context. You will learn how to use context processors in <em class="italic">Chapter 4</em>, <em class="italic">Building a Social Website</em>.</p>
<p class="normal">Let’s create a second view to display a single post. Add the following function to the <code class="inlineCode">views.py</code> file:</p>
<pre class="programlisting code"><code class="hljs-code">from django.http import Http404
def post_detail(request, id):
    try:
        post = Post.published.get(id=id)
    except Post.DoesNotExist:
        raise Http404("No Post found.")
    return render(
        request,
        'blog/post/detail.html',
        {'post': post}
    )
</code></pre>
<p class="normal">This is the <code class="inlineCode">post_detail</code> view. This view takes the <code class="inlineCode">id</code> argument of a post. In the view, we try to retrieve the <code class="inlineCode">Post</code> object with the given <code class="inlineCode">id</code> by calling the <code class="inlineCode">get()</code> method on the <code class="inlineCode">published</code> manager. We raise an <code class="inlineCode">Http404</code> exception to return an HTTP 404 error if the model <code class="inlineCode">DoesNotExist</code> exception<a id="_idIndexMarker133"/> is raised because no result is found.</p>
<p class="normal">Finally, we use the <code class="inlineCode">render()</code> shortcut to render the retrieved post using a template.</p>
<h2 class="heading-2" id="_idParaDest-69">Using the get_object_or_404 shortcut</h2>
<p class="normal">Django provides <a id="_idIndexMarker134"/>a shortcut<a id="_idIndexMarker135"/> to call <code class="inlineCode">get()</code> on a given model manager and raises an <code class="inlineCode">Http404</code> exception instead of a <code class="inlineCode">DoesNotExist</code> exception when no object is found.</p>
<p class="normal">Edit the <code class="inlineCode">views.py</code> file to import the <code class="inlineCode">get_object_or_404</code> shortcut and change the <code class="inlineCode">post_detail</code> view, as follows. The new code is highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.shortcuts import <strong class="hljs-slc">get_object_or_404, </strong>render
# ...
def post_detail(request, id):
<strong class="hljs-slc">    post = get_object_or_404(</strong>
<strong class="hljs-slc">        Post,</strong>
<strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc">id</strong><strong class="hljs-slc">=</strong><strong class="hljs-built_in-slc">id</strong><strong class="hljs-slc">,</strong>
<strong class="hljs-slc">        status=Post.Status.PUBLISHED</strong>
<strong class="hljs-slc">    )</strong>
return render(
        request,
        'blog/post/detail.html',
        {'post': post}
    )
</code></pre>
<p class="normal">In the detail view, we now use the <code class="inlineCode">get_object_or_404()</code> shortcut to retrieve the desired post. This function <a id="_idIndexMarker136"/>retrieves the object that matches the given parameters or an HTTP 404 (not found) exception<a id="_idIndexMarker137"/> if no object is found.</p>
<h2 class="heading-2" id="_idParaDest-70">Adding URL patterns for your views</h2>
<p class="normal">URL patterns allow <a id="_idIndexMarker138"/>you to map URLs <a id="_idIndexMarker139"/>to views. A URL pattern is composed of a string pattern, a view, and, optionally, a name that allows you to name the URL project-wide. Django runs through each URL pattern and stops at the first one that matches the requested URL. Then, Django imports the view of the matching URL pattern and executes it, passing an instance of the <code class="inlineCode">HttpRequest</code> class and the keyword or positional arguments.</p>
<p class="normal">Create a <code class="inlineCode">urls.py</code> file in the directory of the <code class="inlineCode">blog</code> application and add the following lines to it:</p>
<pre class="programlisting code"><code class="hljs-code">from django.urls import path
from . import views
app_name = 'blog'
urlpatterns = [
    # post views
    path('', views.post_list, name='post_list'),
    path('&lt;int:id&gt;/', views.post_detail, name='post_detail'),
]
</code></pre>
<p class="normal">In the preceding code, you define an application namespace with the <code class="inlineCode">app_name</code> variable. This allows you to organize URLs by application and use the name when referring to them. You define two different patterns using the <code class="inlineCode">path()</code> function. The first URL pattern doesn’t take any arguments and is mapped to the <code class="inlineCode">post_list</code> view. The second pattern is mapped to the <code class="inlineCode">post_detail</code> view and takes only one argument <code class="inlineCode">id</code>, which matches an integer, set by the path converter <code class="inlineCode">int</code>.</p>
<p class="normal">You use angle brackets to capture the values from the URL. Any value specified in the URL pattern as <code class="inlineCode">&lt;parameter&gt;</code> is captured as a string. You use path converters, such as <code class="inlineCode">&lt;int:year&gt;</code>, to specifically match and return an integer. For example <code class="inlineCode">&lt;slug:post&gt;</code> would specifically match a slug (a string that can only contain letters, numbers, underscores, or hyphens). You can see all the path converters provided by Django at <a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters">https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters</a>.</p>
<p class="normal">If using <code class="inlineCode">path()</code> and converters isn’t sufficient for you, you can use <code class="inlineCode">re_path()</code> instead to define complex URL patterns with Python regular expressions. You can learn more about defining URL patterns with regular expressions at <a href="https://docs.djangoproject.com/en/5.0/ref/urls/#django.urls.re_path">https://docs.djangoproject.com/en/5.0/ref/urls/#django.urls.re_path</a>. If you haven’t worked <a id="_idIndexMarker140"/>with regular <a id="_idIndexMarker141"/>expressions before, you might want to take a look at <em class="italic">Regular Expression HOWTO</em>, located at <a href="https://docs.python.org/3/howto/regex.html">https://docs.python.org/3/howto/regex.html</a>, first.</p>
<div><p class="normal">Creating a <code class="inlineCode">urls.py</code> file for each application is the best way to make your applications reusable by other projects.</p>
</div>
<p class="normal">Next, you have to include the URL patterns of the <code class="inlineCode">blog</code> application in the main URL patterns of the project.</p>
<p class="normal">Edit the <code class="inlineCode">urls.py</code> file located in the <code class="inlineCode">mysite</code> directory of your project and make it look like the following. The new code is highlighted in bold:</p>
<pre class="programlisting code"><code class="hljs-code">from django.contrib import admin
from django.urls import <strong class="hljs-slc">include, </strong>path
urlpatterns = [
    path('admin/', admin.site.urls),
<strong class="hljs-slc">    path(</strong><strong class="hljs-string-slc">'blog/'</strong><strong class="hljs-slc">, include(</strong><strong class="hljs-string-slc">'blog.urls'</strong><strong class="hljs-slc">, namespace=</strong><strong class="hljs-string-slc">'blog'</strong><strong class="hljs-slc">)),</strong>
]
</code></pre>
<p class="normal">The new URL pattern defined with <code class="inlineCode">include</code> refers to the URL patterns defined in the <code class="inlineCode">blog</code> application so that they are included under the <code class="inlineCode">blog/</code> path. You include these patterns under the namespace <code class="inlineCode">blog</code>. Namespaces have to be unique across your entire project. Later, you will refer to your blog URLs easily by using the namespace followed by a colon and the URL name, for example, <code class="inlineCode">blog:post_list</code> and <code class="inlineCode">blog:post_detail</code>. You can learn more <a id="_idIndexMarker142"/>about URL<a id="_idIndexMarker143"/> namespaces at <a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/#url-namespaces">https://docs.djangoproject.com/en/5.0/topics/http/urls/#url-namespaces</a>.</p>
<h1 class="heading-1" id="_idParaDest-71">Creating templates for your views</h1>
<p class="normal">You have created <a id="_idIndexMarker144"/>views and URL patterns for the <code class="inlineCode">blog</code> application. URL patterns map URLs to views, and views decide which data gets returned to the user. Templates define how the data is displayed; they are usually written in HTML in combination with the Django template language. You can find more information about the Django template language at <a href="https://docs.djangoproject.com/en/5.0/ref/templates/language/">https://docs.djangoproject.com/en/5.0/ref/templates/language/</a>.</p>
<p class="normal">Let’s add templates to your application to display posts in a user-friendly manner.</p>
<p class="normal">Create the following directories and files inside your <code class="inlineCode">blog</code> application directory:</p>
<pre class="programlisting con"><code class="hljs-con">templates/
    blog/
        base.html
        post/
            list.html
            detail.html
</code></pre>
<p class="normal">The preceding structure will be the file structure for your templates. The <code class="inlineCode">base.html</code> file will include the main HTML structure of the website and divide the content into the main content area and a sidebar. The <code class="inlineCode">list.html</code> and <code class="inlineCode">detail.html</code> files will inherit from the <code class="inlineCode">base.html</code> file to render the blog post list and detail views, respectively.</p>
<p class="normal">Django has a powerful template language that allows you to specify how data is displayed. It is based on <em class="italic">template tags</em>, <em class="italic">template variables</em>, and <em class="italic">template filters</em>:</p>
<ul>
<li class="bulletList">Template tags control the rendering of the template and look like this: <code class="inlineCode">{% tag %}</code>.</li>
<li class="bulletList">Template variables get replaced with values when the template is rendered and look like this: <code class="inlineCode">{{ variable }}</code>.</li>
<li class="bulletList">Template filters allow you to modify variables for display and look like this: <code class="inlineCode">{{ variable|filter }}</code>.</li>
</ul>
<p class="normal">You can see <a id="_idIndexMarker145"/>all the built-in template tags and filters at <a href="https://docs.djangoproject.com/en/5.0/ref/templates/builtins/">https://docs.djangoproject.com/en/5.0/ref/templates/builtins/</a>.</p>
<h2 class="heading-2" id="_idParaDest-72">Creating a base template</h2>
<p class="normal">Edit the <code class="inlineCode">base.html</code> file <a id="_idIndexMarker146"/>and add the following<a id="_idIndexMarker147"/> code:</p>
<pre class="programlisting code"><code class="hljs-code">{% load static %}
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;link href="{% static "css/blog.css" %}" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="content"&gt;
    {% block content %}
    {% endblock %}
  &lt;/div&gt;
&lt;div id="sidebar"&gt;
&lt;h2&gt;My blog&lt;/h2&gt;
&lt;p&gt;This is my blog.&lt;/p&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p class="normal"><code class="inlineCode">{% load static %}</code> tells Django to load the <code class="inlineCode">static</code> template tags that are provided by the <code class="inlineCode">django.contrib.staticfiles</code> application, which is contained in the <code class="inlineCode">INSTALLED_APPS</code> setting. After loading them, you can use the <code class="inlineCode">{% static %}</code> template tag throughout this template. With this template tag, you can include the static files, such as the <code class="inlineCode">blog.css</code> file, which you will find in the code of this example under the <code class="inlineCode">static/</code> directory of the <code class="inlineCode">blog</code> application. Copy the <code class="inlineCode">static/</code> directory from the code that comes along with this chapter into the same location as your project to apply the CSS styles to the templates. You can find the directory’s contents at <a href="https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static">https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static</a>.</p>
<p class="normal">You can see that there are two <code class="inlineCode">{% block %}</code> tags. These tell Django that you want to define a block in that area. Templates that inherit from this template can fill in the blocks with<a id="_idIndexMarker148"/> content. You have defined <a id="_idIndexMarker149"/>a block called <code class="inlineCode">title</code> and a block called <code class="inlineCode">content</code>.</p>
<h2 class="heading-2" id="_idParaDest-73">Creating the post list template</h2>
<p class="normal">Let’s edit <a id="_idIndexMarker150"/>the <code class="inlineCode">post/list.html</code> file and <a id="_idIndexMarker151"/>make it look like the following:</p>
<pre class="programlisting code"><code class="hljs-code">{% extends "blog/base.html" %}
{% block title %}My Blog{% endblock %}
{% block content %}
  &lt;h1&gt;My Blog&lt;/h1&gt;
  {% for post in posts %}
    &lt;h2&gt;
&lt;a href="{% url 'blog:post_detail' post.id %}"&gt;
        {{ post.title }}
      &lt;/a&gt;
&lt;/h2&gt;
&lt;p class="date"&gt;
      Published {{ post.publish }} by {{ post.author }}
    &lt;/p&gt;
    {{ post.body|truncatewords:30|linebreaks }}
  {% endfor %}
{% endblock %}
</code></pre>
<p class="normal">With the <code class="inlineCode">{% extends %}</code> template tag, you tell Django to inherit from the <code class="inlineCode">blog/base.html</code> template. Then, you fill the <code class="inlineCode">title</code> and <code class="inlineCode">content</code> blocks of the base template with content. You iterate through the posts and display their title, date, author, and body, including a link in the title to the detail URL of the post. We build the URL using the <code class="inlineCode">{% url %}</code> template tag provided by Django.</p>
<p class="normal">This template tag allows you to build URLs dynamically by their name. We use <code class="inlineCode">blog:post_detail</code> to refer to the <code class="inlineCode">post_detail</code> URL in the <code class="inlineCode">blog</code> namespace. We pass the required <code class="inlineCode">post.id</code> parameter to build the URL for each post.</p>
<div><p class="normal">Always use the <code class="inlineCode">{% url %}</code> template tag to build URLs in your templates instead of writing hardcoded URLs. This will make your URLs more maintainable.</p>
</div>
<p class="normal">In the body of the post, we apply two template filters: <code class="inlineCode">truncatewords</code> truncates the value to the number of words specified, and <code class="inlineCode">linebreaks</code> converts the output into HTML line breaks. You can concatenate as many template filters as you wish; each one will be applied to the<a id="_idIndexMarker152"/> output generated by the<a id="_idIndexMarker153"/> preceding one.</p>
<h2 class="heading-2" id="_idParaDest-74">Accessing our application</h2>
<p class="normal">Change the<a id="_idIndexMarker154"/> status of the initial post to <strong class="screenText">Published</strong>, as<a id="_idIndexMarker155"/> shown in <em class="italic">Figure 1.16</em>, and create some new posts, also with a <strong class="screenText">Published</strong> status.</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_16.png"/></figure>
<p class="packt_figref">Figure 1.16: The status field for a published post</p>
<p class="normal">Open the shell and execute the following command to start the development server:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py runserver
</code></pre>
<p class="normal">Open <code class="inlineCode">http://127.0.0.1:8000/blog/</code> in your browser; you will see everything running. You should see something like this:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_17.png"/></figure>
<p class="packt_figref">Figure 1.17: The page for the post list view</p>
<h2 class="heading-2" id="_idParaDest-75">Creating the post detail template</h2>
<p class="normal">Next, edit<a id="_idIndexMarker156"/> the<a id="_idIndexMarker157"/> <code class="inlineCode">post/detail.html</code> file:</p>
<pre class="programlisting code"><code class="hljs-code">{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  &lt;h1&gt;{{ post.title }}&lt;/h1&gt;
&lt;p class="date"&gt;
    Published {{ post.publish }} by {{ post.author }}
  &lt;/p&gt;
  {{ post.body|linebreaks }}
{% endblock %}
</code></pre>
<p class="normal">Next, you can return to your browser and click on one of the post titles to take a look at the detail view of the post. You should see something like this:</p>
<figure class="mediaobject"><img alt="" role="presentation" src="img/B21088_01_18.png"/></figure>
<p class="packt_figref">Figure 1.18: The page for the post’s detail view</p>
<p class="normal">Take a look at<a id="_idIndexMarker158"/> the URL – it should include the <a id="_idIndexMarker159"/>auto-generated post ID, like <code class="inlineCode">/blog/1/</code>.</p>
<h1 class="heading-1" id="_idParaDest-76">The request/response cycle</h1>
<p class="normal">Let’s review the<a id="_idIndexMarker160"/> request/response cycle of Django with the application we built. The following schema shows a simplified example of how Django processes HTTP requests and generates HTTP responses:</p>
<figure class="mediaobject"><img alt="Timeline  Description automatically generated with medium confidence" src="img/B21088_01_19.png"/></figure>
<p class="packt_figref">Figure 1.19: The Django request/response cycle</p>
<p class="normal">Let’s review the <a id="_idIndexMarker161"/>Django request/response process:</p>
<p class="normal">A web browser requests a page by its URL, for example, <code class="inlineCode">https://domain.com/blog/33/</code>. The web server receives the HTTP request and passes it over to Django.</p>
<p class="normal">Django runs through each URL pattern defined in the URL patterns configuration. The framework checks each pattern against the given URL path, in order of appearance, and stops at the first one that matches the requested URL. In this case, the pattern <code class="inlineCode">/blog/&lt;id&gt;/</code> matches the path <code class="inlineCode">/blog/33/</code>.</p>
<p class="normal">Django imports the view of the matching URL pattern and executes it, passing an instance of the <code class="inlineCode">HttpRequest</code> class and the keyword or positional arguments. The view uses the models to retrieve information from the database. Using the Django ORM, QuerySets are translated into SQL and executed in the database.</p>
<p class="normal">The view uses the <code class="inlineCode">render()</code> function to render an HTML template passing the <code class="inlineCode">Post</code> object as a context variable.</p>
<p class="normal">The rendered content is returned as a <code class="inlineCode">HttpResponse</code> object by the view with the <code class="inlineCode">text/html</code> content type by default.</p>
<p class="normal">You can always use this schema as the basic reference for how Django processes requests. This schema doesn’t include Django middleware, for the sake of simplicity. You will use<a id="_idIndexMarker162"/> middleware in different examples of this book, and you will learn how to create custom middleware in <em class="italic">Chapter 17</em>, <em class="italic">Going Live</em>.</p>
<h1 class="heading-1" id="_idParaDest-77">Management commands used in this chapter</h1>
<p class="normal">In this chapter, we have <a id="_idIndexMarker163"/>introduced a variety of Django management commands. You need to get familiar with them, as they will be used often throughout the book. Let’s revisit the commands we have covered in this chapter.</p>
<p class="normal">To create the file structure for a new Django project named <code class="inlineCode">mysite</code>, we used the following command:</p>
<pre class="programlisting con"><code class="hljs-con">django-admin startproject mysite
</code></pre>
<p class="normal">To create the file structure for a new Django application named <code class="inlineCode">blog</code>:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py startapp blog
</code></pre>
<p class="normal">To apply all database migrations:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py migrate
</code></pre>
<p class="normal">To create migrations for the models of the <code class="inlineCode">blog</code> application:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py makemigrations blog
</code></pre>
<p class="normal">To view the SQL statements that will be executed with the first migration of the <code class="inlineCode">blog</code> application:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py sqlmigrate blog 0001
</code></pre>
<p class="normal">To run the Django development server:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py runserver
</code></pre>
<p class="normal">To run the development server specifying host/port and settings file:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py runserver 127.0.0.1:8001 --settings=mysite.settings
</code></pre>
<p class="normal">To run the Django shell:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py shell
</code></pre>
<p class="normal">To create a superuser using the Django authentication framework:</p>
<pre class="programlisting con"><code class="hljs-con">python manage.py createsuperuser
</code></pre>
<p class="normal">For the full list of<a id="_idIndexMarker164"/> available management commands, check out <a href="https://docs.djangoproject.com/en/5.0/ref/django-admin/">https://docs.djangoproject.com/en/5.0/ref/django-admin/</a>.</p>
<h1 class="heading-1" id="_idParaDest-78">Summary</h1>
<p class="normal">In this chapter, you learned the basics of the Django web framework by creating a simple blog application. You designed the data models and applied migrations to the database. You also created the views, templates, and URLs for your blog.</p>
<p class="normal">In the next chapter, you will enhance your blog by creating canonical URLs for your posts and building SEO-friendly URLs. You will also learn how to implement object pagination and how to build class-based views. You will also create forms to let your users recommend posts by email and comment on posts.</p>
<h1 class="heading-1" id="_idParaDest-79">Additional resources</h1>
<p class="normal">The following resources provide additional information related to the topics covered in this chapter:</p>
<ul>
<li class="bulletList">Source code for this chapter: <a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01</a></li>
<li class="bulletList">Download Python: <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></li>
<li class="bulletList">Windows Python launcher: <a href="https://docs.python.org/3/using/windows.html#launcher">https://docs.python.org/3/using/windows.html#launcher</a></li>
<li class="bulletList">Python <code class="inlineCode">venv</code> library for virtual environments: <a href="https://docs.python.org/3/library/venv.html">https://docs.python.org/3/library/venv.html</a></li>
<li class="bulletList">Python <code class="inlineCode">pip</code> installation instructions: at <a href="https://pip.pypa.io/en/stable/installation/">https://pip.pypa.io/en/stable/installation/</a></li>
<li class="bulletList">Django installation options: <a href="https://docs.djangoproject.com/en/5.0/topics/install/">https://docs.djangoproject.com/en/5.0/topics/install/</a></li>
<li class="bulletList">Django 5.0 release notes: <a href="https://docs.djangoproject.com/en/5.0/releases/5.0/">https://docs.djangoproject.com/en/5.0/releases/5.0/</a></li>
<li class="bulletList">The <code class="inlineCode">django-upgrade</code> tool: <a href="https://github.com/adamchainz/django-upgrade">https://github.com/adamchainz/django-upgrade</a></li>
<li class="bulletList">The <code class="inlineCode">pyupgrade</code> tool: <a href="https://github.com/asottile/pyupgrade">https://github.com/asottile/pyupgrade</a></li>
<li class="bulletList">Django’s design philosophies: <a href="https://docs.djangoproject.com/en/5.0/misc/design-philosophies/">https://docs.djangoproject.com/en/5.0/misc/design-philosophies/</a></li>
<li class="bulletList">Django model field reference: <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/">https://docs.djangoproject.com/en/5.0/ref/models/fields/</a></li>
<li class="bulletList">Model index reference: <a href="https://docs.djangoproject.com/en/5.0/ref/models/indexes/">https://docs.djangoproject.com/en/5.0/ref/models/indexes/</a></li>
<li class="bulletList">Python support for enumerations: <a href="https://docs.python.org/3/library/enum.html">https://docs.python.org/3/library/enum.html</a></li>
<li class="bulletList">Django model enumeration types: <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types">https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types</a></li>
<li class="bulletList">Django settings reference: <a href="https://docs.djangoproject.com/en/5.0/ref/settings/">https://docs.djangoproject.com/en/5.0/ref/settings/</a></li>
<li class="bulletList">Database default values for model fields: <a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default">https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default</a></li>
<li class="bulletList">Database functions: <a href="https://docs.djangoproject.com/en/5.0/ref/models/database-functions/">https://docs.djangoproject.com/en/5.0/ref/models/database-functions/</a></li>
<li class="bulletList">Django administration site: <a href="https://docs.djangoproject.com/en/5.0/ref/contrib/admin/">https://docs.djangoproject.com/en/5.0/ref/contrib/admin/</a></li>
<li class="bulletList">Model API reference: <a href="https://docs.djangoproject.com/en/5.0/ref/models/">https://docs.djangoproject.com/en/5.0/ref/models/</a></li>
<li class="bulletList">Making queries with the Django ORM: <a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/">https://docs.djangoproject.com/en/5.0/topics/db/queries/</a></li>
<li class="bulletList">QuerySet API reference: <a href="https://docs.djangoproject.com/en/5.0/ref/models/querysets/">https://docs.djangoproject.com/en/5.0/ref/models/querysets/</a></li>
<li class="bulletList">Complex lookups with Q objects: <a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects">https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects</a></li>
<li class="bulletList">Django URL dispatcher: <a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/">https://docs.djangoproject.com/en/5.0/topics/http/urls/</a></li>
<li class="bulletList">Django template language: <a href="https://docs.djangoproject.com/en/5.0/ref/templates/language/">https://docs.djangoproject.com/en/5.0/ref/templates/language/</a></li>
<li class="bulletList">Built-in template tags and filters: <a href="https://docs.djangoproject.com/en/5.0/ref/templates/builtins/">https://docs.djangoproject.com/en/5.0/ref/templates/builtins/</a></li>
<li class="bulletList">Django management commands: <a href="https://docs.djangoproject.com/en/5.0/ref/django-admin/">https://docs.djangoproject.com/en/5.0/ref/django-admin/</a></li>
<li class="bulletList">Static files for the code in this chapter: <a href="https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static">https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static</a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-80">Join us on Discord!</h1>
<p class="normal">Read this book alongside other users, Django development experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more.Scan the QR code or visit the link to join the community.</p>
<p class="normal">https://packt.link/Django5ByExample</p>
<p class="normal"><img alt="" role="presentation" src="img/QR_Code287089408934129031.png"/></p>
</div>
</body></html>