<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer041">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">1</span></h1>
<h1 class="chapterTitle" id="_idParaDest-20"><span class="koboSpan" id="kobo.2.1">Building a Blog Application</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In this book, you will learn how to build professional-grade web projects using Django. </span><span class="koboSpan" id="kobo.3.2">This initial chapter will guide you through the essential building blocks of a Django application, from installation to deployment. </span><span class="koboSpan" id="kobo.3.3">If you haven’t set up Django on your machine yet, the </span><em class="italic"><span class="koboSpan" id="kobo.4.1">Installing Django</span></em><span class="koboSpan" id="kobo.5.1"> section will walk you through the installation process.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1">Before starting our first Django project, let’s go over what you are about to learn. </span><span class="koboSpan" id="kobo.6.2">This chapter will give you a general overview of the framework. </span><span class="koboSpan" id="kobo.6.3">It will guide you through the different major components to create a fully functional web application: models, templates, views, and URLs. </span><span class="koboSpan" id="kobo.6.4">You will gain an understanding of how Django works and how the different framework components interact.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.7.1">You will also learn the difference between Django projects and applications, and you will learn about the most important Django settings. </span><span class="koboSpan" id="kobo.7.2">You will build a simple blog application that allows users to navigate through all published posts and read individual posts. </span><span class="koboSpan" id="kobo.7.3">You will also create a simple administration interface to manage and publish posts. </span><span class="koboSpan" id="kobo.7.4">In the next two chapters, you will extend the blog application with more advanced functionalities.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.8.1">Consider this chapter as your roadmap for constructing a fully-fledged Django application. </span><span class="koboSpan" id="kobo.8.2">Don’t be concerned if some components or concepts appear unclear at first. </span><span class="koboSpan" id="kobo.8.3">The different framework components will be explored in detail throughout this book.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.9.1">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Installing Python</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Creating a Python virtual environment</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Installing Django</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Creating and configuring a Django project</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Building a Django application</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1">Designing data models</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1">Creating and applying model migrations</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.17.1">Setting up an administration site for your models</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.18.1">Working with QuerySets and model managers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.19.1">Building views, templates, and URLs</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.20.1">Understanding the Django request/response cycle</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.21.1">You will start by installing Python on your machine.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.22.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01"><span class="url"><span class="koboSpan" id="kobo.23.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01</span></span></a><span class="koboSpan" id="kobo.24.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.25.1">All Python packages used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.26.1">requirements.txt</span></code><span class="koboSpan" id="kobo.27.1"> file in the source code for the chapter. </span><span class="koboSpan" id="kobo.27.2">You can follow the instructions to install each Python package in the following sections, or you can install all the requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.28.1">python -m pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.29.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-21"><span class="koboSpan" id="kobo.30.1">Installing Python</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.31.1">Django 5.0 supports Python 3.10, 3.11, and 3.12. </span><span class="koboSpan" id="kobo.31.2">In the</span><a id="_idIndexMarker000"/><span class="koboSpan" id="kobo.32.1"> examples in this book, we will use Python 3.12.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.33.1">If you’re using Linux or macOS, you probably have Python installed. </span><span class="koboSpan" id="kobo.33.2">If you’re using Windows, you can download a Python installer from the </span><a href="http://python.org"><span class="url"><span class="koboSpan" id="kobo.34.1">python.org</span></span></a><span class="koboSpan" id="kobo.35.1"> website. </span><span class="koboSpan" id="kobo.35.2">You can download Python for your OS from </span><a href="https://www.python.org/downloads/"><span class="url"><span class="koboSpan" id="kobo.36.1">https://www.python.org/downloads/</span></span></a><span class="koboSpan" id="kobo.37.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.38.1">Open the command-line shell prompt of your machine. </span><span class="koboSpan" id="kobo.38.2">If you are using macOS, press </span><em class="keystroke"><span class="koboSpan" id="kobo.39.1">Command + spacebar</span></em><span class="koboSpan" id="kobo.40.1"> to open Spotlight and write </span><strong class="screenText"><span class="koboSpan" id="kobo.41.1">Terminal</span></strong><span class="koboSpan" id="kobo.42.1"> to open </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">Terminal.app</span></code><span class="koboSpan" id="kobo.44.1">. </span><span class="koboSpan" id="kobo.44.2">If you are using Windows, open the </span><strong class="screenText"><span class="koboSpan" id="kobo.45.1">Start</span></strong><span class="koboSpan" id="kobo.46.1"> menu and type </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">powers</span></code><span class="koboSpan" id="kobo.48.1"> into the search box. </span><span class="koboSpan" id="kobo.48.2">Then, click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.49.1">Windows PowerShell</span></strong><span class="koboSpan" id="kobo.50.1"> application to open it. </span><span class="koboSpan" id="kobo.50.2">Alternatively, you can use the more basic command prompt by typing </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">cmd</span></code><span class="koboSpan" id="kobo.52.1"> into the search box and clicking on the </span><strong class="screenText"><span class="koboSpan" id="kobo.53.1">Command Prompt</span></strong><span class="koboSpan" id="kobo.54.1"> application to open it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.55.1">Verify that Python 3 is installed on your machine by typing the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.56.1">python3 --version
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.57.1">If you see the following, then Python 3 is installed on your computer:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.58.1">Python 3.12.3
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.59.1">If you get an error, try the </span><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">python</span></code><span class="koboSpan" id="kobo.61.1"> command instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.62.1">python3</span></code><span class="koboSpan" id="kobo.63.1">. </span><span class="koboSpan" id="kobo.63.2">If you use Windows, it’s recommended that you replace </span><code class="inlineCode"><span class="koboSpan" id="kobo.64.1">python</span></code><span class="koboSpan" id="kobo.65.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1">py</span></code><span class="koboSpan" id="kobo.67.1"> command.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.68.1">If your installed Python version is lower than 3.12, or if Python is not installed on your computer, download Python 3.12 from </span><a href="https://www.python.org/downloads/"><span class="url"><span class="koboSpan" id="kobo.69.1">https://www.python.org/downloads/</span></span></a><span class="koboSpan" id="kobo.70.1"> and follow the instructions to install it. </span><span class="koboSpan" id="kobo.70.2">On the download site, you can find Python installers for Windows, macOS, and Linux.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.71.1">Throughout this book, when Python is referenced in the shell prompt, we will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.72.1">python</span></code><span class="koboSpan" id="kobo.73.1"> command, though some systems may require using </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">python3</span></code><span class="koboSpan" id="kobo.75.1">. </span><span class="koboSpan" id="kobo.75.2">If you are using Linux or macOS and your system’s Python is Python 2, you will need to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">python3</span></code><span class="koboSpan" id="kobo.77.1"> to use the Python 3 version you installed. </span><span class="koboSpan" id="kobo.77.2">Note that Python 2 reached end-of-life in January 2020 and shouldn’t be used anymore.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.78.1">In Windows, </span><code class="inlineCode"><span class="koboSpan" id="kobo.79.1">python</span></code><span class="koboSpan" id="kobo.80.1"> is the Python executable of your default Python installation, whereas </span><code class="inlineCode"><span class="koboSpan" id="kobo.81.1">py</span></code><span class="koboSpan" id="kobo.82.1"> is the Python launcher. </span><span class="koboSpan" id="kobo.82.2">The Python launcher for Windows was introduced in Python 3.3. </span><span class="koboSpan" id="kobo.82.3">It detects what Python versions are installed on your machine and it automatically delegates to the latest version. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.83.1">If you use Windows, you should use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">py</span></code><span class="koboSpan" id="kobo.85.1"> command. </span><span class="koboSpan" id="kobo.85.2">You can</span><a id="_idIndexMarker001"/><span class="koboSpan" id="kobo.86.1"> read more about the Windows Python launcher at </span><a href="https://docs.python.org/3/using/windows.html#launcher"><span class="url"><span class="koboSpan" id="kobo.87.1">https://docs.python.org/3/using/windows.html#launcher</span></span></a><span class="koboSpan" id="kobo.88.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.89.1">Next, you are going to create a Python environment for your project and install the necessary Python libraries.</span></p>
<h1 class="heading-1" id="_idParaDest-22"><span class="koboSpan" id="kobo.90.1">Creating a Python virtual environment</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.91.1">When you write</span><a id="_idIndexMarker002"/><span class="koboSpan" id="kobo.92.1"> Python applications, you will usually use packages and modules that are not included in the standard Python library. </span><span class="koboSpan" id="kobo.92.2">You may have Python applications that require a different version of the same module. </span><span class="koboSpan" id="kobo.92.3">However, only a specific version of a module can be installed system-wide. </span><span class="koboSpan" id="kobo.92.4">If you upgrade a module version for an application, you might end up breaking other applications that require an older version of that module.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.93.1">To address this issue, you can use Python virtual environments. </span><span class="koboSpan" id="kobo.93.2">With virtual environments, you can install Python modules in an isolated location rather than installing them system-wide. </span><span class="koboSpan" id="kobo.93.3">Each virtual environment has its own Python binary and can have its own independent set of installed Python packages in its site-packages directory.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.94.1">Since version 3.3, Python comes with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.95.1">venv</span></code><span class="koboSpan" id="kobo.96.1"> library, which provides support for creating lightweight virtual environments. </span><span class="koboSpan" id="kobo.96.2">By using the Python </span><code class="inlineCode"><span class="koboSpan" id="kobo.97.1">venv</span></code><span class="koboSpan" id="kobo.98.1"> module to create isolated Python environments, you can use different package versions for different projects. </span><span class="koboSpan" id="kobo.98.2">Another advantage of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.99.1">venv</span></code><span class="koboSpan" id="kobo.100.1"> is that you won’t need any administrative privileges to install Python packages.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.101.1">If you are using Linux or macOS, create an isolated environment with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.102.1">python -m venv my_env
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.103.1">Remember to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.104.1">python3</span></code><span class="koboSpan" id="kobo.105.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.106.1">python</span></code><span class="koboSpan" id="kobo.107.1"> if your system comes with Python 2 and you installed Python 3.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.108.1">If you are using</span><a id="_idIndexMarker003"/><span class="koboSpan" id="kobo.109.1"> Windows, use the following command instead:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.110.1">py -m venv my_env
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.111.1">This will use the Python launcher in Windows.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.112.1">The previous command will create a Python environment in a new directory named </span><code class="inlineCode"><span class="koboSpan" id="kobo.113.1">my_env</span></code><span class="koboSpan" id="kobo.114.1">. </span><span class="koboSpan" id="kobo.114.2">Any Python libraries you install while your virtual environment is active will go into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.115.1">my_env/lib/python3.12/site-packages</span></code><span class="koboSpan" id="kobo.116.1"> directory.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.117.1">If you are using Linux or macOS, run the following command to activate your virtual environment:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.118.1">source my_env/bin/activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.119.1">If you are using Windows, use the following command instead:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.120.1">.\my_env\Scripts\activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.121.1">The shell prompt will include the name of the active virtual environment enclosed in parentheses, like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.122.1">(my_env) zenx@pc:~ zenx$
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.123.1">You can deactivate your environment at any time with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.124.1">deactivate</span></code><span class="koboSpan" id="kobo.125.1"> command. </span><span class="koboSpan" id="kobo.125.2">You can find more</span><a id="_idIndexMarker004"/><span class="koboSpan" id="kobo.126.1"> information about </span><code class="inlineCode"><span class="koboSpan" id="kobo.127.1">venv</span></code><span class="koboSpan" id="kobo.128.1"> at </span><a href="https://docs.python.org/3/library/venv.html"><span class="url"><span class="koboSpan" id="kobo.129.1">https://docs.python.org/3/library/venv.html</span></span></a><span class="koboSpan" id="kobo.130.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-23"><span class="koboSpan" id="kobo.131.1">Installing Django</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.132.1">If you have already</span><a id="_idIndexMarker005"/><span class="koboSpan" id="kobo.133.1"> installed Django 5.0, you can skip this section and jump directly to the </span><em class="italic"><span class="koboSpan" id="kobo.134.1">Creating your first project</span></em><span class="koboSpan" id="kobo.135.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.136.1">Django comes as a Python module and thus can be installed in any Python environment. </span><span class="koboSpan" id="kobo.136.2">If you haven’t installed Django yet, the following is a quick guide to installing it on your machine.</span></p>
<h2 class="heading-2" id="_idParaDest-24"><span class="koboSpan" id="kobo.137.1">Installing Django with pip</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.138.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.139.1">pip</span></code><span class="koboSpan" id="kobo.140.1"> package </span><a id="_idIndexMarker006"/><span class="koboSpan" id="kobo.141.1">management system is the preferred method of installing </span><a id="_idIndexMarker007"/><span class="koboSpan" id="kobo.142.1">Django. </span><span class="koboSpan" id="kobo.142.2">Python 3.12 comes with </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1">pip</span></code><span class="koboSpan" id="kobo.144.1"> preinstalled, but you can find </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1">pip</span></code><span class="koboSpan" id="kobo.146.1"> installation instructions at </span><a href="https://pip.pypa.io/en/stable/installation/"><span class="url"><span class="koboSpan" id="kobo.147.1">https://pip.pypa.io/en/stable/installation/</span></span></a><span class="koboSpan" id="kobo.148.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.149.1">Run the following command at the shell prompt to install Django with </span><code class="inlineCode"><span class="koboSpan" id="kobo.150.1">pip</span></code><span class="koboSpan" id="kobo.151.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.152.1">python -m pip install Django~=5.0.4
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.153.1">This will install Django’s latest 5.0 version in the Python </span><code class="inlineCode"><span class="koboSpan" id="kobo.154.1">site-packages</span></code><span class="koboSpan" id="kobo.155.1"> directory of your virtual environment.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.156.1">Now we will check whether Django has been successfully installed. </span><span class="koboSpan" id="kobo.156.2">Run the following command in a shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.157.1">python -m django --version
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.158.1">If you get an output that starts with </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">5.0</span></code><span class="koboSpan" id="kobo.160.1">, Django has been successfully installed on your machine. </span><span class="koboSpan" id="kobo.160.2">If you get the message </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">No module named Django</span></code><span class="koboSpan" id="kobo.162.1">, Django is not installed on your machine. </span><span class="koboSpan" id="kobo.162.2">If you have issues installing Django, you can review the different installation options described at </span><a href="https://docs.djangoproject.com/en/5.0/intro/install/"><span class="url"><span class="koboSpan" id="kobo.163.1">https://docs.djangoproject.com/en/5.0/intro/install/</span></span></a><span class="koboSpan" id="kobo.164.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.165.1">All Python packages used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.166.1">requirements.txt</span></code><span class="koboSpan" id="kobo.167.1"> file in the source code for the chapter, mentioned above. </span><span class="koboSpan" id="kobo.167.2">You can follow the instructions to install each Python package in the following sections, or you can install all requirements at once with</span><a id="_idIndexMarker008"/><span class="koboSpan" id="kobo.168.1"> the </span><a id="_idIndexMarker009"/><span class="koboSpan" id="kobo.169.1">command </span><code class="inlineCode"><span class="koboSpan" id="kobo.170.1">pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.171.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-25"><span class="koboSpan" id="kobo.172.1">Django overview</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.173.1">Django is a framework </span><a id="_idIndexMarker010"/><span class="koboSpan" id="kobo.174.1">consisting of a set of components that solve common web development problems. </span><span class="koboSpan" id="kobo.174.2">Django components are loosely coupled, which means they can be managed independently. </span><span class="koboSpan" id="kobo.174.3">This helps separate the responsibilities of the different layers of the framework; the database layer knows nothing about how the data is displayed, the template system knows nothing about web requests, and so on.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.175.1">Django offers maximum code reusability by</span><a id="_idIndexMarker011"/><span class="koboSpan" id="kobo.176.1"> following the </span><strong class="keyWord"><span class="koboSpan" id="kobo.177.1">DRY</span></strong><span class="koboSpan" id="kobo.178.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.179.1">don’t repeat yourself</span></strong><span class="koboSpan" id="kobo.180.1">) principle. </span><span class="koboSpan" id="kobo.180.2">Django also fosters rapid development and allows you to use less code by taking advantage of Python’s dynamic capabilities, such as introspection.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.181.1">You can read more about Django’s design philosophies at </span><a href="https://docs.djangoproject.com/en/5.0/misc/design-philosophies/"><span class="url"><span class="koboSpan" id="kobo.182.1">https://docs.djangoproject.com/en/5.0/misc/design-philosophies/</span></span></a><span class="koboSpan" id="kobo.183.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-26"><span class="koboSpan" id="kobo.184.1">Main framework components</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.185.1">Django </span><a id="_idIndexMarker012"/><span class="koboSpan" id="kobo.186.1">follows the </span><strong class="keyWord"><span class="koboSpan" id="kobo.187.1">MTV</span></strong><span class="koboSpan" id="kobo.188.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.189.1">Model-Template-View</span></strong><span class="koboSpan" id="kobo.190.1">) pattern. </span><span class="koboSpan" id="kobo.190.2">It is a </span><a id="_idIndexMarker013"/><span class="koboSpan" id="kobo.191.1">slightly similar pattern to the well-known </span><strong class="keyWord"><span class="koboSpan" id="kobo.192.1">MVC</span></strong><span class="koboSpan" id="kobo.193.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.194.1">Model-View-Controller</span></strong><span class="koboSpan" id="kobo.195.1">) pattern, where</span><a id="_idIndexMarker014"/><span class="koboSpan" id="kobo.196.1"> the template acts as the view and the framework itself acts as the controller.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.197.1">The responsibilities in the Django MTV pattern are divided as follows:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.198.1">Model</span></strong><span class="koboSpan" id="kobo.199.1">: This defines the logical data structure and is the data handler between the database and the view.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.200.1">Template</span></strong><span class="koboSpan" id="kobo.201.1">: This is the presentation layer. </span><span class="koboSpan" id="kobo.201.2">Django uses a plain-text template system that keeps everything that the browser renders.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.202.1">View</span></strong><span class="koboSpan" id="kobo.203.1">: This communicates with the database via the model and transfers the data to the template for viewing.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.204.1">The framework itself acts as the controller. </span><span class="koboSpan" id="kobo.204.2">It sends a request to the appropriate view, according to the Django </span><strong class="keyWord"><span class="koboSpan" id="kobo.205.1">URL</span></strong><span class="koboSpan" id="kobo.206.1"> configuration.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.207.1">When developing any Django project, you will always work with models, views, templates, and</span><a id="_idIndexMarker015"/><span class="koboSpan" id="kobo.208.1"> URLs. </span><span class="koboSpan" id="kobo.208.2">In this chapter, you will learn how they fit together.</span></p>
<h2 class="heading-2" id="_idParaDest-27"><span class="koboSpan" id="kobo.209.1">The Django architecture</span></h2>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.210.1">Figure 1.1</span></em><span class="koboSpan" id="kobo.211.1"> shows how </span><a id="_idIndexMarker016"/><span class="koboSpan" id="kobo.212.1">Django processes requests and how the request/response cycle is managed with the different main Django components – URLs, views, models, and templates:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.213.1"><img alt="Diagram  Description automatically generated" src="../Images/B21088_01_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.214.1">Figure 1.1: The Django architecture</span></p>
<p class="normal"><span class="koboSpan" id="kobo.215.1">This is how Django handles HTTP requests and generates responses:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.216.1">A web browser requests a page by its URL and the web server passes the HTTP request to Django.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.217.1">Django runs through its configured URL patterns and stops at the first one that matches the requested URL.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.218.1">Django executes the view that corresponds to the matched URL pattern.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.219.1">The view potentially uses data models to retrieve information from the database.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.220.1">Data models provide data definitions and behaviors. </span><span class="koboSpan" id="kobo.220.2">They are used to query the database.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.221.1">The view renders a template (usually HTML) to display the data and returns it with an HTTP response.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.222.1">We will get back to the Django request/response cycle at the end of this chapter in the </span><em class="italic"><span class="koboSpan" id="kobo.223.1">The request/response cycle</span></em><span class="koboSpan" id="kobo.224.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.225.1">Django also includes hooks in the request/response process, which are called middleware. </span><span class="koboSpan" id="kobo.225.2">Middleware has been intentionally left out of this diagram for the sake of simplicity. </span><span class="koboSpan" id="kobo.225.3">You will use middleware in different examples of this book, and you will learn how to create custom middleware in </span><em class="italic"><span class="koboSpan" id="kobo.226.1">Chapter 17</span></em><span class="koboSpan" id="kobo.227.1">, </span><em class="italic"><span class="koboSpan" id="kobo.228.1">Going Live</span></em><span class="koboSpan" id="kobo.229.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.230.1">We have covered </span><a id="_idIndexMarker017"/><span class="koboSpan" id="kobo.231.1">the foundational elements of Django and how it processes requests. </span><span class="koboSpan" id="kobo.231.2">Let’s explore the new features introduced in Django 5.</span></p>
<h2 class="heading-2" id="_idParaDest-28"><span class="koboSpan" id="kobo.232.1">New features in Django 5</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.233.1">Django 5 introduces </span><a id="_idIndexMarker018"/><span class="koboSpan" id="kobo.234.1">several key features that you will use in the examples of this book. </span><span class="koboSpan" id="kobo.234.2">This version also deprecates certain features and eliminates previously deprecated functionalities. </span><span class="koboSpan" id="kobo.234.3">Django 5.0 presents the following new major features:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.235.1">Facet filters in the administration site</span></strong><span class="koboSpan" id="kobo.236.1">: Facet filters can be added now to the administration site. </span><span class="koboSpan" id="kobo.236.2">When enabled, facet counts are displayed for applied filters in the admin object list. </span><span class="koboSpan" id="kobo.236.3">This feature is presented in the </span><em class="italic"><span class="koboSpan" id="kobo.237.1">Added facet counts to filters</span></em><span class="koboSpan" id="kobo.238.1"> section of this chapter.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.239.1">Simplified templates for form field rendering</span></strong><span class="koboSpan" id="kobo.240.1">: Form field rendering has been simplified with the capability to define field groups with associated templates. </span><span class="koboSpan" id="kobo.240.2">This aims to make the process of rendering related elements of a Django form field, such as labels, widgets, help text, and errors, more streamlined. </span><span class="koboSpan" id="kobo.240.3">An example of using field groups can be found in the </span><em class="italic"><span class="koboSpan" id="kobo.241.1">Creating templates for the comment form</span></em><span class="koboSpan" id="kobo.242.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.243.1">Chapter 2, Enhancing Your Blog and Adding Social Features</span></em><span class="koboSpan" id="kobo.244.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.245.1">Database-computed default values</span></strong><span class="koboSpan" id="kobo.246.1">: Django adds database-computed default values. </span><span class="koboSpan" id="kobo.246.2">An example of this feature is presented in the </span><em class="italic"><span class="koboSpan" id="kobo.247.1">Adding datetime fields</span></em><span class="koboSpan" id="kobo.248.1"> section of this chapter.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.249.1">Database-generated model fields</span></strong><span class="koboSpan" id="kobo.250.1">: This is a new type of field that enables you to create database-generated columns. </span><span class="koboSpan" id="kobo.250.2">An expression is used to automatically set the field value each time the model is changed. </span><span class="koboSpan" id="kobo.250.3">The field value is set using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.251.1">GENERATED</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.252.1">ALWAYS</span></code><span class="koboSpan" id="kobo.253.1"> SQL syntax.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.254.1">More options for declaring model field choices</span></strong><span class="koboSpan" id="kobo.255.1">: Fields that support choices no longer require accessing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">.choices</span></code><span class="koboSpan" id="kobo.257.1"> attribute to access enumeration types. </span><span class="koboSpan" id="kobo.257.2">A mapping or callable instead of an iterable can be used directly to expand enumeration types. </span><span class="koboSpan" id="kobo.257.3">Choices with enumeration types in this book have been updated to reflect these changes. </span><span class="koboSpan" id="kobo.257.4">An instance of this can be found in </span><a id="_idIndexMarker019"/><span class="koboSpan" id="kobo.258.1">the </span><em class="italic"><span class="koboSpan" id="kobo.259.1">Adding a status field</span></em><span class="koboSpan" id="kobo.260.1"> section of this chapter.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.261.1">Django 5 also comes with some improvements in asynchronous support</span><strong class="keyWord"><span class="koboSpan" id="kobo.262.1">. </span><span class="koboSpan" id="kobo.262.2">Asynchronous Server Gateway Interface</span></strong><span class="koboSpan" id="kobo.263.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.264.1">ASGI</span></strong><span class="koboSpan" id="kobo.265.1">) support</span><a id="_idIndexMarker020"/><span class="koboSpan" id="kobo.266.1"> was first introduced in Django 3 and improved in Django 4.1 with asynchronous handlers for class-based views and an asynchronous ORM interface. </span><span class="koboSpan" id="kobo.266.2">Django 5 adds asynchronous functions to the authentication framework, provides support for asynchronous signal dispatching, and adds asynchronous support to multiple built-in decorators.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.267.1">Django 5.0 drops support for Python 3.8 and 3.9.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.268.1">You can read the complete list of changes in the Django 5.0 release notes at </span><a href="https://docs.djangoproject.com/en/5.0/releases/5.0/"><span class="url"><span class="koboSpan" id="kobo.269.1">https://docs.djangoproject.com/en/5.0/releases/5.0/</span></span></a><span class="koboSpan" id="kobo.270.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.271.1">As a time-based release, there are no drastic changes in Django 5, making it straightforward to upgrade Django 4 applications to the 5.0 release.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.272.1">If you want to quickly upgrade an existing Django project to the 5.0 release, you can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.273.1">django-upgrade</span></code><span class="koboSpan" id="kobo.274.1"> tool. </span><span class="koboSpan" id="kobo.274.2">This package rewrites the files of your project by applying fixers up to a target version. </span><span class="koboSpan" id="kobo.274.3">You can find instructions to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.275.1">django-upgrade</span></code><span class="koboSpan" id="kobo.276.1"> at </span><a href="https://github.com/adamchainz/django-upgrade"><span class="url"><span class="koboSpan" id="kobo.277.1">https://github.com/adamchainz/django-upgrade</span></span></a><span class="koboSpan" id="kobo.278.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.279.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">django-upgrade</span></code><span class="koboSpan" id="kobo.281.1"> tool is inspired by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">pyupgrade</span></code><span class="koboSpan" id="kobo.283.1"> package. </span><span class="koboSpan" id="kobo.283.2">You can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.284.1">pyupgrade</span></code><span class="koboSpan" id="kobo.285.1"> to automatically upgrade syntax for newer versions of Python. </span><span class="koboSpan" id="kobo.285.2">You can find more information </span><a id="_idIndexMarker021"/><span class="koboSpan" id="kobo.286.1">about </span><code class="inlineCode"><span class="koboSpan" id="kobo.287.1">pyupgrade</span></code><span class="koboSpan" id="kobo.288.1"> at </span><a href="https://github.com/asottile/pyupgrade"><span class="url"><span class="koboSpan" id="kobo.289.1">https://github.com/asottile/pyupgrade</span></span></a><span class="koboSpan" id="kobo.290.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-29"><span class="koboSpan" id="kobo.291.1">Creating your first project</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.292.1">Your first Django</span><a id="_idIndexMarker022"/><span class="koboSpan" id="kobo.293.1"> project will consist of a blog application. </span><span class="koboSpan" id="kobo.293.2">This will offer you a solid introduction to Django’s capabilities and functionalities.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.294.1">Blogging is the perfect starting point to build a complete Django project, given its wide range of required features, from basic content management to advanced functionalities like commenting, post sharing, search, and post recommendations. </span><span class="koboSpan" id="kobo.294.2">The blog project will be covered in the first three chapters of this book.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.295.1">In this chapter, we will start by creating the Django project and a Django application for the blog. </span><span class="koboSpan" id="kobo.295.2">We will then create our data models and synchronize them to the database. </span><span class="koboSpan" id="kobo.295.3">Finally, we will create an administration site for the blog, and we will build the views, templates, and URLs.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.296.1">Figure 1.2</span></em><span class="koboSpan" id="kobo.297.1"> shows a representation of the blog application pages that you will create:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.298.1"><img alt="" role="presentation" src="../Images/B21088_01_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.299.1">Figure 1.2: Diagram of functionalities built in Chapter 1</span></p>
<p class="normal"><span class="koboSpan" id="kobo.300.1">The blog application will consist of a list of posts including the post title, publishing date, author, a post excerpt, and a link to read the post. </span><span class="koboSpan" id="kobo.300.2">The post list page will be implemented with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.301.1">post_list</span></code><span class="koboSpan" id="kobo.302.1"> view. </span><span class="koboSpan" id="kobo.302.2">You will learn how to create views in this chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.303.1">When readers click on the link of a post in the post list page, they will be redirected to a single (detail) view of a post. </span><span class="koboSpan" id="kobo.303.2">The detail view will display the title, publishing date, author, and the complete post body.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.304.1">Let’s start by creating the Django project for our blog. </span><span class="koboSpan" id="kobo.304.2">Django provides a command that allows you to create an initial project file structure.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.305.1">Run the following command in your shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.306.1">django-admin startproject mysite
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.307.1">This will create a</span><a id="_idIndexMarker023"/><span class="koboSpan" id="kobo.308.1"> Django project with the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.309.1">mysite</span></code><span class="koboSpan" id="kobo.310.1">.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.311.1">Avoid naming projects after built-in Python or Django modules in order to prevent conflicts.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.312.1">Let’s take a look at the generated project structure:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.313.1">mysite/
    manage.py
    mysite/
      __init__.py
      asgi.py
      settings.py
      urls.py
      wsgi.py
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.314.1">The outer </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">mysite/</span></code><span class="koboSpan" id="kobo.316.1"> directory is the container for our project. </span><span class="koboSpan" id="kobo.316.2">It contains the following files:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">manage.py</span></code><span class="koboSpan" id="kobo.318.1">: This is a command-line utility used to interact with your project. </span><span class="koboSpan" id="kobo.318.2">You won’t usually need to edit this file.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.319.1">mysite/</span></code><span class="koboSpan" id="kobo.320.1">: This is the Python package for your project, which consists of the following files:</span><ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">__init__.py</span></code><span class="koboSpan" id="kobo.322.1">: An empty file that tells Python to treat the </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">mysite</span></code><span class="koboSpan" id="kobo.324.1"> directory as a Python module.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.325.1">asgi.py</span></code><span class="koboSpan" id="kobo.326.1">: This is the configuration to run your project as an ASGI application with ASGI-compatible web servers. </span><span class="koboSpan" id="kobo.326.2">ASGI is the emerging Python standard for asynchronous web servers and applications.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.327.1">settings.py</span></code><span class="koboSpan" id="kobo.328.1">: This indicates settings and configuration for your project and contains initial default settings.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.329.1">urls.py</span></code><span class="koboSpan" id="kobo.330.1">: This is the place where your URL patterns live. </span><span class="koboSpan" id="kobo.330.2">Each URL defined here is mapped to a view.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.331.1">wsgi.py</span></code><span class="koboSpan" id="kobo.332.1">: This is</span><a id="_idIndexMarker024"/><span class="koboSpan" id="kobo.333.1"> the configuration to run your project as a </span><strong class="keyWord"><span class="koboSpan" id="kobo.334.1">Web Server Gateway Interface</span></strong><span class="koboSpan" id="kobo.335.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.336.1">WSGI</span></strong><span class="koboSpan" id="kobo.337.1">) application with WSGI-compatible</span><a id="_idIndexMarker025"/><span class="koboSpan" id="kobo.338.1"> web servers.</span></li>
</ul>
</li>
</ul>
<h2 class="heading-2" id="_idParaDest-30"><span class="koboSpan" id="kobo.339.1">Applying initial database migrations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.340.1">Django applications</span><a id="_idIndexMarker026"/><span class="koboSpan" id="kobo.341.1"> require a database to store data. </span><span class="koboSpan" id="kobo.341.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.342.1">settings.py</span></code><span class="koboSpan" id="kobo.343.1"> file contains the database configuration for your project in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1">DATABASES</span></code><span class="koboSpan" id="kobo.345.1"> setting. </span><span class="koboSpan" id="kobo.345.2">The default configuration is a SQLite3 database. </span><span class="koboSpan" id="kobo.345.3">SQLite comes bundled with Python 3 and can be used in any of your Python applications. </span><span class="koboSpan" id="kobo.345.4">SQLite is a lightweight database that you can use with Django for development. </span><span class="koboSpan" id="kobo.345.5">If you plan to deploy your application in a production environment, you should use a full-featured database, such as PostgreSQL, MySQL, or Oracle. </span><span class="koboSpan" id="kobo.345.6">You can find more information about how to get your database running with Django at </span><a href="https://docs.djangoproject.com/en/5.0/topics/install/#database-installation"><span class="url"><span class="koboSpan" id="kobo.346.1">https://docs.djangoproject.com/en/5.0/topics/install/#database-installation</span></span></a><span class="koboSpan" id="kobo.347.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.348.1">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.349.1">settings.py</span></code><span class="koboSpan" id="kobo.350.1"> file also includes a list named </span><code class="inlineCode"><span class="koboSpan" id="kobo.351.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.352.1"> that contains common Django applications that are added to your project by default. </span><span class="koboSpan" id="kobo.352.2">We will go through these applications later in the </span><em class="italic"><span class="koboSpan" id="kobo.353.1">Project settings</span></em><span class="koboSpan" id="kobo.354.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.355.1">Django applications contain data models that are mapped to database tables. </span><span class="koboSpan" id="kobo.355.2">You will create your own models in the </span><em class="italic"><span class="koboSpan" id="kobo.356.1">Creating the blog data models</span></em><span class="koboSpan" id="kobo.357.1"> section. </span><span class="koboSpan" id="kobo.357.2">To complete the project setup, you need to create the tables associated with the models of the default Django applications included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.358.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.359.1"> setting. </span><span class="koboSpan" id="kobo.359.2">Django comes with a system that helps you manage database migrations.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.360.1">Open the shell prompt and run the following commands:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.361.1">cd mysite
python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.362.1">You will see an output that ends with the following lines:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.363.1">Applying contenttypes.0001_initial... </span><span class="koboSpan" id="kobo.363.2">OK
Applying auth.0001_initial... </span><span class="koboSpan" id="kobo.363.3">OK
Applying admin.0001_initial... </span><span class="koboSpan" id="kobo.363.4">OK
Applying admin.0002_logentry_remove_auto_add... </span><span class="koboSpan" id="kobo.363.5">OK
Applying admin.0003_logentry_add_action_flag_choices... </span><span class="koboSpan" id="kobo.363.6">OK
Applying contenttypes.0002_remove_content_type_name... </span><span class="koboSpan" id="kobo.363.7">OK
Applying auth.0002_alter_permission_name_max_length... </span><span class="koboSpan" id="kobo.363.8">OK
Applying auth.0003_alter_user_email_max_length... </span><span class="koboSpan" id="kobo.363.9">OK
Applying auth.0004_alter_user_username_opts... </span><span class="koboSpan" id="kobo.363.10">OK
Applying auth.0005_alter_user_last_login_null... </span><span class="koboSpan" id="kobo.363.11">OK
Applying auth.0006_require_contenttypes_0002... </span><span class="koboSpan" id="kobo.363.12">OK
Applying auth.0007_alter_validators_add_error_messages... </span><span class="koboSpan" id="kobo.363.13">OK
Applying auth.0008_alter_user_username_max_length... </span><span class="koboSpan" id="kobo.363.14">OK
Applying auth.0009_alter_user_last_name_max_length... </span><span class="koboSpan" id="kobo.363.15">OK
Applying auth.0010_alter_group_name_max_length... </span><span class="koboSpan" id="kobo.363.16">OK
Applying auth.0011_update_proxy_permissions... </span><span class="koboSpan" id="kobo.363.17">OK
Applying auth.0012_alter_user_first_name_max_length... </span><span class="koboSpan" id="kobo.363.18">OK
Applying sessions.0001_initial... </span><span class="koboSpan" id="kobo.363.19">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.364.1">The preceding lines are the database migrations that are applied by Django. </span><span class="koboSpan" id="kobo.364.2">By applying the initial migrations, the tables for the applications listed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.365.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.366.1"> setting are created in</span><a id="_idIndexMarker027"/><span class="koboSpan" id="kobo.367.1"> the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.368.1">You will learn more about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">migrate</span></code><span class="koboSpan" id="kobo.370.1"> management command in the </span><em class="italic"><span class="koboSpan" id="kobo.371.1">Creating and applying migrations</span></em><span class="koboSpan" id="kobo.372.1"> section of this chapter.</span></p>
<h2 class="heading-2" id="_idParaDest-31"><span class="koboSpan" id="kobo.373.1">Running the development server</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.374.1">Django comes with</span><a id="_idIndexMarker028"/><span class="koboSpan" id="kobo.375.1"> a lightweight web server to run your code quickly, without needing to spend time configuring a production server. </span><span class="koboSpan" id="kobo.375.2">When you run the Django development server, it keeps checking for changes in your code. </span><span class="koboSpan" id="kobo.375.3">It reloads automatically, freeing you from manually reloading it after code changes. </span><span class="koboSpan" id="kobo.375.4">However, it might not notice some actions, such as adding new files to your project, so you will have to restart the server manually in these cases.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.376.1">Start the development server by typing the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.377.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.378.1">You should see something like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.379.1">Watching for file changes with StatReloader
Performing system checks...
</span><span class="koboSpan" id="kobo.379.2">System check identified no issues (0 silenced).
</span><span class="koboSpan" id="kobo.379.3">January 01, 2024 - 10:00:00
Django version 5.0, using settings 'mysite.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.380.1">Now, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.381.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.382.1"> in your browser. </span><span class="koboSpan" id="kobo.382.2">You should see a page stating that the project is </span><a id="_idIndexMarker029"/><span class="koboSpan" id="kobo.383.1">successfully running, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.384.1">Figure 1.3</span></em><span class="koboSpan" id="kobo.385.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.386.1"><img alt="" role="presentation" src="../Images/B21088_01_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.387.1">Figure 1.3: The default page of the Django development server</span></p>
<p class="normal"><span class="koboSpan" id="kobo.388.1">The preceding screenshot indicates that Django is running. </span><span class="koboSpan" id="kobo.388.2">If you take a look at your console, you will see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">GET</span></code><span class="koboSpan" id="kobo.390.1"> request performed by your browser:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.391.1">[01/Jan/2024 10:00:15] "GET / HTTP/1.1" 200 16351
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.392.1">Each HTTP request is logged in the console by the development server. </span><span class="koboSpan" id="kobo.392.2">Any error that occurs while running the development server will also appear in the console.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.393.1">You can run the Django development server on a custom host and port or tell Django to load a specific settings file, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.394.1">python manage.py runserver 127.0.0.1:8001 --settings=mysite.settings
</span></code></pre>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.395.1">When you have to deal with multiple environments that require different configurations, you can create a different settings file for each environment.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.396.1">This server is only intended for development and is not suitable for production use. </span><span class="koboSpan" id="kobo.396.2">To deploy Django in a production environment, you should run it as a WSGI application using a web server, such as Apache, Gunicorn, or uWSGI, or as an ASGI application using a server such as Daphne </span><a id="_idIndexMarker030"/><span class="koboSpan" id="kobo.397.1">or Uvicorn. </span><span class="koboSpan" id="kobo.397.2">You can find more information on how to deploy Django with different web servers at </span><a href="https://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/"><span class="url"><span class="koboSpan" id="kobo.398.1">https://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/</span></span></a><span class="koboSpan" id="kobo.399.1">.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.400.1">Chapter 17</span></em><span class="koboSpan" id="kobo.401.1">, </span><em class="italic"><span class="koboSpan" id="kobo.402.1">Going Live</span></em><span class="koboSpan" id="kobo.403.1">, explains how to set up a production environment for your Django projects.</span></p>
<h2 class="heading-2" id="_idParaDest-32"><span class="koboSpan" id="kobo.404.1">Project settings</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.405.1">Let’s open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.406.1">settings.py</span></code><span class="koboSpan" id="kobo.407.1"> file </span><a id="_idIndexMarker031"/><span class="koboSpan" id="kobo.408.1">and take a look at the configuration of the project. </span><span class="koboSpan" id="kobo.408.2">There are several settings that Django includes in this file, but these are only part of all the available Django settings. </span><span class="koboSpan" id="kobo.408.3">You can see all the settings and their default values at </span><a href="https://docs.djangoproject.com/en/5.0/ref/settings/"><span class="url"><span class="koboSpan" id="kobo.409.1">https://docs.djangoproject.com/en/5.0/ref/settings/</span></span></a><span class="koboSpan" id="kobo.410.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.411.1">Let’s review some of the project settings:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.412.1">DEBUG</span></code><span class="koboSpan" id="kobo.413.1"> is a Boolean that turns the debug mode of the project on and off. </span><span class="koboSpan" id="kobo.413.2">If it is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1">True</span></code><span class="koboSpan" id="kobo.415.1">, Django will display detailed error pages when an uncaught exception is thrown by your application. </span><span class="koboSpan" id="kobo.415.2">When you move to a production environment, remember that you have to set it to </span><code class="inlineCode"><span class="koboSpan" id="kobo.416.1">False</span></code><span class="koboSpan" id="kobo.417.1">. </span><span class="koboSpan" id="kobo.417.2">Never deploy a site into production with </span><code class="inlineCode"><span class="koboSpan" id="kobo.418.1">DEBUG</span></code><span class="koboSpan" id="kobo.419.1"> turned on because you will expose sensitive project-related data.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.420.1">ALLOWED_HOSTS</span></code><span class="koboSpan" id="kobo.421.1"> is not applied while debug mode is on or when the tests are run. </span><span class="koboSpan" id="kobo.421.2">Once you move your site to production and set </span><code class="inlineCode"><span class="koboSpan" id="kobo.422.1">DEBUG</span></code><span class="koboSpan" id="kobo.423.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">False</span></code><span class="koboSpan" id="kobo.425.1">, you will have to add your domain/host to this setting to allow it to serve your Django site.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.426.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.427.1"> is a setting you will have to edit for all projects. </span><span class="koboSpan" id="kobo.427.2">This setting tells Django which applications are active for this site. </span><span class="koboSpan" id="kobo.427.3">By default, Django includes the following applications:</span><ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.428.1">django.contrib.admin</span></code><span class="koboSpan" id="kobo.429.1">: An administration site.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.430.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.431.1">: An authentication framework.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">django.contrib.contenttypes</span></code><span class="koboSpan" id="kobo.433.1">: A framework for handling content types.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.434.1">django.contrib.sessions</span></code><span class="koboSpan" id="kobo.435.1">: A session framework.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.436.1">django.contrib.messages</span></code><span class="koboSpan" id="kobo.437.1">: A messaging framework.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">django.contrib.staticfiles</span></code><span class="koboSpan" id="kobo.439.1">: A framework for managing static files, such as CSS, JavaScript files, and images.</span></li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.441.1"> is a list that contains middleware to be executed.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.442.1">ROOT_URLCONF</span></code><span class="koboSpan" id="kobo.443.1"> indicates the Python module where the root URL patterns of your application are defined.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.444.1">DATABASES</span></code><span class="koboSpan" id="kobo.445.1"> is a dictionary that contains the settings for all the databases to be used in the project. </span><span class="koboSpan" id="kobo.445.2">There must always be a default database. </span><span class="koboSpan" id="kobo.445.3">The default configuration uses a SQLite3 database.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.446.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.447.1"> defines the default language code for this Django site.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.448.1">USE_TZ</span></code><span class="koboSpan" id="kobo.449.1"> tells Django to activate/deactivate timezone support. </span><span class="koboSpan" id="kobo.449.2">Django comes with support for timezone-aware datetimes. </span><span class="koboSpan" id="kobo.449.3">This setting is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.450.1">True</span></code><span class="koboSpan" id="kobo.451.1"> when you create a new project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.452.1">startproject</span></code><span class="koboSpan" id="kobo.453.1"> management command.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.454.1">Don’t worry if </span><a id="_idIndexMarker032"/><span class="koboSpan" id="kobo.455.1">you don’t understand much about what you’re seeing here. </span><span class="koboSpan" id="kobo.455.2">You will learn more about the different Django settings in the following chapters.</span></p>
<h2 class="heading-2" id="_idParaDest-33"><span class="koboSpan" id="kobo.456.1">Projects and applications</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.457.1">Throughout this </span><a id="_idIndexMarker033"/><span class="koboSpan" id="kobo.458.1">book, you will encounter the terms </span><strong class="keyWord"><span class="koboSpan" id="kobo.459.1">project</span></strong><span class="koboSpan" id="kobo.460.1"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.461.1">application</span></strong><span class="koboSpan" id="kobo.462.1"> over and over. </span><span class="koboSpan" id="kobo.462.2">In Django, a project is considered a Django installation with some settings. </span><span class="koboSpan" id="kobo.462.3">An application is a group of models, views, templates, and URLs. </span><span class="koboSpan" id="kobo.462.4">Applications interact with the framework to provide specific functionalities and may be reused in various projects. </span><span class="koboSpan" id="kobo.462.5">You can think of a project as your website, which contains several applications, such as a blog, wiki, or forum, that can also be used by other Django projects.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.463.1">Figure 1.4</span></em><span class="koboSpan" id="kobo.464.1"> shows the structure of a Django project:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.465.1"><img alt="" role="presentation" src="../Images/B21088_01_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.466.1">Figure 1.4: The Django project/application structure</span></p>
<h2 class="heading-2" id="_idParaDest-34"><span class="koboSpan" id="kobo.467.1">Creating an application</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.468.1">Let’s create our first</span><a id="_idIndexMarker034"/><span class="koboSpan" id="kobo.469.1"> Django application. </span><span class="koboSpan" id="kobo.469.2">We will build a blog application from scratch.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.470.1">Run the following command in the shell prompt from the project’s root directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.471.1">python manage.py startapp blog
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.472.1">This will create the basic structure of the application, which will look like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.473.1">blog/
    __init__.py
    admin.py
    apps.py
    migrations/
        __init__.py
    models.py
    tests.py
    views.py
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.474.1">These files are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.475.1">__init__.py</span></code><span class="koboSpan" id="kobo.476.1">: This is an empty file that tells Python to treat the </span><code class="inlineCode"><span class="koboSpan" id="kobo.477.1">blog</span></code><span class="koboSpan" id="kobo.478.1"> directory as a Python module.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.479.1">admin.py</span></code><span class="koboSpan" id="kobo.480.1">: This is where you register models to include them in the Django administration site—using this site is optional.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.481.1">apps.py</span></code><span class="koboSpan" id="kobo.482.1">: This includes the main configuration of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.483.1">blog</span></code><span class="koboSpan" id="kobo.484.1"> application.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.485.1">migrations</span></code><span class="koboSpan" id="kobo.486.1">: This directory will contain database migrations of the application. </span><span class="koboSpan" id="kobo.486.2">Migrations allow Django to track your model changes and synchronize the database accordingly. </span><span class="koboSpan" id="kobo.486.3">This directory contains an empty </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">__init__.py</span></code><span class="koboSpan" id="kobo.488.1"> file.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">models.py</span></code><span class="koboSpan" id="kobo.490.1">: This includes the data models of your application; all Django applications need to have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">models.py</span></code><span class="koboSpan" id="kobo.492.1"> file but it can be left empty.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.493.1">tests.py</span></code><span class="koboSpan" id="kobo.494.1">: This is where you can add tests for your application.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.495.1">views.py</span></code><span class="koboSpan" id="kobo.496.1">: The logic of your application goes here; each view receives an HTTP</span><a id="_idIndexMarker035"/><span class="koboSpan" id="kobo.497.1"> request, processes it, and returns a response.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.498.1">With the application structure ready, we can start building the data models for the blog.</span></p>
<h1 class="heading-1" id="_idParaDest-35"><span class="koboSpan" id="kobo.499.1">Creating the blog data models</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.500.1">Remember that a </span><a id="_idIndexMarker036"/><span class="koboSpan" id="kobo.501.1">Python object is a collection of data and methods. </span><span class="koboSpan" id="kobo.501.2">Classes are the blueprint for bundling data and functionality together. </span><span class="koboSpan" id="kobo.501.3">Creating a new class creates a new type of object, allowing you to create instances of that type.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.502.1">A Django model is a source of information about the behaviors of your data. </span><span class="koboSpan" id="kobo.502.2">It consists of a Python class that subclasses </span><code class="inlineCode"><span class="koboSpan" id="kobo.503.1">django.db.models.Model</span></code><span class="koboSpan" id="kobo.504.1">. </span><span class="koboSpan" id="kobo.504.2">Each model maps to a single database table, where each attribute of the class represents a database field. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.505.1">When you create a model, Django will provide you with a practical API to query objects in the database easily.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.506.1">We will define the database models for our blog application. </span><span class="koboSpan" id="kobo.506.2">Then, we will generate the database migrations for the models to create the corresponding database tables. </span><span class="koboSpan" id="kobo.506.3">When applying the migrations, Django will create a table for each model defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.507.1">models.py</span></code><span class="koboSpan" id="kobo.508.1"> file of </span><a id="_idIndexMarker037"/><span class="koboSpan" id="kobo.509.1">the application.</span></p>
<h2 class="heading-2" id="_idParaDest-36"><span class="koboSpan" id="kobo.510.1">Creating the Post model</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.511.1">First, we will</span><a id="_idIndexMarker038"/><span class="koboSpan" id="kobo.512.1"> define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.513.1">Post</span></code><span class="koboSpan" id="kobo.514.1"> model that will allow us to store</span><a id="_idIndexMarker039"/><span class="koboSpan" id="kobo.515.1"> blog posts in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.516.1">Add the following lines to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.517.1">models.py</span></code><span class="koboSpan" id="kobo.518.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.519.1">blog</span></code><span class="koboSpan" id="kobo.520.1"> application. </span><span class="koboSpan" id="kobo.520.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.521.1">from</span></span><span class="koboSpan" id="kobo.522.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.523.1">import</span></span><span class="koboSpan" id="kobo.524.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.525.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.526.1">Post</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.527.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.528.1">    title = models.CharField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.529.1">250</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.530.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.531.1">    slug = models.SlugField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.532.1">250</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.533.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.534.1">    body = models.TextField()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.535.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.536.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.537.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.538.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.539.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.540.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.541.1"> self.title</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.542.1">This is the data model for blog posts. </span><span class="koboSpan" id="kobo.542.2">Posts will have a title, a short label called </span><code class="inlineCode"><span class="koboSpan" id="kobo.543.1">slug</span></code><span class="koboSpan" id="kobo.544.1">, and a body. </span><span class="koboSpan" id="kobo.544.2">Let’s take a look at the fields of this model:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">title</span></code><span class="koboSpan" id="kobo.546.1">: This is the field for the post title. </span><span class="koboSpan" id="kobo.546.2">This is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.547.1">CharField</span></code><span class="koboSpan" id="kobo.548.1"> field that translates into a </span><code class="inlineCode"><span class="koboSpan" id="kobo.549.1">VARCHAR</span></code><span class="koboSpan" id="kobo.550.1"> column in the SQL database.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.551.1">slug</span></code><span class="koboSpan" id="kobo.552.1">: This is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.553.1">SlugField</span></code><span class="koboSpan" id="kobo.554.1"> field that translates into a </span><code class="inlineCode"><span class="koboSpan" id="kobo.555.1">VARCHAR</span></code><span class="koboSpan" id="kobo.556.1"> column in the SQL database. </span><span class="koboSpan" id="kobo.556.2">A slug is a short label that contains only letters, numbers, underscores, or hyphens. </span><span class="koboSpan" id="kobo.556.3">A post with the title </span><em class="italic"><span class="koboSpan" id="kobo.557.1">Django Reinhardt: A legend of Jazz </span></em><span class="koboSpan" id="kobo.558.1">could have a slug like </span><em class="italic"><span class="koboSpan" id="kobo.559.1">django-reinhardt-legend-jazz</span></em><span class="koboSpan" id="kobo.560.1">. </span><span class="koboSpan" id="kobo.560.2">We will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.561.1">slug</span></code><span class="koboSpan" id="kobo.562.1"> field to build beautiful, SEO-friendly URLs for blog posts in </span><em class="italic"><span class="koboSpan" id="kobo.563.1">Chapter 2, Enhancing Your Blog with Advanced Features</span></em><span class="koboSpan" id="kobo.564.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.565.1">body</span></code><span class="koboSpan" id="kobo.566.1">: This is the field for storing the body of the post. </span><span class="koboSpan" id="kobo.566.2">This is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.567.1">TextField</span></code><span class="koboSpan" id="kobo.568.1"> field that translates into a </span><code class="inlineCode"><span class="koboSpan" id="kobo.569.1">TEXT</span></code><span class="koboSpan" id="kobo.570.1"> column in the SQL database.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.571.1">We have also added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.572.1">__str__()</span></code><span class="koboSpan" id="kobo.573.1"> method to the model class. </span><span class="koboSpan" id="kobo.573.2">This is the default Python method to return a string with the human-readable representation of the object. </span><span class="koboSpan" id="kobo.573.3">Django will use this method to display the name of the object in many places, such as the Django administration site.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.574.1">Let’s take a look at how the model and its fields will be translated into a database table and columns. </span><span class="koboSpan" id="kobo.574.2">The following diagram shows the </span><code class="inlineCode"><span class="koboSpan" id="kobo.575.1">Post</span></code><span class="koboSpan" id="kobo.576.1"> model and the corresponding database table that Django will create when we synchronize the model to the database:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.577.1"><img alt="" role="presentation" src="../Images/B21088_01_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.578.1">Figure 1.5: Initial Post model and database table correspondence</span></p>
<p class="normal"><span class="koboSpan" id="kobo.579.1">Django will create a database column for each of the model fields: </span><code class="inlineCode"><span class="koboSpan" id="kobo.580.1">title</span></code><span class="koboSpan" id="kobo.581.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.582.1">slug</span></code><span class="koboSpan" id="kobo.583.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.584.1">body</span></code><span class="koboSpan" id="kobo.585.1">. </span><span class="koboSpan" id="kobo.585.2">You can see how each field type corresponds to a database data type.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.586.1">By default, Django adds an auto-incrementing primary key field to each model. </span><span class="koboSpan" id="kobo.586.2">The field type for this field is specified in each application configuration or globally in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">DEFAULT_AUTO_FIELD</span></code><span class="koboSpan" id="kobo.588.1"> setting. </span><span class="koboSpan" id="kobo.588.2">When creating an application with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.589.1">startapp</span></code><span class="koboSpan" id="kobo.590.1"> command, the default value for </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">DEFAULT_AUTO_FIELD</span></code><span class="koboSpan" id="kobo.592.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">BigAutoField</span></code><span class="koboSpan" id="kobo.594.1">. </span><span class="koboSpan" id="kobo.594.2">This is a 64-bit integer that automatically increments according to available IDs. </span><span class="koboSpan" id="kobo.594.3">If you don’t specify a primary key for your model, Django adds this field automatically. </span><span class="koboSpan" id="kobo.594.4">You can also define one of the model fields to be the primary key by setting </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">primary_key=True</span></code><span class="koboSpan" id="kobo.596.1"> on it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.597.1">We will expand</span><a id="_idIndexMarker040"/><span class="koboSpan" id="kobo.598.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.599.1">Post</span></code><span class="koboSpan" id="kobo.600.1"> model with additional fields </span><a id="_idIndexMarker041"/><span class="koboSpan" id="kobo.601.1">and behaviors. </span><span class="koboSpan" id="kobo.601.2">Once complete, we will synchronize it to the database by creating a database migration and applying it.</span></p>
<h2 class="heading-2" id="_idParaDest-37"><span class="koboSpan" id="kobo.602.1">Adding datetime fields</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.603.1">We will continue</span><a id="_idIndexMarker042"/><span class="koboSpan" id="kobo.604.1"> by adding different datetime </span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.605.1">fields to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.606.1">Post</span></code><span class="koboSpan" id="kobo.607.1"> model. </span><span class="koboSpan" id="kobo.607.2">Each post will be published at a specific date and time. </span><span class="koboSpan" id="kobo.607.3">Therefore, we need a field to store the publication date and time. </span><span class="koboSpan" id="kobo.607.4">We also want to store the date and time when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.608.1">Post</span></code><span class="koboSpan" id="kobo.609.1"> object was created and when it was last modified.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.610.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.611.1">models.py</span></code><span class="koboSpan" id="kobo.612.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.613.1">blog</span></code><span class="koboSpan" id="kobo.614.1"> application to make it look like this; the new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.615.1">from</span></span><span class="koboSpan" id="kobo.616.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.617.1">import</span></span><span class="koboSpan" id="kobo.618.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.619.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.620.1"> django.utils </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.621.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.622.1"> timezone</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.623.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.624.1">Post</span></span><span class="koboSpan" id="kobo.625.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.626.1">250</span></span><span class="koboSpan" id="kobo.627.1">)
    slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.628.1">250</span></span><span class="koboSpan" id="kobo.629.1">)
    body = models.TextField()
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.630.1">    publish = models.DateTimeField(default=timezone.now)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.631.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.632.1">__str__</span></span><span class="koboSpan" id="kobo.633.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.634.1">self</span></span><span class="koboSpan" id="kobo.635.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.636.1">return</span></span><span class="koboSpan" id="kobo.637.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.638.1">We have added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1">publish</span></code><span class="koboSpan" id="kobo.640.1"> field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.641.1">Post</span></code><span class="koboSpan" id="kobo.642.1"> model. </span><span class="koboSpan" id="kobo.642.2">This is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.643.1">DateTimeField</span></code><span class="koboSpan" id="kobo.644.1"> field that translates into a </span><code class="inlineCode"><span class="koboSpan" id="kobo.645.1">DATETIME</span></code><span class="koboSpan" id="kobo.646.1"> column in the SQL database. </span><span class="koboSpan" id="kobo.646.2">We will use it to store the date and time when the post was published. </span><span class="koboSpan" id="kobo.646.3">We use Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.647.1">timezone.now</span></code><span class="koboSpan" id="kobo.648.1"> method as the default value for the field. </span><span class="koboSpan" id="kobo.648.2">Note that we imported the </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">timezone</span></code><span class="koboSpan" id="kobo.650.1"> module to use this method. </span><code class="inlineCode"><span class="koboSpan" id="kobo.651.1">timezone.now</span></code><span class="koboSpan" id="kobo.652.1"> returns the current datetime in a timezone-aware format. </span><span class="koboSpan" id="kobo.652.2">You can think of it as a timezone-aware version of the standard Python </span><code class="inlineCode"><span class="koboSpan" id="kobo.653.1">datetime.now</span></code><span class="koboSpan" id="kobo.654.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.655.1">Another method to</span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.656.1"> define default values for model fields is</span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.657.1"> using database-computed default values. </span><span class="koboSpan" id="kobo.657.2">Introduced in Django 5, this feature allows you to use underlaying database functions to generate default values. </span><span class="koboSpan" id="kobo.657.3">For instance, the following code uses the database server’s current date and time as the default for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">publish</span></code><span class="koboSpan" id="kobo.659.1"> field:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.660.1">from</span></span><span class="koboSpan" id="kobo.661.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.662.1">import</span></span><span class="koboSpan" id="kobo.663.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.664.1">from</span></span><span class="koboSpan" id="kobo.665.1"> django.db.models.functions </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.666.1">import</span></span><span class="koboSpan" id="kobo.667.1"> Now
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.668.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.669.1">Post</span></span><span class="koboSpan" id="kobo.670.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.671.1"># ...</span></span><span class="koboSpan" id="kobo.672.1">
    publish = models.DateTimeField(db_default=Now())
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.673.1">To use database-generated default values, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.674.1">db_default</span></code><span class="koboSpan" id="kobo.675.1"> attribute instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.676.1">default</span></code><span class="koboSpan" id="kobo.677.1">. </span><span class="koboSpan" id="kobo.677.2">In this example, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.678.1">Now</span></code><span class="koboSpan" id="kobo.679.1"> database function. </span><span class="koboSpan" id="kobo.679.2">It serves a similar purpose to </span><code class="inlineCode"><span class="koboSpan" id="kobo.680.1">default=timezone.now</span></code><span class="koboSpan" id="kobo.681.1">, but instead of a Python-generated datetime, it uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.682.1">NOW()</span></code><span class="koboSpan" id="kobo.683.1"> database function to produce the initial value. </span><span class="koboSpan" id="kobo.683.2">You can read more about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.684.1">db_default</span></code><span class="koboSpan" id="kobo.685.1"> attribute at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default"><span class="url"><span class="koboSpan" id="kobo.686.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default</span></span></a><span class="koboSpan" id="kobo.687.1">. </span><span class="koboSpan" id="kobo.687.2">You can find all available database functions at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/database-functions/"><span class="url"><span class="koboSpan" id="kobo.688.1">https://docs.djangoproject.com/en/5.0/ref/models/database-functions/</span></span></a><span class="koboSpan" id="kobo.689.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.690.1">Let’s continue with the previous version of the field:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.691.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.692.1">Post</span></span><span class="koboSpan" id="kobo.693.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.694.1"># ...</span></span><span class="koboSpan" id="kobo.695.1">
    publish = models.DateTimeField(default=timezone.now)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.696.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.697.1">models.py</span></code><span class="koboSpan" id="kobo.698.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.699.1">blog</span></code><span class="koboSpan" id="kobo.700.1"> application and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.701.1">from</span></span><span class="koboSpan" id="kobo.702.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.703.1">import</span></span><span class="koboSpan" id="kobo.704.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.705.1">from</span></span><span class="koboSpan" id="kobo.706.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.707.1">import</span></span><span class="koboSpan" id="kobo.708.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.709.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.710.1">Post</span></span><span class="koboSpan" id="kobo.711.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.712.1">250</span></span><span class="koboSpan" id="kobo.713.1">)
    slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.714.1">250</span></span><span class="koboSpan" id="kobo.715.1">)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.716.1">    created = models.DateTimeField(auto_now_add=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.717.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.718.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.719.1">    updated = models.DateTimeField(auto_now=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.720.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.721.1">)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.722.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.723.1">__str__</span></span><span class="koboSpan" id="kobo.724.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.725.1">self</span></span><span class="koboSpan" id="kobo.726.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.727.1">return</span></span><span class="koboSpan" id="kobo.728.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.729.1">We have </span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.730.1">added</span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.731.1"> the following fields to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.732.1">Post</span></code><span class="koboSpan" id="kobo.733.1"> model:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.734.1">created</span></code><span class="koboSpan" id="kobo.735.1">: This is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.736.1">DateTimeField</span></code><span class="koboSpan" id="kobo.737.1"> field. </span><span class="koboSpan" id="kobo.737.2">We will use it to store the date and time when the post was created. </span><span class="koboSpan" id="kobo.737.3">By using </span><code class="inlineCode"><span class="koboSpan" id="kobo.738.1">auto_now_add</span></code><span class="koboSpan" id="kobo.739.1">, the date will be saved automatically when creating an object.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.740.1">updated</span></code><span class="koboSpan" id="kobo.741.1">: This is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.742.1">DateTimeField</span></code><span class="koboSpan" id="kobo.743.1"> field. </span><span class="koboSpan" id="kobo.743.2">We will use it to store the last date and time when the post was updated. </span><span class="koboSpan" id="kobo.743.3">By using </span><code class="inlineCode"><span class="koboSpan" id="kobo.744.1">auto_now</span></code><span class="koboSpan" id="kobo.745.1">, the date will be updated automatically when saving an object.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.746.1">Utilizing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.747.1">auto_now_add</span></code><span class="koboSpan" id="kobo.748.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1">auto_now</span></code><span class="koboSpan" id="kobo.750.1"> datetime fields in your Django models is highly</span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.751.1"> beneficial for tracking the creation and last modification times of objects.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-38"><span class="koboSpan" id="kobo.752.1">Defining a default sort order</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.753.1">Blog posts are </span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.754.1">typically presented in reverse </span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.755.1">chronological order, showing the newest posts first. </span><span class="koboSpan" id="kobo.755.2">For our model, we will define a default ordering. </span><span class="koboSpan" id="kobo.755.3">This ordering takes effect when retrieving objects from the database unless a specific order is indicated in the query.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.756.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.757.1">models.py</span></code><span class="koboSpan" id="kobo.758.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.759.1">blog</span></code><span class="koboSpan" id="kobo.760.1"> application as shown below. </span><span class="koboSpan" id="kobo.760.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.761.1">from</span></span><span class="koboSpan" id="kobo.762.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.763.1">import</span></span><span class="koboSpan" id="kobo.764.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.765.1">from</span></span><span class="koboSpan" id="kobo.766.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.767.1">import</span></span><span class="koboSpan" id="kobo.768.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.769.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.770.1">Post</span></span><span class="koboSpan" id="kobo.771.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.772.1">250</span></span><span class="koboSpan" id="kobo.773.1">)
    slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.774.1">250</span></span><span class="koboSpan" id="kobo.775.1">)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.776.1">True</span></span><span class="koboSpan" id="kobo.777.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.778.1">True</span></span><span class="koboSpan" id="kobo.779.1">)
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.780.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.781.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.782.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.783.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.784.1">'-publish'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.785.1">]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.786.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.787.1">__str__</span></span><span class="koboSpan" id="kobo.788.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.789.1">self</span></span><span class="koboSpan" id="kobo.790.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.791.1">return</span></span><span class="koboSpan" id="kobo.792.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.793.1">We have added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.794.1">Meta</span></code><span class="koboSpan" id="kobo.795.1"> class inside the model. </span><span class="koboSpan" id="kobo.795.2">This class defines metadata for the model. </span><span class="koboSpan" id="kobo.795.3">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">ordering</span></code><span class="koboSpan" id="kobo.797.1"> attribute to tell Django that it should sort results by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.798.1">publish</span></code><span class="koboSpan" id="kobo.799.1"> field. </span><span class="koboSpan" id="kobo.799.2">This ordering will apply by default for database queries when no specific order is provided in the query. </span><span class="koboSpan" id="kobo.799.3">We indicate descending order by using a hyphen before the field name, </span><code class="inlineCode"><span class="koboSpan" id="kobo.800.1">-publish</span></code><span class="koboSpan" id="kobo.801.1">. </span><span class="koboSpan" id="kobo.801.2">Posts will be returned in reverse chronological order by default.</span></p>
<h2 class="heading-2" id="_idParaDest-39"><span class="koboSpan" id="kobo.802.1">Adding a database index</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.803.1">Let’s define a</span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.804.1"> database index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.805.1">publish</span></code><span class="koboSpan" id="kobo.806.1"> field. </span><span class="koboSpan" id="kobo.806.2">This </span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.807.1">will improve performance for query filtering or ordering results by this field. </span><span class="koboSpan" id="kobo.807.2">We expect many queries to take advantage of this index since we are using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.808.1">publish</span></code><span class="koboSpan" id="kobo.809.1"> field to order results by default.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.810.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">models.py</span></code><span class="koboSpan" id="kobo.812.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.813.1">blog</span></code><span class="koboSpan" id="kobo.814.1"> application and make it look like this; the new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.815.1">from</span></span><span class="koboSpan" id="kobo.816.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1">import</span></span><span class="koboSpan" id="kobo.818.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.819.1">from</span></span><span class="koboSpan" id="kobo.820.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.821.1">import</span></span><span class="koboSpan" id="kobo.822.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.823.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.824.1">Post</span></span><span class="koboSpan" id="kobo.825.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.826.1">250</span></span><span class="koboSpan" id="kobo.827.1">)
    slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.828.1">250</span></span><span class="koboSpan" id="kobo.829.1">)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.830.1">True</span></span><span class="koboSpan" id="kobo.831.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.832.1">True</span></span><span class="koboSpan" id="kobo.833.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.834.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.835.1">Meta</span></span><span class="koboSpan" id="kobo.836.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.837.1">'-publish'</span></span><span class="koboSpan" id="kobo.838.1">]
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.839.1">        indexes = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.840.1">            models.Index(fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.841.1">'-publish'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.842.1">]),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.843.1">        ]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.844.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.845.1">__str__</span></span><span class="koboSpan" id="kobo.846.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.847.1">self</span></span><span class="koboSpan" id="kobo.848.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.849.1">return</span></span><span class="koboSpan" id="kobo.850.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.851.1">We have added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.852.1">indexes</span></code><span class="koboSpan" id="kobo.853.1"> option to the model’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.854.1">Meta</span></code><span class="koboSpan" id="kobo.855.1"> class. </span><span class="koboSpan" id="kobo.855.2">This option allows you to define database indexes for your model, which could comprise one or multiple fields, in ascending or descending order, or functional expressions and database functions. </span><span class="koboSpan" id="kobo.855.3">We have added an index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.856.1">publish</span></code><span class="koboSpan" id="kobo.857.1"> field. </span><span class="koboSpan" id="kobo.857.2">We use a hyphen before the field name to define the index specifically in descending order. </span><span class="koboSpan" id="kobo.857.3">The creation of this index will be included in the database migrations that we will generate later for our blog models.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.858.1">Index ordering is not supported on MySQL. </span><span class="koboSpan" id="kobo.858.2">If you use MySQL for the database, a descending index will be created as a normal index.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.859.1">You can find </span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.860.1">more</span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.861.1"> information about how to define indexes for models at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/indexes/"><span class="url"><span class="koboSpan" id="kobo.862.1">https://docs.djangoproject.com/en/5.0/ref/models/indexes/</span></span></a><span class="koboSpan" id="kobo.863.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-40"><span class="koboSpan" id="kobo.864.1">Activating the application</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.865.1">We need to</span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.866.1"> activate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.867.1">blog</span></code><span class="koboSpan" id="kobo.868.1"> application in the project for Django to keep track of the application and be able to create database tables for its models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.869.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.870.1">settings.py</span></code><span class="koboSpan" id="kobo.871.1"> file and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.872.1">blog.apps.BlogConfig</span></code><span class="koboSpan" id="kobo.873.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.875.1"> setting. </span><span class="koboSpan" id="kobo.875.2">It should look like this; the new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.876.1">INSTALLED_APPS = [
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.877.1">'django.contrib.admin'</span></span><span class="koboSpan" id="kobo.878.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.879.1">'django.contrib.auth'</span></span><span class="koboSpan" id="kobo.880.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.881.1">'django.contrib.contenttypes'</span></span><span class="koboSpan" id="kobo.882.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.883.1">'django.contrib.sessions'</span></span><span class="koboSpan" id="kobo.884.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.885.1">'django.contrib.messages'</span></span><span class="koboSpan" id="kobo.886.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.887.1">'django.contrib.staticfiles'</span></span><span class="koboSpan" id="kobo.888.1">,
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.889.1">'blog.apps.BlogConfig'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.890.1">,</span></strong></span><span class="koboSpan" id="kobo.891.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.892.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.893.1">BlogConfig</span></code><span class="koboSpan" id="kobo.894.1"> class is the application configuration. </span><span class="koboSpan" id="kobo.894.2">Now Django knows that the application is</span><a id="_idIndexMarker056"/><span class="koboSpan" id="kobo.895.1"> active for this project and will be able to load the application models.</span></p>
<h2 class="heading-2" id="_idParaDest-41"><span class="koboSpan" id="kobo.896.1">Adding a status field</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.897.1">A common functionality </span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.898.1">for blogs is to save posts as a draft</span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.899.1"> until ready for publication. </span><span class="koboSpan" id="kobo.899.2">We will add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.900.1">status</span></code><span class="koboSpan" id="kobo.901.1"> field to our model that will allow us to manage the status of blog posts. </span><span class="koboSpan" id="kobo.901.2">We will be using the </span><em class="italic"><span class="koboSpan" id="kobo.902.1">Draft</span></em><span class="koboSpan" id="kobo.903.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.904.1">Published</span></em><span class="koboSpan" id="kobo.905.1"> statuses for posts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.906.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.907.1">models.py</span></code><span class="koboSpan" id="kobo.908.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.909.1">blog</span></code><span class="koboSpan" id="kobo.910.1"> application to make it look as follows. </span><span class="koboSpan" id="kobo.910.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.911.1">from</span></span><span class="koboSpan" id="kobo.912.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.913.1">import</span></span><span class="koboSpan" id="kobo.914.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.915.1">from</span></span><span class="koboSpan" id="kobo.916.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.917.1">import</span></span><span class="koboSpan" id="kobo.918.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.919.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.920.1">Post</span></span><span class="koboSpan" id="kobo.921.1">(models.Model):
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.922.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.923.1">Status</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.924.1">(models.TextChoices):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.925.1">        DRAFT = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.926.1">'DF'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.927.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.928.1">'Draft'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.929.1">        PUBLISHED = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.930.1">'PB'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.931.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.932.1">'Published'</span></strong></span><span class="koboSpan" id="kobo.933.1">
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.934.1">250</span></span><span class="koboSpan" id="kobo.935.1">)
    slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.936.1">250</span></span><span class="koboSpan" id="kobo.937.1">)
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.938.1">True</span></span><span class="koboSpan" id="kobo.939.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.940.1">True</span></span><span class="koboSpan" id="kobo.941.1">)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.942.1">    status = models.CharField(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.943.1">        max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.944.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.945.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.946.1">        choices=Status,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.947.1">        default=Status.DRAFT</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.948.1">    )</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.949.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.950.1">Meta</span></span><span class="koboSpan" id="kobo.951.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.952.1">'-publish'</span></span><span class="koboSpan" id="kobo.953.1">]
        indexes = [
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.954.1">'-publish'</span></span><span class="koboSpan" id="kobo.955.1">]),
        ]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.956.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.957.1">__str__</span></span><span class="koboSpan" id="kobo.958.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.959.1">self</span></span><span class="koboSpan" id="kobo.960.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.961.1">return</span></span><span class="koboSpan" id="kobo.962.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.963.1">We have defined the enumeration class </span><code class="inlineCode"><span class="koboSpan" id="kobo.964.1">Status</span></code><span class="koboSpan" id="kobo.965.1"> by subclassing </span><code class="inlineCode"><span class="koboSpan" id="kobo.966.1">models.TextChoices</span></code><span class="koboSpan" id="kobo.967.1">. </span><span class="koboSpan" id="kobo.967.2">The available choices for the post status are </span><code class="inlineCode"><span class="koboSpan" id="kobo.968.1">DRAFT</span></code><span class="koboSpan" id="kobo.969.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.970.1">PUBLISHED</span></code><span class="koboSpan" id="kobo.971.1">. </span><span class="koboSpan" id="kobo.971.2">Their respective values are </span><code class="inlineCode"><span class="koboSpan" id="kobo.972.1">DF</span></code><span class="koboSpan" id="kobo.973.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.974.1">PB</span></code><span class="koboSpan" id="kobo.975.1">, and their labels or readable names are </span><em class="italic"><span class="koboSpan" id="kobo.976.1">Draft</span></em><span class="koboSpan" id="kobo.977.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.978.1">Published</span></em><span class="koboSpan" id="kobo.979.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.980.1">Django provides enumeration types that you can subclass to define choices simply. </span><span class="koboSpan" id="kobo.980.2">These are based on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.981.1">enum</span></code><span class="koboSpan" id="kobo.982.1"> object of Python’s standard library. </span><span class="koboSpan" id="kobo.982.2">You can read more about </span><code class="inlineCode"><span class="koboSpan" id="kobo.983.1">enum</span></code><span class="koboSpan" id="kobo.984.1"> at </span><a href="https://docs.python.org/3/library/enum.html"><span class="url"><span class="koboSpan" id="kobo.985.1">https://docs.python.org/3/library/enum.html</span></span></a><span class="koboSpan" id="kobo.986.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.987.1">Django enumeration types present some modifications over </span><code class="inlineCode"><span class="koboSpan" id="kobo.988.1">enum</span></code><span class="koboSpan" id="kobo.989.1">. </span><span class="koboSpan" id="kobo.989.2">You can learn about those differences at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types"><span class="url"><span class="koboSpan" id="kobo.990.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types</span></span></a><span class="koboSpan" id="kobo.991.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.992.1">We can access </span><code class="inlineCode"><span class="koboSpan" id="kobo.993.1">Post.Status.choices</span></code><span class="koboSpan" id="kobo.994.1"> to obtain the available choices, </span><code class="inlineCode"><span class="koboSpan" id="kobo.995.1">Post.Status.names</span></code><span class="koboSpan" id="kobo.996.1"> to obtain the names of the choices, </span><code class="inlineCode"><span class="koboSpan" id="kobo.997.1">Post.Status.labels</span></code><span class="koboSpan" id="kobo.998.1"> to obtain the human-readable names, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.999.1">Post.Status.values</span></code><span class="koboSpan" id="kobo.1000.1"> to obtain the actual values of the choices.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1001.1">We have also added a</span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.1002.1"> new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1003.1">status</span></code><span class="koboSpan" id="kobo.1004.1"> field to the model that is an </span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.1005.1">instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1006.1">CharField</span></code><span class="koboSpan" id="kobo.1007.1">. </span><span class="koboSpan" id="kobo.1007.2">It includes a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1008.1">choices</span></code><span class="koboSpan" id="kobo.1009.1"> parameter to limit the value of the field to the choices in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1010.1">Status</span></code><span class="koboSpan" id="kobo.1011.1">. </span><span class="koboSpan" id="kobo.1011.2">We have also set a default value for the field using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1012.1">default</span></code><span class="koboSpan" id="kobo.1013.1"> parameter. </span><span class="koboSpan" id="kobo.1013.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1014.1">DRAFT</span></code><span class="koboSpan" id="kobo.1015.1"> as the default choice for this field.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.1016.1">It’s a good practice to define choices inside the model class and use the enumeration types. </span><span class="koboSpan" id="kobo.1016.2">This will allow you to easily reference choice labels, values, or names from anywhere in your code. </span><span class="koboSpan" id="kobo.1016.3">You can import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1017.1">Post</span></code><span class="koboSpan" id="kobo.1018.1"> model and use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1019.1">Post.Status.DRAFT</span></code><span class="koboSpan" id="kobo.1020.1"> as a reference for the </span><em class="italic"><span class="koboSpan" id="kobo.1021.1">Draft</span></em><span class="koboSpan" id="kobo.1022.1"> status anywhere in your code.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1023.1">Let’s take a look at how to interact with status choices.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1024.1">Run the following command in the shell prompt to open the Python shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1025.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1026.1">Then, type the following lines:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1027.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1028.1">from</span></span><span class="koboSpan" id="kobo.1029.1"> blog.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1030.1">import</span></span><span class="koboSpan" id="kobo.1031.1"> Post
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1032.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1033.1"> Post.Status.choices
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1034.1">You will obtain the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1035.1">enum</span></code><span class="koboSpan" id="kobo.1036.1"> choices with value-label pairs, like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1037.1">[('DF', 'Draft'), ('PB', 'Published')]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1038.1">Type the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1039.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1040.1"> Post.Status.labels
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1041.1">You will get the human-readable names of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1042.1">enum</span></code><span class="koboSpan" id="kobo.1043.1"> members, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1044.1">['Draft', 'Published']
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1045.1">Type the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1046.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1047.1"> Post.Status.values
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1048.1">You will get </span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.1049.1">the</span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.1050.1"> values of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1051.1">enum</span></code><span class="koboSpan" id="kobo.1052.1"> members, as follows. </span><span class="koboSpan" id="kobo.1052.2">These are the values that can be stored in the database for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1053.1">status</span></code><span class="koboSpan" id="kobo.1054.1"> field:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1055.1">['DF', 'PB']
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1056.1">Type the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1057.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1058.1"> Post.Status.names
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1059.1">You will get the names of the choices, like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1060.1">['DRAFT', 'PUBLISHED']
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1061.1">You can access a specific lookup enumeration member with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1062.1">Post.Status.PUBLISHED</span></code><span class="koboSpan" id="kobo.1063.1"> and you can access its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1064.1">.name</span></code><span class="koboSpan" id="kobo.1065.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1066.1">.value</span></code><span class="koboSpan" id="kobo.1067.1"> properties as well.</span></p>
<h2 class="heading-2" id="_idParaDest-42"><span class="koboSpan" id="kobo.1068.1">Adding a many-to-one relationship</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1069.1">Posts are always </span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.1070.1">written by an author. </span><span class="koboSpan" id="kobo.1070.2">We will create a relationship between users and posts that will indicate which user wrote which posts. </span><span class="koboSpan" id="kobo.1070.3">Django comes with an authentication framework that handles user accounts. </span><span class="koboSpan" id="kobo.1070.4">The Django authentication framework comes in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1071.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.1072.1"> package and contains a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1073.1">User</span></code><span class="koboSpan" id="kobo.1074.1"> model. </span><span class="koboSpan" id="kobo.1074.2">To define the relationship between users and posts, we will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1075.1">AUTH_USER_MODEL</span></code><span class="koboSpan" id="kobo.1076.1"> setting, which points to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1077.1">auth.User</span></code><span class="koboSpan" id="kobo.1078.1"> by default. </span><span class="koboSpan" id="kobo.1078.2">This setting allows you to specify a different user model for your project.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1079.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1080.1">models.py</span></code><span class="koboSpan" id="kobo.1081.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1082.1">blog</span></code><span class="koboSpan" id="kobo.1083.1"> application to make it look as follows. </span><span class="koboSpan" id="kobo.1083.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1084.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1085.1"> django.conf </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1086.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1087.1"> settings</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1088.1">from</span></span><span class="koboSpan" id="kobo.1089.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1090.1">import</span></span><span class="koboSpan" id="kobo.1091.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1092.1">from</span></span><span class="koboSpan" id="kobo.1093.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1094.1">import</span></span><span class="koboSpan" id="kobo.1095.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1096.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">Post</span></span><span class="koboSpan" id="kobo.1098.1">(models.Model):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1099.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1100.1">Status</span></span><span class="koboSpan" id="kobo.1101.1">(models.TextChoices):
        DRAFT = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1102.1">'DF'</span></span><span class="koboSpan" id="kobo.1103.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1104.1">'Draft'</span></span><span class="koboSpan" id="kobo.1105.1">
        PUBLISHED = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1106.1">'PB'</span></span><span class="koboSpan" id="kobo.1107.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1108.1">'Published'</span></span><span class="koboSpan" id="kobo.1109.1">
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1110.1">250</span></span><span class="koboSpan" id="kobo.1111.1">)
    slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1112.1">250</span></span><span class="koboSpan" id="kobo.1113.1">)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1114.1">    author = models.ForeignKey(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1115.1">        settings.AUTH_USER_MODEL,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1116.1">        on_delete=models.CASCADE,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1117.1">        related_name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1118.1">'blog_posts'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1119.1">    )</span></strong></span><span class="koboSpan" id="kobo.1120.1">
    body = models.TextField()
    publish = models.DateTimeField(default=timezone.now)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1121.1">True</span></span><span class="koboSpan" id="kobo.1122.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1123.1">True</span></span><span class="koboSpan" id="kobo.1124.1">)
    status = models.CharField(
        max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1125.1">2</span></span><span class="koboSpan" id="kobo.1126.1">,
        choices=Status,
        default=Status.DRAFT
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1127.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1128.1">Meta</span></span><span class="koboSpan" id="kobo.1129.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1130.1">'-publish'</span></span><span class="koboSpan" id="kobo.1131.1">]
        indexes = [
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1132.1">'-publish'</span></span><span class="koboSpan" id="kobo.1133.1">]),
        ]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1134.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1135.1">__str__</span></span><span class="koboSpan" id="kobo.1136.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1137.1">self</span></span><span class="koboSpan" id="kobo.1138.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1139.1">return</span></span><span class="koboSpan" id="kobo.1140.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1141.1">We have imported the project’s settings and we have added an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1142.1">author</span></code><span class="koboSpan" id="kobo.1143.1"> field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1144.1">Post</span></code><span class="koboSpan" id="kobo.1145.1"> model. </span><span class="koboSpan" id="kobo.1145.2">This field defines a many-to-one relationship with the default user model, meaning that each post is written by a user, and a user can write any number of posts. </span><span class="koboSpan" id="kobo.1145.3">For this field, Django will create a foreign key in the database using the primary key of the related model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1146.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1147.1">on_delete</span></code><span class="koboSpan" id="kobo.1148.1"> parameter specifies the behavior to adopt when the referenced object is deleted. </span><span class="koboSpan" id="kobo.1148.2">This is not specific to Django; it is a SQL standard. </span><span class="koboSpan" id="kobo.1148.3">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1">CASCADE</span></code><span class="koboSpan" id="kobo.1150.1">, you specify that when the referenced user is deleted, the database will also delete all related blog posts. </span><span class="koboSpan" id="kobo.1150.2">You can take a look at all the possible options at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.ForeignKey.on_delete"><span class="url"><span class="koboSpan" id="kobo.1151.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.ForeignKey.on_delete</span></span></a><span class="koboSpan" id="kobo.1152.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1153.1">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1154.1">related_name</span></code><span class="koboSpan" id="kobo.1155.1"> to specify the name of the reverse relationship, from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1156.1">User</span></code><span class="koboSpan" id="kobo.1157.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1158.1">Post</span></code><span class="koboSpan" id="kobo.1159.1">. </span><span class="koboSpan" id="kobo.1159.2">This will allow us to access related objects easily from a user object by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1160.1">user.blog_posts</span></code><span class="koboSpan" id="kobo.1161.1"> notation. </span><span class="koboSpan" id="kobo.1161.2">We will learn more about this later.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1162.1">Django comes with different types of fields that you can use to define your models. </span><span class="koboSpan" id="kobo.1162.2">You can find all field </span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.1163.1">types at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/"><span class="url"><span class="koboSpan" id="kobo.1164.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/</span></span></a><span class="koboSpan" id="kobo.1165.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1166.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1167.1">Post</span></code><span class="koboSpan" id="kobo.1168.1"> model is now complete, and we can now synchronize it to the database.</span></p>
<h2 class="heading-2" id="_idParaDest-43"><span class="koboSpan" id="kobo.1169.1">Creating and applying migrations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1170.1">Now that we have </span><a id="_idIndexMarker065"/><span class="koboSpan" id="kobo.1171.1">a data model for blog posts, we need to create the corresponding database table. </span><span class="koboSpan" id="kobo.1171.2">Django comes with a migration system that tracks the changes made to models and enables them to propagate into the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1172.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1173.1">migrate</span></code><span class="koboSpan" id="kobo.1174.1"> command applies migrations for all applications listed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1175.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1176.1">. </span><span class="koboSpan" id="kobo.1176.2">It synchronizes the database with the current models and existing migrations.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1177.1">First, we will need to create an initial migration for our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1178.1">Post</span></code><span class="koboSpan" id="kobo.1179.1"> model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1180.1">Run the following command in the shell prompt from the root directory of your project:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1181.1">python manage.py makemigrations blog
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1182.1">You should get an output similar to the following one:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1183.1">Migrations for 'blog':
    blog/migrations/0001_initial.py
        - Create model Post
        - Create index blog_post_publish_bb7600_idx on field(s)
          -publish of model post
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1184.1">Django just created the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1">0001_initial.py</span></code><span class="koboSpan" id="kobo.1186.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1187.1">migrations</span></code><span class="koboSpan" id="kobo.1188.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1189.1">blog</span></code><span class="koboSpan" id="kobo.1190.1"> application. </span><span class="koboSpan" id="kobo.1190.2">This migration contains the SQL statements to create the database table for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1191.1">Post</span></code><span class="koboSpan" id="kobo.1192.1"> model and the definition of the database index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1193.1">publish</span></code><span class="koboSpan" id="kobo.1194.1"> field.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1195.1">You can take a look at the file contents to see how the migration is defined. </span><span class="koboSpan" id="kobo.1195.2">A migration specifies dependencies on other migrations and operations to perform in the database to synchronize it with model changes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1196.1">Let’s take a look at the SQL code that Django will execute in the database to create the table for your model. </span><span class="koboSpan" id="kobo.1196.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1197.1">sqlmigrate</span></code><span class="koboSpan" id="kobo.1198.1"> command takes the migration names and returns their SQL without executing it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1199.1">Run the following</span><a id="_idIndexMarker066"/><span class="koboSpan" id="kobo.1200.1"> command from the shell prompt to inspect the SQL output of your first migration:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1201.1">python manage.py sqlmigrate blog 0001
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1202.1">The output should look as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1203.1">BEGIN;
--
-- Create model Post
--
CREATE TABLE "blog_post" (
  "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT,
  "title" varchar(250) NOT NULL,
  "slug" varchar(250) NOT NULL,
  "body" text NOT NULL,
  "publish" datetime NOT NULL,
  "created" datetime NOT NULL,
  "updated" datetime NOT NULL,
  "status" varchar(10) NOT NULL,
  "author_id" integer NOT NULL REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create blog_post_publish_bb7600_idx on field(s) -publish of model post
--
CREATE INDEX "blog_post_publish_bb7600_idx" ON "blog_post" ("publish" DESC);
CREATE INDEX "blog_post_slug_b95473f2" ON "blog_post" ("slug");
CREATE INDEX "blog_post_author_id_dd7a8485" ON "blog_post" ("author_id");
COMMIT;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1204.1">The exact output depends on the database you are using. </span><span class="koboSpan" id="kobo.1204.2">The preceding output is generated for SQLite. </span><span class="koboSpan" id="kobo.1204.3">As you can see in the output, Django generates the table names by combining the application name and the lowercase name of the model (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1205.1">blog_post</span></code><span class="koboSpan" id="kobo.1206.1">), but you can also specify a custom database name for your model in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1207.1">Meta</span></code><span class="koboSpan" id="kobo.1208.1"> class of the model using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1209.1">db_table</span></code><span class="koboSpan" id="kobo.1210.1"> attribute.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1211.1">Django creates an auto-incremental </span><code class="inlineCode"><span class="koboSpan" id="kobo.1212.1">id</span></code><span class="koboSpan" id="kobo.1213.1"> column that is used as the primary key for each model, but you can also override this by specifying </span><code class="inlineCode"><span class="koboSpan" id="kobo.1214.1">primary_key=True</span></code><span class="koboSpan" id="kobo.1215.1"> on one of your model fields. </span><span class="koboSpan" id="kobo.1215.2">The default </span><code class="inlineCode"><span class="koboSpan" id="kobo.1216.1">id</span></code><span class="koboSpan" id="kobo.1217.1"> column consists of an integer that is incremented automatically. </span><span class="koboSpan" id="kobo.1217.2">This </span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.1218.1">column corresponds to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1219.1">id</span></code><span class="koboSpan" id="kobo.1220.1"> field that is automatically added to your model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1221.1">The following three database indexes are created:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1222.1">An index in descending order on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1223.1">publish</span></code><span class="koboSpan" id="kobo.1224.1"> column. </span><span class="koboSpan" id="kobo.1224.2">This is the index we explicitly defined with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1225.1">indexes</span></code><span class="koboSpan" id="kobo.1226.1"> option of the model’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1227.1">Meta</span></code><span class="koboSpan" id="kobo.1228.1"> class.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1229.1">An index on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1230.1">slug</span></code><span class="koboSpan" id="kobo.1231.1"> column because </span><code class="inlineCode"><span class="koboSpan" id="kobo.1232.1">SlugField</span></code><span class="koboSpan" id="kobo.1233.1"> fields imply an index by default.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1234.1">An index on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1235.1">author_id</span></code><span class="koboSpan" id="kobo.1236.1"> column because </span><code class="inlineCode"><span class="koboSpan" id="kobo.1237.1">ForeignKey</span></code><span class="koboSpan" id="kobo.1238.1"> fields imply an index by default.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1239.1">Let’s compare the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1240.1">Post</span></code><span class="koboSpan" id="kobo.1241.1"> model with its corresponding database </span><code class="inlineCode"><span class="koboSpan" id="kobo.1242.1">blog_post</span></code><span class="koboSpan" id="kobo.1243.1"> table:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1244.1"><img alt="Table  Description automatically generated with medium confidence" src="../Images/B21088_01_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1245.1">Figure 1.6: Complete Post model and database table correspondence</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.1246.1">Figure 1.6</span></em><span class="koboSpan" id="kobo.1247.1"> shows how the model fields correspond to database table columns.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1248.1">Let’s sync the database with the new model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1249.1">Execute the following command in the shell prompt to apply the existing migrations:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1250.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1251.1">You will get an output that ends with the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1252.1">Applying blog.0001_initial... </span><span class="koboSpan" id="kobo.1252.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1253.1">We just applied migrations for the applications listed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1254.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1255.1">, including the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1256.1">blog</span></code><span class="koboSpan" id="kobo.1257.1"> application. </span><span class="koboSpan" id="kobo.1257.2">After applying the migrations, the database reflects the current status of the models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1258.1">If you edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1259.1">models.py</span></code><span class="koboSpan" id="kobo.1260.1"> file in order to add, remove, or change the fields of existing models, or if you </span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.1261.1">add new models, you will have to create a new migration using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1262.1">makemigrations</span></code><span class="koboSpan" id="kobo.1263.1"> command. </span><span class="koboSpan" id="kobo.1263.2">Each migration allows Django to keep track of model changes. </span><span class="koboSpan" id="kobo.1263.3">Then, you will have to apply the migration using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1264.1">migrate</span></code><span class="koboSpan" id="kobo.1265.1"> command to keep the database in sync with your models.</span></p>
<h1 class="heading-1" id="_idParaDest-44"><span class="koboSpan" id="kobo.1266.1">Creating an administration site for models</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1267.1">Now that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1268.1">Post</span></code><span class="koboSpan" id="kobo.1269.1"> model is </span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.1270.1">in sync with the database, we can create a simple administration site to manage blog posts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1271.1">Django comes with a built-in administration interface that is very useful for editing content. </span><span class="koboSpan" id="kobo.1271.2">The Django site is built dynamically by reading the model metadata and providing a production-ready interface for editing content. </span><span class="koboSpan" id="kobo.1271.3">You can use it out of the box, configuring how you want your models to be displayed in it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1272.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1273.1">django.contrib.admin</span></code><span class="koboSpan" id="kobo.1274.1"> application is already included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1275.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1276.1"> setting, so you don’t need to add it.</span></p>
<h2 class="heading-2" id="_idParaDest-45"><span class="koboSpan" id="kobo.1277.1">Creating a superuser</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1278.1">First, you will need to </span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.1279.1">create a user to manage the administration site. </span><span class="koboSpan" id="kobo.1279.2">Run the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1280.1">python manage.py createsuperuser
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1281.1">You will see the following output. </span><span class="koboSpan" id="kobo.1281.2">Enter your desired username, email, and password, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1282.1">Username (leave blank to use 'admin'): admin
Email address: admin@admin.com
Password: ********
Password (again): ********
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1283.1">Then, you will see the following success message:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1284.1">Superuser created successfully.
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1285.1">We just created an administrator user with the highest permissions.</span></p>
<h2 class="heading-2" id="_idParaDest-46"><span class="koboSpan" id="kobo.1286.1">The Django administration site</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1287.1">Start the </span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.1288.1">development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1289.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1290.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1291.1">http://127.0.0.1:8000/admin/</span></code><span class="koboSpan" id="kobo.1292.1"> in your browser. </span><span class="koboSpan" id="kobo.1292.2">You should see the administration login page, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1293.1">Figure 1.7</span></em><span class="koboSpan" id="kobo.1294.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1295.1"><img alt="" role="presentation" src="../Images/B21088_01_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1296.1">Figure 1.7: The Django administration site login screen</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1297.1">Log in using the</span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.1298.1"> credentials of the user you created in the preceding step. </span><span class="koboSpan" id="kobo.1298.2">You will see the administration site index page, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1299.1">Figure 1.8</span></em><span class="koboSpan" id="kobo.1300.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1301.1"><img alt="" role="presentation" src="../Images/B21088_01_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1302.1">Figure 1.8: The Django administration site index page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1303.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1304.1">Group</span></code><span class="koboSpan" id="kobo.1305.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1306.1">User</span></code><span class="koboSpan" id="kobo.1307.1"> models that you can see in the preceding screenshot are part of the Django authentication framework located in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1308.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.1309.1">. </span><span class="koboSpan" id="kobo.1309.2">If you click on </span><strong class="keyWord"><span class="koboSpan" id="kobo.1310.1">Users</span></strong><span class="koboSpan" id="kobo.1311.1">, you will see</span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.1312.1"> the user you created previously.</span></p>
<h2 class="heading-2" id="_idParaDest-47"><span class="koboSpan" id="kobo.1313.1">Adding models to the administration site</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1314.1">Let’s add your blog </span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.1315.1">models to the administration </span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.1316.1">site. </span><span class="koboSpan" id="kobo.1316.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1317.1">admin.py</span></code><span class="koboSpan" id="kobo.1318.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1319.1">blog</span></code><span class="koboSpan" id="kobo.1320.1"> application and make it look like this; the new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1321.1">from</span></span><span class="koboSpan" id="kobo.1322.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1323.1">import</span></span><span class="koboSpan" id="kobo.1324.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1325.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1326.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1327.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1328.1"> Post</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1329.1">admin.site.register(Post)</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1330.1">Now, reload the administration site in your browser. </span><span class="koboSpan" id="kobo.1330.2">You should see your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1331.1">Post</span></code><span class="koboSpan" id="kobo.1332.1"> model on the site, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1333.1"><img alt="" role="presentation" src="../Images/B21088_01_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1334.1">Figure 1.9: The Post model of the blog application included in the Django administration site index page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1335.1">That was easy, right? </span><span class="koboSpan" id="kobo.1335.2">When you register a model in the Django administration site, you get a user-friendly interface generated by introspecting your models that allows you to list, edit, create, and delete objects in a simple way.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1336.1">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1337.1">Add</span></strong><span class="koboSpan" id="kobo.1338.1"> link beside </span><strong class="screenText"><span class="koboSpan" id="kobo.1339.1">Posts</span></strong><span class="koboSpan" id="kobo.1340.1"> to add a new post. </span><span class="koboSpan" id="kobo.1340.2">You will note the form that Django has generated dynamically for your model, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1341.1">Figure 1.10</span></em><span class="koboSpan" id="kobo.1342.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1343.1"><img alt="" role="presentation" src="../Images/B21088_01_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1344.1">Figure 1.10: The Django administration site edit form for the Post model</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1345.1">Django uses</span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.1346.1"> different </span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.1347.1">form widgets for each type of field. </span><span class="koboSpan" id="kobo.1347.2">Even complex fields, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1348.1">DateTimeField</span></code><span class="koboSpan" id="kobo.1349.1">, are displayed with an easy interface, such as a JavaScript date picker.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1350.1">Fill in the form and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1351.1">SAVE</span></strong><span class="koboSpan" id="kobo.1352.1"> button. </span><span class="koboSpan" id="kobo.1352.2">You should be redirected to the post list page with a success message and the post you just created, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1353.1">Figure 1.11</span></em><span class="koboSpan" id="kobo.1354.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1355.1"><img alt="" role="presentation" src="../Images/B21088_01_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1356.1">Figure 1.11: The Django administration site list view for the Post model with an added successfully message</span></p>
<h2 class="heading-2" id="_idParaDest-48"><span class="koboSpan" id="kobo.1357.1">Customizing how models are displayed</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1358.1">Now, we will </span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.1359.1">take a look at how to customize the administration site.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1360.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1361.1">admin.py</span></code><span class="koboSpan" id="kobo.1362.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1363.1">blog</span></code><span class="koboSpan" id="kobo.1364.1"> application and change it, as follows. </span><span class="koboSpan" id="kobo.1364.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1365.1">from</span></span><span class="koboSpan" id="kobo.1366.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1367.1">import</span></span><span class="koboSpan" id="kobo.1368.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1369.1">from</span></span><span class="koboSpan" id="kobo.1370.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1371.1">import</span></span><span class="koboSpan" id="kobo.1372.1"> Post
</span><span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1373.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1374.1">Post</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1375.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1376.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1377.1">PostAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1378.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1379.1">    list_display = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1380.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1381.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1382.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1383.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1384.1">'author'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1385.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1386.1">'publish'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1387.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1388.1">'status'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1389.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1390.1">We are telling the Django administration site that the model is registered in the site using a custom class that inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1391.1">ModelAdmin</span></code><span class="koboSpan" id="kobo.1392.1">. </span><span class="koboSpan" id="kobo.1392.2">In this class, we can include information about how to display the model on the administration site and how to interact with it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1393.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1394.1">list_display</span></code><span class="koboSpan" id="kobo.1395.1"> attribute allows you to set the fields of your model that you want to display on the administration object list page. </span><span class="koboSpan" id="kobo.1395.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1396.1">@admin.register()</span></code><span class="koboSpan" id="kobo.1397.1"> decorator performs the same function as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1398.1">admin.site.register()</span></code><span class="koboSpan" id="kobo.1399.1"> function that you replaced, registering the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1400.1">ModelAdmin</span></code><span class="koboSpan" id="kobo.1401.1"> class that it decorates.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1402.1">Let’s customize the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1403.1">admin</span></code><span class="koboSpan" id="kobo.1404.1"> model with some more options.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1405.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1406.1">admin.py</span></code><span class="koboSpan" id="kobo.1407.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1408.1">blog</span></code><span class="koboSpan" id="kobo.1409.1"> application and change it, as follows. </span><span class="koboSpan" id="kobo.1409.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1410.1">from</span></span><span class="koboSpan" id="kobo.1411.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1412.1">import</span></span><span class="koboSpan" id="kobo.1413.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1414.1">from</span></span><span class="koboSpan" id="kobo.1415.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1416.1">import</span></span><span class="koboSpan" id="kobo.1417.1"> Post
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1418.1">@admin.register(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1419.1">Post</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1420.1">)</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1421.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1422.1">PostAdmin</span></span><span class="koboSpan" id="kobo.1423.1">(admin.ModelAdmin):
    list_display = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1424.1">'title'</span></span><span class="koboSpan" id="kobo.1425.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1426.1">'slug'</span></span><span class="koboSpan" id="kobo.1427.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1428.1">'author'</span></span><span class="koboSpan" id="kobo.1429.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1430.1">'publish'</span></span><span class="koboSpan" id="kobo.1431.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1432.1">'status'</span></span><span class="koboSpan" id="kobo.1433.1">]
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1434.1">    list_filter = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1435.1">'status'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1436.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1437.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1438.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1439.1">'publish'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1440.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1441.1">'author'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1442.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1443.1">    search_fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1444.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1445.1">title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1446.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1447.1">'body'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1448.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1449.1">    prepopulated_fields = {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1450.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1451.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1452.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1453.1">,)}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1454.1">    raw_id_fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1455.1">'author'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1456.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1457.1">    date_hierarchy = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1458.1">'publish'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1459.1">    ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1460.1">'status'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1461.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1462.1">'publish'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1463.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1464.1">Return to your </span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.1465.1">browser and reload the post list page. </span><span class="koboSpan" id="kobo.1465.2">Now, it will look like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1466.1"><img alt="" role="presentation" src="../Images/B21088_01_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1467.1">Figure 1.12: The Django administration site custom list view for the Post model</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1468.1">You can see that the fields displayed on the post list page are the ones we specified in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1">list_display</span></code><span class="koboSpan" id="kobo.1470.1"> attribute. </span><span class="koboSpan" id="kobo.1470.2">The list page now includes a right sidebar that allows you to filter the results by the fields included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1471.1">list_filter</span></code><span class="koboSpan" id="kobo.1472.1"> attribute. </span><span class="koboSpan" id="kobo.1472.2">Filters for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1473.1">ForeignKey</span></code><span class="koboSpan" id="kobo.1474.1"> fields like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1475.1">author</span></code><span class="koboSpan" id="kobo.1476.1"> are only displayed in the sidebar if more than one object exists in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1477.1">A search bar has appeared on the page. </span><span class="koboSpan" id="kobo.1477.2">This is because we have defined a list of searchable fields using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1478.1">search_fields</span></code><span class="koboSpan" id="kobo.1479.1"> attribute. </span><span class="koboSpan" id="kobo.1479.2">Just below the search bar, there are navigation links to navigate through a date hierarchy; this has been defined by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1480.1">date_hierarchy</span></code><span class="koboSpan" id="kobo.1481.1"> attribute. </span><span class="koboSpan" id="kobo.1481.2">You can also see that the posts are ordered by </span><strong class="screenText"><span class="koboSpan" id="kobo.1482.1">STATUS</span></strong><span class="koboSpan" id="kobo.1483.1"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.1484.1">PUBLISH</span></strong><span class="koboSpan" id="kobo.1485.1"> columns by default. </span><span class="koboSpan" id="kobo.1485.2">We have specified the default sorting criteria using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">ordering</span></code><span class="koboSpan" id="kobo.1487.1"> attribute.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1488.1">Next, click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1489.1">ADD POST</span></strong><span class="koboSpan" id="kobo.1490.1"> link. </span><span class="koboSpan" id="kobo.1490.2">You will also note some changes here. </span><span class="koboSpan" id="kobo.1490.3">As you type the title of a new post, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1491.1">slug</span></code><span class="koboSpan" id="kobo.1492.1"> field is filled in automatically. </span><span class="koboSpan" id="kobo.1492.2">You have told Django to prepopulate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1493.1">slug</span></code><span class="koboSpan" id="kobo.1494.1"> field with the input of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1495.1">title</span></code><span class="koboSpan" id="kobo.1496.1"> field using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1497.1">prepopulated_fields</span></code><span class="koboSpan" id="kobo.1498.1"> attribute:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1499.1"><img alt="" role="presentation" src="../Images/B21088_01_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1500.1">Figure 1.13: The slug model is now automatically prepopulated as you type in the title</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1501.1">Also, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1502.1">author</span></code><span class="koboSpan" id="kobo.1503.1"> field is</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.1504.1"> now displayed with a lookup widget, which can be much better than an input selection drop-down when you have thousands of users. </span><span class="koboSpan" id="kobo.1504.2">This is achieved with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1505.1">raw_id_fields</span></code><span class="koboSpan" id="kobo.1506.1"> attribute and it looks like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1507.1"><img alt="" role="presentation" src="../Images/B21088_01_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1508.1">Figure 1.14: The widget to select related objects for the Author field of the Post model</span></p>
<h2 class="heading-2" id="_idParaDest-49"><span class="koboSpan" id="kobo.1509.1">Adding facet counts to filters</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1510.1">Django 5.0 introduces </span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.1511.1">facet filters to the </span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.1512.1">administration site, showcasing facet counts. </span><span class="koboSpan" id="kobo.1512.2">These counts indicate the number of objects corresponding to each specific filter, making it easier to identify matching objects in the admin changelist view. </span><span class="koboSpan" id="kobo.1512.3">Next, we are going to make sure facet filters are always displayed for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1513.1">PostAdmin</span></code><span class="koboSpan" id="kobo.1514.1"> admin model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1515.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1516.1">admin.py</span></code><span class="koboSpan" id="kobo.1517.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1518.1">blog</span></code><span class="koboSpan" id="kobo.1519.1"> application and add the following line highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1520.1">from</span></span><span class="koboSpan" id="kobo.1521.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1522.1">import</span></span><span class="koboSpan" id="kobo.1523.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1524.1">from</span></span><span class="koboSpan" id="kobo.1525.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1526.1">import</span></span><span class="koboSpan" id="kobo.1527.1"> Post
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1528.1">@admin.register(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1529.1">Post</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1530.1">)</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1531.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1532.1">PostAdmin</span></span><span class="koboSpan" id="kobo.1533.1">(admin.ModelAdmin):
    list_display = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1534.1">'title'</span></span><span class="koboSpan" id="kobo.1535.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1536.1">'slug'</span></span><span class="koboSpan" id="kobo.1537.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1538.1">'author'</span></span><span class="koboSpan" id="kobo.1539.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1540.1">'publish'</span></span><span class="koboSpan" id="kobo.1541.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1542.1">'status'</span></span><span class="koboSpan" id="kobo.1543.1">]
    list_filter = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1544.1">'status'</span></span><span class="koboSpan" id="kobo.1545.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1546.1">'created'</span></span><span class="koboSpan" id="kobo.1547.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1548.1">'publish'</span></span><span class="koboSpan" id="kobo.1549.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1550.1">'author'</span></span><span class="koboSpan" id="kobo.1551.1">]
    search_fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1552.1">'title'</span></span><span class="koboSpan" id="kobo.1553.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1554.1">'body'</span></span><span class="koboSpan" id="kobo.1555.1">]
    prepopulated_fields = {</span><span class="hljs-string"><span class="koboSpan" id="kobo.1556.1">'slug'</span></span><span class="koboSpan" id="kobo.1557.1">: (</span><span class="hljs-string"><span class="koboSpan" id="kobo.1558.1">'title'</span></span><span class="koboSpan" id="kobo.1559.1">,)}
    raw_id_fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1560.1">'author'</span></span><span class="koboSpan" id="kobo.1561.1">]
    date_hierarchy = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1562.1">'publish'</span></span><span class="koboSpan" id="kobo.1563.1">
    ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1564.1">'status'</span></span><span class="koboSpan" id="kobo.1565.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1566.1">'publish'</span></span><span class="koboSpan" id="kobo.1567.1">]
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1568.1">    show_facets = admin.ShowFacets.ALWAYS</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1569.1">Create some posts using the administration site and access </span><code class="inlineCode"><span class="koboSpan" id="kobo.1570.1">http://127.0.0.1:8000/admin/blog/post/</span></code><span class="koboSpan" id="kobo.1571.1">. </span><span class="koboSpan" id="kobo.1571.2">The filters should now include total facet counts, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1572.1">Figure 1.15</span></em><span class="koboSpan" id="kobo.1573.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1574.1"><img alt="" role="presentation" src="../Images/B21088_01_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1575.1">Figure 1.15: Status field filters including facet counts</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1576.1">With a few lines of code, we have customized the way the model is displayed on the administration site. </span><span class="koboSpan" id="kobo.1576.2">There are plenty of ways to customize and extend the Django administration site; you will learn more about these later in this book.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1577.1">You can find </span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.1578.1">more</span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.1579.1"> information about the Django administration site at </span><a href="https://docs.djangoproject.com/en/5.0/ref/contrib/admin/"><span class="url"><span class="koboSpan" id="kobo.1580.1">https://docs.djangoproject.com/en/5.0/ref/contrib/admin/</span></span></a><span class="koboSpan" id="kobo.1581.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-50"><span class="koboSpan" id="kobo.1582.1">Working with QuerySets and managers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1583.1">Now that we</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.1584.1"> have</span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.1585.1"> a fully functional administration site to manage blog posts, it is a good time to learn how to read and write content to the database programmatically.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1586.1">The Django </span><strong class="keyWord"><span class="koboSpan" id="kobo.1587.1">object-relational mapper</span></strong><span class="koboSpan" id="kobo.1588.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1589.1">ORM</span></strong><span class="koboSpan" id="kobo.1590.1">) is a</span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.1591.1"> powerful database abstraction API that lets you create, retrieve, update, and delete objects easily. </span><span class="koboSpan" id="kobo.1591.2">An ORM allows you to generate SQL queries using the object-oriented paradigm of Python. </span><span class="koboSpan" id="kobo.1591.3">You can think of it as a way to interact with your database in a Pythonic fashion instead of writing raw SQL queries.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1592.1">The ORM maps your models to database tables and provides you with a simple Pythonic interface to interact with your database. </span><span class="koboSpan" id="kobo.1592.2">The ORM generates SQL queries and maps the results to model objects. </span><span class="koboSpan" id="kobo.1592.3">The Django ORM is compatible with MySQL, PostgreSQL, SQLite, Oracle, and MariaDB.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1593.1">Remember that you can define the database of your project in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1594.1">DATABASES</span></code><span class="koboSpan" id="kobo.1595.1"> setting of your project’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1596.1">settings.py</span></code><span class="koboSpan" id="kobo.1597.1"> file. </span><span class="koboSpan" id="kobo.1597.2">Django can work with multiple databases at a time, and you can program database routers to create custom data routing schemes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1598.1">Once you have created your data models, Django gives you a free API to interact with them. </span><span class="koboSpan" id="kobo.1598.2">You can find the model API reference of the official documentation at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/"><span class="url"><span class="koboSpan" id="kobo.1599.1">https://docs.djangoproject.com/en/5.0/ref/models/</span></span></a><span class="koboSpan" id="kobo.1600.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1601.1">The Django ORM is based on QuerySets. </span><span class="koboSpan" id="kobo.1601.2">A QuerySet is a collection of database queries to retrieve objects from your database. </span><span class="koboSpan" id="kobo.1601.3">You can apply filters to QuerySets to narrow down the query results based on given parameters. </span><span class="koboSpan" id="kobo.1601.4">The QuerySet equates to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1602.1">SELECT</span></code><span class="koboSpan" id="kobo.1603.1"> SQL statement and the filters are limiting SQL clauses such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1604.1">WHERE</span></code><span class="koboSpan" id="kobo.1605.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1606.1">LIMIT</span></code><span class="koboSpan" id="kobo.1607.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1608.1">Next, you are going to learn how to build and execute QuerySets.</span></p>
<h2 class="heading-2" id="_idParaDest-51"><span class="koboSpan" id="kobo.1609.1">Creating objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1610.1">Run the following </span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.1611.1">command in the shell prompt to open the </span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.1612.1">Python shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1613.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1614.1">Then, type the following lines:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1615.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1616.1">from</span></span><span class="koboSpan" id="kobo.1617.1"> django.contrib.auth.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1618.1">import</span></span><span class="koboSpan" id="kobo.1619.1"> User
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1620.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1621.1">from</span></span><span class="koboSpan" id="kobo.1622.1"> blog.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1623.1">import</span></span><span class="koboSpan" id="kobo.1624.1"> Post
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1625.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1626.1"> user = User.objects.get(username=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1627.1">'admin'</span></span><span class="koboSpan" id="kobo.1628.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1629.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1630.1"> post = Post(title=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1631.1">'Another post'</span></span><span class="koboSpan" id="kobo.1632.1">,
...             </span><span class="koboSpan" id="kobo.1632.2">slug=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1633.1">'another-post'</span></span><span class="koboSpan" id="kobo.1634.1">,
...             </span><span class="koboSpan" id="kobo.1634.2">body=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1635.1">'Post body.'</span></span><span class="koboSpan" id="kobo.1636.1">,
...             </span><span class="koboSpan" id="kobo.1636.2">author=user)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1637.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1638.1"> post.save()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1639.1">Let’s analyze what this code does.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1640.1">First, we are retrieving the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1641.1">user</span></code><span class="koboSpan" id="kobo.1642.1"> object with the username </span><code class="inlineCode"><span class="koboSpan" id="kobo.1643.1">admin</span></code><span class="koboSpan" id="kobo.1644.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1645.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1646.1"> user = User.objects.get(username=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1647.1">'admin'</span></span><span class="koboSpan" id="kobo.1648.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1649.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1650.1">get()</span></code><span class="koboSpan" id="kobo.1651.1"> method allows us to retrieve a single object from the database. </span><span class="koboSpan" id="kobo.1651.2">This method executes a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1652.1">SELECT</span></code><span class="koboSpan" id="kobo.1653.1"> SQL statement behind the scenes. </span><span class="koboSpan" id="kobo.1653.2">Note that this method expects a result that matches the query. </span><span class="koboSpan" id="kobo.1653.3">If no results are returned by the database, this method will raise a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1654.1">DoesNotExist</span></code><span class="koboSpan" id="kobo.1655.1"> exception, and if the database returns more than one result, it will raise a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1656.1">MultipleObjectsReturned</span></code><span class="koboSpan" id="kobo.1657.1"> exception. </span><span class="koboSpan" id="kobo.1657.2">Both exceptions are attributes of the model class that the query is being performed on.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1658.1">Then, we create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1659.1">Post</span></code><span class="koboSpan" id="kobo.1660.1"> instance with a custom title, slug, and body, and set the user that we previously retrieved as the author of the post:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1661.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1662.1"> post = Post(title=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1663.1">'Another post'</span></span><span class="koboSpan" id="kobo.1664.1">, slug=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1665.1">'another-post'</span></span><span class="koboSpan" id="kobo.1666.1">, body=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1667.1">'Post body.'</span></span><span class="koboSpan" id="kobo.1668.1">, author=user)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1669.1">This object is in memory and not persisted to the database; we created a Python object that can be used during runtime but is not saved into the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1670.1">Finally, we are saving the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1671.1">Post</span></code><span class="koboSpan" id="kobo.1672.1"> object in the database using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1673.1">save()</span></code><span class="koboSpan" id="kobo.1674.1"> method:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1675.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1676.1"> post.save()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1677.1">This action performs an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1678.1">INSERT</span></code><span class="koboSpan" id="kobo.1679.1"> SQL statement behind the scenes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1680.1">We created an object in memory first and then persisted it to the database. </span><span class="koboSpan" id="kobo.1680.2">However, you can create the object and persist it to the database in a single operation using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1681.1">create()</span></code><span class="koboSpan" id="kobo.1682.1"> method, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1683.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1684.1"> Post.objects.create(title=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1685.1">'One more post'</span></span><span class="koboSpan" id="kobo.1686.1">,
                    slug='one-more-post',
                    body='Post body.',
                    author=user)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1687.1">In certain situations, you might need to fetch an object from the database or create it if it’s absent. </span><span class="koboSpan" id="kobo.1687.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1688.1">get_or_create()</span></code><span class="koboSpan" id="kobo.1689.1"> method facilitates this by either retrieving an object or creating it if not found. </span><span class="koboSpan" id="kobo.1689.2">This method returns a tuple with the object retrieved and a Boolean indicating whether a new object was created. </span><span class="koboSpan" id="kobo.1689.3">The following code attempts to retrieve a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1690.1">User</span></code><span class="koboSpan" id="kobo.1691.1"> object </span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.1692.1">with the username </span><code class="inlineCode"><span class="koboSpan" id="kobo.1693.1">user2</span></code><span class="koboSpan" id="kobo.1694.1">, and if it doesn’t exist, it</span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.1695.1"> will create one:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1696.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1697.1"> user, created = User.objects.get_or_create(username=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1698.1">'user2'</span></span><span class="koboSpan" id="kobo.1699.1">)
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-52"><span class="koboSpan" id="kobo.1700.1">Updating objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1701.1">Now, change the</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.1702.1"> title of the previous </span><code class="inlineCode"><span class="koboSpan" id="kobo.1703.1">Post</span></code><span class="koboSpan" id="kobo.1704.1"> object to something</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.1705.1"> different and save the object again:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1706.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1707.1"> post.title = </span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1708.1">'New title'</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1709.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1710.1"> post.save()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1711.1">This time, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1712.1">save()</span></code><span class="koboSpan" id="kobo.1713.1"> method performs an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1714.1">UPDATE</span></code><span class="koboSpan" id="kobo.1715.1"> SQL statement.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1716.1">The changes you make to a model object are not persisted to the database until you call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1717.1">save()</span></code><span class="koboSpan" id="kobo.1718.1"> method.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-53"><span class="koboSpan" id="kobo.1719.1">Retrieving objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1720.1">You already</span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.1721.1"> know</span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.1722.1"> how to retrieve a single object from the database using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1723.1">get()</span></code><span class="koboSpan" id="kobo.1724.1"> method. </span><span class="koboSpan" id="kobo.1724.2">We accessed this method using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1725.1">Post.objects.get()</span></code><span class="koboSpan" id="kobo.1726.1">. </span><span class="koboSpan" id="kobo.1726.2">Each Django model has at least one manager, and the default manager is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1727.1">objects</span></code><span class="koboSpan" id="kobo.1728.1">. </span><span class="koboSpan" id="kobo.1728.2">You get a QuerySet object using your model manager.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1729.1">To retrieve all objects from a table, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1730.1">all()</span></code><span class="koboSpan" id="kobo.1731.1"> method on the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.1732.1">objects</span></code><span class="koboSpan" id="kobo.1733.1"> manager, like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1734.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1735.1"> all_posts = Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1736.1">all</span></span><span class="koboSpan" id="kobo.1737.1">()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1738.1">This is how we create a QuerySet that returns all objects in the database. </span><span class="koboSpan" id="kobo.1738.2">Note that this QuerySet has not been executed yet. </span><span class="koboSpan" id="kobo.1738.3">Django QuerySets are </span><em class="italic"><span class="koboSpan" id="kobo.1739.1">lazy</span></em><span class="koboSpan" id="kobo.1740.1">, which means they are only evaluated when they are forced to. </span><span class="koboSpan" id="kobo.1740.2">This behavior makes QuerySets very efficient. </span><span class="koboSpan" id="kobo.1740.3">If you don’t assign the QuerySet to a variable but, instead, write it directly on the Python shell, the SQL statement</span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.1741.1"> of the QuerySet is executed because</span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.1742.1"> you are forcing it to generate output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1743.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1744.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1745.1">all</span></span><span class="koboSpan" id="kobo.1746.1">()
&lt;QuerySet [&lt;Post: Who was Django Reinhardt?&gt;, &lt;Post: New title&gt;]&gt;
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-54"><span class="koboSpan" id="kobo.1747.1">Filtering objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1748.1">To filter a QuerySet, you </span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.1749.1">can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1750.1">filter()</span></code><span class="koboSpan" id="kobo.1751.1"> method of the </span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.1752.1">manager. </span><span class="koboSpan" id="kobo.1752.2">This method allows you to specify the content of a SQL </span><code class="inlineCode"><span class="koboSpan" id="kobo.1753.1">WHERE</span></code><span class="koboSpan" id="kobo.1754.1"> clause by using field lookups.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1755.1">For example, you can use the following to filter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1756.1">Post</span></code><span class="koboSpan" id="kobo.1757.1"> objects by their </span><code class="inlineCode"><span class="koboSpan" id="kobo.1758.1">title</span></code><span class="koboSpan" id="kobo.1759.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1760.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1761.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1762.1">filter</span></span><span class="koboSpan" id="kobo.1763.1">(title=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1764.1">'Who was Django Reinhardt?'</span></span><span class="koboSpan" id="kobo.1765.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1766.1">This QuerySet will return all posts with the exact title </span><em class="italic"><span class="koboSpan" id="kobo.1767.1">Who was Django Reinhardt?</span></em><span class="koboSpan" id="kobo.1768.1">. </span><span class="koboSpan" id="kobo.1768.2">Let’s review the SQL statement generated with this QuerySet. </span><span class="koboSpan" id="kobo.1768.3">Run the following code in the shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1769.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1770.1"> posts = Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1771.1">filter</span></span><span class="koboSpan" id="kobo.1772.1">(title=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1773.1">'Who was Django Reinhardt?'</span></span><span class="koboSpan" id="kobo.1774.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1775.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1776.1">print</span></span><span class="koboSpan" id="kobo.1777.1">(posts.query)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1778.1">By printing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1779.1">query</span></code><span class="koboSpan" id="kobo.1780.1"> attribute of the QuerySet, we can get the SQL produced by it:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1781.1">SELECT "blog_post"."id", "blog_post"."title", "blog_post"."slug", "blog_post"."author_id", "blog_post"."body", "blog_post"."publish", "blog_post"."created", "blog_post"."updated", "blog_post"."status" FROM "blog_post" WHERE "blog_post"."title" = Who was Django Reinhardt? </span><span class="koboSpan" id="kobo.1781.2">ORDER BY "blog_post"."publish" DESC
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1782.1">The generated </span><code class="inlineCode"><span class="koboSpan" id="kobo.1783.1">WHERE</span></code><span class="koboSpan" id="kobo.1784.1"> clause performs an exact match on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1785.1">title</span></code><span class="koboSpan" id="kobo.1786.1"> column. </span><span class="koboSpan" id="kobo.1786.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1787.1">ORDER BY</span></code><span class="koboSpan" id="kobo.1788.1"> clause specifies the default order defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1789.1">ordering</span></code><span class="koboSpan" id="kobo.1790.1"> attribute of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1791.1">Post</span></code><span class="koboSpan" id="kobo.1792.1"> model’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1793.1">Meta</span></code><span class="koboSpan" id="kobo.1794.1"> options since we haven’t provided any specific ordering in the QuerySet. </span><span class="koboSpan" id="kobo.1794.2">You will learn about</span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.1795.1"> ordering in a bit. </span><span class="koboSpan" id="kobo.1795.2">Note that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1796.1">query</span></code><span class="koboSpan" id="kobo.1797.1"> attribute is </span><a id="_idIndexMarker101"/><span class="koboSpan" id="kobo.1798.1">not part of the QuerySet public API.</span></p>
<h2 class="heading-2" id="_idParaDest-55"><span class="koboSpan" id="kobo.1799.1">Using field lookups</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1800.1">The </span><a id="_idIndexMarker102"/><span class="koboSpan" id="kobo.1801.1">previous QuerySet example consists of a filter lookup with an exact match. </span><span class="koboSpan" id="kobo.1801.2">The QuerySet interface provides you with multiple lookup </span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.1802.1">types. </span><span class="koboSpan" id="kobo.1802.2">Two underscores are used to define the lookup type, with the format </span><code class="inlineCode"><span class="koboSpan" id="kobo.1803.1">field__lookup</span></code><span class="koboSpan" id="kobo.1804.1">. </span><span class="koboSpan" id="kobo.1804.2">For example, the following lookup produces an exact match:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1805.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1806.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1807.1">filter</span></span><span class="koboSpan" id="kobo.1808.1">(id__exact=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1809.1">1</span></span><span class="koboSpan" id="kobo.1810.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1811.1">When no specific lookup type is provided, the lookup type is assumed to be </span><code class="inlineCode"><span class="koboSpan" id="kobo.1812.1">exact</span></code><span class="koboSpan" id="kobo.1813.1">. </span><span class="koboSpan" id="kobo.1813.2">The following lookup is equivalent to the previous one:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1814.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1815.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1816.1">filter</span></span><span class="koboSpan" id="kobo.1817.1">(</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1818.1">id</span></span><span class="koboSpan" id="kobo.1819.1">=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1820.1">1</span></span><span class="koboSpan" id="kobo.1821.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1822.1">Let’s take a look at other common lookup types. </span><span class="koboSpan" id="kobo.1822.2">You can generate a case-insensitive lookup with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1823.1">iexact</span></code><span class="koboSpan" id="kobo.1824.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1825.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1826.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1827.1">filter</span></span><span class="koboSpan" id="kobo.1828.1">(title__iexact=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1829.1">'who was django reinhardt?'</span></span><span class="koboSpan" id="kobo.1830.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1831.1">You can also filter objects using a containment test. </span><span class="koboSpan" id="kobo.1831.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1832.1">contains</span></code><span class="koboSpan" id="kobo.1833.1"> lookup translates to a SQL lookup using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1834.1">LIKE</span></code><span class="koboSpan" id="kobo.1835.1"> operator:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1836.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1837.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1838.1">filter</span></span><span class="koboSpan" id="kobo.1839.1">(title__contains=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1840.1">'Django'</span></span><span class="koboSpan" id="kobo.1841.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1842.1">The equivalent SQL clause is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1843.1">WHERE title LIKE '%Django%'</span></code><span class="koboSpan" id="kobo.1844.1">. </span><span class="koboSpan" id="kobo.1844.2">A case-insensitive version is also available, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1845.1">icontains</span></code><span class="koboSpan" id="kobo.1846.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1847.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1848.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1849.1">filter</span></span><span class="koboSpan" id="kobo.1850.1">(title__icontains=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1851.1">'django'</span></span><span class="koboSpan" id="kobo.1852.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1853.1">You can check for a given iterable (often a list, tuple, or another QuerySet object) with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1854.1">in</span></code><span class="koboSpan" id="kobo.1855.1"> lookup. </span><span class="koboSpan" id="kobo.1855.2">The following example retrieves posts with an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1856.1">id</span></code><span class="koboSpan" id="kobo.1857.1"> that is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1858.1">1</span></code><span class="koboSpan" id="kobo.1859.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1860.1">3</span></code><span class="koboSpan" id="kobo.1861.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1862.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1863.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1864.1">filter</span></span><span class="koboSpan" id="kobo.1865.1">(id__in=[</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1866.1">1</span></span><span class="koboSpan" id="kobo.1867.1">, </span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1868.1">3</span></span><span class="koboSpan" id="kobo.1869.1">])
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1870.1">The following example shows the greater than (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1871.1">gt</span></code><span class="koboSpan" id="kobo.1872.1">) lookup:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1873.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1874.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1875.1">filter</span></span><span class="koboSpan" id="kobo.1876.1">(id__gt=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1877.1">3</span></span><span class="koboSpan" id="kobo.1878.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1879.1">The equivalent SQL clause is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1880.1">WHERE ID &gt; 3</span></code><span class="koboSpan" id="kobo.1881.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1882.1">This example shows the greater than or equal to lookup:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1883.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1884.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1885.1">filter</span></span><span class="koboSpan" id="kobo.1886.1">(id__gte=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1887.1">3</span></span><span class="koboSpan" id="kobo.1888.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1889.1">This one shows the less than lookup:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1890.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1891.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1892.1">filter</span></span><span class="koboSpan" id="kobo.1893.1">(id__lt=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1894.1">3</span></span><span class="koboSpan" id="kobo.1895.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1896.1">This shows the less than or equal to lookup:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1897.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1898.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1899.1">filter</span></span><span class="koboSpan" id="kobo.1900.1">(id__lte=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1901.1">3</span></span><span class="koboSpan" id="kobo.1902.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1903.1">A case-sensitive/insensitive starts-with lookup can be performed with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1904.1">startswith</span></code><span class="koboSpan" id="kobo.1905.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1906.1">istartswith</span></code><span class="koboSpan" id="kobo.1907.1"> lookup types, respectively:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1908.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1909.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1910.1">filter</span></span><span class="koboSpan" id="kobo.1911.1">(title__istartswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1912.1">'who'</span></span><span class="koboSpan" id="kobo.1913.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1914.1">A case-sensitive/insensitive ends-with lookup can be performed with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1915.1">endswith</span></code><span class="koboSpan" id="kobo.1916.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1917.1">iendswith</span></code><span class="koboSpan" id="kobo.1918.1"> lookup types, respectively:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1919.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1920.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1921.1">filter</span></span><span class="koboSpan" id="kobo.1922.1">(title__iendswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1923.1">'reinhardt?'</span></span><span class="koboSpan" id="kobo.1924.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1925.1">There are also </span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.1926.1">different lookup types for date lookups. </span><span class="koboSpan" id="kobo.1926.2">An </span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.1927.1">exact date lookup can be performed as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1928.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1929.1">from</span></span><span class="koboSpan" id="kobo.1930.1"> datetime </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1931.1">import</span></span><span class="koboSpan" id="kobo.1932.1"> date
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1933.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1934.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1935.1">filter</span></span><span class="koboSpan" id="kobo.1936.1">(publish__date=date(</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1937.1">2024</span></span><span class="koboSpan" id="kobo.1938.1">, </span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1939.1">1</span></span><span class="koboSpan" id="kobo.1940.1">, </span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1941.1">31</span></span><span class="koboSpan" id="kobo.1942.1">))
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1943.1">This shows how to filter a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1944.1">DateField</span></code><span class="koboSpan" id="kobo.1945.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1946.1">DateTimeField</span></code><span class="koboSpan" id="kobo.1947.1"> field by year:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1948.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1949.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1950.1">filter</span></span><span class="koboSpan" id="kobo.1951.1">(publish__year=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1952.1">2024</span></span><span class="koboSpan" id="kobo.1953.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1954.1">You can also filter by month:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1955.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1956.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1957.1">filter</span></span><span class="koboSpan" id="kobo.1958.1">(publish__month=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1959.1">1</span></span><span class="koboSpan" id="kobo.1960.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1961.1">And you can filter by day:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1962.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1963.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1964.1">filter</span></span><span class="koboSpan" id="kobo.1965.1">(publish__day=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1966.1">1</span></span><span class="koboSpan" id="kobo.1967.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1968.1">You can chain additional lookups to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1969.1">date</span></code><span class="koboSpan" id="kobo.1970.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1971.1">year</span></code><span class="koboSpan" id="kobo.1972.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1973.1">month</span></code><span class="koboSpan" id="kobo.1974.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1975.1">day</span></code><span class="koboSpan" id="kobo.1976.1">. </span><span class="koboSpan" id="kobo.1976.2">For example, here is a lookup for a value greater than a given date:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1977.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1978.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1979.1">filter</span></span><span class="koboSpan" id="kobo.1980.1">(publish__date__gt=date(</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1981.1">2024</span></span><span class="koboSpan" id="kobo.1982.1">, </span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1983.1">1</span></span><span class="koboSpan" id="kobo.1984.1">, </span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1985.1">1</span></span><span class="koboSpan" id="kobo.1986.1">))
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1987.1">To lookup related object fields, you also use the two-underscores notation. </span><span class="koboSpan" id="kobo.1987.2">For example, to retrieve the posts written by the user with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1988.1">admin</span></code><span class="koboSpan" id="kobo.1989.1"> username, use the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1990.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1991.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1992.1">filter</span></span><span class="koboSpan" id="kobo.1993.1">(author__username=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1994.1">'admin'</span></span><span class="koboSpan" id="kobo.1995.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1996.1">You can also chain additional lookups for the related fields. </span><span class="koboSpan" id="kobo.1996.2">For example, to retrieve posts written by any user with a username that starts with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1997.1">ad</span></code><span class="koboSpan" id="kobo.1998.1">, use the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1999.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2000.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2001.1">filter</span></span><span class="koboSpan" id="kobo.2002.1">(author__username__starstwith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2003.1">'ad'</span></span><span class="koboSpan" id="kobo.2004.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2005.1">You can also filter by multiple fields. </span><span class="koboSpan" id="kobo.2005.2">For example, the following QuerySet retrieves all posts published </span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.2006.1">in 2024 by</span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.2007.1"> the author with the username </span><code class="inlineCode"><span class="koboSpan" id="kobo.2008.1">admin</span></code><span class="koboSpan" id="kobo.2009.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2010.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2011.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2012.1">filter</span></span><span class="koboSpan" id="kobo.2013.1">(publish__year=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2014.1">2024</span></span><span class="koboSpan" id="kobo.2015.1">, author__username=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2016.1">'admin'</span></span><span class="koboSpan" id="kobo.2017.1">)
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-56"><span class="koboSpan" id="kobo.2018.1">Chaining filters</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2019.1">The result of a filtered</span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.2020.1"> QuerySet is another QuerySet object. </span><span class="koboSpan" id="kobo.2020.2">This allows you to chain QuerySets together. </span><span class="koboSpan" id="kobo.2020.3">You can build an equivalent QuerySet to the previous one by chaining multiple filters:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2021.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2022.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2023.1">filter</span></span><span class="koboSpan" id="kobo.2024.1">(publish__year=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2025.1">2024</span></span><span class="koboSpan" id="kobo.2026.1">) \
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2027.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2028.1">             .</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2029.1">filter</span></span><span class="koboSpan" id="kobo.2030.1">(author__username=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2031.1">'admin'</span></span><span class="koboSpan" id="kobo.2032.1">)
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-57"><span class="koboSpan" id="kobo.2033.1">Excluding objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2034.1">You can exclude</span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.2035.1"> certain results from your QuerySet by using</span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.2036.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2037.1">exclude()</span></code><span class="koboSpan" id="kobo.2038.1"> method</span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.2039.1"> of the manager. </span><span class="koboSpan" id="kobo.2039.2">For example, you can retrieve all posts published in 2024 whose titles don’t start with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2040.1">Why</span></code><span class="koboSpan" id="kobo.2041.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2042.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2043.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2044.1">filter</span></span><span class="koboSpan" id="kobo.2045.1">(publish__year=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2046.1">2024</span></span><span class="koboSpan" id="kobo.2047.1">) \
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2048.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2049.1">             .exclude(title__startswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2050.1">'Why'</span></span><span class="koboSpan" id="kobo.2051.1">)
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-58"><span class="koboSpan" id="kobo.2052.1">Ordering objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2053.1">The default</span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.2054.1"> order</span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.2055.1"> is defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2056.1">ordering</span></code><span class="koboSpan" id="kobo.2057.1"> option of the model’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2058.1">Meta</span></code><span class="koboSpan" id="kobo.2059.1">. </span><span class="koboSpan" id="kobo.2059.2">You can override the default ordering using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2060.1">order_by()</span></code><span class="koboSpan" id="kobo.2061.1"> method of the manager. </span><span class="koboSpan" id="kobo.2061.2">For example, you can retrieve all objects ordered by their </span><code class="inlineCode"><span class="koboSpan" id="kobo.2062.1">title</span></code><span class="koboSpan" id="kobo.2063.1">, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2064.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2065.1"> Post.objects.order_by(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2066.1">'title'</span></span><span class="koboSpan" id="kobo.2067.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2068.1">Ascending order is implied. </span><span class="koboSpan" id="kobo.2068.2">You can indicate descending order with a negative sign prefix, like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2069.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2070.1"> Post.objects.order_by(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2071.1">'-title'</span></span><span class="koboSpan" id="kobo.2072.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2073.1">You can order by multiple fields. </span><span class="koboSpan" id="kobo.2073.2">The following example orders objects by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2074.1">author</span></code><span class="koboSpan" id="kobo.2075.1"> first and then </span><code class="inlineCode"><span class="koboSpan" id="kobo.2076.1">title</span></code><span class="koboSpan" id="kobo.2077.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2078.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2079.1"> Post.objects.order_by(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2080.1">'author'</span></span><span class="koboSpan" id="kobo.2081.1">, </span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2082.1">'title'</span></span><span class="koboSpan" id="kobo.2083.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2084.1">To order </span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.2085.1">randomly, use</span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.2086.1"> the string </span><code class="inlineCode"><span class="koboSpan" id="kobo.2087.1">'?'</span></code><span class="koboSpan" id="kobo.2088.1">, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2089.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2090.1"> Post.objects.order_by(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2091.1">'?'</span></span><span class="koboSpan" id="kobo.2092.1">)
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-59"><span class="koboSpan" id="kobo.2093.1">Limiting QuerySets</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2094.1">You can limit a QuerySet to a</span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.2095.1"> certain number of results by using a subset of Python’s array-slicing syntax. </span><span class="koboSpan" id="kobo.2095.2">For example, the following QuerySet limits the results to 5 objects:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2096.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2097.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2098.1">all</span></span><span class="koboSpan" id="kobo.2099.1">()[:</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2100.1">5</span></span><span class="koboSpan" id="kobo.2101.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2102.1">This translates to a SQL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2103.1">LIMIT 5</span></code><span class="koboSpan" id="kobo.2104.1"> clause. </span><span class="koboSpan" id="kobo.2104.2">Note that negative indexing is not supported.</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2105.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2106.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2107.1">all</span></span><span class="koboSpan" id="kobo.2108.1">()[</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2109.1">3</span></span><span class="koboSpan" id="kobo.2110.1">:</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2111.1">6</span></span><span class="koboSpan" id="kobo.2112.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2113.1">The preceding translates to a SQL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2114.1">OFFSET 3 LIMIT 6</span></code><span class="koboSpan" id="kobo.2115.1"> clause, to return the fourth through sixth objects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2116.1">To retrieve a single object, you can use an index instead of a slice. </span><span class="koboSpan" id="kobo.2116.2">For example, use the following to retrieve the first object of posts in random order:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2117.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2118.1"> Post.objects.order_by(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2119.1">'?'</span></span><span class="koboSpan" id="kobo.2120.1">)[</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2121.1">0</span></span><span class="koboSpan" id="kobo.2122.1">]
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-60"><span class="koboSpan" id="kobo.2123.1">Counting objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2124.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2125.1">count()</span></code><span class="koboSpan" id="kobo.2126.1"> method counts</span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.2127.1"> the total number of objects matching</span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.2128.1"> the QuerySet and returns an integer. </span><span class="koboSpan" id="kobo.2128.2">This method translates to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2129.1">SELECT COUNT(*)</span></code><span class="koboSpan" id="kobo.2130.1"> SQL statement. </span><span class="koboSpan" id="kobo.2130.2">The following example returns the total number of posts with an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2131.1">id</span></code><span class="koboSpan" id="kobo.2132.1"> lower than </span><code class="inlineCode"><span class="koboSpan" id="kobo.2133.1">3</span></code><span class="koboSpan" id="kobo.2134.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2135.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2136.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2137.1">filter</span></span><span class="koboSpan" id="kobo.2138.1">(id_lt=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2139.1">3</span></span><span class="koboSpan" id="kobo.2140.1">).count()
2
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-61"><span class="koboSpan" id="kobo.2141.1">Checking if an object exists</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2142.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2143.1">exists()</span></code><span class="koboSpan" id="kobo.2144.1"> method</span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.2145.1"> allows you to check if a QuerySet contains </span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.2146.1">any results. </span><span class="koboSpan" id="kobo.2146.2">This method returns </span><code class="inlineCode"><span class="koboSpan" id="kobo.2147.1">True</span></code><span class="koboSpan" id="kobo.2148.1"> if the QuerySet contains any items and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2149.1">False</span></code><span class="koboSpan" id="kobo.2150.1"> otherwise. </span><span class="koboSpan" id="kobo.2150.2">For example, you can check if there are any posts with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2151.1">title</span></code><span class="koboSpan" id="kobo.2152.1"> that starts with </span><em class="italic"><span class="koboSpan" id="kobo.2153.1">Why</span></em><span class="koboSpan" id="kobo.2154.1"> using the following QuerySet:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2155.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2156.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2157.1">filter</span></span><span class="koboSpan" id="kobo.2158.1">(title__startswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2159.1">'Why'</span></span><span class="koboSpan" id="kobo.2160.1">).exists()
False
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-62"><span class="koboSpan" id="kobo.2161.1">Deleting objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2162.1">If you want to </span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.2163.1">delete an object, you can do it from an object</span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.2164.1"> instance using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2165.1">delete()</span></code><span class="koboSpan" id="kobo.2166.1"> method, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2167.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2168.1"> post = Post.objects.get(</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2169.1">id</span></span><span class="koboSpan" id="kobo.2170.1">=</span><span class="hljs-con-number"><span class="koboSpan" id="kobo.2171.1">1</span></span><span class="koboSpan" id="kobo.2172.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2173.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2174.1"> post.delete()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2175.1">Note that deleting objects will also delete any dependent relationships for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2176.1">ForeignKey</span></code><span class="koboSpan" id="kobo.2177.1"> objects defined with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2178.1">on_delete</span></code><span class="koboSpan" id="kobo.2179.1"> set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2180.1">CASCADE</span></code><span class="koboSpan" id="kobo.2181.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-63"><span class="koboSpan" id="kobo.2182.1">Complex lookups with Q objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2183.1">Field lookups </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.2184.1">using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2185.1">filter()</span></code><span class="koboSpan" id="kobo.2186.1"> are joined with</span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.2187.1"> a SQL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2188.1">AND</span></code><span class="koboSpan" id="kobo.2189.1"> operator. </span><span class="koboSpan" id="kobo.2189.2">For example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2190.1">filter(field1='foo</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.2191.1">', field2='bar')</span></code><span class="koboSpan" id="kobo.2192.1"> will retrieve objects where </span><code class="inlineCode"><span class="koboSpan" id="kobo.2193.1">field1</span></code><span class="koboSpan" id="kobo.2194.1"> is </span><em class="italic"><span class="koboSpan" id="kobo.2195.1">foo</span></em> <strong class="keyWord"><span class="koboSpan" id="kobo.2196.1">and</span></strong> <code class="inlineCode"><span class="koboSpan" id="kobo.2197.1">field2</span></code><span class="koboSpan" id="kobo.2198.1"> is </span><em class="italic"><span class="koboSpan" id="kobo.2199.1">bar</span></em><span class="koboSpan" id="kobo.2200.1">. </span><span class="koboSpan" id="kobo.2200.2">If you need to build more complex queries, such as queries with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2201.1">OR</span></code><span class="koboSpan" id="kobo.2202.1"> statements, you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2203.1">Q</span></code><span class="koboSpan" id="kobo.2204.1"> objects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2205.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.2206.1">Q</span></code><span class="koboSpan" id="kobo.2207.1"> object allows you to encapsulate a collection of field lookups. </span><span class="koboSpan" id="kobo.2207.2">You can compose statements by combining </span><code class="inlineCode"><span class="koboSpan" id="kobo.2208.1">Q</span></code><span class="koboSpan" id="kobo.2209.1"> objects with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2210.1">&amp;</span></code><span class="koboSpan" id="kobo.2211.1"> (and), </span><code class="inlineCode"><span class="koboSpan" id="kobo.2212.1">|</span></code><span class="koboSpan" id="kobo.2213.1"> (or), and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2214.1">^</span></code><span class="koboSpan" id="kobo.2215.1"> (xor) operators.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2216.1">For example, the following code retrieves posts with a title that starts with the string </span><em class="italic"><span class="koboSpan" id="kobo.2217.1">who</span></em> <strong class="keyWord"><span class="koboSpan" id="kobo.2218.1">or</span></strong> <em class="italic"><span class="koboSpan" id="kobo.2219.1">why</span></em><span class="koboSpan" id="kobo.2220.1"> (case-insensitive):</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2221.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2222.1">from</span></span><span class="koboSpan" id="kobo.2223.1"> django.db.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2224.1">import</span></span><span class="koboSpan" id="kobo.2225.1"> Q
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2226.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2227.1"> starts_who = Q(title__istartswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2228.1">'who'</span></span><span class="koboSpan" id="kobo.2229.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2230.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2231.1"> starts_why = Q(title__istartswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2232.1">'why'</span></span><span class="koboSpan" id="kobo.2233.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2234.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2235.1"> Post.objects.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2236.1">filter</span></span><span class="koboSpan" id="kobo.2237.1">(starts_who | starts_why)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2238.1">In this case, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2239.1">|</span></code><span class="koboSpan" id="kobo.2240.1"> operator to build an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2241.1">OR</span></code><span class="koboSpan" id="kobo.2242.1"> statement.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2243.1">You can</span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.2244.1"> read</span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.2245.1"> more about </span><code class="inlineCode"><span class="koboSpan" id="kobo.2246.1">Q</span></code><span class="koboSpan" id="kobo.2247.1"> objects at </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects"><span class="url"><span class="koboSpan" id="kobo.2248.1">https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects</span></span></a><span class="koboSpan" id="kobo.2249.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-64"><span class="koboSpan" id="kobo.2250.1">When QuerySets are evaluated</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2251.1">Creating a QuerySet </span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.2252.1">doesn’t involve any database activity until it is evaluated. </span><span class="koboSpan" id="kobo.2252.2">QuerySets will usually return another unevaluated QuerySet. </span><span class="koboSpan" id="kobo.2252.3">You can concatenate as many filters as you like to a QuerySet, and you will not hit the database until the QuerySet is evaluated. </span><span class="koboSpan" id="kobo.2252.4">When a QuerySet is evaluated, it translates into a SQL query to the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2253.1">QuerySets are only evaluated in the following cases:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2254.1">The first time you iterate over them</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2255.1">When you slice them, for instance, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2256.1">Post.objects.all()[:3]</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2257.1">When you pickle or cache them</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2258.1">When you call </span><code class="inlineCode"><span class="koboSpan" id="kobo.2259.1">repr()</span></code><span class="koboSpan" id="kobo.2260.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2261.1">len()</span></code><span class="koboSpan" id="kobo.2262.1"> on them</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2263.1">When you explicitly call </span><code class="inlineCode"><span class="koboSpan" id="kobo.2264.1">list()</span></code><span class="koboSpan" id="kobo.2265.1"> on them</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2266.1">When you test them in a statement, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2267.1">bool()</span></code><span class="koboSpan" id="kobo.2268.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2269.1">or</span></code><span class="koboSpan" id="kobo.2270.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2271.1">and</span></code><span class="koboSpan" id="kobo.2272.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.2273.1">if</span></code></li>
</ul>
<h2 class="heading-2" id="_idParaDest-65"><span class="koboSpan" id="kobo.2274.1">More on QuerySets</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2275.1">You will use</span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.2276.1"> QuerySets in all the project examples featured in this book. </span><span class="koboSpan" id="kobo.2276.2">You will learn how to generate aggregates over QuerySets in the </span><em class="italic"><span class="koboSpan" id="kobo.2277.1">Retrieving posts by similarity</span></em><span class="koboSpan" id="kobo.2278.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.2279.1">Chapter 3, Extending Your Blog Application</span></em><span class="koboSpan" id="kobo.2280.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2281.1">You will learn how to optimize QuerySets in the </span><em class="italic"><span class="koboSpan" id="kobo.2282.1">Optimizing QuerySets that involve related objects</span></em><span class="koboSpan" id="kobo.2283.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.2284.1">Chapter 7, Tracking User Actions</span></em><span class="koboSpan" id="kobo.2285.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2286.1">The QuerySet API reference is located at </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/querysets/"><span class="url"><span class="koboSpan" id="kobo.2287.1">https://docs.djangoproject.com/en/5.0/ref/models/querysets/</span></span></a><span class="koboSpan" id="kobo.2288.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2289.1">You can read more about making queries with the Django ORM at </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/"><span class="url"><span class="koboSpan" id="kobo.2290.1">https://docs.djangoproject.com/en/5.0/topics/db/queries/</span></span></a><span class="koboSpan" id="kobo.2291.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-66"><span class="koboSpan" id="kobo.2292.1">Creating model managers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2293.1">The default manager </span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.2294.1">for every model is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2295.1">objects</span></code><span class="koboSpan" id="kobo.2296.1"> manager. </span><span class="koboSpan" id="kobo.2296.2">This manager retrieves all the objects in the database. </span><span class="koboSpan" id="kobo.2296.3">However, we can define custom managers for models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2297.1">Let’s create a custom manager to retrieve all posts that have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2298.1">PUBLISHED</span></code><span class="koboSpan" id="kobo.2299.1"> status.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2300.1">There are two ways to add or customize managers for your models: you can add extra manager methods to an existing manager or create a new manager by modifying the initial QuerySet that the manager returns. </span><span class="koboSpan" id="kobo.2300.2">The first method provides you with a QuerySet notation like </span><code class="inlineCode"><span class="koboSpan" id="kobo.2301.1">Post.objects.my_manager()</span></code><span class="koboSpan" id="kobo.2302.1">, and the latter provides you with a QuerySet notation like </span><code class="inlineCode"><span class="koboSpan" id="kobo.2303.1">Post.my_manager.all()</span></code><span class="koboSpan" id="kobo.2304.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2305.1">We will choose the second method to implement a manager that will allow us to retrieve posts using the notation </span><code class="inlineCode"><span class="koboSpan" id="kobo.2306.1">Post.published.all()</span></code><span class="koboSpan" id="kobo.2307.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2308.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2309.1">models.py</span></code><span class="koboSpan" id="kobo.2310.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.2311.1">blog</span></code><span class="koboSpan" id="kobo.2312.1"> application to add the custom manager, as follows. </span><span class="koboSpan" id="kobo.2312.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2313.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2314.1">PublishedManager</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2315.1">(models.Manager):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2316.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2317.1">get_queryset</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2318.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2319.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2320.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2321.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2322.1"> (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2323.1">super</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2324.1">().get_queryset().</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2325.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2326.1">(status=Post.Status.PUBLISHED)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2327.1">        )</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2328.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2329.1">Post</span></span><span class="koboSpan" id="kobo.2330.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2331.1"># model fields</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2332.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2333.1">    objects = models.Manager() </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2334.1"># The default manager.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2335.1">    published = PublishedManager() </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2336.1"># Our custom manager.</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2337.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2338.1">Meta</span></span><span class="koboSpan" id="kobo.2339.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.2340.1">'-publish'</span></span><span class="koboSpan" id="kobo.2341.1">]
        indexes = [
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2342.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2343.1">-publish'</span></span><span class="koboSpan" id="kobo.2344.1">]),
        ]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2345.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2346.1">__str__</span></span><span class="koboSpan" id="kobo.2347.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2348.1">self</span></span><span class="koboSpan" id="kobo.2349.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2350.1">return</span></span><span class="koboSpan" id="kobo.2351.1"> self.title
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2352.1">The first manager declared in a model becomes the default manager. </span><span class="koboSpan" id="kobo.2352.2">You can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2353.1">Meta</span></code><span class="koboSpan" id="kobo.2354.1"> attribute </span><code class="inlineCode"><span class="koboSpan" id="kobo.2355.1">default_manager_name</span></code><span class="koboSpan" id="kobo.2356.1"> to specify a different default manager. </span><span class="koboSpan" id="kobo.2356.2">If no manager is defined in the model, Django automatically creates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2357.1">objects</span></code><span class="koboSpan" id="kobo.2358.1"> default manager for it. </span><span class="koboSpan" id="kobo.2358.2">If you declare any managers for your model but you want to keep the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2359.1">objects</span></code><span class="koboSpan" id="kobo.2360.1"> manager as well, you have to add it explicitly to your model. </span><span class="koboSpan" id="kobo.2360.2">In the preceding code, we have added the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.2361.1">objects</span></code><span class="koboSpan" id="kobo.2362.1"> manager and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2363.1">published</span></code><span class="koboSpan" id="kobo.2364.1"> custom manager to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2365.1">Post</span></code><span class="koboSpan" id="kobo.2366.1"> model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2367.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2368.1">get_queryset()</span></code><span class="koboSpan" id="kobo.2369.1"> method of a manager returns the QuerySet that will be executed. </span><span class="koboSpan" id="kobo.2369.2">We have overridden this method to build a custom QuerySet that filters posts by their status and returns a successive QuerySet that only includes posts with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2370.1">PUBLISHED</span></code><span class="koboSpan" id="kobo.2371.1"> status.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2372.1">We have now defined a custom manager for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2373.1">Post</span></code><span class="koboSpan" id="kobo.2374.1"> model. </span><span class="koboSpan" id="kobo.2374.2">Let’s test it!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2375.1">Start the development server again with the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2376.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2377.1">Now, you can import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2378.1">Post</span></code><span class="koboSpan" id="kobo.2379.1"> model and retrieve all published posts whose title starts with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2380.1">Who</span></code><span class="koboSpan" id="kobo.2381.1">, executing the following QuerySet:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2382.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2383.1">from</span></span><span class="koboSpan" id="kobo.2384.1"> blog.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2385.1">import</span></span><span class="koboSpan" id="kobo.2386.1"> Post
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2387.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.2388.1"> Post.published.</span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2389.1">filter</span></span><span class="koboSpan" id="kobo.2390.1">(title__startswith=</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2391.1">'Who'</span></span><span class="koboSpan" id="kobo.2392.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2393.1">To obtain results</span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.2394.1"> for this QuerySet, make sure to set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2395.1">status</span></code><span class="koboSpan" id="kobo.2396.1"> field to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2397.1">PUBLISHED</span></code><span class="koboSpan" id="kobo.2398.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2399.1">Post</span></code><span class="koboSpan" id="kobo.2400.1"> object whose </span><code class="inlineCode"><span class="koboSpan" id="kobo.2401.1">title</span></code><span class="koboSpan" id="kobo.2402.1"> starts with the string </span><em class="italic"><span class="koboSpan" id="kobo.2403.1">Who</span></em><span class="koboSpan" id="kobo.2404.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-67"><span class="koboSpan" id="kobo.2405.1">Building list and detail views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2406.1">Now that you </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.2407.1">understand how to use the ORM, you are ready to build the views of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2408.1">blog</span></code><span class="koboSpan" id="kobo.2409.1"> application. </span><span class="koboSpan" id="kobo.2409.2">A Django view is just a Python function that receives a web request and returns a web response. </span><span class="koboSpan" id="kobo.2409.3">All the logic to return the desired response goes inside the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2410.1">First, you will create your application views, then you will define a URL pattern for each view, and finally, you will create HTML templates to render the data generated by the views. </span><span class="koboSpan" id="kobo.2410.2">Each view will render a template, passing variables to it, and will return an HTTP response with the rendered output.</span></p>
<h2 class="heading-2" id="_idParaDest-68"><span class="koboSpan" id="kobo.2411.1">Creating list and detail views </span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2412.1">Let’s start by </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.2413.1">creating a view to display the list of posts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2414.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2415.1">views.py</span></code><span class="koboSpan" id="kobo.2416.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2417.1">blog</span></code><span class="koboSpan" id="kobo.2418.1"> application and make it look like this; the new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2419.1">from</span></span><span class="koboSpan" id="kobo.2420.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2421.1">import</span></span><span class="koboSpan" id="kobo.2422.1"> render
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2423.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2424.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2425.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2426.1"> Post</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2427.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2428.1">post_list</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2429.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2430.1">request</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2431.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2432.1">    posts = Post.published.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2433.1">all</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2434.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2435.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2436.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2437.1">        request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2438.1">'blog/post/list.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2439.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2440.1">        {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2441.1">'posts'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2442.1">: posts}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2443.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2444.1">This is our very first Django view. </span><span class="koboSpan" id="kobo.2444.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2445.1">post_list</span></code><span class="koboSpan" id="kobo.2446.1"> view takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2447.1">request</span></code><span class="koboSpan" id="kobo.2448.1"> object as the only parameter. </span><span class="koboSpan" id="kobo.2448.2">This parameter is required by all views.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2449.1">In this view, we retrieve all the posts with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2450.1">PUBLISHED</span></code><span class="koboSpan" id="kobo.2451.1"> status using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2452.1">published</span></code><span class="koboSpan" id="kobo.2453.1"> manager that we created previously.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2454.1">Finally, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2455.1">render()</span></code><span class="koboSpan" id="kobo.2456.1"> shortcut provided by Django to render the list of posts with the given template. </span><span class="koboSpan" id="kobo.2456.2">This function takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2457.1">request</span></code><span class="koboSpan" id="kobo.2458.1"> object, the template path, and the context variables to render the given template. </span><span class="koboSpan" id="kobo.2458.2">It returns an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2459.1">HttpResponse</span></code><span class="koboSpan" id="kobo.2460.1"> object with the rendered text (normally HTML code).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2461.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2462.1">render()</span></code><span class="koboSpan" id="kobo.2463.1"> shortcut takes the request context into account, so any variable set by the template context processors is accessible by the given template. </span><span class="koboSpan" id="kobo.2463.2">Template context processors are just callables that set variables into the context. </span><span class="koboSpan" id="kobo.2463.3">You will learn how to use context processors in </span><em class="italic"><span class="koboSpan" id="kobo.2464.1">Chapter 4</span></em><span class="koboSpan" id="kobo.2465.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2466.1">Building a Social Website</span></em><span class="koboSpan" id="kobo.2467.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2468.1">Let’s create a second view to display a single post. </span><span class="koboSpan" id="kobo.2468.2">Add the following function to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2469.1">views.py</span></code><span class="koboSpan" id="kobo.2470.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2471.1">from</span></span><span class="koboSpan" id="kobo.2472.1"> django.http </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2473.1">import</span></span><span class="koboSpan" id="kobo.2474.1"> Http404
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2475.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2476.1">post_detail</span></span><span class="koboSpan" id="kobo.2477.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2478.1">request, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2479.1">id</span></span><span class="koboSpan" id="kobo.2480.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2481.1">try</span></span><span class="koboSpan" id="kobo.2482.1">:
        post = Post.published.get(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2483.1">id</span></span><span class="koboSpan" id="kobo.2484.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2485.1">id</span></span><span class="koboSpan" id="kobo.2486.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2487.1">except</span></span><span class="koboSpan" id="kobo.2488.1"> Post.DoesNotExist:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2489.1">raise</span></span><span class="koboSpan" id="kobo.2490.1"> Http404(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2491.1">"No Post found."</span></span><span class="koboSpan" id="kobo.2492.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2493.1">return</span></span><span class="koboSpan" id="kobo.2494.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2495.1">'blog/post/detail.html'</span></span><span class="koboSpan" id="kobo.2496.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.2497.1">'post'</span></span><span class="koboSpan" id="kobo.2498.1">: post}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2499.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2500.1">post_detail</span></code><span class="koboSpan" id="kobo.2501.1"> view. </span><span class="koboSpan" id="kobo.2501.2">This view takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2502.1">id</span></code><span class="koboSpan" id="kobo.2503.1"> argument of a post. </span><span class="koboSpan" id="kobo.2503.2">In the view, we try to retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2504.1">Post</span></code><span class="koboSpan" id="kobo.2505.1"> object with the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.2506.1">id</span></code><span class="koboSpan" id="kobo.2507.1"> by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2508.1">get()</span></code><span class="koboSpan" id="kobo.2509.1"> method on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2510.1">published</span></code><span class="koboSpan" id="kobo.2511.1"> manager. </span><span class="koboSpan" id="kobo.2511.2">We raise an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2512.1">Http404</span></code><span class="koboSpan" id="kobo.2513.1"> exception to return an HTTP 404 error if the model </span><code class="inlineCode"><span class="koboSpan" id="kobo.2514.1">DoesNotExist</span></code><span class="koboSpan" id="kobo.2515.1"> exception</span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.2516.1"> is raised because no result is found.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2517.1">Finally, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2518.1">render()</span></code><span class="koboSpan" id="kobo.2519.1"> shortcut to render the retrieved post using a template.</span></p>
<h2 class="heading-2" id="_idParaDest-69"><span class="koboSpan" id="kobo.2520.1">Using the get_object_or_404 shortcut</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2521.1">Django provides </span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.2522.1">a shortcut</span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.2523.1"> to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.2524.1">get()</span></code><span class="koboSpan" id="kobo.2525.1"> on a given model manager and raises an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2526.1">Http404</span></code><span class="koboSpan" id="kobo.2527.1"> exception instead of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2528.1">DoesNotExist</span></code><span class="koboSpan" id="kobo.2529.1"> exception when no object is found.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2530.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2531.1">views.py</span></code><span class="koboSpan" id="kobo.2532.1"> file to import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2533.1">get_object_or_404</span></code><span class="koboSpan" id="kobo.2534.1"> shortcut and change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2535.1">post_detail</span></code><span class="koboSpan" id="kobo.2536.1"> view, as follows. </span><span class="koboSpan" id="kobo.2536.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2537.1">from</span></span><span class="koboSpan" id="kobo.2538.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2539.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2540.1">get_object_or_404, </span></strong></span><span class="koboSpan" id="kobo.2541.1">render
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2542.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2543.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2544.1">post_detail</span></span><span class="koboSpan" id="kobo.2545.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2546.1">request, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2547.1">id</span></span><span class="koboSpan" id="kobo.2548.1">):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2549.1">    post = get_object_or_404(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2550.1">        Post,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2551.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2552.1">=</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2553.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2554.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2555.1">        status=Post.Status.PUBLISHED</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2556.1">    )</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2557.1">return</span></span><span class="koboSpan" id="kobo.2558.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2559.1">'blog/post/detail.html'</span></span><span class="koboSpan" id="kobo.2560.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.2561.1">'post'</span></span><span class="koboSpan" id="kobo.2562.1">: post}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2563.1">In the detail view, we now use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2564.1">get_object_or_404()</span></code><span class="koboSpan" id="kobo.2565.1"> shortcut to retrieve the desired post. </span><span class="koboSpan" id="kobo.2565.2">This function </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.2566.1">retrieves the object that matches the given parameters or an HTTP 404 (not found) exception</span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.2567.1"> if no object is found.</span></p>
<h2 class="heading-2" id="_idParaDest-70"><span class="koboSpan" id="kobo.2568.1">Adding URL patterns for your views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2569.1">URL patterns allow </span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.2570.1">you to map URLs </span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.2571.1">to views. </span><span class="koboSpan" id="kobo.2571.2">A URL pattern is composed of a string pattern, a view, and, optionally, a name that allows you to name the URL project-wide. </span><span class="koboSpan" id="kobo.2571.3">Django runs through each URL pattern and stops at the first one that matches the requested URL. </span><span class="koboSpan" id="kobo.2571.4">Then, Django imports the view of the matching URL pattern and executes it, passing an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2572.1">HttpRequest</span></code><span class="koboSpan" id="kobo.2573.1"> class and the keyword or positional arguments.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2574.1">Create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2575.1">urls.py</span></code><span class="koboSpan" id="kobo.2576.1"> file in the directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2577.1">blog</span></code><span class="koboSpan" id="kobo.2578.1"> application and add the following lines to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2579.1">from</span></span><span class="koboSpan" id="kobo.2580.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2581.1">import</span></span><span class="koboSpan" id="kobo.2582.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2583.1">from</span></span><span class="koboSpan" id="kobo.2584.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2585.1">import</span></span><span class="koboSpan" id="kobo.2586.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2587.1">'blog'</span></span><span class="koboSpan" id="kobo.2588.1">
urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2589.1"># post views</span></span><span class="koboSpan" id="kobo.2590.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2591.1">''</span></span><span class="koboSpan" id="kobo.2592.1">, views.post_list, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2593.1">'post_list'</span></span><span class="koboSpan" id="kobo.2594.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2595.1">'&lt;int:id&gt;/'</span></span><span class="koboSpan" id="kobo.2596.1">, views.post_detail, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2597.1">'post_detail'</span></span><span class="koboSpan" id="kobo.2598.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2599.1">In the preceding code, you define an application namespace with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2600.1">app_name</span></code><span class="koboSpan" id="kobo.2601.1"> variable. </span><span class="koboSpan" id="kobo.2601.2">This allows you to organize URLs by application and use the name when referring to them. </span><span class="koboSpan" id="kobo.2601.3">You define two different patterns using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2602.1">path()</span></code><span class="koboSpan" id="kobo.2603.1"> function. </span><span class="koboSpan" id="kobo.2603.2">The first URL pattern doesn’t take any arguments and is mapped to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2604.1">post_list</span></code><span class="koboSpan" id="kobo.2605.1"> view. </span><span class="koboSpan" id="kobo.2605.2">The second pattern is mapped to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2606.1">post_detail</span></code><span class="koboSpan" id="kobo.2607.1"> view and takes only one argument </span><code class="inlineCode"><span class="koboSpan" id="kobo.2608.1">id</span></code><span class="koboSpan" id="kobo.2609.1">, which matches an integer, set by the path converter </span><code class="inlineCode"><span class="koboSpan" id="kobo.2610.1">int</span></code><span class="koboSpan" id="kobo.2611.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2612.1">You use angle brackets to capture the values from the URL. </span><span class="koboSpan" id="kobo.2612.2">Any value specified in the URL pattern as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2613.1">&lt;parameter&gt;</span></code><span class="koboSpan" id="kobo.2614.1"> is captured as a string. </span><span class="koboSpan" id="kobo.2614.2">You use path converters, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2615.1">&lt;int:year&gt;</span></code><span class="koboSpan" id="kobo.2616.1">, to specifically match and return an integer. </span><span class="koboSpan" id="kobo.2616.2">For example </span><code class="inlineCode"><span class="koboSpan" id="kobo.2617.1">&lt;slug:post&gt;</span></code><span class="koboSpan" id="kobo.2618.1"> would specifically match a slug (a string that can only contain letters, numbers, underscores, or hyphens). </span><span class="koboSpan" id="kobo.2618.2">You can see all the path converters provided by Django at </span><a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters"><span class="url"><span class="koboSpan" id="kobo.2619.1">https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters</span></span></a><span class="koboSpan" id="kobo.2620.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2621.1">If using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2622.1">path()</span></code><span class="koboSpan" id="kobo.2623.1"> and converters isn’t sufficient for you, you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2624.1">re_path()</span></code><span class="koboSpan" id="kobo.2625.1"> instead to define complex URL patterns with Python regular expressions. </span><span class="koboSpan" id="kobo.2625.2">You can learn more about defining URL patterns with regular expressions at </span><a href="https://docs.djangoproject.com/en/5.0/ref/urls/#django.urls.re_path"><span class="url"><span class="koboSpan" id="kobo.2626.1">https://docs.djangoproject.com/en/5.0/ref/urls/#django.urls.re_path</span></span></a><span class="koboSpan" id="kobo.2627.1">. </span><span class="koboSpan" id="kobo.2627.2">If you haven’t worked </span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.2628.1">with regular </span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.2629.1">expressions before, you might want to take a look at </span><em class="italic"><span class="koboSpan" id="kobo.2630.1">Regular Expression HOWTO</span></em><span class="koboSpan" id="kobo.2631.1">, located at </span><a href="https://docs.python.org/3/howto/regex.html"><span class="url"><span class="koboSpan" id="kobo.2632.1">https://docs.python.org/3/howto/regex.html</span></span></a><span class="koboSpan" id="kobo.2633.1">, first.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.2634.1">Creating a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2635.1">urls.py</span></code><span class="koboSpan" id="kobo.2636.1"> file for each application is the best way to make your applications reusable by other projects.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2637.1">Next, you have to include the URL patterns of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2638.1">blog</span></code><span class="koboSpan" id="kobo.2639.1"> application in the main URL patterns of the project.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2640.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2641.1">urls.py</span></code><span class="koboSpan" id="kobo.2642.1"> file located in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2643.1">mysite</span></code><span class="koboSpan" id="kobo.2644.1"> directory of your project and make it look like the following. </span><span class="koboSpan" id="kobo.2644.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2645.1">from</span></span><span class="koboSpan" id="kobo.2646.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2647.1">import</span></span><span class="koboSpan" id="kobo.2648.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2649.1">from</span></span><span class="koboSpan" id="kobo.2650.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2651.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2652.1">include, </span></strong></span><span class="koboSpan" id="kobo.2653.1">path
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2654.1">'admin/'</span></span><span class="koboSpan" id="kobo.2655.1">, admin.site.urls),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2656.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2657.1">'blog/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2658.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2659.1">'blog.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2660.1">, namespace=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2661.1">'blog'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2662.1">)),</span></strong></span><span class="koboSpan" id="kobo.2663.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2664.1">The new URL pattern defined with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2665.1">include</span></code><span class="koboSpan" id="kobo.2666.1"> refers to the URL patterns defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2667.1">blog</span></code><span class="koboSpan" id="kobo.2668.1"> application so that they are included under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2669.1">blog/</span></code><span class="koboSpan" id="kobo.2670.1"> path. </span><span class="koboSpan" id="kobo.2670.2">You include these patterns under the namespace </span><code class="inlineCode"><span class="koboSpan" id="kobo.2671.1">blog</span></code><span class="koboSpan" id="kobo.2672.1">. </span><span class="koboSpan" id="kobo.2672.2">Namespaces have to be unique across your entire project. </span><span class="koboSpan" id="kobo.2672.3">Later, you will refer to your blog URLs easily by using the namespace followed by a colon and the URL name, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2673.1">blog:post_list</span></code><span class="koboSpan" id="kobo.2674.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2675.1">blog:post_detail</span></code><span class="koboSpan" id="kobo.2676.1">. </span><span class="koboSpan" id="kobo.2676.2">You can learn more </span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.2677.1">about URL</span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.2678.1"> namespaces at </span><a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/#url-namespaces"><span class="url"><span class="koboSpan" id="kobo.2679.1">https://docs.djangoproject.com/en/5.0/topics/http/urls/#url-namespaces</span></span></a><span class="koboSpan" id="kobo.2680.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-71"><span class="koboSpan" id="kobo.2681.1">Creating templates for your views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2682.1">You have created </span><a id="_idIndexMarker144"/><span class="koboSpan" id="kobo.2683.1">views and URL patterns for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2684.1">blog</span></code><span class="koboSpan" id="kobo.2685.1"> application. </span><span class="koboSpan" id="kobo.2685.2">URL patterns map URLs to views, and views decide which data gets returned to the user. </span><span class="koboSpan" id="kobo.2685.3">Templates define how the data is displayed; they are usually written in HTML in combination with the Django template language. </span><span class="koboSpan" id="kobo.2685.4">You can find more information about the Django template language at </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/language/"><span class="url"><span class="koboSpan" id="kobo.2686.1">https://docs.djangoproject.com/en/5.0/ref/templates/language/</span></span></a><span class="koboSpan" id="kobo.2687.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2688.1">Let’s add templates to your application to display posts in a user-friendly manner.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2689.1">Create the following directories and files inside your </span><code class="inlineCode"><span class="koboSpan" id="kobo.2690.1">blog</span></code><span class="koboSpan" id="kobo.2691.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2692.1">templates/
    blog/
        base.html
        post/
            list.html
            detail.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2693.1">The preceding structure will be the file structure for your templates. </span><span class="koboSpan" id="kobo.2693.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2694.1">base.html</span></code><span class="koboSpan" id="kobo.2695.1"> file will include the main HTML structure of the website and divide the content into the main content area and a sidebar. </span><span class="koboSpan" id="kobo.2695.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2696.1">list.html</span></code><span class="koboSpan" id="kobo.2697.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2698.1">detail.html</span></code><span class="koboSpan" id="kobo.2699.1"> files will inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2700.1">base.html</span></code><span class="koboSpan" id="kobo.2701.1"> file to render the blog post list and detail views, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2702.1">Django has a powerful template language that allows you to specify how data is displayed. </span><span class="koboSpan" id="kobo.2702.2">It is based on </span><em class="italic"><span class="koboSpan" id="kobo.2703.1">template tags</span></em><span class="koboSpan" id="kobo.2704.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2705.1">template variables</span></em><span class="koboSpan" id="kobo.2706.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.2707.1">template filters</span></em><span class="koboSpan" id="kobo.2708.1">:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2709.1">Template tags control the rendering of the template and look like this: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2710.1">{% tag %}</span></code><span class="koboSpan" id="kobo.2711.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2712.1">Template variables get replaced with values when the template is rendered and look like this: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2713.1">{{ variable }}</span></code><span class="koboSpan" id="kobo.2714.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2715.1">Template filters allow you to modify variables for display and look like this: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2716.1">{{ variable|filter }}</span></code><span class="koboSpan" id="kobo.2717.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2718.1">You can see </span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.2719.1">all the built-in template tags and filters at </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/builtins/"><span class="url"><span class="koboSpan" id="kobo.2720.1">https://docs.djangoproject.com/en/5.0/ref/templates/builtins/</span></span></a><span class="koboSpan" id="kobo.2721.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-72"><span class="koboSpan" id="kobo.2722.1">Creating a base template</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2723.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2724.1">base.html</span></code><span class="koboSpan" id="kobo.2725.1"> file </span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.2726.1">and add the following</span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.2727.1"> code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2728.1">{% load static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2729.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2730.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.2731.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2732.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2733.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2734.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2735.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2736.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2737.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2738.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2739.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2740.1">&gt;</span></span><span class="koboSpan" id="kobo.2741.1">{% block title %}{% endblock %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2742.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2743.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2744.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2745.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2746.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2747.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2748.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2749.1">"{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2750.1">css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2751.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2752.1">blog.css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2753.1">" %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2754.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2755.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2756.1">"stylesheet"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2757.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2758.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2759.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2760.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2761.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2762.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2763.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2764.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2765.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2766.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2767.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2768.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2769.1">&gt;</span></span><span class="koboSpan" id="kobo.2770.1">
    {% block content %}
    {% endblock %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2771.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2772.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2773.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2774.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2775.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2776.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2777.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2778.1">"sidebar"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2779.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2780.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2781.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2782.1">&gt;</span></span><span class="koboSpan" id="kobo.2783.1">My blog</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2784.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2785.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2786.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2787.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2788.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2789.1">&gt;</span></span><span class="koboSpan" id="kobo.2790.1">This is my blog.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2791.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2792.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2793.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2794.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2795.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2796.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2797.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2798.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2799.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2800.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2801.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2802.1">&gt;</span></span>
</code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2803.1">{% load static %}</span></code><span class="koboSpan" id="kobo.2804.1"> tells Django to load the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2805.1">static</span></code><span class="koboSpan" id="kobo.2806.1"> template tags that are provided by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2807.1">django.contrib.staticfiles</span></code><span class="koboSpan" id="kobo.2808.1"> application, which is contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2809.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.2810.1"> setting. </span><span class="koboSpan" id="kobo.2810.2">After loading them, you can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2811.1">{% static %}</span></code><span class="koboSpan" id="kobo.2812.1"> template tag throughout this template. </span><span class="koboSpan" id="kobo.2812.2">With this template tag, you can include the static files, such as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2813.1">blog.css</span></code><span class="koboSpan" id="kobo.2814.1"> file, which you will find in the code of this example under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2815.1">static/</span></code><span class="koboSpan" id="kobo.2816.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2817.1">blog</span></code><span class="koboSpan" id="kobo.2818.1"> application. </span><span class="koboSpan" id="kobo.2818.2">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2819.1">static/</span></code><span class="koboSpan" id="kobo.2820.1"> directory from the code that comes along with this chapter into the same location as your project to apply the CSS styles to the templates. </span><span class="koboSpan" id="kobo.2820.2">You can find the directory’s contents at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static"><span class="url"><span class="koboSpan" id="kobo.2821.1">https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static</span></span></a><span class="koboSpan" id="kobo.2822.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2823.1">You can see that there are two </span><code class="inlineCode"><span class="koboSpan" id="kobo.2824.1">{% block %}</span></code><span class="koboSpan" id="kobo.2825.1"> tags. </span><span class="koboSpan" id="kobo.2825.2">These tell Django that you want to define a block in that area. </span><span class="koboSpan" id="kobo.2825.3">Templates that inherit from this template can fill in the blocks with</span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.2826.1"> content. </span><span class="koboSpan" id="kobo.2826.2">You have defined </span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.2827.1">a block called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2828.1">title</span></code><span class="koboSpan" id="kobo.2829.1"> and a block called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2830.1">content</span></code><span class="koboSpan" id="kobo.2831.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-73"><span class="koboSpan" id="kobo.2832.1">Creating the post list template</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2833.1">Let’s edit </span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.2834.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2835.1">post/list.html</span></code><span class="koboSpan" id="kobo.2836.1"> file and </span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.2837.1">make it look like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2838.1">{% extends "blog/base.html" %}
{% block title %}My Blog{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2839.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2840.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2841.1">&gt;</span></span><span class="koboSpan" id="kobo.2842.1">My Blog</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2843.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2844.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2845.1">&gt;</span></span><span class="koboSpan" id="kobo.2846.1">
  {% for post in posts %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2847.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2848.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2849.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2850.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2851.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2852.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2853.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2854.1">"{% url 'blog:post_detail' post.id %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2855.1">&gt;</span></span><span class="koboSpan" id="kobo.2856.1">
        {{ post.title }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2857.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2858.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2859.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2860.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2861.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2862.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2863.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2864.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2865.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2866.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2867.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2868.1">date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2869.1">&gt;</span></span><span class="koboSpan" id="kobo.2870.1">
      Published {{ post.publish }} by {{ post.author }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2871.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2872.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2873.1">&gt;</span></span><span class="koboSpan" id="kobo.2874.1">
    {{ post.body|truncatewords:30|linebreaks }}
  {% endfor %}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2875.1">With the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2876.1">{% extends %}</span></code><span class="koboSpan" id="kobo.2877.1"> template tag, you tell Django to inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2878.1">blog/base.html</span></code><span class="koboSpan" id="kobo.2879.1"> template. </span><span class="koboSpan" id="kobo.2879.2">Then, you fill the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2880.1">title</span></code><span class="koboSpan" id="kobo.2881.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2882.1">content</span></code><span class="koboSpan" id="kobo.2883.1"> blocks of the base template with content. </span><span class="koboSpan" id="kobo.2883.2">You iterate through the posts and display their title, date, author, and body, including a link in the title to the detail URL of the post. </span><span class="koboSpan" id="kobo.2883.3">We build the URL using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2884.1">{% url %}</span></code><span class="koboSpan" id="kobo.2885.1"> template tag provided by Django.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2886.1">This template tag allows you to build URLs dynamically by their name. </span><span class="koboSpan" id="kobo.2886.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2887.1">blog:post_detail</span></code><span class="koboSpan" id="kobo.2888.1"> to refer to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2889.1">post_detail</span></code><span class="koboSpan" id="kobo.2890.1"> URL in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2891.1">blog</span></code><span class="koboSpan" id="kobo.2892.1"> namespace. </span><span class="koboSpan" id="kobo.2892.2">We pass the required </span><code class="inlineCode"><span class="koboSpan" id="kobo.2893.1">post.id</span></code><span class="koboSpan" id="kobo.2894.1"> parameter to build the URL for each post.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.2895.1">Always use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2896.1">{% url %}</span></code><span class="koboSpan" id="kobo.2897.1"> template tag to build URLs in your templates instead of writing hardcoded URLs. </span><span class="koboSpan" id="kobo.2897.2">This will make your URLs more maintainable.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2898.1">In the body of the post, we apply two template filters: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2899.1">truncatewords</span></code><span class="koboSpan" id="kobo.2900.1"> truncates the value to the number of words specified, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2901.1">linebreaks</span></code><span class="koboSpan" id="kobo.2902.1"> converts the output into HTML line breaks. </span><span class="koboSpan" id="kobo.2902.2">You can concatenate as many template filters as you wish; each one will be applied to the</span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.2903.1"> output generated by the</span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.2904.1"> preceding one.</span></p>
<h2 class="heading-2" id="_idParaDest-74"><span class="koboSpan" id="kobo.2905.1">Accessing our application</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2906.1">Change the</span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.2907.1"> status of the initial post to </span><strong class="screenText"><span class="koboSpan" id="kobo.2908.1">Published</span></strong><span class="koboSpan" id="kobo.2909.1">, as</span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.2910.1"> shown in </span><em class="italic"><span class="koboSpan" id="kobo.2911.1">Figure 1.16</span></em><span class="koboSpan" id="kobo.2912.1">, and create some new posts, also with a </span><strong class="screenText"><span class="koboSpan" id="kobo.2913.1">Published</span></strong><span class="koboSpan" id="kobo.2914.1"> status.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2915.1"><img alt="" role="presentation" src="../Images/B21088_01_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2916.1">Figure 1.16: The status field for a published post</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2917.1">Open the shell and execute the following command to start the development server:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2918.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2919.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2920.1">http://127.0.0.1:8000/blog/</span></code><span class="koboSpan" id="kobo.2921.1"> in your browser; you will see everything running. </span><span class="koboSpan" id="kobo.2921.2">You should see something like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2922.1"><img alt="" role="presentation" src="../Images/B21088_01_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2923.1">Figure 1.17: The page for the post list view</span></p>
<h2 class="heading-2" id="_idParaDest-75"><span class="koboSpan" id="kobo.2924.1">Creating the post detail template</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2925.1">Next, edit</span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.2926.1"> the</span><a id="_idIndexMarker157"/> <code class="inlineCode"><span class="koboSpan" id="kobo.2927.1">post/detail.html</span></code><span class="koboSpan" id="kobo.2928.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2929.1">{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2930.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2931.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2932.1">&gt;</span></span><span class="koboSpan" id="kobo.2933.1">{{ post.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2934.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2935.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2936.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2937.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2938.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2939.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2940.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2941.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2942.1">&gt;</span></span><span class="koboSpan" id="kobo.2943.1">
    Published {{ post.publish }} by {{ post.author }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2944.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2945.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2946.1">&gt;</span></span><span class="koboSpan" id="kobo.2947.1">
  {{ post.body|linebreaks }}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2948.1">Next, you can return to your browser and click on one of the post titles to take a look at the detail view of the post. </span><span class="koboSpan" id="kobo.2948.2">You should see something like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2949.1"><img alt="" role="presentation" src="../Images/B21088_01_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2950.1">Figure 1.18: The page for the post’s detail view</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2951.1">Take a look at</span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.2952.1"> the URL – it should include the </span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.2953.1">auto-generated post ID, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.2954.1">/blog/1/</span></code><span class="koboSpan" id="kobo.2955.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-76"><span class="koboSpan" id="kobo.2956.1">The request/response cycle</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2957.1">Let’s review the</span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.2958.1"> request/response cycle of Django with the application we built. </span><span class="koboSpan" id="kobo.2958.2">The following schema shows a simplified example of how Django processes HTTP requests and generates HTTP responses:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2959.1"><img alt="Timeline  Description automatically generated with medium confidence" src="../Images/B21088_01_19.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2960.1">Figure 1.19: The Django request/response cycle</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2961.1">Let’s review the </span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.2962.1">Django request/response process:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2963.1">A web browser requests a page by its URL, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2964.1">https://domain.com/blog/33/</span></code><span class="koboSpan" id="kobo.2965.1">. </span><span class="koboSpan" id="kobo.2965.2">The web server receives the HTTP request and passes it over to Django.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2966.1">Django runs through each URL pattern defined in the URL patterns configuration. </span><span class="koboSpan" id="kobo.2966.2">The framework checks each pattern against the given URL path, in order of appearance, and stops at the first one that matches the requested URL. </span><span class="koboSpan" id="kobo.2966.3">In this case, the pattern </span><code class="inlineCode"><span class="koboSpan" id="kobo.2967.1">/blog/&lt;id&gt;/</span></code><span class="koboSpan" id="kobo.2968.1"> matches the path </span><code class="inlineCode"><span class="koboSpan" id="kobo.2969.1">/blog/33/</span></code><span class="koboSpan" id="kobo.2970.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2971.1">Django imports the view of the matching URL pattern and executes it, passing an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2972.1">HttpRequest</span></code><span class="koboSpan" id="kobo.2973.1"> class and the keyword or positional arguments. </span><span class="koboSpan" id="kobo.2973.2">The view uses the models to retrieve information from the database. </span><span class="koboSpan" id="kobo.2973.3">Using the Django ORM, QuerySets are translated into SQL and executed in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2974.1">The view uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2975.1">render()</span></code><span class="koboSpan" id="kobo.2976.1"> function to render an HTML template passing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2977.1">Post</span></code><span class="koboSpan" id="kobo.2978.1"> object as a context variable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2979.1">The rendered content is returned as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2980.1">HttpResponse</span></code><span class="koboSpan" id="kobo.2981.1"> object by the view with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2982.1">text/html</span></code><span class="koboSpan" id="kobo.2983.1"> content type by default.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2984.1">You can always use this schema as the basic reference for how Django processes requests. </span><span class="koboSpan" id="kobo.2984.2">This schema doesn’t include Django middleware, for the sake of simplicity. </span><span class="koboSpan" id="kobo.2984.3">You will use</span><a id="_idIndexMarker162"/><span class="koboSpan" id="kobo.2985.1"> middleware in different examples of this book, and you will learn how to create custom middleware in </span><em class="italic"><span class="koboSpan" id="kobo.2986.1">Chapter 17</span></em><span class="koboSpan" id="kobo.2987.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2988.1">Going Live</span></em><span class="koboSpan" id="kobo.2989.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-77"><span class="koboSpan" id="kobo.2990.1">Management commands used in this chapter</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2991.1">In this chapter, we have </span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.2992.1">introduced a variety of Django management commands. </span><span class="koboSpan" id="kobo.2992.2">You need to get familiar with them, as they will be used often throughout the book. </span><span class="koboSpan" id="kobo.2992.3">Let’s revisit the commands we have covered in this chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2993.1">To create the file structure for a new Django project named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2994.1">mysite</span></code><span class="koboSpan" id="kobo.2995.1">, we used the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2996.1">django-admin startproject mysite
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2997.1">To create the file structure for a new Django application named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2998.1">blog</span></code><span class="koboSpan" id="kobo.2999.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3000.1">python manage.py startapp blog
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3001.1">To apply all database migrations:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3002.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3003.1">To create migrations for the models of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3004.1">blog</span></code><span class="koboSpan" id="kobo.3005.1"> application:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3006.1">python manage.py makemigrations blog
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3007.1">To view the SQL statements that will be executed with the first migration of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3008.1">blog</span></code><span class="koboSpan" id="kobo.3009.1"> application:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3010.1">python manage.py sqlmigrate blog 0001
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3011.1">To run the Django development server:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3012.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3013.1">To run the development server specifying host/port and settings file:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3014.1">python manage.py runserver 127.0.0.1:8001 --settings=mysite.settings
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3015.1">To run the Django shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3016.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3017.1">To create a superuser using the Django authentication framework:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3018.1">python manage.py createsuperuser
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3019.1">For the full list of</span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.3020.1"> available management commands, check out </span><a href="https://docs.djangoproject.com/en/5.0/ref/django-admin/"><span class="url"><span class="koboSpan" id="kobo.3021.1">https://docs.djangoproject.com/en/5.0/ref/django-admin/</span></span></a><span class="koboSpan" id="kobo.3022.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-78"><span class="koboSpan" id="kobo.3023.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3024.1">In this chapter, you learned the basics of the Django web framework by creating a simple blog application. </span><span class="koboSpan" id="kobo.3024.2">You designed the data models and applied migrations to the database. </span><span class="koboSpan" id="kobo.3024.3">You also created the views, templates, and URLs for your blog.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3025.1">In the next chapter, you will enhance your blog by creating canonical URLs for your posts and building SEO-friendly URLs. </span><span class="koboSpan" id="kobo.3025.2">You will also learn how to implement object pagination and how to build class-based views. </span><span class="koboSpan" id="kobo.3025.3">You will also create forms to let your users recommend posts by email and comment on posts.</span></p>
<h1 class="heading-1" id="_idParaDest-79"><span class="koboSpan" id="kobo.3026.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3027.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3028.1">Source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01"><span class="url"><span class="koboSpan" id="kobo.3029.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter01</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3030.1">Download Python: </span><a href="https://www.python.org/downloads/"><span class="url"><span class="koboSpan" id="kobo.3031.1">https://www.python.org/downloads/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3032.1">Windows Python launcher: </span><a href="https://docs.python.org/3/using/windows.html#launcher"><span class="url"><span class="koboSpan" id="kobo.3033.1">https://docs.python.org/3/using/windows.html#launcher</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3034.1">Python </span><code class="inlineCode"><span class="koboSpan" id="kobo.3035.1">venv</span></code><span class="koboSpan" id="kobo.3036.1"> library for virtual environments: </span><a href="https://docs.python.org/3/library/venv.html"><span class="url"><span class="koboSpan" id="kobo.3037.1">https://docs.python.org/3/library/venv.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3038.1">Python </span><code class="inlineCode"><span class="koboSpan" id="kobo.3039.1">pip</span></code><span class="koboSpan" id="kobo.3040.1"> installation instructions: at </span><a href="https://pip.pypa.io/en/stable/installation/"><span class="url"><span class="koboSpan" id="kobo.3041.1">https://pip.pypa.io/en/stable/installation/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3042.1">Django installation options: </span><a href="https://docs.djangoproject.com/en/5.0/topics/install/"><span class="url"><span class="koboSpan" id="kobo.3043.1">https://docs.djangoproject.com/en/5.0/topics/install/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3044.1">Django 5.0 release notes: </span><a href="https://docs.djangoproject.com/en/5.0/releases/5.0/"><span class="url"><span class="koboSpan" id="kobo.3045.1">https://docs.djangoproject.com/en/5.0/releases/5.0/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3046.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3047.1">django-upgrade</span></code><span class="koboSpan" id="kobo.3048.1"> tool: </span><a href="https://github.com/adamchainz/django-upgrade"><span class="url"><span class="koboSpan" id="kobo.3049.1">https://github.com/adamchainz/django-upgrade</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3050.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3051.1">pyupgrade</span></code><span class="koboSpan" id="kobo.3052.1"> tool: </span><a href="https://github.com/asottile/pyupgrade"><span class="url"><span class="koboSpan" id="kobo.3053.1">https://github.com/asottile/pyupgrade</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3054.1">Django’s design philosophies: </span><a href="https://docs.djangoproject.com/en/5.0/misc/design-philosophies/"><span class="url"><span class="koboSpan" id="kobo.3055.1">https://docs.djangoproject.com/en/5.0/misc/design-philosophies/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3056.1">Django model field reference: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/"><span class="url"><span class="koboSpan" id="kobo.3057.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3058.1">Model index reference: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/indexes/"><span class="url"><span class="koboSpan" id="kobo.3059.1">https://docs.djangoproject.com/en/5.0/ref/models/indexes/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3060.1">Python support for enumerations: </span><a href="https://docs.python.org/3/library/enum.html"><span class="url"><span class="koboSpan" id="kobo.3061.1">https://docs.python.org/3/library/enum.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3062.1">Django model enumeration types: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types"><span class="url"><span class="koboSpan" id="kobo.3063.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/#enumeration-types</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3064.1">Django settings reference: </span><a href="https://docs.djangoproject.com/en/5.0/ref/settings/"><span class="url"><span class="koboSpan" id="kobo.3065.1">https://docs.djangoproject.com/en/5.0/ref/settings/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3066.1">Database default values for model fields: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default"><span class="url"><span class="koboSpan" id="kobo.3067.1">https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.db_default</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3068.1">Database functions: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/database-functions/"><span class="url"><span class="koboSpan" id="kobo.3069.1">https://docs.djangoproject.com/en/5.0/ref/models/database-functions/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3070.1">Django administration site: </span><a href="https://docs.djangoproject.com/en/5.0/ref/contrib/admin/"><span class="url"><span class="koboSpan" id="kobo.3071.1">https://docs.djangoproject.com/en/5.0/ref/contrib/admin/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3072.1">Model API reference: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/"><span class="url"><span class="koboSpan" id="kobo.3073.1">https://docs.djangoproject.com/en/5.0/ref/models/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3074.1">Making queries with the Django ORM: </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/"><span class="url"><span class="koboSpan" id="kobo.3075.1">https://docs.djangoproject.com/en/5.0/topics/db/queries/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3076.1">QuerySet API reference: </span><a href="https://docs.djangoproject.com/en/5.0/ref/models/querysets/"><span class="url"><span class="koboSpan" id="kobo.3077.1">https://docs.djangoproject.com/en/5.0/ref/models/querysets/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3078.1">Complex lookups with Q objects: </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects"><span class="url"><span class="koboSpan" id="kobo.3079.1">https://docs.djangoproject.com/en/5.0/topics/db/queries/#complex-lookups-with-q-objects</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3080.1">Django URL dispatcher: </span><a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/"><span class="url"><span class="koboSpan" id="kobo.3081.1">https://docs.djangoproject.com/en/5.0/topics/http/urls/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3082.1">Django template language: </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/language/"><span class="url"><span class="koboSpan" id="kobo.3083.1">https://docs.djangoproject.com/en/5.0/ref/templates/language/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3084.1">Built-in template tags and filters: </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/builtins/"><span class="url"><span class="koboSpan" id="kobo.3085.1">https://docs.djangoproject.com/en/5.0/ref/templates/builtins/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3086.1">Django management commands: </span><a href="https://docs.djangoproject.com/en/5.0/ref/django-admin/"><span class="url"><span class="koboSpan" id="kobo.3087.1">https://docs.djangoproject.com/en/5.0/ref/django-admin/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3088.1">Static files for the code in this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static"><span class="url"><span class="koboSpan" id="kobo.3089.1">https://github.com/PacktPublishing/Django-5-by-example/tree/master/Chapter01/mysite/blog/static</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-80"><span class="koboSpan" id="kobo.3090.1">Join us on Discord!</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3091.1">Read this book alongside other users, Django development experts, and the author himself. </span><span class="koboSpan" id="kobo.3091.2">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more.Scan the QR code or visit the link to join the community.</span></p>
<p class="normal"><span class="url"><span class="koboSpan" id="kobo.3092.1">https://packt.link/Django5ByExample</span></span></p>
<p class="normal"><span class="koboSpan" id="kobo.3093.1"><img alt="" role="presentation" src="../Images/QR_Code287089408934129031.png"/></span></p>
</div>
</body></html>