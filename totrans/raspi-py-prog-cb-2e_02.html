<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Starting with Python Strings, Files, and Menus"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Starting with Python Strings, Files, and Menus</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Working with text and strings</li><li class="listitem" style="list-style-type: disc">Using files and handling errors</li><li class="listitem" style="list-style-type: disc">Creating a boot-up menu</li><li class="listitem" style="list-style-type: disc">Creating a self-defining menu</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Introduction</h1></div></div></div><p>In this chapter, we discuss how to use Python to perform some basic encryption by scrambling letters. This will introduce some basic string manipulation, user input, progressing on to creating reusable modules, and graphical user interfaces.</p><p>To follow, we will create some useful Python scripts that can be added to run as the Raspberry Pi boots or an easy-to-run command that will provide quick shortcuts to common or frequently-used commands. Taking this further, we will make use of threading to run multiple tasks and introduce classes to define multiple objects.</p><p>As it is<a class="indexterm" id="id196"/> customary to start any programming exercise with a <span class="emphasis"><em>Hello World</em></span> example, we will kick off with that now.</p><p>Create the <code class="literal">hellopi.py</code> file using <code class="literal">nano</code>, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>nano -c hellopi.py</strong></span>
</pre></div><p>Within our <code class="literal">hellopi.py</code> file, add the following code:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#hellopi.py
print ("Hello Raspberry Pi")</pre></div><p>When done, save and exit (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y</em></span>, and <span class="emphasis"><em>Enter</em></span>). To run the file, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python3 hellopi.py</strong></span>
</pre></div><p>Congratulations, you have created your first program!</p><p>Your <a class="indexterm" id="id197"/>result should be similar to the following screenshot:</p><div class="mediaobject"><img alt="Introduction" src="graphics/6623OT_02_01.jpg"/><div class="caption"><p>The Hello Raspberry Pi output</p></div></div></div></div>
<div class="section" title="Working with text and strings"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Working with text and strings</h1></div></div></div><p>A good starting point for Python is to gain an understanding of basic text handling and strings. A string is a<a class="indexterm" id="id198"/> block of characters stored together as a value. As you <a class="indexterm" id="id199"/>will learn, they <a class="indexterm" id="id200"/>can be viewed as a simple list of characters.</p><p>We will create a script to obtain the user's input, use string manipulation to switch around the letters, and print out a coded version of the message. We will then extend this example by demonstrating how encoded messages can be passed between parties without revealing the encoding methods, while also showing how to reuse sections of the code within other Python modules.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>Getting ready</h2></div></div></div><p>You can use most text editors to write Python code. They can be used directly on the Raspberry Pi or remotely through VNC or SSH.</p><p>The following are a few text editors that are available with the Raspberry Pi:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>nano</strong></span>: This <a class="indexterm" id="id201"/>text editor is available at the terminal and includes <a class="indexterm" id="id202"/>syntax highlighting and line numbers (with the <code class="literal">-c</code> option). Refer to the following screenshot:<div class="mediaobject"><img alt="Getting ready" src="graphics/6623OT_02_02.jpg"/><div class="caption"><p>The nano command-line editor</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>IDLE3</strong></span>: This <a class="indexterm" id="id203"/>Python editor includes the syntax highlighting <a class="indexterm" id="id204"/>feature, context help, and will run scripts directly from the editor (on pressing <span class="emphasis"><em>F5</em></span>). This program requires X-Windows (the Debian desktop) or X11-forwarding to run remotely. We will be using Python 3 throughout the book, so ensure that you run IDLE3 (rather than IDLE), which <a class="indexterm" id="id205"/>will use Python 3 to run the scripts, as shown in the <a class="indexterm" id="id206"/>following screenshot:<div class="mediaobject"><img alt="Getting ready" src="graphics/6623OT_02_03.jpg"/><div class="caption"><p>The IDLE3 Python editor</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Geany</strong></span>: This<a class="indexterm" id="id207"/> text <a class="indexterm" id="id208"/>editor provides an <span class="strong"><strong>Integrated Development Environment</strong></span> (<span class="strong"><strong>IDE</strong></span>) that supports a range of <a class="indexterm" id="id209"/>programming languages, syntax highlighting, auto completion, and easy code navigation. This is a feature-rich editor, but can be difficult to use for beginners and may sometimes be slow when running on the Raspberry Pi. Again, you will need to run this editor with the Debian desktop or X11-forwarding. Refer to the following screenshot:<div class="mediaobject"><img alt="Getting ready" src="graphics/6623OT_02_04.jpg"/><div class="caption"><p>The Geany IDE</p></div></div><p>To install Geany, use the following command and then run <span class="strong"><strong>Geany</strong></span> from the <span class="strong"><strong>Programming</strong></span> menu item:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install geany</strong></span>
</pre></div><p>To ensure Geany uses Python 3 when you click on the <span class="strong"><strong>Execute</strong></span> button (to run your scripts), you <a class="indexterm" id="id210"/>will need to change the <span class="emphasis"><em>build</em></span> commands. Load <code class="literal">hellopi.py</code> and then click on the <span class="strong"><strong>Build</strong></span> menu and select <span class="strong"><strong>Set Build Commands</strong></span>. In the window that appears, as shown in the following<a class="indexterm" id="id211"/> screenshot, change <code class="literal">python</code> to <code class="literal">python3</code> in the <span class="strong"><strong>Compile</strong></span> and <span class="strong"><strong>Execute</strong></span> sections. Python is always compiled automatically when it is run (producing the temporary <code class="literal">.pyc</code> files), so you don't need to use the <span class="strong"><strong>Compile</strong></span> button, except maybe to check the syntax of the code:</p><div class="mediaobject"><img alt="Getting ready" src="graphics/6623OT_02_05.jpg"/><div class="caption"><p>The Geany Build command settings for Python 3</p></div></div></li></ul></div><p>If you have the <code class="literal">home</code> directory of the Raspberry Pi shared across the network (refer to <span class="emphasis"><em>Sharing the home folder of the Raspberry Pi with SMB</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with a Raspberry Pi Computer">Chapter 1</a>, <span class="emphasis"><em>Getting Started with a Raspberry Pi Computer</em></span>), you can edit files on another computer. However, note<a class="indexterm" id="id212"/> that if you use Windows, you must use an editor that supports <a class="indexterm" id="id213"/>Linux line endings, such as Notepad++ (you should not use the standard Notepad program).</p><p>To create a space for your Python scripts, we will add a <code class="literal">python_scripts</code> folder to your <code class="literal">home</code> directory with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mkdir ~/python_scripts</strong></span>
</pre></div><p>Now you can open this folder and list the files whenever you need to, using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cd ~/python_scripts</strong></span>
<span class="strong"><strong>ls</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>You can use the <span class="emphasis"><em>Tab</em></span> key to help complete commands in the terminal, for example, typing <code class="literal">cd ~/pyt</code> and then pressing the <span class="emphasis"><em>Tab</em></span> key will finish the command for you. If there are multiple options that start with <code class="literal">pyt</code>, pressing the <span class="emphasis"><em>Tab</em></span> key again will list them.</p><p>To repeat or edit <a class="indexterm" id="id214"/>older commands, use the up and down arrow keys to switch between older and newer commands as required.</p></div></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>How to do it…</h2></div></div></div><p>Create<a class="indexterm" id="id215"/> the <code class="literal">encryptdecrypt.py</code> script as follows:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#encryptdecrypt.py

#Takes the input_text and encrypts it, returning the result
def encryptText(input_text,key):
  input_text=input_text.upper()
  result = ""
  for letter in input_text:
    #Ascii Uppercase 65-90  Lowercase 97-122 (Full range 32-126)
    ascii_value=ord(letter)
    #Exclude non-characters from encryption
    if (ord("A") &gt; ascii_value) or (ascii_value &gt; ord("Z")):
      result+=letter
    else:
      #Apply encryption key
      key_value = ascii_value+key
      #Ensure we just use A-Z regardless of key
      if not((ord("A")) &lt; key_val &lt; ord("Z")):
        key_val = ord("A")+(key_val-ord("A"))\
                         %(ord("Z")-ord("A")+1)
      #Add the encoded letter to the result string
      result+=str(chr(key_value))
  return result

#Test function
def main():
  print ("Please enter text to scramble:")
  #Get user input
  try:
    user_input = input()
    scrambled_result = encryptText(user_input,10)
    print ("Result: " + scrambled_result)
    print ("To un-scramble, press enter again")
    input()
    unscrambled_result = encryptText(scrambled_result,-10)
    print ("Result: " + unscrambled_result)
  except UnicodeDecodeError:
    print ("Sorry: Only ASCII Characters are supported")

main()
#End</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>Within the <span class="emphasis"><em>There's more…</em></span> section of this recipe, we will change <code class="literal">main()</code> to the following code:</p><div class="informalexample"><pre class="programlisting">if __name__=="__main__":
  main()</pre></div><p>If you want to skip the section, ensure that you include this change in the <code class="literal">encryptdecrypt.py</code> file, as we will use it later.</p></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>How it works…</h2></div></div></div><p>The preceding script implements a very basic method to scramble the text using a simple form of character <a class="indexterm" id="id216"/>substitution called the <span class="strong"><strong>Caesar cipher</strong></span>. Named after the Roman emperor Julius Caesar, who originally used this method to send secret orders to his armies.</p><p>The file<a class="indexterm" id="id217"/> defines<a class="indexterm" id="id218"/> two functions, <code class="literal">encryptText()</code> and <code class="literal">main()</code>.</p><p>When the script is running, the <code class="literal">main()</code> function obtains the user's input using the <code class="literal">input()</code> command. The result is stored as a string in the <code class="literal">user_input</code> variable (the command will wait until the user has pressed the <span class="emphasis"><em>Enter</em></span> key before continuing), as follows:</p><div class="informalexample"><pre class="programlisting">user_input = input()</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>The <code class="literal">input()</code> function will not handle non-ASCII characters, so we use <code class="literal">try…except</code> to handle this case, which will cause <code class="literal">UnicodeDecodeError</code> to be raised. For more information about using <code class="literal">try…except</code>, refer to the <span class="emphasis"><em>Using files and handling errors</em></span> recipe of this chapter.</p></div></div><p>We will call the <code class="literal">encryptText()</code> function with two arguments, the text to be encrypted, and the key. After the text has been encrypted, the result is printed:</p><div class="informalexample"><pre class="programlisting">scrambled_result = encryptText(user_input,10)
print ("Result: " + scrambled_result)</pre></div><p>Finally, we will use <code class="literal">input()</code> to wait for the user input again (in this case, a prompt to press <span class="emphasis"><em>Enter</em></span>; any other input is ignored). Now, we will unscramble the text by reversing the encryption by calling <code class="literal">encryptText()</code> again, but with a negative version of the key, and displaying the result, which should be the original message.</p><p>The <code class="literal">encryptText()</code> function performs a simple form of encryption by taking the letters in the message<a class="indexterm" id="id219"/> and substituting each letter with another in the alphabet (determined by counting from the number of letters specified by the encryption <code class="literal">key</code>). In this<a class="indexterm" id="id220"/> way, the letter <code class="literal">A</code> will become <code class="literal">C</code> when the encryption <code class="literal">key</code> is <code class="literal">2</code>.</p><p>To simplify the process, the function converts all characters to uppercase. This allows us to use the ASCII character set to translate each character into numbers easily; the letter <code class="literal">A</code> is represented by <code class="literal">65</code> and <code class="literal">Z</code> by <code class="literal">90</code>. This is achieved with <code class="literal">input_text=input_text.upper()</code> and then by using <code class="literal">ord(letter)</code> to convert to an ASCII value, which gives us a number representation of the character. ASCII is a standard that maps the numbers 0 to 254 (an 8-bit value) and commonly used characters and symbols:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>A</p>
</th><th style="text-align: left" valign="bottom">
<p>B</p>
</th><th style="text-align: left" valign="bottom">
<p>C</p>
</th><th style="text-align: left" valign="bottom">
<p>D</p>
</th><th style="text-align: left" valign="bottom">
<p>E</p>
</th><th style="text-align: left" valign="bottom">
<p>F</p>
</th><th style="text-align: left" valign="bottom">
<p>G</p>
</th><th style="text-align: left" valign="bottom">
<p>H</p>
</th><th style="text-align: left" valign="bottom">
<p>I</p>
</th><th style="text-align: left" valign="bottom">
<p>J</p>
</th><th style="text-align: left" valign="bottom">
<p>K</p>
</th><th style="text-align: left" valign="bottom">
<p>L</p>
</th><th style="text-align: left" valign="bottom">
<p>M</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>65</p>
</td><td style="text-align: left" valign="top">
<p>66</p>
</td><td style="text-align: left" valign="top">
<p>67</p>
</td><td style="text-align: left" valign="top">
<p>68</p>
</td><td style="text-align: left" valign="top">
<p>69</p>
</td><td style="text-align: left" valign="top">
<p>70</p>
</td><td style="text-align: left" valign="top">
<p>71</p>
</td><td style="text-align: left" valign="top">
<p>72</p>
</td><td style="text-align: left" valign="top">
<p>73</p>
</td><td style="text-align: left" valign="top">
<p>74</p>
</td><td style="text-align: left" valign="top">
<p>75</p>
</td><td style="text-align: left" valign="top">
<p>76</p>
</td><td style="text-align: left" valign="top">
<p>77</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>N</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>O</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>P</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Q</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>R</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>S</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>T</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>U</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>V</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>W</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>X</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Y</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Z</strong></span>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>78</p>
</td><td style="text-align: left" valign="top">
<p>79</p>
</td><td style="text-align: left" valign="top">
<p>80</p>
</td><td style="text-align: left" valign="top">
<p>81</p>
</td><td style="text-align: left" valign="top">
<p>82</p>
</td><td style="text-align: left" valign="top">
<p>83</p>
</td><td style="text-align: left" valign="top">
<p>84</p>
</td><td style="text-align: left" valign="top">
<p>85</p>
</td><td style="text-align: left" valign="top">
<p>86</p>
</td><td style="text-align: left" valign="top">
<p>87</p>
</td><td style="text-align: left" valign="top">
<p>88</p>
</td><td style="text-align: left" valign="top">
<p>89</p>
</td><td style="text-align: left" valign="top">
<p>90</p>
</td></tr></tbody></table></div><div class="blockquote"><blockquote class="blockquote"><p>ASCII table for upper case letters</p></blockquote></div><p>Next, we will ensure that we have an empty string where we can build our result (<code class="literal">result = ""</code>) and we will also set our encryption <code class="literal">key</code> to our key value.</p><p>The <code class="literal">input_text</code> variable contains our string, which is stored as a list (this is similar to an array) of letters. We can access each item in the list using <code class="literal">input_text[0]</code> for the first item and so on; however, Python also allows us to loop through a list using <code class="literal">for…in</code>, accessing each item in turn.</p><p>The <code class="literal">for letter in input_text:</code> line allows us to break up <code class="literal">input_text</code> by looping through it for each item inside (in this case, the letters in the string) and also setting the letter equal to that item. So if <code class="literal">input_text</code> equaled <code class="literal">HELLO</code>, it would run all the code that is indented under the command five times; each time, the <code class="literal">letter</code> variable would be set to <code class="literal">H</code>, <code class="literal">E</code>, <code class="literal">L</code>, <code class="literal">L</code>, and finally <code class="literal">O</code>. This allows us to read each letter separately, process it, and add the new encrypted letter to the <code class="literal">result</code> string.</p><p>The next part, <code class="literal">if (ord("A") &gt; ascii_value) or (ascii_value &gt; ord("Z")):</code>, checks to see if the character we are looking at is not between <code class="literal">A</code> and <code class="literal">Z</code>, which means it is probably a number or punctuation mark. In this case, we will exclude the character from the encryption (passing the character directly to the <code class="literal">result</code> string unchanged).</p><p>If the letter is between <code class="literal">A</code> and <code class="literal">Z</code>, we can add the value of our encryption <code class="literal">key</code> to the value of our letter to obtain our new encoded letter. That is, for an encryption <code class="literal">key</code> of <code class="literal">10</code>, we end up with the following set of letters in the output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Input Letter:  A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</strong></span>
<span class="strong"><strong>Output Letter: K L M N O P Q R S T U V W X Y Z A B C D E F G H I J</strong></span>
</pre></div><p>As we want the<a class="indexterm" id="id221"/> encrypted message to be easy to write out, we have limited the output<a class="indexterm" id="id222"/> to be between <code class="literal">A</code> and <code class="literal">Z</code>. So, if the letter starts as <code class="literal">X</code>, we want to it to wrap around and continue counting from <code class="literal">A</code>. We can achieve this by using the <code class="literal">%</code> (modulus) function, which gives us the remainder value if we divide a number by another. So, if <code class="literal">X</code> is <code class="literal">24</code> and we add <code class="literal">10</code>, we get <code class="literal">34</code>. The value of <code class="literal">34%26</code> (where <code class="literal">26</code> is the total number of letters) is <code class="literal">8</code>. Counting <code class="literal">8</code> from <code class="literal">A</code>, we reach <code class="literal">H</code>.</p><p>However, in ASCII, the letter <code class="literal">A</code> is the number <code class="literal">65</code>, so we will remove this offset from <code class="literal">key_value</code> and then add it back once we have the modulus value. The following code ensures that we limit the ASCII values to be between <code class="literal">A</code> and <code class="literal">Z</code>:</p><div class="informalexample"><pre class="programlisting">#Ensure we just use A-Z regardless of key
if not((ord("A")) &lt; key_value &lt; ord("Z")):
  key_value = ord("A")+(key_value-ord("A"))\
                       %(ord("Z")-ord("A")+1)</pre></div><p>Essentially, if the value is not between the values for <code class="literal">A</code> or <code class="literal">Z</code>, then we will allow the value to wrap around (by calculating the modulus using the total number of letters between <code class="literal">A</code> and <code class="literal">Z</code>, which is <code class="literal">26</code>). This also works if the key is larger than <code class="literal">26</code> and if we are counting the opposite way too, for instance, if the encryption key was negative, and therefore, the decryption key positive.</p><p>Finally, we can convert <code class="literal">key_value</code> back into a letter by using the <code class="literal">chr()</code> and <code class="literal">str() </code>functions and adding it to the result string.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>Note that we use <code class="literal">\</code> to split the code into another line, it doesn't affect the calculation. Python can be very fussy about splitting lines, in some cases you can find a natural break in the code and separate the line with a carriage return, however other times we have to force a line break using the <code class="literal">\</code> symbol.</p></div></div><p>Of course, given very little time, such a simple encryption method could easily be broken. Remember that there are only 25 possible combinations to choose from before the result of the encryption is repeated (multiples of 26 will result in no encryption at all).</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>There's more…</h2></div></div></div><p>You can try this simple experiment. Currently, with this basic form of encryption, you will supply the method and key to anyone you wish to read your message. However, what happens if you want to send a secure transmission without sending the method and key?</p><p>The answer is to <a class="indexterm" id="id223"/>send the same message back and forth three times as demonstrated in<a class="indexterm" id="id224"/> the following diagram:</p><div class="mediaobject"><img alt="There's more…" src="graphics/6623OT_02_06.jpg"/><div class="caption"><p>We do not need to exchange encryption keys with the other person</p></div></div><p>The first time, we will encrypt it and send it over to the other party. They will then encrypt it again with their own encryption and send it back. The message at this stage has two layers of encryption applied to it. We can now remove our encryption and return it. Finally, they will receive the message with just their encryption, which they can remove and read the message.</p><p>Just remember that there are only 25 useful encryption combinations with the Caesar cipher, so it is possible that they could decrypt the message by accident.</p><p>We can make use of our previous file as a module using the <code class="literal">import</code> command as follows:</p><div class="informalexample"><pre class="programlisting">import encryptdecrypt as ENC</pre></div><p>This will allow<a class="indexterm" id="id225"/> access to any function inside the <code class="literal">encryptdecrypt</code> file using <code class="literal">ENC</code> as the<a class="indexterm" id="id226"/> reference. When such a file is imported, it will run any code that would normally be run; in this case, the <code class="literal">main()</code> function.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>To avoid this, we can change the call to <code class="literal">main()</code> only to occur when the file is run directly.</p></div></div><p>If the file is run directly, Python will set <code class="literal">__name__</code> to the <code class="literal">"__main__"</code> global attribute. By using the following code, we can reuse the functions in this Python script in other scripts without running any other code:</p><div class="informalexample"><pre class="programlisting">if __name__=="__main__":
  main()</pre></div><p>Create the <code class="literal">keypassing.py</code> script using the following code in the same directory as <code class="literal">encryptdecrypt.py</code>:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#keypassing.py
import encryptdecrypt as ENC

KEY1 = 20
KEY2 = 50

print ("Please enter text to scramble:")
#Get user input
user_input = input()
#Send message out
encodedKEY1 = ENC.encryptText(user_input,KEY1)
print ("USER1: Send message encrypted with KEY1 (KEY1): " + encodedKEY1)
#Receiver encrypts the message again
encodedKEY1KEY2 = ENC.encryptText(encodedKEY1,KEY2)
print ("USER2: Encrypt with KEY2 &amp; returns it (KEY1+KEY2): " + encodedKEY1KEY2)
#Remove the original encoding
encodedKEY2 = ENC.encryptText(encodedKEY1KEY2,-KEY1)
print ("USER1: Removes KEY1 &amp; returns with just KEY2 (KEY2): " + encodedKEY2)
#Receiver removes their encryption
message_result = ENC.encryptText(encodedKEY2,-KEY2)
print ("USER2: Removes KEY2 &amp; Message received: " + message_result)
#End</pre></div><p>On running the <a class="indexterm" id="id227"/>preceding script, we can see that the other person doesn't need to know<a class="indexterm" id="id228"/> the encryption key that we are using, and anyone who intercepts the message will not be able to see its contents. The script produces the following output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Please enter text to scramble:</strong></span>
<span class="strong"><strong>"A message to a friend."</strong></span>
<span class="strong"><strong>USER1: Send message encrypted with KEY1 (KEY1): U GYMMUAY NI U ZLCYHX.</strong></span>
<span class="strong"><strong>USER2: Encrypt with KEY2 &amp; returns it (KEY1+KEY2): S EWKKSYW LG S XJAWFV.</strong></span>
<span class="strong"><strong>USER1: Removes KEY1 &amp; returns with just KEY2 (KEY2): Y KCQQYEC RM Y DPGCLB.</strong></span>
<span class="strong"><strong>USER2: Removes KEY2 &amp; Message received: A MESSAGE TO A FRIEND.</strong></span>
</pre></div><p>This method is<a class="indexterm" id="id229"/> known as the <span class="strong"><strong>three-pass protocol</strong></span>, developed by<a class="indexterm" id="id230"/> Adi Shamir in 1980 (<a class="ulink" href="http://en.wikipedia.org/wiki/Three-pass_protocol">http://en.wikipedia.org/wiki/Three-pass_protocol</a>). One particular disadvantage of this method is that it is possible for a third party to intercept the messages (the so-called man-in-the-middle attack) and characterize the encryption method by inserting known values and analyzing the responses.</p></div></div>
<div class="section" title="Using files and handling errors"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Using files and handling errors</h1></div></div></div><p>In addition to <a class="indexterm" id="id231"/>easy string handling, Python allows you to read, edit, and create files<a class="indexterm" id="id232"/> easily. So, by building upon the previous scripts, we can make use of our <code class="literal">encryptText()</code> function to encode complete files.</p><p>Reading and writing to files can be quite dependent on factors that are outside of the direct control of the script, such as whether the file that we are trying to open exists or the filesystem has space to store a new file. Therefore, we will also take a look at how to handle exceptions and protect operations that may result in errors.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec55"/>Getting ready</h2></div></div></div><p>The following script will allow you to specify a file through the command line, which will be read and encoded to produce an output file. Create a small text file named <code class="literal">infile.txt</code> and save it so that we can test the script. It should include a short message similar to the following:</p><div class="informalexample"><pre class="programlisting">This is a short message to test our file encryption program.</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec56"/>How to do it…</h2></div></div></div><p>Create<a class="indexterm" id="id233"/> the <code class="literal">fileencrypt.py</code> script <a class="indexterm" id="id234"/>using the following code:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#fileencrypt.py
import sys #Imported to obtain command line arguments
import encryptdecrypt as ENC

#Define expected inputs
ARG_INFILE=1
ARG_OUTFILE=2
ARG_KEY=3
ARG_LENGTH=4

def covertFile(infile,outfile,key):
  #Convert the key text to an integer
  try:
    enc_key=int(key)
  except ValueError:
    print ("Error: The key %s should be an integer value!" % (key))
  #Code put on to two lines
  else:
    try:
      #Open the files
      with open(infile) as f_in:
        infile_content=f_in.readlines()
    except IOError:
      print ("Unable to open %s" % (infile))
    try:
      with open(outfile,'w') as f_out:
        for line in infile_content:
          out_line = ENC.encryptText(line,enc_key)
          f_out.writelines(out_line)
    except IOError:
      print ("Unable to open %s" % (outfile))
    print ("Conversion complete: %s" % (outfile))
  finally:
    print ("Finish")

#Check the arguments
if len(sys.argv) == ARG_LENGTH:
  print ("Command: %s" %(sys.argv))
  covertFile(sys.argv[ARG_INFILE], sys.argv[ARG_OUTFILE], sys.argv[ARG_KEY])
else:
  print ("Usage: fileencrypt.py infile outfile key")
#End</pre></div><p>To run the script, use the following command (here, <code class="literal">infile</code> can be any text file we want to encrypt, <code class="literal">outfile</code> is our encrypted version, and <code class="literal">key</code> is the key value we wish to use):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python3 fileencrypt.py infile outfile key</strong></span>
</pre></div><p>For example, to <a class="indexterm" id="id235"/>encrypt <code class="literal">infile.txt</code> and output it as <code class="literal">encrypted.txt</code> using <code class="literal">30</code> as the key, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python3 fileencrypt.py infile.txt encrypted.txt 30</strong></span>
</pre></div><p>To view the result, use <code class="literal">less encrypted.txt</code>. Press <span class="emphasis"><em>Q</em></span> to exit.</p><p>To decrypt <code class="literal">encrypted.txt</code> and output it as <code class="literal">decrypted.txt</code> using <code class="literal">-30</code> as the key, use the following <a class="indexterm" id="id236"/>command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python3 fileencrypt.py encrypted.txt decrypted.txt -30</strong></span>
</pre></div><p>To view the result, use <code class="literal">less decrypted.txt</code>. Press <span class="emphasis"><em>Q</em></span> to exit.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec57"/>How it works…</h2></div></div></div><p>The script requires us to use arguments that are provided on the command line. We will access them by importing the Python module called <code class="literal">sys</code>. Just like we did earlier, we will also import our <code class="literal">encryptdecrypt</code> module using the <code class="literal">import</code> command. We will use the <code class="literal">as</code> part to allow us to reference it using <code class="literal">ENC</code>.</p><p>Next, we will set values to define what each command-line argument will represent. When you run it, you will see that <code class="literal">sys.argv[]</code> is a list of values shown in the following array:</p><div class="informalexample"><pre class="programlisting">['fileencrypt.py', 'infile.txt', 'encrypted.txt', '30']</pre></div><p>So, the input file is at the index <code class="literal">1</code> in the list (indexing always starts at 0), then the output file, and finally, the key, with the total number of arguments being <code class="literal">ARG_LENGTH=4</code>.</p><p>Next, we will define the <code class="literal">convertFile()</code> function, which we will call in a minute from the next block of code.</p><p>To avoid errors, we will check whether the length of the <code class="literal">sys.argv</code> value matches the expected number of arguments from the command line. This will ensure that the user has supplied us with enough, and we don't try to reference items in the <code class="literal">sys.argv[]</code> list that don't exist. Otherwise, we will return a short message explaining what we are expecting.</p><p>We will now call the <code class="literal">convertFile()</code> function using the command-line values and making use of Python's built-in exception handling features to ensure that errors are responded to accordingly.</p><p>The <code class="literal">try…except</code> code allows you to try running some code and handle any exceptions (errors) within the program itself, rather than everything coming to a sudden stop.</p><p>The <code class="literal">try</code> code is accompanied by the following four optional sections:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">except ValueError:</code> – When an error occurs, a specific type of exception can be<a class="indexterm" id="id237"/> specified and handled with the action, depending on the error we wish to handle (that is, for <code class="literal">ValueError</code>, we could check whether the value is a float value and convert it to an integer or prompt for a new one). Multiple exceptions can be caught using <code class="literal">except (ValueError,IOError)</code> as required.</li><li class="listitem" style="list-style-type: disc"><code class="literal">except:</code> – This is a catch-all case where any other exceptions that we haven't handled can be dealt with. For situations where the code may be called from <a class="indexterm" id="id238"/>other places, we may also want to raise the exception again using the <code class="literal">raise</code> command so that it can be dealt with by other parts of the program (for instance, as part of the GUI, we can warn the user that the input was not correct without needing to do so at this stage). Typically, you should either deal with a specific exception or ensure that you raise it again so that the particular error is visible on a failure; if not handled at all, Python will report it on the terminal along with the trace to the function where it occurred.</li><li class="listitem" style="list-style-type: disc"><code class="literal">else:</code> – This <a class="indexterm" id="id239"/>section of code is always executed if the <code class="literal">try</code> code was successful and there was no exception raised; however, any errors in this code will not be handled by the <code class="literal">try…except</code> section it is part of.</li><li class="listitem" style="list-style-type: disc"><code class="literal">finally:</code> – This<a class="indexterm" id="id240"/> code is always executed, regardless of whether an exception was raised or the <code class="literal">try</code> code ran without problems.</li></ul></div><p>If you are familiar <a class="indexterm" id="id241"/>with other languages, you will find <code class="literal">try…except</code> similar to <code class="literal">try…catch</code>, and <code class="literal">raise</code> and <code class="literal">throw</code> as equivalents. Dealing with exceptions can be quite an art form; however, making your code able to handle problems gracefully and effectively is all part <a class="indexterm" id="id242"/>of good design. In many cases, catching the situations where things go wrong is just as important as performing the intended function successfully.</p><p>If there is no problem with converting the <code class="literal">key</code> argument into an integer, we will continue to open the input file specified and read the contents into the <code class="literal">infile_content</code> list. This will contain the contents of the file split into separate lines as a list.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>In this example, we will use a slightly different method to display values within the <code class="literal">print</code> statement.</p><p>Consider the following code as an example:</p><p>print ("Error: The key %s should be an integer value!" %(key))</p><p>This allows us to use the <code class="literal">%s</code> symbol to determine where the key value is printed and also to specify the format (<code class="literal">%s</code> is a string). For numerical values, such as floats and integers, we can use <code class="literal">%d</code> to display integers, <code class="literal">%f</code> for floats, or even <code class="literal">%.4f</code> to limit the value to four decimal places.</p></div></div><p>You may have <a class="indexterm" id="id243"/>noticed that we opened the file using the <code class="literal">with…as…:</code> section. This is a <a class="indexterm" id="id244"/>special way to open a file, which will ensure that it is closed once it has finished (even if there is an error). Refer to the following code:</p><div class="informalexample"><pre class="programlisting">try:
  #Open the files
  with open(infile) as f_in:
    infile_content=f_in.readlines()
except IOError:
  print ("Unable to open %s" % (infile))</pre></div><p>This is equivalent to the following:</p><div class="informalexample"><pre class="programlisting">try:
  f_in = open(infile)
  try:
    infile_content=f_in.readlines()
  finally:
    f_in.close()
  except IOError:
    print ("Unable to open %s" % (infile))</pre></div><p>If there is an exception in opening the file (if it doesn't exist, for example, it will raise <code class="literal">IOError</code>), we can flag to the user that there was a problem with the filename/path provided. We will also use <code class="literal">except:</code> on its own to deal with any other problems that we may have with the file, such as the encoding type or non-text based files.</p><p>Next, we will open a file for our output using <code class="literal">'w'</code> to open it as a writable file. If it doesn't exist, it will create a new file; otherwise, it will overwrite the file. We will also have the option to append to the file instead, using <code class="literal">'a'</code>. We will step through each item in <code class="literal">infile_content</code>, converting each line by passing it through our <code class="literal">ENC.encryptText()</code> function and writing the line to the <code class="literal">f_out</code> file. Once again, when we finish the <code class="literal">with…as…:</code> section, the file is closed and the conversion is complete.</p></div></div>
<div class="section" title="Creating a boot-up menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Creating a boot-up menu</h1></div></div></div><p>We will now<a class="indexterm" id="id245"/> apply the methods introduced in the previous scripts and reapply them to create a menu that we can customize to present a range of quick-to-run commands and programs.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec58"/>How to do it…</h2></div></div></div><p>Create the <code class="literal">menu.py</code> script using the following code:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#menu.py
from subprocess import call

filename="menu.ini"
DESC=0
KEY=1
CMD=2

print ("Start Menu:")
try:
  with open(filename) as f:
    menufile = f.readlines()
except IOError:
  print ("Unable to open %s" % (filename))
for item in menufile:
  line = item.split(',')
  print ("(%s):%s" % (line[KEY],line[DESC]))
#Get user input
running = True
while(running):
  user_input = input()
  #Check input, and execute command
  for item in menufile:
    line = item.split(',')
    if (user_input == line[KEY]):
      print ("Command: " + line[CMD])
      #call the script
      #e.g. call(["ls", "-l"])
      commands = line[CMD].rstrip().split()
      print (commands)
      running = False
      #Only run command is one if available
      if len(commands):
        call(commands)
  if (running==True):
    print ("Key not in menu.")
print ("All Done.")
#End</pre></div><p>Create a <code class="literal">menu.ini</code> file that will contain the following menu items and commands:</p><div class="informalexample"><pre class="programlisting">Start Desktop,d,startx
Show IP Address,i,hostname -I
Show CPU speed,s,cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
Show Core Temperature,t,sudo /opt/vc/bin/vcgencmd measure_temp
Exit,x,</pre></div><p>You can add <a class="indexterm" id="id246"/>your own commands to the list, creating your own custom start-up menu. The script will assume the <code class="literal">menu.ini</code> file is formatted correctly, so if you experience an error (for example <code class="literal">ErrorIndex</code>) it may be because the file is not as expected (such as missing commas or blank lines). We could use <code class="literal">except ErrorIndex:</code> to handle any errors, however we are better off highlighting there is a problem within the input file so that it can be fixed instead.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec59"/>How it works…</h2></div></div></div><p>In order to execute other programs from within a Python script, we need to use the <code class="literal">call</code> command. This time, we only wish to use the <code class="literal">call</code> part of the <code class="literal">subprocess</code> module, so we can simply use <code class="literal">from subprocess import call</code>. This just imports the part we need.</p><p>We will open the file and read all the lines into a <code class="literal">menufile</code> list. We can then process each item (or line of the file) using <code class="literal">item.split(',')</code>, which will create a new list consisting of each section of the line divided by the <code class="literal">','</code> symbol, as follows:</p><div class="informalexample"><pre class="programlisting">line = ['Start Desktop', 'd', 'startx\n']</pre></div><p>As shown by the <code class="literal">print</code> statement, we can now access each section independently, so we can print the key we need to press for a specific command and the description of the command.</p><p>Once we have printed the entire menu of commands, we will wait for the user's input. This is done inside a <code class="literal">while</code> loop; it will continue to run until we set the condition inside <code class="literal">running</code> to <code class="literal">False</code>. This means that if an invalid key is pressed, we can enter another key until a command is selected or the exit item is used. We will then check the input key to see if it matches the allocated key for the menu item, as follows:</p><div class="informalexample"><pre class="programlisting">user_input == line[KEY]</pre></div><p>If there is a match, we will extract the command we wish to call. The <code class="literal">call</code> command requires a command and its arguments to be a list, so we will use <code class="literal">.split()</code> to break up the command part into a list (where each space in the command is a new item in the list). Also note that there is <code class="literal">/n</code> after <code class="literal">startx</code>, this is the end of the line character from the <code class="literal">menu.ini</code> file. We will remove this first using <code class="literal">.rstrip()</code>, which removes any whitespace (spaces, tabs, or line endings) from the end of a string.</p><p>Once the command is formatted into a list of arguments, we will set <code class="literal">running</code> to <code class="literal">False</code> (so the <code class="literal">while</code> loop will not enter another loop), execute our command, and finish the script. If the user selects <code class="literal">x</code>, there will be no <code class="literal">commands</code> set, allowing us to exit the menu without calling anything. The script produces a small menu of options, as shown in the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Start Menu:</strong></span>
<span class="strong"><strong>(d):Start Desktop</strong></span>
<span class="strong"><strong>(i):Show IP Address</strong></span>
<span class="strong"><strong>(s):Show CPU speed</strong></span>
<span class="strong"><strong>(t):Show Core Temperature</strong></span>
<span class="strong"><strong>(x):Exit</strong></span>
<span class="strong"><strong>g</strong></span>
<span class="strong"><strong>Key not in menu.</strong></span>
<span class="strong"><strong>i</strong></span>
<span class="strong"><strong>Command: hostname -I</strong></span>
<span class="strong"><strong>['hostname', '-I']</strong></span>
<span class="strong"><strong>All Done.</strong></span>
</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec60"/>There's more…</h2></div></div></div><p>To make the<a class="indexterm" id="id247"/> script run each time, we will start the Raspberry Pi; we can call it from <code class="literal">.bash_profile</code>, which is a bash script that runs when the user's profile is loaded.</p><p>Create or edit the file as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>nano -c ~/.bash_profile</strong></span>
</pre></div><p>Add the following commands (assuming <code class="literal">menu.py</code> is located in the <code class="literal">/home/pi/python_scripts</code> directory):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cd /home/pi/python_scripts</strong></span>
<span class="strong"><strong>python3 menu.py</strong></span>
</pre></div><p>When done, save and exit (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y</em></span>, and <span class="emphasis"><em>Enter</em></span>).</p><p>The next time you power up your Raspberry Pi, you will have a menu to run your favorite commands from, without needing to remember them.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>You can also<a class="indexterm" id="id248"/> run Python scripts directly, without the <code class="literal">python3</code> command, making them executable, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>chmod +x menu.py</strong></span>
</pre></div><p>Now type <code class="literal">./menu.py</code> and the script will run using the program defined within the file by the first line, as follows:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3</pre></div></div></div></div></div>
<div class="section" title="Creating a self-defining menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Creating a self-defining menu</h1></div></div></div><p>While the previous menu is very useful for defining the most common commands and functions we <a class="indexterm" id="id249"/>may use when running the Raspberry Pi, we will often change what we are doing or develop scripts to automate complex tasks.</p><p>To avoid the need to continuously update and edit the <code class="literal">menu.ini</code> file, we can create a menu that can list the installed scripts and dynamically build a menu from it, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Creating a self-defining menu" src="graphics/6623OT_02_07.jpg"/><div class="caption"><p>A menu of all the Python scripts in the current directory</p></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec61"/>How to do it…</h2></div></div></div><p>Create the <code class="literal">menuadv.py</code> script using the following code:</p><div class="informalexample"><pre class="programlisting">#!/usr/bin/python3
#menuadv.py
import os
from subprocess import call

SCRIPT_DIR="." #Use current directory
SCRIPT_NAME=os.path.basename(__file__)

print ("Start Menu:")
scripts=[]
item_num=1
for files in os.listdir(SCRIPT_DIR):
  if files.endswith(".py"):
    if files != SCRIPT_NAME:
      print ("%s:%s"%(item_num,files))
      scripts.append(files)
      item_num+=1
running = True
while (running):
  print ("Enter script number to run: 1-%d (x to exit)" % (len(scripts)))
  run_item = input()
  try:
    run_number = int(run_item)
    if len(scripts) &gt;= run_number &gt; 0:
      print ("Run script number:" + run_item)
      commands = ["python3",scripts[run_number-1]]
      print (commands)
      call(commands)
      running = False
  except ValueError:
    #Otherwise, ignore invalid input
    if run_item == "x":
      running = False
      print ("Exit")
#End</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec62"/>How it works…</h2></div></div></div><p>This script<a class="indexterm" id="id250"/> allows us to take a different approach. Rather than predefining a list of commands or applications, we can simply keep a folder of useful scripts and scan it to create a list to pick from. In this case, the menu will just list Python scripts and call them without any command-line options.</p><p>To be able to access the list of files in a directory, we can use the <code class="literal">os</code> module's <code class="literal">os.listdir()</code> function. This function allows us to specify a directory and it will return a list of the files and directories within it.</p><p>Using <code class="literal">SCRIPT_DIR="."</code> will allow us to search the current directory (the one the script is being run from). We can specify an absolute path (that is, <code class="literal">"//home/pi/python_scripts"</code>), a relative path (that is, <code class="literal">"./python_scripts_subdirectory"</code>), or navigate from the current directory to others in the structure (that is, <code class="literal">"../more_scripts"</code>, where the <code class="literal">..</code> symbol will move up a level from the current directory and then into the <code class="literal">more_scripts</code> directory if it existed).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>If the directory does not exist, an exception (<code class="literal">OSError</code>) will be raised. Since this menu is intended to simply run and display the list, we are better off letting the exception cause an error and stop the script. This will encourage the user to fix the directory rather than try to handle the error (perhaps by prompting for another path each time). It will also be easier for the user to locate and correct the path when the script isn't running.</p></div></div><p>We will also<a class="indexterm" id="id251"/> get the name of the script using <code class="literal">os.path.basename(__file__)</code>, this allows us to later exclude the <code class="literal">menuadv.py</code> script from the list options.</p><p>We will create an empty <code class="literal">scripts</code> list and ensure that we initialize <code class="literal">item_num</code> to <code class="literal">1</code>. Now, we will call <code class="literal">os.listdir(SCRIPT_DIR)</code> directly within a <code class="literal">for…in</code> loop so that we can process each directory or filename returned by it. Next, we can check the end of each item using the <code class="literal">endswith()</code> function (another useful string function), which allows us to look for a specific ending to the string (in this case, the ending for Python scripts). At this point, we can also exclude the <code class="literal">menuadv.py</code> script from the list, if found.</p><p>We print the name of the script along with <code class="literal">item_num</code> and add it to the script list, finally incrementing <code class="literal">item_num</code> so that it is correct for the next item.</p><p>We will now prompt the user to enter the relevant script number (between <code class="literal">1</code> and the total number of scripts) and wait for the user input from <code class="literal">input()</code>. The script will check for a valid input. If it is a number, it will stay in the <code class="literal">try</code> section, and we can then check whether the number is in the correct range (one of the listed script numbers). If correct, the script is called using <code class="literal">['python3', 'scriptname.py']</code> and the <code class="literal">call()</code> function as before. If the input is not a number (for example, <code class="literal">x</code>), it will raise the <code class="literal">ValueError</code> exception. Within the <code class="literal">ValueError</code> exception, we can check whether <code class="literal">x</code> was pressed and exit the <code class="literal">while</code> loop by setting <code class="literal">running</code> to <code class="literal">False</code> (otherwise, the loop will reprint the prompt and wait for new input).</p><p>The script is now complete.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>You can adjust the preceding script to support other types of scripts, if required. Simply add other file extensions, such as <code class="literal">.sh</code>, to the scripts list and call using <code class="literal">sh</code> or <code class="literal">bash</code> instead of <code class="literal">python3</code>.</p></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec63"/>There's more…</h2></div></div></div><p>We can extend this example further by placing all our useful scripts in a single place and adding the <code class="literal">menu</code> script to the path.</p><div class="section" title="Alternative script locations"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec22"/>Alternative script locations</h3></div></div></div><p>While not <a class="indexterm" id="id252"/>entirely necessary (by default, the script will look in the current directory), it will be useful to create a suitable location to keep your scripts that you would like to use with the menu. This can be a location within your <code class="literal">home</code> folder (<code class="literal">~</code> is short for the <code class="literal">home</code> folder path, which is <code class="literal">/home/pi</code> by default). An example is shown in the following command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mkdir ~/menupy</strong></span>
<span class="strong"><strong>cd ~/menupy</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>To copy files, you can use <code class="literal">cp sourcefile targetfile</code>. If you use the <code class="literal">-r</code> option, it will also create the directory if it doesn't exist. To move or rename the files, use <code class="literal">mv sourcefile targetfile</code>. To delete the files, use <code class="literal">rm targetfile</code>. You must use the <code class="literal">-r</code> option to delete a directory.</p></div></div><p>Just ensure that if the script is not within the same location, the path is updated for <code class="literal">SCRIPT_DIR</code> to refer to the required location.</p></div><div class="section" title="Adding scripts to PATH"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec23"/>Adding scripts to PATH</h3></div></div></div><p>As before, we could add this script to a start-up file, such as <code class="literal">.bash_profile</code>, and have the menu <a class="indexterm" id="id253"/>appear when the user logs in to the Raspberry Pi. Alternatively, we can place such scripts into a folder such as <code class="literal">/home/pi/bin</code>, in which we can include the global value call <code class="literal">PATH</code>. The <code class="literal">PATH</code> settings are a list of directories that scripts and programs will check when trying to locate a file that isn't in the current directory (typically, installed programs and software, but also common configuration files and scripts).</p><p>This will allow us to run the script regardless of what directory we are currently in.</p><p>We can see the current <code class="literal">PATH</code> settings using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>echo $PATH</strong></span>
<span class="strong"><strong>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games</strong></span>
</pre></div><p>The actual contents of the <code class="literal">PATH</code> setting will depend on the initial settings of the distribution you are using and also on the applications you have installed.</p><p>If <code class="literal">/home/pi/bin</code> isn't included, we can temporarily add to this until the next boot with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>PATH=/home/pi/bin:$PATH</strong></span>
</pre></div><p>We can also add this to <code class="literal">.bash_profile</code> to set it every time for the current user, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>PATH=$HOME/bin:$PATH</strong></span>
<span class="strong"><strong>export PATH</strong></span>
</pre></div><p>The next <a class="indexterm" id="id254"/>time we reboot, the <code class="literal">PATH</code> settings will be (for a user with the name <code class="literal">pi</code>) as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/home/pi/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>When items are automatically located through <code class="literal">PATH</code>, it can be difficult to find a specific version of a file or program. To overcome this, use <code class="literal">whereis</code> before the filename/command, and it will list all the locations where it can be found.</p></div></div><p>Finally, if you do move the script to the <code class="literal">bin</code> directory, ensure that you update the path in <code class="literal">os.listdir("//home/pi/bin")</code> to locate and list the scripts you wish to display in the menu.</p></div></div></div></body></html>