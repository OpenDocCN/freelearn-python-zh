<html><head></head><body>
<div id="_idContainer084">
<h1 class="chapter-number" id="_idParaDest-127"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-128"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.2.1">SQL and Data Modeling</span></h1>
<p><span class="koboSpan" id="kobo.3.1">So far, we’ve explored React, a key library in frontend technology stacks. </span><span class="koboSpan" id="kobo.3.2">Now, we will explore the world of backend development, starting with </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Structured Query Language</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">SQL</span></strong><span class="koboSpan" id="kobo.7.1">) and </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">data modeling.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">SQL and data modeling are critical skills for any backend developer, and starting with these skills in the backend development journey will give you a strong foundation to build robust and scalable web applications. </span><span class="koboSpan" id="kobo.9.2">SQL</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.10.1"> is a standard language used to manage data in relational databases, which are essentially used to store </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">structured data.</span></span></p>
<p><span class="koboSpan" id="kobo.12.1">Knowledge of SQL will help you to write optimized SQL queries that can improve the performance of your application and reduce server load. </span><span class="koboSpan" id="kobo.12.2">Data modeling</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.13.1"> will help you to design a database schema that reflects the data your application will work with. </span><span class="koboSpan" id="kobo.13.2">Data modeling can help you avoid performance issues, maintainability problems, and other common issues that may arise when working </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">with databases.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">We will dive deeply into relational databases and how database tables can relate to one another. </span><span class="koboSpan" id="kobo.15.2">We will examine SQL</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.16.1"> as a standard language</span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.17.1"> used by many database management systems, including </span><strong class="bold"><span class="koboSpan" id="kobo.18.1">PostgreSQL</span></strong><span class="koboSpan" id="kobo.19.1">, a popu</span><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.20.1">lar open source </span><strong class="bold"><span class="koboSpan" id="kobo.21.1">relational database management </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.22.1">system</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.23.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.24.1">RDBMS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.26.1">Having a robust understanding of relational databases and knowledge of how database relationships work will help you design scalable and maintainable data structures. </span><span class="koboSpan" id="kobo.26.2">We will leave no stone unturned, cruising through the setup of PostgreSQL and exploring how Flask applications can communicate </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">with PostgreSQL.</span></span></p>
<p><span class="koboSpan" id="kobo.28.1">We will also discuss in depth the ability of SQLAlchemy to handle various relational database dialects by providing an interface that allows SQL interaction with a database using Python objects. </span><strong class="bold"><span class="koboSpan" id="kobo.29.1">SQLAlchemy</span></strong><span class="koboSpan" id="kobo.30.1"> is an industrial-strength object-relational</span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.31.1"> mapper that provides a powerful interface for interaction with various relational database dialects, </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">including PostgreSQL.</span></span></p>
<p><span class="koboSpan" id="kobo.33.1">SQLAlchemy makes it easier to write complex database queries and manage database transactions. </span><span class="koboSpan" id="kobo.33.2">We will examine how you can come up with a data model and send data from a Flask application to </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">In addition to data modeling and SQL, migration is also a crucial aspect of backend development. </span><span class="koboSpan" id="kobo.35.2">We will examine migration as a way of tracking and updating database structures with Alembic. </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">Alembic</span></strong><span class="koboSpan" id="kobo.37.1"> is a migration tool that provides</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.38.1"> a reliable way of tracking and updating database structures, making it an essential tool for </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">Python developers.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.42.1">What is the relational </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">data model?</span></span></li>
<li><span class="koboSpan" id="kobo.44.1">Exploring the different </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">database relationships</span></span></li>
<li><span class="koboSpan" id="kobo.46.1">Setting </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">up PostgreSQL</span></span></li>
<li><span class="koboSpan" id="kobo.48.1">Understanding database concepts for </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">Flask applications</span></span></li>
<li><span class="koboSpan" id="kobo.50.1">Understanding SQLAlchemy </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">ORM basics</span></span></li>
<li><span class="koboSpan" id="kobo.52.1">Modeling data for the speakers conference </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">web application</span></span></li>
<li><span class="koboSpan" id="kobo.54.1">Sending data to the PostgreSQL database from a </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">Flask application</span></span></li>
<li><span class="koboSpan" id="kobo.56.1">Migration </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">with Alembic</span></span></li>
</ul>
<h1 id="_idParaDest-129"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.58.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.59.1">The complete code for this chapter is available on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">at: </span></span><a href="https://github.com/PacktPublishing/Full-Stack-Flask-and-React/tree/main/Chapter08"><span class="No-Break"><span class="koboSpan" id="kobo.61.1">https://github.com/PacktPublishing/Full-Stack-Flask-and-React/tree/main/Chapter08</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.62.1">.</span></span></p>
<h1 id="_idParaDest-130"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.63.1">What is the relational data model?</span></h1>
<p><span class="koboSpan" id="kobo.64.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.65.1">relational data model</span></strong><span class="koboSpan" id="kobo.66.1"> is a conceptual approach used to represent</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.67.1"> a database as a group of relations. </span><span class="koboSpan" id="kobo.67.2">Most web applications are highly data-driven. </span><span class="koboSpan" id="kobo.67.3">Developers have to deal with either code-level data storage, in the case of a data structure, or find a way to persistently store data in an RDBMS, such as PostgreSQL </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">or MySQL.</span></span></p>
<p><span class="koboSpan" id="kobo.69.1">In an RDBMS, you can refer to a table as a relation. </span><span class="koboSpan" id="kobo.69.2">Therefore, a relational model represents data as a collection of relations or tables. </span><span class="koboSpan" id="kobo.69.3">Breaking down the database structure further, you then have rows and columns making up a table. </span><span class="koboSpan" id="kobo.69.4">Then, you have a record, which consists of a combination of rows </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">and columns.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1">Let’s take a look at a hypothetical table</span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.72.1"> named </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">customers</span></strong><span class="koboSpan" id="kobo.74.1"> that depicts the structure of a typical table </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">for clarity:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">Id</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">firstname</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">lastname</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">email</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">phone</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.81.1">1</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.82.1">J</span></span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">oel</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.84.1">D</span></span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">oe</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.86.1">Joel@admin.com</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.87.1">404-228-5487</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.88.1">2</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.89.1">Edward</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.90.1">Spinster</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.91.1">Edward@admin.com</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.92.1">403-268-6486</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.93.1">3</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.94.1">Mabel</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.95.1">Emmanuel</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.96.1">Mabel@admin.com</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.97.1">402-248-4484</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.98.1">Table 8.1 – A table showing customer information</span></p>
<p><span class="koboSpan" id="kobo.99.1">In the preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">customers</span></strong><span class="koboSpan" id="kobo.101.1"> table, we have five columns and three rows. </span><span class="koboSpan" id="kobo.101.2">Each row in a table</span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.102.1"> is called a tuple. </span><span class="koboSpan" id="kobo.102.2">The column headers such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">Id</span></strong><span class="koboSpan" id="kobo.104.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">firstname</span></strong><span class="koboSpan" id="kobo.106.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">lastname</span></strong><span class="koboSpan" id="kobo.108.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">email</span></strong><span class="koboSpan" id="kobo.110.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">phone</span></strong><span class="koboSpan" id="kobo.112.1"> are called</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.113.1"> attributes or fields. </span><span class="koboSpan" id="kobo.113.2">In a database, tables are created to store data efficiently. </span><span class="koboSpan" id="kobo.113.3">Each table usually represents a business entity or object such as a speaker, venue, subject, customer, product, order, and </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.115.1">For clarity, a business entity</span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.116.1"> represents things we intend to encapsulate in the application business data model with all the rules, relationships, and ability to be persistent in the database. </span><span class="koboSpan" id="kobo.116.2">In the preceding table, we have a customer business entity with the following attributes – </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">Id</span></strong><span class="koboSpan" id="kobo.118.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">firstname</span></strong><span class="koboSpan" id="kobo.120.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">lastname</span></strong><span class="koboSpan" id="kobo.122.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">email</span></strong><span class="koboSpan" id="kobo.124.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">phone</span></strong><span class="koboSpan" id="kobo.126.1">. </span><span class="koboSpan" id="kobo.126.2">More often than not, you would have more than one table in your </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">web application.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1">Expectedly, you need to be able to relate these different tables or relations in your database using primary keys. </span><span class="koboSpan" id="kobo.128.2">The primary key</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.129.1"> is the unique identifier for the entire row of a table, referring to one or more columns. </span><span class="koboSpan" id="kobo.129.2">And if there are multiple columns for the primary key, then the set of primary key columns</span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.130.1"> is known as a composite key. </span><span class="koboSpan" id="kobo.130.2">In our case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">Id</span></strong><span class="koboSpan" id="kobo.132.1"> in the customer table could be set as the </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">primary key.</span></span></p>
<p><span class="koboSpan" id="kobo.134.1">Additionally, another concept in data relation is a foreign key. </span><span class="koboSpan" id="kobo.134.2">A foreign key</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.135.1"> refers to a primary key in another (foreign) table. </span><span class="koboSpan" id="kobo.135.2">Foreign keys are used to map relationships between tables or relations. </span><span class="koboSpan" id="kobo.135.3">The table relationship helps you to store data efficiently where it needs to be stored, and accessing related data becomes easier </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">when needed.</span></span></p>
<p><span class="koboSpan" id="kobo.137.1">There are many relationships</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.138.1"> in database design – </span><em class="italic"><span class="koboSpan" id="kobo.139.1">one-to-one</span></em><span class="koboSpan" id="kobo.140.1">, </span><em class="italic"><span class="koboSpan" id="kobo.141.1">one-to-many</span></em><span class="koboSpan" id="kobo.142.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.143.1">many-to-many</span></em><span class="koboSpan" id="kobo.144.1">. </span><span class="koboSpan" id="kobo.144.2">For instance, related tables in a database can help you find out orders made by your customers, how many conference attendees are currently enrolled in each subject, and </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.146.1">In the next section, we will extensively discuss the relationships in a database and how they are used in web application </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">architectural design.</span></span></p>
<h1 id="_idParaDest-131"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.148.1">Exploring the different database relationships</span></h1>
<p><span class="koboSpan" id="kobo.149.1">In the client-server model, the database</span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.150.1"> resides at the server end of the infrastructure. </span><span class="koboSpan" id="kobo.150.2">The database is core to any production-grade web application in collecting and storing application data. </span><span class="koboSpan" id="kobo.150.3">Understanding relationships that exist in a database is vital for organizing, managing, and retrieving useful data from </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.152.1">As previously mentioned, there are three types of relationships that exist in a database – </span><em class="italic"><span class="koboSpan" id="kobo.153.1">one-to-one</span></em><span class="koboSpan" id="kobo.154.1">, </span><em class="italic"><span class="koboSpan" id="kobo.155.1">one-to-many</span></em><span class="koboSpan" id="kobo.156.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.157.1">many-to-many</span></em><span class="koboSpan" id="kobo.158.1">. </span><span class="koboSpan" id="kobo.158.2">We will begin by delving into the concept of a </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">one-to-one relationship.</span></span></p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.160.1">One-to-one (1:1) relationship</span></h2>
<p><span class="koboSpan" id="kobo.161.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.162.1">one-to-one relationship</span></strong><span class="koboSpan" id="kobo.163.1"> in a data model refers to a direct</span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.164.1"> link relationship</span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.165.1"> that exists in information between two tables. </span><span class="koboSpan" id="kobo.165.2">With a one-to-one relationship, you have a situation where a record in one table is directly associated with a specific row in another table. </span><span class="koboSpan" id="kobo.165.3">For clarity, let’s quickly dive into a scenario where you have two tables – </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">speakers</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.167.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">speakerExtras</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer070">
<span class="koboSpan" id="kobo.170.1"><img alt="Figure 8.1 – An entity relationship diagram showing the one-to-one relationship" src="image/Figure_8.1_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.171.1">Figure 8.1 – An entity relationship diagram showing the one-to-one relationship</span></p>
<p><span class="koboSpan" id="kobo.172.1">The preceding diagram depicts the </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">speakers</span></strong><span class="koboSpan" id="kobo.174.1"> table and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">speakerExtras</span></strong><span class="koboSpan" id="kobo.176.1"> table. </span><span class="koboSpan" id="kobo.176.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">speakers</span></strong><span class="koboSpan" id="kobo.178.1"> table details the basic required information of a speaker object, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">speakerExtras</span></strong><span class="koboSpan" id="kobo.180.1"> table showcases the optional information that can be added to speaker information. </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">speaker_id</span></strong><span class="koboSpan" id="kobo.182.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">speakers</span></strong><span class="koboSpan" id="kobo.184.1"> table is the primary key that can be used to uniquely identify a </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">speaker record.</span></span></p>
<p><span class="koboSpan" id="kobo.186.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">speakerExtras</span></strong><span class="koboSpan" id="kobo.188.1"> table, a column is added as </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">speaker_id</span></strong><span class="koboSpan" id="kobo.190.1">. </span><span class="koboSpan" id="kobo.190.2">This </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">speaker_id</span></strong><span class="koboSpan" id="kobo.192.1"> column in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">speakerExtras</span></strong><span class="koboSpan" id="kobo.194.1"> table is a foreign key with a unique attribute. </span><span class="koboSpan" id="kobo.194.2">This </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">speaker_id</span></strong><span class="koboSpan" id="kobo.196.1"> column is used as a reference key for </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">speaker_id</span></strong><span class="koboSpan" id="kobo.198.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">speakers</span></strong><span class="koboSpan" id="kobo.200.1"> table to form a one-to-one relationship between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">speakerExtras</span></strong><span class="koboSpan" id="kobo.202.1"> table and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">speakers</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.204.1"> table.</span></span></p>
<p><span class="koboSpan" id="kobo.205.1">Most of the time, the one-to-one relationship data model can actually be merged. </span><span class="koboSpan" id="kobo.205.2">Merging a one-to-one relationship data model typically means combining the tables into a single table. </span><span class="koboSpan" id="kobo.205.3">This is usually done when the two tables have a strong connection and the data in the tables is not complex enough to warrant having </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">separate tables.</span></span></p>
<p><span class="koboSpan" id="kobo.207.1">However, there are cases where the database design requirement may be a separate table for information that may be optional, so rather than having an empty column in a table, you can create a different table</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.208.1"> to handle this optional information</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.209.1"> for better </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">database performance.</span></span></p>
<p><span class="koboSpan" id="kobo.211.1">Let’s take a look at another database </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">relationship, one-to-many.</span></span></p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.213.1">One-to-many (1:M) relationship</span></h2>
<p><span class="koboSpan" id="kobo.214.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.215.1">one-to-many relationship</span></strong><span class="koboSpan" id="kobo.216.1"> in a data model explains a relationship</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.217.1"> between two tables, in which</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.218.1"> a row in one table can reference one or many rows in another table. </span><span class="koboSpan" id="kobo.218.2">The one-to-many relationship is a kind of parent-child relationship where a child record can only have one </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">parent record.</span></span></p>
<p><span class="koboSpan" id="kobo.220.1">Most of the time, the parent record has more than one child in another table’s rows. </span><span class="koboSpan" id="kobo.220.2">However, in a real-life scenario, we could have a situation in which a parent record has no child record at all. </span><span class="koboSpan" id="kobo.220.3">What does a parent with no child record mean? </span><span class="koboSpan" id="kobo.220.4">It means that the foreign key column in the child table will be empty for that </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">parent record.</span></span></p>
<p><span class="koboSpan" id="kobo.222.1">For instance, consider a database design for a store where each customer can have multiple orders. </span><span class="koboSpan" id="kobo.222.2">If a new customer record is created but no orders have been placed yet, there will be a customer record with no corresponding order records. </span><span class="koboSpan" id="kobo.222.3">In this case, the customer record is the parent record, and the order records are the </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">child records.</span></span></p>
<p><span class="koboSpan" id="kobo.224.1">Furthermore, a one-to-many relationship in some cases also allows a single record in another table. </span><span class="koboSpan" id="kobo.224.2">There are cases where a one-to-many relationship can be constrained to functionally act as a one-to-one relationship. </span><span class="koboSpan" id="kobo.224.3">For instance, you could add a unique constraint to the foreign key column in the child table, ensuring that each record in the parent table is associated with, at most, one record in the </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">child table.</span></span></p>
<p><span class="koboSpan" id="kobo.226.1">This would effectively constrain the relationship to function as a one-to-one relationship, even though the underlying data model is a one-to-many relationship. </span><span class="koboSpan" id="kobo.226.2">This one-to-many relationship is almost similar to a one-to-one relationship but with a subtle difference of a unique constraint. </span><span class="koboSpan" id="kobo.226.3">Why is this one-to-many relationship important in </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">data modeling?</span></span></p>
<p><span class="koboSpan" id="kobo.228.1">Like other database relationships, the one-to-many relationship is a fundamental building block of relational database design and is essential for organizing, managing, and analyzing complex data structures. </span><span class="koboSpan" id="kobo.228.2">The one-to-many relationship enforces referential integrity of data by ensuring that each record in the child table is associated with a valid record in the parent table. </span><span class="koboSpan" id="kobo.228.3">This approach helps prevent data inconsistencies and errors that can arise from orphan records or references to </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">non-existent records.</span></span></p>
<p><span class="koboSpan" id="kobo.230.1">Let’s take a look at an example of a one-to-many relationship. </span><span class="koboSpan" id="kobo.230.2">Imagine we have </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">customers</span></strong><span class="koboSpan" id="kobo.232.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">orders</span></strong><span class="koboSpan" id="kobo.234.1"> tables in our database. </span><span class="koboSpan" id="kobo.234.2">It is possible for a customer to have many 1:M orders with a business over a period </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">of time.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">A business might want to keep this record. </span><span class="koboSpan" id="kobo.236.2">For example, customers tend to have different orders; a particular </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">orderID</span></strong><span class="koboSpan" id="kobo.238.1"> can’t belong to many customers. </span><span class="koboSpan" id="kobo.238.2">Every customer’s order is unique. </span><span class="koboSpan" id="kobo.238.3">The following diagram depicts a one-to-many relationship between customers </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">and orders.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer071">
<span class="koboSpan" id="kobo.240.1"><img alt="Figure 8.2 – An entity relationship diagram showing the one-to-many relationship" src="image/Figure_8.2_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.241.1">Figure 8.2 – An entity relationship diagram showing the one-to-many relationship</span></p>
<p><span class="koboSpan" id="kobo.242.1">In the preceding diagram, </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">customer_id</span></strong><span class="koboSpan" id="kobo.244.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">orders</span></strong><span class="koboSpan" id="kobo.246.1"> table represents the foreign key and the main linking factor between the two entities – </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">customers</span></strong><span class="koboSpan" id="kobo.248.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">orders</span></strong><span class="koboSpan" id="kobo.250.1">. </span><span class="koboSpan" id="kobo.250.2">If you want to know the number of orders a particular customer has, all you need to do is write a </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">JOIN</span></strong><span class="koboSpan" id="kobo.252.1"> query that tends to look up </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">customers</span></strong><span class="koboSpan" id="kobo.254.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">orders</span></strong><span class="koboSpan" id="kobo.256.1"> tables, and check for the occurrence of </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">customer_id</span></strong><span class="koboSpan" id="kobo.258.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">orders</span></strong><span class="koboSpan" id="kobo.260.1"> table as a </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">reference key.</span></span></p>
<p><span class="koboSpan" id="kobo.262.1">In the database design</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.263.1"> for your web application</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.264.1"> development, you will encounter more of this data relationship, as it is the most commonly used one. </span><span class="koboSpan" id="kobo.264.2">Next, we take a look at another database </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">relationship, many-to-many.</span></span></p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.266.1">Many-to-many (M:M) relationship</span></h2>
<p><span class="koboSpan" id="kobo.267.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">many-to-many relationship</span></strong><span class="koboSpan" id="kobo.269.1"> in data modeling simply refers</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.270.1"> to a data relationship</span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.271.1"> in which multiple records in one table are related to multiple records in another table. </span><span class="koboSpan" id="kobo.271.2">Take, for instance, a conference database design, where you could have the </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">following scenarios:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.273.1">An attendee can be enrolled in multiple </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">conference sessions</span></span></li>
<li><span class="koboSpan" id="kobo.275.1">A session can have many attendees enrolled </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">in it</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.277.1">This implies that an attendee has many conference sessions, and a conference session has many attendees. </span><span class="koboSpan" id="kobo.277.2">Thus, there is a many-to-many relationship between the conference attendees </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">and sessions.</span></span></p>
<p><span class="koboSpan" id="kobo.279.1">Interestingly, unlike a one-to-one relationship and one-to-many relationship, you can’t model a many-to-many relationship with just two tables. </span><span class="koboSpan" id="kobo.279.2">In many-to-many relationship modeling, a third join table is required, whereby you have the values of the primary keys of the two tables added to the </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">join table.</span></span></p>
<p><span class="koboSpan" id="kobo.281.1">Let’s examine the </span><strong class="bold"><span class="koboSpan" id="kobo.282.1">entity relationship</span></strong><span class="koboSpan" id="kobo.283.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.284.1">ER</span></strong><span class="koboSpan" id="kobo.285.1">) diagram of a many-to-many relationship</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.286.1"> for conference attendees and the sessions they </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1">enroll in:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer072">
<span class="koboSpan" id="kobo.288.1"><img alt="Figure 8.3 – An entity relationship diagram showing the many-to-many relationship" src="image/Figure_8.3_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.289.1">Figure 8.3 – An entity relationship diagram showing the many-to-many relationship</span></p>
<p><span class="koboSpan" id="kobo.290.1">Let’s break down the preceding</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.291.1"> ER diagram to have a better</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.292.1"> understanding of the many-to-many relationship. </span><span class="koboSpan" id="kobo.292.2">We have three tables, as clearly shown – </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">attendees</span></strong><span class="koboSpan" id="kobo.294.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.295.1">enrollemnt_tbl</span></strong><span class="koboSpan" id="kobo.296.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">conf_sessions</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.300.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">attendees</span></strong><span class="koboSpan" id="kobo.302.1"> table contains records for conference attendees. </span><span class="koboSpan" id="kobo.302.2">Likewise, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">conf_sessions</span></strong><span class="koboSpan" id="kobo.304.1"> table contains records for conference sessions. </span><span class="koboSpan" id="kobo.304.2">You then have a join table, </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">enrollment_tbl</span></strong><span class="koboSpan" id="kobo.306.1">, which technically forms a one-to-many relationship with each of the </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">two tables.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">enrollment_tbl</span></strong><span class="koboSpan" id="kobo.309.1"> contains the primary keys of both the attendees and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">conf_sessions</span></strong><span class="koboSpan" id="kobo.311.1"> tables as foreign keys. </span><span class="koboSpan" id="kobo.311.2">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">enrollment_tbl</span></strong><span class="koboSpan" id="kobo.313.1">, we can query related records from the attendees and </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">conf_sessions</span></strong><span class="koboSpan" id="kobo.315.1"> tables. </span><span class="koboSpan" id="kobo.315.2">In this case, we can access all the sessions</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.316.1"> a particular attendee attends </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.317.1">at </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">the conference.</span></span></p>
<p><span class="koboSpan" id="kobo.319.1">Next, we will delve deeper into database setup, using SQLAlchemy and Alembic, for the database part of a </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">web application.</span></span></p>
<h1 id="_idParaDest-135"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.321.1">Setting up PostgreSQL, SQLAlchemy, and Alembic</span></h1>
<p><span class="koboSpan" id="kobo.322.1">We are going to start by setting</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.323.1"> up the database tools needed for the backend database. </span><span class="koboSpan" id="kobo.323.2">PostgreSQL is a popular free and open source RDBMS. </span><span class="koboSpan" id="kobo.323.3">It is similar</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.324.1"> to other dialects of the </span><strong class="bold"><span class="koboSpan" id="kobo.325.1">SQL</span></strong><span class="koboSpan" id="kobo.326.1"> databases that exist – for example, MySQL, MariaDB, and Oracle. </span><span class="koboSpan" id="kobo.326.2">This database can be used to store data for any web application. </span><span class="koboSpan" id="kobo.326.3">PostgreSQL has enterprise-grade features that make it robust, scalable, </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">and reliable.</span></span></p>
<p><span class="koboSpan" id="kobo.328.1">We will also set up SQLAlchemy, an </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">object-relational mapper</span></strong><span class="koboSpan" id="kobo.330.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.331.1">ORM</span></strong><span class="koboSpan" id="kobo.332.1">). </span><span class="koboSpan" id="kobo.332.2">An ORM is a high-level abstraction layer</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.333.1"> on top of a relational database that allows web developers to rely on Python object-oriented programming code to execute database operations, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">read</span></strong><span class="koboSpan" id="kobo.335.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">insert</span></strong><span class="koboSpan" id="kobo.337.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">update</span></strong><span class="koboSpan" id="kobo.339.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">delete</span></strong><span class="koboSpan" id="kobo.341.1">, rather than writing SQL queries directly. </span><span class="koboSpan" id="kobo.341.2">Finally, in this section, we will set up Alembic to handle </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">database migrations.</span></span></p>
<h2 id="_idParaDest-136"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.343.1">Setting up PostgreSQL</span></h2>
<p><span class="koboSpan" id="kobo.344.1">To get started with PostgreSQL</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.345.1"> locally on your</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.346.1"> machine, download it from </span><a href="https://www.postgresql.org/download/"><span class="koboSpan" id="kobo.347.1">https://www.postgresql.org/download/</span></a><span class="koboSpan" id="kobo.348.1"> and select your operating </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">system package.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer073">
<span class="koboSpan" id="kobo.350.1"><img alt="Figure 8.4 – A diagram showing the download page of PostgreSQL" src="image/Figure_8.4_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.351.1">Figure 8.4 – A diagram showing the download page of PostgreSQL</span></p>
<p><span class="koboSpan" id="kobo.352.1">Run through the installation</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.353.1"> wizard by following the instructions to set up the database. </span><span class="koboSpan" id="kobo.353.2">During the PostgreSQL installation, you will be prompted to enter a super user password. </span><span class="koboSpan" id="kobo.353.3">It is very important you keep the password you entered as super user, as this will be required to log in to the default PostgreSQL database. </span><span class="koboSpan" id="kobo.353.4">Once the installation is complete, log in to </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.355.1">Open the command terminal on your machine and type the </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.357.1">$     psql -d postgres -U postgres</span></pre>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">psql</span></strong><span class="koboSpan" id="kobo.359.1"> invokes a connection to PostgreSQL from the terminal. </span><span class="koboSpan" id="kobo.359.2">Then, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">-d</span></strong><span class="koboSpan" id="kobo.361.1"> option to select the database you want to access and </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1">-U</span></strong><span class="koboSpan" id="kobo.363.1"> to select the user with access permission to </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">the database.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.365.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.366.1">If the command terminal replies with </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">psql not recognized as an internal or external command</span></strong><span class="koboSpan" id="kobo.368.1">, you might need to add the Postgres </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">bin/ (C:\Program Files\PostgreSQL\14\bin</span></strong><span class="koboSpan" id="kobo.370.1">) to the system path of the </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">environment variable.</span></span></p>
<p><span class="koboSpan" id="kobo.372.1">Then, enter the password you created for the superuser during </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">the installation.</span></span></p>
<p><span class="koboSpan" id="kobo.374.1">The following screenshot shows the terminal while trying to log in </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">to PostgreSQL.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer074">
<span class="koboSpan" id="kobo.376.1"><img alt="Figure 8.5 – A screenshot showing how to access PostgreSQL from the terminal" src="image/Figure_8.5_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.377.1">Figure 8.5 – A screenshot showing how to access PostgreSQL from the terminal</span></p>
<p><span class="koboSpan" id="kobo.378.1">It is always a best practice</span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.379.1"> to create a new user on Postgres, different from the superuser created during the installation. </span><span class="koboSpan" id="kobo.379.2">Now that you are logged in with the default Postgres user, let’s create another user role called </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">admin</span></strong><span class="koboSpan" id="kobo.381.1"> and assign it the </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">password </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">admin123</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.385.1">CREATE ROLE admin WITH LOGIN PASSWORD 'admin123';</span></pre>
<p><span class="koboSpan" id="kobo.386.1">We will now give a new user </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">admin</span></strong><span class="koboSpan" id="kobo.388.1"> permission to create </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">a database:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.390.1">ALTER ROLE admin CREATEDB;</span></pre>
<p><span class="koboSpan" id="kobo.391.1">With all this set, log out from the Postgres user and log in as </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">admin</span></strong><span class="koboSpan" id="kobo.393.1">. </span><span class="koboSpan" id="kobo.393.2">To log out, type the </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">\</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">q</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.396.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.397.1">Now, log in as an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">admin</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.399.1"> user:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.400.1">$    psql -d postgres -U admin</span></pre>
<p><span class="koboSpan" id="kobo.401.1">Enter the admin password and log in. </span><span class="koboSpan" id="kobo.401.2">Once logged in, create a new database </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">bizza</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.405.1">$    CREATE DATABASE bizza;</span></pre>
<p><span class="koboSpan" id="kobo.406.1">To connect to the newly created database, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.408.1">$    \connect bizza</span></pre>
<p><span class="koboSpan" id="kobo.409.1">The following screenshot shows how to connect to create a database </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">in PostgreSQL:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer075">
<span class="koboSpan" id="kobo.411.1"><img alt="Figure 8.6 – A screenshot showing a connection to the bizza database" src="image/Figure_8.6_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.412.1">Figure 8.6 – A screenshot showing a connection to the bizza database</span></p>
<p><span class="koboSpan" id="kobo.413.1">Hurray! </span><span class="koboSpan" id="kobo.413.2">We have set up PostgreSQL</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.414.1"> successfully. </span><span class="koboSpan" id="kobo.414.2">Now, let’s dive into setting </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">up SQLAlchemy.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.416.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.417.1">The role name, </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">admin</span></strong><span class="koboSpan" id="kobo.419.1">, and password, </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">admin123</span></strong><span class="koboSpan" id="kobo.421.1">, could be anything you want; they don’t have to be named </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">as suggested.</span></span></p>
<h2 id="_idParaDest-137"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.423.1">Setting up SQLAlchemy</span></h2>
<p><span class="koboSpan" id="kobo.424.1">Setting up SQLAlchemy for a Flask application</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.425.1"> is simple and straightforward. </span><span class="koboSpan" id="kobo.425.2">To set up SQLAlchemy in your project, let’s install SQLAlchemy with the following command in the Terminal right inside your project </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">root</span></strong><span class="koboSpan" id="kobo.427.1"> directory. </span><span class="koboSpan" id="kobo.427.2">Make sure your virtual environment is activated before running the </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">installation command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.429.1">pip install SQLAlchemy</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.430.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.431.1">SQLAlchemy is a Python SQL toolkit and ORM library that provides a set of high-level APIs to interact with </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">relational databases.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1">In addition, we</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.434.1"> will use a Flask extension called </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">Flask-SQLAlchemy</span></strong><span class="koboSpan" id="kobo.436.1">. </span><span class="koboSpan" id="kobo.436.2">Let’s install it by running the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.437.1">the terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.438.1">pip install flask-sqlalchemy</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.439.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.440.1">The Flask-SQLAlchemy extension provides a wrapper for SQLAlchemy, making it easier to use SQLAlchemy in a Flask application. </span><span class="koboSpan" id="kobo.440.2">Flask-SQLAlchemy provides additional features, such as automatic session handling, integration with Flask’s application context, and support for Flask-specific </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">configuration options.</span></span></p>
<p><span class="koboSpan" id="kobo.442.1">SQLAlchemy will be discussed</span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.443.1"> deeply in the subsequent section of this chapter, </span><em class="italic"><span class="koboSpan" id="kobo.444.1">Understanding SQLAlchemy </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.445.1">ORM basics</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.447.1">Briefly, let’s demonstrate how you can seamlessly integrate SQLAlchemy into your Flask application. </span><span class="koboSpan" id="kobo.447.2">The process of integrating SQLAlchemy is </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.449.1">Create a new directory and name </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">sqlalchemy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.453.1">Then, follow the Flask project setup in the </span><em class="italic"><span class="koboSpan" id="kobo.454.1">Setting up the development environment with Flask</span></em><span class="koboSpan" id="kobo.455.1"> section of </span><a href="B18554_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.456.1">Chapter 1</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.457.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.458.1">Make sure your development virtual environment </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">is activated.</span></span></li>
<li><span class="koboSpan" id="kobo.460.1">In the terminal, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">following commands:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.462.1">pip install flask</span></strong><strong class="bold"><span class="koboSpan" id="kobo.463.1">pip install flask-sqlalchemy</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.464.1">Create a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">app.py</span></strong><span class="koboSpan" id="kobo.466.1"> within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">sqlalchemy</span></strong><span class="koboSpan" id="kobo.468.1"> directory, and add the following </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.470.1">from flask import Flask, render_templatefrom flask_sqlalchemy import SQLAlchemyapp = Flask(__name__, template_folder='templates')app.config["SQLALCHEMY_DATABASE_URI"] =    "sqlite:///bizza.db"db = SQLAlchemy(app)@app.route('/users')def get_users():    users = User.query.all()    return render_template('users.html', users=users)class User(db.Model):__tablename__= "users"    id = db.Column(db.Integer, primary_key=True)    username = db.Column(db.String(55), unique=True)    name = db.Column(db.String(55), unique=False)    email = db.Column(db.String(100), unique=True)    def __repr__(self):        return '&lt;User {}&gt;'.format(self.username)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.471.1">The preceding code sets up a basic Flask application</span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.472.1"> that uses SQLAlchemy for database operations. </span><span class="koboSpan" id="kobo.472.2">Let’s explain what happens in the </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">preceding code:</span></span></p><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">from flask import Flask</span></strong><span class="koboSpan" id="kobo.475.1">: This imports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">Flask</span></strong><span class="koboSpan" id="kobo.477.1"> class from the </span><span class="No-Break"><span class="koboSpan" id="kobo.478.1">Flask package.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">from flask_sqlalchemy import SQLAlchemy</span></strong><span class="koboSpan" id="kobo.480.1">: This imports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.481.1">SQLAlchemy</span></strong><span class="koboSpan" id="kobo.482.1"> class from the </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">Flask-SQLAlchemy package.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">app = Flask(__name__, template_folder="templates")</span></strong><span class="koboSpan" id="kobo.485.1">: This creates a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">Flask</span></strong><span class="koboSpan" id="kobo.487.1"> application instance. </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">template_folder</span></strong><span class="koboSpan" id="kobo.489.1"> is added to ensure that Flask finds the </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">templates</span></strong><span class="koboSpan" id="kobo.491.1"> directory. </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">App.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///bizza.db"</span></strong><span class="koboSpan" id="kobo.493.1">: This sets the database URI for the SQLite database. </span><span class="koboSpan" id="kobo.493.2">In this case, the database file is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">bizza.db</span></strong><span class="koboSpan" id="kobo.495.1"> and is located in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">instance</span></strong><span class="koboSpan" id="kobo.497.1"> directory of the Flask application file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">app.py</span></strong><span class="koboSpan" id="kobo.499.1">. </span><span class="koboSpan" id="kobo.499.2">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">SQLite</span></strong><span class="koboSpan" id="kobo.501.1"> in this example. </span><span class="koboSpan" id="kobo.501.2">You can use any database dialect – MySQL, Oracle, PostgreSQL, and </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">so on.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">db = SQLAlchemy(app)</span></strong><span class="koboSpan" id="kobo.504.1">: This creates a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">SQLAlchemy</span></strong><span class="koboSpan" id="kobo.506.1"> instance that is bound to the </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">Flask application.</span></span></li>
<li><span class="koboSpan" id="kobo.508.1">Then, we have a Flask</span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.509.1"> route handler that responds to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">/users</span></strong><span class="koboSpan" id="kobo.511.1"> URL endpoint. </span><span class="koboSpan" id="kobo.511.2">When a user visits the </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">/users</span></strong><span class="koboSpan" id="kobo.513.1"> URL, Flask will execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.514.1">get_users</span></strong><span class="koboSpan" id="kobo.515.1"> function, retrieve all the users from the database, and render the </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">users.html</span></strong><span class="koboSpan" id="kobo.517.1"> template, passing the user’s variable to the template </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">for display.</span></span></li>
<li><span class="koboSpan" id="kobo.519.1">Lastly, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">User</span></strong><span class="koboSpan" id="kobo.521.1"> model with four columns – </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">id</span></strong><span class="koboSpan" id="kobo.523.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">username</span></strong><span class="koboSpan" id="kobo.525.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">name</span></strong><span class="koboSpan" id="kobo.527.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">email</span></strong><span class="koboSpan" id="kobo.529.1">. </span><span class="koboSpan" id="kobo.529.2">Each column represents a field in the corresponding database table and specifies its data type and optional constraints, such as uniqueness. </span><span class="koboSpan" id="kobo.529.3">This represents how we use SQLAlchemy in Flask to define our models as Python classes, specify their attributes and relationships, and perform </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">database operations.</span></span></li>
</ul><p class="list-inset"><span class="koboSpan" id="kobo.531.1">Now, let’s create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">users</span></strong><span class="koboSpan" id="kobo.533.1"> table in the terminal of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">sqlalchemy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.535.1"> directory.</span></span></p></li>
<li><span class="koboSpan" id="kobo.536.1">Enter the following commands in </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">the terminal:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.538.1">flask shell</span></strong><strong class="bold"><span class="koboSpan" id="kobo.539.1">from app import db</span></strong><strong class="bold"><span class="koboSpan" id="kobo.540.1">db.create_all()</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.541.1">The preceding commands create the users table. </span><span class="koboSpan" id="kobo.541.2">You can load the </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">users</span></strong><span class="koboSpan" id="kobo.543.1"> table with sample data with python </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">sample_data.py</span></strong><span class="koboSpan" id="kobo.545.1">. </span><span class="koboSpan" id="kobo.545.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">sample_data.py</span></strong><span class="koboSpan" id="kobo.547.1"> is located inside the project root directory </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">in GitHub.</span></span></p></li>
<li><span class="koboSpan" id="kobo.549.1">Then, enter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">flask run</span></strong><span class="koboSpan" id="kobo.551.1"> command and go to </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">http://127.0.0.1:5000/users</span></strong><span class="koboSpan" id="kobo.553.1"> to view the users list from </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">the database.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.555.1">The following is a screenshot that shows how you can use SQLAlchemy to define and retrieve </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">users’ data.</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer076">
<span class="koboSpan" id="kobo.557.1"><img alt="Figure 8.7 – A screenshot showing how to use SQLAlchemy for database operations" src="image/Figure_8.7_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.558.1">Figure 8.7 – A screenshot showing how to use SQLAlchemy for database operations</span></p>
<p><span class="koboSpan" id="kobo.559.1">With this setup, we have demonstrated</span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.560.1"> how you can define the SQLAlchemy model and use Python objects to interact with the database in a </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">Flask application.</span></span></p>
<p><span class="koboSpan" id="kobo.562.1">Next, we will dive into how you can set up Alembic, a database </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">migration tool.</span></span></p>
<h2 id="_idParaDest-138"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.564.1">Setting up Alembic</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.565.1">Alembic</span></strong><span class="koboSpan" id="kobo.566.1"> is simply a database</span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.567.1"> migration tool. </span><span class="koboSpan" id="kobo.567.2">You can install it with </span><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">pip install alembic</span></strong><span class="koboSpan" id="kobo.569.1"> or install it from another migration package, </span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">Flask-Migrate</span></strong><span class="koboSpan" id="kobo.571.1">, using </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">pip install flask-migrate</span></strong><span class="koboSpan" id="kobo.573.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.574.1">Flask-Migrate</span></strong><span class="koboSpan" id="kobo.575.1"> relies on Alembic</span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.576.1"> for database migration, and we will use it here as a tool of choice for </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">database migration.</span></span></p>
<p><span class="koboSpan" id="kobo.578.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">Flask-Migrate</span></strong><span class="koboSpan" id="kobo.580.1"> migration tool allows you to track</span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.581.1"> changes to your database. </span><span class="koboSpan" id="kobo.581.2">Migration tools come with the ability to manage database structure and operations using a migration script. </span><span class="koboSpan" id="kobo.581.3">The essence of Alembic, a migration tool, is to facilitate the automatic generation</span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.582.1"> of migration </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">SQL scripts.</span></span></p>
<p><span class="koboSpan" id="kobo.584.1">In the last section of this chapter, we will discuss migration in depth with some implementation details. </span><span class="koboSpan" id="kobo.584.2">Next, we will discuss how you can interact with a database from a Flask </span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">web application.</span></span></p>
<h1 id="_idParaDest-139"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.586.1">Understanding database concepts for Flask applications</span></h1>
<p><span class="koboSpan" id="kobo.587.1">Now that we have set up our database and connected with it using the Terminal, it is crucial to have a solid understanding of some database concepts to be able to set up backend services that can collect, store, and retrieve </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">users’ data.</span></span></p>
<p><span class="koboSpan" id="kobo.589.1">Most modern web applications have a database to store users’ data. </span><span class="koboSpan" id="kobo.589.2">As a full stack web developer, part of your responsibility is to be able to set up backend services that can collect, store, and retrieve users’ data. </span><span class="koboSpan" id="kobo.589.3">We will dive into interacting with databases from a Flask application shortly, but before that there are few database concepts you need </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">to understand.</span></span></p>
<p><span class="koboSpan" id="kobo.591.1">Let’s take a quick overview of the following </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">database concepts.</span></span></p>
<h2 id="_idParaDest-140"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.593.1">RDBMS</span></h2>
<p><span class="koboSpan" id="kobo.594.1">When working with a database</span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.595.1"> in a production environment, you need an RDBMS. </span><span class="koboSpan" id="kobo.595.2">An RDBMS is a software package that allows you to interact with a database. </span><span class="koboSpan" id="kobo.595.3">The RDBMS software allows you to define, manipulate, retrieve, and manage data in </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.597.1">You have database features that allow you to manage data in a database and the structure of the database itself. </span><span class="koboSpan" id="kobo.597.2">There are many different RDBMS flavors on the market – MySQL, PostgreSQL, Oracle, MsSQL, and MariaDB – but the one we’ll work with is </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">called PostgreSQL.</span></span></p>
<p><span class="koboSpan" id="kobo.599.1">Let’s take a look at another relevant tool needed to interact with a database, called a </span><strong class="bold"><span class="koboSpan" id="kobo.600.1">database applicati</span><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.601.1">on programming </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.602.1">interface</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.603.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.604.1">DB-API</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">).</span></span></p>
<h2 id="_idParaDest-141"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.606.1">DB-APIs</span></h2>
<p><span class="koboSpan" id="kobo.607.1">A DB-API is an </span><strong class="bold"><span class="koboSpan" id="kobo.608.1">application programming interface</span></strong><span class="koboSpan" id="kobo.609.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.610.1">API</span></strong><span class="koboSpan" id="kobo.611.1">) that allows communication between a programming</span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.612.1"> language or web server framework</span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.613.1"> and a database server, using protocols such as TCP/IP. </span><span class="koboSpan" id="kobo.613.2">Python, a language we use</span><a id="_idIndexMarker514"/><span class="koboSpan" id="kobo.614.1"> with the Flask</span><a id="_idIndexMarker515"/><span class="koboSpan" id="kobo.615.1"> framework, uses a library called psycopg2 that allows Python modules to interact with a PostgreSQL </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">database server.</span></span></p>
<p><span class="koboSpan" id="kobo.617.1">The DB-API acts as a database adapter, a web interface that allows a web server programming language – Python, in our case – to run SQL queries on a database, using psycopg2 as a library for </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">the DB-API.</span></span></p>
<p><span class="koboSpan" id="kobo.619.1">Different types of DB-APIs exist for every programming language or server framework and for the various dialects of the SQL database that we have. </span><span class="koboSpan" id="kobo.619.2">For instance, we have psycopg2 for PostgreSQL, </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">mysql-python</span></strong><span class="koboSpan" id="kobo.621.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">PyMySQL</span></strong><span class="koboSpan" id="kobo.623.1"> for MySQL, </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">adodbapi</span></strong><span class="koboSpan" id="kobo.625.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">pymssql</span></strong><span class="koboSpan" id="kobo.627.1"> for MS SQL Server, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">mxODBC</span></strong><span class="koboSpan" id="kobo.629.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">pyodb</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.631.1">for Oracle.</span></span></p>
<p><span class="koboSpan" id="kobo.632.1">The documentation</span><a id="_idIndexMarker516"/><span class="koboSpan" id="kobo.633.1"> for PEP 248 DB-API version 1.0 specifies a goal for </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">the DB-API:</span></span></p>
<p class="author-quote"><span class="koboSpan" id="kobo.635.1">“This API has been defined to encourage similarity between the Python modules that are used to access databases. </span><span class="koboSpan" id="kobo.635.2">By doing this, we hope to achieve a consistency leading to more easily understood modules, code that is generally more portable across databases, and a broader reach of database connectivity from Python.” </span><span class="koboSpan" id="kobo.635.3">(</span><a href="http://www.python.org/dev/peps/pep-0248/"><span class="koboSpan" id="kobo.636.1">http://www.python.org/dev/peps/pep-0248/</span></a><span class="koboSpan" id="kobo.637.1">)</span></p>
<p><span class="koboSpan" id="kobo.638.1">In essence, the DB-API gives you a low-level way of writing SQL query statements, making interactions with different databases consistently simple </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">and easy.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.640.1">Client–server model interaction</span></h2>
<p><span class="koboSpan" id="kobo.641.1">Client-server model interaction</span><a id="_idIndexMarker517"/><span class="koboSpan" id="kobo.642.1"> is a communication paradigm in which a client requests resources or services from a server over a network. </span><span class="koboSpan" id="kobo.642.2">In this model, the client initiates a request to the server, and the server provides the requested service or data in response, creating a client-server interaction that forms the foundation of various applications and </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">network communications.</span></span></p>
<p><span class="koboSpan" id="kobo.644.1">In the client-server model interaction, the browser acts as a client and the web server as a server. </span><span class="koboSpan" id="kobo.644.2">When an end user requests a resource or web page from the server, the request is made through a browser (the client side) through HTTP protocols on a web server (the server side). </span><span class="koboSpan" id="kobo.644.3">This same client-server architecture can also be modeled on an end user requesting a resource or web page that contains data from </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.646.1">When a browser makes a request that requires data from the database, the web server receives the request and initiates a connection with the database server. </span><span class="koboSpan" id="kobo.646.2">The web server becomes the client, and the database server becomes the server, completing a client-server model from the backend </span><span class="No-Break"><span class="koboSpan" id="kobo.647.1">infrastructure (</span></span><a href="http://www.python.org/dev/peps/pep-0248/"><span class="No-Break"><span class="koboSpan" id="kobo.648.1">http://www.python.org/dev/peps/pep-0248/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.649.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.650.1">Later in this chapter, we will create tables to thoroughly understand how to interact with a database. </span><span class="koboSpan" id="kobo.650.2">The following diagram shows the </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">client–server interaction.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer077">
<span class="koboSpan" id="kobo.652.1"><img alt="Figure 8.8 – A diagram showing the client–server interaction" src="image/Figure_8.8_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.653.1">Figure 8.8 – A diagram showing the client–server interaction</span></p>
<p><span class="koboSpan" id="kobo.654.1">In the preceding diagram, the client initiates the interaction by sending a request to the server. </span><span class="koboSpan" id="kobo.654.2">The request can be an HTTP request in the case of web-based applications. </span><span class="koboSpan" id="kobo.654.3">The server receives the request, interprets it, and performs the necessary operations to generate </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">a response.</span></span></p>
<p><span class="koboSpan" id="kobo.656.1">Once the response is ready, the server</span><a id="_idIndexMarker518"/><span class="koboSpan" id="kobo.657.1"> sends it back to the client. </span><span class="koboSpan" id="kobo.657.2">The client receives the response and processes it, utilizing the information provided to complete the client-server interaction. </span><span class="koboSpan" id="kobo.657.3">Next, we will dive into ORM basics to understand how you can use Python classes to interact with </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">an RDBMS.</span></span></p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.659.1">Understanding SQLAlchemy ORM basics</span></h1>
<p><span class="koboSpan" id="kobo.660.1">SQLAlchemy offers developers the ability</span><a id="_idIndexMarker519"/><span class="koboSpan" id="kobo.661.1"> to work entirely in Python code to create, read, update, and delete tables. </span><span class="koboSpan" id="kobo.661.2">SQLAlchemy is the Python SQL toolkit and ORM that allows application developers to interact with databases without writing direct </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">SQL statements.</span></span></p>
<p><span class="koboSpan" id="kobo.663.1">As SQLAlchemy is an ORM library, Python classes are mapped to tables, and the instances of those classes are mapped to table rows in a relational database. </span><span class="koboSpan" id="kobo.663.2">You then have a situation where you can use Python</span><a id="_idIndexMarker520"/><span class="koboSpan" id="kobo.664.1"> object-oriented programming code to perform database SQL </span><strong class="bold"><span class="koboSpan" id="kobo.665.1">create</span></strong><span class="koboSpan" id="kobo.666.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.667.1">read</span></strong><span class="koboSpan" id="kobo.668.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.669.1">update</span></strong><span class="koboSpan" id="kobo.670.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.671.1">delete</span></strong><span class="koboSpan" id="kobo.672.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.673.1">CRUD</span></strong><span class="koboSpan" id="kobo.674.1">) operations and other necessary operations in </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">your applications.</span></span></p>
<p><span class="koboSpan" id="kobo.676.1">The ORM feature of SQLAlchemy gives Python developers the power to harness function calls to generate SQL statements out of the box. </span><span class="koboSpan" id="kobo.676.2">With this new way of thinking about databases, developers are able to decouple object models and database schema, leading to a more flexible database structure, elegant SQL statements, and Python code that can interact with different types of </span><span class="No-Break"><span class="koboSpan" id="kobo.677.1">database dialects.</span></span></p>
<p><span class="koboSpan" id="kobo.678.1">SQLAlchemy doesn’t mind the kind of database systems you work with. </span><span class="koboSpan" id="kobo.678.2">SQLAlchemy makes it easier to switch from one database to another without altering your code. </span><span class="koboSpan" id="kobo.678.3">SQLAlchemy is undoubtedly a powerful tool that simplifies the process of web development, making it faster and </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">more efficient.</span></span></p>
<p><span class="koboSpan" id="kobo.680.1">With SQLAlchemy’s user-friendly interface, developers can easily create database models and interact with them from their Flask application. </span><span class="koboSpan" id="kobo.680.2">Additionally, SQLAlchemy is designed to reduce the chances of introducing bugs into the code base, which is especially important for </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">large-scale applications.</span></span></p>
<p><span class="koboSpan" id="kobo.682.1">With the provision of a robust framework to handle database interactions, SQLAlchemy allows developers to focus on building the logic of their applications without worrying about the underlying database operations. </span><span class="koboSpan" id="kobo.682.2">This results in a more streamlined development process and better overall </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">code quality.</span></span></p>
<p><span class="koboSpan" id="kobo.684.1">Lastly, the SQLAlchemy ORM library comes with automatic caching. </span><span class="koboSpan" id="kobo.684.2">SQLAlchemy caches collections and references between objects once initially loaded. </span><span class="koboSpan" id="kobo.684.3">This invariably improves performance and prevents you from sending SQL queries to the database upon </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">every call.</span></span></p>
<p><span class="koboSpan" id="kobo.686.1">In SQLAlchemy, there are three main vital layers</span><a id="_idIndexMarker521"/><span class="koboSpan" id="kobo.687.1"> of abstraction. </span><span class="koboSpan" id="kobo.687.2">These layers are the engine, the dialect, and the connection pool. </span><span class="koboSpan" id="kobo.687.3">This trio describes how you choose to interact with </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">a database.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer078">
<span class="koboSpan" id="kobo.689.1"><img alt="Figure 8.9 – The SQLAlchemy layers of abstraction" src="image/Figure_8.9_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.690.1">Figure 8.9 – The SQLAlchemy layers of abstraction</span></p>
<p><span class="koboSpan" id="kobo.691.1">Let’s dig deeper into the SQLAlchemy layers of abstraction to better understand how they are used </span><span class="No-Break"><span class="koboSpan" id="kobo.692.1">in SQLAlchemy.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.693.1">The SQLAlchemy engine</span></h2>
<p><span class="koboSpan" id="kobo.694.1">An SQLAlchemy application</span><a id="_idIndexMarker522"/><span class="koboSpan" id="kobo.695.1"> starts with the creation of an engine. </span><span class="koboSpan" id="kobo.695.2">You need to create an engine before SQLAlchemy can connect and interact with a database. </span><span class="koboSpan" id="kobo.695.3">The engine is at the lowest layer of abstraction in SQLAlchemy, and it works in pretty much the same way in which we use Psycopg2 to interact with </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.697.1">Let’s create an engine to kickstart database connectivity </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">and interaction.</span></span></p>
<p><span class="koboSpan" id="kobo.699.1">The following snippet demonstrates PostgreSQL database connectivity using </span><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">create_engine</span></strong><span class="koboSpan" id="kobo.701.1"> from SQLAlchemy. </span><span class="koboSpan" id="kobo.701.2">The SQLAlchemy engine connects to a PostgreSQL database and executes a SQL query </span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">in Python:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.703.1">from sqlalchemy import create_engine# create the engine with the database URL
engine = create_engine
    ("postgresql://admin:admin123@localhost:5432/bizza")
# create a connection to the database
conn = engine.connect()
# execute a SQL query
result = conn.execute('SELECT * FROM speakers')
# loop through the result set and print the values
for row in result:
    print(row)
# close the result set and connection
result.close()
conn.close()</span></pre>
<p><span class="koboSpan" id="kobo.704.1">This is what happens</span><a id="_idIndexMarker523"/><span class="koboSpan" id="kobo.705.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1">preceding code:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.707.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">create_engine</span></strong><span class="koboSpan" id="kobo.709.1"> function is imported from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">sqlalchemy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.711.1"> library:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.712.1">from sqlalchemy import create_engine</span></pre></li>
<li><span class="koboSpan" id="kobo.713.1">Then, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">create_engine()</span></strong><span class="koboSpan" id="kobo.715.1"> method is invoked in SQLAlchemy and assigned to the engine instance. </span><span class="koboSpan" id="kobo.715.2">You then pass in a connection URL string that specifies backend server details, such as the database’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">name</span></strong><span class="koboSpan" id="kobo.717.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">username</span></strong><span class="koboSpan" id="kobo.719.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">password</span></strong><span class="koboSpan" id="kobo.721.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">host</span></strong><span class="koboSpan" id="kobo.723.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">port</span></strong><span class="koboSpan" id="kobo.725.1"> used </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">for connectivity:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.727.1">engine = create_engine(    'postgresql://admin:admin123@localhost:5432/bizza'    )Database name-bizzaUsername-adminPasswordadmin123</span></pre></li>
<li><span class="koboSpan" id="kobo.728.1">A connection pool is created for the current database, and this is created once in the </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">lifetime application:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.730.1">connection = engine.connect()</span></pre></li>
<li><span class="koboSpan" id="kobo.731.1">We execute the SQL statements using the established </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">connection object:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.733.1">result= connection.execute('SELECT * FROM speakers')</span></pre></li>
<li><span class="koboSpan" id="kobo.734.1">Finally, we loop through the result set returned by the query and print </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">the values.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.736.1">It’s important to close the result</span><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.737.1"> set and the connection using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.738.1">result.close()</span></strong><span class="koboSpan" id="kobo.739.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">conn.close()</span></strong><span class="koboSpan" id="kobo.741.1"> methods to free up resources and prevent </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">memory leaks.</span></span></p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.743.1">SQLAlchemy connection pools</span></h2>
<p><span class="koboSpan" id="kobo.744.1">Connection pooling</span><a id="_idIndexMarker525"/><span class="koboSpan" id="kobo.745.1"> is an implementation of the object pool design paradigm in software engineering, where connections are reused instead of being created every time a connection to a database is required. </span><span class="koboSpan" id="kobo.745.2">In SQLAlchemy, the use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.746.1">create_engine()</span></strong><span class="koboSpan" id="kobo.747.1"> method usually generates a connection pool object that is created once and reused in subsequent connections when carrying out </span><span class="No-Break"><span class="koboSpan" id="kobo.748.1">database transactions.</span></span></p>
<p><span class="koboSpan" id="kobo.749.1">This connection pooling design pattern helps improve performance and better manage application concurrent connections. </span><span class="koboSpan" id="kobo.749.2">The default setting of the connection pool can be adjusted to better serve end users of business web </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">applications efficiently.</span></span></p>
<p><span class="koboSpan" id="kobo.751.1">To update the connection pool, add pooling parameters </span><span class="No-Break"><span class="koboSpan" id="kobo.752.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.753.1">create_engine()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.754.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.755.1">engine = create_engine('postgresql://user:admin123@localhost/bizza', pool_size=20, max_overflow=0)</span></pre>
<p><span class="koboSpan" id="kobo.756.1">The following bullet list shows you how to tweak the connection pool parameters to optimize performance while working with the SQLAlchemy </span><span class="No-Break"><span class="koboSpan" id="kobo.757.1">connection pool.</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.758.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">pool_size</span></strong><span class="koboSpan" id="kobo.760.1">, you can set the number of connections the pool </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">can handle</span></span></li>
<li><span class="koboSpan" id="kobo.762.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">max_overflow</span></strong><span class="koboSpan" id="kobo.764.1">, you can specify how many overflow connections the </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">pool supports</span></span></li>
<li><span class="koboSpan" id="kobo.766.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">pool_recycle</span></strong><span class="koboSpan" id="kobo.768.1">, you can configure the maximum age in seconds of connections in </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">the pool</span></span></li>
<li><span class="koboSpan" id="kobo.770.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">pool_timeout</span></strong><span class="koboSpan" id="kobo.772.1">, you can specify how many seconds the application needs to wait before giving up getting</span><a id="_idIndexMarker526"/><span class="koboSpan" id="kobo.773.1"> a connection from </span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">the pool</span></span></li>
</ul>
<h2 id="_idParaDest-146"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.775.1">SQLAlchemy dialect</span></h2>
<p><span class="koboSpan" id="kobo.776.1">One of the main benefits of using SQLAlchemy is that you can use different types of DB-API implementations (Psycopg2) and relational databases without altering your Python code to suit their </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">internal workings.</span></span></p>
<p><span class="koboSpan" id="kobo.778.1">So, the dialect</span><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.779.1"> is a system in SQLAlchemy that makes interaction with different databases possible. </span><span class="koboSpan" id="kobo.779.2">You can use SQLite in your development environment and decide to use MySQL or PostgreSQL in production with your existing </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">code base.</span></span></p>
<p><span class="koboSpan" id="kobo.781.1">Some examples of relational database dialects are </span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">as follows:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.783.1">PostgreSQL</span></span></li>
<li><span class="koboSpan" id="kobo.784.1">MySQL </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">and MariaDB</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.786.1">SQLite</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.787.1">Oracle</span></span></li>
<li><span class="koboSpan" id="kobo.788.1">Microsoft </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1">SQL Server</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.790.1">In order to use these database dialects, you must install appropriate DB-API drivers in your application. </span><span class="koboSpan" id="kobo.790.2">When connecting with PostgreSQL, SQLAlchemy uses Psycopg2 as an implementation of the DB-API specification. </span><span class="koboSpan" id="kobo.790.3">Psycopg2 is a PostgreSQL adapter for Python. </span><span class="koboSpan" id="kobo.790.4">Psycopg2 provides a simple and efficient way to communicate with a PostgreSQL database using </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">Python code.</span></span></p>
<p><span class="koboSpan" id="kobo.792.1">We’ve talked about how SQLAlchemy dialects work, but what about the data types that are used within those dialects? </span><span class="koboSpan" id="kobo.792.2">SQLAlchemy offers a wide variety of data types, and we’ll explore some of them now. </span><span class="koboSpan" id="kobo.792.3">After that, we’ll discuss how to map them to </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">Python classes.</span></span></p>
<h2 id="_idParaDest-147"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.794.1">SQLAlchemy data types – mapping between tables and classes</span></h2>
<p><span class="koboSpan" id="kobo.795.1">SQLAlchemy provides high-level abstractions</span><a id="_idIndexMarker528"/><span class="koboSpan" id="kobo.796.1"> to any underlying relational databases we may choose to use in our applications. </span><span class="koboSpan" id="kobo.796.2">SQLAlchemy has data type support for the most common traditional databases we are familiar with. </span><span class="koboSpan" id="kobo.796.3">For instance, dates, times, strings, integers, and Booleans are well supported </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">by SQLAlchemy.</span></span></p>
<p><span class="koboSpan" id="kobo.798.1">SQLAlchemy data types allow for precise data storage and retrieval. </span><span class="koboSpan" id="kobo.798.2">Each column in a database table has a specific data type that defines the type of data that can be stored in that column, such as integers, strings, or dates. </span><span class="koboSpan" id="kobo.798.3">SQLAlchemy provides a range of data types that can be used to define the columns in a database table, including </span><strong class="source-inline"><span class="koboSpan" id="kobo.799.1">Numeric</span></strong><span class="koboSpan" id="kobo.800.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.801.1">String</span></strong><span class="koboSpan" id="kobo.802.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.803.1">DateTime</span></strong><span class="koboSpan" id="kobo.804.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.805.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">Boolean</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.807.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.808.1">By using these data types, we can ensure that our data is stored accurately and efficiently, allowing for faster and more reliable data retrieval. </span><span class="koboSpan" id="kobo.808.2">Also, the mapping between tables and classes is important because it allows us to work with database tables in an </span><span class="No-Break"><span class="koboSpan" id="kobo.809.1">object-oriented manner.</span></span></p>
<p><span class="koboSpan" id="kobo.810.1">SQLAlchemy provides an ORM system that allows us to map database tables to Python classes. </span><span class="koboSpan" id="kobo.810.2">This means that we can work with database data using Python objects and methods, which makes it easier to build and maintain our web applications. </span><span class="koboSpan" id="kobo.810.3">Let’s see an example of how SQLAlchemy data types are mapped with Python classes and instance attributes for table and column </span><span class="No-Break"><span class="koboSpan" id="kobo.811.1">creations, respectively.</span></span></p>
<p><span class="koboSpan" id="kobo.812.1">This approach will be used to define tables from Python classes for the Flask applications in </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">this book:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.814.1">class Speaker(Base):__tablename__ = 'speakers'
speaker_ id=Column(Integer, primary_key=True)
first_name=Column(String)
last_name=Column(String)
email=Column(String)
created_at = Column(DateTime(timezone=True),
    server_default=datetime.now)
updated_at = ColumnDateTime(timezone=True),
    default=datetime.now, onupdate=datetime.now)</span></pre>
<p><span class="koboSpan" id="kobo.815.1">In the preceding code</span><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.816.1"> snippet, we defined a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.817.1">Speaker</span></strong><span class="koboSpan" id="kobo.818.1"> that has some attributes. </span><span class="koboSpan" id="kobo.818.2">Let’s dive deeper into </span><span class="No-Break"><span class="koboSpan" id="kobo.819.1">the code:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.820.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.821.1">__tablename__</span></strong><span class="koboSpan" id="kobo.822.1"> attribute is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.823.1">speakers</span></strong><span class="koboSpan" id="kobo.824.1">, indicating that instances of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.825.1">Speaker</span></strong><span class="koboSpan" id="kobo.826.1"> class should be stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.827.1">speakers</span></strong><span class="koboSpan" id="kobo.828.1"> table in </span><span class="No-Break"><span class="koboSpan" id="kobo.829.1">the database.</span></span></li>
<li><span class="koboSpan" id="kobo.830.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">speaker_id</span></strong><span class="koboSpan" id="kobo.832.1"> attribute specifies that this is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.833.1">primary_key</span></strong><span class="koboSpan" id="kobo.834.1"> in the table and has an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">Integer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.836.1"> type.</span></span></li>
<li><span class="koboSpan" id="kobo.837.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">first_name</span></strong><span class="koboSpan" id="kobo.839.1"> attribute specifies that a column in the table has the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">first_name</span></strong><span class="koboSpan" id="kobo.841.1"> with a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">String</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.843.1"> type.</span></span></li>
<li><span class="koboSpan" id="kobo.844.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.845.1">last_name</span></strong><span class="koboSpan" id="kobo.846.1"> attribute specifies that a column in the table has a name </span><strong class="source-inline"><span class="koboSpan" id="kobo.847.1">last_name</span></strong><span class="koboSpan" id="kobo.848.1"> with a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">String</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.850.1"> type.</span></span></li>
<li><span class="koboSpan" id="kobo.851.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.852.1">email</span></strong><span class="koboSpan" id="kobo.853.1"> attribute specifies that a column in the table has the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.854.1">email</span></strong><span class="koboSpan" id="kobo.855.1"> with a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">String</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.857.1"> type.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">created_at</span></strong><span class="koboSpan" id="kobo.859.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">updated_at</span></strong><span class="koboSpan" id="kobo.861.1"> specify columns in the table with the mentioned names that are of type </span><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">date</span></strong><span class="koboSpan" id="kobo.863.1">. </span><span class="koboSpan" id="kobo.863.2">Methods are, however, passed to get the </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1">current </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">timezone</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.867.1">With the classes and instances defined, we can utilize the internal APIs of SQLAlchemy and the configured dialect to map the class attributes to the corresponding native structure of the database. </span><span class="koboSpan" id="kobo.867.2">For example, if we have a string data type in our class, SQLAlchemy will map it to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.868.1">varchar</span></strong><span class="koboSpan" id="kobo.869.1"> column </span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">in PostgreSQL.</span></span></p>
<p><span class="koboSpan" id="kobo.871.1">This ensures that the data types used in the class are properly translated into the appropriate database column types, allowing for seamless communication between the Python code and </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.873.1">To build a robust web application for a speakers’ conference web application, we need to model the data correctly. </span><span class="koboSpan" id="kobo.873.2">SQLAlchemy provides us with a powerful ORM that makes it easy to map our database tables </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1">to classes.</span></span></p>
<p><span class="koboSpan" id="kobo.875.1">We can then define the attributes</span><a id="_idIndexMarker530"/><span class="koboSpan" id="kobo.876.1"> and relationships between these classes, which makes it easy to work with complex data structures. </span><span class="koboSpan" id="kobo.876.2">In the next section, we will explore how to model data for our speakers’ conference web application </span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">using SQLAlchemy.</span></span></p>
<h1 id="_idParaDest-148"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.878.1">Modeling data for a speakers’ conference web application</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.879.1">Data modeling</span></strong><span class="koboSpan" id="kobo.880.1"> is the process of creating a conceptual, logical, and </span><a id="_idIndexMarker531"/><span class="koboSpan" id="kobo.881.1">visual representation of data</span><a id="_idIndexMarker532"/><span class="koboSpan" id="kobo.882.1"> structures and relationships</span><a id="_idIndexMarker533"/><span class="koboSpan" id="kobo.883.1"> between data elements, in order to understand, analyze, and manage complex information systems. </span><span class="koboSpan" id="kobo.883.2">Data modeling involves identifying entities (objects, concepts, or things) that will be represented in a system and defining their attributes and relationships with </span><span class="No-Break"><span class="koboSpan" id="kobo.884.1">other entities.</span></span></p>
<p><span class="koboSpan" id="kobo.885.1">The main purpose of data modeling is to create a clear and precise representation of the data that will be stored, processed, and managed by an information system. </span><span class="koboSpan" id="kobo.885.2">A well-designed data model in a web application can ensure that the web application is scalable, efficient, and meets the needs of </span><span class="No-Break"><span class="koboSpan" id="kobo.886.1">its users.</span></span></p>
<p><span class="koboSpan" id="kobo.887.1">Let’s quickly examine some</span><a id="_idIndexMarker534"/><span class="koboSpan" id="kobo.888.1"> of the best practices to be considered when designing a data model for the conference speakers’ </span><span class="No-Break"><span class="koboSpan" id="kobo.889.1">web application:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.890.1">Identifying the entities</span></strong><span class="koboSpan" id="kobo.891.1">: Start by identifying the entities or objects that will be represented in the web application based on the system requirements, such as users, speakers, presentation, schedule, attendees, sessions, venue, </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1">and sponsors.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.893.1">Defining the relationships</span></strong><span class="koboSpan" id="kobo.894.1">: Determine the relationships between these entities, such as one-to-one, one-to-many, or many-to-many relationships. </span><span class="koboSpan" id="kobo.894.2">For instance, a speaker can give multiple presentations at the conference, but a presentation can only be given by </span><span class="No-Break"><span class="koboSpan" id="kobo.895.1">one speaker.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.896.1">Determining the attributes</span></strong><span class="koboSpan" id="kobo.897.1">: Define the attributes or properties of each entity – for instance, a speaker could have attributes such as name, contact address, biography, or </span><span class="No-Break"><span class="koboSpan" id="kobo.898.1">presentation topics.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.899.1">Considering performance and scalability</span></strong><span class="koboSpan" id="kobo.900.1">: Design the data model to optimize performance and scalability, such as using indexes, caching, or denormalization to reduce query times and improve </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">system response.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.902.1">Planning for data storage</span></strong><span class="koboSpan" id="kobo.903.1">: Consider the data storage options available, such as relational databases, NoSQL databases, or flat files, and choose the appropriate option based on the needs of the web application. </span><span class="koboSpan" id="kobo.903.2">In this case, PostgreSQL </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">was chosen.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.905.1">Data security</span></strong><span class="koboSpan" id="kobo.906.1">: Design the data model to ensure data security, such as using encryption or access controls to protect sensitive data. </span><span class="koboSpan" id="kobo.906.2">For instance, when a user logs in, their entered password can be hashed and compared to the stored hash to verify </span><span class="No-Break"><span class="koboSpan" id="kobo.907.1">their identity.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.908.1">Considering future changes</span></strong><span class="koboSpan" id="kobo.909.1">: Plan for future changes and updates to the web application, such as adding </span><a id="_idIndexMarker535"/><span class="koboSpan" id="kobo.910.1">new entities or attributes, or modifying </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">existing relationships.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.912.1">Are you prepared to begin</span><a id="_idIndexMarker536"/><span class="koboSpan" id="kobo.913.1"> developing the backend</span><a id="_idIndexMarker537"/><span class="koboSpan" id="kobo.914.1"> of the </span><em class="italic"><span class="koboSpan" id="kobo.915.1">Bizza</span></em><span class="koboSpan" id="kobo.916.1"> project by establishing and organizing the data model? </span><span class="koboSpan" id="kobo.916.2">The </span><em class="italic"><span class="koboSpan" id="kobo.917.1">Bizza</span></em><span class="koboSpan" id="kobo.918.1"> project aims to create a full stack web application that is database-driven and focuses on </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">conference speakers.</span></span></p>
<p><span class="koboSpan" id="kobo.920.1">In this data model, we will take a closer look at the database, tables, and relationship between </span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">the tables.</span></span></p>
<p><span class="koboSpan" id="kobo.922.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.923.1">bizza</span></strong><span class="koboSpan" id="kobo.924.1"> database has the following tables </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">and relationships:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.926.1">User model</span></strong><span class="koboSpan" id="kobo.927.1">: This model will include data about</span><a id="_idIndexMarker538"/><span class="koboSpan" id="kobo.928.1"> each user of the application, such as their username, password (encrypted), email address, and any other relevant details. </span><span class="koboSpan" id="kobo.928.2">This model will be used for authentication and authorization purposes. </span><span class="koboSpan" id="kobo.928.3">The following relationships exist with other tables – a one-to-one relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">users</span></strong><span class="koboSpan" id="kobo.930.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.931.1">userExtras</span></strong><span class="koboSpan" id="kobo.932.1">, a many-to-many relationship between users and roles, a one-to-one relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.933.1">users</span></strong><span class="koboSpan" id="kobo.934.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">speakers</span></strong><span class="koboSpan" id="kobo.936.1">, and a one-to-many relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">users</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.938.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.939.1">attendees</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.940.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.941.1">UserExtras model</span></strong><span class="koboSpan" id="kobo.942.1">: This model will include additional</span><a id="_idIndexMarker539"/><span class="koboSpan" id="kobo.943.1"> data about each user, such as their name, contact information, profile photo, and any other relevant details. </span><span class="koboSpan" id="kobo.943.2">The following relationship exists with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">users</span></strong><span class="koboSpan" id="kobo.945.1"> table – a one-to-one relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">users</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.947.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.948.1">userExtras</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.949.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.950.1">Role model</span></strong><span class="koboSpan" id="kobo.951.1">: This model will include data</span><a id="_idIndexMarker540"/><span class="koboSpan" id="kobo.952.1"> about each role available in the system, such as administrator, speaker, attendee, or sponsor. </span><span class="koboSpan" id="kobo.952.2">Each role will have its own set of permissions and access controls. </span><span class="koboSpan" id="kobo.952.3">The following relationship exists with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">users</span></strong><span class="koboSpan" id="kobo.954.1"> table – a many-to-many relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1">users</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.956.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">roles</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.958.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.959.1">Speaker model</span></strong><span class="koboSpan" id="kobo.960.1">: This model will include data about</span><a id="_idIndexMarker541"/><span class="koboSpan" id="kobo.961.1"> each speaker, such as their name, bio, photo, contact information, and any other relevant details. </span><span class="koboSpan" id="kobo.961.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">Speaker</span></strong><span class="koboSpan" id="kobo.963.1"> model will be linked to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.964.1">users</span></strong><span class="koboSpan" id="kobo.965.1"> model to associate each</span><a id="_idIndexMarker542"/><span class="koboSpan" id="kobo.966.1"> speaker with their user account. </span><span class="koboSpan" id="kobo.966.2">The following relationships exist with other tables – a one-to-many relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">speakers</span></strong><span class="koboSpan" id="kobo.968.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">sessions</span></strong><span class="koboSpan" id="kobo.970.1">, a one-to-one relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">users</span></strong><span class="koboSpan" id="kobo.972.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">speakers</span></strong><span class="koboSpan" id="kobo.974.1">, a one-to-many relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.975.1">speakers</span></strong><span class="koboSpan" id="kobo.976.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.977.1">schedules</span></strong><span class="koboSpan" id="kobo.978.1">, and a one-to-many relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">speakers</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.980.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">presentations</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.982.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.983.1">Presentation model</span></strong><span class="koboSpan" id="kobo.984.1">: This model will include data</span><a id="_idIndexMarker543"/><span class="koboSpan" id="kobo.985.1"> about each presentation or talk, such as the title, description, date and time, duration, location, and speaker(s). </span><span class="koboSpan" id="kobo.985.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1">Presentation</span></strong><span class="koboSpan" id="kobo.987.1"> model will be linked to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.988.1">Speaker</span></strong><span class="koboSpan" id="kobo.989.1"> model to associate each presentation with its speaker. </span><span class="koboSpan" id="kobo.989.2">The following relationships exist with other tables – many-to-one relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">presentations</span></strong><span class="koboSpan" id="kobo.991.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">speakers</span></strong><span class="koboSpan" id="kobo.993.1">, and one-to-many relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">presentations</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.995.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">schedules</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.997.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.998.1">Schedule model</span></strong><span class="koboSpan" id="kobo.999.1">: This model will include data about the overall</span><a id="_idIndexMarker544"/><span class="koboSpan" id="kobo.1000.1"> conference schedule, including the dates, times, and locations of all presentations, workshops, and other events. </span><span class="koboSpan" id="kobo.1000.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1">Schedule</span></strong><span class="koboSpan" id="kobo.1002.1"> model will be linked to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1">Presentation</span></strong><span class="koboSpan" id="kobo.1004.1"> model to associate each presentation with its date and time. </span><span class="koboSpan" id="kobo.1004.2">The following relationships exist with other tables – many-to-one relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1005.1">schedules</span></strong><span class="koboSpan" id="kobo.1006.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1">presentations</span></strong><span class="koboSpan" id="kobo.1008.1">, one-to-many relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">schedules</span></strong><span class="koboSpan" id="kobo.1010.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">sessions</span></strong><span class="koboSpan" id="kobo.1012.1">, many-to-one relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1">schedules</span></strong><span class="koboSpan" id="kobo.1014.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1015.1">venues</span></strong><span class="koboSpan" id="kobo.1016.1">, and many-to-many relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">schedules</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1018.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">attendees</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1020.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1021.1">Attendee model</span></strong><span class="koboSpan" id="kobo.1022.1">: This model will include data</span><a id="_idIndexMarker545"/><span class="koboSpan" id="kobo.1023.1"> about each attendee, such as their name, contact information, registration status, and any other relevant details. </span><span class="koboSpan" id="kobo.1023.2">The following relationship exists with other tables – many-to-many relationships between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">attendees</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1025.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1">schedules</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1027.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1028.1">Session model</span></strong><span class="koboSpan" id="kobo.1029.1">: This model will include data</span><a id="_idIndexMarker546"/><span class="koboSpan" id="kobo.1030.1"> about each session, which can be a group of related presentations or workshops. </span><span class="koboSpan" id="kobo.1030.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">Session</span></strong><span class="koboSpan" id="kobo.1032.1"> model will be linked to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1033.1">Presentation</span></strong><span class="koboSpan" id="kobo.1034.1"> model to associate each session with its presentations. </span><span class="koboSpan" id="kobo.1034.2">The following relationships exist with other tables – a many-to-one relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1">sessions</span></strong><span class="koboSpan" id="kobo.1036.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">schedules</span></strong><span class="koboSpan" id="kobo.1038.1">, and a one-to-one relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1">sessions</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1040.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1">presentations</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1042.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1043.1">Venue model</span></strong><span class="koboSpan" id="kobo.1044.1">: This model will include data about</span><a id="_idIndexMarker547"/><span class="koboSpan" id="kobo.1045.1"> the conference venue, such as the address, capacity, layout, and any other relevant details. </span><span class="koboSpan" id="kobo.1045.2">There is a one-to-many relationship between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1046.1">venues</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1047.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1048.1">schedules</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1050.1">Sponsor model</span></strong><span class="koboSpan" id="kobo.1051.1">: This model will include data about each sponsor</span><a id="_idIndexMarker548"/><span class="koboSpan" id="kobo.1052.1"> of the conference, such</span><a id="_idIndexMarker549"/><span class="koboSpan" id="kobo.1053.1"> as their name, logo, website, and</span><a id="_idIndexMarker550"/><span class="koboSpan" id="kobo.1054.1"> any other </span><span class="No-Break"><span class="koboSpan" id="kobo.1055.1">relevant details.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1056.1">Now that we have defined our data model, we will explore in the next section how to seamlessly send data to a PostgreSQL database with just a few </span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1">simple steps.</span></span></p>
<h1 id="_idParaDest-149"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1058.1">Sending data to the PostgreSQL database from a Flask app</span></h1>
<p><span class="koboSpan" id="kobo.1059.1">Interacting with a database</span><a id="_idIndexMarker551"/><span class="koboSpan" id="kobo.1060.1"> is a common aspect of most web</span><a id="_idIndexMarker552"/><span class="koboSpan" id="kobo.1061.1"> applications. </span><span class="koboSpan" id="kobo.1061.2">Sending data to the PostgreSQL database from a Flask app is simple and straightforward. </span><span class="koboSpan" id="kobo.1061.3">A web application would not be complete without the ability to store and retrieve data from </span><span class="No-Break"><span class="koboSpan" id="kobo.1062.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.1063.1">The first step in sending data to a database is to ensure there is a connection between the Flask app and the database. </span><span class="koboSpan" id="kobo.1063.2">This involves installing the required libraries and ensuring that you work in a virtual environment to contain your installation and prevent unexpected occurrences, due to the interference of </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1">other libraries.</span></span></p>
<p><span class="koboSpan" id="kobo.1065.1">Let’s make use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">bizza/backend</span></strong><span class="koboSpan" id="kobo.1067.1"> directory created in the </span><em class="italic"><span class="koboSpan" id="kobo.1068.1">Setting up the development environment with Flask </span></em><span class="koboSpan" id="kobo.1069.1">section of </span><a href="B18554_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1070.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.1071.1">. </span><span class="koboSpan" id="kobo.1071.2">You can create one if you haven’t already. </span><span class="koboSpan" id="kobo.1071.3">Install and activate the </span><span class="No-Break"><span class="koboSpan" id="kobo.1072.1">virtual environment.</span></span></p>
<p><span class="koboSpan" id="kobo.1073.1">To create a virtual environment, open your project root directory in a terminal and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1074.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1075.1">python –m venv venv</span></pre>
<p><span class="koboSpan" id="kobo.1076.1">Now, let’s activate the </span><span class="No-Break"><span class="koboSpan" id="kobo.1077.1">virtual environment:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1078.1">For </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1079.1">Windows users</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1">:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1081.1">Venv\Scripts\activate</span></strong></pre></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1082.1">For </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1083.1">Linux/Mac users</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1084.1">:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1085.1">source venv/bin/activate</span></strong></pre></li>
</ul>
<p><span class="koboSpan" id="kobo.1086.1">To create a database table from a Python class, you need </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">flask-sqlalchemy</span></strong><span class="koboSpan" id="kobo.1088.1"> installed. </span><span class="koboSpan" id="kobo.1088.2">We have this installed already. </span><span class="koboSpan" id="kobo.1088.3">If not, enter </span><span class="No-Break"><span class="koboSpan" id="kobo.1089.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1090.1">pip install flask-sqlalchemy</span></pre>
<p><span class="koboSpan" id="kobo.1091.1">In the Flask application</span><a id="_idIndexMarker553"/><span class="koboSpan" id="kobo.1092.1"> module – that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1">app.py</span></strong><span class="koboSpan" id="kobo.1094.1"> – update the content</span><a id="_idIndexMarker554"/><span class="koboSpan" id="kobo.1095.1"> of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1096.1">app.py</span></strong><span class="koboSpan" id="kobo.1097.1"> with the following code that creates the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1098.1">users</span></strong><span class="koboSpan" id="kobo.1099.1"> table in the </span><em class="italic"><span class="koboSpan" id="kobo.1100.1">bizza</span></em><span class="koboSpan" id="kobo.1101.1"> database. </span><span class="koboSpan" id="kobo.1101.2">In this section, we will only create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1102.1">users</span></strong><span class="koboSpan" id="kobo.1103.1"> table to demonstrate how to send data from a Flask app </span><span class="No-Break"><span class="koboSpan" id="kobo.1104.1">to PostgreSQL.</span></span></p>
<p><span class="koboSpan" id="kobo.1105.1">The other models will be shown on GitHub and later in the book until we have a full implementation of the speakers’ conference web </span><span class="No-Break"><span class="koboSpan" id="kobo.1106.1">app, </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1107.1">Bizza</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1108.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1109.1"># Import flaskfrom flask import Flask
# Import datetime
from datetime import datetime
# Import SQLAlchemy
from flask_sqlalchemy import SQLAlchemy
# Create a Flask instance
app = Flask(__name__)
# Add the PostgreSQL database
app.config['SQLALCHEMY_DATABASE_URI'] =
    'postgresql://&lt;db_username&gt;:&lt;db_password&gt;@localhost:
    5432/&lt;database_name&gt;'
# Initialize the database
db = SQLAlchemy(app)
# User model definition
class User(db.Model):
    __tablename__ = 'users'
    user_id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(100), unique=True,
        nullable=False)
    email = db.Column(db.String(120), unique=True,
        nullable=False)
    password = db.Column(db.String(128), nullable=False)
    first_name = db.Column(db.String(100), nullable=False)
    last_name = db.Column(db.String(100), nullable=False)
    roles = db.Column(db.String(100))
    is_active = db.Column(db.Boolean, default=True)
    is_superuser = db.Column(db.Boolean, default=False)
    created_at = db.Column(db.DateTime,
        default=datetime.utcnow())
    updated_at = db.Column(db.DateTime,
        default=datetime.utcnow,
        onupdate=datetime.utcnow())
    def __repr__(self):
        return '&lt;User %r&gt;' % self.username</span></pre>
<p><span class="koboSpan" id="kobo.1110.1">Let’s delve into the preceding</span><a id="_idIndexMarker555"/><span class="koboSpan" id="kobo.1111.1"> Flask app snippet used</span><a id="_idIndexMarker556"/><span class="koboSpan" id="kobo.1112.1"> to create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1">users</span></strong><span class="koboSpan" id="kobo.1114.1"> table in </span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1">the database:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">from flask import Flask</span></strong><span class="koboSpan" id="kobo.1117.1"> imports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1">Flask</span></strong><span class="koboSpan" id="kobo.1119.1"> class from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1120.1">Flask module.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1121.1">from flask_sqlalchemy import SQLAlchemy</span></strong><span class="koboSpan" id="kobo.1122.1"> imports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1123.1">SQLAlchemy</span></strong><span class="koboSpan" id="kobo.1124.1"> class from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">flask_sqlalchemy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1"> module.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1">app = Flask(__name__)</span></strong><span class="koboSpan" id="kobo.1128.1"> creates a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">Flask</span></strong><span class="koboSpan" id="kobo.1130.1"> instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1131.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">app</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1133.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1134.1">app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://&lt;db_username&gt;:&lt;db_password&gt;@localhost:5432/&lt;database_name&gt;'</span></strong><span class="koboSpan" id="kobo.1135.1"> is where the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1136.1">app.config[]</span></strong><span class="koboSpan" id="kobo.1137.1"> dictionary defines the path to the database with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1138.1">db username</span></strong><span class="koboSpan" id="kobo.1139.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1140.1">password</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1141.1"> set.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">db = SQLAlchemy(app)</span></strong><span class="koboSpan" id="kobo.1143.1"> initializes an instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1144.1">SQLAlchemy</span></strong><span class="koboSpan" id="kobo.1145.1"> class with the Flask app as </span><span class="No-Break"><span class="koboSpan" id="kobo.1146.1">the argument.</span></span></li>
<li><span class="koboSpan" id="kobo.1147.1">Then, we start to define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1148.1">model</span></strong><span class="koboSpan" id="kobo.1149.1"> class for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1150.1">User</span></strong><span class="koboSpan" id="kobo.1151.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1">class User(db.Model):</span></strong><span class="koboSpan" id="kobo.1153.1">. </span><span class="koboSpan" id="kobo.1153.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1154.1">User(db.Model)</span></strong><span class="koboSpan" id="kobo.1155.1"> class defines a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1156.1">User</span></strong><span class="koboSpan" id="kobo.1157.1"> model that inherits from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">db.Model</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1159.1"> class.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1160.1">__tablename__ = 'users'</span></strong><span class="koboSpan" id="kobo.1161.1"> allows us to have a custom name for the table – a </span><em class="italic"><span class="koboSpan" id="kobo.1162.1">Class User</span></em><span class="koboSpan" id="kobo.1163.1"> model with a corresponding table name, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">users</span></strong><span class="koboSpan" id="kobo.1165.1">. </span><span class="koboSpan" id="kobo.1165.2">If this is not specified, the lowercase class name (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">user</span></strong><span class="koboSpan" id="kobo.1167.1">) will </span><span class="No-Break"><span class="koboSpan" id="kobo.1168.1">be used.</span></span></li>
<li><span class="koboSpan" id="kobo.1169.1">Then, we add the</span><a id="_idIndexMarker557"/><span class="koboSpan" id="kobo.1170.1"> columns for the table. </span><span class="koboSpan" id="kobo.1170.2">Each</span><a id="_idIndexMarker558"/><span class="koboSpan" id="kobo.1171.1"> column is an object of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">Column</span></strong><span class="koboSpan" id="kobo.1173.1"> subclass </span><span class="No-Break"><span class="koboSpan" id="kobo.1174.1">of SQLAlchemy:</span></span><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1">User_id = db.Column(db.Integer, primary_key=True,nullable=False)</span></strong><span class="koboSpan" id="kobo.1176.1"> defines a primary key column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">user_id</span></strong><span class="koboSpan" id="kobo.1178.1"> with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1179.1">Integer</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1180.1">data type</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1">username = db.Column(db.String(50), unique=True, nullable=False)</span></strong><span class="koboSpan" id="kobo.1182.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">username</span></strong><span class="koboSpan" id="kobo.1184.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1185.1">String</span></strong><span class="koboSpan" id="kobo.1186.1"> data type and enforces that it must be unique and </span><span class="No-Break"><span class="koboSpan" id="kobo.1187.1">not nullable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1188.1">email = db.Column(db.String(120), unique=True, nullable=False)</span></strong><span class="koboSpan" id="kobo.1189.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1190.1">email</span></strong><span class="koboSpan" id="kobo.1191.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1192.1">String</span></strong><span class="koboSpan" id="kobo.1193.1"> data type and enforces that it must be unique and </span><span class="No-Break"><span class="koboSpan" id="kobo.1194.1">not nullable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1195.1">password = db.Column(db.String(256), nullable=False)</span></strong><span class="koboSpan" id="kobo.1196.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1197.1">password</span></strong><span class="koboSpan" id="kobo.1198.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1199.1">String</span></strong><span class="koboSpan" id="kobo.1200.1"> data type and enforces that it must not </span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1">be nullable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1202.1">first_name = db.Column(db.String(50), nullable=False)</span></strong><span class="koboSpan" id="kobo.1203.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1204.1">first_name</span></strong><span class="koboSpan" id="kobo.1205.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1206.1">String</span></strong><span class="koboSpan" id="kobo.1207.1"> data type and enforces that it must not </span><span class="No-Break"><span class="koboSpan" id="kobo.1208.1">be nullable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1209.1">last_name = db.Column(db.String(50), nullable=False)</span></strong><span class="koboSpan" id="kobo.1210.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1">last_name</span></strong><span class="koboSpan" id="kobo.1212.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1">String</span></strong><span class="koboSpan" id="kobo.1214.1"> data type and enforces that it must not </span><span class="No-Break"><span class="koboSpan" id="kobo.1215.1">be nullable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1">is_active = db.Column(db.Boolean, default=True)</span></strong><span class="koboSpan" id="kobo.1217.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1218.1">is_active</span></strong><span class="koboSpan" id="kobo.1219.1"> with a b</span><strong class="source-inline"><span class="koboSpan" id="kobo.1220.1">oolean</span></strong><span class="koboSpan" id="kobo.1221.1"> data type and sets a default value </span><span class="No-Break"><span class="koboSpan" id="kobo.1222.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1">True</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1224.1">is_superuser = db.Column(db.Boolean, default=False)</span></strong><span class="koboSpan" id="kobo.1225.1"> defines a column named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1">is_superuser</span></strong><span class="koboSpan" id="kobo.1227.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1228.1">Boolean</span></strong><span class="koboSpan" id="kobo.1229.1"> data type and sets a default value </span><span class="No-Break"><span class="koboSpan" id="kobo.1230.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1231.1">False</span></strong></span></li>
</ul></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1232.1">def __repr__(self)</span></strong><span class="koboSpan" id="kobo.1233.1"> defines a method that returns a string representation of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1234.1">User</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1"> object.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1236.1">return '&lt;User %r&gt;' % self.username</span></strong><span class="koboSpan" id="kobo.1237.1"> returns a string that includes the username of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1238.1">User</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1239.1"> object.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1240.1">Now that we have defined the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1241.1">User</span></strong><span class="koboSpan" id="kobo.1242.1"> class model, it’s time to create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1">users</span></strong><span class="koboSpan" id="kobo.1244.1"> table in the database and pass in </span><span class="No-Break"><span class="koboSpan" id="kobo.1245.1">some data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1246.1">Open a terminal</span><a id="_idIndexMarker559"/><span class="koboSpan" id="kobo.1247.1"> in the project root directory</span><a id="_idIndexMarker560"/><span class="koboSpan" id="kobo.1248.1"> and enter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1249.1">flask </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1250.1">shell</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1"> command.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer079">
<span class="koboSpan" id="kobo.1252.1"><img alt="Figure 8.10 – A screenshot showing flask shell" src="image/Figure_8.10_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1253.1">Figure 8.10 – A screenshot showing flask shell</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1254.1">Enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1">from app import db</span></strong><span class="koboSpan" id="kobo.1256.1"> to connect with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1257.1">database object.</span></span></li>
<li><span class="koboSpan" id="kobo.1258.1">Enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1259.1">db.create_all()</span></strong><span class="koboSpan" id="kobo.1260.1"> to create the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1261.1">users</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1262.1"> table.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer080">
<span class="koboSpan" id="kobo.1263.1"><img alt="Figure 8.11 – A screenshot showing db.create_all()" src="image/Figure_8.11_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1264.1">Figure 8.11 – A screenshot showing db.create_all()</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1265.1">Enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1266.1">from app import User</span></strong><span class="koboSpan" id="kobo.1267.1"> to gain access to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">User</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1269.1"> model.</span></span></li>
<li><span class="koboSpan" id="kobo.1270.1">Add user data to the table using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1271.1">flask </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1272.1">shell</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1273.1"> terminal:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1274.1">user1=User(username='john',first_name='John',last_name='Stewart',email='admin@admin.com',password='password')</span></pre></li>
<li><span class="koboSpan" id="kobo.1275.1">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.1276.1">db.session.add(user1)</span></strong><span class="koboSpan" id="kobo.1277.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1">db.session.commit()</span></strong><span class="koboSpan" id="kobo.1279.1"> to add a user to the database session and a commit for data persistence in </span><span class="No-Break"><span class="koboSpan" id="kobo.1280.1">the database.</span></span></li>
<li><span class="koboSpan" id="kobo.1281.1">Enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1282.1">User.query.all()</span></strong><span class="koboSpan" id="kobo.1283.1"> to see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1284.1">users</span></strong><span class="koboSpan" id="kobo.1285.1"> table</span><a id="_idIndexMarker561"/><span class="koboSpan" id="kobo.1286.1"> with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1287.1">added</span></span><span class="No-Break"><a id="_idIndexMarker562"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1288.1"> information.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer081">
<span class="koboSpan" id="kobo.1289.1"><img alt="Figure 8.12 – A screenshot showing flask shell with inserted data" src="image/Figure_8.12_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1290.1">Figure 8.12 – A screenshot showing flask shell with inserted data</span></p>
<p><span class="koboSpan" id="kobo.1291.1">Next, we will discuss how you can add and track changes to your database structure </span><span class="No-Break"><span class="koboSpan" id="kobo.1292.1">with migrations.</span></span></p>
<h1 id="_idParaDest-150"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.1293.1">Migration with Alembic</span></h1>
<p><span class="koboSpan" id="kobo.1294.1">As discussed earlier, Alembic</span><a id="_idIndexMarker563"/><span class="koboSpan" id="kobo.1295.1"> is a migration tool that makes the tracking of changes in a database</span><a id="_idIndexMarker564"/><span class="koboSpan" id="kobo.1296.1"> a less problematic operation for Flask developers. </span><span class="koboSpan" id="kobo.1296.2">Since we expect data models to change, we need a tool that can keep track of these changes and ensure they are updated in </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.1298.1">This is similar to how we do version control of source code using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1299.1">Git</span></strong><span class="koboSpan" id="kobo.1300.1">. </span><span class="koboSpan" id="kobo.1300.2">The same applies to database schema change management, where we keep incremental and reversible changes in the database structure. </span><span class="koboSpan" id="kobo.1300.3">Working with a database table, you will want to add or remove columns, thus altering the schema in a Python </span><span class="No-Break"><span class="koboSpan" id="kobo.1301.1">model class.</span></span></p>
<p><span class="koboSpan" id="kobo.1302.1">Once this is done, you need an automatic process to ensure your database table and the state of the data model schema are in sync. </span><span class="koboSpan" id="kobo.1302.2">Alembic graciously handles the schema migration and ensures that the data model in a Python file is the same as the </span><span class="No-Break"><span class="koboSpan" id="kobo.1303.1">database structure.</span></span></p>
<p><span class="koboSpan" id="kobo.1304.1">Let’s examine how you can implement migration in a Flask application. </span><span class="koboSpan" id="kobo.1304.2">We will add another model and use migration to track changes made to the database. </span><span class="koboSpan" id="kobo.1304.3">Here, we add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1305.1">Speaker</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1306.1">model class.</span></span></p>
<p><span class="koboSpan" id="kobo.1307.1">Install </span><strong class="source-inline"><span class="koboSpan" id="kobo.1308.1">Flask-Migrate</span></strong><span class="koboSpan" id="kobo.1309.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1310.1">pip</span></strong><span class="koboSpan" id="kobo.1311.1">, as stated in the </span><em class="italic"><span class="koboSpan" id="kobo.1312.1">Setting up </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1313.1">Alembic</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1314.1"> section:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1315.1">pip install Flask-Migrate</span></pre>
<p><span class="koboSpan" id="kobo.1316.1">Inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1">app.py</span></strong><span class="koboSpan" id="kobo.1318.1">, add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1319.1">following snippet:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1320.1">from flask import Flaskfrom flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate
app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] =
    'sqlite:///bizza.db'
db = SQLAlchemy(app)
migrate = Migrate(app, db)
class Speaker(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(50), nullable=False)
    bio = db.Column(db.Text, nullable=False)
    photo = db.Column(db.String(100))
    contact_info = db.Column(db.String(100))
    user_id = db.Column(db.Integer,
        db.ForeignKey('users.user_id'), nullable=False)
    user = db.relationship('User',
        backref=db.backref('speaker', uselist=False))
    def __repr__(self):
        return f"Speaker('{self.name}', '{self.bio}',
            '{self.photo}', '{self.contact_info}')"
if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=5000)</span></pre>
<p><span class="koboSpan" id="kobo.1321.1">A few changes were made to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1322.1">app.py</span></strong><span class="koboSpan" id="kobo.1323.1"> file, including the installation of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1324.1">flask-migrate</span></strong><span class="koboSpan" id="kobo.1325.1"> package, the creation of an instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1326.1">Migrate</span></strong><span class="koboSpan" id="kobo.1327.1"> class with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1328.1">app</span></strong><span class="koboSpan" id="kobo.1329.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1330.1">db</span></strong><span class="koboSpan" id="kobo.1331.1"> instances</span><a id="_idIndexMarker565"/><span class="koboSpan" id="kobo.1332.1"> as arguments, and the addition of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1333.1">speaker</span></strong><span class="koboSpan" id="kobo.1334.1"> model class that will be tracked</span><a id="_idIndexMarker566"/><span class="koboSpan" id="kobo.1335.1"> upon its inclusion in </span><span class="No-Break"><span class="koboSpan" id="kobo.1336.1">the database.</span></span></p>
<h2 id="_idParaDest-151"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.1337.1">Running migrations</span></h2>
<p><span class="koboSpan" id="kobo.1338.1">Based on the changes</span><a id="_idIndexMarker567"/><span class="koboSpan" id="kobo.1339.1"> made to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1340.1">app.py</span></strong><span class="koboSpan" id="kobo.1341.1"> with the addition</span><a id="_idIndexMarker568"/><span class="koboSpan" id="kobo.1342.1"> of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1343.1">speaker</span></strong><span class="koboSpan" id="kobo.1344.1"> model class, let’s implement migrations </span><span class="No-Break"><span class="koboSpan" id="kobo.1345.1">with Alembic:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1346.1">Firstly, inside the project directory, enter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1347.1">pip install flask-migrate</span></strong><span class="koboSpan" id="kobo.1348.1"> command. </span><span class="koboSpan" id="kobo.1348.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1349.1">flask-migrate</span></strong><span class="koboSpan" id="kobo.1350.1"> extension provides database migration support for </span><span class="No-Break"><span class="koboSpan" id="kobo.1351.1">Flask applications.</span></span></li>
<li><span class="koboSpan" id="kobo.1352.1">To generate the initial migration in Flask, enter the following in the command terminal of the project </span><span class="No-Break"><span class="koboSpan" id="kobo.1353.1">root directory:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1354.1">flask db init</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1355.1">The preceding command will create a new directory called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1356.1">migrations</span></strong><span class="koboSpan" id="kobo.1357.1"> in your Flask </span><span class="No-Break"><span class="koboSpan" id="kobo.1358.1">application directory.</span></span></p></li>
<li><span class="koboSpan" id="kobo.1359.1">Then, once you have initialized the migration repository, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1360.1">flask db migrate</span></strong><span class="koboSpan" id="kobo.1361.1"> command to generate the first migration, based on changes you have made to your models. </span><span class="koboSpan" id="kobo.1361.2">We have added the new speaker model to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1362.1">app.py</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1363.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1364.1">Now, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1365.1">flask db migrate -m 'first migration message, speaker model added'</span></strong><span class="koboSpan" id="kobo.1366.1"> command to generate a new migration script, based on the changes made to the database models. </span><span class="koboSpan" id="kobo.1366.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1367.1">-m</span></strong><span class="koboSpan" id="kobo.1368.1"> flag is used to specify a message describing the changes made in the migration. </span><span class="koboSpan" id="kobo.1368.2">The following command will create a new migration file with the changes specified in </span><span class="No-Break"><span class="koboSpan" id="kobo.1369.1">the models:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1370.1">flask db init</span></strong><strong class="bold"><span class="koboSpan" id="kobo.1371.1">flask db migrate -m "first migration speaker model"</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1372.1">The following screenshot shows the effects of </span><span class="No-Break"><span class="koboSpan" id="kobo.1373.1">the commands:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer082">
<span class="koboSpan" id="kobo.1374.1"><img alt="Figure 8.13 – A screenshot showing the migration commands" src="image/Figure_8.13_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1375.1">Figure 8.13 – A screenshot showing the migration commands</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1376.1">To commit the schema data model change to a database based on the state of the migration script, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1377.1">following command:</span></span><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1378.1">flask db upgrade</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1379.1">You will then get the </span><span class="No-Break"><span class="koboSpan" id="kobo.1380.1">following output:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer083">
<span class="koboSpan" id="kobo.1381.1"><img alt="Figure 8.14 – A screenshot showing the flask db upgrade command" src="image/Figure_8.14_B18554.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1382.1">Figure 8.14 – A screenshot showing the flask db upgrade command</span></p>
<p><span class="koboSpan" id="kobo.1383.1">This will apply all the pending</span><a id="_idIndexMarker569"/><span class="koboSpan" id="kobo.1384.1"> migrations to your database</span><a id="_idIndexMarker570"/><span class="koboSpan" id="kobo.1385.1"> schema. </span><span class="koboSpan" id="kobo.1385.2">From this point on, you can continue to generate new migrations as needed using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1386.1">flask db </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1387.1">migrate</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1388.1"> command.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1389.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1390.1">To summarize the commands needed for Alembic migrations, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.1391.1">these steps:</span></span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.1392.1">pip </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1393.1">install flask-migrate</span></strong></span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.1394.1">flask </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1395.1">db init</span></strong></span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.1396.1">flask db migrate -m “first migration message </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1397.1">speakers model”</span></strong></span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.1398.1">flask </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1399.1">db upgrade</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1400.1">Alembic is a database migration tool for SQLAlchemy that helps keep the database schema in sync with the application’s data model. </span><span class="koboSpan" id="kobo.1400.2">When using Alembic, you define changes to the data model in a series of migrations, which are Python scripts that modify the </span><span class="No-Break"><span class="koboSpan" id="kobo.1401.1">database schema.</span></span></p>
<p><span class="koboSpan" id="kobo.1402.1">These migrations are stored in a migration directory, and each migration is associated with a specific version of the schema. </span><span class="koboSpan" id="kobo.1402.2">When you run a migration, Alembic compares the current state of the database schema to the target state defined in the migration. </span><span class="koboSpan" id="kobo.1402.3">It then generates a set of SQL statements to modify the database schema to match the </span><span class="No-Break"><span class="koboSpan" id="kobo.1403.1">target state.</span></span></p>
<p><span class="koboSpan" id="kobo.1404.1">These SQL statements</span><a id="_idIndexMarker571"/><span class="koboSpan" id="kobo.1405.1"> are executed in a transaction, which ensures</span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.1406.1"> that the database schema is modified in a consistent manner. </span><span class="koboSpan" id="kobo.1406.2">With the use of Alembic to manage database migrations, you can ensure that the database schema remains in sync with the application’s data model as it evolves over time. </span><span class="koboSpan" id="kobo.1406.3">This can help prevent data inconsistencies and other issues that can arise when the database schema and data model become out </span><span class="No-Break"><span class="koboSpan" id="kobo.1407.1">of sync.</span></span></p>
<h1 id="_idParaDest-152"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1408.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1409.1">In this chapter, we extensively discussed SQL and relational data modeling for the web. </span><span class="koboSpan" id="kobo.1409.2">A relational database helps us with the design of a database as a group of relations. </span><span class="koboSpan" id="kobo.1409.3">We also discussed relationships that can exist in a database, such as one-to-one, one-to-many, and many-to-many relationships, allowing us to logically group relations in the database and enforce data </span><span class="No-Break"><span class="koboSpan" id="kobo.1410.1">referential integrity.</span></span></p>
<p><span class="koboSpan" id="kobo.1411.1">Additionally, we examined how to set up PostgreSQL. </span><span class="koboSpan" id="kobo.1411.2">We shed light on the basics of SQLAlchemy and its associated database adapters and how they are used in Flask application development. </span><span class="koboSpan" id="kobo.1411.3">We discussed data model design, with the </span><em class="italic"><span class="koboSpan" id="kobo.1412.1">Bizza</span></em><span class="koboSpan" id="kobo.1413.1"> project as a use case. </span><span class="koboSpan" id="kobo.1413.2">Finally, we discussed how a Flask app can communicate with the database and migration in Flask to keep track of changes in </span><span class="No-Break"><span class="koboSpan" id="kobo.1414.1">a database.</span></span></p>
<p><span class="koboSpan" id="kobo.1415.1">In the next chapter, we will extensively discuss the API in backend development and how you can use the Flask framework to implement </span><span class="No-Break"><span class="koboSpan" id="kobo.1416.1">API design.</span></span></p>
</div>
</body></html>