<html><head></head><body>
<section data-number="0.16" id="chapter-13-application-integration-configuration">
<h2 class="likechapterhead" data-number="0.16"><span><span class="kobospan" id="kobo.1.1">13</span></span><br class="tipbox1"/> <span id="x1-71500013"/><span class="kobospan" id="kobo.2.1">Application Integration: Configuration</span></h2>
<p class="normal"><span class="kobospan" id="kobo.3.1">Python’s concept of an extensible library gives us rich access to numerous computing resources. </span><span class="kobospan" id="kobo.3.2">The language provides avenues to make even more resources available. </span><span class="kobospan" id="kobo.3.3">This makes Python programs particularly strong at integrating components to create sophisticated composite processing. </span><span class="kobospan" id="kobo.3.4">In this chapter, we’ll address the fundamentals of creating complex applications: managing configuration files, logging, and a design pattern for scripts that permits automated testing.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.4.1">These new recipes leverage ideas shown in recipes in other chapters. </span><span class="kobospan" id="kobo.4.2">Specifically, in the </span><a href="ch010.xhtml#x1-3490004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.5.1">Using argparse to get command-line input</span></span></a><span class="kobospan" id="kobo.6.1">, </span><a href="ch010.xhtml#x1-3610006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.7.1">Using cmd to</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.8.1">create command-line applications</span></span></a><span class="kobospan" id="kobo.9.1">, and </span><a href="ch010.xhtml#x1-3670007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.10.1">Using the OS environment settings</span></span></a><span class="kobospan" id="kobo.11.1"> recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.12.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.13.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.14.1">6</span></span></a><span class="kobospan" id="kobo.15.1">, some specific techniques for creating top-level (main) application scripts were shown. </span><span class="kobospan" id="kobo.15.2">It may help to review those recipes to see examples of Python application scripts. </span><span class="kobospan" id="kobo.15.3">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.16.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.17.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.18.1">11</span></span></a><span class="kobospan" id="kobo.19.1">, we looked at filesystem input and output.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.20.1">In this chapter, we’ll look at a number of ways to handle configuration</span><span id="dx1-715001"/><span class="kobospan" id="kobo.21.1"> files. </span><span class="kobospan" id="kobo.21.2">There are many file formats that can be used to store long-term configuration information:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.22.1">The INI file format as processed by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.23.1">configparser</span></span></span></span><span class="kobospan" id="kobo.24.1"> module.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.25.1">The TOML file format is very easy to work with but requires an add-on module that’s not currently part of the Python distribution. </span><span class="kobospan" id="kobo.25.2">We’ll look at this in the </span><a href="ch017.xhtml#x1-7230002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.26.1">Using TOML for configuration files</span></span></a><span class="kobospan" id="kobo.27.1"> recipe.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.28.1">The properties file format is typical of Java programming and can be handled in Python without writing too much code. </span><span class="kobospan" id="kobo.28.2">Some of the syntax overlaps with Python scripts and TOML files. </span><span class="kobospan" id="kobo.28.3">A switch from the properties file format to TOML only requires changing any </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.29.1">name:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.30.1"> value</span></span></span></span><span class="kobospan" id="kobo.31.1"> to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.32.1">name</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.33.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.34.1"> "value"</span></span></span></span><span class="kobospan" id="kobo.35.1">, permitting use of the TOML parser.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.36.1">For Python scripts, a file with assignment statements looks a lot like a properties file, and is very easy to process using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.37.1">compile()</span></span></span></span><span class="kobospan" id="kobo.38.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.39.1">exec()</span></span></span></span><span class="kobospan" id="kobo.40.1"> functions. </span><span class="kobospan" id="kobo.40.2">We’ll look at this in the </span><a href="ch017.xhtml#x1-7290003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.41.1">Using Python for</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.42.1">configuration files</span></span></a><span class="kobospan" id="kobo.43.1"> recipe.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.44.1">A Python module with class definitions is a variation that uses Python syntax but isolates the settings into separate classes. </span><span class="kobospan" id="kobo.44.2">This can be processed with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.45.1">import</span></span></span></span><span class="kobospan" id="kobo.46.1"> statement. </span><span class="kobospan" id="kobo.46.2">We’ll look at this in the </span><a href="ch017.xhtml#x1-7350004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.47.1">Using</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.48.1">a class as a namespace for configuration</span></span></a><span class="kobospan" id="kobo.49.1"> recipe.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.50.1">Some recipes in this chapter will extend some of the concepts from </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.51.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.52.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.53.1">7</span></span></a><span class="kobospan" id="kobo.54.1">, and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.55.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.56.1"> </span></span><a href="ch012.xhtml#x1-4520008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.57.1">8</span></span></a><span class="kobospan" id="kobo.58.1">. </span><span class="kobospan" id="kobo.58.2">This chapter will apply those concepts to defining configuration files using classes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.59.1">It’s important to consider the kinds of information required in configuration files. </span><span class="kobospan" id="kobo.59.2">Carelessly including passwords or security tokens in a configuration file can be fatal to secure use of data. </span><span class="kobospan" id="kobo.59.3">Including personal information in a configuration file is also a common security weakness. </span><span class="kobospan" id="kobo.59.4">See the </span><a href="https://cwe.mitre.org/index.html" class="url"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.60.1">Common Weakness</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.61.1">Enumeration</span></span></a><span class="kobospan" id="kobo.62.1"> for other more specific issues with poorly designed configuration files.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.63.1">In this chapter, we’ll look at the following recipes:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.64.1">Finding configuration files</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch017.xhtml#x1-7230002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.65.1">Using TOML for configuration files</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch017.xhtml#x1-7290003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.66.1">Using Python for configuration files</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch017.xhtml#x1-7350004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.67.1">Using a class as a namespace for configuration</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch017.xhtml#x1-7410005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.68.1">Designing scripts for composition</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch017.xhtml#x1-7470006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.69.1">Using logging for control and audit output</span></span></a></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.70.1">We’ll start with a recipe for handling multiple configuration files that must be combined. </span><span class="kobospan" id="kobo.70.2">This gives users some helpful flexibility. </span><span class="kobospan" id="kobo.70.3">From there, we can dive into the specifics of a few of the common configuration file formats. </span><span id="x1-715002r1528"/></p>
<section data-number="0.16.1" id="finding-configuration-files">
<h1 class="unnumbered" data-number="0.16.1"><span><span class="kobospan" id="kobo.71.1">13.1 </span></span> <span id="x1-7160001"/><span class="kobospan" id="kobo.72.1">Finding configuration files</span></h1>
<p class="normal"><span class="kobospan" id="kobo.73.1">Many applications will have</span><span id="dx1-716001"/><span class="kobospan" id="kobo.74.1"> a hierarchy of configuration options. </span><span class="kobospan" id="kobo.74.2">The foundation of the hierarchy is often the default values built into the application. </span><span class="kobospan" id="kobo.74.3">These might be supplemented by server-wide (or cluster-wide) values from centralized configuration files. </span><span class="kobospan" id="kobo.74.4">There might also be user-specific files, or perhaps even configuration files provided when starting a program.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.75.1">In many cases, configuration parameters are written in text files, so they are persistent and easy to change. </span><span class="kobospan" id="kobo.75.2">The common tradition in Linux is to put system-wide configuration in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.76.1">/etc</span></span></span></span><span class="kobospan" id="kobo.77.1"> directory. </span><span class="kobospan" id="kobo.77.2">A user’s personal changes would be in their home directory, often named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.78.1">~username</span></span></span></span><span class="kobospan" id="kobo.79.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.80.1">$HOME</span></span></span></span><span class="kobospan" id="kobo.81.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.82.1">In this recipe, we’ll see how an application can support a rich hierarchy of locations for configuration files. </span><span id="x1-716002r1526"/></p>
<section data-number="0.16.1.1" id="getting-ready-99">
<h2 class="likechapterhead" data-number="0.16.1.1"><span><span class="kobospan" id="kobo.83.1">13.1.1 </span></span> <span id="x1-7170001"/><span class="kobospan" id="kobo.84.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.85.1">The example we’ll use is an application to simulate dice rolling. </span><span class="kobospan" id="kobo.85.2">The application is shown in several recipes throughout </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.86.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.87.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.88.1">6</span></span></a><span class="kobospan" id="kobo.89.1">. </span><span class="kobospan" id="kobo.89.2">Specifically, look at </span><a href="ch010.xhtml#x1-3490004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.90.1">Using</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.91.1">argparse to get command-line input</span></span></a><span class="kobospan" id="kobo.92.1"> and </span><a href="ch010.xhtml#x1-3610006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.93.1">Using cmd to create command-line</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.94.1">applications</span></span></a><span class="kobospan" id="kobo.95.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.96.1">We’ll follow the design pattern of the Bash shell, which looks for configuration files in the following places:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-717002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.97.1">It starts with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.98.1">/etc/profile</span></span></span></span><span class="kobospan" id="kobo.99.1"> file, applicable to everyone using the system.</span></p>
</div></li>
<li class="calibre7"><div id="x1-717004x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.100.1">After reading that file, it looks for one of these files, in this order:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-717006x1" class="calibre14">
<p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.101.1">~/.bash_profile</span></span></span></span></p>
</div></li>
<li class="calibre7"><div id="x1-717008x2" class="calibre14">
<p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.102.1">~/.bash_login</span></span></span></span></p>
</div></li>
<li class="calibre7"><div id="x1-717010x3" class="calibre14">
<p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.103.1">~/.profile</span></span></span></span></p>
</div></li>
</ol>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.104.1">Other shells, like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.105.1">zsh</span></span><span class="kobospan" id="kobo.106.1">, use some additional</span><span id="dx1-717011"/><span class="kobospan" id="kobo.107.1"> files but follow this pattern</span><span id="dx1-717012"/><span class="kobospan" id="kobo.108.1"> of working through a sequence of files in order.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.109.1">In a POSIX-compliant operating system, the shell expands the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.110.1">~</span></span></span></span><span class="kobospan" id="kobo.111.1"> to be the home directory for the logged-in user. </span><span class="kobospan" id="kobo.111.2">In general, the Python </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.112.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.113.1"> module handles this for Windows, Linux, and macOS automatically via the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.114.1">Path.home()</span></span></span></span><span class="kobospan" id="kobo.115.1"> method.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.116.1">In later recipes, we’ll look at ways to parse and process specific formats of configuration files. </span><span class="kobospan" id="kobo.116.2">For the purposes of this recipe, we won’t pick a specific format. </span><span class="kobospan" id="kobo.116.3">Instead, we’ll assume that an existing function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.117.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.118.1">, has been defined that will load a specific configuration mapping from the contents of the configuration files.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.119.1">The function looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.120.1">def load_config_file(config_path: Path) -&gt; dict[str, Any]: 
 
    """Loads a configuration mapping object with the contents 
 
    of a given file. 
 
    :param config_path: Path to be read. 
 
    :returns: mapping with configuration parameter value 
 
    """ 
 
    # Details omitted.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.121.1">We’ll look at a number of different ways to implement this function.</span></p>
<section data-number="0.16.1.1.1" id="why-so-many-choices">
<h3 class="likesubsubsectionhead" data-number="0.16.1.1.1"><span id="x1-7180001"/><span class="kobospan" id="kobo.122.1">Why so many choices?</span></h3>
<p class="normal"><span class="kobospan" id="kobo.123.1">There’s a side topic that sometimes</span><span id="dx1-718001"/><span class="kobospan" id="kobo.124.1"> arises when discussing this kind of design – why have so many choices? </span><span class="kobospan" id="kobo.124.2">Why not specify exactly one place?</span></p>
<p class="normal1"><span class="kobospan" id="kobo.125.1">It’s common to offer variations typical for one distribution, but atypical for another. </span><span class="kobospan" id="kobo.125.2">Also, user expectations depend on software with which they’re already familiar; this is very difficult to anticipate. </span><span class="kobospan" id="kobo.125.3">And, of course, when dealing with Windows, there will be the possibility of yet more variant file paths that are unique to that platform. </span><span class="kobospan" id="kobo.125.4">For these reasons, it’s easier to offer multiple locations</span><span id="dx1-718002"/><span class="kobospan" id="kobo.126.1"> and permit the user or administrator to pick the one they prefer. </span><span id="x1-718003r1532"/></p>
</section>
</section>
<section data-number="0.16.1.2" id="how-to-do-it...-100">
<h2 class="likechapterhead" data-number="0.16.1.2"><span><span class="kobospan" id="kobo.127.1">13.1.2 </span></span> <span id="x1-7190002"/><span class="kobospan" id="kobo.128.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.129.1">We’ll make use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.130.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.131.1"> module</span><span id="dx1-719001"/><span class="kobospan" id="kobo.132.1"> to provide a handy way to work with files in various locations. </span><span class="kobospan" id="kobo.132.2">We’ll also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.133.1">collections</span></span></span></span><span class="kobospan" id="kobo.134.1"> module to provide the very useful </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.135.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.136.1"> class:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-719003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.137.1">Import the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.138.1">Path</span></span></span></span><span class="kobospan" id="kobo.139.1"> class and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.140.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.141.1"> class. </span><span class="kobospan" id="kobo.141.2">There are several type hints that are also required:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.142.1">from pathlib import Path 
 
from collections import ChainMap 
 
from typing import TextIO, Any</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-719009x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.143.1">Define an overall function to get the configuration files:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.144.1">def get_config() -&gt; ChainMap[str, Any]:</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-719013x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.145.1">Create paths for the various locations of the configuration files. </span><span class="kobospan" id="kobo.145.2">These are</span><span id="dx1-719014"/><span class="kobospan" id="kobo.146.1"> called pure paths and start with the names of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.147.1">potential </span></span><span class="kobospan" id="kobo.148.1">files. </span><span class="kobospan" id="kobo.148.2">We can decompose these locations into a system path and a sequence of local paths. </span><span class="kobospan" id="kobo.148.3">Here are the two assignment statements:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.149.1">
    system_path = Path("/etc") / "some_app" / "config" 
 
    local_paths = [ 
 
    ".some_app_settings", 
 
    ".some_app_config", 
 
    ]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-719022x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.150.1">Define the application’s built-in defaults as a list of dictionaries:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.151.1">
    configuration_items = [ 
 
        dict( 
 
            some_setting="Default Value", 
 
            another_setting="Another Default", 
 
            some_option="Built-In Choice", 
 
        ) 
 
    ]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.152.1">Each individual configuration file is a mapping</span><span id="dx1-719031"/><span class="kobospan" id="kobo.153.1"> from keys to values. </span><span class="kobospan" id="kobo.153.2">Each of these mapping objects is combined to form a list; this becomes the final </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.154.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.155.1"> configuration mapping.</span></p>
</div></li>
<li class="calibre7"><div id="x1-719033x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.156.1">If the system-wide configuration file exists, load this file:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.157.1">
    if system_path.exists(): 
 
        configuration_items.append( 
 
            load_config_file(system_path))</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-719039x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.158.1">Iterate through other locations looking for a file to load. </span><span class="kobospan" id="kobo.158.2">This loads the first file that it finds and uses a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.159.1">break</span></span></span></span><span class="kobospan" id="kobo.160.1"> statement to stop after the first file is found:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.161.1">
    for config_name in local_paths: 
 
        config_path = Path.home() / config_name 
 
        if config_path.exists(): 
 
            configuration_items.append( 
 
                load_config_file(config_path)) 
 
            break</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-719048x7" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.162.1">Reverse the list and create the final </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.163.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.164.1"> mapping:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.165.1">
    configuration = ChainMap( 
 
        *reversed(configuration_items) 
 
    )</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.166.1">The list needs to be reversed so that the local file (appended last) is searched first, then the system settings, and finally the application default settings. </span><span class="kobospan" id="kobo.166.2">It’s certainly possible to assemble the list in the reverse order to avoid the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.167.1">reversed()</span></span></span></span><span class="kobospan" id="kobo.168.1"> function; we’ve left this possible change as an exercise for you.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.169.1">Once we’ve built the configuration object, we can use the final configuration like a simple mapping. </span><span class="kobospan" id="kobo.169.2">This object supports all of the expected dictionary operations. </span><span id="x1-719053r1535"/></p>
</section>
<section data-number="0.16.1.3" id="how-it-works...-100">
<h2 class="likechapterhead" data-number="0.16.1.3"><span><span class="kobospan" id="kobo.170.1">13.1.3 </span></span> <span id="x1-7200003"/><span class="kobospan" id="kobo.171.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.172.1">In the </span><a href="ch009.xhtml#x1-2900001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.173.1">Creating dictionaries – inserting and updating</span></span></a><span class="kobospan" id="kobo.174.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.175.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.176.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.177.1">5</span></span></a><span class="kobospan" id="kobo.178.1">, we looked at the basics of using a dictionary. </span><span class="kobospan" id="kobo.178.2">Here, we’ve combined several dictionaries into a chain. </span><span class="kobospan" id="kobo.178.3">When a key is not located in the first dictionary of the chain, then later dictionaries in the chain are checked. </span><span class="kobospan" id="kobo.178.4">This is a handy way to provide default values for each key in the mapping. </span><span class="kobospan" id="kobo.178.5">Because the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.179.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.180.1"> is nearly indistinguishable from the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.181.1">dict</span></span></span></span><span class="kobospan" id="kobo.182.1"> class, it permits a lot of flexibility in the implementation details: any kind of configuration file that can be read to create a dictionary is perfectly acceptable. </span><span class="kobospan" id="kobo.182.2">The rest of the application can be based on the dictionary without being exposed</span><span id="dx1-720001"/><span class="kobospan" id="kobo.183.1"> to the details of how the configuration was built. </span><span id="x1-720002r1543"/></p>
</section>
<section data-number="0.16.1.4" id="theres-more...-91">
<h2 class="likechapterhead" data-number="0.16.1.4"><span><span class="kobospan" id="kobo.184.1">13.1.4 </span></span> <span id="x1-7210004"/><span class="kobospan" id="kobo.185.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.186.1">The subtle distinction between the single system-wide configuration file and the collection of alternative names for the local configuration files isn’t ideal. </span><span class="kobospan" id="kobo.186.2">This distinction between a singleton and a list of choices doesn’t seem to serve any particular purpose. </span><span class="kobospan" id="kobo.186.3">Often, we want to extend this design and the tiny asymmetry leads to complications.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.187.1">We’ll consider changing the configuration</span><span id="dx1-721001"/><span class="kobospan" id="kobo.188.1"> to have the following four tiers:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-721003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.189.1">The built-in defaults.</span></p>
</div></li>
<li class="calibre7"><div id="x1-721005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.190.1">A host-wide configuration in a central directory like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.191.1">/etc</span></span></span></span><span class="kobospan" id="kobo.192.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.193.1">/opt</span></span></span></span><span class="kobospan" id="kobo.194.1">. </span><span class="kobospan" id="kobo.194.2">This is often used for details of the OS or network context for this container.</span></p>
</div></li>
<li class="calibre7"><div id="x1-721007x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.195.1">A home directory configuration for the user running the app. </span><span class="kobospan" id="kobo.195.2">This may be used for distinguishing test and production instances.</span></p>
</div></li>
<li class="calibre7"><div id="x1-721009x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.196.1">A local file in the current working directory. </span><span class="kobospan" id="kobo.196.2">This may be used by a developer or tester.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.197.1">This suggests a modification to the recipe to use nested lists of paths. </span><span class="kobospan" id="kobo.197.2">The outer list contains all of the tiers of configuration. </span><span class="kobospan" id="kobo.197.3">Within each tier, a list will contain the alternative locations for a configuration file.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.198.1">local_names = (’.some_app_settings’, ’.some_app_config’) 
 
config_paths = [ 
 
    [ 
 
        base / ’some_app’ / ’config’ 
 
        for base in (Path(’/etc’), Path(’/opt’)) 
 
    ], 
 
    [ 
 
        Path.home() / name 
 
        for name in local_names 
 
    ], 
 
    [ 
 
        Path.cwd() / name 
 
        for name in local_names 
 
    ], 
 
]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.199.1">This </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.200.1">list[list[Path]]</span></span></span></span><span class="kobospan" id="kobo.201.1"> structure provides three tiers</span><span id="dx1-721026"/><span class="kobospan" id="kobo.202.1"> of configuration files. </span><span class="kobospan" id="kobo.202.2">Each of the tiers has a number of alternative names. </span><span class="kobospan" id="kobo.202.3">The order of the tiers and the names within each tier are important. </span><span class="kobospan" id="kobo.202.4">The lower tiers provide overrides to the upper tiers. </span><span class="kobospan" id="kobo.202.5">We can then use nested </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.203.1">for</span></span></span></span><span class="kobospan" id="kobo.204.1"> statements to examine all of the alternative locations.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.205.1">def get_config_2() -&gt; ChainMap[str, Any]: 
 
    configuration_items = [ 
 
        DEFAULT_CONFIGURATION 
 
    ] 
 
    for tier_paths in config_paths: 
 
        for alternative in tier_paths: 
 
            if alternative.exists(): 
 
                configuration_items.append( 
 
                    load_config_file(alternative)) 
 
                break 
 
    configuration = ChainMap( 
 
        *reversed(configuration_items) 
 
    ) 
 
    return configuration</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.206.1">We’ve factored out the default configuration into a global variable with the name </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.207.1">DEFAULT_CONFIGURATION</span></span></span></span><span class="kobospan" id="kobo.208.1">. </span><span class="kobospan" id="kobo.208.2">We have conspicuously left the collection of configuration paths with the name </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.209.1">config_paths</span></span></span></span><span class="kobospan" id="kobo.210.1">. </span><span class="kobospan" id="kobo.210.2">It’s not perfectly clear if this should be global (and have a global variable name in ALL-CAPITALS) or if this should be part of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.211.1">get_config()</span></span></span></span><span class="kobospan" id="kobo.212.1"> function. </span><span class="kobospan" id="kobo.212.2">We’ve adopted a bit of both by using a lowercase name and putting it outside the function.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.213.1">The value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.214.1">config_paths</span></span></span></span><span class="kobospan" id="kobo.215.1"> is unlikely to be needed elsewhere, making it a bad choice for being a global variable. </span><span class="kobospan" id="kobo.215.2">It is, however, something that may change – perhaps in the next major release – and deserves to be exposed so it can be changed. </span><span id="x1-721042r1544"/></p>
</section>
<section data-number="0.16.1.5" id="see-also-98">
<h2 class="likechapterhead" data-number="0.16.1.5"><span><span class="kobospan" id="kobo.216.1">13.1.5 </span></span> <span id="x1-7220005"/><span class="kobospan" id="kobo.217.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.218.1">In the </span><a href="ch017.xhtml#x1-7230002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.219.1">Using TOML for configuration files</span></span></a><span class="kobospan" id="kobo.220.1"> and </span><a href="ch017.xhtml#x1-7290003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.221.1">Using Python for</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.222.1">configuration files</span></span></a><span class="kobospan" id="kobo.223.1"> recipes in this chapter, we’ll look at ways to implement the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.224.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.225.1"> function.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.226.1">In the </span><a href="ch019_split_001.xhtml#x1-85500010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.227.1">Mocking external resources</span></span></a><span class="kobospan" id="kobo.228.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.229.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.230.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.231.1">15</span></span></a><span class="kobospan" id="kobo.232.1">, we look at ways to test functions such as this, which interact with external resources.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.233.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.234.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.235.1"> module is central to this processing. </span><span class="kobospan" id="kobo.235.2">This module provides the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.236.1">Path</span></span></span></span><span class="kobospan" id="kobo.237.1"> class definition, which provides a great deal of sophisticated information about the OS’s files. </span><span class="kobospan" id="kobo.237.2">For more information, see the </span><a href="ch015_split_000.xhtml#x1-6160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.238.1">Using pathlib to work with filenames</span></span></a><span class="kobospan" id="kobo.239.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.240.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.241.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.242.1">11</span></span></a><span class="kobospan" id="kobo.243.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-722001r1531"/></p>
</section>
</section>
<section data-number="0.16.2" id="using-toml-for-configuration-files">
<h1 class="unnumbered" data-number="0.16.2"><span><span class="kobospan" id="kobo.244.1">13.2 </span></span> <span id="x1-7230002"/><span class="kobospan" id="kobo.245.1">Using TOML for configuration files</span></h1>
<p class="normal"><span class="kobospan" id="kobo.246.1">Python offers a variety of ways</span><span id="dx1-723001"/><span class="kobospan" id="kobo.247.1"> to package application</span><span id="dx1-723002"/><span class="kobospan" id="kobo.248.1"> inputs and configuration files. </span><span class="kobospan" id="kobo.248.2">We’ll look at writing files in TOML notation because this format is elegant and simple. </span><span class="kobospan" id="kobo.248.3">For more information</span><span id="dx1-723003"/><span class="kobospan" id="kobo.249.1"> on this format, see </span><a class="url" href="https://toml.io/en/"><span class="url1"><span class="kobospan" id="kobo.250.1">https://toml.io/en/</span></span></a><span class="kobospan" id="kobo.251.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.252.1">Most TOML files look quite a bit like INI-format files. </span><span class="kobospan" id="kobo.252.2">This overlap is intentional. </span><span class="kobospan" id="kobo.252.3">When parsed in Python, a TOML file will be a nested dictionary structure.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.253.1">We might have a file like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.254.1">[some_app] 
 
    option_1 = "useful value" 
 
    option_2 = 42 
 
 
 
[some_app.feature] 
 
    option_1 = 7331</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.255.1">This will become a dictionary like the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.256.1">{’some_app’: {’feature’: {’option_1’: 7331}, 
 
              ’option_1’: ’useful value’, 
 
              ’option_2’: 42}}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.257.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.258.1">[some_app.feature]</span></span></span></span><span class="kobospan" id="kobo.259.1"> is called a ”table”. </span><span class="kobospan" id="kobo.259.2">The use of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.260.1">.</span></span></span></span><span class="kobospan" id="kobo.261.1"> in the key</span><span id="dx1-723015"/><span class="kobospan" id="kobo.262.1"> creates a nested table. </span><span id="x1-723016r1547"/></p>
<section data-number="0.16.2.1" id="getting-ready-100">
<h2 class="likechapterhead" data-number="0.16.2.1"><span><span class="kobospan" id="kobo.263.1">13.2.1 </span></span> <span id="x1-7240001"/><span class="kobospan" id="kobo.264.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.265.1">We’ll often use the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.266.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.267.1"> recipe, shown earlier</span><span id="dx1-724001"/><span class="kobospan" id="kobo.268.1"> in this chapter, to check</span><span id="dx1-724002"/><span class="kobospan" id="kobo.269.1"> a variety of locations for a given configuration file. </span><span class="kobospan" id="kobo.269.2">This flexibility is often essential for creating an application that’s easy to use on a variety of platforms.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.270.1">In this recipe, we’ll build the missing part of the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.271.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.272.1"> recipe, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.273.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.274.1"> function. </span><span class="kobospan" id="kobo.274.2">Here’s the template that needs to be filled in:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.275.1">def load_config_file_draft(config_path: Path) -&gt; dict[str, Any]: 
 
    """Loads a configuration mapping object with contents 
 
    of a given file. 
 
 
 
    :param config_path: Path to be read. 
 
 
 
    :returns: mapping with configuration parameter values 
 
    """ 
 
    # Details omitted.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.276.1">In this recipe, we’ll fill in the space held by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.277.1">Details</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.278.1"> omitted</span></span></span></span><span class="kobospan" id="kobo.279.1"> line to load configuration files in TOML format. </span><span id="x1-724013r1551"/></p>
</section>
<section data-number="0.16.2.2" id="how-to-do-it...-101">
<h2 class="likechapterhead" data-number="0.16.2.2"><span><span class="kobospan" id="kobo.280.1">13.2.2 </span></span> <span id="x1-7250002"/><span class="kobospan" id="kobo.281.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.282.1">This recipe will make</span><span id="dx1-725001"/><span class="kobospan" id="kobo.283.1"> use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.284.1">tomllib</span></span></span></span><span class="kobospan" id="kobo.285.1"> module</span><span id="dx1-725002"/><span class="kobospan" id="kobo.286.1"> to parse a YAML-TOML file:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-725004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.287.1">Import the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.288.1">tomllib</span></span></span></span><span class="kobospan" id="kobo.289.1"> module along with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.290.1">Path</span></span></span></span><span class="kobospan" id="kobo.291.1"> definition and the type hints required by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.292.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.293.1"> function definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.294.1">from pathlib import Path 
 
from typing import Any 
 
import tomllib</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-725010x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.295.1">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.296.1">tomllib.load()</span></span></span></span><span class="kobospan" id="kobo.297.1"> function to load the TOML-syntax document:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.298.1">import tomllib 
 
 
 
def load_config_file(config_path: Path) -&gt; dict[str, Any]: 
 
    """Loads a configuration mapping object with contents 
 
    of a given file. 
 
    :param config_path: Path to be read. 
 
    :returns: mapping with configuration parameter values 
 
    """ 
 
    with config_path.open(’b’) as config_file: 
 
        document = tomllib.load(config_file)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.299.1">An unusual requirement of TOML parsing in Python requires us to open the file in ”binary” mode when using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.300.1">load()</span></span></span></span><span class="kobospan" id="kobo.301.1"> function. </span><span class="kobospan" id="kobo.301.2">We can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.302.1">’rb’</span></span></span></span><span class="kobospan" id="kobo.303.1"> as the mode to be explicit that the file is opened for reading.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.304.1">The alternative is to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.305.1">loads()</span></span></span></span><span class="kobospan" id="kobo.306.1"> function on a block of text. </span><span class="kobospan" id="kobo.306.2">It looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.307.1">    document = tomllib.loads(config_path.read_text())</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.308.1">This </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.309.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.310.1"> function produced the required dictionary structure. </span><span class="kobospan" id="kobo.310.2">It can be fit into the design from the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.311.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.312.1"> recipe to load a configuration file using TOML syntax. </span><span id="x1-725024r1553"/></p>
</section>
<section data-number="0.16.2.3" id="how-it-works...-101">
<h2 class="likechapterhead" data-number="0.16.2.3"><span><span class="kobospan" id="kobo.313.1">13.2.3 </span></span> <span id="x1-7260003"/><span class="kobospan" id="kobo.314.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.315.1">As noted above, the idea of TOML syntax is to be easy to read and map directly to a Python dictionary. </span><span class="kobospan" id="kobo.315.2">There is some intentional overlap between TOML notation and INI file syntax. </span><span class="kobospan" id="kobo.315.3">There is also some overlap with some aspects of property file syntax.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.316.1">The core of TOML syntax is key-value pairings generally written as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.317.1">key</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.318.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.319.1"> value</span></span></span></span><span class="kobospan" id="kobo.320.1">. </span><span class="kobospan" id="kobo.320.2">The keys include valid Python symbols. </span><span class="kobospan" id="kobo.320.3">This means that any sort of dataclass or Pydantic structure with a dictionary mapping can be mapped into TOML syntax, too.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.321.1">It’s valid for a TOML</span><span id="dx1-726001"/><span class="kobospan" id="kobo.322.1"> key to have a hyphen, which is not part</span><span id="dx1-726002"/><span class="kobospan" id="kobo.323.1"> of allowed Python names. </span><span class="kobospan" id="kobo.323.2">A key can be a quoted string, too. </span><span class="kobospan" id="kobo.323.3">This permits quite a wide variety of alternative keys. </span><span class="kobospan" id="kobo.323.4">These features may need some caution depending on ultimate use for the configuration dictionary objects.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.324.1">A key can also be </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.325.1">dotted</span></span><span class="kobospan" id="kobo.326.1">; this will create sub-dictionaries. </span><span class="kobospan" id="kobo.326.2">Here’s an example of dotted keys:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.327.1">some_app.option_1 = "useful value" 
 
some_app.option_2 = 42 
 
some_app.feature.option_1 = 7331</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.328.1">This looks quite a bit like a properties file often used with Java applications. </span><span class="kobospan" id="kobo.328.2">This creates nested dictionaries by decomposing the keys at the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.329.1">.</span></span></span></span><span class="kobospan" id="kobo.330.1"> character.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.331.1">A wide variety of values are available, including string values, integer values, float values, and Boolean values (using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.332.1">true</span></span></span></span><span class="kobospan" id="kobo.333.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.334.1">false</span></span></span></span><span class="kobospan" id="kobo.335.1"> as the literal values). </span><span class="kobospan" id="kobo.335.2">Additionally, TOML recognizes ISO date-time strings; see </span><a href="https://tools.ietf.org/html/rfc3339" class="url"><span class="kobospan" id="kobo.336.1">RFC 3339</span></a><span class="kobospan" id="kobo.337.1"> for the formats supported.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.338.1">TOML permits two data structures:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.339.1">An array is enclosed in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.340.1">[</span></span></span></span><span class="kobospan" id="kobo.341.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.342.1">]</span></span></span></span><span class="kobospan" id="kobo.343.1">. </span><span class="kobospan" id="kobo.343.2">We can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.344.1">sizes</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.345.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.346.1"> [1,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.347.1"> 2,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.348.1"> 3]</span></span></span></span><span class="kobospan" id="kobo.349.1"> to create a Python </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.350.1">list</span></span></span></span><span class="kobospan" id="kobo.351.1"> value.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.352.1">An in-line table can be created using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.353.1">{</span></span></span></span><span class="kobospan" id="kobo.354.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.355.1">}</span></span></span></span><span class="kobospan" id="kobo.356.1"> around one or more </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.357.1">key</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.358.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.359.1"> value</span></span></span></span><span class="kobospan" id="kobo.360.1"> items. </span><span class="kobospan" id="kobo.360.2">For example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.361.1">sample</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.362.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.363.1"> {x</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.364.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.365.1"> 10,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.366.1"> y</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.367.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.368.1"> 8.4}</span></span></span></span><span class="kobospan" id="kobo.369.1"> creates a nested </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.370.1">dict</span></span></span></span><span class="kobospan" id="kobo.371.1"> value.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.372.1">One of the most important features of TOML syntax is using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.373.1">[table]</span></span></span></span><span class="kobospan" id="kobo.374.1"> as the key for a nested dictionary. </span><span class="kobospan" id="kobo.374.2">We’ll often see this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.375.1">[some_app] 
 
    option_1 = "useful value" 
 
    option_2 = 42 
 
 
 
[some_app.feature] 
 
    option_1 = 7331</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.376.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.377.1">[some_app]</span></span></span></span><span class="kobospan" id="kobo.378.1"> is a key for a dictionary containing the indented key-value pairs. </span><span class="kobospan" id="kobo.378.2">TOML syntax of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.379.1">[some_app.feature]</span></span></span></span><span class="kobospan" id="kobo.380.1"> defines a more deeply nested dictionary. </span><span class="kobospan" id="kobo.380.2">The use of a dotted key means the string </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.381.1">"some_app"</span></span></span></span><span class="kobospan" id="kobo.382.1"> will be a key for a dictionary containing the key </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.383.1">feature</span></span></span></span><span class="kobospan" id="kobo.384.1">. </span><span class="kobospan" id="kobo.384.2">The value associated with this key will be a dictionary with the key </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.385.1">"option_1"</span></span></span></span><span class="kobospan" id="kobo.386.1">. </span><span class="kobospan" id="kobo.386.2">In TOML the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.387.1">[table]</span></span></span></span><span class="kobospan" id="kobo.388.1"> prefix for nested values creates a visual</span><span id="dx1-726014"/><span class="kobospan" id="kobo.389.1"> organization, making it easier</span><span id="dx1-726015"/><span class="kobospan" id="kobo.390.1"> to find and change configuration settings. </span><span id="x1-726016r1557"/></p>
</section>
<section data-number="0.16.2.4" id="theres-more...-92">
<h2 class="likechapterhead" data-number="0.16.2.4"><span><span class="kobospan" id="kobo.391.1">13.2.4 </span></span> <span id="x1-7270004"/><span class="kobospan" id="kobo.392.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.393.1">TOML notation is used for a the overall </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.394.1">pyproject.toml</span></span></span></span><span class="kobospan" id="kobo.395.1"> file that can be used to describe a Python project. </span><span class="kobospan" id="kobo.395.2">This file often has two top-level tables: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.396.1">[project]</span></span></span></span><span class="kobospan" id="kobo.397.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.398.1">[build-system]</span></span></span></span><span class="kobospan" id="kobo.399.1">. </span><span class="kobospan" id="kobo.399.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.400.1">project</span></span></span></span><span class="kobospan" id="kobo.401.1"> table will have some metadata about the [project]. </span><span class="kobospan" id="kobo.401.2">Here’s an example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.402.1">[project] 
 
name = "python_cookbook_3e" 
 
version = "2024.1.0" 
 
description = "All of the code examples for Modern Python Cookbook, 3rd Ed." 
 
readme = "README.rst" 
 
requires-python = "&gt;=3.12" 
 
license = {file = "LICENSE.txt"}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.403.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.404.1">[build-system]</span></span></span></span><span class="kobospan" id="kobo.405.1"> table provides information on tools needed to install the module, package, or application. </span><span class="kobospan" id="kobo.405.2">Here’s an example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.406.1">[build-system] 
 
build-backend = ’setuptools.build_meta’ 
 
requires = [ 
 
    ’setuptools’, 
 
]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.407.1">This file provides a few essential pieces of information about the project. </span><span class="kobospan" id="kobo.407.2">The use of TOML notation makes it relatively easy to read and change. </span><span id="x1-727015r1560"/></p>
</section>
<section data-number="0.16.2.5" id="see-also-99">
<h2 class="likechapterhead" data-number="0.16.2.5"><span><span class="kobospan" id="kobo.408.1">13.2.5 </span></span> <span id="x1-7280005"/><span class="kobospan" id="kobo.409.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.410.1">See the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.411.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.412.1"> recipe earlier in this chapter to see how to search multiple filesystem locations for a configuration file. </span><span class="kobospan" id="kobo.412.2">We can easily have application defaults, system-wide settings, and personal settings built into separate files and combined by an application.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.413.1">For more information on TOML syntax, see </span><a class="url" href="https://toml.io/en/"><span class="url1"><span class="kobospan" id="kobo.414.1">https://toml.io/en/</span></span></a><span class="kobospan" id="kobo.415.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.416.1">For more information on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.417.1">pyproject.toml</span></span></span></span><span class="kobospan" id="kobo.418.1"> file, see the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.419.1">Python</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.420.1">Packaging Authority </span></span><span class="kobospan" id="kobo.421.1">document </span><a class="url" href="https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/"><span class="url1"><span class="kobospan" id="kobo.422.1">https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/</span></span></a><span class="kobospan" id="kobo.423.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-728001r1548"/></p>
</section>
</section>
<section data-number="0.16.3" id="using-python-for-configuration-files">
<h1 class="unnumbered" data-number="0.16.3"><span><span class="kobospan" id="kobo.424.1">13.3 </span></span> <span id="x1-7290003"/><span class="kobospan" id="kobo.425.1">Using Python for configuration files</span></h1>
<p class="normal"><span class="kobospan" id="kobo.426.1">In addition to syntax like TOML</span><span id="dx1-729001"/><span class="kobospan" id="kobo.427.1"> for providing configuration</span><span id="dx1-729002"/><span class="kobospan" id="kobo.428.1"> data, we can also write files in Python notation; it’s elegant and simple. </span><span class="kobospan" id="kobo.428.2">It offers tremendous flexibility, since the configuration file is a Python module. </span><span id="x1-729003r1563"/></p>
<section data-number="0.16.3.1" id="getting-ready-101">
<h2 class="likechapterhead" data-number="0.16.3.1"><span><span class="kobospan" id="kobo.429.1">13.3.1 </span></span> <span id="x1-7300001"/><span class="kobospan" id="kobo.430.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.431.1">Python assignment statements are particularly elegant for creating configuration files. </span><span class="kobospan" id="kobo.431.2">The syntax can be simple, easy to read, and extremely flexible. </span><span class="kobospan" id="kobo.431.3">If we use assignment statements, we can import an application’s configuration details from a separate module. </span><span class="kobospan" id="kobo.431.4">This could have a name like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.432.1">settings.py</span></span></span></span><span class="kobospan" id="kobo.433.1"> to show the module’s focus on configuration parameters.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.434.1">Because Python treats each</span><span id="dx1-730001"/><span class="kobospan" id="kobo.435.1"> imported module as a global </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.436.1">Singleton </span></span><span class="kobospan" id="kobo.437.1">object, we can have several parts of an application all use an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.438.1">import</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.439.1"> settings</span></span></span></span><span class="kobospan" id="kobo.440.1"> statement to get a consistent view of the current, global application configuration parameters. </span><span class="kobospan" id="kobo.440.2">We don’t need to worry about managing</span><span id="dx1-730002"/><span class="kobospan" id="kobo.441.1"> an object using the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.442.1">Singleton </span></span><span class="kobospan" id="kobo.443.1">design pattern, since that’s already part of Python.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.444.1">We’d like to be able to provide definitions in a text file that look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.445.1">"""Weather forecast for Offshore including the Bahamas 
 
""" 
 
 
 
query = {’mz’: 
 
    [’ANZ532’, 
 
     ’AMZ117’, 
 
     ’AMZ080’] 
 
} 
 
 
 
base_url = "https://forecast.weather.gov/shmrn.php"</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.446.1">This configuration is a Python</span><span id="dx1-730014"/><span class="kobospan" id="kobo.447.1"> script. </span><span class="kobospan" id="kobo.447.2">The parameters</span><span id="dx1-730015"/><span class="kobospan" id="kobo.448.1"> include two variables, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.449.1">query</span></span></span></span><span class="kobospan" id="kobo.450.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.451.1">base_url</span></span></span></span><span class="kobospan" id="kobo.452.1">. </span><span class="kobospan" id="kobo.452.2">The value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.453.1">query</span></span></span></span><span class="kobospan" id="kobo.454.1"> variable is a dictionary with a single key, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.455.1">’mz’</span></span></span></span><span class="kobospan" id="kobo.456.1">, and a sequence of values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.457.1">This can be seen as a specification for a number of related URLs that are all similar to </span><a class="url" href="http://forecast.weather.gov/shmrn.php?mz=ANZ532"><span class="url1"><span class="kobospan" id="kobo.458.1">http://forecast.weather.gov/shmrn.php?mz=ANZ532</span></span></a><span class="kobospan" id="kobo.459.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.460.1">We’ll often use the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.461.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.462.1"> recipe to check a variety of locations for a given configuration file. </span><span class="kobospan" id="kobo.462.2">This flexibility is often essential for creating an application that’s easily used on a variety of platforms.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.463.1">In this recipe, we’ll build the missing part of the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.464.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.465.1"> recipe, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.466.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.467.1"> function. </span><span class="kobospan" id="kobo.467.2">Here’s the template that needs to be filled in:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.468.1">def load_config_file_draft(config_path: Path) -&gt; dict[str, Any]: 
 
    """Loads a configuration mapping object with contents 
 
    of a given file. 
 
 
 
    :param config_path: Path to be read. 
 
 
 
    :returns: mapping with configuration parameter values 
 
    """ 
 
    # Details omitted.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.469.1">In this recipe, we’ll fill in the space held by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.470.1">#</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.471.1"> Details</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.472.1"> omitted</span></span></span></span><span class="kobospan" id="kobo.473.1"> line to load configuration files in Python format. </span><span id="x1-730026r1565"/></p>
</section>
<section data-number="0.16.3.2" id="how-to-do-it...-102">
<h2 class="likechapterhead" data-number="0.16.3.2"><span><span class="kobospan" id="kobo.474.1">13.3.2 </span></span> <span id="x1-7310002"/><span class="kobospan" id="kobo.475.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.476.1">We can make use</span><span id="dx1-731001"/><span class="kobospan" id="kobo.477.1"> of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.478.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.479.1"> module</span><span id="dx1-731002"/><span class="kobospan" id="kobo.480.1"> to locate the files. </span><span class="kobospan" id="kobo.480.2">We’ll also leverage the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.481.1">compile()</span></span></span></span><span class="kobospan" id="kobo.482.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.483.1">exec()</span></span></span></span><span class="kobospan" id="kobo.484.1"> functions to process the code in the configuration file:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-731004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.485.1">Import the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.486.1">Path</span></span></span></span><span class="kobospan" id="kobo.487.1"> definition and the type hints required by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.488.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.489.1"> function definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.490.1">from pathlib import Path 
 
from typing import Any</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-731009x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.491.1">Use the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.492.1">compile()</span></span></span></span><span class="kobospan" id="kobo.493.1"> function to compile the Python module into an executable form. </span><span class="kobospan" id="kobo.493.2">This function requires the source text as well as the filename from which the text was read. </span><span class="kobospan" id="kobo.493.3">The filename is essential for creating trace-back messages that are useful and correct:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.494.1">def load_config_file(config_path: Path) -&gt; dict[str, Any]: 
 
    code = compile( 
 
        config_path.read_text(), 
 
        config_path.name, 
 
        "exec")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.495.1">In rare cases where the code doesn’t come from a file, the general practice is to provide a name such as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.496.1">&lt;string&gt;</span></span></span></span><span class="kobospan" id="kobo.497.1"> for the filename.</span></p>
</div></li>
<li class="calibre7"><div id="x1-731017x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.498.1">Execute the code object created by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.499.1">compile()</span></span></span></span><span class="kobospan" id="kobo.500.1"> function. </span><span class="kobospan" id="kobo.500.2">This requires two contexts. </span><span class="kobospan" id="kobo.500.3">The global context provides any previously imported modules, plus the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.501.1">__builtins__</span></span></span></span><span class="kobospan" id="kobo.502.1"> module. </span><span class="kobospan" id="kobo.502.2">The local context is the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.503.1">locals</span></span></span></span><span class="kobospan" id="kobo.504.1"> dictionary; this is where new variables will be created:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.505.1">
    locals: dict[str, Any] = {} 
 
    exec( 
 
        code, 
 
        {"__builtins__": __builtins__}, 
 
        locals 
 
    ) 
 
    return locals</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.506.1">This </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.507.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.508.1"> function produces the required dictionary structure. </span><span class="kobospan" id="kobo.508.2">It can be fit into the design from the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.509.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.510.1"> recipe to load a configuration file using Python syntax. </span><span id="x1-731026r1568"/></p>
</section>
<section data-number="0.16.3.3" id="how-it-works...-102">
<h2 class="likechapterhead" data-number="0.16.3.3"><span><span class="kobospan" id="kobo.511.1">13.3.3 </span></span> <span id="x1-7320003"/><span class="kobospan" id="kobo.512.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.513.1">The details of the Python</span><span id="dx1-732001"/><span class="kobospan" id="kobo.514.1"> language – the syntax</span><span id="dx1-732002"/><span class="kobospan" id="kobo.515.1"> and semantics – are embodied in the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.516.1">compile()</span></span></span></span><span class="kobospan" id="kobo.517.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.518.1">exec()</span></span></span></span><span class="kobospan" id="kobo.519.1"> functions. </span><span class="kobospan" id="kobo.519.2">The three essential steps are these:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-732004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.520.1">Read the text.</span></p>
</div></li>
<li class="calibre7"><div id="x1-732006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.521.1">Compile the text with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.522.1">compile()</span></span></span></span><span class="kobospan" id="kobo.523.1"> function to create a code object.</span></p>
</div></li>
<li class="calibre7"><div id="x1-732008x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.524.1">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.525.1">exec()</span></span></span></span><span class="kobospan" id="kobo.526.1"> function to execute the code object.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.527.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.528.1">exec()</span></span></span></span><span class="kobospan" id="kobo.529.1"> function reflects the way Python handles global and local variables. </span><span class="kobospan" id="kobo.529.2">There are two namespaces (mappings) provided to this function. </span><span class="kobospan" id="kobo.529.3">These are visible via the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.530.1">globals()</span></span></span></span><span class="kobospan" id="kobo.531.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.532.1">locals()</span></span></span></span><span class="kobospan" id="kobo.533.1"> functions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.534.1">We can provide two distinct dictionaries to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.535.1">exec()</span></span></span></span><span class="kobospan" id="kobo.536.1"> function:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.537.1">A dictionary of global objects. </span><span class="kobospan" id="kobo.537.2">The most common use is to provide access to the imported modules, which are always global. </span><span class="kobospan" id="kobo.537.3">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.538.1">__builtins__</span></span></span></span><span class="kobospan" id="kobo.539.1"> module can be provided in this dictionary. </span><span class="kobospan" id="kobo.539.2">In some cases, other modules like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.540.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.541.1"> should be added.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.542.1">A dictionary for the locals that will be created (or updated) by each assignment statement. </span><span class="kobospan" id="kobo.542.2">This local dictionary allows us to capture the variables created when executing the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.543.1">settings</span></span></span></span><span class="kobospan" id="kobo.544.1"> module.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.545.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.546.1">locals</span></span></span></span><span class="kobospan" id="kobo.547.1"> dictionary will be updated by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.548.1">exec()</span></span></span></span><span class="kobospan" id="kobo.549.1"> function. </span><span class="kobospan" id="kobo.549.2">We don’t expect the globals to be updated and will ignore</span><span id="dx1-732009"/><span class="kobospan" id="kobo.550.1"> any changes that happen</span><span id="dx1-732010"/><span class="kobospan" id="kobo.551.1"> to this collection. </span><span id="x1-732011r1572"/></p>
</section>
<section data-number="0.16.3.4" id="theres-more...-93">
<h2 class="likechapterhead" data-number="0.16.3.4"><span><span class="kobospan" id="kobo.552.1">13.3.4 </span></span> <span id="x1-7330004"/><span class="kobospan" id="kobo.553.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.554.1">This recipe suggests a configuration file is entirely a sequence of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.555.1">name</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.556.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.557.1"> value</span></span></span></span><span class="kobospan" id="kobo.558.1"> assignment statements. </span><span class="kobospan" id="kobo.558.2">The assignment statement is in Python syntax, as are the variable names and the literal syntax. </span><span class="kobospan" id="kobo.558.3">This permits the configuration to leverage Python’s large collection of built-in types. </span><span class="kobospan" id="kobo.558.4">Additionally, the full spectrum of Python statements is available. </span><span class="kobospan" id="kobo.558.5">This leads to some engineering trade-offs.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.559.1">Because any statement can be used in the configuration file, it can lead to complexity. </span><span class="kobospan" id="kobo.559.2">If the processing in the configuration file becomes too complex, the file ceases to be configuration and becomes a first-class part of the application. </span><span class="kobospan" id="kobo.559.3">Very complex features should be implemented by modifying the application programming, not hacking around with the configuration settings. </span><span class="kobospan" id="kobo.559.4">Python applications include the full source, as it is generally easier to fix the source than create hyper-complex configuration files. </span><span class="kobospan" id="kobo.559.5">The goal is for a configuration file to provide values to tailor operations, not provide plug-in functionality.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.560.1">We might want to include the OS environment variables as part of the global variables used for configuration. </span><span class="kobospan" id="kobo.560.2">Doing this helps ensure the configuration values match the current environment settings. </span><span class="kobospan" id="kobo.560.3">This can be done with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.561.1">os.environ</span></span></span></span><span class="kobospan" id="kobo.562.1"> mapping.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.563.1">It can also be sensible to do some processing for related settings. </span><span class="kobospan" id="kobo.563.2">For example, it can be helpful to write a configuration file with a number of adjacent paths like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.564.1">"""Config with related paths""" 
 
base = Path(os.environ.get("APP_HOME", "/opt/app")) 
 
log = base / ’log’ 
 
out = base / ’out’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.565.1">In many cases, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.566.1">settings</span></span></span></span><span class="kobospan" id="kobo.567.1"> file is edited by a person who can be trusted. </span><span class="kobospan" id="kobo.567.2">Mistakes do happen, though, and it’s wise to be careful about what functions are available in the dictionary of globals provided to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.568.1">exec()</span></span></span></span><span class="kobospan" id="kobo.569.1"> function. </span><span class="kobospan" id="kobo.569.2">Providing the narrowest set of functions to support configuration is the recommended practice. </span><span id="x1-733006r1573"/></p>
</section>
<section data-number="0.16.3.5" id="see-also-100">
<h2 class="likechapterhead" data-number="0.16.3.5"><span><span class="kobospan" id="kobo.570.1">13.3.5 </span></span> <span id="x1-7340005"/><span class="kobospan" id="kobo.571.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.572.1">See the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.573.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.574.1"> recipe earlier in this chapter to learn how to search multiple filesystem locations for a configuration file.</span></p></li>
</ul>
<p class="normal1"><span id="x1-734001r1564"/></p>
</section>
</section>
<section data-number="0.16.4" id="using-a-class-as-a-namespace-for-configuration">
<h1 class="unnumbered" data-number="0.16.4"><span><span class="kobospan" id="kobo.575.1">13.4 </span></span> <span id="x1-7350004"/><span class="kobospan" id="kobo.576.1">Using a class as a namespace for configuration</span></h1>
<p class="normal"><span class="kobospan" id="kobo.577.1">Python offers a variety</span><span id="dx1-735001"/><span class="kobospan" id="kobo.578.1"> of ways to package application</span><span id="dx1-735002"/><span class="kobospan" id="kobo.579.1"> inputs and configuration files. </span><span class="kobospan" id="kobo.579.2">We’ll continue to look at writing files in Python notation because it’s elegant and the familiar syntax can lead to easy-to-read configuration files. </span><span class="kobospan" id="kobo.579.3">A number of projects allow us to use a class definition to provide configuration parameters. </span><span class="kobospan" id="kobo.579.4">This uses Python syntax, of course. </span><span class="kobospan" id="kobo.579.5">It also uses the class definition as a namespace to allow multiple configurations to be provided in a single module. </span><span class="kobospan" id="kobo.579.6">The use of a class hierarchy means that inheritance techniques can be used to simplify the organization of parameters.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.580.1">This avoids the use of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.581.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.582.1"> to permit user-specific overrides of generic settings. </span><span class="kobospan" id="kobo.582.2">Instead, this uses ordinary inheritance.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.583.1">We’re never going to create instances of these classes. </span><span class="kobospan" id="kobo.583.2">We’re going to use the attributes of the class definition and rely on class inheritance methods to track down the appropriate value for an attribute. </span><span class="kobospan" id="kobo.583.3">This will differ from the other recipes in this chapter because it will produce a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.584.1">ConfigClass</span></span></span></span><span class="kobospan" id="kobo.585.1"> object, instead of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.586.1">dict[str,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.587.1"> Any]</span></span></span></span><span class="kobospan" id="kobo.588.1"> object.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.589.1">In this recipe, we’ll look at how we can represent configuration details in Python class notation. </span><span id="x1-735003r1575"/></p>
<section data-number="0.16.4.1" id="getting-ready-102">
<h2 class="likechapterhead" data-number="0.16.4.1"><span><span class="kobospan" id="kobo.590.1">13.4.1 </span></span> <span id="x1-7360001"/><span class="kobospan" id="kobo.591.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.592.1">Python notation for defining the attributes of a class can be simple, easy to read, and reasonably flexible. </span><span class="kobospan" id="kobo.592.2">We can, with a little work, define a sophisticated configuration language that allows someone to change configuration parameters for a Python application quickly and reliably.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.593.1">We can base this language on class definitions. </span><span class="kobospan" id="kobo.593.2">This allows us to package a number of configuration alternatives in a single module. </span><span class="kobospan" id="kobo.593.3">An application can load the module and pick the relevant class definition from the module.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.594.1">We’d like to be able to provide definitions that look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.595.1">class Configuration: 
 
    """ 
 
    Generic Configuration with a sample query. 
 
    """ 
 
    base = "https://forecast.weather.gov/shmrn.php" 
 
    query = {"mz": ["GMZ856"]}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.596.1">We can create this class definition in a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.597.1">settings.py</span></span></span></span><span class="kobospan" id="kobo.598.1"> file to create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.599.1">settings</span></span></span></span><span class="kobospan" id="kobo.600.1"> module. </span><span class="kobospan" id="kobo.600.2">To use the configuration, the main application could do this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.601.1">&gt;&gt;&gt; from settings import Configuration 
 
&gt;&gt;&gt; Configuration.base 
 
’https://forecast.weather.gov/shmrn.php’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.602.1">The application will gather the settings using the module name of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.603.1">settings</span></span></span></span><span class="kobospan" id="kobo.604.1"> with a class name of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.605.1">Configuration</span></span></span></span><span class="kobospan" id="kobo.606.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.607.1">The configuration file locations</span><span id="dx1-736012"/><span class="kobospan" id="kobo.608.1"> follow Python’s rules</span><span id="dx1-736013"/><span class="kobospan" id="kobo.609.1"> for finding modules. </span><span class="kobospan" id="kobo.609.2">Rather than implementing our own search for the configuration, we can leverage Python’s built-in search of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.610.1">sys.path</span></span></span></span><span class="kobospan" id="kobo.611.1">, and the use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.612.1">PYTHONPATH</span></span></span></span><span class="kobospan" id="kobo.613.1"> environment variable.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.614.1">In this recipe, we’ll build a missing part that’s similar to the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.615.1">Finding</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.616.1">configuration files</span></span></a><span class="kobospan" id="kobo.617.1"> recipe, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.618.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.619.1"> function. </span><span class="kobospan" id="kobo.619.2">However, there will be an important difference: we’ll return an object instead of a dictionary. </span><span class="kobospan" id="kobo.619.3">We can then refer to configuration values by attribute name instead of using the more cumbersome notation of a dictionary. </span><span class="kobospan" id="kobo.619.4">Here’s the revised template that needs to be filled in:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.620.1">ConfigClass = type[object] 
 
 
 
def load_config_file_draft( 
 
    config_path: Path, classname: str = "Configuration" 
 
) -&gt; ConfigClass: 
 
    """Loads a configuration mapping object with contents 
 
    of a given file. 
 
 
 
    :param config_path: Path to be read. 
 
 
 
    :returns: mapping with configuration parameter values 
 
    """ 
 
    # Details omitted.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.621.1">We’ve used a similar template</span><span id="dx1-736028"/><span class="kobospan" id="kobo.622.1"> in a number of recipes</span><span id="dx1-736029"/><span class="kobospan" id="kobo.623.1"> in this chapter. </span><span class="kobospan" id="kobo.623.2">For this recipe, we’ve added a parameter to this definition and changed the return type. </span><span class="kobospan" id="kobo.623.3">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.624.1">classname</span></span></span></span><span class="kobospan" id="kobo.625.1"> parameter is not present in previous recipes, but it is used here to select one of the classes from a module at the location in the filesystem named by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.626.1">config_path</span></span></span></span><span class="kobospan" id="kobo.627.1"> parameter. </span><span id="x1-736030r1577"/></p>
</section>
<section data-number="0.16.4.2" id="how-to-do-it...-103">
<h2 class="likechapterhead" data-number="0.16.4.2"><span><span class="kobospan" id="kobo.628.1">13.4.2 </span></span> <span id="x1-7370002"/><span class="kobospan" id="kobo.629.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.630.1">We can make use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.631.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.632.1"> module to locate the files. </span><span class="kobospan" id="kobo.632.2">We’ll leverage the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.633.1">compile()</span></span></span></span><span class="kobospan" id="kobo.634.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.635.1">exec()</span></span></span></span><span class="kobospan" id="kobo.636.1"> functions to process the code in the configuration file:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-737002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.637.1">Import the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.638.1">Path</span></span></span></span><span class="kobospan" id="kobo.639.1"> definition and the type hints required by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.640.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.641.1"> function definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.642.1">from pathlib import Path 
 
import platform                                                                

                                                                     
     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-737007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.643.1">Use the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.644.1">compile()</span></span></span></span><span class="kobospan" id="kobo.645.1"> function to compile the Python module into an executable form. </span><span class="kobospan" id="kobo.645.2">This function requires the source text as well as a filename from which the text was read. </span><span class="kobospan" id="kobo.645.3">The filename is essential for creating trace-back messages that are useful and correct:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.646.1">def load_config_file( 
 
    config_path: Path, classname: str = "Configuration" 
 
) -&gt; ConfigClass: 
 
    code = compile( 
 
        config_path.read_text(), 
 
        config_path.name, 
 
        "exec")</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-737017x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.647.1">Execute the code object created by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.648.1">compile()</span></span></span></span><span class="kobospan" id="kobo.649.1"> method. </span><span class="kobospan" id="kobo.649.2">We need to provide two contexts. </span><span class="kobospan" id="kobo.649.3">The global context can provide the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.650.1">__builtins__</span></span></span></span><span class="kobospan" id="kobo.651.1"> module, plus the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.652.1">Path</span></span></span></span><span class="kobospan" id="kobo.653.1"> class and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.654.1">platform</span></span></span></span><span class="kobospan" id="kobo.655.1"> module. </span><span class="kobospan" id="kobo.655.2">The local context is where new variables will be created:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.656.1">
    globals = { 
 
        "__builtins__": __builtins__, 
 
        "Path": Path, 
 
        "platform": platform} 
 
    locals: dict[str, ConfigClass] = {} 
 
    exec(code, globals, locals) 
 
    return locals[classname]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.657.1">This locates the named class in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.658.1">locals()</span></span></span></span><span class="kobospan" id="kobo.659.1"> mapping and returns the class as the configuration object. </span><span class="kobospan" id="kobo.659.2">This does not return a dictionary.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.660.1">This variation on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.661.1">load_config_file()</span></span></span></span><span class="kobospan" id="kobo.662.1"> function</span><span id="dx1-737026"/><span class="kobospan" id="kobo.663.1"> produces a useful structure</span><span id="dx1-737027"/><span class="kobospan" id="kobo.664.1"> that can be accessed using attribute names. </span><span class="kobospan" id="kobo.664.2">It does not provide the design expected by the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.665.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.666.1"> recipe. </span><span class="kobospan" id="kobo.666.2">The resulting configuration object does – because it uses attribute names – more useful than a simple dictionary. </span><span id="x1-737028r1581"/></p>
</section>
<section data-number="0.16.4.3" id="how-it-works...-103">
<h2 class="likechapterhead" data-number="0.16.4.3"><span><span class="kobospan" id="kobo.667.1">13.4.3 </span></span> <span id="x1-7380003"/><span class="kobospan" id="kobo.668.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.669.1">We can load a Python module by using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.670.1">compile()</span></span></span></span><span class="kobospan" id="kobo.671.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.672.1">exec()</span></span></span></span><span class="kobospan" id="kobo.673.1">. </span><span class="kobospan" id="kobo.673.2">From the module, we can extract an individual class name that contains the various application settings. </span><span class="kobospan" id="kobo.673.3">Overall, it looks like the following example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.674.1">&gt;&gt;&gt; configuration = load_config_file( 
 
... </span><span class="kobospan" id="kobo.674.2">Path(’src/ch13/settings.py’), ’Chesapeake’) 
 
 
 
&gt;&gt;&gt; configuration.__doc__.strip() 
 
’Weather for Chesapeake Bay’ 
 
&gt;&gt;&gt; configuration.query 
 
{’mz’: [’ANZ532’]} 
 
&gt;&gt;&gt; configuration.base 
 
’https://forecast.weather.gov/shmrn.php’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.675.1">We can put any kind of object into the attributes of the configuration class. </span><span class="kobospan" id="kobo.675.2">Our example showed lists of strings and strings. </span><span class="kobospan" id="kobo.675.3">Any object of any class becomes a possibility when using class definitions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.676.1">We can have complex calculations within the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.677.1">class</span></span></span></span><span class="kobospan" id="kobo.678.1"> statement. </span><span class="kobospan" id="kobo.678.2">We can use this to create attributes that are derived from other attributes. </span><span class="kobospan" id="kobo.678.3">We can execute any kind of statement, including </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.679.1">if</span></span></span></span><span class="kobospan" id="kobo.680.1"> statements and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.681.1">for</span></span></span></span><span class="kobospan" id="kobo.682.1"> statements, to create attribute values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.683.1">We will not, however, create an instance of the given class. </span><span class="kobospan" id="kobo.683.2">Tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.684.1">Pydantic </span></span><span class="kobospan" id="kobo.685.1">will validate instances</span><span id="dx1-738011"/><span class="kobospan" id="kobo.686.1"> of a class, but aren’t helpful for validating a class definition. </span><span class="kobospan" id="kobo.686.2">Any kind of validation rules would have to be defined in a metaclass that is used to build the resulting configuration class. </span><span class="kobospan" id="kobo.686.3">Additionally, ordinary methods of the class will not be used. </span><span class="kobospan" id="kobo.686.4">If a function-like definition is needed, it would</span><span id="dx1-738012"/><span class="kobospan" id="kobo.687.1"> have to be decorated</span><span id="dx1-738013"/><span class="kobospan" id="kobo.688.1"> with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.689.1">@classmethod</span></span></span></span><span class="kobospan" id="kobo.690.1"> to be useful. </span><span id="x1-738014r1585"/></p>
</section>
<section data-number="0.16.4.4" id="theres-more...-94">
<h2 class="likechapterhead" data-number="0.16.4.4"><span><span class="kobospan" id="kobo.691.1">13.4.4 </span></span> <span id="x1-7390004"/><span class="kobospan" id="kobo.692.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.693.1">Using a class definition</span><span id="dx1-739001"/><span class="kobospan" id="kobo.694.1"> means that we will leverage inheritance to organize the configuration values. </span><span class="kobospan" id="kobo.694.2">We can easily create multiple subclasses of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.695.1">Configuration</span></span></span></span><span class="kobospan" id="kobo.696.1">, one of which will be selected for use in the application.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.697.1">The configuration might look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.698.1">class Configuration: 
 
    """ 
 
    Generic Configuration with a sample query. 
 
    """ 
 
    base = "https://forecast.weather.gov/shmrn.php" 
 
    query = {"mz": ["GMZ856"]} 
 
 
 
 
 
class Bahamas(Configuration): 
 
    """ 
 
    Weather forecast for Offshore including the Bahamas 
 
    """ 
 
    query = {"mz": ["AMZ117", "AMZ080"]} 
 
 
 
 
 
class Chesapeake(Configuration): 
 
    """ 
 
    Weather for Chesapeake Bay 
 
    """ 
 
    query = {"mz": ["ANZ532"]}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.699.1">Our application must choose an appropriate class</span><span id="dx1-739023"/><span class="kobospan" id="kobo.700.1"> from the available classes in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.701.1">settings</span></span></span></span><span class="kobospan" id="kobo.702.1"> module. </span><span class="kobospan" id="kobo.702.2">We might use an OS environment variable or a command-line option to specify the class name to use. </span><span class="kobospan" id="kobo.702.3">The idea is that our program can be executed like this:</span></p>
<pre class="programlisting" id="listing-83"><code class="calibre13"><span class="kobospan" id="kobo.703.1">(cookbook3) % python3 some_app.py -c settings.Chesapeake</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.704.1">This would locate the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.705.1">Chesapeake</span></span></span></span><span class="kobospan" id="kobo.706.1"> class in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.707.1">settings</span></span></span></span><span class="kobospan" id="kobo.708.1"> module. </span><span class="kobospan" id="kobo.708.2">Processing would then be based on the details in that particular configuration class. </span><span class="kobospan" id="kobo.708.3">This idea leads to an extension to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.709.1">load_config_class()</span></span></span></span><span class="kobospan" id="kobo.710.1"> function.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.711.1">In order to pick one of the available classes, we can separate the module name and class name by looking for a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.712.1">"."</span></span></span></span><span class="kobospan" id="kobo.713.1"> separator in the command-line argument value:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.714.1">import importlib 
 
 
 
def load_config_class(name: str) -&gt; ConfigClass: 
 
    module_name, _, class_name = name.rpartition(".") 
 
    settings_module = importlib.import_module(module_name) 
 
    result: ConfigClass = vars(settings_module)[class_name] 
 
    return result</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.715.1">Rather than manually compiling and executing the module, we’ve used the higher-level </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.716.1">importlib</span></span></span></span><span class="kobospan" id="kobo.717.1"> module. </span><span class="kobospan" id="kobo.717.2">This module contains functions implementing the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.718.1">import</span></span></span></span><span class="kobospan" id="kobo.719.1"> statement semantics. </span><span class="kobospan" id="kobo.719.2">The requested module is imported, then compiled and executed, and the resulting module object is assigned to the variable named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.720.1">result</span></span></span></span><span class="kobospan" id="kobo.721.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.722.1">Now we can use this function as follows:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.723.1">&gt;&gt;&gt; configuration = load_config_class( 
 
... </span><span class="kobospan" id="kobo.723.2">’settings.Chesapeake’) 
 
 
 
&gt;&gt;&gt; configuration.__doc__.strip() 
 
’Weather for Chesapeake Bay’ 
 
&gt;&gt;&gt; configuration.query 
 
{’mz’: [’ANZ532’]} 
 
&gt;&gt;&gt; configuration.base 
 
’https://forecast.weather.gov/shmrn.php’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.724.1">We’ve located the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.725.1">Chesapeake</span></span></span></span><span class="kobospan" id="kobo.726.1"> configuration class in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.727.1">settings</span></span></span></span><span class="kobospan" id="kobo.728.1"> module and extracted the various settings the application needs from this class. </span><span id="x1-739043r1587"/></p>
</section>
<section data-number="0.16.4.5" id="see-also-101">
<h2 class="likechapterhead" data-number="0.16.4.5"><span><span class="kobospan" id="kobo.729.1">13.4.5 </span></span> <span id="x1-7400005"/><span class="kobospan" id="kobo.730.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.731.1">We’ll look at class definitions in detail in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.732.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.733.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.734.1">7</span></span></a><span class="kobospan" id="kobo.735.1">, and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.736.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.737.1"> </span></span><a href="ch012.xhtml#x1-4520008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.738.1">8</span></span></a><span class="kobospan" id="kobo.739.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.740.1">See the </span><a href="ch017.xhtml#x1-7160001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.741.1">Finding configuration files</span></span></a><span class="kobospan" id="kobo.742.1"> recipe in this chapter for an alternative approach that doesn’t use class definitions.</span></p></li>
</ul>
<p class="normal1"><span id="x1-740001r1576"/></p>
</section>
</section>
<section data-number="0.16.5" id="designing-scripts-for-composition">
<h1 class="unnumbered" data-number="0.16.5"><span><span class="kobospan" id="kobo.743.1">13.5 </span></span> <span id="x1-7410005"/><span class="kobospan" id="kobo.744.1">Designing scripts for composition</span></h1>
<p class="normal"><span class="kobospan" id="kobo.745.1">An important part of overall application</span><span id="dx1-741001"/><span class="kobospan" id="kobo.746.1"> design is creating</span><span id="dx1-741002"/><span class="kobospan" id="kobo.747.1"> a script that can process command-line arguments and configuration files. </span><span class="kobospan" id="kobo.747.2">Further, it’s very important to design a script so that it can be tested as well as combined with other scripts into a composite application.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.748.1">The idea is that many good ideas evolve through a series of stages. </span><span class="kobospan" id="kobo.748.2">One such evolution might be the following path:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-741004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.749.1">The idea starts as a collection of separate notebooks for separate parts of a larger task.</span></p>
</div></li>
<li class="calibre7"><div id="x1-741006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.750.1">After the initial period of exploration and experimentation, this becomes a simple repetitive task. </span><span class="kobospan" id="kobo.750.2">Rather than open and click manually to run the notebook, it’s saved into a script file, Then the script files can be run from the command line.</span></p>
</div></li>
<li class="calibre7"><div id="x1-741008x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.751.1">After an initial period of making this a regular part of the organization’s operations, the three-part script needs to be consolidated into a single script. </span><span class="kobospan" id="kobo.751.2">At this point, refactoring is needed.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.752.1">The most painful time to refactor is </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.753.1">after </span></span><span class="kobospan" id="kobo.754.1">combining a number of scripts into a single application and uncovering unexpected problems. </span><span class="kobospan" id="kobo.754.2">This often happens because global variables will be shared when multiple scripts are integrated.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.755.1">A much less painful time is earlier</span><span id="dx1-741009"/><span class="kobospan" id="kobo.756.1"> in the life of the project. </span><span class="kobospan" id="kobo.756.2">As soon</span><span id="dx1-741010"/><span class="kobospan" id="kobo.757.1"> as a script is created, some effort should be made to design the script for testing and composition into a larger application. </span><span id="x1-741011r1591"/></p>
<section data-number="0.16.5.1" id="getting-ready-103">
<h2 class="likechapterhead" data-number="0.16.5.1"><span><span class="kobospan" id="kobo.758.1">13.5.1 </span></span> <span id="x1-7420001"/><span class="kobospan" id="kobo.759.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.760.1">In this recipe, we’ll look at what constitutes a good design for a script. </span><span class="kobospan" id="kobo.760.2">In particular, we want to be sure that parameters and configuration files are considered in the design.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.761.1">The target is to have a structure like the following:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.762.1">A docstring for the module or script as a whole.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.763.1">The imports. </span><span class="kobospan" id="kobo.763.2">There’s an internal ordering to these. </span><span class="kobospan" id="kobo.763.3">Tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.764.1">isort</span></span><span class="kobospan" id="kobo.765.1"> and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.766.1">ruff </span></span><span class="kobospan" id="kobo.767.1">can handle this.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.768.1">The class and function definitions that apply to the script.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.769.1">A function to gather the configuration file options and runtime parameters into a single object that can be used by other classes and functions.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.770.1">A single function that does the useful work. </span><span class="kobospan" id="kobo.770.2">This is often called </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.771.1">main()</span></span></span></span><span class="kobospan" id="kobo.772.1">, but there’s nothing sacred about this name.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.773.1">A small block of code that is executed </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.774.1">only </span></span><span class="kobospan" id="kobo.775.1">when the module is run as a script, and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.776.1">never </span></span><span class="kobospan" id="kobo.777.1">when the module is imported:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.778.1">
if __name__ == "__main__": 
 
    main()</span></code></pre></li>
</ul>
<p class="normal1"><span id="x1-742004r1593"/></p>
</section>
<section data-number="0.16.5.2" id="how-to-do-it...-104">
<h2 class="likechapterhead" data-number="0.16.5.2"><span><span class="kobospan" id="kobo.779.1">13.5.2 </span></span> <span id="x1-7430002"/><span class="kobospan" id="kobo.780.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.781.1">With the target design</span><span id="dx1-743001"/><span class="kobospan" id="kobo.782.1"> as our goal, here is one</span><span id="dx1-743002"/><span class="kobospan" id="kobo.783.1"> approach:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-743004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.784.1">Start by writing a summary docstring at the top of the file. </span><span class="kobospan" id="kobo.784.2">It’s important to start with something and add details later. </span><span class="kobospan" id="kobo.784.3">Here’s an example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.785.1">
""" 
 
    Some Script. 
 
    What it does. </span><span class="kobospan" id="kobo.785.2">How it works. 
 
    Who uses it. </span><span class="kobospan" id="kobo.785.3">When do they use it. 
 
"""</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-743012x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.786.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.787.1">import</span></span></span></span><span class="kobospan" id="kobo.788.1"> statements go after the docstring. </span><span class="kobospan" id="kobo.788.2">It’s not always possible to foresee all of the imports in advance. </span><span class="kobospan" id="kobo.788.3">As the module is being written and modified, imports will be added and removed.</span></p>
</div></li>
<li class="calibre7"><div id="x1-743014x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.789.1">The class and function definitions go next. </span><span class="kobospan" id="kobo.789.2">The order is important for resolving the type names in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.790.1">def</span></span></span></span><span class="kobospan" id="kobo.791.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.792.1">class</span></span></span></span><span class="kobospan" id="kobo.793.1"> statements. </span><span class="kobospan" id="kobo.793.2">This means the most fundamental type definitions must go first.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.794.1">Again, it’s not always possible to write all the definitions in their proper order during the first wave of design. </span><span class="kobospan" id="kobo.794.2">What’s important is keeping them together in a logical organization and rearranging them so the order makes sense to someone reading the code.</span></p>
</div></li>
<li class="calibre7"><div id="x1-743016x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.795.1">Write a function (with a name like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.796.1">get_config()</span></span></span></span><span class="kobospan" id="kobo.797.1">) to get all of the configuration parameters. </span><span class="kobospan" id="kobo.797.2">Generally, there are two parts to this; sometimes they need to be decomposed into two separate functions because each part can be rather complicated.</span></p>
</div></li>
<li class="calibre7"><div id="x1-743018x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.798.1">Then we have the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.799.1">main()</span></span></span></span><span class="kobospan" id="kobo.800.1"> function. </span><span class="kobospan" id="kobo.800.2">This does the essential work of the script. </span><span class="kobospan" id="kobo.800.3">When evolving from a notebook, this can be built from the sequence of cells.</span></p>
</div></li>
<li class="calibre7"><div id="x1-743020x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.801.1">Add the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.802.1">Main-Import Switch </span></span><span class="kobospan" id="kobo.803.1">code block at the end:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.804.1">if __name__ == "__main__": 
 
    main()</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.805.1">The resulting module will work properly as a script. </span><span class="kobospan" id="kobo.805.2">It can also be tested more easily because</span><span id="dx1-743024"/><span class="kobospan" id="kobo.806.1"> testing tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.807.1">pytest </span></span><span class="kobospan" id="kobo.808.1">can import the module without it making changes to the filesystem when it tries to starting processing data. </span><span class="kobospan" id="kobo.808.2">It can be integrated with other scripts to create a useful composite application. </span><span id="x1-743025r1595"/></p>
</section>
<section data-number="0.16.5.3" id="how-it-works...-104">
<h2 class="likechapterhead" data-number="0.16.5.3"><span><span class="kobospan" id="kobo.809.1">13.5.3 </span></span> <span id="x1-7440003"/><span class="kobospan" id="kobo.810.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.811.1">The core consideration in designing</span><span id="dx1-744001"/><span class="kobospan" id="kobo.812.1"> a script is distinguishing</span><span id="dx1-744002"/><span class="kobospan" id="kobo.813.1"> between two use cases for a module:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.814.1">When run from the command line. </span><span class="kobospan" id="kobo.814.2">In this case, the built-in global variable </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.815.1">__name__</span></span></span></span><span class="kobospan" id="kobo.816.1"> will have a value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.817.1">"__main__"</span></span></span></span><span class="kobospan" id="kobo.818.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.819.1">When imported for testing or as part of a larger, composite application. </span><span class="kobospan" id="kobo.819.2">In this case, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.820.1">__name__</span></span></span></span><span class="kobospan" id="kobo.821.1"> will have a value that is the name of the module.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.822.1">When a module is imported, we do not want it to start doing work. </span><span class="kobospan" id="kobo.822.2">During import, we don’t want the module to open files, read data, do computations, or produce output. </span><span class="kobospan" id="kobo.822.3">All of this work is something that can only happen when the module is run as the main program.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.823.1">The original cells of the notebook or script statements are now part of the body of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.824.1">main()</span></span></span></span><span class="kobospan" id="kobo.825.1"> function, so the script will work properly. </span><span class="kobospan" id="kobo.825.2">It will, however, it will also be in a form that can be tested. </span><span class="kobospan" id="kobo.825.3">It can also be integrated into a larger and more sophisticated application. </span><span id="x1-744003r1598"/></p>
</section>
<section data-number="0.16.5.4" id="theres-more...-95">
<h2 class="likechapterhead" data-number="0.16.5.4"><span><span class="kobospan" id="kobo.826.1">13.5.4 </span></span> <span id="x1-7450004"/><span class="kobospan" id="kobo.827.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.828.1">When starting the conversion to an application, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.829.1">main()</span></span></span></span><span class="kobospan" id="kobo.830.1"> function is often quite lengthy. </span><span class="kobospan" id="kobo.830.2">There are two ways to make the processing clear:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.831.1">Large, prominent </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.832.1">billboard </span></span><span class="kobospan" id="kobo.833.1">comments</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.834.1">Refactoring to create a number of smaller functions</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.835.1">We might start with a script that has comments like these:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.836.1"># # Some complicated process 
 
# 
 
# Some additional markdown details. 
 
 
 
# In[12]: 
 
 
 
print("Some useful code here") 
 
 
 
# In[21]: 
 
 
 
print("More code here")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.837.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.838.1">In[n]:</span></span></span></span><span class="kobospan" id="kobo.839.1"> comments are provided by JupyterLab to identify the cells in a notebook. </span><span class="kobospan" id="kobo.839.2">We can create billboard</span><span id="dx1-745013"/><span class="kobospan" id="kobo.840.1"> comments like these:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.841.1">#################################### 
 
# Some complicated process         # 
 
#                                  # 
 
# Some additional markdown details.# 
 
#################################### 
 
 
 
print("Some useful code here") 
 
 
 
#################################### 
 
# Another step in the process      # 
 
#################################### 
 
 
 
print("More code here")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.842.1">This is less than ideal. </span><span class="kobospan" id="kobo.842.2">It’s an acceptable temporary measure, but these steps should be proper functions, each with a docstring and test cases. </span><span class="kobospan" id="kobo.842.3">Billboard comments are traditional in languages that don’t have proper docstrings and lack documentation generators that exploit the docstrings.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.843.1">Python has docstrings</span><span id="dx1-745028"/><span class="kobospan" id="kobo.844.1"> and several tools – like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.845.1">Sphinx </span></span><span class="kobospan" id="kobo.846.1">– to create documentation from the docstrings. </span><span id="x1-745029r1599"/></p>
</section>
<section data-number="0.16.5.5" id="see-also-102">
<h2 class="likechapterhead" data-number="0.16.5.5"><span><span class="kobospan" id="kobo.847.1">13.5.5 </span></span> <span id="x1-7460005"/><span class="kobospan" id="kobo.848.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.849.1">See the </span><a href="ch010.xhtml#x1-3490004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.850.1">Using argparse to get command-line input</span></span></a><span class="kobospan" id="kobo.851.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.852.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.853.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.854.1">6</span></span></a><span class="kobospan" id="kobo.855.1">, for background on using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.856.1">argparse</span></span></span></span><span class="kobospan" id="kobo.857.1"> to get inputs from a user.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.858.1">See </span><a href="ch017.xhtml#x1-7230002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.859.1">Using TOML for configuration files</span></span></a><span class="kobospan" id="kobo.860.1">, </span><a href="ch017.xhtml#x1-7290003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.861.1">Using Python for</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.862.1">configuration files</span></span></a><span class="kobospan" id="kobo.863.1">, and </span><a href="ch017.xhtml#x1-7350004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.864.1">Using a class as a namespace for configuration</span></span></a><span class="kobospan" id="kobo.865.1"> in this chapter for recipes related to configuration files.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.866.1">The </span><a href="ch017.xhtml#x1-7470006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.867.1">Using logging for control and audit output</span></span></a><span class="kobospan" id="kobo.868.1"> recipe later in this chapter looks at logging.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.869.1">In the </span><a href="ch018.xhtml#x1-7590001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.870.1">Combining two applications into one</span></span></a><span class="kobospan" id="kobo.871.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.872.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.873.1"> </span></span><a href="ch018.xhtml#x1-75800014" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.874.1">14</span></span></a><span class="kobospan" id="kobo.875.1">, we’ll look at ways to combine applications that follow this design pattern.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.876.1">The details of testing and integration are covered in separate chapters. </span><span class="kobospan" id="kobo.876.2">See </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.877.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.878.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.879.1">15</span></span></a><span class="kobospan" id="kobo.880.1"> for details on creating tests. </span><span class="kobospan" id="kobo.880.2">See </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.881.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.882.1"> </span></span><a href="ch018.xhtml#x1-75800014" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.883.1">14</span></span></a><span class="kobospan" id="kobo.884.1"> for details on combining applications.</span></p></li>
</ul>
<p class="normal1"><span id="x1-746001r1592"/></p>
</section>
</section>
<section data-number="0.16.6" id="using-logging-for-control-and-audit-output">
<h1 class="unnumbered" data-number="0.16.6"><span><span class="kobospan" id="kobo.885.1">13.6 </span></span> <span id="x1-7470006"/><span class="kobospan" id="kobo.886.1">Using logging for control and audit output</span></h1>
<p class="normal"><span class="kobospan" id="kobo.887.1">When we consider</span><span id="dx1-747001"/><span class="kobospan" id="kobo.888.1"> an application, we can decompose</span><span id="dx1-747002"/><span class="kobospan" id="kobo.889.1"> the overall computation into three distinct aspects:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.890.1">Gathering input</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.891.1">The essential processing that transforms the input into the output</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.892.1">Producing output</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.893.1">There are several different kinds of output that applications produce:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.894.1">The main output that helps a user make a decision or take action. </span><span class="kobospan" id="kobo.894.2">In some cases, this might be a JSON-formatted document downloaded by a web server. </span><span class="kobospan" id="kobo.894.3">It might be a more complicated collection of documents that – together – will create a PDF file.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.895.1">Control information that confirms that the program worked completely and correctly.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.896.1">Audit summaries that can be used to track the history of state changes in a persistent databases.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.897.1">Any error messages that indicate why the application didn’t work.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.898.1">It’s less than optimal to lump all of these various aspects into </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.899.1">print()</span></span></span></span><span class="kobospan" id="kobo.900.1"> requests that write to standard output. </span><span class="kobospan" id="kobo.900.2">Indeed, it can lead to confusion because too many different outputs can be interleaved in a single stream.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.901.1">The OS provides each running</span><span id="dx1-747003"/><span class="kobospan" id="kobo.902.1"> process with two output</span><span id="dx1-747004"/><span class="kobospan" id="kobo.903.1"> files, standard output and standard error. </span><span class="kobospan" id="kobo.903.2">These are visible in Python through the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.904.1">sys</span></span></span></span><span class="kobospan" id="kobo.905.1"> module with the names </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.906.1">sys.stdout</span></span></span></span><span class="kobospan" id="kobo.907.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.908.1">sys.stderr</span></span></span></span><span class="kobospan" id="kobo.909.1">. </span><span class="kobospan" id="kobo.909.2">By default, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.910.1">print()</span></span></span></span><span class="kobospan" id="kobo.911.1"> function writes to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.912.1">sys.stdout</span></span></span></span><span class="kobospan" id="kobo.913.1"> file. </span><span class="kobospan" id="kobo.913.2">We can change the target file and write the control, audit, and error messages to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.914.1">sys.stderr</span></span></span></span><span class="kobospan" id="kobo.915.1">. </span><span class="kobospan" id="kobo.915.2">This is an important step in the right direction.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.916.1">Python also offers the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.917.1">logging</span></span></span></span><span class="kobospan" id="kobo.918.1"> package, which can be used to direct the ancillary output to a separate file (and/or other output channels, such as a database). </span><span class="kobospan" id="kobo.918.2">It can also be used to format and filter that additional output.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.919.1">In this recipe, we’ll look at good ways to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.920.1">logging</span></span></span></span><span class="kobospan" id="kobo.921.1"> module. </span><span id="x1-747005r1602"/></p>
<section data-number="0.16.6.1" id="getting-ready-104">
<h2 class="likechapterhead" data-number="0.16.6.1"><span><span class="kobospan" id="kobo.922.1">13.6.1 </span></span> <span id="x1-7480001"/><span class="kobospan" id="kobo.923.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.924.1">One approach to meeting a variety of output needs is to create multiple loggers, each with a different intent. </span><span class="kobospan" id="kobo.924.2">It’s common to name loggers around the module or class associated with the logger. </span><span class="kobospan" id="kobo.924.3">We can also name loggers around an overall purpose, like audit or control.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.925.1">The names of loggers form a hierarchy, punctuated by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.926.1">.</span></span></span></span><span class="kobospan" id="kobo.927.1">. </span><span class="kobospan" id="kobo.927.2">The </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.928.1">root </span></span><span class="kobospan" id="kobo.929.1">logger is the parent of all loggers and has a name of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.930.1">""</span></span></span></span><span class="kobospan" id="kobo.931.1">. </span><span class="kobospan" id="kobo.931.2">This suggests that we can have families of loggers focused on particular classes, modules, or features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.932.1">A set of top-level loggers can include a number of separate focus areas, including:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.933.1">error</span></span></span></span><span class="kobospan" id="kobo.934.1"> will preface all loggers for warnings and errors.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.935.1">debug</span></span></span></span><span class="kobospan" id="kobo.936.1"> will preface all loggers for debugging messages.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.937.1">audit</span></span></span></span><span class="kobospan" id="kobo.938.1"> will name loggers with counts and totals used to confirm that data was processed fully.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.939.1">control</span></span></span></span><span class="kobospan" id="kobo.940.1"> will name loggers that provide information about when the application was run, the environment, configuration files, and command-line argument values.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.941.1">In most cases, it is helpful to have errors and debugging in a single logger. </span><span class="kobospan" id="kobo.941.2">In other cases – for example, a web server – the request error response log should be separate from any internal error or debugging log.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.942.1">A complicated application</span><span id="dx1-748001"/><span class="kobospan" id="kobo.943.1"> might have several loggers</span><span id="dx1-748002"/><span class="kobospan" id="kobo.944.1"> with names like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.945.1">audit.input</span></span></span></span><span class="kobospan" id="kobo.946.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.947.1">audit.output</span></span></span></span><span class="kobospan" id="kobo.948.1"> to show the counts of data consumed and the counts of data produced. </span><span class="kobospan" id="kobo.948.2">Keeping these separate can help focus attention on problems with data providers.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.949.1">A severity level serves as a kind of filter for each logger. </span><span class="kobospan" id="kobo.949.2">The severity levels defined in the logging package include the following:</span></p>
<p class="normal1"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.950.1">DEBUG</span></span><span class="kobospan" id="kobo.951.1">: These messages are not generally</span><span id="dx1-748003"/><span class="kobospan" id="kobo.952.1"> shown since their intent is to support debugging. </span><span class="kobospan" id="kobo.952.2">Above, we suggested this is a distinct variety of debugging. </span><span class="kobospan" id="kobo.952.3">We suggest an application create a logging debugger, and use ordinary </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.953.1">INFO </span></span><span class="kobospan" id="kobo.954.1">messages for the debugging entries.</span></p>
<p class="normal1"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.955.1">INFO</span></span><span class="kobospan" id="kobo.956.1">: These messages provide</span><span id="dx1-748004"/><span class="kobospan" id="kobo.957.1"> information on the normal, happy-path processing.</span></p>
<p class="normal1"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.958.1">WARNING</span></span><span class="kobospan" id="kobo.959.1">: These messages indicate that processing</span><span id="dx1-748005"/><span class="kobospan" id="kobo.960.1"> may be compromised in some way. </span><span class="kobospan" id="kobo.960.2">The most sensible use case for a warning is when functions or classes have been deprecated: they still work, but they should be replaced.</span></p>
<p class="normal1"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.961.1">ERROR</span></span><span class="kobospan" id="kobo.962.1">: Processing is invalid and the output</span><span id="dx1-748006"/><span class="kobospan" id="kobo.963.1"> is incorrect or incomplete. </span><span class="kobospan" id="kobo.963.2">In the case of a long-running server, an individual request may have problems, but the server as a whole can continue to operate.</span></p>
<p class="normal1"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.964.1">CRITICAL</span></span><span class="kobospan" id="kobo.965.1">: A more severe level</span><span id="dx1-748007"/><span class="kobospan" id="kobo.966.1"> of error. </span><span class="kobospan" id="kobo.966.2">Generally, this is used by long-running servers where the server itself can no longer operate and is about to crash.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.967.1">Each logger has method names that are similar to the severity levels. </span><span class="kobospan" id="kobo.967.2">We use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.968.1">info()</span></span></span></span><span class="kobospan" id="kobo.969.1"> method to write a message with the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.970.1">INFO </span></span><span class="kobospan" id="kobo.971.1">severity level.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.972.1">For error handling, the severity levels are mostly appropriate. </span><span class="kobospan" id="kobo.972.2">A debugging logger, however, often produces volumes of data that need to be kept separate. </span><span class="kobospan" id="kobo.972.3">Further, any audit and control output doesn’t seem to have a severity level. </span><span class="kobospan" id="kobo.972.4">The severity level seems to be focused only on error logging. </span><span class="kobospan" id="kobo.972.5">For this reason, it seems to be better to have distinct logs with names like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.973.1">debug.some_function</span></span></span></span><span class="kobospan" id="kobo.974.1">. </span><span class="kobospan" id="kobo.974.2">We can then configure debugging by enabling or disabling the output from these loggers, and configure the severity level to be </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.975.1">INFO</span></span></span></span><span class="kobospan" id="kobo.976.1">. </span><span id="x1-748008r1604"/></p>
</section>
<section data-number="0.16.6.2" id="how-to-do-it...-105">
<h2 class="likechapterhead" data-number="0.16.6.2"><span><span class="kobospan" id="kobo.977.1">13.6.2 </span></span> <span id="x1-7490002"/><span class="kobospan" id="kobo.978.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.979.1">We’ll look at logging</span><span id="dx1-749001"/><span class="kobospan" id="kobo.980.1"> in a class as well as a function</span><span id="dx1-749002"/><span class="kobospan" id="kobo.981.1"> in two mini-recipes.</span></p>
<section data-number="0.16.6.2.1" id="logging-in-a-class">
<h3 class="likesubsubsectionhead" data-number="0.16.6.2.1"><span id="x1-7500002"/><span class="kobospan" id="kobo.982.1">Logging in a class</span></h3>
<ol class="calibre2">
<li class="calibre7"><div id="x1-750002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.983.1">Be sure the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.984.1">logging</span></span></span></span><span class="kobospan" id="kobo.985.1"> module</span><span id="dx1-750003"/><span class="kobospan" id="kobo.986.1"> is imported.</span></p>
</div></li>
<li class="calibre7"><div id="x1-750005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.987.1">In the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.988.1">__init__()</span></span></span></span><span class="kobospan" id="kobo.989.1"> method, include the following to create an error and debug loggers:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.990.1">
        self.err_logger = logging.getLogger( 
 
            f"error.{self.__class__.__name__}") 
 
        self.dbg_logger = logging.getLogger( 
 
            f"debug.{self.__class__.__name__}")</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-750012x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.991.1">In any method that might require future debugging, use the debug logger’s methods to write details to the log. </span><span class="kobospan" id="kobo.991.2">While f-strings can be used to write log messages, they involve a bit of overhead to interpolate values into the text. </span><span class="kobospan" id="kobo.991.3">Using the logger’s formatting options and separate argument values involves slightly less computation when the configuration silences the logger’s output:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.992.1">
        self.dbg_logger.info( 
 
            "Some computation with %r", some_variable) 
 
        # Some complicated computation with some_variable 
 
        self.dbg_logger.info( 
 
            "Result details = %r", result)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-750020x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.993.1">In a few key places, include overall status messages. </span><span class="kobospan" id="kobo.993.2">These are often in the overall application control classes:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.994.1">
        # Some complicated input processing and parsing 
 
        self.err_logger.info("Input processing completed.")                                                                

                                                                     
     </span></code></pre>
</div></li>
</ol>
</section>
<section data-number="0.16.6.2.2" id="logging-in-a-function">
<h3 class="likesubsubsectionhead" data-number="0.16.6.2.2"><span id="x1-7510002"/><span class="kobospan" id="kobo.995.1">Logging in a function</span></h3>
<ol class="calibre2">
<li class="calibre7"><div id="x1-751002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.996.1">Be sure the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.997.1">logging</span></span></span></span><span class="kobospan" id="kobo.998.1"> module is imported.</span></p>
</div></li>
<li class="calibre7"><div id="x1-751004x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.999.1">For larger and more complicated functions, it makes sense to include the logger inside the function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1000.1">def large_and_complicated(some_parameter: Any) -&gt; Any: 
 
    dbg_logger = logging.getLogger("debug.large_and_complicated") 
 
    dbg_logger.info("some_parameter= %r", some_parameter)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1001.1">Because the loggers are cached, only the first request to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1002.1">get_logger()</span></span></span></span><span class="kobospan" id="kobo.1003.1"> involves any significant overhead. </span><span class="kobospan" id="kobo.1003.2">All subsequent requests are dictionary lookups.</span></p>
</div></li>
<li class="calibre7"><div id="x1-751010x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1004.1">For smaller functions, it can make sense to have a globally defined logger. </span><span class="kobospan" id="kobo.1004.2">This can help to reduce visual clutter within a function’s body:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1005.1">                                                                     very_small_dbg_logger = logging.getLogger("debug.very_small") 
 
 
 
def very_small(some_parameter: Any) -&gt; Any: 
 
    very_small_dbg_logger.info("some_parameter= %r", some_parameter)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1006.1">Note that without any further configuration, no output will be produced. </span><span class="kobospan" id="kobo.1006.2">This is because the default severity level for each logger will be </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1007.1">WARNING</span></span></span></span><span class="kobospan" id="kobo.1008.1">, which means the handler will not show </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1009.1">INFO</span></span></span></span><span class="kobospan" id="kobo.1010.1">- or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1011.1">DEBUG</span></span></span></span><span class="kobospan" id="kobo.1012.1">-level messages.. </span><span id="x1-751016r1605"/></p>
</section>
</section>
<section data-number="0.16.6.3" id="how-it-works...-105">
<h2 class="likechapterhead" data-number="0.16.6.3"><span><span class="kobospan" id="kobo.1013.1">13.6.3 </span></span> <span id="x1-7520003"/><span class="kobospan" id="kobo.1014.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1015.1">There are three parts</span><span id="dx1-752001"/><span class="kobospan" id="kobo.1016.1"> to introducing logging</span><span id="dx1-752002"/><span class="kobospan" id="kobo.1017.1"> into an application:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1018.1">Creating </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1019.1">Logger</span></span></span></span><span class="kobospan" id="kobo.1020.1"> objects with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1021.1">getLogger()</span></span></span></span><span class="kobospan" id="kobo.1022.1"> function.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1023.1">Placing log messages near important state changes with one of the methods similar to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1024.1">info()</span></span></span></span><span class="kobospan" id="kobo.1025.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1026.1">error()</span></span></span></span><span class="kobospan" id="kobo.1027.1"> for each logger.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1028.1">Configuring the logging system as a whole when the application is run. </span><span class="kobospan" id="kobo.1028.2">This is essential for seeing output from the loggers. </span><span class="kobospan" id="kobo.1028.3">We’ll look at this in the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1029.1">There’s more... </span></span><span class="kobospan" id="kobo.1030.1">section of this recipe.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1031.1">Creating loggers can be done in a variety of ways. </span><span class="kobospan" id="kobo.1031.2">A common approach is to create one logger with the same name as the module:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1032.1">logger = logging.getLogger(__name__)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1033.1">For the top-level main script, this will have the name </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1034.1">__main__</span></span></span></span><span class="kobospan" id="kobo.1035.1">. </span><span class="kobospan" id="kobo.1035.2">For imported modules, the name will match the module name.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1036.1">In more complex applications, there could be a variety of loggers serving a variety of purposes. </span><span class="kobospan" id="kobo.1036.2">In these cases, simply naming a logger after a module may not provide the required level of flexibility.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1037.1">It’s also possible to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1038.1">logging</span></span></span></span><span class="kobospan" id="kobo.1039.1"> module itself as the root logger. </span><span class="kobospan" id="kobo.1039.2">This means a module can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1040.1">logging.info()</span></span></span></span><span class="kobospan" id="kobo.1041.1"> function, for example. </span><span class="kobospan" id="kobo.1041.2">This isn’t recommended because the root logger is anonymous, and we sacrifice the possibility of using the logger name as an important source of information.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1042.1">This recipe suggests naming loggers based on the audience or use case. </span><span class="kobospan" id="kobo.1042.2">The topmost name – for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1043.1">debug.</span></span></span></span><span class="kobospan" id="kobo.1044.1"> – will distinguish the audience or purpose for the log. </span><span class="kobospan" id="kobo.1044.2">This can make it easy to route all loggers under a given parent to a specific handler.</span></p>
<div class="tipbox" id="tcolobox-28">
<div class="note">
<p class="normal1"><span class="kobospan" id="kobo.1045.1">It’s helpful to associate logging messages with the important state changes made by the code.</span></p>
</div>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1046.1">The third aspect of logging</span><span id="dx1-752005"/><span class="kobospan" id="kobo.1047.1"> is configuring the loggers</span><span id="dx1-752006"/><span class="kobospan" id="kobo.1048.1"> so that they route the requests to the appropriate destination. </span><span class="kobospan" id="kobo.1048.2">By default, with no configuration at all, the logger instances will quietly ignore the various messages being created.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1049.1">With a minimal configuration, we can see all of the log events on the console. </span><span class="kobospan" id="kobo.1049.2">This can be done with the following:</span></p>
<pre class="programlisting" id="listing-84"><code class="calibre13"><span class="kobospan" id="kobo.1050.1">if __name__ == "__main__": 
 
    logging.basicConfig(level=logging.INFO)</span></code></pre>
<p class="normal1"><span id="x1-752009r1613"/></p>
</section>
<section data-number="0.16.6.4" id="theres-more...-96">
<h2 class="likechapterhead" data-number="0.16.6.4"><span><span class="kobospan" id="kobo.1051.1">13.6.4 </span></span> <span id="x1-7530004"/><span class="kobospan" id="kobo.1052.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1053.1">In order to route the different loggers to different destinations, we’ll need a more sophisticated configuration. </span><span class="kobospan" id="kobo.1053.2">Often, this goes beyond what we can build with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1054.1">basicConfig()</span></span></span></span><span class="kobospan" id="kobo.1055.1"> function. </span><span class="kobospan" id="kobo.1055.2">We’ll need to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1056.1">logging.config</span></span></span></span><span class="kobospan" id="kobo.1057.1"> module and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1058.1">dictConfig()</span></span></span></span><span class="kobospan" id="kobo.1059.1"> function. </span><span class="kobospan" id="kobo.1059.2">This can provide a complete set of configuration options. </span><span class="kobospan" id="kobo.1059.3">The easiest way to use this function is to write the configuration in TOML:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1060.1">version = 1 
 
[formatters.default] 
 
    style = "{" 
 
    format = "{levelname}:{name}:{message}" 
 
 
 
[formatters.timestamp] 
 
    style = "{" 
 
    format = "{asctime}//{levelname}//{name}//{message}" 
 
 
 
[handlers.console] 
 
    class = "logging.StreamHandler" 
 
    stream = "ext://sys.stderr" 
 
    formatter = "default" 
 
 
 
[handlers.file] 
 
    class = "logging.FileHandler" 
 
    filename = "data/write.log" 
 
    formatter = "timestamp" 
 
 
 
[loggers] 
 
    overview_stats.detail = {handlers = ["console"]} 
 
    overview_stats.write = {handlers = ["file", "console"] } 
 
    root = {level = "INFO"}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1061.1">Here are some key points</span><span id="dx1-753025"/><span class="kobospan" id="kobo.1062.1"> in this TOML configuration:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1063.1">The value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1064.1">version</span></span></span></span><span class="kobospan" id="kobo.1065.1"> key must be </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1066.1">1</span></span></span></span><span class="kobospan" id="kobo.1067.1">. </span><span class="kobospan" id="kobo.1067.2">This is required.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1068.1">The values in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1069.1">formatters</span></span></span></span><span class="kobospan" id="kobo.1070.1"> table define the log formats available. </span><span class="kobospan" id="kobo.1070.2">If a formatter is not specified, a built-in formatter will display the message body only:</span></p>
<ul class="calibre25">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1071.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1072.1">default</span></span></span></span><span class="kobospan" id="kobo.1073.1"> formatter defined in the example mirrors the format created by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1074.1">basicConfig()</span></span></span></span><span class="kobospan" id="kobo.1075.1"> function. </span><span class="kobospan" id="kobo.1075.2">This includes the message severity level and the logger name.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1076.1">The new </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1077.1">timestamp</span></span></span></span><span class="kobospan" id="kobo.1078.1"> formatter defined in the example is a more complex format that includes the date-time stamp for the record. </span><span class="kobospan" id="kobo.1078.2">To make the file easier to parse, a column separator of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1079.1">//</span></span></span></span><span class="kobospan" id="kobo.1080.1"> was used.</span></p></li>
</ul></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1081.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1082.1">handlers</span></span></span></span><span class="kobospan" id="kobo.1083.1"> table defines the handlers available for loggers to use:</span></p>
<ul class="calibre25">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1084.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1085.1">console</span></span></span></span><span class="kobospan" id="kobo.1086.1"> handler writes to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1087.1">sys.stderr</span></span></span></span><span class="kobospan" id="kobo.1088.1"> stream and uses </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1089.1">default</span></span></span></span><span class="kobospan" id="kobo.1090.1"> formatter. </span><span class="kobospan" id="kobo.1090.2">The text starting </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1091.1">"ext://..."</span></span></span></span><span class="kobospan" id="kobo.1092.1"> is how a configuration file can refer to objects defined in the Python environment – in this case, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1093.1">sys.stderr</span></span></span></span><span class="kobospan" id="kobo.1094.1"> value from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1095.1">sys</span></span></span></span><span class="kobospan" id="kobo.1096.1"> module.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1097.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1098.1">file</span></span></span></span><span class="kobospan" id="kobo.1099.1"> handler uses the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1100.1">FileHandler</span></span></span></span><span class="kobospan" id="kobo.1101.1"> class to write to a file. </span><span class="kobospan" id="kobo.1101.2">The default mode for opening the file is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1102.1">a</span></span></span></span><span class="kobospan" id="kobo.1103.1">, which will append to any existing log file. </span><span class="kobospan" id="kobo.1103.2">The configuration specifies the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1104.1">timestamp</span></span></span></span><span class="kobospan" id="kobo.1105.1"> formatter that will be used for the file.</span></p></li>
</ul></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1106.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1107.1">loggers</span></span></span></span><span class="kobospan" id="kobo.1108.1"> table provides</span><span id="dx1-753026"/><span class="kobospan" id="kobo.1109.1"> a configuration for two specific named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1110.1">loggers</span></span></span></span><span class="kobospan" id="kobo.1111.1"> that the application will use. </span><span class="kobospan" id="kobo.1111.2">Any logger name that begins with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1112.1">overview_stats.detail</span></span></span></span><span class="kobospan" id="kobo.1113.1"> will be handled only by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1114.1">console</span></span></span></span><span class="kobospan" id="kobo.1115.1"> handler. </span><span class="kobospan" id="kobo.1115.2">Any logger name that begins with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1116.1">overview_stats.write</span></span></span></span><span class="kobospan" id="kobo.1117.1"> will go to both the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1118.1">file</span></span></span></span><span class="kobospan" id="kobo.1119.1"> handler and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1120.1">console</span></span></span></span><span class="kobospan" id="kobo.1121.1"> handler.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1122.1">The special </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1123.1">root</span></span></span></span><span class="kobospan" id="kobo.1124.1"> key defines the top-level logger. </span><span class="kobospan" id="kobo.1124.2">Within an application, it has a name of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1125.1">""</span></span></span></span><span class="kobospan" id="kobo.1126.1"> (empty string) when referred to in code. </span><span class="kobospan" id="kobo.1126.2">Within the configuration file, it has the key </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1127.1">root</span></span></span></span><span class="kobospan" id="kobo.1128.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1129.1">Setting the severity level on the root logger will set the level used to show – or hide – messages for all of the children of this logger. </span><span class="kobospan" id="kobo.1129.2">This will show messages with the severity </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1130.1">INFO</span></span></span></span><span class="kobospan" id="kobo.1131.1"> or higher, which includes warnings, errors, and severe errors.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1132.1">Assuming the contents of this file are present in a variable named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1133.1">config_toml</span></span></span></span><span class="kobospan" id="kobo.1134.1">, the configuration to wrap the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1135.1">main()</span></span></span></span><span class="kobospan" id="kobo.1136.1"> function will look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1137.1">if __name__ == "__main__": 
 
    logging.config.dictConfig( 
 
        tomllib.loads(config_toml)) 
 
    main() 
 
    logging.shutdown()</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1138.1">This will start the logging in a known state. </span><span class="kobospan" id="kobo.1138.2">It will do the processing of the application. </span><span class="kobospan" id="kobo.1138.3">It will finalize all of the logging buffers and properly close any files. </span><span id="x1-753033r1615"/></p>
</section>
<section data-number="0.16.6.5" id="see-also-103">
<h2 class="likechapterhead" data-number="0.16.6.5"><span><span class="kobospan" id="kobo.1139.1">13.6.5 </span></span> <span id="x1-7540005"/><span class="kobospan" id="kobo.1140.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1141.1">See the </span><a href="ch017.xhtml#x1-7410005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1142.1">Designing scripts for composition</span></span></a><span class="kobospan" id="kobo.1143.1"> recipe earlier in this chapter for the complementary part of this application.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1144.1">See the </span><a href="ch017.xhtml#x1-7230002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1145.1">Using TOML for configuration files</span></span></a><span class="kobospan" id="kobo.1146.1"> recipe in this chapter for more on parsing TOML documents.</span></p></li>
</ul>
<p class="normal1"><span id="x1-754001r1603"/></p>
</section>
</section>
<section data-number="0.16.9" id="join-our-community-discord-space-13">
<h1 class="unnumbered" data-number="0.16.9"><span id="x1-7570008"/><span class="kobospan" id="kobo.1147.1">Join our community Discord space</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1148.1">Join our Python Discord workspace to discuss and find out more about the book: </span><a class="url" href="https://packt.link/dHrHU"><span class="url1"><span class="kobospan" id="kobo.1149.1">https://packt.link/dHrHU</span></span></a></p>
<p class="normal1"><span class="kobospan" id="kobo.1150.1"><img alt="PIC" src="../media/file1.png" class="calibre9"/></span></p>
<p class="normal1"><span id="x1-757001r1530"/></p>
</section>
</section>
</body></html>