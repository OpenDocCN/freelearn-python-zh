<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer077">
			<h1 id="_idParaDest-320"><em class="italic"><a id="_idTextAnchor324"/></em><a href="B16119_11_Final_PD_ePub.xhtml#_idTextAnchor324"><em class="italic">Chapter 11</em></a>: Kanban Views and Client-Side QWeb</h1>
			<p><strong class="bold">Kanban views</strong> support lean processes, providing a visual representation of the work in progress and the status of each work item. This can be an important tool to streamline business processes.</p>
			<p>This chapter introduces <strong class="bold">kanban board</strong> concepts, and how they are implemented in <strong class="bold">Odoo</strong> by using the kanban view type, stage columns, and kanban states.</p>
			<p>Kanban views are powered by <strong class="bold">QWeb</strong> – the template engine used by Odoo. It is <strong class="bold">XML</strong>-based and used to generate <strong class="bold">HTML</strong> fragments and pages. It is also used for reports and website pages, so it is an important part of Odoo that developers should be familiar with.</p>
			<p>In this chapter, we will show how to organize a kanban view in several areas, such as the title and main content, as well as how to use the QWeb syntax to apply the widgets and effects that are available.</p>
			<p>The QWeb template language will be described in detail to provide a complete understanding of its features.</p>
			<p>The later sections will explain how to extend the QWeb templates used in kanban views and present useful techniques for this. Here, you will learn how to add web assets that you intend to be used in these views, such as <strong class="bold">CSS</strong> and <strong class="bold">JavaScript</strong>.</p>
			<p>The following topics will be covered in this chapter:</p>
			<ul>
				<li>Introducing kanban boards</li>
				<li>Designing kanban views</li>
				<li>Designing kanban cards</li>
				<li>Exploring the QWeb template language</li>
				<li>Extending kanban views</li>
				<li>Adding CSS and JavaScript assets</li>
			</ul>
			<p>By the end of this chapter, you will understand kanban boards and be able to design your own kanban views.</p>
			<h1 id="_idParaDest-321"><a id="_idTextAnchor325"/>Technical requirements</h1>
			<p>This chapter continues enhancing the <strong class="source-inline">library_checkout</strong> addon module from <a href="B16119_10_Final_PD_ePub.xhtml#_idTextAnchor287"><em class="italic">Chapter 10</em></a>, <em class="italic">Backend Views – Designing the User Interface</em>. The corresponding code can be found in the <strong class="source-inline">ch11/</strong> directory of the <strong class="bold">GitHub</strong> repository at <a href="https://github.com/PacktPublishing/Odoo-15-Development-Essentials">https://github.com/PacktPublishing/Odoo-15-Development-Essentials.</a></p>
			<h1 id="_idParaDest-322"><a id="_idTextAnchor326"/>Introducing kanban boards</h1>
			<p><em class="italic">Kanban</em> is <a id="_idIndexMarker904"/>a Japanese word literally meaning <em class="italic">billboard</em> and is associated with lean manufacturing. More recently, <em class="italic">kanban boards</em> have <a id="_idIndexMarker905"/>become popular in the software industry with the adoption of <strong class="bold">agile</strong> methodologies.</p>
			<p>A kanban board <a id="_idIndexMarker906"/>provides a visual representation of a work queue. The board is organized into columns, which represent the <em class="italic">stages</em> of the work process. Work items are <a id="_idIndexMarker907"/>represented by <em class="italic">cards</em> placed on the appropriate column of the board. New work items start from the leftmost column and travel through the board until they reach the rightmost column, which represents the completed work.</p>
			<p>The simplicity and visual impact of kanban boards make them a good tool to support simple business processes. A basic example<a id="_idIndexMarker908"/> of a kanban board has three columns: <em class="italic">To Do</em>, <em class="italic">Doing</em>, and <em class="italic">Done</em>, as shown in the following diagram:</p>
			<p class="figure-caption">`</p>
			<div>
				<div id="_idContainer072" class="IMG---Figure">
					<img src="Images/Figure_11.1_B16119.jpg" alt="Figure 11.1 – An example of a kanban board&#13;&#10;" width="725" height="302"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.1 – An example of a kanban board</p>
			<p>In many cases, a<a id="_idIndexMarker909"/> kanban board is a more effective way to manage a process when compared to heavier workflow engines.</p>
			<p>Odoo supports kanban views – along with the classic list and form views – to support kanban boards. Now that we know what a kanban board is, let's learn how to use one.</p>
			<h2 id="_idParaDest-323"><a id="_idTextAnchor327"/>Supporting kanban boards in Odoo</h2>
			<p>Browsing the Odoo <a id="_idIndexMarker910"/>apps, we can see two different ways to use kanban views. One is a simple <em class="italic">card list</em>, which is used in places such as contacts, products, employees, and apps. The other is a kanban board, which is organized in columns representing the steps of a process.</p>
			<p>For simple card lists, a good example is the <strong class="bold">Contacts</strong> kanban view. The contact cards have an image on the left-hand side and a bold title in the main area, followed by a list of values:</p>
			<div>
				<div id="_idContainer073" class="IMG---Figure">
					<img src="Images/Figure_11.2_B16119.jpg" alt="Figure 11.2 – The Contacts kanban view&#13;&#10;" width="1185" height="531"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.2 – The Contacts kanban view</p>
			<p>While this contacts view uses a <em class="italic">kanban view</em>, it is not a <em class="italic">kanban board</em>.</p>
			<p>Examples of kanban boards can be found on the <em class="italic">CRM</em> app's <strong class="bold">Pipeline</strong> page or on the <strong class="bold">Project Tasks</strong> page. An example of the <strong class="bold">Pipeline</strong> page is shown in <em class="italic">Figure 11.3</em>:</p>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="Images/Figure_11.3_B16119.jpg" alt="Figure 11.3 – The CRM Pipeline kanban board&#13;&#10;" width="1266" height="666"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.3 – The CRM Pipeline kanban board</p>
			<p>The most<a id="_idIndexMarker911"/> important difference between this kanban board and the <strong class="bold">Contacts</strong> kanban view is the card organization in columns. This is done using the <strong class="bold">Group By</strong> feature, which<a id="_idIndexMarker912"/> is similar to what list views use. Usually, the grouping is done in a <em class="italic">stage</em> field. One very useful feature of kanban views is that they support dragging and dropping cards between columns, which automatically assigns the corresponding value to the field the view is grouped by.</p>
			<p>The <strong class="bold">CRM</strong> <strong class="bold">Pipeline</strong> page cards have a bit more structure. The main card area also has a title, followed by a list of relevant information, as well as a footer area. In this footer area, we can see a priority widget on the left-hand side, followed by an activities indicator, and on the right-hand side, we can see a small image of the responsible user.</p>
			<p>It's not visible in the figure shown in this chapter, but the cards also have an options menu on the top-right, which is shown when hovering the mouse pointer over it. This menu allows us to, for example, change a color indicator for the card.</p>
			<p>Looking at the cards in both examples, we can see some differences. In fact, their design is quite flexible, and there isn't a single way to design a kanban card. But these two examples provide a starting point for your designs.</p>
			<p>We will be using the more elaborate structure as a model for the cards on our checkouts kanban board.</p>
			<h2 id="_idParaDest-324"><a id="_idTextAnchor328"/>Understanding kanban states</h2>
			<p>On a kanban board, work<a id="_idIndexMarker913"/> items start in the leftmost column, and while the work is in progress, they travel through the columns until reaching the rightmost column, which shows the completed items. This implies a <em class="italic">push strategy</em>, which means when work on a column is done, the work item is <em class="italic">pushed</em> to the next column.</p>
			<p>A push strategy tends to lead to a build-up of work items in progress, which can be inefficient. Lean approaches advise using a <em class="italic">pull strategy</em> instead. Here, each stage <em class="italic">pulls</em> work from the previous one when it is ready to start the next work item.</p>
			<p>Odoo supports the pull strategy with the use of kanban states. Each record work item has a kanban state field signaling its flow status: <em class="italic">In progress</em> (gray), <em class="italic">Blocked</em> (red), or <em class="italic">Ready</em> (green).</p>
			<p>When the work needed in a stage is completed, instead of moving the card to the next column, it is marked as <em class="italic">Ready</em>. This gives a visual indication that the work item is ready to be pulled by the next stage. Additionally, if something is preventing the work from moving ahead, it can be marked as <em class="italic">Blocked</em>, giving a visual indication that help is needed to unblock this work item.</p>
			<p>As an example, kanban states are used in the <strong class="bold">Project Tasks</strong> kanban view. In the following screenshot, we can see the kanban state <em class="italic">gray-red-green</em> indicator in the bottom-right of each card. Also, note the progress bar at the top of each column, which provides a visual indication of the items in each state:</p>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="Images/Figure_11.4_B16119.jpg" alt="Figure 11.4 – The project task kanban view with the kanban states&#13;&#10;" width="1021" height="680"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.4 – The project task kanban view with the kanban states</p>
			<p>The <a id="_idIndexMarker914"/>kanban state is meaningful in each stage, so it should be reset when an item moves to another stage.</p>
			<p>You have now learned about the different views in a kanban board and what they look like. Now, we will move on to learning how to design them.</p>
			<h1 id="_idParaDest-325"><a id="_idTextAnchor329"/>Designing kanban views</h1>
			<p>The book checkout <a id="_idIndexMarker915"/>process can use a kanban view to visualize the work in progress. In this case, the kanban board columns could represent the checkout stages, and each checkout could be represented by a card.</p>
			<p>This is what the library checkout kanban view will look like when complete:</p>
			<div>
				<div id="_idContainer076" class="IMG---Figure">
					<img src="Images/Figure_11.5_B16119.jpg" alt="Figure 11.5 –  Library checkouts kanban view&#13;&#10;" width="1125" height="483"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.5 –  Library checkouts kanban view</p>
			<p>Form views mostly use Odoo-specific XML elements such as <strong class="source-inline">&lt;field&gt;</strong> and <strong class="source-inline">&lt;group&gt;</strong>. They also use some HTML elements such as <strong class="source-inline">&lt;h1&gt;</strong> or <strong class="source-inline">&lt;div&gt;</strong>, but their use is limited. Kanban views are quite the opposite. They are HTML-based and additionally support two Odoo-specific elements: <strong class="source-inline">&lt;field&gt;</strong> and <strong class="source-inline">&lt;button&gt;</strong>.</p>
			<p>With kanban views, the<a id="_idIndexMarker916"/> final HTML presented in the web client is dynamically generated from QWeb templates. The QWeb engine processes special XML tags and attributes in the templates to produce the final HTML. This allows a lot of control of how the content is rendered, but it also makes the view design more complex.</p>
			<p>As a kanban view design is so flexible, different design structures can be used. A good approach is to find an existing kanban view that would fit well with the use case at hand, inspect it, and use it as a reference.</p>
			<h2 id="_idParaDest-326"><a id="_idTextAnchor330"/>Creating a minimal viable kanban view</h2>
			<p>Kanban views <a id="_idIndexMarker917"/>allow for a rich user interface and can quickly get complex. The first step in learning how to design kanban views is to create a minimum viable view.</p>
			<p>To add a kanban view to the <strong class="source-inline">library_checkout</strong> module, follow these steps: </p>
			<ol>
				<li>Add <strong class="source-inline">kanban</strong> in <strong class="source-inline">view_mode</strong> of the window action. To do this, edit the <strong class="source-inline">views/library_menu.xml</strong> file and update the value set in the <strong class="source-inline">view_mode</strong> field to match the following:<p class="source-code">  &lt;record id="action_library_checkout"</p><p class="source-code">          model="ir.actions.act_window"&gt;</p><p class="source-code">    &lt;field name="name"&gt;Checkouts&lt;/field&gt;</p><p class="source-code">    &lt;field name="res_model"&gt;library.checkout&lt;/field&gt;</p><p class="source-code">    &lt;field name="view_mode"&gt;</p><p class="source-code">      <strong class="bold">kanban,</strong>tree,form,calendar,pivot,graph,activity</p><p class="source-code"><strong class="bold">    </strong>&lt;/field&gt;</p><p class="source-code">  &lt;/record&gt;</p><p>In the <a id="_idIndexMarker918"/>previous code, <strong class="source-inline">kanban</strong> was added at the beginning of the list to have it as the default view type.</p></li>
				<li>The new kanban view will be added in a new XML file, <strong class="source-inline">views/checkout_kanban_<a id="_idTextAnchor331"/>view.xml</strong>. So, add this file to the <strong class="source-inline">__manifest__.py</strong> module in the <strong class="source-inline">data</strong> key:<p class="source-code">    "data": [</p><p class="source-code">        "security/ir.model.access.csv",</p><p class="source-code">        "views/library_menu.xml",</p><p class="source-code">        "views/checkout_view.xml",</p><p class="source-code"><strong class="bold">        "views/checkout_kanban_view.xml",</strong></p><p class="source-code">        "wizard/checkout_mass_message_wizard_view.xml"</p><p class="source-code">         ,</p><p class="source-code">        "data/stage_data.xml",</p><p class="source-code">    ],</p></li>
				<li>Finally, add the <a id="_idIndexMarker919"/>XML code for a minimal kanban view in the <strong class="source-inline">views/checkout_kanban_view.xml</strong> file by using the following code:<p class="source-code">&lt;odoo&gt;</p><p class="source-code">  &lt;record id="library_checkout_kanban" </p><p class="source-code">    model="ir.ui.view"&gt;</p><p class="source-code">    &lt;field name="model"&gt;library.checkout&lt;/field&gt;</p><p class="source-code">    &lt;field name="arch" type="xml"&gt;</p><p class="source-code"><strong class="bold">&lt;kanban&gt;</strong></p><p class="source-code"><strong class="bold">  &lt;templates&gt;</strong></p><p class="source-code"><strong class="bold">    &lt;t t-name="kanban-box"&gt;</strong></p><p class="source-code"><strong class="bold">      &lt;div&gt;</strong></p><p class="source-code"><strong class="bold">        &lt;field name="name" /&gt;</strong></p><p class="source-code"><strong class="bold">      &lt;/div&gt;</strong></p><p class="source-code"><strong class="bold">    &lt;/t&gt;</strong></p><p class="source-code"><strong class="bold">  &lt;/templates&gt;</strong></p><p class="source-code"><strong class="bold">&lt;/kanban&gt;</strong></p><p class="source-code">    &lt;/field&gt;</p><p class="source-code">  &lt;/record&gt;</p><p class="source-code">&lt;/odoo&gt;</p></li>
			</ol>
			<p>In the previous code, a kanban view is declared inside a <strong class="source-inline">&lt;kanban&gt;</strong> element. Kanban views are described using the QWeb template language. The templates are added inside a <strong class="source-inline">&lt;templates&gt;</strong> sub-element.</p>
			<p>The main template for each kanban card is described in the  <strong class="source-inline">&lt;t t-name="kanban-box"&gt;</strong> element. This QWeb template is minimal. It is an HTML <strong class="source-inline">&lt;div&gt;</strong> element containing an <a id="_idIndexMarker920"/>Odoo-specific <strong class="source-inline">&lt;field&gt;</strong> widget, which is also used in form and tree views.</p>
			<p>This provides a pretty basic <em class="italic">kanban view</em> XML structure to start building from. To be a <em class="italic">kanban board</em>, it needs to feature columns for each process stage.</p>
			<h2 id="_idParaDest-327"><a id="_idTextAnchor332"/>Presenting kanban board columns</h2>
			<p>Kanban boards<a id="_idIndexMarker921"/> present the work items organized in columns, where each column is a stage in the process. New work items start on the left-hand columns and then travel through the columns until they arrive at the right-hand side, completed.</p>
			<p>Kanban views present items in columns when grouping by a field. For a kanban board, the view should be grouped by a stage or state field – often, <strong class="source-inline">stage_id</strong> is used.</p>
			<p>The <strong class="source-inline">default_group_by</strong> attribute sets a default column group for the kanban view. To have a kanban board for the book checkouts, edit the <strong class="source-inline">&lt;kanban&gt;</strong> element to look like this:</p>
			<p class="source-code">&lt;kanban <strong class="bold">default_group_by="stage_id"</strong>&gt;</p>
			<p>When opening this view, it will be grouped by stage by default (which is similar to <em class="italic">Figure 11.4</em>). The user is still able to change the applied <strong class="bold">group by</strong> by using the same <strong class="source-inline">group_by</strong> options used for list views.</p>
			<h2 id="_idParaDest-328"><a id="_idTextAnchor333"/>Understanding kanban view attributes and elements</h2>
			<p>Kanban views support a few additional attributes<a id="_idIndexMarker922"/> to fine-tune their behavior.</p>
			<p>The <strong class="source-inline">&lt;kanban&gt;</strong> top element supports <a id="_idIndexMarker923"/>these attributes:</p>
			<ul>
				<li><strong class="source-inline">default_group_by</strong>: This sets the field to use for the default column groups.</li>
				<li><strong class="source-inline">default_order</strong>: This sets a default order to use for the kanban items.</li>
				<li><strong class="source-inline">quick_create="false"</strong>: This disables the <strong class="source-inline">quick_create</strong> option to create new items by providing just a title description, using the plus sign at the right-hand side of each column header. The <strong class="source-inline">false</strong> value is a JavaScript literal and must be in lowercase.</li>
				<li><strong class="source-inline">quick_create_view</strong>: This can optionally be used to set a specific form view to use for the <strong class="source-inline">quick_create</strong> function. It should be set with the XML ID of the form view.</li>
				<li><strong class="source-inline">class</strong>: This adds a<a id="_idIndexMarker924"/> CSS class to the root element of the rendered kanban view. A relevant class is <strong class="source-inline">o_kanban_small_column</strong>, which makes columns somewhat more compact than the default. Additional classes <a id="_idIndexMarker925"/>may be made available through the CSS assets provided by the module.</li>
				<li><strong class="source-inline">group_create</strong>, <strong class="source-inline">group_edit</strong>, <strong class="source-inline">group_delete</strong>, and <strong class="source-inline">quick_create_view</strong>: These can be set to <strong class="source-inline">false</strong> to disable the corresponding action on the kanban columns. For example, <strong class="source-inline">group_create="false"</strong> removes the vertical <strong class="bold">Add new column</strong> bar on the right side of the screen.</li>
				<li><strong class="source-inline">records_draggable="false"</strong>: This disables the ability to drag records between columns.</li>
			</ul>
			<p>The <strong class="source-inline">&lt;kanban&gt;</strong> element can contain these elements:</p>
			<ul>
				<li><strong class="source-inline">&lt;field&gt;</strong>: This is used to declare the fields used by the QWeb templates that need to be retrieved from the server. This is necessary when those fields are used in QWeb evaluation expressions. It is not needed for fields used in a template <strong class="source-inline">&lt;field&gt;</strong> element.</li>
				<li><strong class="source-inline">&lt;progressbar&gt;</strong>: This element adds a progress bar widget on the group column headers.</li>
				<li><strong class="source-inline">&lt;templates&gt;</strong>: This element is required where the kanban card QWeb templates are declared.</li>
			</ul>
			<p>An example for the <strong class="source-inline">&lt;templates&gt;</strong> element can be seen in the minimal kanban view presented previously. An example of the <strong class="source-inline">&lt;progressbar&gt;</strong> element is provided next.</p>
			<h2 id="_idParaDest-329"><a id="_idTextAnchor334"/>Adding a progress bar to group columns</h2>
			<p>A <strong class="bold">progress bar</strong> can <a id="_idIndexMarker926"/>show a total number for the column and a colored bar representing the column record sub-states. The CRM Pipeline page uses it to provide a summary for the lead activities, from <strong class="bold">planned</strong> to <strong class="bold">overdue</strong>. Another example is the use of kanban states, as used by the <strong class="bold">Project Tasks</strong> kanban board.</p>
			<p>For this, first <strong class="source-inline">kanban_state</strong> needs to <a id="_idIndexMarker927"/>be added to the model, and then, it <a id="_idIndexMarker928"/>can be used in the view. To do so, apply the following steps:</p>
			<ol>
				<li value="1">Add the field to the <strong class="source-inline">library.checkout</strong> model, editing the <strong class="source-inline">models/library_checkout.py</strong> file as follows:<p class="source-code"># class Checkout(models.Model):</p><p class="source-code"><strong class="bold">    kanban_state = fields.Selection(</strong></p><p class="source-code"><strong class="bold">        [("normal", "In Progress"),</strong></p><p class="source-code"><strong class="bold">         ("blocked", "Blocked"),</strong></p><p class="source-code"><strong class="bold">         ("done", "Ready for next stage")],</strong></p><p class="source-code"><strong class="bold">        "Kanban State",</strong></p><p class="source-code"><strong class="bold">        default="normal")</strong></p></li>
				<li>When changing the stage in the same file at the beginning of the <strong class="source-inline">write()</strong> method, add the business logic to reset <strong class="source-inline">kanban_state</strong>, as follows:<p class="source-code">    def write(self, vals):</p><p class="source-code"><strong class="bold">        # reset kanban state when changing stage</strong></p><p class="source-code"><strong class="bold">        if "stage_id" in vals and "kanban_state" </strong></p><p class="source-code"><strong class="bold">          </strong><strong class="bold">not in vals:</strong></p><p class="source-code"><strong class="bold">            vals["kanban_state"] = "normal"</strong></p><p class="source-code">        # Code before write ...</p><p class="source-code">        # ...</p><p class="source-code">        return True</p></li>
			</ol>
			<p>This completes the model changes needed for the time being. Here, we are focusing on adding the <a id="_idIndexMarker929"/>progress bar – the kanban status widget will<a id="_idIndexMarker930"/> be added in a later section.</p>
			<p>The <strong class="source-inline">&lt;progressbar&gt;</strong> element is one of the three element types allowed inside a <strong class="source-inline">&lt;kanban&gt;</strong> tag, along with <strong class="source-inline">&lt;field&gt;</strong> and <strong class="source-inline">&lt;templates&gt;</strong>.</p>
			<p>To add it to the <strong class="source-inline">&lt;kanban&gt;</strong> view definition, edit the element to add the following highlighted code:</p>
			<p class="source-code">&lt;kanban&gt;</p>
			<p class="source-code"><strong class="bold">  &lt;progressbar field="kanban_state" </strong></p>
			<p class="source-code"><strong class="bold">   colors='{</strong></p>
			<p class="source-code"><strong class="bold">     "done": "success",</strong></p>
			<p class="source-code"><strong class="bold">     "blocked": "danger",</strong></p>
			<p class="source-code"><strong class="bold">     "normal": "muted"}'</strong></p>
			<p class="source-code"><strong class="bold">   sum_fields="num_books" </strong></p>
			<p class="source-code"><strong class="bold">  /&gt;</strong></p>
			<p class="source-code">  &lt;templates&gt;</p>
			<p class="source-code">    &lt;t t-name="kanban-box"&gt;</p>
			<p class="source-code">      &lt;div&gt;</p>
			<p class="source-code">        &lt;field name="name" /&gt;</p>
			<p class="source-code">      &lt;/div&gt;</p>
			<p class="source-code">    &lt;/t&gt;</p>
			<p class="source-code">  &lt;/templates&gt;</p>
			<p class="source-code">&lt;/kanban&gt;</p>
			<p>The previous code adds the progress bar widget. The <strong class="source-inline">field</strong> attribute sets the model field to use, and the <strong class="source-inline">colors</strong> attribute maps the field values to the <strong class="source-inline">"danger"</strong>, <strong class="source-inline">"warning"</strong>, <strong class="source-inline">"success"</strong>, or <strong class="source-inline">"muted"</strong> colors.</p>
			<p>By default, the<a id="_idIndexMarker931"/> column total indicator counts the number<a id="_idIndexMarker932"/> of items in each column. This can be changed to be the sum of the values in a model field. In the previous code, the optional <strong class="source-inline">sum_fields</strong> attribute was added to present the total number of books in each column's requests.</p>
			<p>At this point, we have a functioning kanban view. However, the kanban cards can display richer features. The next section focuses on this, where we will further expand the templates used to render the kanban card content.</p>
			<h1 id="_idParaDest-330"><a id="_idTextAnchor335"/>Designing kanban cards</h1>
			<p>The design of a<a id="_idIndexMarker933"/> kanban card is quite flexible and uses HTML that is produced from QWeb templates declared in the <strong class="source-inline">&lt;templates&gt;</strong> element.</p>
			<p>The content area will often feature several other areas. Using the CRM Pipeline as a blueprint, the following sections can be found:</p>
			<ul>
				<li>A title section, with the lead short summary</li>
				<li>A content section, with the amount, customer name, and lead tags</li>
				<li>A left footer section, with the priority and activities widgets</li>
				<li>A right footer section, with the salesperson avatar</li>
				<li>A top-right menu button, which in this case, is visible on mouse hover</li>
			</ul>
			<p>This section implements the previous kanban card structure, and it populates each section to showcase the most important features. The first step for designing kanban cards is to lay out<a id="_idIndexMarker934"/> the kanban card skeleton, which is described next.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The proposed kanban skeleton, as well as certain CSS classes used, is based on the CRM Pipeline kanban view. Odoo modules can provide specific CSS classes and use them in the kanban card design. So, these can vary when inspecting the kanban view templates from different modules.</p>
			<h2 id="_idParaDest-331"><a id="_idTextAnchor336"/>Organizing the kanban card layout</h2>
			<p>The kanban card <a id="_idIndexMarker935"/>minimal design will now be expanded to a skeleton including several areas, which we will now describe.</p>
			<p>The kanban card is defined inside the <strong class="source-inline">&lt;templates&gt;</strong> section in an element with <strong class="source-inline">t-name="kanban-box"</strong>. This can be an HTML element or a QWeb <strong class="source-inline">t-</strong> directive. The definition created earlier in this chapter uses the neutral <strong class="source-inline">&lt;t&gt;</strong> QWeb element: <strong class="source-inline">&lt;t t-name="kanban-box"&gt;</strong>.</p>
			<p>Moving ahead, the kanban view template and the QWeb template should be edited to mark the areas to be worked on, as shown by the following code:</p>
			<p class="source-code">&lt;kanban&gt;</p>
			<p class="source-code"><strong class="bold">  &lt;!-- Field list to ensure is loaded ... --&gt;</strong></p>
			<p class="source-code">  &lt;templates&gt;</p>
			<p class="source-code">    &lt;t t-name="kanban-box"&gt;</p>
			<p class="source-code">      &lt;div <strong class="bold">class="oe_kanban_global_click"</strong>&gt;</p>
			<p class="source-code">        &lt;div class="o_dropdown_kanban dropdown"&gt;</p>
			<p class="source-code"><strong class="bold">          &lt;!-- Top-right drop down menu ... --&gt;</strong></p>
			<p class="source-code">        &lt;/div&gt;</p>
			<p class="source-code">        &lt;div class="oe_kanban_content"&gt;</p>
			<p class="source-code">          &lt;div class="o_kanban_record_title"&gt;</p>
			<p class="source-code"><strong class="bold">            &lt;!-- Title area ... --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;field name="name" /&gt;</strong></p>
			<p class="source-code">          &lt;/div&gt;</p>
			<p class="source-code">          &lt;div class="o_kanban_record_body"&gt;</p>
			<p class="source-code"><strong class="bold">            &lt;!-- Other content area  </strong><strong class="bold">... --&gt;</strong></p>
			<p class="source-code">          &lt;/div&gt;</p>
			<p class="source-code">          &lt;div class="o_kanban_record_bottom"&gt;</p>
			<p class="source-code">            &lt;div class="oe_kanban_bottom_left"&gt;</p>
			<p class="source-code"><strong class="bold">              &lt;!-- Left side footer... --&gt;</strong></p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">            &lt;div class="oe_kanban_bottom_right"&gt;</p>
			<p class="source-code"><strong class="bold">                &lt;!-- Right side footer... --&gt;</strong></p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">          &lt;/div&gt; &lt;!-- o_kanban_record_bottom --&gt;</p>
			<p class="source-code">          &lt;div class="oe_clear"/&gt;</p>
			<p class="source-code">        &lt;/div&gt; &lt;!-- oe_kanban_content --&gt;</p>
			<p class="source-code">      &lt;/div&gt; &lt;!-- oe_kanban_global_click --&gt;</p>
			<p class="source-code">&lt;/t&gt;</p>
			<p>The previous QWeb<a id="_idIndexMarker936"/> template code provides a skeleton for all the areas usually seen in kanban cards.</p>
			<p>When the <strong class="source-inline">t-name</strong> QWeb attribute is used in a <strong class="source-inline">&lt;t&gt;</strong> element, this element can have only one child element. This was the case in the preceding code, and the <strong class="source-inline">&lt;div&gt;</strong> child element must contain all the other kanban view elements.</p>
			<p>It is worth noting that this overarching <strong class="source-inline">&lt;div&gt;</strong> element uses the <strong class="source-inline">class="oe_kanban_global_click"</strong> attribute. This makes the card clickable, and when the user does so, the corresponding form view will be opened in a similar way to what happens<a id="_idIndexMarker937"/> with list views.</p>
			<p>The next task is to focus on each of the highlighted areas and add content to them.</p>
			<h2 id="_idParaDest-332"><a id="_idTextAnchor337"/>Adding a title and other content fields</h2>
			<p>Now that we have a basic <a id="_idIndexMarker938"/>kanban card skeleton, the title and additional <a id="_idIndexMarker939"/>data can be added.</p>
			<p>These will go inside the <strong class="source-inline">&lt;div class="oe_kanban_content"&gt;</strong> element. The skeleton being used has sections for these: the <strong class="source-inline">&lt;div class="o_kanban_record_title"&gt;</strong> and <strong class="source-inline">&lt;div class="o_kanban_record_body"&gt;</strong> elements.</p>
			<p>The following code expands this section to highlight the card title and add the checkout request date and the requesting library member ID:</p>
			<p class="source-code">          &lt;div class="o_kanban_record_title"&gt;</p>
			<p class="source-code"><strong class="bold">            &lt;!-- Title area ... --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;strong&gt;&lt;field name="name" /&gt;&lt;/strong&gt;</strong></p>
			<p class="source-code">          &lt;/div&gt;</p>
			<p class="source-code">          &lt;div class="o_kanban_record_body"&gt;</p>
			<p class="source-code"><strong class="bold">            &lt;!-- Other content area ... --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;div&gt;&lt;fields name="request_date" /&gt;&lt;/div&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;div&gt;</strong></p>
			<p class="source-code"><strong class="bold">              &lt;field name="member_id" </strong></p>
			<p class="source-code"><strong class="bold">                widget="many2one_avatar"/&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;/div&gt;</strong></p>
			<p class="source-code">          &lt;/div&gt;</p>
			<p>In this case, regular HTML elements can be used. For example, the <strong class="source-inline">&lt;strong&gt;</strong> element was used to highlight the title. Also, <strong class="source-inline">&lt;field&gt;</strong> elements can be used to render field values, which will be rendered using the appropriate formatting in a similar way to what happens in form views. In the previous code, <strong class="source-inline">request_date</strong> uses a <strong class="source-inline">&lt;field&gt;</strong> element, and so its content will be rendered using the Odoo-configured date format. It is wrapped in a <strong class="source-inline">&lt;div&gt;</strong> element so that there is a line break between several fields.</p>
			<p>The <strong class="source-inline">member_id</strong> many-to-one object is<a id="_idIndexMarker940"/> also added by using a specific widget that presents the corresponding avatar image along with the name, <strong class="source-inline">widget="many2one_avatar"</strong>.</p>
			<p>Now that we have added some basic data elements to the card, let's look at the drop-down menu area.</p>
			<h2 id="_idParaDest-333"><a id="_idTextAnchor338"/>Adding the drop-down options menu</h2>
			<p>Kanban cards can have an<a id="_idIndexMarker941"/> options menu on the top-right corner. Common options include being able to edit or delete the record, set a color for the card, or run any action that can be called from a button.</p>
			<p>The following is the baseline HTML code for the options menu to be added to the top of the <strong class="source-inline">oe_kanban_content</strong> element:</p>
			<p class="source-code">        &lt;div class="o_dropdown_kanban dropdown"&gt;</p>
			<p class="source-code">          &lt;!-- Top-right drop down menu ... --&gt;</p>
			<p class="source-code"><strong class="bold">          &lt;a class="dropdown-toggle btn"</strong></p>
			<p class="source-code"><strong class="bold">             role="button" data-toggle="dropdown"</strong></p>
			<p class="source-code"><strong class="bold">             title="Dropdown menu" href="#"&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;span class="fa fa-ellipsis-v" /&gt;</strong></p>
			<p class="source-code"><strong class="bold">          &lt;/a&gt;</strong></p>
			<p class="source-code"><strong class="bold">          &lt;div class="dropdown-menu" role="menu"&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;!-- Edit menu option --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;t t-if="widget.editable"&gt;</strong></p>
			<p class="source-code"><strong class="bold">              &lt;a role="menuitem" type="edit"</strong></p>
			<p class="source-code"><strong class="bold">                 class="dropdown-item"&gt;Edit&lt;/a&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;/t&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;!-- Delete menu option --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            </strong><strong class="bold">&lt;t t-if="widget.deletable"&gt;</strong></p>
			<p class="source-code"><strong class="bold">              &lt;a role="menuitem" type="delete"</strong></p>
			<p class="source-code"><strong class="bold">                 class="dropdown-item"&gt;Delete&lt;/a&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;/t&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;!-- Separator line --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;div role="separator" class=</strong></p>
			<p class="source-code"><strong class="bold">              "dropdown-divider"/&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;!-- Color picker option: --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;ul class="oe_kanban_colorpicker" </strong></p>
			<p class="source-code"><strong class="bold">              </strong><strong class="bold">data-field="color" /&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;!-- Set as Done menu option --&gt;</strong></p>
			<p class="source-code"><strong class="bold">            &lt;a t-if="record.state != 'done'" </strong></p>
			<p class="source-code"><strong class="bold">               role="menuitem" class="dropdown-item"</strong></p>
			<p class="source-code"><strong class="bold">               name="button_done" type="object"&gt;Set </strong></p>
			<p class="source-code"><strong class="bold">               as Done&lt;/a&gt;</strong></p>
			<p class="source-code"><strong class="bold">          &lt;/div&gt;</strong></p>
			<p class="source-code">        &lt;/div&gt;</p>
			<p>Here, there are QWeb expressions using fields that may not be loaded into the view. In particular, the last <strong class="source-inline">t-if</strong> expression uses the record's <strong class="source-inline">state</strong> field. To ensure this field is available in the form, it should be added just after the <strong class="source-inline">&lt;kanban&gt;</strong> element:</p>
			<p class="source-code">&lt;kanban&gt;</p>
			<p class="source-code">  &lt;!-- Field list to ensure is loaded ... --&gt;</p>
			<p class="source-code"><strong class="bold">  &lt;field name="state" /&gt;</strong></p>
			<p>Let's break down the <a id="_idIndexMarker942"/>drop-down menu code and look at the key elements added:</p>
			<ul>
				<li>The ellipsis icon, in an HTML anchor (<strong class="source-inline">&lt;a&gt;</strong>) element, to present the menu button.</li>
				<li>A <strong class="source-inline">&lt;div class="dropdown-menu" role="menu"&gt;</strong> element, containing the menu options.</li>
				<li>The <strong class="bold">Edit</strong> menu item, which is an <strong class="source-inline">&lt;a&gt;</strong> element with <strong class="source-inline">type="edit".</strong></li>
				<li>The <strong class="bold">Delete</strong> menu item, which is an <strong class="source-inline">&lt;a&gt;</strong> element with <strong class="source-inline">type="delete".</strong></li>
				<li>A separator line, using <strong class="source-inline">&lt;div role="separator" class="dropdown-divider"/&gt;.</strong></li>
				<li>A color picker menu option added with a <strong class="source-inline">&lt;ul class="oe_kanban_colorpicker" /&gt;</strong> element. The <strong class="source-inline">data-field</strong> attribute sets the field used to store the picked color. This capability will be implemented in the next section, so it won't work right now.</li>
				<li>A menu item equivalent to a button click, added with an <strong class="source-inline">&lt;a&gt;</strong> element, featuring the same <strong class="source-inline">name</strong> and <strong class="source-inline">type</strong> attributes used in regular buttons. This particular one uses <strong class="source-inline">name="button_done" type="object"</strong>.</li>
			</ul>
			<p>Some menu items, such as <strong class="bold">Edit</strong> and <strong class="bold">Delete</strong>, are made available only if certain conditions are met. This is done with the <strong class="source-inline">t-if</strong> QWeb directive. This and other QWeb directives are explained in more detail later in this chapter in the <em class="italic">Exploring the QWeb template language</em> section.</p>
			<p>The <strong class="source-inline">widget</strong> global variable represents a <strong class="source-inline">KanbanRecord()</strong> JavaScript object, which is responsible for the rendering of the current kanban card. Two particularly useful properties are <strong class="source-inline">widget.editable</strong> and <strong class="source-inline">widget.deletable</strong>, which allow us to check whether the corresponding actions are available.</p>
			<p>Menu items can be added with additional <strong class="source-inline">&lt;a&gt;</strong> elements in a similar way to the <strong class="bold">Set as Done</strong> option.</p>
			<p>Menu items can<a id="_idIndexMarker943"/> be shown or hidden using a JavaScript expression that can use record field values. For example, the <strong class="bold">Set as Done</strong> option can be set to only be displayed if the <strong class="source-inline">state</strong> field is not set to <strong class="source-inline">done</strong>.</p>
			<p>The color picker menu option uses a special widget that uses a <strong class="source-inline">color</strong> model field to store the picked color. While the color selector is available, we did not add the feature to set the card yet. Let's do this in the next section.</p>
			<h2 id="_idParaDest-334"><a id="_idTextAnchor339"/>Adding a kanban card color indicator</h2>
			<p>Kanban cards can be <a id="_idIndexMarker944"/>set with a user-selected color. This colors a bar on the left side of the card and can be useful to easily locate items.</p>
			<p>The color to apply is selected using a color picker option on the card's menu. This is added with a <strong class="source-inline">&lt;ul class="oe_kanban_colorpicker" data-field="color"/&gt;</strong> element, as shown in the previous section. The <strong class="source-inline">data-field</strong> attribute sets the field to use, which in this case is <strong class="source-inline">color</strong>.</p>
			<p>To add a kanban color card indicator, complete the following steps:</p>
			<ol>
				<li value="1">Add the color field in the <strong class="source-inline">library.checkout</strong> model by editing the <strong class="source-inline">models/library_checkout.py</strong> file as follows:<p class="source-code"># class Checkout(models.Model):</p><p class="source-code"># ...</p><p class="source-code"><strong class="bold">    color = fields.Integer()</strong></p><p>This is a regular integer field. The color picker widget maps the selectable color to numbers.</p></li>
				<li>Now, the color field can be used to set a dynamic CSS style on the kanban cards though QWeb. First, add it to the fields to load by adding the following code:<p class="source-code">&lt;kanban&gt;</p><p class="source-code">  &lt;!-- Field list to ensure is loaded ... --&gt;</p><p class="source-code"><strong class="bold">  &lt;field name="color" /&gt;</strong></p><p class="source-code">  &lt;field name="state" /&gt;</p></li>
				<li>Finally, edit the kanban card top <strong class="source-inline">&lt;div&gt;</strong> element to add the dynamic color style, as shown in the <a id="_idIndexMarker945"/>following code:<p class="source-code">    &lt;t t-name="kanban-box"&gt;</p><p class="source-code">      &lt;div <strong class="bold">t-attf-class="</strong>oe_kanban_global_click</p><p class="source-code"><strong class="bold">         {{!selection_mode ? 'oe_kanban_color_' +</strong></p><p class="source-code"><strong class="bold">           kanban_getcolor(record.color.raw_value) : </strong></p><p class="source-code"><strong class="bold">        ''}}"&gt;</strong></p></li>
			</ol>
			<p>The preceding code uses <strong class="source-inline">t-attf-class</strong> to dynamically calculate a CSS class to apply. A JavaScript expression is declared in a <strong class="source-inline">{{ }}</strong> block to be evaluated and return a style to use, which depends on the <strong class="source-inline">color</strong> field value. This completes the steps to add a kanban color card indicator. </p>
			<p>A few more widgets are available for kanban cards. The next sections show how to use them, where we will add them to the card footer section.</p>
			<h2 id="_idParaDest-335"><a id="_idTextAnchor340"/>Adding priority and activity widgets</h2>
			<p>The priority widget<a id="_idIndexMarker946"/> is displayed as a list of stars that can be clicked to select a priority level. This widget is a <strong class="source-inline">&lt;field&gt;</strong> element with <strong class="source-inline">widget="priority"</strong>. The priority field is a <strong class="source-inline">Selection</strong> field, declaring the several priority levels available.</p>
			<p>The <strong class="source-inline">library.checkout</strong> model needs to be modified to add a priority field. To do this, complete the following steps:</p>
			<ol>
				<li value="1">Edit the <strong class="source-inline">models/library_checkout.py</strong> file as follows:<p class="source-code"># class Checkout(models.Model):</p><p class="source-code"># ...</p><p class="source-code"><strong class="bold">    priority = fields.Selection(</strong></p><p class="source-code"><strong class="bold">        [("0", "High"),</strong></p><p class="source-code"><strong class="bold">         ("1", "Very High"),</strong></p><p class="source-code"><strong class="bold">         ("2", "Critical")],</strong></p><p class="source-code"><strong class="bold">        </strong><strong class="bold">default="0")</strong></p><p>The activity widget is <a id="_idIndexMarker947"/>an indicator for the item's scheduled activities and is presented for the activities field (<strong class="source-inline">&lt;field name="activity_ids"&gt;</strong>) with <strong class="source-inline">widget="kanban_activity"</strong>.</p></li>
				<li>Now, the corresponding <strong class="source-inline">&lt;field&gt;</strong> elements need to be added to the kanban template on the left side. So, insert the priority widget:<p class="source-code">&lt;div class="oe_kanban_footer_left"&gt; </p><p class="source-code">  &lt;!-- Left side footer... --&gt; </p><p class="source-code"><strong class="bold">  &lt;field name="priority" widget="priority"/&gt; </strong></p><p class="source-code"><strong class="bold">  &lt;field name="activity_ids" </strong></p><p class="source-code"><strong class="bold">    widget="kanban_activity"/&gt;</strong></p><p class="source-code">&lt;/div&gt;</p></li>
			</ol>
			<p>The kanban card now has the priority and activity widgets added to the left side of the footer. Next, we will add a few more widgets to the right footer.</p>
			<h2 id="_idParaDest-336"><a id="_idTextAnchor341"/>Adding kanban state and user avatar widgets</h2>
			<p>The kanban state widget<a id="_idIndexMarker948"/> presents a traffic light color for the item. It is a <strong class="source-inline">&lt;field&gt;</strong> element using <strong class="source-inline">widget="kanban_state_selection"</strong>.</p>
			<p>For related user records, a specific widget is available for this: <strong class="source-inline">widget="many2one_avatar_user"</strong>.</p>
			<p>Examples of<a id="_idIndexMarker949"/> both of these will be added to the kanban card right footer, as shown in the following code:</p>
			<p class="source-code">&lt;div class="oe_kanban_footer_right"&gt;</p>
			<p class="source-code">  &lt;!-- Right side footer... --&gt;</p>
			<p class="source-code"><strong class="bold">  &lt;field name="kanban_state"</strong></p>
			<p class="source-code"><strong class="bold">         widget="kanban_state_selection" /&gt;</strong></p>
			<p class="source-code"><strong class="bold">  &lt;field name="user_id"</strong></p>
			<p class="source-code"><strong class="bold">         widget="many2one_avatar_user" /&gt;</strong></p>
			<p class="source-code">&lt;/div&gt;</p>
			<p>The kanban state is added using a <strong class="source-inline">&lt;field&gt;</strong> element with the <strong class="source-inline">kanban_state_selection</strong> widget. </p>
			<p>The user <a id="_idIndexMarker950"/>avatar image is added with the <strong class="source-inline">user_id</strong> field, using the <strong class="source-inline">widget="many2one_avatar_user"</strong> widget.</p>
			<p>One more important topic is using actions on kanban cards, which we will discuss in the following section.</p>
			<h2 id="_idParaDest-337"><a id="_idTextAnchor342"/>Using actions in kanban view elements</h2>
			<p>In QWeb<a id="_idIndexMarker951"/> templates, the <strong class="source-inline">&lt;a&gt;</strong> tag for links can have a <strong class="source-inline">type</strong> attribute. This <a id="_idIndexMarker952"/>sets the type of action the link will perform so that links can act just like buttons in regular forms. So, in addition to the <strong class="source-inline">&lt;button&gt;</strong> elements, the <strong class="source-inline">&lt;a&gt;</strong> tags can also be used to run Odoo actions.</p>
			<p>As is the case in form views, the action type can be set to <strong class="source-inline">action</strong> or <strong class="source-inline">object</strong> and should be accompanied by a <strong class="source-inline">name</strong> attribute that identifies the specific action to execute. Additionally, the following action types are also available:</p>
			<ul>
				<li><strong class="source-inline">open</strong>: This opens the corresponding form view.</li>
				<li><strong class="source-inline">edit</strong>: This opens the corresponding form view directly in edit mode.</li>
				<li><strong class="source-inline">delete</strong>: This deletes the record and removes the item from the kanban view.</li>
			</ul>
			<p>This completes our walkthrough of designing kanban views. Kanban views use the QWeb template language, and a few examples were used here. The next section takes a deep dive into QWeb.</p>
			<h1 id="_idParaDest-338"><a id="_idTextAnchor343"/>Exploring the QWeb template language</h1>
			<p>The QWeb parser looks for <a id="_idIndexMarker953"/>special directives in the templates and replaces them with dynamically generated HTML. These directives are XML element attributes and can be used in any valid tag or element – for example, <strong class="source-inline">&lt;div&gt;</strong>, <strong class="source-inline">&lt;span&gt;</strong>, or <strong class="source-inline">&lt;field&gt;</strong>.</p>
			<p>Sometimes, a QWeb directive needs to be used, but we don't want to place it in any of the XML elements in the template. For these cases, the <strong class="source-inline">&lt;t&gt;</strong> special element can be used. It can have QWeb directives such as <strong class="source-inline">t-if</strong> or <strong class="source-inline">t-foreach</strong>, but it is silent, and it won't have any effect on the final XML/HTML produced.</p>
			<p>The QWeb directives frequently use evaluated expressions to produce different effects that depend on record values. The language used to evaluate these expressions depends on the environment where the QWeb is being executed. There are two different QWeb implementations: <strong class="bold">client-side</strong> <strong class="bold">JavaScript</strong> and <strong class="bold">server-side</strong> <strong class="bold">Python</strong>. Reports and website pages use the server-side Python implementation of QWeb.</p>
			<p>Kanban views use the client-side JavaScript implementation. This means that the QWeb expression used in kanban views should be written using the JavaScript syntax, not Python.</p>
			<p>When displaying a kanban view, the internal steps are roughly as follows:</p>
			<ol>
				<li value="1">Get the XML for the templates to render.</li>
				<li>Call the server <strong class="source-inline">read()</strong> method to get the data for the fields used in the templates.</li>
				<li>Locate the <strong class="source-inline">kanban-box</strong> template and parse it using QWeb to output the final HTML fragments.</li>
				<li>Inject the HTML in the browser display (the <strong class="bold">Document Object Model</strong> (<strong class="bold">DOM</strong>)).</li>
			</ol>
			<p>This is not meant to be technically exact. It's just a mind map that can be useful to understand how things work in kanban views.</p>
			<p>Next, we'll learn about QWeb expression evaluation and explore the available QWeb directives, using examples that will enhance the checkout kanban card.</p>
			<h2 id="_idParaDest-339"><a id="_idTextAnchor344"/>Understanding the QWeb JavaScript evaluation context</h2>
			<p>Many of the QWeb directives <a id="_idIndexMarker954"/>use expressions that are evaluated to produce some result. When used on the client side (as is the case for Kanban views), these expressions are written in JavaScript. They're evaluated in a context that has a few useful variables available.</p>
			<p>A <strong class="source-inline">record</strong> object is available, representing the current record, with the fields requested from the server. The field values can be accessed using either the <strong class="source-inline">raw_value</strong> or <strong class="source-inline">value</strong> attributes:</p>
			<ul>
				<li><strong class="source-inline">raw_value</strong>: This is the value returned by the <strong class="source-inline">read()</strong> server method, so it's more suitable for use in condition expressions.</li>
				<li><strong class="source-inline">value</strong>: This is formatted according to the user settings and is meant to be used for display in the user interface. This is typically useful for date, datetime, float, monetary, and relational fields.</li>
			</ul>
			<p>The QWeb evaluation context can also reference the JavaScript web client instance. To make use of that, a good understanding of the web client architecture is needed. In this chapter, we won't be able to go into detail regarding this. However, for reference purposes, the following identifiers are available in QWeb expression evaluation:</p>
			<ul>
				<li><strong class="source-inline">widget</strong>: This is a reference to the current <strong class="source-inline">KanbanRecord()</strong> widget object and is responsible for the rendering of the current record into a kanban card. It exposes some helper functions we can use.</li>
				<li><strong class="source-inline">record</strong>: This is a shortcut for <strong class="source-inline">widget.record</strong> and provides access to the fields available, using dot notation.</li>
				<li><strong class="source-inline">read_only_mode</strong>: This indicates whether the current view is in read mode (and not in edit mode). It's a shortcut for <strong class="source-inline">widget.view.options.read_only_mode</strong>.</li>
				<li><strong class="source-inline">instance</strong>: This is a reference to the full web client instance.</li>
			</ul>
			<p>Since QWeb templates are written in XML files, there are limitations on the usage of some characters not accepted by the XML format (such as the lower than sign (<strong class="source-inline">&lt;</strong>)). When these characters are needed – for example, to describe JavaScript expressions – escaped alternatives need to be used.</p>
			<p>These are the alternative symbols that are available for inequality operations:</p>
			<ul>
				<li><strong class="source-inline">&amp;lt;</strong> is for less than (<strong class="source-inline">&lt;</strong>).</li>
				<li><strong class="source-inline">&amp;lt;=</strong> is for less than or equal to (<strong class="source-inline">&lt;=</strong>).</li>
				<li><strong class="source-inline">&amp;gt;</strong> is for greater than (<strong class="source-inline">&gt;</strong>).</li>
				<li><strong class="source-inline">&amp;gt;=</strong> is for greater than or equal to (<strong class="source-inline">&gt;=</strong>).</li>
			</ul>
			<p>The preceding<a id="_idIndexMarker955"/> comparison symbols are not specific to Odoo and are part of the XML format standards.</p>
			<p>The previous symbols can be used in QWeb evaluated expressions, and they are often used to calculate text to render for the <strong class="source-inline">t-out</strong> directive, which we will describe in the following section.</p>
			<h2 id="_idParaDest-340"><a id="_idTextAnchor345"/>Using t-out to render values</h2>
			<p>The <strong class="source-inline">&lt;field&gt;</strong> element is <a id="_idIndexMarker956"/>available to render field values, with the <a id="_idIndexMarker957"/>advantage of Odoo taking care of properly formatting the output for us. But this has the limitation of only displaying the field content.</p>
			<p>However, the <strong class="source-inline">t-out</strong> directive can render the result of a code expression as an HTML-escaped value:</p>
			<p class="source-code">&lt;t t-out="'Requested on ${record.request_date.value}'" /&gt;</p>
			<p>The preceding code renders the result of a JavaScript expression. The <strong class="source-inline">record</strong> represents the record retrieved from the Odoo server and provides access to the fields. The <strong class="source-inline">value</strong> property returns properly formatted content, as returned by a <strong class="source-inline">&lt;field&gt;</strong> element. The <strong class="source-inline">raw_value</strong> property returns the unformatted native value.</p>
			<p class="callout-heading">Changes in Odoo 15</p>
			<p class="callout">The <strong class="source-inline">t-out</strong> directive was introduced in <strong class="bold">Odoo</strong> <strong class="bold">15</strong>, and it replaces the discontinued <strong class="source-inline">t-esc</strong> directive, used until <strong class="bold">Odoo</strong> <strong class="bold">14</strong>. The <strong class="source-inline">t-raw</strong> directive was also discontinued. This was previously used to render the raw value without escaping any HTML, and using it carries security risks. </p>
			<h2 id="_idParaDest-341"><a id="_idTextAnchor346"/>Using t-set to assign values to variables</h2>
			<p>For more <a id="_idIndexMarker958"/>complex logic, the result of an expression<a id="_idIndexMarker959"/> can be stored into a variable to use later in the template. This is to be done using the <strong class="source-inline">t-set</strong> directive for the variable name to be set, followed by the <strong class="source-inline">t-value</strong> directive with the expression to calculate the value to be assigned.</p>
			<p>As an example, the following code renders the title in red if the request has no lines yet. It uses a <strong class="source-inline">red_or_black</strong> variable for the CSS class to use, shown as follows:</p>
			<p class="source-code"><strong class="bold">&lt;t t-set="red_or_black"</strong></p>
			<p class="source-code"><strong class="bold">   t-value="record.num_books == 0 ? '' : </strong></p>
			<p class="source-code"><strong class="bold">    'oe_kanban_text_red'"</strong></p>
			<p class="source-code"><strong class="bold">/&gt;</strong></p>
			<p class="source-code">&lt;strong <strong class="bold">t-att-class="red_or_black"</strong>&gt;</p>
			<p class="source-code">  &lt;field name="name" /&gt;</p>
			<p class="source-code">&lt;/strong&gt;</p>
			<p>The previous example has a code expression using the <strong class="source-inline">num_books</strong> field, so we need to ensure it is loaded by adding a <strong class="source-inline">&lt;field name="num_books" /&gt;</strong> element inside the <strong class="source-inline">&lt;kanban&gt;</strong> top element.</p>
			<p>Variables can also be assigned HTML content, as in the following example:</p>
			<p class="source-code">&lt;t t-set="calendar_sign"&gt;</p>
			<p class="source-code">  &lt;i class="fa fa-calendar" title="Calendar" /&gt;</p>
			<p class="source-code">&lt;/t&gt;</p>
			<p class="source-code">&lt;t t-out="calendar_sign" /&gt;</p>
			<p>The previous code assigns the HTML inside to the <strong class="source-inline">calendar_sign</strong> variable and then renders it using the <strong class="source-inline">t-out</strong> directive.</p>
			<h2 id="_idParaDest-342"><a id="_idTextAnchor347"/>Using t-attf- for string substitution of dynamic attributes</h2>
			<p>Our kanban card is <a id="_idIndexMarker960"/>using the <strong class="source-inline">t-attf-</strong> QWeb <a id="_idIndexMarker961"/>directive to dynamically set a class in the top <strong class="source-inline">&lt;div&gt;</strong> element so that the card color depends on the <strong class="source-inline">color</strong> field value. For this, the <strong class="source-inline">t-attf-</strong> QWeb directive was used.</p>
			<p>The <strong class="source-inline">t-attf-</strong> directive dynamically generates tag attributes using string substitution. This allows for parts of larger strings to be generated dynamically, such as URLs or CSS class names.</p>
			<p>The directive looks for expression blocks that will be evaluated and replaced by the results. These are delimited either by <strong class="source-inline">{{</strong> and <strong class="source-inline">}}</strong> or by <strong class="source-inline">#{</strong> and <strong class="source-inline">}</strong>. The content of the blocks can be any valid JavaScript expression and can use any of the variables available for QWeb expressions, such as <strong class="source-inline">record</strong> and <strong class="source-inline">widget</strong>.</p>
			<p>In this case, the <strong class="source-inline">kanban_color()</strong> JavaScript function was used. This is specifically provided to map color index numbers into the CSS class color names.</p>
			<p>As an elaborate example, this directive will be used to dynamically change the color of the request date to be in red letters if the priority is high. For this, the <strong class="source-inline">&lt;field name="request_date"/&gt;</strong> element in the kanban card should be replaced with the following:</p>
			<p class="source-code">&lt;div <strong class="bold">t-attf-</strong>class="oe_kanban_text_{{</p>
			<p class="source-code">  record.priority.raw_value &amp;lt; '2'</p>
			<p class="source-code">  ? 'black' : 'red' }}"&gt;</p>
			<p class="source-code">  &lt;field name="request_date"/&gt;</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p>This results in either <strong class="source-inline">class="oe_kanban_text_red"</strong> or <strong class="source-inline">class="oe_kanban_text_black"</strong>, depending on the priority value. This is evaluated dynamically – that means that when the user clicks on the priority widget to change it, the date color will immediately change.</p>
			<h2 id="_idParaDest-343"><a id="_idTextAnchor348"/>Using t-att- for expressions calculated by dynamic attributes</h2>
			<p>The <strong class="source-inline">t-att-</strong> QWeb directive<a id="_idIndexMarker962"/> can dynamically generate an attribute value from an expression evaluation.</p>
			<p>For example, the formatting effect from the previous section that used the <strong class="source-inline">t-attf-</strong> attribute could alternatively be implemented using <strong class="source-inline">t-att-</strong>. The following code shows this alternative implementation:</p>
			<p class="source-code">&lt;div <strong class="bold">t-att-</strong>class="record.priority.raw_value &amp;lt; '2'</p>
			<p class="source-code">  ? 'oe_kanban_text_black' : 'oe_kanban_text_red'"&gt;</p>
			<p class="source-code">  &lt;field name="request_date"/&gt;</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p>When the expression evaluates to a false-equivalent value, the attribute is not rendered at all. This is important for special HTML attributes such as the <strong class="source-inline">checked</strong> input field.</p>
			<h2 id="_idParaDest-344"><a id="_idTextAnchor349"/>Using t-foreach for loops</h2>
			<p>Iterating through loops is <a id="_idIndexMarker963"/>useful to repeat a particular HTML block. For this, the <strong class="source-inline">t-foreach</strong> directive is used with an expression returning an iterable value. It needs to be accompanied by a <strong class="source-inline">t-as</strong> directive, which sets the variable name for the iteration value.</p>
			<p>This could be used to present the book titles requested in the checkout. This requires a loop on the <strong class="source-inline">lines_ids</strong> field.</p>
			<p>Note that the accessible values for the <strong class="source-inline">line_ids</strong> elements are database IDs and not record objects. This can be confirmed by adding the following code in the <strong class="source-inline">&lt;!-- Other content area  --&gt;</strong> area:</p>
			<p class="source-code">&lt;div&gt;</p>
			<p class="source-code">  &lt;t <strong class="bold">t-foreach="record.line_ids.raw_value" t-as="line"</strong>&gt;</p>
			<p class="source-code">    &lt;t t-out="line" /&gt;;</p>
			<p class="source-code">  &lt;/t&gt;</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p>The <strong class="source-inline">t-foreach</strong> directive accepts a JavaScript expression evaluating to a collection to iterate. <strong class="source-inline">record.&lt;field&gt;.value</strong> returns a representation of a string for the field value, and <strong class="source-inline">record.&lt;field&gt;.raw_value</strong> returns the database-stored values. For a to-many field, this is a list of IDS:</p>
			<ul>
				<li>The <strong class="source-inline">t-as</strong> directive sets the variable name to be used to refer to each iteration value.</li>
				<li>The <strong class="source-inline">t-out</strong> directive evaluates the provided expression – in this case, just the <strong class="source-inline">line</strong> variable name – and renders safely escaped HTML.</li>
			</ul>
			<p>Presenting the record IDs is not very interesting. However, we do have a JavaScript function available to retrieve an image for an ID: <strong class="source-inline">kanban_image()</strong>.</p>
			<p>To use this, first, the<a id="_idIndexMarker964"/> checkout lines need to support an image. For this, the <strong class="source-inline">models/library_checkout_line.py</strong> file should be edited to add a field for the book cover image:</p>
			<p class="source-code">    book_cover = fields.Binary(related="book_id.image")</p>
			<p>Now, this field can be used in the kanban card:</p>
			<p class="source-code">&lt;div&gt;</p>
			<p class="source-code">  &lt;t <strong class="bold">t-foreach="record.line_ids.raw_value" t-as="line"</strong>&gt;</p>
			<p class="source-code">    &lt;t t-out="line" /&gt;;</p>
			<p class="source-code">    &lt;img t-att-src="kanban_image(</p>
			<p class="source-code">      'library.checkout.line', 'book_cover', line)" </p>
			<p class="source-code">      class="oe_avatar" height="60" alt="Cover" /&gt; </p>
			<p class="source-code">  &lt;/t&gt;</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p>The previous code renders an image for the book title in each checkout line.</p>
			<p>If there are many lines, this might be too much content for the kanban card. Since the <strong class="source-inline">t-foreach</strong> object is a JavaScript expression, it can use additional syntax to limit the number of the allowed cover thumbnails. JavaScript arrays have a <strong class="source-inline">slice()</strong> method to extract a subset of elements.</p>
			<p>This can be used to limit the number to the first five elements by using the following variation of the <strong class="source-inline">for</strong> loop:</p>
			<p class="source-code">&lt;t t-foreach="record.line_ids.raw_value.slice(0, 5)" t-as="line&gt;</p>
			<p>The <strong class="source-inline">for</strong> loops have a few helper variables available. These variables are automatically generated and are prefixed by the variable name defined in <strong class="source-inline">t-as</strong>.</p>
			<p>If <strong class="source-inline">t-as="rec"</strong> is used, where <strong class="source-inline">rec</strong> is set as the variable name, the helper variables would be as follows:</p>
			<ul>
				<li><strong class="source-inline">rec_index</strong>: This is the iteration index, starting from zero.</li>
				<li><strong class="source-inline">rec_size</strong>: This is the number of elements of the collection.</li>
				<li><strong class="source-inline">rec_first</strong>: This is true on the first element of the iteration.</li>
				<li><strong class="source-inline">rec_last</strong>: This is true on the last element of the iteration.</li>
				<li><strong class="source-inline">rec_even</strong>: This is true on even indexes.</li>
				<li><strong class="source-inline">rec_odd</strong>: This is true on odd indexes.</li>
				<li><strong class="source-inline">rec_parity</strong>: This is either <strong class="source-inline">odd</strong> or <strong class="source-inline">even</strong>, depending on the current index.</li>
				<li><strong class="source-inline">rec_all</strong>: This represents the object being iterated over.</li>
				<li><strong class="source-inline">rec_value</strong>: This holds the value when iterating through a <strong class="source-inline">{key:value}</strong> dictionary (<strong class="source-inline">rec</strong> holds the key name).</li>
			</ul>
			<p>For example, when<a id="_idIndexMarker965"/> presenting a list of comma-separated values, we would like to avoid a trailing comma. Avoiding rendering it on the last iteration is easy with the help of the <strong class="source-inline">_last</strong> loop variable. Here is an example of this:</p>
			<p class="source-code">&lt;t t-foreach="record.line_ids.raw_value" t-as="rec"&gt;</p>
			<p class="source-code">  &lt;t t-out="rec" /&gt;</p>
			<p class="source-code">  <strong class="bold">&lt;t t-if="!rec_last"&gt;;&lt;/t&gt;</strong></p>
			<p class="source-code">&lt;/t&gt;</p>
			<p>The <strong class="source-inline">rec_last</strong> variable is <strong class="source-inline">true</strong> on the last record. Negating it with <strong class="source-inline">!rec_last</strong> enables printing the comma on all iterations except the last one.</p>
			<h2 id="_idParaDest-345"><a id="_idTextAnchor350"/>Using t-if to apply conditions</h2>
			<p>The <strong class="source-inline">t-if</strong> directive<a id="_idIndexMarker966"/> expects an expression to be evaluated in JavaScript when rendering kanban views on the client side. The tag and its content will be rendered only if the condition evaluates to <strong class="source-inline">true</strong>.</p>
			<p>In our example, it was used in the checkout kanban view to have menu options available depending on some conditions.</p>
			<p>To take another example, we can display the checkout number of books borrowed, but only if the view has any lines. This can be confirmed by adding the following code in the <strong class="source-inline">&lt;!-- Other content area  --&gt;</strong> area:</p>
			<p class="source-code">&lt;div&gt; t-if="record.num_books.raw_value &amp;gt; 0"&gt; </p>
			<p class="source-code">  &lt;field name="num_books"/&gt; books </p>
			<p class="source-code">&lt;/div&gt;&gt;</p>
			<p>Here, we used a <strong class="source-inline">t-if="&lt;expression&gt;"&gt;</strong> attribute to render an element and its content only when the expression used evaluated to <strong class="source-inline">true</strong>. Notice that the condition expression uses the <strong class="source-inline">&amp;gt;</strong> symbol instead of <strong class="source-inline">&gt;</strong> to represent the greater-than operation.</p>
			<p>The <strong class="source-inline">else if</strong> and <strong class="source-inline">else</strong> conditions are also supported with the <strong class="source-inline">t-elif</strong> and <strong class="source-inline">t-else</strong> directives. Here is an example of their use:</p>
			<p class="source-code">&lt;div t-if="record.num_books.raw_value == 0"&gt;</p>
			<p class="source-code">  No books!</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p class="source-code">&lt;div t-elif="record.num_books.raw_value == 1"&gt;</p>
			<p class="source-code">  One book</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p class="source-code">&lt;div t-else=""&gt;</p>
			<p class="source-code">  &lt;field name="num_books"/&gt; books</p>
			<p class="source-code">&lt;/div&gt;</p>
			<p>These conditions are useful to render particular elements on particular cases.</p>
			<p>Another useful feature is the ability to decompose templates into smaller reusable snippets that can be included using <strong class="source-inline">t-call</strong>. The following section explains how this works.</p>
			<h2 id="_idParaDest-346"><a id="_idTextAnchor351"/>Using t-call to call and reuse templates</h2>
			<p>Instead of repeating the same HTML blocks over and over again, building blocks can be used to compose more complex user interface views. QWeb templates can be used as reusable HTML snippets that are inserted into other templates.</p>
			<p>Reusable <a id="_idIndexMarker967"/>templates are defined inside the <strong class="source-inline">&lt;templates&gt;</strong> tag and identified by a top element with <strong class="source-inline">t-name</strong> other than <strong class="source-inline">kanban-box</strong>. These other templates can then be included using the <strong class="source-inline">t-call</strong> directive. This is true for the <a id="_idIndexMarker968"/>templates declared in the same kanban view, somewhere else in the same addon module, or even in a different addon.</p>
			<p>As an example, the book cover list could be isolated in a reusable snippet. For this, another template can be added in the <strong class="source-inline">&lt;templates&gt;</strong> element after the <strong class="source-inline">&lt;t t-name="kanban-box"&gt;</strong> node, as shown in the following example:</p>
			<p class="source-code">&lt;t <strong class="bold">t-name="book_covers"</strong>&gt;</p>
			<p class="source-code">  &lt;div&gt;</p>
			<p class="source-code">    &lt;t t-foreach="record.line_ids.raw_value" t-as="line"&gt;</p>
			<p class="source-code">      &lt;t t-out="line" /&gt;;</p>
			<p class="source-code">      &lt;img t-att-src="kanban_image(</p>
			<p class="source-code">        'library.checkout.line', 'book_cover', line)"</p>
			<p class="source-code">        class="oe_avatar" height="60" alt="Cover" /&gt;</p>
			<p class="source-code">    &lt;/t&gt;</p>
			<p class="source-code">  &lt;/div&gt;</p>
			<p class="source-code">&lt;/t&gt;</p>
			<p>Then, the <strong class="source-inline">t-call</strong> directive can be used to call this template in the <strong class="source-inline">kanban-box</strong> main template:</p>
			<p class="source-code">&lt;t t-call="book_covers" /&gt;</p>
			<p>To call templates defined in other addon modules, the <strong class="source-inline">module.name</strong> full identifier must be used, in a similar way to what happens with other views. For instance, this snippet can be referred to in another module using the <strong class="source-inline">library_checkout.book_covers</strong> full identifier.</p>
			<p>The called template runs in the same context as the caller, so any variable names available in the caller are also available when processing the called template.</p>
			<p>A more elegant <a id="_idIndexMarker969"/>alternative is to pass arguments to the called template. This is<a id="_idIndexMarker970"/> done by setting variables inside the <strong class="source-inline">t-call</strong> tag. These will be evaluated and made available in the sub-template context only, and they won't exist in the caller context.</p>
			<p>As an example, the <strong class="source-inline">books_cover</strong> template could have an argument to set the maximum number of covers to display instead of being hardcoded in the sub-template. First, the <strong class="source-inline">book_covers</strong> template should be edited to replace the fixed limit with a variable, such as <strong class="source-inline">limit</strong>:</p>
			<p class="source-code">&lt;t t-name="book_covers"&gt;</p>
			<p class="source-code">  &lt;div&gt;</p>
			<p class="source-code">    &lt;t t-foreach="record.line_ids.raw_value.<strong class="bold">slice(0, </strong></p>
			<p class="source-code"><strong class="bold">      limit)</strong>"</p>
			<p class="source-code">       t-as="line"&gt;</p>
			<p class="source-code">      &lt;t t-out="line" /&gt;;</p>
			<p class="source-code">      &lt;img t-att-src="kanban_image(</p>
			<p class="source-code">        'library.checkout.line', 'book_cover', line)"</p>
			<p class="source-code">        class="oe_avatar" height="60" alt="Cover" /&gt;</p>
			<p class="source-code">    &lt;/t&gt;</p>
			<p class="source-code">  &lt;/div&gt;</p>
			<p class="source-code">&lt;/t&gt;</p>
			<p>Now, <strong class="source-inline">t-call</strong> must set this variable using a nested <strong class="source-inline">t-set</strong> directive, as shown in the following code:</p>
			<p class="source-code">&lt;t t-call="book_covers"&gt; </p>
			<p class="source-code">  &lt;t t-set="limit" t-value="3" /&gt; </p>
			<p class="source-code">&lt;/t&gt;</p>
			<p>The entire <a id="_idIndexMarker971"/>content inside the <strong class="source-inline">t-call</strong> element is also available to the<a id="_idIndexMarker972"/> sub-template through the <strong class="source-inline">0</strong> magic variable. Instead of argument variables, an HTML code fragment could be added inside the <strong class="source-inline">t-call</strong> element, and then it could be used in the called template with <strong class="source-inline">&lt;t t-out="0" /&gt;</strong>. This is especially useful for building layouts and combining/nesting QWeb templates in a modular way.</p>
			<h2 id="_idParaDest-347"><a id="_idTextAnchor352"/>Using dictionaries and lists to dynamically set attributes</h2>
			<p>We've gone <a id="_idIndexMarker973"/>through the most important QWeb <a id="_idIndexMarker974"/>directives, but there are a few more to be aware of. Now, we'll give a short explanation of them.</p>
			<p>Here, the <strong class="source-inline">t-att-NAME</strong> and <strong class="source-inline">t-attf-NAME</strong> style dynamic tag attributes were introduced. Additionally,  the fixed <strong class="source-inline">t-att</strong> directive can be used. It accepts either a key-value dictionary mapping or a pair (that is, a two-element list).</p>
			<p>For example, consider the following mapping:</p>
			<p class="source-code">&lt;p t-att="{'class': 'oe_bold', 'name': 'Hello'}" /&gt;</p>
			<p>The preceding code produces this result:</p>
			<p class="source-code">&lt;p class="oe_bold" name="Hello" /&gt;</p>
			<p><strong class="source-inline">t-att</strong> can also work with a list or with pairs of values. For example, consider the following:</p>
			<p class="source-code">&lt;p t-att="['class', 'oe_bold']" /&gt;</p>
			<p>The preceding code produces this result:</p>
			<p class="source-code">&lt;p class="oe_bold" /&gt;</p>
			<p>These special ways to assign attributes to elements can be useful in cases where there is some server-side processing, and a resulting dictionary or list can be used on a single <strong class="source-inline">t-att</strong> element to be applied on a template element.</p>
			<p>This completes a reasonable overview of the QWeb template language with a special focus on kanban view applications, although the QWeb language is also used on the server side – for example, it can be used for reports and website pages.</p>
			<p>Not surprisingly, QWeb templates provide an extension mechanism. We will explore this in the next section.</p>
			<h1 id="_idParaDest-348"><a id="_idTextAnchor353"/>Extending kanban views</h1>
			<p>The templates used in <a id="_idIndexMarker975"/>kanban views and reports can be extended in the same way other view types are extended: that is, declare the element to match, possibly using an XPath expression, and use the position attribute to set what the extensions should do (for example, add the new elements after of before the matched element). These techniques are explained in detail in <a href="B16119_04_Final_PD_ePub.xhtml#_idTextAnchor119"><em class="italic">Chapter 4</em></a>, <em class="italic">Extending Modules</em>.</p>
			<p>In practice, kanban views and QWeb templates are more complex than the regular form view, and matching the elements to extend can be tricky.</p>
			<p>Using <strong class="source-inline">&lt;field&gt;</strong> elements as selectors can be difficult. It is common for the same field name to be included more than once in a kanban view: at the beginning, in the field list to load, and then again inside the kanban box template. Since the selector will match the first field element found, the modification won't be applied inside the template, as intended.</p>
			<p>For example, the <strong class="source-inline">//t[@t-name='kanban-box']//field[@name='name']</strong> XPath expression locates any child elements matching <strong class="source-inline">&lt;t t-name="kanban-box"&gt;</strong>, and then it finds any further child elements matching <strong class="source-inline">&lt;field name="name"&gt;</strong>.</p>
			<p>Another challenge is the frequent use of HTML elements with no clear identifier, such as <strong class="source-inline">&lt;div&gt;</strong> or <strong class="source-inline">&lt;span&gt;</strong>. In these cases, XPath expressions with non-trivial matching conditions are needed. For example, the <strong class="source-inline">//div/t/img</strong> XPath expression matches a <strong class="source-inline">&lt;div&gt;&lt;t&gt;&lt;img&gt;</strong> nested sequence of elements.</p>
			<p>The following is an example that extends the <strong class="source-inline">Contacts</strong> kanban view:</p>
			<p class="source-code">&lt;record id="res_partner_kanban_inherit" model="ir.ui.view"&gt; </p>
			<p class="source-code">  &lt;field name="name"&gt;Contact Kanban modification&lt;/field&gt; </p>
			<p class="source-code">  &lt;field name="model"&gt;res.partner&lt;/field&gt; </p>
			<p class="source-code">  &lt;field name="inherit_id" </p>
			<p class="source-code">    ref="base.res_partner_kanban_view" /&gt; </p>
			<p class="source-code">  &lt;field name="arch" type="xml"&gt; </p>
			<p class="source-code">    &lt;xpath</p>
			<p class="source-code">     expr="//t[@t-name=</p>
			<p class="source-code">       'kanban-box']//field[@name='display_name']" </p>
			<p class="source-code">     position="before"&gt; </p>
			<p class="source-code">     &lt;span&gt;Name:&lt;/span&gt; </p>
			<p class="source-code">    &lt;/xpath&gt; </p>
			<p class="source-code">  &lt;/field&gt; </p>
			<p class="source-code">&lt;/record&gt;</p>
			<p>In the previous example, XPath looks for a <strong class="source-inline">&lt;field name="display_name"&gt;</strong> element inside a <strong class="source-inline">&lt;t t-name="kanban-box"&gt;</strong> element. This rules out the same field element outside of the <strong class="source-inline">&lt;templates&gt;</strong> section.</p>
			<p>For complex XPath <a id="_idIndexMarker976"/>expressions, some command-line tools can be helpful to explore the correct syntax to use.</p>
			<p>The <strong class="source-inline">xmllint</strong> command-line utility – from the <strong class="source-inline">libxml2-utils</strong> <strong class="bold">Debian</strong>/<strong class="bold">Ubuntu</strong> package – has an <strong class="source-inline">--xpath</strong> option to perform queries on XML files. Here is an example of using it:</p>
			<p class="source-code">$ xmllint --xpath "//templates//field[@name='name']" library_checkout/views/checkout_view.xml</p>
			<p>Another option is the <strong class="source-inline">xpath</strong> command, from the <strong class="source-inline">libxml-xpath-perl</strong> Debian/Ubuntu package. Here is an example of using it:</p>
			<p class="source-code">$ xpath -e "//templates//field[@name='name']" library_checkout/views/checkout_view.xml</p>
			<p>These tools can be useful to quickly try and test XPath expressions on an XML file.</p>
			<p>Until now, you have seen how to create and extend kanban views. However, these can make use of additional JavaScript and CSS assets for effects. The next section explains how to add these components.</p>
			<h1 id="_idParaDest-349"><a id="_idTextAnchor354"/>Adding CSS and JavaScript assets</h1>
			<p>Kanban views are mostly HTML and make significant use of CSS classes. In this chapter, some standard CSS classes were introduced in the code examples, but modules can also provide their own <a id="_idIndexMarker977"/>CSS.</p>
			<p>The generally used convention is to have the asset files inside the <strong class="source-inline">/static/src</strong> subdirectory.</p>
			<p>Module web assets are declared in a <strong class="source-inline">manifest</strong> file in the <strong class="source-inline">assets</strong> key. This file is set with a dictionary that maps the assets bundle to be extended and the list of assets to add to it.</p>
			<p>This provides the tool to add <a id="_idIndexMarker978"/>web assets to an Odoo module, such as CSS and JavaScript assets. These web asset files provide a structured way to better provide user interface elements for a richer user experience.</p>
			<p>They can then be used in the module's QWeb templates, as discussed throughout the previous sections in this chapter.</p>
			<p>Here is an example for the <strong class="source-inline">library_checkout</strong> addon module. Edit the <strong class="source-inline">__manifest__.py</strong> file to add the following:</p>
			<p class="source-code">    "assets": {</p>
			<p class="source-code">        "web.assets_backend": {</p>
			<p class="source-code">            "library_checkout/static/src/css/checkout.css",</p>
			<p class="source-code">            "library_checkout/static/src/js/checkout.js",</p>
			<p class="source-code">        }</p>
			<p class="source-code">    }</p>
			<p>The previous code adds a CSS and JavaScript file to the <strong class="source-inline">web.assets_backend</strong> assets bundle.</p>
			<p>The main asset bundles available are as follows:</p>
			<ul>
				<li><strong class="source-inline">web.assets_common</strong>: This contains the assets common to the web client, website, and also the point of sale.</li>
				<li><strong class="source-inline">web.assets_backend</strong>: This contains the assets specific to the backend web client.</li>
				<li><strong class="source-inline">web.assets_frontend</strong>: This <a id="_idIndexMarker979"/>contains the assets to be made available for the public<a id="_idIndexMarker980"/> website.</li>
			</ul>
			<p>The <strong class="source-inline">assets</strong> manifest key was introduced in Odoo 15. For previous Odoo versions, assets were declared using XML template inheritance. We will explain this next.</p>
			<h2 id="_idParaDest-350"><a id="_idTextAnchor355"/>Adding assets before Odoo 15</h2>
			<p>In previous <a id="_idIndexMarker981"/>Odoo versions, assets were added using an XML file that extends the asset bundle. The XML file doing this was usually placed inside the <strong class="source-inline">views/</strong> module subdirectory.</p>
			<p>The following example adds a CSS and JavaScript file to the <strong class="source-inline">library_checkout</strong> module. Add the <strong class="source-inline">views/assets.xml</strong> file with the following code:</p>
			<p class="source-code">&lt;odoo&gt; </p>
			<p class="source-code">  &lt;template id="assets_backend" </p>
			<p class="source-code">    <strong class="bold">inherit_id="web.assets_backend"</strong></p>
			<p class="source-code">    name="Library Checkout Kanban Assets" &gt;</p>
			<p class="source-code">    &lt;xpath expr="." position="inside"&gt;</p>
			<p class="source-code">      &lt;link rel="stylesheet"</p>
			<p class="source-code">       href="/library_checkout/static/src/css/checkout.css"</p>
			<p class="source-code">      /&gt;</p>
			<p class="source-code">      &lt;script type="text/javascript"</p>
			<p class="source-code">       src="/library_checkout/static/src/js/checkout.js"&gt;</p>
			<p class="source-code">      &lt;/script&gt;</p>
			<p class="source-code">    &lt;/xpath&gt;</p>
			<p class="source-code">  &lt;/template&gt;</p>
			<p class="source-code">&lt;/odoo&gt;</p>
			<p>As usual, this code <a id="_idIndexMarker982"/>should also be added to the <strong class="source-inline">data</strong> key in the <strong class="source-inline">__manifest__.py</strong> descriptor file.</p>
			<h1 id="_idParaDest-351"><a id="_idTextAnchor356"/>Summary</h1>
			<p>This chapter covered kanban views and demonstrated how they can act as a powerful user interface tool. By now, you should understand kanban boards, and you are equipped with the techniques needed to design kanban views.</p>
			<p>In this chapter, you also explored the QWeb template language that powers kanban views. With the help of the examples in this chapter, you should now know how to use its features.</p>
			<p>As is expected for Odoo, kanban views and QWeb templates can also be extended by other modules in a similar way to other view types. Having read this chapter, you know additional techniques to use this functionality on Kanban views.</p>
			<p>Finally, we also discussed the use of CSS and JavaScript assets in advanced kanban views. We also looked at how these assets must be provided by the modules and must be added to the backend assets. You now know how to implement this. </p>
			<p>The next chapter will continue exploring QWeb, but this time, we'll focus on the server side and see how to design printable reports.</p>
			<h1 id="_idParaDest-352"><a id="_idTextAnchor357"/>Further reading</h1>
			<p>The following reference materials complement the topics discussed in this chapter:</p>
			<ul>
				<li>The official Odoo documentation on QWeb: https://www.odoo.com/documentation/15.0/developer/reference/frontend/qweb.html</li>
				<li>The <strong class="bold">Bootstrap</strong> CSS documentation: https://getbootstrap.com/docs/4.1/getting-started/introduction/</li>
				<li>The <strong class="bold">Font Awesome</strong> icon index: https://fontawesome.com/v4.7.0/icons/</li>
			</ul>
		</div>
	</div></body></html>