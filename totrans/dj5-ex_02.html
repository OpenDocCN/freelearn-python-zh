<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer078">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 class="chapterTitle" id="_idParaDest-81"><span class="koboSpan" id="kobo.2.1">Enhancing Your Blog and Adding Social Features</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the preceding chapter, we learned the main components of Django by developing a simple blog application using views, templates, and URLs. </span><span class="koboSpan" id="kobo.3.2">In this chapter, we will extend the functionalities of the blog application with features that can be found in many blogging platforms nowadays.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will learn the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.5.1">Using canonical URLs for models</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Creating SEO-friendly URLs for posts</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Adding pagination to the post list view</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Building class-based views</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Sending emails with Django</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Using Django forms to share posts via email</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Adding comments to posts using forms from models</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-82"><span class="koboSpan" id="kobo.12.1">Functional overview</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.13.1">Figure 2.1</span></em><span class="koboSpan" id="kobo.14.1"> shows a representation </span><a id="_idIndexMarker165"/><span class="koboSpan" id="kobo.15.1">of the views, templates, and functionalities that will be built in this chapter:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.16.1"><img alt="" role="presentation" src="../Images/B21088_02_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.17.1">Figure 2.1: Diagram of functionalities built in Chapter 2</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">In this chapter, we will add pagination to the post list page to navigate through all posts. </span><span class="koboSpan" id="kobo.18.2">We will also learn </span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.19.1">how to build class-based views with Django and convert the </span><code class="inlineCode"><span class="koboSpan" id="kobo.20.1">post_list</span></code><span class="koboSpan" id="kobo.21.1"> view to a class-based view named </span><code class="inlineCode"><span class="koboSpan" id="kobo.22.1">PostListView</span></code><span class="koboSpan" id="kobo.23.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.24.1">We will create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">post_share</span></code><span class="koboSpan" id="kobo.26.1"> view to share posts via email. </span><span class="koboSpan" id="kobo.26.2">We will use Django forms to share </span><a id="_idIndexMarker167"/><span class="koboSpan" id="kobo.27.1">posts and send email recommendations via </span><strong class="keyWord"><span class="koboSpan" id="kobo.28.1">Simple Mail Transfer Protocol</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.30.1">SMTP</span></strong><span class="koboSpan" id="kobo.31.1">). </span><span class="koboSpan" id="kobo.31.2">To add comments to posts, we will create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.32.1">Comment</span></code><span class="koboSpan" id="kobo.33.1"> model to store comments, and we will build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.34.1">post_comment</span></code><span class="koboSpan" id="kobo.35.1"> view using forms for models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.36.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter02"><span class="url"><span class="koboSpan" id="kobo.37.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter02</span></span></a><span class="koboSpan" id="kobo.38.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.39.1">All Python packages used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.40.1">requirements.txt</span></code><span class="koboSpan" id="kobo.41.1"> file in the source code for the chapter. </span><span class="koboSpan" id="kobo.41.2">You can follow the instructions to install each Python package in the following sections, or you can install all the requirements at once with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.42.1">python -m pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.43.1"> command.</span></p>
<h1 class="heading-1" id="_idParaDest-83"><span class="koboSpan" id="kobo.44.1">Using canonical URLs for models</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.45.1">A website might have different pages that display the same content. </span><span class="koboSpan" id="kobo.45.2">In our application, the initial </span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.46.1">part of the content for each post is displayed both on the post list page and the post detail page. </span><span class="koboSpan" id="kobo.46.2">A canonical URL is the preferred URL for a resource. </span><span class="koboSpan" id="kobo.46.3">You can think of it as the URL of the most representative page for specific content. </span><span class="koboSpan" id="kobo.46.4">There might be different pages on your site that display posts, but there is a single URL that you use as the main URL for a post. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.47.1">Canonical URLs allow you to specify the URL for the master copy of a page. </span><span class="koboSpan" id="kobo.47.2">Django allows you to implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.48.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.49.1"> method in your models to return the canonical URL for the object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.50.1">We will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">post_detail</span></code><span class="koboSpan" id="kobo.52.1"> URL defined in the URL patterns of the application to build the canonical URL for </span><code class="inlineCode"><span class="koboSpan" id="kobo.53.1">Post</span></code><span class="koboSpan" id="kobo.54.1"> objects. </span><span class="koboSpan" id="kobo.54.2">Django provides different URL resolver functions that allow you to build URLs dynamically using their name and any required parameters. </span><span class="koboSpan" id="kobo.54.3">We will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.55.1">reverse()</span></code><span class="koboSpan" id="kobo.56.1"> utility function of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">django.urls</span></code><span class="koboSpan" id="kobo.58.1"> module.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.59.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">models.py</span></code><span class="koboSpan" id="kobo.61.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.62.1">blog</span></code><span class="koboSpan" id="kobo.63.1"> application to import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.64.1">reverse()</span></code><span class="koboSpan" id="kobo.65.1"> function and add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.67.1"> method to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">Post</span></code><span class="koboSpan" id="kobo.69.1"> model as follows. </span><span class="koboSpan" id="kobo.69.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.70.1">from</span></span><span class="koboSpan" id="kobo.71.1"> django.conf </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.72.1">import</span></span><span class="koboSpan" id="kobo.73.1"> settings
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.74.1">from</span></span><span class="koboSpan" id="kobo.75.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.76.1">import</span></span><span class="koboSpan" id="kobo.77.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.78.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.79.1"> django.urls </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.80.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.81.1"> reverse</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.82.1">from</span></span><span class="koboSpan" id="kobo.83.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.84.1">import</span></span><span class="koboSpan" id="kobo.85.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.86.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.87.1">PublishedManager</span></span><span class="koboSpan" id="kobo.88.1">(models.Manager):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.89.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.90.1">get_queryset</span></span><span class="koboSpan" id="kobo.91.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.92.1">self</span></span><span class="koboSpan" id="kobo.93.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.94.1">return</span></span><span class="koboSpan" id="kobo.95.1"> (
            </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.96.1">super</span></span><span class="koboSpan" id="kobo.97.1">().get_queryset().</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.98.1">filter</span></span><span class="koboSpan" id="kobo.99.1">(status=Post.Status.PUBLISHED)
        )
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.100.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.101.1">Post</span></span><span class="koboSpan" id="kobo.102.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.103.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.104.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.105.1">Meta</span></span><span class="koboSpan" id="kobo.106.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.107.1">'-publish'</span></span><span class="koboSpan" id="kobo.108.1">]
        indexes = [
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.109.1">'-publish'</span></span><span class="koboSpan" id="kobo.110.1">]),
        ]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.111.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.112.1">__str__</span></span><span class="koboSpan" id="kobo.113.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.114.1">self</span></span><span class="koboSpan" id="kobo.115.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.116.1">return</span></span><span class="koboSpan" id="kobo.117.1"> self.title
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.118.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.119.1">get_absolute_url</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.120.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.121.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.122.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.123.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.124.1"> reverse(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.125.1">'blog:post_detail'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.126.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.127.1">            args=[self.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.128.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.129.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.130.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.131.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.132.1">reverse()</span></code><span class="koboSpan" id="kobo.133.1"> function will build the URL dynamically using the URL name defined in the URL patterns. </span><span class="koboSpan" id="kobo.133.2">We have used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">blog</span></code><span class="koboSpan" id="kobo.135.1"> namespace followed by a colon and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.136.1">post_detail</span></code><span class="koboSpan" id="kobo.137.1"> URL name. </span><span class="koboSpan" id="kobo.137.2">Remember that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.138.1">blog</span></code><span class="koboSpan" id="kobo.139.1"> namespace is defined in the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.140.1">urls.py</span></code><span class="koboSpan" id="kobo.141.1"> file of the project when including the URL patterns from </span><code class="inlineCode"><span class="koboSpan" id="kobo.142.1">blog.urls</span></code><span class="koboSpan" id="kobo.143.1">. </span><span class="koboSpan" id="kobo.143.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.144.1">post_detail</span></code><span class="koboSpan" id="kobo.145.1"> URL is defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.146.1">urls.py</span></code><span class="koboSpan" id="kobo.147.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.148.1">blog</span></code><span class="koboSpan" id="kobo.149.1"> application. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.150.1">The resulting string, </span><code class="inlineCode"><span class="koboSpan" id="kobo.151.1">blog:post_detail</span></code><span class="koboSpan" id="kobo.152.1">, can be used globally in your project to refer to the post detail URL. </span><span class="koboSpan" id="kobo.152.2">This URL </span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.153.1">has a required parameter, which is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.154.1">id</span></code><span class="koboSpan" id="kobo.155.1"> of the blog post to retrieve. </span><span class="koboSpan" id="kobo.155.2">We have included the </span><code class="inlineCode"><span class="koboSpan" id="kobo.156.1">id</span></code><span class="koboSpan" id="kobo.157.1"> of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.158.1">Post</span></code><span class="koboSpan" id="kobo.159.1"> object as a positional argument by using </span><code class="inlineCode"><span class="koboSpan" id="kobo.160.1">args=[self.id]</span></code><span class="koboSpan" id="kobo.161.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.162.1">You can learn more about the URL’s utility functions at </span><a href="https://docs.djangoproject.com/en/5.0/ref/urlresolvers/"><span class="url"><span class="koboSpan" id="kobo.163.1">https://docs.djangoproject.com/en/5.0/ref/urlresolvers/</span></span></a><span class="koboSpan" id="kobo.164.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.165.1">Let’s replace the post detail URLs in the templates with the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.166.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.167.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.168.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.169.1">blog/post/list.html</span></code><span class="koboSpan" id="kobo.170.1"> file and replace the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.171.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.172.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.173.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.174.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.175.1">"{% url 'blog:post_detail' post.id %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.176.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.177.1">Replace the preceding line with the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.178.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.179.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.180.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.181.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.182.1">"{</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.183.1">{ post.get_absolute_url }</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.184.1">}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.185.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.186.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.187.1">blog/post/list.html</span></code><span class="koboSpan" id="kobo.188.1"> file should now look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.189.1">{% extends "blog/base.html" %}
{% block title %}My Blog{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.190.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.191.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.192.1">&gt;</span></span><span class="koboSpan" id="kobo.193.1">My Blog</span><span class="hljs-tag"><span class="koboSpan" id="kobo.194.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.195.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.196.1">&gt;</span></span><span class="koboSpan" id="kobo.197.1">
  {% for post in posts %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.198.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.199.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.200.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.201.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.202.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.203.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.204.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.205.1">"{{ post.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.206.1">&gt;</span></span><span class="koboSpan" id="kobo.207.1">
        {{ post.title }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.208.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.209.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.210.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.211.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.212.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.213.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.214.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.215.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.216.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.217.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.218.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.219.1">&gt;</span></span><span class="koboSpan" id="kobo.220.1">
      Published {{ post.publish }} by {{ post.author }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.221.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.222.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.223.1">&gt;</span></span><span class="koboSpan" id="kobo.224.1">
    {{ post.body|truncatewords:30|linebreaks }}
  {% endfor %}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.225.1">Open the </span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.226.1">shell prompt and execute the following command to start the development server:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.227.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.228.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1">http://127.0.0.1:8000/blog/</span></code><span class="koboSpan" id="kobo.230.1"> in your browser. </span><span class="koboSpan" id="kobo.230.2">Links to individual blog posts should still work. </span><span class="koboSpan" id="kobo.230.3">Django now builds the post URLs using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.231.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.232.1"> method of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">Post</span></code><span class="koboSpan" id="kobo.234.1"> model.</span></p>
<h1 class="heading-1" id="_idParaDest-84"><span class="koboSpan" id="kobo.235.1">Creating SEO-friendly URLs for posts</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.236.1">The canonical URL for a blog post detail view currently looks like </span><code class="inlineCode"><span class="koboSpan" id="kobo.237.1">/blog/1/</span></code><span class="koboSpan" id="kobo.238.1">. </span><span class="koboSpan" id="kobo.238.2">We will change the </span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.239.1">URL pattern to create SEO-friendly URLs for posts. </span><span class="koboSpan" id="kobo.239.2">We will be using both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.240.1">publish</span></code><span class="koboSpan" id="kobo.241.1"> date and </span><code class="inlineCode"><span class="koboSpan" id="kobo.242.1">slug</span></code><span class="koboSpan" id="kobo.243.1"> values to build the URLs for single posts. </span><span class="koboSpan" id="kobo.243.2">By combining dates, we will make a post detail URL to look like </span><code class="inlineCode"><span class="koboSpan" id="kobo.244.1">/blog/2024/1/1/who-was-django-reinhardt/</span></code><span class="koboSpan" id="kobo.245.1">. </span><span class="koboSpan" id="kobo.245.2">We will provide search engines with friendly URLs to index, containing both the title and date of the post.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.246.1">To retrieve single posts with the combination of publication date and slug, we need to ensure that no post can be stored in the database with the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">slug</span></code><span class="koboSpan" id="kobo.248.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.249.1">publish</span></code><span class="koboSpan" id="kobo.250.1"> date as an existing post. </span><span class="koboSpan" id="kobo.250.2">We will prevent the </span><code class="inlineCode"><span class="koboSpan" id="kobo.251.1">Post</span></code><span class="koboSpan" id="kobo.252.1"> model from storing duplicated posts by defining slugs to be unique for the publication date of the post.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.253.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">models.py</span></code><span class="koboSpan" id="kobo.255.1"> file and add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">unique_for_date</span></code><span class="koboSpan" id="kobo.257.1"> parameter to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">slug</span></code><span class="koboSpan" id="kobo.259.1"> field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">Post</span></code><span class="koboSpan" id="kobo.261.1"> model:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.262.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.263.1">Post</span></span><span class="koboSpan" id="kobo.264.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.265.1"># ...</span></span><span class="koboSpan" id="kobo.266.1">
    slug = models.SlugField(
        max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.267.1">250</span></span><span class="koboSpan" id="kobo.268.1">,
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.269.1">        unique_for_date=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.270.1">'publish'</span></strong></span><span class="koboSpan" id="kobo.271.1">
    )
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.272.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.273.1">By using </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">unique_for_date</span></code><span class="koboSpan" id="kobo.275.1">, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">slug</span></code><span class="koboSpan" id="kobo.277.1"> field is now required to be unique for the date stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.278.1">publish</span></code><span class="koboSpan" id="kobo.279.1"> field. </span><span class="koboSpan" id="kobo.279.2">Note that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">publish</span></code><span class="koboSpan" id="kobo.281.1"> field is an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">DateTimeField</span></code><span class="koboSpan" id="kobo.283.1">, but the check for unique values will be done only against the date (not the time). </span><span class="koboSpan" id="kobo.283.2">Django will prevent you from saving a new post with the same slug as an existing post for a given publication date. </span><span class="koboSpan" id="kobo.283.3">We have now ensured that slugs are unique for the publication date, so we can now retrieve single posts by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.284.1">publish</span></code><span class="koboSpan" id="kobo.285.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">slug</span></code><span class="koboSpan" id="kobo.287.1"> fields.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.288.1">We have </span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.289.1">changed our models, so, let’s create migrations. </span><span class="koboSpan" id="kobo.289.2">Note that </span><code class="inlineCode"><span class="koboSpan" id="kobo.290.1">unique_for_date</span></code><span class="koboSpan" id="kobo.291.1"> is not enforced at the database level, so no database migration is required. </span><span class="koboSpan" id="kobo.291.2">However, Django uses migrations to keep track of all model changes. </span><span class="koboSpan" id="kobo.291.3">We will create a migration just to keep migrations aligned with the current state of the model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.292.1">Run the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.293.1">python manage.py makemigrations blog
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.294.1">You should get the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.295.1">Migrations for 'blog':
    blog/migrations/0002_alter_post_slug.py
    - Alter field slug on post
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.296.1">Django just created the </span><code class="inlineCode"><span class="koboSpan" id="kobo.297.1">0002_alter_post_slug.py</span></code><span class="koboSpan" id="kobo.298.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.299.1">migrations</span></code><span class="koboSpan" id="kobo.300.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.301.1">blog</span></code><span class="koboSpan" id="kobo.302.1"> application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.303.1">Execute the following command in the shell prompt to apply existing migrations:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.304.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.305.1">You will get an output that ends with the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.306.1">Applying blog.0002_alter_post_slug... </span><span class="koboSpan" id="kobo.306.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.307.1">Django will consider that all migrations have been applied and the models are in sync. </span><span class="koboSpan" id="kobo.307.2">No action will be done in the database because </span><code class="inlineCode"><span class="koboSpan" id="kobo.308.1">unique_for_date</span></code><span class="koboSpan" id="kobo.309.1"> is not enforced at the database level.</span></p>
<h2 class="heading-2" id="_idParaDest-85"><span class="koboSpan" id="kobo.310.1">Modifying the URL patterns</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.311.1">Let’s modify </span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.312.1">the URL patterns to use the publication date and slug for the post detail URL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.313.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.314.1">urls.py</span></code><span class="koboSpan" id="kobo.315.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.316.1">blog</span></code><span class="koboSpan" id="kobo.317.1"> application and replace the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.318.1">path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.319.1">'&lt;int:id&gt;/'</span></span><span class="koboSpan" id="kobo.320.1">, views.post_detail, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.321.1">'post_detail'</span></span><span class="koboSpan" id="kobo.322.1">),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.323.1">Replace the preceding line with the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.324.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.325.1">'</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.326.1">&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;/&lt;slug:post&gt;/</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.327.1">'</span></span><span class="koboSpan" id="kobo.328.1">,
    views.post_detail,
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.329.1">'post_detail'</span></span><span class="koboSpan" id="kobo.330.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.331.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">urls.py</span></code><span class="koboSpan" id="kobo.333.1"> file should now look like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.334.1">from</span></span><span class="koboSpan" id="kobo.335.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.336.1">import</span></span><span class="koboSpan" id="kobo.337.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.338.1">from</span></span><span class="koboSpan" id="kobo.339.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.340.1">import</span></span><span class="koboSpan" id="kobo.341.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.342.1">'blog'</span></span><span class="koboSpan" id="kobo.343.1">
urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.344.1"># Post views</span></span><span class="koboSpan" id="kobo.345.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.346.1">''</span></span><span class="koboSpan" id="kobo.347.1">, views.post_list, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.348.1">'post_list'</span></span><span class="koboSpan" id="kobo.349.1">),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.350.1">'</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.351.1">&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;/&lt;slug:post&gt;/</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.352.1">'</span></span><span class="koboSpan" id="kobo.353.1">,
         views.post_detail,
         name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.354.1">'post_detail'</span></span><span class="koboSpan" id="kobo.355.1">
    ),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.356.1">The URL pattern for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.357.1">post_detail</span></code><span class="koboSpan" id="kobo.358.1"> view takes the following arguments:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.359.1">year</span></code><span class="koboSpan" id="kobo.360.1">: This requires an integer</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.361.1">month</span></code><span class="koboSpan" id="kobo.362.1">: This requires an integer</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.363.1">day</span></code><span class="koboSpan" id="kobo.364.1">: This requires an integer</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.365.1">post</span></code><span class="koboSpan" id="kobo.366.1">: This requires a slug (a string that contains only letters, numbers, underscores, or hyphens)</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.367.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.368.1">int</span></code><span class="koboSpan" id="kobo.369.1"> path converter is used for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.370.1">year</span></code><span class="koboSpan" id="kobo.371.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.372.1">month</span></code><span class="koboSpan" id="kobo.373.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.374.1">day</span></code><span class="koboSpan" id="kobo.375.1"> parameters, whereas the </span><code class="inlineCode"><span class="koboSpan" id="kobo.376.1">slug</span></code><span class="koboSpan" id="kobo.377.1"> path converter </span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.378.1">is used for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">post</span></code><span class="koboSpan" id="kobo.380.1"> parameter. </span><span class="koboSpan" id="kobo.380.2">You learned about path converters in the previous chapter. </span><span class="koboSpan" id="kobo.380.3">You can see all path converters provided by Django at </span><a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters"><span class="url"><span class="koboSpan" id="kobo.381.1">https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters</span></span></a><span class="koboSpan" id="kobo.382.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.383.1">Our posts have now an SEO-friendly URL that is built with the date and slug of each post. </span><span class="koboSpan" id="kobo.383.2">Let’s modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">post_detail</span></code><span class="koboSpan" id="kobo.385.1"> view accordingly.</span></p>
<h2 class="heading-2" id="_idParaDest-86"><span class="koboSpan" id="kobo.386.1">Modifying the views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.387.1">We will change the parameters of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.388.1">post_detail</span></code><span class="koboSpan" id="kobo.389.1"> view to match the new URL parameters </span><a id="_idIndexMarker175"/><span class="koboSpan" id="kobo.390.1">and use them to retrieve the corresponding </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">Post</span></code><span class="koboSpan" id="kobo.392.1"> object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.393.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.394.1">views.py</span></code><span class="koboSpan" id="kobo.395.1"> file and edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.396.1">post_detail</span></code><span class="koboSpan" id="kobo.397.1"> view like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.398.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.399.1">post_detail</span></span><span class="koboSpan" id="kobo.400.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.401.1">request, </span></span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.402.1">year, month, day, post</span></strong></span><span class="koboSpan" id="kobo.403.1">):
    post = get_object_or_404(
        Post,
        status=Post.Status.PUBLISHED</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.404.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.405.1">        slug=post,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.406.1">        publish__year=year,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.407.1">        publish__month=month,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.408.1">        publish__day=day)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.409.1">return</span></span><span class="koboSpan" id="kobo.410.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.411.1">'blog/post/detail.html'</span></span><span class="koboSpan" id="kobo.412.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.413.1">'post'</span></span><span class="koboSpan" id="kobo.414.1">: post}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.415.1">We have modified the </span><code class="inlineCode"><span class="koboSpan" id="kobo.416.1">post_detail</span></code><span class="koboSpan" id="kobo.417.1"> view to take the </span><code class="inlineCode"><span class="koboSpan" id="kobo.418.1">year</span></code><span class="koboSpan" id="kobo.419.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.420.1">month</span></code><span class="koboSpan" id="kobo.421.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.422.1">day</span></code><span class="koboSpan" id="kobo.423.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">post</span></code><span class="koboSpan" id="kobo.425.1"> arguments and retrieve a published post with the given slug and publication date. </span><span class="koboSpan" id="kobo.425.2">By adding </span><code class="inlineCode"><span class="koboSpan" id="kobo.426.1">unique_for_date='publish'</span></code><span class="koboSpan" id="kobo.427.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.428.1">slug</span></code><span class="koboSpan" id="kobo.429.1"> field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.430.1">Post</span></code><span class="koboSpan" id="kobo.431.1"> model, we ensured that there would be only one post with a slug for a given date. </span><span class="koboSpan" id="kobo.431.2">Thus, you can retrieve single posts using the date and slug.</span></p>
<h2 class="heading-2" id="_idParaDest-87"><span class="koboSpan" id="kobo.432.1">Modifying the canonical URL for posts</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.433.1">We also </span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.434.1">have to modify the parameters of the canonical URL for blog posts to match the new URL parameters.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.435.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.436.1">models.py</span></code><span class="koboSpan" id="kobo.437.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">blog</span></code><span class="koboSpan" id="kobo.439.1"> application and edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.441.1"> method as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.442.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.443.1">Post</span></span><span class="koboSpan" id="kobo.444.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.445.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.446.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.447.1">get_absolute_url</span></span><span class="koboSpan" id="kobo.448.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.449.1">self</span></span><span class="koboSpan" id="kobo.450.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.451.1">return</span></span><span class="koboSpan" id="kobo.452.1"> reverse(
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.453.1">'blog:post_detail'</span></span><span class="koboSpan" id="kobo.454.1">,
            args=[
                </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.455.1">self.publish.year,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.456.1">                self.publish.month,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.457.1">                self.publish.day,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.458.1">                self.slug</span></strong></span><span class="koboSpan" id="kobo.459.1">
            ]
        )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.460.1">Start the development server by typing the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.461.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.462.1">Next, you can return to your browser and click on one of the post titles to take a look at the detail view of the post. </span><span class="koboSpan" id="kobo.462.2">You should see something like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.463.1"><img alt="" role="presentation" src="../Images/B21088_02_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.464.1">Figure 2.2: The page for the post’s detail view</span></p>
<p class="normal"><span class="koboSpan" id="kobo.465.1">You have designed SEO-friendly URLs for the blog posts. </span><span class="koboSpan" id="kobo.465.2">The URL for a post now looks like </span><code class="inlineCode"><span class="koboSpan" id="kobo.466.1">/blog/2024/1/1/who-was-django-reinhardt/</span></code><span class="koboSpan" id="kobo.467.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.468.1">Now that </span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.469.1">you have implemented SEO-friendly URLs, let’s focus on implementing navigation through posts using pagination.</span></p>
<h1 class="heading-1" id="_idParaDest-88"><span class="koboSpan" id="kobo.470.1">Adding pagination</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.471.1">When you start adding content to your blog, you can easily store tens or hundreds of posts in your </span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.472.1">database. </span><span class="koboSpan" id="kobo.472.2">Instead of displaying all the posts on a single page, you may want to split the list of posts across several pages and include navigation links to the different pages. </span><span class="koboSpan" id="kobo.472.3">This functionality is called pagination, and you can find it in almost every web application that displays long lists of items.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.473.1">For example, Google uses pagination to divide search results across multiple pages. </span><em class="italic"><span class="koboSpan" id="kobo.474.1">Figure 2.3</span></em><span class="koboSpan" id="kobo.475.1"> shows Google’s pagination links for search result pages:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.476.1"><img alt="Icon  Description automatically generated" src="../Images/B21088_02_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.477.1">Figure 2.3: Google pagination links for search result pages</span></p>
<p class="normal"><span class="koboSpan" id="kobo.478.1">Django has a built-in pagination class that allows you to manage paginated data easily. </span><span class="koboSpan" id="kobo.478.2">You can define the number of objects you want to be returned per page and you can retrieve the posts that correspond to the page requested by the user.</span></p>
<h2 class="heading-2" id="_idParaDest-89"><span class="koboSpan" id="kobo.479.1">Adding pagination to the post list view</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.480.1">We will </span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.481.1">add pagination to the list of posts so that users can easily navigate through all posts published on the blog.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.482.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.483.1">views.py</span></code><span class="koboSpan" id="kobo.484.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.485.1">blog</span></code><span class="koboSpan" id="kobo.486.1"> application to import the Django </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">Paginator</span></code><span class="koboSpan" id="kobo.488.1"> class and modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">post_list</span></code><span class="koboSpan" id="kobo.490.1"> view as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.491.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.492.1"> django.core.paginator </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.493.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.494.1"> Paginator</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.495.1">from</span></span><span class="koboSpan" id="kobo.496.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.497.1">import</span></span><span class="koboSpan" id="kobo.498.1"> get_object_or_404, render
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.499.1">from</span></span><span class="koboSpan" id="kobo.500.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.501.1">import</span></span><span class="koboSpan" id="kobo.502.1"> Post
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.503.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.504.1">post_list</span></span><span class="koboSpan" id="kobo.505.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.506.1">request</span></span><span class="koboSpan" id="kobo.507.1">):
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.508.1">post_list</span></strong></span><span class="hljs-params"><span class="koboSpan" id="kobo.509.1"> = Post.published.</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.510.1">all</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.511.1">()</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.512.1"># Pagination with 3 posts per page</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.513.1">    paginator = Paginator(post_list, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.514.1">3</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.515.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.516.1">    page_number = request.GET.get(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.517.1">'page'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.518.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.519.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.520.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.521.1">    posts = paginator.page(page_number)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.522.1">return</span></span><span class="koboSpan" id="kobo.523.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.524.1">'blog/post/list.html'</span></span><span class="koboSpan" id="kobo.525.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.526.1">'posts'</span></span><span class="koboSpan" id="kobo.527.1">: posts}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.528.1">Let’s </span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.529.1">review the new code we have added to the view:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.530.1">We instantiate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.531.1">Paginator</span></code><span class="koboSpan" id="kobo.532.1"> class with the number of objects to return per page. </span><span class="koboSpan" id="kobo.532.2">We will display three posts per page.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.533.1">We retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.534.1">page</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.535.1">GET</span></code><span class="koboSpan" id="kobo.536.1"> HTTP parameter and store it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.537.1">page_number</span></code><span class="koboSpan" id="kobo.538.1"> variable. </span><span class="koboSpan" id="kobo.538.2">This parameter contains the requested page number. </span><span class="koboSpan" id="kobo.538.3">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.539.1">page</span></code><span class="koboSpan" id="kobo.540.1"> parameter is not in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.541.1">GET</span></code><span class="koboSpan" id="kobo.542.1"> parameters of the request, we use the default value </span><code class="inlineCode"><span class="koboSpan" id="kobo.543.1">1</span></code><span class="koboSpan" id="kobo.544.1"> to load the first page of results.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.545.1">We obtain the objects for the desired page by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.546.1">page()</span></code><span class="koboSpan" id="kobo.547.1"> method of </span><code class="inlineCode"><span class="koboSpan" id="kobo.548.1">Paginator</span></code><span class="koboSpan" id="kobo.549.1">. </span><span class="koboSpan" id="kobo.549.2">This method returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.550.1">Page</span></code><span class="koboSpan" id="kobo.551.1"> object that we store in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.552.1">posts</span></code><span class="koboSpan" id="kobo.553.1"> variable.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.554.1">We pass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.555.1">posts</span></code><span class="koboSpan" id="kobo.556.1"> object to the template.</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-90"><span class="koboSpan" id="kobo.557.1">Creating a pagination template</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.558.1">We need </span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.559.1">to create a page navigation for users to browse through the different pages. </span><span class="koboSpan" id="kobo.559.2">In this section, we will create a template to display the pagination links, and we’ll make it generic so that we can reuse the template for any object pagination on our website.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.560.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.561.1">templates/</span></code><span class="koboSpan" id="kobo.562.1"> directory, create a new file and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.563.1">pagination.html</span></code><span class="koboSpan" id="kobo.564.1">. </span><span class="koboSpan" id="kobo.564.2">Add the following HTML code to the file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.565.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.566.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.567.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.568.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.569.1">"pagination"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.570.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.571.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.572.1">span</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.573.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.574.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.575.1">"step-links"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.576.1">&gt;</span></span><span class="koboSpan" id="kobo.577.1">
    {% if page.has_previous %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.578.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.579.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.580.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.581.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.582.1">"?page={{ page.previous_page_number }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.583.1">&gt;</span></span><span class="koboSpan" id="kobo.584.1">Previous</span><span class="hljs-tag"><span class="koboSpan" id="kobo.585.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.586.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.587.1">&gt;</span></span><span class="koboSpan" id="kobo.588.1">
    {% endif %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.589.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.590.1">span</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.591.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.592.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.593.1">"current"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.594.1">&gt;</span></span><span class="koboSpan" id="kobo.595.1">
      Page {{ page.number }} of {{ page.paginator.num_pages }}.
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.596.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.597.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.598.1">&gt;</span></span><span class="koboSpan" id="kobo.599.1">
    {% if page.has_next %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.600.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.601.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.602.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.603.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.604.1">"?page={{ page.next_page_number }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.605.1">&gt;</span></span><span class="koboSpan" id="kobo.606.1">Next</span><span class="hljs-tag"><span class="koboSpan" id="kobo.607.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.608.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.609.1">&gt;</span></span><span class="koboSpan" id="kobo.610.1">
    {% endif %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.611.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.612.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.613.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.614.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.615.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.616.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.617.1">This is the </span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.618.1">generic pagination template. </span><span class="koboSpan" id="kobo.618.2">The template expects to have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.619.1">Page</span></code><span class="koboSpan" id="kobo.620.1"> object in the context to render the previous and next links and to display the current page and total pages of results.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.621.1">Let’s return to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.622.1">blog/post/list.html</span></code><span class="koboSpan" id="kobo.623.1"> template and include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.624.1">pagination.html</span></code><span class="koboSpan" id="kobo.625.1"> template at the bottom of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.626.1">{% content %}</span></code><span class="koboSpan" id="kobo.627.1"> block, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.628.1">{% extends "blog/base.html" %}
{% block title %}My Blog{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.629.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.630.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.631.1">&gt;</span></span><span class="koboSpan" id="kobo.632.1">My Blog</span><span class="hljs-tag"><span class="koboSpan" id="kobo.633.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.634.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.635.1">&gt;</span></span><span class="koboSpan" id="kobo.636.1">
  {% for post in posts %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.637.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.638.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.639.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.640.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.641.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.642.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.643.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.644.1">"{{ post.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.645.1">&gt;</span></span><span class="koboSpan" id="kobo.646.1">
        {{ post.title }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.647.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.648.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.649.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.650.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.651.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.652.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.653.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.654.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.655.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.656.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.657.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.658.1">date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.659.1">&gt;</span></span><span class="koboSpan" id="kobo.660.1">
      Published {{ post.publish }} by {{ post.author }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.661.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.662.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.663.1">&gt;</span></span><span class="koboSpan" id="kobo.664.1">
    {{ post.body|truncatewords:30|linebreaks }}
  {% endfor %}
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.665.1">{% include "pagination.html" with page=posts %}</span></strong></span><span class="koboSpan" id="kobo.666.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.667.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">{% include %}</span></code><span class="koboSpan" id="kobo.669.1"> template tag loads the given template and renders it using the current template context. </span><span class="koboSpan" id="kobo.669.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.670.1">with</span></code><span class="koboSpan" id="kobo.671.1"> to pass additional context variables to the template. </span><span class="koboSpan" id="kobo.671.2">The pagination template uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.672.1">page</span></code><span class="koboSpan" id="kobo.673.1"> variable to render, while the </span><code class="inlineCode"><span class="koboSpan" id="kobo.674.1">Page</span></code><span class="koboSpan" id="kobo.675.1"> object that we </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.676.1">pass from our view to the template is called </span><code class="inlineCode"><span class="koboSpan" id="kobo.677.1">posts</span></code><span class="koboSpan" id="kobo.678.1">. </span><span class="koboSpan" id="kobo.678.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.679.1">with page=posts</span></code><span class="koboSpan" id="kobo.680.1"> to pass the variable expected by the pagination template. </span><span class="koboSpan" id="kobo.680.2">You can follow this method to use the pagination template for any type of object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.681.1">Start the development server by typing the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.682.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.683.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.684.1">http://127.0.0.1:8000/admin/blog/post/</span></code><span class="koboSpan" id="kobo.685.1"> in your browser and use the administration site to create a total of four different posts. </span><span class="koboSpan" id="kobo.685.2">Make sure to set the status to </span><strong class="screenText"><span class="koboSpan" id="kobo.686.1">Published</span></strong><strong class="keyWord"> </strong><span class="koboSpan" id="kobo.687.1">for all of them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.688.1">Now, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.689.1">http://127.0.0.1:8000/blog/</span></code><span class="koboSpan" id="kobo.690.1"> in your browser. </span><span class="koboSpan" id="kobo.690.2">You should see the first three posts in reverse chronological order, and then the navigation links at the bottom of the post list like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.691.1"><img alt="" role="presentation" src="../Images/B21088_02_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.692.1">Figure 2.4: The post list page including pagination</span></p>
<p class="normal"><span class="koboSpan" id="kobo.693.1">If you </span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.694.1">click on </span><strong class="screenText"><span class="koboSpan" id="kobo.695.1">Next</span></strong><span class="koboSpan" id="kobo.696.1">, you will see the last post. </span><span class="koboSpan" id="kobo.696.2">The URL for the second page contains the </span><code class="inlineCode"><span class="koboSpan" id="kobo.697.1">?page=2</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.698.1">GET</span></code><span class="koboSpan" id="kobo.699.1"> parameter. </span><span class="koboSpan" id="kobo.699.2">This parameter is used by the view to load the requested page of results using the paginator.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.700.1"><img alt="" role="presentation" src="../Images/B21088_02_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.701.1">Figure 2.5: The second page of results</span></p>
<p class="normal"><span class="koboSpan" id="kobo.702.1">Great! </span><span class="koboSpan" id="kobo.702.2">The pagination </span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.703.1">links are working as expected.</span></p>
<h2 class="heading-2" id="_idParaDest-91"><span class="koboSpan" id="kobo.704.1">Handling pagination errors</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.705.1">Now that the pagination is working, we can add exception handling for pagination errors in the view. </span><span class="koboSpan" id="kobo.705.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.706.1">page</span></code><span class="koboSpan" id="kobo.707.1"> parameter used by the view to retrieve the given page could potentially </span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.708.1">be used with wrong values, such as non-existing page numbers or a string value that cannot be used as a page number. </span><span class="koboSpan" id="kobo.708.2">We will implement appropriate error handling for those cases.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.709.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.710.1">http://127.0.0.1:8000/blog/?page=3</span></code><span class="koboSpan" id="kobo.711.1"> in your browser. </span><span class="koboSpan" id="kobo.711.2">You should see the following error page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.712.1"><img alt="" role="presentation" src="../Images/B21088_02_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.713.1">Figure 2.6: The EmptyPage error page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.714.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.715.1">Paginator</span></code><span class="koboSpan" id="kobo.716.1"> object throws an </span><code class="inlineCode"><span class="koboSpan" id="kobo.717.1">EmptyPage</span></code><span class="koboSpan" id="kobo.718.1"> exception when retrieving page </span><code class="inlineCode"><span class="koboSpan" id="kobo.719.1">3</span></code><span class="koboSpan" id="kobo.720.1"> because it’s out of range. </span><span class="koboSpan" id="kobo.720.2">There are no results to display. </span><span class="koboSpan" id="kobo.720.3">Let’s handle this error in our view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.721.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1">views.py</span></code><span class="koboSpan" id="kobo.723.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.724.1">blog</span></code><span class="koboSpan" id="kobo.725.1"> application to add the necessary imports and modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.726.1">post_list</span></code><span class="koboSpan" id="kobo.727.1"> view as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.728.1">from</span></span><span class="koboSpan" id="kobo.729.1"> django.core.paginator </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.730.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.731.1">EmptyPage,</span></strong></span><span class="koboSpan" id="kobo.732.1"> Paginator
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.733.1">from</span></span><span class="koboSpan" id="kobo.734.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.735.1">import</span></span><span class="koboSpan" id="kobo.736.1"> get_object_or_404, render
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.737.1">from</span></span><span class="koboSpan" id="kobo.738.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.739.1">import</span></span><span class="koboSpan" id="kobo.740.1"> Post
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.742.1">post_list</span></span><span class="koboSpan" id="kobo.743.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.744.1">request</span></span><span class="koboSpan" id="kobo.745.1">):
    post_list = Post.published.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.746.1">all</span></span><span class="koboSpan" id="kobo.747.1">()
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.748.1"># Pagination with 3 posts per page</span></span><span class="koboSpan" id="kobo.749.1">
    paginator = Paginator(post_list, </span><span class="hljs-number"><span class="koboSpan" id="kobo.750.1">3</span></span><span class="koboSpan" id="kobo.751.1">)
    page_number = request.GET.get(</span><span class="hljs-string"><span class="koboSpan" id="kobo.752.1">'page'</span></span><span class="koboSpan" id="kobo.753.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.754.1">1</span></span><span class="koboSpan" id="kobo.755.1">)
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.756.1">try</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.757.1">:</span></strong></span><span class="koboSpan" id="kobo.758.1">
        posts = paginator.page(page_number)
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.759.1">except</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.760.1"> EmptyPage:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.761.1"># If page_number is out of range get last page of results</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.762.1">        posts = paginator.page(paginator.num_pages)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.763.1">return</span></span><span class="koboSpan" id="kobo.764.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.765.1">'blog/post/list.html'</span></span><span class="koboSpan" id="kobo.766.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.767.1">'posts'</span></span><span class="koboSpan" id="kobo.768.1">: posts}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.769.1">We have added </span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.770.1">a try and except block to manage the </span><code class="inlineCode"><span class="koboSpan" id="kobo.771.1">EmptyPage</span></code><span class="koboSpan" id="kobo.772.1"> exception when retrieving a page. </span><span class="koboSpan" id="kobo.772.2">If the page requested is out of range, we return the last page of results. </span><span class="koboSpan" id="kobo.772.3">We get the total number of pages with </span><code class="inlineCode"><span class="koboSpan" id="kobo.773.1">paginator.num_pages</span></code><span class="koboSpan" id="kobo.774.1">. </span><span class="koboSpan" id="kobo.774.2">The total number of pages is the same as the last page number.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.775.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.776.1">http://127.0.0.1:8000/blog/?page=3</span></code><span class="koboSpan" id="kobo.777.1"> in your browser again. </span><span class="koboSpan" id="kobo.777.2">Now, the exception is managed by the view, and the last page of results is returned as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.778.1"><img alt="" role="presentation" src="../Images/B21088_02_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.779.1">Figure 2.7: The last page of results</span></p>
<p class="normal"><span class="koboSpan" id="kobo.780.1">Our view </span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.781.1">should also handle the case when something different than an integer is passed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.782.1">page</span></code><span class="koboSpan" id="kobo.783.1"> parameter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.784.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1">http://127.0.0.1:8000/blog/?page=asdf</span></code><span class="koboSpan" id="kobo.786.1"> in your browser. </span><span class="koboSpan" id="kobo.786.2">You should see the following error page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.787.1"><img alt="" role="presentation" src="../Images/B21088_02_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.788.1">Figure 2.8: The PageNotAnInteger error page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.789.1">In this case, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.790.1">Paginator</span></code><span class="koboSpan" id="kobo.791.1"> object throws a </span><code class="inlineCode"><span class="koboSpan" id="kobo.792.1">PageNotAnInteger</span></code><span class="koboSpan" id="kobo.793.1"> exception when retrieving the page </span><code class="inlineCode"><span class="koboSpan" id="kobo.794.1">asdf</span></code><span class="koboSpan" id="kobo.795.1"> because page numbers can only be integers. </span><span class="koboSpan" id="kobo.795.2">Let’s handle this error in our view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.796.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.797.1">views.py</span></code><span class="koboSpan" id="kobo.798.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.799.1">blog</span></code><span class="koboSpan" id="kobo.800.1"> application to add the necessary imports and modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.801.1">post_list</span></code><span class="koboSpan" id="kobo.802.1"> view as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.803.1">from</span></span><span class="koboSpan" id="kobo.804.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.805.1">import</span></span><span class="koboSpan" id="kobo.806.1"> get_object_or_404, render
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.807.1">from</span></span><span class="koboSpan" id="kobo.808.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.809.1">import</span></span><span class="koboSpan" id="kobo.810.1"> Post
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.811.1">from</span></span><span class="koboSpan" id="kobo.812.1"> django.core.paginator </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.813.1">import</span></span><span class="koboSpan" id="kobo.814.1"> EmptyPage</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.815.1">, PageNotAnInteger</span></strong></span><span class="koboSpan" id="kobo.816.1">, Paginator
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.818.1">post_list</span></span><span class="koboSpan" id="kobo.819.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.820.1">request</span></span><span class="koboSpan" id="kobo.821.1">):
    post_list = Post.published.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.822.1">all</span></span><span class="koboSpan" id="kobo.823.1">()
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.824.1"># Pagination with 3 posts per page</span></span><span class="koboSpan" id="kobo.825.1">
    paginator = Paginator(post_list, </span><span class="hljs-number"><span class="koboSpan" id="kobo.826.1">3</span></span><span class="koboSpan" id="kobo.827.1">)
    page_number = request.GET.get(</span><span class="hljs-string"><span class="koboSpan" id="kobo.828.1">'page'</span></span><span class="koboSpan" id="kobo.829.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.830.1">try</span></span><span class="koboSpan" id="kobo.831.1">:
        posts = paginator.page(page_number)
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.832.1">except</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.833.1"> PageNotAnInteger:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.834.1"># If page_number is not an integer get the first page</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.835.1">        posts = paginator.page(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.836.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.837.1">)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.838.1">except</span></span><span class="koboSpan" id="kobo.839.1"> EmptyPage:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.840.1"># If page_number is out of range get last page of results</span></span><span class="koboSpan" id="kobo.841.1">
        posts = paginator.page(paginator.num_pages)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.842.1">return</span></span><span class="koboSpan" id="kobo.843.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.844.1">'blog/post/list.html'</span></span><span class="koboSpan" id="kobo.845.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.846.1">'posts'</span></span><span class="koboSpan" id="kobo.847.1">: posts}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.848.1">We have </span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.849.1">added a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.850.1">except</span></code><span class="koboSpan" id="kobo.851.1"> block to manage the </span><code class="inlineCode"><span class="koboSpan" id="kobo.852.1">PageNotAnInteger</span></code><span class="koboSpan" id="kobo.853.1"> exception when retrieving a page. </span><span class="koboSpan" id="kobo.853.2">If the page requested is not an integer, we return the first page of results.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.854.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.855.1">http://127.0.0.1:8000/blog/?page=asdf</span></code><span class="koboSpan" id="kobo.856.1"> in your browser again. </span><span class="koboSpan" id="kobo.856.2">Now, the exception is managed by the view and the first page of results is returned as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.857.1"><img alt="" role="presentation" src="../Images/B21088_02_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.858.1">Figure 2.9: The first page of results</span></p>
<p class="normal"><span class="koboSpan" id="kobo.859.1">The pagination </span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.860.1">for blog posts is now fully implemented.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.861.1">You can </span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.862.1">learn more about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.863.1">Paginator</span></code><span class="koboSpan" id="kobo.864.1"> class at </span><a href="https://docs.djangoproject.com/en/5.0/ref/paginator/"><span class="url"><span class="koboSpan" id="kobo.865.1">https://docs.djangoproject.com/en/5.0/ref/paginator/</span></span></a><span class="koboSpan" id="kobo.866.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.867.1">Having learned how to paginate your blog, we will now turn to transforming the </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1">post_list</span></code><span class="koboSpan" id="kobo.869.1"> view into an equivalent view that is built using Django generic views and built-in pagination.</span></p>
<h1 class="heading-1" id="_idParaDest-92"><span class="koboSpan" id="kobo.870.1">Building class-based views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.871.1">We have built the blog application using function-based views. </span><span class="koboSpan" id="kobo.871.2">Function-based views are simple and powerful, but Django also allows you to build views using classes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.872.1">Class-based </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.873.1">views are an alternative way to implement views as Python objects instead of functions. </span><span class="koboSpan" id="kobo.873.2">Since a view is a function that takes a web request and returns a web response, you can also define your views as class methods. </span><span class="koboSpan" id="kobo.873.3">Django provides base view classes that you can use to implement your own views. </span><span class="koboSpan" id="kobo.873.4">All of them inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">View</span></code><span class="koboSpan" id="kobo.875.1"> class, which handles HTTP method dispatching and other common functionalities.</span></p>
<h2 class="heading-2" id="_idParaDest-93"><span class="koboSpan" id="kobo.876.1">Why use class-based views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.877.1">Class-based </span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.878.1">views offer some advantages over function-based views that are useful for specific use cases. </span><span class="koboSpan" id="kobo.878.2">Class-based views allow you to:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.879.1">Organize code related to HTTP methods, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.880.1">GET</span></code><span class="koboSpan" id="kobo.881.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">POST</span></code><span class="koboSpan" id="kobo.883.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">PUT</span></code><span class="koboSpan" id="kobo.885.1">, in separate methods, instead of using conditional branching</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.886.1">Use multiple inheritance to create reusable view classes (also known as </span><em class="italic"><span class="koboSpan" id="kobo.887.1">mixins</span></em><span class="koboSpan" id="kobo.888.1">)</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-94"><span class="koboSpan" id="kobo.889.1">Using a class-based view to list posts</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.890.1">To understand how to write class-based views, we will create a new class-based view that is </span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.891.1">equivalent to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.892.1">post_list</span></code><span class="koboSpan" id="kobo.893.1"> view. </span><span class="koboSpan" id="kobo.893.2">We will create a class that will inherit from the generic </span><code class="inlineCode"><span class="koboSpan" id="kobo.894.1">ListView</span></code><span class="koboSpan" id="kobo.895.1"> view offered by Django. </span><code class="inlineCode"><span class="koboSpan" id="kobo.896.1">ListView</span></code><span class="koboSpan" id="kobo.897.1"> allows you to list any type of object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.898.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1">views.py</span></code><span class="koboSpan" id="kobo.900.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">blog</span></code><span class="koboSpan" id="kobo.902.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.903.1">from</span></span><span class="koboSpan" id="kobo.904.1"> django.views.generic </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.905.1">import</span></span><span class="koboSpan" id="kobo.906.1"> ListView
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.908.1">PostListView</span></span><span class="koboSpan" id="kobo.909.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.910.1">ListView</span></span><span class="koboSpan" id="kobo.911.1">):
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.912.1">"""</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.913.1">    Alternative post list view</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.914.1">    """</span></span><span class="koboSpan" id="kobo.915.1">
    queryset = Post.published.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.916.1">all</span></span><span class="koboSpan" id="kobo.917.1">()
    context_object_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.918.1">'posts'</span></span><span class="koboSpan" id="kobo.919.1">
    paginate_by = </span><span class="hljs-number"><span class="koboSpan" id="kobo.920.1">3</span></span><span class="koboSpan" id="kobo.921.1">
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.922.1">'blog/post/list.html'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.923.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.924.1">PostListView</span></code><span class="koboSpan" id="kobo.925.1"> view is analogous to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.926.1">post_list</span></code><span class="koboSpan" id="kobo.927.1"> view we built previously. </span><span class="koboSpan" id="kobo.927.2">We have implemented a class-based view that inherits from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.928.1">ListView</span></code><span class="koboSpan" id="kobo.929.1"> class. </span><span class="koboSpan" id="kobo.929.2">We have defined a view with the following attributes:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.930.1">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.931.1">queryset</span></code><span class="koboSpan" id="kobo.932.1"> to use a custom QuerySet instead of retrieving all objects. </span><span class="koboSpan" id="kobo.932.2">Instead of defining a </span><code class="inlineCode"><span class="koboSpan" id="kobo.933.1">queryset</span></code><span class="koboSpan" id="kobo.934.1"> attribute, we could have specified </span><code class="inlineCode"><span class="koboSpan" id="kobo.935.1">model = Post</span></code><span class="koboSpan" id="kobo.936.1"> and Django would have built the generic </span><code class="inlineCode"><span class="koboSpan" id="kobo.937.1">Post.objects.all()</span></code><span class="koboSpan" id="kobo.938.1"> QuerySet for us.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.939.1">We use the context variable </span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1">posts</span></code><span class="koboSpan" id="kobo.941.1"> for the query results. </span><span class="koboSpan" id="kobo.941.2">The default variable is </span><code class="inlineCode"><span class="koboSpan" id="kobo.942.1">object_list</span></code><span class="koboSpan" id="kobo.943.1"> if you don’t specify any </span><code class="inlineCode"><span class="koboSpan" id="kobo.944.1">context_object_name</span></code><span class="koboSpan" id="kobo.945.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.946.1">We define the pagination of results with </span><code class="inlineCode"><span class="koboSpan" id="kobo.947.1">paginate_by</span></code><span class="koboSpan" id="kobo.948.1">, returning three objects per page.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.949.1">We use a custom template to render the page with </span><code class="inlineCode"><span class="koboSpan" id="kobo.950.1">template_name</span></code><span class="koboSpan" id="kobo.951.1">. </span><span class="koboSpan" id="kobo.951.2">If you don’t set a default template, </span><code class="inlineCode"><span class="koboSpan" id="kobo.952.1">ListView</span></code><span class="koboSpan" id="kobo.953.1"> will use </span><code class="inlineCode"><span class="koboSpan" id="kobo.954.1">blog/post_list.html</span></code><span class="koboSpan" id="kobo.955.1"> by default.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.956.1">Now, edit </span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.957.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.958.1">urls.py</span></code><span class="koboSpan" id="kobo.959.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.960.1">blog</span></code><span class="koboSpan" id="kobo.961.1"> application, comment the preceding </span><code class="inlineCode"><span class="koboSpan" id="kobo.962.1">post_list</span></code><span class="koboSpan" id="kobo.963.1"> URL pattern, and add a new URL pattern using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.964.1">PostListView</span></code><span class="koboSpan" id="kobo.965.1"> class, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.966.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.967.1"># Post views</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.968.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.969.1"> path('', views.post_list, name='post_list'),</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.970.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.971.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.972.1">, views.PostListView.as_view(), name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.973.1">'post_list'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.974.1">),</span></strong></span><span class="koboSpan" id="kobo.975.1">
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.976.1">'&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;/&lt;slug:post&gt;/'</span></span><span class="koboSpan" id="kobo.977.1">,
        views.post_detail,
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.978.1">'post_detail'</span></span><span class="koboSpan" id="kobo.979.1">
    ),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.980.1">In order to keep pagination working, we have to use the right page object that is passed to the template. </span><span class="koboSpan" id="kobo.980.2">Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.981.1">ListView</span></code><span class="koboSpan" id="kobo.982.1"> generic view passes the page requested in a variable called </span><code class="inlineCode"><span class="koboSpan" id="kobo.983.1">page_obj</span></code><span class="koboSpan" id="kobo.984.1">. </span><span class="koboSpan" id="kobo.984.2">We have to edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.985.1">post/list.html</span></code><span class="koboSpan" id="kobo.986.1"> template accordingly to include the paginator using the right variable, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.987.1">{% extends "blog/base.html" %}
{% block title %}My Blog{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.988.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.989.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.990.1">&gt;</span></span><span class="koboSpan" id="kobo.991.1">My Blog</span><span class="hljs-tag"><span class="koboSpan" id="kobo.992.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.993.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.994.1">&gt;</span></span><span class="koboSpan" id="kobo.995.1">
  {% for post in posts %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.996.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.997.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.998.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.999.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1000.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1001.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1002.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1003.1">"{{ post.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1004.1">&gt;</span></span><span class="koboSpan" id="kobo.1005.1">
        {{ post.title }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1006.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1007.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1008.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1009.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1010.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1011.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1012.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1013.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1014.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1015.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1016.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1017.1">&gt;</span></span><span class="koboSpan" id="kobo.1018.1">
      Published {{ post.publish }} by {{ post.author }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1019.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1020.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1021.1">&gt;</span></span><span class="koboSpan" id="kobo.1022.1">
    {{ post.body|truncatewords:30|linebreaks }}
  {% endfor %}
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1023.1">{% include "pagination.html" with page=page_obj %}</span></strong></span><span class="koboSpan" id="kobo.1024.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1025.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1026.1">http://127.0.0.1:8000/blog/</span></code><span class="koboSpan" id="kobo.1027.1"> in your browser and verify that the pagination links work </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.1028.1">as expected. </span><span class="koboSpan" id="kobo.1028.2">The behavior of the pagination links should be the same as with the previous </span><code class="inlineCode"><span class="koboSpan" id="kobo.1029.1">post_list</span></code><span class="koboSpan" id="kobo.1030.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1031.1">The exception handling in this case is a bit different. </span><span class="koboSpan" id="kobo.1031.2">If you try to load a page out of range or pass a non-integer value in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1032.1">page</span></code><span class="koboSpan" id="kobo.1033.1"> parameter, the view will return an HTTP response with the status code </span><code class="inlineCode"><span class="koboSpan" id="kobo.1034.1">404</span></code><span class="koboSpan" id="kobo.1035.1"> (page not found) like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1036.1"><img alt="" role="presentation" src="../Images/B21088_02_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1037.1">Figure 2.10: HTTP 404 Page not found response</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1038.1">The exception handling that returns the HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.1039.1">404</span></code><span class="koboSpan" id="kobo.1040.1"> status code is provided by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1041.1">ListView</span></code><span class="koboSpan" id="kobo.1042.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1043.1">This is a </span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.1044.1">simple example of how to write class-based views. </span><span class="koboSpan" id="kobo.1044.2">You will learn more about class-based views in </span><em class="italic"><span class="koboSpan" id="kobo.1045.1">Chapter 13</span></em><span class="koboSpan" id="kobo.1046.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1047.1">Creating a Content Management System</span></em><span class="koboSpan" id="kobo.1048.1">, and successive chapters.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1049.1">You can read an introduction to class-based views at </span><a href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/intro/"><span class="url"><span class="koboSpan" id="kobo.1050.1">https://docs.djangoproject.com/en/5.0/topics/class-based-views/intro/</span></span></a><span class="koboSpan" id="kobo.1051.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1052.1">After learning how to use class-based views and using built-in object pagination, we will implement the functionality for sharing posts by email to engage your blog readers.</span></p>
<h1 class="heading-1" id="_idParaDest-95"><span class="koboSpan" id="kobo.1053.1">Recommending posts by email</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1054.1">We will </span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.1055.1">allow users to share blog posts with others by sending post recommendations via email. </span><span class="koboSpan" id="kobo.1055.2">You will learn how to create forms in Django, handle data submission, and send emails with Django, enhancing your blog with a personal touch.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1056.1">Take a minute to think about how you could use </span><em class="italic"><span class="koboSpan" id="kobo.1057.1">views</span></em><span class="koboSpan" id="kobo.1058.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1059.1">URLs</span></em><span class="koboSpan" id="kobo.1060.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.1061.1">templates</span></em><span class="koboSpan" id="kobo.1062.1"> to create this functionality using what you learned in the preceding chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1063.1">To allow users to share posts via email, we will need to:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1064.1">Create a form for users to fill in their name, their email address, the recipient’s email address, and optional comments</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1065.1">Create a view in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1066.1">views.py</span></code><span class="koboSpan" id="kobo.1067.1"> file that handles the posted data and sends the email</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1068.1">Add a URL pattern for the new view in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1069.1">urls.py</span></code><span class="koboSpan" id="kobo.1070.1"> file of the blog application</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1071.1">Create a template to display the form</span></li>
</ol>
<h2 class="heading-2" id="_idParaDest-96"><span class="koboSpan" id="kobo.1072.1">Creating forms with Django</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1073.1">Let’s start by building the form to share posts. </span><span class="koboSpan" id="kobo.1073.2">Django has a built-in forms framework that allows </span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.1074.1">you to create forms easily. </span><span class="koboSpan" id="kobo.1074.2">The forms framework makes it simple to define the fields of the form, specify how they have to be displayed, and indicate how they have to validate input data. </span><span class="koboSpan" id="kobo.1074.3">The Django forms framework offers a flexible way to render forms in HTML and handle data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1075.1">Django comes with two base classes to build forms:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1076.1">Form</span></code><span class="koboSpan" id="kobo.1077.1">: This allows you to build standard forms by defining fields and validations.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1">ModelForm</span></code><span class="koboSpan" id="kobo.1079.1">: This allows you to build forms tied to model instances. </span><span class="koboSpan" id="kobo.1079.2">It provides all the functionalities of the base </span><code class="inlineCode"><span class="koboSpan" id="kobo.1080.1">Form</span></code><span class="koboSpan" id="kobo.1081.1"> class, but form fields can be explicitly declared, or automatically generated, from model fields. </span><span class="koboSpan" id="kobo.1081.2">The form can be used to create or edit model instances.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1082.1">First, create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1083.1">forms.py</span></code><span class="koboSpan" id="kobo.1084.1"> file inside the directory of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1085.1">blog</span></code><span class="koboSpan" id="kobo.1086.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1087.1">from</span></span><span class="koboSpan" id="kobo.1088.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1089.1">import</span></span><span class="koboSpan" id="kobo.1090.1"> forms
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1091.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1092.1">EmailPostForm</span></span><span class="koboSpan" id="kobo.1093.1">(forms.Form):
    name = forms.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1094.1">25</span></span><span class="koboSpan" id="kobo.1095.1">)
    email = forms.EmailField()
    to = forms.EmailField()
    comments = forms.CharField(
        required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1096.1">False</span></span><span class="koboSpan" id="kobo.1097.1">,
        widget=forms.Textarea
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1098.1">We have defined our first Django form. </span><span class="koboSpan" id="kobo.1098.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1099.1">EmailPostForm</span></code><span class="koboSpan" id="kobo.1100.1"> form inherits from the base </span><code class="inlineCode"><span class="koboSpan" id="kobo.1101.1">Form</span></code><span class="koboSpan" id="kobo.1102.1"> class. </span><span class="koboSpan" id="kobo.1102.2">We use different field types to validate data accordingly.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1103.1">Forms can reside anywhere in your Django project. </span><span class="koboSpan" id="kobo.1103.2">The convention is to place them inside a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1104.1">forms.py</span></code><span class="koboSpan" id="kobo.1105.1"> file for each application.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1106.1">The form contains the following fields:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1107.1">name</span></code><span class="koboSpan" id="kobo.1108.1">: An instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1109.1">CharField</span></code><span class="koboSpan" id="kobo.1110.1"> with a maximum length of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1111.1">25</span></code><span class="koboSpan" id="kobo.1112.1"> characters. </span><span class="koboSpan" id="kobo.1112.2">We will use it for the name of the person sending the post.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1113.1">email</span></code><span class="koboSpan" id="kobo.1114.1">: An instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1115.1">EmailField</span></code><span class="koboSpan" id="kobo.1116.1">. </span><span class="koboSpan" id="kobo.1116.2">We will use the email of the person sending the post recommendation.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1117.1">to</span></code><span class="koboSpan" id="kobo.1118.1">: An instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1119.1">EmailField</span></code><span class="koboSpan" id="kobo.1120.1">. </span><span class="koboSpan" id="kobo.1120.2">We will use the email address of the recipient, who will receive an email recommending the post.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1121.1">comments</span></code><span class="koboSpan" id="kobo.1122.1">: An instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1123.1">CharField</span></code><span class="koboSpan" id="kobo.1124.1">. </span><span class="koboSpan" id="kobo.1124.2">We will use it for comments to include in the post recommendation email. </span><span class="koboSpan" id="kobo.1124.3">We have made this field optional by setting </span><code class="inlineCode"><span class="koboSpan" id="kobo.1125.1">required</span></code><span class="koboSpan" id="kobo.1126.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1127.1">False</span></code><span class="koboSpan" id="kobo.1128.1">, and we have specified a custom widget to render the field.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1129.1">Each field </span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.1130.1">type has a default widget that determines how the field is rendered in HTML. </span><span class="koboSpan" id="kobo.1130.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1131.1">name</span></code><span class="koboSpan" id="kobo.1132.1"> field is an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1133.1">CharField</span></code><span class="koboSpan" id="kobo.1134.1">. </span><span class="koboSpan" id="kobo.1134.2">This type of field is rendered as an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1135.1">&lt;input type="text"&gt;</span></code><span class="koboSpan" id="kobo.1136.1"> HTML element. </span><span class="koboSpan" id="kobo.1136.2">The default widget can be overridden with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1137.1">widget</span></code><span class="koboSpan" id="kobo.1138.1"> attribute. </span><span class="koboSpan" id="kobo.1138.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1139.1">comments</span></code><span class="koboSpan" id="kobo.1140.1"> field, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1">Textarea</span></code><span class="koboSpan" id="kobo.1142.1"> widget to display it as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1143.1">&lt;textarea&gt;</span></code><span class="koboSpan" id="kobo.1144.1"> HTML element instead of the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.1145.1">&lt;input&gt;</span></code><span class="koboSpan" id="kobo.1146.1"> element.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1147.1">Field validation also depends on the field type. </span><span class="koboSpan" id="kobo.1147.2">For example, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1148.1">email</span></code><span class="koboSpan" id="kobo.1149.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1150.1">to</span></code><span class="koboSpan" id="kobo.1151.1"> fields are </span><code class="inlineCode"><span class="koboSpan" id="kobo.1152.1">EmailField</span></code><span class="koboSpan" id="kobo.1153.1"> fields. </span><span class="koboSpan" id="kobo.1153.2">Both fields require a valid email address; the field validation will otherwise raise a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1154.1">forms.ValidationError</span></code><span class="koboSpan" id="kobo.1155.1"> exception and the form will not validate. </span><span class="koboSpan" id="kobo.1155.2">Other parameters are also taken into account for the form field validation, such as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1156.1">name</span></code><span class="koboSpan" id="kobo.1157.1"> field having a maximum length of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1158.1">25</span></code><span class="koboSpan" id="kobo.1159.1"> or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1160.1">comments</span></code><span class="koboSpan" id="kobo.1161.1"> field being optional.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1162.1">These are only some of the field types that Django provides for forms. </span><span class="koboSpan" id="kobo.1162.2">You can find a list of all field types available at </span><a href="https://docs.djangoproject.com/en/5.0/ref/forms/fields/"><span class="url"><span class="koboSpan" id="kobo.1163.1">https://docs.djangoproject.com/en/5.0/ref/forms/fields/</span></span></a><span class="koboSpan" id="kobo.1164.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-97"><span class="koboSpan" id="kobo.1165.1">Handling forms in views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1166.1">We have </span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.1167.1">defined the form to recommend posts via email. </span><span class="koboSpan" id="kobo.1167.2">Now, we need a view to create an instance of the form and handle the form submission.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1168.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">views.py</span></code><span class="koboSpan" id="kobo.1170.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1171.1">blog</span></code><span class="koboSpan" id="kobo.1172.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1173.1">from</span></span><span class="koboSpan" id="kobo.1174.1"> .forms </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1175.1">import</span></span><span class="koboSpan" id="kobo.1176.1"> EmailPostForm
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1177.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1178.1">post_share</span></span><span class="koboSpan" id="kobo.1179.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1180.1">request, post_id</span></span><span class="koboSpan" id="kobo.1181.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1182.1"># Retrieve post by id</span></span><span class="koboSpan" id="kobo.1183.1">
    post = get_object_or_404(
        Post,
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1184.1">id</span></span><span class="koboSpan" id="kobo.1185.1">=post_id,
        status=Post.Status.PUBLISHED
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1186.1">if</span></span><span class="koboSpan" id="kobo.1187.1"> request.method == </span><span class="hljs-string"><span class="koboSpan" id="kobo.1188.1">'POST'</span></span><span class="koboSpan" id="kobo.1189.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1190.1"># Form was submitted</span></span><span class="koboSpan" id="kobo.1191.1">
        form = EmailPostForm(request.POST)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1192.1">if</span></span><span class="koboSpan" id="kobo.1193.1"> form.is_valid():
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1194.1"># Form fields passed validation</span></span><span class="koboSpan" id="kobo.1195.1">
            cd = form.cleaned_data
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1196.1"># ... </span><span class="koboSpan" id="kobo.1196.2">send email</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1197.1">else</span></span><span class="koboSpan" id="kobo.1198.1">:
        form = EmailPostForm()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1199.1">return</span></span><span class="koboSpan" id="kobo.1200.1"> render(
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.1201.1">request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1202.1">'blog/post/share.html'</span></span><span class="koboSpan" id="kobo.1203.1">,
        {
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1204.1">'post'</span></span><span class="koboSpan" id="kobo.1205.1">: post,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1206.1">'form'</span></span><span class="koboSpan" id="kobo.1207.1">: form
        }
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1208.1">We have defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1209.1">post_share</span></code><span class="koboSpan" id="kobo.1210.1"> view that takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1211.1">request</span></code><span class="koboSpan" id="kobo.1212.1"> object and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1213.1">post_id</span></code><span class="koboSpan" id="kobo.1214.1"> variable as parameters. </span><span class="koboSpan" id="kobo.1214.2">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1215.1">get_object_or_404()</span></code><span class="koboSpan" id="kobo.1216.1"> shortcut to retrieve a published post by its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1217.1">id</span></code><span class="koboSpan" id="kobo.1218.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1219.1">We use </span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.1220.1">the same view both for displaying the initial form and processing the submitted data. </span><span class="koboSpan" id="kobo.1220.2">The HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.1221.1">request</span></code><span class="koboSpan" id="kobo.1222.1"> method allows us to differentiate whether the form is being submitted. </span><span class="koboSpan" id="kobo.1222.2">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1223.1">GET</span></code><span class="koboSpan" id="kobo.1224.1"> request will indicate that an empty form has to be displayed to the user and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1225.1">POST</span></code><span class="koboSpan" id="kobo.1226.1"> request will indicate the form is being submitted. </span><span class="koboSpan" id="kobo.1226.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1227.1">request.method == 'POST'</span></code><span class="koboSpan" id="kobo.1228.1"> to differentiate between the two scenarios.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1229.1">This is the process to display the form and handle the form submission:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1230.1">When the page is loaded for the first time, the view receives a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1231.1">GET</span></code><span class="koboSpan" id="kobo.1232.1"> request. </span><span class="koboSpan" id="kobo.1232.2">In this case, a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1233.1">EmailPostForm</span></code><span class="koboSpan" id="kobo.1234.1"> instance is created and stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1235.1">form</span></code><span class="koboSpan" id="kobo.1236.1"> variable. </span><span class="koboSpan" id="kobo.1236.2">This form instance will be used to display the empty form in the template:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1237.1">form = EmailPostForm()
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1238.1">When the user fills in the form and submits it via </span><code class="inlineCode"><span class="koboSpan" id="kobo.1239.1">POST</span></code><span class="koboSpan" id="kobo.1240.1">, a form instance is created using the submitted data contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1241.1">request.POST</span></code><span class="koboSpan" id="kobo.1242.1">:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1243.1">if</span></span><span class="koboSpan" id="kobo.1244.1"> request.method == </span><span class="hljs-string"><span class="koboSpan" id="kobo.1245.1">'POST'</span></span><span class="koboSpan" id="kobo.1246.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1247.1"># Form was submitted</span></span><span class="koboSpan" id="kobo.1248.1">
    form = EmailPostForm(request.POST)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1249.1">After this, the data submitted is validated using the form’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1250.1">is_valid()</span></code><span class="koboSpan" id="kobo.1251.1"> method. </span><span class="koboSpan" id="kobo.1251.2">This method validates the data introduced in the form and returns </span><code class="inlineCode"><span class="koboSpan" id="kobo.1252.1">True</span></code><span class="koboSpan" id="kobo.1253.1"> if all fields contain valid data. </span><span class="koboSpan" id="kobo.1253.2">If any field contains invalid data, then </span><code class="inlineCode"><span class="koboSpan" id="kobo.1254.1">is_valid()</span></code><span class="koboSpan" id="kobo.1255.1"> returns </span><code class="inlineCode"><span class="koboSpan" id="kobo.1256.1">False</span></code><span class="koboSpan" id="kobo.1257.1">. </span><span class="koboSpan" id="kobo.1257.2">The list of validation errors can be obtained with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1258.1">form.errors</span></code><span class="koboSpan" id="kobo.1259.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1260.1">If the form is not valid, the form is rendered in the template again, including the data submitted. </span><span class="koboSpan" id="kobo.1260.2">Validation errors will be displayed in the template.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1261.1">If the </span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.1262.1">form is valid, the validated data is retrieved with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1263.1">form.cleaned_data</span></code><span class="koboSpan" id="kobo.1264.1">. </span><span class="koboSpan" id="kobo.1264.2">This attribute is a dictionary of form fields and their values. </span><span class="koboSpan" id="kobo.1264.3">Forms not only validate the data but also </span><em class="italic"><span class="koboSpan" id="kobo.1265.1">clean</span></em><span class="koboSpan" id="kobo.1266.1"> the data by normalizing it to a consistent format.</span></li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1267.1">If your form data does not validate, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1268.1">cleaned_data</span></code><span class="koboSpan" id="kobo.1269.1"> will contain only the valid fields.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1270.1">We have implemented the view to display the form and handle the form submission. </span><span class="koboSpan" id="kobo.1270.2">We will now learn how to send emails using Django and then we will add that functionality to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1271.1">post_share</span></code><span class="koboSpan" id="kobo.1272.1"> view.</span></p>
<h2 class="heading-2" id="_idParaDest-98"><span class="koboSpan" id="kobo.1273.1">Sending emails with Django</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1274.1">Sending </span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.1275.1">emails with Django is very straightforward. </span><span class="koboSpan" id="kobo.1275.2">You need to have a local SMTP server, or you need to access an external SMTP server, like your email service provider.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1276.1">The following settings allow you to define the SMTP configuration to send emails with Django:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1277.1">EMAIL_HOST</span></code><span class="koboSpan" id="kobo.1278.1">: The SMTP server host; the default is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1279.1">localhost</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1280.1">EMAIL_PORT</span></code><span class="koboSpan" id="kobo.1281.1">: The SMTP port; the default is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1282.1">25</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1283.1">EMAIL_HOST_USER</span></code><span class="koboSpan" id="kobo.1284.1">: The username for the SMTP server</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1285.1">EMAIL_HOST_PASSWORD</span></code><span class="koboSpan" id="kobo.1286.1">: The password for the SMTP server</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1287.1">EMAIL_USE_TLS</span></code><span class="koboSpan" id="kobo.1288.1">: Whether </span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.1289.1">to use a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1290.1">Transport Layer Security</span></strong><span class="koboSpan" id="kobo.1291.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1292.1">TLS</span></strong><span class="koboSpan" id="kobo.1293.1">) secure connection</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">EMAIL_USE_SSL</span></code><span class="koboSpan" id="kobo.1295.1">: Whether to use an implicit TLS secure connection</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1296.1">Additionally, you </span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.1297.1">can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">DEFAULT_FROM_EMAIL</span></code><span class="koboSpan" id="kobo.1299.1"> setting to specify the default sender when sending emails with Django. </span><span class="koboSpan" id="kobo.1299.2">For this example, we will use Google’s SMTP server with a standard Gmail account.</span></p>
<h2 class="heading-2" id="_idParaDest-99"><span class="koboSpan" id="kobo.1300.1">Working with environment variables</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1301.1">We will add SMTP configuration settings to the project, and we will load the SMTP credentials </span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.1302.1">from environment variables. </span><span class="koboSpan" id="kobo.1302.2">By using environment variables, we will avoid embedding credentials in the source code. </span><span class="koboSpan" id="kobo.1302.3">There are multiple reasons to keep configuration separate from the code:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1303.1">Security</span></strong><span class="koboSpan" id="kobo.1304.1">: Credentials or secret keys in the code can lead to unintentional exposure, especially if you push the code to public repositories.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1305.1">Flexibility</span></strong><span class="koboSpan" id="kobo.1306.1">: Keeping the configuration separate will allow you to use the same code base across different environments without any changes. </span><span class="koboSpan" id="kobo.1306.2">You will learn how to build multiple environments in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1307.1">Chapter 17</span></em><span class="koboSpan" id="kobo.1308.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1309.1">Going Live</span></em><span class="koboSpan" id="kobo.1310.1">.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1311.1">Maintainability</span></strong><span class="koboSpan" id="kobo.1312.1">: Changing a configuration won’t require a code change, ensuring that your project remains consistent across versions.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1313.1">To facilitate the separation of configuration from code, we are going to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1314.1">python-decouple</span></code><span class="koboSpan" id="kobo.1315.1">. </span><span class="koboSpan" id="kobo.1315.2">This library simplifies the use of environment variables in your projects. </span><span class="koboSpan" id="kobo.1315.3">You can find information about </span><code class="inlineCode"><span class="koboSpan" id="kobo.1316.1">python-decouple</span></code><span class="koboSpan" id="kobo.1317.1"> at </span><a href="https://github.com/HBNetwork/python-decouple"><span class="url"><span class="koboSpan" id="kobo.1318.1">https://github.com/HBNetwork/python-decouple</span></span></a><span class="koboSpan" id="kobo.1319.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1320.1">First, install </span><code class="inlineCode"><span class="koboSpan" id="kobo.1321.1">python-decouple</span></code><span class="koboSpan" id="kobo.1322.1"> via </span><code class="inlineCode"><span class="koboSpan" id="kobo.1323.1">pip</span></code><span class="koboSpan" id="kobo.1324.1"> by running the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1325.1">python -m pip install python-decouple==3.8
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1326.1">Then, create a new file inside your project’s root directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1327.1">.env</span></code><span class="koboSpan" id="kobo.1328.1">. </span><span class="koboSpan" id="kobo.1328.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1329.1">.env</span></code><span class="koboSpan" id="kobo.1330.1"> file will contain key-value pairs of environment variables. </span><span class="koboSpan" id="kobo.1330.2">Add the following lines to the new file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1331.1">EMAIL_HOST_USER=your_account@gmail.com
EMAIL_HOST_PASSWORD=
DEFAULT_FROM_EMAIL=My Blog &lt;your_account@gmail.com&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1332.1">If you have a Gmail account, replace </span><code class="inlineCode"><span class="koboSpan" id="kobo.1333.1">your_account@gmail.com</span></code><span class="koboSpan" id="kobo.1334.1"> with your Gmail account. </span><span class="koboSpan" id="kobo.1334.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1335.1">EMAIL_HOST_PASSWORD</span></code><span class="koboSpan" id="kobo.1336.1"> variable has no value yet, we will add it later. </span><span class="koboSpan" id="kobo.1336.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1337.1">DEFAULT_FROM_EMAIL</span></code><span class="koboSpan" id="kobo.1338.1"> variable will be used to specify the default sender for our emails. </span><span class="koboSpan" id="kobo.1338.2">If you don’t have a Gmail account, you can use the SMTP credentials for your email service provider.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1339.1">If you </span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.1340.1">are using a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1341.1">git</span></code><span class="koboSpan" id="kobo.1342.1"> repository for your code, make sure to include </span><code class="inlineCode"><span class="koboSpan" id="kobo.1343.1">.env</span></code><span class="koboSpan" id="kobo.1344.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1345.1">.gitignore</span></code><span class="koboSpan" id="kobo.1346.1"> file of your repository. </span><span class="koboSpan" id="kobo.1346.2">By doing so, you ensure that credentials are excluded from the repository.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1347.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1348.1">settings.py</span></code><span class="koboSpan" id="kobo.1349.1"> file of your project and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1350.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1351.1"> decouple </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1352.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1353.1"> config</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1354.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1355.1"># Email server configuration</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1356.1">EMAIL_HOST = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1357.1">'smtp.gmail.com'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1358.1">EMAIL_HOST_USER = config(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1359.1">'EMAIL_HOST_USER'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1360.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1361.1">EMAIL_HOST_PASSWORD = config(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1362.1">'EMAIL_HOST_PASSWORD'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1363.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1364.1">EMAIL_PORT = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1365.1">587</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1366.1">EMAIL_USE_TLS = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1367.1">True</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1368.1">DEFAULT_FROM_EMAIL = config(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1369.1">'DEFAULT_FROM_EMAIL'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1370.1">)</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1371.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1372.1">EMAIL_HOST_USER</span></code><span class="koboSpan" id="kobo.1373.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1374.1">EMAIL_HOST_PASSWORD</span></code><span class="koboSpan" id="kobo.1375.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1376.1">DEFAULT_FROM_EMAIL</span></code><span class="koboSpan" id="kobo.1377.1"> settings are now loaded from environment variables defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1378.1">.env</span></code><span class="koboSpan" id="kobo.1379.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1380.1">The provided </span><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1">EMAIL_HOST</span></code><span class="koboSpan" id="kobo.1382.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1383.1">EMAIL_PORT</span></code><span class="koboSpan" id="kobo.1384.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1385.1">EMAIL_USE_TLS</span></code><span class="koboSpan" id="kobo.1386.1"> settings are for Gmail’s SMTP server. </span><span class="koboSpan" id="kobo.1386.2">If you don’t have a Gmail account, you can use the SMTP server configuration of your email service provider.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1387.1">Instead of Gmail, you can also use a professional, scalable email service that allows you to send emails via SMTP using your own domain, such as SendGrid (</span><a href="https://sendgrid.com/"><span class="url"><span class="koboSpan" id="kobo.1388.1">https://sendgrid.com/</span></span></a><span class="koboSpan" id="kobo.1389.1">) or Amazon </span><strong class="keyWord"><span class="koboSpan" id="kobo.1390.1">Simple Email Service</span></strong><span class="koboSpan" id="kobo.1391.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1392.1">SES</span></strong><span class="koboSpan" id="kobo.1393.1">) (</span><a href="https://aws.amazon.com/ses/"><span class="url"><span class="koboSpan" id="kobo.1394.1">https://aws.amazon.com/ses/</span></span></a><span class="koboSpan" id="kobo.1395.1">). </span><span class="koboSpan" id="kobo.1395.2">Both services will require you to verify your domain and sender email accounts and will provide you with SMTP credentials to send emails. </span><span class="koboSpan" id="kobo.1395.3">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1396.1">django-anymail</span></code><span class="koboSpan" id="kobo.1397.1"> application simplifies the task of adding email service providers to your project like SendGrid or Amazon SES. </span><span class="koboSpan" id="kobo.1397.2">You can find installation instructions for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1398.1">django-anymail</span></code><span class="koboSpan" id="kobo.1399.1"> at </span><a href="https://anymail.dev/en/stable/installation/"><span class="url"><span class="koboSpan" id="kobo.1400.1">https://anymail.dev/en/stable/installation/</span></span></a><span class="koboSpan" id="kobo.1401.1">, and the list of supported email service providers at </span><a href="https://anymail.dev/en/stable/esps/"><span class="url"><span class="koboSpan" id="kobo.1402.1">https://anymail.dev/en/stable/esps/</span></span></a><span class="koboSpan" id="kobo.1403.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1404.1">If you can’t use an SMTP server, you can tell Django to write emails to the console by adding the following setting to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1405.1">settings.py</span></code><span class="koboSpan" id="kobo.1406.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1407.1">EMAIL_BACKEND = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1408.1">'django.core.mail.backends.console.EmailBackend'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1409.1">By using </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.1410.1">this setting, Django will output all emails to the shell instead of sending them. </span><span class="koboSpan" id="kobo.1410.2">This is very useful for testing your application without an SMTP server.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1411.1">In order to send emails with Gmail’s SMTP server, make sure that two-step verification is active in your Gmail account. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1412.1">Open </span><a href="https://myaccount.google.com/security"><span class="url"><span class="koboSpan" id="kobo.1413.1">https://myaccount.google.com/security</span></span></a><span class="koboSpan" id="kobo.1414.1"> in your browser and enable </span><strong class="screenText"><span class="koboSpan" id="kobo.1415.1">2-Step Verification</span></strong><span class="koboSpan" id="kobo.1416.1"> for your account, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1417.1">Figure 2.11</span></em><span class="koboSpan" id="kobo.1418.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1419.1"><img alt="" role="presentation" src="../Images/B21088_02_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1420.1">Figure 2.11: The sign in to Google page for Google accounts</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1421.1">Then, you need to create an app password and use it for your SMTP credentials. </span><span class="koboSpan" id="kobo.1421.2">An app password is a 16-digit passcode that gives a </span><em class="italic"><span class="koboSpan" id="kobo.1422.1">less secure</span></em><span class="koboSpan" id="kobo.1423.1"> app or device permission to access your Google account.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1424.1">To create an app password, open </span><a href="https://myaccount.google.com/apppasswords"><span class="url"><span class="koboSpan" id="kobo.1425.1">https://myaccount.google.com/apppasswords</span></span></a><span class="koboSpan" id="kobo.1426.1"> in your browser. </span><span class="koboSpan" id="kobo.1426.2">You will see the following screen:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1427.1"><img alt="" role="presentation" src="../Images/B21088_02_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1428.1">Figure 2.12: Form to generate a new Google app password</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1429.1">If you cannot access </span><strong class="screenText"><span class="koboSpan" id="kobo.1430.1">App passwords</span></strong><span class="koboSpan" id="kobo.1431.1">, it might be that 2-Step Verification is not set for your account, your account is an organization account instead of a standard Gmail account, or you turned on Google’s advanced protection. </span><span class="koboSpan" id="kobo.1431.2">Make sure to use a standard Gmail </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.1432.1">account and activate 2-Step Verification for your Google account. </span><span class="koboSpan" id="kobo.1432.2">You can find more information at </span><a href="https://support.google.com/accounts/answer/185833"><span class="url"><span class="koboSpan" id="kobo.1433.1">https://support.google.com/accounts/answer/185833</span></span></a><span class="koboSpan" id="kobo.1434.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1435.1">Enter the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.1436.1">Blog</span></code><span class="koboSpan" id="kobo.1437.1"> and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1438.1">Create</span></strong><span class="koboSpan" id="kobo.1439.1"> button, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1440.1"><img alt="" role="presentation" src="../Images/B21088_02_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1441.1">Figure 2.13: Form to generate a new Google app password</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1442.1">A new password will be generated and displayed like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1443.1"><img alt="" role="presentation" src="../Images/B21088_02_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1444.1">Figure 2.14: Generated Google app password</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1445.1">Copy </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.1446.1">the generated app password.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1447.1">Next, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1448.1">.env</span></code><span class="koboSpan" id="kobo.1449.1"> file of your project and add the app password to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1450.1">EMAIL_HOST_PASSWORD</span></code><span class="koboSpan" id="kobo.1451.1"> variable, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1452.1">EMAIL_HOST_USER=your_account@gmail.com
EMAIL_HOST_PASSWORD=</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1453.1">xxxxxxxxxxxxxxxx</span></strong></span><span class="koboSpan" id="kobo.1454.1">
DEFAULT_FROM_EMAIL=My Blog &lt;your_account@gmail.com&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1455.1">Open the Python shell by running the following command in the system shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1456.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1457.1">Execute the following code in the Python shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1458.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1459.1">from</span></span><span class="koboSpan" id="kobo.1460.1"> django.core.mail </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1461.1">import</span></span><span class="koboSpan" id="kobo.1462.1"> send_mail
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1463.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.1464.1"> send_mail(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1465.1">'Django mail'</span></span><span class="koboSpan" id="kobo.1466.1">,
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1467.1">...</span></span> <span class="hljs-con-string"><span class="koboSpan" id="kobo.1468.1">'This e-mail was sent with Django.'</span></span><span class="koboSpan" id="kobo.1469.1">,
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1470.1">...</span></span> <span class="hljs-con-string"><span class="koboSpan" id="kobo.1471.1">'your_account@gmail.com'</span></span><span class="koboSpan" id="kobo.1472.1">,
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1473.1">...</span></span><span class="koboSpan" id="kobo.1474.1">           [</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1475.1">'your_account@gmail.com'</span></span><span class="koboSpan" id="kobo.1476.1">],
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1477.1">...</span></span><span class="koboSpan" id="kobo.1478.1">           fail_silently=</span><span class="hljs-con-literal"><span class="koboSpan" id="kobo.1479.1">False</span></span><span class="koboSpan" id="kobo.1480.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1481.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1482.1">send_mail()</span></code><span class="koboSpan" id="kobo.1483.1"> function takes the subject, message, sender, and list of recipients as required arguments. </span><span class="koboSpan" id="kobo.1483.2">By setting the optional argument </span><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">fail_silently=False</span></code><span class="koboSpan" id="kobo.1485.1">, we are telling it to raise an exception if the email cannot be sent. </span><span class="koboSpan" id="kobo.1485.2">If the output you see is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">1</span></code><span class="koboSpan" id="kobo.1487.1">, then your email was successfully sent.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1488.1">If you get a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1489.1">CERTIFICATE_VERIFY_FAILED</span></code><span class="koboSpan" id="kobo.1490.1"> error, install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1491.1">certify</span></code><span class="koboSpan" id="kobo.1492.1"> module with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.1493.1">pip install --upgrade certifi</span></code><span class="koboSpan" id="kobo.1494.1">. </span><span class="koboSpan" id="kobo.1494.2">If you are using macOS, run the following command on the shell to install </span><code class="inlineCode"><span class="koboSpan" id="kobo.1495.1">certify</span></code><span class="koboSpan" id="kobo.1496.1"> and let Python access macOS root certificates:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1497.1">/Applications/Python\ 3.12/Install\ Certificates.command
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1498.1">Check </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.1499.1">your inbox. </span><span class="koboSpan" id="kobo.1499.2">You should have received the email as displayed in </span><em class="italic"><span class="koboSpan" id="kobo.1500.1">Figure 2.15</span></em><span class="koboSpan" id="kobo.1501.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1502.1"><img alt="" role="presentation" src="../Images/B21088_02_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1503.1">Figure 2.15: Test email sent displayed in Gmail</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1504.1">You just sent your first email with Django! </span><span class="koboSpan" id="kobo.1504.2">You can find more information about sending emails with Django at </span><a href="https://docs.djangoproject.com/en/5.0/topics/email/"><span class="url"><span class="koboSpan" id="kobo.1505.1">https://docs.djangoproject.com/en/5.0/topics/email/</span></span></a><span class="koboSpan" id="kobo.1506.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1507.1">Let’s add this functionality to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1508.1">post_share</span></code><span class="koboSpan" id="kobo.1509.1"> view.</span></p>
<h2 class="heading-2" id="_idParaDest-100"><span class="koboSpan" id="kobo.1510.1">Sending emails in views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1511.1">Edit </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.1512.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1513.1">post_share</span></code><span class="koboSpan" id="kobo.1514.1"> view in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1515.1">views.py</span></code><span class="koboSpan" id="kobo.1516.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1517.1">blog</span></code><span class="koboSpan" id="kobo.1518.1"> application, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1519.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1520.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1521.1"> django.core.mail </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1522.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1523.1"> send_mail</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1524.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1525.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1526.1">post_share</span></span><span class="koboSpan" id="kobo.1527.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1528.1">request, post_id</span></span><span class="koboSpan" id="kobo.1529.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1530.1"># Retrieve post by id</span></span><span class="koboSpan" id="kobo.1531.1">
    post = get_object_or_404(
        Post,
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1532.1">id</span></span><span class="koboSpan" id="kobo.1533.1">=post_id,
        status=Post.Status.PUBLISHED
    )
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1534.1">sent = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1535.1">False</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1536.1">if</span></span><span class="koboSpan" id="kobo.1537.1"> request.method == </span><span class="hljs-string"><span class="koboSpan" id="kobo.1538.1">'POST'</span></span><span class="koboSpan" id="kobo.1539.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1540.1"># Form was submitted</span></span><span class="koboSpan" id="kobo.1541.1">
        form = EmailPostForm(request.POST)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1542.1">if</span></span><span class="koboSpan" id="kobo.1543.1"> form.is_valid():
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1544.1"># Form fields passed validation</span></span><span class="koboSpan" id="kobo.1545.1">
            cd = form.cleaned_data
            </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1546.1">post_url = request.build_absolute_uri(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1547.1">                post.get_absolute_url()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1548.1">            )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1549.1">            subject = (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1550.1">f"</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1551.1">{cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1552.1">'name'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1553.1">]}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1554.1"> (</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1555.1">{cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1556.1">'email'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1557.1">]}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1558.1">) "</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1559.1">f"recommends you read </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1560.1">{post.title}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1561.1">"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1562.1">            )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1563.1">            message = (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1564.1">f"Read </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1565.1">{post.title}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1566.1"> at </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1567.1">{post_url}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1568.1">\n\n"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1569.1">f"</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1570.1">{cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1571.1">'name'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1572.1">]}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1573.1">\'s comments: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1574.1">{cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1575.1">'comments'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1576.1">]}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1577.1">"</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1578.1">            )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1579.1">            send_mail(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1580.1">                subject=subject,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1581.1">                message=message,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1582.1">                from_email=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1583.1">None</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1584.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1585.1">                recipient_list=[cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1586.1">'to'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1587.1">]]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1588.1">            )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1589.1">            sent = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1590.1">True</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1591.1">else</span></span><span class="koboSpan" id="kobo.1592.1">:
        form = EmailPostForm()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1593.1">return</span></span><span class="koboSpan" id="kobo.1594.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1595.1">'blog/post/share.html'</span></span><span class="koboSpan" id="kobo.1596.1">,
        {
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1597.1">'post'</span></span><span class="koboSpan" id="kobo.1598.1">: post,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1599.1">'form'</span></span><span class="koboSpan" id="kobo.1600.1">: form</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1601.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1602.1">'sent'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1603.1">: sent</span></strong></span><span class="koboSpan" id="kobo.1604.1">
        }
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1605.1">In the preceding code, we have declared a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1606.1">sent</span></code><span class="koboSpan" id="kobo.1607.1"> variable with the initial </span><code class="inlineCode"><span class="koboSpan" id="kobo.1608.1">False</span></code><span class="koboSpan" id="kobo.1609.1"> value. </span><span class="koboSpan" id="kobo.1609.2">We set this variable to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1610.1">True</span></code><span class="koboSpan" id="kobo.1611.1"> after the email is sent. </span><span class="koboSpan" id="kobo.1611.2">We will use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1612.1">sent</span></code><span class="koboSpan" id="kobo.1613.1"> variable later in the template to display a success message when the form is successfully submitted.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1614.1">Since we have to include a link to the post in the email, we retrieve the absolute path of the post using its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1615.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.1616.1"> method. </span><span class="koboSpan" id="kobo.1616.2">We use this path as an input for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1617.1">request.build_absolute_uri()</span></code><span class="koboSpan" id="kobo.1618.1"> to build a complete URL, including the HTTP schema and hostname.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1619.1">We create </span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.1620.1">the subject and the message body of the email using the cleaned data of the validated form. </span><span class="koboSpan" id="kobo.1620.2">Finally, we send the email to the email address contained in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1621.1">to</span></code><span class="koboSpan" id="kobo.1622.1"> field of the form. </span><span class="koboSpan" id="kobo.1622.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1623.1">from_email</span></code><span class="koboSpan" id="kobo.1624.1"> parameter, we pass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1625.1">None</span></code><span class="koboSpan" id="kobo.1626.1"> value, so the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1627.1">DEFAULT_FROM_EMAIL</span></code><span class="koboSpan" id="kobo.1628.1"> setting will be used for the sender.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1629.1">Now that the view is complete, we have to add a new URL pattern for it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1630.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1631.1">urls.py</span></code><span class="koboSpan" id="kobo.1632.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1633.1">blog</span></code><span class="koboSpan" id="kobo.1634.1"> application and add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1635.1">post_share</span></code><span class="koboSpan" id="kobo.1636.1"> URL pattern, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1637.1">from</span></span><span class="koboSpan" id="kobo.1638.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1639.1">import</span></span><span class="koboSpan" id="kobo.1640.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1641.1">from</span></span><span class="koboSpan" id="kobo.1642.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1643.1">import</span></span><span class="koboSpan" id="kobo.1644.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1645.1">'blog'</span></span><span class="koboSpan" id="kobo.1646.1">
urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1647.1"># Post views</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1648.1"># path('', views.post_list, name='post_list'),</span></span><span class="koboSpan" id="kobo.1649.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1650.1">''</span></span><span class="koboSpan" id="kobo.1651.1">, views.PostListView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1652.1">'post_list'</span></span><span class="koboSpan" id="kobo.1653.1">),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1654.1">'&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;/&lt;slug:post&gt;/'</span></span><span class="koboSpan" id="kobo.1655.1">,
        views.post_detail,
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1656.1">'post_detail'</span></span><span class="koboSpan" id="kobo.1657.1">),
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1658.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1659.1">'&lt;int:post_id&gt;/share/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1660.1">, views.post_share, name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1661.1">'post_share'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1662.1">),</span></strong></span><span class="koboSpan" id="kobo.1663.1">
]
</span></code></pre>
<h2 class="heading-2" id="_idParaDest-101"><span class="koboSpan" id="kobo.1664.1">Rendering forms in templates</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1665.1">After creating the form, programming the view, and adding the URL pattern, the only thing </span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.1666.1">missing is the template for the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1667.1">Create a new file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1668.1">blog/templates/blog/post/</span></code><span class="koboSpan" id="kobo.1669.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1670.1">share.html</span></code><span class="koboSpan" id="kobo.1671.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1672.1">Add the following code to the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1673.1">share.html</span></code><span class="koboSpan" id="kobo.1674.1"> template:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1675.1">{% extends "blog/base.html" %}
{% block title %}Share a post{% endblock %}
{% block content %}
  {% if sent %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1676.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1677.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1678.1">&gt;</span></span><span class="koboSpan" id="kobo.1679.1">E-mail successfully sent</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1680.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1681.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1682.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1683.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1684.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1685.1">&gt;</span></span><span class="koboSpan" id="kobo.1686.1">
      "{{ post.title }}" was successfully sent to {{ form.cleaned_data.to }}.
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1687.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1688.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1689.1">&gt;</span></span><span class="koboSpan" id="kobo.1690.1">
  {% else %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1691.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1692.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1693.1">&gt;</span></span><span class="koboSpan" id="kobo.1694.1">Share "{{ post.title }}" by e-mail</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1695.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1696.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1697.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1698.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1699.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1700.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1701.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1702.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1703.1">post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1704.1">&gt;</span></span><span class="koboSpan" id="kobo.1705.1">
      {{ form.as_p }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1706.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1707.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1708.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1709.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1710.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1711.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1712.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1713.1">"Send e-mail"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1714.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1715.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1716.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1717.1">&gt;</span></span><span class="koboSpan" id="kobo.1718.1">
  {% endif %}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1719.1">This is the template that is used to both display the form to share a post via email and to display a success message when the email has been sent. </span><span class="koboSpan" id="kobo.1719.2">We differentiate between both cases with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1720.1">{% if sent %}</span></code><span class="koboSpan" id="kobo.1721.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1722.1">To display the form, we have defined an HTML form element, indicating that it has to be submitted by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1723.1">POST</span></code><span class="koboSpan" id="kobo.1724.1"> method:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1725.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1726.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1727.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1728.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1729.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1730.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1731.1">We have included the form instance with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1732.1">{{ form.as_p }}</span></code><span class="koboSpan" id="kobo.1733.1">. </span><span class="koboSpan" id="kobo.1733.2">We tell Django to render the form fields using HTML paragraph </span><code class="inlineCode"><span class="koboSpan" id="kobo.1734.1">&lt;p&gt;</span></code><span class="koboSpan" id="kobo.1735.1"> elements by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1736.1">as_p</span></code><span class="koboSpan" id="kobo.1737.1"> method. </span><span class="koboSpan" id="kobo.1737.2">We could also render the form as an unordered list with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1738.1">as_ul</span></code><span class="koboSpan" id="kobo.1739.1"> or as an HTML table with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1740.1">as_table</span></code><span class="koboSpan" id="kobo.1741.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1742.1">We have added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1743.1">{% csrf_token %}</span></code><span class="koboSpan" id="kobo.1744.1"> template tag. </span><span class="koboSpan" id="kobo.1744.2">This tag introduces a hidden field with an </span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.1745.1">autogenerated token to avoid </span><strong class="keyWord"><span class="koboSpan" id="kobo.1746.1">cross-site request forgery</span></strong><span class="koboSpan" id="kobo.1747.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1748.1">CSRF</span></strong><span class="koboSpan" id="kobo.1749.1">) attacks. </span><span class="koboSpan" id="kobo.1749.2">These attacks consist of a malicious website or program performing an unwanted action for a user on the site. </span><span class="koboSpan" id="kobo.1749.3">You can find more information about CSRF at </span><a href="https://owasp.org/www-community/attacks/csrf"><span class="url"><span class="koboSpan" id="kobo.1750.1">https://owasp.org/www-community/attacks/csrf</span></span></a><span class="koboSpan" id="kobo.1751.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1752.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1753.1">{% csrf_token %}</span></code><span class="koboSpan" id="kobo.1754.1"> template tag generates a hidden field that is rendered like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1755.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1756.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1757.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1758.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1759.1">'hidden'</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1760.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1761.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1762.1">'csrfmiddlewaretoken'</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1763.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1764.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1765.1">'26JjKo2lcEtYkGoV9z4XmJIEHLXN5LDR'</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1766.1"> /&gt;</span></span>
</code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1767.1">By default, Django checks for the CSRF token in all </span><code class="inlineCode"><span class="koboSpan" id="kobo.1768.1">POST</span></code><span class="koboSpan" id="kobo.1769.1"> requests. </span><span class="koboSpan" id="kobo.1769.2">Remember to include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1770.1">csrf_token</span></code><span class="koboSpan" id="kobo.1771.1"> tag in all forms that are submitted via </span><code class="inlineCode"><span class="koboSpan" id="kobo.1772.1">POST</span></code><span class="koboSpan" id="kobo.1773.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1774.1">Edit </span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.1775.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1776.1">blog/post/detail.html</span></code><span class="koboSpan" id="kobo.1777.1"> template and make it look like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1778.1">{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1779.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1780.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1781.1">&gt;</span></span><span class="koboSpan" id="kobo.1782.1">{{ post.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1783.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1784.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1785.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1786.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1787.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1788.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1789.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1790.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1791.1">&gt;</span></span><span class="koboSpan" id="kobo.1792.1">
    Published {{ post.publish }} by {{ post.author }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1793.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1794.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1795.1">&gt;</span></span><span class="koboSpan" id="kobo.1796.1">
  {{ post.body|linebreaks }}
  </span><span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1797.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1798.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1799.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1800.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1801.1">a</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1802.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1803.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1804.1">"{% url "blog:post_share" post.id %}"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1805.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1806.1">Share this post</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1807.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1808.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1809.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1810.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1811.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1812.1">&gt;</span></strong></span><span class="koboSpan" id="kobo.1813.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1814.1">We have added a link to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1815.1">post_share</span></code><span class="koboSpan" id="kobo.1816.1"> URL. </span><span class="koboSpan" id="kobo.1816.2">The URL is built dynamically with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1817.1">{% url %}</span></code><span class="koboSpan" id="kobo.1818.1"> template tag provided by Django. </span><span class="koboSpan" id="kobo.1818.2">We use the namespace called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1819.1">blog</span></code><span class="koboSpan" id="kobo.1820.1"> and the URL named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1821.1">post_share</span></code><span class="koboSpan" id="kobo.1822.1">. </span><span class="koboSpan" id="kobo.1822.2">We pass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1823.1">id</span></code><span class="koboSpan" id="kobo.1824.1"> post as a parameter to build the URL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1825.1">Open the shell prompt and execute the following command to start the development server:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1826.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1827.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1828.1">http://127.0.0.1:8000/blog/</span></code><span class="koboSpan" id="kobo.1829.1"> in your browser and click on any post title to view the post detail page.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1830.1">Under </span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.1831.1">the post body, you should see the link that you just added, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1832.1">Figure 2.16</span></em><span class="koboSpan" id="kobo.1833.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1834.1"><img alt="" role="presentation" src="../Images/B21088_02_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1835.1">Figure 2.16: The post detail page, including a link to share the post</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1836.1">Click on </span><strong class="screenText"><span class="koboSpan" id="kobo.1837.1">Share this post</span></strong><span class="koboSpan" id="kobo.1838.1">, and you should see the page, including the form to share this post by email, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1839.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_02_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1840.1">Figure 2.17: The page to share a post via email</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1841.1">CSS </span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.1842.1">styles for the form are included in the example code in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1843.1">static/css/blog.css</span></code><span class="koboSpan" id="kobo.1844.1"> file. </span><span class="koboSpan" id="kobo.1844.2">When you click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1845.1">SEND E-MAIL</span></strong><span class="koboSpan" id="kobo.1846.1"> button, the form is submitted and validated. </span><span class="koboSpan" id="kobo.1846.2">If all fields contain valid data, you get a success message, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1847.1"><img alt="Text  Description automatically generated with medium confidence" src="../Images/B21088_02_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1848.1">Figure 2.18: A success message for a post shared via email</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1849.1">Send a post to your own email address and check your inbox. </span><span class="koboSpan" id="kobo.1849.2">The email you receive should look like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1850.1"><img alt="" role="presentation" src="../Images/B21088_02_19.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1851.1">Figure 2.19: Test email sent displayed in Gmail</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1852.1">If you </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.1853.1">submit the form with invalid data, the form will be rendered again, including all validation errors:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1854.1"><img alt="Graphical user interface, text, application, Teams  Description automatically generated" src="../Images/B21088_02_20.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1855.1">Figure 2.20: The share post form displaying invalid data errors</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1856.1">Most modern browsers will prevent you from submitting a form with empty or erroneous fields. </span><span class="koboSpan" id="kobo.1856.2">This is because the browser validates the fields based on their attributes before submitting the form. </span><span class="koboSpan" id="kobo.1856.3">In this case, the form won’t be submitted, and the browser will display an error message for the fields that are wrong. </span><span class="koboSpan" id="kobo.1856.4">To test the Django </span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.1857.1">form validation using a modern browser, you can skip the browser form validation by adding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1858.1">novalidate</span></code><span class="koboSpan" id="kobo.1859.1"> attribute to the HTML </span><code class="inlineCode"><span class="koboSpan" id="kobo.1860.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.1861.1"> element, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1862.1">&lt;form method="post" novalidate&gt;</span></code><span class="koboSpan" id="kobo.1863.1">. </span><span class="koboSpan" id="kobo.1863.2">You can add this attribute to prevent the browser from validating fields and test your own form validation. </span><span class="koboSpan" id="kobo.1863.3">After you are done testing, remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1864.1">novalidate</span></code><span class="koboSpan" id="kobo.1865.1"> attribute to keep the browser form validation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1866.1">The functionality for sharing posts by email is now complete. </span><span class="koboSpan" id="kobo.1866.2">You can find more information about working with forms at </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/"><span class="url"><span class="koboSpan" id="kobo.1867.1">https://docs.djangoproject.com/en/5.0/topics/forms/</span></span></a><span class="koboSpan" id="kobo.1868.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-102"><span class="koboSpan" id="kobo.1869.1">Creating a comment system</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1870.1">We will </span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.1871.1">continue extending our blog application with a comment system that will allow users to comment on posts. </span><span class="koboSpan" id="kobo.1871.2">To build the comment system, we will need the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1872.1">A comment model to store user comments on posts</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1873.1">A Django form that allows users to submit comments and manages the data validation</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1874.1">A view that processes the form and saves a new comment to the database</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1875.1">A list of comments and the HTML form to add a new comment that can be included in the post detail template</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-103"><span class="koboSpan" id="kobo.1876.1">Creating a model for comments</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1877.1">Let’s start </span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.1878.1">by building a model to store user comments on posts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1879.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1880.1">models.py</span></code><span class="koboSpan" id="kobo.1881.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1882.1">blog</span></code><span class="koboSpan" id="kobo.1883.1"> application and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1884.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1885.1">Comment</span></span><span class="koboSpan" id="kobo.1886.1">(models.Model):
    post = models.ForeignKey(
        Post,
        on_delete=models.CASCADE,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1887.1">'comments'</span></span>
<span class="hljs-string"> </span><span class="koboSpan" id="kobo.1888.1">)
    name = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1889.1">80</span></span><span class="koboSpan" id="kobo.1890.1">)
    email = models.EmailField()
    body = models.TextField()
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1891.1">True</span></span><span class="koboSpan" id="kobo.1892.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1893.1">True</span></span><span class="koboSpan" id="kobo.1894.1">)
    active = models.BooleanField(default=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1895.1">True</span></span><span class="koboSpan" id="kobo.1896.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1897.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1898.1">Meta</span></span><span class="koboSpan" id="kobo.1899.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1900.1">'created'</span></span><span class="koboSpan" id="kobo.1901.1">]
        indexes = [
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1902.1">'created'</span></span><span class="koboSpan" id="kobo.1903.1">]),
        ]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1904.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1905.1">__str__</span></span><span class="koboSpan" id="kobo.1906.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1907.1">self</span></span><span class="koboSpan" id="kobo.1908.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1909.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1910.1">f'Comment by </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1911.1">{self.name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1912.1"> on </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1913.1">{self.post}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1914.1">'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1915.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1916.1">Comment</span></code><span class="koboSpan" id="kobo.1917.1"> model. </span><span class="koboSpan" id="kobo.1917.2">We have added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1918.1">ForeignKey</span></code><span class="koboSpan" id="kobo.1919.1"> field to associate each comment </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.1920.1">with a single post. </span><span class="koboSpan" id="kobo.1920.2">This many-to-one relationship is defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1921.1">Comment</span></code><span class="koboSpan" id="kobo.1922.1"> model because each comment will be made on one post, and each post may have multiple comments.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1923.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1924.1">related_name</span></code><span class="koboSpan" id="kobo.1925.1"> attribute allows you to name the attribute that you use for the relationship from the related object back to this one. </span><span class="koboSpan" id="kobo.1925.2">We can retrieve the post of a comment object using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1926.1">comment.post</span></code><span class="koboSpan" id="kobo.1927.1"> and retrieve all comments associated with a post object using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1928.1">post.comments.all()</span></code><span class="koboSpan" id="kobo.1929.1">. </span><span class="koboSpan" id="kobo.1929.2">If you don’t define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1930.1">related_name</span></code><span class="koboSpan" id="kobo.1931.1"> attribute, Django will use the name of the model in lowercase, followed by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1932.1">_set</span></code><span class="koboSpan" id="kobo.1933.1"> (that is, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1934.1">comment_set</span></code><span class="koboSpan" id="kobo.1935.1">) to name the relationship of the related object to the object of the model, where this relationship has been defined.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1936.1">You can learn more about many-to-one relationships at </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/examples/many_to_one/"><span class="url"><span class="koboSpan" id="kobo.1937.1">https://docs.djangoproject.com/en/5.0/topics/db/examples/many_to_one/</span></span></a><span class="koboSpan" id="kobo.1938.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1939.1">We have defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1940.1">active</span></code><span class="koboSpan" id="kobo.1941.1"> Boolean field to control the status of the comments. </span><span class="koboSpan" id="kobo.1941.2">This field will allow us to manually deactivate inappropriate comments using the administration site. </span><span class="koboSpan" id="kobo.1941.3">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1942.1">default=True</span></code><span class="koboSpan" id="kobo.1943.1"> to indicate that all comments are active by default.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1944.1">We have defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1945.1">created</span></code><span class="koboSpan" id="kobo.1946.1"> field to store the date and time when the comment was created. </span><span class="koboSpan" id="kobo.1946.2">By using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1947.1">auto_now_add</span></code><span class="koboSpan" id="kobo.1948.1">, the date will be saved automatically when creating an object. </span><span class="koboSpan" id="kobo.1948.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1949.1">Meta</span></code><span class="koboSpan" id="kobo.1950.1"> class of the model, we have added </span><code class="inlineCode"><span class="koboSpan" id="kobo.1951.1">ordering = ['created']</span></code><span class="koboSpan" id="kobo.1952.1"> to sort comments in chronological order by default, and we have added an index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1953.1">created</span></code><span class="koboSpan" id="kobo.1954.1"> field in ascending order. </span><span class="koboSpan" id="kobo.1954.2">This will improve the performance of database lookups or ordering results using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1955.1">created</span></code><span class="koboSpan" id="kobo.1956.1"> field.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1957.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1958.1">Comment</span></code><span class="koboSpan" id="kobo.1959.1"> model that we have built is not synchronized with the database. </span><span class="koboSpan" id="kobo.1959.2">We need to generate a new database migration to create the corresponding database table.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1960.1">Run the </span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.1961.1">following command from the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1962.1">python manage.py makemigrations blog
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1963.1">You should see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1964.1">Migrations for 'blog':
  blog/migrations/0003_comment.py
    - Create model Comment
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1965.1">Django has generated a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1966.1">0003_comment.py</span></code><span class="koboSpan" id="kobo.1967.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1968.1">migrations/</span></code><span class="koboSpan" id="kobo.1969.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1970.1">blog</span></code><span class="koboSpan" id="kobo.1971.1"> application. </span><span class="koboSpan" id="kobo.1971.2">We need to create the related database schema and apply the changes to the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1972.1">Run the following command to apply existing migrations:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1973.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1974.1">You will get an output that includes the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1975.1">Applying blog.0003_comment... </span><span class="koboSpan" id="kobo.1975.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1976.1">The migration has been applied and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1977.1">blog_comment</span></code><span class="koboSpan" id="kobo.1978.1"> table has been created in the database.</span></p>
<h2 class="heading-2" id="_idParaDest-104"><span class="koboSpan" id="kobo.1979.1">Adding comments to the administration site</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1980.1">Next, we will </span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.1981.1">add the new model to the administration site to manage comments through a simple interface.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1982.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1983.1">admin.py</span></code><span class="koboSpan" id="kobo.1984.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1985.1">blog</span></code><span class="koboSpan" id="kobo.1986.1"> application, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1987.1">Comment</span></code><span class="koboSpan" id="kobo.1988.1"> model, and add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1989.1">ModelAdmin</span></code><span class="koboSpan" id="kobo.1990.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1991.1">from</span></span><span class="koboSpan" id="kobo.1992.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1993.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1994.1">Comment,</span></strong></span><span class="koboSpan" id="kobo.1995.1"> Post
</span><span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1996.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1997.1">Comment</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1998.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1999.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2000.1">CommentAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2001.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2002.1">    list_display = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2003.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2004.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2005.1">'email'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2006.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2007.1">'post'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2008.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2009.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2010.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2011.1">'active'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2012.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2013.1">    list_filter = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2014.1">'active'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2015.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2016.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2017.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2018.1">'updated'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2019.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2020.1">    search_fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2021.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2022.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2023.1">'email'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2024.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2025.1">'body'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2026.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2027.1">Open the shell prompt and execute the following command to start the development server:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2028.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2029.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2030.1">http://127.0.0.1:8000/admin/</span></code><span class="koboSpan" id="kobo.2031.1"> in your browser. </span><span class="koboSpan" id="kobo.2031.2">You should see the new model included </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.2032.1">in the </span><strong class="screenText"><span class="koboSpan" id="kobo.2033.1">BLOG</span></strong><span class="koboSpan" id="kobo.2034.1"> section, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2035.1">Figure 2.21</span></em><span class="koboSpan" id="kobo.2036.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2037.1"><img alt="" role="presentation" src="../Images/B21088_02_21.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2038.1">Figure 2.21: Blog application models on the Django administration index page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2039.1">The model is now registered on the administration site.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2040.1">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.2041.1">Comments</span></strong><span class="koboSpan" id="kobo.2042.1"> row, click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2043.1">Add</span></strong><span class="koboSpan" id="kobo.2044.1">. </span><span class="koboSpan" id="kobo.2044.2">You will see the form to add a new comment:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2045.1"><img alt="" role="presentation" src="../Images/B21088_02_22.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2046.1">Figure 2.22: Form to add a new comment in the Django administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2047.1">Now we </span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.2048.1">can manage </span><code class="inlineCode"><span class="koboSpan" id="kobo.2049.1">Comment</span></code><span class="koboSpan" id="kobo.2050.1"> instances using the administration site.</span></p>
<h2 class="heading-2" id="_idParaDest-105"><span class="koboSpan" id="kobo.2051.1">Creating forms from models</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2052.1">We need to build a form to let users comment on blog posts. </span><span class="koboSpan" id="kobo.2052.2">Remember that Django has two </span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.2053.1">base classes that can be used to create forms: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2054.1">Form</span></code><span class="koboSpan" id="kobo.2055.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2056.1">ModelForm</span></code><span class="koboSpan" id="kobo.2057.1">. </span><span class="koboSpan" id="kobo.2057.2">We used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2058.1">Form</span></code><span class="koboSpan" id="kobo.2059.1"> class to allow users to share posts by email. </span><span class="koboSpan" id="kobo.2059.2">Now, we will use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2060.1">ModelForm</span></code><span class="koboSpan" id="kobo.2061.1"> to take advantage of the existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.2062.1">Comment</span></code><span class="koboSpan" id="kobo.2063.1"> model and build a form dynamically for it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2064.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2065.1">forms.py</span></code><span class="koboSpan" id="kobo.2066.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.2067.1">blog</span></code><span class="koboSpan" id="kobo.2068.1"> application and add the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2069.1">from</span></span><span class="koboSpan" id="kobo.2070.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2071.1">import</span></span><span class="koboSpan" id="kobo.2072.1"> Comment
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2073.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2074.1">CommentForm</span></span><span class="koboSpan" id="kobo.2075.1">(forms.ModelForm):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2076.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2077.1">Meta</span></span><span class="koboSpan" id="kobo.2078.1">:
        model = Comment
        fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.2079.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2080.1">name'</span></span><span class="koboSpan" id="kobo.2081.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2082.1">'email'</span></span><span class="koboSpan" id="kobo.2083.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2084.1">'body'</span></span><span class="koboSpan" id="kobo.2085.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2086.1">To create a form from a model, we just indicate which model to build the form for in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2087.1">Meta</span></code><span class="koboSpan" id="kobo.2088.1"> class of the form. </span><span class="koboSpan" id="kobo.2088.2">Django will introspect the model and build the corresponding form dynamically.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2089.1">Each model field type has a corresponding default form field type. </span><span class="koboSpan" id="kobo.2089.2">The attributes of model fields are taken into account for form validation. </span><span class="koboSpan" id="kobo.2089.3">By default, Django creates a form field for each field contained in the model. </span><span class="koboSpan" id="kobo.2089.4">However, we can explicitly tell Django which fields </span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.2090.1">to include in the form using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2091.1">fields</span></code><span class="koboSpan" id="kobo.2092.1"> attribute or define which fields to exclude using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2093.1">exclude</span></code><span class="koboSpan" id="kobo.2094.1"> attribute. </span><span class="koboSpan" id="kobo.2094.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2095.1">CommentForm</span></code><span class="koboSpan" id="kobo.2096.1"> form, we have explicitly included the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2097.1">name</span></code><span class="koboSpan" id="kobo.2098.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2099.1">email</span></code><span class="koboSpan" id="kobo.2100.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2101.1">body</span></code><span class="koboSpan" id="kobo.2102.1"> fields. </span><span class="koboSpan" id="kobo.2102.2">These are the only fields that will be included in the form.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2103.1">You can find more information about creating forms from models at </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/"><span class="url"><span class="koboSpan" id="kobo.2104.1">https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/</span></span></a><span class="koboSpan" id="kobo.2105.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-106"><span class="koboSpan" id="kobo.2106.1">Handling ModelForms in views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2107.1">For sharing posts by email, we used the same view to display the form and manage its submission. </span><span class="koboSpan" id="kobo.2107.2">We used the HTTP method to differentiate between both cases: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2108.1">GET</span></code><span class="koboSpan" id="kobo.2109.1"> to display the </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.2110.1">form and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2111.1">POST</span></code><span class="koboSpan" id="kobo.2112.1"> to submit it. </span><span class="koboSpan" id="kobo.2112.2">In this case, we will add the comment form to the post detail page, and we will build a separate view to handle the form submission. </span><span class="koboSpan" id="kobo.2112.3">The new view that processes the form will allow the user to return to the post detail view once the comment has been stored in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2113.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2114.1">views.py</span></code><span class="koboSpan" id="kobo.2115.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2116.1">blog</span></code><span class="koboSpan" id="kobo.2117.1"> application and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2118.1">from</span></span><span class="koboSpan" id="kobo.2119.1"> django.core.mail </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2120.1">import</span></span><span class="koboSpan" id="kobo.2121.1"> send_mail
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2122.1">from</span></span><span class="koboSpan" id="kobo.2123.1"> django.core.paginator </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2124.1">import</span></span><span class="koboSpan" id="kobo.2125.1"> EmptyPage, PageNotAnInteger, Paginator
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2126.1">from</span></span><span class="koboSpan" id="kobo.2127.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2128.1">import</span></span><span class="koboSpan" id="kobo.2129.1"> get_object_or_404, render
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2130.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2131.1"> django.views.decorators.http </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2132.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2133.1"> require_POST</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2134.1">from</span></span><span class="koboSpan" id="kobo.2135.1"> django.views.generic </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2136.1">import</span></span><span class="koboSpan" id="kobo.2137.1"> ListView
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2138.1">from</span></span><span class="koboSpan" id="kobo.2139.1"> .forms </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2140.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2141.1">CommentForm,</span></strong></span><span class="koboSpan" id="kobo.2142.1"> EmailPostForm
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2143.1">from</span></span><span class="koboSpan" id="kobo.2144.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2145.1">import</span></span><span class="koboSpan" id="kobo.2146.1"> Post
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2147.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.2148.1">@require_POST</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2149.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2150.1">post_comment</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2151.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2152.1">request, post_id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2153.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2154.1">    post = get_object_or_404(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2155.1">        Post,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2156.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2157.1">=post_id,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2158.1">        status=Post.Status.PUBLISHED</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2159.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2160.1">    comment = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2161.1">None</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2162.1"># A comment was posted</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2163.1">    form = CommentForm(data=request.POST)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2164.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2165.1"> form.is_valid():</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2166.1"># Create a Comment object without saving it to the database</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2167.1">        comment = form.save(commit=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2168.1">False</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2169.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2170.1"># Assign the post to the comment</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2171.1">        comment.post = post</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2172.1"># Save the comment to the database</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2173.1">        comment.save()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2174.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2175.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2176.1">        request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2177.1">'blog/post/comment.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2178.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2179.1">        {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2180.1">'post'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2181.1">: post,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2182.1">'form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2183.1">: form,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2184.1">'comment'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2185.1">: comment</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2186.1">        }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2187.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2188.1">We have </span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.2189.1">defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2190.1">post_comment</span></code><span class="koboSpan" id="kobo.2191.1"> view that takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2192.1">request</span></code><span class="koboSpan" id="kobo.2193.1"> object and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2194.1">post_id</span></code><span class="koboSpan" id="kobo.2195.1"> variable as parameters. </span><span class="koboSpan" id="kobo.2195.2">We will be using this view to manage the post submission. </span><span class="koboSpan" id="kobo.2195.3">We expect the form to be submitted using the HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.2196.1">POST</span></code><span class="koboSpan" id="kobo.2197.1"> method. </span><span class="koboSpan" id="kobo.2197.2">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2198.1">require_POST</span></code><span class="koboSpan" id="kobo.2199.1"> decorator provided by Django to only allow </span><code class="inlineCode"><span class="koboSpan" id="kobo.2200.1">POST</span></code><span class="koboSpan" id="kobo.2201.1"> requests for this view. </span><span class="koboSpan" id="kobo.2201.2">Django allows you to restrict the HTTP methods allowed for views. </span><span class="koboSpan" id="kobo.2201.3">Django will throw an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.2202.1">405</span></code><span class="koboSpan" id="kobo.2203.1"> (method not allowed) error if you try to access the view with any other HTTP method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2204.1">In this view, we have implemented the following actions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2205.1">We retrieve a published post by its </span><code class="inlineCode"><span class="koboSpan" id="kobo.2206.1">id</span></code><span class="koboSpan" id="kobo.2207.1"> using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2208.1">get_object_or_404()</span></code><span class="koboSpan" id="kobo.2209.1"> shortcut.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2210.1">We define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2211.1">comment</span></code><span class="koboSpan" id="kobo.2212.1"> variable with the initial value </span><code class="inlineCode"><span class="koboSpan" id="kobo.2213.1">None</span></code><span class="koboSpan" id="kobo.2214.1">. </span><span class="koboSpan" id="kobo.2214.2">This variable will be used to store the comment object when it is created.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2215.1">We instantiate the form using the submitted </span><code class="inlineCode"><span class="koboSpan" id="kobo.2216.1">POST</span></code><span class="koboSpan" id="kobo.2217.1"> data and validate it using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2218.1">is_valid()</span></code><span class="koboSpan" id="kobo.2219.1"> method. </span><span class="koboSpan" id="kobo.2219.2">If the form is invalid, the template is rendered with the validation errors.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2220.1">If the form is valid, we create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2221.1">Comment</span></code><span class="koboSpan" id="kobo.2222.1"> object by calling the form’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2223.1">save()</span></code><span class="koboSpan" id="kobo.2224.1"> method and assign it to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2225.1">comment</span></code><span class="koboSpan" id="kobo.2226.1"> variable, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2227.1">comment = form.save(commit=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2228.1">False</span></span><span class="koboSpan" id="kobo.2229.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2230.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2231.1">save()</span></code><span class="koboSpan" id="kobo.2232.1"> method creates an instance of the model that the form is linked to and saves it to the database. </span><span class="koboSpan" id="kobo.2232.2">If you call it using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2233.1">commit=False</span></code><span class="koboSpan" id="kobo.2234.1">, the model instance </span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.2235.1">is created but not saved to the database. </span><span class="koboSpan" id="kobo.2235.2">This allows us to modify the object before finally saving it.</span><div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2236.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2237.1">save()</span></code><span class="koboSpan" id="kobo.2238.1"> method is available for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2239.1">ModelForm</span></code><span class="koboSpan" id="kobo.2240.1"> but not for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2241.1">Form</span></code><span class="koboSpan" id="kobo.2242.1"> instances since they are not linked to any model.</span></p>
</div>
</li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.2243.1">We assign the post to the comment we created:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2244.1">comment.post = post
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2245.1">We save the new comment to the database by calling its </span><code class="inlineCode"><span class="koboSpan" id="kobo.2246.1">save()</span></code><span class="koboSpan" id="kobo.2247.1"> method:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2248.1">comment.save()
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2249.1">We render the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2250.1">blog/post/comment.html</span></code><span class="koboSpan" id="kobo.2251.1"> template, passing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2252.1">post</span></code><span class="koboSpan" id="kobo.2253.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2254.1">form</span></code><span class="koboSpan" id="kobo.2255.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2256.1">comment</span></code><span class="koboSpan" id="kobo.2257.1"> objects in the template context. </span><span class="koboSpan" id="kobo.2257.2">This template doesn’t exist yet; we will create it later.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2258.1">Let’s create a URL pattern for this view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2259.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2260.1">urls.py</span></code><span class="koboSpan" id="kobo.2261.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2262.1">blog</span></code><span class="koboSpan" id="kobo.2263.1"> application and add the following URL pattern to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2264.1">from</span></span><span class="koboSpan" id="kobo.2265.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2266.1">import</span></span><span class="koboSpan" id="kobo.2267.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2268.1">from</span></span><span class="koboSpan" id="kobo.2269.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2270.1">import</span></span><span class="koboSpan" id="kobo.2271.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2272.1">'blog'</span></span><span class="koboSpan" id="kobo.2273.1">
urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2274.1"># Post views</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2275.1"># path('', views.post_list, name='post_list'),</span></span><span class="koboSpan" id="kobo.2276.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2277.1">''</span></span><span class="koboSpan" id="kobo.2278.1">, views.PostListView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2279.1">'post_list'</span></span><span class="koboSpan" id="kobo.2280.1">),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2281.1">'&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;/&lt;slug:post&gt;/'</span></span><span class="koboSpan" id="kobo.2282.1">,
        views.post_detail,
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2283.1">'post_detail'</span></span>
<span class="hljs-string"> </span><span class="koboSpan" id="kobo.2284.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2285.1">'&lt;int:post_id&gt;/share/'</span></span><span class="koboSpan" id="kobo.2286.1">, views.post_share, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2287.1">'post_share'</span></span><span class="koboSpan" id="kobo.2288.1">),
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2289.1">path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2290.1">'&lt;int:post_id&gt;/comment/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2291.1">, views.post_comment, name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2292.1">'post_comment'</span></strong></span>
<span class="hljs-string"> </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2293.1">),</span></strong></span><span class="koboSpan" id="kobo.2294.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2295.1">We have </span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.2296.1">implemented the view to manage the submission of comments and their corresponding URL. </span><span class="koboSpan" id="kobo.2296.2">Let’s create the necessary templates.</span></p>
<h2 class="heading-2" id="_idParaDest-107"><span class="koboSpan" id="kobo.2297.1">Creating templates for the comment form</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2298.1">We will </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.2299.1">create a template for the comment form that we will use in two places:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2300.1">In the post detail template associated with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2301.1">post_detail</span></code><span class="koboSpan" id="kobo.2302.1"> view to let users publish comments.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2303.1">In the post comment template associated with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2304.1">post_comment</span></code><span class="koboSpan" id="kobo.2305.1"> view to display the form again if there are any form errors.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2306.1">We will create the form template and use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2307.1">{% include %}</span></code><span class="koboSpan" id="kobo.2308.1"> template tag to include it in the two other templates.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2309.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2310.1">templates/blog/post/</span></code><span class="koboSpan" id="kobo.2311.1"> directory, create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2312.1">includes/</span></code><span class="koboSpan" id="kobo.2313.1"> directory. </span><span class="koboSpan" id="kobo.2313.2">Add a new file inside this directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2314.1">comment_form.html</span></code><span class="koboSpan" id="kobo.2315.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2316.1">The file structure should look as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2317.1">templates/
  blog/
    post/
      includes/
        comment_form.html
      detail.html
      list.html
      share.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2318.1">Edit the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2319.1">blog/post/includes/comment_form.html</span></code><span class="koboSpan" id="kobo.2320.1"> template and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2321.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2322.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2323.1">&gt;</span></span><span class="koboSpan" id="kobo.2324.1">Add a new comment</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2325.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2326.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2327.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2328.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2329.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2330.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2331.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2332.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2333.1">blog:post_comment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2334.1">" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2335.1">post.id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2336.1"> %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2337.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2338.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2339.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2340.1">post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2341.1">&gt;</span></span><span class="koboSpan" id="kobo.2342.1">
  {{ form.as_p }}
  {% csrf_token %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2343.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2344.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2345.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2346.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2347.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2348.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2349.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2350.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2351.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2352.1">"Add comment"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2353.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2354.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2355.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2356.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2357.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2358.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2359.1">In this </span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.2360.1">template, we build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2361.1">action</span></code><span class="koboSpan" id="kobo.2362.1"> URL of the HTML </span><code class="inlineCode"><span class="koboSpan" id="kobo.2363.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.2364.1"> element dynamically using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2365.1">{% url %}</span></code><span class="koboSpan" id="kobo.2366.1"> template tag. </span><span class="koboSpan" id="kobo.2366.2">We build the URL of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2367.1">post_comment</span></code><span class="koboSpan" id="kobo.2368.1"> view that will process the form. </span><span class="koboSpan" id="kobo.2368.2">We display the form rendered in paragraphs and we include </span><code class="inlineCode"><span class="koboSpan" id="kobo.2369.1">{% csrf_token %}</span></code><span class="koboSpan" id="kobo.2370.1"> for CSRF protection because this form will be submitted with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2371.1">POST</span></code><span class="koboSpan" id="kobo.2372.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2373.1">Create a new file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2374.1">templates/blog/post/</span></code><span class="koboSpan" id="kobo.2375.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2376.1">blog</span></code><span class="koboSpan" id="kobo.2377.1"> application and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2378.1">comment.html</span></code><span class="koboSpan" id="kobo.2379.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2380.1">The file structure should now look as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2381.1">templates/
  blog/
    post/
      includes/
        comment_form.html
      comment.html
      detail.html
      list.html
      share.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2382.1">Edit the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2383.1">blog/post/comment.html</span></code><span class="koboSpan" id="kobo.2384.1"> template and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2385.1">{% extends "blog/base.html" %}
{% block title %}Add a comment{% endblock %}
{% block content %}
  {% if comment %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2386.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2387.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2388.1">&gt;</span></span><span class="koboSpan" id="kobo.2389.1">Your comment has been added.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2390.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2391.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2392.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2393.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2394.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2395.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2396.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2397.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2398.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2399.1">"{{ post.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2400.1">&gt;</span></span><span class="koboSpan" id="kobo.2401.1">Back to the post</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2402.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2403.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2404.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2405.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2406.1">&gt;</span></span><span class="koboSpan" id="kobo.2407.1">
  {% else %}
    {% include "blog/post/includes/comment_form.html" %}
  {% endif %}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2408.1">This </span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.2409.1">is the template for the post comment view. </span><span class="koboSpan" id="kobo.2409.2">In this view, we expect the form to be submitted via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2410.1">POST</span></code><span class="koboSpan" id="kobo.2411.1"> method. </span><span class="koboSpan" id="kobo.2411.2">The template covers two different scenarios:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2412.1">If the form data submitted is valid, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2413.1">comment</span></code><span class="koboSpan" id="kobo.2414.1"> variable will contain the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2415.1">comment</span></code><span class="koboSpan" id="kobo.2416.1"> object that was created and a success message will be displayed.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2417.1">If the form data submitted is not valid, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2418.1">comment</span></code><span class="koboSpan" id="kobo.2419.1"> variable will be </span><code class="inlineCode"><span class="koboSpan" id="kobo.2420.1">None</span></code><span class="koboSpan" id="kobo.2421.1">. </span><span class="koboSpan" id="kobo.2421.2">In this case, we will display the comment form. </span><span class="koboSpan" id="kobo.2421.3">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2422.1">{% include %}</span></code><span class="koboSpan" id="kobo.2423.1"> template tag to include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2424.1">comment_form.html</span></code><span class="koboSpan" id="kobo.2425.1"> template that we have previously created.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-108"><span class="koboSpan" id="kobo.2426.1">Adding comments to the post detail view</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2427.1">To complete the comment functionality, we will add the list of comments and the comment </span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.2428.1">form to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2429.1">post_detail</span></code><span class="koboSpan" id="kobo.2430.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2431.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2432.1">views.py</span></code><span class="koboSpan" id="kobo.2433.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2434.1">blog</span></code><span class="koboSpan" id="kobo.2435.1"> application and edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2436.1">post_detail</span></code><span class="koboSpan" id="kobo.2437.1"> view as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2438.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2439.1">post_detail</span></span><span class="koboSpan" id="kobo.2440.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2441.1">request, year, month, day, post</span></span><span class="koboSpan" id="kobo.2442.1">):
    post = get_object_or_404(
        Post,
        status=Post.Status.PUBLISHED,
        slug=post,
        publish__year=year,
        publish__month=month,
        publish__day=day
    )
    </span><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2443.1"># List of active comments for this post</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2444.1">    comments = post.comments.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2445.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2446.1">(active=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2447.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2448.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2449.1"># Form for users to comment</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2450.1">    form = CommentForm()</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2451.1">return</span></span><span class="koboSpan" id="kobo.2452.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2453.1">'blog/post/detail.html'</span></span><span class="koboSpan" id="kobo.2454.1">,
        {
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2455.1">'post'</span></span><span class="koboSpan" id="kobo.2456.1">: post</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2457.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2458.1">'comments'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2459.1">: comments,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2460.1">'form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2461.1">: form</span></strong></span><span class="koboSpan" id="kobo.2462.1">
        }
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2463.1">Let’s </span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.2464.1">review the code we have added to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2465.1">post_detail</span></code><span class="koboSpan" id="kobo.2466.1"> view:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2467.1">We have added a QuerySet to retrieve all active comments for the post, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2468.1">comments = post.comments.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2469.1">filter</span></span><span class="koboSpan" id="kobo.2470.1">(active=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2471.1">True</span></span><span class="koboSpan" id="kobo.2472.1">)
</span></code></pre>
</li>
<li class="bulletList"><span class="koboSpan" id="kobo.2473.1">This QuerySet is built using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2474.1">post</span></code><span class="koboSpan" id="kobo.2475.1"> object. </span><span class="koboSpan" id="kobo.2475.2">Instead of building a QuerySet for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2476.1">Comment</span></code><span class="koboSpan" id="kobo.2477.1"> model directly, we leverage the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2478.1">post</span></code><span class="koboSpan" id="kobo.2479.1"> object to retrieve the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.2480.1">Comment</span></code><span class="koboSpan" id="kobo.2481.1"> objects. </span><span class="koboSpan" id="kobo.2481.2">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2482.1">comments</span></code><span class="koboSpan" id="kobo.2483.1"> manager for the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.2484.1">Comment</span></code><span class="koboSpan" id="kobo.2485.1"> objects that we previously defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2486.1">Comment</span></code><span class="koboSpan" id="kobo.2487.1"> model, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2488.1">related_name</span></code><span class="koboSpan" id="kobo.2489.1"> attribute of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2490.1">ForeignKey</span></code><span class="koboSpan" id="kobo.2491.1"> field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2492.1">Post</span></code><span class="koboSpan" id="kobo.2493.1"> model.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2494.1">We have also created an instance of the comment form with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2495.1">form = CommentForm()</span></code><span class="koboSpan" id="kobo.2496.1">.</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-109"><span class="koboSpan" id="kobo.2497.1">Adding comments to the post detail template</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2498.1">We </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.2499.1">need to edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2500.1">blog/post/detail.html</span></code><span class="koboSpan" id="kobo.2501.1"> template to implement the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2502.1">Display the total number of comments for a post</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2503.1">Display the list of comments</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2504.1">Display the form for users to add a new comment</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2505.1">We will start by adding the total number of comments for a post.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2506.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2507.1">blog/post/detail.html</span></code><span class="koboSpan" id="kobo.2508.1"> template and change it as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2509.1">{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2510.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2511.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2512.1">&gt;</span></span><span class="koboSpan" id="kobo.2513.1">{{ post.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2514.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2515.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2516.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2517.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2518.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2519.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2520.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2521.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2522.1">&gt;</span></span><span class="koboSpan" id="kobo.2523.1">
    Published {{ post.publish }} by {{ post.author }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2524.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2525.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2526.1">&gt;</span></span><span class="koboSpan" id="kobo.2527.1">
  {{ post.body|linebreaks }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2528.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2529.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2530.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2531.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2532.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2533.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2534.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2535.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2536.1">blog:post_share</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2537.1">" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2538.1">post.id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2539.1"> %}"&gt;</span></span><span class="koboSpan" id="kobo.2540.1">
      Share this post
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2541.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2542.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2543.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2544.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2545.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2546.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2547.1">{% with comments.count as total_comments %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2548.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2549.1">h2</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2550.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2551.1">      {{ total_comments }} comment{{ total_comments|pluralize }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2552.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2553.1">h2</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2554.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2555.1">  {% endwith %}</span></strong></span><span class="koboSpan" id="kobo.2556.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2557.1">We </span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.2558.1">use the Django </span><strong class="keyWord"><span class="koboSpan" id="kobo.2559.1">object relational mapper</span></strong><span class="koboSpan" id="kobo.2560.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2561.1">ORM</span></strong><span class="koboSpan" id="kobo.2562.1">) in the template, executing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2563.1">comments.count()</span></code><span class="koboSpan" id="kobo.2564.1"> QuerySet. </span><span class="koboSpan" id="kobo.2564.2">Note </span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.2565.1">that the Django template language doesn’t use parentheses for calling methods. </span><span class="koboSpan" id="kobo.2565.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2566.1">{% with %}</span></code><span class="koboSpan" id="kobo.2567.1"> tag allows you to assign a value to a new variable that will be available in the template until the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2568.1">{% endwith %}</span></code><span class="koboSpan" id="kobo.2569.1"> tag.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2570.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2571.1">{% with %}</span></code><span class="koboSpan" id="kobo.2572.1"> template tag is useful for avoiding hitting the database or accessing expensive methods multiple times.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2573.1">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2574.1">pluralize</span></code><span class="koboSpan" id="kobo.2575.1"> template filter to display a plural suffix for the word “comment,” depending on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2576.1">total_comments</span></code><span class="koboSpan" id="kobo.2577.1"> value. </span><span class="koboSpan" id="kobo.2577.2">Template filters take the value of the variable they are applied to as their input and return a computed value. </span><span class="koboSpan" id="kobo.2577.3">We will learn more about template filters in </span><em class="italic"><span class="koboSpan" id="kobo.2578.1">Chapter 3</span></em><span class="koboSpan" id="kobo.2579.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2580.1">Extending Your Blog Application</span></em><span class="koboSpan" id="kobo.2581.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2582.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2583.1">pluralize</span></code><span class="koboSpan" id="kobo.2584.1"> template filter returns a string with the letter “s” if the value is different from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2585.1">1</span></code><span class="koboSpan" id="kobo.2586.1">. </span><span class="koboSpan" id="kobo.2586.2">The preceding text will be rendered as </span><em class="italic"><span class="koboSpan" id="kobo.2587.1">0 comments</span></em><span class="koboSpan" id="kobo.2588.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2589.1">1 comment</span></em><span class="koboSpan" id="kobo.2590.1">, or </span><em class="italic"><span class="koboSpan" id="kobo.2591.1">N comments</span></em><span class="koboSpan" id="kobo.2592.1">, depending on the number of active comments for the post.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2593.1">Now, let’s </span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.2594.1">add the list of active comments to the post detail template.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2595.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2596.1">blog/post/detail.html</span></code><span class="koboSpan" id="kobo.2597.1"> template and implement the following changes:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2598.1">{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2599.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2600.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2601.1">&gt;</span></span><span class="koboSpan" id="kobo.2602.1">{{ post.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2603.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2604.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2605.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2606.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2607.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2608.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2609.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2610.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2611.1">&gt;</span></span><span class="koboSpan" id="kobo.2612.1">
    Published {{ post.publish }} by {{ post.author }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2613.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2614.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2615.1">&gt;</span></span><span class="koboSpan" id="kobo.2616.1">
  {{ post.body|linebreaks }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2617.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2618.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2619.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2620.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2621.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2622.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2623.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2624.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2625.1">blog:post_share</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2626.1">" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2627.1">post.id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2628.1"> %}"&gt;</span></span><span class="koboSpan" id="kobo.2629.1">
      Share this post
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2630.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2631.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2632.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2633.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2634.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2635.1">&gt;</span></span><span class="koboSpan" id="kobo.2636.1">
  {% with comments.count as total_comments %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2637.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2638.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2639.1">&gt;</span></span><span class="koboSpan" id="kobo.2640.1">
      {{ total_comments }} comment{{ total_comments|pluralize }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2641.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2642.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2643.1">&gt;</span></span><span class="koboSpan" id="kobo.2644.1">
  {% endwith %}
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2645.1">{% for comment in comments %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2646.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2647.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2648.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2649.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2650.1">"comment"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2651.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2652.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2653.1">p</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2654.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2655.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2656.1">"info"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2657.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2658.1">        Comment {{ forloop.counter }} by {{ comment.name }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2659.1">        {{ comment.created }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2660.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2661.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2662.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2663.1">      {{ comment.body|linebreaks }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2664.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2665.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2666.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2667.1">  {% empty %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2668.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2669.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2670.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2671.1">There are no comments.</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2672.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2673.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2674.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2675.1">  {% endfor %}</span></strong></span><span class="koboSpan" id="kobo.2676.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2677.1">We have added a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2678.1">{% for %}</span></code><span class="koboSpan" id="kobo.2679.1"> template tag to loop through the post comments. </span><span class="koboSpan" id="kobo.2679.2">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2680.1">comments</span></code><span class="koboSpan" id="kobo.2681.1"> list is empty, we display a message that informs users that there are no comments for this post. </span><span class="koboSpan" id="kobo.2681.2">We enumerate comments with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2682.1">{{ forloop.counter }}</span></code><span class="koboSpan" id="kobo.2683.1"> variable, which contains the loop counter in each iteration. </span><span class="koboSpan" id="kobo.2683.2">For each post, we display the name </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.2684.1">of the user who posted it, the date, and the body of the comment.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2685.1">Finally, let’s add the comment form to the template.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2686.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2687.1">blog/post/detail.html</span></code><span class="koboSpan" id="kobo.2688.1"> template and include the comment form template as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2689.1">{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2690.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2691.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2692.1">&gt;</span></span><span class="koboSpan" id="kobo.2693.1">{{ post.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2694.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2695.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2696.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2697.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2698.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2699.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2700.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2701.1">"date"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2702.1">&gt;</span></span><span class="koboSpan" id="kobo.2703.1">
    Published {{ post.publish }} by {{ post.author }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2704.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2705.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2706.1">&gt;</span></span><span class="koboSpan" id="kobo.2707.1">
  {{ post.body|linebreaks }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2708.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2709.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2710.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2711.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2712.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2713.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2714.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2715.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2716.1">blog:post_share</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2717.1">"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2718.1">post.id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2719.1"> %}"&gt;</span></span><span class="koboSpan" id="kobo.2720.1">
      Share this post
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2721.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2722.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2723.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2724.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2725.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2726.1">&gt;</span></span><span class="koboSpan" id="kobo.2727.1">
  {% with comments.count as total_comments %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2728.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2729.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2730.1">&gt;</span></span><span class="koboSpan" id="kobo.2731.1">
      {{ total_comments }} comment{{ total_comments|pluralize }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2732.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2733.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2734.1">&gt;</span></span><span class="koboSpan" id="kobo.2735.1">
  {% endwith %}
  {% for comment in comments %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2736.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2737.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2738.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2739.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2740.1">"comment"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2741.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2742.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2743.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2744.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2745.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2746.1">"info"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2747.1">&gt;</span></span><span class="koboSpan" id="kobo.2748.1">
        Comment {{ forloop.counter }} by {{ comment.name }}
        {{ comment.created }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2749.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2750.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2751.1">&gt;</span></span><span class="koboSpan" id="kobo.2752.1">
      {{ comment.body|linebreaks }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2753.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2754.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2755.1">&gt;</span></span><span class="koboSpan" id="kobo.2756.1">
  {% empty %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2757.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2758.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2759.1">&gt;</span></span><span class="koboSpan" id="kobo.2760.1">There are no comments.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2761.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2762.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2763.1">&gt;</span></span><span class="koboSpan" id="kobo.2764.1">
  {% endfor %}
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2765.1">{% include "blog/post/includes/comment_form.html" %}</span></strong></span><span class="koboSpan" id="kobo.2766.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2767.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2768.1">http://127.0.0.1:8000/blog/</span></code><span class="koboSpan" id="kobo.2769.1"> in your browser and click on a post title to take a look </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.2770.1">at the post detail page. </span><span class="koboSpan" id="kobo.2770.2">You will see something like </span><em class="italic"><span class="koboSpan" id="kobo.2771.1">Figure 2.23</span></em><span class="koboSpan" id="kobo.2772.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2773.1"><img alt="" role="presentation" src="../Images/B21088_02_23.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2774.1">Figure 2.23: The post detail page, including the form to add a comment</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2775.1">Fill in the comment form with valid data and click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2776.1">Add comment</span></strong><span class="koboSpan" id="kobo.2777.1">. </span><span class="koboSpan" id="kobo.2777.2">You should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2778.1"><img alt="" role="presentation" src="../Images/B21088_02_24.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2779.1">Figure 2.24: The comment added success page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2780.1">Click </span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.2781.1">on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2782.1">Back to the post</span></strong><span class="koboSpan" id="kobo.2783.1"> link. </span><span class="koboSpan" id="kobo.2783.2">You should be redirected back to the post detail page, and you should be able to see the comment that you just added, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2784.1"><img alt="" role="presentation" src="../Images/B21088_02_25.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2785.1">Figure 2.25: The post detail page, including a comment</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2786.1">Add </span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.2787.1">one more comment to the post. </span><span class="koboSpan" id="kobo.2787.2">The comments should appear below the post contents in chronological order, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2788.1"><img alt="" role="presentation" src="../Images/B21088_02_26.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2789.1">Figure 2.26: The comment list on the post detail page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2790.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2791.1">http://127.0.0.1:8000/admin/blog/comment/</span></code><span class="koboSpan" id="kobo.2792.1"> in your browser. </span><span class="koboSpan" id="kobo.2792.2">You will see the administration page with the list of comments you created, like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2793.1"><img alt="" role="presentation" src="../Images/B21088_02_27.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2794.1">Figure 2.27: List of comments on the administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2795.1">Click </span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.2796.1">on the name of one of the posts to edit it. </span><span class="koboSpan" id="kobo.2796.2">Uncheck the </span><strong class="screenText"><span class="koboSpan" id="kobo.2797.1">Active</span></strong><span class="koboSpan" id="kobo.2798.1"> checkbox as follows and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2799.1">Save</span></strong><span class="koboSpan" id="kobo.2800.1"> button:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2801.1"><img alt="" role="presentation" src="../Images/B21088_02_28.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2802.1">Figure 2.28: Editing a comment on the administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2803.1">You will be redirected to the list of comments. </span><span class="koboSpan" id="kobo.2803.2">The </span><strong class="screenText"><span class="koboSpan" id="kobo.2804.1">Active</span></strong><span class="koboSpan" id="kobo.2805.1"> column will display an inactive icon for the comment, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2806.1">Figure 2.29</span></em><span class="koboSpan" id="kobo.2807.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2808.1"><img alt="" role="presentation" src="../Images/B21088_02_29.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2809.1">Figure 2.29: Active/inactive comments on the administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2810.1">If you </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.2811.1">return to the post detail view, you will note that the inactive comment is no longer displayed, neither is it counted for the total number of active comments for the post:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2812.1"><img alt="" role="presentation" src="../Images/B21088_02_30.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2813.1">Figure 2.30: A single active comment displayed on the post detail page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2814.1">Thanks to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2815.1">active</span></code><span class="koboSpan" id="kobo.2816.1"> field, you can deactivate inappropriate comments and avoid showing them on your posts.</span></p>
<h2 class="heading-2" id="_idParaDest-110"><span class="koboSpan" id="kobo.2817.1">Using simplified templates for form rendering</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2818.1">You have used </span><code class="inlineCode"><span class="koboSpan" id="kobo.2819.1">{{ form.as_p }}</span></code><span class="koboSpan" id="kobo.2820.1"> to render the forms using HTML paragraphs. </span><span class="koboSpan" id="kobo.2820.2">This is a very </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.2821.1">straightforward method for rendering forms, but there may be occasions when you need to employ custom HTML markup for rendering forms.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2822.1">To use custom HTML for rendering form fields, you can access each form field directly, or iterate through the form fields, as in the following example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2823.1">{% for field in form %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2824.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2825.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2826.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2827.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2828.1">"my-div"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2829.1">&gt;</span></span><span class="koboSpan" id="kobo.2830.1">
    {{ field.errors }}
    {{ field.label_tag }} {{ field }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2831.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2832.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2833.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2834.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2835.1">"help-text"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2836.1">&gt;</span></span><span class="koboSpan" id="kobo.2837.1">{{ field.help_text|safe }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2838.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2839.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2840.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2841.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2842.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2843.1">&gt;</span></span><span class="koboSpan" id="kobo.2844.1">
{% endfor %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2845.1">In this code, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2846.1">{{ field.errors }}</span></code><span class="koboSpan" id="kobo.2847.1"> to render any field errors of the form, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2848.1">{{ field.label_tag }}</span></code><span class="koboSpan" id="kobo.2849.1"> to render the form HTML label, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2850.1">{{ field }}</span></code><span class="koboSpan" id="kobo.2851.1"> to render the actual field, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2852.1">{{ field.help_text|safe }}</span></code><span class="koboSpan" id="kobo.2853.1"> to render the field’s help text HTML.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2854.1">This method is helpful to customize how forms are rendered, but you might need to add certain HTML elements for specific fields or include some fields in containers. </span><span class="koboSpan" id="kobo.2854.2">Django 5.0 introduces field groups and field group templates. </span><span class="koboSpan" id="kobo.2854.3">Field groups simplify the rendering of labels, widgets, help texts, and field errors. </span><span class="koboSpan" id="kobo.2854.4">Let’s use this new feature to customize the comment form.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2855.1">We are going to use custom HTML markup to reposition the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2856.1">name</span></code><span class="koboSpan" id="kobo.2857.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2858.1">email</span></code><span class="koboSpan" id="kobo.2859.1"> form fields using additional HTML elements.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2860.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2861.1">blog/post/includes/comment_form.html</span></code><span class="koboSpan" id="kobo.2862.1"> template and modify it as follows. </span><span class="koboSpan" id="kobo.2862.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2863.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2864.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2865.1">&gt;</span></span><span class="koboSpan" id="kobo.2866.1">Add a new comment</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2867.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2868.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2869.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2870.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2871.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2872.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2873.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2874.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2875.1">blog:post_comment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2876.1">" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2877.1">post.id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2878.1"> %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2879.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2880.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2881.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2882.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2883.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2884.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2885.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2886.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2887.1">"left"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2888.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2889.1">    {{ form.name.as_field_group }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2890.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2891.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2892.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2893.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2894.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2895.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2896.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2897.1">"left"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2898.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2899.1">    {{ form.email.as_field_group }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2900.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2901.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2902.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2903.1">  {{ form.body.as_field_group }}</span></strong></span><span class="koboSpan" id="kobo.2904.1">
  {% csrf_token %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2905.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2906.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2907.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2908.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2909.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2910.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2911.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2912.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2913.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2914.1">"Add comment"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2915.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2916.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2917.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2918.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2919.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2920.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2921.1">We have added </span><code class="inlineCode"><span class="koboSpan" id="kobo.2922.1">&lt;div&gt;</span></code><span class="koboSpan" id="kobo.2923.1"> containers for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2924.1">name</span></code><span class="koboSpan" id="kobo.2925.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2926.1">email</span></code><span class="koboSpan" id="kobo.2927.1"> fields with a custom CSS class to float both fields to the left.</span><code class="inlineCode"> </code><span class="koboSpan" id="kobo.2928.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2929.1">as_field_group</span></code><span class="koboSpan" id="kobo.2930.1"> method renders each field including help </span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.2931.1">text and errors. </span><span class="koboSpan" id="kobo.2931.2">This method uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2932.1">django/forms/field.html</span></code><span class="koboSpan" id="kobo.2933.1"> template by default. </span><span class="koboSpan" id="kobo.2933.2">You can see the contents of this template at </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/forms/templates/django/forms/field.html"><span class="url"><span class="koboSpan" id="kobo.2934.1">https://github.com/django/django/blob/stable/5.0.x/django/forms/templates/django/forms/field.html</span></span></a><span class="koboSpan" id="kobo.2935.1">. </span><span class="koboSpan" id="kobo.2935.2">You can also create custom field templates and reuse them by adding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2936.1">template_name</span></code><span class="koboSpan" id="kobo.2937.1"> attribute to any form field. </span><span class="koboSpan" id="kobo.2937.2">You can read more about reusable form templates at </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/#reusable-field-group-templates"><span class="url"><span class="koboSpan" id="kobo.2938.1">https://docs.djangoproject.com/en/5.0/topics/forms/#reusable-field-group-templates</span></span></a><span class="koboSpan" id="kobo.2939.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2940.1">Open a blog post and take a look at the comment form. </span><span class="koboSpan" id="kobo.2940.2">The form should now look like </span><em class="italic"><span class="koboSpan" id="kobo.2941.1">Figure 2.31</span></em><span class="koboSpan" id="kobo.2942.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2943.1"><img alt="" role="presentation" src="../Images/B21088_02_31.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2944.1">Figure 2.31: The comment form with the new HTML markup</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2945.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2946.1">name</span></code><span class="koboSpan" id="kobo.2947.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2948.1">email</span></code><span class="koboSpan" id="kobo.2949.1"> fields are now displayed next to each other. </span><span class="koboSpan" id="kobo.2949.2">Field groups allow you to easily customize form rendering.</span></p>
<h1 class="heading-1" id="_idParaDest-111"><span class="koboSpan" id="kobo.2950.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2951.1">In this chapter, you learned how to define canonical URLs for models. </span><span class="koboSpan" id="kobo.2951.2">You created SEO-friendly URLs for blog posts, and you implemented object pagination for your post list. </span><span class="koboSpan" id="kobo.2951.3">You also learned how to work with Django forms and model forms. </span><span class="koboSpan" id="kobo.2951.4">You created a system to recommend posts by email and created a comment system for your blog.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2952.1">In the next chapter, you will create a tagging system for the blog. </span><span class="koboSpan" id="kobo.2952.2">You will learn how to build complex QuerySets to retrieve objects by similarity. </span><span class="koboSpan" id="kobo.2952.3">You will learn how to create custom template tags and filters. </span><span class="koboSpan" id="kobo.2952.4">You will also build a custom sitemap and feed for your blog posts and implement full-text search functionality for your posts.</span></p>
<h1 class="heading-1" id="_idParaDest-112"><span class="koboSpan" id="kobo.2953.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2954.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2955.1">Source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter02"><span class="url"><span class="koboSpan" id="kobo.2956.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter02</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2957.1">URL utility functions: </span><a href="https://docs.djangoproject.com/en/5.0/ref/urlresolvers/"><span class="url"><span class="koboSpan" id="kobo.2958.1">https://docs.djangoproject.com/en/5.0/ref/urlresolvers/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2959.1">URL path converters: </span><a href="https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters"><span class="url"><span class="koboSpan" id="kobo.2960.1">https://docs.djangoproject.com/en/5.0/topics/http/urls/#path-converters</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2961.1">Django paginator class: </span><a href="https://docs.djangoproject.com/en/5.0/ref/paginator/"><span class="url"><span class="koboSpan" id="kobo.2962.1">https://docs.djangoproject.com/en/5.0/ref/paginator/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2963.1">Introduction to class-based views – </span><a href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/intro/"><span class="url"><span class="koboSpan" id="kobo.2964.1">https://docs.djangoproject.com/en/5.0/topics/class-based-views/intro/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2965.1">Sending emails with Django: </span><a href="https://docs.djangoproject.com/en/5.0/topics/email/"><span class="url"><span class="koboSpan" id="kobo.2966.1">https://docs.djangoproject.com/en/5.0/topics/email/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2967.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2968.1">python-decouple</span></code><span class="koboSpan" id="kobo.2969.1"> library: </span><a href="https://github.com/HBNetwork/python-decouple"><span class="url"><span class="koboSpan" id="kobo.2970.1">https://github.com/HBNetwork/python-decouple</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2971.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2972.1">django-anymail</span></code><span class="koboSpan" id="kobo.2973.1"> library: </span><a href="https://anymail.dev/en/stable/installation/"><span class="url"><span class="koboSpan" id="kobo.2974.1">https://anymail.dev/en/stable/installation/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2975.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2976.1">django-anymail</span></code><span class="koboSpan" id="kobo.2977.1"> supported email service providers: </span><a href="https://anymail.dev/en/stable/esps/"><span class="url"><span class="koboSpan" id="kobo.2978.1">https://anymail.dev/en/stable/esps/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2979.1">Django form field types: </span><a href="https://docs.djangoproject.com/en/5.0/ref/forms/fields/"><span class="url"><span class="koboSpan" id="kobo.2980.1">https://docs.djangoproject.com/en/5.0/ref/forms/fields/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2981.1">Working with forms: </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/"><span class="url"><span class="koboSpan" id="kobo.2982.1">https://docs.djangoproject.com/en/5.0/topics/forms/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2983.1">Creating forms from models: </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/"><span class="url"><span class="koboSpan" id="kobo.2984.1">https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2985.1">Many-to-one model relationships: </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/examples/many_to_one/"><span class="url"><span class="koboSpan" id="kobo.2986.1">https://docs.djangoproject.com/en/5.0/topics/db/examples/many_to_one/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2987.1">Default form field template: </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/forms/templates/django/forms/field.html"><span class="url"><span class="koboSpan" id="kobo.2988.1">https://github.com/django/django/blob/stable/5.0.x/django/forms/templates/django/forms/field.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2989.1">Reusable field group templates: </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/#reusable-field-group-templates"><span class="url"><span class="koboSpan" id="kobo.2990.1">https://docs.djangoproject.com/en/5.0/topics/forms/#reusable-field-group-templates</span></span></a></li>
</ul>
</div>
</body></html>