# 第四章。做出决定 – Python 控制流

恭喜！在第三章“计算这个！”中，你编写了一个计算器程序。如果你遵循了指示并纠正了错误，那么你就有了一个可以运行两个数字的所有数学函数的程序。虽然这对第一个程序来说很棒，但这样的有限计算器不会给用户太多选择。当用户运行计算器时，程序将不会结束，直到所有五个函数都运行完毕，或者由于错误而结束程序。

如果我们能够编程我们的计算器根据用户回答我们的问题的方式执行某些操作，而不是执行整个数学运算，那会怎么样？作为程序员，我们可以使用 Python 来解释用户数据并改变程序的操作方式。在本章中，你将学习如何使用*控制流*，以便我们的计算器程序可以做出选择，并且只运行用户选择的代码。

在本章结束时，你将有一个可以根据用户想要做什么来选择执行哪种数学运算的计算器程序。你将能够根据你如何使用控制流来定制这个程序。

# 是等于、不等于，还是其他什么？

在学习条件语句之前，你需要意识到计算机是根据**比较运算符**做出决定的。这些帮助我们比较两件事，以便计算机可以决定接下来做什么。以下是一个运算符列表：

| 比较运算符 |
| --- |
| 小于 | < |
| 小于或等于 | <= |
| 大于 | > |
| 大于或等于 | >= |
| 等于 | == |
| 不等于 | != |

这些运算符中的每一个都允许我们比较两个值。最令人困惑的运算符是等于运算符，因为它使用了两个等号。之所以这样，是因为当我们设置变量时，我们使用一个等号。我们不希望计算机在我们比较两个值时感到困惑，所以我们使用两个等号。当我们使用比较运算符与`if`、`elif`和`else`一起使用时，我们的程序可以编写得更好，以便做出更好的决策。

为了查看这些运算符在实际生活中的工作方式，打开你的 Python 壳并输入以下代码行：

```py
1 < 1
1 <= 1
1 > 1
1 >= 1
1 == 1
1 != 1

```

在每一行代码之后，将打印出`True`或`False`。请查看以下截图，了解如何使用数字`1`评估这些语句。尝试使用其他数字，看看会发生什么，并了解运算符及其功能：

![它是等于、不等于，还是其他什么？](img/B04681_04_01.jpg)

# 条件语句 – if，elif，else

在 Python 中，有三种语言结构经常用于控制程序的结果。这些结构是`if`、`elif`和`else`：

+   `if`语句告诉程序“如果用户这样做，则执行程序的这个部分”。

+   `else` 语句用于捕获用户所做的任何不在程序中的操作。例如，你可以将 `if` 和 `else` 结合使用：*如果用户选择* `add`*，则执行加法，否则执行其他操作*。

    ### 注意

    `elif` 代表 *else if*，这意味着 *如果第一个条件不成立，那么就在可能性的列表中执行下一个操作，直到用户的选项与可能性匹配*。

+   `elif` 用于当你想给程序提供超过两个选择时。你可以根据需要多次使用 `elif`。

+   `else` 是向你的计算机程序发出结束可能选择信号的标志。`else` 的意思是 *如果程序中没有发生其他事情，或者如果用户做了意外的事情，那么结束这段代码块*。`else` 语句始终位于以 `if` 开头的代码块末尾。

在下一节中，你可以查看 `if`、`elif` 和 `else` 的使用方法。然后，你可以通过实验你的计算器代码，并添加一些这些语句来使你的计算器更加灵活。

## 获取更好的输入

为了使 `if`、`elif` 和 `else` 能够工作，我们需要获取更好的用户输入。为了实现这一点，我们需要提出更好的问题！你将在每个 `if`、`elif` 和 `else` 的示例中看到，我们将添加更多的 `raw_input()` 语句来获取用户更多的信息。然后，我们将使用 `if`、`elif` 和 `else` 语句来使用这些信息，使我们的计算器程序更能满足用户的需求。

为了练习提出更好的问题，让我们打开我们的 Python 壳，并练习编写以下代码：

```py
raw_input('add, subtract, multiply, divide, or modulo?')

```

因此，我们现在要求用户通过将操作名称作为问题的答案来选择他们想要执行的操作。当我们的程序运行时，它会询问用户这个问题。我们的程序将如何知道如何处理这个答案？

## if

`if` 语句告诉程序，如果用户做出选择，则执行一些特殊操作。为了更好地理解这一点，让我们使用这个示例问题并询问用户他们希望计算器执行什么操作：

![if](img/B04681_04_10_replace.jpg)

为了练习的目的，让我们假设用户输入 *addition* 作为他们的答案。目前，我们的程序不知道或关心用户想要做加法。我们的程序无法对那个答案做出任何反应！我们需要使用 `if` 语句来告诉我们的程序该做什么。

因此，我们现在将创建一个特殊函数，并将我们告诉计算机如何处理用户的新信息。为此，我们将使用我们的文本编辑器添加新代码，并在保存代码后使用命令提示符来运行代码。提醒一下，你的命令提示符的工作目录应该设置为你的项目文件夹。

### 注意

如果你忘记了如何找到你的工作目录，可以参考第一章，*欢迎！让我们开始吧*。

一旦你在文本编辑器中打开了你的计算器程序，将此函数添加到程序中：

```py
def calc_run():
 op = raw_input('add, subtract, multiply, divide, or modulo?')
 if op == 'add':
 addition()

```

然后，通过在程序文件末尾添加这一行来调用你的新 `calc_run()` 函数：

```py
calc_run()

```

现在，你将擦除你在整个程序中对加法、减法、乘法和除法函数的调用，因为我们并不总是需要它们。我们希望它们只在用户做出选择时发生。

在我们现在创建的 `calc_run()` 函数中，我们告诉计算器提出一个问题。一旦用户回答了问题，计算机将检查答案是否等于加法。如果是，那么计算机将运行加法函数。

## elif

`elif` 语句让我们可以为用户提供许多选择，这对于可能想要从加法、减法、乘法和除法函数中选择用户来说更加合理。使用 `elif` 允许我们给用户提供在多个操作之间的选择。你可以写多少次 `elif` 语句没有限制。

如果你想要为 100 种不同的信息创建响应，你可以写 100 个 `elif` 语句。然而，这真的很繁琐，所以我们不会这样做。你可以看看以下代码中的一些更改，这将展示你如何使用 `elif` 为每个数学运算提供用户选择：

```py
def calc_run():
 op = raw_input('add, subtract, multiply, divide, or modulo? ')
 if op == 'add':
 addition()
 elif op == 'subtract':
 subtraction()
 elif op == 'multiply':
 multiplication()
 elif op == 'divide':
 division()
 elif op == 'modulo':
 modulo()

```

你会注意到我们使用了四个 `elif` 语句。每个 `elif` 都匹配我们想要的响应。现在，我们将测试我们的程序。希望你在文本编辑器中保存了你的工作。始终记得尽可能经常保存！

![elif](img/B04681_04_03.jpg)

按照以下步骤尝试运行你的程序：

1.  打开你的命令提示符或终端。

1.  导航到你的项目文件夹。

1.  输入 `python first_calc.py`。![elif](img/B04681_04_04.jpg)

## else

`else` 是一种管理用户可能执行的所有其他我们无法预测的行为的方式。当用户输入某些内容以触发 `else` 时，我们可以向他们返回一条消息，甚至可以结束程序。你的程序**不需要**使用 `else` 语句；然而，为你的用户提供你想要的选项，并尽可能使它们清晰是很不错的。在下面的示例中，如果用户没有选择加、减、乘、除或取模，我们将向用户打印一条消息：

```py
def calc_run():
 op = raw_input('add, subtract, multiply, divide, or modulo? ')
 if op == 'add':
 addition()
 elif op == 'subtract':
 subtraction()
 elif op == 'multiply':
 multiplication()
 elif op == 'divide':
 division()
 elif op == 'modulo':
 modulo()
 else:
 print('Thank you. Goodbye')

```

![else](img/B04681_04_05.jpg)

现在，当你运行代码时，如果你输入的答案不是加法、减法、乘法或除法，你的程序应该打印 `Thank you. Goodbye`。测试你的程序以检查你的 `else` 语句是否工作！

![else](img/B04681_04_06.jpg)

# 循环

**循环**是一种控制流，但它们会反复运行相同的代码块，直到有其他东西告诉循环停止重复。这与条件语句有点不同，因为它们只会运行一次代码块。两种循环类型是 `while` 和 `for`。这两种类型的循环都非常有用。

## while

**while** 是一种循环。当我们创建一个 `while` 循环时，程序会重复执行，直到发生一个给定的代码块。在编程 `while` 循环时，我们需要创建一些规则，否则我们的程序将永远运行。

例如，我们可以制定以下规则：当计算器开启时，执行以下步骤：

1.  运行计算器。

1.  提示用户继续计算。

1.  当用户遇到 `else` 语句时，关闭计算器。

让我们一步一步地通过每个代码更改；您需要这些更改才能使 `while` 循环工作。

### 全局变量和 `quit()` 函数

我们将创建一个全局变量，用于我们的 `quit()` 函数。以这种方式使用变量将允许我们让 `quit()` 函数像一个“关闭”开关一样工作，从而停止 `calc_run()` 函数的运行。在下一节中，我们将编写我们的全局变量，然后创建我们的 `quit()` 函数。

首先，我们将创建一个全局变量，名为 `calc_on`。这是我们为计算机计算器创建一个“开启”按钮的方法之一。这个全局变量应该在代码文件顶部编写，不要缩进，写为 *NO*：

```py
calc_on = 1

```

全局变量可以在程序中的任何函数中使用。如果您想在函数中使用全局变量，可以在函数内部变量的名称旁边输入 `global`。稍后您将看到一个示例。

现在我们已经有一个可以在代码的任何地方使用的 *开启按钮* 全局变量，我们将创建 `while` 循环所需的组件。我们需要添加一种让程序不断重复的方法，这样用户就可以在每次计算时无需重新启动程序。此外，我们还需要添加一种让用户退出程序的方法。我们将从后往前工作，首先创建 `quit()` 函数：

```py
def quit():
 global calc_on
 calc_on = 0

```

我们刚刚编写了 `quit()` 函数的代码。第一行使用了我们的 `calc_on` 全局变量。第二行将 `calc_on` 的值更改为 `0`。通过将值从 `1` 更改为 `0`，我们告诉程序关闭计算器并停止运行代码。

### 使用 `quit()` 函数

在我们的代码中，我们将更改 `else` 语句，使其运行 `quit()` 函数而不是打印一条消息。请看以下代码示例，以了解我们对 `else` 的更改：

```py
def calc_run():
 op = raw_input('add, subtract, multiply, divide, or modulo? ')
 if op == 'add':
 addition()
 elif op == 'subtract':
 subtraction()
 elif op == 'multiply':
 multiplication()
 elif op == 'divide':
 division()
 elif op == 'modulo':
 modulo()
 else:
 quit()

```

现在我们已经创建了“开启”按钮 `calc_on`、“关闭”按钮和 `quit()`，我们可以将“退出”选项添加到我们的程序中。在获取用户信息的代码行中，我们将添加单词 `quit` 作为选项：

```py
op = raw_input('add, subtract, multiply, divide, modulo, quit?')

```

### 使用 `while` 循环控制程序

退出是用户可以通过简单地输入 `quit` 来做出的一个选择。然而，我们希望允许用户在需要时保持程序运行。为此，我们将使用一个 `while` 循环。在代码底部，我们将简单地写下：

```py
while calc_on == 1:
 calc_run()

```

`while` 循环表示*只要开关键处于开启状态，就运行* `calc_run()` *函数。如果有人做了改变，将* `calc_on` *的值改为不是* `1` *的值，那么停止运行* `calc_run()` *程序。

希望你能注意到我们的 `quit()` 函数将 `calc_on` 的值改为 `0`，这意味着我们的程序停止运行。`while` 循环对于运行程序的一部分非常有用，并且可以使用简单的变量来开始或停止循环，这与我们在计算器中做的类似：

![使用 while 循环控制程序](img/B04681_04_07.jpg)

## for

`for` 循环是另一种循环。我们将使用 `for` 循环为我们的计算器创建一个奖励函数。`for` 和 `while` 之间最大的区别是，当程序员确切知道需要循环重复多少次时，才会使用 `for` 循环。在 `while` 循环中，我们不知道用户何时会完成计算器。用户可能只想进行一次计算，或者可能想进行 10 次计算，而 `while` 循环是灵活的。`for` 循环更加严格。

为什么不总是使用 `while` 呢？嗯，有些时候我们知道完成工作需要什么，我们不想在任务完成后让程序继续运行。`for` 循环非常适合说明重复循环的次数。例如，假设你有一个数字列表，你想要打印列表中的所有数字。假设你想要打印数字 `1` 到 `10`。如果你必须单独写出它们，看起来会是这样：

```py
 print(1)
 print(2)
 print(3)
 print(4)
 print(5)
 print(6)
 print(7)
 print(8)
 print(9)
 print(10)

```

这是一段很多行的代码，它们都在做同样的事情！多么浪费空间，而且输入这些代码是多么浪费时间。与其输入前面的代码，不如在下面的 `for` 循环中输入代码：

```py
 for n in range(1, 11):
 print(n)

```

![for](img/B04681_04_08.jpg)

首先，你注意到我们在 `range(1, 11)` 中输入了 `n`。这意味着*介于* `1` 和 `11` 之间的*每一个数字*，不包括 `11`。

你还会注意到我们调用了一个名为 `range()` 的函数，这是一个内置的 Python 函数，允许我们指定一系列数字而不是全部写出来。`range()` 函数*不包括*最后一个数字，所以你可以看到第二个数字是 `11`，而不是 `10`。

你可以通过将范围扩展到 `range(1, 1000)` 来在这些数字范围内进行实验。现在会发生什么？这是一个基本的 `for` 循环，但我们会发现，当我们想要对数字、字母、单词或对象列表重复代码时，使用这个 `for` 循环非常有帮助。

### 奖励 - `count_to_ten()` 函数

为了让我们的计算器更有趣，让我们创建一个 `count` 函数，该函数将打印从 `1` 到 `10` 的数字。然后我们可以将此函数添加到我们的选择列表中。首先，考虑我们是如何使用前面的 `for` 循环的。然后，将 `count_to_ten()` 函数复制到 `modulo()` 函数和 `quit()` 函数之间，并将其放入你的 `first_calc.py` 程序中：

```py
 def count_to_ten()
 for number in range(1, 11):
 print(number)

```

将选择`ten`添加到你的`op`变量中，如下所示：

```py
 op = raw_input('add, subtract, multiply, divide, modulo, ten, or quit?')

```

最后，将`elif`添加到你的`if`/`elif`/`else`控制流程中，用于`ten`：

```py
 elif op == 'ten':
 count_to_ten()

```

这将打印出用户的选择，然后，当用户输入`ten`时，计算机会打印出从 1 到 10 的所有数字。这个截图显示了代码的工作原理：

![奖励 – count_to_ten() 函数](img/B04681_04_09.jpg)

# 一个快速的任务

在本章中，你学到了很多关于如何编写能够做出决策的程序的知识。以下是一些需要回答的问题：

Q1. `elif`语句在`if`/`elif`/`else`流程中可以出现多少次？

1.  只一次

1.  两次

1.  需要多少次就运行多少次

1.  十

Q2. 哪个语句开始了一个用于做出决策的条件代码块？

1.  else

1.  if

1.  elif

1.  while

Q3. 哪个语句仅在条件代码块的末尾使用？

1.  else

1.  if

1.  elif

1.  while

Q4. 什么是全局变量？

1.  只在一个函数中使用的变量

1.  可以与许多函数共享的变量

1.  如果变量在函数内部，其名称前使用全局变量

1.  2 和 3 都可以

Q5. 什么是`while`循环？

1.  只运行一次代码的循环

1.  运行固定次数代码的循环

1.  重复执行代码直到发生不同的事情，然后停止的循环

1.  一个什么也不做的循环

# 摘要

在本章中，你学到了许多新概念。你学习了比较运算符，这些符号允许我们比较两个项目。你还学习了`if`、`elif`和`else`，这三个条件词让我们能够告诉程序如何根据用户输入的信息做出不同的决策。你学习了`for`和`while`循环；这两个循环在制作提供反馈的程序中都非常重要。你还了解了一些如何使用全局变量的知识，这些变量可以与代码文件中的所有函数共享。

希望你能跟上我们到目前为止所讨论的所有内容！这可能感觉有点令人不知所措，但我们将通过在下一章中构建一些新的项目来继续复习本章学到的概念。
