<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Making a Text Editor like Notepad"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Making a Text Editor like Notepad</h1></div></div></div><p>In the previous project, we got a fairly high-level overview of Tkinter. Now that we know some things about Tkinter's core widgets, geometry management, and bindings of command and events to callbacks, let us apply our skill to make a text editor in this project.</p><p>In the process, we will also take a closer look at individual widgets and learn how to tweak those widgets to our custom needs.</p><div class="section" title="Mission Briefing"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Mission Briefing</h1></div></div></div><p>In this project, our goal is to build a fully-functional text editing pad with some cool nifty features. In its final form, the<a id="id136" class="indexterm"/> proposed editor should look as follows:</p><div class="mediaobject"><img src="graphics/7941_02_01.jpg" alt="Mission Briefing"/></div><p>Some features we intend to include in the notepad are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating new<a id="id137" class="indexterm"/> documents, opening and editing existing documents, and saving documents</li><li class="listitem" style="list-style-type: disc">Implementing common editing options such as cut, copy, paste, undo, and redo</li><li class="listitem" style="list-style-type: disc">Searching within a file for a given search term</li><li class="listitem" style="list-style-type: disc">Implementing line numbering and the ability to show/hide line numbers</li><li class="listitem" style="list-style-type: disc">Implementing theme selection to let the user choose custom color themes</li><li class="listitem" style="list-style-type: disc">Implementing about and help windows and more</li></ul></div><div class="section" title="Why Is It Awesome?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>Why Is It Awesome?</h2></div></div></div><p>In this project you will build you first real and useful project. This project will provide you with further insights into the world of Tkinter. It will delve deeper into features of some commonly used widgets such as Menu, Menubutton, Text, Entry, Checkbutton, and Button widgets.</p><p>Particularly, we will go into the finer details of the Menu, Menubar, and Text widgets. We will also learn to easily handle custom dialogs windows such as the Open, Save, Error, Warning, and Info dialogs.</p></div><div class="section" title="Your Hotshot Objectives"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>Your Hotshot Objectives</h2></div></div></div><p>The project will be developed in seven consecutive iterations. The goals <a id="id138" class="indexterm"/>for each of these iterations are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set the user interface using the <code class="literal">pack</code> geometry using widgets such as Menu, Menubar, Text, Entry, Button, Checkbutton, and the like</li><li class="listitem" style="list-style-type: disc">Implement some features using Tkinter's built-in widget options</li><li class="listitem" style="list-style-type: disc">Implement dialogs using <code class="literal">ttk</code> dialogs and different types of Toplevel widgets</li><li class="listitem" style="list-style-type: disc">Apply some Text widget features such as text index, tag, and mark to implement some custom features</li><li class="listitem" style="list-style-type: disc">Apply some features using the Checkbutton and Radiobutton widgets</li><li class="listitem" style="list-style-type: disc">Apply some custom event binding and protocol binding to make the application more user-friendly</li><li class="listitem" style="list-style-type: disc">Add some miscellaneous features</li></ul></div></div></div></div>
<div class="section" title="Setting up the widgets"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Setting up the widgets</h1></div></div></div><p>Our first goal is to implement the visual elements of the text editor. As programmers, we have all used notepad or some code editor to edit our code. We are mostly aware of the common GUI <a id="id139" class="indexterm"/>elements of a text editor. So, without much of an introduction, let's get started.</p><div class="section" title="Prepare for Lift Off"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Prepare for Lift Off</h2></div></div></div><p>The first phase implements the following six widgets:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Menu</li><li class="listitem" style="list-style-type: disc">Menubutton</li><li class="listitem" style="list-style-type: disc">Label</li><li class="listitem" style="list-style-type: disc">Button</li><li class="listitem" style="list-style-type: disc">Text</li><li class="listitem" style="list-style-type: disc">Scrollbar</li></ul></div><p>Although we will cover all these in detail, you might find it helpful to look at the widget-specific options in the documentation of Tkinter maintained by its author Frederick Lundh at <a class="ulink" href="http://effbot.org/tkinterbook/">http://effbot.org/tkinterbook/</a>.</p><p>You might also want to bookmark the official documentation page of Tck/Tk located at <a class="ulink" href="http://www.tcl.tk/man/tcl8.5/TkCmd/contents.htm">http://www.tcl.tk/man/tcl8.5/TkCmd/contents.htm</a>.</p><p>The latter site includes the original Tcl/Tk reference. While it does not relate to Python, it provides a more <a id="id140" class="indexterm"/>detailed overview of each widget and is an equally useful reference. (Remember, Tkinter is just a wrapper around Tk)</p><p>You can also read the documentation provided with the original source code of Tkinter by typing these two lines in the interactive Python shell:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; import Tkinter</strong></span>
<span class="strong"><strong>&gt;&gt;&gt;help(Tkinter)</strong></span>
</pre></div></div><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Engage Thrusters</h2></div></div></div><p>In this iteration, we will complete the implementation of most of the visual elements of the program.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>We will be using the <code class="literal">pack()</code> geometry manager to place all the widgets. We have chosen the <code class="literal">pack</code> manager because it is ideally suited for placing widgets side by side or in a top-down position. Fortunately in a text editor, we have all widgets placed either side-by-side or in top-down locations. Thus, it suits to use the <code class="literal">pack</code> manager. We could have done the same with the <code class="literal">grid</code> manager as well.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we will start by adding the Toplevel window, one that will contain all other widgets using the following code:<div class="informalexample"><pre class="programlisting">from Tkinter import *
root = Tk()
# all our code is entered here
root.mainloop()</pre></div></li><li class="listitem">In this step we add the top menu buttons to our code. See the code in <code class="literal">2.01.py</code>. Menus offer a very compact way of presenting a large number of choices to the user without cluttering the interface. Tkinter offers two widgets to handle menus.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <a id="id141" class="indexterm"/><span class="strong"><strong>Menubutton</strong></span> widget<a id="id142" class="indexterm"/> – one that is part of the menu and appears on the top of application, which is always visible to the end user</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Menu</strong></span> widget<a id="id143" class="indexterm"/><a id="id144" class="indexterm"/> – one that show a list of choices when the user clicks on any menu button</li></ul></div><div class="mediaobject"><img src="graphics/7941_02_02.jpg" alt="Engage Thrusters"/></div><p>To add <a id="id145" class="indexterm"/>top-level menu buttons, you use the following command:</p><div class="informalexample"><pre class="programlisting">mymenu = Menu(parent, **options)</pre></div><p>For example, to add a File menu, we use the following code:</p><div class="informalexample"><pre class="programlisting"># Adding Menubar in the widget
menubar = Menu(root)
filemenu = Menu(menubar, tearoff=0 ) # File menu
root.config(menu=menubar) # this line actually displays menu</pre></div><p>Similarly, we add the Edit, View, and About menus at the top. Refer to step 2 of <code class="literal">2.01.py</code>.</p><p>Most of the Linux platforms support <a id="id146" class="indexterm"/>
<span class="strong"><strong>tear-off menus</strong></span>. When <code class="literal">tearoff</code> is set to <code class="literal">1</code> (enabled), the menu appears with a dotted line above the menu options. Clicking on the dotted line enables the user to literally tear off or separate the menu from the top. However, as this is not a cross-platform feature, we have decided to disable tear-off, marking it as <code class="literal">tearoff = 0</code>.</p></li><li class="listitem">Now we will add menu items within each of the four menu buttons. As previously mentioned, all drop-down options are to be added within the menu instance. In our example, we add five drop-down menu choices in the File menu, <a id="id147" class="indexterm"/>namely New, Open, Save, Save As, and Exit menu items. See step 3 of <code class="literal">2.02.py</code>.<p>Similarly, we add the following menu choices for other menus:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Under <span class="strong"><strong>Edit</strong></span> we have <span class="strong"><strong>Undo</strong></span>, <span class="strong"><strong>Redo</strong></span>, <span class="strong"><strong>Cut</strong></span>, <span class="strong"><strong>Copy</strong></span>, <span class="strong"><strong>Paste</strong></span>, <span class="strong"><strong>Find All</strong></span>, and <span class="strong"><strong>Select All</strong></span></li><li class="listitem" style="list-style-type: disc">Under <span class="strong"><strong>View</strong></span> we have <span class="strong"><strong>Show Line Number</strong></span>, <span class="strong"><strong>Show Info Bar at Bottom</strong></span>, <span class="strong"><strong>Highlight Current Line</strong></span>, and <span class="strong"><strong>Themes</strong></span></li><li class="listitem" style="list-style-type: disc">Under <span class="strong"><strong>About</strong></span> we have <span class="strong"><strong>About</strong></span> and <span class="strong"><strong>Help</strong></span></li></ul></div><p>The format for adding menu items is as follows:</p><div class="informalexample"><pre class="programlisting">mymenu.add_command(label="Mylabel", accelerator='KeyBoard Shortcut', compound=LEFT, image=myimage, underline=0,  command=callback)</pre></div><p>For example, you would create the <span class="strong"><strong>Undo</strong></span> menu item using the following syntax:</p><div class="informalexample"><pre class="programlisting">mymenu.add_command(label="Undo", accelerator='Ctrl + Z', compound=LEFT, image=undoimage, command=undocallback)</pre></div><div class="mediaobject"><img src="graphics/7941_02_03.jpg" alt="Engage Thrusters"/></div></li><li class="listitem">Next we will add some labels. We will add the top label, which will later hold the shortcut buttons. We will also add a label to the left-hand side to display<a id="id148" class="indexterm"/> the line numbers:<div class="mediaobject"><img src="graphics/7941_02_05.jpg" alt="Engage Thrusters"/></div><p>The top label has been marked in a green background and the side label in a light cream background for illustration purposes.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>When working with the <code class="literal">pack</code> geometry manager, it is important to add widgets in the order they will appear. This is because <code class="literal">pack()</code> uses the concept of available space to fit the widgets. If we do not maintain the order, the widgets will start occupying places in the order they are introduced. This is why we cannot introduce the text widget before the two label widgets as they appear higher up in the display.</p></div></div><p>Having reserved the space, we can later add shortcut icons or line numbers keeping the label as the parent widget. Adding labels is easy, we have done that in the past. See the code in <code class="literal">2.02.py</code> step 4. The code is as follows:</p><div class="informalexample"><pre class="programlisting">shortcutbar = Frame(root,  height=25, bg='light sea green')
shortcutbar.pack(expand=NO, fill=X)
lnlabel = Label(root,  width=2,  bg = 'antique white')
lnlabel.pack(side=LEFT, anchor='nw', fill=Y)</pre></div><p>We have applied a colorful background to these two labels for now to differentiate it from the body of the Toplevel window.</p></li><li class="listitem">Lastly, let's add the Text widget and Scrollbar widget to our code. Refer to step 5 of the code <code class="literal">2.02.py</code>.<div class="informalexample"><pre class="programlisting">textPad = Text(root)
textPad.pack(expand=YES, fill=BOTH)
scroll=Scrollbar(textPad)
textPad.configure(yscrollcommand=scroll.set)
scroll.config(command=textPad.yview)
scroll.pack(side=RIGHT, fill=Y)</pre></div><p>The code<a id="id149" class="indexterm"/> is similar to all other code that we have used so far to instantiate widgets. Notice, however, that the scrollbar is configured to <code class="literal">yview</code>
<span class="strong"><strong> </strong></span>of the Text widget and the Text widget is configured to connect to the Scrollbar widget. This way, we cross connected both the widgets to each other.</p><p>Now when you go down the Text widget, the scrollbar reacts to it. Alternatively, when you pull the scrollbar, the Text widget reacts in return.</p></li></ol></div><p>Some new menu-specific options introduced here are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">accelerator</code>: This option<a id="id150" class="indexterm"/> is used to specify a string, typically the keyboard shortcut, which can be used to invoke the menu. The <a id="id151" class="indexterm"/>string specified as the accelerator appears next to the text of the menu item. Please note that this does not automatically create bindings for the keyboard shortcut. We will have to manually set them up, as we will see later.</li><li class="listitem" style="list-style-type: disc"><code class="literal">compound</code>: Specifying a <code class="literal">compound</code> option to the menu item lets you add images beside the common<a id="id152" class="indexterm"/> text label of the menu. A specification such as <code class="literal">Compound=LEFT, label= 'mytext', image=myimage</code> means that the menu item has a compound label comprising of a text label and an image, where the image is to be placed on the left-hand side of the text. The images we use here are stored and referenced from a separate folder called <code class="literal">icons</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">underline</code>: The<a id="id153" class="indexterm"/> <code class="literal">underline</code> option lets you specify the index of a character in the menu text to be underlined. The indexing starts at 0, which means that specifying <code class="literal">underline=1</code> underlines the second character of the text. Besides underlining, Tkinter also uses it to define the default bindings for keyboard traversal of menus. This means that we can select the<a id="id154" class="indexterm"/> menu either with the mouse pointer, or with the <span class="emphasis"><em>Alt</em></span> + <code class="literal">&lt;character_at_the_underlined_index&gt;</code> shortcut.</li></ul></div><p>Therefore, to add the <span class="strong"><strong>New</strong></span> menu item within the <span class="strong"><strong>File</strong></span> menu, we use the following code:</p><div class="informalexample"><pre class="programlisting">filemenu.add_command(label="New", accelerator='Ctrl+N', compound=LEFT, image=newicon, underline=0,  command=new_file)</pre></div><p>Similarly, we add menu choices <a id="id155" class="indexterm"/>for the <span class="strong"><strong>Edit</strong></span> menu.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>
<span class="strong"><strong>Menu separators</strong></span>
</p><p>Occasionally within your menu items, you will come across code such as <code class="literal">mymenu.add_separator()</code>. This widget displays a separator bar and is solely used to organize similar menu items in groups, separating groups by horizontal bars.</p></div></div><p>Other than the normal menu type that we implement for the <span class="strong"><strong>New</strong></span> and <span class="strong"><strong>Edit</strong></span> menus, Tkinter offers three more varieties of menu:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>The Checkbutton menu</strong></span>: This menu<a id="id156" class="indexterm"/> lets you make a yes/no choice by checking/unchecking the menu</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>The Radiobutton menu</strong></span>: This<a id="id157" class="indexterm"/> menu lets you choose one from among many different options</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>The Cascade menu</strong></span>: This menu <a id="id158" class="indexterm"/>only opens up to show another list of choices</li></ul></div><p>Our <span class="strong"><strong>View</strong></span> menu demonstrates all these three types of menus as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7941_02_04.jpg" alt="Engage Thrusters"/></div><p>The first three choices under the <span class="strong"><strong>View</strong></span> menu let the user select whether or not they want a certain thing to happen. The user can check/uncheck options against these menus and are examples of the Checkbutton menu.</p><p>The fourth menu choice<a id="id159" class="indexterm"/> under <span class="strong"><strong>View</strong></span> menu reads as <span class="strong"><strong>Themes</strong></span>. Hovering over this menu opens another list of choices. This is an example of a <span class="strong"><strong>Cascade</strong></span> menu as it only serves the purpose of opening up another list of choices.</p><p>Within the <span class="strong"><strong>Cascade</strong></span> menu, you are presented with a list of choices for your editor theme. You can, however, select only one of the themes. Selecting one theme unselects any previous selection. This is an example of the Radiobutton menu.</p><p>An example format for adding these three types of menu is as follows:</p><div class="informalexample"><pre class="programlisting">viewmenu.add_checkbutton(label="Show Line Number", variable=showln)
viewmenu.add_cascade(label="Themes", menu=themesmenu)
themesmenu.add_radiobutton(label="Default White", variable=theme)</pre></div><p>Now that we need to track whether or not a selection has been made, we track it by adding a variable that can be <code class="literal">BooleanVar()</code>, <code class="literal">IntVar()</code>, or <code class="literal">Stringvar()</code> as we discussed in <a class="link" href="ch01.html" title="Chapter 1. Meet Tkinter">Project 1</a>, <span class="emphasis"><em>Meet Tkinter</em></span>.</p><p>For a complete list of configuration options for the Menubutton and Menu widgets, refer to the <span class="emphasis"><em>The basic widget methods</em></span> section in <a class="link" href="apb.html" title="Appendix B. Quick Reference Sheets">Appendix B</a>, <span class="emphasis"><em>Quick Reference Sheets</em></span>.</p></div><div class="section" title="Objective Complete – Mini Debriefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Objective Complete – Mini Debriefing</h2></div></div></div><p>This concludes our first iteration. In this iteration, we have completed laying down the majority of visual elements of our text editor.</p></div></div>
<div class="section" title="Leveraging the power of built-in Text widget options"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Leveraging the power of built-in Text widget options</h1></div></div></div><p>Tkinter's Text widget comes with some handy built-in functionality to handle common text-related functions.<a id="id160" class="indexterm"/> Let's leverage these functionalities to implement some common features in our text editor.</p><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Engage Thrusters</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's start by implementing the Cut, Copy, and Paste features. We now have our editor GUI ready. If you open the program and play with the Text widget, you will notice that you can perform basic functions such as cut, copy, and paste in the text area using the keyboard shortcuts <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span>, and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>V</em></span>. All these functions exist without us having to add a single line of code toward these functionalities.<p>Clearly the text widget comes built in with these events. Rather than coding these functions ourselves, let's use the built-in functions to add these features to our text editor.</p><p>The documentation of Tcl/Tk "universal widget methods" tells us that we can trigger events without any external stimulus using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>widget.event_generate(sequence, **kw)</strong></span>
</pre></div><p>To trigger the cut event for our <code class="literal">textPad</code> widget, all we need is a line of code such as the following:</p><div class="informalexample"><pre class="programlisting">textPad.event_generate("&lt;&lt;Cut&gt;&gt;")</pre></div><p>Let's call that using a function cut, and associate it with our cut menu using the command callback. See the code <code class="literal">2.03.py</code> that bears the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>def cut():</strong></span>
<span class="strong"><strong>  textPad.event_generate("&lt;&lt;Cut&gt;&gt;")</strong></span>
# then define a command callback from our existing cut menu like:
editmenu.add_command(label="Cut", compound=LEFT, image=cuticon, accelerator='Ctrl+X', <span class="strong"><strong>command=cut</strong></span>)</pre></div><p>Similarly, we trigger the copy and paste functions from their respective menu items.</p></li><li class="listitem">Next we will <a id="id161" class="indexterm"/>move on to implementing the undo and redo features. The Tcl/Tk text documentation tells us that the Text widget has an unlimited undo and redo mechanism, provided we set the <code class="literal">-undo</code> option as <code class="literal">true</code>. To leverage this option, let's first set the Text widget's <code class="literal">undo</code> option to <code class="literal">true</code> as shown in the following screenshot:<div class="informalexample"><pre class="programlisting">textPad = Text(root, <span class="strong"><strong>undo=True</strong></span>)</pre></div><p>Now if you open your text editor and try out the undo and redo features using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Z</em></span> and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Y</em></span>, you will see that they work fine. We now only have to associate the events to functions and callback the functions from our <span class="strong"><strong>Undo</strong></span> and <span class="strong"><strong>Redo</strong></span> menus respectively. This is similar to what we did for cut, copy, and paste. Refer to the code in <code class="literal">2.03.py</code>.</p></li></ol></div></div><div class="section" title="Objective Complete – Mini Briefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Objective Complete – Mini Briefing</h2></div></div></div><p>Taking advantage of some built-in Text widget options, we have successfully implemented the functionality of cut, copy, paste, undo, and redo into our text editor with minimal coding.</p></div></div>
<div class="section" title="Indexing and tagging"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Indexing and tagging</h1></div></div></div><p>While we managed to leverage some built-in functionality to gain a quick advantage, we need a more precise control over the text area, so as to bend it to our will. This would require the ability to target each character or location of the text with precision.</p><div class="section" title="Prepare for Lift Off"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Prepare for Lift Off</h2></div></div></div><p>The Text widget offers us the ability to manipulate its content using <span class="strong"><strong>index</strong></span>, <span class="strong"><strong>tags</strong></span>, and <span class="strong"><strong>mark</strong></span>
<a id="id162" class="indexterm"/>, which lets us target a position or place within the text area for manipulation.</p><div class="section" title="Index"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec11"/>Index</h3></div></div></div><p>Indexing helps you target a <a id="id163" class="indexterm"/>particular place within a text. For example, if you want to mark a particular word in bold style or in red or in a different font size, you can do so if you know the index of the starting point and the index of end point to be targeted.</p><p>The index must be specified in one of the following formats:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Index format</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">x.y</code>
<a id="id164" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The <span class="emphasis"><em>y</em></span>th character on<a id="id165" class="indexterm"/> line <span class="emphasis"><em>x</em></span>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">@x,y</code>
<a id="id166" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The character that covers the <code class="literal">x</code>,<code class="literal">y</code> coordinate within the text's window.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">end</code>
<a id="id167" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The end of the text.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mark</code>
<a id="id168" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The character after a named mark.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tag.first</code>
<a id="id169" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The first character in the text that has been tagged with a given tag.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tag.last</code>
<a id="id170" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The last character in the text that has been tagged with a given tag.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">selection (SEL_FIRST, SEL_LAST)</code>
<a id="id171" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This corresponds to the current selection. The constants <code class="literal">SEL_FIRST</code> and <code class="literal">SEL_LAST</code> refer to the start position and the end position in the selection. Tkinter raises a TclError exception if there is no selection.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">windowname</code>
<a id="id172" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The position of the embedded window whose name is <code class="literal">windowname</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">imagename</code>
<a id="id173" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The position of the embedded image with the name <code class="literal">imageName</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">INSERT</code>
<a id="id174" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The position of the insertion cursor.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CURRENT</code>
<a id="id175" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The position of the character closest to the mouse pointer.</p>
</td></tr></tbody></table></div><p>Indices can be <a id="id176" class="indexterm"/>further manipulated using modifiers and submodifiers. Some examples of modifiers and submodifers are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">end - 1 chars</code> or <code class="literal">end - 1 c</code> refers to the index of one character before the end</li><li class="listitem" style="list-style-type: disc"><code class="literal">insert +5lines</code> refers to the index of five lines ahead of the insertion cursor</li><li class="listitem" style="list-style-type: disc"><code class="literal">insertwordstart - 1 c</code> refers to the character just before the first one in the word containing the insertion cursor</li><li class="listitem" style="list-style-type: disc"><code class="literal">end linestart</code> refers to the index of the line start of the end line</li></ul></div><p>Indexes are<a id="id177" class="indexterm"/> often used as arguments to functions. For example, refer to the following list:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">text.delete(1.0,END)</code>: This means you can delete from line 1, column 0 up till the end</li><li class="listitem" style="list-style-type: disc"><code class="literal">text.get(0.0, END)</code>: This gets the content from 0.0 up till the end</li><li class="listitem" style="list-style-type: disc"><code class="literal">text.delete(insert-1c, INSERT)</code>: This deletes one character at the insertion cursor</li></ul></div></div><div class="section" title="Tags"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec12"/>Tags</h3></div></div></div><p>Tags are used to annotate text with an identification string that can then be used to manipulate the tagged text. Tkinter has a built-in tag called <span class="strong"><strong>SEL</strong></span>, which is automatically applied to the selected text. In <a id="id178" class="indexterm"/>addition to SEL, you can define your own tags. A text range can be associated with multiple tags, and the same tag can be used for many different text ranges.</p><p>Some examples of tagging are as follows:</p><div class="informalexample"><pre class="programlisting">mytext.tag_add('sel', '1.0', 'end') # add SEL tag from start(1.0) to end
mytext.tag_add("danger", "insert linestart", "insert lineend+1c")
mytext.tag_remove("danger", 1.0, "end")
mytext.tag_config('danger', background=red)
mytext.tag_config('outdated', overstrike=1)</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>You can specify the visual style for a given tag with <code class="literal">tag_config</code> using options such as <code class="literal">background(color)</code>, <code class="literal">bgstipple (bitmap)</code>, <code class="literal">borderwidth (distance)</code>, <code class="literal">fgstipple (bitmap)</code>, <code class="literal">font (font)</code>, <code class="literal">foreground (color)</code>, <code class="literal">justify (constant)</code>, <code class="literal">lmargin1 (distance)</code>, <code class="literal">lmargin2 (distance)</code>, <code class="literal">offset (distance)</code>, <code class="literal">overstrike (flag)</code>, <code class="literal">relief (constant)</code>, <code class="literal">rmargin (distance)</code>, <code class="literal">spacing1 (distance)</code>, <code class="literal">tabs (string)</code>, <code class="literal">underline (flag)</code>, and <code class="literal">wrap (constant)</code>.</p></div></div><p>For a complete reference of text indexing and tagging, type the following command into your Python interactive shell:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; import Tkinter</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; help(Tkinter.Text)</strong></span>
</pre></div></div></div><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>Engage Thrusters</h2></div></div></div><p>Equipped with a basic understanding of indexing and tagging, let's implement some more features in our code editor.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first feature that we <a id="id179" class="indexterm"/>will implement is the "Select All" feature. We know that Tkinter has a built-in <code class="literal">SEL</code> tag that applies a selection to a given text range. We want to apply this <code class="literal">sel</code> tag to the complete text contained in our widget.<p>We simply define a function to handle this. Refer to the code in <code class="literal">2.04.py</code> as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">def select_all():
  textPad.<span class="strong"><strong>tag_add('sel', '1.0', 'end')</strong></span>
</pre></div><p>After this we add a callback to our Select All menu item:</p><div class="informalexample"><pre class="programlisting">editmenu.add_command(label="Select All", underline=7, accelerator='Ctrl+A', <span class="strong"><strong>command=select_all</strong></span>)</pre></div><p>Now, we are done adding the Select All functionality to our code editor. If you now add some text to the text widget and then click on the menu item <span class="strong"><strong>select all</strong></span>, it should select the entire text in your editor. Note that we have not bound the <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>A </em></span>accelerator in the menu options. The keyboard shortcut will therefore not work. We will make the <code class="literal">accelerator</code> function in a separate step.</p></li><li class="listitem">Next, let's complete the functioning of the <span class="strong"><strong>Find</strong></span> menu item.<div class="mediaobject"><img src="graphics/7941_02_06.jpg" alt="Engage Thrusters"/></div><p>Here's a quick summary of the desired functionality. When a user clicks on the <span class="strong"><strong>Find</strong></span> menu item, a new Toplevel window opens up. The user enters a search keyword, and specifies if the search is to be case-sensitive. When<a id="id180" class="indexterm"/> the user clicks on the <span class="strong"><strong>Find All</strong></span> button, all matches are highlighted.</p><p>For searching through the document, we will rely on the <code class="literal">text.search()</code> method. The <code class="literal">search</code> method takes in the following arguments:</p><div class="informalexample"><pre class="programlisting">search(pattern, startindex, stopindex=None, forwards=None, backwards=None, exact=None, regexp=None, nocase=None, count=None)</pre></div><p>For our editor, we define a function called <code class="literal">on_find</code> and attach it as a callback to our <span class="strong"><strong>Find</strong></span> menu item (refer to the code in <code class="literal">2.04.py</code>):</p><div class="informalexample"><pre class="programlisting">editmenu.add_command(label="Find", underline= 0, accelerator='Ctrl+F', <span class="strong"><strong>command=on_find</strong></span>)</pre></div><p>We then define our function <code class="literal">on_find</code> as follows (refer to the code in <code class="literal">2.04.py</code>):</p><div class="informalexample"><pre class="programlisting">def on_find():
  t2 = Toplevel(root)
  t2.title('Find')
  t2.geometry('262x65+200+250')
  t2.transient(root)
  Label(t2, text="Find All:").grid(row=0, column=0, sticky='e')
      v=StringVar()
      e = Entry(t2, width=25, textvariable=v)
  e.grid(row=0, column=1, padx=2, pady=2, sticky='we')
  e.focus_set()
  c=IntVar()
  Checkbutton(t2, text='Ignore Case', variable=c).grid(row=1, column=1, sticky='e', padx=2, pady=2)
  Button(t2, text="Find All", underline=0,  command=lambda: search_for(v.get(), c.get(), textPad, t2, e)).grid(row=0, column=2, sticky='e'+'w', padx=2, pady=2)

def close_search():
  textPad.tag_remove('match', '1.0', END)
  t2.destroy()

t2.protocol('WM_DELETE_WINDOW', close_search)#override close </pre></div><p>The description<a id="id181" class="indexterm"/> of the preceding code is as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">When a user clicks on the <span class="strong"><strong>Find</strong></span> menu item, it invokes a callback <code class="literal">on_find</code>.</li><li class="listitem" style="list-style-type: disc">The first four lines of the <code class="literal">on_find()</code> function creates a new Toplevel window, adds a title <code class="literal">Find</code>, specifies it geometry (size, shape, and location), and sets it as a transient window. Setting it to transient means that it is always drawn on top of its parent or root window. If you uncomment this line and click on the root editor window, the <span class="strong"><strong>Find</strong></span> window will go behind the root window.</li><li class="listitem" style="list-style-type: disc">The next eight lines of code are pretty self-explanatory in that they set the widgets of the <span class="strong"><strong>Find</strong></span> window. It adds the Label, Entry, Button, and Checkbutton widgets and provides for two variables, <code class="literal">e</code> and <code class="literal">c</code>, to track the value a user enters into the Entry widget, and whether or not the user has checked the check button. The widgets are arranged using the <code class="literal">grid</code> geometry manager to fit into the <span class="strong"><strong>Find</strong></span> window.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Find All</strong></span> button has a <code class="literal">command</code> option that calls a function, <code class="literal">search_for()</code>, passing the search string as the first argument and whether or not the search is to be case-sensitive as its second argument. The third, fourth, and fifth arguments pass the Toplevel window, the Text widget, and the Entry widget as parameters.</li><li class="listitem" style="list-style-type: disc">Prior to the <code class="literal">search_for()</code> method, we override the Close button of the Find window and redirect it to a callback named <code class="literal">close_search()</code>. The <code class="literal">close_search()</code> method is defined within the <code class="literal">on_find()</code> function. This function takes care of removing the tag <code class="literal">match</code> that was added during the search. If we do not override the Close button and remove these tags, our matched string will continue to be marked in red and yellow, even after our searching has ended.</li></ul></div></li><li class="listitem">Next we have <a id="id182" class="indexterm"/>the <code class="literal">search_for()</code>function that does the actual searching. The code is as follows:<div class="informalexample"><pre class="programlisting">def search_for(needle, cssnstv, textPad, t2, e) :
  textPad.tag_remove('match', '1.0', END)
  count =0
  if needle:
    pos = '1.0'
    while True:
      pos = textPad.search(needle, pos, nocase=cssnstv,stopindex=END)
    if not pos: break
      lastpos = '%s+%dc' % (pos, len(needle))
      textPad.tag_add('match', pos, lastpos)
      count += 1
      pos = lastpos
  textPad.tag_config('match', foreground='red',background='yellow')
  e.focus_set()
  t2.title('%d matches found' %count)</pre></div><p>The description of the code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This part of code is the heart of the search function. It searches through the entire document using the <code class="literal">while True</code> loop, breaking out of the loop only if no more text items remain to be searched.</li><li class="listitem" style="list-style-type: disc">The code first removes any previous search-related <code class="literal">match</code> tags as we do not want to append the results of the new search to previous search results. The function uses the <code class="literal">search()</code> method provided in Tkinter on the Text widget. The <code class="literal">search()</code> function takes the following arguments:<div class="informalexample"><pre class="programlisting">search(pattern,  index,  stopindex=None,  forwards=None,  backwards=None, exact=None, regexp=None, nocase=None, count=None)</pre></div><p>The method returns the starting position of the first match. We store it in a<a id="id183" class="indexterm"/> variable with the name <code class="literal">pos</code> and also calculate the position of the last character in the matched word and store it in the variable <code class="literal">lastpos</code>.</p></li><li class="listitem" style="list-style-type: disc">For every search match that it finds, it adds a tag named <code class="literal">match</code> to the range of text starting from the first position to the last position. After every match, we set the value of <code class="literal">pos</code> to be equal to <code class="literal">lastpos</code>. This ensures that the next search starts after <code class="literal">lastpos</code>.</li><li class="listitem" style="list-style-type: disc">The loop also keeps track of the number of matches using the count variable.</li><li class="listitem" style="list-style-type: disc">Outside the loop, the tag <code class="literal">match</code> is configured to be of a red font color and with a background of yellow. The last line of this function updates the title of the <span class="strong"><strong>Find</strong></span> window with the number of matches found.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>In the case of event bindings, interaction occurs between your input devices (keyboard/mouse) and your application. In addition to event binding, Tkinter also supports protocol handling.</p><p>The term "protocol" means the interaction between your application and the window manager. An example of a protocol is <code class="literal">WM_DELETE_WINDOW</code>, which handles the <code class="literal">close</code> window event for your window manager. Tkinter lets you override these protocols handlers by mentioning your own handler for the root or Toplevel widget. To override our window exit protocol, we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>root.protocol("WM_DELETE_WINDOW", callback)</strong></span>
</pre></div><p>Once you add this command, Tkinter bypasses protocol handling to your specified callback/handler.</p></div></div></li></ol></div></div><div class="section" title="Objective Complete – Mini Briefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>Objective Complete – Mini Briefing</h2></div></div></div><p>Congratulations! In this iteration, we have completed coding the Select All and Find functionality into our program.</p><p>More importantly, we have been introduced to indexing and tagging—two very powerful concepts associated with many Tkinter widgets. You will find yourself using these two concepts all the time in your projects.</p></div><div class="section" title="Classified Intel"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Classified Intel</h2></div></div></div><p>In the previous code, we used a line that reads: <code class="literal">t2.transient(root)</code>. Let's understand what it means here.</p><p>Tkinter supports four types of Toplevel windows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Main Toplevel window</strong></span>: These <a id="id184" class="indexterm"/>are the ones that we have constructed so far.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Child Toplevel window</strong></span>: These are the ones that are independent of the root. The child Toplevel behaves independently of its root but it gets destroyed if its parent is destroyed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transient Toplevel window</strong></span>: This always appears on top of its parent. The transient window is hidden if the parent is minimized and it is destroyed if the parent is destroyed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Undecorated Toplevel window</strong></span>: A Toplevel window is undecorated if it does not have a window manager decoration around it. It is created by setting the <code class="literal">overrideredirect</code> flag to <code class="literal">1</code>. An undecorated window cannot be resized or moved.</li></ul></div><p>See the code in <code class="literal">2.05.py</code> for a demonstration of all these four types of Toplevel windows.</p></div></div>
<div class="section" title="Working with forms and dialogs"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Working with forms and dialogs</h1></div></div></div><p>The goal for this <a id="id185" class="indexterm"/>iteration is to complete the functioning of the <span class="strong"><strong>File</strong></span> menu<a id="id186" class="indexterm"/> options of <span class="strong"><strong>Open</strong></span>, <span class="strong"><strong>Save</strong></span>, and <span class="strong"><strong>Save As</strong></span>.</p><div class="section" title="Prepare for Lift Off"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Prepare for Lift Off</h2></div></div></div><p>We regularly use the <span class="strong"><strong>Open</strong></span> and <span class="strong"><strong>Save</strong></span> dialogs. They are common across many programs. We know how these menu items behave. For instance, when you click on the <span class="strong"><strong>Open</strong></span> menu, it opens up a dialog form that lets you traverse to the location of the file you want to open. <a id="id187" class="indexterm"/>When you select a particular file and click on <span class="strong"><strong>Open</strong></span>, it opens up in your editor. Similarly, we have the <span class="strong"><strong>Save</strong></span> dialog.</p><p>While we can implement these dialogs using standard Tkinter widgets, it turns out that they are so commonly used that a specific Tkinter module called <code class="literal">tkFileDialog</code> has been included in the standard Python distribution. We will not try to reinvent the wheel and in the spirit of less coding, we will use the <code class="literal">tkFileDialog</code> module to implement Open and Save functionality for our text editor as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7941_02_07.jpg" alt="Prepare for Lift Off"/></div><p>To use the module,<a id="id188" class="indexterm"/> we simply import it into the current namespace as given in the code file of <code class="literal">2.06.py</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>import tkFileDialog</strong></span>
</pre></div><p>You can specify the following additional options for <code class="literal">tkFileDialog</code>:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>File dialog</p>
</th><th style="text-align: left" valign="bottom">
<p>Configurable options</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">askopenfile(mode='r', **options)</code>
<a id="id189" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">parent</code>, <code class="literal">title</code>, <code class="literal">message</code>, <code class="literal">defaultextension</code>, <code class="literal">filetypes</code>, <code class="literal">initialdir</code>, <code class="literal">initialfile</code>, and <code class="literal">multiple</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Asks for a filename to open, and then it returns the opened file</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">askopenfilename(**options)</code>
<a id="id190" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">parent</code>, <code class="literal">title</code>, <code class="literal">message</code>, <code class="literal">defaultextension</code>, <code class="literal">filetypes</code>, <code class="literal">initialdir</code>, <code class="literal">initialfile</code>, and <code class="literal">multiple</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Asks for a filename to open but returns nothing</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">asksaveasfile(mode='w', **options)</code>
<a id="id191" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">parent</code>, <code class="literal">title</code>, <code class="literal">message</code>, <code class="literal">defaultextension</code>, <code class="literal">filetypes</code>, <code class="literal">initialdir</code>, <code class="literal">initialfile</code>, and <code class="literal">multiple</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Asks for a filename to save as, and it returns the opened file</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">asksaveasfilename(**options)</code>
<a id="id192" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">parent</code>, <code class="literal">title</code>, <code class="literal">message</code>, <code class="literal">defaultextension</code>, <code class="literal">filetypes</code>, <code class="literal">initialdir</code>, <code class="literal">initialfile</code>, and <code class="literal">multiple</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Asks for a filename to save as but returns nothing</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">askdirectory(**options)</code>
<a id="id193" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>parent, title, initialdir, must exist</p>
</td><td style="text-align: left" valign="top">
<p>Asks for a directory, and it returns the filename</p>
</td></tr></tbody></table></div></div><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Engage Thrusters</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let us now <a id="id194" class="indexterm"/>develop <a id="id195" class="indexterm"/>our Open function using <code class="literal">tkDialogBox</code> (refer to code<code class="literal">2.07.py</code>):<div class="informalexample"><pre class="programlisting">import tkFileDialog
import os

def open_file():
  global filename
  filename =   tkFileDialog.askopenfilename(defaultextension=".txt",filetypes =[("All Files","*.*"),("Text Documents","*.txt")])
  if filename == "": # If no file chosen.
    filename = None # Absence of file.
  else:
    root.title(os.path.basename(filename) + " - pyPad") # 
    #Returning the basename of 'file'
    textPad.delete(1.0,END)         
    fh = open(filename,"r")        
    textPad.insert(1.0,fh.read()) 
    fh.close()</pre></div><p>We then modify the <span class="strong"><strong>Open</strong></span> menu to add a <code class="literal">command</code> callback to this newly-defined method:</p><div class="informalexample"><pre class="programlisting">filemenu.add_command(label="Open", accelerator='Ctrl+O', compound=LEFT, image=openicon, underline =0, <span class="strong"><strong>command=open_file</strong></span>)</pre></div><p>The description <a id="id196" class="indexterm"/>of the code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We import the <code class="literal">tkfileDialog</code> and <code class="literal">os</code> modules into the current namespace.</li><li class="listitem" style="list-style-type: disc">We define our function <code class="literal">open_file()</code>.</li><li class="listitem" style="list-style-type: disc">We declare a variable in the global scope to keep track of the filename of the opened file. This is required to keep track of whether or not a file has been opened. We need this variable in the global scope, as we want this variable to be available to other methods such as <code class="literal">save()</code> and <code class="literal">save_as()</code>. Not specifying it as global would mean that it is only available within the function. So our <code class="literal">save()</code> and <code class="literal">save_as()</code> functions would not be able to check if a file is already open in the editor.</li><li class="listitem" style="list-style-type: disc">We use <code class="literal">tkFileDialog.askopenfilename</code> to fetch the filename of the opened file. If the user cancels opening the file or if no file is chosen, the filename returned is <code class="literal">None</code>. In that case we do nothing.</li><li class="listitem" style="list-style-type: disc">If, however, <code class="literal">tkFileDialog</code> returns a valid filename, we isolate the filename using the <code class="literal">os</code> module and add it as a title of our root window.</li><li class="listitem" style="list-style-type: disc">If the Text widget already contains some previous text, we delete it all.</li><li class="listitem" style="list-style-type: disc">We then open the given file in read mode and insert all its content into the text area.</li><li class="listitem" style="list-style-type: disc">After this we close the file handle <code class="literal">fh</code>.</li><li class="listitem" style="list-style-type: disc">Finally, we add a <code class="literal">command</code> callback to our <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open</strong></span> menu item.</li></ul></div><p>This completes<a id="id197" class="indexterm"/> the coding of <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open</strong></span>. If you now go and click on <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open</strong></span> and select a text file and click on <span class="strong"><strong>Open</strong></span>, the text area will be populated with the content of the text file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Use of global variables is generally considered a bad programming practice because it is very difficult to understand a program that uses lots of global variables.</p><p>A global variable<a id="id198" class="indexterm"/> can be modified or accessed from many different places in the program, and it therefore becomes difficult to remember or work out every possible use of the variable.</p><p>A global variable is not subject to any access control, which may pose security hazards in certain situations, say when this program is to interact with a third party code.</p><p>However, when you work on programs in the procedural style like this one, global variables are sometimes unavoidable.</p><p>An alternative approach to programming involves writing code in a class structure (also called <span class="strong"><strong>object-oriented programming</strong></span>
<a id="id199" class="indexterm"/>), where a variable can only be accessed by members of predefined classes. We will see a lot of examples of object-oriented programming in the next project.</p></div></div></li><li class="listitem">Next we will see how to save a file. There are two components for saving a file:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Save File</li><li class="listitem" style="list-style-type: disc">Save As</li></ul></div><p>If the text pad already contains a file, we do not prompt the user for a filename. We simply overwrite the contents of the existing file. If there is no filename associated with the current content of the text area, we prompt the user with a <span class="strong"><strong>Save As</strong></span> dialog. Moreover, if the text area has an open file, and the user clicks on <span class="strong"><strong>Save As</strong></span>, we still prompt them with a <span class="strong"><strong>Save As</strong></span>
<a id="id200" class="indexterm"/> dialog to allow them to write the contents to a different filename.</p><p>The code for Save and Save As is as follows (see the code in <code class="literal">2.07.py</code>):</p><div class="informalexample"><pre class="programlisting">#Defining save method
def save():
  global filename
  try:
    f = open(filename, 'w')
    letter = textPad.get(1.0, 'end')
    f.write(letter)
    f.close()
  except:
    save_as()

#Defining save_as method
def save_as():
  try:
     # Getting a filename to save the file.
     f = tkFileDialog.asksaveasfilename(initialfile = 'Untitled.txt', defaultextension=".txt",filetypes=[("All Files","*.*"),("Text Documents","*.txt")])
     fh = open(f, 'w')           
     textoutput = textPad.get(1.0, END)
     fh.write(textoutput)              
     fh.close()
     root.title(os.path.basename(f) + " - pyPad")
  except:
     pass

filemenu.add_command(label="Save", accelerator='Ctrl+S', compound=LEFT, image=saveicon, underline=0, <span class="strong"><strong>command=save</strong></span>)
filemenu.add_command(label="Save as", accelerator='Shift+Ctrl+S', <span class="strong"><strong>command=save_as</strong></span>)</pre></div><p>The description of the code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">save</code> function<a id="id201" class="indexterm"/> first tries to locate if a file is open in the text area using a <code class="literal">try</code> block<a id="id202" class="indexterm"/>. If a file is open, it simply overwrites the content of the file with the current content of the text area.</li><li class="listitem" style="list-style-type: disc">If there is no filename associated with the text area, it simply passes the<a id="id203" class="indexterm"/> work to our <code class="literal">save_as</code> function.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">save_as</code> function opens a dialog using <code class="literal">tkFileDialog.asksaveasfilename</code> and tries to get the filename provided by the user for the given file. If it succeeds, it opens the new file in the write mode and writes the content of text into this new filename. After writing, it closes the current file handler and changes the title of the window to reflect the new filename.</li><li class="listitem" style="list-style-type: disc">To obtain the new filename, our <code class="literal">save_as</code> function makes use of the <code class="literal">os</code> module. We, therefore, need to import the <code class="literal">os</code> module into our namespace before we can use it to extract the current filename.</li><li class="listitem" style="list-style-type: disc">If the user does not specify a filename or if the user cancels the <code class="literal">save_as</code> operation, it simply ignores the process by using a <code class="literal">pass</code> command.</li><li class="listitem" style="list-style-type: disc">Finally, we add a <code class="literal">command</code> callback from our existing <span class="strong"><strong>Save</strong></span> and <span class="strong"><strong>Save As</strong></span> menu items to invoke these two functions.</li></ul></div><p>We are now done adding Save and Save As functionality to our code editor.</p></li><li class="listitem">While we are at it, let's complete our functionality of <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span>. The code is simple. For this see the code in <code class="literal">2.07.py</code>:<div class="informalexample"><pre class="programlisting">def new_file():
  root.title("Untitled")
  global filename
  filename = None
  textPad.delete(1.0,END)

  filemenu.add_command(label="New", accelerator='Ctrl+N', compound=LEFT, image=newicon, underline=0, <span class="strong"><strong>command=new_file</strong></span>  )</pre></div><p>The description for this code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">new_file</code> function begins by changing the <code class="literal">title</code> attribute of the root window to <code class="literal">Untitled</code>.</li><li class="listitem" style="list-style-type: disc">It then sets<a id="id204" class="indexterm"/> the value of the global variable <code class="literal">filename</code> to <code class="literal">None</code>. This is important because our <code class="literal">save</code> and <code class="literal">save_As</code> functionality uses this global variable name to track whether or<a id="id205" class="indexterm"/> not the file exists or is new.</li><li class="listitem" style="list-style-type: disc">Our function then deletes all the content of the Text widget, creating a fresh document in its place.</li><li class="listitem" style="list-style-type: disc">Finally, we add a <code class="literal">command</code> callback to function from our <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> menu item.</li></ul></div><p>This completes our coding of <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> into our code editor.</p></li></ol></div></div><div class="section" title="Objective Complete – Mini Briefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>Objective Complete – Mini Briefing</h2></div></div></div><p>In this iteration, we completed coding functionality for the <span class="strong"><strong>New</strong></span>, <span class="strong"><strong>Open</strong></span>, <span class="strong"><strong>Save</strong></span>, and <span class="strong"><strong>Save As</strong></span> submenus, present under the <span class="strong"><strong>File</strong></span> menu, for our editor.</p><p>More importantly, we saw how to use the <code class="literal">tkFileDialog</code> module to achieve certain commonly-used features in our program. We also saw how we could use indexing to achieve a wide variety of tasks for our programs.</p></div></div>
<div class="section" title="Working with message boxes"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Working with message boxes</h1></div></div></div><p>In this iteration, let's complete our <a id="id206" class="indexterm"/>code for the <span class="strong"><strong>About</strong></span> and <span class="strong"><strong>Help</strong></span> menus. The functionality is simple. When a user clicks on the <span class="strong"><strong>Help</strong></span> or <span class="strong"><strong>About</strong></span> menu, it pops up a message window and waits for the user to respond by clicking on a button. While we can easily code new Toplevel windows to show our <span class="strong"><strong>About</strong></span> and <span class="strong"><strong>Help</strong></span> popup windows, we will instead use a module called <code class="literal">tkMessageBox</code> to achieve this functionality. This is because the module provides an efficient way to handle this and similar functionalities with minimal coding.</p><p>We will also complete coding the <span class="strong"><strong>Exit</strong></span> button functioning in this iteration. Currently, when a user clicks on<a id="id207" class="indexterm"/> the <span class="strong"><strong>Close</strong></span> button, the window is simply closed. We want to ask the user if they really want to quit or have they clicked on the <span class="strong"><strong>Close</strong></span> button accidentally.</p><div class="section" title="Prepare for Lift Off"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Prepare for Lift Off</h2></div></div></div><p>The <code class="literal">tkMessageBox</code> module provides ready-made message boxes to display a wide variety of messages in your applications. Some of these functions are <code class="literal">showinfo</code>, <code class="literal">showwarning</code>, <code class="literal">showerror</code>, <code class="literal">askquestion</code>, <code class="literal">askyesno</code>, <code class="literal">askokcancel</code>, and <code class="literal">askretryignore</code>. These are illustrated, when in use, in the following screenshot:</p><div class="mediaobject"><img src="graphics/7941_02_08.jpg" alt="Prepare for Lift Off"/></div><p>To use the module, we simply import it into the current namespace as shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>import tkMessageBox</strong></span>
</pre></div><p>A demonstration of commonly-used functions of <code class="literal">tkMessageBox</code> is illustrated in <code class="literal">2.08.py</code>. Some common usage patterns are mentioned as follows:</p><div class="informalexample"><pre class="programlisting">tkMessageBox.showwarning("Beware", "You are warned")
tkMessageBox.showinfo("FYI", "This is FYI")
tkMessageBox.showerror("Err..", "its leaking.")
tkMessageBox.askquestion("?", "Can you read this ?")
tkMessageBox.askokcancel("OK", "Quit Postponing ?")
tkMessageBox.askyesno("Yes or No", " What Say ?")    
tkMessageBox.askretrycancel("Retry", "Load Failed")</pre></div><p>Using this module to display messages has the following advantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Minimal coding yields functional features</li><li class="listitem" style="list-style-type: disc">The messages can easily be configured</li><li class="listitem" style="list-style-type: disc">Messages are presented with icons</li><li class="listitem" style="list-style-type: disc">It presents<a id="id208" class="indexterm"/> a standardized view of common messages on each platform</li></ul></div></div><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>Engage Thrusters</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let us now code the <code class="literal">about</code> and <code class="literal">help</code> functions for our code editor. The use case is simple. When a user clicks on the <span class="strong"><strong>About</strong></span> menu, it pops up a message with the <span class="strong"><strong>OK</strong></span> button. Similarly, when the user clicks on the <span class="strong"><strong>Help</strong></span> button, they are also prompted with a message with the <span class="strong"><strong>OK</strong></span> button.<p>To achieve these functionalities, we include the following code in our editor. (See the code in <code class="literal">2.09.py</code>)</p><div class="informalexample"><pre class="programlisting">import tkMessageBox
def about(event=None):
  tkMessageBox.showinfo("About","Tkinter GUI Application\n Development Hotshot")

def help_box(event=None):
  tkMessageBox.showinfo("Help","For help refer to book:\n
  Tkinter GUI Application\n Development Hotshot ", icon='question')

aboutmenu.add_cascade(label="Help", <span class="strong"><strong>command=help_box</strong></span>)</pre></div></li><li class="listitem">Next, we will look at adding the Quit Confirmation feature. When the user clicks on <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Exit</strong></span>, it prompts an <code class="literal">Ok-Cancel</code> dialog to confirm the quit action.<div class="informalexample"><pre class="programlisting">def exit_editor(event=None):
  if tkMessageBox.askokcancel("Quit", "Do you really want to quit?"):
    root.destroy()
root.protocol('WM_DELETE_WINDOW', exit_command) # override close 
filemenu.add_command(label="Exit", accelerator='Alt+F4', command=exit_editor)</pre></div><p>The description of the code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">First we import <code class="literal">tkMessageBox</code> into our current namespace.</li><li class="listitem" style="list-style-type: disc">We then define our <code class="literal">about</code> function to display a <code class="literal">showinfo</code> message box.</li><li class="listitem" style="list-style-type: disc">Similarly, we define our <code class="literal">help_box</code> function to display a <code class="literal">showinfo</code> message box.</li><li class="listitem" style="list-style-type: disc">We then define the <code class="literal">exit</code> command with an <code class="literal">askokcancel</code> box.<a id="id209" class="indexterm"/> If the user clicks on <span class="strong"><strong>OK</strong></span>, the <code class="literal">exit</code> command destroys the root window to close the window.</li><li class="listitem" style="list-style-type: disc">We then override the close button protocol and redirect it to be handled by our definition of the <code class="literal">exit</code> command.</li><li class="listitem" style="list-style-type: disc">Finally, we add <code class="literal">command</code> callbacks to <span class="strong"><strong>About</strong></span>, <span class="strong"><strong>Help</strong></span>, and <span class="strong"><strong>Exit</strong></span> menu items.</li></ul></div></li></ol></div></div><div class="section" title="Objective Complete – Mini Briefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>Objective Complete – Mini Briefing</h2></div></div></div><p>In this iteration, we completed coding the functionality for the <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Exit</strong></span>, <span class="strong"><strong>About</strong></span> | <span class="strong"><strong>About</strong></span>, and <span class="strong"><strong>About</strong></span> | <span class="strong"><strong>Help</strong></span> menu items of our code editor. We also saw how to use the <code class="literal">tkMessageBox</code> module to display different message boxes for some commonly-used message formats.</p></div></div>
<div class="section" title="The icon toolbar and View menu functions"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>The icon toolbar and View menu functions</h1></div></div></div><p>In this iteration, we will add a few more functionalities to our text editor:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Showing the shortcut icon toolbar</li><li class="listitem" style="list-style-type: disc">Displaying line numbers</li><li class="listitem" style="list-style-type: disc">Highlighting the current line</li><li class="listitem" style="list-style-type: disc">Changing the color theme of the editor</li></ul></div><div class="mediaobject"><img src="graphics/7941_02_09.jpg" alt="The icon toolbar and View menu functions"/></div><p>In the process, we will see more usage of indexing and tagging.</p><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>Engage Thrusters</h2></div></div></div><p>Let's start with a simple task first. In this step we add the shortcut icon toolbar to our editor. Recall that we have already created a<a id="id210" class="indexterm"/> frame to hold these toolbar icons. Let's add these icons now.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's start with adding a shortcut icon toolbar. While adding these icons, we have followed a convention. All icons have been placed in the <code class="literal">icons</code> folder. Moreover, the icons have been named exactly the same as the corresponding function that handles them. Following this convention has enabled us to loop through a list, simultaneously applying the icon image to each button and adding the <code class="literal">command</code> callback from within the loop.<p>The code has been placed between the shortcut frame we created earlier to place these icons. The code is as follows (refer to the code in <code class="literal">2.10.py</code>):</p><div class="informalexample"><pre class="programlisting">shortcutbar = Frame(root,  height=25, bg='light sea green')
#creating icon toolbar
icons = ['new_file', 'open_file', 'save', 'cut', 'copy', 'paste', 'undo', 'redo', 'on_find', 'about']
for i, icon in enumerate(icons):
  tbicon = PhotoImage(file='icons/'+icon+'.gif')
  cmd = eval(icon)
  toolbar = Button(shortcutbar, image=tbicon, command=cmd)
  toolbar.image = tbicon
  toolbar.pack(side=LEFT)
shortcutbar.pack(expand=NO, fill=X)</pre></div><p>The description of the code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We have already created a shortcut bar in our first iteration. Now we place our code between the lines where we created the frame and line and where we used the <code class="literal">pack</code> manager to display it.</li><li class="listitem" style="list-style-type: disc">We create a list of icons, taking care to name them exactly as the name of icons.</li><li class="listitem" style="list-style-type: disc">We then iterate through<a id="id211" class="indexterm"/> a loop with length equal to the number of items in the icons lists. In every loop, we create a Button widget, taking the corresponding image and adding the respective <code class="literal">command</code> callback.</li><li class="listitem" style="list-style-type: disc">Before adding the <code class="literal">command</code> callback, we had to convert the string to an equivalent expression using the <code class="literal">eval</code> command. If we do not apply <code class="literal">eval</code>, it cannot be applied as an expression to our <code class="literal">command</code> callback.</li></ul></div><p>This completes our coding of the shortcut icon toolbar. Now, if you run the code (code <code class="literal">2.10.py</code>), it should show you a shortcut icon toolbar at the top. Moreover, as we have linked each button to a callback, all these shortcut icons should work as they should.</p></li><li class="listitem">Let us now work at showing line numbers on the left frame of the Text widget. This will require us to do a bit if tweaking of code at various places. So, before we start coding, let's take a look at what we are trying to achieve here:<div class="mediaobject"><img src="graphics/foo.jpg" alt="Engage Thrusters"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>View</strong></span> menu has <a id="id212" class="indexterm"/>a menu item that lets the user choose whether or not to show the line numbers. We only want to show line numbers if the <a id="id213" class="indexterm"/>option is selected.</li><li class="listitem" style="list-style-type: disc">If the option is selected, we need to display line numbers in the left frame that we created earlier.</li><li class="listitem" style="list-style-type: disc">The line number should update every time a user enters a new line, deletes a line, cuts or pastes text from the line, performs an undo or redo operation, opens an existing file, or clicks on the new menu item. In short, the line number should be updated after every activity that may affect line numbers.</li></ul></div><p>Therefore, we need to define a function called <code class="literal">update_line_number()</code>. <a id="id214" class="indexterm"/>This function should be called after every keypress, cut, paste, undo, redo, new, and open definitions to see if lines have been added or removed from the text area and accordingly update the line numbers. We achieve this using these two strategies (see the code in <code class="literal">2.10.py</code>):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bind any keypress events to our <code class="literal">update_line_number()</code> function:<div class="informalexample"><pre class="programlisting">	textPad.bind("&lt;Any-KeyPress&gt;", update_line_number)</pre></div></li><li class="listitem" style="list-style-type: disc">Add a call to our <code class="literal">update_line_number()</code> function in each of our definitions of cut, paste, undo, redo, new, and open</li></ul></div><p>Finally, we define our <code class="literal">update_line_number()</code> function as follows:</p><div class="informalexample"><pre class="programlisting">def update_line_number(event=None):
  txt = ''
  if showln.get(): 
     endline, endcolumn = textPad.index('end-1c').split('.')
     txt = '\n'.join(map(str, range(1, int(endline))))
  lnlabel.config(text=txt, anchor='nw')</pre></div><p>The description of the code is listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Recall<a id="id215" class="indexterm"/> that we <a id="id216" class="indexterm"/>have assigned a variable <code class="literal">showln</code> to our menu item earlier:<div class="informalexample"><pre class="programlisting">	showln = IntVar()
	showln.set(1)
	viewmenu.add_checkbutton(label="Show Line Number", variable=showln)
	update_line_number</pre></div></li><li class="listitem" style="list-style-type: disc">We first mark the text configuration of label as blank.</li><li class="listitem" style="list-style-type: disc">If the <code class="literal">showline</code> option is set to <code class="literal">1</code> (that is to say, it has been tick-marked in the menu item), we calculate the last line and last column in the text.</li><li class="listitem" style="list-style-type: disc">We then create a text string consisting of numbers from 1 to the number of the last line, each number separated by a line break, <code class="literal">\n</code>. This string is then added to the left label using<a id="id217" class="indexterm"/> the <code class="literal">textPad.config()</code> method.</li><li class="listitem" style="list-style-type: disc">If <span class="strong"><strong>Show Line Number</strong></span> is unchecked in the menu, the variable text remains blank, thereby displaying no line numbers.</li><li class="listitem" style="list-style-type: disc">Finally, we update each of our previously defined cut, paste, undo, redo, new, and open functions to invoke the <code class="literal">update_line_number()</code> function at their end.</li></ul></div><p>We are now done adding the line number functionality to our text editor.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>You may have noticed an <code class="literal">event=None</code> argument in our function definition previously given. We need to specify this here, because this function can be invoked from two places:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">From the event binding (we bound it to the <code class="literal">&lt;Any-KeyPress&gt;</code> event)</li><li class="listitem" style="list-style-type: disc">From other functions such as cut, copy, paste, undo, redo, and more</li></ul></div><p>When the function is invoked from other functions, no arguments are passed. However, when the function is invoked from an event binding, the event object is passed as parameter. If we do not specify the <code class="literal">event=None</code> argument and the function is invoked from an event binding, it will give the following error:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>TypeError: myfunction() takes no arguments (1 given)</strong></span>
</pre></div></div></div></li><li class="listitem">Last in this iteration,<a id="id218" class="indexterm"/> we will implement a feature where the user can select to add a highlight on the current line. (See the code in <code class="literal">2.10.py</code>)<p>The idea is simple. We need to locate the line of the cursor and add a tag to the line. <a id="id219" class="indexterm"/>And finally, we need to configure that tag to appear with a different color background to highlight it.</p><p>Recall that we have already provided a menu choice to our user to decide whether or not to highlight the current line. We now add a <code class="literal">command</code> callback from this menu item to a function that we define as <code class="literal">toggle_highlight</code>:</p><div class="informalexample"><pre class="programlisting">hltln = IntVar()
viewmenu.add_checkbutton(label="Highlight Current Line", onvalue=1, offvalue=0, variable=hltln, <span class="strong"><strong>command=toggle_highlight</strong></span>)</pre></div><p>We define three functions to handle this for us:</p><div class="informalexample"><pre class="programlisting">#line highlighting 
def highlight_line(interval=100):
  textPad.tag_remove("active_line", 1.0, "end")
  textPad.tag_add("active_line", "insert linestart", "insert lineend+1c")
  textPad.after(interval, toggle_highlight)

def undo_highlight():
  textPad.tag_remove("active_line", 1.0, "end")

def toggle_highlight(event=None):
  val = hltln.get()
  undo_highlight() if not val else highlight_line()</pre></div><p>The description of the code is given as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Every time a<a id="id220" class="indexterm"/> user checks/unchecks the <span class="strong"><strong>View</strong></span> | <span class="strong"><strong>Highlight Current Line</strong></span>, it invokes our function <code class="literal">toggle_highlight</code>. This function checks if the menu item is checked. If it is checked, it invokes the <code class="literal">highlight_line</code> function, otherwise, if the<a id="id221" class="indexterm"/> menu item is unchecked, it invokes the undo highlight function.</li><li class="listitem" style="list-style-type: disc">Our <code class="literal">highlight_line</code> function simply adds a tag called <code class="literal">active_line</code> to our current line, and after every one second it calls the toggle highlight function to check whether the current line should still be highlighted.</li><li class="listitem" style="list-style-type: disc">Our <code class="literal">undo_highlight</code> function is invoked when the user unchecks highlighting in the <span class="strong"><strong>View</strong></span> menu. Once invoked, it simply removes the <code class="literal">active_line</code> tag from the entire text area.</li><li class="listitem" style="list-style-type: disc">Finally, we configure our tag named <code class="literal">active_line</code> to be displayed with a different background color:<div class="informalexample"><pre class="programlisting">	textPad.tag_configure("active_line", background="ivory2")</pre></div></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>In our code, we used the <code class="literal">.widget.after(ms, callback)</code> handler. Methods like this that let us perform some periodic actions are called <span class="strong"><strong>alarm handlers</strong></span>
<a id="id222" class="indexterm"/>. Some commonly used Tkinter alarm handlers include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">after(delay_ms, callback, args...)</code>: Registers an alarm callback to be called after given number of millisecond</li><li class="listitem" style="list-style-type: disc"><code class="literal">after_cancel(id)</code>: Cancels the given alarm callback</li><li class="listitem" style="list-style-type: disc"><code class="literal">after_idle(callback, args...)</code>: Calls back only when there are no more events to process in the mainloop, that is, after the system becomes idle</li></ul></div></div></div></li><li class="listitem">The info bar is simply a small area at the bottom-right corner of our Text widget, which displays the current line number and column number of the position of the cursor as shown in the following screenshot:<div class="mediaobject"><img src="graphics/7941_02_11.jpg" alt="Engage Thrusters"/></div><p>The user can choose to show/hide this info bar from the view menu; refer to the <a id="id223" class="indexterm"/>code in <code class="literal">2.11.py</code>. We begin by creating a Label widget within the Text widget and pack it in the southeast corner.</p><div class="informalexample"><pre class="programlisting">infobar = Label(textPad, text='Line: 1 | Column: 0')
infobar.pack(expand=NO, fill=None, side=RIGHT, anchor='se')</pre></div><p>In many ways, this is similar to displaying the line numbers. Here, too, the positions must be calculated after every keypress or after events such as cut, paste, undo, redo, new, open, or activities that lead to a change in cursor positions. Because this is so similar to our line number code, we will use the existing bindings and existing function <code class="literal">update_line_number()</code> to update this. To do this, we simply add two lines to our existing definition of the <code class="literal">update_line_number()</code> function:</p><div class="informalexample"><pre class="programlisting">currline, curcolumn = textPad.index("insert").split('.')
infobar.config(text= 'Line: %s | Column: %s' %(currline, curcolumn))</pre></div><p>This keeps updating the label with the line and column of the current cursor position.</p><p>Finally, if the user unchecks the option from the <span class="strong"><strong>View</strong></span> menu, we need to hide this widget. We do this by defining a function called <code class="literal">show_info_bar</code>, which depending upon the user-selected choice, either applies <code class="literal">pack</code> or <code class="literal">pack_forget</code> to the <code class="literal">infobar</code> label.</p><div class="informalexample"><pre class="programlisting">def show_info_bar():
  val = showinbar.get()
  if val:
    infobar.pack(expand=NO, fill=None, side=RIGHT, anchor='se')
  elif not val:
    infobar.pack_forget()</pre></div><p>This function<a id="id224" class="indexterm"/> is then connected to the existing menu item using a <code class="literal">command</code> callback:</p><div class="informalexample"><pre class="programlisting">viewmenu.add_checkbutton(label="Show Info Bar at Bottom", variable=showinbar ,<span class="strong"><strong>command=show_info_bar</strong></span>)</pre></div></li><li class="listitem">Recall that while<a id="id225" class="indexterm"/> defining our <span class="strong"><strong>Themes</strong></span> menu, we defined a color scheme dictionary containing the name and hexadecimal color codes as a key-value pair. Actually, we need two colors for each theme, one for the background and other for our foreground color. Let's modify our color definition to specify two colors separated by the dot character (<code class="literal">.</code>). Refer to code <code class="literal">2.11.py</code>:<div class="informalexample"><pre class="programlisting">clrschms = {
'1. Default White': '000000.FFFFFF',
'2. Greygarious Grey': '83406A.D1D4D1',
'3. Lovely Lavender': '202B4B.E1E1FF' ,
'4. Aquamarine': '5B8340.D1E7E0',
'5. Bold Beige': '4B4620.FFF0E1',
'6. Cobalt Blue': 'ffffBB.3333aa',
'7. Olive Green': 'D1E7E0.5B8340',
}</pre></div><p>Our theme choice menu has already been defined earlier. Let us now add a <code class="literal">command</code> callback to handle the selected menu:</p><div class="informalexample"><pre class="programlisting">themechoice= StringVar()
themechoice.set('1. Default White')
for k in sorted(clrschms):
  themesmenu.add_radiobutton(label=k, variable=themechoice, command=theme)
  menubar.add_cascade(label="View", menu=viewmenu)</pre></div><p>Finally, let's define our <code class="literal">theme</code> function to handle the changing of themes:</p><div class="informalexample"><pre class="programlisting">def theme():
  global bgc,fgc
  val = themechoice.get()
  clrs = clrschms.get(val)
  fgc, bgc = clrs.split('.')
  fgc, bgc = '#'+fgc, '#'+bgc
  textPad.config(bg=bgc, fg=fgc)</pre></div><p>The function is simple. It picks up the key-value pair from our defined color scheme dictionary. It splits the color into its two components and applies one color each to the Text widget foreground and background using <code class="literal">widget.config()</code>.</p><p>Now if you select <a id="id226" class="indexterm"/>a different color from the <span class="strong"><strong>Themes</strong></span> menu, the background and foreground colors change accordingly.</p></li></ol></div></div><div class="section" title="Objective Complete – Mini Briefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>Objective Complete – Mini Briefing</h2></div></div></div><p>We completed coding our shortcut icon toolbar and all functionality of the <span class="strong"><strong>View</strong></span> menu in this iteration. In the process we learned how to handle the Checkbutton and Radiobutton menu items. We also saw how to make compound buttons, while reinforcing several Tkinter options covered in previous sections.</p></div></div>
<div class="section" title="Event handling and the context menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Event handling and the context menu</h1></div></div></div><p>In this last iteration, we will add the following features to our editor:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Event handling</li><li class="listitem" style="list-style-type: disc">The context menu</li><li class="listitem" style="list-style-type: disc">The title bar icon</li></ul></div><div class="section" title="Engage Thrusters"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>Engage Thrusters</h2></div></div></div><p>Let us complete our editor in this final iteration.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First we will <a id="id227" class="indexterm"/>add the event handling features. We have added the accelerator keyboard shortcuts to a large number of our menu items. However, merely adding accelerator keys does not add the required functionality. For example, pressing the keys <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>N</em></span> should create a new file, but simply adding it as an accelerator does not make it functional. Let's add these event handling features into our code.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>Note that all our functionality is already complete. Now we simply need to map the events to their related callbacks. (Refer to the code in <code class="literal">2.12.py.</code>)</p></div></div><div class="informalexample"><pre class="programlisting">textPad.bind('&lt;Control-N&gt;', new_file)
textPad.bind('&lt;Control-n&gt;', new_file)
textPad.bind('&lt;Control-O&gt;', open_file)
textPad.bind('&lt;Control-o&gt;', open_file)
textPad.bind('&lt;Control-S&gt;', save)
textPad.bind('&lt;Control-s&gt;', save)
textPad.bind('&lt;Control-A&gt;', select_all)
textPad.bind('&lt;Control-a&gt;', select_all)
textPad.bind('&lt;Control-f&gt;', on_find)
textPad.bind('&lt;Control-F&gt;', on_find)
textPad.bind('&lt;KeyPress-F1&gt;', help_box)</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>Simply adding these lines takes care of our event bindings. However, this introduces a new issue for us. We have already discussed that event bindings pass the event object as a parameter to the bound callback. None of our previous functions are equipped to handle the incoming parameters. To do that we need to add the <code class="literal">event=None</code> parameter.</p><p>Adding this optional argument allows us to use these functions with or without the event parameter.</p><p>Alternatively, you can also add <code class="literal">textPad.bind (event, lambda e: callback())</code>to ignore the <code class="literal">event</code> argument altogether.</p></div></div><p>Now you can access<a id="id228" class="indexterm"/> these functions using your keyboard shortcuts.</p><p>Note that we did not bind keyboard shortcuts for cut, copy, and paste. This is because the Text widget comes with automatic binding for these events. If you add bindings for these events, it will cause cut, copy, and paste events to take place twice; once from the built-in widget and once from your own defined event handler.</p></li><li class="listitem">Next we will add the context menu. <a id="id229" class="indexterm"/>But before that, we need to understand what a context menu is.<p>The menu that pops up on the right-mouse-button click at the location of the mouse cursor is called the <span class="strong"><strong>context menu</strong></span> or the <span class="strong"><strong>o</strong></span>. This is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7941_02_12.jpg" alt="Engage Thrusters"/></div><p>Let's code this feature in our text editor. We first define our context menu:</p><div class="informalexample"><pre class="programlisting">cmenu = Menu(textPad)
for i in ('cut', 'copy', 'paste', 'undo', 'redo'):
  cmd = eval(i)
  cmenu.add_command(label=i, compound=LEFT, command=cmd)  
  cmenu.add_separator()
  cmenu.add_command(label='Select All', underline=7, command=select_all)</pre></div><p>We then bind the right-click of a mouse with a callback named <code class="literal">popup</code>:</p><div class="informalexample"><pre class="programlisting">textPad.bind("&lt;Button-3&gt;", popup)</pre></div><p>Finally, we define the method <code class="literal">popup</code>:</p><div class="informalexample"><pre class="programlisting">def popup(event):
  cmenu.<span class="strong"><strong>tk_popup</strong></span>(event.x_root, event.y_root, 0)</pre></div></li><li class="listitem">As a final touch to <a id="id230" class="indexterm"/>our application, we add a title bar icon for our editor using the following code:<div class="informalexample"><pre class="programlisting">root.<span class="strong"><strong>iconbitmap</strong></span>('icons/pypad.ico') </pre></div></li></ol></div></div><div class="section" title="Objective Complete – Mini Briefing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>Objective Complete – Mini Briefing</h2></div></div></div><p>In this iteration we added support for event handling, and added a contextual menu and title bar icon to our editor program.</p></div></div>
<div class="section" title="Mission Accomplished"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Mission Accomplished</h1></div></div></div><p>We have completed coding our editor in seven iterations. We started by placing all widgets on our Toplevel window. We then leveraged some built-in features of the Text widget to code some functionality. We learned some very important concepts of indexing and tagging, which you will find yourself using frequently in Tkinter projects.</p><p>We also saw how to use the <code class="literal">tkfileDialog</code> and <code class="literal">tkMessageBox</code> modules to quickly code some common features in our programs.</p><p>Congratulations! You have now completed coding your text editor.</p></div>
<div class="section" title="A Hotshot Challenge"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>A Hotshot Challenge</h1></div></div></div><p>Here's your <a id="id231" class="indexterm"/>Hotshot challenge:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Your goal is to turn this text editor into a Python code editor. Your editor should allow the opening and saving of the <code class="literal">.py</code> file extension.</li><li class="listitem" style="list-style-type: disc">If the file has a <code class="literal">.py</code> extension, your editor should implement syntax highlighting and tab <a id="id232" class="indexterm"/>indenting.</li><li class="listitem" style="list-style-type: disc">While this can be easily done with external libraries, you should try to implement these features on your own using built-in Tkinter options that we have seen so far. For hints you can look at the source code of Python's built-in editor IDLE, which is written in Tkinter.</li></ul></div></div></body></html>