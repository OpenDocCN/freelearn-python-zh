<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<title>ch011.xhtml</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body epub:type="bodymatter">
<section class="level1" data-number="11" id="chapter-7-data-inspection-features">
<h1 data-number="11"><span class="titlemark"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 7</span></span><br/>
<span id="x1-1610007"/><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Data Inspection Features</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">There are three broad kinds of data domains: cardinal, ordinal, and nominal. </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">The first project in this chapter will guide you through the inspection of cardinal data; values like weights, measures, and durations where the data is continuous, as well as counts where the data is discrete. </span><span class="koboSpan" id="kobo.3.3" xmlns="http://www.w3.org/1999/xhtml">The second project will guide reasoners through the inspection of ordinal data involving things like dates, where order matters, but the data isn’t a proper measurement; it’s more of a code or designator. </span><span class="koboSpan" id="kobo.3.4" xmlns="http://www.w3.org/1999/xhtml">The nominal data is a code that happens to use digits but doesn’t represent numeric values. </span><span class="koboSpan" id="kobo.3.5" xmlns="http://www.w3.org/1999/xhtml">The third project will cover the more complex case of matching keys between separate data sources.</span></p>
<p><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">An inspection notebook is required when looking at new data. </span><span class="koboSpan" id="kobo.4.2" xmlns="http://www.w3.org/1999/xhtml">It’s a great place to keep notes and lessons learned. </span><span class="koboSpan" id="kobo.4.3" xmlns="http://www.w3.org/1999/xhtml">It’s helpful when diagnosing problems that arise in a more mature analysis pipeline.</span></p>
<p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">This chapter will cover a number of skills related to </span><span id="dx1-161001"/><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">data inspection techniques:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">Essential notebook data inspection features using Python expressions, extended from the previous chapter.</span></p></li>
<li><p><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml"> module for examining cardinal data.</span></p></li>
<li><p><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">collections.Counter</span></code><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml"> class for examining ordinal and nominal data.</span></p></li>
<li><p><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Some additional </span><code><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">collections.Counter</span></code><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml"> for matching primary and foreign keys.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">For the Ancombe’s Quartet example data set used in </span><em><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">Chapters 3</span></em><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">, </span><em><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">4</span></em><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><em><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">5</span></em><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">, both of the attribute values are cardinal data. </span><span class="koboSpan" id="kobo.23.2" xmlns="http://www.w3.org/1999/xhtml">It’s a helpful data set for some of the inspections, but we’ll need to look at some other data sets for later projects in this chapter. </span><span class="koboSpan" id="kobo.23.3" xmlns="http://www.w3.org/1999/xhtml">We’ll start by looking at some inspection techniques for cardinal data. </span><span class="koboSpan" id="kobo.23.4" xmlns="http://www.w3.org/1999/xhtml">Readers who are focused on other data sets will need to discern which attributes represent cardinal data. </span><span id="x1-161002r175"/></p>
<section class="level3 sectionHead" data-number="11.0.1" id="project-2.2-validating-cardinal-domains-measures-counts-and-durations">
<h3 class="sectionHead" data-number="11.0.1"><span class="titlemark"><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">7.1 </span></span> <span id="x1-1620001"/><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.2: Validating cardinal domains — measures, counts, and durations</span></h3>
<p><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">A great deal of data is </span><span id="dx1-162001"/><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">cardinal in nature. </span><span class="koboSpan" id="kobo.27.2" xmlns="http://www.w3.org/1999/xhtml">Cardinal numbers </span><span id="dx1-162002"/><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">are used to count things, like elements of a set. </span><span class="koboSpan" id="kobo.28.2" xmlns="http://www.w3.org/1999/xhtml">The concept can be generalized to include real numbers representing a weight or a measure.</span></p>
<p><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">A very interesting data set is available here: </span><a class="url" href="https://www.kaggle.com/datasets/rtatman/iris-dataset-json-version"><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">https://www.kaggle.com/datasets/rtatman/iris-dataset-json-version</span></a><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.31.2" xmlns="http://www.w3.org/1999/xhtml">This </span><span id="dx1-162003"/><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">contains samples with numerous measurements of the pistils and stamen of different species of flowers. </span><span class="koboSpan" id="kobo.32.2" xmlns="http://www.w3.org/1999/xhtml">The measurements are identifiable because the unit, mm, is provided.</span></p>
<p><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">Another interesting data set is available here: </span><a class="url" href="https://datahub.io/core/co2-ppm"><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">https://datahub.io/core/co2-ppm</span></a><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.35.2" xmlns="http://www.w3.org/1999/xhtml">This contains data with measurements of CO2 levels measured with units of ppm, parts per million.</span></p>
<p><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">We need to </span><span id="dx1-162004"/><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">distinguish counts and measures from </span><span id="dx1-162005"/><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">numbers that are only used to rank or order things, which are called ordinal numbers. </span><span class="koboSpan" id="kobo.38.2" xmlns="http://www.w3.org/1999/xhtml">Also, number-like data is sometimes only a code. </span><span class="koboSpan" id="kobo.38.3" xmlns="http://www.w3.org/1999/xhtml">US postal codes, for example, are merely strings of digits; they aren’t proper numeric values. </span><span class="koboSpan" id="kobo.38.4" xmlns="http://www.w3.org/1999/xhtml">We’ll look at these numeric values in </span><a href="#x1-1710002"><em><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.3: Validating text and codes — nominal data and ordinal</span></em> <em><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">numbers</span></em></a><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">Since this is an inspection notebook, the primary purpose is only to understand the range of values for cardinal data. </span><span class="koboSpan" id="kobo.42.2" xmlns="http://www.w3.org/1999/xhtml">A deeper analysis will come later. </span><span class="koboSpan" id="kobo.42.3" xmlns="http://www.w3.org/1999/xhtml">For now, we want a notebook that demonstrates the data is complete and consistent, and can be used for further processing.</span></p>
<p><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">In the event an enterprise is using data contracts, this notebook will demonstrate compliance with the </span><span id="dx1-162006"/><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">data contract. </span><span class="koboSpan" id="kobo.44.2" xmlns="http://www.w3.org/1999/xhtml">With data contracts, the focus may shift slightly from showing “some data that is not usable” to showing “data found to be non-compliant with the contract.” </span><span class="koboSpan" id="kobo.44.3" xmlns="http://www.w3.org/1999/xhtml">In cases where the contract is </span><span id="dx1-162007"/><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">inadequate for the </span><span id="dx1-162008"/><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">analytical consumer, the notebook may shift further to show “compliant data that’s not useful.”</span></p>
<p><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">We’ll start with a description of the kinds of cells to add to an inspection notebook. </span><span class="koboSpan" id="kobo.47.2" xmlns="http://www.w3.org/1999/xhtml">After that, we’ll about the architectural approach and wrap up with a detailed list of deliverables. </span><span id="x1-162009r176"/></p>
</section>
<section class="level3" data-number="11.0.2" id="description-7">
<h3 data-number="11.0.2"><span class="titlemark"><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">7.1.1 </span></span> <span id="x1-1630001"/><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></h3>
<p><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">This project’s intent is to inspect raw data to understand if it is actually </span><span id="dx1-163001"/><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">cardinal data. </span><span class="koboSpan" id="kobo.51.2" xmlns="http://www.w3.org/1999/xhtml">In some cases, floating-point values may have been used to represent nominal data; the data appears to be a measurement but is actually a code.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-116">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">Spreadsheet software tends to transform all data into floating-point numbers; many data items may look like cardinal data.</span></p>
<p><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">One example is US Postal Codes, which are strings of digits, but may be transformed into numeric values by a spreadsheet.</span></p>
<p><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">Another example is bank account numbers, which — while very long — can be converted into floating-point numbers. </span><span class="koboSpan" id="kobo.54.2" xmlns="http://www.w3.org/1999/xhtml">A floating-point value uses 8 bytes of storage, but will comfortably represent about 15 decimal digits. </span><span class="koboSpan" id="kobo.54.3" xmlns="http://www.w3.org/1999/xhtml">While this is a net saving in storage, it is a potential confusion of data types and there is a (small) possibility of having an account number altered by floating-point truncation rules.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">The user experience is a Jupyter Lab notebook that can be used to examine the data, show some essential features of the raw data values, and confirm that the data really does appear to be cardinal.</span></p>
<p><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">There are several </span><span id="dx1-163002"/><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">common sub-varieties of cardinal data:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">Counts; represented by integer values.</span></p></li>
<li><p><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">Currency and other money-related values. </span><span class="koboSpan" id="kobo.59.2" xmlns="http://www.w3.org/1999/xhtml">These are often decimal values, and the </span><code><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml"> type is likely to be a bad idea.</span></p></li>
<li><p><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">Duration values. </span><span class="koboSpan" id="kobo.62.2" xmlns="http://www.w3.org/1999/xhtml">These are often measured in days, hours, and minutes, but represent a time interval or a “delta” applied to a point in time. </span><span class="koboSpan" id="kobo.62.3" xmlns="http://www.w3.org/1999/xhtml">These can be normalized to seconds or days and represented by a float value.</span></p></li>
<li><p><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">More general measures are not in any of the previous categories. </span><span class="koboSpan" id="kobo.63.2" xmlns="http://www.w3.org/1999/xhtml">These are often represented by floating-point values.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">What’s </span><span id="dx1-163003"/><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">important for this project is to have an overview of the data. </span><span class="koboSpan" id="kobo.65.2" xmlns="http://www.w3.org/1999/xhtml">Later projects will look at cleaning and converting the data for further use. </span><span class="koboSpan" id="kobo.65.3" xmlns="http://www.w3.org/1999/xhtml">This notebook is only designed to preview and inspect the data.</span></p>
<p><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at general measures first since the principles apply to counts and durations. </span><span class="koboSpan" id="kobo.66.2" xmlns="http://www.w3.org/1999/xhtml">Currency, as well as duration, values are a bit more complicated and we’ll look at them separately. </span><span class="koboSpan" id="kobo.66.3" xmlns="http://www.w3.org/1999/xhtml">Date-time stamps are something we’ll look at in the next project since they’re often thought of as ordinal data, not cardinal. </span><span id="x1-163004r179"/></p>
</section>
<section class="level3" data-number="11.0.3" id="approach-6">
<h3 data-number="11.0.3"><span class="titlemark"><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">7.1.2 </span></span> <span id="x1-1640002"/><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">Approach</span></h3>
<p><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">This project is based on the initial inspection notebook from </span><a href="ch010.xhtml#x1-1460006"><em><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml"> 6</span></em></a><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch010.xhtml#x1-1460006"><em><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">Project</span></em> <em><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">2.1: Data Inspection Notebook</span></em></a><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.75.2" xmlns="http://www.w3.org/1999/xhtml">Some of the essential cell content will be reused in this notebook. </span><span class="koboSpan" id="kobo.75.3" xmlns="http://www.w3.org/1999/xhtml">We’ll add components to the components shown in the earlier chapter – specifically, the </span><code><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">samples_iter()</span></code><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml"> function to iterate over samples in an open file. </span><span class="koboSpan" id="kobo.77.2" xmlns="http://www.w3.org/1999/xhtml">This feature will be central to working with the raw data.</span></p>
<p><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">In the previous chapter, we suggested avoiding conversion functions. </span><span class="koboSpan" id="kobo.78.2" xmlns="http://www.w3.org/1999/xhtml">When starting down the path of inspecting data, it’s best to assume nothing and look at the text values first.</span></p>
<p><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">There are some common </span><span id="dx1-164001"/><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">patterns in the source data values:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">The values appear to be all numeric values. </span><span class="koboSpan" id="kobo.81.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">int()</span></code><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">float()</span></code><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml"> function works on all of the values. </span><span class="koboSpan" id="kobo.85.2" xmlns="http://www.w3.org/1999/xhtml">There are two sub-cases here:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">All of the values seem to be proper counts or measures in some expected range. </span><span class="koboSpan" id="kobo.86.2" xmlns="http://www.w3.org/1999/xhtml">This is ideal.</span></p></li>
<li><p><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">A few “outlier” values are present. </span><span class="koboSpan" id="kobo.87.2" xmlns="http://www.w3.org/1999/xhtml">These are values that seem to be outside the expected range of values.</span></p></li>
</ul></li>
<li><p><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">Some of the values are not valid numbers. </span><span class="koboSpan" id="kobo.88.2" xmlns="http://www.w3.org/1999/xhtml">They may be empty strings, or a code line “NULL”, “None”, or “N/A”.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">Numeric outlier values can be </span><span id="dx1-164002"/><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">measurement errors or an interesting phenomenon buried in the data. </span><span class="koboSpan" id="kobo.90.2" xmlns="http://www.w3.org/1999/xhtml">Outlier values </span><span id="dx1-164003"/><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">can also be numeric code values indicating a known missing or otherwise unusable value for a sample. </span><span class="koboSpan" id="kobo.91.2" xmlns="http://www.w3.org/1999/xhtml">In the example of the CO2 data, there are outlier values of </span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">−</span></span><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">99</span><em><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">.</span></em><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">99 parts per million, which encode a specific kind of missing data situation.</span></p>
<p><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">Many data sets will be accompanied by metadata to explain the domain of values, including non-numeric values, as well as the numeric codes in use. </span><span class="koboSpan" id="kobo.96.2" xmlns="http://www.w3.org/1999/xhtml">Some enterprise data sources will not have complete or carefully explained metadata. </span><span class="koboSpan" id="kobo.96.3" xmlns="http://www.w3.org/1999/xhtml">This means an analyst needs to ask questions to locate the root cause for non-numeric values or special codes that appear in cardinal data.</span></p>
<p><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">The first question — </span><em><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">are all the values numeric? </span></em><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">— can be handled with code like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-117">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">from collections import defaultdict
from collections.abc import Iterable, Callable
from typing import TypeAlias

Conversion: TypeAlias = Callable[[str], int | float]

def non_numeric(test: Conversion, samples: Iterable[str]) -&gt; dict[str, int]:
        bad_data = defaultdict(int)
        for s in samples:
                try:
                        test(s)
                except ValueError:
                        bad_data[s] += 1
        return bad_data</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">The idea is to apply a conversion function, commonly </span><code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">int()</span></code><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">float()</span></code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">, but </span><code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">decimal.Decimal()</span></code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml"> may be useful for currency data or other data with a fixed number of decimal places. </span><span class="koboSpan" id="kobo.107.2" xmlns="http://www.w3.org/1999/xhtml">If the conversion function fails, the exceptional data is preserved in a mapping showing the counts.</span></p>
<p><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">You’re encouraged to try this with a sequence of strings like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-118">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">data = ["2", "3.14", "42", "Nope", None, ""]
non_numeroc(int, data)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">This kind of test case will let you see how this function works with good (and bad) data. </span><span class="koboSpan" id="kobo.110.2" xmlns="http://www.w3.org/1999/xhtml">It can help to transform the test case into a docstring, and include it in the function definition.</span></p>
<p><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">If the result of the </span><code><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">non_numeric()</span></code><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml"> function is an empty dictionary, then the lack of non-numeric data means all of the data is numeric.</span></p>
<p><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">The test function is provided first to follow the pattern of higher-order functions like </span><code><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">map()</span></code><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">filter()</span></code><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">A variation on this function can be used as a numeric filter to pass the numeric values and reject the non-numeric values. </span><span class="koboSpan" id="kobo.119.2" xmlns="http://www.w3.org/1999/xhtml">This would look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-119">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">from collections.abc import Iterable, Iterator, Callable
from typing import TypeVar

Num = TypeVar(’Num’)

def numeric_filter(
    conversion: Callable[[str], Num],
    samples: Iterable[str]
) -&gt; Iterator[Num]:
        for s in samples:
                try:
                        yield conversion(s)
                except ValueError:
                        pass</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml">This function will silently reject the values that cannot be converted. </span><span class="koboSpan" id="kobo.121.2" xmlns="http://www.w3.org/1999/xhtml">The net effect of omitting the data is to create a NULL that does not participate in further computations. </span><span class="koboSpan" id="kobo.121.3" xmlns="http://www.w3.org/1999/xhtml">An alternative may be to replace invalid values with default values. </span><span class="koboSpan" id="kobo.121.4" xmlns="http://www.w3.org/1999/xhtml">An even more complicated choice is to interpolate a replacement value using adjacent values. </span><span class="koboSpan" id="kobo.121.5" xmlns="http://www.w3.org/1999/xhtml">Omitting samples may have a significant impact on the statistical measures used in later stages of processing. </span><span class="koboSpan" id="kobo.121.6" xmlns="http://www.w3.org/1999/xhtml">This </span><code><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">numeric_filter()</span></code><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml"> function permits the use of other statistical functions to locate outliers.</span></p>
<p><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">For data with good documentation or a data contract, outlier values like </span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">−</span></span><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">99</span><em><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">.</span></em><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">99 are easy to spot. </span><span class="koboSpan" id="kobo.128.2" xmlns="http://www.w3.org/1999/xhtml">For data without good documentation, a statistical test might be more appropriate. </span><span class="koboSpan" id="kobo.128.3" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h.htm"><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h.htm</span></a><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml"> for details on approaches to locating outliers.</span></p>
<p><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">One approach suitable for small data sets is to use a median-based Z-score. </span><span class="koboSpan" id="kobo.131.2" xmlns="http://www.w3.org/1999/xhtml">We’ll dive into an algorithm that is built on a number of common statistical measures. </span><span class="koboSpan" id="kobo.131.3" xmlns="http://www.w3.org/1999/xhtml">This will involve computing the median using a function available in the built-in </span><code><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml"> package.</span></p>
<p><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">For more information on basic statistics for data analytics, see </span><em><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">Statistics for Data</span></em> <em><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">Science</span></em><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><a class="url" href="https://www.packtpub.com/product/statistics-for-data-science/9781788290678"><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">https://www.packtpub.com/product/statistics-for-data-science/9781788290678</span></a><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">The conventional Z-score for a sample, </span><em><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">Z</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">, is based on the mean, </span><em><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">Ȳ</span></em><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">, and the standard deviation, </span><em><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">σ</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></span></sub><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml"> . </span><span class="koboSpan" id="kobo.148.2" xmlns="http://www.w3.org/1999/xhtml">It’s computed as </span><em><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">Z</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml"> = </span><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Yi−Y¯- σY" class="frac" data-align="middle" src="../media/file33.jpg"/></span><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.153.2" xmlns="http://www.w3.org/1999/xhtml">It measures how many standard deviations a value lies from the mean. </span><span class="koboSpan" id="kobo.153.3" xmlns="http://www.w3.org/1999/xhtml">Parallel with this is the idea of a median-based Z-score, </span><em><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">M</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.156.2" xmlns="http://www.w3.org/1999/xhtml">The median-based Z-score uses the median, </span><em><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">Ỹ</span></em><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">, and the median absolute deviation, MAD</span><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></span></sub><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml"> .</span></p>
<p><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">This is computed as </span><em><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml">M</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml"> = </span><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="-Yi−Y˜- MADY" class="frac" data-align="middle" src="../media/file34.jpg"/></span><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.166.2" xmlns="http://www.w3.org/1999/xhtml">This measures how many “MAD” units a value lies from the median of the samples.</span></p>
<p><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">The </span><span id="dx1-164034"/><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">MAD is the median of the absolute values of deviations from the median. </span><span class="koboSpan" id="kobo.168.2" xmlns="http://www.w3.org/1999/xhtml">It requires computing an overall median, </span><em><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml">Ỹ</span></em><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">, then computing all the deviations from the overall median, </span><em><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></em> <sub><span class="cmmi-8"><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub> <span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">−</span></span><em><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">Ỹ</span></em><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.175.2" xmlns="http://www.w3.org/1999/xhtml">From this sequence of deviations from the median, the median value is selected to locate a central value for all of the median absolute deviations. </span><span class="koboSpan" id="kobo.175.3" xmlns="http://www.w3.org/1999/xhtml">This is computed as MAD</span><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></span></sub><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml"> = median(</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">|</span></span><em><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></em> <sub><span class="cmmi-8"><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub> <span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">−</span></span><em><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">Ỹ</span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">|</span></span><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">).</span></p>
<p><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">The filter based on </span><em><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">M</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml"> looks for any absolute value of the deviation from MAD</span><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></span></sub><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml"> that’s greater than 3</span><em><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">.</span></em><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">5, </span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">|</span></span><em><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">M</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">| </span></span><em><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">&gt; </span></em><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">3</span><em><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">.</span></em><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">5. </span><span class="koboSpan" id="kobo.200.2" xmlns="http://www.w3.org/1999/xhtml">These samples are possible outliers because their absolute deviation from the median is suspiciously large.</span></p>
<p><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">To be complete, here’s a cell to read the source data:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-120">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">with series_4_path.open() as source_file:
    series_4_data = list(samples_iter(source_file))</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">This can be followed with a cell to compute the median and the median absolute deviation. </span><span class="koboSpan" id="kobo.203.2" xmlns="http://www.w3.org/1999/xhtml">The median computation can be done with the </span><code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml"> module. </span><span class="koboSpan" id="kobo.205.2" xmlns="http://www.w3.org/1999/xhtml">The deviations can then be computed with a generator, and the median absolute deviation computed from the generator. </span><span class="koboSpan" id="kobo.205.3" xmlns="http://www.w3.org/1999/xhtml">The cell looks like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-121">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">from statistics import median

y_text = (s[’y’] for s in series_4_data)
y = list(numeric_filter(float, y_text))
m_y = median(y)
mad_y = median(abs(y_i - m_y) for y_i in y)
outliers_y = list(
    filter(lambda m_i: m_i &gt; 3.5, ((y_i - m_y)/mad_y for y_i in y))
)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">The value of </span><code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">y_text</span></code><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml"> is a generator that will extract the values mapped to the </span><code><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">’y’</span></code><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml"> key in each of the raw data samples in the NDJSON file. </span><span class="koboSpan" id="kobo.211.2" xmlns="http://www.w3.org/1999/xhtml">From these text values, the value of </span><code><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">y</span></code><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml"> is computed by applying the </span><code><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">numeric_filter()</span></code><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml"> function.</span></p>
<p><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">It’s sometimes helpful to show that </span><code><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">len(y)</span></code><code><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml"> ==</span></code><code><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml"> len(y_text)</span></code><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml"> to demonstrate that all values are numeric. </span><span class="koboSpan" id="kobo.220.2" xmlns="http://www.w3.org/1999/xhtml">In some data sets, the presence of non-numeric data might be a warning that there are deeper problems.</span></p>
<p><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">The value of </span><code><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">m_y</span></code><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml"> is the median of the </span><code><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">y</span></code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml"> values. </span><span class="koboSpan" id="kobo.225.2" xmlns="http://www.w3.org/1999/xhtml">This is used to compute the MAD value as the median of the absolute deviations from the median. </span><span class="koboSpan" id="kobo.225.3" xmlns="http://www.w3.org/1999/xhtml">This median absolute deviation provides an expected range around the median.</span></p>
<p><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">outliers_y</span></code><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml"> computation uses a generator expression to compute the median-based Z-score, and then keep only those scores that are more than 3.5 MADs from the median.</span></p>
<p><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">The data in Series IV of Anscombe’s Quartet seems to suffer from an even more complicated outlier problem. </span><span class="koboSpan" id="kobo.229.2" xmlns="http://www.w3.org/1999/xhtml">While the ”x” attribute has a potential outlier, the ”y” attribute’s MAD is zero. </span><span class="koboSpan" id="kobo.229.3" xmlns="http://www.w3.org/1999/xhtml">This means more than half the ”y” attribute values are the same. </span><span class="koboSpan" id="kobo.229.4" xmlns="http://www.w3.org/1999/xhtml">This single value is the median, and the difference from the median will be zero for most of the samples.</span></p>
<p><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">This anomaly would become an interesting part of the notebook.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.0.3.1" id="dealing-with-currency-and-related-values">
<h4 class="likesubsubsectionHead" data-number="11.0.3.1"><span id="x1-1650002"/><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">Dealing with currency and related values</span></h4>
<p><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">Most currencies </span><span id="dx1-165001"/><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">around the world use a fixed </span><span id="dx1-165002"/><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">number of decimal places. </span><span class="koboSpan" id="kobo.234.2" xmlns="http://www.w3.org/1999/xhtml">The United States, for example, uses exactly two decimal places for money. </span><span class="koboSpan" id="kobo.234.3" xmlns="http://www.w3.org/1999/xhtml">These are decimal values; the </span><code><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml"> type is almost always the wrong type for these values.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-122">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">Python has a </span><code><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml"> module with a </span><code><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">Decimal</span></code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml"> type, which must be used for currency.</span></p>
<p><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">Do not use </span><code><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml"> for currency or anything used in currency-related computations.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Tax rates, discount rates, interest rates, and other money-related fields are also decimal values. </span><span class="koboSpan" id="kobo.245.2" xmlns="http://www.w3.org/1999/xhtml">They’re often used with currency values, and computations must be done using decimal arithmetic rules.</span></p>
<p><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">When we multiply </span><code><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">Decimal</span></code><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml"> values together, the results may have additional digits to the right of the decimal place. </span><span class="koboSpan" id="kobo.248.2" xmlns="http://www.w3.org/1999/xhtml">This requires applying rounding rules to determine how to round or truncate the extra digits. </span><span class="koboSpan" id="kobo.248.3" xmlns="http://www.w3.org/1999/xhtml">The rules are essential to getting the correct results. </span><span class="koboSpan" id="kobo.248.4" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml"> type </span><code><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">round()</span></code><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml"> function may not do this properly. </span><span class="koboSpan" id="kobo.252.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">decimal</span></code><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml"> module includes a wide variety of rounding and truncating algorithms.</span></p>
<p><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">Consider an item with a price of </span><span class="tcrm-1095"><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">$</span></span><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">12.99 in a locale that charges a sales tax of 6.25% on each purchase. </span><span class="koboSpan" id="kobo.257.2" xmlns="http://www.w3.org/1999/xhtml">This is not a tax amount of </span><span class="tcrm-1095"><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">$</span></span><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">0.811875. </span><span class="koboSpan" id="kobo.259.2" xmlns="http://www.w3.org/1999/xhtml">The tax amount must be rounded; there are many, many rounding rules in common use by accountants. </span><span class="koboSpan" id="kobo.259.3" xmlns="http://www.w3.org/1999/xhtml">It’s essential to know which rule is required to compute the correct result.</span></p>
<p><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">Because the underlying assumption behind currency is decimal computation, the </span><code><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml"> should never be used for currency amounts.</span></p>
<p><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">This can be a problem when </span><span id="dx1-165003"/><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">spreadsheet data is involved. </span><span class="koboSpan" id="kobo.264.2" xmlns="http://www.w3.org/1999/xhtml">Spreadsheet software generally uses </span><code><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml"> values with complex formatting rules to produce correct-looking answers. </span><span class="koboSpan" id="kobo.266.2" xmlns="http://www.w3.org/1999/xhtml">This can lead to odd-looking values in a CSV extract like 12</span><em><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">.</span></em><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">999999997 for an attribute that should have currency values.</span></p>
<p><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">Additionally, currency may be decorated with currency symbols like </span><span class="tcrm-1095"><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">$</span></span><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">, </span><span class="tcrm-1095"><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">£</span></span><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">, or </span><span class="feymr-10x-x-109"><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">€</span></span><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.275.2" xmlns="http://www.w3.org/1999/xhtml">There may also be separator characters thrown in, depending on the locale. </span><span class="koboSpan" id="kobo.275.3" xmlns="http://www.w3.org/1999/xhtml">For the US locale, this can mean stray ”,” characters may be present in large numbers.</span></p>
<p><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">The ways currency values may have text decoration suggest the conversion function used by a </span><code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">non_numeric()</span></code><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">numeric_filter()</span></code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml"> function will have to be somewhat more sophisticated than the simple use of the </span><code><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">Decimal</span></code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<p><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">Because of these kinds of anomalies, data inspection is a critical step in data acquisition and analysis.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.0.3.2" id="dealing-with-intervals-or-durations">
<h4 class="likesubsubsectionHead" data-number="11.0.3.2"><span id="x1-1660002"/><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">Dealing with intervals or durations</span></h4>
<p><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">Some date will </span><span id="dx1-166001"/><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">include duration data in the form </span><code><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">"12:34"</span></code><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">, meaning 12 hours and 34 minutes. </span><span class="koboSpan" id="kobo.288.2" xmlns="http://www.w3.org/1999/xhtml">This looks exactly like a time of day. </span><span class="koboSpan" id="kobo.288.3" xmlns="http://www.w3.org/1999/xhtml">In some cases, it might have the form </span><code><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">12h</span></code><code><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml"> 34m</span></code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">, which is a bit easier to parse. </span><span class="koboSpan" id="kobo.291.2" xmlns="http://www.w3.org/1999/xhtml">Without </span><span id="dx1-166002"/><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">metadata to explain if an attribute is a duration or a time of day, this may be impossible to understand.</span></p>
<p><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml">For durations, it’s helpful to represent the values as a single, common time unit. </span><span class="koboSpan" id="kobo.293.2" xmlns="http://www.w3.org/1999/xhtml">Seconds are a popular choice. </span><span class="koboSpan" id="kobo.293.3" xmlns="http://www.w3.org/1999/xhtml">Days are another common choice.</span></p>
<p><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">We can create a cell with a given string, for example:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-123">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">time_text = "12:34"</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">Given this string, we can create a cell to compute the duration in seconds as follows:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-124">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">import re

m = re.match(r"(\d+):(\d+)", time_text)
h, m = map(int, m.groups())
sec = (h*60 + m) * 60
sec</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">This will compute a </span><span id="dx1-166010"/><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">duration, </span><code><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">sec</span></code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">, of 45,240 seconds from the </span><span id="dx1-166011"/><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">source time as text, </span><code><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">time_text</span></code><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.304.2" xmlns="http://www.w3.org/1999/xhtml">The final expression </span><code><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">sec</span></code><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml"> in a Jupyter notebook cell will display this variable’s value to confirm the computation worked. </span><span class="koboSpan" id="kobo.306.2" xmlns="http://www.w3.org/1999/xhtml">This cardinal value computation works out elegantly.</span></p>
<p><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">For formatting purposes, the inverse computation can be helpful. </span><span class="koboSpan" id="kobo.307.2" xmlns="http://www.w3.org/1999/xhtml">A floating-point value like 45,240 can be converted back into a sequence of integers, like (12, 34, 0), which can be formatted as ”12:34” or ”12h 34m 0s”.</span></p>
<p><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">It might look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-125">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">h_m, s = divmod(sec, 60)
h, m = divmod(h_m, 60)
text = f"{h:02d}:{m:02d}"
text</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">This will produce the string </span><code><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">12:34</span></code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml"> from the value of seconds given in the </span><code><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">sec</span></code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.314.2" xmlns="http://www.w3.org/1999/xhtml">The final expression </span><code><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">text</span></code><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml"> in a cell will display the computed value to help confirm the cell works.</span></p>
<p><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">It’s important to normalize duration strings and complex-looking times into a single float value.</span></p>
<p><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">Now that we’ve looked at some of the tricky cardinal data fields, we can look at the notebook as a whole. </span><span class="koboSpan" id="kobo.318.2" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at refactoring the notebook to create a useful module.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.0.3.3" id="extract-notebook-functions">
<h4 class="likesubsubsectionHead" data-number="11.0.3.3"><span id="x1-1670002"/><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">Extract notebook functions</span></h4>
<p><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">The </span><span id="dx1-167001"/><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">computation of ordinary Z-scores and median-based Z-scores are similar in several ways. </span><span class="koboSpan" id="kobo.321.2" xmlns="http://www.w3.org/1999/xhtml">Here are some common features we might want to extract:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">Extracting the center and variance. </span><span class="koboSpan" id="kobo.322.2" xmlns="http://www.w3.org/1999/xhtml">This might be the mean and standard deviation, using the </span><code><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml"> module. </span><span class="koboSpan" id="kobo.324.2" xmlns="http://www.w3.org/1999/xhtml">Or it might be the median and MAD.</span></p></li>
<li><p><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">Creating a function to compute Z-scores from the mean or median.</span></p></li>
<li><p><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">Applying the </span><code><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">filter()</span></code><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml"> function to locate outliers.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">When looking at data with a large number of attributes, or looking at a large number of related data sets, it’s helpful to write these functions first in the notebook. </span><span class="koboSpan" id="kobo.329.2" xmlns="http://www.w3.org/1999/xhtml">Once they’ve been debugged, they can be cut from the notebook and collected into a separate module. </span><span class="koboSpan" id="kobo.329.3" xmlns="http://www.w3.org/1999/xhtml">The notebook can then be modified to import the functions, making it easier to reuse these functions.</span></p>
<p><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">Because the source data is pushed into a dictionary with string keys, it becomes possible to consider functions that work across a sequence of key values. </span><span class="koboSpan" id="kobo.330.2" xmlns="http://www.w3.org/1999/xhtml">We might have cells that look like the following example:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-126">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">for column in (’x’, ’y’):
    values = list(
        numeric_filter(float, (s[column] for s in series_4_data))
    )
    m = median(values)
    print(column, len(series_4_data), len(values), m)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">This will analyze all of the columns named in the surrounding </span><code><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">for</span></code><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml"> statement. </span><span class="koboSpan" id="kobo.334.2" xmlns="http://www.w3.org/1999/xhtml">In this example, the x and y column names are provided as the collection of columns to analyze. </span><span class="koboSpan" id="kobo.334.3" xmlns="http://www.w3.org/1999/xhtml">The result is a small table of values with the column name, the raw data size, the filtered data size, and the median of the filtered data.</span></p>
<p><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">The idea of a collection of descriptive statistics suggests a class to hold these. </span><span class="koboSpan" id="kobo.335.2" xmlns="http://www.w3.org/1999/xhtml">We might add the following dataclass:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-127">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">from dataclasses import dataclass

@dataclass
class AttrSummary:
    name: str
    raw_count: int
    valid_count: int
    median: float

    @classmethod
    def from_raw(
            cls: Type["AttrSummary"],
            column: str,
            text_values: list[str]
    ) -&gt; "AttrSummary":
        values = list(numeric_filter(float, text_values))
        return cls(
            name=column,
            raw_count=len(text_values),
            valid_count=len(values),
            median=median(values)
        )</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">The class </span><span id="dx1-167030"/><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">definition includes a class method to build instances of this class from a collection of raw values. </span><span class="koboSpan" id="kobo.338.2" xmlns="http://www.w3.org/1999/xhtml">Putting the instance builder into the class definition makes it slightly easier to add additional inspection attributes and the functions needed to compute those attributes. </span><span class="koboSpan" id="kobo.338.3" xmlns="http://www.w3.org/1999/xhtml">A function that builds </span><code><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">AttrSummary</span></code><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml"> instances can be used to summarize the attributes of a data set. </span><span class="koboSpan" id="kobo.340.2" xmlns="http://www.w3.org/1999/xhtml">This function might look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-128">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">from collections.abc import Iterator
from typing import TypeAlias

Samples: TypeAlias = list[dict[str, str]]

def summary_iter(
        samples: Samples,
        columns: list[str]
) -&gt; Iterator[AttrSummary]:
    for column in columns:
        text = [s[column] for s in samples]
        yield AttrSummary.from_raw(column, text)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">This kind of </span><span id="dx1-167043"/><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">function makes it possible to reuse inspection code for a number of attributes in a complicated data set. </span><span class="koboSpan" id="kobo.343.2" xmlns="http://www.w3.org/1999/xhtml">After looking at the suggested technical approach, we’ll turn to the deliverables for this project. </span><span id="x1-167044r180"/></p>
</section>
</section>
<section class="level3" data-number="11.0.4" id="deliverables-7">
<h3 data-number="11.0.4"><span class="titlemark"><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">7.1.3 </span></span> <span id="x1-1680003"/><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">Deliverables</span></h3>
<p><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">This project has the following deliverables:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml">A </span><code><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">requirements-dev.txt</span></code><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml"> file that identifies the tools used, usually </span><code><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">jupyterlab==3.5.3</span></code><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></li>
<li><p><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">Documentation in the </span><code><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">docs</span></code><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for any new changes to the modules in use.</span></p></li>
<li><p><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">Any new application modules with code to be used by the inspection notebook.</span></p></li>
<li><p><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">A notebook to inspect the attributes that appear to have cardinal data.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">This project will require a </span><code><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">notebooks</span></code><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml"> directory. </span><span class="koboSpan" id="kobo.360.2" xmlns="http://www.w3.org/1999/xhtml">See </span><a href="ch005.xhtml#x1-260003"><em><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">List of deliverables</span></em></a><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml"> for some more information on this structure.</span></p>
<p><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at a few of these deliverables in a little more detail.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.0.4.1" id="inspection-module">
<h4 class="likesubsubsectionHead" data-number="11.0.4.1"><span id="x1-1690003"/><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">Inspection module</span></h4>
<p><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">You are </span><span id="dx1-169001"/><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">encouraged to refactor functions like </span><code><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">samples_iter()</span></code><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml">non_numeric()</span></code><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">numeric_filter()</span></code><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml"> into a separate module. </span><span class="koboSpan" id="kobo.372.2" xmlns="http://www.w3.org/1999/xhtml">Additionally, the </span><code><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">AttrSummary</span></code><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml"> class and the closely related </span><code><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">summary_iter()</span></code><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml"> function are also good candidates for being moved to a separate module with useful inspection classes and functions.</span></p>
<p><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">Notebooks can be refactored to import these classes and functions from a separate module.</span></p>
<p><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml">It’s easiest to throw this module into the </span><code><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">notebooks</span></code><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml"> folder to make it easier to access. </span><span class="koboSpan" id="kobo.380.2" xmlns="http://www.w3.org/1999/xhtml">An alternative is to include the </span><code><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml">src</span></code><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml"> directory on the </span><code><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml">PYTHONPATH</span></code><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml"> environment variable, making it available to the Jupyter Lab session.</span></p>
<p><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">Another alternative is to create an IPython profile with the </span><code><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">ipython</span></code><code><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml"> profile</span></code><code><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml"> create</span></code><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml"> command at the terminal prompt. </span><span class="koboSpan" id="kobo.389.2" xmlns="http://www.w3.org/1999/xhtml">This will create a </span><code><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">~/.ipython/profile_default</span></code><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml"> directory with the default configuration files in it. </span><span class="koboSpan" id="kobo.391.2" xmlns="http://www.w3.org/1999/xhtml">Adding a </span><code><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">startup</span></code><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml"> folder permits including scripts that will add the </span><code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">src</span></code><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml"> directory to the </span><code><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">sys.path</span></code><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml"> list of places to look for modules.</span></p>
<p><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#startup-files"><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml">https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#startup-files</span></a><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.0.4.2" id="unit-test-cases-for-the-module">
<h4 class="likesubsubsectionHead" data-number="11.0.4.2"><span id="x1-1700003"/><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">Unit test cases for the module</span></h4>
<p><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">The various </span><span id="dx1-170001"/><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">functions were </span><span id="dx1-170002"/><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">refactored from a notebook to create a separate module need unit tests. </span><span class="koboSpan" id="kobo.404.2" xmlns="http://www.w3.org/1999/xhtml">In many cases, the functions will have doctest examples; the notebook as a whole will have a doctest cell.</span></p>
<p><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">In this case, an extra option in the </span><strong><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">pytest </span></strong><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml">command will execute these tests, as well.</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-129">
<div class="tcolorbox-content">
<pre class="console"><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">% pytest --doctest-modules notebooks/*.py</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">--doctest-modules</span></code><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml"> option will look for the doctest examples and execute them.</span></p>
<p><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">An alternative is to use the Python </span><code><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">doctest</span></code><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml"> command directly.</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-130">
<div class="tcolorbox-content">
<pre class="console"><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">% python -m doctest notebooks/*.py</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">It is, of course, essential to test the code extracted from the notebook to be sure it works properly and can be trusted.</span></p>
<p><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">This revised and </span><span id="dx1-170005"/><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">expanded inspection </span><span id="dx1-170006"/><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">notebook lets an analyst inspect unknown data sources to confirm values are likely to be cardinal numbers, for example, measures or counts. </span><span class="koboSpan" id="kobo.419.2" xmlns="http://www.w3.org/1999/xhtml">Using a filter function can help locate invalid or other anomalous text. </span><span class="koboSpan" id="kobo.419.3" xmlns="http://www.w3.org/1999/xhtml">Some statistical techniques can help to locate outlying values.</span></p>
<p><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">In the next project, we’ll look at non-cardinal data. </span><span class="koboSpan" id="kobo.420.2" xmlns="http://www.w3.org/1999/xhtml">This includes nominal data (i.e., strings of digits that aren’t numbers), and ordinal values that represent ranking or ordering positions. </span><span id="x1-170007r178"/></p>
</section>
</section>
<section class="level3 sectionHead" data-number="11.0.5" id="project-2.3-validating-text-and-codes-nominal-data-and-ordinal-numbers">
<h3 class="sectionHead" data-number="11.0.5"><span class="titlemark"><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">7.2 </span></span> <span id="x1-1710002"/><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.3: Validating text and codes — nominal data and ordinal numbers</span></h3>
<p><span id="x1-171001r184"/></p>
</section>
<section class="level3" data-number="11.0.6" id="description-8">
<h3 data-number="11.0.6"><span class="titlemark"><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">7.2.1 </span></span> <span id="x1-1720001"/><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></h3>
<p><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">In the previous project (</span><a href="#x1-1620001"><em><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.2: Validating cardinal domains — measures,</span></em> <em><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">counts, and durations</span></em></a><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">), we </span><span id="dx1-172001"/><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">looked at attributes that </span><span id="dx1-172002"/><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">contained cardinal data – measures and counts. </span><span class="koboSpan" id="kobo.430.2" xmlns="http://www.w3.org/1999/xhtml">We also need to look at ordinal and nominal data. </span><span class="koboSpan" id="kobo.430.3" xmlns="http://www.w3.org/1999/xhtml">Ordinal data is generally used to provide ranks and ordering. </span><span class="koboSpan" id="kobo.430.4" xmlns="http://www.w3.org/1999/xhtml">Nominal data is best thought of as codes made up of strings of digits. </span><span class="koboSpan" id="kobo.430.5" xmlns="http://www.w3.org/1999/xhtml">Values like US postal codes and bank account numbers are nominal data.</span></p>
<p><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">When we look at the </span><strong><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">CO</span></strong><strong><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">2</span></strong> <strong><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">PPM — Trends in Atmospheric Carbon</span></strong> <strong><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">Dioxide </span></strong><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml">data set, available at </span><a class="url" href="https://datahub.io/core/co2-ppm"><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">https://datahub.io/core/co2-ppm</span></a><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">, it has </span><span id="dx1-172003"/><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">dates that are provided in two forms: as a </span><code><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">year-month-day</span></code><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml"> string and as a decimal number. </span><span class="koboSpan" id="kobo.441.2" xmlns="http://www.w3.org/1999/xhtml">The decimal number positions the first day of the month within the year as a whole.</span></p>
<p><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">It’s instructive to use ordinal day numbers to compute unique values for each date and compare these with the supplied ”Decimal Date” value. </span><span class="koboSpan" id="kobo.442.2" xmlns="http://www.w3.org/1999/xhtml">An integer day number may be more useful than the decimal date value because it avoids truncation to three decimal places.</span></p>
<p><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml">Similarly, many of the data sets available from </span><a class="url" href="https://berkeleyearth.org/data/"><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">https://berkeleyearth.org/data/</span></a><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml"> contain complicated date and time values. </span><span class="koboSpan" id="kobo.445.2" xmlns="http://www.w3.org/1999/xhtml">Looking at the source data, </span><a class="url" href="https://berkeleyearth.org/archive/source-files/"><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">https://berkeleyearth.org/archive/source-files/</span></a><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml"> has data sets with nominal values to encode precipitation types or other details of historical weather. </span><span class="koboSpan" id="kobo.447.2" xmlns="http://www.w3.org/1999/xhtml">For even more data, see </span><a class="url" href="https://www.ncdc.noaa.gov/cdo-web/"><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">https://www.ncdc.noaa.gov/cdo-web/</span></a><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.449.2" xmlns="http://www.w3.org/1999/xhtml">All of these datasets have dates in a variety of formats.</span></p>
<p><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">What’s important for this project is to get an overview of the data that involves dates and nominal code values. </span><span class="koboSpan" id="kobo.450.2" xmlns="http://www.w3.org/1999/xhtml">Later projects will look at cleaning and converting the data for further use. </span><span class="koboSpan" id="kobo.450.3" xmlns="http://www.w3.org/1999/xhtml">This notebook is only designed to preview and inspect the data. </span><span class="koboSpan" id="kobo.450.4" xmlns="http://www.w3.org/1999/xhtml">It is used to demonstrate the data is complete and consistent and can be used for further processing.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.0.6.1" id="dates-and-times">
<h4 class="likesubsubsectionHead" data-number="11.0.6.1"><span id="x1-1730001"/><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">Dates and times</span></h4>
<p><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml">A date, time, and the </span><span id="dx1-173001"/><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">combined date-time value represent a specific point in time, sometimes called a timestamp. </span><span class="koboSpan" id="kobo.453.2" xmlns="http://www.w3.org/1999/xhtml">Generally, these are modeled by Python </span><code><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml"> objects.</span></p>
<p><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">A date in isolation can generally be treated as a </span><code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml"> with a time of midnight. </span><span class="koboSpan" id="kobo.458.2" xmlns="http://www.w3.org/1999/xhtml">A time in isolation is often part of a date stated elsewhere in the data or assumed from context. </span><span class="koboSpan" id="kobo.458.3" xmlns="http://www.w3.org/1999/xhtml">Ideally, a date-time value has been broken into separate columns of data for no good reason and can be combined. </span><span class="koboSpan" id="kobo.458.4" xmlns="http://www.w3.org/1999/xhtml">In other cases, the data might be a bit more difficult to track down. </span><span class="koboSpan" id="kobo.458.5" xmlns="http://www.w3.org/1999/xhtml">For example, a log file as a whole might have an implied date — because each log file starts at midnight UTC — and the time values must be combined with the (implied) log’s date.</span></p>
<p><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">Date-time values are quite complex and rich with strange quirks. </span><span class="koboSpan" id="kobo.459.2" xmlns="http://www.w3.org/1999/xhtml">To keep the Gregorian calendar aligned with the positions of stars, and the Moon, leap days are added periodically. </span><span class="koboSpan" id="kobo.459.3" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml"> library in Python is the best way to work with the calendar.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-131">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">It’s generally a bad idea to do any date-time computation outside the </span><code><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml"> package.</span></p>
<p><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">Home-brewed date computations are difficult to implement correctly.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">toordinal()</span></code><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml"> function of a </span><code><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">datetime.datetime</span></code><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml"> object provides a clear relationship between dates and an ordinal number that can be used to put dates into order.</span></p>
<p><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">Because months are irregular, there are several common kinds of date computations:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">A date plus or minus a duration given in months. </span><span class="koboSpan" id="kobo.472.2" xmlns="http://www.w3.org/1999/xhtml">The day of the month is generally preserved, except in the unusual case of February 29, 30, or 31, where ad hoc rules will apply.</span></p></li>
<li><p><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">A date plus or minus a duration given in days or weeks.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml">These kinds of </span><span id="dx1-173002"/><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">computations can result in dates in a different year. </span><span class="koboSpan" id="kobo.475.2" xmlns="http://www.w3.org/1999/xhtml">For month-based computations, an ordinal month value needs to be computed from the date. </span><span class="koboSpan" id="kobo.475.3" xmlns="http://www.w3.org/1999/xhtml">Given a date, </span><em><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">d</span></em><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">, with a year, </span><em><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">d.y</span></em><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">, and a month </span><em><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">d.m</span></em><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">, the ordinal month, </span><em><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">m</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">o</span></span></sub><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">, is </span><em><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">d.y </span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">× </span></span><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">12 + </span><em><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">d.m </span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">− </span></span><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">1. </span><span class="koboSpan" id="kobo.490.2" xmlns="http://www.w3.org/1999/xhtml">After a computation, the </span><code><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">divmod()</span></code><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml"> function will recover the year and month of the result. </span><span class="koboSpan" id="kobo.492.2" xmlns="http://www.w3.org/1999/xhtml">Note that months are generally numbered from 1, but the ordinal month computation numbers months from zero. </span><span class="koboSpan" id="kobo.492.3" xmlns="http://www.w3.org/1999/xhtml">This leads to a </span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">−</span></span><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">1 when creating an ordinal month from a date, and a +1 when creating a date from an ordinal month. </span><span class="koboSpan" id="kobo.494.2" xmlns="http://www.w3.org/1999/xhtml">As noted above, when the resulting month is February, something needs to be done to handle the exceptional case of trying to build a possibly invalid date with a day number that’s invalid in February of the given year.</span></p>
<p><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">For day- or week-based computations, the </span><code><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml">toordinal()</span></code><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml"> function and </span><code><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">fromordinal()</span></code><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml"> functions will work correctly to order and compute differences between dates.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-132">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">All calendar computations must be done using ordinal values.</span></p>
<p><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">Here are the three steps:</span></p>
<ol>
<li><div id="x1-173004x1">
<p><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">Either use the built-in </span><code><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">toordinal()</span></code><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml"> method of a </span><code><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml"> object, or compute an ordinal month number.</span></p>
</div></li>
<li><div id="x1-173006x2">
<p><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">Apply duration offsets to the ordinal value.</span></p>
</div></li>
<li><div id="x1-173008x3">
<p><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">Either use the built-in </span><code><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">fromordinal()</span></code><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml"> class method of the </span><code><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml"> class, or use the </span><code><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">divmod()</span></code><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml"> function to compute the year and month of the ordinal month number.</span></p>
</div></li>
</ol>
</div>
</div>
<p><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">For some developers, the use of ordinal numbers for dates can feel complicated. </span><span class="koboSpan" id="kobo.515.2" xmlns="http://www.w3.org/1999/xhtml">Using </span><code><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">if</span></code><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml"> statements to decide if an offset from a date is in a different year is less reliable and requires more extensive edge-case testing. </span><span class="koboSpan" id="kobo.517.2" xmlns="http://www.w3.org/1999/xhtml">Using an expression like </span><code><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">year,</span></code><code><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml"> month</span></code><code><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml"> =</span></code><code><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml"> divmod(date,</span></code><code><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml"> 12)</span></code><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml"> is much easier to test.</span></p>
<p><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at time and the problem of local time.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.0.6.2" id="time-values-local-time-and-utc-time">
<h4 class="likesubsubsectionHead" data-number="11.0.6.2"><span id="x1-1740001"/><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">Time values, local time, and UTC time</span></h4>
<p><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">Local time is </span><span id="dx1-174001"/><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">subject to a great deal of complex-seeming rules, particularly in the US. </span><span class="koboSpan" id="kobo.527.2" xmlns="http://www.w3.org/1999/xhtml">Some countries have a single time zone, simplifying what constitutes local time. </span><span class="koboSpan" id="kobo.527.3" xmlns="http://www.w3.org/1999/xhtml">In the US, however, each county decides which </span><span id="dx1-174002"/><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">timezone it belongs to, leading to very complex situations that don’t </span><span id="dx1-174003"/><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">necessarily follow US state borders.</span></p>
<p><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">Some countries (the US and Europe, as well as a scattering of other places) offset the time (generally, but not universally by one hour) for part of the year. </span><span class="koboSpan" id="kobo.530.2" xmlns="http://www.w3.org/1999/xhtml">The rules are not necessarily nationwide; Canada, Mexico, Australia, and Chile have regions that don’t have daylight savings time offsets. </span><span class="koboSpan" id="kobo.530.3" xmlns="http://www.w3.org/1999/xhtml">The Navajo nation — surrounded by the state of Arizona in the US — doesn’t switch its clocks.</span></p>
<p><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">The rules are here: </span><a class="url" href="https://data.iana.org/time-zones/tz-link.html"><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml">https://data.iana.org/time-zones/tz-link.html</span></a><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.533.2" xmlns="http://www.w3.org/1999/xhtml">This is part of the Python </span><code><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml"> library and is already available in Python.</span></p>
<p><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">This complexity </span><span id="dx1-174004"/><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">makes use of the </span><strong><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml">universal coordinated time </span></strong><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml">UTC</span></strong><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">) imperative.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-133">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">Local times should be converted into UTC for analysis purposes.</span></p>
<p><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://www.rfc-editor.org/rfc/rfc3339"><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">https://www.rfc-editor.org/rfc/rfc3339</span></a><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml"> for time formats that can include a local-time offset.</span></p>
<p><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">UTC can be converted back into local time to be displayed to users.</span></p>
</div>
</div>
<p><span id="x1-174005r188"/></p>
</section>
</section>
<section class="level3" data-number="11.0.7" id="approach-7">
<h3 data-number="11.0.7"><span class="titlemark"><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">7.2.2 </span></span> <span id="x1-1750002"/><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">Approach</span></h3>
<p><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">Dates and times often have bewildering formats. </span><span class="koboSpan" id="kobo.549.2" xmlns="http://www.w3.org/1999/xhtml">This is particularly true in the US, where dates are often written as numbers in month/day/year format. </span><span class="koboSpan" id="kobo.549.3" xmlns="http://www.w3.org/1999/xhtml">Using year/month/day puts the values in order of significance. </span><span class="koboSpan" id="kobo.549.4" xmlns="http://www.w3.org/1999/xhtml">Using day/month/year is the reverse order of significance. </span><span class="koboSpan" id="kobo.549.5" xmlns="http://www.w3.org/1999/xhtml">The US ordering is simply strange.</span></p>
<p><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">This makes it difficult to do inspections on completely unknown data without any metadata to explain the serialization format. </span><span class="koboSpan" id="kobo.550.2" xmlns="http://www.w3.org/1999/xhtml">A date like 01/02/03 could mean almost anything.</span></p>
<p><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">In some cases, a survey of many date-like values will reveal a field with a range of 1-12 and another field with a range of 1-31, permitting analysts to distinguish between the month and day. </span><span class="koboSpan" id="kobo.551.2" xmlns="http://www.w3.org/1999/xhtml">The remaining field can be taken as a truncated year.</span></p>
<p><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">In cases where there is not enough data to make a positive identification of month or day, other clues will be needed. </span><span class="koboSpan" id="kobo.552.2" xmlns="http://www.w3.org/1999/xhtml">Ideally, there’s metadata to define the date format.</span></p>
<p><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">datetime.strptime()</span></code><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml"> function can be </span><span id="dx1-175001"/><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">used to parse dates when the format(s) are known. </span><span class="koboSpan" id="kobo.556.2" xmlns="http://www.w3.org/1999/xhtml">Until the date format is known, the data must be used cautiously.</span></p>
<p><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">Here are two </span><span id="dx1-175002"/><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">Python modules that can help parse dates:</span></p>
<ul>
<li><p><a class="url" href="https://pypi.org/project/dateparser/"><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">https://pypi.org/project/dateparser/</span></a></p></li>
<li><p><a class="url" href="https://pypi.org/project/python-dateutil/"><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">https://pypi.org/project/python-dateutil/</span></a></p></li>
</ul>
<p><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">It’s important to carefully inspect the results of date parsing to be sure the results are sensible. </span><span class="koboSpan" id="kobo.561.2" xmlns="http://www.w3.org/1999/xhtml">There are some confounding factors.</span></p>
<p><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">Years, for example, can be provided as two or four digits. </span><span class="koboSpan" id="kobo.562.2" xmlns="http://www.w3.org/1999/xhtml">For example, when dealing with old data, it’s important to note the use of two-digit encoding schemes. </span><span class="koboSpan" id="kobo.562.3" xmlns="http://www.w3.org/1999/xhtml">For a few years prior to 2000, the year of date might have been given as a complicated two-digit transformation. </span><span class="koboSpan" id="kobo.562.4" xmlns="http://www.w3.org/1999/xhtml">In one scheme, values from 0 to 29 meant years 2000 to 2029. </span><span class="koboSpan" id="kobo.562.5" xmlns="http://www.w3.org/1999/xhtml">Values from 30 to 99 meant years 1930 to 1999. </span><span class="koboSpan" id="kobo.562.6" xmlns="http://www.w3.org/1999/xhtml">These rules were generally ad hoc, and different enterprises may have used different year encodings.</span></p>
<p><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">Additionally, leap seconds </span><span id="dx1-175003"/><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">have been added to the calendar a few times as a way to keep the clocks aligned with planetary motion. </span><span class="koboSpan" id="kobo.564.2" xmlns="http://www.w3.org/1999/xhtml">Unlike leap years, these are the result of ongoing research by astronomers, and are not defined by the way leap years are defined.</span></p>
<p><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://www.timeanddate.com/time/leapseconds.html"><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">https://www.timeanddate.com/time/leapseconds.html</span></a><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml"> for more information.</span></p>
<p><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">The presence of a leap second means that a timestamp like </span><code><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">1972-06-30T23:59:60</span></code><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml"> is valid. </span><span class="koboSpan" id="kobo.570.2" xmlns="http://www.w3.org/1999/xhtml">The 60 value for seconds represents the additional leap second. </span><span class="koboSpan" id="kobo.570.3" xmlns="http://www.w3.org/1999/xhtml">As of this book’s initial publication, there were 26 leap seconds, all added on June 30 or December 31 of a given year. </span><span class="koboSpan" id="kobo.570.4" xmlns="http://www.w3.org/1999/xhtml">These values are rare but valid.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.0.7.1" id="nominal-data">
<h4 class="likesubsubsectionHead" data-number="11.0.7.1"><span id="x1-1760002"/><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml">Nominal data</span></h4>
<p><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml">Nominal data is not </span><span id="dx1-176001"/><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">numeric but may consist of strings of digits, leading to possible sources of confusion and — in some cases — useless data conversions. </span><span class="koboSpan" id="kobo.573.2" xmlns="http://www.w3.org/1999/xhtml">While nominal data should be treated as text, it’s possible for a spreadsheet to treat US Postal ZIP codes as numbers and truncate the leading zeroes. </span><span class="koboSpan" id="kobo.573.3" xmlns="http://www.w3.org/1999/xhtml">For example, North Adams, MA, has a ZIP code of 01247. </span><span class="koboSpan" id="kobo.573.4" xmlns="http://www.w3.org/1999/xhtml">A spreadsheet might lose the leading zero, making the code 1247.</span></p>
<p><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml">While it’s generally best to treat nominal data as text, it may be necessary to reformat ZIP codes, account numbers, or part numbers to restore the leading zeroes. </span><span class="koboSpan" id="kobo.574.2" xmlns="http://www.w3.org/1999/xhtml">This can be done in a number of ways; perhaps the best is to use f-strings to pad values on the left with leading ”0” characters. </span><span class="koboSpan" id="kobo.574.3" xmlns="http://www.w3.org/1999/xhtml">An expression like </span><code><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml">f"{zip:0&gt;5s}"</span></code><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml"> creates a string from the </span><code><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml">zip</span></code><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml"> value using a format of </span><code><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml">0&gt;5s</span></code><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.580.2" xmlns="http://www.w3.org/1999/xhtml">This format has a padding character, </span><code><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">0</span></code><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">, a padding rule of </span><code><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">&gt;</span></code><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml">, and a target size of </span><code><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">5</span></code><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.586.2" xmlns="http://www.w3.org/1999/xhtml">The final character </span><code><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">s</span></code><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml"> is the type of data expected; in this case, a string.</span></p>
<p><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">An alternative is something like </span><code><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">(5*"0"</span></code><code><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml"> +</span></code><code><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml"> zip)[-5:]</span></code><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml"> to pad a given </span><code><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">zip</span></code><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml"> value to 5 positions. </span><span class="koboSpan" id="kobo.595.2" xmlns="http://www.w3.org/1999/xhtml">This prepends zeroes and then takes the right-most five characters. </span><span class="koboSpan" id="kobo.595.3" xmlns="http://www.w3.org/1999/xhtml">It doesn’t seem as elegant as an f-string but can be more flexible.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.0.7.2" id="extend-the-data-inspection-module">
<h4 class="likesubsubsectionHead" data-number="11.0.7.2"><span id="x1-1770002"/><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">Extend the data inspection module</span></h4>
<p><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><span id="dx1-177001"/><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">previous project, </span><a href="#x1-1620001"><em><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.2: Validating cardinal domains — measures,</span></em> <em><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">counts, and durations</span></em></a><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml">, we considered adding a module with some useful functions to examine cardinal data. </span><span class="koboSpan" id="kobo.601.2" xmlns="http://www.w3.org/1999/xhtml">We can also add functions for ordinal and nominal data.</span></p>
<p><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">For a given problem domain, the date parsing can be defined as a separate, small function. </span><span class="koboSpan" id="kobo.602.2" xmlns="http://www.w3.org/1999/xhtml">This can help to avoid the complicated-looking </span><code><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">strptime()</span></code><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.604.2" xmlns="http://www.w3.org/1999/xhtml">In many cases, there are only a few date formats, and a parsing function can try the alternatives. </span><span class="koboSpan" id="kobo.604.3" xmlns="http://www.w3.org/1999/xhtml">It might look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-134">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml">import datetime

def parse_date(source: str) -&gt; datetime.datetime:
    formats = "%Y-%m-%d", "%y-%m-%d", "%Y-%b-%d"
    for fmt in formats:
        try:
            return datetime.datetime.strptime(source, fmt)
        except ValueError:
            pass
    raise ValueError(f"datetime data {source!r} not in any of {formats}
      format")</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">This </span><span id="dx1-177013"/><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">function has three date formats that it attempts to use to convert the data. </span><span class="koboSpan" id="kobo.607.2" xmlns="http://www.w3.org/1999/xhtml">If none of the formats match the data, a </span><code><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml">ValueError</span></code><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml"> exception is raised.</span></p>
<p><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">For rank ordering data and codes, a notebook cell can rely on a </span><code><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml">collections.Counter</span></code><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml"> instance to get the domain of values. </span><span class="koboSpan" id="kobo.612.2" xmlns="http://www.w3.org/1999/xhtml">More sophisticated processing is not required for simple numbers and nominal codes. </span><span id="x1-177014r191"/></p>
</section>
</section>
<section class="level3" data-number="11.0.8" id="deliverables-8">
<h3 data-number="11.0.8"><span class="titlemark"><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml">7.2.3 </span></span> <span id="x1-1780003"/><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml">Deliverables</span></h3>
<p><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">This project has the following deliverables:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml">A </span><code><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">requirements-dev.txt</span></code><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml"> file that identifies the tools used, usually </span><code><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">jupyterlab==3.5.3</span></code><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></li>
<li><p><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">Documentation in the </span><code><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">docs</span></code><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for any new changes to the modules in use.</span></p></li>
<li><p><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">Any new application modules with code to be used by the inspection notebook.</span></p></li>
<li><p><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml">A notebook to inspect the attributes that appear to have ordinal or nominal data.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">The project directory structure suggested in </span><a href="ch005.xhtml#x1-170001"><em><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml"> 1</span></em></a><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch005.xhtml#x1-170001"><em><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml">Project Zero: A Template</span></em> <em><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">for Other Projects</span></em></a><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml"> mentions a </span><code><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">notebooks</span></code><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml"> directory. </span><span class="koboSpan" id="kobo.635.2" xmlns="http://www.w3.org/1999/xhtml">See </span><a href="ch005.xhtml#x1-260003"><em><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml">List of deliverables</span></em></a><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml"> for some more information. </span><span class="koboSpan" id="kobo.637.2" xmlns="http://www.w3.org/1999/xhtml">For this project, the notebook directory is needed.</span></p>
<p><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at a few of these deliverables in a little more detail.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.0.8.1" id="revised-inspection-module">
<h4 class="likesubsubsectionHead" data-number="11.0.8.1"><span id="x1-1790003"/><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">Revised inspection module</span></h4>
<p><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml">Functions for date </span><span id="dx1-179001"/><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">conversions and cleaning up nominal data can be written in a separate module. </span><span class="koboSpan" id="kobo.641.2" xmlns="http://www.w3.org/1999/xhtml">Or they can be developed in a notebook, and then moved to the inspection module. </span><span class="koboSpan" id="kobo.641.3" xmlns="http://www.w3.org/1999/xhtml">As we noted in the </span><a href="#x1-1720001"><em><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></em></a><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml"> section, this project’s objective is to support the inspection of the data and the identification of special cases, data anomalies, and outlier values.</span></p>
<p><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">Later, we can look at refactoring these </span><span id="dx1-179002"/><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">functions into a more formal and complete data cleansing module. </span><span class="koboSpan" id="kobo.645.2" xmlns="http://www.w3.org/1999/xhtml">This project’s goal is to inspect the data and write some useful functions for the inspection process. </span><span class="koboSpan" id="kobo.645.3" xmlns="http://www.w3.org/1999/xhtml">This will create seeds to grow a more complete solution.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.0.8.2" id="unit-test-cases">
<h4 class="likesubsubsectionHead" data-number="11.0.8.2"><span id="x1-1800003"/><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">Unit test cases</span></h4>
<p><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml">Date parsing is — perhaps — one of the more awkwardly </span><span id="dx1-180001"/><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml">complicated problems. </span><span class="koboSpan" id="kobo.648.2" xmlns="http://www.w3.org/1999/xhtml">While we often think we’ve seen all of the source data formats, some small changes to upstream applications can lead to unexpected changes for data analysis purposes.</span></p>
<p><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">Every time there’s a new date format, it becomes necessary to expand the unit tests with the bad data, and then adjust the parser to handle the bad data. </span><span class="koboSpan" id="kobo.649.2" xmlns="http://www.w3.org/1999/xhtml">This can lead to a surprisingly large number of date-time examples.</span></p>
<p><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml">When confronted with a number of very similar cases, the </span><code><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">pytest</span></code><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml"> parameterized fixtures are very handy. </span><span class="koboSpan" id="kobo.652.2" xmlns="http://www.w3.org/1999/xhtml">These fixtures provide a number of examples of a test case.</span></p>
<p><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml">The fixture might look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-135">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">import pytest

EXAMPLES = [
    (’2021-01-18’, datetime.datetime(2021, 1, 18, 0, 0)),
    (’21-01-18’, datetime.datetime(2021, 1, 18, 0, 0)),
    (’2021-jan-18’, datetime.datetime(2021, 1, 18, 0, 0)),
]

@pytest.fixture(params=EXAMPLES)
def date_example(request):
    return request.param</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">Each of the example values is a two-tuple with input text and the expected </span><code><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml"> object. </span><span class="koboSpan" id="kobo.657.2" xmlns="http://www.w3.org/1999/xhtml">This pair of values can be decomposed by the test case.</span></p>
<p><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">A test that uses this fixture full of examples might look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-136">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">def test_date(date_example):
    text, expected = date_example
    assert parse_date(text) == expected</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml">This kind of test </span><span id="dx1-180016"/><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml">structure permits us to add new formats as they are discovered. </span><span class="koboSpan" id="kobo.661.2" xmlns="http://www.w3.org/1999/xhtml">The test cases in the </span><code><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">EXAMPLES</span></code><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml"> variable are easy to expand with additional formats and special cases.</span></p>
<p><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">Now that we’ve looked at inspecting cardinal, ordinal, and nominal data, we can turn to a more specialized form of nominal data: key values used to follow references between separate data sets. </span><span id="x1-180017r187"/></p>
</section>
</section>
<section class="level2" data-number="11.1" id="project-2.4-finding-reference-domains">
<h2 data-number="11.1"><span class="titlemark"><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml">7.3 </span></span> <span id="x1-1810003"/><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.4: Finding reference domains</span></h2>
<p><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">In many cases, data is </span><span id="dx1-181001"/><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml">decomposed to avoid repetition. </span><span class="koboSpan" id="kobo.668.2" xmlns="http://www.w3.org/1999/xhtml">In </span><a href="ch009.xhtml#x1-1140005"><em><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml"> 5</span></em></a><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch009.xhtml#x1-1140005"><em><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml">Data</span></em> <em><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">Acquisition Features: SQL Database</span></em></a><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml">, we touched on the idea of normalization to decompose data.</span></p>
<p><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml">As an example, consider the data sets in this directory: </span><a class="url" href="https://www.ncei.noaa.gov/pub/data/paleo/historical/northamerica/usa/new-england/"><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">https://www.ncei.noaa.gov/pub/data/paleo/historical/northamerica/usa/new-england/</span></a></p>
<p><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml">There are three separate files. </span><span class="koboSpan" id="kobo.677.2" xmlns="http://www.w3.org/1999/xhtml">Here’s what we see when we visit the web page.</span></p>
<p><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">Here’s the index of the </span><code><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml">/pub/data/paleo/historical/northamerica/usa/new-england</span></code><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml"> file:</span></p>
<div class="center">
<div class="tabular">
<table class="tabular" id="TBL-1">
<tbody>
<tr class="odd hline">
<td><hr/>
</td>
<td><hr/>
</td>
<td><hr/>
</td>
<td><hr/>
</td>
</tr>
<tr class="even" id="TBL-1-1-" style="vertical-align:baseline;">
<td class="td11" id="TBL-1-1-1" style="text-align: center; white-space: nowrap;"><strong><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">Name </span></strong></td>
<td class="td11" id="TBL-1-1-2" style="text-align: center; white-space: nowrap;"><strong><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml">Last modified </span></strong></td>
<td class="td11" id="TBL-1-1-3" style="text-align: center; white-space: nowrap;"><strong><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml">Size </span></strong></td>
<td class="td11" id="TBL-1-1-4" style="text-align: center; white-space: nowrap;"><strong><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">Description </span></strong></td>
</tr>
<tr class="odd hline">
<td><hr/>
</td>
<td><hr/>
</td>
<td><hr/>
</td>
<td><hr/>
</td>
</tr>
<tr class="even" id="TBL-1-2-" style="vertical-align:baseline;">
<td class="td11" id="TBL-1-2-1" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">Parent Directory</span></td>
<td class="td11" id="TBL-1-2-2" style="text-align: center; white-space: nowrap;"/>
<td class="td11" id="TBL-1-2-3" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml">-</span></td>
<td class="td11" id="TBL-1-2-4" style="text-align: center; white-space: nowrap;"/>
</tr>
<tr class="odd" id="TBL-1-3-" style="vertical-align:baseline;">
<td class="td11" id="TBL-1-3-1" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">new-england-oldweather-data.txt</span></td>
<td class="td11" id="TBL-1-3-2" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml">2014-01-30 13:02</span></td>
<td class="td11" id="TBL-1-3-3" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml">21M</span></td>
<td class="td11" id="TBL-1-3-4" style="text-align: center; white-space: nowrap;"/>
</tr>
<tr class="even" id="TBL-1-4-" style="vertical-align:baseline;">
<td class="td11" id="TBL-1-4-1" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">readme-new-england-oldweather.txt</span></td>
<td class="td11" id="TBL-1-4-2" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">2014-01-29 19:22</span></td>
<td class="td11" id="TBL-1-4-3" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml">9.6K</span></td>
<td class="td11" id="TBL-1-4-4" style="text-align: center; white-space: nowrap;"/>
</tr>
<tr class="odd" id="TBL-1-5-" style="vertical-align:baseline;">
<td class="td11" id="TBL-1-5-1" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml">town-summary.txt</span></td>
<td class="td11" id="TBL-1-5-2" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml">2014-01-29 18:51</span></td>
<td class="td11" id="TBL-1-5-3" style="text-align: center; white-space: nowrap;"><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">34K</span></td>
<td class="td11" id="TBL-1-5-4" style="text-align: center; white-space: nowrap;"/>
</tr>
<tr class="even hline">
<td><hr/>
</td>
<td><hr/>
</td>
<td><hr/>
</td>
<td><hr/>
</td>
</tr>
<tr class="odd" id="TBL-1-6-" style="vertical-align:baseline;">
<td class="td11" id="TBL-1-6-1" style="text-align: center; white-space: nowrap;"/>
<td/>
<td/>
<td/>
</tr>
</tbody>
</table>
</div>
</div>
<p><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml">readme-new-england-oldweather.txt</span></code><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml"> file has descriptions of a number of codes and their meanings used in the main data set. </span><span class="koboSpan" id="kobo.698.2" xmlns="http://www.w3.org/1999/xhtml">The ”readme” file provides a number of mappings from keys to values. </span><span class="koboSpan" id="kobo.698.3" xmlns="http://www.w3.org/1999/xhtml">The keys are used in the massive ”oldweather-data” file to reduce the repetition of data.</span></p>
<p><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml">These mappings include the following:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">The Temperature Code Key</span></p></li>
<li><p><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml">The Precipitation Type Key</span></p></li>
<li><p><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">The Precipitation Amount key</span></p></li>
<li><p><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml">The Snowfall Amount key</span></p></li>
<li><p><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">The Like Values Code key</span></p></li>
<li><p><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml">The Pressure Code Key</span></p></li>
<li><p><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml">The Sky Cover Key</span></p></li>
<li><p><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">The Sky Classification Key</span></p></li>
<li><p><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml">The Location Code Key</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">This is a rather complex </span><span id="dx1-181002"/><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml">decomposition of primary data into coded values. </span><span id="x1-181003r194"/></p>
<section class="level3" data-number="11.1.1" id="description-9">
<h3 data-number="11.1.1"><span class="titlemark"><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">7.3.1 </span></span> <span id="x1-1820001"/><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></h3>
<p><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml">In cases where data is decomposed or normalized, we need to confirm that references between items are valid. </span><span class="koboSpan" id="kobo.713.2" xmlns="http://www.w3.org/1999/xhtml">Relationships are often one-way — a sample will have a reference to an item in another collection of data. </span><span class="koboSpan" id="kobo.713.3" xmlns="http://www.w3.org/1999/xhtml">For example, a climate record may have a reference to ”Town Id” (TWID) with a value like </span><code><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">NY26</span></code><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.715.2" xmlns="http://www.w3.org/1999/xhtml">A second data set with the ”location code key” provides detailed information on the definition of the </span><code><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">NY26</span></code><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml"> town ID. </span><span class="koboSpan" id="kobo.717.2" xmlns="http://www.w3.org/1999/xhtml">There’s no reverse reference from the location code data set to all of the climate records for that location.</span></p>
<p><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">We often depict this relationship as an ERD. </span><span class="koboSpan" id="kobo.718.2" xmlns="http://www.w3.org/1999/xhtml">For example, </span><a href="#7.1"><em><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml">Figure 7.1</span></em></a><em><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">.</span></em></p>
<figure class="IMG---Figure">
<span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 7.1: A Normalized Relationship " src="../media/file35.jpg"/></span>
<figcaption class="IMG---Caption"><span class="id" id="7.1"><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">Figure 7.1: </span></span><span class="content"><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml">A Normalized Relationship </span></span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml">A number of weather data records refer to a single location definition.</span></p>
<p><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">The database </span><span id="dx1-182003"/><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml">designers will call the Location’s “TWID” attribute a </span><strong><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml">primary</span></strong> <strong><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">key</span></strong><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.729.2" xmlns="http://www.w3.org/1999/xhtml">The WeatherData’s ID attribute is </span><span id="dx1-182004"/><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">called a </span><strong><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">foreign key</span></strong><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml">; it’s a primary key for a different class of entities. </span><span class="koboSpan" id="kobo.732.2" xmlns="http://www.w3.org/1999/xhtml">These are often abbreviated as PK and FK.</span></p>
<p><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">There are two closely related questions about the relationship between entities:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml">What is the </span><em><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">cardinality </span></em><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">of the relationship? </span><span class="koboSpan" id="kobo.736.2" xmlns="http://www.w3.org/1999/xhtml">This must be viewed from both directions. </span><span class="koboSpan" id="kobo.736.3" xmlns="http://www.w3.org/1999/xhtml">How many primary key entities have </span><span id="dx1-182005"/><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">relationships with foreign key entities? </span><span class="koboSpan" id="kobo.737.2" xmlns="http://www.w3.org/1999/xhtml">How many foreign key entities have a relationship with a primary key entity?</span></p></li>
<li><p><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml">What is the </span><em><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">optionality </span></em><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml">of the relationship? </span><span class="koboSpan" id="kobo.740.2" xmlns="http://www.w3.org/1999/xhtml">Again, we must ask this in both directions. </span><span class="koboSpan" id="kobo.740.3" xmlns="http://www.w3.org/1999/xhtml">Must a </span><span id="dx1-182006"/><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">primary entity have any foreign key references? </span><span class="koboSpan" id="kobo.741.2" xmlns="http://www.w3.org/1999/xhtml">Must the foreign key item have a primary key reference?</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml">While a large number of combinations are possible, there are a few common patterns.</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">The mandatory many-to-one relationship. </span><span class="koboSpan" id="kobo.743.2" xmlns="http://www.w3.org/1999/xhtml">This is </span><span id="dx1-182007"/><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml">exemplified by the historical weather data. </span><span class="koboSpan" id="kobo.744.2" xmlns="http://www.w3.org/1999/xhtml">Many weather data records must refer to a single location definition. </span><span class="koboSpan" id="kobo.744.3" xmlns="http://www.w3.org/1999/xhtml">There are two common variants. </span><span class="koboSpan" id="kobo.744.4" xmlns="http://www.w3.org/1999/xhtml">In one case, a location </span><strong><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">must </span></strong><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">have one or more weather records. </span><span class="koboSpan" id="kobo.746.2" xmlns="http://www.w3.org/1999/xhtml">The other common variant may have locations without any weather data that refers to the location.</span></p></li>
<li><p><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">An optional one-to-one relationship. </span><span class="koboSpan" id="kobo.747.2" xmlns="http://www.w3.org/1999/xhtml">This isn’t in the </span><span id="dx1-182008"/><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml">weather data example, but we may have invoices with payments and invoices without payments. </span><span class="koboSpan" id="kobo.748.2" xmlns="http://www.w3.org/1999/xhtml">The relationship is one-to-one, but a payment may not exist yet.</span></p></li>
<li><p><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">A many-to-many relationship. </span><span class="koboSpan" id="kobo.749.2" xmlns="http://www.w3.org/1999/xhtml">An </span><span id="dx1-182009"/><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml">example of a many-to-many relationship is a product entity that has a number of features. </span><span class="koboSpan" id="kobo.750.2" xmlns="http://www.w3.org/1999/xhtml">Features are reused between products. </span><span class="koboSpan" id="kobo.750.3" xmlns="http://www.w3.org/1999/xhtml">This requires a separate many-to-many association table to track the relationship links.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">This leads to the following two detailed inspections:</span></p>
<ol>
<li><div id="x1-182011x1">
<p><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml">The domain of </span><span id="dx1-182012"/><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">primary key values. </span><span class="koboSpan" id="kobo.753.2" xmlns="http://www.w3.org/1999/xhtml">For example, the “TWID” attribute of each location.</span></p>
</div></li>
<li><div id="x1-182014x2">
<p><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml">The domain of the </span><span id="dx1-182015"/><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">foreign key values. </span><span class="koboSpan" id="kobo.755.2" xmlns="http://www.w3.org/1999/xhtml">For example, the ID attribute of each weather data record.</span></p>
</div></li>
</ol>
<p><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">If these two sets are identical, we can be sure the foreign keys all have matching primary keys. </span><span class="koboSpan" id="kobo.756.2" xmlns="http://www.w3.org/1999/xhtml">We can count the number of rows that share a foreign key to work out the cardinality (and the optionality) of the relationship.</span></p>
<p><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml">If the two sets are not identical, we have to determine which set has the extra rows. </span><span class="koboSpan" id="kobo.757.2" xmlns="http://www.w3.org/1999/xhtml">Let’s call the two sets </span><em><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">P </span></em><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml">and </span><em><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml">F</span></em><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.761.2" xmlns="http://www.w3.org/1999/xhtml">Further, we know that </span><em><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">P</span></em><em><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">≠</span></em><em><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml">F</span></em><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.765.2" xmlns="http://www.w3.org/1999/xhtml">There are a number of scenarios:</span></p>
<ul>
<li><p><em><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml">P </span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">⊃ </span></span><em><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">F</span></em><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">: This means there are some primary keys without any foreign keys. </span><span class="koboSpan" id="kobo.769.2" xmlns="http://www.w3.org/1999/xhtml">If the relationship is optional, then, there’s no problem. </span><span class="koboSpan" id="kobo.769.3" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml">P</span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">∖</span></span><em><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml">F</span></em><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml"> is the set of unused entities.</span></p></li>
<li><p><em><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">F </span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">⊂ </span></span><em><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">P</span></em><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">: This means there are foreign keys that do not have an associated primary key. </span><span class="koboSpan" id="kobo.777.2" xmlns="http://www.w3.org/1999/xhtml">This situation may be a misunderstanding of the key attributes, or it may mean data is missing.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml">What’s important for this project is to have an overview of key values and their relationship. </span><span class="koboSpan" id="kobo.778.2" xmlns="http://www.w3.org/1999/xhtml">This notebook is only designed to preview and inspect the data. </span><span class="koboSpan" id="kobo.778.3" xmlns="http://www.w3.org/1999/xhtml">It is used to demonstrate the data is complete and consistent, and can be used for further processing.</span></p>
<p><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at how we can build cells in a notebook to compare the keys and determine the cardinality of the relationships. </span><span id="x1-182016r198"/></p>
</section>
<section class="level3" data-number="11.1.2" id="approach-8">
<h3 data-number="11.1.2"><span class="titlemark"><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">7.3.2 </span></span> <span id="x1-1830002"/><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">Approach</span></h3>
<p><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">To work with data sets like </span><a class="url" href="https://www.ncei.noaa.gov/pub/data/paleo/historical/northamerica/usa/new-england/"><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml">https://www.ncei.noaa.gov/pub/data/paleo/historical/northamerica/usa/new-england/</span></a><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml"> we’ll need to compare keys.</span></p>
<p><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">This will lead to two kinds of data summarization cells in an inspection notebook:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml">Summarizing primary keys in a </span><code><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">Counter</span></code><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml"> object.</span></p></li>
<li><p><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml">Summarizing foreign key references to those primary keys, also using a </span><code><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">Counter</span></code><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">Once the </span><code><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">Counter</span></code><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml"> summaries are available, then the </span><code><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">.keys()</span></code><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml"> method will have the distinct primary or foreign key values. </span><span class="koboSpan" id="kobo.796.2" xmlns="http://www.w3.org/1999/xhtml">This can be transformed into a Python </span><code><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">set</span></code><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml"> object, permitting elegant comparison, subset checking, and set subtraction operations.</span></p>
<p><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at the programming to collect key values and references to keys first. </span><span class="koboSpan" id="kobo.799.2" xmlns="http://www.w3.org/1999/xhtml">Then, we’ll look at summaries that are helpful.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.1.2.1" id="collect-and-compare-keys">
<h4 class="likesubsubsectionHead" data-number="11.1.2.1"><span id="x1-1840002"/><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">Collect and compare keys</span></h4>
<p><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">The core </span><span id="dx1-184001"/><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">inspection tool is the </span><code><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">collections.Counter</span></code><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.804.2" xmlns="http://www.w3.org/1999/xhtml">Let’s assume we have done two separate data acquisition steps. </span><span class="koboSpan" id="kobo.804.3" xmlns="http://www.w3.org/1999/xhtml">The first extracted the </span><span id="dx1-184002"/><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">location definitions from the </span><code><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">readme-new-england-oldweather.txt</span></code><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span class="koboSpan" id="kobo.807.2" xmlns="http://www.w3.org/1999/xhtml">The </span><span id="dx1-184003"/><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">second converted all of the </span><code><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml">new-england-oldweather-data.txt</span></code><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml"> weather data records into a separate file.</span></p>
<p><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml">The inspection notebook can load the location definitions and gather the values of the </span><code><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">TWID</span></code><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml"> attribute.</span></p>
<p><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">One cell for loading the key definitions might look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-137">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">from pathlib import Path
from inspection import samples_iter

location_path = Path("/path/to/location.ndjson")
with location_path.open() as data_file:
    locations = list(samples_iter(data_file))</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">A cell for inspecting the definitions of the town keys might look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-138">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml">import collections

town_id_count = collections.Counter(
    row[’TWID’] for row in locations
)
town_id_set = set(town_id_count.keys())</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">This creates the </span><code><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">town_id_set</span></code><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml"> variable with a set of IDs in use. </span><span class="koboSpan" id="kobo.820.2" xmlns="http://www.w3.org/1999/xhtml">The values of the </span><code><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">town_id_counts</span></code><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml"> variable are the number of location definitions for each ID. </span><span class="koboSpan" id="kobo.822.2" xmlns="http://www.w3.org/1999/xhtml">Since this is supposed to be a primary key, it should have only a single instance of each value.</span></p>
<p><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">The data with </span><span id="dx1-184016"/><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml">references to the town </span><span id="dx1-184017"/><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">keys may be much larger than the definitions of the keys. </span><span class="koboSpan" id="kobo.825.2" xmlns="http://www.w3.org/1999/xhtml">In some cases, it’s not practical to load all the data into memory, and instead, the inspection needs to work with summaries of selected columns.</span></p>
<p><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml">For this example, that means a </span><code><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml">list</span></code><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml"> object is </span><strong><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">not </span></strong><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">created with the weather data. </span><span class="koboSpan" id="kobo.830.2" xmlns="http://www.w3.org/1999/xhtml">Instead, a generator expression is used to extract a relevant column, and this generator is then used to build the final summary </span><code><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">Counter</span></code><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml"> object.</span></p>
<p><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">The rows of data with references to the foreign keys might look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-139">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">weather_data_path = Path("/path/to/weather-data.ndjson")
with weather_data_path.open() as data_file:
    weather_reports = samples_iter(data_file)
    weather_id_count = collections.Counter(
        row[’ID’] for row in weather_reports
    )</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml">Once the </span><code><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">weather_id_count</span></code><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml"> summary has been created, the following cell can compute the domain of key references like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-140">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml">weather_id_set = set(weather_id_count.keys())</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">It’s important to note that this example emphatically does </span><em><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml">not </span></em><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml">create a list of individual weather report samples. </span><span class="koboSpan" id="kobo.841.2" xmlns="http://www.w3.org/1999/xhtml">That would be a lot of data jammed into memory at one time. </span><span class="koboSpan" id="kobo.841.3" xmlns="http://www.w3.org/1999/xhtml">Instead, this example uses a generator expression to extract the </span><code><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">’ID’</span></code><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml"> attribute from each row. </span><span class="koboSpan" id="kobo.843.2" xmlns="http://www.w3.org/1999/xhtml">These values are used to populate the </span><code><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml">weather_id_count</span></code><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.845.2" xmlns="http://www.w3.org/1999/xhtml">This is used to extract the set of IDs in use in the weather reports.</span></p>
<p><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">Since we have two sets, we can use Python’s set operations to compare the two. </span><span class="koboSpan" id="kobo.846.2" xmlns="http://www.w3.org/1999/xhtml">Ideally, a cell can assert that </span><code><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">weather_id_set</span></code><code><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml"> ==</span></code><code><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml"> town_id_set</span></code><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.850.2" xmlns="http://www.w3.org/1999/xhtml">If the two are not equal, then the set subtraction operation can be used to locate anomalous data.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.1.2.2" id="summarize-keys-counts">
<h4 class="likesubsubsectionHead" data-number="11.1.2.2"><span id="x1-1850002"/><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">Summarize keys counts</span></h4>
<p><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">The first summary is the </span><span id="dx1-185001"/><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml">comparison of primary keys to foreign keys. </span><span class="koboSpan" id="kobo.853.2" xmlns="http://www.w3.org/1999/xhtml">If the two sets don’t match, the list of missing foreign keys may be helpful for locating the root cause of the problem.</span></p>
<p><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">Additionally, the range of counts for a foreign key provides some hints as to its cardinality and optionality. </span><span class="koboSpan" id="kobo.854.2" xmlns="http://www.w3.org/1999/xhtml">When a primary key has no foreign key values referring to it, the relationship appears optional. </span><span class="koboSpan" id="kobo.854.3" xmlns="http://www.w3.org/1999/xhtml">This should be confirmed by reading the metadata descriptions. </span><span class="koboSpan" id="kobo.854.4" xmlns="http://www.w3.org/1999/xhtml">The lower and upper bounds on the foreign key counts provide the range of the cardinality. </span><span class="koboSpan" id="kobo.854.5" xmlns="http://www.w3.org/1999/xhtml">Does this range make sense? </span><span class="koboSpan" id="kobo.854.6" xmlns="http://www.w3.org/1999/xhtml">Are there any hints in the metadata about the cardinality?</span></p>
<p><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">The example data source for this project includes a file with summary counts. </span><span class="koboSpan" id="kobo.855.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">town-summary.txt</span></code><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml"> file has four columns: “STID”, “TWID”, “YEAR”, and “Records”. </span><span class="koboSpan" id="kobo.857.2" xmlns="http://www.w3.org/1999/xhtml">The “STID” is from the location definitions; it’s the US state. </span><span class="koboSpan" id="kobo.857.3" xmlns="http://www.w3.org/1999/xhtml">The “TWID” is the town ID. </span><span class="koboSpan" id="kobo.857.4" xmlns="http://www.w3.org/1999/xhtml">The “YEAR” is from the weather data; it’s the year of the report. </span><span class="koboSpan" id="kobo.857.5" xmlns="http://www.w3.org/1999/xhtml">Finally, the “Records” attribute is the count of weather reports for a given location and year.</span></p>
<p><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml">The Town ID and Year form a logical pair of values that can be used to build a </span><code><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">collections.Counter</span></code><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml"> object. </span><span class="koboSpan" id="kobo.860.2" xmlns="http://www.w3.org/1999/xhtml">To fully reproduce this table, though, the location definitions are needed to map a Town ID, “TWID,” to the associated state, “STID.”</span></p>
<p><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">While it’s also possible to decompose the “TWID” key to extract the state information from the first two characters, this is not a good design alternative. </span><span class="koboSpan" id="kobo.861.2" xmlns="http://www.w3.org/1999/xhtml">This composite key is an uncommon kind of key design. </span><span class="koboSpan" id="kobo.861.3" xmlns="http://www.w3.org/1999/xhtml">It’s considerably more common for primary keys to be atomic with no internal information available. </span><span class="koboSpan" id="kobo.861.4" xmlns="http://www.w3.org/1999/xhtml">A good design treats the key as an opaque identifier and looks up the state information in the associated location definition table from the </span><code><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml">readme</span></code><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span id="x1-185002r200"/></p>
</section>
</section>
<section class="level3" data-number="11.1.3" id="deliverables-9">
<h3 data-number="11.1.3"><span class="titlemark"><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml">7.3.3 </span></span> <span id="x1-1860003"/><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">Deliverables</span></h3>
<p><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml">This project has the following deliverables:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">A </span><code><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml">requirements-dev.txt</span></code><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml"> file that identifies the tools used, usually </span><code><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">jupyterlab==3.5.3</span></code><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p></li>
<li><p><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">Documentation in the </span><code><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">docs</span></code><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for any new changes to the modules in use.</span></p></li>
<li><p><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">Any new application modules with code to be used by the inspection notebook.</span></p></li>
<li><p><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">A notebook to inspect the attributes that appear to have foreign or primary keys.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">The project directory structure suggested in </span><a href="ch005.xhtml#x1-170001"><em><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml"> 1</span></em></a><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch005.xhtml#x1-170001"><em><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">Project Zero: A Template</span></em> <em><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">for Other Projects</span></em></a><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml"> mentions a </span><code><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">notebooks</span></code><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml"> directory. </span><span class="koboSpan" id="kobo.886.2" xmlns="http://www.w3.org/1999/xhtml">See </span><a href="ch005.xhtml#x1-260003"><em><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml">List of deliverables</span></em></a><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml"> for some more information. </span><span class="koboSpan" id="kobo.888.2" xmlns="http://www.w3.org/1999/xhtml">For this project, the notebook directory is needed.</span></p>
<p><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at a few of these deliverables in a little more detail.</span></p>
<section class="level4 likesubsubsectionHead" data-number="11.1.3.1" id="revised-inspection-module-1">
<h4 class="likesubsubsectionHead" data-number="11.1.3.1"><span id="x1-1870003"/><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml">Revised inspection module</span></h4>
<p><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">The functions for </span><span id="dx1-187001"/><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">examining primary and foreign keys can be written in a separate module. </span><span class="koboSpan" id="kobo.892.2" xmlns="http://www.w3.org/1999/xhtml">It’s often easiest to develop these in a notebook first. </span><span class="koboSpan" id="kobo.892.3" xmlns="http://www.w3.org/1999/xhtml">There can be odd discrepancies that arise because of misunderstandings. </span><span class="koboSpan" id="kobo.892.4" xmlns="http://www.w3.org/1999/xhtml">Once the key examination works, it can be moved to the inspection module. </span><span class="koboSpan" id="kobo.892.5" xmlns="http://www.w3.org/1999/xhtml">As we noted in the </span><a href="#x1-1720001"><em><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></em></a><span class="koboSpan" id="kobo.894.1" xmlns="http://www.w3.org/1999/xhtml">, this project’s objective is to support the inspection of the data and the identification of special cases, data anomalies, and outlier values.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.1.3.2" id="unit-test-cases-1">
<h4 class="likesubsubsectionHead" data-number="11.1.3.2"><span id="x1-1880003"/><span class="koboSpan" id="kobo.895.1" xmlns="http://www.w3.org/1999/xhtml">Unit test cases</span></h4>
<p><span class="koboSpan" id="kobo.896.1" xmlns="http://www.w3.org/1999/xhtml">It’s often helpful to </span><span id="dx1-188001"/><span class="koboSpan" id="kobo.897.1" xmlns="http://www.w3.org/1999/xhtml">create test cases for the most common varieties of key problems: primary keys with no foreign keys and foreign keys with no primary keys. </span><span class="koboSpan" id="kobo.897.2" xmlns="http://www.w3.org/1999/xhtml">These complications don’t often arise with readily available, well-curated data sets; they often arise with enterprise data with incomplete documentation.</span></p>
<p><span class="koboSpan" id="kobo.898.1" xmlns="http://www.w3.org/1999/xhtml">This can lead to rather lengthy fixtures that contain two collections of source objects. </span><span class="koboSpan" id="kobo.898.2" xmlns="http://www.w3.org/1999/xhtml">It doesn’t take many rows of data to reveal a missing key; two rows of data are enough to show a key that’s present and a row with a missing key.</span></p>
<p><span class="koboSpan" id="kobo.899.1" xmlns="http://www.w3.org/1999/xhtml">It’s also essential to keep these test cases separate from test cases for cardinal data processing, and ordinal data conversions. </span><span class="koboSpan" id="kobo.899.2" xmlns="http://www.w3.org/1999/xhtml">Since keys are a kind of nominal data, a key cardinality check may be dependent on a separate function to clean damaged key values.</span></p>
<p><span class="koboSpan" id="kobo.900.1" xmlns="http://www.w3.org/1999/xhtml">For example, real data may require a step to add leading zeroes to account numbers before they can be checked against a list of transactions to find transactions for the account. </span><span class="koboSpan" id="kobo.900.2" xmlns="http://www.w3.org/1999/xhtml">These two operations on </span><span id="dx1-188002"/><span class="koboSpan" id="kobo.901.1" xmlns="http://www.w3.org/1999/xhtml">account number keys need to be built — and tested — in isolation. </span><span class="koboSpan" id="kobo.901.2" xmlns="http://www.w3.org/1999/xhtml">The data cleanup application can combine the two functions. </span><span class="koboSpan" id="kobo.901.3" xmlns="http://www.w3.org/1999/xhtml">For now, they are separate concerns with separate test cases.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="11.1.3.3" id="revised-notebook-to-use-the-refactored-inspection-model">
<h4 class="likesubsubsectionHead" data-number="11.1.3.3"><span id="x1-1890003"/><span class="koboSpan" id="kobo.902.1" xmlns="http://www.w3.org/1999/xhtml">Revised notebook to use the refactored inspection model</span></h4>
<p><span class="koboSpan" id="kobo.903.1" xmlns="http://www.w3.org/1999/xhtml">A failure to resolve </span><span id="dx1-189001"/><span class="koboSpan" id="kobo.904.1" xmlns="http://www.w3.org/1999/xhtml">foreign keys is a chronic problem in data acquisition applications. </span><span class="koboSpan" id="kobo.904.2" xmlns="http://www.w3.org/1999/xhtml">This is often due to a wide variety of circumstances, and there’s no single process for data inspection. </span><span class="koboSpan" id="kobo.904.3" xmlns="http://www.w3.org/1999/xhtml">This means a </span><span id="dx1-189002"/><span class="koboSpan" id="kobo.905.1" xmlns="http://www.w3.org/1999/xhtml">notebook can have a spectrum of information in it. </span><span class="koboSpan" id="kobo.905.2" xmlns="http://www.w3.org/1999/xhtml">We might see any of the following kinds of cells:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.906.1" xmlns="http://www.w3.org/1999/xhtml">A cell explaining the sets of keys match, and the data is likely usable.</span></p></li>
<li><p><span class="koboSpan" id="kobo.907.1" xmlns="http://www.w3.org/1999/xhtml">A cell explaining some primary keys have no foreign key data. </span><span class="koboSpan" id="kobo.907.2" xmlns="http://www.w3.org/1999/xhtml">This may include a summary of this subset of samples, separate from samples that have foreign key references.</span></p></li>
<li><p><span class="koboSpan" id="kobo.908.1" xmlns="http://www.w3.org/1999/xhtml">A cell explaining some foreign keys that have no primary key. </span><span class="koboSpan" id="kobo.908.2" xmlns="http://www.w3.org/1999/xhtml">These may may reflect errors in the data. </span><span class="koboSpan" id="kobo.908.3" xmlns="http://www.w3.org/1999/xhtml">It may reflect a more complex relationship between keys. </span><span class="koboSpan" id="kobo.908.4" xmlns="http://www.w3.org/1999/xhtml">It may reflect a more complicated data model. </span><span class="koboSpan" id="kobo.908.5" xmlns="http://www.w3.org/1999/xhtml">It may reflect missing data.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.909.1" xmlns="http://www.w3.org/1999/xhtml">In all cases, an extra cell with some markdown explaining the results is necessary. </span><span class="koboSpan" id="kobo.909.2" xmlns="http://www.w3.org/1999/xhtml">In the future, you will be grateful because in the past, you left an explanation of an anomaly in your notebook. </span><span id="x1-189003r197"/></p>
</section>
</section>
</section>
<section class="level2" data-number="11.2" id="summary-6">
<h2 data-number="11.2"><span class="titlemark"><span class="koboSpan" id="kobo.910.1" xmlns="http://www.w3.org/1999/xhtml">7.4 </span></span> <span id="x1-1900004"/><span class="koboSpan" id="kobo.911.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.912.1" xmlns="http://www.w3.org/1999/xhtml">This chapter expanded on the core features of the inspection notebook. </span><span class="koboSpan" id="kobo.912.2" xmlns="http://www.w3.org/1999/xhtml">We looked at handling cardinal data (measures and counts), ordinal data (dates and ranks), and nominal data (codes like account numbers).</span></p>
<p><span class="koboSpan" id="kobo.913.1" xmlns="http://www.w3.org/1999/xhtml">Our primary objective was to get a complete view of the data, prior to formalizing our analysis pipeline. </span><span class="koboSpan" id="kobo.913.2" xmlns="http://www.w3.org/1999/xhtml">A secondary objective was to leave notes for ourselves on outliers, anomalies, data formatting problems and other complications. </span><span class="koboSpan" id="kobo.913.3" xmlns="http://www.w3.org/1999/xhtml">A pleasant consequence of this effort is to be able to write some functions that can be used downstream to clean and normalize the data we’ve found.</span></p>
<p><span class="koboSpan" id="kobo.914.1" xmlns="http://www.w3.org/1999/xhtml">Starting in </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.915.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.916.1" xmlns="http://www.w3.org/1999/xhtml"> 9</span></em></a><span class="koboSpan" id="kobo.917.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.918.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.1: Data Cleaning Base Application</span></em></a><span class="koboSpan" id="kobo.919.1" xmlns="http://www.w3.org/1999/xhtml">, we’ll look at refactoring these inspection functions to create a complete and automated data cleaning and normalization application. </span><span class="koboSpan" id="kobo.919.2" xmlns="http://www.w3.org/1999/xhtml">That application will be based on the lessons learned while creating inspection notebooks.</span></p>
<p><span class="koboSpan" id="kobo.920.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, we’ll look at one more lesson that’s often learned from the initial inspection. </span><span class="koboSpan" id="kobo.920.2" xmlns="http://www.w3.org/1999/xhtml">We often discover the underlying schema behind multiple, diverse sources of data. </span><span class="koboSpan" id="kobo.920.3" xmlns="http://www.w3.org/1999/xhtml">We’ll look at formalizing the schema definition via JSONSchema, and using the schema to validate data. </span><span id="x1-190001r207"/></p>
</section>
<section class="level2" data-number="11.3" id="extras-5">
<h2 data-number="11.3"><span class="titlemark"><span class="koboSpan" id="kobo.921.1" xmlns="http://www.w3.org/1999/xhtml">7.5 </span></span> <span id="x1-1910005"/><span class="koboSpan" id="kobo.922.1" xmlns="http://www.w3.org/1999/xhtml">Extras</span></h2>
<p><span class="koboSpan" id="kobo.923.1" xmlns="http://www.w3.org/1999/xhtml">Here are some ideas for you to add to the projects in this chapter. </span><span id="x1-191001r203"/></p>
<section class="level3" data-number="11.3.1" id="markdown-cells-with-dates-and-data-source-information">
<h3 data-number="11.3.1"><span class="titlemark"><span class="koboSpan" id="kobo.924.1" xmlns="http://www.w3.org/1999/xhtml">7.5.1 </span></span> <span id="x1-1920001"/><span class="koboSpan" id="kobo.925.1" xmlns="http://www.w3.org/1999/xhtml">Markdown cells with dates and data source information</span></h3>
<p><span class="koboSpan" id="kobo.926.1" xmlns="http://www.w3.org/1999/xhtml">A minor feature of an </span><span id="dx1-192001"/><span class="koboSpan" id="kobo.927.1" xmlns="http://www.w3.org/1999/xhtml">inspection notebook is some identification of the date, time, and source of the data. </span><span class="koboSpan" id="kobo.927.2" xmlns="http://www.w3.org/1999/xhtml">It’s sometimes clear from the context what the data source is; there may, for example, be an obvious path to the data.</span></p>
<p><span class="koboSpan" id="kobo.928.1" xmlns="http://www.w3.org/1999/xhtml">However, in many cases, it’s not perfectly clear what file is being inspected or how it was acquired. </span><span class="koboSpan" id="kobo.928.2" xmlns="http://www.w3.org/1999/xhtml">As a general solution, any processing application should produce a log. </span><span class="koboSpan" id="kobo.928.3" xmlns="http://www.w3.org/1999/xhtml">In some cases, a metadata file can include the details of the processing steps.</span></p>
<p><span class="koboSpan" id="kobo.929.1" xmlns="http://www.w3.org/1999/xhtml">This additional metadata on the source and processing steps can be helpful when reviewing a data inspection notebook or sharing a preliminary inspection of data with others. </span><span class="koboSpan" id="kobo.929.2" xmlns="http://www.w3.org/1999/xhtml">In many cases, this extra data is pasted into ordinary markdown cells. </span><span class="koboSpan" id="kobo.929.3" xmlns="http://www.w3.org/1999/xhtml">In other cases, this data may be the result of scanning a log file for key </span><code><span class="koboSpan" id="kobo.930.1" xmlns="http://www.w3.org/1999/xhtml">INFO</span></code><span class="koboSpan" id="kobo.931.1" xmlns="http://www.w3.org/1999/xhtml"> lines that summarize processing. </span><span id="x1-192002r209"/></p>
</section>
<section class="level3" data-number="11.3.2" id="presentation-materials">
<h3 data-number="11.3.2"><span class="titlemark"><span class="koboSpan" id="kobo.932.1" xmlns="http://www.w3.org/1999/xhtml">7.5.2 </span></span> <span id="x1-1930002"/><span class="koboSpan" id="kobo.933.1" xmlns="http://www.w3.org/1999/xhtml">Presentation materials</span></h3>
<p><span class="koboSpan" id="kobo.934.1" xmlns="http://www.w3.org/1999/xhtml">A common request is to tailor a </span><span id="dx1-193001"/><span class="koboSpan" id="kobo.935.1" xmlns="http://www.w3.org/1999/xhtml">presentation to users or peers to explain a new source of data, or explain anomalies found in existing data sources. </span><span class="koboSpan" id="kobo.935.2" xmlns="http://www.w3.org/1999/xhtml">These presentations often involve an online meeting or in-person meeting with some kind of “slide deck” that emphasizes the speaker’s points.</span></p>
<p><span class="koboSpan" id="kobo.936.1" xmlns="http://www.w3.org/1999/xhtml">Proprietary tools like Keynote or PowerPoint are common for these slide decks.</span></p>
<p><span class="koboSpan" id="kobo.937.1" xmlns="http://www.w3.org/1999/xhtml">A better choice is to organize a notebook carefully and export it as </span><code><span class="koboSpan" id="kobo.938.1" xmlns="http://www.w3.org/1999/xhtml">reveal.js</span></code><span class="koboSpan" id="kobo.939.1" xmlns="http://www.w3.org/1999/xhtml"> slides.</span></p>
<p><span class="koboSpan" id="kobo.940.1" xmlns="http://www.w3.org/1999/xhtml">The RISE extension for Jupyter is popular for this. </span><span class="koboSpan" id="kobo.940.2" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://rise.readthedocs.io/en/stable/"><span class="koboSpan" id="kobo.941.1" xmlns="http://www.w3.org/1999/xhtml">https://rise.readthedocs.io/en/stable/</span></a><span class="koboSpan" id="kobo.942.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.943.1" xmlns="http://www.w3.org/1999/xhtml">Having a notebook that is </span><strong><span class="koboSpan" id="kobo.944.1" xmlns="http://www.w3.org/1999/xhtml">also </span></strong><span class="koboSpan" id="kobo.945.1" xmlns="http://www.w3.org/1999/xhtml">the slide </span><span id="dx1-193002"/><span class="koboSpan" id="kobo.946.1" xmlns="http://www.w3.org/1999/xhtml">presentation for business owners and users provide a great deal of flexibility. </span><span class="koboSpan" id="kobo.946.2" xmlns="http://www.w3.org/1999/xhtml">Rather than copying and pasting to move data from an inspection notebook to PowerPoint (or Keynote), we only need to make sure each slide has a few key points about the data. </span><span class="koboSpan" id="kobo.946.3" xmlns="http://www.w3.org/1999/xhtml">If the slide has a data sample, it’s only a few rows, which provide supporting evidence for the speaker’s remarks.</span></p>
<p><span class="koboSpan" id="kobo.947.1" xmlns="http://www.w3.org/1999/xhtml">In many enterprises, these presentations are shared widely. </span><span class="koboSpan" id="kobo.947.2" xmlns="http://www.w3.org/1999/xhtml">It can be beneficial to make sure the data in the presentation comes directly from the source and is immune to copy-paste errors and omissions. </span><span id="x1-193003r210"/></p>
</section>
<section class="level3" data-number="11.3.3" id="jupyterbook-or-quarto-for-even-more-sophisticated-output">
<h3 data-number="11.3.3"><span class="titlemark"><span class="koboSpan" id="kobo.948.1" xmlns="http://www.w3.org/1999/xhtml">7.5.3 </span></span> <span id="x1-1940003"/><span class="koboSpan" id="kobo.949.1" xmlns="http://www.w3.org/1999/xhtml">JupyterBook or Quarto for even more sophisticated output</span></h3>
<p><span class="koboSpan" id="kobo.950.1" xmlns="http://www.w3.org/1999/xhtml">In some cases, a preliminary </span><span id="dx1-194001"/><span class="koboSpan" id="kobo.951.1" xmlns="http://www.w3.org/1999/xhtml">inspection of data may involve learning a lot of lessons about the data sources, encoding schemes, missing data, and relationships between data sets. </span><span class="koboSpan" id="kobo.951.2" xmlns="http://www.w3.org/1999/xhtml">This information often needs to be organized and published.</span></p>
<p><span class="koboSpan" id="kobo.952.1" xmlns="http://www.w3.org/1999/xhtml">There are a number of ways to disseminate lessons learned about data:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.953.1" xmlns="http://www.w3.org/1999/xhtml">Share the notebooks. </span><span class="koboSpan" id="kobo.953.2" xmlns="http://www.w3.org/1999/xhtml">For some communities of users, the interactive nature of a notebook invites further exploration.</span></p></li>
<li><p><span class="koboSpan" id="kobo.954.1" xmlns="http://www.w3.org/1999/xhtml">Export the notebook for publication. </span><span class="koboSpan" id="kobo.954.2" xmlns="http://www.w3.org/1999/xhtml">One choice is to create a PDF that can be shared. </span><span class="koboSpan" id="kobo.954.3" xmlns="http://www.w3.org/1999/xhtml">Another choice is to create RST, Markdown, or LaTeX and use a publishing pipeline to build a final, shareable document.</span></p></li>
<li><p><span class="koboSpan" id="kobo.955.1" xmlns="http://www.w3.org/1999/xhtml">Use a tool like Jupyter</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.956.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span><span class="koboSpan" id="kobo.957.1" xmlns="http://www.w3.org/1999/xhtml">Book</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.958.1" xmlns="http://www.w3.org/1999/xhtml">} </span></span><span class="koboSpan" id="kobo.959.1" xmlns="http://www.w3.org/1999/xhtml">to formalize the publication of a shareable document.</span></p></li>
<li><p><span class="koboSpan" id="kobo.960.1" xmlns="http://www.w3.org/1999/xhtml">Use Quarto to publish a final, shareable document.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.961.1" xmlns="http://www.w3.org/1999/xhtml">For Jupyter</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.962.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span><span class="koboSpan" id="kobo.963.1" xmlns="http://www.w3.org/1999/xhtml">Book</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.964.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span><span class="koboSpan" id="kobo.965.1" xmlns="http://www.w3.org/1999/xhtml">, see </span><a class="url" href="https://jupyterbook.org/en/stable/intro.html"><span class="koboSpan" id="kobo.966.1" xmlns="http://www.w3.org/1999/xhtml">https://jupyterbook.org/en/stable/intro.html</span></a><span class="koboSpan" id="kobo.967.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.967.2" xmlns="http://www.w3.org/1999/xhtml">The larger “Executable</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.968.1" xmlns="http://www.w3.org/1999/xhtml">{</span></span><span class="koboSpan" id="kobo.969.1" xmlns="http://www.w3.org/1999/xhtml">Books</span><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.970.1" xmlns="http://www.w3.org/1999/xhtml">}</span></span><span class="koboSpan" id="kobo.971.1" xmlns="http://www.w3.org/1999/xhtml">” project ( </span><a class="url" href="https://executablebooks.org/en/latest/tools.html"><span class="koboSpan" id="kobo.972.1" xmlns="http://www.w3.org/1999/xhtml">https://executablebooks.org/en/latest/tools.html</span></a><span class="koboSpan" id="kobo.973.1" xmlns="http://www.w3.org/1999/xhtml">) describes the collection of Python-related tools, including Myst-NB, Sphinx, and some related Sphinx themes. </span><span class="koboSpan" id="kobo.973.2" xmlns="http://www.w3.org/1999/xhtml">The essential ingredient is using Sphinx to control the final publication.</span></p>
<p><span class="koboSpan" id="kobo.974.1" xmlns="http://www.w3.org/1999/xhtml">For </span><span id="dx1-194002"/><span class="koboSpan" id="kobo.975.1" xmlns="http://www.w3.org/1999/xhtml">Quarto, see </span><a class="url" href="https://quarto.org"><span class="koboSpan" id="kobo.976.1" xmlns="http://www.w3.org/1999/xhtml">https://quarto.org</span></a><span class="koboSpan" id="kobo.977.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.977.2" xmlns="http://www.w3.org/1999/xhtml">This is </span><span id="dx1-194003"/><span class="koboSpan" id="kobo.978.1" xmlns="http://www.w3.org/1999/xhtml">somewhat more tightly integrated: it requires a single download of the Quarto CLI. </span><span class="koboSpan" id="kobo.978.2" xmlns="http://www.w3.org/1999/xhtml">The Quarto tool leverages Pandoc to produce a final, elegant, ready-to-publish file.</span></p>
<p><span class="koboSpan" id="kobo.979.1" xmlns="http://www.w3.org/1999/xhtml">You are encouraged to look at ways to elevate the shared notebook to an elegant report that can be widely shared. </span><span id="x1-194004r177"/></p>
</section>
</section>
</section>
</body>
</html>
