- en: Chapter 13
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第13章
- en: 'Project 4.1: Visual Analysis Techniques'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 项目4.1：可视化分析技术
- en: When doing **exploratory data analysis** (**EDA**), one common practice is to
    use graphical techniques to help understand the nature of data distribution. The
    US **National Institute of Standards and Technology** (**NIST**) has an *Engineering
    Statistics Handbook* that strongly emphasizes the need for graphic techniques.
    See [https://doi.org/10.18434/M32189](https://doi.org/10.18434/M32189).
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行**探索性数据分析**（**EDA**）时，一个常见的做法是使用图形技术来帮助理解数据分布的性质。美国**国家标准与技术研究院**（**NIST**）的*工程统计学手册*强烈强调了图形技术的重要性。参见[https://doi.org/10.18434/M32189](https://doi.org/10.18434/M32189)。
- en: This chapter will create some additional Jupyter notebooks to present a few
    techniques for displaying univariate and multivariate distributions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将创建一些额外的Jupyter笔记本来展示展示单变量和多变量分布的一些技术。
- en: 'In this chapter, we’ll focus on some important skills for creating diagrams
    for the cleaned data:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将关注创建清理数据图表的一些重要技能：
- en: Additional Jupyter Notebook techniques
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 额外的Jupyter Notebook技术
- en: Using **PyPlot** to present data
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**PyPlot**展示数据
- en: Unit testing for Jupyter Notebook functions
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Jupyter Notebook函数的单元测试
- en: This chapter has one project, to build the start of a more complete analysis
    notebook. A notebook can be saved and exported as a PDF file, allowing an analyst
    to share preliminary results for early conversations. In the next chapter, we’ll
    expand on the notebook to create a presentation that can be shared with colleagues.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 本章有一个项目，即构建一个更完整分析笔记本的开始。笔记本可以保存并导出为PDF文件，允许分析师分享初步结果以进行早期对话。在下一章中，我们将扩展笔记本以创建可以与同事分享的演示文稿。
- en: Looking further down the road, a notebook can help to identify important aspects
    of the data that need ongoing monitoring. The computations created here will often
    become the basis for more fully automated reporting tools and notifications. This
    analysis activity is an important step toward understanding the data and designing
    a model for the data.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 看得更远一些，笔记本可以帮助识别需要持续监控的数据的重要方面。这里创建的计算通常将成为更全面自动化报告工具和通知的基础。这种分析活动是理解数据并设计数据模型的重要步骤。
- en: We’ll start with a description of an analysis notebook.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从分析笔记本的描述开始。
- en: 13.1 Description
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.1 描述
- en: In the previous chapters, the sequence of projects created a pipeline to acquire
    and then clean the raw data. The intent is to build automated data gathering as
    Python applications.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，创建的项目序列建立了一个获取并清理原始数据的管道。目的是构建自动化的数据收集作为Python应用程序。
- en: We noted that ad hoc data inspection is best done with a notebook, not an automated
    CLI tool. Similarly, creating command-line applications for analysis and presentation
    can be challenging. Analytical work seems to be essentially exploratory, making
    it helpful to have immediate feedback from looking at results.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们指出，临时数据检查最好使用笔记本，而不是自动化的CLI工具。同样，为分析和展示创建命令行应用程序可能具有挑战性。分析工作似乎本质上就是探索性的，因此从查看结果中获得即时反馈是有帮助的。
- en: Additionally, analytical work transforms raw data into information, and possibly
    even insight. Analytical results need to be shared to create significant value.
    A Jupyter notebook is an exploratory environment that can create readable, helpful
    presentations.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，分析工作将原始数据转化为信息，甚至可能是洞察。分析结果需要共享以创造显著的价值。Jupyter笔记本是一个探索环境，可以创建可读的、有帮助的演示文稿。
- en: 'One of the first things to do with raw data is to create diagrams to illustrate
    the distribution of univariate data and the relationships among variables in multivariate
    data. We’ll emphasize the following common kinds of diagrams:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 对原始数据进行的第一件事之一是创建图表来展示单变量数据的分布和多变量数据中变量之间的关系。我们将强调以下常见的图表类型：
- en: '**Histograms** A histogram summarizes the distribution of values for a variable
    in a dataset. The histogram will have data values on one axis and frequency on
    the other axis.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**直方图**直方图总结了数据集中一个变量值的分布。直方图将在一个轴上有数据值，在另一个轴上有频率。'
- en: '**Scatter Plots** A scatter plot summarizes the relationships between values
    for two variables in a dataset. The visual clustering can be apparent to the casual
    observer.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**散点图**散点图总结了数据集中两个变量值之间的关系。视觉聚类对普通观察者来说是显而易见的。'
- en: For small datasets, each relationship in a scatter plot can be a single dot.
    For larger datasets, where a number of points have similar relationships, it can
    be helpful to create “bins” that reflect how many points have the same relationship.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 对于小数据集，散点图中的每个关系都可以用一个单独的点来表示。对于包含许多点且具有相似关系的较大数据集，创建“桶”来反映具有相同关系的点的数量可能是有帮助的。
- en: There are a number of ways of showing the size of these bins. This includes
    using a color code for more popular combinations. For some datasets, the size
    of an enclosing circle can show the relative concentration of similarly-valued
    data. The reader is encouraged to look at alternatives to help emphasize the interesting
    relationships among the attributes of the various samples.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法可以显示这些桶的大小。这包括使用颜色代码来表示更流行的组合。对于某些数据集，包围圆的大小可以显示类似值数据的相对浓度。鼓励读者查看替代方案，以帮助强调各种样本属性之间的有趣关系。
- en: The use of **Seaborn** to provide colorful styles is also important when working
    with diagrams. You are encouraged to explore various color palettes to help emphasize
    interesting data.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理图表时，使用**Seaborn**提供彩色样式也很重要。鼓励您探索各种调色板，以帮助强调有趣的数据。
- en: 13.2 Overall approach
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.2 总体方法
- en: 'We’ll take some guidance from the C4 model ( [https://c4model.com](https://c4model.com))
    when looking at our approach:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在审视我们的方法时，我们将借鉴C4模型（[https://c4model.com](https://c4model.com)）的一些指导原则：
- en: '**Context**: For this project, the context diagram has two use cases: the acquire-to-clean
    process and this analysis notebook.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**上下文**：对于这个项目，上下文图有两个用例：获取-清理过程和这个分析笔记本。'
- en: '**Containers**: There’s one container for analysis application: the user’s
    personal computer.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**容器**：有一个用于分析应用的容器：用户的个人电脑。'
- en: '**Components**: The software components include the existing analysis models
    that provide handy definitions for the Python objects.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组件**：软件组件包括现有的分析模型，这些模型为Python对象提供了便捷的定义。'
- en: '**Code**: The code is scattered in two places: supporting modules as well as
    the notebook itself.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**代码**：代码分散在两个地方：支持模块以及笔记本本身。'
- en: A context diagram for this application is shown in [*Figure 13.1*](#13.1).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 本应用的上下文图显示在[*图13.1*](#13.1)中。
- en: '![Figure 13.1: Context diagram ](img/file55.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![图13.1：上下文图](img/file55.jpg)'
- en: 'Figure 13.1: Context diagram'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.1：上下文图
- en: The analyst will often need to share their analytical results with stakeholders.
    An initial notebook might provide confirmation that some data does not conform
    to the null hypothesis, suggesting an interesting relationship that deserves deeper
    exploration. This could be part of justifying a budget allocation to do more analysis
    based on preliminary results. Another possible scenario is sharing a notebook
    to confirm the null hypothesis is likely true, and that the variations in the
    data have a high probability of being some kind of measurement noise. This could
    be used to end one investigation and focus on alternatives.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 分析师通常会需要与利益相关者分享他们的分析结果。一个初步的笔记本可能提供确认，表明某些数据不符合零假设，暗示了一个值得深入探索的有趣关系。这可能是一部分，为基于初步结果进行更多分析的理由分配预算。另一种可能的场景是分享一个笔记本以确认零假设很可能为真，并且数据的变化有很大概率是某种测量噪声。这可以用来结束一项调查并专注于替代方案。
- en: 'In [*Chapter** 6*](ch010.xhtml#x1-1460006), [*Project 2.1: Data Inspection
    Notebook*](ch010.xhtml#x1-1460006), the data inspection notebook was described.
    The use of a single acquisition model module for the data was mentioned, but the
    details of the Python implementation weren’t emphasized. The raw data module often
    provides little useful structure to the data when doing inspections.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在[*第6章*](ch010.xhtml#x1-1460006)、[*项目2.1：数据检查笔记本*](ch010.xhtml#x1-1460006)中，描述了数据检查笔记本。提到了使用单个获取模型模块来处理数据，但Python实现的细节并没有被强调。在检查时，原始数据模块通常不会为数据提供多少有用的结构。
- en: Moving forward into more complicated projects, we’ll see the relationship between
    the notebooks and the modules that define the data model become more important.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在进入更复杂的项目时，我们将看到笔记本与定义数据模型的模块之间的关系变得更加重要。
- en: 'For this analysis notebook, the analysis data model, created in [*Chapter** 9*](ch013.xhtml#x1-2080009),
    [*Project 3.1: Data Cleaning Base Application*](ch013.xhtml#x1-2080009), will
    be a central part of the notebook for doing analysis. This will be imported and
    used in the analysis notebook. The analysis process may lead to changes to the
    analysis model to reflect lessons learned.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: A technical complication arises from the directory structure. The data acquisition
    and cleaning applications are in the `src` directory, where the notebooks are
    kept in a separate `notebooks` directory.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: When working with a notebook in the `notebooks` directory, it is difficult to
    make the Python `import` statement look into the adjacent `src` directory. The
    `import` statement scans a list of directories defined by the `sys.path` value.
    This value is seeded from some defined rules, the current working directory, and
    the value of the `PYTHONPATH` environment variable.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: 'There are two ways to make the `import` statement load modules from the adjacent
    `src` directory:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: Put `../src` into the `PYTHONPATH` environment variable before starting JupyterLab.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Put the absolute path to `../src` into the `sys.path` list after starting JupyterLab.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The two are equivalent. The first can be done by updating one’s `~/.zshrc` file
    to make sure the `PYTHONPATH` environment variable is set each time a terminal
    session starts. There are other files appropriate for other shells; for example,
    `~/.bashrc` or `./rc` for the classic `sh` shell. For Windows, there’s a dialog
    that allows one to edit the system’s environment variables.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: 'The alternative is to update `sys.path` with a cell containing code like the
    following example:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This cell will add the peer `../src` directory to the system path. After this
    is done, the `import` statement will bring in modules from the `../src` directory
    as well as bringing in built-in standard library modules, and modules installed
    with **conda** or **pip**.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: An initialization module can be defined as part of the IPython startup. This
    module can alter the `sys.path` value in a consistent way for a number of related
    notebooks in a project.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: While some developers object to tinkering with `sys.path` in a notebook, it
    has the advantage of being explicit.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: Setting `PYTHONPATH` in one’s `~/.zshrc` file is a very clean and reliable solution.
    It then becomes necessary to put a reminder in a `README` file so that new team
    members can also make this change to their personal home directory.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: When sharing notebooks, it becomes imperative to make sure all stakeholders
    have access to the entire project the notebook depends on. This can lead to a
    need to create a Git repository that contains the notebook being shared along
    with reminders, test cases, and needed modules.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: Once we have the path defined properly, the notebook can share classes and functions
    with the rest of the applications. We’ll move on to looking at one possible organization
    of an analysis notebook.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: 13.2.1 General notebook organization
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2.1 笔记本的一般组织
- en: An analytical notebook is often the primary method for presenting and sharing
    results. It differs from a “lab” notebook. It’s common for lab notebooks to contain
    a number of experiments, some of which are failures, and some of which have more
    useful results. Unlike a lab notebook, an analytical notebook needs to have a
    tidy organization with carefully-written Markdown cells interspersed with data
    processing cells. In effect, an analysis notebook needs to tell a kind of story.
    It needs to expose actors and actions and the consequences of those actions.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 分析笔记本通常是展示和共享结果的主要方法。它与“实验室”笔记本不同。实验室笔记本通常包含许多实验，其中一些是失败的，一些则提供了更有用的结果。与实验室笔记本不同，分析笔记本需要有一个整洁的组织，Markdown单元格与数据处理单元格穿插其中。实际上，分析笔记本需要讲述一种故事。它需要展示角色、行动以及这些行动的后果。
- en: It’s essential that the notebook’s cells execute correctly from beginning to
    end. The author should be able to restart the kernel and run all of the cells
    at any time to redo the computations. While this may be undesirable for a particularly
    long-running computation, it still must be true.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 笔记本中的单元格从开始到结束正确执行是至关重要的。作者应该能够在任何时间重新启动内核并运行所有单元格以重新进行计算。虽然这可能对于特别长时间运行的计算来说可能是不希望的，但这仍然是必须的。
- en: A notebook may have preliminary operations that aren’t relevant to most readers
    of the report. A specific example is setting the `sys.path` to import modules
    from an adjacent `../src` directory. It can be helpful to make use of JupyterLab’s
    ability to collapse a cell as a way to set some of the computation details aside
    to help the reader focus on the key concepts.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 笔记本可能有一些初步操作，这些操作对报告的大多数读者来说并不相关。一个具体的例子是将`sys.path`设置为从相邻的`../src`目录导入模块。利用JupyterLab折叠单元格的能力，将一些计算细节放在一边，以帮助读者关注关键概念，这可能是有帮助的。
- en: It seems sensible to formalize this with Markdown cells to explain the preliminaries.
    The remaining cells in this section can be collapsed visually to minimize distractions.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Markdown单元格来正式化这些初步介绍似乎是合理的。本节剩余的单元格可以视觉上折叠，以最小化干扰。
- en: The preliminaries can include technical and somewhat less technical aspects.
    For example, setting `sys.path` is purely technical, and few stakeholders will
    need to see this. On the other hand, reading the `SeriesSample` objects from an
    ND JSON format file is a preliminary step that’s somewhat more relevant to the
    stakeholder’s problems.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 初步介绍可以包括技术和相对不那么技术性的方面。例如，设置`sys.path`完全是技术性的，而且很少的利益相关者需要看到这一点。另一方面，从ND JSON格式文件中读取`SeriesSample`对象是相对更相关于利益相关者问题的初步步骤。
- en: 'After the preliminaries, the bulk of the notebook can focus on two topics:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在初步介绍之后，笔记本的主要内容可以集中在两个主题上：
- en: Summary statistics
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 概述统计
- en: Visualizations
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可视化
- en: We’ll look at the summary statistics in the next section.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在下一节中查看概述统计。
- en: 13.2.2 Python modules for summarizing
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2.2 用于总结的Python模块
- en: For initial reports, Python’s `statistics` module offers a few handy statistical
    functions. This module offers `mean()`, `median()`, `mode()`, `stdev()`, `variance()`.
    There are numerous other functions here the reader is encouraged to explore.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 对于初步报告，Python的`statistics`模块提供了一些方便的统计函数。此模块提供`mean()`、`median()`、`mode()`、`stdev()`、`variance()`。还有许多其他函数，鼓励读者进行探索。
- en: These functions can be evaluated in a cell, and the results will be displayed
    below the cell. In many cases, this is all that’s required.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 这些函数可以在单元格中评估，结果将显示在单元格下方。在许多情况下，这已经足够了。
- en: 'In a few cases, though, results need to be truncated to remove meaningless
    trailing digits. In other cases, it can help to use an f-string to provide a label
    for a result. A cell might look like the following:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在少数情况下，需要截断结果以删除无意义的尾随数字。在其他情况下，使用f-string为结果提供标签可能会有所帮助。一个单元格可能看起来像以下这样：
- en: '[PRE1]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This provides a label, and truncates the output to two places to the right of
    the decimal point.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这提供了一个标签，并将输出截断到小数点后两位。
- en: In some cases, we might want to incorporate computed values into markdown cells.
    The **Python Markdown** extension provides a tidy way to incorporate computed
    values into markdown content.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，我们可能希望将计算值纳入Markdown单元格中。**Python Markdown**扩展提供了一种整洁的方式来将计算值纳入Markdown内容。
- en: See [https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/nbextensions/python-markdown/readme.html](https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/nbextensions/python-markdown/readme.html).
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 [https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/nbextensions/python-markdown/readme.html](https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/nbextensions/python-markdown/readme.html)。
- en: The most important part of the notebook is the graphic visualization of the
    data, we’ll turn to that in the next section.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 笔记本中最重要的一部分是数据的图形可视化，我们将在下一节中转向这一点。
- en: 13.2.3 PyPlot graphics
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2.3 PyPlot 图形
- en: The **matplotlib** package works well for creating images and diagrams. Within
    this extensive, sophisticated graphic library is a smaller library, `pyplot`,
    that’s narrowly focused on data visualizations. Using the `pyplot` library permits
    a few lines of code to create a useful display of data.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**matplotlib** 包非常适合创建图像和图表。在这个广泛而复杂的图形库中，有一个较小的库，`pyplot`，它专注于数据可视化。使用 `pyplot`
    库允许用几行代码创建一个有用的数据显示。'
- en: 'The module is often renamed to make it easier to type. The common convention
    is shown in the following line of code:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块通常会被重命名以使其更容易输入。以下代码行显示了常见的约定：
- en: '[PRE2]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This lets us use `plt` as a namespace to refer to functions defined in the `pyplot`
    module of the `matplotlib` package.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这使我们能够使用 `plt` 作为命名空间来引用 `matplotlib` 包中 `pyplot` 模块定义的函数。
- en: 'In some cases, JupyterLab may not have the `matplotlib` library prepared for
    interactive use. (This will be clear when the plotted images are not shown in
    the notebook.) In these cases, the interactive use of the `matplotlib` library
    needs to be enabled. Use the following magic commands in a cell of the notebook
    to enable interactive use:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，JupyterLab 可能没有为交互式使用准备 `matplotlib` 库。（当绘制的图像不在笔记本中显示时，这将是明显的。）在这些情况下，需要启用
    `matplotlib` 库的交互式使用。在笔记本的一个单元格中使用以下魔法命令来启用交互式使用：
- en: '[PRE3]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The first command enables the `matplotlib` library to create graphics immediately
    in the notebook. It won’t create separate files or pop-up windows. The second
    command produces readily-shared PNG output files. It also helps **MAC OS X** users
    to optimize the graphics for their high-resolution displays.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个命令使 `matplotlib` 库能够在笔记本中立即创建图形。它不会创建单独的文件或弹出窗口。第二个命令生成易于共享的 PNG 输出文件。它还帮助
    **MAC OS X** 用户优化其高分辨率显示的图形。
- en: This isn’t always required. It’s needed only for those installations that didn’t
    configure the `matplotlib` library for interactive use in a Jupyter notebook.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 这并不总是必需的。它仅适用于那些未在 Jupyter 笔记本中为交互式使用配置 `matplotlib` 库的安装。
- en: In many cases, the `pyplot` library expects simple sequences of values for the
    various plotting functions. The *x* and *y* values of a scatter plot, for example,
    are expected to be two parallel lists of the same length. This will lead to a
    few extra cells to restructure data.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，`pyplot` 库期望为各种绘图函数提供简单的值序列。例如，散点图的 *x* 和 *y* 值预期是相同长度的两个平行列表。这将导致需要一些额外的单元格来重新组织数据。
- en: The data cleaning applications from previous chapters produced a single sequence
    of compound sample objects. Each object was a separate sample, with the related
    values for all of the variables. We’ll need to convert from this sample record
    organization to parallel sequences of values for the individual variables.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 前几章中的数据清洗应用产生了一系列的复合样本对象。每个对象都是一个单独的样本，包含所有变量的相关值。我们需要将这种样本记录组织转换为单个变量的并行值序列。
- en: 'This can involve something like the following:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能包括以下内容：
- en: '[PRE4]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'An alternative is to use the `operator.attrgetter()` function. It looks like
    the following:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选择是使用 `operator.attrgetter()` 函数。它看起来如下：
- en: '[PRE5]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We’ll start with a histogram to show the distribution of values for a single
    variable.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从直方图开始，以展示单个变量的值分布。
- en: Data frequency histograms
  id: totrans-83
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 数据频率直方图
- en: Often, a document — like a book — has individual figures. A figure may contain
    a single plot. Or, it may contain a number of “subplots” within a single figure.
    The `pyplot` library provides support for creating a single figure that contains
    many subplots. The idea of a figure with a single plot can be seen as a special
    case of this generalized approach.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，一个文档——比如一本书——有单独的图形。一个图形可能包含一个单一的图表。或者，它可能在一个图形中包含多个“子图”。`pyplot` 库提供了创建包含多个子图的单一图形的支持。一个包含单个图表的图形可以被视为这种通用方法的一个特例。
- en: 'A figure with a single plot can be prepared with a statement like the following:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用如下语句准备包含单个图表的图形：
- en: '[PRE6]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The `fig` object is the figure as a whole. The `ax` object is the set of axes
    for the subplot within the figure. While the explicit `ax` object can seem unnecessary,
    it’s part of a more general approach that allows figures with related plots to
    be built.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: 'The more general case stacks multiple subplots within a figure. The `sublots()`
    function can return axes for each subplot. The call to create a two-plot figure
    might look like this:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Here we’ve stated we’ll have 1 row with 2 subplots stacked next to each other.
    The `fig` object is the figure as a whole. The `ax_0` and `ax_1` objects are the
    sets of axes for each of these two subplots within the figure.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s an example of creating a single histogram from the `y` values of one
    of the four Anscombe’s quartet series:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: For this example, the `y` variable must be a list of *y* attribute values from
    Series I. The series data must be read from the cleaned source file.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: The `_`` =`` ax.hist(...)` statement assigns the results of the `hist()` function
    to the variable `_` as a way to suppress displaying the result value in this cell.
    Without this assignment statement, the notebook will show the result of the `hist()`
    function, which isn’t very interesting and clutters up the output. Since each
    series has both an *x* and a *y* value, it helps to stack two histograms that
    shows the distribution of these values. The reader is encouraged to develop a
    figure with two stacked subplots.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: The number of options for color and borders on the histogram bars are breathtaking
    in their complexity. It helps to try several variants in a single notebook and
    then delete the ones that aren’t helpful.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: The comparison between values is often shown in a scatter plot that shows each
    (*x,y*) pair. We’ll look at this next.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: X-Y scatter plot
  id: totrans-97
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'A scatter plot is one of many ways to show the relationship between two variables.
    Here’s an example of creating a single plot from the `x` and `y` values of one
    of the four Anscombe’s quartet series:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The `_`` =`` ax.scatter(...)` statement assigns the results of the `scatter()`
    function to the variable `_` as a way to suppress displaying the value. This keeps
    the output focused on the figure.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: 'The above example presumes the data have been extracted from a sequence of
    `SeriesSample` instances using code like the following:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: This, in turn, presumes the value for `series_1` was read from the clean data
    created by the **acquire** and **clean** applications.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have an approach to building the notebook, we can address the way
    notebooks tend to evolve.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: 13.2.4 Iteration and evolution
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A notebook is often built iteratively. Cells are added, removed, and modified
    as the data is understood.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: On a purely technical level, the Python programming in the cells needs to evolve
    from a good idea to software that’s testable. It’s often easiest to do this by
    rewriting selected cells into functions. For example, define a function to acquire
    the ND JSON data. This can be supplemented by `doctest` comments to confirm the
    function works as expected.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在纯技术层面上，单元格中的Python编程需要从好想法发展到可测试的软件。通常，通过将选定的单元格重写为函数来做这件事是最容易的。例如，定义一个函数来获取ND
    JSON数据。这可以通过`doctest`注释来补充，以确认函数按预期工作。
- en: A collection of functions can be refactored into a separate, testable module
    if needed. This can permit wider reuse of good ideas in multiple notebooks.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，可以将函数集合重构为单独的可测试模块。这可以允许在多个笔记本中更广泛地重用好的想法。
- en: Equally important is to avoid “over-engineering” a notebook. It’s rarely worth
    the time and effort to carefully specify the contents of a notebook, and then
    write code that meets those specifications. It’s far easier to create — and refine
    — the notebook.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 同样重要的是避免过度设计笔记本。仔细指定笔记本的内容并编写满足这些规范的代码通常不值得花费时间和精力。创建和改进笔记本要容易得多。
- en: In some large organizations, a senior analyst may direct the efforts of junior
    analysts. In this kind of enterprise, it can be helpful to provide guidance to
    junior analysts. When formal methods are needed, the design guidance can take
    the form of a notebook with markdown cells to explain the desired goal.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在一些大型组织中，高级分析师可能会指导初级分析师的工作。在这种企业中，为初级分析师提供指导可能是有帮助的。当需要正式方法时，设计指导可以采取带有Markdown单元格的笔记本形式来解释期望的目标。
- en: Now that we have an approach to building the notebook, we can enumerate the
    deliverables for this project.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了构建笔记本的方法，我们可以列出这个项目的可交付成果。
- en: 13.3 Deliverables
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.3 可交付成果
- en: 'This project has the following deliverables:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目有以下可交付成果：
- en: A `requirements-dev.txt` file that identifies the tools used, usually `jupyterlab==3.5.3`
    and `matplotlib==3.7.0`.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个`requirements-dev.txt`文件，用于标识使用的工具，通常是`jupyterlab==3.5.3`和`matplotlib==3.7.0`。
- en: Documentation in the `docs` folder.
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docs`文件夹中的文档。'
- en: Unit tests for any new application modules in the `tests` folder.
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tests`文件夹中任何新的应用模块的单元测试。'
- en: Any new application modules in the `src` folder with code to be used by the
    inspection notebook.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`src`文件夹中任何新的应用模块，其中包含用于检查笔记本的代码。'
- en: A notebook to summarize the clean data. In the case of Anscombe’s quartet, it’s
    essential to show the means and variances are nearly identical, but the scatter
    plots are dramatically different.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个用于总结清洁数据的笔记本。在Anscombe的四重奏的情况下，显示均值和方差几乎相同，但散点图却截然不同。
- en: We’ll look at a few of these deliverables in a little more detail.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将更详细地查看一些这些可交付成果。
- en: 13.3.1 Unit test
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.3.1 单元测试
- en: 'There are two distinct kinds of modules that can require testing:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种不同的模块可能需要测试：
- en: The notebook with any function or class definitions. All of these definitions
    require unit tests.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含任何函数或类定义的笔记本。所有这些定义都需要单元测试。
- en: If functions are factored from the notebook into a supporting module, this module
    will need unit tests. Many previous projects have emphasized these tests.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果函数从笔记本分解到支持模块中，这个模块将需要单元测试。许多先前项目都强调了这些测试。
- en: A notebook cell with a computation cell is notoriously difficult to test. The
    visual output from the `hist()` or `scatter()` functions seems almost impossible
    to test in a meaningful way.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 带有计算单元的笔记本单元难以测试。`hist()`或`scatter()`函数的视觉输出似乎几乎无法以有意义的方式进行测试。
- en: 'In addition, there are numerous usability tests that can’t be automated. Poor
    choice of colors, for example, can obscure an important relationship. Consider
    the following questions:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有许多无法自动化的可用性测试。例如，颜色选择不当可能会掩盖一个重要的关系。考虑以下问题：
- en: Is it informative?
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它是否具有信息性？
- en: Is it relevant?
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它是否相关？
- en: Is it misleading in any way?
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是否有任何误导之处？
- en: In many cases, these questions are difficult to quantify and difficult to test.
    As a consequence, it’s best to focus automated testing on the Python programming.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，这些问题难以量化且难以测试。因此，最好将自动化测试集中在Python编程上。
- en: It’s imperative to avoid testing the internals of `matplotlib.pyplot`.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 避免测试`matplotlib.pyplot`的内部结构是强制性的。
- en: What’s left to test?
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 还剩下什么要测试的？
- en: The data loading.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据加载。
- en: Any ad hoc transformations that are part of the notebook.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 笔记本中作为一部分的任何临时变换。
- en: The data loading should be reduced to a single function that creates a sequence
    of `SeriesSample` instances from the lines in an ND JSON file of clean data. This
    loading function can include a test case.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: 'We might define the function as follows:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This permits testing by adding a cell to the notebook that includes the following:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This cell will find the functions defined by the notebook, extract any doctest
    cases from the docstrings in the function definitions, and confirm the doctest
    cases pass.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: For more complicated numerical processing, the **hypothesis** library is helpful.
    See [*Hypothesis testing*](ch014.xhtml#x1-2600001) in [*Chapter** 10*](ch014.xhtml#x1-22900010),
    [*Data Cleaning Features*](ch014.xhtml#x1-22900010) for more information.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: 13.3.2 Acceptance test
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: An automated acceptance test is difficult to define for a notebook. It’s hard
    to specify ways in which a notebook is helpful, meaningful, or insightful in the
    simple language of Gherkin scenarios.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: The `jupyter`` execute`` <filename>` command will execute an `.ipynb` notebook
    file. This execution is entirely automated, allowing a kind of sanity check to
    be sure the notebook runs to completion. If there is a problem, the command will
    exit with a return code of 1, and the cell with the error will be displayed in
    detail. This can be handy for confirming the notebook isn’t trivially broken.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: The `.ipynb` file is a JSON document. An application (or a step definition for
    **Behave**) can read the file to confirm some of its properties. An acceptance
    test case might look for error messages, for example, to see if the notebook failed
    to work properly.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: Cells with `"type":`` "code"` will also have `"outputs"`. If one of the outputs
    has `"output_type":`` "error"`; this cell indicates a problem in the notebook.
    The notebook did not run to completion, and the acceptance test should be counted
    as a failure.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: We can use projects like **Papermill** to automate notebook refresh with new
    data. This project can execute a template notebook and save the results as a finalized
    output notebook with values available and computations performed.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: For more information, see [https://papermill.readthedocs.io](https://papermill.readthedocs.io).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: 13.4 Summary
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This project begins the deeper analysis work on clean data. It emphasizes several
    key skills, including:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: More advanced Jupyter Notebook techniques. This includes setting the `PYTHONPATH`
    to import modules and creating figures with plots to visualize data.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Using **PyPlot** to present data. The project uses popular types of visualizations:
    histograms and scatter plots.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unit testing for Jupyter Notebook functions.
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the next chapter, we’ll formalize the notebook into a presentation “slide
    deck” that can be shown to a group of stakeholders.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: 13.5 Extras
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Here are some ideas for the reader to add to these projects.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: 13.5.1 Use Seaborn for plotting
  id: totrans-156
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: An alternative to the **pyplot** package is the **Seaborn** package. This package
    also provides statistical plotting functions. It provides a wider variety of styling
    options, permitting more colorful (and perhaps more informative) plots.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: See [https://seaborn.pydata.org](https://seaborn.pydata.org) for more information.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: This module is based on `matplotlib`, making it compatible with JupyterLab.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: Note that the **Seaborn** package can work directly with a list-of-dictionary
    structure. This matches the ND JSON format used for acquiring and cleaning the
    data.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: Using a list-of-dictionary type suggests it might be better to avoid the analysis
    model structure, and stick with dictionaries created by the **clean** application.
    Doing this might sacrifice some model-specific processing and validation functionality.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, the `pydantic` package offers a built-in `dict()` method
    that covers a sophisticated analysis model object into a single dictionary, amenable
    to use with the **Seaborn** package. This seems to be an excellent way to combine
    these packages. We encourage the reader to explore this technology stack.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: 13.5.2 Adjust color palettes to emphasize key points about the data
  id: totrans-163
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Both the **pyplot** package and the **Seaborn** package have extensive capabilities
    for applying color to the plot. A choice of colors can sometimes help make a distinction
    visible, or it can obscure important details.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: You can consider alternative styles to see which seems more useful.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: In some enterprise contexts, there are enterprise communications standards,
    with colors and fonts that are widely used. An important technique when using
    Seaborn is to create a style that matches enterprise communication standards.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: A number of websites provide website color schemes and design help. Sites like
    [https://paletton.com](https://paletton.com) or [colordesigner.io](https://colordesigner.io)
    provide complementary color palettes. With some effort, we can take these kinds
    of designs for color palettes and create Seaborn styles that permit a consistent
    and unique presentation style.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
