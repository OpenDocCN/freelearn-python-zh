<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Interacting with Social Media Using Requests</h1></div></div></div><p>In this contemporary world, our lives are woven with a lot of interactions and collaborations with social media. The information that is available on the web is very valuable and it is being used by abundant resources. For instance, the news that is trending in the world can be spotted easily from a Twitter hashtag and this can be achieved by interacting with the Twitter API.</p><p>Using natural language processing, we can classify emotion of a person by grabbing the Facebook status of an account. All this stuff can be accomplished easily with the help of Requests using the concerned APIs. Requests is a perfect module, if we want to reach out API frequently, as it supports pretty much everything, like caching, redirection, proxies, and so on.</p><p>We will cover the following topics in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Interacting with Twitter</li><li class="listitem" style="list-style-type: disc">Interacting with Facebook</li><li class="listitem" style="list-style-type: disc">Interacting with reddit</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec45"/>API introduction</h1></div></div></div><p>Before diving into details, let <a class="indexterm" id="id145"/>us have a quick look at what exactly is an <strong>Application Programming Interface</strong> (<strong>API</strong>).</p><p>A web API is a set of <a class="indexterm" id="id146"/>rules and specifications. It assists us to communicate with different software. There are different types of APIs, and <a class="indexterm" id="id147"/>REST API is the subject matter here. <strong>REpresentational State Transfer</strong> (<strong>REST</strong>) is an architecture containing guidelines for building scalable web services. An API which adheres to the guidelines and conforms to the <a class="indexterm" id="id148"/>constraints of REST is called a <strong>RESTful</strong> <strong>API</strong>. In a nutshell, the constraints are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Client-server</li><li class="listitem" style="list-style-type: disc">Stateless</li><li class="listitem" style="list-style-type: disc">Cacheable</li><li class="listitem" style="list-style-type: disc">Layered system</li><li class="listitem" style="list-style-type: disc">Uniform interface</li><li class="listitem" style="list-style-type: disc">Code on demand</li></ul></div><p>Google Maps API, Twitter API, and GitHub API are various examples RESTful APIs.</p><p>Let us understand much more about an API. Take an instance of getting all tweets from Twitter with the hashtag "worldtoday" which includes the process of authenticating, sending requests and receiving <a class="indexterm" id="id149"/>responses from different URLs, and dealing with different methods. All the said processes and the procedures will be specified in the API of Twitter. By following these procedures, we can collaborate with the web smoothly.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec23"/>Getting started with the Twitter API</h2></div></div></div><p>To get started with <a class="indexterm" id="id150"/>Twitter API we should first obtain an API key. It is a code which is passed by the computer programs while calling an API. The basic purpose of the API key is that it uniquely identifies the program that it is trying to interact with. It also serves us in the process of authentication with its token.</p><p>The next step involves the process of creating an authentication request which will give us access to the Twitter account. Once we have authenticated successfully, we will be free to deal with tweets, followers, trends, searches, and stuff. Let us get to know more about the steps to follow.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>Please note that, we will be using the Twitter API 1.1 version in all the examples.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec24"/>Obtaining an API Key</h2></div></div></div><p>Getting an API key is <a class="indexterm" id="id151"/>pretty simple. You need to follow the steps <a class="indexterm" id="id152"/>prescribed in the following section:</p><div><ol class="orderedlist arabic"><li class="listitem">At first, you need to sign into the page <a class="ulink" href="https://apps.twitter.com/">https://apps.twitter.com/</a> with your your Twitter credentials.</li><li class="listitem">Click on <strong>Create New App</strong> button.</li><li class="listitem">Now, you need to fill the following fields to set up a new application:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Name</strong>: Specify your application name. This is used to attribute the source of a tweet and in user-facing authorization screens.</li><li class="listitem" style="list-style-type: disc"><strong>Description</strong>: Enter a short description of your application. This will be shown when a user faces the authorization screens.</li><li class="listitem" style="list-style-type: disc"><strong>Website</strong>: Specify your fully qualified website URL. A fully qualified URL includes http:// or https:// and will not have a trailing slash in the end (for example: <code class="literal">http://example.com</code> or <code class="literal">http://www.example.com</code>).</li><li class="listitem" style="list-style-type: disc"><strong>Callback URL</strong>: This field answers the question—where should we return after successfully authenticating.</li><li class="listitem" style="list-style-type: disc"><strong>Developer Agreement</strong>: Read the <strong>Developer Agreement</strong> carefully and then check the checkbox <strong>Yes, I agree</strong>.</li></ul></div></li><li class="listitem">Now, by clicking on <a class="indexterm" id="id153"/><strong>Create your Twitter application,</strong> a new application will be created for us with the previously specified details.</li><li class="listitem">After the successful creation, we'll be redirected to a page where the <strong>Details</strong> tab is selected by default. Now, select the <strong>Keys and Access Tokens</strong> tab. We should click on <strong>Create my access token</strong> button to generate our access token.</li><li class="listitem">Lastly, make a note of the <strong>Consumer Key (API Key)</strong>, <strong>Consumer Secret (API Secret)</strong>, <strong>Access Token</strong> and <strong>Access Token Secret</strong>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec25"/>Creating an authentication Request</h2></div></div></div><p>If we remember <a class="indexterm" id="id154"/>the theme of the third chapter, we learned different kinds of authentication with <code class="literal">requests</code>, such as Basic authentication, Digest authentication, and OAuth authentication. Time to apply all that stuff in real time!</p><p>Now, we will be using OAuth1 authentication to get the access to the Twitter API. In the first step of obtaining a key, we got access to Consumer key, Consumer secret, Access token and Access token secret, now we should use them to authenticate our application. The following commands show how we can accomplish the process:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; import requests</strong>
<strong>&gt;&gt;&gt; from requests_oauthlib import OAuth1</strong>
<strong>&gt;&gt;&gt; CONSUMER_KEY = 'YOUR_APP_CONSUMER_KEY'</strong>
<strong>&gt;&gt;&gt; CONSUMER_SECRET = 'YOUR_APP_CONSUMER_SECRET'</strong>
<strong>&gt;&gt;&gt; ACCESS_TOKEN = 'YOUR_APP_ACCESS_TOKEN'</strong>
<strong>&gt;&gt;&gt; ACCESS_TOKEN_SECRET = 'YOUR_APP_ACCESS_TOKEN_SECRET'</strong>

<strong>&gt;&gt;&gt; auth = OAuth1(CONSUMER_KEY, CONSUMER_SECRET,</strong>
<strong>...               ACCESS_TOKEN, ACCESS_TOKEN_SECRET)</strong>
</pre></div><p>In the preceding lines, we have sent our keys and tokens to the API and got ourselves authenticated and stored them in the variable <code class="literal">auth</code>. Now, we can do all sorts of interactions with the API <a class="indexterm" id="id155"/>using this. Let us start to interact with the Twitter API.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>Keep in mind that, all the twitter interacting examples that are depicted after this will be using the "auth" value obtained in the previous section.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec26"/>Getting your favorite tweet</h2></div></div></div><p>Let us grab some <a class="indexterm" id="id156"/>favorite tweets of the authenticated user first. For this, we should send a request to the Twitter API to access the favorite tweets. The request can be sent with a <code class="literal">Resource URL</code> by specifying the parameters. The <code class="literal">Resource URL</code> for getting the favorite list looks like this:</p><p>
<code class="literal">https://api.twitter.com/1.1/favorites/list.json</code>
</p><p>We can also send some optional parameters to the URL like <code class="literal">user_id</code>, <code class="literal">screen_name</code>, <code class="literal">count</code>, <code class="literal">since_id</code>, <code class="literal">max_id</code>, <code class="literal">include_identities</code> to accomplish our needs. Let us get one favorite tweet now.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; favorite_tweet = requests.get('https://api.twitter.com/1.1/favorites/list.json?count=1', auth=auth)</strong>
<strong>&gt;&gt;&gt; favorite_tweet.json()</strong>
<strong>[{u'contributors': None, u'truncated': False, u'text': u'India has spent $74 mil to reach Mars. Less than the budget of the film \u201cGravity,\u201d $100 million.\n\n#respect\n#ISRO\n#Mangalyaan', u'in_reply_to_status_id': None, …}]</strong>
</pre></div><p>In the first step, we sent a <code class="literal">get</code> request with the parameter <code class="literal">count</code> and the authentication <code class="literal">auth</code> to the resource URL. In the next step, we accessed the response within the JSON format which gave us my favorite tweet, and it is that simple.</p><p>As we have specified the count parameter as <code class="literal">1</code> in the request, we happened to see the result with one favorite tweet. By default, if we don't specify the optional parameter <code class="literal">count,</code> the request will result in <code class="literal">20</code> most recent favorite tweets.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec27"/>Performing a simple search</h2></div></div></div><p>We shall make a <a class="indexterm" id="id157"/>search with a Twitter's API now. For this, we will be making use of <code class="literal">Search API</code> of Twitter. The basic URL structure for searching has the following syntax:</p><p>
<code class="literal">https://api.twitter.com/1.1/search/tweets.json?q=%40twitterapi</code>
</p><p>It has got additional parameters like <code class="literal">Result type</code>, <code class="literal">Geolocation</code>, <code class="literal">language</code>, <code class="literal">Iterating in a result set</code>.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; search_results = requests.get('https://api.twitter.com/1.1/search/tweets.json?q=%40python', auth=auth)</strong>
<strong>&gt;&gt;&gt; search_results.json().keys()</strong>
<strong>[u'search_metadata', u'statuses']</strong>
<strong>&gt;&gt;&gt; search_results.json()["search_metadata"]</strong>
<strong>{u'count': 15, u'completed_in': 0.022, u'max_id_str': u'529975076746043392', u'since_id_str': u'0', u'next_results': u'?max_id=527378999857532927&amp;q=%40python&amp;include_entities=1', u'refresh_url': u'?since_id=529975076746043392&amp;q=%40python&amp;include_entities=1', u'since_id': 0, u'query': u'%40python', u'max_id': 529975076746043392}</strong>
</pre></div><p>In the preceding <a class="indexterm" id="id158"/>example, we tried to search for tweets with the words <code class="literal">python</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec28"/>Accessing the list of followers</h2></div></div></div><p>Let us access the followers of a specified user. By default, when we query for the list of followers, it returns the <code class="literal">20</code> <a class="indexterm" id="id159"/>most recent following users. The resource URL looks like this:</p><p>
<code class="literal">https://api.twitter.com/1.1/followers/list.json</code>
</p><p>It returns a cursored collection of user objects for users following the specified user:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; followers = requests.get('https://api.twitter.com/1.1/followers/list.json', auth=auth)</strong>
<strong>&gt;&gt;&gt; followers.json().keys()</strong>
<strong>[u'previous_cursor', u'previous_cursor_str', u'next_cursor', u'users', u'next_cursor_str']</strong>
<strong>&gt;&gt;&gt; followers.json()["users"]</strong>
<strong>[{u'follow_request_sent': False, u'profile_use_background_image': True, u'profile_text_color': u'333333'... }]</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec29"/>Retweets</h2></div></div></div><p>A tweet which has been <a class="indexterm" id="id160"/>reposted is called a <strong>retweet</strong>. To access the most recent <a class="indexterm" id="id161"/>retweets that have been authored by the authenticated user, we will be using the following URL:</p><p>
<code class="literal">https://api.twitter.com/1.1/statuses/retweets_of_me.json</code>
</p><p>The optional parameters that can be sent with it are <code class="literal">count</code>, <code class="literal">since_id</code>, <code class="literal">max_id</code>, <code class="literal">trim_user</code>, <code class="literal">include_entites</code>, <code class="literal">include_user_entities</code>
</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; retweets = requests.get('https://api.twitter.com/1.1/statuses/retweets_of_me.json', auth=auth)</strong>
<strong>&gt;&gt;&gt; len(retweets.json())</strong>
<strong>16</strong>
<strong>&gt;&gt;&gt; retweets.json()[0]</strong>
<strong>{u'contributors': None, u'text': u'I\u2019m now available to take on new #python #django #freelance projects. Reply for more details!', {u'screen_name': u'vabasu', ...}}</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec30"/>Accessing available trends</h2></div></div></div><p>Twitter trends are <a class="indexterm" id="id162"/>hashtag-driven subject matter that is popular at a specific time. Take an instance of getting a location of the available trends in Twitter. For that, we will use the following URL:</p><p>
<code class="literal">https://api.twitter.com/1.1/trends/available.json</code>
</p><p>The response of the resource URL is an array of locations in encoded form:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; available_trends = requests.get('https://api.twitter.com/1.1/trends/available.json', auth=auth)</strong>
<strong>&gt;&gt;&gt; len(available_trends.json())</strong>
<strong>467</strong>
<strong>&gt;&gt;&gt; available_trends.json()[10]</strong>
<strong>{u'name': u'Blackpool', u'countryCode': u'GB', u'url': u'http://where.yahooapis.com/v1/place/12903', u'country': u'United Kingdom', u'parentid': 23424975, u'placeType': {u'code': 7, u'name': u'Town'}, u'woeid': 12903}</strong>
</pre></div><p>In the preceding lines of code, we searched for the locations of the <code class="literal">available_trends</code>. Then, we learned that the number of locations having <code class="literal">available_trends</code> is <code class="literal">467</code>. Later, we tried to access the tenth location's <a class="indexterm" id="id163"/>data and it resulted in a response with the location information which is <a class="indexterm" id="id164"/>encoded with <strong>woeid</strong>. This is a unique identifier called <strong>Where on Earth ID</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec31"/>Updating user status</h2></div></div></div><p>To update the <a class="indexterm" id="id165"/>authenticated user's current status, which is also known as tweeting, we follow the following procedure.</p><p>For each update attempt, the update text is compared with the authenticating user's recent tweets. Any attempt that would result in duplication will be blocked, resulting in a <code class="literal">403 error</code>. Therefore, a user cannot submit the same status twice in a row.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; requests.post('https://api.twitter.com/1.1/statuses/update.json?status=This%20is%20a%20Tweet', auth=auth)</strong>
</pre></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Interacting with Facebook</h1></div></div></div><p>The Facebook <a class="indexterm" id="id166"/>API platform helps third-party developers like us to create our own applications and services that access data on Facebook.</p><p>Let us draw the Facebook data using the Facebook API. Facebook provides two types of APIs; that is, Graph API and Ads API. Graph API is a RESTful JSON API with which we can access the different resources from Facebook like statuses, likes, pages, photos, and so on. The Ads API basically deals with managing access to add campaigns, audiences and so on.</p><p>In this chapter, we are going to <a class="indexterm" id="id167"/>use the Facebook Graph API to interact with Facebook. It is named after its manner of representation with nodes and edges. The nodes represent the <em>things</em>, which means a user, a photo, a page; and the edges represent the connection between the things; that is page's photos, photo's comments.</p><div><div><h3 class="title"><a id="note08"/>Note</h3><p>All the examples in this section will be using the Graph API version 2.2</p></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec32"/>Getting started with the Facebook API</h2></div></div></div><p>To get started with the <a class="indexterm" id="id168"/>Facebook API, we need an opaque string called access token which is used by Facebook to identify a user, app, or page. It is followed by the steps of obtaining a key. We will be sending almost all our requests to the API at <code class="literal">graph.facebook.com</code> except the video upload stuff. The procedure to send a request takes place using the unique id of the node in the following way:</p><div><pre class="programlisting">GET graph.facebook.com/{node-id}</pre></div><p>And in the same way, we can POST in the following way:</p><div><pre class="programlisting">POST graph.facebook.com/{node-id}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec33"/>Obtaining a key</h2></div></div></div><p>The tokens of Facebook <a class="indexterm" id="id169"/>API are portable and can be used to make calls from a mobile client, a web browser or from a server.</p><p>There are four <a class="indexterm" id="id170"/>different types of Access tokens:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>User Access Token</strong>: This <a class="indexterm" id="id171"/>is the most commonly used type of access token which needs the authorization of users. This token can be used to access the user information and to post data on the user's timeline.</li><li class="listitem" style="list-style-type: disc"><strong>App Access Token</strong>: This token comes into the picture when dealing at the Application level. This <a class="indexterm" id="id172"/>token doesn't help in getting access to the user's data, but it gives access to read the stream.</li><li class="listitem" style="list-style-type: disc"><strong>Page Access Token</strong>: This <a class="indexterm" id="id173"/>token can used while accessing and managing a Facebook page.</li><li class="listitem" style="list-style-type: disc"><strong>Client Token</strong>: This <a class="indexterm" id="id174"/>token can be embedded in an application to get access to the app-level API's.</li></ul></div><p>In this tutorial, we will be using the App access token which consists of App Id and App Secret to get access to the resources.</p><p>Follow the below steps to <a class="indexterm" id="id175"/>obtain an App access token:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an application using the developer console of Facebook at <a class="ulink" href="https://developers.facebook.com/developer-console/">https://developers.facebook.com/developer-console/</a>. Note that we should login to <a class="ulink" href="http://developers.facebook.com">http://developers.facebook.com</a> so that we can attain the permission to create an application.</li><li class="listitem">Once we are done with the creation of the application, we can get the access to App Id and App Secret on the application page of our <a class="ulink" href="http://developers.facebook.com">http://developers.facebook.com</a> account.</li></ol></div><p>That's all; obtaining a <a class="indexterm" id="id176"/>key is that simple. We don't need to create any authentication request to send messages, as opposed to how it is on Twitter. The App Id and App Secret are enough to give us permission to access the resources.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec34"/>Getting a user profile</h2></div></div></div><p>We can access the <a class="indexterm" id="id177"/>current user profile of the person who is logged into the site, using the API URL <code class="literal">https://graph.facebook.com/me</code> with a GET request. We need to pass the previously obtained access token as a parameter, while we are making any Graph API call using requests.</p><p>Firstly, we need to import the requests module and then we have to store the access token into a variable. The process works in the following way:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; import requests</strong>
<strong>&gt;&gt;&gt; ACCESS_TOKEN = '231288990034554xxxxxxxxxxxxxxx'</strong>
</pre></div><p>In the next step, we should send the required graph API call, in the following way:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; me = requests.get("https://graph.facebook.com/me", params={'access_token': ACCESS_TOKEN})</strong>
</pre></div><p>Now, we have a <code class="literal">requests.Response</code> object called <code class="literal">me</code>. The <code class="literal">me.text</code> returns a JSON response string. To access various elements (example, <code class="literal">id</code>, <code class="literal">name</code>, <code class="literal">last_name</code>, <code class="literal">hometown</code>, <code class="literal">work</code>) of the retrieved user profile, we need to convert the <code class="literal">json</code> <code class="literal">response</code> string into a <code class="literal">json object</code> string. We can achieve this by calling the method <code class="literal">me.json()</code>. The <code class="literal">me.json.keys()</code> results all the keys in the dictionary:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; me.json().keys()</strong>
<strong>[u'website', u'last_name', u'relationship_status', u'locale', u'hometown', u'quotes', u'favorite_teams', u'favorite_athletes', u'timezone', u'education', u'id', u'first_name', u'verified', u'political', u'languages', u'religion', u'location', u'username', u'link', u'name', u'gender', u'work', u'updated_time', u'interested_in']</strong>
</pre></div><p>A user's <code class="literal">id</code> is a unique number which is used to identify the user on Facebook. We can access the current <a class="indexterm" id="id178"/>profile ID from the user profile in the following way. We'll use this ID in the subsequent examples to retrieve the current user's friends, feed and albums.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; me.json()['id']</strong>
<strong>u'10203783798823031'</strong>
<strong>&gt;&gt;&gt; me.json()['name']</strong>
<strong>u'Bala Subrahmanyam Varanasi'</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec35"/>Retrieving a friends list</h2></div></div></div><p>Let us gather the friends <a class="indexterm" id="id179"/>list of a specific user. To achieve this, we should make an API call to <code class="literal">https://graph.facebook.com/&lt;user-id&gt;/friends</code>, and replace the <code class="literal">user-id</code> with the value of user's ID.</p><p>Now, let us obtain the friends list of the user id that we retrieved in the former example:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; friends = requests.get("https://graph.facebook.com/10203783798823031/friends", params={'access_token': ACCESS_TOKEN})</strong>
<strong>&gt;&gt;&gt; friends.json().keys()</strong>
<strong>[u'paging', u'data']</strong>
</pre></div><p>The response for the API call contains a JSON object string. The friend's information is stored in the <code class="literal">data</code> attribute of the <code class="literal">response json</code> object, which is a list of friend objects containing friends' IDs and names as keys.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; len(friends.json()['data'])</strong>
<strong>32</strong>
<strong>&gt;&gt;&gt; friends.json().keys()</strong>
<strong>[u'paging', u'data']</strong>
<strong>&gt;&gt;&gt; friends.json()['data'][0].keys()</strong>
<strong>[u'name', u'id']</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec36"/>Retrieving feed</h2></div></div></div><p>In order to retrieve the <a class="indexterm" id="id180"/>feed of posts which includes status updates and links published by the current user, or by others on the current user's profile, we should use the feed parameter in the request.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; feed = requests.get("https://graph.facebook.com/10203783798823031/feed", params={'access_token': ACCESS_TOKEN})</strong>
<strong>&gt;&gt;&gt; feed.json().keys()</strong>
<strong>[u'paging', u'data']</strong>
<strong>&gt;&gt;&gt; len(feed.json()["data"])</strong>
<strong>24</strong>
<strong>&gt;&gt;&gt; feed.json()["data"][0].keys()</strong>
<strong>[u'from', u'privacy', u'actions', u'updated_time', u'likes', u'created_time', u'type', u'id', u'status_type']</strong>
</pre></div><p>In the preceding <a class="indexterm" id="id181"/>example, we sent a request to get the feeds of a specific user with user ID <code class="literal">10203783798823031</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec37"/>Retrieving albums</h2></div></div></div><p>Let us access the photo <a class="indexterm" id="id182"/>albums created by the current logged-in user. It can be achieved in the following way:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; albums = requests.get("https://graph.facebook.com/10203783798823031/albums", params={'access_token': ACCESS_TOKEN})</strong>
<strong>&gt;&gt;&gt; albums.json().keys()</strong>
<strong>[u'paging', u'data']</strong>
<strong>&gt;&gt;&gt; len(albums.json()["data"])</strong>
<strong>13</strong>
<strong>&gt;&gt;&gt; albums.json()["data"][0].keys()</strong>
<strong>[u'count', u'from', u'name', u'privacy', u'cover_photo', u'updated_time', u'link', u'created_time', u'can_upload', u'type', u'id']</strong>
<strong>&gt;&gt;&gt; albums.json()["data"][0]["name"]</strong>
<strong>u'Timeline Photos'</strong>
</pre></div><p>In the preceding example, we sent a request to graph API to get access to the albums of the user with <code class="literal">user-id</code> <code class="literal">10203783798823031</code>. And then we tried to access the response data through JSON.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Interacting with reddit</h1></div></div></div><p>Reddit is one of the popular <a class="indexterm" id="id183"/>social networking, entertainment and news websites where registered members can submit content, such as text posts or direct links. It allows the registered users to vote the submissions either "up" or "down" to rank the posts on the site's pages. Each content entry is categorized by area of interest called <strong>SUBREDDITS</strong>.</p><p>In this section, we are going to access the reddit API directly, using the Python requests library. We are going to cover the topics of a basic overview of reddit API, getting data related to our own reddit account, and using the search API to retrieve the links.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec38"/>Getting started with the reddit API</h2></div></div></div><p>The reddit API consists of four <a class="indexterm" id="id184"/>important parts that we need to get familiar with before starting to interact with it. The four parts are:</p><div><ol class="orderedlist arabic"><li class="listitem"><strong>listings</strong>: The endpoints <a class="indexterm" id="id185"/>in reddit are called listings. They contain parameters like <code class="literal">after</code>/<code class="literal">before</code>, <code class="literal">limit</code>, <code class="literal">count</code>, <code class="literal">show</code>.</li><li class="listitem"><strong>modhashes</strong>: This is a <a class="indexterm" id="id186"/>token which is used to prevent the <strong>cross site request forgery</strong>(<strong>CSRF</strong>) exploit. We can get the modhash for us by using <code class="literal">GET /api/me.json</code>.</li><li class="listitem"><strong>fullnames</strong>: A fullname <a class="indexterm" id="id187"/>is a combination of a thing's type and its unique ID which forms a compact encoding of a globally unique ID on reddit.</li><li class="listitem"><strong>account</strong>: This deals with <a class="indexterm" id="id188"/>the user's account. Using this we can register, login, set force https, update the account, update email and so on.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec39"/>Registering a new account</h2></div></div></div><p>Registering a new account on reddit is easy. First, we need to reach the reddit site—<a class="ulink" href="https://www.reddit.com/">https://www.reddit.com/</a>, and then have to fill up the registration form which pops up when we click on <strong>sign in or create an account</strong> link in the top right corner. The Registration form includes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>username</strong>: Used to <a class="indexterm" id="id189"/>identify the reddit community member uniquely</li><li class="listitem" style="list-style-type: disc"><strong>email</strong>: An optional  field used to communicate directly with a user</li><li class="listitem" style="list-style-type: disc"><strong>password</strong>: Secure password to login into the reddit platform</li><li class="listitem" style="list-style-type: disc"><strong>verify password</strong>: This field should be the same as the password field</li><li class="listitem" style="list-style-type: disc"><strong>captcha</strong>: This field is used to check whether the user who  is trying to login is a human or a programmable bot</li></ul></div><p>Let us create a new account with a username and a password of our choice. For now, leave the email field empty. We are going to add it in the next section.</p><p>In the following examples, I'm assuming that the username and password we created before are <code class="literal">OUR_USERNAME</code> and <code class="literal">OUR_PASSWORD</code> respectively.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec40"/>Modifying account information</h2></div></div></div><p>Now, let's add an <a class="indexterm" id="id190"/>email to our account's profile which we intentionally left undone while creating the account in the previous section.</p><div><ol class="orderedlist arabic"><li class="listitem">Let us begin the process by creating a session object, which allows us to maintain certain parameters and cookies across all requests.<div><pre class="programlisting"><strong>&gt;&gt;&gt; import requests</strong>
<strong>&gt;&gt;&gt; client = requests.session()</strong>
<strong>&gt;&gt;&gt; client.headers = {'User-Agent': 'Reddit API - update profile'}</strong>
</pre></div></li><li class="listitem">Let us create a <a class="indexterm" id="id191"/><code class="literal">DATA</code> attribute with the <code class="literal">'user'</code>, <code class="literal">'passwd'</code> and <code class="literal">'api type'</code> attributes.<div><pre class="programlisting"><strong>&gt;&gt;&gt; DATA = {'user': 'OUR_USERNAME', 'passwd': 'OUR_PASSWORD', 'api type': 'json'}</strong>
</pre></div></li><li class="listitem">We can access our reddit account by making a <code class="literal">post</code> request call to the URL—<a class="ulink" href="https://ssl.reddit.com/api/login">https://ssl.reddit.com/api/login</a> with the login credentials stored in the <code class="literal">DATA</code> attribute.<div><pre class="programlisting"><strong>&gt;&gt;&gt; response = client.post('https://ssl.reddit.com/api/login', data=DATA)</strong>
</pre></div></li><li class="listitem">The reddit api response to the above post request will be stored in the <code class="literal">response</code> variable. The <code class="literal">response</code> object contains the <code class="literal">data</code> and <code class="literal">errors</code> information as shown in the following example:<div><pre class="programlisting"><strong>&gt;&gt;&gt; print response.json()</strong>
<strong>{u'json': {u'errors': [], u'data': {u'need_https': False, u'modhash': u'v4k68gabo0aba80a7fda463b5a5548120a04ffb43490f54072', u'cookie': u'32381424,2014-11-09T13:53:30,998c473d93cfeb7abcd31ac457c33935a54caaa7'}}}</strong>
</pre></div></li><li class="listitem">We need to send the <code class="literal">modhash</code> value obtained in the previous response to perform an update call to change our <code class="literal">email</code>. Now, let us call the reddit's update API as shown in the following example:<div><pre class="programlisting"><strong>&gt;&gt;&gt; modhash = response.json()['json']['data']['modhash']</strong>
<strong>&gt;&gt;&gt; update_params = {"api_type": "json", "curpass": "OUR_PASSWORD",</strong>
<strong>...                  "dest": "www.reddit.com", "email": "user@example.com",</strong>
<strong>...                  "verpass": "OUR_PASSWORD", "verify": True, 'uh': modhash}</strong>
<strong>&gt;&gt;&gt; r = client.post('http://www.reddit.com/api/update', data=update_params)</strong>
</pre></div></li><li class="listitem">The response to the update call is stored in <code class="literal">r</code>. If there are no errors, then the <code class="literal">status_code</code> will be <code class="literal">200</code> and <code class="literal">errors</code> attributes value will be an empty list as shown in the following example:<div><pre class="programlisting"><strong>&gt;&gt;&gt; print r.status_code</strong>
<strong>200</strong>
<strong>&gt;&gt;&gt; r.text</strong>
<strong>u'{"json": {"errors": []}}'</strong>
</pre></div></li><li class="listitem">Now, let us check whether the <code class="literal">email</code> field is set by getting info about the currently authenticated <a class="indexterm" id="id192"/>user. If the <code class="literal">has_mail</code> attribute is <code class="literal">True</code>, then we can assume that the email is successfully updated.<div><pre class="programlisting"><strong>&gt;&gt;&gt; me = client.get('http://www.reddit.com/api/me.json')</strong>
<strong>&gt;&gt;&gt; me.json()['data']['has_mail']</strong>
<strong>True</strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec41"/>Performing a simple search</h2></div></div></div><p>We can use reddit's search <a class="indexterm" id="id193"/>API to search the entire site or in a subreddit. In this section we'll look at making a search API request. Proceed with the following steps to make a search request.</p><p>To make a search api call, we need to send a get request to <code class="literal">http://www.reddit.com/search.json</code> url with a search query <code class="literal">q</code> in the parameters.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; search = requests.get('http://www.reddit.com/search.json', params={'q': 'python'})</strong>
<strong>&gt;&gt;&gt; search.json().keys()</strong>
<strong>[u'kind', u'data']</strong>
<strong>&gt;&gt;&gt; search.json()['data']['children'][0]['data'].keys()</strong>
<strong>[u'domain', u'author', u'media', u'score', u'approved_by', u'name', u'created', u'url', u'author_flair_text', u'title' ... ]</strong>
</pre></div><p>The response to search is stored in the <code class="literal">search</code> variable which is a <code class="literal">requests.Response</code> object. The search results are stored in the <code class="literal">children</code> attribute of the <code class="literal">data</code> attribute. We can access <code class="literal">title</code>, <code class="literal">author</code>, <code class="literal">score</code> or another item in the search results as shown in the following example:</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; search.json()['data']['children'][0]['data']['title']</strong>
<strong>u'If you could change something in Python what would it be?'</strong>
<strong>&gt;&gt;&gt; search.json()['data']['children'][0]['data']['author']</strong>
<strong>u'yasoob_python'</strong>
<strong>&gt;&gt;&gt; search.json()['data']['children'][0]['data']['score']</strong>
<strong>146</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec42"/>Searching subreddits</h2></div></div></div><p>Searching in reddit's <a class="indexterm" id="id194"/>subreddits by title and description is same as searching in reddit. For that, we need to send a get request to <code class="literal">http://www.reddit.com/search.json</code> URL with a search query <code class="literal">q</code> in the parameters.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; subreddit_search = requests.get('http://www.reddit.com/subreddits/search.json', params={'q': 'python'})</strong>
</pre></div><p>The response to search is stored in the <code class="literal">search</code> variable which is a <code class="literal">requests.Response</code> object. The search results are stored in the <code class="literal">data</code> attribute.</p><div><pre class="programlisting"><strong>&gt;&gt;&gt; subreddit_search.json()['data']['children'][0]['data']['title']</strong>
<strong>u'Python'</strong>
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Summary</h1></div></div></div><p>This chapter serves as a guide to interact with some of the most popular social media with Python using requests. We started by learning about the definition and importance of an API in the real world. Then we interacted with some of the most popular social networking sites like Twitter, Facebook and reddit. Each section about a social network will provide a hands on experience using a limited set of examples.</p><p>In the next chapter, we are going to learn step by step about Web scraping with requests and BeautifulSoup libraries.</p></div></body></html>