<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer351">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">11</span></h1>
<h1 class="chapterTitle" id="_idParaDest-295"><span class="koboSpan" id="kobo.2.1">Adding Internationalization to Your Shop</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, you added a coupon system to your shop and built a product recommendation engine.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will learn how internationalization and localization work. </span><span class="koboSpan" id="kobo.4.2">By making your application accessible in multiple languages, you can serve a wider range of users. </span><span class="koboSpan" id="kobo.4.3">Additionally, by adapting your application to local formatting conventions such as date or number formatting, you improve its usability. </span><span class="koboSpan" id="kobo.4.4">By translating and localizing your application, you will make it more intuitive for users from different cultural backgrounds and increase user engagement.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Preparing your project for internationalization</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Managing translation files</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Translating Python code</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Translating templates</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Using Rosetta to manage translations</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Translating URL patterns and using a language prefix in URLs</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Allowing users to switch language</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Translating models using </span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">django-parler</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1">Using model translations with the ORM</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1">Adapting views to use translations</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.17.1">Using the localized form fields of </span><code class="inlineCode"><span class="koboSpan" id="kobo.18.1">django-localflavor</span></code></li>
</ul>
<h1 class="heading-1" id="_idParaDest-296"><span class="koboSpan" id="kobo.19.1">Functional overview</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.20.1">Figure 11.1</span></em><span class="koboSpan" id="kobo.21.1"> shows a representation of the views, templates, and functionalities that will be built in this chapter:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.22.1"><img alt="" role="presentation" src="../Images/B21088_11_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.23.1">Figure 11.1: Diagram of the functionalities built in Chapter 11</span></p>
<p class="normal"><span class="koboSpan" id="kobo.24.1">In this chapter, you will implement internationalization in your project and translate templates, URLs, and models. </span><span class="koboSpan" id="kobo.24.2">You will add language selection links to the header of your site and create language-specific URLs. </span><span class="koboSpan" id="kobo.24.3">You will modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">product_list</span></code><span class="koboSpan" id="kobo.26.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.27.1">product_detail</span></code><span class="koboSpan" id="kobo.28.1"> views of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.29.1">shop</span></code><span class="koboSpan" id="kobo.30.1"> application to retrieve </span><code class="inlineCode"><span class="koboSpan" id="kobo.31.1">Category</span></code><span class="koboSpan" id="kobo.32.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">Product</span></code><span class="koboSpan" id="kobo.34.1"> objects by their translated slugs. </span><span class="koboSpan" id="kobo.34.2">You will also add a localized postal code field to the form used in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.35.1">order_create</span></code><span class="koboSpan" id="kobo.36.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.37.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter11"><span class="url"><span class="koboSpan" id="kobo.38.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter11</span></span></a><span class="koboSpan" id="kobo.39.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.40.1">All the Python modules used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">requirements.txt</span></code><span class="koboSpan" id="kobo.42.1"> file in the source code that comes with this chapter. </span><span class="koboSpan" id="kobo.42.2">You can follow the instructions to install each Python module below, or you can install all the requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">python -m pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.44.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-297"><span class="koboSpan" id="kobo.45.1">Internationalization with Django</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.46.1">Django offers full internationalization</span><a id="_idIndexMarker973"/><span class="koboSpan" id="kobo.47.1"> and</span><a id="_idIndexMarker974"/><span class="koboSpan" id="kobo.48.1"> localization support. </span><span class="koboSpan" id="kobo.48.2">It allows you to translate your application into multiple languages, and it handles locale-specific formatting for dates, times, numbers, and time zones. </span><span class="koboSpan" id="kobo.48.3">Let’s clarify the difference between internationalization and localization:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.49.1">Internationalization</span></strong><span class="koboSpan" id="kobo.50.1"> (frequently abbreviated to </span><strong class="keyWord"><span class="koboSpan" id="kobo.51.1">i18n</span></strong><span class="koboSpan" id="kobo.52.1">) is the process of adapting software for</span><a id="_idIndexMarker975"/><span class="koboSpan" id="kobo.53.1"> the potential use of different languages and locales so that it isn’t hardwired to a specific language or locale.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.54.1">Localization</span></strong><span class="koboSpan" id="kobo.55.1"> (abbreviated to </span><strong class="keyWord"><span class="koboSpan" id="kobo.56.1">l10n</span></strong><span class="koboSpan" id="kobo.57.1">) is the</span><a id="_idIndexMarker976"/><span class="koboSpan" id="kobo.58.1"> process of actually translating the software and adapting it to a particular locale. </span><span class="koboSpan" id="kobo.58.2">Django itself is translated into more than 50 languages using its internationalization framework.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.59.1">The internationalization framework allows you to easily mark strings for translation, both in Python code and in your templates. </span><span class="koboSpan" id="kobo.59.2">It relies on the GNU </span><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">gettext</span></code><span class="koboSpan" id="kobo.61.1"> toolset to generate and manage message files. </span><span class="koboSpan" id="kobo.61.2">A </span><strong class="keyWord"><span class="koboSpan" id="kobo.62.1">message file</span></strong><span class="koboSpan" id="kobo.63.1"> is</span><a id="_idIndexMarker977"/><span class="koboSpan" id="kobo.64.1"> a plain text file that represents a language. </span><span class="koboSpan" id="kobo.64.2">It contains a part, or all, of the translation strings found in your application and their respective translations for a single language. </span><span class="koboSpan" id="kobo.64.3">Message files have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">.po</span></code><span class="koboSpan" id="kobo.66.1"> extension. </span><span class="koboSpan" id="kobo.66.2">Once the translation is done, message files are compiled to offer rapid access to translated strings. </span><span class="koboSpan" id="kobo.66.3">The compiled translation files have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.67.1">.mo</span></code><span class="koboSpan" id="kobo.68.1"> extension.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.69.1">Let’s review the settings that Django provides for internationalization and localization.</span></p>
<h2 class="heading-2" id="_idParaDest-298"><span class="koboSpan" id="kobo.70.1">Internationalization and localization settings</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.71.1">Django </span><a id="_idIndexMarker978"/><span class="koboSpan" id="kobo.72.1">provides several settings for internationalization. </span><span class="koboSpan" id="kobo.72.2">The following </span><a id="_idIndexMarker979"/><span class="koboSpan" id="kobo.73.1">settings are the most relevant ones:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">USE_I18N</span></code><span class="koboSpan" id="kobo.75.1">: A Boolean that specifies whether Django’s translation system is enabled. </span><span class="koboSpan" id="kobo.75.2">This is </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">True</span></code><span class="koboSpan" id="kobo.77.1"> by default.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">USE_TZ</span></code><span class="koboSpan" id="kobo.79.1">: A Boolean that specifies whether datetimes are time-zone-aware. </span><span class="koboSpan" id="kobo.79.2">When you create a project with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.80.1">startproject</span></code><span class="koboSpan" id="kobo.81.1"> command, this is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.82.1">True</span></code><span class="koboSpan" id="kobo.83.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.85.1">: The default language code for the project. </span><span class="koboSpan" id="kobo.85.2">This is in the standard language ID format, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">en-us</span></code><span class="koboSpan" id="kobo.87.1"> for American English or </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">en-gb</span></code><span class="koboSpan" id="kobo.89.1"> for British English. </span><span class="koboSpan" id="kobo.89.2">This setting requires </span><code class="inlineCode"><span class="koboSpan" id="kobo.90.1">USE_I18N</span></code><span class="koboSpan" id="kobo.91.1"> to be set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">True</span></code><span class="koboSpan" id="kobo.93.1"> in order to take effect. </span><span class="koboSpan" id="kobo.93.2">You can find a list of</span><a id="_idIndexMarker980"/><span class="koboSpan" id="kobo.94.1"> valid language IDs at </span><code class="inlineCode"><span class="koboSpan" id="kobo.95.1">http://www.i18nguy.com/unicode/language-identifiers.html</span></code><span class="koboSpan" id="kobo.96.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.97.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.98.1">: A tuple that contains available languages for the project. </span><span class="koboSpan" id="kobo.98.2">They come in two tuples with a </span><strong class="keyWord"><span class="koboSpan" id="kobo.99.1">language code</span></strong><span class="koboSpan" id="kobo.100.1"> and a </span><strong class="keyWord"><span class="koboSpan" id="kobo.101.1">language name</span></strong><span class="koboSpan" id="kobo.102.1">. </span><span class="koboSpan" id="kobo.102.2">You can see the list of available languages at </span><code class="inlineCode"><span class="koboSpan" id="kobo.103.1">django.conf.global_settings</span></code><span class="koboSpan" id="kobo.104.1">. </span><span class="koboSpan" id="kobo.104.2">When you choose which languages your site will be available in, you set </span><code class="inlineCode"><span class="koboSpan" id="kobo.105.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.106.1"> to a subset of that list.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.107.1">LOCALE_PATHS</span></code><span class="koboSpan" id="kobo.108.1">: A list of directories where Django looks for message files containing translations for the project.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.109.1">TIME_ZONE</span></code><span class="koboSpan" id="kobo.110.1">: A string that represents the time zone for the project. </span><span class="koboSpan" id="kobo.110.2">This is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.111.1">'UTC'</span></code><span class="koboSpan" id="kobo.112.1"> when you create a new project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.113.1">startproject</span></code><span class="koboSpan" id="kobo.114.1"> command. </span><span class="koboSpan" id="kobo.114.2">You can set it to any other time zone, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.115.1">'Europe/Madrid'</span></code><span class="koboSpan" id="kobo.116.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.117.1">These are some of the internationalization and localization settings available. </span><span class="koboSpan" id="kobo.117.2">You can find the full list at </span><a href="https://docs.djangoproject.com/en/5.0/ref/settings/#globalization-i18n-l10n"><span class="url"><span class="koboSpan" id="kobo.118.1">https://docs.djangoproject.com/en/5.0/ref/settings/#globalization-i18n-l10n</span></span></a><span class="koboSpan" id="kobo.119.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.120.1">After reviewing the most important settings for internationalization and localization, let’s learn how we can create translations for our application.</span></p>
<h2 class="heading-2" id="_idParaDest-299"><span class="koboSpan" id="kobo.121.1">Internationalization management commands</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.122.1">Django</span><a id="_idIndexMarker981"/><span class="koboSpan" id="kobo.123.1"> includes the following management commands to manage translations:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.124.1">makemessages</span></code><span class="koboSpan" id="kobo.125.1">: This runs over the source tree to find all the strings marked for translation and creates or updates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.126.1">.po</span></code><span class="koboSpan" id="kobo.127.1"> message files in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.128.1">locale</span></code><span class="koboSpan" id="kobo.129.1"> directory. </span><span class="koboSpan" id="kobo.129.2">A single </span><code class="inlineCode"><span class="koboSpan" id="kobo.130.1">.po</span></code><span class="koboSpan" id="kobo.131.1"> file is created for each language.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.132.1">compilemessages</span></code><span class="koboSpan" id="kobo.133.1">: This compiles the existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">.po</span></code><span class="koboSpan" id="kobo.135.1"> message files to </span><code class="inlineCode"><span class="koboSpan" id="kobo.136.1">.mo</span></code><span class="koboSpan" id="kobo.137.1"> files, which are used to retrieve translations.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.138.1">Django relies on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.139.1">gettext</span></code><span class="koboSpan" id="kobo.140.1"> toolkit to generate and compile translation files. </span><span class="koboSpan" id="kobo.140.2">Let’s review how to install it.</span></p>
<h2 class="heading-2" id="_idParaDest-300"><span class="koboSpan" id="kobo.141.1">Installing the gettext toolkit</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.142.1">You will need the</span><a id="_idIndexMarker982"/> <code class="inlineCode"><span class="koboSpan" id="kobo.143.1">gettext</span></code><span class="koboSpan" id="kobo.144.1"> toolkit to be able to create, update, and compile message files. </span><span class="koboSpan" id="kobo.144.2">Most Linux distributions include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1">gettext</span></code><span class="koboSpan" id="kobo.146.1"> toolkit. </span><span class="koboSpan" id="kobo.146.2">If you are using macOS, the simplest way to install it is via</span><a id="_idIndexMarker983"/><span class="koboSpan" id="kobo.147.1"> Homebrew, at </span><a href="https://brew.sh/"><span class="url"><span class="koboSpan" id="kobo.148.1">https://brew.sh/</span></span></a><span class="koboSpan" id="kobo.149.1">, with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.150.1">brew install gettext
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.151.1">You might also need to force-link it with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.152.1">brew link --force gettext
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.153.1">If you are using Windows, follow the steps at </span><a href="https://docs.djangoproject.com/en/5.0/topics/i18n/translation/#gettext-on-windows"><span class="url"><span class="koboSpan" id="kobo.154.1">https://docs.djangoproject.com/en/5.0/topics/i18n/translation/#gettext-on-windows</span></span></a><span class="koboSpan" id="kobo.155.1">. </span><span class="koboSpan" id="kobo.155.2">You can download a precompiled </span><code class="inlineCode"><span class="koboSpan" id="kobo.156.1">gettext</span></code><span class="koboSpan" id="kobo.157.1"> binary installer for Windows from </span><a href="https://mlocati.github.io/articles/gettext-iconv-windows.html"><span class="url"><span class="koboSpan" id="kobo.158.1">https://mlocati.github.io/articles/gettext-iconv-windows.html</span></span></a><span class="koboSpan" id="kobo.159.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.160.1">Once you have installed the </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">gettext</span></code><span class="koboSpan" id="kobo.162.1"> toolkit, you are all set to start translating your project. </span><span class="koboSpan" id="kobo.162.2">First, you need to understand the steps needed to translate your project and how Django determines the user’s language.</span></p>
<h2 class="heading-2" id="_idParaDest-301"><span class="koboSpan" id="kobo.163.1">How to add translations to a Django project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.164.1">Let’s</span><a id="_idIndexMarker984"/><span class="koboSpan" id="kobo.165.1"> explore the process of internationalizing your</span><a id="_idIndexMarker985"/><span class="koboSpan" id="kobo.166.1"> project. </span><span class="koboSpan" id="kobo.166.2">Here are the steps needed to translate a Django project:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.167.1">Mark the strings for translation in your Python code and your templates.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.168.1">Run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.169.1">makemessages</span></code><span class="koboSpan" id="kobo.170.1"> command to create or update message files that include all the translation strings from your code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.171.1">Translate the strings contained in the message files.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.172.1">Compile the message files using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.173.1">compilemessages</span></code><span class="koboSpan" id="kobo.174.1"> management command.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.175.1">We will follow this process to add translations to our project throughout this chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.176.1">Next, you are going to learn how Django determines the language of the current user.</span></p>
<h2 class="heading-2" id="_idParaDest-302"><span class="koboSpan" id="kobo.177.1">How Django determines the current language</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.178.1">Django comes with a </span><a id="_idIndexMarker986"/><span class="koboSpan" id="kobo.179.1">middleware that determines the current language based on the request data. </span><span class="koboSpan" id="kobo.179.2">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">LocaleMiddleware</span></code><span class="koboSpan" id="kobo.181.1"> middleware that resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">django.middleware.locale.LocaleMiddleware</span></code><span class="koboSpan" id="kobo.183.1">, which performs the following tasks:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.184.1">If you are using </span><code class="inlineCode"><span class="koboSpan" id="kobo.185.1">i18n_patterns</span></code><span class="koboSpan" id="kobo.186.1">, that is, you are using translated URL patterns, it looks for a language prefix in the requested URL to determine the current language. </span><span class="koboSpan" id="kobo.186.2">You will learn to translate URL patterns in the </span><em class="italic"><span class="koboSpan" id="kobo.187.1">Translating URL patterns section</span></em><span class="koboSpan" id="kobo.188.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.189.1">If no language prefix is found, it looks for an existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.190.1">LANGUAGE_SESSION_KEY</span></code><span class="koboSpan" id="kobo.191.1"> in the current user’s session.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.192.1">If the language is not set in the session, it looks for an existing cookie with the current language. </span><span class="koboSpan" id="kobo.192.2">A custom name for this cookie can be provided in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1">LANGUAGE_COOKIE_NAME</span></code><span class="koboSpan" id="kobo.194.1"> setting. </span><span class="koboSpan" id="kobo.194.2">By default, the name for this cookie is </span><code class="inlineCode"><span class="koboSpan" id="kobo.195.1">django_language</span></code><span class="koboSpan" id="kobo.196.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.197.1">If no cookie is found, it looks for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">Accept-Language</span></code><span class="koboSpan" id="kobo.199.1"> HTTP header of the request.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.200.1">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.201.1">Accept-Language</span></code><span class="koboSpan" id="kobo.202.1"> header does not specify a language, Django uses the language defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.203.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.204.1"> setting.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.205.1">By default, Django will </span><a id="_idIndexMarker987"/><span class="koboSpan" id="kobo.206.1">use the language defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.207.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.208.1"> setting unless you are using </span><code class="inlineCode"><span class="koboSpan" id="kobo.209.1">LocaleMiddleware</span></code><span class="koboSpan" id="kobo.210.1">. </span><span class="koboSpan" id="kobo.210.2">The process described here only applies when using this middleware.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.211.1">We can also let users change their language. </span><span class="koboSpan" id="kobo.211.2">You will learn about how to implement a language selector in the section </span><em class="italic"><span class="koboSpan" id="kobo.212.1">Allowing users to switch language</span></em><span class="koboSpan" id="kobo.213.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.214.1">Let’s start by configuring our project for internationalization.</span></p>
<h1 class="heading-1" id="_idParaDest-303"><span class="koboSpan" id="kobo.215.1">Preparing your project for internationalization</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.216.1">We will prepare our </span><a id="_idIndexMarker988"/><span class="koboSpan" id="kobo.217.1">project to use different languages. </span><span class="koboSpan" id="kobo.217.2">We are going to create an English and a Spanish version for the online shop:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.218.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.219.1">settings.py</span></code><span class="koboSpan" id="kobo.220.1"> file of your project and add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.221.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.222.1"> setting to it. </span><span class="koboSpan" id="kobo.222.2">Place it next to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.224.1"> setting:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.225.1">LANGUAGES = [
    (</span><span class="hljs-string"><span class="koboSpan" id="kobo.226.1">'en'</span></span><span class="koboSpan" id="kobo.227.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.228.1">'English'</span></span><span class="koboSpan" id="kobo.229.1">),
    (</span><span class="hljs-string"><span class="koboSpan" id="kobo.230.1">'es'</span></span><span class="koboSpan" id="kobo.231.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.232.1">'Spanish'</span></span><span class="koboSpan" id="kobo.233.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.234.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.235.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.236.1"> setting contains two tuples that consist of a language code and a name. </span><span class="koboSpan" id="kobo.236.2">Language codes can be locale-specific, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.237.1">en-us</span></code><span class="koboSpan" id="kobo.238.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">en-gb</span></code><span class="koboSpan" id="kobo.240.1">, or generic, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.241.1">en</span></code><span class="koboSpan" id="kobo.242.1">. </span><span class="koboSpan" id="kobo.242.2">With this setting, you specify that your application will only be available in English and Spanish. </span><span class="koboSpan" id="kobo.242.3">If you don’t define a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.244.1"> setting, the site will be available in all the languages that Django is translated into.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.245.1">Make your </span><code class="inlineCode"><span class="koboSpan" id="kobo.246.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.247.1"> setting look like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.248.1">LANGUAGE_CODE = </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.249.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.250.1">en'</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.251.1">Add </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">'django.middleware.locale.LocaleMiddleware'</span></code><span class="koboSpan" id="kobo.253.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.255.1"> setting. </span><span class="koboSpan" id="kobo.255.2">Make sure that this middleware comes after </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">SessionMiddleware</span></code><span class="koboSpan" id="kobo.257.1"> because </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">LocaleMiddleware</span></code><span class="koboSpan" id="kobo.259.1"> needs to use session data. </span><span class="koboSpan" id="kobo.259.2">It also has to be placed before </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">CommonMiddleware</span></code><span class="koboSpan" id="kobo.261.1"> because the latter needs an active language to resolve the requested URL. </span><span class="koboSpan" id="kobo.261.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.263.1"> setting should now look like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.264.1">MIDDLEWARE = [
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.265.1">'django.middleware.security.SecurityMiddleware'</span></span><span class="koboSpan" id="kobo.266.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.267.1">'django.contrib.sessions.middleware.SessionMiddleware'</span></span><span class="koboSpan" id="kobo.268.1">,
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.269.1">'django.middleware.locale.LocaleMiddleware'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.270.1">,</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.271.1">'django.middleware.common.CommonMiddleware'</span></span><span class="koboSpan" id="kobo.272.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.273.1">'django.middleware.csrf.CsrfViewMiddleware'</span></span><span class="koboSpan" id="kobo.274.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.275.1">'django.contrib.auth.middleware.AuthenticationMiddleware'</span></span><span class="koboSpan" id="kobo.276.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.277.1">'django.contrib.messages.middleware.MessageMiddleware'</span></span><span class="koboSpan" id="kobo.278.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.279.1">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span></span><span class="koboSpan" id="kobo.280.1">,
]
</span></code></pre>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.281.1">The order of middleware classes is very important because each middleware can depend on data set by another middleware that was executed previously. </span><span class="koboSpan" id="kobo.281.2">Middleware is applied for requests in order of appearance in </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.283.1">, and in reverse order for responses.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.284.1">Create the </span><a id="_idIndexMarker989"/><span class="koboSpan" id="kobo.285.1">following directory structure inside the main project directory, next to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">manage.py</span></code><span class="koboSpan" id="kobo.287.1"> file:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.288.1">locale/
    en/
    es/
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.289.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.290.1">locale</span></code><span class="koboSpan" id="kobo.291.1"> directory is the place where message files for your application will reside.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.292.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">settings.py</span></code><span class="koboSpan" id="kobo.294.1"> file again and add the following setting to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.295.1">LOCALE_PATHS = [
    BASE_DIR / </span><span class="hljs-string"><span class="koboSpan" id="kobo.296.1">'locale'</span></span><span class="koboSpan" id="kobo.297.1">,
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.298.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.299.1">LOCALE_PATHS</span></code><span class="koboSpan" id="kobo.300.1"> setting specifies the directories where Django has to look for translation files. </span><span class="koboSpan" id="kobo.300.2">Locale paths that appear first have the highest precedence.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.301.1">When you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.302.1">makemessages</span></code><span class="koboSpan" id="kobo.303.1"> command from your project directory, message files will be generated in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.304.1">locale/</span></code><span class="koboSpan" id="kobo.305.1"> path you created. </span><span class="koboSpan" id="kobo.305.2">However, for applications that contain a </span><code class="inlineCode"><span class="koboSpan" id="kobo.306.1">locale/</span></code><span class="koboSpan" id="kobo.307.1"> directory, message files will be</span><a id="_idIndexMarker990"/><span class="koboSpan" id="kobo.308.1"> generated in that directory.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.309.1">Your project is now configured for internationalization. </span><span class="koboSpan" id="kobo.309.2">Next, you will learn how to translate strings in your Python code.</span></p>
<h1 class="heading-1" id="_idParaDest-304"><span class="koboSpan" id="kobo.310.1">Translating Python code</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.311.1">We will explore various methods to handle </span><a id="_idIndexMarker991"/><span class="koboSpan" id="kobo.312.1">translations within Python code. </span><span class="koboSpan" id="kobo.312.2">We </span><a id="_idIndexMarker992"/><span class="koboSpan" id="kobo.313.1">will cover</span><a id="_idIndexMarker993"/><span class="koboSpan" id="kobo.314.1"> the following methods:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.315.1">Standard translations</span></strong></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.316.1">Lazy translations</span></strong><span class="koboSpan" id="kobo.317.1">: Executed </span><a id="_idIndexMarker994"/><span class="koboSpan" id="kobo.318.1">when the value is accessed rather than when the</span><a id="_idIndexMarker995"/><span class="koboSpan" id="kobo.319.1"> function is called.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.320.1">Translations including variables</span></strong><span class="koboSpan" id="kobo.321.1">: Used to interpolate variables within strings that are to be</span><a id="_idIndexMarker996"/><span class="koboSpan" id="kobo.322.1"> translated.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.323.1">Plural forms in translations</span></strong><span class="koboSpan" id="kobo.324.1">: Techniques to manage translations that depend on </span><a id="_idIndexMarker997"/><span class="koboSpan" id="kobo.325.1">numerical quantities that might affect the</span><a id="_idIndexMarker998"/><span class="koboSpan" id="kobo.326.1"> string being translated.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.327.1">For translating literals in your Python code, you can mark strings for translation using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.328.1">gettext()</span></code><span class="koboSpan" id="kobo.329.1"> function included in </span><code class="inlineCode"><span class="koboSpan" id="kobo.330.1">django.utils.translation</span></code><span class="koboSpan" id="kobo.331.1">. </span><span class="koboSpan" id="kobo.331.2">This function translates the message and returns a string. </span><span class="koboSpan" id="kobo.331.3">The convention is to import this function as a shorter alias named </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">_</span></code><span class="koboSpan" id="kobo.333.1"> (the underscore character).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.334.1">You can find all the documentation about translations</span><a id="_idIndexMarker999"/><span class="koboSpan" id="kobo.335.1"> at </span><a href="https://docs.djangoproject.com/en/5.0/topics/i18n/translation/"><span class="url"><span class="koboSpan" id="kobo.336.1">https://docs.djangoproject.com/en/5.0/topics/i18n/translation/</span></span></a><span class="koboSpan" id="kobo.337.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.338.1">Let’s review the different translation methods for Python strings.</span></p>
<h2 class="heading-2" id="_idParaDest-305"><span class="koboSpan" id="kobo.339.1">Standard translations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.340.1">The following code</span><a id="_idIndexMarker1000"/><span class="koboSpan" id="kobo.341.1"> shows how to </span><a id="_idIndexMarker1001"/><span class="koboSpan" id="kobo.342.1">mark a string for translation:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.343.1">from</span></span><span class="koboSpan" id="kobo.344.1"> django.utils.translation </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.345.1">import</span></span><span class="koboSpan" id="kobo.346.1"> gettext </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.347.1">as</span></span><span class="koboSpan" id="kobo.348.1"> _
output = _(</span><span class="hljs-string"><span class="koboSpan" id="kobo.349.1">'Text to be translated.'</span></span><span class="koboSpan" id="kobo.350.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.351.1">This method </span><a id="_idIndexMarker1002"/><span class="koboSpan" id="kobo.352.1">allows you to apply translations to most strings within your Python code by</span><a id="_idIndexMarker1003"/><span class="koboSpan" id="kobo.353.1"> using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.354.1">gettext()</span></code><span class="koboSpan" id="kobo.355.1"> function, aliased as </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1">_</span></code><span class="koboSpan" id="kobo.357.1"> for convenience.</span></p>
<h2 class="heading-2" id="_idParaDest-306"><span class="koboSpan" id="kobo.358.1">Lazy translations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.359.1">Django includes </span><strong class="keyWord"><span class="koboSpan" id="kobo.360.1">lazy</span></strong><span class="koboSpan" id="kobo.361.1"> versions for all of its </span><a id="_idIndexMarker1004"/><span class="koboSpan" id="kobo.362.1">translation functions, which have the suffix </span><code class="inlineCode"><span class="koboSpan" id="kobo.363.1">_lazy()</span></code><span class="koboSpan" id="kobo.364.1">. </span><span class="koboSpan" id="kobo.364.2">When </span><a id="_idIndexMarker1005"/><span class="koboSpan" id="kobo.365.1">using the lazy functions, strings are translated when the value is accessed, rather than when the function is called (this is why they are translated </span><strong class="keyWord"><span class="koboSpan" id="kobo.366.1">lazily</span></strong><span class="koboSpan" id="kobo.367.1">). </span><span class="koboSpan" id="kobo.367.2">The lazy translation functions come in handy when the strings marked for translation are in paths that are executed when modules are loaded.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.368.1">A common example where lazy translations are beneficial is in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">settings.py</span></code><span class="koboSpan" id="kobo.370.1"> file of your project, where immediate translation is not practical because the settings must be defined before the translation system is fully ready.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.371.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.372.1">gettext_lazy()</span></code><span class="koboSpan" id="kobo.373.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.374.1">gettext()</span></code><span class="koboSpan" id="kobo.375.1"> means that strings are translated when the value is accessed. </span><span class="koboSpan" id="kobo.375.2">Django offers a lazy version for all translation functions.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-307"><span class="koboSpan" id="kobo.376.1">Translations including variables</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.377.1">The </span><a id="_idIndexMarker1006"/><span class="koboSpan" id="kobo.378.1">strings marked for translation can include placeholders to include variables in the translations. </span><span class="koboSpan" id="kobo.378.2">The following code is an example of a translation string with a placeholder:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.379.1">from</span></span><span class="koboSpan" id="kobo.380.1"> django.utils.translation </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.381.1">import</span></span><span class="koboSpan" id="kobo.382.1"> gettext </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.383.1">as</span></span><span class="koboSpan" id="kobo.384.1"> _
month = _(</span><span class="hljs-string"><span class="koboSpan" id="kobo.385.1">'April'</span></span><span class="koboSpan" id="kobo.386.1">)
day = </span><span class="hljs-string"><span class="koboSpan" id="kobo.387.1">'14'</span></span><span class="koboSpan" id="kobo.388.1">
output = _(</span><span class="hljs-string"><span class="koboSpan" id="kobo.389.1">'Today is %(month)s %(day)s'</span></span><span class="koboSpan" id="kobo.390.1">) % {</span><span class="hljs-string"><span class="koboSpan" id="kobo.391.1">'month'</span></span><span class="koboSpan" id="kobo.392.1">: month, </span><span class="hljs-string"><span class="koboSpan" id="kobo.393.1">'day'</span></span><span class="koboSpan" id="kobo.394.1">: day}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.395.1">By using placeholders, you can reorder the text variables. </span><span class="koboSpan" id="kobo.395.2">For example, an English translation of the previous example might be </span><em class="italic"><span class="koboSpan" id="kobo.396.1">today is April 14</span></em><span class="koboSpan" id="kobo.397.1">, while the Spanish one might be </span><em class="italic"><span class="koboSpan" id="kobo.398.1">hoy es 14 de Abril</span></em><span class="koboSpan" id="kobo.399.1">. </span><span class="koboSpan" id="kobo.399.2">Always use string interpolation instead of positional interpolation when you have more than one parameter for the translation string. </span><span class="koboSpan" id="kobo.399.3">By doing so, you will be able to reorder the placeholder text.</span></p>
<h2 class="heading-2" id="_idParaDest-308"><span class="koboSpan" id="kobo.400.1">Plural forms in translations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.401.1">For plural forms, Django </span><a id="_idIndexMarker1007"/><span class="koboSpan" id="kobo.402.1">provides </span><code class="inlineCode"><span class="koboSpan" id="kobo.403.1">ngettext()</span></code><span class="koboSpan" id="kobo.404.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.405.1">ngettext_lazy()</span></code><span class="koboSpan" id="kobo.406.1">. </span><span class="koboSpan" id="kobo.406.2">These</span><a id="_idIndexMarker1008"/><span class="koboSpan" id="kobo.407.1"> functions translate singular and plural forms, depending on an argument that indicates the number of objects. </span><span class="koboSpan" id="kobo.407.2">The following example shows how to use them:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.408.1">output = ngettext(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.409.1">'there is %(count)d product'</span></span><span class="koboSpan" id="kobo.410.1">,    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.411.1"># Singular form</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.412.1">'there are %(count)d products'</span></span><span class="koboSpan" id="kobo.413.1">,  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.414.1"># Plural form</span></span><span class="koboSpan" id="kobo.415.1">
    count                            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.416.1"># Numeric value to determine form</span></span><span class="koboSpan" id="kobo.417.1">
) % {</span><span class="hljs-string"><span class="koboSpan" id="kobo.418.1">'count'</span></span><span class="koboSpan" id="kobo.419.1">: count}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.420.1">In this example, if </span><code class="inlineCode"><span class="koboSpan" id="kobo.421.1">count</span></code><span class="koboSpan" id="kobo.422.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.423.1">1</span></code><span class="koboSpan" id="kobo.424.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.425.1">ngettext()</span></code><span class="koboSpan" id="kobo.426.1"> will use the first string and output </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">there is 1 product</span></code><span class="koboSpan" id="kobo.428.1">. </span><span class="koboSpan" id="kobo.428.2">For any other number, it will use the second string, appropriately outputting, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.429.1">there are 5 products</span></code><span class="koboSpan" id="kobo.430.1">. </span><span class="koboSpan" id="kobo.430.2">This allows for more accurate and grammatically correct </span><a id="_idIndexMarker1009"/><span class="koboSpan" id="kobo.431.1">translations in languages where pluralization rules are</span><a id="_idIndexMarker1010"/><span class="koboSpan" id="kobo.432.1"> essential.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.433.1">Now that you know the basics of translating literals in your Python code, it’s time to apply translations to your project.</span></p>
<h2 class="heading-2" id="_idParaDest-309"><span class="koboSpan" id="kobo.434.1">Translating your own code</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.435.1">First, we will </span><a id="_idIndexMarker1011"/><span class="koboSpan" id="kobo.436.1">translate the language names. </span><span class="koboSpan" id="kobo.436.2">To do this, you can follow these instructions:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.437.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">settings.py</span></code><span class="koboSpan" id="kobo.439.1"> file of your project, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">gettext_lazy()</span></code><span class="koboSpan" id="kobo.441.1"> function, and change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.442.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.443.1"> setting, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.444.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.445.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.446.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.447.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.448.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.449.1"> _</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.450.1"># ...</span></span><span class="koboSpan" id="kobo.451.1">
LANGUAGES = [
    (</span><span class="hljs-string"><span class="koboSpan" id="kobo.452.1">'en'</span></span><span class="koboSpan" id="kobo.453.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.454.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.455.1">'English'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.456.1">)</span></strong></span><span class="koboSpan" id="kobo.457.1">),
    (</span><span class="hljs-string"><span class="koboSpan" id="kobo.458.1">'es'</span></span><span class="koboSpan" id="kobo.459.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.460.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.461.1">'Spanish'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.462.1">)</span></strong></span><span class="koboSpan" id="kobo.463.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.464.1">Here, you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.465.1">gettext_lazy()</span></code><span class="koboSpan" id="kobo.466.1"> function instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.467.1">gettext()</span></code><span class="koboSpan" id="kobo.468.1"> to avoid a circular import, thus translating the languages’ names when they are accessed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.469.1">Open the shell and run the following command from your project directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.470.1">django-admin makemessages --all
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.471.1">You should see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.472.1">processing locale es
processing locale en
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.473.1">Take a look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.474.1">locale/</span></code><span class="koboSpan" id="kobo.475.1"> directory. </span><span class="koboSpan" id="kobo.475.2">You should see a file structure like the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.476.1">en/
    LC_MESSAGES/
        django.po
es/
    LC_MESSAGES/
        django.po
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.477.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.478.1">.po</span></code><span class="koboSpan" id="kobo.479.1"> message file has been created for each language.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.480.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.481.1">es/LC_MESSAGES/django.po</span></code><span class="koboSpan" id="kobo.482.1"> with a text editor. </span><span class="koboSpan" id="kobo.482.2">At the end of the file, you should be able to see the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.483.1">#: myshop/settings.py:118</span></span><span class="koboSpan" id="kobo.484.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.485.1">"English"</span></span><span class="koboSpan" id="kobo.486.1">
msgstr </span><span class="hljs-string"><span class="koboSpan" id="kobo.487.1">""</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.488.1">#: myshop/settings.py:119</span></span><span class="koboSpan" id="kobo.489.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.490.1">"Spanish"</span></span><span class="koboSpan" id="kobo.491.1">
msgstr </span><span class="hljs-string"><span class="koboSpan" id="kobo.492.1">""</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.493.1">Each </span><a id="_idIndexMarker1012"/><span class="koboSpan" id="kobo.494.1">translation string is preceded by a comment showing details about the file and the line where it was found. </span><span class="koboSpan" id="kobo.494.2">Each translation includes two strings:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.495.1">msgid</span></code><span class="koboSpan" id="kobo.496.1">: The translation string as it appears in the source code.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.497.1">msgstr</span></code><span class="koboSpan" id="kobo.498.1">: The language translation, which is empty by default. </span><span class="koboSpan" id="kobo.498.2">This is where you have to enter the actual translation for the given string.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.499.1">Fill in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.500.1">msgstr</span></code><span class="koboSpan" id="kobo.501.1"> translations for the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.502.1">msgid</span></code><span class="koboSpan" id="kobo.503.1"> string, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.504.1">#: myshop/settings.py:118</span></span><span class="koboSpan" id="kobo.505.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.506.1">"English"</span></span><span class="koboSpan" id="kobo.507.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.508.1">"Inglés"</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.509.1">#: myshop/settings.py:119</span></span><span class="koboSpan" id="kobo.510.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.511.1">"Spanish"</span></span><span class="koboSpan" id="kobo.512.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.513.1">"Español"</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.514.1">Save the modified message file, open the shell, and run the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.515.1">django-admin compilemessages
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.516.1">If everything goes well, you should see an output like the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.517.1">processing file django.po in myshop/locale/en/LC_MESSAGES
processing file django.po in myshop/locale/es/LC_MESSAGES
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.518.1">The output gives</span><a id="_idIndexMarker1013"/><span class="koboSpan" id="kobo.519.1"> you information about the message files that are being compiled. </span><span class="koboSpan" id="kobo.519.2">Take a look at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.520.1">locale</span></code><span class="koboSpan" id="kobo.521.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.522.1">myshop</span></code><span class="koboSpan" id="kobo.523.1"> project again. </span><span class="koboSpan" id="kobo.523.2">You should see the following files:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.524.1">en/
    LC_MESSAGES/
        django.mo
        django.po
es/
    LC_MESSAGES/
        django.mo
        django.po
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.525.1">You can see that a </span><code class="inlineCode"><span class="koboSpan" id="kobo.526.1">.mo</span></code><span class="koboSpan" id="kobo.527.1"> compiled message file has been generated for each language.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.528.1">Now that you have translated the language names, let’s translate the model field names that are displayed on the site:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.529.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.530.1">models.py</span></code><span class="koboSpan" id="kobo.531.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.532.1">orders</span></code><span class="koboSpan" id="kobo.533.1"> application, and add names marked for translation to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.534.1">Order</span></code><span class="koboSpan" id="kobo.535.1"> model fields, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.536.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.537.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.538.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.539.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.540.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.541.1"> _</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.542.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.543.1">Order</span></span><span class="koboSpan" id="kobo.544.1">(models.Model):
    first_name = models.CharField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.545.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.546.1">'first name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.547.1">)</span></strong></span><span class="koboSpan" id="kobo.548.1">, max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.549.1">50</span></span><span class="koboSpan" id="kobo.550.1">)
    last_name = models.CharField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.551.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.552.1">'last name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.553.1">)</span></strong></span><span class="koboSpan" id="kobo.554.1">, max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.555.1">50</span></span><span class="koboSpan" id="kobo.556.1">)
    email = models.EmailField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.557.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.558.1">'e-mail'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.559.1">)</span></strong></span><span class="koboSpan" id="kobo.560.1">)
    address = models.CharField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.561.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.562.1">'address'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.563.1">)</span></strong></span><span class="koboSpan" id="kobo.564.1">, max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.565.1">250</span></span><span class="koboSpan" id="kobo.566.1">)
    postal_code = models.CharField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.567.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.568.1">'postal code'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.569.1">)</span></strong></span><span class="koboSpan" id="kobo.570.1">, max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.571.1">20</span></span><span class="koboSpan" id="kobo.572.1">)
    city = models.CharField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.573.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.574.1">'city'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.575.1">)</span></strong></span><span class="koboSpan" id="kobo.576.1">, max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.577.1">100</span></span><span class="koboSpan" id="kobo.578.1">)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.579.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.580.1">You have added names for the fields that are displayed when a user places a new order. </span><span class="koboSpan" id="kobo.580.2">These are </span><code class="inlineCode"><span class="koboSpan" id="kobo.581.1">first_name</span></code><span class="koboSpan" id="kobo.582.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.583.1">last_name</span></code><span class="koboSpan" id="kobo.584.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1">email</span></code><span class="koboSpan" id="kobo.586.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">address</span></code><span class="koboSpan" id="kobo.588.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.589.1">postal_code</span></code><span class="koboSpan" id="kobo.590.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">city</span></code><span class="koboSpan" id="kobo.592.1">. </span><span class="koboSpan" id="kobo.592.2">Remember that you can also use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">verbose_name</span></code><span class="koboSpan" id="kobo.594.1"> attribute to name the fields.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.595.1">Create the following directory structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.596.1">orders</span></code><span class="koboSpan" id="kobo.597.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.598.1">locale/
    en/
    es/
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.599.1">By creating a </span><code class="inlineCode"><span class="koboSpan" id="kobo.600.1">locale</span></code><span class="koboSpan" id="kobo.601.1"> directory, the translation strings of this application will be stored in a message file in this directory instead of the main messages file. </span><span class="koboSpan" id="kobo.601.2">In this way, you can generate separate translation files for each application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.602.1">Open the shell </span><a id="_idIndexMarker1014"/><span class="koboSpan" id="kobo.603.1">from the project directory and run the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.604.1">django-admin makemessages --all
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.605.1">You should see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.606.1">processing locale es
processing locale en
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.607.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.608.1">locale/es/LC_MESSAGES/django.po</span></code><span class="koboSpan" id="kobo.609.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.610.1">order</span></code><span class="koboSpan" id="kobo.611.1"> application using a text editor. </span><span class="koboSpan" id="kobo.611.2">You will see the translation strings for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.612.1">Order</span></code><span class="koboSpan" id="kobo.613.1"> model. </span><span class="koboSpan" id="kobo.613.2">Fill in the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.614.1">msgstr</span></code><span class="koboSpan" id="kobo.615.1"> translations for the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.616.1">msgid</span></code><span class="koboSpan" id="kobo.617.1"> strings:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.618.1">#: orders/models.py:12</span></span><span class="koboSpan" id="kobo.619.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.620.1">"first name"</span></span><span class="koboSpan" id="kobo.621.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.622.1">"nombre"</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.623.1">#: orders/models.py:14</span></span><span class="koboSpan" id="kobo.624.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.625.1">"last name"</span></span><span class="koboSpan" id="kobo.626.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.627.1">"apellidos"</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.628.1">#: orders/models.py:16</span></span><span class="koboSpan" id="kobo.629.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.630.1">"e-mail"</span></span><span class="koboSpan" id="kobo.631.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.632.1">"e-mail"</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.633.1">#: orders/models.py:17</span></span><span class="koboSpan" id="kobo.634.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.635.1">"address"</span></span><span class="koboSpan" id="kobo.636.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.637.1">"dirección"</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.638.1">#: orders/models.py:19</span></span><span class="koboSpan" id="kobo.639.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.640.1">"postal code"</span></span><span class="koboSpan" id="kobo.641.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.642.1">"código postal"</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.643.1">#: orders/models.py:21</span></span><span class="koboSpan" id="kobo.644.1">
msgid </span><span class="hljs-string"><span class="koboSpan" id="kobo.645.1">"city"</span></span><span class="koboSpan" id="kobo.646.1">
msgstr </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.647.1">"ciudad"</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.648.1">After you</span><a id="_idIndexMarker1015"/><span class="koboSpan" id="kobo.649.1"> have finished adding the translations, save the file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.650.1">Besides a text editor, you can use Poedit to edit translations. </span><span class="koboSpan" id="kobo.650.2">Poedit is a piece of software for editing translations that uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.651.1">gettext</span></code><span class="koboSpan" id="kobo.652.1">. </span><span class="koboSpan" id="kobo.652.2">It is available for Linux, Windows, and macOS. </span><span class="koboSpan" id="kobo.652.3">You can download Poedit</span><a id="_idIndexMarker1016"/><span class="koboSpan" id="kobo.653.1"> from </span><a href="https://poedit.net/"><span class="url"><span class="koboSpan" id="kobo.654.1">https://poedit.net/</span></span></a><span class="koboSpan" id="kobo.655.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.656.1">Let’s also translate the forms of your project. </span><span class="koboSpan" id="kobo.656.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.657.1">OrderCreateForm</span></code><span class="koboSpan" id="kobo.658.1"> of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.659.1">orders</span></code><span class="koboSpan" id="kobo.660.1"> application does not have to be translated. </span><span class="koboSpan" id="kobo.660.2">That’s because it is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.661.1">ModelForm</span></code><span class="koboSpan" id="kobo.662.1"> and uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.663.1">verbose_name</span></code><span class="koboSpan" id="kobo.664.1"> attribute of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.665.1">Order</span></code><span class="koboSpan" id="kobo.666.1"> model fields for the form field labels. </span><span class="koboSpan" id="kobo.666.2">You are going to translate the forms of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.667.1">cart</span></code><span class="koboSpan" id="kobo.668.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.669.1">coupons</span></code><span class="koboSpan" id="kobo.670.1"> applications:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.671.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.672.1">forms.py</span></code><span class="koboSpan" id="kobo.673.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.674.1">cart</span></code><span class="koboSpan" id="kobo.675.1"> application directory and add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.676.1">label</span></code><span class="koboSpan" id="kobo.677.1"> attribute to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.678.1">quantity</span></code><span class="koboSpan" id="kobo.679.1"> field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.680.1">CartAddProductForm</span></code><span class="koboSpan" id="kobo.681.1">. </span><span class="koboSpan" id="kobo.681.2">Then, mark this field for translation, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.682.1">from</span></span><span class="koboSpan" id="kobo.683.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.684.1">import</span></span><span class="koboSpan" id="kobo.685.1"> forms
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.686.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.687.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.688.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.689.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.690.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.691.1"> _</span></strong></span><span class="koboSpan" id="kobo.692.1">
PRODUCT_QUANTITY_CHOICES = [(i, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.693.1">str</span></span><span class="koboSpan" id="kobo.694.1">(i)) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.695.1">for</span></span><span class="koboSpan" id="kobo.696.1"> i </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.697.1">in</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.698.1">range</span></span><span class="koboSpan" id="kobo.699.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.700.1">1</span></span><span class="koboSpan" id="kobo.701.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.702.1">21</span></span><span class="koboSpan" id="kobo.703.1">)]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.704.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.705.1">CartAddProductForm</span></span><span class="koboSpan" id="kobo.706.1">(forms.Form):
    quantity = forms.TypedChoiceField(
        choices=PRODUCT_QUANTITY_CHOICES,
        coerce=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.707.1">int</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.708.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.709.1">        label=_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.710.1">'Quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.711.1">)</span></strong></span><span class="koboSpan" id="kobo.712.1">
    )
    override = forms.BooleanField(
        required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.713.1">False</span></span><span class="koboSpan" id="kobo.714.1">,
        initial=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.715.1">False</span></span><span class="koboSpan" id="kobo.716.1">,
        widget=forms.HiddenInput
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.717.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.718.1">forms.py</span></code><span class="koboSpan" id="kobo.719.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.720.1">coupons</span></code><span class="koboSpan" id="kobo.721.1"> application and translate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.722.1">CouponApplyForm</span></code><span class="koboSpan" id="kobo.723.1"> form, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.724.1">from</span></span><span class="koboSpan" id="kobo.725.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.726.1">import</span></span><span class="koboSpan" id="kobo.727.1"> forms
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.728.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.729.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.730.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.731.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.732.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.733.1"> _</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.734.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.735.1">CouponApplyForm</span></span><span class="koboSpan" id="kobo.736.1">(forms.Form):
    code = forms.CharField(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.737.1">label=_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.738.1">'Coupon'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.739.1">)</span></strong></span><span class="koboSpan" id="kobo.740.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.741.1">You have added</span><a id="_idIndexMarker1017"/><span class="koboSpan" id="kobo.742.1"> a label to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.743.1">code</span></code><span class="koboSpan" id="kobo.744.1"> field and marked it for translation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.745.1">You have finished marking Python strings for translation. </span><span class="koboSpan" id="kobo.745.2">Next, you will learn how to mark text for translation in templates.</span></p>
<h1 class="heading-1" id="_idParaDest-310"><span class="koboSpan" id="kobo.746.1">Translating templates</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.747.1">Django offers </span><a id="_idIndexMarker1018"/><span class="koboSpan" id="kobo.748.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1">{% translate %}</span></code><span class="koboSpan" id="kobo.750.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.751.1">{% blocktranslate %}</span></code><span class="koboSpan" id="kobo.752.1"> template tags to translate the strings using templates. </span><span class="koboSpan" id="kobo.752.2">In order to use the translation template tags, you have to add </span><code class="inlineCode"><span class="koboSpan" id="kobo.753.1">{% load i18n %}</span></code><span class="koboSpan" id="kobo.754.1"> to the top of your template to load them.</span></p>
<h2 class="heading-2" id="_idParaDest-311"><span class="koboSpan" id="kobo.755.1">The {% translate %} template tag</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.756.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.757.1">{% translate %}</span></code><span class="koboSpan" id="kobo.758.1"> template tag allows</span><a id="_idIndexMarker1019"/><span class="koboSpan" id="kobo.759.1"> you to mark a literal for translation. </span><span class="koboSpan" id="kobo.759.2">Internally, Django executes </span><code class="inlineCode"><span class="koboSpan" id="kobo.760.1">gettext()</span></code><span class="koboSpan" id="kobo.761.1"> on the given text. </span><span class="koboSpan" id="kobo.761.2">This is how to mark a string for translation in a template:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.762.1">{% translate </span><span class="hljs-string"><span class="koboSpan" id="kobo.763.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.764.1">Text to be translated"</span></span><span class="koboSpan" id="kobo.765.1"> %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.766.1">You can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.767.1">as</span></code><span class="koboSpan" id="kobo.768.1"> to store the translated content in a variable that you can use throughout your template. </span><span class="koboSpan" id="kobo.768.2">The following example stores the translated text in a variable called </span><code class="inlineCode"><span class="koboSpan" id="kobo.769.1">greeting</span></code><span class="koboSpan" id="kobo.770.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.771.1">{% translate "Hello!" </span><span class="koboSpan" id="kobo.771.2">as greeting %}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.772.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.773.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.774.1">&gt;</span></span><span class="koboSpan" id="kobo.775.1">{{ greeting }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.776.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.777.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.778.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.779.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.780.1">{% translate %}</span></code><span class="koboSpan" id="kobo.781.1"> tag is useful for simple translation strings, but it can’t handle content for translation that includes </span><a id="_idIndexMarker1020"/><span class="koboSpan" id="kobo.782.1">variables.</span></p>
<h2 class="heading-2" id="_idParaDest-312"><span class="koboSpan" id="kobo.783.1">The {% blocktranslate %} template tag</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.784.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1">{% blocktranslate %}</span></code><span class="koboSpan" id="kobo.786.1"> template tag allows you</span><a id="_idIndexMarker1021"/><span class="koboSpan" id="kobo.787.1"> to mark content that includes literals and variable content, using placeholders. </span><span class="koboSpan" id="kobo.787.2">The following example shows you how to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.788.1">{% blocktranslate %}</span></code><span class="koboSpan" id="kobo.789.1"> tag, including a </span><code class="inlineCode"><span class="koboSpan" id="kobo.790.1">name</span></code><span class="koboSpan" id="kobo.791.1"> variable in the content for translation:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.792.1">{% blocktranslate %}Hello {{ name }}!{% endblocktranslate %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.793.1">You can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.794.1">with</span></code><span class="koboSpan" id="kobo.795.1"> to include template expressions, such as accessing object attributes or applying template filters to variables. </span><span class="koboSpan" id="kobo.795.2">You always have to use placeholders for these. </span><span class="koboSpan" id="kobo.795.3">You can’t access expressions or object attributes inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">blocktrans</span></code><span class="koboSpan" id="kobo.797.1"> block. </span><span class="koboSpan" id="kobo.797.2">The following example shows you how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.798.1">with</span></code><span class="koboSpan" id="kobo.799.1"> to include an object attribute to which the </span><code class="inlineCode"><span class="koboSpan" id="kobo.800.1">capfirst</span></code><span class="koboSpan" id="kobo.801.1"> filter has been applied:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.802.1">{% blocktranslate with name=user.name|capfirst %}
  Hello {{ name }}!
</span><span class="koboSpan" id="kobo.802.2">{% endblocktranslate %}
</span></code></pre>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.803.1"> Use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.804.1">{% blocktranslate %}</span></code><span class="koboSpan" id="kobo.805.1"> tag instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.806.1">{% translate %}</span></code><span class="koboSpan" id="kobo.807.1"> when you need to include variable content in your translation string.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.808.1">Now that you are familiar with the translation template tags, let’s put them to use.</span></p>
<h2 class="heading-2" id="_idParaDest-313"><span class="koboSpan" id="kobo.809.1">Translating the shop templates</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.810.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">shop/base.html</span></code><span class="koboSpan" id="kobo.812.1"> template </span><a id="_idIndexMarker1022"/><span class="koboSpan" id="kobo.813.1">of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1">shop</span></code><span class="koboSpan" id="kobo.815.1"> application. </span><span class="koboSpan" id="kobo.815.2">Make sure that you load the </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1">i18n</span></code><span class="koboSpan" id="kobo.817.1"> tag at the top of the template and mark the strings for translation, as follows. </span><span class="koboSpan" id="kobo.817.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.818.1">{% load </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.819.1">i18n </span></strong></span><span class="koboSpan" id="kobo.820.1">static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.821.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.822.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.823.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.824.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.825.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.826.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.827.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.828.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.829.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.830.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.831.1">meta</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.832.1">charset</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.833.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.834.1">"utf-8"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.835.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.836.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.837.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.838.1">&gt;</span></span><span class="koboSpan" id="kobo.839.1">
    {% block title %}</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.840.1">{% translate "My shop" %}</span></strong></span><span class="koboSpan" id="kobo.841.1">{% endblock %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.842.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.843.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.844.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.845.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.846.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.847.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.848.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.849.1">"{% static "css/base.css" %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.850.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.851.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.852.1">"stylesheet"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.853.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.854.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.855.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.856.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.857.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.858.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.859.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.860.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.861.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.862.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.863.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.864.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.865.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.866.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.867.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.868.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.869.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.870.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.871.1">/"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.872.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.873.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.874.1">"logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.875.1">&gt;</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.876.1">{% translate "My shop" %}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.877.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.878.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.879.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.880.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.881.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.882.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.883.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.884.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.885.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.886.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.887.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.888.1">subheader"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.889.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.890.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.891.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.892.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.893.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.894.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.895.1">&gt;</span></span><span class="koboSpan" id="kobo.896.1">
      {% with total_items=cart|length %}
        {% if total_items &gt; 0 %}
          </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.897.1">{% translate "Your cart" %}</span></strong></span><span class="koboSpan" id="kobo.898.1">:
          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.899.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.900.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.901.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.902.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.903.1">"{% url "cart:cart_detail"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.904.1"> %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.905.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.906.1">{% blocktranslate with total=cart.get_total_price count items=total_items %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.907.1">              {{ items }} item, ${{ total }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.908.1">            {% plural %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.909.1">              {{ items }} items, ${{ total }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.910.1">            {% endblocktranslate %}</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.911.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.912.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.913.1">&gt;</span></span><span class="koboSpan" id="kobo.914.1">
        {% elif not order %}
          </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.915.1">{% translate "Your cart is empty." </span><span class="koboSpan" id="kobo.915.2">%}</span></strong></span><span class="koboSpan" id="kobo.916.1">
        {% endif %}
      {% endwith %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.917.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.918.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.919.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.920.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.921.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.922.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.923.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.924.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.925.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.926.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.927.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.928.1">&gt;</span></span><span class="koboSpan" id="kobo.929.1">
    {% block content %}
    {% endblock %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.930.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.931.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.932.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.933.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.934.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.935.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.936.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.937.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.938.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.939.1">Make </span><a id="_idIndexMarker1023"/><span class="koboSpan" id="kobo.940.1">sure that no template tag is split across multiple lines.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.941.1">Notice the </span><code class="inlineCode"><span class="koboSpan" id="kobo.942.1">{% blocktranslate %}</span></code><span class="koboSpan" id="kobo.943.1"> tag to display the cart’s summary. </span><span class="koboSpan" id="kobo.943.2">The cart’s summary was previously as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.944.1">{{ total_items }} item{{ total_items|pluralize }},
${{ cart.get_total_price }}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.945.1">You changed it, and now you use </span><code class="inlineCode"><span class="koboSpan" id="kobo.946.1">{% blocktranslate with ... </span><span class="koboSpan" id="kobo.946.2">%}</span></code><span class="koboSpan" id="kobo.947.1"> to set up the placeholder </span><code class="inlineCode"><span class="koboSpan" id="kobo.948.1">total</span></code><span class="koboSpan" id="kobo.949.1"> with the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.950.1">cart.get_total_price</span></code><span class="koboSpan" id="kobo.951.1"> (the object method called here). </span><span class="koboSpan" id="kobo.951.2">You also use </span><code class="inlineCode"><span class="koboSpan" id="kobo.952.1">count</span></code><span class="koboSpan" id="kobo.953.1">, which allows you to set a variable for counting objects for Django to</span><a id="_idIndexMarker1024"/><span class="koboSpan" id="kobo.954.1"> select the right plural form. </span><span class="koboSpan" id="kobo.954.2">You set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.955.1">items</span></code><span class="koboSpan" id="kobo.956.1"> variable to count objects with the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.957.1">total_items</span></code><span class="koboSpan" id="kobo.958.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.959.1">This allows you to set a translation for the singular and plural forms, which you separate with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.960.1">{% plural %}</span></code><span class="koboSpan" id="kobo.961.1"> tag within the </span><code class="inlineCode"><span class="koboSpan" id="kobo.962.1">{% blocktranslate %}</span></code><span class="koboSpan" id="kobo.963.1"> block. </span><span class="koboSpan" id="kobo.963.2">The resulting code is:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.964.1">{% blocktranslate with total=cart.get_total_price count items=total_items %}
  {{ items }} item, ${{ total }}
{% plural %}
  {{ items }} items, ${{ total }}
{% endblocktranslate %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.965.1">Next, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.966.1">shop/product/detail.html</span></code><span class="koboSpan" id="kobo.967.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.968.1">shop</span></code><span class="koboSpan" id="kobo.969.1"> application and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.970.1">i18n</span></code><span class="koboSpan" id="kobo.971.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.972.1">{% load %}</span></code><span class="koboSpan" id="kobo.973.1"> tag:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.974.1">{% extends "shop/base.html" %}
{% load </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.975.1">i18n </span></strong></span><span class="koboSpan" id="kobo.976.1">static %}
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.977.1">Note that </span><code class="inlineCode"><span class="koboSpan" id="kobo.978.1">{% load %}</span></code><span class="koboSpan" id="kobo.979.1"> allows you to load all template tags at once by including the modules separated by spaces. </span><span class="koboSpan" id="kobo.979.2">In this case, we load the </span><code class="inlineCode"><span class="koboSpan" id="kobo.980.1">i18n</span></code><span class="koboSpan" id="kobo.981.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.982.1">static</span></code><span class="koboSpan" id="kobo.983.1"> modules that contain template tags.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.984.1">Then, find the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.985.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.986.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.987.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.988.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.989.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.990.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.991.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.992.1">"Add to cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.993.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.994.1">Replace it with the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.995.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.996.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.997.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.998.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.999.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1000.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1001.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1002.1">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1003.1">{% translate "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1004.1">Add</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1005.1">to</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1006.1">cart</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1007.1">" %}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1008.1">"&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1009.1">Then, find the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1010.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1011.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1012.1">&gt;</span></span><span class="koboSpan" id="kobo.1013.1">People who bought this also bought</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1014.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1015.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1016.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1017.1">Replace it with the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1018.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1019.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1020.1">&gt;</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1021.1">{% translate "People who bought this also bought" %}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1022.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1023.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1024.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1025.1">Now, translate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1026.1">orders</span></code><span class="koboSpan" id="kobo.1027.1"> application template. </span><span class="koboSpan" id="kobo.1027.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1028.1">orders/order/create.html</span></code><span class="koboSpan" id="kobo.1029.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1030.1">orders</span></code><span class="koboSpan" id="kobo.1031.1"> application </span><a id="_idIndexMarker1025"/><span class="koboSpan" id="kobo.1032.1">and mark the text for translation, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1033.1">{% extends </span><span class="hljs-string"><span class="koboSpan" id="kobo.1034.1">"shop/base.html"</span></span><span class="koboSpan" id="kobo.1035.1"> %}
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1036.1">{% load i18n %}</span></strong></span><span class="koboSpan" id="kobo.1037.1">
{% block title %}
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1038.1">  {% translate </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1039.1">"Checkout"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1040.1"> %}</span></strong></span><span class="koboSpan" id="kobo.1041.1">
{% endblock %}
{% block content %}
  &lt;h1&gt;</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1042.1">{% translate </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1043.1">"Checkout"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1044.1"> %}</span></strong></span><span class="koboSpan" id="kobo.1045.1">&lt;/h1&gt;
  &lt;div class=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1046.1">"order-info"</span></span><span class="koboSpan" id="kobo.1047.1">&gt;
    &lt;h3&gt;</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1048.1">{% translate </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1049.1">"Your order"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1050.1"> %}</span></strong></span><span class="koboSpan" id="kobo.1051.1">&lt;/h3&gt;
    &lt;ul&gt;
      {% </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1052.1">for</span></span><span class="koboSpan" id="kobo.1053.1"> item in cart %}
        &lt;li&gt;
          {{ item.quantity }}x {{ item.product.name }}
          &lt;span&gt;${{ item.total_price }}&lt;/span&gt;
        &lt;/li&gt;
      {% endfor %}
      {% </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1054.1">if</span></span><span class="koboSpan" id="kobo.1055.1"> cart.coupon %}
        &lt;li&gt;
          </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1056.1">{% blocktranslate with code=cart.coupon.code discount=cart.coupon.discount %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1057.1">"</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1058.1">{{ code }}"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1059.1"> ({{ discount }}% off)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1060.1">          {% endblocktranslate %}</span></strong></span><span class="koboSpan" id="kobo.1061.1">
          &lt;span class=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1062.1">"neg"</span></span><span class="koboSpan" id="kobo.1063.1">&gt;- ${{ cart.get_discount|floatformat:</span><span class="hljs-number"><span class="koboSpan" id="kobo.1064.1">2</span></span><span class="koboSpan" id="kobo.1065.1"> }}&lt;/span&gt;
        &lt;/li&gt;
      {% endif %}
    &lt;/ul&gt;
    &lt;p&gt;</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1066.1">{% translate </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1067.1">"Total"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1068.1"> %}</span></strong></span><span class="koboSpan" id="kobo.1069.1">: ${{
    cart.get_total_price_after_discount|floatformat:</span><span class="hljs-number"><span class="koboSpan" id="kobo.1070.1">2</span></span><span class="koboSpan" id="kobo.1071.1"> }}&lt;/p&gt;
  &lt;/div&gt;
  &lt;form method=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1072.1">"post"</span></span><span class="koboSpan" id="kobo.1073.1"> class=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1074.1">"order-form"</span></span><span class="koboSpan" id="kobo.1075.1">&gt;
    {{ form.as_p }}
    &lt;p&gt;&lt;input type=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1076.1">"submit"</span></span><span class="koboSpan" id="kobo.1077.1"> value=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1078.1">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1079.1">{% translate "</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1080.1">Place order</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1081.1">" %}</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1082.1">"</span></span><span class="koboSpan" id="kobo.1083.1">&gt;&lt;/p&gt;
    {% csrf_token %}
  &lt;/form&gt;
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1084.1">Make sure that </span><a id="_idIndexMarker1026"/><span class="koboSpan" id="kobo.1085.1">no template tag is split across multiple lines. </span><span class="koboSpan" id="kobo.1085.2">Take a look at the following files in the code that accompanies this chapter to see how the strings have been marked for translation:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1086.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1087.1">shop</span></code><span class="koboSpan" id="kobo.1088.1"> application: Template </span><code class="inlineCode"><span class="koboSpan" id="kobo.1089.1">shop/product/list.html</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1090.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1091.1">orders</span></code><span class="koboSpan" id="kobo.1092.1"> application: Template </span><code class="inlineCode"><span class="koboSpan" id="kobo.1093.1">orders/order/pdf.html</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1094.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1095.1">cart</span></code><span class="koboSpan" id="kobo.1096.1"> application: Template </span><code class="inlineCode"><span class="koboSpan" id="kobo.1097.1">cart/detail.html</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1098.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1099.1">payments</span></code><span class="koboSpan" id="kobo.1100.1"> application: Templates </span><code class="inlineCode"><span class="koboSpan" id="kobo.1101.1">payment/process.html</span></code><span class="koboSpan" id="kobo.1102.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1103.1">payment/completed.html</span></code><span class="koboSpan" id="kobo.1104.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1105.1">payment/canceled.html</span></code></li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1106.1">Remember that you can find the source code for this chapter at </span><a href="https://github.com/PacktPublishing/Django-5-by-Example/tree/master/Chapter11"><span class="url"><span class="koboSpan" id="kobo.1107.1">https://github.com/PacktPublishing/Django-5-by-Example/tree/master/Chapter11</span></span></a><span class="koboSpan" id="kobo.1108.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1109.1">Let’s update the message files to include the new translation strings:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1110.1">Open the shell and run the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1111.1">django-admin makemessages --all
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1112.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1113.1">.po</span></code><span class="koboSpan" id="kobo.1114.1"> files are inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1115.1">locale</span></code><span class="koboSpan" id="kobo.1116.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1117.1">myshop</span></code><span class="koboSpan" id="kobo.1118.1"> project, and you’ll see that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1119.1">orders</span></code><span class="koboSpan" id="kobo.1120.1"> application now contains all the strings that you marked for translation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1121.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1122.1">.po</span></code><span class="koboSpan" id="kobo.1123.1"> translation files of the project and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1124.1">orders</span></code><span class="koboSpan" id="kobo.1125.1"> application, and include Spanish translations in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1126.1">msgstr</span></code><span class="koboSpan" id="kobo.1127.1">. </span><span class="koboSpan" id="kobo.1127.2">You can also use the translated </span><code class="inlineCode"><span class="koboSpan" id="kobo.1128.1">.po</span></code><span class="koboSpan" id="kobo.1129.1"> files in the source code that accompanies this chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1130.1">Run the following command to compile the translation files:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1131.1">django-admin compilemessages
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1132.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1133.1">processing file django.po in myshop/locale/en/LC_MESSAGES
processing file django.po in myshop/locale/es/LC_MESSAGES
processing file django.po in myshop/orders/locale/en/LC_MESSAGES
processing file django.po in myshop/orders/locale/es/LC_MESSAGES
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1134.1">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1135.1">.mo</span></code><span class="koboSpan" id="kobo.1136.1"> file</span><a id="_idIndexMarker1027"/><span class="koboSpan" id="kobo.1137.1"> containing compiled translations has been generated for each </span><code class="inlineCode"><span class="koboSpan" id="kobo.1138.1">.po</span></code><span class="koboSpan" id="kobo.1139.1"> translation file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1140.1">Now, you have edited </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1">.po</span></code><span class="koboSpan" id="kobo.1142.1"> files with a text editor or by using Poedit. </span><span class="koboSpan" id="kobo.1142.2">Next, we are going to use a Django application to edit translations directly within the browser.</span></p>
<h1 class="heading-1" id="_idParaDest-314"><span class="koboSpan" id="kobo.1143.1">Using the Rosetta translation interface</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1144.1">Rosetta</span><a id="_idIndexMarker1028"/><span class="koboSpan" id="kobo.1145.1"> is a third-party application that allows you to edit translations directly in the browser, using the same interface as the Django administration site. </span><span class="koboSpan" id="kobo.1145.2">Rosetta makes it easy to edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1146.1">.po</span></code><span class="koboSpan" id="kobo.1147.1"> files, and it updates compiled translation files. </span><span class="koboSpan" id="kobo.1147.2">This eliminates the need to download and upload translation files, and it supports collaborative editing by multiple users. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1148.1">Let’s integrate Rosetta into your project:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1149.1">Install </span><a id="_idIndexMarker1029"/><span class="koboSpan" id="kobo.1150.1">Rosetta via </span><code class="inlineCode"><span class="koboSpan" id="kobo.1151.1">pip</span></code><span class="koboSpan" id="kobo.1152.1"> using this command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1153.1">python -m pip install django-rosetta==0.10.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1154.1">Then, add </span><code class="inlineCode"><span class="koboSpan" id="kobo.1155.1">'rosetta'</span></code><span class="koboSpan" id="kobo.1156.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1157.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1158.1"> setting in your project’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1">settings.py</span></code><span class="koboSpan" id="kobo.1160.1"> file, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1161.1">INSTALLED_APPS = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1162.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1163.1">'rosetta'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1164.1">,</span></strong></span><span class="koboSpan" id="kobo.1165.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1166.1">You need to add Rosetta’s URLs to your main URL configuration. </span><span class="koboSpan" id="kobo.1166.2">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1167.1">urls.py</span></code><span class="koboSpan" id="kobo.1168.1"> file of your project and add the following URL pattern highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1169.1">urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1170.1">'admin/'</span></span><span class="koboSpan" id="kobo.1171.1">, admin.site.urls),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1172.1">'cart/'</span></span><span class="koboSpan" id="kobo.1173.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1174.1">'cart.urls'</span></span><span class="koboSpan" id="kobo.1175.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1176.1">'cart'</span></span><span class="koboSpan" id="kobo.1177.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1178.1">'orders/'</span></span><span class="koboSpan" id="kobo.1179.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1180.1">'orders.urls'</span></span><span class="koboSpan" id="kobo.1181.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1182.1">'orders'</span></span><span class="koboSpan" id="kobo.1183.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1184.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1185.1">payment/'</span></span><span class="koboSpan" id="kobo.1186.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1187.1">'payment.urls'</span></span><span class="koboSpan" id="kobo.1188.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1189.1">'payment'</span></span><span class="koboSpan" id="kobo.1190.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1191.1">'coupons/'</span></span><span class="koboSpan" id="kobo.1192.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1193.1">'coupons.urls'</span></span><span class="koboSpan" id="kobo.1194.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1195.1">'coupons'</span></span><span class="koboSpan" id="kobo.1196.1">)),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1197.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1198.1">'rosetta/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1199.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1200.1">'rosetta.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1201.1">)),</span></strong></span><span class="koboSpan" id="kobo.1202.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1203.1">''</span></span><span class="koboSpan" id="kobo.1204.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1205.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1206.1">shop.urls'</span></span><span class="koboSpan" id="kobo.1207.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1208.1">'shop'</span></span><span class="koboSpan" id="kobo.1209.1">)),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1210.1">Make sure you place it before the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1211.1">shop.urls</span></code><span class="koboSpan" id="kobo.1212.1"> pattern to prevent an undesired pattern match.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1213.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1214.1">http://127.0.0.1:8000/admin/</span></code><span class="koboSpan" id="kobo.1215.1"> and log in as a superuser. </span><span class="koboSpan" id="kobo.1215.2">Then, navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1216.1">http://127.0.0.1:8000/rosetta/</span></code><span class="koboSpan" id="kobo.1217.1"> in your browser. </span><span class="koboSpan" id="kobo.1217.2">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.1218.1">Filter</span></strong><span class="koboSpan" id="kobo.1219.1"> menu, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1220.1">THIRD PARTY</span></strong><span class="koboSpan" id="kobo.1221.1"> to display all the available message files, including those that belong to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1222.1">orders</span></code><span class="koboSpan" id="kobo.1223.1"> application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1224.1">You</span><a id="_idIndexMarker1030"/><span class="koboSpan" id="kobo.1225.1"> should see a list of existing languages, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1226.1"><img alt="" role="presentation" src="../Images/B21088_11_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1227.1">Figure 11.2: The Rosetta administration interface</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1228.1">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1229.1">Myshop</span></strong><span class="koboSpan" id="kobo.1230.1"> link in the </span><strong class="screenText"><span class="koboSpan" id="kobo.1231.1">Spanish</span></strong><span class="koboSpan" id="kobo.1232.1"> section to edit the Spanish translations. </span><span class="koboSpan" id="kobo.1232.2">You should see a list of translation strings, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1233.1"><img alt="" role="presentation" src="../Images/B21088_11_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1234.1">Figure 11.3: Editing Spanish translations using Rosetta</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1235.1">You can</span><a id="_idIndexMarker1031"/><span class="koboSpan" id="kobo.1236.1"> enter the translations in the </span><strong class="screenText"><span class="koboSpan" id="kobo.1237.1">SPANISH</span></strong><span class="koboSpan" id="kobo.1238.1"> column. </span><span class="koboSpan" id="kobo.1238.2">The </span><strong class="screenText"><span class="koboSpan" id="kobo.1239.1">OCCURRENCE(S)</span></strong><span class="koboSpan" id="kobo.1240.1"> column displays the files and lines of code where each translation string was found.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1241.1">Translations that include placeholders will appear as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1242.1"><img alt="" role="presentation" src="../Images/B21088_11_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1243.1">Figure 11.4: Translations including placeholders</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1244.1">Rosetta uses a different background color to display placeholders. </span><span class="koboSpan" id="kobo.1244.2">When you translate content, make sure that you keep placeholders untranslated. </span><span class="koboSpan" id="kobo.1244.3">For example, take the following string:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1245.1">%(items)s items, $%(total)s
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1246.1">It can be translated into Spanish as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1247.1">%(items)s productos, $%(total)s
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1248.1">You can take a look at the source code that comes with this chapter to use the same Spanish translations for your project.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1249.1">When you</span><a id="_idIndexMarker1032"/><span class="koboSpan" id="kobo.1250.1"> finish editing translations, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1251.1">Save and translate next block</span></strong><span class="koboSpan" id="kobo.1252.1"> button to save the translations to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1253.1">.po</span></code><span class="koboSpan" id="kobo.1254.1"> file. </span><span class="koboSpan" id="kobo.1254.2">Rosetta compiles the message file when you save translations, so there is no need for you to run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1255.1">compilemessages</span></code><span class="koboSpan" id="kobo.1256.1"> command. </span><span class="koboSpan" id="kobo.1256.2">However, Rosetta requires write access to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1257.1">locale</span></code><span class="koboSpan" id="kobo.1258.1"> directories to write the message files. </span><span class="koboSpan" id="kobo.1258.2">Make sure that the directories have valid permissions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1259.1">If you want other users to be able to edit translations, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1260.1">http://127.0.0.1:8000/admin/auth/group/add/</span></code><span class="koboSpan" id="kobo.1261.1"> in your browser and create a new group named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1262.1">translators</span></code><span class="koboSpan" id="kobo.1263.1">. </span><span class="koboSpan" id="kobo.1263.2">Then, access </span><code class="inlineCode"><span class="koboSpan" id="kobo.1264.1">http://127.0.0.1:8000/admin/auth/user/</span></code><span class="koboSpan" id="kobo.1265.1"> to edit the users to whom you want to grant permissions so that they can edit translations. </span><span class="koboSpan" id="kobo.1265.2">When editing a user, under the </span><strong class="screenText"><span class="koboSpan" id="kobo.1266.1">Permissions</span></strong><span class="koboSpan" id="kobo.1267.1"> section, add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1268.1">translators</span></code><span class="koboSpan" id="kobo.1269.1"> group to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1270.1">Chosen Groups</span></strong><span class="koboSpan" id="kobo.1271.1"> for each user. </span><span class="koboSpan" id="kobo.1271.2">Rosetta is only available to superusers or users who belong to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1272.1">translators</span></code><span class="koboSpan" id="kobo.1273.1"> group.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1274.1">You can read Rosetta’s documentation </span><a id="_idIndexMarker1033"/><span class="koboSpan" id="kobo.1275.1">at </span><a href="https://django-rosetta.readthedocs.io/"><span class="url"><span class="koboSpan" id="kobo.1276.1">https://django-rosetta.readthedocs.io/</span></span></a><span class="koboSpan" id="kobo.1277.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1278.1">When you add new translations to your production environment, if you serve Django with a real web server, you will have to reload your server after running the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1279.1">compilemessages</span></code><span class="koboSpan" id="kobo.1280.1"> command, or after saving the translations with Rosetta, for any changes to take effect.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1281.1">When editing translations, a translation can be marked as </span><em class="italic"><span class="koboSpan" id="kobo.1282.1">fuzzy</span></em><span class="koboSpan" id="kobo.1283.1">. </span><span class="koboSpan" id="kobo.1283.2">Let’s review what fuzzy translations are.</span></p>
<h1 class="heading-1" id="_idParaDest-315"><span class="koboSpan" id="kobo.1284.1">Fuzzy translations</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1285.1">When editing </span><a id="_idIndexMarker1034"/><span class="koboSpan" id="kobo.1286.1">translations in Rosetta, you can see a </span><strong class="screenText"><span class="koboSpan" id="kobo.1287.1">FUZZY</span></strong><span class="koboSpan" id="kobo.1288.1"> column. </span><span class="koboSpan" id="kobo.1288.2">This is not a Rosetta</span><a id="_idIndexMarker1035"/><span class="koboSpan" id="kobo.1289.1"> feature; it is provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1290.1">gettext</span></code><span class="koboSpan" id="kobo.1291.1">. </span><span class="koboSpan" id="kobo.1291.2">If the </span><strong class="screenText"><span class="koboSpan" id="kobo.1292.1">FUZZY</span></strong><span class="koboSpan" id="kobo.1293.1"> flag is active for a translation, it will not be included in the compiled message files. </span><span class="koboSpan" id="kobo.1293.2">This flag marks translation strings that need to be reviewed by a translator. </span><span class="koboSpan" id="kobo.1293.3">When </span><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">.po</span></code><span class="koboSpan" id="kobo.1295.1"> files are updated with new translation strings, it is possible that some translation strings will automatically be flagged as fuzzy. </span><span class="koboSpan" id="kobo.1295.2">This happens when </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1">gettext</span></code><span class="koboSpan" id="kobo.1297.1"> finds some </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">msgid</span></code><span class="koboSpan" id="kobo.1299.1"> that has been slightly modified. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1">gettext</span></code><span class="koboSpan" id="kobo.1301.1"> pairs it with what it thinks was the old translation and flags it as fuzzy for review. </span><span class="koboSpan" id="kobo.1301.2">The translator should then review the fuzzy translations, remove the </span><strong class="screenText"><span class="koboSpan" id="kobo.1302.1">FUZZY</span></strong><span class="koboSpan" id="kobo.1303.1"> flag, and compile the translation file again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1304.1">You have translated your project’s interface, but internationalization doesn’t stop there. </span><span class="koboSpan" id="kobo.1304.2">You can also translate URL patterns, offering custom URLs tailored for each supported language.</span></p>
<h1 class="heading-1" id="_idParaDest-316"><span class="koboSpan" id="kobo.1305.1">URL patterns for internationalization</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1306.1">Django offers </span><a id="_idIndexMarker1036"/><span class="koboSpan" id="kobo.1307.1">internationalization capabilities for URLs. </span><span class="koboSpan" id="kobo.1307.2">It includes</span><a id="_idIndexMarker1037"/><span class="koboSpan" id="kobo.1308.1"> two main features for internationalized URLs:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1309.1">A language prefix in URL patterns</span></strong><span class="koboSpan" id="kobo.1310.1">: Adding a language prefix to URLs to serve each language version under a different base URL</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1311.1">Translated URL patterns</span></strong><span class="koboSpan" id="kobo.1312.1">: Translating URL patterns so that every URL is different for each language</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1313.1">One reason for translating URLs is to optimize your site for search engines. </span><span class="koboSpan" id="kobo.1313.2">By adding a language prefix to your patterns, you will be able to index a URL for each language instead of a single URL for all of them. </span><span class="koboSpan" id="kobo.1313.3">Furthermore, by translating URLs into each language, you will provide search engines with URLs that will rank better for each language.</span></p>
<h2 class="heading-2" id="_idParaDest-317"><span class="koboSpan" id="kobo.1314.1">Adding a language prefix to URL patterns</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1315.1">Django</span><a id="_idIndexMarker1038"/><span class="koboSpan" id="kobo.1316.1"> allows you to add a language prefix to your URL</span><a id="_idIndexMarker1039"/><span class="koboSpan" id="kobo.1317.1"> patterns. </span><span class="koboSpan" id="kobo.1317.2">For example, the English version of your site can be served by a path starting with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1318.1">/en/</span></code><span class="koboSpan" id="kobo.1319.1">, and the Spanish version under </span><code class="inlineCode"><span class="koboSpan" id="kobo.1320.1">/es/</span></code><span class="koboSpan" id="kobo.1321.1">. </span><span class="koboSpan" id="kobo.1321.2">To use languages in URL patterns, you have to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1322.1">LocaleMiddleware</span></code><span class="koboSpan" id="kobo.1323.1"> provided by Django. </span><span class="koboSpan" id="kobo.1323.2">The framework will use it to identify the current language from the requested URL. </span><span class="koboSpan" id="kobo.1323.3">Previously, you added it to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1324.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.1325.1"> setting of your project, so you don’t need to do it now.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1326.1">Let’s add a</span><a id="_idIndexMarker1040"/><span class="koboSpan" id="kobo.1327.1"> language </span><a id="_idIndexMarker1041"/><span class="koboSpan" id="kobo.1328.1">prefix to your URL patterns:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1329.1">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1330.1">urls.py</span></code><span class="koboSpan" id="kobo.1331.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1332.1">myshop</span></code><span class="koboSpan" id="kobo.1333.1"> project and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.1334.1">i18n_patterns()</span></code><span class="koboSpan" id="kobo.1335.1">, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1336.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1337.1"> django.conf.urls.i18n </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1338.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1339.1"> i18n_patterns</span></strong></span><span class="koboSpan" id="kobo.1340.1">
urlpatterns = </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1341.1">i18n_patterns(</span></strong></span><span class="koboSpan" id="kobo.1342.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1343.1">'admin/'</span></span><span class="koboSpan" id="kobo.1344.1">, admin.site.urls),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1345.1">'cart/'</span></span><span class="koboSpan" id="kobo.1346.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1347.1">'cart.urls'</span></span><span class="koboSpan" id="kobo.1348.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1349.1">'cart'</span></span><span class="koboSpan" id="kobo.1350.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1351.1">'orders/'</span></span><span class="koboSpan" id="kobo.1352.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1353.1">'orders.urls'</span></span><span class="koboSpan" id="kobo.1354.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1355.1">'orders'</span></span><span class="koboSpan" id="kobo.1356.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1357.1">'payment/'</span></span><span class="koboSpan" id="kobo.1358.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1359.1">'payment.urls'</span></span><span class="koboSpan" id="kobo.1360.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1361.1">'payment'</span></span><span class="koboSpan" id="kobo.1362.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1363.1">'coupons/'</span></span><span class="koboSpan" id="kobo.1364.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1365.1">'coupons.urls'</span></span><span class="koboSpan" id="kobo.1366.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1367.1">'coupons'</span></span><span class="koboSpan" id="kobo.1368.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1369.1">'rosetta/'</span></span><span class="koboSpan" id="kobo.1370.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1371.1">'rosetta.urls'</span></span><span class="koboSpan" id="kobo.1372.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1373.1">''</span></span><span class="koboSpan" id="kobo.1374.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1375.1">'shop.urls'</span></span><span class="koboSpan" id="kobo.1376.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1377.1">'shop'</span></span><span class="koboSpan" id="kobo.1378.1">)),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1379.1">)</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1380.1">You can combine non-translatable standard URL patterns and patterns under </span><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1">i18n_patterns</span></code><span class="koboSpan" id="kobo.1382.1"> so that some patterns include a language prefix and others don’t. </span><span class="koboSpan" id="kobo.1382.2">However, it’s better to use translated URLs only to avoid the possibility that a carelessly translated URL matches a non-translated URL pattern.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1383.1">Run the development server and open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1384.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.1385.1"> in your browser. </span><span class="koboSpan" id="kobo.1385.2">Django will perform the steps described in the </span><em class="italic"><span class="koboSpan" id="kobo.1386.1">How Django determines the current language</span></em><span class="koboSpan" id="kobo.1387.1"> section to determine the current language, and it will redirect you to the requested URL, including the language prefix. </span><span class="koboSpan" id="kobo.1387.2">Take a look at the URL in your browser; it should now look like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1388.1">http://127.0.0.1:8000/en/</span></code><span class="koboSpan" id="kobo.1389.1">. </span><span class="koboSpan" id="kobo.1389.2">The current language is the one set by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1390.1">Accept-Language</span></code><span class="koboSpan" id="kobo.1391.1"> header of your browser if it is Spanish or English; otherwise, it is the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.1392.1">LANGUAGE_CODE</span></code><span class="koboSpan" id="kobo.1393.1"> (English) defined in your settings.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1394.1">You have </span><a id="_idIndexMarker1042"/><span class="koboSpan" id="kobo.1395.1">added a language prefix to your URLs, generating </span><a id="_idIndexMarker1043"/><span class="koboSpan" id="kobo.1396.1">a different URL for each language available. </span><span class="koboSpan" id="kobo.1396.2">This helps you to index different versions in search engines.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1397.1">Next, we are going to translate URL patterns so that we can add fully translated URLs to our site.</span></p>
<h2 class="heading-2" id="_idParaDest-318"><span class="koboSpan" id="kobo.1398.1">Translating URL patterns</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1399.1">Django supports translated</span><a id="_idIndexMarker1044"/><span class="koboSpan" id="kobo.1400.1"> strings in URL patterns. </span><span class="koboSpan" id="kobo.1400.2">You can use a different translation for each language for a single URL pattern. </span><span class="koboSpan" id="kobo.1400.3">You can mark URL patterns for translation in the same way you would with literals, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1401.1">gettext_lazy()</span></code><span class="koboSpan" id="kobo.1402.1"> function. </span><span class="koboSpan" id="kobo.1402.2">To do this, follow these steps:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1403.1">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1404.1">urls.py</span></code><span class="koboSpan" id="kobo.1405.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1406.1">myshop</span></code><span class="koboSpan" id="kobo.1407.1"> project and add translation strings to the regular expressions of the URL patterns for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1408.1">cart</span></code><span class="koboSpan" id="kobo.1409.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1410.1">orders</span></code><span class="koboSpan" id="kobo.1411.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1412.1">payment</span></code><span class="koboSpan" id="kobo.1413.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1414.1">coupons</span></code><span class="koboSpan" id="kobo.1415.1"> applications, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1416.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1417.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1418.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1419.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1420.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1421.1"> _</span></strong></span><span class="koboSpan" id="kobo.1422.1">
urlpatterns = i18n_patterns(
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1423.1">'admin/'</span></span><span class="koboSpan" id="kobo.1424.1">, admin.site.urls),
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1425.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1426.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1427.1">cart/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1428.1">)</span></strong></span><span class="koboSpan" id="kobo.1429.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1430.1">'cart.urls'</span></span><span class="koboSpan" id="kobo.1431.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1432.1">'cart'</span></span><span class="koboSpan" id="kobo.1433.1">)),
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1434.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1435.1">'orders/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1436.1">)</span></strong></span><span class="koboSpan" id="kobo.1437.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1438.1">'orders.urls'</span></span><span class="koboSpan" id="kobo.1439.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1440.1">'orders'</span></span><span class="koboSpan" id="kobo.1441.1">)),
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1442.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1443.1">'payment/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1444.1">)</span></strong></span><span class="koboSpan" id="kobo.1445.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1446.1">'payment.urls'</span></span><span class="koboSpan" id="kobo.1447.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1448.1">'payment'</span></span><span class="koboSpan" id="kobo.1449.1">)),
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1450.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1451.1">'coupons/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1452.1">)</span></strong></span><span class="koboSpan" id="kobo.1453.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1454.1">'coupons.urls'</span></span><span class="koboSpan" id="kobo.1455.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1456.1">'coupons'</span></span><span class="koboSpan" id="kobo.1457.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1458.1">'rosetta/'</span></span><span class="koboSpan" id="kobo.1459.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1460.1">'rosetta.urls'</span></span><span class="koboSpan" id="kobo.1461.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1462.1">''</span></span><span class="koboSpan" id="kobo.1463.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1464.1">'shop.urls'</span></span><span class="koboSpan" id="kobo.1465.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1466.1">'shop'</span></span><span class="koboSpan" id="kobo.1467.1">)),
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1468.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1">urls.py</span></code><span class="koboSpan" id="kobo.1470.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1471.1">orders</span></code><span class="koboSpan" id="kobo.1472.1"> application and mark the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1473.1">order_create</span></code><span class="koboSpan" id="kobo.1474.1"> URL pattern for translation, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1475.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1476.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1477.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1478.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1479.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1480.1"> _</span></strong></span><span class="koboSpan" id="kobo.1481.1">
urlpatterns = [
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1482.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1483.1">'create/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1484.1">)</span></strong></span><span class="koboSpan" id="kobo.1485.1">, views.order_create, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1486.1">'order_create'</span></span><span class="koboSpan" id="kobo.1487.1">),
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1488.1"># ...</span></span><span class="koboSpan" id="kobo.1489.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1490.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1491.1">urls.py</span></code><span class="koboSpan" id="kobo.1492.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1493.1">payment</span></code><span class="koboSpan" id="kobo.1494.1"> application and change the code to the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1495.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1496.1"> django.utils.translation </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1497.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1498.1"> gettext_lazy </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1499.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1500.1"> _</span></strong></span><span class="koboSpan" id="kobo.1501.1">
urlpatterns = [
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1502.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1503.1">'process/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1504.1">)</span></strong></span><span class="koboSpan" id="kobo.1505.1">, views.payment_process, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1506.1">'process'</span></span><span class="koboSpan" id="kobo.1507.1">),
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1508.1">_(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1509.1">'</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1510.1">completed/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1511.1">)</span></strong></span><span class="koboSpan" id="kobo.1512.1">, views.payment_completed, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1513.1">'completed'</span></span><span class="koboSpan" id="kobo.1514.1">),
    path(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1515.1">_(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1516.1">'canceled/'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1517.1">)</span></strong></span><span class="koboSpan" id="kobo.1518.1">, views.payment_canceled, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1519.1">'canceled'</span></span><span class="koboSpan" id="kobo.1520.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1521.1">'webhook/'</span></span><span class="koboSpan" id="kobo.1522.1">, webhooks.stripe_webhook, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1523.1">'stripe-webhook'</span></span><span class="koboSpan" id="kobo.1524.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1525.1">Note that these</span><a id="_idIndexMarker1045"/><span class="koboSpan" id="kobo.1526.1"> URL patterns will include a language prefix because they are included under </span><code class="inlineCode"><span class="koboSpan" id="kobo.1527.1">i18n_patterns()</span></code><span class="koboSpan" id="kobo.1528.1"> in the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1529.1">urls.py</span></code><span class="koboSpan" id="kobo.1530.1"> file of the project. </span><span class="koboSpan" id="kobo.1530.2">This will make each URL pattern have a different URI for each available language, one starting with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1531.1">/en/</span></code><span class="koboSpan" id="kobo.1532.1">, another one with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1533.1">/es/</span></code><span class="koboSpan" id="kobo.1534.1">, and so on. </span><span class="koboSpan" id="kobo.1534.2">However, we need a single URL for Stripe to notify events, and we need to avoid language prefixes in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1535.1">webhook</span></code><span class="koboSpan" id="kobo.1536.1"> URL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1537.1">Remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1538.1">webhook</span></code><span class="koboSpan" id="kobo.1539.1"> URL pattern from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1540.1">urls.py</span></code><span class="koboSpan" id="kobo.1541.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1542.1">payment</span></code><span class="koboSpan" id="kobo.1543.1"> application. </span><span class="koboSpan" id="kobo.1543.2">The file should now look like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1544.1">from</span></span><span class="koboSpan" id="kobo.1545.1"> django.utils.translation </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1546.1">import</span></span><span class="koboSpan" id="kobo.1547.1"> gettext_lazy </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1548.1">as</span></span><span class="koboSpan" id="kobo.1549.1"> _
urlpatterns = [
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1550.1">'process/'</span></span><span class="koboSpan" id="kobo.1551.1">), views.payment_process, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1552.1">'process'</span></span><span class="koboSpan" id="kobo.1553.1">),
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1554.1">'completed/'</span></span><span class="koboSpan" id="kobo.1555.1">), views.payment_completed, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1556.1">'completed'</span></span><span class="koboSpan" id="kobo.1557.1">),
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1558.1">'canceled/'</span></span><span class="koboSpan" id="kobo.1559.1">), views.payment_canceled, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1560.1">'canceled'</span></span><span class="koboSpan" id="kobo.1561.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1562.1">Then, add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1563.1">webhook</span></code><span class="koboSpan" id="kobo.1564.1"> URL pattern to the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1565.1">urls.py</span></code><span class="koboSpan" id="kobo.1566.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1567.1">myshop</span></code><span class="koboSpan" id="kobo.1568.1"> project. </span><span class="koboSpan" id="kobo.1568.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1569.1">from</span></span><span class="koboSpan" id="kobo.1570.1"> django.utils.translation </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1571.1">import</span></span><span class="koboSpan" id="kobo.1572.1"> gettext_lazy </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1573.1">as</span></span><span class="koboSpan" id="kobo.1574.1"> _
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1575.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1576.1"> payment </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1577.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1578.1"> webhooks</span></strong></span><span class="koboSpan" id="kobo.1579.1">
urlpatterns = i18n_patterns(
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1580.1">'admin/'</span></span><span class="koboSpan" id="kobo.1581.1">, admin.site.urls),
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1582.1">'cart/'</span></span><span class="koboSpan" id="kobo.1583.1">), include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1584.1">'cart.urls'</span></span><span class="koboSpan" id="kobo.1585.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1586.1">'cart'</span></span><span class="koboSpan" id="kobo.1587.1">)),
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1588.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1589.1">orders/'</span></span><span class="koboSpan" id="kobo.1590.1">), include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1591.1">'orders.urls'</span></span><span class="koboSpan" id="kobo.1592.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1593.1">'orders'</span></span><span class="koboSpan" id="kobo.1594.1">)),
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1595.1">'payment/'</span></span><span class="koboSpan" id="kobo.1596.1">), include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1597.1">'payment.urls'</span></span><span class="koboSpan" id="kobo.1598.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1599.1">'payment'</span></span><span class="koboSpan" id="kobo.1600.1">)),
    path(_(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1601.1">'coupons/'</span></span><span class="koboSpan" id="kobo.1602.1">), include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1603.1">'coupons.urls'</span></span><span class="koboSpan" id="kobo.1604.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1605.1">'coupons'</span></span><span class="koboSpan" id="kobo.1606.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1607.1">'rosetta/'</span></span><span class="koboSpan" id="kobo.1608.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1609.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1610.1">rosetta.urls'</span></span><span class="koboSpan" id="kobo.1611.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1612.1">''</span></span><span class="koboSpan" id="kobo.1613.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1614.1">'shop.urls'</span></span><span class="koboSpan" id="kobo.1615.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1616.1">'shop'</span></span><span class="koboSpan" id="kobo.1617.1">)),
)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1618.1">urlpatterns += [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1619.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1620.1">'payment/webhook/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1621.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1622.1">        webhooks.stripe_webhook,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1623.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1624.1">'stripe-webhook'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1625.1">    ),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1626.1">]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1627.1">if</span></span><span class="koboSpan" id="kobo.1628.1"> settings.DEBUG:
    urlpatterns += static(
        settings.MEDIA_URL, document_root=settings.MEDIA_ROOT
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1629.1">We have added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1630.1">webhook</span></code><span class="koboSpan" id="kobo.1631.1"> URL pattern to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1632.1">urlpatterns</span></code><span class="koboSpan" id="kobo.1633.1"> outside of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1634.1">i18n_patterns()</span></code><span class="koboSpan" id="kobo.1635.1"> to ensure we maintain a single URL for Stripe event notifications.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1636.1">You don’t need to translate the URL patterns of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1637.1">shop</span></code><span class="koboSpan" id="kobo.1638.1"> application, as they are built with variables and do not include any other literals.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1639.1">Open the shell and </span><a id="_idIndexMarker1046"/><span class="koboSpan" id="kobo.1640.1">run the next command to update the message files with the new translations:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1641.1">django-admin makemessages --all
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1642.1">Make sure the development server is running with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1643.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1644.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1645.1">http://127.0.0.1:8000/en/rosetta/</span></code><span class="koboSpan" id="kobo.1646.1"> in your browser and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1647.1">Myshop</span></strong><span class="koboSpan" id="kobo.1648.1"> link under</span><a id="_idIndexMarker1047"/><span class="koboSpan" id="kobo.1649.1"> the </span><strong class="screenText"><span class="koboSpan" id="kobo.1650.1">Spanish</span></strong><span class="koboSpan" id="kobo.1651.1"> section. </span><span class="koboSpan" id="kobo.1651.2">Click on </span><strong class="screenText"><span class="koboSpan" id="kobo.1652.1">UNTRANSLATED ONLY</span></strong><span class="koboSpan" id="kobo.1653.1"> to only see the strings that have not been translated yet. </span><span class="koboSpan" id="kobo.1653.2">Now, you will see the URL patterns for translation, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1654.1">Figure 11.5</span></em><span class="koboSpan" id="kobo.1655.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1656.1"><img alt="" role="presentation" src="../Images/B21088_11_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1657.1">Figure 11.5: URL patterns for translation in the Rosetta interface</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1658.1">Add a different translation string for each URL. </span><span class="koboSpan" id="kobo.1658.2">Don’t forget to include a slash character, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1659.1">/</span></code><span class="koboSpan" id="kobo.1660.1">, at the end of each URL, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1661.1">Figure 11.6</span></em><span class="koboSpan" id="kobo.1662.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1663.1"><img alt="" role="presentation" src="../Images/B21088_11_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1664.1">Figure 11.6: Spanish translations for URL patterns in the Rosetta interface</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1665.1">When you have finished, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1666.1">SAVE AND TRANSLATE NEXT BLOCK</span></strong><span class="koboSpan" id="kobo.1667.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1668.1">Then, click on </span><strong class="screenText"><span class="koboSpan" id="kobo.1669.1">FUZZY ONLY</span></strong><span class="koboSpan" id="kobo.1670.1">. </span><span class="koboSpan" id="kobo.1670.2">You will see translations that have been flagged as fuzzy because they were paired with the old translation of a similar original string. </span><span class="koboSpan" id="kobo.1670.3">In the</span><a id="_idIndexMarker1048"/><span class="koboSpan" id="kobo.1671.1"> case displayed in </span><em class="italic"><span class="koboSpan" id="kobo.1672.1">Figure 11.7</span></em><span class="koboSpan" id="kobo.1673.1">, the translations are incorrect and need to be corrected:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1674.1"><img alt="" role="presentation" src="../Images/B21088_11_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1675.1">Figure 11.7: Fuzzy translations in the Rosetta interface</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1676.1">Enter the correct text for the fuzzy translations. </span><span class="koboSpan" id="kobo.1676.2">Rosetta will automatically uncheck the </span><strong class="screenText"><span class="koboSpan" id="kobo.1677.1">FUZZY</span></strong><span class="koboSpan" id="kobo.1678.1"> select box when you enter new text for a translation. </span><span class="koboSpan" id="kobo.1678.2">When you have finished, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1679.1">SAVE AND TRANSLATE NEXT BLOCK</span></strong><span class="koboSpan" id="kobo.1680.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1681.1"><img alt="" role="presentation" src="../Images/B21088_11_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1682.1">Figure 11.8: Correcting fuzzy translations in the Rosetta interface</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1683.1">You can now go back to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1684.1">http://127.0.0.1:8000/en/rosetta/files/third-party/</span></code><span class="koboSpan" id="kobo.1685.1"> and edit the</span><a id="_idIndexMarker1049"/><span class="koboSpan" id="kobo.1686.1"> Spanish translation for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1687.1">orders</span></code><span class="koboSpan" id="kobo.1688.1"> application as well.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1689.1">After translating the strings into Spanish, our site will be available in two languages. </span><span class="koboSpan" id="kobo.1689.2">You have already learned how Django determines the current language. </span><span class="koboSpan" id="kobo.1689.3">However, users may wish to switch languages. </span><span class="koboSpan" id="kobo.1689.4">Let’s create the functionality that allows users to change their language preference.</span></p>
<h1 class="heading-1" id="_idParaDest-319"><span class="koboSpan" id="kobo.1690.1">Allowing users to switch language</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1691.1">Since you are serving</span><a id="_idIndexMarker1050"/><span class="koboSpan" id="kobo.1692.1"> content that is available in multiple languages, you should let your users switch the site’s language. </span><span class="koboSpan" id="kobo.1692.2">You are going to add a language selector to your site. </span><span class="koboSpan" id="kobo.1692.3">The language selector will consist of a list of available languages displayed using links.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1693.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1694.1">shop/base.html</span></code><span class="koboSpan" id="kobo.1695.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1696.1">shop</span></code><span class="koboSpan" id="kobo.1697.1"> application and locate the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1698.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1699.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1700.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1701.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1702.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1703.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1704.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1705.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1706.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1707.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1708.1">"/"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1709.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1710.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1711.1">"logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1712.1">&gt;</span></span><span class="koboSpan" id="kobo.1713.1">{% translate "My shop" %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1714.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1715.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1716.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1717.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1718.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1719.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1720.1">Replace</span><a id="_idIndexMarker1051"/><span class="koboSpan" id="kobo.1721.1"> them with the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1722.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1723.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1724.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1725.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1726.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1727.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1728.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1729.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1730.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1731.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1732.1">"/"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1733.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1734.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1735.1">"logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1736.1">&gt;</span></span><span class="koboSpan" id="kobo.1737.1">{% translate "My shop" %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1738.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1739.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1740.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1741.1">  {% get_current_language as LANGUAGE_CODE %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1742.1">  {% get_available_languages as LANGUAGES %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1743.1">  {% get_language_info_list for LANGUAGES as languages %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1744.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1745.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1746.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1747.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1748.1">"languages"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1749.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1750.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1751.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1752.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1753.1">{% translate "Language" %}:</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1754.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1755.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1756.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1757.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1758.1">ul</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1759.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1760.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1761.1">"languages"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1762.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1763.1">      {% for language in languages %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1764.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1765.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1766.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1767.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1768.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1769.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1770.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1771.1">"/{{ language.code }}/"</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1772.1">          {% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1773.1">if</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1774.1">language.code</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1775.1"> == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1776.1">LANGUAGE_CODE</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1777.1"> %} </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1778.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1779.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1780.1">"selected"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1781.1">{% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1782.1">endif</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1783.1"> %}&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1784.1">            {{ language.name_local }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1785.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1786.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1787.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1788.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1789.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1790.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1791.1">      {% endfor %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1792.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1793.1">ul</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1794.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1795.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1796.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1797.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1798.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1799.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1800.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1801.1">Make sure that no template tag is split into multiple lines.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1802.1">This is how you build your language selector:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1803.1">You load the internationalization tags using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1804.1">{% load i18n %}</span></code><span class="koboSpan" id="kobo.1805.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1806.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1807.1">{% get_current_language %}</span></code><span class="koboSpan" id="kobo.1808.1"> tag to retrieve the current language.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1809.1">You get the languages defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1810.1">LANGUAGES</span></code><span class="koboSpan" id="kobo.1811.1"> setting using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1812.1">{% get_available_languages %}</span></code><span class="koboSpan" id="kobo.1813.1"> template tag.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1814.1">You use the tag </span><code class="inlineCode"><span class="koboSpan" id="kobo.1815.1">{% get_language_info_list %}</span></code><span class="koboSpan" id="kobo.1816.1"> to provide easy access to the language attributes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1817.1">You build an HTML list to display all available languages, and you add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1818.1">selected</span></code><span class="koboSpan" id="kobo.1819.1"> class attribute to the currently active language.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1820.1">In the code for the language selector, you used the template tags provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1821.1">i18n</span></code><span class="koboSpan" id="kobo.1822.1">, based on the languages available in the settings of your project. </span><span class="koboSpan" id="kobo.1822.2">Now, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1823.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.1824.1"> in your browser and take a look. </span><span class="koboSpan" id="kobo.1824.2">You should see the language selector in the top </span><a id="_idIndexMarker1052"/><span class="koboSpan" id="kobo.1825.1">right-hand corner of the site, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1826.1"><img alt="" role="presentation" src="../Images/B21088_11_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1827.1">Figure 11.9: The product list page, including a language selector in the site header</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1828.1">Images in this chapter:</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.1829.1">Green tea</span></em><span class="koboSpan" id="kobo.1830.1">: Photo by Jia Ye on Unsplash</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.1831.1">Red tea</span></em><span class="koboSpan" id="kobo.1832.1">: Photo by Manki Kim on Unsplash</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.1833.1">Tea powder</span></em><span class="koboSpan" id="kobo.1834.1">: Photo by Phuong Nguyen on Unsplash</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1835.1">Users can now </span><a id="_idIndexMarker1053"/><span class="koboSpan" id="kobo.1836.1">effortlessly switch to their preferred language by selecting from the options available in the language selector.</span></p>
<h1 class="heading-1" id="_idParaDest-320"><span class="koboSpan" id="kobo.1837.1">Translating models with django-parler</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1838.1">Django does </span><a id="_idIndexMarker1054"/><span class="koboSpan" id="kobo.1839.1">not include built-in support to translate models. </span><span class="koboSpan" id="kobo.1839.2">To manage content in multiple languages, you can either develop a custom solution or opt for a third-party module that facilitates model translation. </span><span class="koboSpan" id="kobo.1839.3">There are several third-party applications available, each employing a unique method for storing and retrieving translations. </span><span class="koboSpan" id="kobo.1839.4">One of these applications is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1840.1">django-parler</span></code><span class="koboSpan" id="kobo.1841.1">. </span><span class="koboSpan" id="kobo.1841.2">This module provides a very effective approach for translating models and integrates smoothly with Django’s administration site.</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1842.1">django-parler</span></code><span class="koboSpan" id="kobo.1843.1"> generates a separate database table for each model that contains translations. </span><span class="koboSpan" id="kobo.1843.2">This table</span><a id="_idIndexMarker1055"/><span class="koboSpan" id="kobo.1844.1"> includes all the translated fields and a foreign key for the original object that the translation belongs to. </span><span class="koboSpan" id="kobo.1844.2">It also contains a language field, since each row stores the content for a single language.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1845.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1846.1">django-parler</span></code><span class="koboSpan" id="kobo.1847.1"> package has not received updates for several years. </span><span class="koboSpan" id="kobo.1847.2">Despite this, many developers continue to use it because of its proven effectiveness in facilitating model translations.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-321"><span class="koboSpan" id="kobo.1848.1">Installing django-parler</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1849.1">Install </span><code class="inlineCode"><span class="koboSpan" id="kobo.1850.1">django-parler</span></code><span class="koboSpan" id="kobo.1851.1"> via </span><code class="inlineCode"><span class="koboSpan" id="kobo.1852.1">pip</span></code><span class="koboSpan" id="kobo.1853.1"> using the</span><a id="_idIndexMarker1056"/><span class="koboSpan" id="kobo.1854.1"> following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1855.1">python -m pip install django-parler==2.3
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1856.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1857.1">settings.py</span></code><span class="koboSpan" id="kobo.1858.1"> file of your project and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.1859.1">'parler'</span></code><span class="koboSpan" id="kobo.1860.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1861.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1862.1"> setting, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1863.1">INSTALLED_APPS = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1864.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1865.1">'parler'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1866.1">,</span></strong></span><span class="koboSpan" id="kobo.1867.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1868.1">Also, add the following code to your settings:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1869.1"># django-parler settings</span></span><span class="koboSpan" id="kobo.1870.1">
PARLER_LANGUAGES = {
    </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1871.1">None</span></span><span class="koboSpan" id="kobo.1872.1">: (
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.1873.1">'code'</span></span><span class="koboSpan" id="kobo.1874.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1875.1">'en'</span></span><span class="koboSpan" id="kobo.1876.1">},
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.1877.1">'code'</span></span><span class="koboSpan" id="kobo.1878.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1879.1">'es'</span></span><span class="koboSpan" id="kobo.1880.1">},
    ),
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1881.1">'default'</span></span><span class="koboSpan" id="kobo.1882.1">: {
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1883.1">'fallback'</span></span><span class="koboSpan" id="kobo.1884.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1885.1">'en'</span></span><span class="koboSpan" id="kobo.1886.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1887.1">'hide_untranslated'</span></span><span class="koboSpan" id="kobo.1888.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1889.1">False</span></span><span class="koboSpan" id="kobo.1890.1">,
    }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1891.1">This setting </span><a id="_idIndexMarker1057"/><span class="koboSpan" id="kobo.1892.1">defines the available languages, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1893.1">en</span></code><span class="koboSpan" id="kobo.1894.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1895.1">es</span></code><span class="koboSpan" id="kobo.1896.1">, for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1897.1">django-parler</span></code><span class="koboSpan" id="kobo.1898.1">. </span><span class="koboSpan" id="kobo.1898.2">You specify the default language, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1899.1">en</span></code><span class="koboSpan" id="kobo.1900.1">, and indicate that </span><code class="inlineCode"><span class="koboSpan" id="kobo.1901.1">django-parler</span></code><span class="koboSpan" id="kobo.1902.1"> should not hide untranslated content.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1903.1">Parler is now activated in our project. </span><span class="koboSpan" id="kobo.1903.2">Let’s add translation capabilities to our model fields.</span></p>
<h2 class="heading-2" id="_idParaDest-322"><span class="koboSpan" id="kobo.1904.1">Translating model fields</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1905.1">Let’s add translations </span><a id="_idIndexMarker1058"/><span class="koboSpan" id="kobo.1906.1">to your product catalog. </span><code class="inlineCode"><span class="koboSpan" id="kobo.1907.1">django-parler</span></code><span class="koboSpan" id="kobo.1908.1"> provides a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1909.1">TranslatableModel</span></code><span class="koboSpan" id="kobo.1910.1"> model class and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1911.1">TranslatedFields</span></code><span class="koboSpan" id="kobo.1912.1"> wrapper to translate model fields. </span><span class="koboSpan" id="kobo.1912.2">You can follow these instructions:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1913.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1914.1">models.py</span></code><span class="koboSpan" id="kobo.1915.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1916.1">shop</span></code><span class="koboSpan" id="kobo.1917.1"> application directory and add the following import:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1918.1">from</span></span><span class="koboSpan" id="kobo.1919.1"> parler.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1920.1">import</span></span><span class="koboSpan" id="kobo.1921.1"> TranslatableModel, TranslatedFields
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1922.1">Then, modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1923.1">Category</span></code><span class="koboSpan" id="kobo.1924.1"> model to make the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1925.1">name</span></code><span class="koboSpan" id="kobo.1926.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1927.1">slug</span></code><span class="koboSpan" id="kobo.1928.1"> fields translatable, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1929.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1930.1">Category</span></span><span class="koboSpan" id="kobo.1931.1">(</span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1932.1">TranslatableModel</span></strong></span><span class="koboSpan" id="kobo.1933.1">):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1934.1">    translations = TranslatedFields(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong></span><span class="koboSpan" id="kobo.1935.1">       name = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1936.1">200</span></span><span class="koboSpan" id="kobo.1937.1">)</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1938.1">,</span></strong></span><span class="koboSpan" id="kobo.1939.1">
        slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1940.1">200</span></span><span class="koboSpan" id="kobo.1941.1">, unique=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1942.1">True</span></span><span class="koboSpan" id="kobo.1943.1">)</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1944.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1945.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1946.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1947.1">Category</span></code><span class="koboSpan" id="kobo.1948.1"> model now inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1949.1">TranslatableModel</span></code><span class="koboSpan" id="kobo.1950.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1951.1">models.Model</span></code><span class="koboSpan" id="kobo.1952.1">, and both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1953.1">name</span></code><span class="koboSpan" id="kobo.1954.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1955.1">slug</span></code><span class="koboSpan" id="kobo.1956.1"> fields are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1957.1">TranslatedFields</span></code><span class="koboSpan" id="kobo.1958.1"> wrapper.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1959.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1960.1">Product</span></code><span class="koboSpan" id="kobo.1961.1"> model to add translations for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1962.1">name</span></code><span class="koboSpan" id="kobo.1963.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1964.1">slug</span></code><span class="koboSpan" id="kobo.1965.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1966.1">description</span></code><span class="koboSpan" id="kobo.1967.1"> fields, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1968.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1969.1">Product</span></span><span class="koboSpan" id="kobo.1970.1">(</span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1971.1">TranslatableModel</span></strong></span><span class="koboSpan" id="kobo.1972.1">):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1973.1">    translations = TranslatedFields(</span></strong></span><span class="koboSpan" id="kobo.1974.1">
        name = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1975.1">200</span></span><span class="koboSpan" id="kobo.1976.1">)</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1977.1">,</span></strong></span><span class="koboSpan" id="kobo.1978.1">
        slug = models.SlugField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1979.1">200</span></span><span class="koboSpan" id="kobo.1980.1">)</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1981.1">,</span></strong></span><span class="koboSpan" id="kobo.1982.1">
        description = models.TextField(blank=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1983.1">True</span></span><span class="koboSpan" id="kobo.1984.1">)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1985.1">    )</span></strong></span><span class="koboSpan" id="kobo.1986.1">
    category = models.ForeignKey(
        Category,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1987.1">'products'</span></span><span class="koboSpan" id="kobo.1988.1">,
        on_delete=models.CASCADE
    )
    image = models.ImageField(
        upload_to=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1989.1">'products/%Y/%m/%d'</span></span><span class="koboSpan" id="kobo.1990.1">,
        blank=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1991.1">True</span></span><span class="koboSpan" id="kobo.1992.1">
    )
    price = models.DecimalField(max_digits=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1993.1">10</span></span><span class="koboSpan" id="kobo.1994.1">, decimal_places=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1995.1">2</span></span><span class="koboSpan" id="kobo.1996.1">)
    available = models.BooleanField(default=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1997.1">True</span></span><span class="koboSpan" id="kobo.1998.1">)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1999.1">True</span></span><span class="koboSpan" id="kobo.2000.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2001.1">True</span></span><span class="koboSpan" id="kobo.2002.1">)
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2003.1">django-parler</span></code><span class="koboSpan" id="kobo.2004.1"> manages </span><a id="_idIndexMarker1059"/><span class="koboSpan" id="kobo.2005.1">translations by generating another model for each translatable model. </span><span class="koboSpan" id="kobo.2005.2">In the following schema, you can see the fields of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2006.1">Product</span></code><span class="koboSpan" id="kobo.2007.1"> model and what the generated </span><code class="inlineCode"><span class="koboSpan" id="kobo.2008.1">ProductTranslation</span></code><span class="koboSpan" id="kobo.2009.1"> model will look like:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2010.1"><img alt="" role="presentation" src="../Images/B21088_11_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2011.1">Figure 11.10: The Product model and related ProductTranslation model generated by django-parler</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2012.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2013.1">ProductTranslation</span></code><span class="koboSpan" id="kobo.2014.1"> model generated by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2015.1">django-parler</span></code><span class="koboSpan" id="kobo.2016.1"> includes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2017.1">name</span></code><span class="koboSpan" id="kobo.2018.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2019.1">slug</span></code><span class="koboSpan" id="kobo.2020.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2021.1">description</span></code><span class="koboSpan" id="kobo.2022.1"> translatable fields, a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2023.1">language_code</span></code><span class="koboSpan" id="kobo.2024.1"> field, and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2025.1">ForeignKey</span></code><span class="koboSpan" id="kobo.2026.1"> for the master </span><code class="inlineCode"><span class="koboSpan" id="kobo.2027.1">Product</span></code><span class="koboSpan" id="kobo.2028.1"> object. </span><span class="koboSpan" id="kobo.2028.2">There is a one-to-many relationship from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2029.1">Product</span></code><span class="koboSpan" id="kobo.2030.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2031.1">ProductTranslation</span></code><span class="koboSpan" id="kobo.2032.1">. </span><span class="koboSpan" id="kobo.2032.2">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.2033.1">ProductTranslation</span></code><span class="koboSpan" id="kobo.2034.1"> object will exist for each available language of each </span><code class="inlineCode"><span class="koboSpan" id="kobo.2035.1">Product</span></code><span class="koboSpan" id="kobo.2036.1"> object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2037.1">Since </span><a id="_idIndexMarker1060"/><span class="koboSpan" id="kobo.2038.1">Django uses a separate table for translations, there are some Django features that you can’t use. </span><span class="koboSpan" id="kobo.2038.2">It is not possible to use a default order with a translated field. </span><span class="koboSpan" id="kobo.2038.3">You can filter by translated fields in queries, but you can’t include a translatable field in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2039.1">ordering Meta</span></code><span class="koboSpan" id="kobo.2040.1"> options. </span><span class="koboSpan" id="kobo.2040.2">Also, you can’t use indexes for the fields that are translated, as these fields will not exist in the original model because they will reside in the translation model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2041.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2042.1">models.py</span></code><span class="koboSpan" id="kobo.2043.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2044.1">shop</span></code><span class="koboSpan" id="kobo.2045.1"> application and comment out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2046.1">ordering</span></code><span class="koboSpan" id="kobo.2047.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2048.1">indexes</span></code><span class="koboSpan" id="kobo.2049.1"> attributes of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2050.1">Category Meta</span></code><span class="koboSpan" id="kobo.2051.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2052.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2053.1">Category</span></span><span class="koboSpan" id="kobo.2054.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2055.1">TranslatableModel</span></span><span class="koboSpan" id="kobo.2056.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2057.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2058.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2059.1">Meta</span></span><span class="koboSpan" id="kobo.2060.1">:
        </span><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2061.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2062.1"> ordering = ['name']</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2063.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2064.1"> indexes = [</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2065.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2066.1">     models.Index(fields=['name']),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2067.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2068.1"> ]</span></span><span class="koboSpan" id="kobo.2069.1">
        verbose_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2070.1">'category'</span></span><span class="koboSpan" id="kobo.2071.1">
        verbose_name_plural = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2072.1">'categories'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2073.1">You also have to comment out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2074.1">ordering</span></code><span class="koboSpan" id="kobo.2075.1"> and attribute of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2076.1">Product Meta</span></code><span class="koboSpan" id="kobo.2077.1"> class and the indexes that refer to the translated fields. </span><span class="koboSpan" id="kobo.2077.2">Comment out the following lines of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2078.1">Product Meta</span></code><span class="koboSpan" id="kobo.2079.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2080.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2081.1">Product</span></span><span class="koboSpan" id="kobo.2082.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2083.1">TranslatableModel</span></span><span class="koboSpan" id="kobo.2084.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2085.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2086.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2087.1">Meta</span></span><span class="koboSpan" id="kobo.2088.1">:
        </span><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2089.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2090.1"> ordering = ['name']</span></span><span class="koboSpan" id="kobo.2091.1">
        indexes = [
            </span><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2092.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2093.1"> models.Index(fields=['id', 'slug']),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2094.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.2095.1"> models.Index(fields=['name']),</span></span><span class="koboSpan" id="kobo.2096.1">
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2097.1">'-created'</span></span><span class="koboSpan" id="kobo.2098.1">]),
        ]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2099.1">You can read more about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2100.1">django-parler</span></code><span class="koboSpan" id="kobo.2101.1"> module’s compatibility </span><a id="_idIndexMarker1061"/><span class="koboSpan" id="kobo.2102.1">with Django at </span><a href="https://django-parler.readthedocs.io/en/latest/compatibility.html"><span class="url"><span class="koboSpan" id="kobo.2103.1">https://django-parler.readthedocs.io/en/latest/compatibility.html</span></span></a><span class="koboSpan" id="kobo.2104.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2105.1">Let’s continue by integrating the translatable models into the administration site.</span></p>
<h2 class="heading-2" id="_idParaDest-323"><span class="koboSpan" id="kobo.2106.1">Integrating translations into the administration site</span></h2>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2107.1">django-parler</span></code><span class="koboSpan" id="kobo.2108.1"> integrates </span><a id="_idIndexMarker1062"/><span class="koboSpan" id="kobo.2109.1">seamlessly with the Django administration site. </span><span class="koboSpan" id="kobo.2109.2">This allows you to easily edit different translations of your objects through the user-friendly admin interface. </span><span class="koboSpan" id="kobo.2109.3">It includes a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2110.1">TranslatableAdmin</span></code><span class="koboSpan" id="kobo.2111.1"> class that overrides the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2112.1">ModelAdmin</span></code><span class="koboSpan" id="kobo.2113.1"> class provided by Django to manage model translations.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2114.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2115.1">admin.py</span></code><span class="koboSpan" id="kobo.2116.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2117.1">shop</span></code><span class="koboSpan" id="kobo.2118.1"> application and add the following import to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2119.1">from</span></span><span class="koboSpan" id="kobo.2120.1"> parler.admin </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2121.1">import</span></span><span class="koboSpan" id="kobo.2122.1"> TranslatableAdmin
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2123.1">Modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2124.1">CategoryAdmin</span></code><span class="koboSpan" id="kobo.2125.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2126.1">ProductAdmin</span></code><span class="koboSpan" id="kobo.2127.1"> classes to inherit from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2128.1">TranslatableAdmin</span></code><span class="koboSpan" id="kobo.2129.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2130.1">ModelAdmin</span></code><span class="koboSpan" id="kobo.2131.1">. </span><span class="koboSpan" id="kobo.2131.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2132.1">django-parler</span></code><span class="koboSpan" id="kobo.2133.1"> module doesn’t support the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2134.1">prepopulated_fields</span></code><span class="koboSpan" id="kobo.2135.1"> attribute, but it does support the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2136.1">get_prepopulated_fields()</span></code><span class="koboSpan" id="kobo.2137.1"> method that provides the same functionality. </span><span class="koboSpan" id="kobo.2137.2">Let’s change this accordingly. </span><span class="koboSpan" id="kobo.2137.3">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2138.1">admin.py</span></code><span class="koboSpan" id="kobo.2139.1"> file to make it look like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2140.1">from</span></span><span class="koboSpan" id="kobo.2141.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2142.1">import</span></span><span class="koboSpan" id="kobo.2143.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2144.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2145.1"> parler.admin </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2146.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2147.1"> TranslatableAdmin</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2148.1">from</span></span><span class="koboSpan" id="kobo.2149.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2150.1">import</span></span><span class="koboSpan" id="kobo.2151.1"> Category, Product
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2152.1">@admin.register(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2153.1">Category</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.2154.1">)</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2155.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2156.1">CategoryAdmin</span></span><span class="koboSpan" id="kobo.2157.1">(</span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2158.1">TranslatableAdmin</span></strong></span><span class="koboSpan" id="kobo.2159.1">):
    list_display = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.2160.1">'name'</span></span><span class="koboSpan" id="kobo.2161.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2162.1">'slug'</span></span><span class="koboSpan" id="kobo.2163.1">]
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2164.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2165.1">get_prepopulated_fields</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2166.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2167.1">self, request, obj=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2168.1">None</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2169.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2170.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2171.1"> {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2172.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2173.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2174.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2175.1">,)}</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.2176.1">@admin.register(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2177.1">Product</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.2178.1">)</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2179.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2180.1">ProductAdmin</span></span><span class="koboSpan" id="kobo.2181.1">(</span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2182.1">TranslatableAdmin</span></strong></span><span class="koboSpan" id="kobo.2183.1">):
    list_display = [
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2184.1">'name'</span></span><span class="koboSpan" id="kobo.2185.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2186.1">'slug'</span></span><span class="koboSpan" id="kobo.2187.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2188.1">'price'</span></span><span class="koboSpan" id="kobo.2189.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2190.1">'available'</span></span><span class="koboSpan" id="kobo.2191.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2192.1">'created'</span></span><span class="koboSpan" id="kobo.2193.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2194.1">'updated'</span></span><span class="koboSpan" id="kobo.2195.1">
    ]
    list_filter = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.2196.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2197.1">available'</span></span><span class="koboSpan" id="kobo.2198.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2199.1">'created'</span></span><span class="koboSpan" id="kobo.2200.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2201.1">'updated'</span></span><span class="koboSpan" id="kobo.2202.1">]
    list_editable = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.2203.1">'price'</span></span><span class="koboSpan" id="kobo.2204.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2205.1">'available'</span></span><span class="koboSpan" id="kobo.2206.1">]
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2207.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2208.1">get_prepopulated_fields</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2209.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2210.1">self, request, obj=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2211.1">None</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2212.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2213.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2214.1"> {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2215.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2216.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2217.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2218.1">,)}</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2219.1">You have adapted</span><a id="_idIndexMarker1063"/><span class="koboSpan" id="kobo.2220.1"> the administration site to work with the new translated models. </span><span class="koboSpan" id="kobo.2220.2">You can now sync the database with the model changes that you made.</span></p>
<h2 class="heading-2" id="_idParaDest-324"><span class="koboSpan" id="kobo.2221.1">Creating migrations for model translations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2222.1">To create</span><a id="_idIndexMarker1064"/><span class="koboSpan" id="kobo.2223.1"> migrations, follow these instructions:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2224.1">Open the shell and run the following command to create a new migration for the model translations:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2225.1">python manage.py makemigrations shop --name "translations"
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2226.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2227.1">Migrations for 'shop':
  shop/migrations/0002_translations.py
    - Create model CategoryTranslation
    - Create model ProductTranslation
    - Change Meta options on category
    - Change Meta options on product
    - Remove index shop_catego_name_289c7e_idx from category
    - Remove index shop_produc_id_f21274_idx from product
    - Remove index shop_produc_name_a2070e_idx from product
    - Remove field name from category
    - Remove field slug from category
    - Remove field description from product
    - Remove field name from product
    - Remove field slug from product
    - Add field master to producttranslation
    - Add field master to categorytranslation
    - Alter unique_together for producttranslation (1 constraint(s))
    - Alter unique_together for categorytranslation (1 constraint(s))
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2228.1">This migration automatically includes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2229.1">CategoryTranslation</span></code><span class="koboSpan" id="kobo.2230.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2231.1">ProductTranslation</span></code><span class="koboSpan" id="kobo.2232.1"> models created dynamically by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2233.1">django-parler</span></code><span class="koboSpan" id="kobo.2234.1">. </span><span class="koboSpan" id="kobo.2234.2">It’s important to note that this migration deletes the previous existing fields from your models. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.2235.1">This means that you will lose that data and need to set your categories and products again on the administration site after running it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2236.1">Edit the </span><a id="_idIndexMarker1065"/><span class="koboSpan" id="kobo.2237.1">file </span><code class="inlineCode"><span class="koboSpan" id="kobo.2238.1">migrations/0002_translations.py</span></code><span class="koboSpan" id="kobo.2239.1"> of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2240.1">shop</span></code><span class="koboSpan" id="kobo.2241.1"> application and identify the two occurrences of the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2242.1">bases=(parler.models.TranslatedFieldsModelMixin, models.Model),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2243.1">Replace those occurrences with the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2244.1">bases=(parler.models.</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2245.1">TranslatableModel</span></strong></span><span class="koboSpan" id="kobo.2246.1">, models.Model),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2247.1">This is a fix for a minor issue found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2248.1">django-parler</span></code><span class="koboSpan" id="kobo.2249.1"> version you are using. </span><span class="koboSpan" id="kobo.2249.2">This change is necessary to prevent the migration from failing when applying it. </span><span class="koboSpan" id="kobo.2249.3">This issue is related to creating translations for existing fields in the model and shall be fixed in newer </span><code class="inlineCode"><span class="koboSpan" id="kobo.2250.1">django-parler</span></code><span class="koboSpan" id="kobo.2251.1"> versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2252.1">Run the following command to apply the migration:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2253.1">python manage.py migrate shop
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2254.1">You will see an output that ends with the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2255.1">Applying shop.0002_ categorytranslation_producttranslation_and_more... </span><span class="koboSpan" id="kobo.2255.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2256.1">Your models are now synchronized with the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2257.1">Run the development server using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2258.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2259.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2260.1">http://127.0.0.1:8000/en/admin/shop/category/</span></code><span class="koboSpan" id="kobo.2261.1"> in your browser. </span><span class="koboSpan" id="kobo.2261.2">You will see that existing categories lost their name and slug, due to deleting those fields and using the translatable models generated by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2262.1">django-parler</span></code><span class="koboSpan" id="kobo.2263.1"> instead. </span><span class="koboSpan" id="kobo.2263.2">You will just see a dash under each column, like in </span><em class="italic"><span class="koboSpan" id="kobo.2264.1">Figure 11.11</span></em><span class="koboSpan" id="kobo.2265.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2266.1"><img alt="" role="presentation" src="../Images/B21088_11_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2267.1">Figure 11.11: The category list on the Django administration site after creating the translation models</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2268.1">Click on the </span><a id="_idIndexMarker1066"/><span class="koboSpan" id="kobo.2269.1">dash under the category name to edit it. </span><span class="koboSpan" id="kobo.2269.2">You will see that the </span><strong class="screenText"><span class="koboSpan" id="kobo.2270.1">Change category</span></strong><span class="koboSpan" id="kobo.2271.1"> page includes two different tabs, one for English and one for Spanish translations:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2272.1"><img alt="" role="presentation" src="../Images/B21088_11_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2273.1">Figure 11.12: The category edit form, including the language tabs added by django-parler</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2274.1">Make sure that you fill in a name and slug for all existing categories. </span><span class="koboSpan" id="kobo.2274.2">When you edit a category, enter the English details and click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2275.1">Save and continue editing</span></strong><span class="koboSpan" id="kobo.2276.1">. </span><span class="koboSpan" id="kobo.2276.2">Then, click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2277.1">Spanish</span></strong><span class="koboSpan" id="kobo.2278.1">, add the Spanish translation for the fields, and click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2279.1">SAVE</span></strong><span class="koboSpan" id="kobo.2280.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2281.1"><img alt="" role="presentation" src="../Images/B21088_11_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2282.1">Figure 11.13: The Spanish translation of the category edit form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2283.1">Make sure to save the changes before switching between the language tabs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2284.1">After you</span><a id="_idIndexMarker1067"/><span class="koboSpan" id="kobo.2285.1"> complete the data for existing categories, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2286.1">http://127.0.0.1:8000/en/admin/shop/product/</span></code><span class="koboSpan" id="kobo.2287.1"> and edit each of the products, providing an English and Spanish name, a slug, and a description.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2288.1">Once the translations are in place, the next step will be to explore how to interact with the translated fields through the Django ORM.</span></p>
<h2 class="heading-2" id="_idParaDest-325"><span class="koboSpan" id="kobo.2289.1">Using translations in QuerySets</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2290.1">Let’s</span><a id="_idIndexMarker1068"/><span class="koboSpan" id="kobo.2291.1"> take a look at how to work with translations in QuerySets. </span><span class="koboSpan" id="kobo.2291.2">Run</span><a id="_idIndexMarker1069"/><span class="koboSpan" id="kobo.2292.1"> the following command to open the Python shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2293.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2294.1">Let’s take a look at how you can retrieve and query translation fields. </span><span class="koboSpan" id="kobo.2294.2">To get the object with translatable fields translated into a specific language, you can use Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2295.1">activate()</span></code><span class="koboSpan" id="kobo.2296.1"> function, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2297.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2298.1">from</span></span><span class="language-python"><span class="koboSpan" id="kobo.2299.1"> shop.models </span></span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2300.1">import</span></span><span class="language-python"><span class="koboSpan" id="kobo.2301.1"> Product</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.2302.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2303.1">from</span></span><span class="language-python"><span class="koboSpan" id="kobo.2304.1"> django.utils.translation </span></span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.2305.1">import</span></span><span class="language-python"><span class="koboSpan" id="kobo.2306.1"> activate</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.2307.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2308.1">activate(</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2309.1">'es'</span></span><span class="language-python"><span class="koboSpan" id="kobo.2310.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.2311.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2312.1">product=Product.objects.first()</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.2313.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2314.1">product.name</span></span><span class="koboSpan" id="kobo.2315.1">
'Té verde'
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2316.1">Another way to do this is by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2317.1">language()</span></code><span class="koboSpan" id="kobo.2318.1"> manager provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2319.1">django-parler</span></code><span class="koboSpan" id="kobo.2320.1">, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2321.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2322.1">product=Product.objects.language(</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2323.1">'en'</span></span><span class="language-python"><span class="koboSpan" id="kobo.2324.1">).first()</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.2325.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2326.1">product.name</span></span><span class="koboSpan" id="kobo.2327.1">
'Green tea'
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2328.1">When you </span><a id="_idIndexMarker1070"/><span class="koboSpan" id="kobo.2329.1">access translated fields, they are resolved using the</span><a id="_idIndexMarker1071"/><span class="koboSpan" id="kobo.2330.1"> current language. </span><span class="koboSpan" id="kobo.2330.2">You can set a different current language for an object to access that specific translation, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2331.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2332.1">product.set_current_language(</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2333.1">'es'</span></span><span class="language-python"><span class="koboSpan" id="kobo.2334.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.2335.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2336.1">product.name</span></span><span class="koboSpan" id="kobo.2337.1">
'Té verde'
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2338.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2339.1">product.get_current_language()</span></span><span class="koboSpan" id="kobo.2340.1">
'es'
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2341.1">When performing a QuerySet using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2342.1">filter()</span></code><span class="koboSpan" id="kobo.2343.1">, you can filter using the related translation objects with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2344.1">translations__</span></code><span class="koboSpan" id="kobo.2345.1"> syntax, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.2346.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.2347.1">Product.objects.</span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.2348.1">filter</span></span><span class="language-python"><span class="koboSpan" id="kobo.2349.1">(translations__name=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.2350.1">'Green tea'</span></span><span class="language-python"><span class="koboSpan" id="kobo.2351.1">)</span></span><span class="koboSpan" id="kobo.2352.1">
&lt;TranslatableQuerySet [&lt;Product: Té verde&gt;]&gt;	
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2353.1">Let’s apply what we have learned to our views.</span></p>
<h2 class="heading-2" id="_idParaDest-326"><span class="koboSpan" id="kobo.2354.1">Adapting views for translations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2355.1">Let’s </span><a id="_idIndexMarker1072"/><span class="koboSpan" id="kobo.2356.1">adapt the</span><a id="_idIndexMarker1073"/><span class="koboSpan" id="kobo.2357.1"> product catalog views:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2358.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2359.1">views.py</span></code><span class="koboSpan" id="kobo.2360.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2361.1">shop</span></code><span class="koboSpan" id="kobo.2362.1"> application and add the following code highlighted</span><a id="_idIndexMarker1074"/><span class="koboSpan" id="kobo.2363.1"> in bold</span><a id="_idIndexMarker1075"/><span class="koboSpan" id="kobo.2364.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2365.1">product_list</span></code><span class="koboSpan" id="kobo.2366.1"> view:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2367.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2368.1">product_list</span></span><span class="koboSpan" id="kobo.2369.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2370.1">request, category_slug=</span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.2371.1">None</span></span><span class="koboSpan" id="kobo.2372.1">):
    category = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2373.1">None</span></span><span class="koboSpan" id="kobo.2374.1">
    categories = Category.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2375.1">all</span></span><span class="koboSpan" id="kobo.2376.1">()
    products = Product.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2377.1">filter</span></span><span class="koboSpan" id="kobo.2378.1">(available=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2379.1">True</span></span><span class="koboSpan" id="kobo.2380.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2381.1">if</span></span><span class="koboSpan" id="kobo.2382.1"> category_slug:
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2383.1">        language = request.LANGUAGE_CODE</span></strong></span><span class="koboSpan" id="kobo.2384.1">
        category = get_object_or_404(
            Category,
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2385.1">            translations__language_code=language,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2386.1">            translations__</span></strong></span><span class="koboSpan" id="kobo.2387.1">slug=category_slug
        )
        products = products.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2388.1">filter</span></span><span class="koboSpan" id="kobo.2389.1">(category=category)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2390.1">return</span></span><span class="koboSpan" id="kobo.2391.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2392.1">'shop/product/list.html'</span></span><span class="koboSpan" id="kobo.2393.1">,
        {
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2394.1">'category'</span></span><span class="koboSpan" id="kobo.2395.1">: category,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2396.1">'categories'</span></span><span class="koboSpan" id="kobo.2397.1">: categories,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2398.1">'products'</span></span><span class="koboSpan" id="kobo.2399.1">: products
        }
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2400.1">Then, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2401.1">product_detail</span></code><span class="koboSpan" id="kobo.2402.1"> view and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2403.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2404.1">product_detail</span></span><span class="koboSpan" id="kobo.2405.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2406.1">request, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2407.1">id</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2408.1">, slug</span></span><span class="koboSpan" id="kobo.2409.1">):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2410.1">    language = request.LANGUAGE_CODE</span></strong></span><span class="koboSpan" id="kobo.2411.1">
    product = get_object_or_404(
        Product,
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2412.1">id</span></span><span class="koboSpan" id="kobo.2413.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2414.1">id</span></span><span class="koboSpan" id="kobo.2415.1">,
        </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2416.1">translations__language_code=language,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2417.1">        translations__</span></strong></span><span class="koboSpan" id="kobo.2418.1">slug=slug,
        available=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2419.1">True</span></span><span class="koboSpan" id="kobo.2420.1">
    )
    cart_product_form = CartAddProductForm()
    r = Recommender()
    recommended_products = r.suggest_products_for([product], </span><span class="hljs-number"><span class="koboSpan" id="kobo.2421.1">4</span></span><span class="koboSpan" id="kobo.2422.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2423.1">return</span></span><span class="koboSpan" id="kobo.2424.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2425.1">'shop/product/detail.html'</span></span><span class="koboSpan" id="kobo.2426.1">,
        {
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2427.1">'product'</span></span><span class="koboSpan" id="kobo.2428.1">: product,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2429.1">'cart_product_form'</span></span><span class="koboSpan" id="kobo.2430.1">: cart_product_form,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2431.1">'recommended_products'</span></span><span class="koboSpan" id="kobo.2432.1">: recommended_products
        }
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2433.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2434.1">product_list</span></code><span class="koboSpan" id="kobo.2435.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2436.1">product_detail</span></code><span class="koboSpan" id="kobo.2437.1"> views are now adapted to retrieve objects using translated fields.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2438.1">Run the </span><a id="_idIndexMarker1076"/><span class="koboSpan" id="kobo.2439.1">development </span><a id="_idIndexMarker1077"/><span class="koboSpan" id="kobo.2440.1">server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2441.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2442.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2443.1">http://127.0.0.1:8000/es/</span></code><span class="koboSpan" id="kobo.2444.1"> in your browser. </span><span class="koboSpan" id="kobo.2444.2">You should see the product list page, including all products translated into Spanish:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2445.1"><img alt="" role="presentation" src="../Images/B21088_11_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2446.1">Figure 11.14: The Spanish version of the product list page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2447.1">Now, each</span><a id="_idIndexMarker1078"/><span class="koboSpan" id="kobo.2448.1"> product’s</span><a id="_idIndexMarker1079"/><span class="koboSpan" id="kobo.2449.1"> URL is built using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2450.1">slug</span></code><span class="koboSpan" id="kobo.2451.1"> field translated into the current language. </span><span class="koboSpan" id="kobo.2451.2">For example, the URL for a product in Spanish is </span><code class="inlineCode"><span class="koboSpan" id="kobo.2452.1">http://127.0.0.1:8000/es/2/te-rojo/</span></code><span class="koboSpan" id="kobo.2453.1">, whereas, in English, the URL is </span><code class="inlineCode"><span class="koboSpan" id="kobo.2454.1">http://127.0.0.1:8000/en/2/red-tea/</span></code><span class="koboSpan" id="kobo.2455.1">. </span><span class="koboSpan" id="kobo.2455.2">If you navigate to a product details page, you will see the translated URL and the contents of the selected language, as shown in the following example:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2456.1"><img alt="" role="presentation" src="../Images/B21088_11_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2457.1">Figure 11.15: The Spanish version of the product details page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2458.1">If you want to know more </span><a id="_idIndexMarker1080"/><span class="koboSpan" id="kobo.2459.1">about </span><code class="inlineCode"><span class="koboSpan" id="kobo.2460.1">django-parler</span></code><span class="koboSpan" id="kobo.2461.1">, you can find the full documentation at </span><a href="https://django-parler.readthedocs.io/en/latest/"><span class="url"><span class="koboSpan" id="kobo.2462.1">https://django-parler.readthedocs.io/en/latest/</span></span></a><span class="koboSpan" id="kobo.2463.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2464.1">You have learned how to translate Python code, templates, URL patterns, and model fields. </span><span class="koboSpan" id="kobo.2464.2">To complete the internationalization and localization process, you need to use localized formatting for dates, times, and numbers as well.</span></p>
<h1 class="heading-1" id="_idParaDest-327"><span class="koboSpan" id="kobo.2465.1">Format localization</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2466.1">To enhance user experience, it’s </span><a id="_idIndexMarker1081"/><span class="koboSpan" id="kobo.2467.1">important to present dates, times, and numbers in formats that align with the user’s locale. </span><span class="koboSpan" id="kobo.2467.2">Adapting your site to the data formats familiar to users in various regions significantly improves its accessibility. </span><span class="koboSpan" id="kobo.2467.3">Since Django 5.0, localized formatting of data is always enabled. </span><span class="koboSpan" id="kobo.2467.4">Django displays numbers and dates using the format of the current locale.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2468.1">Django tries to use a locale-specific format whenever it outputs a value in a template. </span><em class="italic"><span class="koboSpan" id="kobo.2469.1">Figure 11.16</span></em><span class="koboSpan" id="kobo.2470.1"> shows the format localization for decimal numbers in the English and Spanish versions of the site:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2471.1"><img alt="" role="presentation" src="../Images/B21088_11_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2472.1">Figure 11.16: Format localization in English and Spanish</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2473.1">Decimal numbers in the English version are displayed with a dot separator for decimal places, while in the Spanish version, a comma is used as the separator. </span><span class="koboSpan" id="kobo.2473.2">This is due to the locale formats specified for</span><a id="_idIndexMarker1082"/><span class="koboSpan" id="kobo.2474.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2475.1">en</span></code><span class="koboSpan" id="kobo.2476.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2477.1">es</span></code><span class="koboSpan" id="kobo.2478.1"> locales by Django. </span><span class="koboSpan" id="kobo.2478.2">You can take a look at the English formatting configuration at </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/en/formats.py"><span class="url"><span class="koboSpan" id="kobo.2479.1">https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/en/formats.py</span></span></a><span class="koboSpan" id="kobo.2480.1"> and the Spanish formatting configuration at </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/es/formats.py"><span class="url"><span class="koboSpan" id="kobo.2481.1">https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/es/formats.py</span></span></a><span class="koboSpan" id="kobo.2482.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2483.1">By default, Django applies the format localization for each locale. </span><span class="koboSpan" id="kobo.2483.2">However, there might be cases for which you don’t want to use localized values. </span><span class="koboSpan" id="kobo.2483.3">This is especially relevant when outputting JavaScript or JSON, which has to provide a machine-readable format.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2484.1">Django offers a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2485.1">{% localize %}</span></code><span class="koboSpan" id="kobo.2486.1"> template tag that allows you to turn on/off localization for template fragments. </span><span class="koboSpan" id="kobo.2486.2">This gives you control over localized formatting. </span><span class="koboSpan" id="kobo.2486.3">You will have to load the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2487.1">l10n</span></code><span class="koboSpan" id="kobo.2488.1"> (localization) tags to be able to use this template tag. </span><span class="koboSpan" id="kobo.2488.2">The following is an example of how to turn localization on and off in a template:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2489.1">{% load l10n %}
{% localize on %}
  {{ value }}
{% endlocalize %}
{% localize off %}
  {{ value }}
{% endlocalize %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2490.1">Django also offers the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2491.1">localize</span></code><span class="koboSpan" id="kobo.2492.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2493.1">unlocalize</span></code><span class="koboSpan" id="kobo.2494.1"> template filters to force or avoid the localization of a value. </span><span class="koboSpan" id="kobo.2494.2">These filters can be applied as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2495.1">{{ value|localize }}
{{ value|unlocalize }}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2496.1">You can also create custom</span><a id="_idIndexMarker1083"/><span class="koboSpan" id="kobo.2497.1"> format files to specify locale formatting. </span><span class="koboSpan" id="kobo.2497.2">You can find further information about format localization at </span><a href="https://docs.djangoproject.com/en/5.0/topics/i18n/formatting/"><span class="url"><span class="koboSpan" id="kobo.2498.1">https://docs.djangoproject.com/en/5.0/topics/i18n/formatting/</span></span></a><span class="koboSpan" id="kobo.2499.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2500.1">Next, you will learn how to create localized form fields.</span></p>
<h1 class="heading-1" id="_idParaDest-328"><span class="koboSpan" id="kobo.2501.1">Using django-localflavor to validate form fields</span></h1>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2502.1">django-localflavor</span></code><span class="koboSpan" id="kobo.2503.1"> is a </span><a id="_idIndexMarker1084"/><span class="koboSpan" id="kobo.2504.1">third-party module that contains a collection of utilities, such as form fields or model fields, that are specific for each country. </span><span class="koboSpan" id="kobo.2504.2">It’s very useful for validating local regions, local phone numbers, identity card numbers, social security numbers, and so on. </span><span class="koboSpan" id="kobo.2504.3">The package is organized into a series of modules named after ISO 3166 </span><a id="_idIndexMarker1085"/><span class="koboSpan" id="kobo.2505.1">country codes. </span><span class="koboSpan" id="kobo.2505.2">Follow these instructions to set it up:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2506.1">Install </span><code class="inlineCode"><span class="koboSpan" id="kobo.2507.1">django-localflavor</span></code><span class="koboSpan" id="kobo.2508.1"> using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2509.1">python -m pip install django-localflavor==4.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2510.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2511.1">settings.py</span></code><span class="koboSpan" id="kobo.2512.1"> file of your project and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.2513.1">localflavor</span></code><span class="koboSpan" id="kobo.2514.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2515.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.2516.1"> setting, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2517.1">INSTALLED_APPS = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2518.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2519.1">'localflavor'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2520.1">,</span></strong></span><span class="koboSpan" id="kobo.2521.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2522.1">You are going to add the United States zip code field so that a valid United States zip code is required to create a new order. </span><span class="koboSpan" id="kobo.2522.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2523.1">forms.py</span></code><span class="koboSpan" id="kobo.2524.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2525.1">orders</span></code><span class="koboSpan" id="kobo.2526.1"> application and make it look like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2527.1">from</span></span><span class="koboSpan" id="kobo.2528.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2529.1">import</span></span><span class="koboSpan" id="kobo.2530.1"> forms
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2531.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2532.1"> localflavor.us.forms </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2533.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2534.1"> USZipCodeField</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2535.1">from</span></span><span class="koboSpan" id="kobo.2536.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2537.1">import</span></span><span class="koboSpan" id="kobo.2538.1"> Order
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2539.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2540.1">OrderCreateForm</span></span><span class="koboSpan" id="kobo.2541.1">(forms.ModelForm):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2542.1">    postal_code = USZipCodeField()</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2543.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2544.1">Meta</span></span><span class="koboSpan" id="kobo.2545.1">:
        model = Order
        fields = [
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2546.1">'first_name'</span></span><span class="koboSpan" id="kobo.2547.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2548.1">'last_name'</span></span><span class="koboSpan" id="kobo.2549.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2550.1">'email'</span></span><span class="koboSpan" id="kobo.2551.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2552.1">'address'</span></span><span class="koboSpan" id="kobo.2553.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2554.1">'postal_code'</span></span><span class="koboSpan" id="kobo.2555.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2556.1">'city'</span></span><span class="koboSpan" id="kobo.2557.1">
        ]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2558.1">You import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2559.1">USZipCodeField</span></code><span class="koboSpan" id="kobo.2560.1"> field from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2561.1">us</span></code><span class="koboSpan" id="kobo.2562.1"> package of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2563.1">localflavor</span></code><span class="koboSpan" id="kobo.2564.1"> and use it for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2565.1">postal_code</span></code><span class="koboSpan" id="kobo.2566.1"> field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2567.1">OrderCreateForm</span></code><span class="koboSpan" id="kobo.2568.1"> form.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2569.1">Run the</span><a id="_idIndexMarker1086"/><span class="koboSpan" id="kobo.2570.1"> development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2571.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2572.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2573.1">http://127.0.0.1:8000/en/orders/create/</span></code><span class="koboSpan" id="kobo.2574.1"> in your browser. </span><span class="koboSpan" id="kobo.2574.2">Fill in all the fields, enter a three-letter zip code, and then submit the form. </span><span class="koboSpan" id="kobo.2574.3">You will get the following validation error, which is raised by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2575.1">USZipCodeField</span></code><span class="koboSpan" id="kobo.2576.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2577.1">Enter a zip code in the format XXXXX or XXXXX-XXXX.
</span></code></pre>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.2578.1">Figure 11.17</span></em><span class="koboSpan" id="kobo.2579.1"> shows the form validation error:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2580.1"><img alt="" role="presentation" src="../Images/B21088_11_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2581.1">Figure 11.17: The validation error for an invalid US zip code</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2582.1">This is </span><a id="_idIndexMarker1087"/><span class="koboSpan" id="kobo.2583.1">just a brief example of how to use a custom field from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2584.1">localflavor</span></code><span class="koboSpan" id="kobo.2585.1"> in your own project for validation purposes. </span><span class="koboSpan" id="kobo.2585.2">The local components provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2586.1">localflavor</span></code><span class="koboSpan" id="kobo.2587.1"> are very useful for adapting your application to specific countries. </span><span class="koboSpan" id="kobo.2587.2">You can read the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2588.1">django-localflavor</span></code><span class="koboSpan" id="kobo.2589.1"> documentation and see all the </span><a id="_idIndexMarker1088"/><span class="koboSpan" id="kobo.2590.1">available local components for each country at </span><a href="https://django-localflavor.readthedocs.io/en/latest/"><span class="url"><span class="koboSpan" id="kobo.2591.1">https://django-localflavor.readthedocs.io/en/latest/</span></span></a><span class="koboSpan" id="kobo.2592.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-329"><span class="koboSpan" id="kobo.2593.1">Expanding your project using AI</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2594.1">In this section, you are </span><a id="_idIndexMarker1089"/><span class="koboSpan" id="kobo.2595.1">presented with a task to extend your project, accompanied by a sample prompt for ChatGPT to assist you. </span><span class="koboSpan" id="kobo.2595.2">To engage with </span><a id="_idIndexMarker1090"/><span class="koboSpan" id="kobo.2596.1">ChatGPT, visit </span><a href="https://chat.openai.com/"><span class="url"><span class="koboSpan" id="kobo.2597.1">https://chat.openai.com/</span></span></a><span class="koboSpan" id="kobo.2598.1">. </span><span class="koboSpan" id="kobo.2598.2">If this is your first interaction with ChatGPT, you can revisit the </span><em class="italic"><span class="koboSpan" id="kobo.2599.1">Expanding your project using AI</span></em><span class="koboSpan" id="kobo.2600.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.2601.1">Chapter 3, Extending Your Blog Application</span></em><span class="koboSpan" id="kobo.2602.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2603.1">In this project example, we have implemented an online shop. </span><span class="koboSpan" id="kobo.2603.2">We have added orders, payments, and a coupon system. </span><span class="koboSpan" id="kobo.2603.3">Now, another typical feature of e-commerce platforms is managing shipping costs. </span><span class="koboSpan" id="kobo.2603.4">Let’s consider adding a weight attribute to products and implementing shipping costs based on the total weight of the items shipped. </span><span class="koboSpan" id="kobo.2603.5">Use ChatGPT to help you implement shipping costs for products, making them dependent on the product’s weight. </span><span class="koboSpan" id="kobo.2603.6">Ensure that Stripe charges the correct amount, including the calculated shipping costs. </span><span class="koboSpan" id="kobo.2603.7">You can use the prompt provided at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/blob/main/Chapter11/prompts/task.md"><span class="url"><span class="koboSpan" id="kobo.2604.1">https://github.com/PacktPublishing/Django-5-by-example/blob/main/Chapter11/prompts/task.md</span></span></a><span class="koboSpan" id="kobo.2605.1">.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.2606.1">Use ChatGPT as a debugging companion. </span><span class="koboSpan" id="kobo.2606.2">If you find yourself stuck on a particularly stubborn bug, describe the problem and the context. </span><span class="koboSpan" id="kobo.2606.3">It can provide a fresh perspective, often prompting you to consider angles you might have overlooked, leading to quicker problem resolution.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-330"><span class="koboSpan" id="kobo.2607.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2608.1">In this chapter, you learned the basics of the internationalization and localization of Django projects. </span><span class="koboSpan" id="kobo.2608.2">You marked code and template strings for translation, and you discovered how to generate and compile translation files. </span><span class="koboSpan" id="kobo.2608.3">You also installed Rosetta in your project to manage translations through a web interface. </span><span class="koboSpan" id="kobo.2608.4">You translated URL patterns, and you created a language selector to allow users to switch the language of the site. </span><span class="koboSpan" id="kobo.2608.5">Then, you used </span><code class="inlineCode"><span class="koboSpan" id="kobo.2609.1">django-parler</span></code><span class="koboSpan" id="kobo.2610.1"> to translate models, and you used </span><code class="inlineCode"><span class="koboSpan" id="kobo.2611.1">django-localflavor</span></code><span class="koboSpan" id="kobo.2612.1"> to validate localized form fields.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2613.1">In the next chapter, you will start a new Django project that will consist of an e-learning platform. </span><span class="koboSpan" id="kobo.2613.2">You will learn how to use model inheritance to implement polymorphism, and you will lay the foundations for a flexible content management system. </span><span class="koboSpan" id="kobo.2613.3">You will create the application models, and you will learn how to create and apply fixtures to provide initial data for the models. </span><span class="koboSpan" id="kobo.2613.4">You will build a custom model field and use it in your models. </span><span class="koboSpan" id="kobo.2613.5">You will also build authentication views for your new application.</span></p>
<h1 class="heading-1" id="_idParaDest-331"><span class="koboSpan" id="kobo.2614.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2615.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2616.1">The source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter11"><span class="url"><span class="koboSpan" id="kobo.2617.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter11</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2618.1">A list of valid language IDs: </span><a href="http://www.i18nguy.com/unicode/language-identifiers.html"><span class="url"><span class="koboSpan" id="kobo.2619.1">http://www.i18nguy.com/unicode/language-identifiers.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2620.1">A list of internationalization and localization settings: </span><a href="https://docs.djangoproject.com/en/5.0/ref/settings/#globalization-i18n-l10n"><span class="url"><span class="koboSpan" id="kobo.2621.1">https://docs.djangoproject.com/en/5.0/ref/settings/#globalization-i18n-l10n</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2622.1">Homebrew package manager: </span><a href="https://brew.sh/"><span class="url"><span class="koboSpan" id="kobo.2623.1">https://brew.sh/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2624.1">Installing </span><code class="inlineCode"><span class="koboSpan" id="kobo.2625.1">gettext</span></code><span class="koboSpan" id="kobo.2626.1"> on Windows: </span><a href="https://docs.djangoproject.com/en/5.0/topics/i18n/translation/#gettext-on-windows"><span class="url"><span class="koboSpan" id="kobo.2627.1">https://docs.djangoproject.com/en/5.0/topics/i18n/translation/#gettext-on-windows</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2628.1">Precompiled </span><code class="inlineCode"><span class="koboSpan" id="kobo.2629.1">gettext</span></code><span class="koboSpan" id="kobo.2630.1"> binary installer for Windows: </span><a href="https://mlocati.github.io/articles/gettext-iconv-windows.html"><span class="url"><span class="koboSpan" id="kobo.2631.1">https://mlocati.github.io/articles/gettext-iconv-windows.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2632.1">Documentation about translations: </span><a href="https://docs.djangoproject.com/en/5.0/topics/i18n/translation/"><span class="url"><span class="koboSpan" id="kobo.2633.1">https://docs.djangoproject.com/en/5.0/topics/i18n/translation/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2634.1">Poedit translation file editor: </span><a href="https://poedit.net/"><span class="url"><span class="koboSpan" id="kobo.2635.1">https://poedit.net/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2636.1">Documentation for Django Rosetta: </span><a href="https://django-rosetta.readthedocs.io/"><span class="url"><span class="koboSpan" id="kobo.2637.1">https://django-rosetta.readthedocs.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2638.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2639.1">django-parler</span></code><span class="koboSpan" id="kobo.2640.1"> module’s compatibility with Django: </span><a href="https://django-parler.readthedocs.io/en/latest/compatibility.html"><span class="url"><span class="koboSpan" id="kobo.2641.1">https://django-parler.readthedocs.io/en/latest/compatibility.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2642.1">Documentation for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2643.1">django-parler</span></code><span class="koboSpan" id="kobo.2644.1">: </span><a href="https://django-parler.readthedocs.io/en/latest/"><span class="url"><span class="koboSpan" id="kobo.2645.1">https://django-parler.readthedocs.io/en/latest/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2646.1">Django formatting configuration for the English locale: </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/en/formats.py"><span class="url"><span class="koboSpan" id="kobo.2647.1">https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/en/formats.py</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2648.1">Django formatting configuration for the Spanish locale: </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/es/formats.py"><span class="url"><span class="koboSpan" id="kobo.2649.1">https://github.com/django/django/blob/stable/5.0.x/django/conf/locale/es/formats.py</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2650.1">Django format localization: </span><a href="https://docs.djangoproject.com/en/5.0/topics/i18n/formatting/"><span class="url"><span class="koboSpan" id="kobo.2651.1">https://docs.djangoproject.com/en/5.0/topics/i18n/formatting/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2652.1">Documentation for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2653.1">django-localflavor</span></code><span class="koboSpan" id="kobo.2654.1">: </span><a href="https://django-localflavor.readthedocs.io/en/latest/"><span class="url"><span class="koboSpan" id="kobo.2655.1">https://django-localflavor.readthedocs.io/en/latest/</span></span></a></li>
</ul>
</div>
</body></html>