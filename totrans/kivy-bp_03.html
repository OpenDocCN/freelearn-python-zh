<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Sound Recorder for Android"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Sound Recorder for Android</h1></div></div></div><p>In the previous chapter, we briefly discussed how the Kivy app, generally cross-platform, may have parts of code working conditionally on selected systems, enhancing user experience for some users and performing other platform-specific tasks.</p><p>At times, this is essentially free; for example, multitouch just works if Kivy detects support for it on a target system—you don't need to write any code to turn it on, but only account for the sheer possibility of several pointer events firing at the same time for different touches.</p><p>Other platform-dependent tasks include code that just cannot run on other systems for various reasons. Remember the mouse cursor customization from the Paint app? That code used low-level bindings to SDL cursor routines provided by Pygame, which is perfectly fine as long as you have SDL and Pygame running. So, in order to make our app multi-platform, we took precautions to avoid entering that specific code path on incompatible systems; otherwise, it would have crashed our program.</p><p>Otherwise, Kivy applications<a id="id191" class="indexterm"/> are generally portable across all supported platforms—Mac, Windows, Linux, iOS, Android, and Raspberry Pi—with no significant problems. Until they aren't; we will discuss the reason for this in a second.</p><div class="mediaobject"><img src="graphics/B01620_03_01.jpg" alt="Sound Recorder for Android"/><div class="caption"><p>Kivy supports a wide variety of platforms</p></div></div><p>In this chapter, we're going to cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Achieving interoperability between Python and Java using the <span class="strong"><strong>Pyjnius</strong></span> library</li><li class="listitem" style="list-style-type: disc">Testing Kivy apps on a device (or an emulator) running Android OS</li><li class="listitem" style="list-style-type: disc">Working with Android's sound API from Python, which allows you to record and playback audio files</li><li class="listitem" style="list-style-type: disc">Making a tiled user interface layout, similar in concept to Windows Phone</li><li class="listitem" style="list-style-type: disc">Using icon fonts to improve the presentation of the app with vector icons</li></ul></div><div class="section" title="Writing platform-dependent code"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Writing platform-dependent code</h1></div></div></div><p>Most<a id="id192" class="indexterm"/> of the projects in this book are inherently cross-platform, thanks to Kivy being extremely portable. This time, however, we're building an app that will be purposefully single-platform. This is certainly a severe limitation that reduces our potential user base; on the other hand, this gives us an opportunity to rely on platform-specific bindings that provide extended functionality.</p><p>The need for such bindings arises from the fact that Kivy strives to be as cross-platform as possible and delivers a similar user experience on every system it supports. This is a huge feature by itself; as a plus, we have the ability to write code once and run everywhere with little to no tweaks.</p><p>The downside of being cross-platform, however, is that you can only rely on the core functionality supported by every system. This "lowest common denominator" feature set includes rendering graphics on the screen, reproducing a sound if there is a sound card, accepting user input, and not much else.</p><p>Each Kivy app, by the virtue of being written in Python, also has access to the vast Python standard library. It facilitates networking, supports a number of application protocols, and provides many general-purpose algorithms and utility functions.</p><p>Still, the<a id="id193" class="indexterm"/> <span class="strong"><strong>input-output</strong></span> (<span class="strong"><strong>IO</strong></span>) capabilities of a "pure Kivy" program are limited to those that are present on most platforms. This amounts to a tiny fraction of what a common computer system, such as a smartphone or a tablet PC, can actually do.</p><p>Let's take a look at the API surface of a modern mobile device (for the sake of this chapter, let's assume it's running Android). We'll split everything in two parts: things that are supported directly by Python and/or Kivy, and things that aren't.</p><p>The following<a id="id194" class="indexterm"/> are <a id="id195" class="indexterm"/>features that are directly available in Python or Kivy:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Hardware-accelerated graphics</li><li class="listitem" style="list-style-type: disc">Touch screen input with optional multitouch</li><li class="listitem" style="list-style-type: disc">Sound<a id="id196" class="indexterm"/> playback (at the time of writing this, the playback <a id="id197" class="indexterm"/>is supported only for files in persistent storage)</li><li class="listitem" style="list-style-type: disc">Networking, assuming that Internet connectivity is present</li></ul></div><p>The<a id="id198" class="indexterm"/> following are features that aren't supported or require an external library:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Modem, support for voice calls, and SMS</li><li class="listitem" style="list-style-type: disc">Use of built-in cameras for filming videos and taking pictures</li><li class="listitem" style="list-style-type: disc">Use of a built-in microphone to record sound</li><li class="listitem" style="list-style-type: disc">Cloud storage for application data, associated with a user account</li><li class="listitem" style="list-style-type: disc">Bluetooth and other near-field networking features</li><li class="listitem" style="list-style-type: disc">Location services and GPS</li><li class="listitem" style="list-style-type: disc">Fingerprinting and other biometric security</li><li class="listitem" style="list-style-type: disc">Motion sensors, that is, accelerometer and gyroscope</li><li class="listitem" style="list-style-type: disc">Screen brightness control</li><li class="listitem" style="list-style-type: disc">Vibration and other forms of haptic feedback</li><li class="listitem" style="list-style-type: disc">Battery charge level</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>For most entries in the "not supported" list, different Python libraries are already present to fill the gap, such as Audiostream for a low-level sound recording and Plyer that handles many platform-specific tasks.</p><p>So, it's not like these features are completely unavailable to your application; realistically, the challenge is that these bits of functionality are insanely fragmented across different platforms (or even consecutive versions of the same platform, for example, Android); thus, you end up writing platform-specific, not portable code anyway.</p></div></div><p>As you can see from the preceding comparison, a lot of functionality is available on Android, only partially covered by an existing Python or Kivy API. This leaves a huge amount of untamed potential for using platform-specific features in your applications. This is not a limitation, but an opportunity. Shortly, you will learn how to utilize any Android API from Python code, allowing your Kivy application to do practically anything.</p><p>Another advantage of narrowing the scope of your app to only a small selection of systems is that there are whole new classes of programs that can function (or even make sense) only on a mobile device with fitting hardware specifications. These include augmented reality apps, gyroscope-controlled games, panoramic cameras, and so on.</p><div class="section" title="Introducing Pyjnius"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec37"/>Introducing Pyjnius</h2></div></div></div><p>To<a id="id199" class="indexterm"/> harness the full power of our chosen<a id="id200" class="indexterm"/> platform, we're going to use a platform-specific API, which happens to be in Java and thus primarily Java-oriented. We are going to build a sound recorder app, similar to the apps commonly found in Android and iOS, albeit more simplistic. Unlike pure Kivy, the underlying Android API certainly provides us with ways of recording sound programmatically.</p><p>The rest of the chapter will cover this little recorder program throughout its development to illustrate the Python-Java interoperability using the excellent Pyjnius library, another great project made by Kivy developers. The concept we chose—sound recording and playback—is deliberately simple so as to outline the features of such interoperation without too much distraction caused by the sheer complexity of a subject and abundant implementation details.</p><p>The most interesting property of Pyjnius is that it doesn't provide its own "overlay" API over Android's, but instead allows you to use Java classes directly from Python. It means that you have full access to the native Android API and the official Android documentation, which is obviously more suited for Java development, not Python. However, this is still better than having no API reference at all.</p><p>Note that you don't have to install Pyjnius locally to complete the tutorial, since we obviously aren't going to run the code that taps into Android Java classes on the machine used for development.</p><p>The source code<a id="id201" class="indexterm"/> of Pyjnius, together with the reference manual and some examples, can be found in the official repository at <a class="ulink" href="https://github.com/kivy/pyjnius">https://github.com/kivy/pyjnius</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>We will talk about Pyjnius only in the context of Android development and interoperation, but keep in mind that you can do the same kind of integration with desktop Java. This is an interesting property because another option of scripting a Java API from Python is Jython, which is rather slow and incomplete. Pyjnius, on the other hand, allows you to use the official Python interpreter (CPython), together with a multitude of libraries such as NumPy, which facilitates very fast computation.</p><p>So, if you absolutely have to call a Java library from Python, by all means consider Pyjnius as a good interop variant.</p></div></div></div><div class="section" title="Emulating Android"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Emulating Android</h2></div></div></div><p>As <a id="id202" class="indexterm"/>mentioned earlier, this chapter's project<a id="id203" class="indexterm"/> targets Android exclusively, thus it will not work on your computer. Don't worry if you haven't got a spare Android gadget, or if you don't feel comfortable toying with the real, physical device for the purpose of this tutorial. There are good-quality Android emulators available to help you overcome this minor obstacle and toy with the Android OS from the comfort of your desktop.</p><p>One of the best <a id="id204" class="indexterm"/>emulators out there is Genymotion (previously AndroVM), built on top of Oracle's VirtualBox virtual machine. You can grab a free copy from the official website, <a class="ulink" href="http://www.genymotion.com/">http://www.genymotion.com/</a>; at the time of writing this, their licensing is very liberal, allowing for practically unrestricted free personal use.</p><p>The installation<a id="id205" class="indexterm"/> of the VM package is wildly different for every emulator and host OS combination, so we won't provide overly detailed instructions at this point. After all, these things are supposed to be user friendly nowadays, complete with instruction manuals and graphical user interfaces. Truly, we have reached the golden age of technology.</p><p>Even if the last sentence wasn't entirely sarcastic, there would've been some things to consider when setting up and using a virtual machine for Android emulation:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Always use the latest version of Android. Backward compatibility or lack thereof can be pretty bad; debugging OS-level glitches isn't entertaining at all.</li><li class="listitem" style="list-style-type: disc">Don't hesitate to search the Internet for solutions. The Android community is huge, and if you have a problem, it means that you're most probably not alone.</li><li class="listitem" style="list-style-type: disc">The Kivy Launcher app, which you may find very useful to test your own programs, is <a id="id206" class="indexterm"/>available in the form of an <code class="literal">.apk</code> file from the official Kivy website, <a class="ulink" href="http://kivy.org/">http://kivy.org/</a>; this will be useful for emulated Android devices that don't have access to Google Play.</li><li class="listitem" style="list-style-type: disc">Lastly, there are many different emulators out there of varying quality and compatibility. If things just seem to blow up and cease working at random, maybe you should try another VM or Android distribution. Fiddling with the virtual machine's configuration may also help.</li></ul></div><p>The next screenshot depicts a Genymotion virtual machine running a recent version of Android, complete with usable Kivy Launcher:</p><div class="mediaobject"><img src="graphics/B01620_03_02.jpg" alt="Emulating Android"/><div class="caption"><p>Genymotion VM running Android 4.4.2 with Kivy Launcher installed</p></div></div></div></div></div>
<div class="section" title="Metro UI"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Metro UI</h1></div></div></div><p>While <a id="id207" class="indexterm"/>we're at it, let's build a user interface that resembles the Windows Phone home screen. This concept, basically a grid of colored rectangles (tiles) of various sizes, was known as <span class="strong"><strong>Metro UI</strong></span> at some point in time, but was later renamed to <span class="strong"><strong>Modern UI</strong></span> due to trademark issues. No matter the name, this is how it looks. This will give you a vague idea of what we'll be aiming at during the course of this app's development:</p><div class="mediaobject"><img src="graphics/B01620_03_03.jpg" alt="Metro UI"/><div class="caption"><p>Design inspiration – Windows Phone home screen with tiles</p></div></div><p>Obviously, we <a id="id208" class="indexterm"/>aren't going to replicate it as is, but rather make something that resembles the depicted user interface. The following list pretty much summarizes<a id="id209" class="indexterm"/> the distinctive features we're after:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Everything is aligned to a rectangular grid</li><li class="listitem" style="list-style-type: disc">UI elements feature the same flat look discussed in <a class="link" href="ch01.html" title="Chapter 1. Building a Clock App">Chapter 1</a>, <span class="emphasis"><em>Building a Clock App</em></span> (tiles use bright, solid colors, and there are no shadows or rounded corners)</li><li class="listitem" style="list-style-type: disc">Tiles that are considered more useful (for an arbitrary definition of "useful") are larger and thus easier to hit</li></ul></div><p>If this sounds easy to you, then you're absolutely right. As you will see shortly, the Kivy implementation of such a UI is rather straightforward.</p><div class="section" title="The buttons"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec39"/>The buttons</h2></div></div></div><p>To start off, we<a id="id210" class="indexterm"/> are going to tweak a <code class="literal">Button</code> class, just like we did in our previous applications. It resembles <code class="literal">ColorButton</code> from the Paint app (<a class="link" href="ch02.html" title="Chapter 2. Building a Paint App">Chapter 2</a>, <span class="emphasis"><em>Building a Paint App</em></span>):</p><div class="informalexample"><pre class="programlisting">&lt;Button&gt;:
    background_normal: 'button_normal.png'
    background_down: 'button_down.png'
    background_color: C('#95A5A6')
    font_size: 40</pre></div><p>The texture <a id="id211" class="indexterm"/>we set as the background is solid white, exploiting the same trick that was used while creating the color palette. The <code class="literal">background_color</code> property acts as tint color, and assigning a plain white texture equals to painting the button in <code class="literal">background_color</code>. We don't want borders this time.</p><p>The second (pressed <code class="literal">background_down</code>) texture is 25 percent transparent white. Combined with the pitch-black background color of the app, we're getting a slightly darker shade of the same background color the button was assigned:</p><div class="mediaobject"><img src="graphics/B01620_03_04.jpg" alt="The buttons"/><div class="caption"><p>Normal (left) and pressed (right) states of a button – the background color is set to #0080FF</p></div></div></div><div class="section" title="The grid structure"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec40"/>The grid structure</h2></div></div></div><p>The layout is<a id="id212" class="indexterm"/> a bit more complex to build. In the absence of readily<a id="id213" class="indexterm"/> available Modern UI-like tiled layout, we are going to emulate it with the built-in <code class="literal">GridLayout</code> widget. It behaves just like the <code class="literal">BoxLayout</code> widget we used earlier, only in two dimensions instead of one, so there is no <code class="literal">orientation: 'horizontal'</code> or <code class="literal">'vertical'</code> property—the <code class="literal">GridLayout</code> widget is both at the same time.</p><p>One such layout could have fulfilled all our needs, if not for the last requirement: we want to have bigger and smaller buttons. Presently, <code class="literal">GridLayout</code> doesn't allow the merging of cells to create bigger ones (a functionality similar to the <code class="literal">rowspan</code> and <code class="literal">colspan</code> attributes in HTML would be nice to have). So, we will go in the opposite direction: start with the root <code class="literal">GridLayout</code> with big cells and add another <code class="literal">GridLayout</code> inside a cell to subdivide it.</p><p>Thanks to nested layouts working great in Kivy, we arrive at the following Kivy language structure (let's name the file <code class="literal">recorder.kv</code>):</p><div class="informalexample"><pre class="programlisting">#:import C kivy.utils.get_color_from_hex

GridLayout:
    padding: 15

    Button:
        background_color: C('#3498DB')
        text: 'aaa'

    GridLayout:
        Button:
            background_color: C('#2ECC71')
            text: 'bbb1'

        Button:
            background_color: C('#1ABC9C')
            text: 'bbb2'

        Button:
            background_color: C('#27AE60')
            text: 'bbb3'

        Button:
            background_color: C('#16A085')
            text: 'bbb4'

    Button:
        background_color: C('#E74C3C')
        text: 'ccc'

    Button:
        background_color: C('#95A5A6')
        text: 'ddd'</pre></div><p>In <a id="id214" class="indexterm"/>order to run this code, you'll need the usual <code class="literal">main.py</code> boilerplate <a id="id215" class="indexterm"/>to serve as an application's entry point. Try writing this code yourself as an exercise.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip18"/>Tip</h3><p>Refer to the beginning of the first chapter. The application class name will be different because it should reflect the name of the Kivy language file presented earlier.</p></div></div><p>Note how the nested <code class="literal">GridLayout</code> widget sits on the same level as that of outer, large buttons. This should make perfect sense if you look at the previous screenshot of the WinPhone home screen: a pack of four smaller buttons takes up the same space (one outer grid cell) as <a id="id216" class="indexterm"/>a large button. The nested <code class="literal">GridLayout</code> is <a id="id217" class="indexterm"/>a container for those smaller buttons.</p><div class="section" title="Visual attributes"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec07"/>Visual attributes</h3></div></div></div><p>On<a id="id218" class="indexterm"/> the outer grid, <code class="literal">padding</code> is provided to create some distance<a id="id219" class="indexterm"/> from the edges of the screen. Other visual attributes are shared between <code class="literal">GridLayout</code> instances and moved to a class, resulting in the following code inside <code class="literal">recorder.kv</code>:</p><div class="informalexample"><pre class="programlisting">&lt;GridLayout&gt;:
    cols: 2
    spacing: 10
    row_default_height:
        (0.5 * (self.width - self.spacing[0]) -
        self.padding[0])
    row_force_default: True</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>It's worth mentioning that both <code class="literal">padding</code> and <code class="literal">spacing</code> are effectively lists, not scalars. The <code class="literal">spacing[0]</code> property refers to a horizontal spacing, followed by a vertical one. However, we can initialize <code class="literal">spacing</code> with a single value, as shown in the preceding code; this value will then be used for everything.</p></div></div><p>Each grid consists of two columns with some spacing in between. The <code class="literal">row_default_height</code> property is trickier: we can't just say, "Let the row height be equal to the cell width." Instead, we compute the desired height manually, where 0.5 is because we have two columns:</p><div class="mediaobject"><img src="graphics/7849OS_03_06.jpg" alt="Visual attributes"/></div><p>If we don't apply this tweak, the buttons inside the grid will fill all the available vertical space, which is undesirable, especially when there aren't that many buttons (every one of them ends up being too large). Instead, we want all the buttons nice and square, with empty space at the bottom left, well, empty.</p><p>The following is the screenshot of our app's "Modern UI" tiles, resulting from the preceding code:</p><div class="mediaobject"><img src="graphics/B01620_03_07.jpg" alt="Visual attributes"/><div class="caption"><p>The UI so far – clickable tiles of variable size not too dissimilar from our design inspiration</p></div></div></div></div><div class="section" title="Scalable vector icons"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Scalable vector icons</h2></div></div></div><p>One <a id="id220" class="indexterm"/>of the nice finishing touches we can apply to the application<a id="id221" class="indexterm"/> UI is the use of icons, and not just text, on buttons. We could, of course, just throw in a bunch of images, but let's borrow another useful technique from modern web development and use an icon font instead—as you will see shortly, these provide great flexibility at no cost.</p><div class="section" title="Icon fonts"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec08"/>Icon fonts</h3></div></div></div><p>Icon fonts<a id="id222" class="indexterm"/> are essentially just like regular ones, except their <a id="id223" class="indexterm"/>glyphs are unrelated to the letters of a language. For example, you type "P" and the Python logo is rendered instead of the letter; every font invents its own mnemonic on how to assign letters to icons.</p><p>This is about the only downside to using an icon font—the code that uses such font heavily isn't very readable because character–icon mapping is hardly obvious. This can be mitigated by using constants instead of entering symbols directly.</p><p>There are also fonts that don't use English letters, instead they map icons to Unicode's "private use area" character codes. This is a technically correct way to build such a font, but application support for this Unicode feature varies—not every platform behaves the same in this regard, especially when it comes to mobile platforms. The font that we will use for our app does not assign private use characters and uses ASCII (plain English letters) instead.</p></div><div class="section" title="Rationale for using icon fonts"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec09"/>Rationale for using icon fonts</h3></div></div></div><p>On the Web, icon<a id="id224" class="indexterm"/> fonts solve a number of problems<a id="id225" class="indexterm"/> that are commonly associated with (raster) images:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">First and foremost, raster images don't scale well and may become blurry when resized—there are certain algorithms that produce better results than others, but as of today, the "state of the art" is still not perfect. In contrast, a vector picture is infinitely scalable, by definition.</li><li class="listitem" style="list-style-type: disc">Raster image files containing schematic graphics (such as icons and UI elements) tend to be larger than vector formats. This does not apply to photos encoded as JPEG, obviously.</li><li class="listitem" style="list-style-type: disc">In addition, an icon font is typically just one file for any number of icons, which means one HTTP round trip. Regular icons (images) routinely end up in separate files, leading to significant HTTP overhead; there are ways to mitigate this, such as CSS sprites, but they are not universally used and have their own problems.</li><li class="listitem" style="list-style-type: disc">In the case of icon fonts, a color change literally takes about a second—you can do just that by adding <code class="literal">color: red</code> (for example) to your CSS file. The same is true for size, rotation, and other properties that don't involve changing the geometry of an image. Effectively, this means that making trivial adjustments to an icon does not require an image editor, like it normally would when dealing with bitmaps.</li></ul></div><p>Some of these points do not apply to Kivy apps that much, but overall, the use of icon fonts is considered a good practice in contemporary web development, especially since there are many free high-quality fonts to choose from—that's hundreds of icons readily available for inclusion in your project.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip19"/>Tip</h3><p>Two<a id="id226" class="indexterm"/> great sources of free fonts (including those that are free for<a id="id227" class="indexterm"/> commercial usage) are <span class="strong"><strong>Font Squirrel</strong></span> (<a class="ulink" href="http://www.fontsquirrel.com">http://www.fontsquirrel.com</a>) and <span class="strong"><strong>Google Fonts</strong></span> (<a class="ulink" href="https://www.google.com/fonts">https://www.google.com/fonts</a>). Never mind the general web development orientation of these sites, most fonts are just as usable in your offline programs as they are on the Web. If not more so, because browser support still isn't ideal.</p><p>The only thing that really matters is the file format: Kivy only supports True Type (<code class="literal">.ttf</code>) at the moment. Thankfully, this is the most popular font format out there anyway. Besides, it's possible to convert a font from practically any other format to <code class="literal">.ttf</code>.</p></div></div></div><div class="section" title="Using the icon font in Kivy"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec10"/>Using the icon font in Kivy</h3></div></div></div><p>In our <a id="id228" class="indexterm"/>application, we are going to use the <a id="id229" class="indexterm"/>Modern Pictograms (version 1) free font, designed by John Caserta. The following is a glimpse of how it looks:</p><div class="mediaobject"><img src="graphics/B01620_03_08.jpg" alt="Using the icon font in Kivy"/><div class="caption"><p>A small sample of icons from the Modern Pictograms icon font</p></div></div><p>To load the font into our Kivy program, we'll use the same process outlined in <a class="link" href="ch01.html" title="Chapter 1. Building a Clock App">Chapter 1</a>, <span class="emphasis"><em>Building a Clock App</em></span>. In this specific case, it isn't strictly necessary, as icon fonts rarely have different font weights and styles. Still, accessing the font by display name (Modern Pictograms) rather than the filename (<code class="literal">modernpics.ttf</code>) is a better way. You can later rename or move the font file by updating just one occurrence of its path, and not every place where the font was used.</p><p>The code so far (in <code class="literal">main.py</code>) looks like this:</p><div class="informalexample"><pre class="programlisting">from kivy.app import App
from kivy.core.text import LabelBase

class RecorderApp(App):
    pass

if __name__ == '__main__':
    LabelBase.register(name=<span class="strong"><strong>'Modern Pictograms'</strong></span>,
                       fn_regular=<span class="strong"><strong>'modernpics.ttf'</strong></span>)

    RecorderApp().run()</pre></div><p>The actual use of the font happens inside <code class="literal">recorder.kv</code>. First, we want to update the <code class="literal">Button</code> class once again to allow us to change the font in the middle of a text using markup tags. This is shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;Button&gt;:
    background_normal: 'button_normal.png'
    background_down: 'button_down.png'
    font_size: 24
    <span class="strong"><strong>halign: 'center'</strong></span>
<span class="strong"><strong>    markup: True</strong></span>
</pre></div><p>The <code class="literal">halign: 'center'</code> attribute means that we want every line of text centered inside the button. The <code class="literal">markup: True</code> attribute is self-evident and required because the next step <a id="id230" class="indexterm"/>in customization of buttons will rely <a id="id231" class="indexterm"/>heavily on markup.</p><p>Now we can update button definitions. Here's an example of this:</p><div class="informalexample"><pre class="programlisting">Button:
    background_color: C('#3498DB')
    text:
        ('[font=Modern Pictograms][size=120]'
        'e[/size][/font]\nNew recording')</pre></div><p>Normally, you don't need parentheses around strings in Kivy language files; this syntax is useful only when the declaration is multiline. This notation is effectively the same as writing a long string on the same line.</p><p>Notice the character <code class="literal">'e'</code> inside the <code class="literal">[font][size]</code> tags. That's the icon code. Every button in our app will use a different icon, and changing an icon amounts to replacing a single letter in the <code class="literal">recorder.kv</code> file. Complete mapping of the code for the Modern Pictograms font<a id="id232" class="indexterm"/> can be found on its official website at <a class="ulink" href="http://modernpictograms.com/">http://modernpictograms.com/</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>In order to explore an icon font by hand, you'll need to use a font viewer. Typically, there is one readily available on your machine, regardless of an operating system.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Character Map</strong></span> program is bundled with Windows</li><li class="listitem" style="list-style-type: disc">On a Mac, there<a id="id233" class="indexterm"/> is a built-in application called <span class="strong"><strong>Font Book</strong></span></li><li class="listitem" style="list-style-type: disc">Linux has several viewers depending on the desktop environment of your choice, for example, <span class="strong"><strong>gnome-font-viewer</strong></span> in GNOME</li></ul></div><p>Alternatively, just search the Web. Popular fonts usually have some sort of user manual online that explains character mapping.</p></div></div><p>Long story short, this is how the UI of our application looks after the addition of icons to buttons:</p><div class="mediaobject"><img src="graphics/B01620_03_09.jpg" alt="Using the icon font in Kivy"/><div class="caption"><p>The sound recorder app interface – a modern UI with vector icons from the Modern Pictograms font</p></div></div><p>This <a id="id234" class="indexterm"/>is already pretty close to the original<a id="id235" class="indexterm"/> Modern UI look.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>You might wonder what is the purpose of smaller green buttons at the top-right corner. The answer is that currently they're there for quantity alone. Three buttons that we actually need to implement a sound recorder—record, play, delete—just aren't enough to illustrate the Modern UI concept, as it needs more diversity to look even remotely interesting.</p></div></div></div></div></div>
<div class="section" title="Testing on Android"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Testing on Android</h1></div></div></div><p>Right <a id="id236" class="indexterm"/>now, our app still doesn't contain any non-portable code, but let's gradually move towards our platform of choice nevertheless and begin testing it on Android. The only prerequisite for this operation is an Android device, physical or virtualized, with the <span class="strong"><strong>Kivy Launcher</strong></span> application installed and working.</p><p>Packaging an app for Kivy Launcher is borderline trivial. We're going to add two files, <code class="literal">android.txt</code> and <code class="literal">icon.png</code>, to the same folder where other sources (in this case, <code class="literal">main.py</code> and <code class="literal">recorder.kv</code>) reside and then copy the folder to an SD card of the Android device under <code class="literal">/Kivy</code>. The directory structure should look something like the following:</p><div class="mediaobject"><img src="graphics/B01620_03_10.jpg" alt="Testing on Android"/><div class="caption"><p>SD card directory structure for Kivy Launcher</p></div></div><p>When <a id="id237" class="indexterm"/>you start Kivy Launcher, it will spell out the full path that it searches for projects. This may be useful, for example, when you have no SD card.</p><p>The format of the <code class="literal">android.txt</code> file is pretty self-evident:</p><div class="informalexample"><pre class="programlisting">title=App Name
author=Your Name
orientation=portrait</pre></div><p>Title and author fields are just strings displayed in the list of apps. Orientation can be either portrait (vertical, <span class="emphasis"><em>height &gt; width</em></span>) or landscape (horizontal, <span class="emphasis"><em>width &gt; height</em></span>), depending on the application's preferred aspect ratio.</p><p>The icon <code class="literal">icon.png</code> is optional and will be blank if omitted. It is advisable to add it because it's much easier to look up applications based on their icons, and if you're planning to release the resulting app to the Google Play store, you'll need an icon anyway.</p><p>Note that the icon's filename isn't customizable, and neither is the <code class="literal">main.py</code> filename, which must designate the application's entry point; otherwise, Kivy Launcher won't start the app.</p><p>With all the files in place, you should see your Sound recorder program in the list when you start Kivy Launcher:</p><div class="mediaobject"><img src="graphics/B01620_03_11.jpg" alt="Testing on Android"/><div class="caption"><p>The Kivy Launcher applications list, containing every app we've written during the course of this book</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip22"/>Tip</h3><p>If instead you see a message containing instructions where to put files, please recheck your paths—unfortunately, the directory that Kivy Launcher searches for projects is not easily configurable at the time of writing this. This may improve in future versions.</p></div></div><p>Now <a id="id238" class="indexterm"/>you can start your app by tapping the corresponding entry in the list. This is the easiest way to test a Kivy program on Android—just copy files and you're all set (as opposed to packaging an <code class="literal">.apk</code> file, which is also relatively straightforward but considerably more involved).</p></div>
<div class="section" title="Using the native API"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Using the native API</h1></div></div></div><p>Having<a id="id239" class="indexterm"/> done the user interface part of the app, we will now turn to a native API and implement the sound recording and playback logic using the suitable Android Java classes, <code class="literal">MediaRecorder</code> and <code class="literal">MediaPlayer</code>.</p><p>Technically, both Python and Java are object-oriented, and it may even appear at first glance that these languages are rather similar. The utilization of OOP principles, however, differs radically. In comparison to Python, many Java APIs suffer from (or enjoy immensely, depending on who you ask) over-architecting and general overuse of the object-oriented paradigm. So don't be surprised that otherwise very simple tasks may require you to import and instantiate quite a lot of classes.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>In 1913, Vladimir Lenin wrote regarding the Java architecture:</p><p>
<span class="emphasis"><em>And there is only one way of smashing the resistance of those classes, and that is to find, in the very society which surrounds us, the forces which can constitute the power capable of sweeping away the old and creating the new.</em></span>
</p><p>The essay didn't mention Python or Pyjnius back then, but the message is clear—even a century ago, going overboard with classes wasn't very much welcome in the contemporary society.</p></div></div><p>Thankfully, the<a id="id240" class="indexterm"/> task at hand is relatively simple. To record a sound using the Android API, we only need the following five Java classes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">android.os.Environment</code>: This class provides<a id="id241" class="indexterm"/> access to many useful environment variables. We are going to use it to determine the path where SD card is mounted so we can save the recorded audio file. It's tempting to just hardcode <code class="literal">'/sdcard/'</code> or a similar constant, but in practice, every other Android device has a different filesystem layout. So let's not do this even for the purposes of the tutorial.</li><li class="listitem" style="list-style-type: disc"><code class="literal">android.media.MediaRecorder</code>: This class <a id="id242" class="indexterm"/>is our main workhorse. It facilitates capturing audio and video and saving it to the filesystem.</li><li class="listitem" style="list-style-type: disc"><code class="literal">android.media.MediaRecorder$AudioSource</code>, <code class="literal">android.media.MediaRecorder$AudioEncoder</code>, and <code class="literal">android.media.MediaRecorder$OutputFormat</code>: These <a id="id243" class="indexterm"/>are <a id="id244" class="indexterm"/>enumerations that hold <a id="id245" class="indexterm"/>values we need to pass as arguments to the various methods of <code class="literal">MediaRecorder</code>.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip23"/>Tip</h3><p>
<span class="strong"><strong>Java class naming scheme</strong></span>
</p><p>The dollar sign in the class name commonly means that the class is internal. This is not the exact heuristic, as you can declare a similar class name yourself without following any logic whatsoever—<code class="literal">'$'</code> is a usable character in Java variable and class names, not too dissimilar from, for example, JavaScript. Such unorthodox naming, however, is frowned upon.</p></div></div><div class="section" title="Loading Java classes"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Loading Java classes</h2></div></div></div><p>The<a id="id246" class="indexterm"/> code to load the aforementioned Java classes<a id="id247" class="indexterm"/> into your Python application is as follows:</p><div class="informalexample"><pre class="programlisting">from jnius import autoclass

Environment = autoclass('android.os.Environment')
MediaRecorder = autoclass('android.media.MediaRecorder')
AudioSource = autoclass('android.media.MediaRecorder$AudioSource')
OutputFormat = autoclass('android.media.MediaRecorder$OutputFormat')
AudioEncoder = autoclass('android.media.MediaRecorder$AudioEncoder')</pre></div><p>If you try to run the program at this point, you'll receive an error, something along the lines of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ImportError: No module named jnius</strong></span>: You'll encounter this error if you don't have Pyjnius installed on your machine</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>jnius.JavaException: Class not found 'android/os/Environment'</strong></span>: You'll encounter this error if Pyjnius is installed, but the Android classes we're trying to load are missing (for example, when running on a desktop machine)</li></ul></div><p>This is one of the rare cases when receiving an error means we did everything right. From now on, we should do all of the testing on Android device or inside an emulator because the code isn't cross-platform anymore. It relies unequivocally on Android-specific Java features.</p><p>Now we can use Java classes seamlessly in our Python code.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip24"/>Tip</h3><p>Keep in mind that the documentation for these classes is intended for use with Java, not Python. You can look it up on Google's official Android developers portal at <a class="ulink" href="http://developer.android.com/reference/packages.html">http://developer.android.com/reference/packages.html</a>—translating code samples from Java to Python may appear intimidating at first, but in reality, it is dead simple (if a bit wordy).</p></div></div></div><div class="section" title="Looking up the storage path"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec43"/>Looking up the storage path</h2></div></div></div><p>Let's illustrate<a id="id248" class="indexterm"/> the practical cross-language API use with a simple<a id="id249" class="indexterm"/> example. In Java, we would do something like this in order to find out where an SD card is mounted:</p><div class="informalexample"><pre class="programlisting">import android.os.Environment;

String path = Environment.getExternalStorageDirectory()
.getAbsolutePath();</pre></div><p>When translated to Python, this code reads:</p><div class="informalexample"><pre class="programlisting">Environment = autoclass('android.os.Environment')
path = Environment.getExternalStorageDirectory().getAbsolutePath()</pre></div><p>This is the exact same thing as shown in the previous code, only written in Python instead of Java.</p><p>While <a id="id250" class="indexterm"/>we're at it, let's also log this value, so that we can see in the<a id="id251" class="indexterm"/> Kivy log which exact path the <code class="literal">getAbsolutePath</code> method returned to our code:</p><div class="informalexample"><pre class="programlisting">from kivy.logger import Logger
Logger.info('App: storage path == "%s"' % path)</pre></div><p>On my testing device, this produces the following line in the Kivy log:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[INFO] App: storage path == "/storage/sdcard0"</strong></span>
</pre></div><div class="section" title="Reading logs from the device"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Reading logs from the device</h3></div></div></div><p>When <a id="id252" class="indexterm"/>you're running a Kivy application<a id="id253" class="indexterm"/> from the terminal during development, logs <a id="id254" class="indexterm"/>appear immediately in the same terminal window. This very useful feature is also available, albeit less accessible, when your app runs inside Kivy Launcher.</p><p>To read Kivy logs, navigate to the folder where your app lives on the device (for example, <code class="literal">/Kivy/Recorder</code> on the SD card). Inside this folder, Kivy Launcher creates another directory named <code class="literal">.kivy</code>, with the default configuration and miscellaneous service information inside. Every time the application is started, a log file is created under <code class="literal">.kivy/logs</code>.</p><p>Alternatively, if you have the Android SDK installed, you can enable USB debugging on your device and then use the <code class="literal">adb logcat</code> command to see all the Android logs, including<a id="id255" class="indexterm"/> Kivy logs, in one place. This produces much more information about the internal processes happening inside the device, such as various hardware activating and deactivating, application windows changing their state, and so on.</p><p>Logs can be of tremendous value when debugging strange program behavior or when an app just refuses to start. Kivy also prints all sorts of warnings about the runtime environment there, such as libraries or features missing, Python modules failing to load, and other potential problems.</p></div></div><div class="section" title="Recording sound"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Recording sound</h2></div></div></div><p>Now, let's <a id="id256" class="indexterm"/>dive deeper into the rabbit hole of the Android<a id="id257" class="indexterm"/> API and actually record a sound from the mic. The following code is again basically a translation of Android API documentation into Python. If you're interested in the original Java version of this code, you may find it at <a class="ulink" href="http://developer.android.com/guide/topics/media/audio-capture.html">http://developer.android.com/guide/topics/media/audio-capture.html</a>—it's way too lengthy to include here.</p><p>The following is the preparation code that initializes a <code class="literal">MediaRecorder</code> object:</p><div class="informalexample"><pre class="programlisting">storage_path = (Environment.getExternalStorageDirectory()
                .getAbsolutePath() + '/kivy_recording.3gp')

recorder = MediaRecorder()

def init_recorder():
    recorder.setAudioSource(AudioSource.MIC)
    recorder.setOutputFormat(OutputFormat.THREE_GPP)
    recorder.setAudioEncoder(AudioEncoder.AMR_NB)
    recorder.setOutputFile(storage_path)
    recorder.prepare()</pre></div><p>This is the typical, straightforward, verbose Java way of initializing things, rewritten in Python word for word.</p><p>You can<a id="id258" class="indexterm"/> tweak the output file format and codec here, for example, change <code class="literal">AMR_NB</code> (<span class="strong"><strong>Adaptive Multi-Rate</strong></span> codec, which is optimized for speech and hence widely used in GSM and other mobile phone networks) to <code class="literal">AudioEncoder.AAC</code> (<span class="strong"><strong>Advanced Audio Coding</strong></span> standard, a more general-purpose codec similar<a id="id259" class="indexterm"/> to MP3). There is probably no good reason for this since the dynamic range of the built-in microphone is unlikely to be suitable for recording music anyway, but the choice is yours.</p><p>Now for the fun part, the "Begin/End recording" button. The following code snippet uses the same logic as already seen in <a class="link" href="ch01.html" title="Chapter 1. Building a Clock App">Chapter 1</a>, <span class="emphasis"><em>Building a Clock App</em></span>, when implementing the Start/Stop button for the stopwatch:</p><div class="informalexample"><pre class="programlisting">class RecorderApp(App):
    is_recording = False

    def begin_end_recording(self):
        if (self.is_recording):
            <span class="strong"><strong>recorder.stop()</strong></span>
            <span class="strong"><strong>recorder.reset()</strong></span>
            self.is_recording = False
            self.root.ids.begin_end_recording.text = \
                ('[font=Modern Pictograms][size=120]'
                 'e[/size][/font]\nBegin recording')
            return

        <span class="strong"><strong>init_recorder()</strong></span>
        <span class="strong"><strong>recorder.start()</strong></span>
        self.is_recording = True
        self.root.ids.begin_end_recording.text = \
            ('[font=Modern Pictograms][size=120]'
             '%[/size][/font]\nEnd recording')</pre></div><p>As you can see, no rocket science was applied here either: we just stored the current state, <code class="literal">is_recording</code>, and then took the action depending on it, namely:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start or stop the <code class="literal">MediaRecorder</code> object (the highlighted part).</li><li class="listitem">Flip the <code class="literal">is_recording</code> flag.</li><li class="listitem">Update the button text so that it reflects the current state (see the following screenshot).</li></ol></div><p>The last<a id="id260" class="indexterm"/> part of the application that needs updating is <a id="id261" class="indexterm"/>the <code class="literal">recorder.kv</code> file. We need to tweak the "Begin/End recording" button so that it calls our <code class="literal">begin_end_recording()</code> function:</p><div class="informalexample"><pre class="programlisting">Button:
        id: begin_end_recording
        background_color: C('#3498DB')
        text:
            ('[font=Modern Pictograms][size=120]'
            'e[/size][/font]\nBegin recording')
        on_press: app.begin_end_recording()</pre></div><p>That's it! If you run the application now, chances are that you'll be able to actually record a sound file that is going to be stored on the SD card. However, please see the next section before you do this. The button that you created will look something like the following:</p><div class="mediaobject"><img src="graphics/B01620_03_12.jpg" alt="Recording sound"/><div class="caption"><p>Begin recording and End recording – this one button summarizes our app's functionality so far</p></div></div><div class="section" title="Major caveat – permissions"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec12"/>Major caveat – permissions</h3></div></div></div><p>The<a id="id262" class="indexterm"/> default Kivy Launcher app at the time of writing this doesn't have the necessary permission to record sound, <code class="literal">android.permission.RECORD_AUDIO</code>. This results in a crash as soon as the <code class="literal">MediaRecorder</code> instance is initialized.</p><p>There are many ways to mitigate this problem. First, the easiest one: for the sake of this tutorial, we already provide a modified Kivy Launcher that has the necessary permission enabled. You can find <code class="literal">KivyLauncherMod.apk</code> bundled with the book's source code archive. The latest version of the package is also available for download at <a class="ulink" href="https://github.com/mvasilkov/kivy_launcher_hack">https://github.com/mvasilkov/kivy_launcher_hack</a>.</p><p>Before you install the provided <code class="literal">.apk</code> file, please delete the existing version of the app, if any, from your device.</p><p>Alternatively, if you're willing to fiddle with the gory details of bundling Kivy apps for Google Play, you can build Kivy Launcher yourself from the source code. Everything you need to<a id="id263" class="indexterm"/> do this can be found in the official Kivy GitHub account, <a class="ulink" href="https://github.com/kivy">https://github.com/kivy</a>.</p><p>The third viable option (also probably easier than the previous one) is to tweak the already<a id="id264" class="indexterm"/> existing Kivy Launcher app. To do so, you can use the <span class="strong"><strong>apktool</strong></span> (<a class="ulink" href="https://code.google.com/p/android-apktool/">https://code.google.com/p/android-apktool/</a>). The exact steps you need to take are outlined as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the official <code class="literal">KivyLauncher.apk</code> file and extract it from the command line, assuming that the apktool is in your path:<div class="informalexample"><pre class="programlisting">apktool d -b -s -d KivyLauncher.apk KivyLauncher</pre></div></li><li class="listitem">Add the necessary permission statement to the <code class="literal">AndroidManifest.xml</code> file:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;</pre></div></li><li class="listitem">Repackage <code class="literal">.apk</code> like this:<div class="informalexample"><pre class="programlisting">apktool b KivyLauncher KivyLauncherWithChanges.apk</pre></div></li><li class="listitem">Sign <a id="id265" class="indexterm"/>the resulting <code class="literal">.apk</code> file using the <code class="literal">jarsigner</code> utility. Have a look at the official documentation on signing Android packages, available at <a class="ulink" href="http://developer.android.com/tools/publishing/app-signing.html#signing-manually">http://developer.android.com/tools/publishing/app-signing.html#signing-manually</a>.</li></ol></div><p>As a result of this procedure, the modified Kivy Launcher package will be able to record sound.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip25"/>Tip</h3><p>You can add various other permissions in the same way to be able to exploit them in your Python code using Pyjnius. For example, in order to access the GPS API, your app needs the <code class="literal">android.permission.ACCESS_FINE_LOCATION</code> permission.</p><p>All <a id="id266" class="indexterm"/>available permissions are listed in the Android<a id="id267" class="indexterm"/> documentation at <a class="ulink" href="http://developer.android.com/reference/android/Manifest.permission.html">http://developer.android.com/reference/android/Manifest.permission.html</a>.</p></div></div></div></div><div class="section" title="Playing sound"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Playing sound</h2></div></div></div><p>Getting<a id="id268" class="indexterm"/> sound playback to work is easier; there is no permission<a id="id269" class="indexterm"/> for this, and the API is somewhat more concise too. We need to load just one more class, <code class="literal">MediaPlayer</code>:</p><div class="informalexample"><pre class="programlisting">MediaPlayer = autoclass('android.media.MediaPlayer')
player = MediaPlayer()</pre></div><p>The following is the code that will run when the user presses the Play button. We'll also use the <code class="literal">reset_player()</code> function in the <span class="emphasis"><em>Deleting files</em></span> section; otherwise, there could have been one slightly longer function:</p><div class="informalexample"><pre class="programlisting">def reset_player():
    if (player.isPlaying()):
        player.stop()
    player.reset()

def restart_player():
    reset_player()
    try:
        player.setDataSource(storage_path)
        player.prepare()
        player.start()
    except:
        player.reset()</pre></div><p>The intricate details of each API call can be found in the official documentation, but overall, this listing is pretty self-evident: reset the player to its initial state, load the sound file, and push play. The file format is determined automatically, making our task at hand a wee bit easier.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip26"/>Tip</h3><p>In practice, such code should always be wrapped in a <code class="literal">try ... catch</code> block. There are just too many things that can go wrong: the file may go missing or created in a wrong format, the SD card may become unplugged or otherwise unreadable, and other equally terrible things that will surely crash your program if given <a id="id270" class="indexterm"/>a chance. A good rule of thumb when doing IO is <span class="emphasis"><em>better safe than sorry</em></span>.</p></div></div></div><div class="section" title="Deleting files"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Deleting files</h2></div></div></div><p>This <a id="id271" class="indexterm"/>last feature will use the <code class="literal">java.io.File</code> class, which is <a id="id272" class="indexterm"/>not strictly related to Android. One great thing about the official Android documentation is that it contains reference to these core Java classes too, despite the fact they predate the Android operating system by more than a decade. The actual code needed to implement file removal is exactly one line; it's highlighted in the following listing:</p><div class="informalexample"><pre class="programlisting">File = autoclass('java.io.File')

class RecorderApp(App):
    def delete_file(self):
        reset_player()
<span class="strong"><strong>        File(storage_path).delete()</strong></span>
</pre></div><p>First, we stop the playback (if any) by calling the <code class="literal">reset_player()</code> function, and then remove the file—short and sweet.</p><p>Interestingly, the <code class="literal">File.delete()</code> method in Java won't throw an exception in the event of a catastrophic failure, so there is no need to perform <code class="literal">try ... catch</code> in this case. Consistency, consistency everywhere.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>An attentive reader will notice that we could also delete the file using Python's own <code class="literal">os.remove()</code> function. Doing this using Java achieves nothing special compared to a pure Python implementation; it's also slower. On the other hand, as a demonstration of Pyjnius, <code class="literal">java.io.File</code> works as good as any other Java class.</p><p>Also note that this function will run perfectly fine in a desktop OS as well because it's not Android-specific; you only need Java and Pyjnius installed in order for this to work.</p></div></div><p>At this point, with the UI and all three major functions done, our application is complete for the purposes of this tutorial.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Summary</h1></div></div></div><p>Writing non-portable code has its strengths and weaknesses, just like any other global architectural decision. This particular choice, however, is especially hard because the switch to native API typically happens early in the project and may be completely impractical to undo at a later stage.</p><p>The major advantage of the approach was discussed at the beginning of this chapter: with platform-specific code, you can do virtually anything that your platform is capable of. There are no artificial limits; your Python code has unrestricted access to the same underlying API as the native code.</p><p>On the downside, depending on a single platform is risky for a number of reasons:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The market of Android alone is provably smaller than that of Android plus iOS (this holds true for about every combination of operating systems).</li><li class="listitem" style="list-style-type: disc">Porting the program over to a new system becomes harder with every platform-specific feature you use.</li><li class="listitem" style="list-style-type: disc">If the project runs on just one platform, exactly one political decision may be sufficient to kill it. The chances of getting banned by Google is higher than that of getting the boot from both App Store and Google Play simultaneously. (Again, this holds true for practically every set of application marketplaces.)</li></ul></div><p>Now that you're well aware of the options, it's up to you to make an educated choice regarding every app you develop.</p><p><span class="strong"><strong>A few words on the UI</strong></span></p><p>By all means, you should not hesitate to borrow and re-implement ideas (and layouts, fonts, colors, and so on) seen elsewhere. The phrase attributed to Pablo Picasso, "Good artists borrow; great artists steal," summarizes today's web and application development neatly. (The "steal" part is figurative: please don't actually steal things.)</p><p>Also, let's get this straight: the mere fact that Microsoft decided to use the "Modern UI" in a number of latest products, both mobile and desktop, doesn't mean that the design itself is any good. What we know for sure is that this user interface paradigm will be immediately recognizable by users due to popularity, fortunate or otherwise, of Microsoft operating systems.</p><p>Putting Java to rest, in the next chapter we will build a simple chat with client–server architecture on top of the popular Python web framework, <span class="strong"><strong>Twisted</strong></span>.</p></div></body></html>