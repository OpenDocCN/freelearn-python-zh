<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Getting Creative with PDF Files and Documents"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Getting Creative with PDF Files and Documents</h1></div></div></div><p>Word documents and PDF files are some of the most used file formats by business professionals. Want to send an invoice to you customer or send a set of requirements to your vendor, businesses often end up using PDF files and documents for their needs. Let's see how we can work with these file formats in Python.</p><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Extracting data from PDF files</li><li class="listitem" style="list-style-type: disc">Creating and copying PDF documents</li><li class="listitem" style="list-style-type: disc">Manipulating PDFs (adding header/footer, merge, split, delete)</li><li class="listitem" style="list-style-type: disc">Automating generation of payslips for finance department</li><li class="listitem" style="list-style-type: disc">Reading Word documents</li><li class="listitem" style="list-style-type: disc">Writing data into Word documents (adding headings, images, tables)</li><li class="listitem" style="list-style-type: disc">Generating personalized new hire orientation for HR team in an automated way</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Introduction</h1></div></div></div><p>In the previous few chapters, we looked at working with CSV files and then extended our scope to learn about working with Excel worksheets. While CSV files are in a simple text format, Excel files are available in binary format.</p><p>In this chapter, we will discuss two more binary file formats: <code class="literal">.pdf</code> and <code class="literal">.docx</code>. You'll build knowledge on generating and reading PDF files, copying them and even manipulating them to build your own header and footer formats. Do you know you could merge many PDF files with a simple Python recipe?</p><p>This chapter also takes you on a journey of working with Word documents. It helps you build knowledge on reading and writing data into Word files. Adding tables, images, charts, you name it and this chapter covers it. Sounds interesting? Then this chapter is definitely for you!</p><p>Specifically, we will focus on the following Python modules in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PyPDF2</code> (<a class="ulink" href="https://pythonhosted.org/PyPDF2/">https://pythonhosted.org/PyPDF2/</a>)</li><li class="listitem" style="list-style-type: disc"><code class="literal">fpdf</code> (<a class="ulink" href="https://pyfpdf.readthedocs.io/">https://pyfpdf.readthedocs.io/</a>)</li><li class="listitem" style="list-style-type: disc"><code class="literal">python-docx</code> (<a class="ulink" href="http://python-docx.readthedocs.io/en/latest/">http://python-docx.readthedocs.io/en/latest/</a>)</li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note7"/>Note</h3><p>While you'll learn about the majority of operations supported by <code class="literal">.pdf</code> and <code class="literal">.docx</code> files in this chapter, we won't be able to cover them in their entirety. I'd recommend you to try out the remaining APIs from the libraries discussed in this chapter.</p></div></div></div></div>
<div class="section" title="Extracting&#xA0;data from PDF files"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Extracting data from PDF files</h1></div></div></div><p>
<span class="strong"><strong>PDF</strong></span> (<span class="strong"><strong>Portable Document Format</strong></span>) is a file format used to store data in documents agnostic to application software, hardware, and operating systems (hence the name, portable). PDF documents are fixed-layout flat files that include text and graphics and contain information needed to display the content. This recipe will show you how to extract information from PDF files and use the reader object.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec72"/>Getting ready</h2></div></div></div><p>To step through this recipe, you will need to install Python v2.7. To work with PDF files, we have <code class="literal">PyPDF2</code>, a nice module that can be installed with the following command:</p><pre class="programlisting">
<span class="strong"><strong>sudo pip install PyPDF2</strong></span>
</pre><p>Already installed the module? So, let's get started!</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec73"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">On your Linux/Mac computer, go to Terminal and use Vim or choose your favorite editor.</li><li class="listitem">We start by downloading an existing PDF file from the Internet. Let's download the <code class="literal">diveintopython.pdf</code> file.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note8"/>Note</h3><p>You can search for this file on the Internet and easily obtain it. You'll also get the file if you download the code samples for this book.</p></div></div></li><li class="listitem">Now, let's write the Python code for creating a PDF file reader object:<pre class="programlisting">        import PyPDF2&#13;
        from PyPDF2 import PdfFileReader&#13;
        pdf = open("diveintopython.pdf", 'rb')&#13;
        readerObj = PdfFileReader(pdf) &#13;
        print "PDF Reader Object is:", readerObj</pre><p>The output of the preceding code snippet is as follows:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_001.jpg"/></div><p>
</p></li><li class="listitem">That's good; we now have a reader object of the PDF file. Let's move on to see what we can achieve with this object, based on the following Python code:<pre class="programlisting">        print "Details of diveintopython book"&#13;
        print "Number of pages:", readerObj.getNumPages()&#13;
        print "Title:", readerObj.getDocumentInfo().title&#13;
        print "Author:", readerObj.getDocumentInfo().author</pre><p>The output of the preceding code snippet is shown in the following screenshot. See how we use the <code class="literal">PdfFileReader</code> object to get the metadata of the file:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_002.jpg"/></div><p>
</p></li><li class="listitem">OK, that's neat! But we'd like to extract the contents of the file, wouldn't we? Let's go ahead and look at how to achieve this with a simple code snippet:<pre class="programlisting">        print "Reading Page 1"&#13;
        page = readerObj.getPage(1)&#13;
        print page.extractText()</pre><p>So, what are we doing in the preceding code? I guess, the <code class="literal">print</code> statement is obvious. Yes, we read the first page of the <code class="literal">diveintopython</code> book. The following screenshot shows the contents of the first page of the <code class="literal">diveintopython</code> book:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_003.jpg"/></div><p>
</p><p>The contents are partial (as I couldn't fit the entire page in a screenshot), but as you can see, the contents are not in the same format as in the PDF file. This is a shortcoming with the text extract of the PDF file. Even though not 100%, we can still get the PDF file contents with decent accuracy.</p></li><li class="listitem">Let's do one more interesting operation with the <code class="literal">PdfFileReader</code> object. How about getting the book outline with it? Yes, this is easily achievable in Python:<pre class="programlisting">        print "Book Outline"&#13;
        for heading in readerObj.getOutlines():&#13;
            if type(heading) is not list:&#13;
                print dict(heading).get('/Title') &#13;
</pre></li></ol></div><p>The output of the preceding code example can be seen in the following screenshot. As you can see, we get the complete outline of the book. In the beginning, we see the introduction of <code class="literal">Dive Into Python</code> and <code class="literal">Table of Contents</code>. Then we get the names of all the chapters, starting from <code class="literal">Chapter 1</code> to <code class="literal">Chapter 18</code>, and also the appendix, from <code class="literal">Appendix A</code> to <code class="literal">Appendix H</code>:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_004.jpg"/></div><p>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec74"/>How it works...</h2></div></div></div><p>In the first code snippet, we used the <code class="literal">PdfFileReader</code> class from the <code class="literal">PyPDF2</code> module to generate an object. This object opens up the possibilities of reading and extracting information from the PDF file.</p><p>In the next code snippet, we used the <code class="literal">PdfFileReader</code> object to get the metadata of the file. We got the book details, such as the number of pages in the book, the book<span class="strong"><strong>'</strong></span>s title, and also the name of the author.</p><p>In the third example, we used the reader object that was created from the <code class="literal">PdfFileReader</code> class and pointed to the first page of the <code class="literal">diveintopython</code> book. This creates a <code class="literal">page</code> object represented by the <code class="literal">page</code> variable. We then used the <code class="literal">page</code> object and read the contents of the page with the <code class="literal">extractText()</code> method.</p><p>Finally, in the last code snippet of this recipe, we used the <code class="literal">getOutlines()</code> method to retrieve the book's outline as an array. The outline not only returns the topic's titles but also returns the subtopics under the main topic. In our example though, we filtered the subtopics and just printed the main outline of the book as seen in the screenshot.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec75"/>There's more...</h2></div></div></div><p>Cool, so we looked at multiple things that we could achieve with <code class="literal">PdfFileReader</code>. You learnt about reading the file metadata, reading the outline, browsing to a given page in a PDF file, and extracting the text information. All this is great, but hey, we'd like to create new PDF files, right?</p></div></div>
<div class="section" title="Creating and copying PDF documents"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Creating and copying PDF documents</h1></div></div></div><p>Working with PDFs adds more value when you can create them from scratch programmatically. Let's see how we can create our own PDF files in this section.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec76"/>Getting ready</h2></div></div></div><p>We will continue to use the <code class="literal">PyPDF2</code> module for this recipe and will deal with its <code class="literal">PdfFileWriter</code> and <code class="literal">PdfFileMerger</code> classes. We will also use another module, <code class="literal">fpdf</code>, to demonstrate adding content to PDF files. We will talk about this later in the recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec77"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We can create a PDF file in multiple ways; in this example, we copy the contents of an old file to generate a new PDF file. We start by taking an existing PDF--<code class="literal">Exercise.pdf</code>. The following screenshot shows the contents of this file. It contains two pages; the first page is a technical exercise and the second page gives possible hints for the solution of the exercise, as shown in the following screenshot:<p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_005.jpg"/></div><p>
</p></li><li class="listitem">We will create a new PDF file by reading <code class="literal">Exercise.pdf</code> and writing the contents of the first page of the exercise into the new file. We will also add a blank page to the newly created PDF file. Let's start by writing some code:<pre class="programlisting">        from PyPDF2 import PdfFileReader, PdfFileWriter&#13;
        infile = PdfFileReader(open('Exercise.pdf', 'rb'))&#13;
        outfile = PdfFileWriter()</pre><p>In the preceding code, we import the appropriate classes from the <code class="literal">PyPDF2</code> module. As we need to read the <code class="literal">Exercise.pdf</code> file and then write the contents into a new PDF file, we will need both the <code class="literal">PdfFileReader</code> and <code class="literal">PdfFileWriter</code> classes. We then go ahead and open the exercise file in read mode with the <code class="literal">open()</code> method and create a reader object, <code class="literal">infile</code>. Later, we instantiate <code class="literal">PdfFileWriter</code> and create an object, <code class="literal">outfile</code>, which will be used to write the contents to the new file.</p></li><li class="listitem">Let's move on and add a blank page to the <code class="literal">outfile</code> object using the <code class="literal">addBlankPage()</code> method. The page dimensions are typically 8.5 x 11 inches, but in this case, we need to convert them into units, which is 612 x 792 point.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip9"/>Tip</h3><p>
<span class="emphasis"><em>Point</em></span> is a desktop publishing point also known as PostScript point. 100 point=1.38 inch.</p></div></div></li><li class="listitem">Next, we read the contents of the first page of <code class="literal">Exercise.pdf</code> with the <code class="literal">getPage()</code> method. Once we have the page object <code class="literal">p</code>, we pass this object to the writer object. The writer object uses the <code class="literal">addPage()</code> method to add the contents to the new file:<pre class="programlisting">        outfile.addBlankPage(612, 792)&#13;
        p = infile.getPage(0)&#13;
        outfile.addPage(p)</pre><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>So far, we have created an output PDF file object <code class="literal">outfile</code>, but haven't yet created the file.</p></div></div></li><li class="listitem">OK, cool! Now we have the writer object and the contents to be written into the new PDF file. So, we create a new PDF file with the <code class="literal">open()</code> method and use the writer object to write the contents and generate the new PDF, <code class="literal">myPdf.pdf</code> (this is where the PDF file is available on the file system for us to view). The following code achieves this. Here, <code class="literal">f</code> is the file handle of the newly created PDF file:<pre class="programlisting">        with open('myPdf.pdf', 'wb') as f: &#13;
             outfile.write(f)&#13;
        f.close()</pre><p>The following screenshot shows the contents of the newly created PDF file. As you can see, the first page is the blank page and the second page contains the contents of the first page of the <code class="literal">Exercise.pdf</code> file. Sweet, isn't it!</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_006.jpg"/></div><p>
</p></li><li class="listitem">But hey, we always need to create a PDF file from scratch! Yes, there is another way to create a PDF file. For this we will install a new module <code class="literal">fpdf</code> using the following command:<pre class="programlisting">
<span class="strong"><strong>        pip install fpdf</strong></span>
</pre><p>
</p></li><li class="listitem">Let's look at a very basic example, as given in the following code snippet:<pre class="programlisting">        import fpdf&#13;
        from fpdf import FPDF&#13;
        pdf = FPDF(format='letter')</pre><p>In this example, we instantiate the <code class="literal">FPDF()</code> class from the <code class="literal">fpdf</code> module and create an object, <code class="literal">pdf</code>, which essentially represents the PDF file. While creating the object, we also define the default format of the PDF file, which is <code class="literal">letter</code>. The <code class="literal">fpdf</code> module supports multiple formats, such as <code class="literal">A3</code>, <code class="literal">A4</code>, <code class="literal">A5</code>, <code class="literal">Letter</code>, and <code class="literal">Legal</code>.</p></li><li class="listitem">Next, we start inserting content into the file. But hey, the file is still empty, so before we write content, we use the <code class="literal">add_page()</code> method to insert a new page and also set the font using the <code class="literal">set_font()</code> method. We have set the font to <code class="literal">Arial</code> and its size to <code class="literal">12</code>:<pre class="programlisting">        pdf.add_page()&#13;
        pdf.set_font("Arial", size=12)</pre><p>
</p></li><li class="listitem">Now we actually start writing content to the file with the <code class="literal">cell()</code> method. Cell is a rectangular area that contains some text. So, as you can see in the following code, we add a new line, <code class="literal">Welcome to Automate It!</code>, and follow it up with another line, <code class="literal">Created by Chetan</code>. There are a few things that you must have observed. 200 x 10 is the height x width of the cell. The <code class="literal">ln=1</code> designates a new line and <code class="literal">align=C</code> aligns the text to the center of the page. You may get into issues when adding long text to a cell, but the <code class="literal">fpdf</code> module has a <code class="literal">multi_cell()</code> method, which automatically breaks long lines of text with the available effective page width. You can always calculate the page width:<pre class="programlisting">        pdf.cell(200, 10, txt="Welcome to Automate It!", ln=1, &#13;
        align="C")&#13;
        pdf.cell(200,10,'Created by Chetan',0,1,'C') &#13;
        pdf.output("automateit.pdf")</pre><p>The output of the preceding code is a PDF file with contents as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_007.jpg"/></div><p>
</p></li></ol></div></div></div>
<div class="section" title="Manipulating PDFs (adding header/footer, merge, split, delete)"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Manipulating PDFs (adding header/footer, merge, split, delete)</h1></div></div></div><p>Ever wondered if you could merge PDF files programatically in a few seconds? Or could update header and footer of many PDF files in a jiffy? In this recipe, lets move on to do some interesting and most frequently performed operations on PDF files in this recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec78"/>Getting ready</h2></div></div></div><p>For this recipe, we will use the <code class="literal">PyPDF2</code> and <code class="literal">fpdf</code> modules that were installed for the earlier recipes.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec79"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's start by working with the <code class="literal">PdfFileMerge</code> class of the <code class="literal">PyPDF2</code>. We use this class to merge multiple PDF files. The following code example does exactly the same:<pre class="programlisting">        from PyPDF2 import PdfFileReader, PdfFileMerger&#13;
        import os &#13;
        merger = PdfFileMerger()&#13;
        files = [x for x in os.listdir('.') if&#13;
        x.endswith('.pdf')]&#13;
        for fname in sorted(files):&#13;
            merger.append(PdfFileReader(open(&#13;
                          os.path.join('.', fname), 'rb')))&#13;
        merger.write("output.pdf")</pre></li><li class="listitem">If you run the preceding piece of code, it will generate a new file, <code class="literal">output.pdf</code>, which would have merged multiple PDF files. Open the <code class="literal">output.pdf</code> file and see for yourself.</li><li class="listitem">That was cool! Now, how about adding a header and footer to a PDF file. Let's invoke the example from the previous recipe where we used the <code class="literal">fpdf</code> module to generate a PDF file (<code class="literal">automateit.pdf</code>). Now, what if we have to create a similar file with header and footer information? The following code does exactly that:<pre class="programlisting">        from fpdf import FPDF&#13;
        class PDF(FPDF):&#13;
            def footer(self):&#13;
                self.set_y(-15)&#13;
                self.set_font('Arial', 'I', 8)&#13;
                self.cell(0, 10, 'Page %s' % self.page_no(), 0, 0, 'C')&#13;
            def header(self):&#13;
                self.set_font('Arial', 'B', 15)&#13;
                self.cell(80)&#13;
                self.cell(30, 10, 'Automate It!', 1, 0, 'C')&#13;
                self.ln(20)&#13;
        pdf = PDF(format='A5')&#13;
        pdf.add_page()&#13;
        pdf.set_font("Times", size=12)&#13;
        for i in range(1, 50):&#13;
            pdf.cell(0, 10, "This my new line. line number is:&#13;
                     %s" % i, ln=1, align='C')&#13;
        pdf.output("header_footer.pdf")</pre><p>The output of the preceding code snippet can be viewed in the following screenshot. Look how we're able to manipulate the header and footer of our PDF document:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_008.jpg"/></div><p>
</p></li><li class="listitem">Wow! That was nice; now, let's quickly cover some more operations. Remember we added a blank page to the <code class="literal">myPdf.pdf</code> file in the previous recipe? What if I want to remove blank pages from PDF files?<pre class="programlisting">        infile = PdfFileReader('myPdf.pdf', 'rb')&#13;
        output = PdfFileWriter()&#13;
&#13;
        for i in xrange(infile.getNumPages()):&#13;
            p = infile.getPage(i)&#13;
            if p.getContents():&#13;
                output.addPage(p)&#13;
        with open('myPdf_wo_blank.pdf', 'wb') as f:&#13;
            output.write(f)</pre><p>If you run the Python code and look at the contents of <code class="literal">myPdf_wo_blank.pdf</code>, you will just see one page and the blank page would be removed.</p></li><li class="listitem">Now, what if we want to add specific meta information to our file? We should be able to easily edit the metadata for a PDF file with the following code in Python:<pre class="programlisting">        from PyPDF2 import PdfFileMerger, PdfFileReader&#13;
        mergerObj = PdfFileMerger()&#13;
        fp = open('myPdf.pdf', 'wb')&#13;
        metadata = {u'/edited':u'ByPdfFileMerger',}&#13;
        mergerObj.addMetadata(metadata)&#13;
        mergerObj.write(fp)&#13;
        fp.close()&#13;
        pdf = open("myPdf.pdf", 'rb')&#13;
        readerObj = PdfFileReader(pdf)&#13;
        print "Document Info:", readerObj.getDocumentInfo()&#13;
        pdf.close()</pre><p>The output of the preceding code can be seen in the following screenshot. See how we were successful in adding edited metadata to our PDF file.</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_009.jpg"/></div><p>
</p></li><li class="listitem">Another good option to have from a development perspective is the ability to rotate a page in a PDF file. Yes, we could do that as well using the <code class="literal">PyPDF2</code> module. The following code rotates the first page of <code class="literal">Exercise.pdf</code> anticlockwise by <code class="literal">90</code> degrees:<pre class="programlisting">        from PyPDF2 import PdfFileReader&#13;
        fp = open('Exercise.pdf', 'rb')&#13;
        readerObj = PdfFileReader(fp)&#13;
        page = readerObj.getPage(0)&#13;
        page.rotateCounterClockwise(90)&#13;
        writer = PdfFileWriter()&#13;
        writer.addPage(page)&#13;
        fw = open('RotatedExercise.pdf', 'wb')&#13;
        writer.write(fw)&#13;
        fw.close()&#13;
        fp.close()</pre><p>The following screenshot shows how the file looks when rotated anticlockwise:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_010.jpg"/></div><p>
</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec80"/>How it works...</h2></div></div></div><p>In the first code snippet, we created an object of the <code class="literal">PdfFileMerger</code> class, called <code class="literal">merger</code>. We then went through all the files in the current working directory and selected all the files with the <code class="literal">.pdf</code> extension using Python's list comprehension.</p><p>We then sorted the files and ran a loop to pick up one file at a time, read it, and append it to the <code class="literal">merger</code> object.</p><p>Once all the files were merged, we used the <code class="literal">write()</code> method of the <code class="literal">merger</code> object to generate a single merged file: <code class="literal">output.pdf</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>In this example, we didn't have to create a file handle for the <code class="literal">output.pdf</code> file. The merger internally handles it and generates a nice PDF file.</p></div></div><p>In the second code snippet, we performed multiple operations:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We inherited the standard <code class="literal">FPDF</code> class and wrote our own class, <code class="literal">PDF</code>.</li><li class="listitem">We overrode two methods--<code class="literal">header()</code> and <code class="literal">footer()</code>--to define how the header and footer should look when we create a new PDF file with our PDF class.</li><li class="listitem">In the <code class="literal">footer()</code> method, we added page numbers to every page. The page numbers are in <code class="literal">Italics</code> with font size <code class="literal">8</code> and in <code class="literal">Arial</code> font. We also centered them and set them to appear 15 mm above the bottom of the page.</li><li class="listitem">In the <code class="literal">header()</code> method, we created the header cell and positioned it to the extreme right. The title of the header is <code class="literal">Automate It</code> and it is in <code class="literal">Arial</code> and <code class="literal">Bold</code> with font size <code class="literal">15</code>. The title is also centered in the context of the cell. Lastly, we added a line break of 20 pixels below the header.</li><li class="listitem">We then created our own PDF with the page format set to <code class="literal">A5</code>.</li><li class="listitem">The contents of the PDF will be <code class="literal">This is my new line. Line number is &lt;line_no&gt;</code> with the font set to <code class="literal">Times</code> and the font size being <code class="literal">12</code>.</li><li class="listitem">The generated PDF looks like the following screenshot. Note that the page is of <code class="literal">A5</code> size; hence, only 15 lines could be added to the page. If it had been of letter size, it would have accommodated at least 20 lines on a page.</li></ol></div><p>In the third code example of this recipe, <code class="literal">getContents()</code> does the critical task of checking whether a given page has any content. So, when we start reading the old PDF file, we check the content of the page. If there is no content, the page is ignored and is not added to the new PDF file. </p><p>In the fourth snippet, we added the metadata information to our PDF file using the <code class="literal">addMetadata()</code> method. The <code class="literal">addMetadata()</code> method takes a key value pair as arguments, where we can pass the attributes that need to be modified for the PDF file. In our example, we used the method to add the <code class="literal">/edited</code> metadata field to the PDF file.</p><p>For the final example, I think the rest of the code is self-explanatory, except the use of <code class="literal">rotateCounterClockwise()</code>, which actually rotates the page. We could use <code class="literal">rotateClockwise()</code> to rotate the page in a clockwise direction as well.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec81"/>There's more...</h2></div></div></div><p>You learned about reading and writing PDF files and also understood many ways of manipulating PDF files. It's now time to put things into perspective with a real-life example.</p></div></div>
<div class="section" title="Automating generation of payslips for finance department"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Automating generation of payslips for finance department</h1></div></div></div><p>Let's take an example of an organization use case, where the Finance Manager of the company wants to make the payslip generation process quicker. He realizes that not only is the task mundane but also consumes a lot of time. With more employees expected to join the company, it's going to get harder. He chooses to automate the process and approaches you. How can you help?</p><p>Well, with what you learnt throughout the chapter, I bet this will be a piece of cake for you! Let's work on it.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec82"/>Getting ready</h2></div></div></div><p>We don't need any special modules for this example. All the modules that have been installed as part of the previous recipes are enough for us, don't you think?</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec83"/>How to do it...</h2></div></div></div><p>Let's first think of a payslip template. What does a payslip contain?</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Employee information</li><li class="listitem" style="list-style-type: disc">Payments from the company</li><li class="listitem" style="list-style-type: disc">Deductions (tax paid to government)</li><li class="listitem" style="list-style-type: disc">Total payment made</li></ul></div><p>So we need to get the employee information, add tables for payments and deductions, and add an entry for the total salary paid for the month.</p><p>The code implementation for this scenario could be as follows:</p><pre class="programlisting">from datetime import datetime&#13;
&#13;
employee_data = [ &#13;
     { 'id': 123, 'name': 'John Sally', 'payment': 10000,&#13;
       'tax': 3000, 'total': 7000 },&#13;
     { 'id': 245, 'name': 'Robert Langford', 'payment': 12000,&#13;
       'tax': 4000, 'total': 8000 }, &#13;
]&#13;
from fpdf import FPDF, HTMLMixin&#13;
class PaySlip(FPDF, HTMLMixin):&#13;
      def footer(self): &#13;
          self.set_y(-15) &#13;
          self.set_font('Arial', 'I', 8)&#13;
          self.cell(0, 10, 'Page %s' % self.page_no(), 0, 0, 'C')&#13;
      def header(self):&#13;
          self.set_font('Arial', 'B', 15)&#13;
          self.cell(80)&#13;
          self.cell(30, 10, 'Google', 1, 0, 'C')&#13;
          self.ln(20)&#13;
def generate_payslip(data):&#13;
     month = datetime.now().strftime("%B")&#13;
     year = datetime.now().strftime("%Y")&#13;
     pdf = PaySlip(format='letter')&#13;
     pdf.add_page()&#13;
     pdf.set_font("Times", size=12)&#13;
     pdf.cell(200, 10, txt="Pay Slip for %s, %s" % &#13;
              (month, year),  ln=3, align="C")&#13;
     pdf.cell(50)&#13;
     pdf.cell(100, 10, txt="Employeed Id: %s" % data['id'],&#13;
              ln=1, align='L')&#13;
     pdf.cell(50)&#13;
     pdf.cell(100, 10, txt="Employeed Name: %s" % &#13;
              data['name'], ln=3, align='L')&#13;
     html = """&#13;
         &lt;table border="0" align="center" width="50%"&gt;&#13;
         &lt;thead&gt;&lt;tr&gt;&lt;th align="left" width="50%"&gt;&#13;
          Pay Slip Details&lt;/th&gt;&lt;th align="right" width="50%"&gt;&#13;
          Amount in USD&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&#13;
         &lt;tbody&gt;&#13;
             &lt;tr&gt;&lt;td&gt;Payments&lt;/td&gt;&lt;td align="right"&gt;""" + &#13;
                     str(data['payment']) + """&lt;/td&gt;&lt;/tr&gt; &#13;
             &lt;tr&gt;&lt;td&gt;Tax&lt;/td&gt;&lt;td align="right"&gt;""" + &#13;
                     str(data['tax']) + """&lt;/td&gt;&lt;/tr&gt;&#13;
             &lt;tr&gt;&lt;td&gt;Total&lt;/td&gt;&lt;td align="right"&gt;""" + &#13;
                     str(data['total']) + """&lt;/td&gt;&lt;/tr&gt;&#13;
         &lt;/tbody&gt;&#13;
         &lt;/table&gt;&#13;
         """&#13;
     pdf.write_html(html)&#13;
     pdf.output('payslip_%s.pdf' % data['id'])&#13;
for emp in employee_data:&#13;
     generate_payslip(emp)</pre><p>This is how the payslip looks with the header, footer, and payslip details:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_011.jpg"/></div><p>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec84"/>How it works...</h2></div></div></div><p>We first got the employee data in the dictionary <code class="literal">employee_data</code>. Now, in a real scenario, it could be from the employee table and would be retrieved with an SQL query. We wrote our own <code class="literal">PaySlip</code> class, which is inherited from the <code class="literal">FPDF</code> class, and defined our own header and footer.</p><p>We then wrote our own method to generate the payslip. This includes the header at the top with the company name (in this case, say <span class="strong"><strong>Google</strong></span>) and the period for which the payslip is. We also added the <span class="strong"><strong>Employee Id</strong></span> and <span class="strong"><strong>Employee Name</strong></span>.</p><p>Now, this is interesting. We created an HTML document that generates a table and adds the payment, tax, and total salary information to the payslip with the <code class="literal">add_html()</code> method.</p><p>In the end, we added all this information to the PDF file with the <code class="literal">output()</code> method and named the payslip as <code class="literal">payslip_&lt;employee_id&gt;</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec85"/>There's more...</h2></div></div></div><p>Even though we coded the example alright, do you think something is missing? Yeah, we didn't encrypt the PDF. It's always a great idea to secure the payslip with a password, so that nobody apart from the employee is able to view it. The following code will help us encrypt the file. In this example, we encrypt <code class="literal">Exercise.pdf</code>, secure it with the password, <code class="literal">P@$$w0rd</code>, and rename it to <code class="literal">EncryptExercise.pdf</code>:</p><pre class="programlisting">from PyPDF2 import PdfFileWriter, PdfFileReader&#13;
fp = open('Exercise.pdf', 'rb')&#13;
readerObj = PdfFileReader(fp)&#13;
&#13;
writer = PdfFileWriter()&#13;
&#13;
for page in range(readerObj.numPages):&#13;
     writer.addPage(readerObj.getPage(page))&#13;
writer.encrypt('P@$$w0rd')&#13;
&#13;
newfp = open('EncryptExercise.pdf', 'wb')&#13;
writer.write(newfp)&#13;
newfp.close()&#13;
fp.close()</pre><p>If we open the secured file, it will ask you for the password:</p><p>
</p><div class="mediaobject"><img alt="There's more..." src="graphics/image_04_012.jpg"/></div><p>
</p><p>Well, that's an awesome solution! Your finance manager will be happy I must say! Wondering how do I decrypt the secure file? I'll leave that to you; it's fairly straightforward. Read the documentation.</p><p>We have come to the end of this section on working with PDF files. PDF files essentially store data in a binary format and support multiple operations as we discussed. In the next section we start working with the documents (<code class="literal">.docx</code>) and appreciate what they can offer!</p></div></div>
<div class="section" title="Reading Word documents"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Reading Word documents</h1></div></div></div><p>As you might be aware, Microsoft Office started providing a new extension to Word documents, which is <code class="literal">.docx</code>, from Office 2007 onwards. With this change, documents moved to XML-based file formats (Office Open XML) with ZIP compression. Microsoft made this change when the business community asked for an open file format that could help with transferring data across applications. So, let's begin our journey with DOCX files!</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec86"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the <code class="literal">python-docx</code> module to read Word documents. The <code class="literal">python-docx</code> is a comprehensive module that performs both read and write operations on Word documents. Let's install this module with our favorite tool, <code class="literal">pip</code>:</p><pre class="programlisting">
<span class="strong"><strong>pip install python-docx</strong></span>
</pre></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec87"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We start by creating our own Word document. It's the same exercise as we saw in the previous section while working with PDF files. Except for the fact that we have added a table to it and stored it as <code class="literal">WExercise.docx</code>. It looks as follows:<p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_013.jpg"/></div><p>
</p></li><li class="listitem">Let's now go ahead and read the document <code class="literal">WExercise.docx</code> file. The following code will help us in getting the object that points to the <code class="literal">WExercise.docx</code> file:<pre class="programlisting">        import docx&#13;
        doc = docx.Document('WExercise.docx')&#13;
        print "Document Object:", doc</pre><p>The output of the preceding code is shown in the following screenshot. Reading a Word document is conceptually pretty similar to reading a file in Python. Just like how we created a file handle using the <code class="literal">open()</code> method, we create a document handle in this code snippet:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_014.jpg"/></div><p>
</p></li><li class="listitem">Now, if we want to get the basic information about a document, we can use the document object, <code class="literal">doc</code>, from the preceding code. For instance, if we want to retrieve the title of a document, we can do that with the following code. If you look at the code carefully, we use the <code class="literal">paragraphs</code> object to get the text. Paragraphs are the lines present in the document. Assuming that the title of the document is the first line of the document, we get the <code class="literal">0</code> index for the paragraphs in the document and call the <code class="literal">text</code> attribute to get the text of the title:<pre class="programlisting">
import docx
doc = docx.Document('WExercise.docx')
print "Document Object:", doc
print "Title of the document:"
print doc.paragraphs[0].text
</pre><p>Notice in the following screenshot how we print the title of our exercise
document:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_015.jpg"/></div><p>
</p></li><li class="listitem">Wow, that's cool! Let's go ahead and read other attributes of the Word document that we care about. Let's use the same <code class="literal">doc</code> object:<pre class="programlisting">        print "Attributes of the document"&#13;
        print "Author:", doc.core_properties.author&#13;
        print "Date Created:", doc.core_properties.created&#13;
        print "Document Revision:", doc.core_properties.revision</pre><p>The output of the preceding code is shown in the following screenshot. The author of the document is <code class="literal">Chetan Giridhar</code>. As you may have observed, it was created on July 2nd at 4:24 am. Also, note that the document has been changed five times, as this is the fifth revision of the document:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_016.jpg"/></div><p>
</p></li><li class="listitem">Well, I will get more audacious now and read the table down there in the document. The <code class="literal">python-docx</code> module is awesome for reading tables. Look at the following code snippet:<pre class="programlisting">        table = doc.tables[0]&#13;
&#13;
        print "Column 1:"&#13;
        for i in range(len(table.rows)):&#13;
            print table.rows[i].cells[0].paragraphs[0].text&#13;
 &#13;
        print "Column 2:"&#13;
        for i in range(len(table.rows)):&#13;
            print table.rows[i].cells[1].paragraphs[0].text&#13;
&#13;
        print "Column 3:"&#13;
        for i in range(len(table.rows)):&#13;
            print table.rows[i].cells[2].paragraphs[0].text</pre></li><li class="listitem">In the preceding example, we used the <code class="literal">tables</code> object to read the tables in the document. Since we have only one table throughout the document, we get the first index with <code class="literal">tables[0]</code> and store the object in the <code class="literal">table</code> variable.</li><li class="listitem">Each table contains rows and columns and they can be accessed with <code class="literal">table.rows</code> or <code class="literal">table.columns</code>. We used the <code class="literal">table.rows</code> to get the number of rows in the table.</li><li class="listitem">Next, we iterated over all the rows and read the text in the cell with <code class="literal">table.rows[index].cells[index].paragraphs[0].text</code>. We needed the <code class="literal">paragraphs</code> object as this contains the actual text of the cell. (We again used the 0<sup>th</sup> index, as the assumption is that every cell has only one line of data.)</li><li class="listitem">From the first <code class="literal">for</code> loop, you'd identify that we're reading all three rows but reading the first cell in every row. Essentially, we're reading the column values.</li><li class="listitem">The output of the preceding code snippet shows all the columns with their values:<p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_017.jpg"/></div><p>
</p></li><li class="listitem">Nice! So, we're now experts in reading a Word document. But what's the use if we cant write data into a Word document? Let's look at how to write or create a <code class="literal">.docx</code> document in the next recipe.</li></ol></div></div></div>
<div class="section" title="Writing data into Word documents (adding headings, images, tables)"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Writing data into Word documents (adding headings, images, tables)</h1></div></div></div><p>Reading files is a breeze with the <code class="literal">python-docx</code> module. Now, let's shift our focus to writing Word documents. We'll perform multiple operations with documents in this section.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec88"/>Getting ready</h2></div></div></div><p>For this recipe, we will use the same fantastic Python module, <code class="literal">python-docx</code>. We don't need to spend much time on the setup. Let's get started!</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec89"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We start with a very basic operation of creating a <code class="literal">.docx</code> file and then to add a heading to it. The following code performs this operation:<pre class="programlisting">        from docx import Document&#13;
        document = Document()&#13;
        document.add_heading('Test Document from Docx', 0)&#13;
        document.save('testDoc.docx')</pre><p>This is how the document looks:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_018.jpg"/></div><p>
</p></li><li class="listitem">If you look at the screenshot, you will see a new document being created with a string in it. Observe how the screenshot indicates it is styled as a <span class="strong"><strong>Title</strong></span> text. How did we achieve this? Do you see <code class="literal">0</code> in the third line of our Python code? It talks about the heading type and styles the text accordingly. The <code class="literal">0</code> indicates title; <code class="literal">1</code> and <code class="literal">2</code> indicate text with <span class="strong"><strong>Heading 1</strong></span> or <span class="strong"><strong>Heading 2</strong></span>.</li><li class="listitem">Let's move ahead and add a new line to the document. We decorate the string with some words in bold and some in italics:<pre class="programlisting">        document = Document('testDoc.docx')&#13;
        p = document.add_paragraph('A plain paragraph&#13;
                                    having some ')&#13;
        p.add_run('bold words').bold = True&#13;
        p.add_run(' and italics.').italic = True&#13;
        document.save('testDoc.docx')</pre></li><li class="listitem">The document now looks as shown in the following screenshot. Observe the line added in the <span class="strong"><strong>Normal </strong></span>style. Some words in the text are bold and few of them are in italics:<p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_019.jpg"/></div><p>
</p></li><li class="listitem">OK, good. Let's add another subtopic to our document. See the following code implementation. Here, we create a subtopic with style <span class="strong"><strong>Heading 1</strong></span> and add a new line under this topic:<pre class="programlisting">        document = Document('testDoc.docx')&#13;
        document.add_heading('Lets talk about Python &#13;
                              language', level=1)&#13;
        document.add_paragraph('First lets see the Python&#13;
                                logo', style='ListBullet')&#13;
        document.save('testDoc.docx')</pre></li><li class="listitem">The document now looks as shown in the following screenshots. When taking the screenshot, I had clicked on the line with <span class="strong"><strong>Heading 1</strong></span> that shows up in the screenshot. Note how the subtopic is styled as a bullet point:<p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_020.jpg"/></div><p>
</p></li><li class="listitem">There's often a need to include images in the documents. Now that's really, really, easy. Check out the following code for this step:<pre class="programlisting">        from docx.shared import Inches&#13;
        document = Document('testDoc.docx')&#13;
        document.add_picture('python.png', &#13;
                              width=Inches(1.25)) &#13;
        document.save('testDoc.docx')</pre><p>If you run the Python code on your interpreter, you will see that the document now contains a nice Python logo. Please note that I had clicked on the image before taking the screenshot to catch your attention, so it's not done by the library:</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_021.jpg"/></div><p>
</p></li><li class="listitem">Last but not least, we may also want to add tables to our document, right? Let's do that. The following code demonstrates adding tables to the DOCX file:<pre class="programlisting">        document = Document('testDoc.docx')&#13;
        table = document.add_table(rows=1, cols=3)&#13;
        table.style = 'TableGrid'&#13;
&#13;
        data = {'id':1, 'items':'apple', 'price':50}&#13;
&#13;
        headings = table.rows[0].cells&#13;
        headings[0].text = 'Id'&#13;
        headings[1].text = 'Items'&#13;
        headings[2].text = 'Price'&#13;
 &#13;
        row = table.add_row().cells&#13;
        row[0].text = str(data.get('id'))&#13;
        row[1].text = data.get('items')&#13;
        row[2].text = str(data.get('price')) &#13;
        document.save('testDoc.docx')</pre></li></ol></div><p>The following screenshot shows how the complete document looks along with the table. Nice!</p><p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_022.jpg"/></div><p>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec90"/>How it works...</h2></div></div></div><p>In the first code snippet, we created the <code class="literal">document</code> object from the <code class="literal">Document</code> class. We then used this object to add a new heading, which contains the text <code class="literal">Hi this is a nice text document</code>. I know this is not a text document but just a string.</p><p>In the second example, adding a new line is done with the <code class="literal">add_paragraph()</code> method (remember, <code class="literal">paragraphs</code> was used to read the lines from the word document in the previous section). And how did we get the styling? That is possible with the <code class="literal">add_run()</code> method by setting the attributes <code class="literal">bold</code> and <code class="literal">italic</code> to <code class="literal">true</code>.</p><p>In the fourth example, we just used the <code class="literal">add_image()</code> method to add the picture to the document. We could also set the height and width of the image in inches. To do this, we imported a new class, <code class="literal">Inches</code>, and set the width of the image to 1.25 inches. Simple and neat!</p><p>In the final example, we added a table to the document by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We started by creating a table object with the <code class="literal">add_table()</code> method. We configured the table to contain one row and three columns. We also styled the table to be a grid table.</li><li class="listitem">As we saw in the previous section, the <code class="literal">table</code> object has the <code class="literal">rows</code> and <code class="literal">columns</code> objects. We used these to fill in the table with the dictionary <code class="literal">data</code>.</li><li class="listitem">Then we added a heading to the table. Heading is the first row of the table and, hence, we used <code class="literal">table.rows[0]</code> to fill the data in it. We filled the first column by <code class="literal">Id</code>, the second by <code class="literal">Items</code>, and the third by <code class="literal">Price</code>.</li><li class="listitem">After the heading, we added a new row and filled the cells of this row from the data dictionary.</li><li class="listitem">If you look at the screenshot, the document now has one table added to it, where ID is <code class="literal">1</code>, item is <code class="literal">apple</code> and price is <code class="literal">50</code>.</li></ol></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec91"/>There's more...</h2></div></div></div><p>What you learnt in the preceding section were straightforward, frequently done, day-to-day operations of writing into DOCX files. We could perform many more operations programmatically as we are used to doing manually on word documents. Let's now bring the learning together in a business use case.</p></div></div>
<div class="section" title="Generating personalized new hire orientation for HR team in an automated way"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Generating personalized new hire orientation for HR team in an automated way</h1></div></div></div><p>As the HR manager of your company, you are responsible for new hire orientation. You see that, every month, you have at least 15-20 new employees joining your organization. Once they complete a month in the company, you have to take them through your company policies in an orientation program.</p><p>For this, you need to send them a personalized document with new hire orientation details. Getting the details of employees one by one from the database is tedious; on top of that, you have to filter for employees who are due for orientation, based on different departments.</p><p>All this is time-consuming and you feel this process can be easily automated. Let's see how we can use the knowledge we have acquired so far in this chapter to automate this process.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec92"/>Getting ready</h2></div></div></div><p>For this recipe, we will use <code class="literal">python-docx</code>, which has been so helpful in our previous recipes. So, we need not install any new modules.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec93"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's first split the problem. First, we need to collect the employees who are due for orientation. Next, we need to know their department and look at the schedule template based on the department. Once these details are available, we need to put this together in a document.</li><li class="listitem">Look at the code implementation for this scenario:<pre class="programlisting">        from docx import Document&#13;
 &#13;
        employee_data = [&#13;
            {'id': 123, 'name': 'John Sally', 'department':&#13;
             'Operations', 'isDue': True},&#13;
            {'id': 245, 'name': 'Robert Langford',&#13;
            'department': 'Software', 'isDue': False},&#13;
        ]&#13;
        agenda = {&#13;
            "Operations": ["SAP Overview", "Inventory Management"],&#13;
            "Software": ["C/C++ Overview", "Computer Architecture"],&#13;
            "Hardware": ["Computer Aided Tools", "Hardware Design"] }&#13;
        def generate_document(employee_data, agenda):&#13;
            document = Document()&#13;
            for emp in employee_data:&#13;
                if emp['isDue']:&#13;
                    name = emp['name']&#13;
                    document.add_heading('Your New Hire&#13;
                                    Orientationn', level=1)&#13;
                    document.add_paragraph('Dear %s,' % name)&#13;
                    document.add_paragraph('Welcome to Google&#13;
                      Inc. You have been selected for our new&#13;
                      hire orientation.')&#13;
                   document.add_paragraph('Based on your &#13;
                      department you will go through &#13;
                      below sessions:')&#13;
                   department = emp['department']&#13;
                   for session in agenda[department]:&#13;
                       document.add_paragraph(&#13;
                         session , style='ListBullet'&#13;
                   )&#13;
                   document.add_paragraph('Thanks,n HR Manager')&#13;
                   document.save('orientation_%s.docx' % emp['id'])&#13;
                   generate_document(employee_data, agenda)</pre></li><li class="listitem">If you run this code snippet, this is how your document will look with all the relevant details about the orientation. Cool! But how did it work? We will see that in the <span class="emphasis"><em>How it works</em></span> section.<p>
</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_023.jpg"/></div><p>
</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec94"/>How it works...</h2></div></div></div><p>In the preceding code, we have a prefilled dictionary, <code class="literal">employee_data</code>, which contains employee information. This dictionary also contains information on whether an employee is due for orientation or not. We also have the <code class="literal">agenda</code> dictionary that acts as a template for different sessions based on the department. We have manually added all this data in Python dictionaries in this example, but in the real world, it needs to be pulled from your organization's database.</p><p>Next, we write a <code class="literal">generate_document()</code> method that takes <code class="literal">employee_data</code> and <code class="literal">agenda</code>. It iterates through all the employees and checks if a given employee is due for orientation and starts writing the document. First it adds a title, then follows up with a personalized address to the employee, and then shifts down to the sessions the employee needs to attend based on his or her department.</p><p>In the end, all the text is saved as a document with the name, <code class="literal">orientation_&lt;emp_id&gt;.docx</code> file.</p><p>That was cool! Imagine the time you saved. How happy are you as a HR manager? You acquired some new skills and quickly applied them for the benefit of your team. Awesome!</p><p>We have come to the end of this chapter on reading, writing, and manipulating PDF files and documents. Hope you enjoyed it and learnt many new things that you can apply to your work at office or at school! Of course you could do more; I highly encourage you to try out these modules and have fun with them.</p></div></div></body></html>