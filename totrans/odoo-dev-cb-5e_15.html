<html><head></head><body>
		<div><h1 id="_idParaDest-712" class="chapter-number"><a id="_idTextAnchor861"/>15</h1>
			<h1 id="_idParaDest-713"><a id="_idTextAnchor862"/>Web Client Development</h1>
			<p>Odoo’s web client, or backend, is where employees spend most of their time.</p>
			<p>In <a href="B20997_09.xhtml#_idTextAnchor446"><em class="italic">Chapter 9</em></a><em class="italic">, Backend Views</em>, you saw how to use the existing functionality that backends provide. Here, we’ll take a look at how to extend and customize those functionalities.</p>
			<p>The <code>web</code> module contains everything related to the user interface in Odoo.</p>
			<p>All of the code in this chapter will depend on the <code>web</code> module. As you know, Odoo has two different editions (Enterprise and Community).</p>
			<p>The Community version uses the <code>web</code> module for user interfaces, while the Enterprise version uses an extended version of the Community <code>web</code> module, which is the <code>web_enterprise</code> module.</p>
			<p>The Enterprise version provides more features than the Community version, including mobile compatibility, searchable menus, and material design. We’ll work on the Community version here. Don’t worry—the modules developed in Community work perfectly in Enterprise because, internally, <code>web_enterprise</code> depends on the Community <code>web</code> module and just adds some features to it.</p>
			<p class="callout-heading">Important information</p>
			<p class="callout">Odoo 17 is a bit different for the backend web client compared to other Odoo versions. It contains two different frameworks to maintain the GUI of the Odoo backend. The first one is the widget-based legacy framework, and the second one is the component-based modern<a id="_idIndexMarker1074"/> framework called the <strong class="bold">Odoo Web Library</strong> (<strong class="bold">OWL</strong>). OWL is the new UI framework introduced in Odoo v16. Both use QWeb templates for structure, but there are significant changes in the syntax and the way those frameworks work.</p>
			<p class="callout">Although Odoo 17 has a new framework OWL, Odoo does not use this new framework everywhere. Most of the web client is still written with the old widget-based framework. In this chapter, we will see how to customize the web client using a widget-based framework. In the next chapter, we will look at the OWL framework.</p>
			<p>In this chapter, you will learn how to create new field widgets to get input from users. We will also be creating a new view from scratch. After reading this chapter, you will be able to create your own UI elements in the Odoo backend.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Odoo’s user interface heavily depends on JavaScript. Throughout this chapter, we will assume you have a basic knowledge of JavaScript, jQuery, and SCSS.</p>
			<p>In this chapter, we will cover the following recipes:</p>
			<ul>
				<li>Creating custom widgets</li>
				<li>Using client-side QWeb templates</li>
				<li>Making RPC calls to the server</li>
				<li>Creating a new view</li>
				<li>Debugging your client-side code</li>
				<li>Improving onboarding with tours</li>
				<li>Mobile app JavaScript</li>
			</ul>
			<h1 id="_idParaDest-714"><a id="_idTextAnchor863"/>Technical requirements</h1>
			<p>The technical requirement for this chapter is the online Odoo platform.</p>
			<p>All the code used in this chapter can be downloaded from the GitHub repository at <a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter15">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter15</a><a id="_idTextAnchor864"/></p>
			<h1 id="_idParaDest-715"><a id="_idTextAnchor865"/>Creating custom widgets</h1>
			<p>As you saw in <a href="B20997_09.xhtml#_idTextAnchor446"><em class="italic">Chapter 9</em></a><em class="italic">, Backend Views</em>, we can use<a id="_idIndexMarker1075"/> widgets to display certain data in different formats. For example, we used <code>widget='image'</code> to display a binary field as an image. To demonstrate how to create your own widget, we’ll write one widget that lets the user choose an integer field, but we will display it differently. Instead of an input box, we will display a color picker so that we can select a color number. Here, each number will be mapped to its related color<a id="_idTextAnchor866"/>.</p>
			<h2 id="_idParaDest-716"><a id="_idTextAnchor867"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module with basic fields and views. You will find the basic <code>my_hostel</code> module in the <code>Chapter15/00_initial_module</code> directory in the GitHub repository<a id="_idTextAnchor868"/>.</p>
			<h2 id="_idParaDest-717"><a id="_idTextAnchor869"/>How to do it…</h2>
			<p>We’ll add a JavaScript file that contains our widget’s logic, an XML file that contains design logic, and an SCSS file to do some styling. Then, we will add one integer field to the books form to use our new widget.</p>
			<p>Follow these steps to add a new field widget:</p>
			<ol>
				<li>This widget can be written with a very small amount of JavaScript. Let’s create a file called <code>static/src/js/field_widget.js</code> with this:<pre class="source-code">
/** @odoo-module */
import { Component} from "@odoo/owl";
import { registry } from "@web/core/registry";</pre></li>				<li>Create your widget by extending <code>Component</code>:<pre class="source-code">
export class CategColorField extends Component {</pre></li>				<li>Capture the JavaScript color widget code:<pre class="source-code">
export class CategColorField extends Component {
   setup() {
     this.totalColors = [1,2,3,4,5,6];
     super.setup();
  }
  clickPill(value) {
    this.props.record.update({ [this.props.name]: value });
  }
}</pre></li>				<li>Set the <code>template</code> and the supported <a id="_idIndexMarker1076"/>field types for the widget:<pre class="source-code">
CategColorField.template = "CategColorField";
CategColorField.supportedTypes = ["integer"];</pre></li>				<li>In the same file, register the component to the <code>fields</code> registry:<pre class="source-code">
registry.category("fields").add("category_color", {
  component: CategColorField,
});</pre></li>				<li>Add QWeb template design code in <code>static/src/xml/field_widget.xml</code>:<pre class="source-code">
&lt;templates xml:space="preserve"&gt;
  &lt;t t-name="CategColorField" owl="1"&gt;
    &lt;div&gt;
      &lt;t t-foreach="totalColors" t-as="color" t-key="color"&gt;
         &lt;span t-attf-class="o_color_pill o_color_#{color}
            {{props.record.data[props.name] == color ? 'active': ''}}"
            t-att-data-value="color"
            t-on-click="() =&gt; this.clickPill(color)"/&gt;
       &lt;/t&gt;
       &lt;div class="categInformationPanel
"/&gt;
    &lt;/div&gt;
  &lt;/t&gt;
&lt;/templates&gt;</pre></li>				<li>Add SCSS<a id="_idIndexMarker1077"/> in <code>static/src/scss/field_widget.scss</code>:<pre class="source-code">
.o_field_category_color {
  .o_color_pill {
    display: inline-block;
    height: 25px;
    width: 25px;
    margin: 4px;
    border-radius: 15px;
    position: relative;
    @for $size from 1 through length($o-colors) {
      &amp;.o_color_#{$size - 1} {
        background-color: nth($o-colors, $size);
        &amp;:not(.readonly):hover {
          transform: scale(1.2);
          transition: 0.3s;
          cursor: pointer;
        }
        &amp;.active:after{
          content: "\f00c";
          display: inline-block;
          font: normal 14px/1 FontAwesome;
          font-size: inherit;
          color: #fff;
          position: absolute;
          padding: 4px;
          font-size: 16px;
        }
      }
    }
  }
}</pre></li>				<li>Register files<a id="_idIndexMarker1078"/> in the manifest file:<pre class="source-code">
'assets': {
  'web.assets_backend': [
    'my_hostel/static/src/scss/field_widget.scss',
    'my_hostel/static/src/js/field_widget.js',
    'my_hostel/static/src/xml/field_widget.xml',
  ],
}</pre></li>				<li>Then, add the <code>Category</code> integer field to the <code>hostel.room</code> model:<pre class="source-code">
category = fields.Integer('Category')</pre></li>				<li> Add the category field to the hostel form view, and then add <code>widget="category_color"</code>:<pre class="source-code">
&lt;field name="category" widget="category_color"/&gt;</pre></li>			</ol>
			<p>Update the module to apply<a id="_idIndexMarker1079"/> the changes. After the update, open the hostel form view and you will see the category color picker, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_15_1.jpg" alt="Figure 15.1 – How the custom widget is displ﻿ayed"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.1 – How the custom widget is displ<a id="_idTextAnchor870"/>ayed</p>
			<h2 id="_idParaDest-718"><a id="_idTextAnchor871"/>How it works…</h2>
			<p>In <em class="italic">step 1</em>, we imported the <code>Component</code> and registry.</p>
			<p>In <em class="italic">step 2</em>, we created a <code>CategColorField</code> by extending the <code>Component</code>. Through this, <code>CategColorField</code> will get all the properties and methods from the <code>Component</code>.</p>
			<p>In <em class="italic">step 3</em>, we inherited the <code>setup</code> method and set the value of the <code>this.totalColors</code> attribute. We will use this variable to decide on the number of color pills. We want to display six color pills, so we assigned <code>[1,2,3,4,5,6]</code>.</p>
			<p>In <em class="italic">step 4</em>, we added the <code>clickPill</code> handler method to manage pill clicks. To set the field value, we used <code>this. props.update</code> method. This method is added from the <code>Component</code> class.</p>
			<p>In <em class="italic">step 5</em>, we added a template name where we rendered the <code>CategColorField</code> design and set supported types.</p>
			<p><code>supportedTypes</code> has been used to decide which types of field are supported by this widget. In our case, we want to create a widget for integer fields.</p>
			<p>In <em class="italic">step 6</em>, after registering the component to the fields registry.</p>
			<p>Finally, we exported our <code>widget</code> class so that other add-ons can extend it or inherit from it. Then, we added a new integer field called category to the <code>hostel.room</code> model. We also added the same field to the form view with the <code>widget="category_color"</code> attribute. This will display<a id="_idIndexMarker1080"/> our widget in the form instead of the default integer wi<a id="_idTextAnchor872"/>dget.</p>
			<h1 id="_idParaDest-719"><a id="_idTextAnchor873"/>Using client-side QWeb templates</h1>
			<p>Just as it’s a bad habit<a id="_idIndexMarker1081"/> to programmatically create HTML code in JavaScript, you should only create minimal DOM elements in your client-side JavaScript code. Fortunately, there’s a templating engine available for the client side.</p>
			<p>A client-side template engine is also available in Odoo. This template<a id="_idIndexMarker1082"/> engine is known as <strong class="bold">Qweb Templates</strong> and is carried out completely in JavaScript code and rendered inside the b<a id="_idTextAnchor874"/>rowser.</p>
			<h2 id="_idParaDest-720"><a id="_idTextAnchor875"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe and add <code>informationPanel</code> below the category color icon.</p>
			<p>Using <code>renderToElement</code>, we render the category information element and set it on <code>informatio<a id="_idTextAnchor876"/>nPanel</code>.</p>
			<h2 id="_idParaDest-721"><a id="_idTextAnchor877"/>How to do it...</h2>
			<p>We need to add the QWeb definition to the manifest and change the JavaScript code so that we can use it. Perform the following steps to get started:</p>
			<ol>
				<li>Import <code>@web/core/utils/render</code> and extract the <code>renderToElement</code> reference to a variable, as shown in the following code:<pre class="source-code">
import { renderToElement } from "@web/core/utils/render";</pre></li>				<li>Add the template file to <code>static/src/xml/field_widget.xml</code>:<pre class="source-code">
&lt;t t-name="CategColorField"&gt;
  &lt;div&gt;
    &lt;t t-foreach="totalColors" t-as="color" t-key="color"&gt;
       &lt;span t-attf-class="o_color_pill o_color_#{color}
            {{props.record.data[props.name] == color ? 'active': ''}}"
            t-att-data-value="color"
            t-on-click="() =&gt; this.clickPill(color)"
            t-on-mouseover.prevent="categInfo"/&gt;
    &lt;/t&gt;
    &lt;div class="categInformationPanel"/&gt;
  &lt;/div&gt;
&lt;/t&gt;
&lt;t t-name="CategInformation"&gt;
  &lt;div t-attf-class="categ_info o_color_pill o_color_#{value}"&gt;
    &lt;t t-if="value == 1"&gt;
      Single Room With AC&lt;br/&gt;
      &lt;ul&gt;
        &lt;li&gt;
          Small Dressing Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Bedside Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Writing Table
        &lt;/li&gt;
        &lt;li&gt;
          Attached Bathroom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/t&gt;
    &lt;t t-if="value == 2"&gt;
      Single Room With None AC&lt;br/&gt;
      &lt;ul&gt;
        &lt;li&gt;
          Small Dressing Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Bedside Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Writing Table
        &lt;/li&gt;
        &lt;li&gt;
          Attached Bathroom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/t&gt;
    &lt;t t-if="value == 3"&gt;
      King Double Room With AC&lt;br/&gt;
      &lt;ul&gt;
        &lt;li&gt;
          King Size Double Bed
        &lt;/li&gt;
        &lt;li&gt;
          Small Dressing Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Bedside Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Writing Table
        &lt;/li&gt;
        &lt;li&gt;
          TV
        &lt;/li&gt;
        &lt;li&gt;
          Small Fridge
        &lt;/li&gt;
        &lt;li&gt;
          Attached Bathroom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/t&gt;
    &lt;t t-if="value == 4"&gt;
      King Double Room With None AC&lt;br/&gt;
      &lt;ul&gt;
        &lt;li&gt;
          King Size Double Bed
        &lt;/li&gt;
        &lt;li&gt;
          Small Dressing Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Bedside Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Writing Table
        &lt;/li&gt;
        &lt;li&gt;
          TV
        &lt;/li&gt;
        &lt;li&gt;
          Small Fridge
        &lt;/li&gt;
        &lt;li&gt;
          Attached Bathroom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/t&gt;
    &lt;t t-if="value == 5"&gt;
      Queen Double Room With AC&lt;br/&gt;
      &lt;ul&gt;
        &lt;li&gt;
          Queen Size Double Bed
        &lt;/li&gt;
        &lt;li&gt;
          Small Dressing Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Bedside Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Writing Table
        &lt;/li&gt;
        &lt;li&gt;
          TV
        &lt;/li&gt;
        &lt;li&gt;
          Small Fridge
        &lt;/li&gt;
        &lt;li&gt;
          Attached Bathroom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/t&gt;
    &lt;t t-if="value == 6"&gt;
      Queen Double Room With None AC&lt;br/&gt;
      &lt;ul&gt;
        &lt;li&gt;
          Queen Size Double Bed
        &lt;/li&gt;
        &lt;li&gt;
          Small Dressing Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Bedside Table
        &lt;/li&gt;
        &lt;li&gt;
          Small Writing Table
        &lt;/li&gt;
        &lt;li&gt;
          TV
        &lt;/li&gt;
        &lt;li&gt;
          Small Fridge
        &lt;/li&gt;
        &lt;li&gt;
          Attached Bathroom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/t&gt;
  &lt;/div&gt;
&lt;/t&gt;</pre></li>				<li>Add the mouseover function<a id="_idIndexMarker1083"/> and, in this function, simply render the category information element using <code>renderToElement.render</code> and append the <code>categ</code> information element to <code>categInformationPanel</code>:<pre class="source-code">
categInfo(ev){
  var $target = $(ev.target);
  var data = $target.data();
  $target.parent().find(".categInformationPanel").html(
    $(renderToElement('CategInformation',{
      'value': data.value,
      'widget': this
    }))
  )
}</pre></li>				<li>Add SCSS in <code>static/src/scss/field_widget.scss</code> to set the category information style:<pre class="source-code">
.categInformationPanel .categ_info{
  padding: 10px;
  height: 100%;
  width: 100%;
  color: white;
  font-weight: bold;
}</pre></li>				<li>Register the QWeb file in your manifest:<pre class="source-code">
'assets': {
  'web.assets_backend': [
    'my_hostel/static/src/scss/field_widget.scss',
    'my_hostel/static/src/js/field_widget.js',
    'my_hostel/static/src/xml/field_widget.xml',
  ],
}</pre></li>			</ol>
			<p>Restart the server to apply<a id="_idIndexMarker1084"/> the changes. After the restart, open the hotel form view and you will see the category information panel, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_15_2.jpg" alt="Figure 15.2 – Category information panel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.2 – Category information panel</p>
			<p>When we hover over the category color icon:</p>
			<p class="IMG---Figure"> </p>
			<div><div><img src="img/B20997_15_3.jpg" alt="Figure 15.3 – Hovering over the category icon displays category infor﻿mation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.3 – Hovering over the category icon displays category infor<a id="_idTextAnchor878"/>mation</p>
			<h2 id="_idParaDest-722"><a id="_idTextAnchor879"/>How it works...</h2>
			<p>As there is already a comprehensive<a id="_idIndexMarker1085"/> discussion on the basics of QWeb in the <em class="italic">Creating or Modifying Templates – QWeb</em> recipe in <a href="B20997_14.xhtml#_idTextAnchor734"><em class="italic">Chapter 14</em></a>, <em class="italic">CMS Website Development</em>, we’ll focus on what is different here. First of all, you need to realize that we’re dealing with the JavaScript QWeb implementation, as opposed to the Python implementation on the server side. This means that you don’t have access to browsing records or the environment; you only have access to the parameters you have passed from the <code>renderToElement</code> function.</p>
			<p>In our case, we have passed the current object via the <code>widget</code> key. This means that you should have all the intelligence in the widget’s JavaScript code and have your template only access properties, or possibly functions. Given that we can access all the available properties on the widget, we can simply check the value in the template by checking the hover category color property.</p>
			<p>As client-side QWeb has nothing to do with QWeb views, there’s a different mechanism to make<a id="_idIndexMarker1086"/> those templates known to the web client—add them via the QWeb key to your add-on’s manifest in a list of filenames relative to the add-o<a id="_idTextAnchor880"/>n’s root.</p>
			<h2 id="_idParaDest-723"><a id="_idTextAnchor881"/>There’s more…</h2>
			<p>The reason for going<a id="_idIndexMarker1087"/> to the effort of using QWeb here was extensibility. If, for example, we want to add info icons to our widget from another module, we’ll use the following code to have an icon in each pill:</p>
			<pre class="source-code">
&lt;t t-name="CategInformationCustom" t-inherit="my_hostel.CategInformation"
    t-inherit-mode="extension"&gt;
    &lt;xpath expr='//t[@t-if="value == 1"]' position="before"&gt;
      &lt;i class="fa fa-info-circle" aria-hidden="true"&gt;&lt;/i&gt;
    &lt;/xpath&gt;
  &lt;/t&gt;</pre>			<div><div><img src="img/B20997_15_4.jpg" alt="Figure 15.4 – Info icon on the category informati﻿on panel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.4 – Info icon on the category informati<a id="_idTextAnchor882"/>on panel</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you want to learn more about the QWeb templates, refer to the following points:</p>
			<p class="callout">- The client-side QWeb engine<a id="_idIndexMarker1088"/> has less convenient error messages and handling than other parts of Odoo. A small error often means that nothing happens, and it’s hard for beginners to continue from there.</p>
			<p class="callout">- Fortunately, there are some debug statements for client-side QWeb templates that will be described later in this chapter in the <em class="italic">Debugging your client-side </em><em class="italic">co<a id="_idTextAnchor883"/>de</em> recipe.</p>
			<h1 id="_idParaDest-724"><a id="_idTextAnchor884"/>Making RPC calls to the server</h1>
			<p>Sooner or later, your widget<a id="_idIndexMarker1089"/> will need to look<a id="_idIndexMarker1090"/> up some data from the server. In this recipe, we will add a category booked panel to the category information panel. When the user hovers their cursor over the category color pill element, the booked panel will show the number of booked rooms related to that category color. We will make an RPC call to the server to fetch a book count of the data associated with that particul<a id="_idTextAnchor885"/>ar category.</p>
			<h2 id="_idParaDest-725"><a id="_idTextAnchor886"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the prev<a id="_idTextAnchor887"/>ious recipe.</p>
			<h2 id="_idParaDest-726"><a id="_idTextAnchor888"/>How to do it…</h2>
			<p>Follow these steps to make an RPC call to the server and display the result in a <code>colorPreviewPanel</code>:</p>
			<ol>
				<li>Import <code>@odoo/owl</code> and extract the <code>onWillStart,onWillUpdateProps</code> reference to a variable, as shown in the following code:<pre class="source-code">
import { Component, onWillStart , onWillUpdateProps} from "@odoo/owl";</pre></li>				<li>Add the <code>onWillStart</code> method to the <code>setup</code> method and call our custom <code>load</code><code> </code><code>ColorData</code> method:<pre class="source-code">
onWillStart(() =&gt; {
  this.loadCategInformation();
});
onWillUpdateProps(() =&gt; {
  this.loadCategInformation();
});</pre></li>				<li>Add the <code>loadCategInformation</code> method<a id="_idIndexMarker1091"/> and set <code>categInfoData</code> in the<a id="_idIndexMarker1092"/> RPC call:<pre class="source-code">
async loadCategInformation() {
  var self = this;
  self.categoryInfo = {};
  var resModel = self.env.model.root.resModel;
  var domain = [];
  var fields = ['category'];
  var groupby = ['category'];
  const categInfoPromise = await self.env.services.orm.readGroup(
  resModel,
  domain,
  fields,
  groupby
);
  categInfoPromise.map((info) =&gt; {
    self.categoryInfo[info.category] = info.category_count;
  });
}</pre></li>				<li>Update <code>CategoryInformation</code> template<a id="_idIndexMarker1093"/> and add the count<a id="_idIndexMarker1094"/> data:<pre class="source-code">
&lt;t t-name="CategInformationCustom" t-inherit="my_hostel.CategInformation"
    t-inherit-mode="extension"&gt;
    &lt;xpath expr='//t[@t-if="value == 1"]' position="before"&gt;
      &lt;i class="fa fa-info-circle" aria-hidden="true"&gt;&lt;/i&gt;
    &lt;/xpath&gt;
    &lt;xpath expr="//div" position="inside"&gt;
      &lt;div class="text-center"
         style="color:gray;background: white;padding:3px;padding: 5px;border-radius: 5px;"&gt;
        Total Booked Rooms: &lt;t t-esc="widget.categoryInfo[value] or 0"/&gt;
      &lt;/div&gt;
    &lt;/xpath&gt;
  &lt;/t&gt;</pre></li>			</ol>
			<p>Update the module to apply the changes. After the update, you will see a count of category information, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_15_5.jpg" alt="Figure 15.5 – Data ﻿Fetch Using RPC"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.5 – Data <a id="_idTextAnchor889"/>Fetch Using RPC</p>
			<h2 id="_idParaDest-727"><a id="_idTextAnchor890"/>How it works…</h2>
			<p>The <code>onWillStart</code> hook will be called<a id="_idIndexMarker1095"/> just before the component<a id="_idIndexMarker1096"/> is rendered for the first time. It will be useful if we need to do some actions before the component is rendered to the view, such as loading some initial data.</p>
			<p><code>onWillUpdateProps</code> is also an asynchronous hook that is called whenever an update is made to a related component. The reactive nature of the OWL framework can be maintained using this amazing hook.</p>
			<p>When dealing with data access, we rely on the <code>_rpc</code> function provided by the <code>ORM</code><code>search</code>, <code>read</code>, <code>write</code>, or, in this case, <code>read_group</code>.</p>
			<p>In <em class="italic">step 1</em>, we made an RPC call and invoked the <code>read_group</code> method on the current model, which is <code>hostel.room</code> in our case. We grouped data based on the <code>category</code> field so that the RPC call will return book data that were grouped by <code>category</code> and add an aggregate in the <code>category_count</code> key. We also mapped the <code>category_count</code> and <code>category</code> index in the <code>categoryInfo</code> so that we could use it in the QWeb template.</p>
			<p><em class="italic">Step 2</em> is nothing special. We just initialized the bootstrap tooltip.</p>
			<p>In <em class="italic">step 3</em>, we used <code>categoryInfo</code> to set the attributes that are needed to display the category information. In the <code>loadCategInformation</code> method, we assigned a color map via <code>this.categoryInfo</code> so that you can access them in the QWeb template via <code>widget.categoryInfo</code>. This is because<a id="_idIndexMarker1097"/> we passed the widget<a id="_idIndexMarker1098"/> reference; this is the <code>rend<a id="_idTextAnchor891"/>erToElement</code> method.</p>
			<h2 id="_idParaDest-728"><a id="_idTextAnchor892"/>See also</h2>
			<p>Odoo’s RPC returns JavaScript’s native <code>Promise</code> object. You will get the requested data once the <code>Promise</code> is resolved. You can learn<a id="_idIndexMarker1099"/> more about <code>Promise</code> here: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise</a></p>
			<h1 id="_idParaDest-729"><a id="_idTextAnchor893"/>Creating a new view</h1>
			<p>As you saw in <a href="B20997_09.xhtml#_idTextAnchor446"><em class="italic">Chapter 9</em></a>, <em class="italic">Backend Views</em>, there are different<a id="_idIndexMarker1100"/> kinds of views, such as form, list, and kanban. In this recipe, we will create a new view. This view will display the list of rooms, along<a id="_idTextAnchor894"/> with their students.</p>
			<h2 id="_idParaDest-730"><a id="_idTextAnchor895"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe. Note that views are very complex structures, and each view has a different purpose and implementation. The purpose of this recipe is to make you aware of the <code>MVC</code> pattern view and how to create simple views. In this recipe, we will create a view called <code>m2m_group</code>, the purpose of which is to display records in groups. To divide records into different groups, the view will use the <code>many2x</code> field data. In the <code>my_hostel</code> module, we have the <code>room_id</code> field. Here, we will group students based on room and display them in cards.</p>
			<p>In addition, we will add a new button to the control panel. With the help of this button, you will be able to add a new student record. We will also add a button to the room’s card so that we can redirect u<a id="_idTextAnchor896"/>sers to another view.</p>
			<h2 id="_idParaDest-731"><a id="_idTextAnchor897"/>How to do it…</h2>
			<p>Follow these steps<a id="_idIndexMarker1101"/> to add a new view called <code>m2m_group</code>:</p>
			<ol>
				<li>Add a new view type in <code>ir.ui.view</code>:<pre class="source-code">
class View(models.Model):
  _inherit = 'ir.ui.view'
  type = fields.Selection(selection_add=[('m2m_group', 'M2m Group')])</pre></li>				<li>Add a new view mode in <code>ir.actions.act_window.view</code>:<pre class="source-code">
class ActWindowView(models.Model):
  _inherit = 'ir.actions.act_window.view'
  view_mode = fields.Selection(selection_add=[
('m2m_group', 'M2m group')], ondelete={'m2m_group': 'cascade'})</pre></li>				<li>Add a new method by inheriting from the base model. This method will be called from the JavaScript model (see <em class="italic">step 4</em> for more details):<pre class="source-code">
class Base(models.AbstractModel):
  _inherit = 'base'
  @api.model
  def get_m2m_group_data(self, domain, m2m_field):
    records = self.search(domain)
    result_dict = {}
    for record in records:
      for m2m_record in record[m2m_field]:
        if m2m_record.id not in result_dict:
          result_dict[m2m_record.id] = {
            'name': m2m_record.name,
            'children': [],
            'model': m2m_record._name
          }
        result_dict[m2m_record.id]['children'].append({
          'name': record.display_name,
          'id': record.id,
        })
    return result_dict</pre></li>				<li>Add a new file<a id="_idIndexMarker1102"/> called <code>/static/src/js/m2m_group_model.js</code> and add the following content to it:<pre class="source-code">
/** @odoo-module **/
import { Model } from "@web/model/model";
export class M2mGroupModel extends Model {
  setup(params) {
    const metaData = Object.assign({}, params.metaData, {});
    this.data = params.data || {};
    this.metaData = this._buildMetaData(metaData);
    this.m2m_field = this.metaData.m2m_field;
  }
  _buildMetaData(params) {
    const metaData = Object.assign({}, this.metaData, params);
    return metaData;
  }
  async load(searchParams) {
    var self = this;
    const model = self.metaData.resModel;
    const method = 'get_m2m_group_data'
    const m2m_field = self.m2m_field
    const result = await this.orm.call(
      model,
      method,
      [searchParams.domain, m2m_field]
    )
    self.data = result;
    return result;
  }
}</pre></li>				<li>Add a new file <a id="_idIndexMarker1103"/>called <code>/static/src/js/m2m_group_controller.js</code> and add the following content to it:<pre class="source-code">
/** @odoo-module **/
import { useService } from "@web/core/utils/hooks";
import { Layout } from "@web/search/layout";
import { useModelWithSampleData } from "@web/model/model";
import { standardViewProps } from "@web/views/standard_view_props";
import { Component } from "@odoo/owl";
export class M2mGroupController extends Component {
  setup() {
    this.actionService = useService("action");
    this.model = useModelWithSampleData(this.props.Model, this.props.modelParams);
  }
  _onBtnClicked(domain) {
    this.actionService.doAction({
      type: 'ir.actions.act_window',
      name: this.model.metaData.title,
      res_model: this.props.resModel,
      views: [[false, 'list'], [false, 'form']],
      domain: domain,
    });
  }
  _onAddButtonClick(ev) {
    this.actionService.doAction({
      type: 'ir.actions.act_window',
      name: this.model.metaData.title,
      res_model: this.props.resModel,
      views: [[false, 'form']],
      target: 'new'
    });
  }
}
M2mGroupController.template = "M2mGroupView";
M2mGroupController.components = { Layout };
M2mGroupController.props = {
  ...standardViewProps,
  Model: Function,
  modelParams: Object,
  Renderer: Function,
  buttonTemplate: String,
};</pre></li>				<li>Add a new file<a id="_idIndexMarker1104"/> called <code>/static/src/js/m2m_group_renderer.js</code> and add the following content to it:<pre class="source-code">
/** @odoo-module **/
import { Component } from "@odoo/owl";
export class M2mGroupRenderer extends Component {
  onClickViewButton(group) {
     var children_ids = group.children.map((group_id) =&gt; {
      return group_id.id;
    });
    const domain = [['id', 'in', children_ids]]
    this.props.onClickViewButton(domain);
  }
  get groups() {
    return this.props.model.data
  }
}
M2mGroupRenderer.template = "M2mGroupRenderer";
M2mGroupRenderer.props = ["model", "onClickViewButton"];</pre></li>				<li>Add a new file<a id="_idIndexMarker1105"/> called <code>/static/src/js/m2m_group_arch_parser.js</code> and add the following content to it:<pre class="source-code">
/** @odoo-module **/
import { visitXML } from "@web/core/utils/xml";
export class M2mGroupArchParser {
  parse(arch, fields = {}) {
    const archInfo = { fields, fieldAttrs: {} };
    visitXML(arch, (node) =&gt; {
      switch (node.tagName) {
        case "m2m_group": {
          const m2m_field = node.getAttribute("m2m_field");
          if (m2m_field) {
            archInfo.m2m_field = m2m_field;
          }
          const title = node.getAttribute("string");
          if (title) {
            archInfo.title = title;
          }
          break;
        }
        case "field": {
          const fieldName = node.getAttribute("name"); // exists (rng validation)
          if (fieldName === "id") {
            break;
          }
          const string = node.getAttribute("string");
          if (string) {
            if (!archInfo.fieldAttrs[fieldName]) {
              archInfo.fieldAttrs[fieldName] = {};
            }
            archInfo.fieldAttrs[fieldName].string = string;
          }
          const modifiers = JSON.parse(node.getAttribute("modifiers") || "{}");
          if (modifiers.invisible === true) {
            if (!archInfo.fieldAttrs[fieldName]) {
              archInfo.fieldAttrs[fieldName] = {};
            }
            archInfo.fieldAttrs[fieldName].isInvisible = true;
            break;
          }
          break;
        }
      }
    });
    return archInfo;
  }
}</pre></li>				<li>Add a new file <a id="_idIndexMarker1106"/>called <code>/static/src/js/m2m_group_view.js</code> and add the following content to it:<pre class="source-code">
/** @odoo-module **/
import { _lt } from "@web/core/l10n/translation";
import { registry } from "@web/core/registry";
import { M2mGroupArchParser } from "./m2m_group_arch_parser";
import { M2mGroupController } from "./m2m_group_controller";
import {  M2mGroupModel } from "./m2m_group_model";
import { M2mGroupRenderer } from "./m2m_group_renderer";
const viewRegistry = registry.category("views");
export const M2mGroupView = {
  type: "m2m_group",
  display_name: _lt("Author"),
  icon: "fa fa-id-card-o",
  multiRecord: true,
  Controller: M2mGroupController,
  Renderer: M2mGroupRenderer,
  Model: M2mGroupModel,
  ArchParser: M2mGroupArchParser,
  searchMenuTypes: ["filter", "favorite"],
  buttonTemplate: "ViewM2mGroup.buttons",
  props: (genericProps, view) =&gt; {
    const modelParams = {};
    const { arch, fields, resModel } = genericProps;
    // parse arch
    const archInfo = new view.ArchParser().parse(arch);
    modelParams.metaData = {
      m2m_field: archInfo.m2m_field,
      fields: fields,
      fieldAttrs: archInfo.fieldAttrs,
      resModel: resModel,
      title: archInfo.title || _lt("Untitled"),
      widgets: archInfo.widgets,
    };
    return {
      ...genericProps,
      Model: view.Model,
      modelParams,
      Renderer: view.Renderer,
      buttonTemplate: view.buttonTemplate,
    };
  },
};
viewRegistry.add("m2m_group", M2mGroupView);</pre></li>				<li>Add the QWeb template<a id="_idIndexMarker1107"/> for the view to the <code>/</code><code>static/src/xml/m2m_group_controller.xml</code> file:<pre class="source-code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;templates xml:space="preserve"&gt;
  &lt;t t-name="M2mGroupView" owl="1"&gt;
    &lt;div t-att-class="props.className" t-ref="root"&gt;
      &lt;Layout display="props.display"&gt;
        &lt;t t-set-slot="layout-buttons"&gt;
           &lt;t t-call="{{ props.buttonTemplate }}"/&gt;
        &lt;/t&gt;
         &lt;div&gt;
           &lt;t t-component="props.Renderer"
            model="model"
            onClickViewButton="group =&gt; this._onBtnClicked(group)"/&gt;
         &lt;/div&gt;
      &lt;/Layout&gt;
    &lt;/div&gt;
  &lt;/t&gt;
&lt;/templates&gt;</pre></li>				<li>Add the QWeb template<a id="_idIndexMarker1108"/> for the view to the <code>/</code><code>static/src/xml/m2m_group_renderer.xml</code> file:<pre class="source-code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;templates xml:space="preserve"&gt;
  &lt;t t-name="M2mGroupRenderer" owl="1"&gt;
    &lt;div class="row ml16 mr16"&gt;
      &lt;div t-foreach="groups" t-as="group" class="col-3" t-key="group"&gt;
        &lt;t t-set="group_data" t-value="groups[group]" /&gt;
        &lt;div class="card mt16"&gt;
          &lt;img class="card-img-top"
          t-attf-src="img/image"
          style="height: 300px;"/&gt;
          &lt;div class="card-body"&gt;
            &lt;h5 class="card-title mt8"&gt;
              &lt;t t-esc="group_data['name']"/&gt;
            &lt;/h5&gt;
          &lt;/div&gt;
          &lt;ul class="list-group list-group-flush"&gt;
            &lt;t t-foreach="group_data['children']" t-as="child" t-key="child.id"&gt;
              &lt;li class="list-group-item"&gt;
                &lt;i class="fa fa-user"/&gt;&lt;t t-esc="child.name"/&gt;
              &lt;/li&gt;
            &lt;/t&gt;
          &lt;/ul&gt;
          &lt;div class="card-body"&gt;
            &lt;a href="#" class="btn btn-sm btn-primary o_primay_button"
             t-att-data-group="group"
             t-on-click="() =&gt; this.onClickViewButton(group_data)"&gt;View&lt;/a&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/t&gt;
&lt;/templates&gt;</pre></li>				<li>Add the QWeb template for the view to the <code>/</code><code>static/src/xml/m2m_group_view.xml</code> file:<pre class="source-code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;templates xml:space="preserve"&gt;
  &lt;t t-name="ViewM2mGroup.buttons" owl="1"&gt;
    &lt;button type="button" class="btn btn-primary"
        t-on-click="() =&gt; this._onAddButtonClick()"&gt;
      Add Record
    &lt;/button&gt;
  &lt;/t&gt;
&lt;/templates&gt;</pre></li>				<li>Add all of the JavaScript <a id="_idIndexMarker1109"/>and XML files to the backend assets:<pre class="source-code">
'assets': {
  'web.assets_backend': [
    'my_hostel/static/src/js/m2m_group_arch_parser.js',
    'my_hostel/static/src/js/my_hostel_tour.js',
    'my_hostel/static/src/js/m2m_group_view.js',
    'my_hostel/static/src/js/m2m_group_renderer.js',
    'my_hostel/static/src/js/m2m_group_model.js',
    'my_hostel/static/src/js/m2m_group_controller.js',
    'my_hostel/static/src/xml/m2m_group_controller.xml',
    'my_hostel/static/src/xml/m2m_group_renderer.xml',
    'my_hostel/static/src/xml/m2m_group_view.xml',
    'my_hostel/static/src/xml/field_widget.xml',
  ],
},</pre></li>				<li>Finally, add our new view for the <code>hostel.student</code> model:<pre class="source-code">
&lt;record id="view_hostel_student_m2m_group" model="ir.ui.view"&gt;
  &lt;field name="name"&gt;Students&lt;/field&gt;
  &lt;field name="model"&gt;hostel.student&lt;/field&gt;
  &lt;field name="arch" type="xml"&gt;
    &lt;m2m_group m2m_field="room_id"&gt;
    &lt;/m2m_group&gt;
  &lt;/field&gt;
&lt;/record&gt;</pre></li>				<li>Add <code>m2m_group</code> to the action:<pre class="source-code">
&lt;field name="view_mode"&gt;tree,m2m_group,form&lt;/field&gt;</pre></li>			</ol>
			<p>Update the <code>my_hostel</code> module<a id="_idIndexMarker1110"/> to open the <strong class="bold">Students</strong> view, and then, from the view switcher, open the new view that we just added. This will look as follows:</p>
			<div><div><img src="img/B20997_15_6.jpg" alt="Figure 15.6 – Many2many group view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.6 – Many2many group view</p>
			<div><div><img src="img/B20997_15_7.jpg" alt="Figur﻿e 15.7 – Many2many group view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figur<a id="_idTextAnchor898"/>e 15.7 – Many2many group view</p>
			<p class="callout-heading">Important information</p>
			<p class="callout">Odoo views are very easy to use and are very flexible. However, it is often the case that easy and flexible things have complex implementations under the hood.</p>
			<p class="callout">This is true of Odoo JavaScript views: they are easy to use, but complex to implement. They consist of lots of components, including the model, renderer, controller, view, and QWeb template. In the next section, we have added all of the required components for the views and have also used a new view for the <code>my_hostel</code> model. If you don’t want to add everything manually, grab a module from the example file in t<a id="_idTextAnchor899"/>his book’s GitHub repository.</p>
			<h2 id="_idParaDest-732"><a id="_idTextAnchor900"/>How it works…</h2>
			<p>In <em class="italic">steps 1</em> and <em class="italic">2</em>, we registered<a id="_idIndexMarker1111"/> a new type of view, called <code>m2m_group</code>, in <code>ir.ui.view</code> and <code>ir.actions.act_window.view</code>.</p>
			<p>In <em class="italic">step 3</em>, we added the <code>get_m2m_group_data</code> method to the base. Adding this method to the base will make that method available in every model. This method will be called via an RPC call from the JavaScript view. The view will pass two parameters—the <code>domain</code> and <code>m2m_field</code>. In the <code>domain</code> argument, the value of the domain will be the domain generated with a combination of the search view domain and the action domain. <code>m2m_field</code> is the field name by which we want to group the records. This field will be set on the view definition.</p>
			<p>In the next few steps, we added the JavaScript files that are required to new the view. An Odoo JavaScript view consists of the view, model, renderer, and controller. The word view has historical<a id="_idIndexMarker1112"/> meaning in the Odoo<a id="_idIndexMarker1113"/> code base, so <strong class="bold">model, view, controller</strong> (<strong class="bold">MVC</strong>) becomes <strong class="bold">model, renderer, controller</strong> (<strong class="bold">MRC</strong>) in Odoo. In general, the view sets up the model, renderer, and controller, and sets the MVC hierarchy so that it looks similar to the following:</p>
			<div><div><img src="img/B20997_15_8.jpg" alt="Figure 15.8 – View components"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.8 – View components</p>
			<p>Its job is to get a set<a id="_idIndexMarker1114"/> of fields, arch, context, and some other parameters, then to construct a controller/renderer/model triplet:</p>
			<ul>
				<li>The view’s role is to properly set up each piece of the MVC pattern with the correct information. Usually, it has to process the arch string and extract the data necessary for each other parts of the view.<p class="list-inset">Note that the view is a class, not a widget. Once its job has been done, it can be discarded.</p></li>
				<li>The renderer has one job: representing the data being viewed in a DOM element. Each view can render the data in a different way. Also, it should listen to appropriate user actions and notify its parent (the controller) if necessary. The renderer is the V in the MVC pattern.</li>
				<li>The model: its job is to fetch and hold the state of the view. Usually, it represents in some way a set of records in the database. The model is the owner of the business data. It is the M in the MVC pattern.</li>
				<li>The controller: Its job is to coordinate the renderer and the model. Also, it is the main entry point for the rest of the web client. For example, when the user changes something in the search view, the <code>update</code> method of the controller will be called with the appropriate information. It is the C in the MVC pattern.</li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">The JavaScript code for the views has been designed to be usable outside of the context of a view manager/action manager. It could be used in a client action, or it could be displayed on the public website (with some work on the assets).</p>
			<p>In <em class="italic">step 8</em>, we added JavaScript and XML files to the assets.</p>
			<p>Finally, in the last two steps, we added a view definition for the <code>hostel.student</code> model.</p>
			<p>In <em class="italic">step 9</em>, we used the <code>&lt;m2m_group&gt;</code> tag for the view, and we also passed the <code>m2m_field</code> attribute as the option. This will be passed <a id="_idIndexMarker1115"/>to the model t<a id="_idTextAnchor901"/>o fetch the data from the server.</p>
			<h1 id="_idParaDest-733"><a id="_idTextAnchor902"/>Debugging your client-side code</h1>
			<p>This book contains a whole chapter<a id="_idIndexMarker1116"/> for debugging server-side code, <a href="B20997_07.xhtml#_idTextAnchor363"><em class="italic">Chapter 7</em></a>, <em class="italic">Debugging Modules</em>. For the client-side part, you’l<a id="_idTextAnchor903"/>l get a kick-start in this recipe.</p>
			<h2 id="_idParaDest-734"><a id="_idTextAnchor904"/>Getting ready</h2>
			<p>This recipe doesn’t rely on specific code, but if you want to be able to reproduce exactly what’s going on<a id="_idTextAnchor905"/>, grab the previous recipe’s code.</p>
			<h2 id="_idParaDest-735"><a id="_idTextAnchor906"/>How to do it...</h2>
			<p>What makes debugging client-side scripts difficult is that the web client relies heavily on jQuery’s asynchronous events. Given that breakpoints halt the execution, there is a high chance that a bug caused by timing issues will not occur when debugging. We’ll discuss some strategies for this later:</p>
			<ol>
				<li>For the client-side debugging, you will need to activate debug mode with the assets. If you don’t know how to activate debug mode with the assets, read the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo </em><em class="italic">Development Environment</em>.</li>
				<li>In the JavaScript function you’re interested in, call <code>debugger</code>:<pre class="source-code">
debugger;</pre></li>				<li>If you have timing problems, log in to the console through a JavaScript function:<pre class="source-code">
    console.log("Debugging call…….");</pre></li>				<li>If you want to debug<a id="_idIndexMarker1117"/> during template rendering, call the debugger from QWeb:<pre class="source-code">
&lt;t t-debug="" /&gt;</pre></li>				<li> You can also have QWeb log in to the console, as follows:<pre class="source-code">
&lt;t t-log="myvalue" /&gt;</pre></li>			</ol>
			<p>All of this relies on your browser offering the appropriate functionality for debugging. While all major browsers do that, we’ll only look at Chromium here, for demonstration purposes. To be able to use the debug tools, open them by clicking on the top-right menu button and selecting <strong class="bold">More tools</strong> | <strong class="bold">Developer tools</strong>:</p>
			<div><div><img src="img/B20997_15_9.jpg" alt="Figure 15.9 –﻿ Opening Developer Tools in Chrome"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.9 –<a id="_idTextAnchor907"/> Opening Developer Tools in Chrome</p>
			<h2 id="_idParaDest-736"><a id="_idTextAnchor908"/>How it works…</h2>
			<p>When the debugger<a id="_idIndexMarker1118"/> is open, you should see something similar to the following screenshot:</p>
			<div><div><img src="img/B20997_15_10.jpg" alt="Figure 15.10 – Opening Developer Tools in Chrome"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.10 – Opening Developer Tools in Chrome</p>
			<p>Here, you have access<a id="_idIndexMarker1119"/> to a lot of different tools in separate tabs. The currently active tab in the preceding screenshot is the JavaScript debugger, and we have set a breakpoint in line 31 by clicking on the line number. Every time our widget fetches the list of users, the execution should stop at this line, and the debugger will allow you to inspect variables or change their values. Within the watch list to the right, you can also call functions to try out their effects without having to continuously save your script file and reload the page.</p>
			<p>The debugger statements we described earlier will behave the same as soon as you have the developer tools open. The execution will then stop, and the browser will switch to the <strong class="bold">Sources</strong> tab, with the file in question opened and the line with the debugger statement highlighted.</p>
			<p>The two logging possibilities from earlier will end up on the <strong class="bold">Console</strong> tab. This is the first tab you should inspect in case of problems in any case because, if some JavaScript code doesn’t load at all because of syntax errors or similar fundamental problems, you’ll see an error messag<a id="_idTextAnchor909"/>e there explaining<a id="_idIndexMarker1120"/> what’s going on.</p>
			<h2 id="_idParaDest-737"><a id="_idTextAnchor910"/>There’s more…</h2>
			<p>Use the <strong class="bold">Elements</strong> tab to inspect the DOM<a id="_idIndexMarker1121"/> representation of the page the browser currently displays. This will prove helpful when it comes to familiarizing yourself with the HTML code the existing widgets produce, and it will also allow you to play with classes and CSS attributes, in general. This is a great resource for testing layout changes.</p>
			<p>The <strong class="bold">Network</strong> tab gives you an overview<a id="_idIndexMarker1122"/> of which requests the current page made and how long it took. This is helpful when it comes to debugging slow page loads as, in the <strong class="bold">Network</strong> tab, you will usually find the details of the requests. If you select a request, you can inspect the payload that was passed to the server and the result returned, which helps you to figure out the reason for unexpected behavior on the client side. You’ll also see the status codes of requests made—for example, 404—in case a resource can’t be found because yo<a id="_idTextAnchor911"/>u misspelled a filename, for instance.</p>
			<h1 id="_idParaDest-738"><a id="_idTextAnchor912"/>Improving onboarding with tours</h1>
			<p>After developing<a id="_idIndexMarker1123"/> a large<a id="_idIndexMarker1124"/> application, it is crucial to explain software flows to the end users. The Odoo framework includes a built-in tour manager. With this tour manager, you can guide an end user through learning specific flows. In this recipe, we will create a tour so t<a id="_idTextAnchor913"/>hat we can create a book in the library.</p>
			<h2 id="_idParaDest-739"><a id="_idTextAnchor914"/>Getting ready</h2>
			<p>We will be using the <code>my_hostel</code> module from the previous recipe. Tours are only displayed in the database without demo data, so if you are using a database with demo data, create a new dat<a id="_idTextAnchor915"/>abase without demo data for this recipe.</p>
			<h2 id="_idParaDest-740"><a id="_idTextAnchor916"/>How to do it…</h2>
			<p>To add a tour<a id="_idIndexMarker1125"/> to a hostel, follow<a id="_idIndexMarker1126"/> these steps:</p>
			<ol>
				<li>Add a new <code>/static/src/js/my_hostel_tour.js</code> file with the following code:<pre class="source-code">
/** @odoo-module **/
import { _t } from "@web/core/l10n/translation";
import { registry } from "@web/core/registry";
import { markup } from "@odoo/owl"
import { stepUtils } from "@web_tour/tour_service/tour_utils";
registry.category("web_tour.tours").add('hostel_tour',  {
  url: "/web",
  rainbowManMessage: _t("Congrats, best of luck catching such big fish! :)"),
  sequence: 5,
  steps: () =&gt; [stepUtils.showAppsMenuItem(), {
    trigger: '.o_app[data-menu-xmlid="my_hostel.hostel_main_menu"]',
    content: markup(_t("Ready to launch your &lt;b&gt;hostel&lt;/b&gt;?")),
    position: 'bottom',
  }, {
    trigger: '.o_list_button_add',
    content: markup(_t("Let's create new room.")),
    position: "bottom",
  },{
    trigger: '.o_form_button_save',
    content: markup(_t('Save this room record')),
    position: "bottom",
  }]
});</pre></li>				<li>Add the tour<a id="_idIndexMarker1127"/> JavaScript file<a id="_idIndexMarker1128"/> in the backend assets:<pre class="source-code">
'assets': {
  'web.assets_backend': [
    'my_hostel/static/src/scss/field_widget.scss',
    'my_hostel/static/src/js/field_widget.js',
    'my_hostel/static/src/js/my_hostel_tour.js',
    'my_hostel/static/src/xml/field_widget.xml',
  ],
},</pre></li>			</ol>
			<p>Update the module and open the Odoo backend. At this point, you will see the tour, as shown in the following screenshot:</p>
			<p>Or you can click on debug icon and click on <strong class="bold">Start Tour</strong>.</p>
			<div><div><img src="img/B20997_15_11.jpg" alt="Figure 15.11 – Tour step for user onboarding"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.11 – Tour step for user onboarding</p>
			<p>It displays<a id="_idIndexMarker1129"/> below<a id="_idIndexMarker1130"/> the <strong class="bold">Tours</strong> popup.</p>
			<div><div><img src="img/B20997_15_12.jpg" alt="Figure 15.12 – Tour step for user onboarding"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.12 – Tour step for user onboarding</p>
			<p>Click the start <a id="_idIndexMarker1131"/>icon button <a id="_idIndexMarker1132"/>to see the <strong class="bold">Ready to lunch your hostel?</strong> Tour content:</p>
			<div><div><img src="img/B20997_15_13.jpg" alt="Figure 15.13 – Tour step for user onboarding"/>
				</div>
			</div>
			<p class="IMG---Figure"><a id="_idTextAnchor917"/></p>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.13 – Tour step for user onboarding</p>
			<h2 id="_idParaDest-741"><a id="_idTextAnchor918"/>How it works…</h2>
			<p>The tour manager is available in the <strong class="bold">web_tour.tours</strong> category.</p>
			<p>In the first step, we imported <code>registry</code>. We can then added a new tour with <code>registry.category("web_tour.tours")</code>. We registered our tour with the <code>hostel_tour</code> name and passed the URL on which this tour should run.</p>
			<p>The next parameter<a id="_idIndexMarker1133"/> is a list of these tour stops. A tour step<a id="_idIndexMarker1134"/> requires three values. The trigger is used to select the element on which the tour should be displayed. This is a JavaScript selector. We used the XML ID of the menu because it is available in the DOM.</p>
			<p>The first step, <code>stepUtils.showAppsMenuItem()</code>, is the predefined step from the tour for the main menu. The next key is the content, and this is displayed when the user hovers over the tour drop. We used the <code>markup(_t())</code> function because we want to translate the string, while the position key is used to decide on the position of the tour drop. Possible values are top, right, left, or bottom.</p>
			<p class="callout-heading">Important information</p>
			<p class="callout">Tours improve the onboarding experience of the user and manage the integration tests. When you run Odoo with test mode internally, it also runs the tours and causes th<a id="_idTextAnchor919"/>e test case to fail if a tour has not finished.</p>
			<h1 id="_idParaDest-742"><a id="_idTextAnchor920"/>Mobile app JavaScript</h1>
			<p>Odoo v10 introduced<a id="_idIndexMarker1135"/> the Odoo mobile application. It provides a few small utilities to perform mobile actions, such as vibrating the phone,<a id="_idTextAnchor921"/> showing a toast message, and scanning QR codes.</p>
			<h2 id="_idParaDest-743"><a id="_idTextAnchor922"/>Getting ready</h2>
			<p>We will be using the <code>my_hostel</code> module from the previous recipe. We will show you the toast when we change the value of the color field from the mobile app.</p>
			<p class="callout-heading">Warning</p>
			<p class="callout">The Odoo mobile app only supports the Enterprise Edition, so if you don’t have <a id="_idTextAnchor923"/>the Enterprise Edition, then you cannot test it.</p>
			<h2 id="_idParaDest-744"><a id="_idTextAnchor924"/>How to do it…</h2>
			<p>Follow these steps to show a toast message in the Odoo mobile app:</p>
			<pre class="source-code">
import mobile from "@web_mobile/js/services/core";
clickPill(value) {
    if (mobile.methods.showToast) {
      mobile.methods.showToast({ 'message': 'Color changed' });
    }
    this.props.record.update({ [this.props.name]: value });
  }</pre>			<p>Update the module<a id="_idIndexMarker1136"/> and open the form view of the <code>hostel.room</code> model in the mobile app. When you change the color, you will see the toast, as shown in the following sc<a id="_idTextAnchor925"/>reenshot:</p>
			<div><div><img src="img/B20997_15_14.jpg" alt="Figure 15.14 – Toast on color change"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.14 – Toast on color change</p>
			<h2 id="_idParaDest-745"><a id="_idTextAnchor926"/>How it works…</h2>
			<p><code>@web_mobile/js/services/core</code> provides the bridge between a mobile device and Odoo JavaScript. It exposes a few basic mobile utilities. In our example, we used the <code>showToast</code> method to display a toast in the mobile app. We also need to check the availability of the function. The reason for this is that some mobile phones might not support a few features. For example, if devices don’t have a camera, then you can’t use the <code>scanBarcode()</code> method. In such cases, to avoid traceb<a id="_idTextAnchor927"/>acks, we need to wrap them with an <code>if</code> condition.</p>
			<h2 id="_idParaDest-746"><a id="_idTextAnchor928"/>There’s more...</h2>
			<p>The mobile utilities that are to be found<a id="_idIndexMarker1137"/> in Odoo are as follows:</p>
			<ul>
				<li><code>showToast()</code>: To display a toast message</li>
				<li><code>vibrate()</code>: To make a phone vibrate</li>
				<li><code>showSnackBar()</code>: To display a snack bar with a button</li>
				<li><code>showNotification()</code>: To display a mobile notification</li>
				<li><code>addContact()</code>: To add a new contact to the phonebook</li>
				<li><code>scanBarcode()</code>: To scan QR codes</li>
				<li><code>switchAccount()</code>: To open the account switcher in Android</li>
			</ul>
			<p>To learn more about<a id="_idIndexMarker1138"/> mobile JavaScript, refer to <a href="https://www.odoo.com/documentation/16.0/developer/reference/frontend/mobile.html">https://www.odoo.com/documentation/16.0/developer/reference/frontend/mobile.html</a>.</p>
		</div>
	</body></html>