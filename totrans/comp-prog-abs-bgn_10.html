<html><head></head><body>
		<div id="_idContainer131">
			<h1 id="_idParaDest-115"><em class="italic"><a id="_idTextAnchor116"/>Chapter 8:</em> Understanding Functions</h1>
			<p>There are a number of useful concepts that we, as programmers, always should follow. One is to write code that is easy to read and understand. Another is to avoid duplicating code. When you start out your career as a programmer, you will find yourself copying and pasting code and just changing some small things here and there. This is a bad habit as it nullifies the first concept of code that is easy to read because reading more or less the same lines over and over is tedious and it is hard to spot the tiny differences.</p>
			<p>A better solution is to package code that we want to reuse several times into a function. A function is a way for us to give a name to a block of code and then, with this name, the code block can be called over and over every time we want it to execute. </p>
			<p>In this chapter, you will learn the following:</p>
			<ul>
				<li>Deciding what goes into a function</li>
				<li>Writing a function</li>
				<li>Returning values from a function</li>
				<li>Passing arguments to a function</li>
				<li>Working with local and global variables</li>
			</ul>
			<h1 id="_idParaDest-116"><a id="_idTextAnchor117"/>Deciding what goes into a function</h1>
			<p>A function is a way for us to package a code block and give it a name. This is a good idea for several reasons. Back in <a href="B15554_04_Final_NM_ePub.xhtml#_idTextAnchor067"><em class="italic">Chapter 4</em></a><em class="italic">, Software Projects and How We Organize Our Code,</em> we talked about software <a id="_idIndexMarker443"/>modules and that dividing our code into small parts is wise as it will give us code that is easier to read, update, and maintain. The same reason applies to functions as they, too, package our code into smaller units. Another reason we want to use functions is so we can easily reuse parts of our code. </p>
			<p>When deciding what will go into a function, we can have one rule of thumb. A function should always do only one thing and it will be named after what reflects that. What this means is that if we have a function called <strong class="source-inline">send_email_and_print_invoice</strong>, we are doing things wrong. This function does two distinct tasks and should, therefore, be two separate functions. We can rephrase this rule with a quote by Robert C. Martin, the author of an excellent book on writing clean code:</p>
			<p class="author-quote">"A function should do something or answer something, but not both."</p>
			<p>What this means is that a function either should have a very well-specified task and only do that task and nothing else or it should answer a well-specified question and only answer that question and nothing else, and a single function should absolutely not do both of these things.</p>
			<p> Another quote from Robert C. Martin about functions is as follows:</p>
			<p class="author-quote">"The first rule of functions is that they should be small."</p>
			<p>This is an interesting quote because it raises some questions. What if I have a very well-defined problem that I would like to package within a function so it follows the first quote, but the problem is rather complex and the resulting function ends up being several hundred lines of code? Would that not contradict the second quote? Yes, it would and we will need to deal with it. We can take this long function and find subtasks and move these subtasks into separate functions. How we split a function into several smaller functions might not be that obvious at first glance, but this is something we will see in the <em class="italic">Splitting the code further</em> section.</p>
			<p>If we create a function with the first quote in mind, it does only one thing, and if this is true, would not breaking it up into <a id="_idIndexMarker444"/>smaller things contradict the second quote, meaning that the function does several things? No, not necessarily. Think of something you often do, such as making breakfast. That is one single thing, but it can be broken down into several smaller things that together make up the tasks of cooking breakfast. You would make coffee or tea, toast some bread, boil an egg, and so on.</p>
			<p>Observe the following figure:</p>
			<div>
				<div id="_idContainer122" class="IMG---Figure">
					<img src="image/B15554_08_01.jpg" alt="Figure 8.1. A function that uses other functions to fulfill its task"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.1 – A function that uses other functions to fulfill its task</p>
			<p>The preceding figure illustrates how a function, here called <strong class="bold">function A</strong>, has been broken up into <a id="_idIndexMarker445"/>several smaller functions, and to accomplish its task, it uses subtasks of <strong class="bold">function B</strong>, <strong class="bold">function C</strong>, and <strong class="bold">function D</strong>. Compare this to the following figure, where we illustrate making breakfast in the same way:</p>
			<div>
				<div id="_idContainer123" class="IMG---Figure">
					<img src="image/B15554_08_02.jpg" alt="Figure 8.2. The task of making breakfast broken down into subtasks"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.2 – The task of making breakfast broken down into subtasks</p>
			<p>Functions are an important building block of computer programs; let's see how we can write them. So, after understanding what comprises a function, let's see how to use it.</p>
			<h1 id="_idParaDest-117"><a id="_idTextAnchor118"/>Writing a function</h1>
			<p>Let's see what a function looks like in code:</p>
			<p class="source-code">function name()</p>
			<p class="source-code">   code within this function</p>
			<p class="source-code">   more function code</p>
			<p class="source-code">end_function</p>
			<p>Here, we see that <a id="_idIndexMarker446"/>a function has a name, just like a variable. The conventions used by a language for naming functions are usually the same as those used for variables. If you don't remember what those were, you can find them in <a href="B15554_06_Final_NM_ePub.xhtml#_idTextAnchor091"><em class="italic">Chapter 6</em></a><em class="italic">, Working with Data – Variables</em>, in the <em class="italic">Naming conventions</em> section.</p>
			<p>After the function name, we find open and close parentheses. Whenever we refer to this function, they will be included after the name. They will also have another use, which we will see later in this chapter.</p>
			<p>After that, we see a code block, the body of loops and <strong class="source-inline">if</strong> statements, for example. This is the code that will be executed when the function is called.</p>
			<p>A function can be called just by using its name, and we must not forget the parentheses. Calling the preceding function would look like this:</p>
			<p class="source-code">name()</p>
			<p>All of the code within this function will now run. Once this is done, the program execution will return to where the call occurred and continue from there.</p>
			<p>The following program illustrates this:</p>
			<p class="source-code">function say_hi()</p>
			<p class="source-code">    print "Hi there!"</p>
			<p class="source-code">end_function</p>
			<p class="source-code">print "Before the function"</p>
			<p class="source-code">say_hi()</p>
			<p class="source-code">print "After the function"</p>
			<p>Even if the code for the function is above the rest of the function, it will not execute until we call the function, so the output when running this program will be this:</p>
			<p class="source-code">Before the function</p>
			<p class="source-code">Hi there!</p>
			<p class="source-code">After the function</p>
			<p>We can now call the function as often as we like, and all of the code within it will run each time. So, for example, check the following code:</p>
			<p class="source-code">function say_hi()</p>
			<p class="source-code">    print "Hi there!"</p>
			<p class="source-code">end_function</p>
			<p class="source-code">print "Before the function"</p>
			<p class="source-code">say_hi()</p>
			<p class="source-code">say_hi()</p>
			<p class="source-code">say_hi()</p>
			<p class="source-code">print "After the function"</p>
			<p>We can see that <a id="_idIndexMarker447"/>we are making three calls to the function. This is reflected in the output, as follows:</p>
			<p class="source-code">Before the function</p>
			<p class="source-code">Hi there!</p>
			<p class="source-code">Hi there!</p>
			<p class="source-code">Hi there!</p>
			<p class="source-code">After the function</p>
			<p>Now that we know what a function looks like, we can try to write a more realistic one and see how it can make code easier to read and better structured.</p>
			<h2 id="_idParaDest-118"><a id="_idTextAnchor119"/>Moving code into a function</h2>
			<p>Assume that <a id="_idIndexMarker448"/>we are writing a program that calculates how many seconds have passed since midnight.</p>
			<p>The code <a id="_idIndexMarker449"/>for this might look like the following:</p>
			<p class="source-code">time_now = now()</p>
			<p class="source-code">time_midnight = Date(time_now.year, time_now.month. time_now.    day)</p>
			<p class="source-code">time_diference = time_now – time_midnight</p>
			<p class="source-code">seconds_since_midnight = time_difference.total_seconds()</p>
			<p>This code will first get the current date and time. Note that it is the full date-time, that is, the year, month, day, hour, minute, and second. All of this is stored in the <strong class="source-inline">time_now</strong> variable.</p>
			<p>On the second line, we create an object that will hold the date and time for the previous midnight. We are using the current year, month, and day. As we have the current date and time in the <strong class="source-inline">time_now</strong> variable, we can use it to get the current year, month, and day. This will set the hour, minutes, and seconds to 0 as we did not provide a value for them. The idea is that today's date with <strong class="source-inline">hour = 0</strong>, <strong class="source-inline">minute = 0</strong>, and <strong class="source-inline">second = 0</strong> is the previous midnight.</p>
			<p>Then, we take the current date and time and subtract the date and time for midnight. This will give us the time difference between now and past midnight. </p>
			<p>Finally, we use this difference and convert it into the total number of seconds. In this case, the <strong class="source-inline">time_difference</strong> variable is an object that can hold time information, that is, how many hours, minutes, and seconds have elapsed since midnight. How this works will differ from language to language. Here, this object provides the functionality to give us this time in the total number of seconds. Now we have a variable called <strong class="source-inline">seconds_since_midnight</strong> that contains the number of seconds since the last midnight.</p>
			<p>But if we want to do this now and again in a number of places in our program, we will end up with something like this:</p>
			<p class="source-code">time_now = now()</p>
			<p class="source-code">time_midnight = Date(time_now.year, time_now.month. time_now.    day)</p>
			<p class="source-code">time_diference = time_now – time_midnight</p>
			<p class="source-code">seconds_since_midnight = time_difference.total_seconds()</p>
			<p class="source-code">do some other stuff</p>
			<p class="source-code">do some more stuff</p>
			<p class="source-code">time_now = now()</p>
			<p class="source-code">time_midnight = Date(time_now.year, time_now.month. time_now.    day)</p>
			<p class="source-code">time_diference = time_now – time_midnight</p>
			<p class="source-code">seconds_since_midnight = time_difference.total_seconds()</p>
			<p>As we can see, the <a id="_idIndexMarker450"/>four lines that calculate the time get repeated. And we would <a id="_idIndexMarker451"/>need to do this every time we want to get the number of seconds that has passed since midnight.</p>
			<p>A better solution would be to move the code where we perform the calculation into a function. It would look something like this:</p>
			<p class="source-code">function calculate_seconds()</p>
			<p class="source-code">   time_now = now()</p>
			<p class="source-code">   time_midnight = Date(time_now.year, time_now.month. time_      now.day)</p>
			<p class="source-code">   time_diference = time_now – time_midnight</p>
			<p class="source-code">   seconds_since_midnight = time_difference.total_seconds()</p>
			<p class="source-code">end_function</p>
			<p>Every time we need the calculation, we can now call the function and we no longer need to repeat the code.</p>
			<p>The full program will now look like this:</p>
			<p class="source-code">function calculate_seconds()</p>
			<p class="source-code">   time_now = now()</p>
			<p class="source-code">   time_midnight = Date(time_now.year, time_now.month. time_      now.day)</p>
			<p class="source-code">   time_diference = time_now – time_midnight</p>
			<p class="source-code">   seconds_since_midnight = time_difference.total_seconds()</p>
			<p class="source-code">end_function</p>
			<p class="source-code">calculate_seconds()</p>
			<p class="source-code">do some other stuff</p>
			<p class="source-code">do some more stuff</p>
			<p class="source-code">calculate_seconds()</p>
			<p>As we can see, this is <a id="_idIndexMarker452"/>much better as we only need to code for calculating <a id="_idIndexMarker453"/>the time once. But we do have a problem. The result from the calculation is<em class="italic"> trapped</em> within the function. By trapped, I mean that we calculate the correct number of seconds but the value obtained can't get out of the function so there is no way for us to use this value outside of it. To solve this problem, we will need to return the result back out to the caller. Let's see how that works.</p>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor120"/>Returning values from a function</h1>
			<p>The idea behind a function is that it not only can be used to package code so we can reuse it over and over but <a id="_idIndexMarker454"/>can also do something that will produce some sort of value. In our example with the time calculator, the function has calculated a result, the number of <a id="_idIndexMarker455"/>seconds that have elapsed since midnight, and we now want that value at the location where we called the function. Functions have the ability to return data, and this is a feature we can use to get the value.</p>
			<p>In its simplest form, returning a value from a function works like this:</p>
			<p class="source-code">function greet()</p>
			<p class="source-code">    return "Hello my friend"</p>
			<p class="source-code">end_function</p>
			<p class="source-code">result = greet()</p>
			<p class="source-code">print result</p>
			<p>Here, we have a function called <strong class="source-inline">greet</strong>. All it does is return a string containing the greeting, <strong class="source-inline">Hello my friend</strong>. Remember that the code within a function is not executed until the function is actually called. The call happens below the function. Consider what happens when the following row is called:</p>
			<p class="source-code">result = greet()</p>
			<p>Things work as they always do. The thing to the right of the assignment operator (<strong class="source-inline">=</strong>) is executed first. This is the call to the function.</p>
			<p>Now the program will jump to the actual function, executing the code within it. The only thing inside the function is this:</p>
			<p class="source-code">return "Hello my friend"</p>
			<p>We must understand two things about this line. First, a line with the <strong class="source-inline">return</strong> keyword will exit the function, even if there is more code following it. This might sound strange, and we will soon come back to that. Secondly, it will return whatever follows the word <strong class="source-inline">return</strong> back to the location that called the function.</p>
			<p>This will take us back to this line:</p>
			<p class="source-code">result = greet()</p>
			<p>We are now <a id="_idIndexMarker456"/>done with the operation on the right of <strong class="source-inline">=</strong>, and that has returned the <strong class="source-inline">Hello my friend</strong> string. That string is now assigned to the <strong class="source-inline">result</strong> variable.</p>
			<p>On the <a id="_idIndexMarker457"/>last line, the content of that variable is printed.</p>
			<p>Now, this is a silly program, as the function always returns the same thing, but it illustrates how <strong class="source-inline">return</strong> works. We can now use this in our function that calculates the number of seconds since midnight, as follows:</p>
			<p class="source-code">function calculate_seconds()</p>
			<p class="source-code">   time_now = now()</p>
			<p class="source-code">   time_midnight = Date(time_now.year, time_now.month. time_      now.day)</p>
			<p class="source-code">   time_diference = time_now – time_midnight</p>
			<p class="source-code">   seconds_since_midnight = time_difference.total_seconds()</p>
			<p class="source-code">   return seconds_since_midnight</p>
			<p class="source-code">end_function</p>
			<p>We did this by just adding one line at the end that returns the content of the <strong class="source-inline">seconds_since_midnight</strong> variable.</p>
			<p>As this variable <a id="_idIndexMarker458"/>is created on the line just above <strong class="source-inline">return</strong>, we could actually <a id="_idIndexMarker459"/>remove it and instead return the result immediately like this:</p>
			<p class="source-code">function calculate_seconds()</p>
			<p class="source-code">   time_now = now()</p>
			<p class="source-code">   time_midnight = Date(time_now.year, time_now.month. time_      now.day)</p>
			<p class="source-code">   time_diference = time_now – time_midnight</p>
			<p class="source-code">   return time_difference.total_seconds()</p>
			<p class="source-code">end_function</p>
			<p>We can now call this function over and over and get the current number of seconds since midnight, as follows:</p>
			<p class="source-code">seconds_since_midnight = calculate_seconds()</p>
			<p class="source-code">print "Seconds since midnight: " + seconds_since_midnight</p>
			<p class="source-code">do some other stuff</p>
			<p class="source-code">do some more stuff</p>
			<p class="source-code">seconds_since_midnight = calculate_seconds()</p>
			<p class="source-code">print "Seconds since midnight: " + seconds_since_midnight</p>
			<p>Here, we take <a id="_idIndexMarker460"/>the result returned back from the function and store it in a variable called <strong class="source-inline">seconds_since_midnight</strong>. We then print a text together with the result. The output <a id="_idIndexMarker461"/>might look something like this:</p>
			<p class="source-code">Seconds since midnight: 36769</p>
			<p>This is great because now we can package a piece of code and we can call it whenever we want that code to run. We can also get data back from the function. But there is one piece missing. What if we would like to send data to the function? We can do that with the help of function arguments.</p>
			<h1 id="_idParaDest-120"><a id="_idTextAnchor121"/>Function arguments</h1>
			<p>Often, we want <a id="_idIndexMarker462"/>our functions to be somewhat flexible, so they don't do exactly the same thing every time we call them. Consider the following two functions:</p>
			<p class="source-code">function add_2_and_3()</p>
			<p class="source-code">    return 2 + 3</p>
			<p class="source-code">end_function</p>
			<p class="source-code">function add_5_and 9()</p>
			<p class="source-code">    return 5 + 9</p>
			<p class="source-code">end_function</p>
			<p>These two functions add two numbers and return the result. The first one adds <strong class="source-inline">2</strong> and <strong class="source-inline">3</strong>, and the second one does the same but with <strong class="source-inline">5</strong> and <strong class="source-inline">9</strong>. Now, these are just two pairs of numbers. If we would like to have a function that could add any numbers, we would need to create an endless number of functions. </p>
			<p>But if we look at what the functions do, we can see that they are actually doing the same thing. They add two numbers and return the result. The only thing that changes are the numbers that are used in the addition operation. </p>
			<p>What we want is to be able to pass the numbers we want to be added to the function so it can use them in the calculation, and by that, only have one function that can add any two numbers.</p>
			<p>We can pass data to functions. We say that the function can accept arguments. For a function that can add two numbers, this can look like this:</p>
			<p class="source-code">function add(number1, number2)</p>
			<p class="source-code">    return number1 + number2</p>
			<p class="source-code">end_function</p>
			<p>Here, we can see that we now have made use of the parenthesis that has followed the function name. This is where we can specify variables that will receive the data we want to pass to the function. Now we can use this function like this:</p>
			<p class="source-code">result = add(73, 8)</p>
			<p class="source-code">print(result)</p>
			<p class="source-code">result = add(2, 3)</p>
			<p class="source-code">print result</p>
			<p class="source-code">result = add(5, 9)</p>
			<p class="source-code">print result</p>
			<p>The output, when <a id="_idIndexMarker463"/>running this program, will be this:</p>
			<p class="source-code">81</p>
			<p class="source-code">5</p>
			<p class="source-code">14</p>
			<p>As we can see, we can now serve any two numbers using only one single function. Let's examine this a bit closer to really understand how this works.</p>
			<p>Let's remove two of the calls to the function and only focus on what happens when we call the function the first time. We will have this code:</p>
			<p class="source-code">function add(number1, number2)</p>
			<p class="source-code">    return number1 + number2</p>
			<p class="source-code">end_function</p>
			<p class="source-code">result = add(73, 8)</p>
			<p class="source-code">print result</p>
			<p>When we make the call to the function, we are passing in the values, <strong class="source-inline">73</strong> and <strong class="source-inline">8</strong>. These are called arguments. On the receiving side, that is, in the <strong class="source-inline">add</strong> function, these two values will be assigned to two variables, <strong class="source-inline">number1</strong> and <strong class="source-inline">number2</strong>. These are called the parameters of the function. The first argument that we pass in, the value, <strong class="source-inline">73</strong>, is assigned to the first parameter, <strong class="source-inline">number1</strong>, and the second argument, the value, <strong class="source-inline">8</strong>, will be assigned to the parameter called <strong class="source-inline">number2</strong>. </p>
			<p>When we enter the function body, we now have these two variables and they are assigned the values that were passed to the function. So, this time, the variables will have the values 73 and 8 respectively. </p>
			<p>When we call the function with the values, <strong class="source-inline">2</strong> and <strong class="source-inline">3</strong>, then <strong class="source-inline">number1</strong> will get <strong class="source-inline">2</strong> and <strong class="source-inline">number2</strong> will get <strong class="source-inline">3</strong>. This means that the parameters in the function will receive data in the same order as the paramters are passed to the function:</p>
			<p class="source-code">add(4, 5)</p>
			<p>Here, <strong class="source-inline">number1</strong> will get the value <strong class="source-inline">4</strong>, and <strong class="source-inline">number2</strong> will get the value <strong class="source-inline">5</strong>:</p>
			<p class="source-code">add(5, 4)</p>
			<p>Here, things are reversed as <strong class="source-inline">number1</strong> gets <strong class="source-inline">5</strong> and <strong class="source-inline">number2</strong> gets <strong class="source-inline">4</strong>.</p>
			<p>Now we can create functions that can take arguments and return values. Let's put all of this together and use it <a id="_idIndexMarker464"/>in a more realistic application, our automatic light app.</p>
			<p>Now, having a function that adds two numbers together is pointless as we already have an operator that performs addition. It is only used here to illustrate the concept of arguments.</p>
			<h1 id="_idParaDest-121"><a id="_idTextAnchor122"/>Functions in action</h1>
			<p>If we again go back to our application for turning on the lights outside our house and focus on the application <a id="_idIndexMarker465"/>running on our phone, we will see that we have at least two distinct things we need to do over and over again. </p>
			<p>We will need to get our current position and we need to calculate our distance to home so we know whether it is time to turn on the lights or not.</p>
			<p>These are two distinct tasks, and they are very well suited to being packaged up into two different functions, namely, <strong class="source-inline">get_current_position</strong> and <strong class="source-inline">calculate_distance_to_home</strong>, as shown in the following figure:</p>
			<div>
				<div id="_idContainer124" class="IMG---Figure">
					<img src="image/B15554_08_03.jpg" alt="Figure 8.3: main_application calls two different functions"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.3 – main_application calls two different functions</p>
			<p>This diagram shows that we have a block that we call <strong class="source-inline">main_application</strong>. This is a function, and it calls <a id="_idIndexMarker466"/>a function called <strong class="source-inline">get_current_position</strong> that will return the longitude and latitude, indicating the current position of the phone. Equipped with this information, <strong class="source-inline">main_application</strong> can now make another function call, this time, to a function called <strong class="source-inline">calculate_distance_to_home</strong>, and pass the longitude and latitude just obtained to it. This function will do some calculations and return either <strong class="source-inline">true</strong> or <strong class="source-inline">false</strong>, indicating whether we are within the range or not.</p>
			<p>The question is, how did I decide to divide the code into these functions? Would we even need to have them, or could this program be written without the use of them? The answer is yes, it could, and we will now see why it is a good idea to use functions instead of just having all of the code in one place.</p>
			<p>In <a href="B15554_07_Final_NM_ePub.xhtml#_idTextAnchor103"><em class="italic">Chapter 7</em></a><em class="italic">, Program Control Structures</em>, we had the following figure:</p>
			<div>
				<div id="_idContainer125" class="IMG---Figure">
					<img src="image/B15554_08_04.jpg" alt="Figure 8.4. Flowchart of the phone application"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.4 – Flowchart of the phone application</p>
			<p>Here, we can see that we have a loop that runs forever (remember that forever in programming means as <a id="_idIndexMarker467"/>long as the program is running). We also have a selection statement that checks whether we are within the range and if we are, the signal is sent. After that, no matter whether we sent a signal or not, we will go back to the beginning and ask for our current position again.</p>
			<p>Now, imagine the code for this application. It might look something like this:</p>
			<p class="source-code">while true</p>
			<p class="source-code">    some code that connects to the phone GPS</p>
			<p class="source-code">    some code that asks the GPS for the current position</p>
			<p class="source-code">    some code the calculates the distance to our home</p>
			<p class="source-code">    if distance_to_home &lt; range_limit then</p>
			<p class="source-code">        some code that connects to the home computer</p>
			<p class="source-code">        some code that sends a notification to home computer </p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>Every line that starts with some code will most likely be made up of several code lines in the real application. </p>
			<p>If we read the code, we can see that we start ours with a <strong class="source-inline">while</strong> loop that runs as long as <strong class="source-inline">true</strong> is true. <strong class="source-inline">true</strong> will always be true so this is how we can create an endless loop that will just go on and run forever.</p>
			<p>If you compare the program to the flowchart in <em class="italic">figure 8.4</em>, you can see that the logic is identical:</p>
			<ul>
				<li>The oval at the top is the two lines in the code, which is connecting to the GPS and communicating with the GPS.</li>
				<li>The rectangle that follows the oval is represented by the code that calculates the distance.</li>
				<li>The diamond shape is the <strong class="source-inline">if</strong> statement and the code within the <strong class="source-inline">if</strong> statement is the final rectangle in the flow chart.</li>
				<li>The two arrows that bring us back to the top is the <strong class="source-inline">while</strong> loop that encapsulates the rest of the code.</li>
			</ul>
			<p>Looking at the code, it might not look that bad, but remember that this is just an outline of what needs to be done.</p>
			<p>If we now <a id="_idIndexMarker468"/>start to change this to see what the program actually might look like, we can change the two first lines into something like this:</p>
			<p class="source-code">location = Location</p>
			<p class="source-code">my_latitude = location.get_latitude()</p>
			<p class="source-code">my_longitude = location.get_longitude()</p>
			<p>The first line creates some sort of <strong class="source-inline">location</strong> object that can be used to communicate with the GPS. Note that we store this object in a variable called <strong class="source-inline">location</strong>, with all lowercase letters. <strong class="source-inline">Location</strong> with a capital <em class="italic">L</em>, to the right, is the thing that creates this object for us. To see how this is actually done, we will need to read the documentation for the programming language we are currently using. Most likely, it will be done in a line that resembles this.</p>
			<p>We can then use this <strong class="source-inline">location</strong> variable to get the current latitude and longitude.</p>
			<p>Calculating the distance between two geographical coordinates is something that most of us can't even imagine how we should do. Searching online might scare us. What we will get back is that we must use something called the <em class="italic">haversine formula</em> (there are other ways to accomplish this too, but for this example, we will stick with this formula). Then, we get something like this that will explain the formula:</p>
			<p><img src="image/Formula_08_001.png" alt=""/></p>
			<p><img src="image/Formula_08_002.png" alt=""/></p>
			<p><img src="image/Formula_08_003.png" alt=""/></p>
			<p>Here, <em class="italic">ϕ</em> is latitude, <em class="italic">λ</em> is longitude, and <em class="italic">R</em> is the Earth's radius (the mean radius is 6,371 km). Note that all angles need to be in radians.</p>
			<p>Don't be scared if you don't understand any of that. Most likely, someone else has already looked at that formula and translated it into source code for the language you are using. This is good <a id="_idIndexMarker469"/>as we can use it without actually understanding the formula. We must make sure, though, that the calculations done with it match other tools that do the same things. We will soon do such a test, but first, let's just see what such an implementation can look like.</p>
			<p>In this example, we pretend that we are at the <em class="italic">Musée des Lettres et Manuscrits</em> in Paris and that we rent a home on <em class="italic">Avenue Victor-Hugo</em> in the same city. Musée des Lettres et Manuscrits is located at latitude 48.855421 and longitude 2.327688. Our pretend home on Avenue Victor Hugo is located at latitude 48.870320 and longitude 2.286560:</p>
			<p class="source-code">my_latitude = 48.855421</p>
			<p class="source-code">my_longitude = 2.327688</p>
			<p class="source-code">home_latitude = 48.870320</p>
			<p class="source-code">home_longitude = 2.286560</p>
			<p class="source-code">earth_radius = 6371</p>
			<p class="source-code">my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">my_long_radians = radians(my_longitude)</p>
			<p class="source-code">home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">home_long_radians = radians(home_longitude)</p>
			<p class="source-code">lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">a = sin(lat_distance / 2)**2 + cos(my_lat_radians) * </p>
			<p class="source-code">    cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">print "The distance is " + distance + " km"</p>
			<p>Wow, scary stuff, but the <a id="_idIndexMarker470"/>good thing is that we don't need to understand it to use it. We must just make sure that it works. As we can see at the top, we have the coordinates to the museum (that we pretend that we are visiting), followed by the coordinates to our home (that we pretend that we are renting). Running this program will give us the following output:</p>
			<p class="source-code">The distance is 3.4345378351411333 km</p>
			<p>Plugging these same coordinates into an online geo coordinate distance calculator will give us the result shown in <em class="italic">figure 8.5</em>:</p>
			<div>
				<div id="_idContainer129" class="IMG---Figure">
					<img src="image/B15554_08_08.jpg" alt="Figure 8.5: Online geo coordinate distance calculator"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.5 – Online geo coordinate distance calculator</p>
			<p>As we can see, the result matches ours. We should perform more tests by trying other coordinates, both in our program and the calculator, to verify that the results match.</p>
			<p>Great, now we can perform this calculation even if we don't understand all of the details for how it works.</p>
			<p>We now have <a id="_idIndexMarker471"/>a distance that tells us how far we are from our Paris home. Now we need to decide how close we need to be to our home before we turn on the light. Maybe 500 meters is a good distance as we don't want to turn it on too early and not too late; 500 meters is 0.5 kilometers, so this is the value we can compare our distance to:</p>
			<p class="source-code">if distance &lt; 0.5 then</p>
			<p class="source-code">    some code that connects to the home computer</p>
			<p class="source-code">    some code that sends a notification to home computer </p>
			<p class="source-code">end_if</p>
			<p>For now, let's ignore the code that connects to the home computer and sends the notification, and just put everything together that we have so far:</p>
			<p class="source-code">while true</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">    my_long_radians = radians(my_longitude)</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">    if distance &lt; 0.5 then</p>
			<p class="source-code">        some code that connects to the home computer</p>
			<p class="source-code">        some code that sends a notification to home computer </p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>Reading this <a id="_idIndexMarker472"/>code is hard and confusing. What can we do about it? Functions are the answer. Let's see how that works.</p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor123"/>Splitting the code further</h2>
			<p>When breaking a long code into small functions, we must remember that a function should do one thing or answer one question.</p>
			<p>One trick we <a id="_idIndexMarker473"/>can use to identify separate tasks within the code is to read it from beginning to end, and when we feel that the application shifts its focus from one thing to another, we can insert a blank line into the code. Let's do that for the application that we have used so far:</p>
			<p class="source-code">while true</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">    my_long_radians = radians(my_longitude)</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">    if distance &lt; 0.5 then</p>
			<p class="source-code">        some code that connects to the home computer</p>
			<p class="source-code">        some code that sends a notification to home computer </p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>As we can see, there are now blocks of code separated by blank lines. Let's study them closely.</p>
			<p>There is nothing <a id="_idIndexMarker474"/>we can do about the first line with <strong class="source-inline">while</strong>, at least not at this point. It will just sit at the top and make sure that we repeat the code over and over.</p>
			<p>After the line with <strong class="source-inline">while</strong>, three lines follow that all have to do with establishing our location. When reading the code, we should ask ourselves, what task does this line help us to accomplish? For all of these lines, the answer will be, answer the question where we are. But when we hit the line that begins with <strong class="source-inline">home_latitude</strong>, this is no longer true. We are now in a block of code that does something else. The code has shifted focus, so we insert a blank line.</p>
			<p>We now have two lines that answer the question "where do we live?". They obviously belong together. But after these two lines, there is a line defining the radius of the earth. This is a noticeable shift in the focus so why did I not insert a blank line here?</p>
			<p>The answer can be found if we look closer at these three lines. All three do have something in common. They all have fixed values that will never change. We say that these are constant values. We will deal with them later, but let's move on.</p>
			<p>Then, we come to a larger block that deals with the distance calculation. That is a single task.</p>
			<p>In the end, we have the <strong class="source-inline">if</strong> statement containing the signaling to the home computer that we have left unimplemented so far.</p>
			<p>To begin with, we have two strong candidates for becoming functions here and that is where we get our current location and the distance calculation. Let's try to turn them into functions and we start with the part that tells us where we are.</p>
			<p>Currently, that part of the code looks like this:</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p>We can move these three lines into a function like this:</p>
			<p class="source-code">function get_current_position()</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p class="source-code">end_function</p>
			<p>Now, we must check two things. First, does this function need any data as input? The answer is no. To accomplish its task, it does not need any more data. This means that this function will not take any arguments.</p>
			<p>Secondly, will this function need to return any data back to the location where we called the function? The answer to this is yes, but it is a bit tricky.</p>
			<p>The current longitude <a id="_idIndexMarker475"/>and latitude are now created inside a function and this makes it inaccessible outside it. These are called <em class="italic">local variables</em>, a topic we will discuss in more detail at the end of this chapter. We had the same problem with the function <a id="_idIndexMarker476"/>that calculated the number of seconds since midnight. We solved it then by returning the result using the <strong class="source-inline">return</strong> keyword. We will need to do that here too, but most programming languages will only let us return one single value from a function, but we need to return two values, both the latitude and longitude. </p>
			<p>We can get around this limitation by putting the two values inside an array. Remember that an array is a sequence of things, and an array is treated as one single item, even if it contains many values.</p>
			<p>We can change our function so it looks like this:</p>
			<p class="source-code">function get_current_position()</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p class="source-code">    return [my_latitude, my_longitude]</p>
			<p class="source-code">end_function</p>
			<p>Note that the two values are inside square brackets. This creates an array and inserts <strong class="source-inline">latitude</strong> as its first value and <strong class="source-inline">longitude</strong> as its second.</p>
			<p>We must now <a id="_idIndexMarker477"/>call the function and receive the coordinates in <strong class="source-inline">location</strong> in the code where we previously fetched the location. The <strong class="source-inline">while</strong> loop now looks like this:</p>
			<p class="source-code">function get_current_position()</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p class="source-code">    return [my_latitude, my_longitude]</p>
			<p class="source-code">end_function</p>
			<p class="source-code">while true</p>
			<p class="source-code">    position = get_current_position()</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">    my_long_radians = radians(my_longitude)</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">    if distance &lt; 0.5 then</p>
			<p class="source-code">        some code that connects to the home computer</p>
			<p class="source-code">        some code that sends a notification to home computer </p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>On the first line inside the <strong class="source-inline">while</strong> loop, we are now making a call to the function. We will get the array containing <a id="_idIndexMarker478"/>the latitude and longitude and we store them in a variable we call <strong class="source-inline">position</strong>.</p>
			<p>We have a problem now as, later on, when we calculate the distance, we will be using the variables, <strong class="source-inline">my_latitude</strong> and <strong class="source-inline">my_longitude</strong>. These two now only exist inside the function, so when we reach the lines that convert them into radians, we will get an error saying that <strong class="source-inline">my_latitude</strong> is undefined. This is how a programming language will tell you that it has no idea what <strong class="source-inline">my_latitude</strong> is.</p>
			<p>The problem here is that we have packaged the coordinates inside an array that we have named <strong class="source-inline">position</strong>. We could solve this by replacing the two problematic lines with this:</p>
			<p class="source-code">    my_lat_radians = radians(position[0])</p>
			<p class="source-code">    my_long_radians = radians(position[1])</p>
			<p>Remember that we can access individual items within an array by using the index to the position that the item has within the array. Also, remember that the indexing starts at 0.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you need a reminder on how arrays work, we talked about them in <a href="B15554_06_Final_NM_ePub.xhtml#_idTextAnchor091"><em class="italic">Chapter 6</em></a><em class="italic">, Working with Data – Variables</em> in the <em class="italic">Composite types</em> section.</p>
			<p>As we added the latitude as the first element in the array, it can be found at index 0 and the longitude at index 1. This code is harder to read through as we must know how the array was created within the function to know that the latitude came before the longitude.</p>
			<p>Another option that would make our code easier to read would be to unpack these two values into variables again like this:</p>
			<p class="source-code">    position = get_current_position()</p>
			<p class="source-code">    my_latitude = position[0]</p>
			<p class="source-code">    my_longitude = position[1]</p>
			<p>Now, after we are making the call, we insert the first value into a variable called <strong class="source-inline">my_latitude</strong> and the second <a id="_idIndexMarker479"/>into a variable called <strong class="source-inline">my_longitude</strong>. As we picked the same name that was later used in the calculation, we will not need to change it at all if we use this option.</p>
			<p>I will go with a third option and will leave the variables in the array for now and not change the code in the calculation. We will soon see why.</p>
			<p>We can now turn our attention to the calculation code and turn that into a function. This function will now look like this:</p>
			<p class="source-code">function calculate_distance_to_home()</p>
			<p class="source-code">    my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">    my_long_radians = radians(my_longitude)</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">end_function</p>
			<p>Again, we will now check to see whether this function needs any more data to fulfill its task. Yes, as this is written, we are missing several things. This function does not know about our latitude and longitude. It does not know the home latitude and longitude either and <strong class="source-inline">earth_radius</strong> is also unknown to it.</p>
			<p>Let's turn the attention back to the three lines where we defined the home location and the radius of the earth. Who will need this data? When we think about it, the answer is, only the function we just created. This means that we can move these three lines into the function like this:</p>
			<p class="source-code">function calculate_distance_to_home()</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">    my_long_radians = radians(my_longitude)</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">end_function</p>
			<p>We add them at the top, so they are all defined when they are needed later on in the function.</p>
			<p>Now, we are only <a id="_idIndexMarker480"/>missing the latitude and longitude for our current position. This function must accept them as their arguments. We can now either say that this function takes two arguments, <strong class="source-inline">latitude</strong> and <strong class="source-inline">longitude</strong>, as separate parameters like this:</p>
			<p class="source-code">function calculate_distance_to_home(my_latitude, my_longitude)</p>
			<p>Another option is that we can let this function accept an array with the values. This suits our needs as we know that we will get an array back from the other function we wrote. So, let's use that option.</p>
			<p>It will look like this:</p>
			<p class="source-code">function calculate_distance_to_home(current_position)</p>
			<p>We now accept an array, and we call it <strong class="source-inline">current_position</strong>. We must now make one change inside <a id="_idIndexMarker481"/>the function on the lines where we use <strong class="source-inline">my_latitude</strong> and <strong class="source-inline">my_longitude</strong>. We can do the same as we saw before and index into the array as follows:</p>
			<p class="source-code">    my_lat_radians = radians(current_position[0])</p>
			<p class="source-code">    my_long_radians = radians(current_position[1])</p>
			<p>The full function now looks like this:</p>
			<p class="source-code">function calculate_distance_to_home(current_position)</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(current_position[0])</p>
			<p class="source-code">    my_long_radians = radians(current_position[1])</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">end_function</p>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor124"/>Putting it all together</h2>
			<p>Now we must check whether this function needs to return something. It calculates the distance and we need that <a id="_idIndexMarker482"/>outside the function, so that value needs to be returned.</p>
			<p>Again, we have two options. We can either return the value contained inside the variable distance like this:</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">    return distance</p>
			<p>Or, if not the previous option, we can make this shorter, though, as the <strong class="source-inline">distance</strong> variable is only used to hold the distance for one line. So, instead of using it to hold the value we want to return, we can return the result from the calculation directly and get rid of the <strong class="source-inline">distance</strong> variable. It would look like this:</p>
			<p class="source-code">    return 2 * earth_radius * asin(sqrt(a))</p>
			<p>That is better. The function is now finished and looks like this:</p>
			<p class="source-code">function calculate_distance_to_home(current_position)</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(current_position[0])</p>
			<p class="source-code">    my_long_radians = radians(current_position[1])</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    return 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">end_function</p>
			<p>We will now need to call it. Our <strong class="source-inline">while</strong> loop is now much cleaner and its main responsibility is to call our two functions. The loop now looks like this:</p>
			<p class="source-code">while true</p>
			<p class="source-code">    position = get_current_position()</p>
			<p class="source-code">    distance = calculate_distance_to_home(position) </p>
			<p class="source-code">    if distance &lt; 0.5 then</p>
			<p class="source-code">        some code that connects to the home computer</p>
			<p class="source-code">        some code that sends a notification to home computer </p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>We call the <a id="_idIndexMarker483"/>new function by passing the <strong class="source-inline">position</strong> array to it, and we will get the distance back and store it in a variable called <strong class="source-inline">distance</strong>.</p>
			<p>Now, this is more pleasant to look at. If you think about it, you can treat this as a table of contents in a book. On the first line, we call a function called <strong class="source-inline">get_current_position</strong>. The name of the function is chosen to reflect what it does. So, reading this line explains what happens. We can now decide whether we are interested in seeing what happens when we get the current position or not. If not, we can just accept that we get the current position back. If we do want to know how it works, we can go to the function and read the code there.</p>
			<p>We can then treat the next line in the same way. The name tells us what the function does, so there is no need for us to go and read that. We can trust that it does its job and that we get a distance back.</p>
			<p>The code is easier to read, maintain, and update, thanks to the use of functions. Another benefit is that complex distance calculation is hidden away in a function and we don't need to see it if we don't want to.</p>
			<p>We now only have the part inside the <strong class="source-inline">if</strong> statement left. To communicate with the home computer, we can use something called <em class="italic">sockets</em>. The concept of sockets is rather advanced, and we will not go into any details of it here. We can just say that all of that code will go into a function of its own and we can call that function from within the <strong class="source-inline">if</strong> statement by using a final <strong class="source-inline">while</strong> loop that looks like this:</p>
			<p class="source-code">while true</p>
			<p class="source-code">    position = get_current_position()</p>
			<p class="source-code">    distance = calculate_distance_to_home(position) </p>
			<p class="source-code">    if distance &lt; 0.5 then</p>
			<p class="source-code">        notify_home_computer()</p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>Compare this <a id="_idIndexMarker484"/>to the code we started with, which looked like this:</p>
			<p class="source-code">while true</p>
			<p class="source-code">    location = Location</p>
			<p class="source-code">    my_latitude = location.get_latitude()</p>
			<p class="source-code">    my_longitude = location.get_longitude()</p>
			<p class="source-code">    home_latitude = 48.870320</p>
			<p class="source-code">    home_longitude = 2.286560</p>
			<p class="source-code">    earth_radius = 6371</p>
			<p class="source-code">    my_lat_radians = radians(my_latitude)</p>
			<p class="source-code">    my_long_radians = radians(my_longitude)</p>
			<p class="source-code">    home_lat_radians = radians(home_latitude)</p>
			<p class="source-code">    home_long_radians = radians(home_longitude)</p>
			<p class="source-code">    lat_distance = home_lat_radians – my_lat_radians</p>
			<p class="source-code">    long_distance = home_long_radians – my_long_radians</p>
			<p class="source-code">    a = sin(lat_distance / 2)**2 + cos(my_lat_radians) *    </p>
			<p class="source-code">        cos(home_lat_radians) * sin(long_distance / 2)**2</p>
			<p class="source-code">    distance = 2 * earth_radius * asin(sqrt(a))</p>
			<p class="source-code">    if distance &lt; 0.5 then</p>
			<p class="source-code">        some code that connects to the home computer</p>
			<p class="source-code">        some code that sends a notification to home computer </p>
			<p class="source-code">    end_if</p>
			<p class="source-code">end_while</p>
			<p>This is a major clean up of the code and is indeed very helpful, not to mention less scary and more pleasing to the eye!</p>
			<p>In this section, we have <a id="_idIndexMarker485"/>seen that when we create a variable inside a function, it becomes inaccessible for all of the code outside that function. We will now discuss this further with local and global variables.</p>
			<h1 id="_idParaDest-124"><a id="_idTextAnchor125"/>Local and global variables</h1>
			<p>A variable <a id="_idIndexMarker486"/>declared (created) inside a function is called a local variable, and it can only be accessed from within <a id="_idIndexMarker487"/>the function. Outside the function, it is as if the variable never existed at all. Check the following code:</p>
			<p class="source-code">function my_function()</p>
			<p class="source-code">    name = "Lisa"</p>
			<p class="source-code">end_function</p>
			<p class="source-code">my_function()</p>
			<p class="source-code">print name</p>
			<p>Here, we create <a id="_idIndexMarker488"/>and assign a value to the <strong class="source-inline">name</strong> variable inside the <strong class="source-inline">my_function</strong> function. Outside the function, we first call the function, and then we try to print the name. The program will crash with an error on the line where we try to print the name. The reason is that the <strong class="source-inline">name</strong> variable is unknown in this part of the program. It is only valid as long as we execute code inside the function.</p>
			<p>This is a local variable. It is local as it is created inside the function.</p>
			<p>If we instead <a id="_idIndexMarker489"/>change the program so it looks like this, things will be different:</p>
			<p class="source-code">name = "Bill"</p>
			<p class="source-code">function my_function()</p>
			<p class="source-code">    name = "Lisa"</p>
			<p class="source-code">end_function</p>
			<p class="source-code">my_function()</p>
			<p class="source-code">print name</p>
			<p>It might be hard to see what happens here. To understand this, we must read the code as the compiler/interpreter will read the code when it executes it:</p>
			<ul>
				<li>It will start at the first line and see that we create a variable called <strong class="source-inline">name</strong> and assign the <strong class="source-inline">Bill</strong> string to it.</li>
				<li>It will then continue and see the function. It will not run the function; just remember that it exists.</li>
				<li>Then, we call the function, so the execution of the program will now jump up and run the code inside the function.</li>
				<li>Here we find a line where we assign the <strong class="source-inline">Lisa</strong> string to a variable called <strong class="source-inline">name</strong>. As it already knows about this variable, it will change its content and will store <strong class="source-inline">Lisa</strong> in it and the <strong class="source-inline">Bill</strong> string is now gone.</li>
				<li>The end of the function is now reached, so the execution jumps back down to where it came from.</li>
				<li>On the last line, the content of the variable name will be printed, which is <strong class="source-inline">Lisa</strong>.</li>
			</ul>
			<p>From the working of the preceding code, we saw that as we moved the declaration of the variable out of the function, it turned global (for use in code) and so it is now a global variable. A global variable can be accessed from any location.</p>
			<p>Some programming <a id="_idIndexMarker490"/>languages will not let us modify a global variable, as we did in the preceding example, but instead of the assignment of <strong class="source-inline">Lisa</strong> within the function, it will create a new variable with the same name.</p>
			<p>It might sound <a id="_idIndexMarker491"/>as if global variables are the way to go. But it is actually the opposite. We shall always strive to use local variables as often as we can. The reason is that it is hard to control global variables.</p>
			<p>Imagine that you have a program that is thousands of lines long, and all variables are global. They get changed here and there and all over, and then you discover that one of the variables has a value that would be impossible for it to have. Somewhere, a code line has changed this variable in a bad way. This is an error in our program, and we need to find it and fix it. But where is that line? As all parts of the program can change that variable (and all of the others that are declared global), it can be extremely hard to find that location. It might also be so that the reason this variable has a bad value is that some other variable had a bad value and that we discovered the error was just a side effect. </p>
			<p>Code like this is called <em class="italic">spaghetti code</em>. The reason it is called this will be obvious if you look at figure 8.6, which illustrates how five functions change four global variables. Look at it and try to figure out how changed what and when:</p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="image/B15554_08_09.jpg" alt="Figure 8.6. Five functions changing four global variables"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.6 – Five functions changing four global variables</p>
			<p>By using local variables, we will make things much cleaner and easier to understand. We can do this by passing data <a id="_idIndexMarker492"/>into a function using arguments and returning results from the function to the location that called it.</p>
			<p>We should also <a id="_idIndexMarker493"/>note that function parameters are considered local variables. What this means is that if we look at the <strong class="source-inline">calculate_distance_from_home</strong> function that we created earlier, we can see that we have a parameter called <strong class="source-inline">current_position</strong>: </p>
			<p class="source-code">function calculate_distance_to_home(current_position)</p>
			<p>It will be treated as a local variable within this function.</p>
			<h1 id="_idParaDest-125"><a id="_idTextAnchor126"/>Summary</h1>
			<p>In this chapter, we have seen that functions are a powerful tool we can use to organize and structure our code to make it more readable and reusable.</p>
			<p>We saw how functions have a name, and that name can be used to call them. Calling a function makes the code inside it to execute. This is something we can do over and over again as often as we need to.</p>
			<p>Sometimes, we want functions to produce a value as a result of its operations. In those cases, we can let the function return something. We can then use that value in the location where we called the function.</p>
			<p>Then, we learned that we can also pass data into a function. This can be done using function arguments. The function receives these arguments in local variables called parameters.</p>
			<p>With the introduction of functions, we also have the concepts of variables being either global or local. We saw that global variables can be accessed from any location within the program and local variables can only be used within the function where they are created.</p>
			<p>Sometimes, things will not go according to plan, and we will discover that our program either produces the wrong results or simply crashes. In the next chapter, we will see how we can identify bugs in our programs and handle errors that can be harder to predict.</p>
		</div>
	</body></html>