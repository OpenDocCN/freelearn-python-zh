<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer149">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 class="chapterTitle" id="_idParaDest-142"><span class="koboSpan" id="kobo.2.1">Building a Social Website</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the preceding chapter, you learned how to implement a tagging system and how to recommend similar posts. </span><span class="koboSpan" id="kobo.3.2">You implemented custom template tags and filters. </span><span class="koboSpan" id="kobo.3.3">You also learned how to create sitemaps and feeds for your site, and you built a full-text search engine using PostgreSQL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will learn how to develop user account functionalities to create a social website, including user registration, password management, profile editing, and authentication. </span><span class="koboSpan" id="kobo.4.2">We will implement social features on this site in the next few chapters, to let users share images and interact with each other. </span><span class="koboSpan" id="kobo.4.3">Users will be able to bookmark any image on the internet and share it with other users. </span><span class="koboSpan" id="kobo.4.4">They will also be able to see activity on the platform from the users they follow and like/unlike the images shared by them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">This chapter will cover the following topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Creating a login view</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Using the Django authentication framework</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Creating templates for Django login, logout, password change, and password reset views</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Creating user registration views</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Extending the user model with a custom profile model</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Configuring the project for media file uploads</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-143"><span class="koboSpan" id="kobo.12.1">Functional overview</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.13.1">Figure 4.1</span></em><span class="koboSpan" id="kobo.14.1"> shows a</span><a id="_idIndexMarker372"/><span class="koboSpan" id="kobo.15.1"> representation of the views, templates, and functionalities that will be built in this chapter:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.16.1"><img alt="" role="presentation" src="../Images/B21088_04_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.17.1">Figure 4.1: Diagram of functionalities built in Chapter 4</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">In this chapter, you will create a new project and use the login, logout, password change, and password recovery views provided by Django in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.19.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.20.1"> package. </span><span class="koboSpan" id="kobo.20.2">You will create templates for the authentication views, and you will create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.21.1">dashboard</span></code><span class="koboSpan" id="kobo.22.1"> view that users will have access to when they successfully authenticate. </span><span class="koboSpan" id="kobo.22.2">You will implement user registration with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">register</span></code><span class="koboSpan" id="kobo.24.1"> view. </span><span class="koboSpan" id="kobo.24.2">Finally, you will extend the user model with a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">Profile</span></code><span class="koboSpan" id="kobo.26.1"> model and create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.27.1">edit</span></code><span class="koboSpan" id="kobo.28.1"> view to allow users to edit their profile.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.29.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter04"><span class="url"><span class="koboSpan" id="kobo.30.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter04</span></span></a><span class="koboSpan" id="kobo.31.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.32.1">All Python packages used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">requirements.txt</span></code><span class="koboSpan" id="kobo.34.1"> file in the source code for the chapter. </span><span class="koboSpan" id="kobo.34.2">You can follow the instructions to install each Python package in the</span><a id="_idIndexMarker373"/><span class="koboSpan" id="kobo.35.1"> following sections, or you can install all requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">python -m pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.37.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-144"><span class="koboSpan" id="kobo.38.1">Creating a social website project</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.39.1">We are going to </span><a id="_idIndexMarker374"/><span class="koboSpan" id="kobo.40.1">create a social application that will allow users to share images that they find on the internet. </span><span class="koboSpan" id="kobo.40.2">This project is relevant because it will help you understand how to build social capabilities into your site, as well as how to implement advanced functionalities with Django and JavaScript.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.41.1">For our image-sharing website, we will need to build the following elements:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.42.1">An authentication system for users to register, log in, edit their profile, and change or reset their password</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.43.1">Social authentication to sign in with services such as Google</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.44.1">Functionality to display shared images and a system for users to share images from any website</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.45.1">An activity stream that allows users to see the content uploaded by the people that they follow</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.46.1">A follow system to allow users to follow each other on the website</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.47.1">This chapter will address the first point on the list. </span><span class="koboSpan" id="kobo.47.2">The rest of the points will be covered in </span><em class="italic"><span class="koboSpan" id="kobo.48.1">Chapters</span></em><span class="koboSpan" id="kobo.49.1"> 5 to 7.</span></p>
<h2 class="heading-2" id="_idParaDest-145"><span class="koboSpan" id="kobo.50.1">Starting the social website project</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.51.1">We will start by</span><a id="_idIndexMarker375"/><span class="koboSpan" id="kobo.52.1"> setting up the virtual environment for the project and creating the initial project structure.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.53.1">Open the terminal and use the following commands to create a virtual environment for your project:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.54.1">mkdir env
python -m venv env/bookmarks
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.55.1">If you are using Linux or macOS, run the following command to activate your virtual environment:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.56.1">source env/bookmarks/bin/activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.57.1">If you are using Windows, use the following command instead:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.58.1">.\env\bookmarks\Scripts\activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.59.1">The shell prompt will display your active virtual environment, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.60.1">(bookmarks)laptop:~ zenx$
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.61.1">Install Django in your virtual environment with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.62.1">python -m pip install Django~=5.0.4
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.63.1">Run the following command to create a new project:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.64.1">django-admin startproject bookmarks
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.65.1">The initial project structure has been created. </span><span class="koboSpan" id="kobo.65.2">Use the following commands to get into your project directory and create a new application named </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1">account</span></code><span class="koboSpan" id="kobo.67.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.68.1">cd bookmarks/
django-admin startapp account
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.69.1">Remember that you </span><a id="_idIndexMarker376"/><span class="koboSpan" id="kobo.70.1">should add the new application to your project by adding the application’s name to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.71.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.72.1"> setting in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.73.1">settings.py</span></code><span class="koboSpan" id="kobo.74.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.75.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">settings.py</span></code><span class="koboSpan" id="kobo.77.1"> and add the following line highlighted in bold to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.79.1"> list before any of the other installed apps:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.80.1">INSTALLED_APPS = [
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.81.1">'account.apps.AccountConfig'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.82.1">,</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.83.1">'django.contrib.admin'</span></span><span class="koboSpan" id="kobo.84.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.85.1">'django.contrib.auth'</span></span><span class="koboSpan" id="kobo.86.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.87.1">'django.contrib.contenttypes'</span></span><span class="koboSpan" id="kobo.88.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.89.1">'django.contrib.sessions'</span></span><span class="koboSpan" id="kobo.90.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.91.1">'django.contrib.messages'</span></span><span class="koboSpan" id="kobo.92.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.93.1">'django.contrib.staticfiles'</span></span><span class="koboSpan" id="kobo.94.1">,
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.95.1">Django looks for templates in the application template directories by order of appearance in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.96.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.97.1"> setting. </span><span class="koboSpan" id="kobo.97.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.98.1">django.contrib.admin</span></code><span class="koboSpan" id="kobo.99.1"> app includes standard authentication templates, which we will override in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.100.1">account</span></code><span class="koboSpan" id="kobo.101.1"> application. </span><span class="koboSpan" id="kobo.101.2">Usually, we place our own apps at the end of the list. </span><span class="koboSpan" id="kobo.101.3">In this case, we place the application first in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.103.1"> setting to ensure that our custom authentication templates will be used, instead of the authentication templates contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.104.1">django.contrib.admin</span></code><span class="koboSpan" id="kobo.105.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.106.1">Run the following command to sync the database with the models of the default applications included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.107.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.108.1"> setting:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.109.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.110.1">You will see that all the initial Django database migrations get applied. </span><span class="koboSpan" id="kobo.110.2">The database tables corresponding </span><a id="_idIndexMarker377"/><span class="koboSpan" id="kobo.111.1">to the Django models of the installed applications have been created. </span><span class="koboSpan" id="kobo.111.2">Next, we will build an authentication system into our project using the Django authentication framework.</span></p>
<h1 class="heading-1" id="_idParaDest-146"><span class="koboSpan" id="kobo.112.1">Using the Django authentication framework</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.113.1">Django comes with </span><a id="_idIndexMarker378"/><span class="koboSpan" id="kobo.114.1">a built-in authentication framework that can handle user authentication, sessions, permissions, and user groups. </span><span class="koboSpan" id="kobo.114.2">The authentication system includes views for common user actions such as logging in, logging out, password change, and password reset.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.115.1">The authentication framework is located at </span><code class="inlineCode"><span class="koboSpan" id="kobo.116.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.117.1"> and is used by other Django </span><code class="inlineCode"><span class="koboSpan" id="kobo.118.1">contrib</span></code><span class="koboSpan" id="kobo.119.1"> packages. </span><span class="koboSpan" id="kobo.119.2">Remember that we already used the authentication framework in </span><em class="chapterRef"><span class="koboSpan" id="kobo.120.1">Chapter 1</span></em><span class="koboSpan" id="kobo.121.1">, </span><em class="italic"><span class="koboSpan" id="kobo.122.1">Building a Blog Application</span></em><span class="koboSpan" id="kobo.123.1">, to create a superuser for the blog application to access the administration site.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.124.1">When we create a new Django project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.125.1">startproject</span></code><span class="koboSpan" id="kobo.126.1"> command, the authentication framework is included in the default settings of our project. </span><span class="koboSpan" id="kobo.126.2">It consists of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.127.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.128.1"> application and the following two middleware classes found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.130.1"> setting of our project:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">AuthenticationMiddleware</span></code><span class="koboSpan" id="kobo.132.1">: Associates users with requests using sessions</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.133.1">SessionMiddleware</span></code><span class="koboSpan" id="kobo.134.1">: Handles the current session across requests</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.135.1">Middleware is classes with methods that are globally executed during the request or response phase. </span><span class="koboSpan" id="kobo.135.2">You will use middleware classes on several occasions throughout this book, and you will learn how to create custom middleware in </span><em class="chapterRef"><span class="koboSpan" id="kobo.136.1">Chapter 17</span></em><span class="koboSpan" id="kobo.137.1">, </span><em class="italic"><span class="koboSpan" id="kobo.138.1">Going Live</span></em><span class="koboSpan" id="kobo.139.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.140.1">The authentication framework also includes the following models that are defined in </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">django.contrib.auth.models</span></code><span class="koboSpan" id="kobo.142.1">:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.143.1">User</span></code><span class="koboSpan" id="kobo.144.1">: A user model with basic fields; the main fields of this model are </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1">username</span></code><span class="koboSpan" id="kobo.146.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.147.1">password</span></code><span class="koboSpan" id="kobo.148.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1">email</span></code><span class="koboSpan" id="kobo.150.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.151.1">first_name</span></code><span class="koboSpan" id="kobo.152.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.153.1">last_name</span></code><span class="koboSpan" id="kobo.154.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1">is_active</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.156.1">Group</span></code><span class="koboSpan" id="kobo.157.1">: A group model to categorize users</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.158.1">Permission</span></code><span class="koboSpan" id="kobo.159.1">: Flags for users or groups to perform certain actions</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.160.1">The framework </span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.161.1">also includes default authentication views and forms, which you will use later.</span></p>
<h2 class="heading-2" id="_idParaDest-147"><span class="koboSpan" id="kobo.162.1">Creating a login view</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.163.1">We will start this </span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.164.1">section by using the Django authentication framework to allow users to log in to the website. </span><span class="koboSpan" id="kobo.164.2">We will create a view that will perform the following actions to log in a user:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.165.1">Present the user with a login form</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.166.1">Get the username and password provided by the user when they submit the form</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.167.1">Authenticate the user against the data stored in the database</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.168.1">Check whether the user is active</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.169.1">Log the user into the website and start an authenticated session</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.170.1">We will start by creating the login form.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.171.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">forms.py</span></code><span class="koboSpan" id="kobo.173.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.174.1">account</span></code><span class="koboSpan" id="kobo.175.1"> application directory and add the following lines to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.176.1">from</span></span><span class="koboSpan" id="kobo.177.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.178.1">import</span></span><span class="koboSpan" id="kobo.179.1"> forms
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.180.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.181.1">LoginForm</span></span><span class="koboSpan" id="kobo.182.1">(forms.Form):
    username = forms.CharField()
    password = forms.CharField(widget=forms.PasswordInput)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.183.1">This form will be used to authenticate users against the database. </span><span class="koboSpan" id="kobo.183.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.184.1">PasswordInput</span></code><span class="koboSpan" id="kobo.185.1"> widget is used to render the </span><code class="inlineCode"><span class="koboSpan" id="kobo.186.1">password</span></code><span class="koboSpan" id="kobo.187.1"> HTML element. </span><span class="koboSpan" id="kobo.187.2">This will include </span><code class="inlineCode"><span class="koboSpan" id="kobo.188.1">type="password"</span></code><span class="koboSpan" id="kobo.189.1"> in the HTML so that the browser treats it as a password input.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.190.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.191.1">views.py</span></code><span class="koboSpan" id="kobo.192.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1">account</span></code><span class="koboSpan" id="kobo.194.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.195.1">from</span></span><span class="koboSpan" id="kobo.196.1"> django.contrib.auth </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.197.1">import</span></span><span class="koboSpan" id="kobo.198.1"> authenticate, login
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.199.1">from</span></span><span class="koboSpan" id="kobo.200.1"> django.http </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.201.1">import</span></span><span class="koboSpan" id="kobo.202.1"> HttpResponse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.203.1">from</span></span><span class="koboSpan" id="kobo.204.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.205.1">import</span></span><span class="koboSpan" id="kobo.206.1"> render
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.207.1">from</span></span><span class="koboSpan" id="kobo.208.1"> .forms </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.209.1">import</span></span><span class="koboSpan" id="kobo.210.1"> LoginForm
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.211.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.212.1">user_login</span></span><span class="koboSpan" id="kobo.213.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.214.1">request</span></span><span class="koboSpan" id="kobo.215.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.216.1">if</span></span><span class="koboSpan" id="kobo.217.1"> request.method == </span><span class="hljs-string"><span class="koboSpan" id="kobo.218.1">'POST'</span></span><span class="koboSpan" id="kobo.219.1">:
        form = LoginForm(request.POST)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.220.1">if</span></span><span class="koboSpan" id="kobo.221.1"> form.is_valid():
            cd = form.cleaned_data
            user = authenticate(
                request,
                username=cd[</span><span class="hljs-string"><span class="koboSpan" id="kobo.222.1">'username'</span></span><span class="koboSpan" id="kobo.223.1">],
                password=cd[</span><span class="hljs-string"><span class="koboSpan" id="kobo.224.1">'password'</span></span><span class="koboSpan" id="kobo.225.1">]
            )
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.226.1">if</span></span><span class="koboSpan" id="kobo.227.1"> user </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.228.1">is</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.229.1">not</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.230.1">None</span></span><span class="koboSpan" id="kobo.231.1">:
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.232.1">if</span></span><span class="koboSpan" id="kobo.233.1"> user.is_active:
                    login(request, user)
                    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.234.1">return</span></span><span class="koboSpan" id="kobo.235.1"> HttpResponse(</span><span class="hljs-string"><span class="koboSpan" id="kobo.236.1">'Authenticated successfully'</span></span><span class="koboSpan" id="kobo.237.1">)
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.238.1">else</span></span><span class="koboSpan" id="kobo.239.1">:
                    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.240.1">return</span></span><span class="koboSpan" id="kobo.241.1"> HttpResponse(</span><span class="hljs-string"><span class="koboSpan" id="kobo.242.1">'Disabled account'</span></span><span class="koboSpan" id="kobo.243.1">)
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.244.1">else</span></span><span class="koboSpan" id="kobo.245.1">:
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.246.1">return</span></span><span class="koboSpan" id="kobo.247.1"> HttpResponse(</span><span class="hljs-string"><span class="koboSpan" id="kobo.248.1">'Invalid login'</span></span><span class="koboSpan" id="kobo.249.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.250.1">else</span></span><span class="koboSpan" id="kobo.251.1">:
        form = LoginForm()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.252.1">return</span></span><span class="koboSpan" id="kobo.253.1"> render(request, </span><span class="hljs-string"><span class="koboSpan" id="kobo.254.1">'account/login.html'</span></span><span class="koboSpan" id="kobo.255.1">, {</span><span class="hljs-string"><span class="koboSpan" id="kobo.256.1">'form'</span></span><span class="koboSpan" id="kobo.257.1">: form})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.258.1">This is what </span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.259.1">the basic login view does:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.260.1">When the </span><code class="inlineCode"><span class="koboSpan" id="kobo.261.1">user_login</span></code><span class="koboSpan" id="kobo.262.1"> view is called with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.263.1">GET</span></code><span class="koboSpan" id="kobo.264.1"> request, a new login form is instantiated with </span><code class="inlineCode"><span class="koboSpan" id="kobo.265.1">form = LoginForm()</span></code><span class="koboSpan" id="kobo.266.1">. </span><span class="koboSpan" id="kobo.266.2">The form is then passed to the template.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.267.1">When the user submits the form via </span><code class="inlineCode"><span class="koboSpan" id="kobo.268.1">POST</span></code><span class="koboSpan" id="kobo.269.1">, the following actions are performed:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.270.1">The form is instantiated with the submitted data with </span><code class="inlineCode"><span class="koboSpan" id="kobo.271.1">form = LoginForm(request.POST)</span></code><span class="koboSpan" id="kobo.272.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.273.1">The form is validated with </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">form.is_valid()</span></code><span class="koboSpan" id="kobo.275.1">. </span><span class="koboSpan" id="kobo.275.2">If it is not valid, the form errors will be displayed later in the template (for example, if the user didn’t fill in one of the fields).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.276.1">If the submitted data is valid, the user gets authenticated against the database using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.277.1">authenticate()</span></code><span class="koboSpan" id="kobo.278.1"> method. </span><span class="koboSpan" id="kobo.278.2">This method takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.279.1">request</span></code><span class="koboSpan" id="kobo.280.1"> object, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.281.1">username</span></code><span class="koboSpan" id="kobo.282.1">, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.283.1">password</span></code><span class="koboSpan" id="kobo.284.1"> parameters and returns the </span><code class="inlineCode"><span class="koboSpan" id="kobo.285.1">User</span></code><span class="koboSpan" id="kobo.286.1"> object if the user has been successfully authenticated, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.287.1">None</span></code><span class="koboSpan" id="kobo.288.1"> otherwise. </span><span class="koboSpan" id="kobo.288.2">If the user has not been successfully authenticated, a raw </span><code class="inlineCode"><span class="koboSpan" id="kobo.289.1">HttpResponse</span></code><span class="koboSpan" id="kobo.290.1"> is returned with an </span><strong class="keyWord"><span class="koboSpan" id="kobo.291.1">Invalid login</span></strong><span class="koboSpan" id="kobo.292.1"> message.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.293.1">If the user is successfully authenticated, the user status is checked by accessing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1">is_active</span></code><span class="koboSpan" id="kobo.295.1"> attribute. </span><span class="koboSpan" id="kobo.295.2">This is an attribute of Django’s user model. </span><span class="koboSpan" id="kobo.295.3">If the user is not active, an </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1">HttpResponse</span></code><span class="koboSpan" id="kobo.297.1"> is returned with a </span><strong class="keyWord"><span class="koboSpan" id="kobo.298.1">Disabled account</span></strong><span class="koboSpan" id="kobo.299.1"> message.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.300.1">If the user is active, the user is </span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.301.1">logged into the site. </span><span class="koboSpan" id="kobo.301.2">The user is set in the session by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.302.1">login()</span></code><span class="koboSpan" id="kobo.303.1"> method. </span><span class="koboSpan" id="kobo.303.2">An </span><strong class="keyWord"><span class="koboSpan" id="kobo.304.1">Authenticated successfully</span></strong><span class="koboSpan" id="kobo.305.1"> message is returned.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.306.1">Note the difference between </span><code class="inlineCode"><span class="koboSpan" id="kobo.307.1">authenticate()</span></code><span class="koboSpan" id="kobo.308.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.309.1">login()</span></code><span class="koboSpan" id="kobo.310.1">: </span><code class="inlineCode"><span class="koboSpan" id="kobo.311.1">authenticate()</span></code><span class="koboSpan" id="kobo.312.1"> verifies the user’s credentials and, upon validation, returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.313.1">User</span></code><span class="koboSpan" id="kobo.314.1"> object representing the authenticated user. </span><span class="koboSpan" id="kobo.314.2">In contrast, </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">login()</span></code><span class="koboSpan" id="kobo.316.1"> sets the user in the current session by incorporating the authenticated </span><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">User</span></code><span class="koboSpan" id="kobo.318.1"> object into the current session context.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.319.1">Now, we will create a URL pattern for this view:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.320.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">urls.py</span></code><span class="koboSpan" id="kobo.322.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">account</span></code><span class="koboSpan" id="kobo.324.1"> application directory and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.325.1">from</span></span><span class="koboSpan" id="kobo.326.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.327.1">import</span></span><span class="koboSpan" id="kobo.328.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.329.1">from</span></span><span class="koboSpan" id="kobo.330.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.331.1">import</span></span><span class="koboSpan" id="kobo.332.1"> views
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.333.1">'login/'</span></span><span class="koboSpan" id="kobo.334.1">, views.user_login, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.335.1">'login'</span></span><span class="koboSpan" id="kobo.336.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.337.1">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1">urls.py</span></code><span class="koboSpan" id="kobo.339.1"> file located in your </span><code class="inlineCode"><span class="koboSpan" id="kobo.340.1">bookmarks</span></code><span class="koboSpan" id="kobo.341.1"> project directory, import </span><code class="inlineCode"><span class="koboSpan" id="kobo.342.1">include</span></code><span class="koboSpan" id="kobo.343.1">, and add the URL patterns of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1">account</span></code><span class="koboSpan" id="kobo.345.1"> application, as follows. </span><span class="koboSpan" id="kobo.345.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.346.1">from</span></span><span class="koboSpan" id="kobo.347.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.348.1">import</span></span><span class="koboSpan" id="kobo.349.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.350.1">from</span></span><span class="koboSpan" id="kobo.351.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.352.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.353.1">include, </span></strong></span><span class="koboSpan" id="kobo.354.1">path
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.355.1">'admin/'</span></span><span class="koboSpan" id="kobo.356.1">, admin.site.urls),
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.357.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.358.1">'account/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.359.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.360.1">'account.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.361.1">)),</span></strong></span><span class="koboSpan" id="kobo.362.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.363.1">The login view can now be accessed with a URL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.364.1">Let’s create a template for this view. </span><span class="koboSpan" id="kobo.364.2">Since there are no templates in the project yet, we will start by creating a base template that will be extended by the login template:</span></p>
<p class="normal"><span class="koboSpan" id="kobo.365.1">Create the following</span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.366.1"> files and directories inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">account</span></code><span class="koboSpan" id="kobo.368.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.369.1">templates/
    account/
        login.html
    base.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.370.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">base.html</span></code><span class="koboSpan" id="kobo.372.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.373.1">{% load static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.374.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.375.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.376.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.377.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.378.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.379.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.380.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.381.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.382.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.383.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.384.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.385.1">&gt;</span></span><span class="koboSpan" id="kobo.386.1">{% block title %}{% endblock %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.387.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.388.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.389.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.390.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.391.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.392.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.393.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.394.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.395.1">{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.396.1">css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.397.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.398.1">base.css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.399.1">" %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.400.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.401.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.402.1">"stylesheet"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.403.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.404.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.405.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.406.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.407.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.408.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.409.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.410.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.411.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.412.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.413.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.414.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.415.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.416.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.417.1">span</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.418.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.419.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.420.1">"logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.421.1">&gt;</span></span><span class="koboSpan" id="kobo.422.1">Bookmarks</span><span class="hljs-tag"><span class="koboSpan" id="kobo.423.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.424.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.425.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.426.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.427.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.428.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.429.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.430.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.431.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.432.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.433.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.434.1">&gt;</span></span><span class="koboSpan" id="kobo.435.1">
    {% block content %}
    {% endblock %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.436.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.437.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.438.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.439.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.440.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.441.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.442.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.443.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.444.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.445.1">This will be the base template for the website. </span><span class="koboSpan" id="kobo.445.2">As you did in your previous project, include the CSS styles in the main template. </span><span class="koboSpan" id="kobo.445.3">You can find these static files in the code that comes with this chapter. </span><span class="koboSpan" id="kobo.445.4">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.446.1">static/</span></code><span class="koboSpan" id="kobo.447.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.448.1">account</span></code><span class="koboSpan" id="kobo.449.1"> application from the chapter’s source code to the same location in your project so that you can use the static files. </span><span class="koboSpan" id="kobo.449.2">You can find the directory’s contents at </span><a href="https://github.com/PacktPublishing/Django-5-by-Example/tree/master/Chapter04/bookmarks/account/static"><span class="url"><span class="koboSpan" id="kobo.450.1">https://github.com/PacktPublishing/Django-5-by-Example/tree/master/Chapter04/bookmarks/account/static</span></span></a><span class="koboSpan" id="kobo.451.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.452.1">The base template defines a </span><code class="inlineCode"><span class="koboSpan" id="kobo.453.1">title</span></code><span class="koboSpan" id="kobo.454.1"> block and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.455.1">content</span></code><span class="koboSpan" id="kobo.456.1"> block that can be filled with content by the templates that extend from it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.457.1">Let’s fill in the template for your login form.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.458.1">Open</span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.459.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.460.1">account/login.html</span></code><span class="koboSpan" id="kobo.461.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.462.1">{% extends "base.html" %}
{% block title %}Log-in{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.463.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.464.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.465.1">&gt;</span></span><span class="koboSpan" id="kobo.466.1">Log-in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.467.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.468.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.469.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.470.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.471.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.472.1">&gt;</span></span><span class="koboSpan" id="kobo.473.1">Please, use the following form to log-in:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.474.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.475.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.476.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.477.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.478.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.479.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.480.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.481.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.482.1">&gt;</span></span><span class="koboSpan" id="kobo.483.1">
    {{ form.as_p }}
    {% csrf_token %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.484.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.485.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.486.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.487.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.488.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.489.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.490.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.491.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.492.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.493.1">"Log in"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.494.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.495.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.496.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.497.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.498.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.499.1">&gt;</span></span><span class="koboSpan" id="kobo.500.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.501.1">This template includes the form that is instantiated in the view. </span><span class="koboSpan" id="kobo.501.2">Since your form will be submitted via </span><code class="inlineCode"><span class="koboSpan" id="kobo.502.1">POST</span></code><span class="koboSpan" id="kobo.503.1">, you will </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.504.1">include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.505.1">{% csrf_token %}</span></code><span class="koboSpan" id="kobo.506.1"> template tag for </span><strong class="keyWord"><span class="koboSpan" id="kobo.507.1">cross-site request forgery</span></strong><span class="koboSpan" id="kobo.508.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.509.1">CSRF</span></strong><span class="koboSpan" id="kobo.510.1">) protection. </span><span class="koboSpan" id="kobo.510.2">You learned about CSRF protection in </span><em class="chapterRef"><span class="koboSpan" id="kobo.511.1">Chapter 2</span></em><span class="koboSpan" id="kobo.512.1">, </span><em class="italic"><span class="koboSpan" id="kobo.513.1">Enhancing Your Blog with Advanced Features</span></em><span class="koboSpan" id="kobo.514.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.515.1">There are no users in the database yet. </span><span class="koboSpan" id="kobo.515.2">You will need to create a superuser first to access the administration site to manage other users.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.516.1">Execute the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.517.1">python manage.py createsuperuser
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.518.1">You will see the following output. </span><span class="koboSpan" id="kobo.518.2">Enter your desired username, email, and password, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.519.1">Username (leave blank to use 'admin'): admin
Email address: admin@admin.com
Password: ********
Password (again): ********
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.520.1">Then, you will see the following success message:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.521.1">Superuser created successfully.
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.522.1">Run the development server using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.523.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.524.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.525.1">http://127.0.0.1:8000/admin/</span></code><span class="koboSpan" id="kobo.526.1"> in your browser. </span><span class="koboSpan" id="kobo.526.2">Access the administration site using the credentials of the user you just created. </span><span class="koboSpan" id="kobo.526.3">You will see the Django administration site, including </span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.527.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.528.1">User</span></code><span class="koboSpan" id="kobo.529.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.530.1">Group</span></code><span class="koboSpan" id="kobo.531.1"> models of the Django authentication framework.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.532.1">It will look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.533.1"><img alt="" role="presentation" src="../Images/B21088_04_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.534.1">Figure 4.2: The Django administration site index page including Users and Groups</span></p>
<p class="normal"><span class="koboSpan" id="kobo.535.1">In the </span><strong class="screenText"><span class="koboSpan" id="kobo.536.1">Users</span></strong><span class="koboSpan" id="kobo.537.1"> row, click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.538.1">Add</span></strong><span class="koboSpan" id="kobo.539.1"> link.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.540.1">Create a new user using the administration site as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.541.1"><img alt="" role="presentation" src="../Images/B21088_04_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.542.1">Figure 4.3: The Add user form on the Django administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.543.1">Enter the user </span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.544.1">details and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.545.1">SAVE</span></strong><span class="koboSpan" id="kobo.546.1"> button to save the new user in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.547.1">Then, in </span><strong class="screenText"><span class="koboSpan" id="kobo.548.1">Personal info</span></strong><span class="koboSpan" id="kobo.549.1">, fill in the </span><strong class="screenText"><span class="koboSpan" id="kobo.550.1">First name</span></strong><span class="koboSpan" id="kobo.551.1">, </span><strong class="screenText"><span class="koboSpan" id="kobo.552.1">Last name</span></strong><span class="koboSpan" id="kobo.553.1">, and </span><strong class="screenText"><span class="koboSpan" id="kobo.554.1">Email address</span></strong><span class="koboSpan" id="kobo.555.1"> fields as follows, and then click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.556.1">SAVE</span></strong><span class="koboSpan" id="kobo.557.1"> button to save the changes:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.558.1"><img alt="" role="presentation" src="../Images/B21088_04_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.559.1">Figure 4.4: The user editing form on the Django administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.560.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.561.1">http://127.0.0.1:8000/account/login/</span></code><span class="koboSpan" id="kobo.562.1"> in your browser. </span><span class="koboSpan" id="kobo.562.2">You should see the rendered template, including the login form:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.563.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_04_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.564.1">Figure 4.5: The user Log-in page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.565.1">Enter invalid </span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.566.1">credentials and submit the form. </span><span class="koboSpan" id="kobo.566.2">You should get the following </span><strong class="screenText"><span class="koboSpan" id="kobo.567.1">Invalid login</span></strong><span class="koboSpan" id="kobo.568.1"> response:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.569.1"><img alt="" role="presentation" src="../Images/B21088_04_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.570.1">Figure 4.6: The invalid login plain text response</span></p>
<p class="normal"><span class="koboSpan" id="kobo.571.1">Enter valid credentials; you will get the following </span><strong class="screenText"><span class="koboSpan" id="kobo.572.1">Authenticated successfully</span></strong><span class="koboSpan" id="kobo.573.1"> response:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.574.1"><img alt="" role="presentation" src="../Images/B21088_04_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.575.1">Figure 4.7: The successful authentication plain text response</span></p>
<p class="normal"><span class="koboSpan" id="kobo.576.1">Now, you have learned how to authenticate users and create your own authentication view. </span><span class="koboSpan" id="kobo.576.2">You can</span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.577.1"> build your own auth views, but Django ships with ready-to-use authentication views that you can leverage.</span></p>
<h2 class="heading-2" id="_idParaDest-148"><span class="koboSpan" id="kobo.578.1">Using Django’s built-in authentication views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.579.1">Django includes</span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.580.1"> several forms and views in the authentication framework that you can use right away. </span><span class="koboSpan" id="kobo.580.2">The login view we have created is a good exercise to understand the process of user authentication in Django. </span><span class="koboSpan" id="kobo.580.3">However, you can use the default Django authentication views in most cases.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.581.1">Django provides the following class-based views to deal with authentication. </span><span class="koboSpan" id="kobo.581.2">All of them are located in </span><code class="inlineCode"><span class="koboSpan" id="kobo.582.1">django.contrib.auth.views</span></code><span class="koboSpan" id="kobo.583.1">:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.584.1">LoginView</span></code><span class="koboSpan" id="kobo.585.1">: Handles a login form and logs in a user</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.586.1">LogoutView</span></code><span class="koboSpan" id="kobo.587.1">: Logs out a user</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.588.1">Django provides the following views to handle password changes:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.589.1">PasswordChangeView</span></code><span class="koboSpan" id="kobo.590.1">: Handles a form to change the user’s password</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">PasswordChangeDoneView</span></code><span class="koboSpan" id="kobo.592.1">: The success view that the user is redirected to after a successful password change</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.593.1">Django also includes the following views to allow users to reset their password:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.594.1">PasswordResetView</span></code><span class="koboSpan" id="kobo.595.1">: Allows users to reset their password. </span><span class="koboSpan" id="kobo.595.2">It generates a one-time-use link with a token and sends it to a user’s email account</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.596.1">PasswordResetDoneView</span></code><span class="koboSpan" id="kobo.597.1">: Tells users that an email—including a link to reset their password—has been sent to them</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.598.1">PasswordResetConfirmView</span></code><span class="koboSpan" id="kobo.599.1">: Allows users to set a new password</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.600.1">PasswordResetCompleteView</span></code><span class="koboSpan" id="kobo.601.1">: The success view that the user is redirected to after successfully resetting their password</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.602.1">These views can save you a lot of time when building any web application with user accounts. </span><span class="koboSpan" id="kobo.602.2">The views use default values that can be overridden, such as the location of the template to be rendered, or the form to be used by the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.603.1">You can get more</span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.604.1"> information about the built-in authentication views at </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/default/#all-authentication-views"><span class="url"><span class="koboSpan" id="kobo.605.1">https://docs.djangoproject.com/en/5.0/topics/auth/default/#all-authentication-views</span></span></a><span class="koboSpan" id="kobo.606.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-149"><span class="koboSpan" id="kobo.607.1">Login and logout views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.608.1">To learn how to</span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.609.1"> use Django’s authentication views, we will substitute our custom login view with Django’s built-in equivalent and also integrate a logout view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.610.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.611.1">urls.py</span></code><span class="koboSpan" id="kobo.612.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.613.1">account</span></code><span class="koboSpan" id="kobo.614.1"> application and add the code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.615.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.616.1"> django.contrib.auth </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.617.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.618.1"> views </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.619.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.620.1"> auth_views</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.621.1">from</span></span><span class="koboSpan" id="kobo.622.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.623.1">import</span></span><span class="koboSpan" id="kobo.624.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.625.1">from</span></span><span class="koboSpan" id="kobo.626.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.627.1">import</span></span><span class="koboSpan" id="kobo.628.1"> views
urlpatterns = [
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.629.1"># previous login url</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.630.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.631.1"> path('login/', views.user_login, name='login'),</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.632.1"># login / logout urls</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.633.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.634.1">'login/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.635.1">, auth_views.LoginView.as_view(), name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.636.1">'login'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.637.1">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.638.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.639.1">'logout/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.640.1">, auth_views.LogoutView.as_view(), name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.641.1">'logout'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.642.1">),</span></strong></span><span class="koboSpan" id="kobo.643.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.644.1">In the preceding code, we have commented out the URL pattern for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.645.1">user_login</span></code><span class="koboSpan" id="kobo.646.1"> view that we created previously. </span><span class="koboSpan" id="kobo.646.2">We’ll now use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.647.1">LoginView</span></code><span class="koboSpan" id="kobo.648.1"> view of Django’s authentication framework. </span><span class="koboSpan" id="kobo.648.2">We have also added a URL pattern for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">LogoutView</span></code><span class="koboSpan" id="kobo.650.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.651.1">Create a new directory inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.652.1">templates/</span></code><span class="koboSpan" id="kobo.653.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.654.1">account</span></code><span class="koboSpan" id="kobo.655.1"> application and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.656.1">registration</span></code><span class="koboSpan" id="kobo.657.1">. </span><span class="koboSpan" id="kobo.657.2">This is the default path where the Django authentication views expect your authentication templates to be.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.658.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.659.1">django.contrib.admin</span></code><span class="koboSpan" id="kobo.660.1"> module includes authentication templates that are used for the administration site, like the login template. </span><span class="koboSpan" id="kobo.660.2">By placing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.661.1">account</span></code><span class="koboSpan" id="kobo.662.1"> application at the top of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.663.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.664.1"> setting when configuring the project, we ensured that Django would use our authentication templates instead of the ones defined in any other application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.665.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.666.1">templates/registration/</span></code><span class="koboSpan" id="kobo.667.1"> directory, name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">login.html</span></code><span class="koboSpan" id="kobo.669.1">, and add the </span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.670.1">following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.671.1">{% extends "base.html" %}
{% block title %}Log-in{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.672.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.673.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.674.1">&gt;</span></span><span class="koboSpan" id="kobo.675.1">Log-in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.676.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.677.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.678.1">&gt;</span></span><span class="koboSpan" id="kobo.679.1">
  {% if form.errors %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.680.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.681.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.682.1">&gt;</span></span><span class="koboSpan" id="kobo.683.1">
      Your username and password didn't match.
      </span><span class="koboSpan" id="kobo.683.2">Please try again.
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.684.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.685.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.686.1">&gt;</span></span><span class="koboSpan" id="kobo.687.1">
  {% else %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.688.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.689.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.690.1">&gt;</span></span><span class="koboSpan" id="kobo.691.1">Please, use the following form to log-in:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.692.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.693.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.694.1">&gt;</span></span><span class="koboSpan" id="kobo.695.1">
  {% endif %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.696.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.697.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.698.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.699.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.700.1">"login-form"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.701.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.702.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.703.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.704.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.705.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.706.1">"{% url 'login' %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.707.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.708.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.709.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.710.1">&gt;</span></span><span class="koboSpan" id="kobo.711.1">
      {{ form.as_p }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.712.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.713.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.714.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.715.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.716.1">"hidden"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.717.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.718.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.719.1">"next"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.720.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.721.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.722.1">"{{ next }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.723.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.724.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.725.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.726.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.727.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.728.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.729.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.730.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.731.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.732.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.733.1">"Log-in"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.734.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.735.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.736.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.737.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.738.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.739.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.740.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.741.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.742.1">&gt;</span></span><span class="koboSpan" id="kobo.743.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.744.1">This login template is quite similar to the one we created before. </span><span class="koboSpan" id="kobo.744.2">Django uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.745.1">AuthenticationForm</span></code><span class="koboSpan" id="kobo.746.1"> form located at </span><code class="inlineCode"><span class="koboSpan" id="kobo.747.1">django.contrib.auth.forms</span></code><span class="koboSpan" id="kobo.748.1"> by default. </span><span class="koboSpan" id="kobo.748.2">This form tries to authenticate the user and raises a validation error if the login is unsuccessful. </span><span class="koboSpan" id="kobo.748.3">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1">{% if form.errors %}</span></code><span class="koboSpan" id="kobo.750.1"> in the template to check whether the credentials provided are wrong.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.751.1">We have added a hidden HTML </span><code class="inlineCode"><span class="koboSpan" id="kobo.752.1">&lt;input&gt;</span></code><span class="koboSpan" id="kobo.753.1"> element to submit the value of a variable called </span><code class="inlineCode"><span class="koboSpan" id="kobo.754.1">next</span></code><span class="koboSpan" id="kobo.755.1">. </span><span class="koboSpan" id="kobo.755.2">This variable is provided to the login view if you pass a parameter named </span><code class="inlineCode"><span class="koboSpan" id="kobo.756.1">next</span></code><span class="koboSpan" id="kobo.757.1"> to the request, for example, by accessing </span><code class="inlineCode"><span class="koboSpan" id="kobo.758.1">http://127.0.0.1:8000/account/login/?next=/account/</span></code><span class="koboSpan" id="kobo.759.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.760.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.761.1">next</span></code><span class="koboSpan" id="kobo.762.1"> parameter has to be a URL. </span><span class="koboSpan" id="kobo.762.2">If this parameter is given, the Django login view will redirect the user to the given URL after a successful login.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.763.1">Now, create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.764.1">logged_out.html</span></code><span class="koboSpan" id="kobo.765.1"> template inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.766.1">templates/registration/</span></code><span class="koboSpan" id="kobo.767.1"> directory and make it look like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.768.1">{% extends "base.html" %}
{% block title %}Logged out{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.769.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.770.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.771.1">&gt;</span></span><span class="koboSpan" id="kobo.772.1">Logged out</span><span class="hljs-tag"><span class="koboSpan" id="kobo.773.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.774.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.775.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.776.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.777.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.778.1">&gt;</span></span><span class="koboSpan" id="kobo.779.1">
    You have been successfully logged out.
    </span><span class="koboSpan" id="kobo.779.2">You can </span><span class="hljs-tag"><span class="koboSpan" id="kobo.780.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.781.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.782.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.783.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.784.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.785.1">login</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.786.1">" %}"&gt;</span></span><span class="koboSpan" id="kobo.787.1">log-in again</span><span class="hljs-tag"><span class="koboSpan" id="kobo.788.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.789.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.790.1">&gt;</span></span><span class="koboSpan" id="kobo.791.1">.
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.792.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.793.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.794.1">&gt;</span></span><span class="koboSpan" id="kobo.795.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.796.1">This is the template </span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.797.1">that Django will display after the user logs out.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.798.1">We have added the URL patterns and templates for the login and logout views. </span><span class="koboSpan" id="kobo.798.2">Users can now log in and out using Django’s authentication views.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.799.1">Now, we will create a new view to display a dashboard when users log in to their accounts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.800.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.801.1">views.py</span></code><span class="koboSpan" id="kobo.802.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.803.1">account</span></code><span class="koboSpan" id="kobo.804.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.805.1">from</span></span><span class="koboSpan" id="kobo.806.1"> django.contrib.auth.decorators </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.807.1">import</span></span><span class="koboSpan" id="kobo.808.1"> login_required
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.809.1">@login_required</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.810.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.811.1">dashboard</span></span><span class="koboSpan" id="kobo.812.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.813.1">request</span></span><span class="koboSpan" id="kobo.814.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.815.1">return</span></span><span class="koboSpan" id="kobo.816.1"> render(
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.817.1">request,
</span><span class="hljs-keyword"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.818.1">'account/dashboard.html'</span></span><span class="koboSpan" id="kobo.819.1">,
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.820.1">{</span><span class="hljs-string"><span class="koboSpan" id="kobo.821.1">'section'</span></span><span class="koboSpan" id="kobo.822.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.823.1">'dashboard'</span></span><span class="koboSpan" id="kobo.824.1">}
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.825.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.826.1">We have created the </span><code class="inlineCode"><span class="koboSpan" id="kobo.827.1">dashboard</span></code><span class="koboSpan" id="kobo.828.1"> view, and we have applied to it the </span><code class="inlineCode"><span class="koboSpan" id="kobo.829.1">login_required</span></code><span class="koboSpan" id="kobo.830.1"> decorator of the authentication framework. </span><span class="koboSpan" id="kobo.830.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.831.1">login_required</span></code><span class="koboSpan" id="kobo.832.1"> decorator checks whether the current user is authenticated.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.833.1">If the user is authenticated, it executes the decorated view; if the user is not authenticated, it redirects the user to the login URL, with the originally requested URL as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.834.1">GET</span></code><span class="koboSpan" id="kobo.835.1"> parameter named </span><code class="inlineCode"><span class="koboSpan" id="kobo.836.1">next</span></code><span class="koboSpan" id="kobo.837.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.838.1">By doing this, the login view redirects users to the URL that they were trying to access after they successfully logged in. </span><span class="koboSpan" id="kobo.838.2">Remember that we added a hidden </span><code class="inlineCode"><span class="koboSpan" id="kobo.839.1">&lt;input&gt;</span></code><span class="koboSpan" id="kobo.840.1"> HTML element named </span><code class="inlineCode"><span class="koboSpan" id="kobo.841.1">next</span></code><span class="koboSpan" id="kobo.842.1"> in the login template for this purpose.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.843.1">We have also defined a </span><code class="inlineCode"><span class="koboSpan" id="kobo.844.1">section</span></code><span class="koboSpan" id="kobo.845.1"> variable. </span><span class="koboSpan" id="kobo.845.2">We will use this variable to highlight the current section in the main menu of the site.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.846.1">Next, we need to create a template for the dashboard view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.847.1">Create a new file </span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.848.1">inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.849.1">templates/account/</span></code><span class="koboSpan" id="kobo.850.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.851.1">dashboard.html</span></code><span class="koboSpan" id="kobo.852.1">. </span><span class="koboSpan" id="kobo.852.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.853.1">{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.854.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.855.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.856.1">&gt;</span></span><span class="koboSpan" id="kobo.857.1">Dashboard</span><span class="hljs-tag"><span class="koboSpan" id="kobo.858.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.859.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.860.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.861.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.862.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.863.1">&gt;</span></span><span class="koboSpan" id="kobo.864.1">Welcome to your dashboard.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.865.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.866.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.867.1">&gt;</span></span><span class="koboSpan" id="kobo.868.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.869.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.870.1">urls.py</span></code><span class="koboSpan" id="kobo.871.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.872.1">account</span></code><span class="koboSpan" id="kobo.873.1"> application and add the following URL pattern for the view. </span><span class="koboSpan" id="kobo.873.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.874.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.875.1"># previous login url</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.876.1"># path('login/', views.user_login, name='login'),</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.877.1"># login / logout urls</span></span><span class="koboSpan" id="kobo.878.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.879.1">'login/'</span></span><span class="koboSpan" id="kobo.880.1">, auth_views.LoginView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.881.1">'login'</span></span><span class="koboSpan" id="kobo.882.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.883.1">'logout/'</span></span><span class="koboSpan" id="kobo.884.1">, auth_views.LogoutView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.885.1">'logout'</span></span><span class="koboSpan" id="kobo.886.1">),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.887.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.888.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.889.1">, views.dashboard, name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.890.1">'dashboard'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.891.1">),</span></strong></span><span class="koboSpan" id="kobo.892.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.893.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.894.1">settings.py</span></code><span class="koboSpan" id="kobo.895.1"> file of the project and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.896.1">LOGIN_REDIRECT_URL = </span><span class="hljs-string"><span class="koboSpan" id="kobo.897.1">'dashboard'</span></span><span class="koboSpan" id="kobo.898.1">
LOGIN_URL = </span><span class="hljs-string"><span class="koboSpan" id="kobo.899.1">'login'</span></span><span class="koboSpan" id="kobo.900.1">
LOGOUT_URL = </span><span class="hljs-string"><span class="koboSpan" id="kobo.901.1">'logout'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.902.1">We have defined the following settings:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">LOGIN_REDIRECT_URL</span></code><span class="koboSpan" id="kobo.904.1">: Tells Django which URL to redirect the user to after a successful login if no </span><code class="inlineCode"><span class="koboSpan" id="kobo.905.1">next</span></code><span class="koboSpan" id="kobo.906.1"> parameter is present in the request</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.907.1">LOGIN_URL</span></code><span class="koboSpan" id="kobo.908.1">: The URL to redirect the user to log in (for example, views using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.909.1">login_required</span></code><span class="koboSpan" id="kobo.910.1"> decorator)</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.911.1">LOGOUT_URL</span></code><span class="koboSpan" id="kobo.912.1">: The URL to redirect the user to log out</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.913.1">We have used the names of the URLs that we previously defined with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.914.1">name</span></code><span class="koboSpan" id="kobo.915.1"> attribute of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.916.1">path()</span></code><span class="koboSpan" id="kobo.917.1"> function in the URL patterns. </span><span class="koboSpan" id="kobo.917.2">Hardcoded URLs instead of URL names can also be used for these settings.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.918.1">Let’s summarize what we have done so far:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.919.1">We have added the built-in Django authentication login and logout views to the project.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.920.1">We have created custom templates for both views and defined a simple dashboard view to redirect users after they log in.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.921.1">Finally, we have added settings for Django to use these URLs by default.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.922.1">Now, we will add a</span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.923.1"> link to the login URL and a button to log out to the base template. </span><span class="koboSpan" id="kobo.923.2">In order to do this, we have to determine whether the current user is logged in or not to display the appropriate action for each case. </span><span class="koboSpan" id="kobo.923.3">The current user is set in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.924.1">HttpRequest</span></code><span class="koboSpan" id="kobo.925.1"> object by the authentication middleware. </span><span class="koboSpan" id="kobo.925.2">You can access it with </span><code class="inlineCode"><span class="koboSpan" id="kobo.926.1">request.user</span></code><span class="koboSpan" id="kobo.927.1">. </span><span class="koboSpan" id="kobo.927.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.928.1">request</span></code><span class="koboSpan" id="kobo.929.1"> object contains a </span><code class="inlineCode"><span class="koboSpan" id="kobo.930.1">User</span></code><span class="koboSpan" id="kobo.931.1"> object even if the user is not authenticated. </span><span class="koboSpan" id="kobo.931.2">A non-authenticated user is set in the request as an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.932.1">AnonymousUser</span></code><span class="koboSpan" id="kobo.933.1">. </span><span class="koboSpan" id="kobo.933.2">The best way to check if the current user is authenticated is by accessing the read-only attribute, </span><code class="inlineCode"><span class="koboSpan" id="kobo.934.1">is_authenticated</span></code><span class="koboSpan" id="kobo.935.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.936.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.937.1">templates/base.html</span></code><span class="koboSpan" id="kobo.938.1"> template by adding the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.939.1">{% load static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.940.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.941.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.942.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.943.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.944.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.945.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.946.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.947.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.948.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.949.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.950.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.951.1">&gt;</span></span><span class="koboSpan" id="kobo.952.1">{% block title %}{% endblock %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.953.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.954.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.955.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.956.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.957.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.958.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.959.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.960.1">"{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.961.1">css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.962.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.963.1">base.css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.964.1">" %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.965.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.966.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.967.1">"stylesheet"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.968.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.969.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.970.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.971.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.972.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.973.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.974.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.975.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.976.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.977.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.978.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.979.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.980.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.981.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.982.1">span</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.983.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.984.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.985.1">"logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.986.1">&gt;</span></span><span class="koboSpan" id="kobo.987.1">Bookmarks</span><span class="hljs-tag"><span class="koboSpan" id="kobo.988.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.989.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.990.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.991.1">    {% if request.user.is_authenticated %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.992.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.993.1">ul</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.994.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.995.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.996.1">"menu"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.997.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.998.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.999.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1000.1"> {% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1001.1">if</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1002.1">section</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1003.1"> == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1004.1">"dashboard"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1005.1"> %}</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1006.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1007.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1008.1">"selected"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1009.1">{% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1010.1">endif</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1011.1"> %}&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1012.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1013.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1014.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1015.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1016.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1017.1">dashboard</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1018.1">" %}"&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1019.1">My dashboard</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1020.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1021.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1022.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1023.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1024.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1025.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1026.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1027.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1028.1"> {% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1029.1">if</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1030.1">section</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1031.1"> == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1032.1">"images"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1033.1"> %}</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1034.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1035.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1036.1">"selected"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1037.1">{% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1038.1">endif</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1039.1"> %}&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1040.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1041.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1042.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1043.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1044.1">"#"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1045.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1046.1">Images</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1047.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1048.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1049.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1050.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1051.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1052.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1053.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1054.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1055.1"> {% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1056.1">if</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1057.1">section</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1058.1"> == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1059.1">"people"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1060.1"> %}</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1061.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1062.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1063.1">"selected"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1064.1">{% </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1065.1">endif</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1066.1"> %}&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1067.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1068.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1069.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1070.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1071.1">"#"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1072.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1073.1">People</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1074.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1075.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1076.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1077.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1078.1">li</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1079.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1080.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1081.1">ul</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1082.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1083.1">    {% endif %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1084.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1085.1">span</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1086.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1087.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1088.1">"user"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1089.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1090.1">      {% if request.user.is_authenticated %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1091.1">        Hello {{ request.user.first_name|default:request.user.username }},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1092.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1093.1">form</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1094.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1095.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1096.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1097.1">logout</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1098.1">" %}" </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1099.1">method</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1100.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1101.1">"post"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1102.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1103.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1104.1">button</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1105.1">type</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1106.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1107.1">"submit"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1108.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1109.1">Logout</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1110.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1111.1">button</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1112.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1113.1">          {% csrf_token %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1114.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1115.1">form</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1116.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1117.1">      {% else %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1118.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1119.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1120.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1121.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1122.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1123.1">login</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1124.1">" %}"&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1125.1">Log-in</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1126.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1127.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1128.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1129.1">      {% endif %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1130.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1131.1">span</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1132.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1133.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1134.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1135.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1136.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1137.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1138.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1139.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1140.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1141.1">&gt;</span></span><span class="koboSpan" id="kobo.1142.1">
    {% block content %}
    {% endblock %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1143.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1144.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1145.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1146.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1147.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1148.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1149.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1150.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1151.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1152.1">The site’s menu is only displayed to authenticated users. </span><span class="koboSpan" id="kobo.1152.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1153.1">section</span></code><span class="koboSpan" id="kobo.1154.1"> variable is checked to add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1155.1">selected</span></code><span class="koboSpan" id="kobo.1156.1"> class attribute to the menu </span><code class="inlineCode"><span class="koboSpan" id="kobo.1157.1">&lt;li&gt;</span></code><span class="koboSpan" id="kobo.1158.1"> list item of the current section. </span><span class="koboSpan" id="kobo.1158.2">By doing so, the menu item that corresponds to the current section will be highlighted using CSS. </span><span class="koboSpan" id="kobo.1158.3">The user’s first name and a button to log out are displayed if the user is authenticated; a link to log in is displayed otherwise. </span><span class="koboSpan" id="kobo.1158.4">If the user’s name is empty, the username is displayed instead by using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1">request.user.first_name|default:request.user.username</span></code><span class="koboSpan" id="kobo.1160.1">. </span><span class="koboSpan" id="kobo.1160.2">Note that for the logout action, we use a form with the method </span><code class="inlineCode"><span class="koboSpan" id="kobo.1161.1">POST</span></code><span class="koboSpan" id="kobo.1162.1"> and a button to submit the form. </span><span class="koboSpan" id="kobo.1162.2">This is because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1163.1">LogoutView</span></code><span class="koboSpan" id="kobo.1164.1"> requires </span><code class="inlineCode"><span class="koboSpan" id="kobo.1165.1">POST</span></code><span class="koboSpan" id="kobo.1166.1"> requests.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1167.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1168.1">http://127.0.0.1:8000/account/login/</span></code><span class="koboSpan" id="kobo.1169.1"> in your browser. </span><span class="koboSpan" id="kobo.1169.2">You should see the </span><strong class="screenText"><span class="koboSpan" id="kobo.1170.1">Log-in</span></strong><span class="koboSpan" id="kobo.1171.1"> page. </span><span class="koboSpan" id="kobo.1171.2">Enter a</span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.1172.1"> valid username and password and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1173.1">Log-in</span></strong><span class="koboSpan" id="kobo.1174.1"> button. </span><span class="koboSpan" id="kobo.1174.2">You should see the following screen:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1175.1"><img alt="Graphical user interface  Description automatically generated with medium confidence" src="../Images/B21088_04_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1176.1">Figure 4.8: The Dashboard page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1177.1">The </span><strong class="screenText"><span class="koboSpan" id="kobo.1178.1">My dashboard</span></strong><span class="koboSpan" id="kobo.1179.1"> menu item is highlighted with CSS because it has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1180.1">selected</span></code><span class="koboSpan" id="kobo.1181.1"> class. </span><span class="koboSpan" id="kobo.1181.2">Since the user is authenticated, the first name of the user is displayed on the right side of the header. </span><span class="koboSpan" id="kobo.1181.3">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1182.1">Logout</span></strong><span class="koboSpan" id="kobo.1183.1"> button. </span><span class="koboSpan" id="kobo.1183.2">You should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1184.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_04_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1185.1">Figure 4.9: The Logged out page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1186.1">On this page, you can see that the user is logged out, and therefore, the menu of the website is not</span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.1187.1"> displayed. </span><span class="koboSpan" id="kobo.1187.2">The link displayed on the right side of the header is now </span><strong class="screenText"><span class="koboSpan" id="kobo.1188.1">Log-in</span></strong><span class="koboSpan" id="kobo.1189.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1190.1">If you see the </span><strong class="screenText"><span class="koboSpan" id="kobo.1191.1">Logged out</span></strong><span class="koboSpan" id="kobo.1192.1"> page of the Django administration site instead of your own </span><strong class="screenText"><span class="koboSpan" id="kobo.1193.1">Logged out</span></strong><span class="koboSpan" id="kobo.1194.1"> page, check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1195.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1196.1"> setting of your project and make sure that </span><code class="inlineCode"><span class="koboSpan" id="kobo.1197.1">django.contrib.admin</span></code><span class="koboSpan" id="kobo.1198.1"> comes after the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1199.1">account</span></code><span class="koboSpan" id="kobo.1200.1"> application. </span><span class="koboSpan" id="kobo.1200.2">Both applications contain logged-out templates located in the same relative path. </span><span class="koboSpan" id="kobo.1200.3">The Django template loader will go through the different applications in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1201.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1202.1"> list and use the first template it finds.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-150"><span class="koboSpan" id="kobo.1203.1">Change password views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1204.1">We need users to</span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.1205.1"> be able to change their password after they log in to the site. </span><span class="koboSpan" id="kobo.1205.2">We will integrate the Django authentication views to change passwords.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1206.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1207.1">urls.py</span></code><span class="koboSpan" id="kobo.1208.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1209.1">account</span></code><span class="koboSpan" id="kobo.1210.1"> application and add the following URL patterns highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1211.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1212.1"># previous login url</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1213.1"># path('login/', views.user_login, name='login'),</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1214.1"># login / logout urls</span></span><span class="koboSpan" id="kobo.1215.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1216.1">'login/'</span></span><span class="koboSpan" id="kobo.1217.1">, auth_views.LoginView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1218.1">'login'</span></span><span class="koboSpan" id="kobo.1219.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1220.1">'logout/'</span></span><span class="koboSpan" id="kobo.1221.1">, auth_views.LogoutView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1222.1">'logout'</span></span><span class="koboSpan" id="kobo.1223.1">),
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1224.1"># change password urls</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1225.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1226.1">'password-change/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1227.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1228.1">        auth_views.PasswordChangeView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1229.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1230.1">'password_change'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1231.1">    ),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1232.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1233.1">'password-change/done/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1234.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1235.1">        auth_views.PasswordChangeDoneView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1236.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1237.1">'password_change_done'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1238.1">    ),</span></strong></span><span class="koboSpan" id="kobo.1239.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1240.1">''</span></span><span class="koboSpan" id="kobo.1241.1">, views.dashboard, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1242.1">'dashboard'</span></span><span class="koboSpan" id="kobo.1243.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1244.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1245.1">PasswordChangeView</span></code><span class="koboSpan" id="kobo.1246.1"> view will handle the form to change the password, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1247.1">PasswordChangeDoneView</span></code><span class="koboSpan" id="kobo.1248.1"> view will display a success message after the user has successfully</span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.1249.1"> changed their password. </span><span class="koboSpan" id="kobo.1249.2">Let’s create a template for each view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1250.1">Add a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1251.1">templates/registration/</span></code><span class="koboSpan" id="kobo.1252.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1253.1">account</span></code><span class="koboSpan" id="kobo.1254.1"> application and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1255.1">password_change_form.html</span></code><span class="koboSpan" id="kobo.1256.1">. </span><span class="koboSpan" id="kobo.1256.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1257.1">{% extends "base.html" %}
{% block title %}Change your password{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1258.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1259.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1260.1">&gt;</span></span><span class="koboSpan" id="kobo.1261.1">Change your password</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1262.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1263.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1264.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1265.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1266.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1267.1">&gt;</span></span><span class="koboSpan" id="kobo.1268.1">Use the form below to change your password.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1269.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1270.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1271.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1272.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1273.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1274.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1275.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1276.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1277.1">&gt;</span></span><span class="koboSpan" id="kobo.1278.1">
    {{ form.as_p }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1279.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1280.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1281.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1282.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1283.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1284.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1285.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1286.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1287.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1288.1">"Change"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1289.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1290.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1291.1">&gt;</span></span><span class="koboSpan" id="kobo.1292.1">
    {% csrf_token %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1293.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1294.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1295.1">&gt;</span></span><span class="koboSpan" id="kobo.1296.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1297.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">password_change_form.html</span></code><span class="koboSpan" id="kobo.1299.1"> template includes the form to change the password.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1300.1">Now, create another file in the same directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1301.1">password_change_done.html</span></code><span class="koboSpan" id="kobo.1302.1">. </span><span class="koboSpan" id="kobo.1302.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1303.1">{% extends "base.html" %}
{% block title %}Password changed{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1304.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1305.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1306.1">&gt;</span></span><span class="koboSpan" id="kobo.1307.1">Password changed</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1308.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1309.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1310.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1311.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1312.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1313.1">&gt;</span></span><span class="koboSpan" id="kobo.1314.1">Your password has been successfully changed.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1315.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1316.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1317.1">&gt;</span></span><span class="koboSpan" id="kobo.1318.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1319.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1320.1">password_change_done.html</span></code><span class="koboSpan" id="kobo.1321.1"> template only contains the success message to be displayed </span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.1322.1">when the user has successfully changed their password.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1323.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1324.1">http://127.0.0.1:8000/account/password-change/</span></code><span class="koboSpan" id="kobo.1325.1"> in your browser. </span><span class="koboSpan" id="kobo.1325.2">If you are not logged in, the browser will redirect you to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1326.1">Log-in</span></strong><span class="koboSpan" id="kobo.1327.1"> page. </span><span class="koboSpan" id="kobo.1327.2">After you are successfully authenticated, you will see the following change password page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1328.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_04_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1329.1">Figure 4.10: The change password form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1330.1">Fill in the form </span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.1331.1">with your current password and your new password, and then click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1332.1">CHANGE</span></strong><span class="koboSpan" id="kobo.1333.1"> button. </span><span class="koboSpan" id="kobo.1333.2">You will see the following success page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1334.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_04_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1335.1">Figure 4.11: The successful change password page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1336.1">Log out and log in </span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.1337.1">again using your new password to verify that everything works as expected.</span></p>
<h2 class="heading-2" id="_idParaDest-151"><span class="koboSpan" id="kobo.1338.1">Reset password views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1339.1">If users forget</span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.1340.1"> their password, they should be able to recover their account. </span><span class="koboSpan" id="kobo.1340.2">We will implement a password reset feature. </span><span class="koboSpan" id="kobo.1340.3">This will enable users to regain access to their account by receiving a password reset email that contains a secure link, generated with a unique token, allowing them to create a new password.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1341.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1342.1">urls.py</span></code><span class="koboSpan" id="kobo.1343.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1344.1">account</span></code><span class="koboSpan" id="kobo.1345.1"> application and add the following URL patterns highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1346.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1347.1"># previous login url</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1348.1"># path('login/', views.user_login, name='login'),</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1349.1"># login / logout urls</span></span><span class="koboSpan" id="kobo.1350.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1351.1">'login/'</span></span><span class="koboSpan" id="kobo.1352.1">, auth_views.LoginView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1353.1">'login'</span></span><span class="koboSpan" id="kobo.1354.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1355.1">'logout/'</span></span><span class="koboSpan" id="kobo.1356.1">, auth_views.LogoutView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1357.1">'logout'</span></span><span class="koboSpan" id="kobo.1358.1">),
  
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1359.1"># change password urls</span></span><span class="koboSpan" id="kobo.1360.1">
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1361.1">'password-change/'</span></span><span class="koboSpan" id="kobo.1362.1">,
        auth_views.PasswordChangeView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1363.1">'password_change'</span></span>
<span class="hljs-string"> </span><span class="koboSpan" id="kobo.1364.1">),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1365.1">'password-change/done/'</span></span><span class="koboSpan" id="kobo.1366.1">,
        auth_views.PasswordChangeDoneView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1367.1">'password_change_done'</span></span>
<span class="hljs-string"> </span><span class="koboSpan" id="kobo.1368.1">),
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1369.1"># reset password urls</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1370.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1371.1">'password-reset/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1372.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1373.1">        auth_views.PasswordResetView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1374.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1375.1">'password_reset'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1376.1">    ),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1377.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1378.1">'password-reset/done/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1379.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1380.1">        auth_views.PasswordResetDoneView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1381.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1382.1">'password_reset_done'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1383.1">    ),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1384.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1385.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1386.1">password-reset/&lt;uidb64&gt;/&lt;token&gt;/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1387.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1388.1">        auth_views.PasswordResetConfirmView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1389.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1390.1">'password_reset_confirm'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1391.1">    ),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1392.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1393.1">'password-reset/complete/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1394.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1395.1">        auth_views.PasswordResetCompleteView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1396.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1397.1">'password_reset_complete'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1398.1">    ),</span></strong></span><span class="koboSpan" id="kobo.1399.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1400.1">''</span></span><span class="koboSpan" id="kobo.1401.1">, views.dashboard, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1402.1">'dashboard'</span></span><span class="koboSpan" id="kobo.1403.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1404.1">Add a new </span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.1405.1">file to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1406.1">templates/registration/</span></code><span class="koboSpan" id="kobo.1407.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1408.1">account</span></code><span class="koboSpan" id="kobo.1409.1"> application and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1410.1">password_reset_form.html</span></code><span class="koboSpan" id="kobo.1411.1">. </span><span class="koboSpan" id="kobo.1411.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1412.1">{% extends "base.html" %}
{% block title %}Reset your password{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1413.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1414.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1415.1">&gt;</span></span><span class="koboSpan" id="kobo.1416.1">Forgotten your password?</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1417.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1418.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1419.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1420.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1421.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1422.1">&gt;</span></span><span class="koboSpan" id="kobo.1423.1">Enter your e-mail address to obtain a new password.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1424.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1425.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1426.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1427.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1428.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1429.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1430.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1431.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1432.1">&gt;</span></span><span class="koboSpan" id="kobo.1433.1">
    {{ form.as_p }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1434.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1435.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1436.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1437.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1438.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1439.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1440.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1441.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1442.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1443.1">"Send e-mail"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1444.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1445.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1446.1">&gt;</span></span><span class="koboSpan" id="kobo.1447.1">
    {% csrf_token %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1448.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1449.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1450.1">&gt;</span></span><span class="koboSpan" id="kobo.1451.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1452.1">Now, create another file in the same directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1453.1">password_reset_email.html</span></code><span class="koboSpan" id="kobo.1454.1">. </span><span class="koboSpan" id="kobo.1454.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1455.1">Someone asked for password reset for email {{ email }}. </span><span class="koboSpan" id="kobo.1455.2">Follow the link below:
{{ protocol }}://{{ domain }}{% url "password_reset_confirm" uidb64=uid token=token %}
Your username, in case you've forgotten: {{ user.get_username }}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1456.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1457.1">password_reset_email.html</span></code><span class="koboSpan" id="kobo.1458.1"> template will be used to render the email sent to users to reset their password. </span><span class="koboSpan" id="kobo.1458.2">It includes a reset token that is generated by the view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1459.1">Create another file</span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.1460.1"> in the same directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1461.1">password_reset_done.html</span></code><span class="koboSpan" id="kobo.1462.1">. </span><span class="koboSpan" id="kobo.1462.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1463.1">{% extends "base.html" %}
{% block title %}Reset your password{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1464.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1465.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1466.1">&gt;</span></span><span class="koboSpan" id="kobo.1467.1">Reset your password</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1468.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1469.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1470.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1471.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1472.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1473.1">&gt;</span></span><span class="koboSpan" id="kobo.1474.1">We've emailed you instructions for setting your password.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1475.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1476.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1477.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1478.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1479.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1480.1">&gt;</span></span><span class="koboSpan" id="kobo.1481.1">If you don't receive an email, please make sure you've entered the address you registered with.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1482.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1483.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1484.1">&gt;</span></span><span class="koboSpan" id="kobo.1485.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1486.1">Create another template in the same directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1487.1">password_reset_confirm.html</span></code><span class="koboSpan" id="kobo.1488.1">. </span><span class="koboSpan" id="kobo.1488.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1489.1">{% extends "base.html" %}
{% block title %}Reset your password{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1490.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1491.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1492.1">&gt;</span></span><span class="koboSpan" id="kobo.1493.1">Reset your password</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1494.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1495.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1496.1">&gt;</span></span><span class="koboSpan" id="kobo.1497.1">
  {% if validlink %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1498.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1499.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1500.1">&gt;</span></span><span class="koboSpan" id="kobo.1501.1">Please enter your new password twice:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1502.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1503.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1504.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1505.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1506.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1507.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1508.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1509.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1510.1">&gt;</span></span><span class="koboSpan" id="kobo.1511.1">
      {{ form.as_p }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1512.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1513.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1514.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1515.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1516.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1517.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1518.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1519.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1520.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1521.1">"Change my password"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1522.1"> /&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1523.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1524.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1525.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1526.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1527.1">&gt;</span></span><span class="koboSpan" id="kobo.1528.1">
  {% else %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1529.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1530.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1531.1">&gt;</span></span><span class="koboSpan" id="kobo.1532.1">The password reset link was invalid, possibly because it has already been used. </span><span class="koboSpan" id="kobo.1532.2">Please request a new password reset.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1533.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1534.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1535.1">&gt;</span></span><span class="koboSpan" id="kobo.1536.1">
  {% endif %}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1537.1">In this template, we confirm whether the link to reset the password is valid by checking the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1538.1">validlink</span></code><span class="koboSpan" id="kobo.1539.1"> variable. </span><span class="koboSpan" id="kobo.1539.2">The view </span><code class="inlineCode"><span class="koboSpan" id="kobo.1540.1">PasswordResetConfirmView</span></code><span class="koboSpan" id="kobo.1541.1"> checks the validity of the token provided in the URL and passes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1542.1">validlink</span></code><span class="koboSpan" id="kobo.1543.1"> variable to the template. </span><span class="koboSpan" id="kobo.1543.2">If the link is valid, the user password reset form is displayed. </span><span class="koboSpan" id="kobo.1543.3">Users can only set a new password if they have a valid reset password link.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1544.1">Create another</span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.1545.1"> template and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1546.1">password_reset_complete.html</span></code><span class="koboSpan" id="kobo.1547.1">. </span><span class="koboSpan" id="kobo.1547.2">Enter the following code into it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1548.1">{% extends "base.html" %}
{% block title %}Password reset{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1549.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1550.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1551.1">&gt;</span></span><span class="koboSpan" id="kobo.1552.1">Password set</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1553.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1554.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1555.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1556.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1557.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1558.1">&gt;</span></span><span class="koboSpan" id="kobo.1559.1">Your password has been set. </span><span class="koboSpan" id="kobo.1559.2">You can </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1560.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1561.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1562.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1563.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1564.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1565.1">login</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1566.1">" %}"&gt;</span></span><span class="koboSpan" id="kobo.1567.1">log in now</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1568.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1569.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1570.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1571.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1572.1">&gt;</span></span><span class="koboSpan" id="kobo.1573.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1574.1">Finally, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1575.1">registration/login.html</span></code><span class="koboSpan" id="kobo.1576.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1577.1">account</span></code><span class="koboSpan" id="kobo.1578.1"> application, and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1579.1">{% extends "base.html" %}
{% block title %}Log-in{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1580.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1581.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1582.1">&gt;</span></span><span class="koboSpan" id="kobo.1583.1">Log-in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1584.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1585.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1586.1">&gt;</span></span><span class="koboSpan" id="kobo.1587.1">
  {% if form.errors %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1588.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1589.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1590.1">&gt;</span></span><span class="koboSpan" id="kobo.1591.1">
      Your username and password didn't match.
      </span><span class="koboSpan" id="kobo.1591.2">Please try again.
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1592.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1593.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1594.1">&gt;</span></span><span class="koboSpan" id="kobo.1595.1">
  {% else %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1596.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1597.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1598.1">&gt;</span></span><span class="koboSpan" id="kobo.1599.1">Please, use the following form to log-in:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1600.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1601.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1602.1">&gt;</span></span><span class="koboSpan" id="kobo.1603.1">
  {% endif %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1604.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1605.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1606.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1607.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1608.1">"login-form"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1609.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1610.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1611.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1612.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1613.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1614.1">"{% url 'login' %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1615.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1616.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1617.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1618.1">&gt;</span></span><span class="koboSpan" id="kobo.1619.1">
      {{ form.as_p }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1620.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1621.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1622.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1623.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1624.1">"hidden"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1625.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1626.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1627.1">"next"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1628.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1629.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1630.1">"{{ next }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1631.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1632.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1633.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1634.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1635.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1636.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1637.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1638.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1639.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1640.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1641.1">"Log-in"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1642.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1643.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1644.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1645.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1646.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1647.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1648.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1649.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1650.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1651.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1652.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1653.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1654.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1655.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1656.1">password_reset</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1657.1">" %}"&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1658.1">        Forgotten your password?</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1659.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1660.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1661.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1662.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1663.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1664.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1665.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1666.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1667.1">&gt;</span></span><span class="koboSpan" id="kobo.1668.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1669.1">Now, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1670.1">http://127.0.0.1:8000/account/login/</span></code><span class="koboSpan" id="kobo.1671.1"> in your browser. </span><span class="koboSpan" id="kobo.1671.2">The </span><strong class="screenText"><span class="koboSpan" id="kobo.1672.1">Log-in </span></strong><span class="koboSpan" id="kobo.1673.1">page should now</span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.1674.1"> include a link to the reset password page, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1675.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_04_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1676.1">Figure 4.12: The Log-in page, including a link to the reset password page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1677.1">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1678.1">Forgotten your password?</span></strong><span class="koboSpan" id="kobo.1679.1"> link. </span><span class="koboSpan" id="kobo.1679.2">You should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1680.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_04_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1681.1">Figure 4.13: The restore password form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1682.1">At this point, we </span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.1683.1">need to add </span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.1684.1">a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1685.1">Simple Mail Transfer Protocol</span></strong><span class="koboSpan" id="kobo.1686.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1687.1">SMTP</span></strong><span class="koboSpan" id="kobo.1688.1">) configuration to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1689.1">settings.py</span></code><span class="koboSpan" id="kobo.1690.1"> file of your project so that Django is able to send emails. </span><span class="koboSpan" id="kobo.1690.2">You learned how to add email settings to your project in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1691.1">Chapter 2</span></em><span class="koboSpan" id="kobo.1692.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1693.1">Enhancing Your Blog with Advanced Features</span></em><span class="koboSpan" id="kobo.1694.1">. </span><span class="koboSpan" id="kobo.1694.2">However, during development, you can configure Django to write emails to the standard output instead of sending them through an SMTP server. </span><span class="koboSpan" id="kobo.1694.3">Django provides an email backend to write emails to the console.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1695.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1696.1">settings.py</span></code><span class="koboSpan" id="kobo.1697.1"> file of your project, and add the following line to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1698.1">EMAIL_BACKEND = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1699.1">'django.core.mail.backends.console.EmailBackend'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1700.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1701.1">EMAIL_BACKEND</span></code><span class="koboSpan" id="kobo.1702.1"> setting indicates the class that will be used to send emails.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1703.1">Return to your browser, enter the email address of an existing user, and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1704.1">SEND E-MAIL</span></strong><span class="koboSpan" id="kobo.1705.1"> button. </span><span class="koboSpan" id="kobo.1705.2">You should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1706.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_04_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1707.1">Figure 4.14: The reset password email sent page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1708.1">Take a look at the</span><a id="_idIndexMarker411"/><span class="koboSpan" id="kobo.1709.1"> shell prompt, where you are running the development server. </span><span class="koboSpan" id="kobo.1709.2">You will see the generated email, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1710.1">Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Subject: Password reset on 127.0.0.1:8000
From: webmaster@localhost
To: test@gmail.com
Date: Mon, 10 Jan 2024 19:05:18 -0000
Message-ID: &lt;162896791878.58862.14771487060402279558@MBP-amele.local&gt;
Someone asked for password reset for email test@gmail.com. </span><span class="koboSpan" id="kobo.1710.2">Follow the link below:
http://127.0.0.1:8000/account/password-reset/MQ/ardx0u-b4973cfa2c70d652a190e79054bc479a/
Your username, in case you've forgotten: test
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1711.1">The email is rendered using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1712.1">password_reset_email.html</span></code><span class="koboSpan" id="kobo.1713.1"> template that you created earlier. </span><span class="koboSpan" id="kobo.1713.2">The URL to reset the password includes a token that was generated dynamically by Django.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1714.1">Copy the URL from the email, which should look similar to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1715.1">http://127.0.0.1:8000/account/password-reset/MQ/ardx0u-b4973cfa2c70d652a190e79054bc479a/</span></code><span class="koboSpan" id="kobo.1716.1">, and open it in your browser. </span><span class="koboSpan" id="kobo.1716.2">You should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1717.1"><img alt="Graphical user interface, text, application, chat or text message, email  Description automatically generated" src="../Images/B21088_04_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1718.1">Figure 4.15: The reset password form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1719.1">The page to set a</span><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.1720.1"> new password uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1721.1">password_reset_confirm.html</span></code><span class="koboSpan" id="kobo.1722.1"> template. </span><span class="koboSpan" id="kobo.1722.2">Fill in a new password and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1723.1">CHANGE MY PASSWORD</span></strong><span class="koboSpan" id="kobo.1724.1"> button. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.1725.1">Django will create a new hashed password and save it in the database. </span><span class="koboSpan" id="kobo.1725.2">You will see the following success page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1726.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_04_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1727.1">Figure 4.16: The successful password reset page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1728.1">Now, you can log back into the user account using the new password.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1729.1">Each token to set a new password can be used only once. </span><span class="koboSpan" id="kobo.1729.2">If you open the link that you received again, you will get a message stating that the token is invalid.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1730.1">We have now integrated the views of the Django authentication framework into the project. </span><span class="koboSpan" id="kobo.1730.2">These views are suitable for most cases. </span><span class="koboSpan" id="kobo.1730.3">However, you can create your own views if you need different behavior.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1731.1">Django provides URL patterns for the authentication views that are equivalent to the ones we just </span><a id="_idIndexMarker413"/><span class="koboSpan" id="kobo.1732.1">created. </span><span class="koboSpan" id="kobo.1732.2">We will replace the authentication URL patterns with the ones provided by Django.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1733.1">Comment out the authentication URL patterns that you added to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1734.1">urls.py</span></code><span class="koboSpan" id="kobo.1735.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1736.1">account</span></code><span class="koboSpan" id="kobo.1737.1"> application and include </span><code class="inlineCode"><span class="koboSpan" id="kobo.1738.1">django.contrib.auth.urls</span></code><span class="koboSpan" id="kobo.1739.1"> instead, as follows. </span><span class="koboSpan" id="kobo.1739.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1740.1">from</span></span><span class="koboSpan" id="kobo.1741.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1742.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1743.1">include,</span></strong></span><span class="koboSpan" id="kobo.1744.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1745.1">from</span></span><span class="koboSpan" id="kobo.1746.1"> django.contrib.auth </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1747.1">import</span></span><span class="koboSpan" id="kobo.1748.1"> views </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1749.1">as</span></span><span class="koboSpan" id="kobo.1750.1"> auth_views
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1751.1">from</span></span><span class="koboSpan" id="kobo.1752.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1753.1">import</span></span><span class="koboSpan" id="kobo.1754.1"> views
urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1755.1"># previous login view</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1756.1"># path('login/', views.user_login, name='login'),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1757.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1758.1"> path('login/', auth_views.LoginView.as_view(), name='login'),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1759.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1760.1"> path('logout/', auth_views.LogoutView.as_view(), name='logout'),</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1761.1"># change password urls</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1762.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1763.1"> path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1764.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1765.1">     'password-change/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1766.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1767.1">     auth_views.PasswordChangeView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1768.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1769.1">     name='password_change'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1770.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1771.1"> ),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1772.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1773.1"> path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1774.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1775.1">     'password-change/done/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1776.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1777.1">     auth_views.PasswordChangeDoneView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1778.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1779.1">     name='password_change_done'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1780.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1781.1"> ),</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1782.1"># reset password urls</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1783.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1784.1"> path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1785.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1786.1">     'password-reset/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1787.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1788.1">     auth_views.PasswordResetView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1789.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1790.1">     name='password_reset'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1791.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1792.1"> ),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1793.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1794.1"> path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1795.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1796.1">     'password-reset/done/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1797.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1798.1">     auth_views.PasswordResetDoneView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1799.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1800.1">     name='password_reset_done'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1801.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1802.1"> ),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1803.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1804.1"> path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1805.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1806.1">     'password-reset/&lt;uidb64&gt;/&lt;token&gt;/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1807.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1808.1">     auth_views.PasswordResetConfirmView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1809.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1810.1">     name='password_reset_confirm'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1811.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1812.1"> ),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1813.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1814.1"> path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1815.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1816.1">     'password-reset/complete/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1817.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1818.1">     auth_views.PasswordResetCompleteView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1819.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1820.1">     name='password_reset_complete'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1821.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1822.1"> ),</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1823.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1824.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1825.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1826.1">'django.contrib.auth.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1827.1">)),</span></strong></span><span class="koboSpan" id="kobo.1828.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1829.1">''</span></span><span class="koboSpan" id="kobo.1830.1">, views.dashboard, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1831.1">'dashboard'</span></span><span class="koboSpan" id="kobo.1832.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1833.1">You can see the </span><a id="_idIndexMarker414"/><span class="koboSpan" id="kobo.1834.1">authentication URL patterns included at </span><a href="https://github.com/django/django/blob/stable/5.0.x/django/contrib/auth/urls.py"><span class="url"><span class="koboSpan" id="kobo.1835.1">https://github.com/django/django/blob/stable/5.0.x/django/contrib/auth/urls.py</span></span></a><span class="koboSpan" id="kobo.1836.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1837.1">We have now added all the necessary authentication views to our project. </span><span class="koboSpan" id="kobo.1837.2">Next, we will implement</span><a id="_idIndexMarker415"/><span class="koboSpan" id="kobo.1838.1"> user registration.</span></p>
<h1 class="heading-1" id="_idParaDest-152"><span class="koboSpan" id="kobo.1839.1">User registration and user profiles</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1840.1">Site users can </span><a id="_idIndexMarker416"/><span class="koboSpan" id="kobo.1841.1">now</span><a id="_idIndexMarker417"/><span class="koboSpan" id="kobo.1842.1"> log in, log out, change their password, and reset their password. </span><span class="koboSpan" id="kobo.1842.2">However, we need to build a view to allow visitors to create a user account. </span><span class="koboSpan" id="kobo.1842.3">They should be able to register and create a profile on our site. </span><span class="koboSpan" id="kobo.1842.4">Once registered, users will be able to log in to our site using their credentials.</span></p>
<h2 class="heading-2" id="_idParaDest-153"><span class="koboSpan" id="kobo.1843.1">User registration</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1844.1">Let’s create a</span><a id="_idIndexMarker418"/><span class="koboSpan" id="kobo.1845.1"> simple view to allow user registration on your website. </span><span class="koboSpan" id="kobo.1845.2">Initially, you have to create a form to let the user enter a username, their real name, and a password.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1846.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1847.1">forms.py</span></code><span class="koboSpan" id="kobo.1848.1"> file located inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1849.1">account</span></code><span class="koboSpan" id="kobo.1850.1"> application directory and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1851.1">from</span></span><span class="koboSpan" id="kobo.1852.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1853.1">import</span></span><span class="koboSpan" id="kobo.1854.1"> forms
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1855.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1856.1"> django.contrib.auth </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1857.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1858.1"> get_user_model</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1859.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1860.1">LoginForm</span></span><span class="koboSpan" id="kobo.1861.1">(forms.Form):
    username = forms.CharField()
    password = forms.CharField(widget=forms.PasswordInput)
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1862.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1863.1">UserRegistrationForm</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1864.1">(forms.ModelForm):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1865.1">    password = forms.CharField(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1866.1">        label=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1867.1">'Password'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1868.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1869.1">        widget=forms.PasswordInput</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1870.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1871.1">    password2 = forms.CharField(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1872.1">        label=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1873.1">'Repeat password'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1874.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1875.1">        widget=forms.PasswordInput</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1876.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1877.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1878.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1879.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1880.1">        model = get_user_model()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1881.1">        fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1882.1">'username'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1883.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1884.1">'first_name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1885.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1886.1">'email'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1887.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1888.1">We have created a model form for the user model. </span><span class="koboSpan" id="kobo.1888.2">This form includes the fields </span><code class="inlineCode"><span class="koboSpan" id="kobo.1889.1">username</span></code><span class="koboSpan" id="kobo.1890.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1891.1">first_name</span></code><span class="koboSpan" id="kobo.1892.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1893.1">email</span></code><span class="koboSpan" id="kobo.1894.1"> of the user model. </span><span class="koboSpan" id="kobo.1894.2">We retrieve the user model dynamically by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1895.1">get_user_model()</span></code><span class="koboSpan" id="kobo.1896.1"> function provided by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1897.1">auth</span></code><span class="koboSpan" id="kobo.1898.1"> application. </span><span class="koboSpan" id="kobo.1898.2">This retrieves the user model, which could be a custom model instead of the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.1899.1">auth</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.1900.1">User</span></code><span class="koboSpan" id="kobo.1901.1"> model, since Django allows you to define custom user models. </span><span class="koboSpan" id="kobo.1901.2">These fields will be validated according to the validations of their corresponding model fields. </span><span class="koboSpan" id="kobo.1901.3">For example, if the user chooses a username that already exists, they will get a validation error because </span><code class="inlineCode"><span class="koboSpan" id="kobo.1902.1">username</span></code><span class="koboSpan" id="kobo.1903.1"> is a field defined with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1904.1">unique=True</span></code><span class="koboSpan" id="kobo.1905.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1906.1">In order to keep your code generic, use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1907.1">get_user_model()</span></code><span class="koboSpan" id="kobo.1908.1"> method to retrieve the user model and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1909.1">AUTH_USER_MODEL</span></code><span class="koboSpan" id="kobo.1910.1"> setting to refer to it when defining a model’s relationship with in to it, instead of referring to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1911.1">auth</span></code><span class="koboSpan" id="kobo.1912.1"> user model directly. </span><span class="koboSpan" id="kobo.1912.2">You can read more information about this at </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#django.contrib.auth.get_user_model"><span class="url"><span class="koboSpan" id="kobo.1913.1">https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#django.contrib.auth.get_user_model</span></span></a><span class="koboSpan" id="kobo.1914.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1915.1">We have also</span><a id="_idIndexMarker419"/><span class="koboSpan" id="kobo.1916.1"> added two additional fields—</span><code class="inlineCode"><span class="koboSpan" id="kobo.1917.1">password</span></code><span class="koboSpan" id="kobo.1918.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1919.1">password2</span></code><span class="koboSpan" id="kobo.1920.1">—for users to set a password and to repeat it. </span><span class="koboSpan" id="kobo.1920.2">Let’s add the field validation to check that both passwords are the same.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1921.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1922.1">forms.py</span></code><span class="koboSpan" id="kobo.1923.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1924.1">account</span></code><span class="koboSpan" id="kobo.1925.1"> application and add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1926.1">clean_password2()</span></code><span class="koboSpan" id="kobo.1927.1"> method to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1928.1">UserRegistrationForm</span></code><span class="koboSpan" id="kobo.1929.1"> class. </span><span class="koboSpan" id="kobo.1929.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1930.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1931.1">UserRegistrationForm</span></span><span class="koboSpan" id="kobo.1932.1">(forms.ModelForm):
    password = forms.CharField(
        label=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1933.1">'Password'</span></span><span class="koboSpan" id="kobo.1934.1">,
        widget=forms.PasswordInput
    )
    password2 = forms.CharField(
        label=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1935.1">'Repeat password'</span></span><span class="koboSpan" id="kobo.1936.1">,
        widget=forms.PasswordInput
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1937.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1938.1">Meta</span></span><span class="koboSpan" id="kobo.1939.1">:
        model = get_user_model()
        fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1940.1">'username'</span></span><span class="koboSpan" id="kobo.1941.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1942.1">'first_name'</span></span><span class="koboSpan" id="kobo.1943.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1944.1">'email'</span></span><span class="koboSpan" id="kobo.1945.1">]
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1946.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1947.1">clean_password2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1948.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1949.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1950.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1951.1">        cd = self.cleaned_data</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1952.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1953.1"> cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1954.1">'password'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1955.1">] != cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1956.1">'password2'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1957.1">]:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1958.1">raise</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1959.1"> forms.ValidationError(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1960.1">"Passwords don't match."</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1961.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1962.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1963.1"> cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1964.1">'password2'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1965.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1966.1">We have defined a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1967.1">clean_password2()</span></code><span class="koboSpan" id="kobo.1968.1"> method to compare the second password against the first one and raise a validation error if the passwords don’t match. </span><span class="koboSpan" id="kobo.1968.2">This method is executed when the form is validated by calling its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1969.1">is_valid()</span></code><span class="koboSpan" id="kobo.1970.1"> method. </span><span class="koboSpan" id="kobo.1970.2">You can provide a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1971.1">clean_&lt;fieldname&gt;()</span></code><span class="koboSpan" id="kobo.1972.1"> method to any of your form fields to clean the value or raise form validation errors for a specific field. </span><span class="koboSpan" id="kobo.1972.2">Forms also include a general </span><code class="inlineCode"><span class="koboSpan" id="kobo.1973.1">clean()</span></code><span class="koboSpan" id="kobo.1974.1"> method to validate the entire form, which is useful to validate fields that depend on each other. </span><span class="koboSpan" id="kobo.1974.2">In this case, we use the field-specific </span><code class="inlineCode"><span class="koboSpan" id="kobo.1975.1">clean_password2()</span></code><span class="koboSpan" id="kobo.1976.1"> validation instead of overriding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1977.1">clean()</span></code><span class="koboSpan" id="kobo.1978.1"> method of the form. </span><span class="koboSpan" id="kobo.1978.2">This avoids overriding other field-specific checks that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1979.1">ModelForm</span></code><span class="koboSpan" id="kobo.1980.1"> gets from the restrictions set in the model (for example, validating</span><a id="_idIndexMarker420"/><span class="koboSpan" id="kobo.1981.1"> that the username is unique).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1982.1">Django also provides a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1983.1">UserCreationForm</span></code><span class="koboSpan" id="kobo.1984.1"> form that resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1985.1">django.contrib.auth.forms</span></code><span class="koboSpan" id="kobo.1986.1"> and is very similar to the one we have created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1987.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1988.1">views.py</span></code><span class="koboSpan" id="kobo.1989.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1990.1">account</span></code><span class="koboSpan" id="kobo.1991.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1992.1">from</span></span><span class="koboSpan" id="kobo.1993.1"> django.contrib.auth </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1994.1">import</span></span><span class="koboSpan" id="kobo.1995.1"> authenticate, login
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1996.1">from</span></span><span class="koboSpan" id="kobo.1997.1"> django.contrib.auth.decorators </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1998.1">import</span></span><span class="koboSpan" id="kobo.1999.1"> login_required
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2000.1">from</span></span><span class="koboSpan" id="kobo.2001.1"> django.http </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2002.1">import</span></span><span class="koboSpan" id="kobo.2003.1"> HttpResponse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2004.1">from</span></span><span class="koboSpan" id="kobo.2005.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2006.1">import</span></span><span class="koboSpan" id="kobo.2007.1"> render
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2008.1">from</span></span><span class="koboSpan" id="kobo.2009.1"> .forms </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2010.1">import</span></span><span class="koboSpan" id="kobo.2011.1"> LoginForm</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2012.1">, UserRegistrationForm</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2013.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2014.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2015.1">register</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2016.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2017.1">request</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2018.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2019.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2020.1"> request.method == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2021.1">'POST'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2022.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2023.1">        user_form = UserRegistrationForm(request.POST)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2024.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2025.1"> user_form.is_valid():</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2026.1"># Create a new user object but avoid saving it yet</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2027.1">            new_user = user_form.save(commit=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2028.1">False</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2029.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2030.1"># Set the chosen password</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2031.1">            new_user.set_password(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2032.1">                user_form.cleaned_data[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2033.1">'password'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2034.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2035.1">            )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2036.1"># Save the User object</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2037.1">            new_user.save()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2038.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2039.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2040.1">request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2041.1">'account/register_done.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2042.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2043.1">{</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2044.1">'new_user'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2045.1">: new_user}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2046.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2047.1">else</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2048.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2049.1">        user_form = UserRegistrationForm()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2050.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2051.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2052.1">        request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2053.1">'account/register.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2054.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2055.1">        {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2056.1">'user_form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2057.1">: user_form}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2058.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2059.1">The view for creating user accounts is quite simple. </span><span class="koboSpan" id="kobo.2059.2">For security reasons, instead of saving the raw password entered by the user, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2060.1">set_password()</span></code><span class="koboSpan" id="kobo.2061.1"> method of the user model. </span><span class="koboSpan" id="kobo.2061.2">This method handles password hashing before storing the password in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2062.1">Django doesn’t store clear text passwords; it stores hashed passwords instead. </span><span class="koboSpan" id="kobo.2062.2">Hashing is the process of transforming a given key into another value. </span><span class="koboSpan" id="kobo.2062.3">A hash function is used to generate a fixed-length</span><a id="_idIndexMarker421"/><span class="koboSpan" id="kobo.2063.1"> value according to a mathematical algorithm. </span><span class="koboSpan" id="kobo.2063.2">By hashing passwords with secure algorithms, Django ensures that user passwords stored in the database require massive amounts of computing time to break.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2064.1">By default, Django uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2065.1">PBKDF2</span></code><span class="koboSpan" id="kobo.2066.1"> hashing algorithm with a SHA256 hash to store all passwords. </span><span class="koboSpan" id="kobo.2066.2">However, Django not only supports checking existing passwords hashed with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2067.1">PBKDF2</span></code><span class="koboSpan" id="kobo.2068.1"> but also supports checking stored passwords hashed with other algorithms, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2069.1">PBKDF2SHA1</span></code><span class="koboSpan" id="kobo.2070.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2071.1">argon2</span></code><span class="koboSpan" id="kobo.2072.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2073.1">bcrypt</span></code><span class="koboSpan" id="kobo.2074.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2075.1">scrypt</span></code><span class="koboSpan" id="kobo.2076.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2077.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2078.1">PASSWORD_HASHERS</span></code><span class="koboSpan" id="kobo.2079.1"> setting defines the password hashers that the Django project supports. </span><span class="koboSpan" id="kobo.2079.2">The following is the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.2080.1">PASSWORD_HASHERS</span></code><span class="koboSpan" id="kobo.2081.1"> list:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2082.1">PASSWORD_HASHERS = [
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2083.1">'django.contrib.auth.hashers.PBKDF2PasswordHasher'</span></span><span class="koboSpan" id="kobo.2084.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2085.1">'django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher'</span></span><span class="koboSpan" id="kobo.2086.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2087.1">'django.contrib.auth.hashers.Argon2PasswordHasher'</span></span><span class="koboSpan" id="kobo.2088.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2089.1">'django.contrib.auth.hashers.BCryptSHA256PasswordHasher'</span></span><span class="koboSpan" id="kobo.2090.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2091.1">'django.contrib.auth.hashers.ScryptPasswordHasher'</span></span><span class="koboSpan" id="kobo.2092.1">,
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2093.1">Django uses the first entry of the list (in this case, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2094.1">PBKDF2PasswordHasher</span></code><span class="koboSpan" id="kobo.2095.1">) to hash all passwords. </span><span class="koboSpan" id="kobo.2095.2">The rest of the hashers can be used by Django to check existing passwords.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2096.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2097.1">scrypt</span></code><span class="koboSpan" id="kobo.2098.1"> hasher was introduced in Django 4.0. </span><span class="koboSpan" id="kobo.2098.2">It is more secure and recommended over </span><code class="inlineCode"><span class="koboSpan" id="kobo.2099.1">PBKDF2</span></code><span class="koboSpan" id="kobo.2100.1">. </span><span class="koboSpan" id="kobo.2100.2">However, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2101.1">PBKDF2</span></code><span class="koboSpan" id="kobo.2102.1"> is still the default hasher, as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2103.1">scrypt</span></code><span class="koboSpan" id="kobo.2104.1"> requires OpenSSL 1.1+ and more memory.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2105.1">You can learn more about how Django stores passwords and about the password hashers included at </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/passwords/"><span class="url"><span class="koboSpan" id="kobo.2106.1">https://docs.djangoproject.com/en/5.0/topics/auth/passwords/</span></span></a><span class="koboSpan" id="kobo.2107.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2108.1">Now, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2109.1">urls.py</span></code><span class="koboSpan" id="kobo.2110.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2111.1">account</span></code><span class="koboSpan" id="kobo.2112.1"> application and add the following URL pattern highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2113.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2114.1"># ...</span></span><span class="koboSpan" id="kobo.2115.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2116.1">''</span></span><span class="koboSpan" id="kobo.2117.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2118.1">'django.contrib.auth.urls'</span></span><span class="koboSpan" id="kobo.2119.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2120.1">''</span></span><span class="koboSpan" id="kobo.2121.1">, views.dashboard, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2122.1">'dashboard'</span></span><span class="koboSpan" id="kobo.2123.1">),
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2124.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2125.1">'register/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2126.1">, views.register, name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2127.1">'register'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2128.1">),</span></strong></span><span class="koboSpan" id="kobo.2129.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2130.1">Finally, create</span><a id="_idIndexMarker422"/><span class="koboSpan" id="kobo.2131.1"> a new template in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2132.1">templates/account/</span></code><span class="koboSpan" id="kobo.2133.1"> template directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2134.1">account</span></code><span class="koboSpan" id="kobo.2135.1"> application, name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2136.1">register.html</span></code><span class="koboSpan" id="kobo.2137.1">, and make it look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2138.1">{% extends "base.html" %}
{% block title %}Create an account{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2139.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2140.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2141.1">&gt;</span></span><span class="koboSpan" id="kobo.2142.1">Create an account</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2143.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2144.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2145.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2146.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2147.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2148.1">&gt;</span></span><span class="koboSpan" id="kobo.2149.1">Please, sign up using the following form:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2150.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2151.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2152.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2153.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2154.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2155.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2156.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2157.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2158.1">&gt;</span></span><span class="koboSpan" id="kobo.2159.1">
    {{ user_form.as_p }}
    {% csrf_token %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2160.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2161.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2162.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2163.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2164.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2165.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2166.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2167.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2168.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2169.1">"Create my account"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2170.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2171.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2172.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2173.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2174.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2175.1">&gt;</span></span><span class="koboSpan" id="kobo.2176.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2177.1">Create an additional template file in the same directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2178.1">register_done.html</span></code><span class="koboSpan" id="kobo.2179.1">. </span><span class="koboSpan" id="kobo.2179.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2180.1">{% extends "base.html" %}
{% block title %}Welcome{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2181.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2182.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2183.1">&gt;</span></span><span class="koboSpan" id="kobo.2184.1">Welcome {{ new_user.first_name }}!</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2185.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2186.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2187.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2188.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2189.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2190.1">&gt;</span></span><span class="koboSpan" id="kobo.2191.1">
    Your account has been successfully created.
    </span><span class="koboSpan" id="kobo.2191.2">Now you can </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2192.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2193.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2194.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2195.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2196.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2197.1">login</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2198.1">" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2199.1">&gt;</span></span><span class="koboSpan" id="kobo.2200.1">log in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2201.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2202.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2203.1">&gt;</span></span><span class="koboSpan" id="kobo.2204.1">.
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2205.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2206.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2207.1">&gt;</span></span><span class="koboSpan" id="kobo.2208.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2209.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2210.1">http://127.0.0.1:8000/account/register/</span></code><span class="koboSpan" id="kobo.2211.1"> in your browser. </span><span class="koboSpan" id="kobo.2211.2">You will see the registration</span><a id="_idIndexMarker423"/><span class="koboSpan" id="kobo.2212.1"> page you have created:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2213.1"><img alt="" role="presentation" src="../Images/B21088_04_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2214.1">Figure 4.17: The account creation form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2215.1">Fill in the details</span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.2216.1"> for a new user and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2217.1">CREATE MY ACCOUNT</span></strong><span class="koboSpan" id="kobo.2218.1"> button.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2219.1">If all fields are valid, the user will be created, and you will see the following success message:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2220.1"><img alt="Graphical user interface, application, website  Description automatically generated" src="../Images/B21088_04_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2221.1">Figure 4.18: The account is successfully created page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2222.1">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2223.1">log in</span></strong><span class="koboSpan" id="kobo.2224.1"> link and enter your username and password to verify that you can access your newly created account.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2225.1">Let’s add a link to </span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.2226.1">register on the login template. </span><span class="koboSpan" id="kobo.2226.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2227.1">registration/login.html</span></code><span class="koboSpan" id="kobo.2228.1"> template and find the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2229.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2230.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2231.1">&gt;</span></span><span class="koboSpan" id="kobo.2232.1">Please, use the following form to log-in:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2233.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2234.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2235.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2236.1">Replace it with the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2237.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2238.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2239.1">&gt;</span></span><span class="koboSpan" id="kobo.2240.1">
  Please, use the following form to log-in.
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2241.1">If you don't have an account </span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2242.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2243.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2244.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2245.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2246.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2247.1">register</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2248.1">" %}"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2249.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2250.1">register here</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2251.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2252.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2253.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2254.1">.</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2255.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2256.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2257.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2258.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2259.1">http://127.0.0.1:8000/account/login/</span></code><span class="koboSpan" id="kobo.2260.1"> in your browser. </span><span class="koboSpan" id="kobo.2260.2">The page should now look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2261.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_04_19.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2262.1">Figure 4.19: The Log-in page including a link to register</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2263.1">We have now </span><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.2264.1">made the registration page accessible from the </span><strong class="screenText"><span class="koboSpan" id="kobo.2265.1">Log-in</span></strong><span class="koboSpan" id="kobo.2266.1"> page.</span></p>
<h2 class="heading-2" id="_idParaDest-154"><span class="koboSpan" id="kobo.2267.1">Extending the user model</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2268.1">While the user</span><a id="_idIndexMarker427"/><span class="koboSpan" id="kobo.2269.1"> model provided by Django’s authentication framework is sufficient for most typical scenarios, it does have a limited set of predefined fields. </span><span class="koboSpan" id="kobo.2269.2">If you want to capture additional details relevant to your application, you may want to extend the default user model. </span><span class="koboSpan" id="kobo.2269.3">For example, the default user model comes with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2270.1">first_name</span></code><span class="koboSpan" id="kobo.2271.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2272.1">last_name</span></code><span class="koboSpan" id="kobo.2273.1"> fields, a structure that may not align with naming conventions in various countries. </span><span class="koboSpan" id="kobo.2273.2">Additionally, you may want to store further user details or construct a more comprehensive user profile.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2274.1">A simple way to extend the user model is by creating a profile model that contains a one-to-one relationship with the Django user model, and any additional fields. </span><span class="koboSpan" id="kobo.2274.2">A one-to-one relationship is similar to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2275.1">ForeignKey</span></code><span class="koboSpan" id="kobo.2276.1"> field with the parameter </span><code class="inlineCode"><span class="koboSpan" id="kobo.2277.1">unique=True</span></code><span class="koboSpan" id="kobo.2278.1">. </span><span class="koboSpan" id="kobo.2278.2">The reverse side of the relationship is an implicit one-to-one relationship with the related model instead of a manager for multiple elements. </span><span class="koboSpan" id="kobo.2278.3">From each side of the relationship, you access a single related object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2279.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2280.1">models.py</span></code><span class="koboSpan" id="kobo.2281.1"> file of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.2282.1">account</span></code><span class="koboSpan" id="kobo.2283.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2284.1">from</span></span><span class="koboSpan" id="kobo.2285.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2286.1">import</span></span><span class="koboSpan" id="kobo.2287.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2288.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2289.1"> django.conf </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2290.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2291.1"> settings</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2292.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2293.1">Profile</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2294.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2295.1">    user = models.OneToOneField(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2296.1">        settings.AUTH_USER_MODEL,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2297.1">        on_delete=models.CASCADE</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2298.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2299.1">    date_of_birth = models.DateField(blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2300.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2301.1">, null=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2302.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2303.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2304.1">    photo = models.ImageField(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2305.1">        upload_to=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2306.1">'users/%Y/%m/%d/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2307.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2308.1">        blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2309.1">True</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2310.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2311.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2312.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2313.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2314.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2315.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2316.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2317.1">f'Profile of </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2318.1">{self.user.username}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2319.1">'</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2320.1">Our user profile </span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.2321.1">will include the user’s date of birth and an image of the user.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2322.1">The one-to-one field </span><code class="inlineCode"><span class="koboSpan" id="kobo.2323.1">user</span></code><span class="koboSpan" id="kobo.2324.1"> will be used to associate profiles with users. </span><span class="koboSpan" id="kobo.2324.2">We use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2325.1">AUTH_USER_MODEL</span></code><span class="koboSpan" id="kobo.2326.1"> to refer to the user model instead of pointing to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2327.1">auth.User</span></code><span class="koboSpan" id="kobo.2328.1"> model directly. </span><span class="koboSpan" id="kobo.2328.2">This makes our code more generic, as it can operate with custom-defined user models. </span><span class="koboSpan" id="kobo.2328.3">With </span><code class="inlineCode"><span class="koboSpan" id="kobo.2329.1">on_delete=models.CASCADE</span></code><span class="koboSpan" id="kobo.2330.1">, we force the deletion of the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.2331.1">Profile</span></code><span class="koboSpan" id="kobo.2332.1"> object when a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2333.1">User</span></code><span class="koboSpan" id="kobo.2334.1"> object gets deleted.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2335.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2336.1">date_of_birth</span></code><span class="koboSpan" id="kobo.2337.1"> field is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2338.1">DateField</span></code><span class="koboSpan" id="kobo.2339.1">. </span><span class="koboSpan" id="kobo.2339.2">We have made this field optional with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2340.1">blank=True</span></code><span class="koboSpan" id="kobo.2341.1">, and we allow </span><code class="inlineCode"><span class="koboSpan" id="kobo.2342.1">null</span></code><span class="koboSpan" id="kobo.2343.1"> values with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2344.1">null=True</span></code><span class="koboSpan" id="kobo.2345.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2346.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2347.1">photo</span></code><span class="koboSpan" id="kobo.2348.1"> field is an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2349.1">ImageField</span></code><span class="koboSpan" id="kobo.2350.1">. </span><span class="koboSpan" id="kobo.2350.2">We have made this field optional with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2351.1">blank=True</span></code><span class="koboSpan" id="kobo.2352.1">. </span><span class="koboSpan" id="kobo.2352.2">An </span><code class="inlineCode"><span class="koboSpan" id="kobo.2353.1">ImageField</span></code><span class="koboSpan" id="kobo.2354.1"> field manages the storage of image files. </span><span class="koboSpan" id="kobo.2354.2">It validates that the file provided is a valid image, stores the image file in the directory indicated with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2355.1">upload_to</span></code><span class="koboSpan" id="kobo.2356.1"> parameter, and stores the relative path to the file in the related database field. </span><span class="koboSpan" id="kobo.2356.2">An </span><code class="inlineCode"><span class="koboSpan" id="kobo.2357.1">ImageField</span></code><span class="koboSpan" id="kobo.2358.1"> field is translated to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2359.1">VARHAR(100)</span></code><span class="koboSpan" id="kobo.2360.1"> column in the database by default. </span><span class="koboSpan" id="kobo.2360.2">A blank string will be </span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.2361.1">stored if the value is left empty.</span></p>
<h2 class="heading-2" id="_idParaDest-155"><span class="koboSpan" id="kobo.2362.1">Installing Pillow and serving media files</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2363.1">We need to </span><a id="_idIndexMarker430"/><span class="koboSpan" id="kobo.2364.1">install the Pillow library to manage images. </span><span class="koboSpan" id="kobo.2364.2">Pillow </span><a id="_idIndexMarker431"/><span class="koboSpan" id="kobo.2365.1">is </span><a id="_idIndexMarker432"/><span class="koboSpan" id="kobo.2366.1">the</span><a id="_idIndexMarker433"/><span class="koboSpan" id="kobo.2367.1"> de facto standard library for image processing in Python. </span><span class="koboSpan" id="kobo.2367.2">It supports multiple image formats and provides powerful image processing functions. </span><span class="koboSpan" id="kobo.2367.3">Pillow is required by Django to handle images with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2368.1">ImageField</span></code><span class="koboSpan" id="kobo.2369.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2370.1">Install Pillow by running the following command from the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2371.1">python -m pip install Pillow==10.3.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2372.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2373.1">settings.py</span></code><span class="koboSpan" id="kobo.2374.1"> file of the project and add the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2375.1">MEDIA_URL = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2376.1">'media/'</span></span><span class="koboSpan" id="kobo.2377.1">
MEDIA_ROOT = BASE_DIR / </span><span class="hljs-string"><span class="koboSpan" id="kobo.2378.1">'media'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2379.1">This will enable Django to manage file uploads and serve media files. </span><code class="inlineCode"><span class="koboSpan" id="kobo.2380.1">MEDIA_URL</span></code><span class="koboSpan" id="kobo.2381.1"> is the base URL used to serve the media files uploaded by users. </span><code class="inlineCode"><span class="koboSpan" id="kobo.2382.1">MEDIA_ROOT</span></code><span class="koboSpan" id="kobo.2383.1"> is the local path where they reside. </span><span class="koboSpan" id="kobo.2383.2">Paths and URLs for files are built dynamically by prepending the project path or the media URL to them for portability.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2384.1">Now, edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.2385.1">urls.py</span></code><span class="koboSpan" id="kobo.2386.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2387.1">bookmarks</span></code><span class="koboSpan" id="kobo.2388.1"> project and modify the code, as follows. </span><span class="koboSpan" id="kobo.2388.2">The new lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2389.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2390.1"> django.conf </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2391.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2392.1"> settings</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2393.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2394.1"> django.conf.urls.static </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2395.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2396.1"> static</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2397.1">from</span></span><span class="koboSpan" id="kobo.2398.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2399.1">import</span></span><span class="koboSpan" id="kobo.2400.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2401.1">from</span></span><span class="koboSpan" id="kobo.2402.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2403.1">import</span></span><span class="koboSpan" id="kobo.2404.1"> path, include
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2405.1">'admin/'</span></span><span class="koboSpan" id="kobo.2406.1">, admin.site.urls),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2407.1">'account/'</span></span><span class="koboSpan" id="kobo.2408.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2409.1">'account.urls'</span></span><span class="koboSpan" id="kobo.2410.1">)),
]
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2411.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2412.1"> settings.DEBUG:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2413.1">    urlpatterns += static(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2414.1">        settings.MEDIA_URL,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2415.1">        document_root=settings.MEDIA_ROOT</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2416.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2417.1">We have added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2418.1">static()</span></code><span class="koboSpan" id="kobo.2419.1"> helper function to serve media files with the Django development</span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.2420.1"> server during</span><a id="_idIndexMarker435"/><span class="koboSpan" id="kobo.2421.1"> development (that is, when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2422.1">DEBUG</span></code><span class="koboSpan" id="kobo.2423.1"> setting</span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.2424.1"> is </span><a id="_idIndexMarker437"/><span class="koboSpan" id="kobo.2425.1">set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2426.1">True</span></code><span class="koboSpan" id="kobo.2427.1">).</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2428.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2429.1">static()</span></code><span class="koboSpan" id="kobo.2430.1"> helper function is suitable for development but not for production use. </span><span class="koboSpan" id="kobo.2430.2">Django is very inefficient at serving static files. </span><span class="koboSpan" id="kobo.2430.3">Never serve your static files with Django in a production environment. </span><span class="koboSpan" id="kobo.2430.4">You will learn how to serve static files in a production environment in </span><em class="chapterRef"><span class="koboSpan" id="kobo.2431.1">Chapter 17</span></em><span class="koboSpan" id="kobo.2432.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2433.1">Going Live</span></em><span class="koboSpan" id="kobo.2434.1">.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-156"><span class="koboSpan" id="kobo.2435.1">Creating migrations for the profile model</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2436.1">Let’s create the </span><a id="_idIndexMarker438"/><span class="koboSpan" id="kobo.2437.1">database table for the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2438.1">Profile</span></code><span class="koboSpan" id="kobo.2439.1"> model. </span><span class="koboSpan" id="kobo.2439.2">Open the shell and run the following command to create the database migration for the new model:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2440.1">python manage.py makemigrations
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2441.1">You will get the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2442.1">Migrations for 'account':
  account/migrations/0001_initial.py
    - Create model Profile
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2443.1">Next, sync the database with the following command in the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2444.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2445.1">You will see output that includes the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2446.1">Applying account.0001_initial... </span><span class="koboSpan" id="kobo.2446.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2447.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2448.1">admin.py</span></code><span class="koboSpan" id="kobo.2449.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2450.1">account</span></code><span class="koboSpan" id="kobo.2451.1"> application and register the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2452.1">Profile</span></code><span class="koboSpan" id="kobo.2453.1"> model in the administration site by adding the code in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2454.1">from</span></span><span class="koboSpan" id="kobo.2455.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2456.1">import</span></span><span class="koboSpan" id="kobo.2457.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2458.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2459.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2460.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2461.1"> Profile</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.2462.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2463.1">Profile</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.2464.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2465.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2466.1">ProfileAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2467.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2468.1">    list_display = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2469.1">'user'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2470.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2471.1">'date_of_birth'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2472.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2473.1">'photo'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2474.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2475.1">    raw_id_fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2476.1">'user'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2477.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2478.1">Run the development server using the following command from the shell prompt:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2479.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2480.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2481.1">http://127.0.0.1:8000/admin/</span></code><span class="koboSpan" id="kobo.2482.1"> in your browser. </span><span class="koboSpan" id="kobo.2482.2">Now, you should be able to see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2483.1">Profile</span></code><span class="koboSpan" id="kobo.2484.1"> model</span><a id="_idIndexMarker439"/><span class="koboSpan" id="kobo.2485.1"> on the administration site of your project, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2486.1"><img alt="" role="presentation" src="../Images/B21088_04_20.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2487.1">Figure 4.20: The ACCOUNT block on the administration site index page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2488.1">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2489.1">Add</span></strong><span class="koboSpan" id="kobo.2490.1"> link of the </span><strong class="screenText"><span class="koboSpan" id="kobo.2491.1">Profiles</span></strong><span class="koboSpan" id="kobo.2492.1"> row. </span><span class="koboSpan" id="kobo.2492.2">You will see the following form to add a new profile:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2493.1"><img alt="" role="presentation" src="../Images/B21088_04_21.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2494.1">Figure 4.21: The Add profile form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2495.1">Create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2496.1">Profile</span></code><span class="koboSpan" id="kobo.2497.1"> object manually for each of the existing users in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2498.1">Next, we will let users edit their profiles on the website.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2499.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2500.1">forms.py</span></code><span class="koboSpan" id="kobo.2501.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2502.1">account</span></code><span class="koboSpan" id="kobo.2503.1"> application and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2504.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2505.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2506.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2507.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2508.1"> Profile</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2509.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2510.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2511.1">UserEditForm</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2512.1">(forms.ModelForm):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2513.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2514.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2515.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2516.1">        model = get_user_model()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2517.1">        fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2518.1">'first_name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2519.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2520.1">'last_name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2521.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2522.1">'email'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2523.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2524.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2525.1">ProfileEditForm</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2526.1">(forms.ModelForm):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2527.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2528.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2529.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2530.1">        model = Profile</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2531.1">        fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2532.1">'date_of_birth'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2533.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2534.1">'photo'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2535.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2536.1">These forms</span><a id="_idIndexMarker440"/><span class="koboSpan" id="kobo.2537.1"> are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2538.1">UserEditForm</span></code><span class="koboSpan" id="kobo.2539.1">: This will allow users to edit their first name, last name, and email, which are attributes of the built-in Django user model.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2540.1">ProfileEditForm</span></code><span class="koboSpan" id="kobo.2541.1">: This will allow users to edit the profile data that is saved in the custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.2542.1">Profile</span></code><span class="koboSpan" id="kobo.2543.1"> model. </span><span class="koboSpan" id="kobo.2543.2">Users will be able to edit their date of birth and upload an image for their profile picture.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2544.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2545.1">views.py</span></code><span class="koboSpan" id="kobo.2546.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2547.1">account</span></code><span class="koboSpan" id="kobo.2548.1"> application and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.2549.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2550.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2551.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2552.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2553.1"> Profile</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2554.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2555.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2556.1">register</span></span><span class="koboSpan" id="kobo.2557.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2558.1">request</span></span><span class="koboSpan" id="kobo.2559.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2560.1">if</span></span><span class="koboSpan" id="kobo.2561.1"> request.method == </span><span class="hljs-string"><span class="koboSpan" id="kobo.2562.1">'POST'</span></span><span class="koboSpan" id="kobo.2563.1">:
        user_form = UserRegistrationForm(request.POST)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2564.1">if</span></span><span class="koboSpan" id="kobo.2565.1"> user_form.is_valid():
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2566.1"># Create a new user object but avoid saving it yet</span></span><span class="koboSpan" id="kobo.2567.1">
            new_user = user_form.save(commit=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2568.1">False</span></span><span class="koboSpan" id="kobo.2569.1">)
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2570.1"># Set the chosen password</span></span><span class="koboSpan" id="kobo.2571.1">
            new_user.set_password(
                user_form.cleaned_data[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2572.1">'password'</span></span><span class="koboSpan" id="kobo.2573.1">]
            )
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2574.1"># Save the User object</span></span><span class="koboSpan" id="kobo.2575.1">
            new_user.save()
            </span><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2576.1"># Create the user profile</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2577.1">Profile.objects.create(user=new_user)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2578.1">return</span></span><span class="koboSpan" id="kobo.2579.1"> render(
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.2580.1">request,
</span><span class="hljs-keyword"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.2581.1">'account/register_done.html'</span></span><span class="koboSpan" id="kobo.2582.1">,
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.2583.1">{</span><span class="hljs-string"><span class="koboSpan" id="kobo.2584.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2585.1">new_user'</span></span><span class="koboSpan" id="kobo.2586.1">: new_user}
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.2587.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2588.1">else</span></span><span class="koboSpan" id="kobo.2589.1">:
        user_form = UserRegistrationForm()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2590.1">return</span></span><span class="koboSpan" id="kobo.2591.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2592.1">'account/register.html'</span></span><span class="koboSpan" id="kobo.2593.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.2594.1">'user_form'</span></span><span class="koboSpan" id="kobo.2595.1">: user_form}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2596.1">When users register on the site, a corresponding </span><code class="inlineCode"><span class="koboSpan" id="kobo.2597.1">Profile</span></code><span class="koboSpan" id="kobo.2598.1"> object will be automatically created and associated</span><a id="_idIndexMarker441"/><span class="koboSpan" id="kobo.2599.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2600.1">User</span></code><span class="koboSpan" id="kobo.2601.1"> object created. </span><span class="koboSpan" id="kobo.2601.2">However, users created through the administration site won’t automatically get an associated </span><code class="inlineCode"><span class="koboSpan" id="kobo.2602.1">Profile</span></code><span class="koboSpan" id="kobo.2603.1"> object. </span><span class="koboSpan" id="kobo.2603.2">Both users with and without a profile (for example, staff users) can co-exist.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2604.1">If you want to force profile creation for all users, you can use Django signals to trigger the creation of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2605.1">Profile</span></code><span class="koboSpan" id="kobo.2606.1"> object whenever a user is created. </span><span class="koboSpan" id="kobo.2606.2">You will learn about signals in </span><em class="italic"><span class="koboSpan" id="kobo.2607.1">Chapter 7</span></em><span class="koboSpan" id="kobo.2608.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2609.1">Tracking User Actions</span></em><span class="koboSpan" id="kobo.2610.1">, where you will engage in an exercise to implement this feature in the section </span><em class="italic"><span class="koboSpan" id="kobo.2611.1">Expanding your project using AI</span></em><span class="koboSpan" id="kobo.2612.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2613.1">Now, we will let users edit their profiles.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2614.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2615.1">views.py</span></code><span class="koboSpan" id="kobo.2616.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2617.1">account</span></code><span class="koboSpan" id="kobo.2618.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2619.1">from</span></span><span class="koboSpan" id="kobo.2620.1"> django.contrib.auth </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2621.1">import</span></span><span class="koboSpan" id="kobo.2622.1"> authenticate, login
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2623.1">from</span></span><span class="koboSpan" id="kobo.2624.1"> django.contrib.auth.decorators </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2625.1">import</span></span><span class="koboSpan" id="kobo.2626.1"> login_required
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2627.1">from</span></span><span class="koboSpan" id="kobo.2628.1"> django.http </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2629.1">import</span></span><span class="koboSpan" id="kobo.2630.1"> HttpResponse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2631.1">from</span></span><span class="koboSpan" id="kobo.2632.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2633.1">import</span></span><span class="koboSpan" id="kobo.2634.1"> render
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2635.1">from</span></span><span class="koboSpan" id="kobo.2636.1"> .forms </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2637.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2638.1">(</span></strong></span><span class="koboSpan" id="kobo.2639.1">
    LoginForm,
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.2640.1">UserRegistrationForm</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2641.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2642.1">UserEditForm,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2643.1">ProfileEditForm</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2644.1">)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2645.1">from</span></span><span class="koboSpan" id="kobo.2646.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2647.1">import</span></span><span class="koboSpan" id="kobo.2648.1"> Profile
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2649.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.2650.1">@login_required</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2651.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2652.1">edit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2653.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2654.1">request</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2655.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2656.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2657.1"> request.method == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2658.1">'POST'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2659.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2660.1">        user_form = UserEditForm(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2661.1">            instance=request.user,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2662.1">            data=request.POST</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2663.1">        )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2664.1">        profile_form = ProfileEditForm(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2665.1">            instance=request.user.profile,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2666.1">            data=request.POST,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2667.1">            files=request.FILES</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2668.1">        )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2669.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2670.1"> user_form.is_valid() </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2671.1">and</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2672.1"> profile_form.is_valid():</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2673.1">            user_form.save()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2674.1">            profile_form.save()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2675.1">else</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2676.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2677.1">        user_form = UserEditForm(instance=request.user)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2678.1">        profile_form = ProfileEditForm(instance=request.user.profile)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2679.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2680.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2681.1">        request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2682.1">'account/edit.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2683.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2684.1">        {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2685.1">'user_form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2686.1">: user_form,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2687.1">'profile_form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2688.1">: profile_form</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2689.1">        }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2690.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2691.1">We have added the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2692.1">edit</span></code><span class="koboSpan" id="kobo.2693.1"> view to allow users to edit their personal information. </span><span class="koboSpan" id="kobo.2693.2">We have added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2694.1">login_required</span></code><span class="koboSpan" id="kobo.2695.1"> decorator to the view because only authenticated users will be able to edit their profiles. </span><span class="koboSpan" id="kobo.2695.2">For this view, we use two model forms: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2696.1">UserEditForm</span></code><span class="koboSpan" id="kobo.2697.1"> to store the data of the built-in user model and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2698.1">ProfileEditForm</span></code><span class="koboSpan" id="kobo.2699.1"> to store the additional personal data in the custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.2700.1">Profile</span></code><span class="koboSpan" id="kobo.2701.1"> model. </span><span class="koboSpan" id="kobo.2701.2">To validate the data submitted, we call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2702.1">is_valid()</span></code><span class="koboSpan" id="kobo.2703.1"> method of both forms. </span><span class="koboSpan" id="kobo.2703.2">If both forms contain valid data, we save both forms by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2704.1">save()</span></code><span class="koboSpan" id="kobo.2705.1"> method to update the corresponding objects in the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2706.1">Add the following </span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.2707.1">URL pattern to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2708.1">urls.py</span></code><span class="koboSpan" id="kobo.2709.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2710.1">account</span></code><span class="koboSpan" id="kobo.2711.1"> application:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2712.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2713.1">#...</span></span><span class="koboSpan" id="kobo.2714.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2715.1">''</span></span><span class="koboSpan" id="kobo.2716.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2717.1">'django.contrib.auth.urls'</span></span><span class="koboSpan" id="kobo.2718.1">)),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2719.1">''</span></span><span class="koboSpan" id="kobo.2720.1">, views.dashboard, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2721.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2722.1">dashboard'</span></span><span class="koboSpan" id="kobo.2723.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2724.1">'register/'</span></span><span class="koboSpan" id="kobo.2725.1">, views.register, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2726.1">'register'</span></span><span class="koboSpan" id="kobo.2727.1">),
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2728.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2729.1">'edit/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2730.1">, views.edit, name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2731.1">'edit'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2732.1">),</span></strong></span><span class="koboSpan" id="kobo.2733.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2734.1">Finally, create a template for this view in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2735.1">templates/account/</span></code><span class="koboSpan" id="kobo.2736.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2737.1">edit.html</span></code><span class="koboSpan" id="kobo.2738.1">. </span><span class="koboSpan" id="kobo.2738.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2739.1">{% extends "base.html" %}
{% block title %}Edit your account{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2740.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2741.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2742.1">&gt;</span></span><span class="koboSpan" id="kobo.2743.1">Edit your account</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2744.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2745.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2746.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2747.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2748.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2749.1">&gt;</span></span><span class="koboSpan" id="kobo.2750.1">You can edit your account using the following form:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2751.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2752.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2753.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2754.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2755.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2756.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2757.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2758.1">"post"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2759.1">enctype</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2760.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2761.1">"multipart/form-data"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2762.1">&gt;</span></span><span class="koboSpan" id="kobo.2763.1">
    {{ user_form.as_p }}
    {{ profile_form.as_p }}
    {% csrf_token %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2764.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2765.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2766.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2767.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2768.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2769.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2770.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2771.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2772.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2773.1">"Save changes"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2774.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2775.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2776.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2777.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2778.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2779.1">&gt;</span></span><span class="koboSpan" id="kobo.2780.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2781.1">In the preceding code, we have added </span><code class="inlineCode"><span class="koboSpan" id="kobo.2782.1">enctype="multipart/form-data"</span></code><span class="koboSpan" id="kobo.2783.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2784.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.2785.1"> HTML element to enable file uploads. </span><span class="koboSpan" id="kobo.2785.2">We use an HTML form to submit both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2786.1">user_form</span></code><span class="koboSpan" id="kobo.2787.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2788.1">profile_form</span></code><span class="koboSpan" id="kobo.2789.1"> forms.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2790.1">Open the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2791.1">http://127.0.0.1:8000/account/register/</span></code><span class="koboSpan" id="kobo.2792.1"> and register a new user. </span><span class="koboSpan" id="kobo.2792.2">Then, log in with the new user and open the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2793.1">http://127.0.0.1:8000/account/edit/</span></code><span class="koboSpan" id="kobo.2794.1">. </span><span class="koboSpan" id="kobo.2794.2">You should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2795.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_04_22.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2796.1">Figure 4.22: The profile edit form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2797.1">You can now</span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.2798.1"> add the profile information and save the changes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2799.1">We will edit the dashboard template to include links to the edit profile and change password pages.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2800.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2801.1">templates/account/dashboard.html</span></code><span class="koboSpan" id="kobo.2802.1"> template and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2803.1">{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2804.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2805.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2806.1">&gt;</span></span><span class="koboSpan" id="kobo.2807.1">Dashboard</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2808.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2809.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2810.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2811.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2812.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2813.1">&gt;</span></span><span class="koboSpan" id="kobo.2814.1">
    Welcome to your dashboard. </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2815.1">You can </span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2816.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2817.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2818.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2819.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2820.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2821.1">edit</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2822.1">" %}"&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2823.1">edit your profile</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2824.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2825.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2826.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2827.1"> or </span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2828.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2829.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2830.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2831.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2832.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2833.1">password_change</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2834.1">"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2835.1"> %}"&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2836.1">change your password</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2837.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2838.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2839.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2840.1">.</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2841.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2842.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2843.1">&gt;</span></span><span class="koboSpan" id="kobo.2844.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2845.1">Users can now access the form to edit their profile from the dashboard. </span><span class="koboSpan" id="kobo.2845.2">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2846.1">http://127.0.0.1:8000/account/</span></code><span class="koboSpan" id="kobo.2847.1"> in your browser and test the new link to edit a user’s profile. </span><span class="koboSpan" id="kobo.2847.2">The </span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.2848.1">dashboard should now look like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2849.1"><img alt="Graphical user interface  Description automatically generated with medium confidence" src="../Images/B21088_04_23.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2850.1">Figure 4.23: Dashboard page content, including links to edit a profile and change a password</span></p>
<h3 class="heading-3" id="_idParaDest-157"><span class="koboSpan" id="kobo.2851.1">Using a custom user model</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.2852.1">Django also offers a </span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.2853.1">way to substitute the user model with a custom model. </span><span class="koboSpan" id="kobo.2853.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2854.1">User</span></code><span class="koboSpan" id="kobo.2855.1"> class should inherit from Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2856.1">AbstractUser</span></code><span class="koboSpan" id="kobo.2857.1"> class, which provides the full implementation of the default user as an abstract model. </span><span class="koboSpan" id="kobo.2857.2">You can read more about this method at </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#substituting-a-custom-user-model"><span class="url"><span class="koboSpan" id="kobo.2858.1">https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#substituting-a-custom-user-model</span></span></a><span class="koboSpan" id="kobo.2859.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2860.1">Using a custom user model will give you more flexibility, but it might also result in more difficult integration</span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.2861.1"> with pluggable applications that interact directly with Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2862.1">auth</span></code><span class="koboSpan" id="kobo.2863.1"> user model.</span></p>
<h1 class="heading-1" id="_idParaDest-158"><span class="koboSpan" id="kobo.2864.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2865.1">In this chapter, you learned how to build an authentication system for your site. </span><span class="koboSpan" id="kobo.2865.2">You implemented all the necessary views for users to register, log in, log out, edit their password, and reset their password. </span><span class="koboSpan" id="kobo.2865.3">You also built a model to store custom user profiles.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2866.1">In the next chapter, you will improve the user experience by providing feedback on user’s actions through the Django messages framework. </span><span class="koboSpan" id="kobo.2866.2">You will also broaden the scope of authentication methods, enabling users to authenticate with their email address, and integrate social authentication via Google. </span><span class="koboSpan" id="kobo.2866.3">You will also learn how to serve the development server over HTTPS using Django Extensions, and you will customize the authentication pipeline to create user profiles automatically.</span></p>
<h1 class="heading-1" id="_idParaDest-159"><span class="koboSpan" id="kobo.2867.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2868.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2869.1">Source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter04"><span class="url"><span class="koboSpan" id="kobo.2870.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter04</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2871.1">Built-in authentication views: </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/default/#all-authentication-views"><span class="url"><span class="koboSpan" id="kobo.2872.1">https://docs.djangoproject.com/en/5.0/topics/auth/default/#all-authentication-views</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2873.1">Authentication URL patterns: </span><a href="https://github.com/django/django/blob/stable/3.0.x/django/contrib/auth/urls.py"><span class="url"><span class="koboSpan" id="kobo.2874.1">https://github.com/django/django/blob/stable/3.0.x/django/contrib/auth/urls.py</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2875.1">How Django manages passwords and available password hashers: </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/passwords/"><span class="url"><span class="koboSpan" id="kobo.2876.1">https://docs.djangoproject.com/en/5.0/topics/auth/passwords/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2877.1">Generic user model and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2878.1">get_user_model()</span></code><span class="koboSpan" id="kobo.2879.1"> method: </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#django.contrib.auth.get_user_model"><span class="url"><span class="koboSpan" id="kobo.2880.1">https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#django.contrib.auth.get_user_model</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2881.1">Using a custom user model: </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#substituting-a-custom-user-model"><span class="url"><span class="koboSpan" id="kobo.2882.1">https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#substituting-a-custom-user-model</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-160"><span class="koboSpan" id="kobo.2883.1">Join us on Discord!</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2884.1">Read this book alongside other users, Django development experts, and the author himself. </span><span class="koboSpan" id="kobo.2884.2">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more.Scan the QR code or visit the link to join the community.</span></p>
<p class="normal"><a href="https://packt.link/Django5ByExample"><span class="url"><span class="koboSpan" id="kobo.2885.1">https://packt.link/Django5ByExample</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2886.1"><img alt="" role="presentation" src="../Images/QR_Code287089408934129031.png"/></span></p>
</div>
</body></html>