<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-15"><a id="_idTextAnchor014"/>1</h1>
<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>Developing Trading Strategies – Why They Are Different</h1>
<p>For many years, I traded in various markets, educated developers in trading, and taught some essential programming and algorithm (algo) development to traders. Eventually, I concluded that the main problem for both groups (the developers and traders) was not a lack of knowledge in programming, but an incorrect or insufficient understanding of the subject domain, that is, financial markets and their mechanics.</p>
<p>This was quite a surprise for me. I thought that coding, debugging, and handling errors should be the main obstacle, but in reality, the problem is in finding useful, correct, and adequate information about markets, their structure, and operations, especially in regard to algo trading. I don’t mean that it’s somehow undisclosed or otherwise hidden from the general audience – not at all. The problem is that it’s really hard to find a source that not only covers everything – from the market structure to money and risk management – but also shows clear connections between very specific features of a market and less-specific features that a trading algorithm should have in order to be successful in this market.</p>
<p>For example, many authors consider entries and exits in a trading strategy as something that can be executed immediately and with equal success at any moment, any time of the day. However, in the real market, this is not the case. I saw lots of strategies that only worked <em class="italic">on paper</em> because their developers didn’t take into consideration the fact that they were dealing with a real, complex structure with lots of limitations and shortcomings, and not with an abstract idealistic model.</p>
<p>This example is really primitive, but I hope it explains the most important point that is missed by many researchers and developers: we do not deal with abstract datasets and time series where each data point has an equal value and where any action can be taken at any moment with equal possibility; we work with a very complex structure that has lots of features that make this structure a <em class="italic">dynamic non-stationary system</em>. And to be successful in algo trading, these features should be accounted for.</p>
<p>Without knowing how markets are organized and how they operate, our trading algorithms will inevitably fail sooner or later.</p>
<p>If put in a more positive manner, understanding the market will help us in making trading algorithms more robust.</p>
<p>This book is my humble attempt to bridge the gap between the world of quantitative trading (driven by numbers) and the real market (driven by humans). I am convinced that today, any long-term success in trading can be achieved only with good knowledge of both.</p>
<p>Let’s begin with the basics. We will learn about the very basic market terminology and the essential concept of a trading strategy, get familiar with the risk in various forms and aspects with a special focus on ordering and transactional risk, and also mention market data processing in a very general sense.</p>
<p>In this chapter, we will discuss the following topics:</p>
<ul>
<li>Trading strategies – it’s all about how you manage risk</li>
<li>Automated trading – operational risk and regulatory limitations</li>
<li>Making actual trading decisions – trading logic and credit risk</li>
<li>Ordering – transactional risk</li>
<li>The general architecture of a trading application</li>
</ul>
<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Trading strategies – it’s all about how you manage risk</h1>
<p>Let’s start from the beginning by giving definitions. I know it sounds like an academic textbook, but I promise that it’s going to get more and more interesting very quickly.</p>
<p>According to <a id="_idIndexMarker000"/>Investopedia (<a href="https://www.investopedia.com/terms/t/trade.asp">https://www.investopedia.com/terms/t/trade.asp</a>), <strong class="bold">trade</strong> is “<em class="italic">the voluntary exchange of goods or services between different economic actors</em>.” This means that if I exchange <a id="_idIndexMarker001"/>my money for meat or vegetables, then I am at a grocery market. If I exchange my money for obligations to buy or sell live cattle or wheat in the future, then I am in a derivatives market. And if I exchange my money for another type of money, I am in the <strong class="bold">foreign exchange</strong>, <strong class="bold">forex or </strong><strong class="bold">FX market</strong>.</p>
<p>What I buy and sell in a particular market is called an <strong class="bold">asset</strong>. If I buy or sell something that can be <a id="_idIndexMarker002"/>delivered (wheat, gold, stocks, or even money) it’s called the <strong class="bold">underlying</strong>. If I buy or sell an <a id="_idIndexMarker003"/>obligation or the right to buy or sell the underlying at a certain price in the future, then it’s called a <strong class="bold">derivative</strong>.</p>
<p>Underlying and derivatives are traded at <strong class="bold">trading venues</strong> – previously, physical locations such as <a id="_idIndexMarker004"/>exchanges, but today, more electronic networks where traders, liquidity providers, market makers, and other market participants match their orders.</p>
<p>If I went to a grocery market to sell potatoes, then I am on the <strong class="bold">sell side</strong>. If I came to buy potatoes, I am on the <strong class="bold">buy side</strong>. In financial markets, buy-side market participants are mostly referred to as <strong class="bold">price takers</strong> (because they can only take prices offered by the sell side), and <a id="_idIndexMarker005"/>sell-side market participants <a id="_idIndexMarker006"/>are referred to as <strong class="bold">price givers</strong>.</p>
<p>Not all trading venues welcome everyone as a direct participant. Most of them work via a network of <strong class="bold">brokers</strong> – entities that accept orders from their clients and route them to one or more trading venues, possibly internally netting client positions and sometimes even acting as the counterparty for their clients.</p>
<p>In <a href="B19145_03.xhtml#_idTextAnchor044"><em class="italic">Chapter 3</em></a>, <em class="italic">FX Market Overview from a Developer’s Standpoint</em>, we will consider all these entities in more detail to see why we should pay particular attention to their behavior and how to actually use them to make our trading strategies more robust.</p>
<p>Let’s proceed with a very quick look into the essence of a trading strategy and see the main risks that are natural to the systematic or algo trading business.</p>
<h2 id="_idParaDest-18"><a id="_idTextAnchor017"/>Trading strategies – how we make money in financial markets</h2>
<p>A trading strategy is a set of <a id="_idIndexMarker007"/>rules that tells me when to buy and when to sell the asset if I am on the buy side, or when and how much to offer to the market if I am on the sell side. But in any case, <em class="italic">the ultimate goal of a trading strategy is to </em><em class="italic">make money</em>.</p>
<p>If I am on the buy side, I can make money only in the following two ways:</p>
<ul>
<li>I buy low and I sell high, or vice versa (earning on the price difference)</li>
<li>I buy and receive dividends</li>
</ul>
<p>The former is called <strong class="bold">active trading</strong>, and the latter is <a id="_idIndexMarker008"/>normally called <strong class="bold">investing</strong>, or getting <a id="_idIndexMarker009"/>passive income. In this book, we will consider only active trading.</p>
<p>There are two major classes of active trading strategies on the buy side. The first one is called <strong class="bold">directional trading</strong> and in <a id="_idIndexMarker010"/>essence, it’s when we buy, wait, and sell. If we manage to sell at a price greater <a id="_idIndexMarker011"/>than the price at which we bought, we make money.</p>
<p>The second class <a id="_idIndexMarker012"/>of buy-side trading strategies is <strong class="bold">arbitrage</strong>. Such a strategy identifies moments when the same <a id="_idIndexMarker013"/>asset is priced differently at different trading venues (so-called <em class="italic">real</em> or <em class="italic">pure</em> arbitrage), or when there is a tradable difference between the price of the underlying and a derivative, different derivatives, or even more complex setups that <a id="_idIndexMarker014"/>consist of multiple instruments (so-called <strong class="bold">statistical arbitrage</strong> or <strong class="bold">stat arb</strong>).</p>
<p>Sounds a bit overwhelming? Don’t worry, we will now consider each case in more detail.</p>
<h2 id="_idParaDest-19"><a id="_idTextAnchor018"/>Trading app – what can be simpler?</h2>
<p>At this point, if you have sufficient experience in application development and a reasonable knowledge of markets, you might exclaim the following:</p>
<p>“<em class="italic">Why do we need all this? It is so easy to build a trading application: you only need to get market data, calculate entry and exit orders, and send them to </em><em class="italic">the broker!</em>”</p>
<p>So, the suggested general <a id="_idIndexMarker015"/>architecture of a trading application from that standpoint may look as simple as this:</p>
<div><div><img alt="Figure 1.1 – Initial architecture of a trading application" src="img/B19145_1_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Initial architecture of a trading application</p>
<p>However, as we will see very soon, this is an overly simplified view and it lacks at least one key feature that makes developing trading strategies different from developing other applications: it doesn’t include risk management.</p>
<h2 id="_idParaDest-20"><a id="_idTextAnchor019"/>So, what about that risk?</h2>
<p>Before discussing ways to make money in trading, let’s first pay closer attention to avoiding losses – at least because according to all statistics, more than 70% of active traders, unfortunately, lose money.</p>
<p>Before we proceed, let me note that the following classification of risks does not fully correspond to official legal and academic classifications. This informal classification is used here for the sake of simplicity, to sort out rather complex matters quickly and with an acceptable degree of comfort.</p>
<p>All risks in active trading can be generally put into three major categories, as follows:</p>
<ul>
<li><strong class="bold">Operational risks</strong> are those <a id="_idIndexMarker016"/>associated with how you <a id="_idIndexMarker017"/>place trades and depend on your own business procedures as well as third parties, such as brokers, trading venues, and regulators.</li>
<li><strong class="bold">Systemic risks</strong> are those <a id="_idIndexMarker018"/>pertaining to the very <a id="_idIndexMarker019"/>market itself and the logic of a trading strategy.</li>
<li><strong class="bold">Transactional risks</strong> are those <a id="_idIndexMarker020"/>that make the execution <a id="_idIndexMarker021"/>of orders different from expectations; this is the main reason why many strategies that work <em class="italic">on paper</em> are unable to make money in reality.</li>
</ul>
<p>Now that we are a bit more familiar with the idea of a trading strategy and know that the main problem any systematic trader should solve is risk mitigation, let’s dive a little deeper into risks specific to the algo trading business.</p>
<h1 id="_idParaDest-21"><a id="_idTextAnchor020"/>Automated trading – operational risk and regulatory limitations</h1>
<p>Operational risk is the risk of direct or indirect loss resulting from inadequate or failed internal procedures, <a id="_idIndexMarker022"/>people, and systems, or from external events (Bank for International Settlements, <em class="italic">Basel Committee on Banking Supervision</em>, <em class="italic">Operational Risk Supporting Documentation to the New Basel Capital Accord</em> (Basel: BIS, 2002), p. 2, <a href="https://www.bis.org/publ/bcbsca07.pdf">https://www.bis.org/publ/bcbsca07.pdf</a>).</p>
<p>Since, in this book, we will talk mostly about developing trading algos with Python and not about running a trading business, the main operational risk in this context could be that you don’t follow your <a id="_idIndexMarker023"/>own strategy or intervene in the algorithmic trading process discretionarily.</p>
<p>Another risk that may be considered operational (although it is normally considered as money management) is the improper use of leverage. In essence, leverage is a credit line provided by the broker that allows you to buy more than you have in your account. If the leverage is too high, you are at risk of being unable to enter the market, or in certain cases, even worse – liquidating your positions that are rapidly losing money.</p>
<p>Broker risk can also be attributed to operational risks as the broker is the very entity that provides you <a id="_idIndexMarker024"/>with access to the market, gives you a credit line to open positions, and does the clearing and settlement. Some brokers also act as market makers for their clients, netting their positions internally and acting as the counterparty for their own clients, which may lead to a conflict of interest, and even worse – loss of money if the broker didn’t have sufficient capital to perform these operations.</p>
<p>Last, but not least, we should note that algorithmic and/or automated trading may be fully or partially prohibited <a id="_idIndexMarker025"/>in certain jurisdictions. So always check with the respective market regulators to make sure you can run your algo trading at all.</p>
<p class="callout-heading">Key takeaways</p>
<p class="callout">Always perform a background check of all counterparties, especially your broker. Be careful with leverage and check local regulatory documents on algo trading.</p>
<p>Enough on operational risk – at least for a quick start – and let’s move on to another kind of risk that is common for any trading activity but becomes particularly problematic for algo trading: the risk of basing trading decisions on incorrect market data.</p>
<h1 id="_idParaDest-22"><a id="_idTextAnchor021"/>Retrieving market data – quality and consistency as keys to success</h1>
<p>Market data is often <a id="_idIndexMarker026"/>considered something that cannot contribute to the overall risk in systematic trading. However, this is a massive mistake. There are two key risks associated with market data:</p>
<ul>
<li>Issues with receiving data</li>
<li>Issues with received data</li>
</ul>
<p>In the next two subsections, we will dive deeper into the preceding risks.</p>
<h2 id="_idParaDest-23"><a id="_idTextAnchor022"/>Receiving data – when size does matter</h2>
<p>There are two forms in which we get market data: real-time or historical. In both cases, we obtain it from a data <a id="_idIndexMarker027"/>vendor, a broker, or directly from an exchange. The difference is that real-time data is used for actual trading (as it reflects what is going on in the market right now) and historical data is used only for research and development, to rebuild hypothetical trades and estimate the theoretical performance of a trading algorithm.</p>
<p>The issues with receiving data are mostly related to real-time data.</p>
<p>Let’s now add some more definitions as we need to acquire some common terminology to move on with market data and ordering.</p>
<p>A request to buy <a id="_idIndexMarker028"/>an asset at a certain price is called a <strong class="bold">bid</strong>. It’s like you go to a market and shout, “<em class="italic">I want to buy this asset at this price. Is anyone willing to sell it </em><em class="italic">to me?</em>”</p>
<p>A request to sell an asset at a certain price is called an <strong class="bold">ask</strong> or <strong class="bold">offer</strong>. It means that you are ready to sell it to anyone willing to accept your price.</p>
<p>In financial markets, both requests are realized by buy side traders with a <strong class="bold">limit order</strong> (see <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a>, <em class="italic">Types of Orders and Their Simulation in Python</em>, for a detailed discussion on types of orders).</p>
<p>When another counterparty agrees to place a trade at the order price, a new trade is registered and its information is included in the data stream and distributed across data vendors, brokers, and <a id="_idIndexMarker029"/>other recipients. Such a record is called a <strong class="bold">tick</strong>. In other words, a tick is a minimal piece of information in the market data and normally consists of the following fields:</p>
<ul>
<li><code>date</code></li>
<li><code>time</code></li>
<li><code>price</code></li>
<li><code>traded volume</code></li>
<li><code>counterparty1</code></li>
<li><code>counterparty2</code></li>
</ul>
<p>The last two fields contain information about actual counterparties and are normally not disclosed or <a id="_idIndexMarker030"/>distributed to protect the market participants. Traded volume means the amount of the asset that was traded (number of contracts, or just the amount of money if we are talking about forex).</p>
<p>The main problem with receiving market data in its raw form is that it’s simply overwhelmingly huge. There are so many market participants and so many trading venues that streaming all transactions for just one asset (which is also called a “financial instrument”) may easily reach megabytes per second – receiving it is already a challenge by itself (don’t worry, we are not going to work with data feeds of this sort in this book). Next, even if we are able to receive a data stream with such a throughput, we need to store and handle this data somehow, and thus a very fast database is required. And finally, we need to be able to process this amount of data at an adequate speed, so we need blazingly fast computers.</p>
<p>But there is good news. Despite some strategies (mostly arbitrage and high-frequency trading), we do need raw market data in the format just described (also frequently referred to as <strong class="bold">time and sales</strong> data) to identify trading opportunities, as most directional trading <a id="_idIndexMarker031"/>algorithms are far less sensitive to a lack of information about each and every trade. So, data vendors provide data in a compressed format. This becomes possible because most of the raw market data contains sequences of ticks with identical prices, and removing them won’t distort the price movements. This happens because there may be many market participants placing trades at the same price at almost the same time, so by excluding these sequences, we lose information about each transaction but retain information about any change in price. Such a market data stream is often referred to as <em class="italic">filtered</em> or <em class="italic">cleaned</em>. Besides that, some trades are made at bids, others at asks, and while both bids and asks remain the same, these trades form sequences of trades where prices seem to be different. However, in reality, they are always at the distance of the difference between bids and asks. This difference doesn’t <a id="_idIndexMarker032"/>mean that the market price changes. Such a phenomenon is called a <strong class="bold">bounce</strong> and is normally also excluded from cleaned data.</p>
<p>Some vendors and brokers go even further and send <em class="italic">snapshots</em> of the market data instead of a <a id="_idIndexMarker033"/>filtered data stream. A snapshot is sent at regular time intervals, for example, 100 ms or 1 s, and contains only the following information:</p>
<ul>
<li>Date</li>
<li>Time</li>
<li>Price at the beginning of the interval (also known as <em class="italic">open</em>, or just <em class="italic">O</em>)</li>
<li>Maximum price during the interval (also known as <em class="italic">high</em>, or <em class="italic">H</em>)</li>
<li>Minimum price during the interval (also known as <em class="italic">low</em>, or <em class="italic">L</em>)</li>
<li>Price at the end of the interval (also known as <em class="italic">close</em>, or <em class="italic">C</em>)</li>
<li>Traded volume</li>
</ul>
<p>Therefore, instead of thousands of ticks, we receive only one tick with seven data fields. This approach dramatically reduces the throughput but is obviously somewhat destructive to the data, and snapshot data may not be suitable for some strategies.</p>
<p class="callout-heading">Key takeaway</p>
<p class="callout">Be careful with choosing the source of data, especially for live trading, and always make sure it contains sufficient information for your strategy.</p>
<h2 id="_idParaDest-24"><a id="_idTextAnchor023"/>Received data – looking at it from a critical angle</h2>
<p>After we have <a id="_idIndexMarker034"/>successfully received the data, we should make sure it makes sense. Often, data, especially tick data, contains erroneous prices. These prices may be received due to a number of reasons, which we will discuss in detail in <a href="B19145_05.xhtml#_idTextAnchor086"><em class="italic">Chapter 5</em></a>, <em class="italic">Retrieving and Handling Market Data </em><em class="italic">with Python</em>.</p>
<p><em class="italic">Erroneous</em>, otherwise known as <em class="italic">non-market</em>, prices may cause trouble for systematic traders because a single <em class="italic">wrong</em> quote may trigger an algorithm to buy or sell something, and such a trade should not have happened according to the strategy logic.</p>
<p>Sometimes, these incorrect quotes can be seen if plotted on a chart. The human eye intuitively expects <a id="_idIndexMarker035"/>data points to be within a certain reasonable range and easily catches the outliers, as can be seen in the following chart:</p>
<div><div><img alt="Figure 1.2 – Non-market prices seen on a tick chart" src="img/B19145_1_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Non-market prices seen on a tick chart</p>
<p>In case we receive snapshots or other compressed data, there could be missing intervals when we receive no quotes. It can happen because of the following:</p>
<ul>
<li>The market is closed (scheduled or due to an emergency)</li>
<li>The data server is down</li>
<li>The connection is broken</li>
</ul>
<p class="callout-heading">Key takeaway</p>
<p class="callout">A robust trading app should have a module capable of checking data consistency and connection persistence.</p>
<p>Alright, we are <a id="_idIndexMarker036"/>now aware of the operational risks and know how harmful incorrectly handling market data could be. Anything else? Of course, here comes the main risk: systemic.</p>
<h1 id="_idParaDest-25"><a id="_idTextAnchor024"/>Making actual trading decisions – trading logic and credit risk</h1>
<p>In directional trading, systemic risks are mostly realized when you or your trading strategy supposed the <a id="_idIndexMarker037"/>price would go in one direction, but in reality, it went in the opposite direction. Don’t worry, this situation is absolutely normal for systematic trading, and no one can guarantee that any strategy will generate a win rate of 100%.</p>
<p>There are two major <a id="_idIndexMarker038"/>types of trading strategies: data-driven and event-driven. <strong class="bold">Data-driven</strong> strategies analyze the price time series (which we discussed <a id="_idIndexMarker039"/>in the <em class="italic">Retrieving market data – quality and consistency as keys to success</em> section) in order to find a certain pattern or sequence that then triggers an order. Event-driven strategies wait for a certain event to happen – for example, a <a id="_idIndexMarker040"/>new tick at a certain price and with a certain volume, or a release of political news or economic indicators. In both cases, a trading app should have rules to not only open positions but also to liquidate them – again, based on price data or events (or both).</p>
<p>In general, if a strategy generates <em class="italic">some</em> wins and <em class="italic">some</em> losses, there are only two ways for it to make money:</p>
<ul>
<li>Generate more wins than losses</li>
<li>Have the average win greater than the average loss</li>
</ul>
<p>If your trading algorithm does not have a routine that handles situations when the market goes against the position, then most likely, the average loss across a statistically significant number of trades will be greater than the average win, and it will become really problematic to make money with such a strategy.</p>
<p>Don’t forget that forex is traded using leverage, which means the ability to trade much greater amounts of money than you actually have in your account. In the case that your trading algorithm has poor risk management logic and incorrect position sizing, an open position may quickly drain your account to zero if the price goes the opposite way, and even worse – some brokers will even let you go negative and you will be left with debt instead of profit.</p>
<p class="callout-heading">Key takeaway</p>
<p class="callout">Systemic risk management and position sizing algorithms are crucial parts of an algo trading application.</p>
<p>Systemic risk is very important, but there’s good news for systematic traders: it is possible to mitigate <a id="_idIndexMarker041"/>this risk by carefully testing the strategy before going to production and adjusting it so the systemic risk is minimized. But there is one more risk that is hard to mitigate during the research and development phase: transactional risk.</p>
<h1 id="_idParaDest-26"><a id="_idTextAnchor025"/>Ordering – transactional risk</h1>
<p>Transactional risks are <a id="_idIndexMarker042"/>the real problem in the first place for arbitrage, but they also affect directional strategies. In simple terms, this is a risk of the following:</p>
<ul>
<li>Entering or exiting the market at a wrong price</li>
<li>Entering or exiting the market at a wrong time</li>
<li>Entering or exiting the market with a wrong trading size</li>
<li>Not entering or exiting the market at all</li>
</ul>
<p>All four situations are more than possible in all markets and are even quite frequent during periods of insufficient liquidity (see <a href="B19145_03.xhtml#_idTextAnchor044"><em class="italic">Chapter 3</em></a>, <em class="italic">FX Market Overview from a Developer’s Standpoint</em>, for a more detailed discussion of liquidity issues).</p>
<p class="callout-heading">Key takeaway</p>
<p class="callout">Transactional risks are managed by a set of algorithms that are also an essential part of any trading application.</p>
<p>Well, it’s been quite a <a id="_idIndexMarker043"/>trip across the various risks, and we now understand that the initial idea of a trading application with a simple and straightforward linear logic definitely won’t work in real life. Now, we can suggest something (unfortunately) more complex, but (fortunately) more realistic.</p>
<h1 id="_idParaDest-27"><a id="_idTextAnchor026"/>The general architecture of a trading application</h1>
<p>Now, we can improve <a id="_idIndexMarker044"/>our initial diagram (see <em class="italic">Figure 1</em><em class="italic">.1</em>) representing the architecture of a trading application. Although it is still very general and high level, it now radically differs from what we suggested in the beginning:</p>
<div><div><img alt="Figure 1.3 – More complete general architecture of a trading app" src="img/B19145_1_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – More complete general architecture of a trading app</p>
<p>Here, we can see that the real trading application features a number of blocks or modules, and some of them receive feedback from others. After we have received market data, we should clean it up and add storage and retrieval facilities, as pieces of data may be reused in the following code. Then, we generate trading signals according to the strategy logic. But before sending these signals to the market in the form of orders, we should do some checks to make sure that the order size is comfortable for both the strategy <a id="_idIndexMarker045"/>and the market. After that, we actually trade – send orders to the market controlling their execution. And finally, we track the open positions and manage exposure according to the running profit or loss.</p>
<h1 id="_idParaDest-28"><a id="_idTextAnchor027"/>Summary</h1>
<p>In this chapter, we familiarized ourselves with the core terminology and key concepts of FX markets, learned about counterparties and transactions, understood the intrinsic issues with market data, reviewed various risks, and drafted the first mockup of a trading application’s architecture. We now know that a robust trading app is more about risk management, checking various situations that may happen in real life before and after the trade, and making corrections on the fly. This is what makes the development of trading apps different.</p>
<p>In the next chapter, let us see how using Python in algo trading helps improve the research and development of trading applications.</p>
</div>
</body></html>