<html><head></head><body>
  <div id="_idContainer267">
    <h1 class="chapterNumber">16</h1>
    <h1 id="_idParaDest-438" class="chapterTitle">Packaging with setuptools and cxFreeze</h1>
    <p class="normal">Word of your application has spread throughout the ABQ corporation, and you've been asked to provide it for use at other facilities. Unfortunately, running and installing the application is not a very friendly process; you've been installing it through a tedious and error-prone copy-and-paste procedure, and users launch it from a batch or shell script you create by hand on each machine. You need to package your application in a professional way that makes it easy to install and run across Windows, macOS, and Linux.</p>
    <p class="normal">In this chapter, you will learn the following topics:</p>
    <ul>
      <li class="bullet">In <em class="italic">Creating distributable packages with setuptools</em>, you'll learn to create distributable Python source and <code class="Code-In-Text--PACKT-">wheel</code> packages using the <code class="Code-In-Text--PACKT-">setuptools</code> library.</li>
      <li class="bullet">In <em class="italic">Creating executables with cx_Freeze</em>, you'll learn to create a standalone executable of your application, including specific instructions for Windows and macOS.</li>
    </ul>
    <h1 id="_idParaDest-439" class="title">Creating distributable packages with setuptools</h1>
    <p class="normal">The <a id="_idIndexMarker1557"/>distribution<a id="_idIndexMarker1558"/> process has often been cited as a major shortcoming for Python; it is an area with a storied history of ever-evolving tools and approaches, often caught between the vestiges of the past and competing visions of the future. </p>
    <p class="normal">That said, it works surprisingly well, as evidenced by the ease with which we have installed components using <code class="Code-In-Text--PACKT-">pip</code> throughout this book. The aim of this section is to cut through some of the confusion and provide you with a process that respects both traditional approaches and future trends.</p>
    <p class="normal">The standard library contains the <code class="Code-In-Text--PACKT-">distutils</code> library, a collection of functionalities related to packaging and distributing Python code. However, both the <code class="Code-In-Text--PACKT-">distutils</code> documentation (<a href="https://docs.python.org/3/library/distutils.html"><span class="url">https://docs.python.org/3/library/distutils.html</span></a>) and the official packaging guide recommend against using it and instead direct you to use <code class="Code-In-Text--PACKT-">setuptools</code>.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">setuptools</code> library is an extension of the <code class="Code-In-Text--PACKT-">distutils</code> library that adds some important functionality such as dependency handling, bundling non-Python files, and generation of executables. Although <code class="Code-In-Text--PACKT-">setuptools</code> is not part of the standard library, it is included in the official Python distributions for Windows and macOS, and is readily available from the package repositories of most Linux distributions. <code class="Code-In-Text--PACKT-">setuptools</code> is used by the <code class="Code-In-Text--PACKT-">pip</code> package installer, and we can use it to create packages that can be installed on any <a id="_idIndexMarker1559"/>system <a id="_idIndexMarker1560"/>with Python and <code class="Code-In-Text--PACKT-">pip</code>.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">If you want to create packages that can be uploaded to PyPI, <code class="Code-In-Text--PACKT-">setuptools</code> is what you need. For more information about preparing and uploading packages to PyPI, see the official Python packaging guide at <a href="https://packaging.python.org"><span class="url">https://packaging.python.org</span></a>.</p>
    </div>
    <h2 id="_idParaDest-440" class="title">Preparing our package for distribution</h2>
    <p class="normal">Although the<a id="_idIndexMarker1561"/> restructuring of our project directory we did in <em class="chapterRef">Chapter 6</em>, <em class="italic">Planning for the Expansion of Our Application</em>, left us in fairly good shape for packaging our application, there are a few minor additions and changes we need to make for our Python package to be a good citizen as a distributed package. Let's go through what those are.</p>
    <h3 id="_idParaDest-441" class="title">Creating a requirements.txt file</h3>
    <p class="normal">The <code class="Code-In-Text--PACKT-">requirements.txt</code> file<a id="_idIndexMarker1562"/> is a<a id="_idIndexMarker1563"/> plaintext file, typically placed in the application root directory, that lists all the third-party modules that we used to develop our application. Although not used by <code class="Code-In-Text--PACKT-">setuptools</code>, this file can be used by <code class="Code-In-Text--PACKT-">pip</code> to install a package's dependencies.</p>
    <p class="normal">Create a <code class="Code-In-Text--PACKT-">requirements.txt</code> file that contains the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># requirements.txt</span>
--index-url https://pypi.python.org/simple/
<span class="hljs-comment"># Runtime:</span>
Requests
Paramiko
psycopg2
matplotlib
<span class="hljs-comment"># for testing REST:</span>
flask
</code></pre>
    <p class="normal">The first line of the file specifies the index from which we want to install packages; strictly speaking, this line isn't necessary since PyPI will be used by default. However, we can override this URL if we want to use a different package index; for example, if ABQ decided to create its own private Python package index for security reasons, we could redirect <code class="Code-In-Text--PACKT-">pip</code> to that server instead.</p>
    <p class="normal">Next, we've specified runtime requirements. Our application depends on four external libraries: <code class="Code-In-Text--PACKT-">requests</code>, <code class="Code-In-Text--PACKT-">paramiko</code>, <code class="Code-In-Text--PACKT-">psycopg2</code>, and <code class="Code-In-Text--PACKT-">matplotlib</code>, and these are simply specified one per line. Note that we can also add comments to the file by beginning a line with a <code class="Code-In-Text--PACKT-">#</code> sign.</p>
    <p class="normal">Finally, we've included <code class="Code-In-Text--PACKT-">flask</code> as a requirement, which is not used by the application but was required by the test service we used for REST. It might seem odd to include these kinds of<a id="_idIndexMarker1564"/> requirements, but<a id="_idIndexMarker1565"/> the purpose of the <code class="Code-In-Text--PACKT-">requirements.txt</code> file is to make it simple for other developers (including your future self) to reproduce the development environment for this application. You might choose to place non-runtime requirements like this in a separate file, for example, <code class="Code-In-Text--PACKT-">requirements.development.txt</code> or <code class="Code-In-Text--PACKT-">requirements.testing.txt.</code></p>
    <p class="normal">This file can then be used to direct <code class="Code-In-Text--PACKT-">pip</code> to install these dependencies using the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> pip install -r requirements.txt
</code></pre>
    <p class="normal">This command causes <code class="Code-In-Text--PACKT-">pip</code> to read through the file one line at a time to install the dependencies. For each dependency, <code class="Code-In-Text--PACKT-">pip</code> will first check to see if the package is already installed; if not, it will install the latest version of the package from the specified package index.</p>
    <p class="normal">This presents a small problem, though; what if our code depends on a newer version of the package than the user has installed on their system? Or, what if an incompatible change in a newer version of a library requires that we run an older version than the latest in the index?</p>
    <p class="normal">To address this, we can include version specifier strings in <code class="Code-In-Text--PACKT-">requirements.txt</code>, like so:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># These are examples, don't include this in our requirements.txt</span>
requests==<span class="hljs-number">2.26.0</span>
paramiko&gt;=<span class="hljs-number">2.6</span>
psycopg2&lt;<span class="hljs-number">3.0</span>
matplotlib&gt;<span class="hljs-number">3.2</span>,&lt;=<span class="hljs-number">3.3</span>
</code></pre>
    <p class="normal">A version specifier consists of a comparison operator followed by a version string. This will direct <code class="Code-In-Text--PACKT-">pip</code> to ensure that the version installed matches the requirement; in this case, it would specify the following:</p>
    <ul>
      <li class="bullet"><code class="Code-In-Text--PACKT-">requests</code> would have to be <em class="italic">exactly</em> version 2.26.0</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">paramiko</code> would have to be at least 2.6 or higher</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">psycopg2</code> would have to be less than 3.0</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">matplotlib</code> would have to be greater than 3.2 (not including 3.2!), but 3.3 or lower</li>
    </ul>
    <p class="normal">Whether you include version specifiers, and how specific you make them, depends somewhat on the needs of your project and users. In general, you shouldn't limit <code class="Code-In-Text--PACKT-">pip</code> from installing newer versions of a library so that you don't miss out on bug fixes and security <a id="_idIndexMarker1566"/>patches, but in<a id="_idIndexMarker1567"/> situations where there are known bugs with newer versions, it may be essential.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">The command <code class="Code-In-Text--PACKT-">pip freeze</code> will print a list of all your installed packages with exact versions specified. Developers in mission-critical environments who want to guarantee the ability to reproduce their exact development environment often just copy this output directly to <code class="Code-In-Text--PACKT-">requirements.txt</code>.</p>
    </div>
    <h3 id="_idParaDest-442" class="title">Creating a pyproject.toml file</h3>
    <p class="normal">Although <code class="Code-In-Text--PACKT-">setuptools</code> is <a id="_idIndexMarker1568"/>still the<a id="_idIndexMarker1569"/> de facto standard for packaging Python projects, the Python community is moving toward tool-agnostic configuration to accommodate newer options as well. As part of this move, the official packaging guide recommends creating a <code class="Code-In-Text--PACKT-">pyproject.toml</code> file in your project's root directory. Currently, this file is only used to specify your project's build system and build system requirements, but there is indication that more project settings will migrate to this file in the future.</p>
    <p class="normal">For our project, the file should contain the following:</p>
    <pre class="programlisting code"><code class="hljs-code">[build-system]
requires = [
    <span class="hljs-string">"setuptools"</span>,
    <span class="hljs-string">"wheel"</span>
]
build-backend = <span class="hljs-string">"setuptools.build_meta"</span>
</code></pre>
    <p class="normal">This file indicates that our project requires the <code class="Code-In-Text--PACKT-">setuptools</code> and <code class="Code-In-Text--PACKT-">wheel</code> packages, and that we're using <code class="Code-In-Text--PACKT-">setuptools.build_meta</code> to actually build our project. These are the recommended configurations if you wish to use <code class="Code-In-Text--PACKT-">setuptools</code> to build your project.</p>
    <p class="normal">Note that the requirements listed here are <em class="italic">build requirements</em>, meaning they are the packages required by the build tool used to create a distributable package. This is distinct from the requirements we listed in <code class="Code-In-Text--PACKT-">requirements.txt</code>, which are the packages needed<a id="_idIndexMarker1570"/> to <em class="italic">use</em> the<a id="_idIndexMarker1571"/> package.</p>
    <div class="note">
      <p class="Information-Box--PACKT-"><strong class="keyword">TOML</strong> (<strong class="keyword">Tom's Obvious, Minimal Language</strong>) is a relatively new configuration file format<a id="_idIndexMarker1572"/> introduced in 2013. It extends the traditional INI-style format with new features like hierarchical structures and nested lists. It is growing in popularity particularly as a configuration format for build tools in languages like Rust, JavaScript, and of course Python. Learn<a id="_idIndexMarker1573"/> more about TOML at <a href="https://toml.io"><span class="url">https://toml.io</span></a>.</p>
    </div>
    <h3 id="_idParaDest-443" class="title">Adding a license file</h3>
    <p class="normal">When you<a id="_idIndexMarker1574"/> distribute code, it's important that the recipients know what they're allowed to do with that code. Unlike compiled languages such as C or Java, Python source code is necessarily included when you distribute your project using <code class="Code-In-Text--PACKT-">setuptools</code>. To make sure that recipients use the code appropriately, we need to include a license file with our code.</p>
    <p class="normal">When deciding on a license, there are a few concerns you need to consider.</p>
    <p class="normal">First, if you're developing software as part of your job (such as our ABQ Data Entry program), your employer typically owns the code and you need to make sure you're specifying their preferred license for the code. Consult your employer for their policy on this issue.</p>
    <p class="normal">Second, if you've used third-party libraries, you'll need to make sure your license is compatible with the license of those libraries. For example, if you are using a software library licensed under the <strong class="keyword">GNU Public License</strong> (<strong class="keyword">GPL</strong>), you may be required to release your software under <a id="_idIndexMarker1575"/>the GPL or a similar, compatible license. Python and Tkinter are distributed under fairly permissive licenses; here are the licenses of our four dependencies:</p>
    <table id="table001-12" class="No-Table-Style">
      <colgroup>
        <col/>
        <col/>
        <col/>
      </colgroup>
      <tbody>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="Table-Column-Heading--PACKT-">Package</p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Heading--PACKT-">License</p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Heading--PACKT-">Reference</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><code class="Code-In-Text--PACKT-">requests</code></p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-">Apache2</p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><a href="https://2.python-requests.org/projects/3/user/intro/"><span class="url">https://2.python-requests.org/projects/3/user/intro/</span></a></p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><code class="Code-In-Text--PACKT-">paramiko</code></p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-">LGPL 2.1</p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><a href="https://github.com/paramiko/paramiko"><span class="url">https://github.com/paramiko/paramiko</span></a> (<code class="Code-In-Text--PACKT-">LICENSE</code> file)</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><code class="Code-In-Text--PACKT-">psycopg2</code></p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-">LGPL 2.1</p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><a href="https://www.psycopg.org/license"><span class="url">https://www.psycopg.org/license</span></a></p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><code class="Code-In-Text--PACKT-">matplotlib</code></p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-">Matplotlib License (BSD-based)</p>
          </td>
          <td class="No-Table-Style">
            <p class="Table-Column-Content--PACKT-"><a href="https://matplotlib.org/stable/users/license.html"><span class="url">https://matplotlib.org/stable/users/license.html</span></a></p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="normal">Be sure to consult these licenses before distributing your package to make sure you're complying with the requirements for software using the libraries. If neither of these situations applies, you should simply consider what license best suits the project and describes the intention you have in distributing it.</p>
    <p class="normal">Whichever <a id="_idIndexMarker1576"/>you choose, this should be included in your project root directory in a file called <code class="Code-In-Text--PACKT-">LICENSE</code>.</p>
    <h3 id="_idParaDest-444" class="title">Making our package executable</h3>
    <p class="normal">Up to this <a id="_idIndexMarker1577"/>point in the project, we've been executing our application by running the <code class="Code-In-Text--PACKT-">abq_data_entry.py</code> file, which we've placed in the project root directory <em class="italic">outside</em> the package. Ideally, though, we'd like all our Python code – even this trivial launcher script – to be located inside the package. We could just copy <code class="Code-In-Text--PACKT-">abq_data_entry.py</code> into the package directory, right? It would seem that simple, but when we execute the script now we get an error:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python abq_data_entry/abq_data_entry.py
Traceback (most recent call last):
  File ".../abq_data_entry/abq_data_entry.py", line 1, in &lt;module&gt;
    from abq_data_entry.application import Application
  File ".../abq_data_entry/abq_data_entry.py", line 1, in &lt;module&gt;
    from abq_data_entry.application import Application
ModuleNotFoundError: No module named 'abq_data_entry.application';
  'abq_data_entry' is not a package
</code></pre>
    <p class="normal">Unfortunately, the relative imports we have in the package will not work correctly when executing code inside the package. However, Python provides a solution here: we can make our <em class="italic">package</em> executable, rather than relying on a particular Python <em class="italic">script</em> for execution.</p>
    <p class="normal">To do that, we need to create a <code class="Code-In-Text--PACKT-">__main__.py</code> file inside our package. This special file inside a Python package makes the package executable; when the module is executed, Python will run the <code class="Code-In-Text--PACKT-">__main__.py</code> script. However, it will run it in a slightly special way that will allow our relative imports to work.</p>
    <p class="normal">Create a new file called <code class="Code-In-Text--PACKT-">abq_data_entry/__main__.py</code> and add the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># abq_data_entry/__main__.py</span>
<span class="hljs-keyword">from</span> abq_data_entry.application <span class="hljs-keyword">import</span> Application
<span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">main</span><span class="hljs-function">():</span>
  app = Application()
  app.mainloop()
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
    <p class="normal">The contents of <code class="Code-In-Text--PACKT-">__main__.py</code> are nearly identical to <code class="Code-In-Text--PACKT-">abq_data_entry.py</code>; the only difference is that we've put the creation of <code class="Code-In-Text--PACKT-">Application</code> and the execution of <code class="Code-In-Text--PACKT-">mainloop()</code> in a function called <code class="Code-In-Text--PACKT-">main()</code>. The reason for this will be explained shortly when we start building our package.</p>
    <p class="normal">Once we've created <code class="Code-In-Text--PACKT-">__main__.py</code>, we can execute the module like so:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python -m abq_data_entry
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">-m</code> flag <a id="_idIndexMarker1578"/>tells Python to load and execute the provided module. Note that, for the moment, this command must be executed inside the project root folder. Once we create and install our Python package, we'll be able to run it from anywhere.</p>
    <h2 id="_idParaDest-445" class="title">Configuring a setup.py script</h2>
    <p class="normal">Now that <a id="_idIndexMarker1579"/>our code is ready, we can start creating our <code class="Code-In-Text--PACKT-">setuptools</code> configuration. To package our project using <code class="Code-In-Text--PACKT-">setuptools</code>, we need to create a <strong class="keyword">setup script</strong>; by convention, this is called <code class="Code-In-Text--PACKT-">setup.py</code> and is created in the application's root directory.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">The <code class="Code-In-Text--PACKT-">setuptools</code> configuration can also be created as an INI-style configuration file, <code class="Code-In-Text--PACKT-">setup.cfg</code>. Eventually, this may replace <code class="Code-In-Text--PACKT-">setup.py</code>, but in this book we're going to stick with the Python script approach, because it allows us to execute some necessary Python code.</p>
    </div>
    <p class="normal">The basic structure of a <code class="Code-In-Text--PACKT-">setup.py</code> file looks like this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># setup.py</span>
<span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup
setup(
  <span class="hljs-comment"># Configuration arguments here</span>
)
</code></pre>
    <p class="normal">The vast majority of our configuration will be passed as arguments to the <code class="Code-In-Text--PACKT-">setup()</code> function, defining the basic metadata for our package, what will be packaged, and providing <a id="_idIndexMarker1580"/>some functionality after installation.</p>
    <h3 id="_idParaDest-446" class="title">Basic metadata arguments</h3>
    <p class="normal">To begin, let's <a id="_idIndexMarker1581"/>define some basic metadata about our application using these arguments in <code class="Code-In-Text--PACKT-">setup.py</code>:</p>
    <pre class="programlisting code"><code class="hljs-code">setup(
  name=<span class="hljs-string">'ABQ_Data_Entry'</span>,
  version=<span class="hljs-string">'1.0'</span>,
  author=<span class="hljs-string">'Alan D Moore'</span>,
  author_email=<span class="hljs-string">'alandmoore@example.com'</span>,
  description=<span class="hljs-string">'Data entry application for ABQ AgriLabs'</span>,
  url=<span class="hljs-string">"http://abq.example.com"</span>,
  license=<span class="hljs-string">"ABQ corporate license"</span>,
  <span class="hljs-comment">#...</span>
)
</code></pre>
    <p class="normal">Metadata such as this will be used in naming the package as well as providing information for PyPI. Not all of the fields are necessary if you are just packaging for personal or internal use, but if you plan to upload to PyPI, you should include all these fields as well as <code class="Code-In-Text--PACKT-">long_description</code>, which should be a reStructuredText string that provides extended information about the program.</p>
    <p class="normal">Often, the <code class="Code-In-Text--PACKT-">README.rst</code> file can simply be used. Since this configuration script is just a Python script, we can use normal Python to read the file and use its contents for this configuration <a id="_idIndexMarker1582"/>option, like so:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># setup.py, near the top</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'README.rst'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> fh:
  long_description = fh.read()
<span class="hljs-comment"># inside the setup() call:</span>
setup(
  <span class="hljs-comment">#...</span>
  long_description=long_description,
)
</code></pre>
    <h3 id="_idParaDest-447" class="title">Packages and dependencies</h3>
    <p class="normal">Once we have <a id="_idIndexMarker1583"/>specified<a id="_idIndexMarker1584"/> the metadata, we need to tell <code class="Code-In-Text--PACKT-">setuptools</code> which packages we're actually bundling using the <code class="Code-In-Text--PACKT-">packages</code> argument. In our case, we only have the <code class="Code-In-Text--PACKT-">abq_data_entry</code> package, so we'll specify it as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">setup(
  <span class="hljs-comment">#...</span>
  packages=[
    <span class="hljs-string">'abq_data_entry'</span>,
    <span class="hljs-string">'abq_data_entry.images'</span>,
    <span class="hljs-string">'abq_data_entry.test'</span>
  ],
</code></pre>
    <p class="normal">Note that we've specified both the main package and the sub-modules <code class="Code-In-Text--PACKT-">images</code> and <code class="Code-In-Text--PACKT-">test</code>. We need to specify all the sub-modules we want to include explicitly here, as <code class="Code-In-Text--PACKT-">setuptools</code> will not automatically include them.</p>
    <p class="normal">That could get tedious with very complex packages, so <code class="Code-In-Text--PACKT-">setuptools</code> also includes the <code class="Code-In-Text--PACKT-">find_packages()</code> function, which can be used instead like so:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup, find_packages
setup(
  <span class="hljs-comment">#...</span>
  packages=<span class="code-highlight"><strong class="hljs-slc">find_packages(),</strong></span>
</code></pre>
    <p class="normal">This will locate and include all the packages in our project directory automatically.</p>
    <p class="normal">In addition to the modules defined in our project, our application depends on third-party modules such as <code class="Code-In-Text--PACKT-">psycopg2</code>, <code class="Code-In-Text--PACKT-">requests</code>, <code class="Code-In-Text--PACKT-">paramiko</code>, and <code class="Code-In-Text--PACKT-">matplotlib</code>. We can specify these dependencies in <code class="Code-In-Text--PACKT-">setup()</code>, and, assuming they're available from PyPI, <code class="Code-In-Text--PACKT-">pip</code> will install them automatically when our package is installed.</p>
    <p class="normal">This is done using the <code class="Code-In-Text--PACKT-">install_requires</code> argument as shown here:</p>
    <pre class="programlisting code"><code class="hljs-code">setup(
  <span class="hljs-comment">#...</span>
  install_requires=[
    <span class="hljs-string">'psycopg2'</span>, <span class="hljs-string">'requests'</span>, <span class="hljs-string">'paramiko'</span>, <span class="hljs-string">'matplotlib'</span>
  ],
</code></pre>
    <p class="normal">Note that these required packages may have their own dependencies as well; for example, <code class="Code-In-Text--PACKT-">matplotlib</code> requires several other libraries including <code class="Code-In-Text--PACKT-">numpy</code> and <code class="Code-In-Text--PACKT-">pillow</code>. We don't <a id="_idIndexMarker1585"/>have<a id="_idIndexMarker1586"/> to specify all of those sub-dependencies; they will also be automatically installed by <code class="Code-In-Text--PACKT-">pip</code>.</p>
    <p class="normal">If the package requires particular versions of these modules, we can specify that as well:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># Just an example, do not add to your setup.py!</span>  
  install_requires=[
    <span class="hljs-string">'psycopg2==2.9.1'</span>, <span class="hljs-string">'requests&gt;=2.26'</span>,
    <span class="hljs-string">'paramiko'</span>, <span class="hljs-string">'matplotlib&lt;3.3.5'</span>
  ]
</code></pre>
    <p class="normal">This looks rather familiar, doesn't it? These are the same kind of rules we can put in <code class="Code-In-Text--PACKT-">requirements.txt</code>, and the same list of runtime dependencies. Some developers take the approach of just reading in <code class="Code-In-Text--PACKT-">requirements.txt</code> and sending its contents to the <code class="Code-In-Text--PACKT-">install_requires</code> list; there are even tools available to help translate some of the incompatible syntax between them. Remember, though, that the intention of our <code class="Code-In-Text--PACKT-">requirements.txt</code> file was to recreate our specific development environment. As such, it contains non-runtime packages, and may have very specific version specifiers for the sake of testing consistency. The <code class="Code-In-Text--PACKT-">install_requires</code> list, by contrast, is meant solely for runtime requirements, and in general should be more abstract about versions and package sources. For example, while it might be helpful to specify <code class="Code-In-Text--PACKT-">psycopg2</code> version <code class="Code-In-Text--PACKT-">2.9.1</code> for the development environment, unless we know for certain that it only works correctly with that one version, we would specify something more general here like <code class="Code-In-Text--PACKT-">psycopg2&lt;3.0</code>.</p>
    <p class="normal">Just as we can specify package version requirements, we can also specify the version of Python required by our application using the <code class="Code-In-Text--PACKT-">python_requires</code> argument, like so:</p>
    <pre class="programlisting code"><code class="hljs-code">setup(
  <span class="hljs-comment">#...</span>
  python_requires=<span class="hljs-string">'&gt;= 3.6'</span>,
</code></pre>
    <p class="normal">This is always a good idea to do if you're using Python features not found in earlier releases (for example, the f-strings used in our application do not work before Python 3.6), or if you want to be sure that only a specific, tested version of Python is used. If the user is <a id="_idIndexMarker1587"/>not <a id="_idIndexMarker1588"/>running a matching version of Python, <code class="Code-In-Text--PACKT-">pip install</code> will abort with an error.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">The syntax for version specifiers used in <code class="Code-In-Text--PACKT-">setuptools</code> is laid out in PEP 440, which you can find at <a href="https://www.python.org/dev/peps/pep-0440/"><span class="url">https://www.python.org/dev/peps/pep-0440/</span></a>.</p>
    </div>
    <h3 id="_idParaDest-448" class="title">Adding extra files</h3>
    <p class="normal">By default, <code class="Code-In-Text--PACKT-">setuptools</code> will <a id="_idIndexMarker1589"/>only copy Python files into your package. Our package contains more than that, though: we have documentation in RST, SQL scripts, and most importantly our PNG images, without which our program won't run correctly.</p>
    <p class="normal">Non-Python files that are located <em class="italic">inside </em>our package structure can be specified using the <code class="Code-In-Text--PACKT-">package_data</code> argument:</p>
    <pre class="programlisting code"><code class="hljs-code">setup(
  <span class="hljs-comment">#...</span>
  package_data={<span class="hljs-string">'abq_data_entry.images'</span>: [<span class="hljs-string">'*.png'</span>, <span class="hljs-string">'*.xbm'</span>]},
)
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">package_data</code> argument takes a dictionary that matches module paths to a list of files (or globbing expressions that match a list of files) to be included in that module. Here, we're telling <code class="Code-In-Text--PACKT-">setuptools</code> to include all the PNG and XBM files in the <code class="Code-In-Text--PACKT-">images</code> module.</p>
    <p class="normal">Our project also contains necessary files outside the <code class="Code-In-Text--PACKT-">abq_data_entry</code> module; these aren't needed for the program to operate, but should nevertheless be distributed with the package. We cannot specify these in <code class="Code-In-Text--PACKT-">setup()</code>, since it only deals with the in-package files.</p>
    <p class="normal">To add these, we need to create a separate file in the project root directory called <code class="Code-In-Text--PACKT-">MANIFEST.in</code>. For our application, the file should contain this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># MANIFEST.in</span>
include README.rst
include requirements.txt
include docs/*
include sql/*.sql
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">MANIFEST.in</code> file contains a series of the <code class="Code-In-Text--PACKT-">include</code> directives with filenames or globbing expressions that match files we want to include. Here, we're including all files in our <code class="Code-In-Text--PACKT-">docs</code> directory, all the <code class="Code-In-Text--PACKT-">.sql</code> files in the <code class="Code-In-Text--PACKT-">sql</code> directory, the <code class="Code-In-Text--PACKT-">requirements.txt</code> file, and the <code class="Code-In-Text--PACKT-">README.rst</code> file. Since <code class="Code-In-Text--PACKT-">setup.py</code> relies on the <code class="Code-In-Text--PACKT-">README.rst</code> and <code class="Code-In-Text--PACKT-">requirements.txt</code> files for setup data, it's imperative that we include it in the package. Otherwise, our<a id="_idIndexMarker1590"/> package won't be buildable on other systems.</p>
    <h3 id="_idParaDest-449" class="title">Defining commands</h3>
    <p class="normal">Earlier, we<a id="_idIndexMarker1591"/> created a <code class="Code-In-Text--PACKT-">__main__.py</code> file in our package that allows our package to be run using the command <code class="Code-In-Text--PACKT-">python -m abq_data_entry</code>. This is certainly cleaner than having to hunt down the right Python script to execute, but ideally we'd like our package to set up a simple command that a user can execute to launch the program.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">setuptools</code> library offers a way to add executable commands in our package using the <code class="Code-In-Text--PACKT-">entry_points</code> argument. <strong class="keyword">Entry points</strong> are ways<a id="_idIndexMarker1592"/> for external environments to access our code. One particular entry point, <code class="Code-In-Text--PACKT-">console_scripts</code>, defines a list of module functions that will be mapped to external commands. When the package is installed, <code class="Code-In-Text--PACKT-">setuptools</code> will create a simple, platform-appropriate executable file for each <code class="Code-In-Text--PACKT-">console_scripts</code> item that, when executed, will run the function specified.</p>
    <p class="normal">We can't point <code class="Code-In-Text--PACKT-">console_scripts</code> to a Python file or package, however; it must point instead to a <em class="italic">function</em> inside the package. This is why we created the <code class="Code-In-Text--PACKT-">main()</code> function in our <code class="Code-In-Text--PACKT-">__main__.py</code> file earlier, so that we can specify <code class="Code-In-Text--PACKT-">__main__.main()</code> as a console script entry point, like so:</p>
    <pre class="programlisting code"><code class="hljs-code">setup(
  <span class="hljs-comment">#...</span>
  entry_points={
    <span class="hljs-string">'console_scripts'</span>: [
    <span class="hljs-string">'abq = abq_data_entry.__main__:main'</span>
  ]}
)
</code></pre>
    <p class="normal">Each item in the <code class="Code-In-Text--PACKT-">console_scripts</code> list is a string in the format <code class="Code-In-Text--PACKT-">{executable_name} = {module}.{submodule}:{function_name}</code>. Our code here will cause <code class="Code-In-Text--PACKT-">setuptools</code> to create an executable called <code class="Code-In-Text--PACKT-">abq</code>, which will run the <code class="Code-In-Text--PACKT-">main()</code> function we defined in <code class="Code-In-Text--PACKT-">__main__.py</code>. Thus, after installation, we can execute the application by just typing <code class="Code-In-Text--PACKT-">abq</code> at a command line. You could define other scripts here if there were functions in the package that<a id="_idIndexMarker1593"/> could run standalone.</p>
    <h3 id="_idParaDest-450" class="title">Testing the configuration</h3>
    <p class="normal">Before we<a id="_idIndexMarker1594"/> move on to creating distributable packages from our configuration, we can check it for proper syntax and content by running the following command in the project root directory:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python setup.py check
</code></pre>
    <p class="normal">If all is well, this will simply return the string <code class="Code-In-Text--PACKT-">running check</code> with no other output. If something were missing, you would get an error message. For example, if you comment out the <code class="Code-In-Text--PACKT-">name</code> and <code class="Code-In-Text--PACKT-">version</code> arguments to <code class="Code-In-Text--PACKT-">setup()</code> and run the check, you'll get the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">running check
warning: check: missing required meta-data: name, version
</code></pre>
    <p class="normal">While it won't find every potential problem with your <code class="Code-In-Text--PACKT-">setup.py</code>, the <code class="Code-In-Text--PACKT-">check</code> command will at least ensure you have the essential metadata specified, which is especially important if you wish to upload your package to PyPI.</p>
    <h2 id="_idParaDest-451" class="title">Creating and using source distributions</h2>
    <p class="normal">With our <a id="_idIndexMarker1595"/>configuration<a id="_idIndexMarker1596"/> files all set, we can now create a <strong class="keyword">source distribution</strong>. This kind of distribution bundles all the relevant files for building our package from source into a <code class="Code-In-Text--PACKT-">.tar.gz</code> archive.</p>
    <p class="normal">To create the source distribution, run <code class="Code-In-Text--PACKT-">setup.py</code> with the <code class="Code-In-Text--PACKT-">sdist</code> option in the project root directory:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python setup.py sdist
</code></pre>
    <p class="normal">After doing this, two new directories will appear under the project root:</p>
    <ul>
      <li class="bullet"><code class="Code-In-Text--PACKT-">ABQ_Data_Entry.egg-info</code>: This directory contains the metadata files generated by <code class="Code-In-Text--PACKT-">setuptools</code>. If you explore this directory, you'll find that all the information we passed to <code class="Code-In-Text--PACKT-">setup()</code> is here in some form or other.</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">dist</code>: This directory contains the files generated for distribution; in this case, there is just a single <code class="Code-In-Text--PACKT-">.tar.gz</code> file that contains our source package.</li>
    </ul>
    <p class="normal">To install the source distribution on another computer, it first needs to be extracted. This can be done with GUI utilities or in a terminal with the <code class="Code-In-Text--PACKT-">tar</code> command, as shown in the following example:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> tar -xzf ABQ_Data_Entry-1.0.tar.gz
</code></pre>
    <p class="normal">Once extracted, we can install the package by running <code class="Code-In-Text--PACKT-">setup.py</code> inside the extracted directory <a id="_idIndexMarker1597"/>using<a id="_idIndexMarker1598"/> the <code class="Code-In-Text--PACKT-">install</code> option, like so:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> <span class="hljs-con-built_in">cd</span> ABQ_Data_Entry/
<span class="hljs-con-meta">$</span> python3 setup.py install
</code></pre>
    <h3 id="_idParaDest-452" class="title">Testing our source distribution</h3>
    <p class="normal">If you don't have<a id="_idIndexMarker1599"/> a second computer handy to test your source installer on, you <a id="_idIndexMarker1600"/>can use a Python <strong class="keyword">virtual environment</strong> instead. A virtual environment is a clean, isolated Python installation that can be activated on demand to keep installed packages from polluting your system's main Python environment.</p>
    <p class="normal">To create one, first make sure you have the <code class="Code-In-Text--PACKT-">virtualenv</code> package installed using <code class="Code-In-Text--PACKT-">pip</code>:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> pip install --user virtualenv
</code></pre>
    <p class="normal">Next, create a directory anywhere on your system and generate a Python 3 environment in it with these commands:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> mkdir testenv
<span class="hljs-con-meta">$</span> python -m virtualenv -p python3 testenv
</code></pre>
    <p class="normal">This will create a virtual environment, essentially a copy of the Python interpreter and standard library, in the <code class="Code-In-Text--PACKT-">testenv</code> directory along with some supporting scripts and files. This environment can be modified in any way you wish without affecting your system's Python environment.</p>
    <p class="normal">To use the new virtual environment, you need to <strong class="keyword">activate</strong> it by executing the following code in a terminal:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-comment"># On Linux, macOS, and other unix-like systems:</span>
<span class="hljs-con-meta">$</span> <span class="hljs-con-built_in">source</span> testenv/bin/activate
<span class="hljs-con-comment"># On Windows</span>
<span class="hljs-con-meta">&gt;</span> testenv\Scripts\activate
</code></pre>
    <p class="normal">Activating a virtual environment means that invocations of <code class="Code-In-Text--PACKT-">python</code> will use the binaries and libraries in the virtual environment rather than your system installation. This includes Python-related commands like <code class="Code-In-Text--PACKT-">pip</code>, meaning that a <code class="Code-In-Text--PACKT-">pip install</code> will install packages to the environment's library rather than to your system or user Python libraries.</p>
    <p class="normal">With your test environment active, you can now run <code class="Code-In-Text--PACKT-">setup.py install</code> on your source distribution. You'll notice that Python will install <code class="Code-In-Text--PACKT-">psycopg2</code>, <code class="Code-In-Text--PACKT-">requests</code>, <code class="Code-In-Text--PACKT-">paramiko</code>, and <code class="Code-In-Text--PACKT-">matplotlib</code>, as well as their individual dependencies, even if you already have those packages on your system. That's because the virtual environment starts clean with no third-party packages, so everything must be installed again in the new environment.</p>
    <p class="normal">If the install was successful, you should find the following things:</p>
    <ul>
      <li class="bullet">You have a command called <code class="Code-In-Text--PACKT-">abq</code> available in your virtual environment, which launches the ABQ Data Entry application.</li>
      <li class="bullet">You can open a Python prompt from any directory on the system (not just in the project root) and import <code class="Code-In-Text--PACKT-">abq_data_entry</code>.</li>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">abq_data_entry</code> package directory can be found in <code class="Code-In-Text--PACKT-">testenv/lib/python3.9/sitepackages</code>.</li>
    </ul>
    <p class="normal">When finished <a id="_idIndexMarker1601"/>with your virtual environment, you can type <code class="Code-In-Text--PACKT-">deactivate</code> in the terminal to go back to your system Python. If you want to remove the environment, just delete the <code class="Code-In-Text--PACKT-">testenv</code> directory.</p>
    <h2 id="_idParaDest-453" class="title">Building a wheel distribution</h2>
    <p class="normal">While a source <a id="_idIndexMarker1602"/>distribution may be fine for simple software such as our application, packages with complicated build steps such as code compilation may benefit <a id="_idIndexMarker1603"/>from a <strong class="keyword">built distribution</strong>. As the name implies, a built distribution is one where any building operations (compilation or code generation, for example) has already been done. The current format used by <code class="Code-In-Text--PACKT-">setuptools</code> for built distributions is the <strong class="keyword">wheel format</strong>.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">The wheel format replaces an older <code class="Code-In-Text--PACKT-">distutils</code> distribution format called <code class="Code-In-Text--PACKT-">egg</code>. You will still see references to <code class="Code-In-Text--PACKT-">egg</code> when using <code class="Code-In-Text--PACKT-">setuptools</code> or other <code class="Code-In-Text--PACKT-">distutils</code> derivatives.</p>
    </div>
    <p class="normal">A <code class="Code-In-Text--PACKT-">wheel</code> (<code class="Code-In-Text--PACKT-">.whl</code>) file is basically a ZIP-format archive file containing pre-built code. It comes in the following<a id="_idIndexMarker1604"/> three types:</p>
    <ul>
      <li class="bullet"><strong class="keyword">Universal</strong>: This type of <code class="Code-In-Text--PACKT-">wheel</code> file contains only Python code that will run on any platform with any major version of Python (2 and 3).</li>
      <li class="bullet"><strong class="keyword">Pure Python</strong>: This type of <code class="Code-In-Text--PACKT-">wheel</code> file contains only Python code that will run on any platform, but is compatible with only one version of Python.</li>
      <li class="bullet"><strong class="keyword">Platform</strong>: This <code class="Code-In-Text--PACKT-">wheel</code> file is limited to a particular OS, platform, or architecture, usually because it contains compiled binary code.</li>
    </ul>
    <p class="normal">The default <code class="Code-In-Text--PACKT-">wheel</code> file created by <code class="Code-In-Text--PACKT-">setuptools</code> is a pure Python wheel, which is what our application should be (since we have no compiled code, but are compatible only with Python 3). Creating one is simply a matter of calling <code class="Code-In-Text--PACKT-">setup.py</code> with the <code class="Code-In-Text--PACKT-">bdist_wheel</code> option, like so:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python3 setup.py bdist_wheel
</code></pre>
    <p class="normal">Like <code class="Code-In-Text--PACKT-">sdist</code>, this <a id="_idIndexMarker1605"/>command creates a new file in the <code class="Code-In-Text--PACKT-">dist</code> directory, only this time it's a <code class="Code-In-Text--PACKT-">.whl</code> file. The filename will be <code class="Code-In-Text--PACKT-">ABQ_Data_Entry-1.0-py3-none-any.whl</code>, the segments of which represent the following information:</p>
    <ul>
      <li class="bullet">The package name, in this case <code class="Code-In-Text--PACKT-">ABQ_Data_Entry</code>.</li>
      <li class="bullet">The version, in this case <code class="Code-In-Text--PACKT-">1.0</code>.</li>
      <li class="bullet">Whether it's Python 3, Python 2, or universal; in this case, <code class="Code-In-Text--PACKT-">py3</code> for Python 3.</li>
      <li class="bullet">The <strong class="keyword">Application Binary Interface</strong> (<strong class="keyword">ABI</strong>) tag, which would indicate a particular implementation <a id="_idIndexMarker1606"/>of Python (for example, CPython vs. IronPython). In this case, it's <code class="Code-In-Text--PACKT-">none</code>, since we have no particular ABI requirements.</li>
      <li class="bullet">The supported platform, in this case <code class="Code-In-Text--PACKT-">any</code>, since our application is not platform-specific. Note that this component can include a CPU architecture as well as an operating system.</li>
    </ul>
    <p class="normal">Notice that the <code class="Code-In-Text--PACKT-">bdist_wheel</code> process also creates a <code class="Code-In-Text--PACKT-">build</code> directory, which is where built code is staged before it is compressed into the <code class="Code-In-Text--PACKT-">wheel</code> file. You can inspect this directory to make sure that your package is being assembled correctly.</p>
    <p class="normal">Once built, your <code class="Code-In-Text--PACKT-">wheel</code> file can be installed using <code class="Code-In-Text--PACKT-">pip</code>, like so:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> pip install ABQ_Data_Entry-1.0-py3-none-any.whl
</code></pre>
    <p class="normal">As with the source install, <code class="Code-In-Text--PACKT-">pip</code> will first install any dependencies specified in the setup configuration, then install the package itself to the environment's <code class="Code-In-Text--PACKT-">site-packages</code> directory. The executable <code class="Code-In-Text--PACKT-">abq</code> file will also be created and copied to an executable location <a id="_idIndexMarker1607"/>appropriate to your platform.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">If you get an error when trying to use <code class="Code-In-Text--PACKT-">bdist_wheel</code>, you may need to install the <code class="Code-In-Text--PACKT-">wheel</code> module, as it's not always included with <code class="Code-In-Text--PACKT-">setuptools</code>. This module can be installed with the command <code class="Code-In-Text--PACKT-">pip install --user wheel</code>. Recall that we specified <code class="Code-In-Text--PACKT-">wheel</code> as a build dependency in <code class="Code-In-Text--PACKT-">pyproject.toml</code>, though, so this step should be taken care of by <code class="Code-In-Text--PACKT-">setuptools</code>.</p>
    </div>
    <h1 id="_idParaDest-454" class="title">Creating executables with cx_Freeze</h1>
    <p class="normal">While source<a id="_idIndexMarker1608"/> and<a id="_idIndexMarker1609"/> wheel distributions are useful, they both require that Python and any third-party library dependencies be installed on the system before the program can be run. Often, it would be much handier if we could provide a file or set of files that can simply be copied and run on a system without installing anything else first. Better yet, we'd like to have platform-appropriate installation packages that set up desktop shortcuts and perform other common system configurations.</p>
    <p class="normal">There are several ways to go about this with Python code, and several projects to choose from; in this book, we're going to look at one called <code class="Code-In-Text--PACKT-">cx_Freeze</code>.</p>
    <p class="normal">The basic idea of <code class="Code-In-Text--PACKT-">cx_Freeze</code> is to bundle up all the code and shared library files for a Python project along with a Python interpreter, and then generate a small executable file that will launch the code with the bundled interpreter. This approach is commonly known as <strong class="keyword">freezing</strong> the<a id="_idIndexMarker1610"/> code (hence the package name), and it works fairly well most of the time. However, as we'll see, there are some limitations and difficulties to work around. One significant limitation is that <code class="Code-In-Text--PACKT-">cx_Freeze</code> can only make executables for the platform that it's running on; in other words, if you want a Windows executable, you'll need to build it on Windows; if you want a Linux executable, you'll have to build it on Linux, and so on.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Complete <a id="_idIndexMarker1611"/>documentation on <code class="Code-In-Text--PACKT-">cx_Freeze</code> can be found at <a href="https://cx-freeze.readthedocs.io"><span class="url">https://cx-freeze.readthedocs.io</span></a>.</p>
    </div>
    <h2 id="_idParaDest-455" class="title">First steps with cx_Freeze</h2>
    <p class="normal">Install <code class="Code-In-Text--PACKT-">cx_Freeze</code> using <code class="Code-In-Text--PACKT-">pip</code> as shown<a id="_idIndexMarker1612"/> in the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> pip install --user cx-Freeze
</code></pre>
    <p class="normal">Linux users may also need to install the <code class="Code-In-Text--PACKT-">patchelf</code> utility, generally available in your distribution's package manager.</p>
    <p class="normal">Like <code class="Code-In-Text--PACKT-">setuptools</code>, <code class="Code-In-Text--PACKT-">cx_Freeze</code> is an extension of <code class="Code-In-Text--PACKT-">distutils</code>; it shares many similarities with <code class="Code-In-Text--PACKT-">setuptools</code>, but as you'll see, it takes a different approach to solving certain problems. Just like <code class="Code-In-Text--PACKT-">setuptools</code>, we'll start with a script in the project directory that calls the <code class="Code-In-Text--PACKT-">setup()</code> function. To distinguish this script from our <code class="Code-In-Text--PACKT-">setuptools</code> script, we'll call it <code class="Code-In-Text--PACKT-">cxsetup.py</code>. Open this file and enter the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># cxsetup.py</span>
<span class="hljs-keyword">import</span> cx_Freeze <span class="hljs-keyword">as</span> cx
cx.setup(
  name=<span class="hljs-string">'ABQ_Data_Entry'</span>,
  version=<span class="hljs-string">'1.0'</span>,
  author=<span class="hljs-string">'Alan D Moore'</span>,
  author_email=<span class="hljs-string">'alandmoore@example.com'</span>,
  description=<span class="hljs-string">'Data entry application for ABQ Agrilabs'</span>,
  url=<span class="hljs-string">"http://abq.example.com"</span>,
  packages=[<span class="hljs-string">'abq_data_entry'</span>],
)
</code></pre>
    <p class="normal">So far, this is identical to a <code class="Code-In-Text--PACKT-">setuptools</code> script apart from us using the <code class="Code-In-Text--PACKT-">cx_Freeze.setup()</code> function instead of the <code class="Code-In-Text--PACKT-">setuptools</code> one. From here, though, things will diverge considerably.</p>
    <p class="normal">Where <code class="Code-In-Text--PACKT-">setuptools</code> uses the <code class="Code-In-Text--PACKT-">entry_points</code> argument, <code class="Code-In-Text--PACKT-">cx_Freeze</code> uses an <code class="Code-In-Text--PACKT-">executables</code> argument. This argument takes a list of <code class="Code-In-Text--PACKT-">cx_Freeze.Excecutable</code> objects, each of which describes various attributes of an executable file we want to generate. Add the following code that does this for ABQ Data Entry:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
<span class="code-highlight"><strong class="hljs-slc">  executables=[</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    cx.Executable(</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-string-slc">'abq_data_entry/__main__.py'</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      target_name=</strong><strong class="hljs-string-slc">'abq'</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      icon=</strong><strong class="hljs-string-slc">'abq.ico'</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      )</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    ],</strong></span>
)
</code></pre>
    <p class="normal">At a minimum, we need to provide a Python script that should be executed when the executable will run; we're using our <code class="Code-In-Text--PACKT-">abq_data_entry/__main__.py</code> script for this purpose. </p>
    <p class="normal">By default, the generated executable will be the script name without the <code class="Code-In-Text--PACKT-">.py</code> extension. In this case, that would be <code class="Code-In-Text--PACKT-">__main__</code>, which is not a terribly descriptive name for our application. Fortunately, we can override this default with the <code class="Code-In-Text--PACKT-">target_name</code> argument, as we've done here. By specifying <code class="Code-In-Text--PACKT-">abq</code> here, <code class="Code-In-Text--PACKT-">cx_Freeze</code> will build an executable file called <code class="Code-In-Text--PACKT-">abq</code>.</p>
    <p class="normal">We can also specify an icon to use for the application using the <code class="Code-In-Text--PACKT-">icon</code> argument. This needs to be a path to a <code class="Code-In-Text--PACKT-">.ico</code> file, so you'll need to convert PNG or other formats to <code class="Code-In-Text--PACKT-">.ico</code> before <a id="_idIndexMarker1613"/>using them. The path to the file is relative to the project directory where the <code class="Code-In-Text--PACKT-">cxsetup.py</code> file is, and does not need to be inside the package itself.</p>
    <h2 id="_idParaDest-456" class="title">The build_exe options</h2>
    <p class="normal">Arguments to<a id="_idIndexMarker1614"/> specific <code class="Code-In-Text--PACKT-">cx_Freeze</code> operations can be passed into <code class="Code-In-Text--PACKT-">setup()</code> using the <code class="Code-In-Text--PACKT-">options</code> argument. This argument takes a dictionary in which each item is a <code class="Code-In-Text--PACKT-">cx_Freeze</code> operation name paired with a <code class="Code-In-Text--PACKT-">dict</code> object of operation-specific arguments. The first operation we're going to look at is <code class="Code-In-Text--PACKT-">build_exe</code>, which is a universal first step for all other operations. As the name implies, this is the stage where the executable and its accompanying files are built.</p>
    <p class="normal">Among other things, this is where we specify the package dependencies:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
<span class="code-highlight"><strong class="hljs-slc">  options={</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-string-slc">'build_exe'</strong><strong class="hljs-slc">: {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-string-slc">'packages'</strong><strong class="hljs-slc">: [</strong></span>
<span class="code-highlight"><strong class="hljs-slc">        </strong><strong class="hljs-string-slc">'psycopg2'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'requests'</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">        </strong><strong class="hljs-string-slc">'matplotlib'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'numpy'</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">        </strong><strong class="hljs-string-slc">'paramiko'</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      ],</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-string-slc">'includes'</strong><strong class="hljs-slc">: [],</strong></span>
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">packages</code> argument is a list of the packages that need to be installed. It's similar to the <code class="Code-In-Text--PACKT-">install_requires</code> argument for <code class="Code-In-Text--PACKT-">setuptools</code>, with the important difference that it does not support version specifiers. Also, note that we've included some things beyond our three main dependencies. Unfortunately, because <code class="Code-In-Text--PACKT-">cx_Freeze</code> doesn't always do a great job at identifying all the dependencies, it's often necessary to explicitly list sub-dependencies.</p>
    <p class="normal">Where <code class="Code-In-Text--PACKT-">packages</code> is a list of the packages that should be included, we can also specify specific <em class="italic">modules</em> to be included using the <code class="Code-In-Text--PACKT-">includes</code> argument. In theory, we shouldn't need to specify anything here, but in practice <code class="Code-In-Text--PACKT-">cx_Freeze</code> sometimes fails to bundle modules that our program needs. </p>
    <p class="normal">Using the <code class="Code-In-Text--PACKT-">includes</code> directive, we can explicitly request modules to ensure that they are included.</p>
    <p class="normal">To figure out what should go in the list, follow a basic trial-and-error procedure:</p>
    <ol>
      <li class="numbered">Build the executable.</li>
      <li class="numbered">Run the executable.</li>
      <li class="numbered">If you get a <code class="Code-In-Text--PACKT-">ModuleNotFoundError</code> exception stating that a module cannot be found, add <a id="_idIndexMarker1615"/>the module to the <code class="Code-In-Text--PACKT-">includes</code> list and run the build command again.</li>
      <li class="numbered">If you find several modules from the same package are missing, it may be more effective to add the package to the <code class="Code-In-Text--PACKT-">packages</code> list and rebuild.</li>
    </ol>
    <p class="normal">For example, suppose you build ABQ Data Entry and get the following error when running <code class="Code-In-Text--PACKT-">abq</code>:</p>
    <pre class="programlisting con"><code class="hljs-con">ModuleNotFoundError: No module named 'zlib'
</code></pre>
    <p class="normal">In this situation, <code class="Code-In-Text--PACKT-">zlib</code> would be a dependency of one of our required packages that for some reason <code class="Code-In-Text--PACKT-">cx_Freeze</code> did not identify as necessary. To fix this, we would simply force its inclusion by updating the configuration:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
  options={
    <span class="hljs-string">'build_exe'</span>: {
      <span class="hljs-comment">#...</span>
      <span class="hljs-string">'includes'</span>: <span class="code-highlight"><strong class="hljs-slc">[</strong><strong class="hljs-string-slc">'zlib'</strong><strong class="hljs-slc">]</strong></span>,
</code></pre>
    <p class="normal">After that, a rebuilt executable should include the missing module. Generally, you don't need to do this for widely used modules, but depending on your platform and the packages you require, these issues do come up.</p>
    <h2 id="_idParaDest-457" class="title">Including external files</h2>
    <p class="normal">As with <code class="Code-In-Text--PACKT-">setuptools</code>, <code class="Code-In-Text--PACKT-">cx_Freeze</code> only<a id="_idIndexMarker1616"/> includes Python files by default. To get other files like images and documentation included, we can use the <code class="Code-In-Text--PACKT-">include_files</code> argument to <code class="Code-In-Text--PACKT-">build_exe</code>. However, there is a problem: because of the way that <code class="Code-In-Text--PACKT-">cx_Freeze</code> bundles our Python module in a compressed archive, accessing file paths inside the module takes some extra code.</p>
    <p class="normal">Our <code class="Code-In-Text--PACKT-">images</code> module presents such a problem: it contains PNG files that our application accesses by calculating a relative path from its <code class="Code-In-Text--PACKT-">__init__.py</code> file. </p>
    <p class="normal">To address the issue, the PNG files will need to be relocated to a directory outside the package during the build process. Our code will then have to find them in the new location when it's been frozen, and in the original location when not.</p>
    <p class="normal">To make it work, modify <code class="Code-In-Text--PACKT-">images/__init__.py</code> as follows:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># abq_data_entry/images/__init__.py</span>
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">if</span> <span class="hljs-built_in">getattr</span>(sys, <span class="hljs-string">'frozen'</span>, <span class="hljs-literal">False</span>):
  IMAGE_DIRECTORY = Path(sys.executable).parent / <span class="hljs-string">'images'</span>
<span class="hljs-keyword">else</span>:
  IMAGE_DIRECTORY = Path(__file__).parent / <span class="hljs-string">'images'</span>
</code></pre>
    <p class="normal">When running a Python script that has been frozen using <code class="Code-In-Text--PACKT-">cx_Freeze</code>, the <code class="Code-In-Text--PACKT-">sys</code> module has an attribute called <code class="Code-In-Text--PACKT-">frozen</code>. We can test for the presence of this attribute to specify behavior that changes when the app is frozen. In this case, when our app is frozen, we're going to look for our images in an <code class="Code-In-Text--PACKT-">images</code> directory located in the same directory as the executable file. The location of the executable can be found from the <code class="Code-In-Text--PACKT-">sys.executable</code> variable. If the application is not frozen, we'll look for the images in the module directory as before.</p>
    <p class="normal">Now that the script knows where to look for the images, we need to configure our <code class="Code-In-Text--PACKT-">cx_Freeze</code> setup to copy the images into the location we set. To do that, we need to update our <code class="Code-In-Text--PACKT-">build_exe</code> options like so:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># cxsetup.py</span>
cx.setup(
  <span class="hljs-comment">#...</span>
  options={
    <span class="hljs-string">'build_exe'</span>: {
      <span class="hljs-comment">#...</span>
      <span class="code-highlight"><strong class="hljs-string-slc">'include_files'</strong><strong class="hljs-slc">: [(</strong><strong class="hljs-string-slc">'abq_data_entry/images'</strong><strong class="hljs-slc">, </strong><strong class="hljs-string-slc">'images'</strong><strong class="hljs-slc">)]</strong></span>
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">include_files</code> argument is a list of two-tuples. The first tuple member is a source path relative to the <code class="Code-In-Text--PACKT-">cxsetup.py</code> script, while the second is a destination path relative to the executable file. In this case, we're telling it to copy the files in the <code class="Code-In-Text--PACKT-">abq_data_entry/images</code> directory<a id="_idIndexMarker1617"/> to a directory called <code class="Code-In-Text--PACKT-">images</code> in the generated executable directory.</p>
    <h2 id="_idParaDest-458" class="title">Building executables</h2>
    <p class="normal">At this point, we can<a id="_idIndexMarker1618"/> build an executable by running the following command line:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python cxsetup.py build
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">build</code> command runs all steps up to <code class="Code-In-Text--PACKT-">build_exe</code>, leaving you with the built code in a platform-specific directory under <code class="Code-In-Text--PACKT-">./build</code> in the format <code class="Code-In-Text--PACKT-">exe.(os)-(cpu_arch)-(python_version)</code>. For example, if you ran this command on 64-bit Linux with Python 3.9, you'd have a <code class="Code-In-Text--PACKT-">build/exe.linux-x86_64-3.9</code> directory containing the compiled code. You can inspect this directory to make sure files are being copied over and created properly, as well as testing the generated executable binary file. In the case of our application, <code class="Code-In-Text--PACKT-">cx_Freeze</code> should have created a binary executable file called <code class="Code-In-Text--PACKT-">abq</code>, which will launch your application when run. It should also have created <code class="Code-In-Text--PACKT-">lib</code> and <code class="Code-In-Text--PACKT-">images</code> directories, and copied the <code class="Code-In-Text--PACKT-">abq.ico</code> file.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Note that all files in the platform-specific build directory must be present for the program to run; <code class="Code-In-Text--PACKT-">cx_Freeze</code> does not support the creation of single-file standalone executables.</p>
    </div>
    <p class="normal">For Linux and BSD, this build directory can be zipped up and distributed as is; users on other computers should be able to just extract the directory and execute the file. For Windows and macOS, though, we're going to need to do some more work to get it ready for distribution. In fact, you may even have gotten an error running the build command or executing the binary. We'll talk about the platform-specific tweaks and configurations that need to happen in the next section.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-"><code class="Code-In-Text--PACKT-">cx_Freeze</code> supports the creation of RPM files, the package format used by certain Linux distributions such as Fedora or SUSE. If you're on an RPM-based distribution, you may want to investigate this option. Unfortunately, there is no build operation to build packages for non-RPM distributions such as Debian, Ubuntu, or<a id="_idIndexMarker1619"/> Arch.</p>
    </div>
    <h3 id="_idParaDest-459" class="title">Cleaning up the build</h3>
    <p class="normal">Although we<a id="_idIndexMarker1620"/> have a working executable file, you might have noticed that the distributable folder is extremely large for such a simple project as ours. </p>
    <p class="normal">Before calling it a day, it's worth poking around inside the build directories to see what files <code class="Code-In-Text--PACKT-">cx_Freeze</code> is bundling into your application and whether you really need all of it.</p>
    <p class="normal">If you look in the platform-specific build directory under <code class="Code-In-Text--PACKT-">lib/python(python_version)/</code>, you'll find all the libraries that were pulled in as dependencies of our package. You may find that some of these aren't actually necessary for running our application. For example, if you happen to have alternative GUI libraries like PyQt or PySide installed on your system, <code class="Code-In-Text--PACKT-">matplotlib</code> may pull them in as dependencies. </p>
    <p class="normal">If we do end up with extra packages like this, we can remove them using the <code class="Code-In-Text--PACKT-">excludes</code> option of <code class="Code-In-Text--PACKT-">build_exe</code>, like this:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
  options={
    <span class="hljs-comment">#...</span>
    <span class="hljs-string">'build_exe'</span>: {
      <span class="hljs-comment">#...</span>
      <span class="hljs-string">'excludes'</span>: [
        <span class="hljs-string">'PyQt4'</span>, <span class="hljs-string">'PyQt5'</span>, <span class="hljs-string">'PySide'</span>, <span class="hljs-string">'IPython'</span>, <span class="hljs-string">'jupyter_client'</span>,
        <span class="hljs-string">'jupyter_core'</span>, <span class="hljs-string">'ipykernel'</span>,<span class="hljs-string">'ipython_genutils'</span>
      ],
</code></pre>
    <p class="normal">After adding this change, delete your <code class="Code-In-Text--PACKT-">build</code> directory and rerun the build command. You'll see that all these packages are no longer there, and the size of your build is significantly smaller.</p>
    <p class="normal">Knowing what can be included or excluded takes research and some trial and error, but with careful pruning we can bring down the size of our distributable files and the build time for our package considerably.</p>
    <h2 id="_idParaDest-460" class="title">Building Windows executables with cx_Freeze</h2>
    <p class="normal">To build <a id="_idIndexMarker1621"/>executables <a id="_idIndexMarker1622"/>on Microsoft Windows, we need to properly set the <code class="Code-In-Text--PACKT-">base</code> argument to the <code class="Code-In-Text--PACKT-">Executable</code> initializer. Recall from <em class="chapterRef">Chapter 10</em>, <em class="italic">Maintaining Cross-Platform Compatibility</em>, that Windows programs launch in either console or GUI mode. For each platform, <code class="Code-In-Text--PACKT-">cx_Freeze</code> has one or more base executables from which it builds the frozen executable; on Linux, BSD, and macOS the default base executable is acceptable, but on Windows the default base launches the application in console mode. </p>
    <p class="normal">We need to specify a base that will launch our script in GUI mode instead. This can be done by passing a value of <code class="Code-In-Text--PACKT-">Win32GUI</code> to the <code class="Code-In-Text--PACKT-">base</code> argument. So, at the top of our <code class="Code-In-Text--PACKT-">cxsetup.py</code> script, add this code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># cxsetup.py</span>
<span class="hljs-keyword">import</span> platform
base = <span class="hljs-literal">None</span>
target_name = <span class="hljs-string">'abq'</span>
<span class="hljs-keyword">if</span> platform.system() == <span class="hljs-string">"Windows"</span>:
  base = <span class="hljs-string">"Win32GUI"</span>
<span class="hljs-comment"># Inside cx.setup()</span>
  <span class="hljs-comment">#...</span>
  executables=[
    cx.Executable(
      <span class="hljs-string">'abq_data_entry.py'</span>,
      base=base,
      target_name=target_name,
      icon=<span class="hljs-string">'abq.ico'</span>
    )
  ],
</code></pre>
    <p class="normal">As we learned to do in <em class="chapterRef">Chapter 10</em>, <em class="italic">Maintaining Cross-Platform Compatibility</em>, we've used <code class="Code-In-Text--PACKT-">platform.system()</code> to determine the operating system we're running on; if it's Windows, we'll set the base to <code class="Code-In-Text--PACKT-">Win32GUI</code>. For other platforms, <code class="Code-In-Text--PACKT-">base</code> should just be <code class="Code-In-Text--PACKT-">None</code>, causing it to use the default base executable.</p>
    <p class="normal">The application should now build successfully on Windows using <code class="Code-In-Text--PACKT-">python cxsetup.py build</code>, and you should find <code class="Code-In-Text--PACKT-">abq.exe</code> in the <code class="Code-In-Text--PACKT-">build/exe.win-amd64-(python_version)</code> directory.</p>
    <h3 id="_idParaDest-461" class="title">Building a Windows installer file</h3>
    <p class="normal">In addition to <a id="_idIndexMarker1623"/>building a Windows executable, we can build a Windows installer file (<code class="Code-In-Text--PACKT-">.msi</code>) using the <code class="Code-In-Text--PACKT-">bdist_msi</code> operation. While our application could be distributed as is by simply zipping up the build folder and extracting it on the target system, there are a few advantages to using MSI files:</p>
    <ul>
      <li class="bullet">MSI files can be more easily deployed by system administrators in a large-scale Windows environment.</li>
      <li class="bullet">MSI files register the application with the OS when installed, making operations like upgrades, repairs, and uninstallations cleaner.</li>
      <li class="bullet">MSI files have additional setup capabilities, such as an install wizard and desktop shortcut generation.</li>
    </ul>
    <p class="normal">To get started generating an MSI file with <code class="Code-In-Text--PACKT-">cx_Freeze</code>, we'll need to configure some aspects of our MSI by setting values in the <code class="Code-In-Text--PACKT-">bdist_msi</code> dictionary of the <code class="Code-In-Text--PACKT-">options</code> argument.</p>
    <p class="normal">We'll start by specifying an <strong class="keyword">upgrade code</strong>:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
  options = {
    <span class="hljs-comment">#...</span>
    <span class="hljs-string">'bdist_msi'</span>: {
      <span class="hljs-string">'upgrade_code'</span>: <span class="hljs-string">'{12345678-90AB-CDEF-1234-567890ABCDEF}'</span>,
</code></pre>
    <p class="normal">The upgrade<a id="_idIndexMarker1624"/> code is a <strong class="keyword">globally unique identifier</strong> (<strong class="keyword">GUID</strong>) value that will identify this program on the OS. By specifying this, subsequent builds of this <code class="Code-In-Text--PACKT-">.msi</code> file will remove and replace any existing installations of the same program.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Upgrade codes consist of five segments of 8, 4, 4, 4, and 12 characters from 0 to 9 and A to F. They can be created in Microsoft Visual Studio, or using this PowerShell command:</p>
      <pre class="programlisting con"><code class="hljs-con">[System.Guid]::NewGuid().ToString().ToUpper() 
</code></pre>
      <p class="Information-Box--PACKT-">Once specified, you should not change the upgrade code in subsequent builds of your application.</p>
    </div>
    <p class="normal">The MSI installation process can also create application shortcuts, which will be placed on the desktop and/or programs menu when the package is installed. To do this, we'll need to define our shortcuts by creating a list of <strong class="keyword">shortcut table</strong> tuples like these:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># cxsetup.py, after the imports</span>
shortcut_data = [
  (
    <span class="hljs-string">'DesktopShortcut'</span>, <span class="hljs-string">'DesktopFolder'</span>, <span class="hljs-string">'ABQ Data Entry'</span>,
    <span class="hljs-string">'TARGETDIR'</span>, <span class="hljs-string">'[TARGETDIR]'</span> + target_name, <span class="hljs-literal">None</span>,
    <span class="hljs-string">'Data Entry application for ABQ Agrilabs'</span>, <span class="hljs-literal">None</span>,
    <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-string">'TARGETDIR'</span>
  ),
  (
    <span class="hljs-string">'MenuShortcut'</span>, <span class="hljs-string">'ProgramMenuFolder'</span>, <span class="hljs-string">'ABQ Data Entry'</span>,
    <span class="hljs-string">'TARGETDIR'</span>, <span class="hljs-string">'[TARGETDIR]'</span> + target_name, <span class="hljs-literal">None</span>,
    <span class="hljs-string">'Data Entry application for ABQ Agrilabs'</span>, <span class="hljs-literal">None</span>,
    <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-string">'TARGETDIR'</span>
  )
]
</code></pre>
    <p class="normal">The preceding two<a id="_idIndexMarker1625"/> tuples define a shortcut for the desktop and menu, respectively. The data contained in them matches the shortcut table layout described by Microsoft at <a href="https://docs.microsoft.com/en-us/windows/win32/msi/shortcut-table?redirectedfrom=MSDN"><span class="url">https://msdn.microsoft.com/en-us/library/windows/desktop/aa371847.aspx</span></a>.</p>
    <p class="normal">Those fields, in order, are defined by Microsoft as follows:</p>
    <ul>
      <li class="bullet"><strong class="keyword">Shortcut</strong>: The type of shortcut to create; in our case either <code class="Code-In-Text--PACKT-">DesktopShortcut</code> or <code class="Code-In-Text--PACKT-">MenuShortcut</code>.</li>
      <li class="bullet"><strong class="keyword">Directory</strong>: A special directory key into which the shortcut will be copied. Here, <code class="Code-In-Text--PACKT-">DesktopFolder</code> points to the desktop, and <code class="Code-In-Text--PACKT-">ProgramMenuFolder</code> points to the programs folder in the menu.</li>
      <li class="bullet"><strong class="keyword">Name</strong>: The name of the shortcut; in our case, <code class="Code-In-Text--PACKT-">ABQ Data Entry</code>.</li>
      <li class="bullet"><strong class="keyword">Component</strong>: This indicates a program whose installed or uninstalled state determines whether our shortcut should be installed or uninstalled. By specifying <code class="Code-In-Text--PACKT-">TARGETDIR</code>, the install/uninstall state of our shortcuts matches the install/uninstall state of the program directory.</li>
      <li class="bullet"><strong class="keyword">Target</strong>: The executable file that is launched by the shortcut. This will be our <code class="Code-In-Text--PACKT-">target_name</code> attribute, located inside <code class="Code-In-Text--PACKT-">TARGETDIR</code>.</li>
      <li class="bullet"><strong class="keyword">Arguments</strong>: A string of arguments passed to the command. Whatever you specify here is simply appended to the target executable for the shortcut and available in our program from <code class="Code-In-Text--PACKT-">sys.argv</code>. You might use this to, for example, create a second shortcut that launches your application in a test mode. In our case, the ABQ program expects no command-line arguments, so this is <code class="Code-In-Text--PACKT-">None</code>.</li>
      <li class="bullet"><strong class="keyword">Description</strong>: A string used in the description field of the shortcut.</li>
      <li class="bullet"><strong class="keyword">Icon</strong> and <strong class="keyword">IconIndex</strong>: These are used to locate an icon for the shortcut, if we want it to be different from the icon of the executable. These can be left as <code class="Code-In-Text--PACKT-">None</code> since our executable's icon will be used by default.</li>
      <li class="bullet"><strong class="keyword">ShowCmd</strong>: Specifies if the program will be launched minimized, maximized, or normally. Leaving this as <code class="Code-In-Text--PACKT-">None</code> will launch it normally.</li>
      <li class="bullet"><strong class="keyword">WkDir</strong>: Indicates the working directory to be used. We want this to be the program's directory, so we use <code class="Code-In-Text--PACKT-">TARGETDIR</code> here.</li>
    </ul>
    <p class="normal">Once created, these<a id="_idIndexMarker1626"/> shortcut tables need to be included in the data argument of our <code class="Code-In-Text--PACKT-">bdist_msi</code> options, like so:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
  options={
  <span class="hljs-comment">#...</span>
    <span class="hljs-string">'bdist_msi'</span>: {
      <span class="hljs-comment">#...</span>
      <span class="hljs-string">'data'</span>: {<span class="hljs-string">'Shortcut'</span>: shortcut_data}
</code></pre>
    <div class="note">
      <p class="Information-Box--PACKT-">Currently, <code class="Code-In-Text--PACKT-">data</code> is not documented in the <code class="Code-In-Text--PACKT-">cx_Freeze</code> documentation; <code class="Code-In-Text--PACKT-">cx_Freeze</code> uses the standard library's <code class="Code-In-Text--PACKT-">msilib</code> module to build the <code class="Code-In-Text--PACKT-">.msi</code> files, and anything passed into this argument is passed along to the <code class="Code-In-Text--PACKT-">add_data()</code> function of <code class="Code-In-Text--PACKT-">msilib</code>. Refer to the standard library documentation for <code class="Code-In-Text--PACKT-">msilib</code> at <a href="https://docs.python.org/3/library/msilib.html"><span class="url">https://docs.python.org/3/library/msilib.html</span></a> if you're interested in exploring this option further.</p>
    </div>
    <p class="normal">With the <code class="Code-In-Text--PACKT-">bdist_msi</code> options specified, let's build the <code class="Code-In-Text--PACKT-">.msi</code> file as follows:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python cxsetup.py bdist_msi
</code></pre>
    <p class="normal">This command creates a new installer file in the <code class="Code-In-Text--PACKT-">dist</code> directory, which you should be able to install on any compatible Windows system, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="../Images/B17578_16_01.png" alt="Figure 16.1: The MSI install wizard for ABQ Data Entry"/></figure>
    <p class="packt_figref">Figure 16.1: The MSI install wizard for ABQ Data Entry</p>
    <p class="normal">Keep in mind that <code class="Code-In-Text--PACKT-">cx_Freeze</code> uses Python binaries from your build environment in the application build; as a result, 64-bit Python will build a 64-bit executable, and 32-bit Python will build a 32-bit executable. Additionally, builds created on newer versions of Windows may not <a id="_idIndexMarker1627"/>be compatible with older versions of Windows. For maximum compatibility, build your binaries on a 32-bit version of the oldest release of Windows you plan to support.</p>
    <h2 id="_idParaDest-462" class="title">Building macOS executables with cx_Freeze</h2>
    <p class="normal">There <a id="_idIndexMarker1628"/>are<a id="_idIndexMarker1629"/> two build operations that <code class="Code-In-Text--PACKT-">cx_Freeze</code> implements that are specific to macOS: <code class="Code-In-Text--PACKT-">bdist_mac</code> and <code class="Code-In-Text--PACKT-">bdist_dmg</code>. These operations create an <strong class="keyword">application bundle</strong> and <a id="_idIndexMarker1630"/>a <strong class="keyword">compressed disk image</strong> file, respectively. Let's look at <a id="_idIndexMarker1631"/>each operation in more detail.</p>
    <h3 id="_idParaDest-463" class="title">Building macOS application bundles</h3>
    <p class="normal">The <code class="Code-In-Text--PACKT-">bdist_mac</code> build <a id="_idIndexMarker1632"/>operation creates an application bundle, a specially formatted directory with an <code class="Code-In-Text--PACKT-">.app</code> extension that the Mac desktop treats as though it were an executable file. <code class="Code-In-Text--PACKT-">bdist_mac</code> has several configuration options, but we're only going to use two:</p>
    <pre class="programlisting code"><code class="hljs-code">cx.setup(
  <span class="hljs-comment">#...</span>
  options={
    <span class="hljs-comment">#...</span>
    <span class="code-highlight"><strong class="hljs-string-slc">'bdist_mac'</strong><strong class="hljs-slc">: {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-string-slc">'bundle_name'</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">'ABQ-Data-Entry'</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-string-slc">'iconfile'</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">'abq.icns'</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    }</strong></span>
</code></pre>
    <p class="normal">Here, <code class="Code-In-Text--PACKT-">bundle_name</code> sets the name of our application bundle directory, without the <code class="Code-In-Text--PACKT-">.app</code> extension. Normally, this would default to the <code class="Code-In-Text--PACKT-">name</code> argument passed to <code class="Code-In-Text--PACKT-">setup()</code>, which in our case is <code class="Code-In-Text--PACKT-">ABQ_Data_Entry</code>. We're overriding it here to use dashes instead of underscores, as it looks a little less technical for end users. Note that using spaces in this value, while technically valid, tends to create problems for <code class="Code-In-Text--PACKT-">cx_Freeze</code> and is best avoided. The <code class="Code-In-Text--PACKT-">iconfile</code> setting allows us to point to an ICNS file that macOS will use for the application's icon. The dimensions of this image file need to be a square number of pixels that is a power of 2 between 16 and 1,024. A compatible ABQ logo is included in the example code.</p>
    <p class="normal">Refer to the <code class="Code-In-Text--PACKT-">cx_Freeze</code> documentation for additional options here, which include code signing and explicitly specifying additional frameworks for the bundle.</p>
    <p class="normal">Once your configuration options are added, run the <code class="Code-In-Text--PACKT-">cxsetup.py</code> script by using the following command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python3 cxsetup.py bdist_mac
</code></pre>
    <p class="normal">When this process completes, <code class="Code-In-Text--PACKT-">ABQ-Data-Entry.app</code> should appear in the build directory. You can double-click this directory in the macOS GUI to run it from any location, or drag it to the <code class="Code-In-Text--PACKT-">/Applications</code> directory to install it.</p>
    <p class="normal">It should appear something like what is shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="../Images/B17578_16_02.png" alt="Figure 16.2: ABQ-Data-Entry bundle in the build directory"/></figure>
    <p class="packt_figref">Figure 16.2: ABQ-Data-Entry bundle in the build directory</p>
    <p class="normal">If you launch the application from this bundle, you'll see that the app menu no longer reads <strong class="screenText">Python</strong>, as we first saw in <em class="chapterRef">Chapter 10</em>, <em class="italic">Maintaining Cross-Platform Compatibility</em>; it now reads <strong class="screenText">abq</strong>, the<a id="_idIndexMarker1633"/> name of the executable file, which is what we want.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">As with Windows executables, <code class="Code-In-Text--PACKT-">cx_Freeze</code>-generated bundles for macOS are not necessarily backward-compatible, so it's best to create them on the oldest version of macOS that you need to support.</p>
    </div>
    <h3 id="_idParaDest-464" class="title">Building macOS .dmg files</h3>
    <p class="normal">Applications on<a id="_idIndexMarker1634"/> macOS are generally distributed inside a compressed disk image (<code class="Code-In-Text--PACKT-">.dmg</code>) file. The <code class="Code-In-Text--PACKT-">cx_Freeze</code> <code class="Code-In-Text--PACKT-">build_dmg</code> operation allows you to build an application bundle and package it in a DMG file for easy distribution.</p>
    <p class="normal">To do this, simply execute this command instead of the <code class="Code-In-Text--PACKT-">bdist_mac</code> command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span> python3 cxsetup.py bdist_dmg
</code></pre>
    <p class="normal">This command first runs <code class="Code-In-Text--PACKT-">bdist_mac</code> to build the application bundle and then packages it into a DMG file. The configuration options for <code class="Code-In-Text--PACKT-">bdist_dmg</code> allow you to override the filename and include a shortcut to the <code class="Code-In-Text--PACKT-">/Applications</code> directory for easy installation. The built file will appear in the <code class="Code-In-Text--PACKT-">build</code> directory, from which you can copy it to another Macintosh to be mounted and used.</p>
    <h1 id="_idParaDest-465" class="title">Summary</h1>
    <p class="normal">In this chapter, you learned how to prepare and package your application for distribution. You learned how to make your package executable, and how to use <code class="Code-In-Text--PACKT-">setuptools</code> to create source and built distributions of it for internal use within your organization or for distribution in a public index such as PyPI. You also learned how to use <code class="Code-In-Text--PACKT-">cx_Freeze</code> to convert your Python script into an executable file that can be distributed to other systems without installing Python or dependent packages, and how to make application installation packages for Windows and macOS.</p>
    <p class="normal">Congratulations on finishing this book! Together we've taken a simple CSV file and turned it into a complex and robust graphical application. You now have the knowledge and confidence to create user-friendly GUI applications that work with files, databases, networks, and APIs across all major platforms.</p>
    <p class="normal">As for your career with ABQ, you've just received a promotion offer to work with the corporate office as a software developer. There will be much more to learn, but with the skills you've learned so far you are ready for whatever challenges come next. Good luck!</p>
  </div>
</body></html>