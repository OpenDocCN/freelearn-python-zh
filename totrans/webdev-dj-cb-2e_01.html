<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Getting Started with Django 1.8"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with Django 1.8</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Working with a virtual environment</li><li class="listitem" style="list-style-type: disc">Creating a project file structure</li><li class="listitem" style="list-style-type: disc">Handling project dependencies with pip</li><li class="listitem" style="list-style-type: disc">Making your code compatible with both Python 2.7 and Python 3</li><li class="listitem" style="list-style-type: disc">Including external dependencies in your project</li><li class="listitem" style="list-style-type: disc">Configuring settings for development, testing, staging, and production environments</li><li class="listitem" style="list-style-type: disc">Defining relative paths in the settings</li><li class="listitem" style="list-style-type: disc">Creating and including local settings</li><li class="listitem" style="list-style-type: disc">Setting up STATIC_URL dynamically for Subversion users</li><li class="listitem" style="list-style-type: disc">Setting up STATIC_URL dynamically for Git users</li><li class="listitem" style="list-style-type: disc">Setting UTF-8 as the default encoding for MySQL configuration</li><li class="listitem" style="list-style-type: disc">Setting the Subversion ignore property</li><li class="listitem" style="list-style-type: disc">Creating a Git ignore file</li><li class="listitem" style="list-style-type: disc">Deleting Python-compiled files</li><li class="listitem" style="list-style-type: disc">Respecting the import order in Python files</li><li class="listitem" style="list-style-type: disc">Creating app configuration</li><li class="listitem" style="list-style-type: disc">Defining overwritable app settings</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Introduction</h1></div></div></div><p>In this chapter, we will see a few good practices when starting a new project with Django 1.8 on Python 2.7 or Python 3. Some of the tricks introduced here are the best ways to deal with the project layout, settings, and configurations. However, for some tricks, you might have to find some alternatives online or in other books about Django. Feel free to evaluate and choose the best bits and pieces for yourself while digging deep into the Django world.</p><p>I am assuming that you are already familiar with the basics of Django, Subversion and Git version control, MySQL and PostgreSQL databases, and command-line usage. Also, I am assuming that you are probably using a Unix-based operating system, such as Mac OS X or Linux. It makes more sense to develop with Django on Unix-based platforms as the websites will most likely be published on a Linux server, therefore, you can establish routines that work the same while developing as well as deploying. If you are locally working with Django on Windows, the routines are similar; however, they are not always the same.</p></div></div>
<div class="section" title="Working with a virtual environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Working with a virtual environment</h1></div></div></div><p>It is very likely that you will develop multiple Django projects on your computer. Some modules such as Python Imaging Library (or Pillow) and MySQLdb, can be installed once and then shared for all projects. Other modules such as Django, third-party Python libraries, and<a class="indexterm" id="id0"/> Django apps, will need to be kept isolated from each other. The virtualenv tool is a utility that separates all the Python projects in their own realms. In this recipe, we will see how to use it.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Getting ready</h2></div></div></div><p>To manage Python packages, you will need <code class="literal">pip</code>. It is included in your Python installation if you are using Python 2.7.9 or Python 3.4+. If you are using another version of<a class="indexterm" id="id1"/> Python, install <code class="literal">pip</code> by executing the installation instructions at <a class="ulink" href="http://pip.readthedocs.org/en/stable/installing/">http://pip.readthedocs.org/en/stable/installing/</a>. Let's install the shared Python modules Pillow and MySQLdb, and the virtualenv utility, using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo pip install Pillow</strong></span>
<span class="strong"><strong>$ sudo pip install MySQL-python</strong></span>
<span class="strong"><strong>$ sudo pip install virtualenv</strong></span>
</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How to do it…</h2></div></div></div><p>Once you have your prerequisites installed, create a directory where all your Django projects will be stored, for example, <code class="literal">virtualenvs</code> under your home directory. Perform the following steps after creating the directory:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the newly created directory and create a virtual environment that uses the shared system site packages:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/virtualenvs</strong></span>
<span class="strong"><strong>$ mkdir myproject_env</strong></span>
<span class="strong"><strong>$ cd myproject_env</strong></span>
<span class="strong"><strong>$ virtualenv --system-site-packages .</strong></span>
<span class="strong"><strong>New python executable in ./bin/python</strong></span>
<span class="strong"><strong>Installing setuptools………….done.</strong></span>
<span class="strong"><strong>Installing pip……………done.</strong></span>
</pre></div></li><li class="listitem">To use your<a class="indexterm" id="id2"/> newly created virtual environment, you need to execute the activation script in your current shell. This can be done with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ source bin/activate</strong></span>
</pre></div><p>You can also use the following command one for the same (note the space between the dot and bin):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ . bin/activate</strong></span>
</pre></div></li><li class="listitem">You will see that the prompt of the command-line tool gets a prefix of the project name, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$</strong></span>
</pre></div></li><li class="listitem">To get out of the virtual environment, type the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ deactivate</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How it works…</h2></div></div></div><p>When you create a virtual environment, a few specific directories (<code class="literal">bin</code>, <code class="literal">build</code>, <code class="literal">include</code>, and <code class="literal">lib</code>) are created in order to store a copy of the Python installation and some shared Python paths are defined. When the virtual environment is activated, whatever you have installed with <code class="literal">pip</code> or <code class="literal">easy_install</code> will be put in and used by the site packages of the virtual environment, and not the global site packages of your Python installation.</p><p>To install Django 1.8 in your virtual environment, type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ pip install Django==1.8</strong></span>
</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a project file structure recipe</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Deploying on Apache with mod_wsgi</em></span> recipe in <a class="link" href="ch11.html" title="Chapter 11. Testing and Deployment">Chapter 11</a>, <span class="emphasis"><em>Testing and Deployment</em></span></li></ul></div></div></div>
<div class="section" title="Creating a project file structure"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Creating a project file structure</h1></div></div></div><p>A consistent file structure for your projects makes you well-organized and more productive. When you have the basic workflow defined, you can get in the business logic quicker and <a class="indexterm" id="id3"/>create awesome projects.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Getting ready</h2></div></div></div><p>If you haven't done this yet, create a <code class="literal">virtualenvs</code> directory, where you will keep all your virtual environments (read about this in the <span class="emphasis"><em>Working with a virtual environment</em></span> recipe). This can be created under your home directory.</p><p>Then, create a directory for your project's environment, for example, <code class="literal">myproject_env</code>. Start the virtual environment in it. I would suggest adding the <code class="literal">commands</code> directory for local bash scripts that are related to the project, the <code class="literal">db_backups</code> directory for database dumps, and the <code class="literal">project</code> directory for your Django project. Also, install Django in your virtual environment.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How to do it…</h2></div></div></div><p>Follow these steps in order to create a file structure for your project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With the virtual environment activated, go to the project directory and start a new Django project as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ django-admin.py startproject myproject</strong></span>
</pre></div><p>For clarity, we will rename the newly created directory as <code class="literal">django-myproject</code>. This is the directory that you will put under version control, therefore, it will have the <code class="literal">.git</code>, <code class="literal">.svn</code>, or similar directories.</p></li><li class="listitem">In the <code class="literal">django-myproject</code> directory, create a <code class="literal">README.md</code> file to describe your project to the new developers. You can also put the pip requirements with the Django version and include other external dependencies (read about this in the <span class="emphasis"><em>Handling project dependencies with pip</em></span> recipe). Also, this directory will contain your project's Python package named <code class="literal">myproject</code>; Django apps (I recommend having an app called <code class="literal">utils</code> for different functionalities that are shared throughout the project); a <code class="literal">locale</code> directory for your project translations if it is multilingual; a Fabric deployment script named <code class="literal">fabfile.py</code>, as suggested in the <span class="emphasis"><em>Creating and using the Fabric deployment script</em></span> recipe in <a class="link" href="ch11.html" title="Chapter 11. Testing and Deployment">Chapter 11</a>, <span class="emphasis"><em>Testing and Deployment</em></span>; and the <code class="literal">externals</code> directory for external dependencies that are included in this project if you decide not to use pip requirements.</li><li class="listitem">In your project's Python package, <code class="literal">myproject</code>, create the <code class="literal">media</code> directory for project uploads, the <code class="literal">site_static</code> directory for project-specific static files, the <code class="literal">static</code> directory for collected static files, the <code class="literal">tmp</code> directory for the upload procedure, and the <code class="literal">templates</code> directory for project templates. Also, the <code class="literal">myproject</code> directory should contain your project settings, the <code class="literal">settings.py</code> and <code class="literal">conf</code> directories (read about this in the <span class="emphasis"><em>Configuring settings for development, testing, staging, and production environments</em></span> recipe), as well as the <code class="literal">urls.py</code> URL configuration.</li><li class="listitem">In your <code class="literal">site_static</code> directory, create the <code class="literal">site</code> directory as a namespace for site-specific static files. Then, separate the separated static files in directories in it. For<a class="indexterm" id="id4"/> instance, <code class="literal">scss</code> for Sass files (optional), <code class="literal">css</code> for the generated minified Cascading Style Sheets, <code class="literal">img</code> for styling images and logos, <code class="literal">js</code> for JavaScript, and any third-party module combining all types of files such as the tinymce rich-text editor. Besides the <code class="literal">site</code> directory, the <code class="literal">site_static</code> directory might also contain overwritten static directories of third-party apps, for example, <code class="literal">cms</code> overwriting static files from Django CMS. To generate the CSS files from Sass and minify the JavaScript files, you can use the CodeKit or Prepros applications with a graphical user interface.</li><li class="listitem">Put your templates that are separated by the apps in your templates directory. If a template file represents a page (for example, <code class="literal">change_item.html</code> or <code class="literal">item_list.html</code>), then directly put it in the app's template directory. If the template is included in another template (for example, <code class="literal">similar_items.html</code>), put it in the includes subdirectory. Also, your templates directory can contain a directory called <code class="literal">utils</code> for globally reusable snippets, such as pagination, language chooser, and others.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How it works…</h2></div></div></div><p>The whole file structure for a complete project in a virtual environment will look similar to the following:</p><div class="mediaobject"><img alt="How it works…" src="graphics/B04912_01_01.jpg"/></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Handling project dependencies with pip</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Including external dependencies in your project</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Configuring settings for development, testing, staging, and production environments</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Deploying on Apache with mod_wsgi</em></span> recipe in <a class="link" href="ch11.html" title="Chapter 11. Testing and Deployment">Chapter 11</a>, <span class="emphasis"><em>Testing and Deployment</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating and using the Fabric deployment script</em></span> recipe in <a class="link" href="ch11.html" title="Chapter 11. Testing and Deployment">Chapter 11</a>, <span class="emphasis"><em>Testing and Deployment</em></span></li></ul></div></div></div>
<div class="section" title="Handling project dependencies with pip"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Handling project dependencies with pip</h1></div></div></div><p>The pip is the most convenient tool to install and manage Python packages. Besides installing the<a class="indexterm" id="id5"/> packages one by one, it is possible to <a class="indexterm" id="id6"/>define a list of packages that you want to install and pass it to the tool so that it deals with the list automatically.</p><p>You will need to have at least two different instances of your project: the development environment, where you create new features, and the public website environment that is usually called the production environment in a hosted server. Additionally, there might be development environments for other developers. Also, you may have a testing and staging environment in order to test the project locally and in a public website-like situation.</p><p>For good maintainability, you should be able to install the required Python modules for development, testing, staging, and production environments. Some of the modules will be shared and some of them will be specific. In this recipe, we will see how to organize the project dependencies and manage them with pip.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Getting ready</h2></div></div></div><p>Before using this recipe, you need to have pip installed and a virtual environment activated. For more information on how to do this, read the <span class="emphasis"><em>Working with a virtual environment</em></span> recipe.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it…</h2></div></div></div><p>Execute the following steps one by one to prepare pip requirements for your Django project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's go to your Django project that you have under version control and create the <code class="literal">requirements</code> directory with these text files: <code class="literal">base.txt</code> for shared modules, <code class="literal">dev.txt</code> for development environment, <code class="literal">test.txt</code> for testing environment, <code class="literal">staging.txt</code> for staging environment, and <code class="literal">prod.txt</code> for production.</li><li class="listitem">Edit <code class="literal">base.txt</code> and add the Python modules that are shared in all environments, line by line, for example:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># base.txt</strong></span>
<span class="strong"><strong>Django==1.8</strong></span>
<span class="strong"><strong>djangorestframework</strong></span>
<span class="strong"><strong>-e git://github.com/omab/python-social-auth.git@6b1e301c79#egg=python-social-auth</strong></span>
</pre></div></li><li class="listitem">If the<a class="indexterm" id="id7"/> requirements of a specific<a class="indexterm" id="id8"/> environment are the same as in the <code class="literal">base.txt</code>, add the line including the <code class="literal">base.txt</code> in the requirements file of that environment, for example:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># prod.txt</strong></span>
-r base.txt</pre></div></li><li class="listitem">If there are specific requirements for an environment, add them as shown in the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># dev.txt</strong></span>
-r base.txt
django-debug-toolbar
selenium</pre></div></li><li class="listitem">Now, you can run the following command in order to install all the required dependencies for development environment (or analogous command for other environments), as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ pip install -r requirements/dev.txt</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How it works…</h2></div></div></div><p>The preceding command downloads and installs all your project dependencies from <code class="literal">requirements/base.txt</code> and <code class="literal">requirements/dev.txt</code> in your virtual environment. As you can see, you can specify a version of the module that you need for the Django framework and even directly install from a specific commit at the Git repository for the <code class="literal">python-social-auth</code> in our example. In practice, installing from a specific commit would rarely be useful, for instance, only when having third-party dependencies in your project with specific functionality that are not supported in the recent versions anymore.</p><p>When you have many dependencies in your project, it is good practice to stick to specific versions of the Python modules as you can then be sure that when you deploy your project or give it to a new developer, the integrity doesn't get broken and all the modules function without conflicts.</p><p>If you have already manually installed the project <code class="literal">requirements</code> with pip one by one, you can generate the <code class="literal">requirements/base.txt</code> file using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ pip freeze &gt; requirements/base.txt</strong></span>
</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>There's more…</h2></div></div></div><p>If you <a class="indexterm" id="id9"/>want to keep things simple and are sure<a class="indexterm" id="id10"/> that, for all environments, you will be using the same dependencies, you can use just one file for your requirements named <code class="literal">requirements.txt</code>, by definition:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ pip freeze &gt; requirements.txt</strong></span>
</pre></div><p>To install the modules in a new environment simply call the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ pip install -r requirements.txt</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>If you need to install a Python library from other version control system or local path, you can<a class="indexterm" id="id11"/> learn more about pip from the official documentation at <a class="ulink" href="http://pip-python3.readthedocs.org/en/latest/reference/pip_install.html">http://pip-python3.readthedocs.org/en/latest/reference/pip_install.html</a>.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Working with a virtual environment</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Including external dependencies in your project</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Configuring settings for development, testing, staging, and production environments</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Making your code compatible with both Python 2.7 and Python 3"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Making your code compatible with both Python 2.7 and Python 3</h1></div></div></div><p>Since <a class="indexterm" id="id12"/>version 1.7, Django can be<a class="indexterm" id="id13"/> used with Python 2.7 and Python 3. In<a class="indexterm" id="id14"/> this recipe, we will take a look at the operations to make your code compatible with both the Python versions.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Getting ready</h2></div></div></div><p>When creating a new Django project or upgrading an old existing project, consider following the rules given in this recipe.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>How to do it…</h2></div></div></div><p>Making your code compatible with both Python versions consists of the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">At the top of each module, add <code class="literal">from</code> <code class="literal">__future__ import unicode_literals</code> and then use usual quotes without a <code class="literal">u</code> prefix for Unicode strings and a <code class="literal">b</code> prefix for bytestrings.</li><li class="listitem">To ensure that a value is bytestring, use the <code class="literal">django.utils.encoding.smart_bytes</code> function. To ensure that a value is Unicode, use<a class="indexterm" id="id15"/> the <code class="literal">django.utils.encoding.smart_text</code> or <code class="literal">django.utils.encoding.force_text</code> function.</li><li class="listitem">For your <a class="indexterm" id="id16"/>models, instead of the <code class="literal">__unicode__</code> method, use the <code class="literal">__str__</code> method and add the <code class="literal">python_2_unicode_compatible</code> decorator, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># models.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from django.db import models
from django.utils.translation import ugettext_lazy as _
from django.utils.encoding import \
    python_2_unicode_compatible

<span class="strong"><strong>@python_2_unicode_compatible</strong></span>
class NewsArticle(models.Model):
    title = models.CharField(_("Title"), max_length=200)
    content = models.TextField(_("Content"))

    def __str__(self):
        return self.title

    class Meta:
        verbose_name = _("News Article")
        verbose_name_plural = _("News Articles")</pre></div></li><li class="listitem">To iterate through dictionaries, use <code class="literal">iteritems()</code>, <code class="literal">iterkeys()</code>, and <code class="literal">itervalues()</code> from <code class="literal">django.utils.six</code>. Take a look at the following:<div class="informalexample"><pre class="programlisting">from django.utils.six import iteritems
d = {"imported": 25, "skipped": 12, "deleted": 3}
for k, v in iteritems(d):
    print("{0}: {1}".format(k, v))</pre></div></li><li class="listitem">When you capture exceptions, use the <code class="literal">as</code> keyword, as follows:<div class="informalexample"><pre class="programlisting">try:
    article = NewsArticle.objects.get(slug="hello-world")
except NewsArticle.DoesNotExist <span class="strong"><strong>as</strong></span> exc:
    pass
except NewsArticle.MultipleObjectsReturned <span class="strong"><strong>as</strong></span> exc:
    pass</pre></div></li><li class="listitem">To check <a class="indexterm" id="id17"/>the type of a value, use <a class="indexterm" id="id18"/><code class="literal">django.utils.six</code>, as shown in the following:<div class="informalexample"><pre class="programlisting">from django.utils import six
isinstance(val, six.string_types) # previously basestring
isinstance(val, six.text_type) # previously unicode
isinstance(val, bytes) # previously str
isinstance(val, six.integer_types) # previously (int, long)</pre></div></li><li class="listitem">Instead of <code class="literal">xrange</code>, use <code class="literal">range</code> from <code class="literal">django.utils.six.moves</code>, as follows:<div class="informalexample"><pre class="programlisting">from django.utils.six.moves import range
for i in range(1, 11):
    print(i)</pre></div></li><li class="listitem">To check whether the current version is Python 2 or Python 3, you can use the following conditions:<div class="informalexample"><pre class="programlisting">from django.utils import six
if six.PY2:
    print("This is Python 2")
if six.PY3:
    print("This is Python 3")</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How it works…</h2></div></div></div><p>All strings in Django projects should be considered as Unicode strings. Only the input of <code class="literal">HttpRequest</code> and output of <code class="literal">HttpResponse</code> is usually in the UTF-8 encoded bytestring.</p><p>Many functions and methods in Python 3 now return the iterators instead of lists, which make the language more efficient. To make the code compatible with both the Python versions, you can use the six library that is bundled in Django.</p><p>Read more about<a class="indexterm" id="id19"/> writing compatible code in the official Django documentation at <a class="ulink" href="https://docs.djangoproject.com/en/1.8/topics/python3/">https://docs.djangoproject.com/en/1.8/topics/python3/</a>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p><span class="strong"><strong>Downloading the example code</strong></span></p><p>You can download the example code files for all Packt books that you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and<a class="indexterm" id="id20"/> register in<a class="indexterm" id="id21"/> order to have the files e-mailed directly to you.</p></div></div></div></div>
<div class="section" title="Including external dependencies in your project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Including external dependencies in your project</h1></div></div></div><p>Sometimes, it is <a class="indexterm" id="id22"/>better to include external dependencies in your project. This ensures that whenever a developer upgrades third-party modules, all the other developers will receive the upgraded version in the next update from the version control system (Git, Subversion, or others).</p><p>Also, it is better to have external dependencies included in your project when the libraries are taken from <a class="indexterm" id="id23"/>unofficial sources, that is, somewhere other than <span class="strong"><strong>Python Package Index</strong></span> (<span class="strong"><strong>PyPI</strong></span>), or different version control systems.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Getting ready</h2></div></div></div><p>Start with a virtual environment with a Django project in it.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>How to do it…</h2></div></div></div><p>Execute the following steps one by one:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If you haven't done this already, create an externals directory under your Django project <code class="literal">django-myproject</code> directory. Then, create the <code class="literal">libs</code> and <code class="literal">apps</code> directories under it.<p>The <code class="literal">libs</code> directory is for the Python modules that are required by your project, for example, boto, Requests, Twython, Whoosh, and so on. The <code class="literal">apps</code> directory is for third-party Django apps, for example, django-cms, django-haystack, django-storages, and so on.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>I highly recommend that you create the <code class="literal">README.txt</code> files in the <code class="literal">libs</code> and <code class="literal">apps</code> directories, where you mention what each module is for, what the used version or revision is, and where it is taken from.</p></div></div></li><li class="listitem">The directory structure should look something similar to the following:<div class="mediaobject"><img alt="How to do it…" src="graphics/B04912_01_02.jpg"/></div></li><li class="listitem">The next step is to put the external libraries and apps under the Python path so that they are recognized as if they were installed. This can be done by adding the following code in the settings:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># settings.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
import os
import sys

BASE_DIR = os.path.abspath(os.path.join(
    os.path.dirname(__file__), ".."
))

EXTERNAL_LIBS_PATH = os.path.join(
    BASE_DIR, "externals", "libs"
)
EXTERNAL_APPS_PATH = os.path.join(
    BASE_DIR, "externals", "apps"
)
sys.path = ["", EXTERNAL_LIBS_PATH, EXTERNAL_APPS_PATH] + \
    sys.path</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How it works…</h2></div></div></div><p>A module is<a class="indexterm" id="id24"/> meant to be under the Python path if you can run Python and import that module. One of the ways to put a module under the Python path is to modify the <code class="literal">sys.path</code> variable before importing a module that is in an unusual location. The value of <code class="literal">sys.path</code> is a list of directories starting with an empty string for the current directory, followed by the directories in the virtual environment, and finally the globally shared directories of the Python installation. You can see the value of <code class="literal">sys.path</code> in the Python shell, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ python</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; import sys</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; sys.path</strong></span>
</pre></div><p>When trying to import a module, Python searches for the module in this list and returns the first result that is found.</p><p>Therefore, we first define the <code class="literal">BASE_DIR</code> variable, which is the absolute path to one level higher than the <code class="literal">settings.py</code> file. Then, we define the <code class="literal">EXTERNAL_LIBS_PATH</code> and <code class="literal">EXTERNAL_APPS_PATH</code> variables, which are relative to <code class="literal">BASE_DIR</code>. Lastly, we modify the <code class="literal">sys.path</code> property, adding new paths to the beginning of the list. Note that we also add an empty string as the first path to search, which means that the current directory of any module<a class="indexterm" id="id25"/> should always be checked first before checking other Python paths.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>This way of including external libraries doesn't work cross-platform with the Python packages that have C language bindings, for example, <code class="literal">lxml</code>. For such dependencies, I would recommend using the pip requirements that were introduced in the <span class="emphasis"><em>Handling project dependencies with pip</em></span> recipe.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a project file structure</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Handling project dependencies with pip</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Defining relative paths in the settings</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using the Django shell</em></span> recipe in <a class="link" href="ch10.html" title="Chapter 10. Bells and Whistles">Chapter 10</a>, <span class="emphasis"><em>Bells and Whistles</em></span></li></ul></div></div></div>
<div class="section" title="Configuring settings for development, testing, staging, and production environments"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Configuring settings for development, testing, staging, and production environments</h1></div></div></div><p>As noted <a class="indexterm" id="id26"/>earlier, you will be creating new <a class="indexterm" id="id27"/>features in the development<a class="indexterm" id="id28"/> environment, test them in the testing<a class="indexterm" id="id29"/> environment, then put the website to a staging server to let other people to try the new features, and lastly, the website will be deployed to the production server for public access. Each of these environments can have specific settings and you will see how to organize them in this recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>Getting ready</h2></div></div></div><p>In a Django project, we'll create settings for each environment: development, testing, staging, and production.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How to do it…</h2></div></div></div><p>Follow these steps to configure project settings:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In <code class="literal">myproject</code> directory, create a <code class="literal">conf</code> Python module with the following files: <code class="literal">__init__.py</code>, <code class="literal">base.py</code> for shared settings, <code class="literal">dev.py</code> for development settings, <code class="literal">test.py</code> for testing settings, <code class="literal">staging.py</code> for staging settings, and <code class="literal">prod.py</code> for production settings.</li><li class="listitem">Put all your shared settings in <code class="literal">conf/base.py</code>.</li><li class="listitem">If the settings of an environment are the same as the shared settings, then just import everything from <code class="literal">base.py</code> there, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># myproject/conf/prod.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from .base import *</pre></div></li><li class="listitem">Apply<a class="indexterm" id="id30"/> the settings that you<a class="indexterm" id="id31"/> want to attach or overwrite<a class="indexterm" id="id32"/> for your specific environment <a class="indexterm" id="id33"/>in the other files, for example, the development environment settings should go to <code class="literal">dev.py</code> as shown in the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># myproject/conf/dev.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from .base import *
EMAIL_BACKEND = \
    "django.core.mail.backends.console.EmailBackend"</pre></div></li><li class="listitem">At the beginning of the <code class="literal">myproject/settings.py</code>, import the configurations from one of the environment settings and then additionally attach specific or sensitive configurations such as <code class="literal">DATABASES</code> or <code class="literal">API</code> keys that shouldn't be under version control, as follows:<div class="informalexample"><pre class="programlisting"># myproject/settings.py
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from .conf.dev import *

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.mysql",
        "NAME": "myproject",
        "USER": "root",
        "PASSWORD": "root",
    }
}</pre></div></li><li class="listitem">Create a <code class="literal">settings.py.sample</code> file that should contain all the sensitive settings that are necessary for a project to run; however, with empty values set.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How it works…</h2></div></div></div><p>By default, the Django management commands use the settings from <code class="literal">myproject/settings.py</code>. Using the method that is defined in this recipe, we can keep all the<a class="indexterm" id="id34"/> required non-sensitive settings for all <a class="indexterm" id="id35"/>environments under version control in the conf directory. Whereas, the <code class="literal">settings.py</code> file itself would be ignored by version control and will <a class="indexterm" id="id36"/>only contain the settings that are<a class="indexterm" id="id37"/> necessary for the current development, testing, staging, or production environments.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating and including local settings</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Defining relative paths in the settings</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting the Subversion ignore property</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a Git ignore file</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Defining relative paths in the settings"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Defining relative paths in the settings</h1></div></div></div><p>Django requires you to define different file paths in the settings, such as the root of your media, the root of<a class="indexterm" id="id38"/> your static files, the path to templates, the path to translation files, and so on. For each developer of your project, the paths may differ as the virtual environment can be set up anywhere and the user might be working on Mac OS X, Linux, or Windows. Anyway, there is a way to define these paths that are relative to your Django project directory.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>Getting ready</h2></div></div></div><p>To start with, open <code class="literal">settings.py</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>How to do it…</h2></div></div></div><p>Modify your path-related settings accordingly instead of hardcoding the paths to your local directories, as follows:</p><div class="informalexample"><pre class="programlisting"># settings.py
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
import os

BASE_DIR = os.path.abspath(
    os.path.join(os.path.dirname(__file__), "..")
)

MEDIA_ROOT = os.path.join(BASE_DIR, "myproject", "media")

STATIC_ROOT = os.path.join(BASE_DIR, "myproject", "static")

STATICFILES_DIRS = (
    os.path.join(BASE_DIR, "myproject", "site_static"),
)

TEMPLATE_DIRS = (
    os.path.join(BASE_DIR, "myproject", "templates"),
)

LOCALE_PATHS = (
    os.path.join(BASE_DIR, "locale"),
)

FILE_UPLOAD_TEMP_DIR = os.path.join(
    BASE_DIR, "myproject", "tmp"
)</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>How it works…</h2></div></div></div><p>At first, we <a class="indexterm" id="id39"/>define <code class="literal">BASE_DIR</code>, which is an absolute path to one level higher than the <code class="literal">settings.py</code> file. Then, we set all the paths relative to <code class="literal">BASE_DIR</code> using the <code class="literal">os.path.join</code> function.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Including external dependencies in your project</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating and including local settings"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Creating and including local settings</h1></div></div></div><p>Configuration doesn't necessarily need to be complex. If you want to keep things simple, you can work <a class="indexterm" id="id40"/>with two settings files: <code class="literal">settings.py</code> for common<a class="indexterm" id="id41"/> configuration and <code class="literal">local_settings.py</code> for sensitive settings that shouldn't be under version control.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>Getting ready</h2></div></div></div><p>Most of the settings for different environments will be shared and saved in version control. However, there will be some settings that are specific to the environment of the project instance, for example, database or e-mail settings. We will put them in the <code class="literal">local_settings.py</code> file.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec36"/>How to do it…</h2></div></div></div><p>To use local settings in your project, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">At the end of <code class="literal">settings.py</code>, add a version of <code class="literal">local_settings.py</code> that claims to be in the same directory, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># settings.py</strong></span>
# … put this at the end of the file …
try:
    execfile(os.path.join(
        os.path.dirname(__file__), "local_settings.py"
    ))
except IOError:
    pass</pre></div></li><li class="listitem">Create <code class="literal">local_settings.py</code> and put your environment-specific settings there, as shown in the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># local_settings.py</strong></span>
DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.mysql",
        "NAME": "myproject",
        "USER": "root",
        "PASSWORD": "root",
    }
}

EMAIL_BACKEND = \
    "django.core.mail.backends.console.EmailBackend"

INSTALLED_APPS += (
    "debug_toolbar",
)</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec37"/>How it works…</h2></div></div></div><p>As you can <a class="indexterm" id="id42"/>see, the local settings are not normally imported, they <a class="indexterm" id="id43"/>are rather included and executed in the <code class="literal">settings.py</code> file itself. This allows you to not only create or overwrite the existing settings, but also adjust the tuples or lists from the <code class="literal">settings.py</code> file. For example, we add <code class="literal">debug_toolbar</code> to <code class="literal">INSTALLED_APPS</code> here in order to be able to debug the SQL queries, template context variables, and so on.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec38"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a project file structure</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Toggling the Debug Toolbar</em></span> recipe in <a class="link" href="ch10.html" title="Chapter 10. Bells and Whistles">Chapter 10</a>, <span class="emphasis"><em>Bells and Whistles</em></span></li></ul></div></div></div>
<div class="section" title="Setting up STATIC_URL dynamically for Subversion users"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Setting up STATIC_URL dynamically for Subversion users</h1></div></div></div><p>If you set <code class="literal">STATIC_URL</code> to a static value, then each time you update a CSS file, JavaScript file, or image, you will need to clear the browser cache in order to see the changes. There is a trick<a class="indexterm" id="id44"/> to work around clearing the browser's<a class="indexterm" id="id45"/> cache. It is to have the revision number of the version control system shown in <code class="literal">STATIC_URL</code>. Whenever the code is updated, the visitor's browser will force the loading of all-new static files.</p><p>This recipe shows how to put a revision number in <code class="literal">STATIC_URL</code> for subversion users.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec39"/>Getting ready</h2></div></div></div><p>Make sure that your project is under the subversion version control and you have <code class="literal">BASE_DIR</code> defined in your settings, as shown in the <span class="emphasis"><em>Defining relative paths in the settings</em></span> recipe.</p><p>Then, create the <code class="literal">utils</code> module in your Django project, and also create a file called <code class="literal">misc.py</code> there.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec40"/>How to do it…</h2></div></div></div><p>The procedure to put the revision number in the <code class="literal">STATIC_URL</code> setting consists of the following two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Insert the following content:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># utils/misc.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
import subprocess

def get_media_svn_revision(absolute_path):
    repo_dir = absolute_path
    svn_revision = subprocess.Popen(
        'svn info | grep "Revision" | awk \'{print $2}\'',
        stdout=subprocess.PIPE, stderr=subprocess.PIPE,
        shell=True, cwd=repo_dir, universal_newlines=True)
    rev = svn_revision.communicate()[0].partition('\n')[0]
    return rev</pre></div></li><li class="listitem">Then, modify the <code class="literal">settings.py</code> file and add the following lines:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># settings.py</strong></span>
# … somewhere after BASE_DIR definition …
from utils.misc import get_media_svn_revision
STATIC_URL = "/static/%s/" % get_media_svn_revision(BASE_DIR)</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec41"/>How it works…</h2></div></div></div><p>The <code class="literal">get_media_svn_revision()</code> function takes the <code class="literal">absolute_path</code> directory as a parameter<a class="indexterm" id="id46"/> and calls the <code class="literal">svn</code> info shell command <a class="indexterm" id="id47"/>in that directory to find out the current revision. We pass <code class="literal">BASE_DIR</code> to the function as we are sure that it is under version control. Then, the revision is parsed, returned, and included in the <code class="literal">STATIC_URL</code> definition.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec42"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting up STATIC_URL dynamically for Git users</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting the Subversion ignore property</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Setting up STATIC_URL dynamically for Git users"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Setting up STATIC_URL dynamically for Git users</h1></div></div></div><p>If you don't want to refresh the browser cache each time you change your CSS and JavaScript <a class="indexterm" id="id48"/>files, or while styling<a class="indexterm" id="id49"/> images, you need to set <code class="literal">STATIC_URL</code> dynamically with a varying path component. With the dynamically changing URL, whenever the code is updated, the visitor's browser will force loading of all-new uncached static files. In this recipe, we will set a dynamic path for <code class="literal">STATIC_URL</code> when you use the Git version control system.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec43"/>Getting ready</h2></div></div></div><p>Make sure<a class="indexterm" id="id50"/> that your project is under the Git <a class="indexterm" id="id51"/>version control and you have <code class="literal">BASE_DIR</code> defined in your settings, as shown in the <span class="emphasis"><em>Defining relative paths in the settings</em></span> recipe.</p><p>If you haven't done it yet, create the <code class="literal">utils</code> module in your Django project. Also, create a <code class="literal">misc.py</code> file there.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec44"/>How to do it…</h2></div></div></div><p>The procedure to put the Git timestamp in the <code class="literal">STATIC_URL</code> setting consists of the following two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following content to the <code class="literal">misc.py</code> file placed in <code class="literal">utils/</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># utils/misc.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
import subprocess
from datetime import datetime

def get_git_changeset(absolute_path):
    repo_dir = absolute_path
    git_show = subprocess.Popen(
        'git show --pretty=format:%ct --quiet HEAD',
        stdout=subprocess.PIPE, stderr=subprocess.PIPE,
        shell=True, cwd=repo_dir, universal_newlines=True,
    )
    timestamp = git_show.communicate()[0].partition('\n')[0]
    try:
        timestamp = \
            datetime.utcfromtimestamp(int(timestamp))
    except ValueError:
        return ""
    changeset = timestamp.strftime('%Y%m%d%H%M%S')
    return changeset</pre></div></li><li class="listitem">Then, import the newly created <code class="literal">get_git_changeset()</code> function in the settings and use it for the <code class="literal">STATIC_URL</code> path, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># settings.py</strong></span>
# … somewhere after BASE_DIR definition …
from utils.misc import get_git_changeset
STATIC_URL = "/static/%s/" % get_git_changeset(BASE_DIR)</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec45"/>How it works…</h2></div></div></div><p>The <code class="literal">get_git_changeset()</code> function takes the <code class="literal">absolute_path</code> directory as a parameter and calls<a class="indexterm" id="id52"/> the <code class="literal">git</code> show shell command<a class="indexterm" id="id53"/> with the parameters to show the Unix timestamp of the <code class="literal">HEAD</code> revision in the directory. As stated in the previous recipe, we pass <code class="literal">BASE_DIR</code> to the function as we are sure that it is under version control. The timestamp is parsed; converted to a string consisting of year, month, day, hour, minutes, and seconds; returned; and included in the definition of <code class="literal">STATIC_URL</code>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec46"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting up STATIC_URL dynamically for Subversion users</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating the Git ignore file</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Setting UTF-8 as the default encoding for MySQL configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Setting UTF-8 as the default encoding for MySQL configuration</h1></div></div></div><p>MySQL is the <a class="indexterm" id="id54"/>most popular open source database. In<a class="indexterm" id="id55"/> this recipe, I will tell you how to set UTF-8 as the default encoding for it. Note that if you don't set this encoding in the database configuration, you might get into a situation where LATIN1 is used by default with your UTF-8 encoded data. This will lead to database errors whenever symbols such as € are used. Also, this recipe will save you from the difficulties of converting the database data from LATIN1 to UTF-8, especially when you have some tables encoded in LATIN1 and others in UTF-8.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec47"/>Getting ready</h2></div></div></div><p>Make sure that the MySQL database management system and the MySQLdb Python module are installed and you are using the MySQL engine in your project's settings.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec48"/>How to do it…</h2></div></div></div><p>Open the <code class="literal">/etc/mysql/my.cnf</code> MySQL configuration file in your favorite editor and ensure that the following settings are set in the sections: <code class="literal">[client]</code>, <code class="literal">[mysql]</code>, and <code class="literal">[mysqld]</code>, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># /etc/mysql/my.cnf</strong></span>
[client]
default-character-set = utf8

[mysql]
default-character-set = utf8

[mysqld]
collation-server = utf8_unicode_ci
init-connect = 'SET NAMES utf8'
character-set-server = utf8</pre></div><p>If any of the<a class="indexterm" id="id56"/> sections don't<a class="indexterm" id="id57"/> exist, create them in the file. Then, restart MySQL in your command-line tool, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ /etc/init.d/mysql restart</strong></span>
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec49"/>How it works…</h2></div></div></div><p>Now, whenever you create a new MySQL database, the databases and all their tables will be set in UTF-8 encoding by default.</p><p>Don't forget to set this in all computers where your project is developed or published.</p></div></div>
<div class="section" title="Setting the Subversion ignore property"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec20"/>Setting the Subversion ignore property</h1></div></div></div><p>If you are using Subversion for version control, you will need to keep most of the projects in the repository; however, some files and directories should only stay locally and not be tracked.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec50"/>Getting ready</h2></div></div></div><p>Make<a class="indexterm" id="id58"/> sure that your Django project is under the Subversion version control.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec51"/>How to do it…</h2></div></div></div><p>Open your command-line tool and set your default editor as <code class="literal">nano</code>, <code class="literal">vi</code>, <code class="literal">vim</code> or any other that you prefer, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ export EDITOR=nano</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>If you don't have a preference, I would recommend using <code class="literal">nano</code>, which is very intuitive and a simple text editor for the terminal.</p></div></div><p>Then, go to your project directory and type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ svn propedit svn:ignore myproject</strong></span>
</pre></div><p>This will open a temporary file in the editor, where you need to put the following file and directory patterns for Subversion to ignore:</p><div class="informalexample"><pre class="programlisting"># Project files and directories
local_settings.py
static
media
tmp

# Byte-compiled / optimized / DLL files
__pycache__
*.py[cod]
*$py.class</pre></div><div class="informalexample"><pre class="programlisting"># C extensions
*.so

# PyInstaller
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov
.tox
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover

# Translations
*.pot

# Django stuff:
*.log

# PyBuilder
target</pre></div><p>Save the<a class="indexterm" id="id59"/> file and exit the editor. For every other Python package in your project, you will need to ignore several files and directories too. Just go to a directory and type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ svn propedit svn:ignore .</strong></span>
</pre></div><p>Then, put this in the temporary file, save it, and close the editor, as follows:</p><div class="informalexample"><pre class="programlisting"># Byte-compiled / optimized / DLL files
__pycache__
*.py[cod]
*$py.class</pre></div><div class="informalexample"><pre class="programlisting"># C extensions
*.so

# PyInstaller
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov
.tox
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover

# Translations
*.pot

# Django stuff:
*.log

# PyBuilder
target</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec52"/>How it works…</h2></div></div></div><p>In Subversion, you need to define the ignore properties for each directory of your project. Mainly, we<a class="indexterm" id="id60"/> don't want to track the Python-compiled files, for instance, <code class="literal">*.pyc</code>. We also want to ignore <code class="literal">local_settings.py</code> that is specific for each environment, <code class="literal">static</code> that replicates collected static files from different apps, <code class="literal">media</code> that contains uploaded files and changes together with the database, and <code class="literal">tmp</code> that is temporarily used for file uploads.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>If you keep all your settings in a <code class="literal">conf</code> Python package as described in the <span class="emphasis"><em>Configuring settings for development, testing, staging, and production environments</em></span> recipe, add <code class="literal">settings.py</code> to the ignored files too.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec53"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating and including local settings</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating the Git ignore file</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating the Git ignore file"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec21"/>Creating the Git ignore file</h1></div></div></div><p>If you are using<a class="indexterm" id="id61"/> Git—the most popular distributed version control system—ignoring some files and folders from version control is much easier than with Subversion.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec54"/>Getting ready</h2></div></div></div><p>Make sure that your Django project is under the Git version control.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec55"/>How to do it…</h2></div></div></div><p>Using your favorite text editor, create a <code class="literal">.gitignore</code> file at the root of your Django project and put these files and directories there, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># .gitignore</strong></span>
# Project files and directories
/myproject/local_settings.py
/myproject/static/
/myproject/tmp/
/myproject/media/

# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# C extensions
*.so

# PyInstaller
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov/
.tox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover

# Translations
*.pot

# Django stuff:
*.log

# Sphinx documentation
docs/_build/

# PyBuilder
target/</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec56"/>How it works…</h2></div></div></div><p>The <code class="literal">.gitignore</code> file specifies the paths that should intentionally be untracked by the Git version <a class="indexterm" id="id62"/>control system. The <code class="literal">.gitignore</code> file that we created in this recipe will ignore the Python-compiled files, local settings, collected static files, temporary directory for uploads, and media directory with the uploaded files.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>If you keep<a class="indexterm" id="id63"/> all your settings in a <code class="literal">conf</code> Python package as described in the <span class="emphasis"><em>Configuring settings for development, testing, staging, and production environments</em></span> recipe, add <code class="literal">settings.py</code> to the ignored files too.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec57"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting the Subversion ignore property</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Deleting Python-compiled files"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec22"/>Deleting Python-compiled files</h1></div></div></div><p>When you run your project for the first time, Python compiles all your <code class="literal">*.py</code> code in bytecode-compiled files, <code class="literal">*.pyc</code>, which are used later for execution.</p><p>Normally, when <a class="indexterm" id="id64"/>you change the <code class="literal">*.py</code> files, <code class="literal">*.pyc</code> is recompiled; however, sometimes when switching branches or moving the directories, you need to clean up the compiled files manually.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec58"/>Getting ready</h2></div></div></div><p>Use your favorite editor and edit or create a <code class="literal">.bash_profile</code> file in your home directory.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec59"/>How to do it…</h2></div></div></div><p>Add this alias at the end of <code class="literal">.bash_profile</code>, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ~/.bash_profile</strong></span>
alias delpyc="find . -name \"*.pyc\" -delete"</pre></div><p>Now, to clean the Python-compiled files, go to your project directory and type the following command in the command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ delpyc</strong></span>
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec60"/>How it works…</h2></div></div></div><p>At first, we create a Unix alias that searches for the <code class="literal">*.pyc</code> files and deletes them in the current directory and its children. The <code class="literal">.bash_profile</code> file is executed when you start a new session in the command-line tool.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec61"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting the Subversion ignore property</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating the Git ignore file</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Respecting the import order in Python files"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec23"/>Respecting the import order in Python files</h1></div></div></div><p>When you create the Python modules, it is good practice to stay consistent with the structure in the files. This makes it easier for other developers and yourself to read the code. This recipe will show you how to structure your imports.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec62"/>Getting ready</h2></div></div></div><p>Create a <a class="indexterm" id="id65"/>virtual environment and a Django project in it.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec63"/>How to do it…</h2></div></div></div><p>Use the following structure in a Python file that you create. Just after the first line that defines UTF-8 as the default Python file encoding, put the imports categorized in sections, as follows:</p><div class="informalexample"><pre class="programlisting"># -*- coding: UTF-8 -*-
# System libraries
from __future__ import unicode_literals
import os
import re
from datetime import datetime

# Third-party libraries
import boto
from PIL import Image

# Django modules
from django.db import models
from django.conf import settings

# Django apps
from cms.models import Page

# Current-app modules
from . import app_settings</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec64"/>How it works…</h2></div></div></div><p>We have five main categories for the imports, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">System libraries for packages in the default installation of Python</li><li class="listitem" style="list-style-type: disc">Third-party libraries for the additionally installed Python packages</li><li class="listitem" style="list-style-type: disc">Django modules for different modules from the Django framework</li><li class="listitem" style="list-style-type: disc">Django <a class="indexterm" id="id66"/>apps for third-party and local apps</li><li class="listitem" style="list-style-type: disc">Current-app modules for relative imports from the current app</li></ul></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec65"/>There's more…</h2></div></div></div><p>When coding in Python and Django, use the official style guide for Python code, PEP 8. You can <a class="indexterm" id="id67"/>find it at <a class="ulink" href="https://www.python.org/dev/peps/pep-0008/">https://www.python.org/dev/peps/pep-0008/</a>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec66"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Handling project dependencies with pip</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Including external dependencies in your project</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating app configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec24"/>Creating app configuration</h1></div></div></div><p>When developing a website with Django, you create one module for the project itself and then, multiple<a class="indexterm" id="id68"/> Python modules called applications or apps that combine the different modular functionalities and usually consist of models, views, forms, URL configurations, management commands, migrations, signals, tests, and so on. The Django framework has application registry, where all apps and models are collected and later used for configuration and introspection. Since Django 1.7, meta information about apps can be saved in the <code class="literal">AppConfig</code> instance for each used app. Let's create a sample <code class="literal">magazine</code> app to take a look at how to use the app configuration there.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec67"/>Getting ready</h2></div></div></div><p>Either create your Django app manually or using this command in your virtual environment (learn how to use virtual environments in the <span class="emphasis"><em>Working with a virtual environment</em></span> recipe), as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ django-admin.py startapp magazine</strong></span>
</pre></div><p>Add some <code class="literal">NewsArticle</code> model to <code class="literal">models.py</code>, create administration for the model in <code class="literal">admin.py</code>, and put <code class="literal">"magazine"</code> in <code class="literal">INSTALLED_APPS</code> in the settings. If you are not yet familiar with<a class="indexterm" id="id69"/> these tasks, study the official Django tutorial at <a class="ulink" href="https://docs.djangoproject.com/en/1.8/intro/tutorial01/">https://docs.djangoproject.com/en/1.8/intro/tutorial01/</a>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec68"/>How to do it…</h2></div></div></div><p>Follow these steps to create and use the app configuration:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of<a class="indexterm" id="id70"/> all, create the <code class="literal">apps.py</code> file and put this content in it, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># magazine/apps.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from django.apps import AppConfig
from django.utils.translation import ugettext_lazy as _

class MagazineAppConfig(AppConfig):
    name = "magazine"
    verbose_name = _("Magazine")

    def ready(self):
        from . import signals</pre></div></li><li class="listitem">Then, edit the <code class="literal">__init__.py</code> file of the app and put the following content:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># magazine/__init__.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
default_app_config = "magazine.apps.MagazineAppConfig"</pre></div></li><li class="listitem">Lastly, let's create a <code class="literal">signals.py</code> file and add some signal handlers there:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># magazine/signals.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from django.conf import settings
from .models import NewsArticle

@receiver(post_save, sender=NewsArticle)
def news_save_handler(sender, **kwargs):
    if settings.DEBUG:
        print("%s saved." % kwargs['instance'])

@receiver(post_delete, sender=NewsArticle)
def news_delete_handler(sender, **kwargs):
    if settings.DEBUG:
        print("%s deleted." % kwargs['instance'])</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec69"/>How it works…</h2></div></div></div><p>When you run an HTTP server or invoke a management command, <code class="literal">django.setup()</code> is called. It loads the settings, sets up logging, and initializes app registry. The app registry is initialized in three steps, as shown in the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Django imports the configurations for each item from <code class="literal">INSTALLED_APPS</code> in the settings. These items can point to app names or configuration directly, for example,<code class="literal">"magazine"</code> or <code class="literal">"magazine.apps.NewsAppConfig"</code>.</li><li class="listitem" style="list-style-type: disc">Django tries to import <code class="literal">models.py</code> from each app in <code class="literal">INSTALLED_APPS</code> and collect all the models.</li><li class="listitem" style="list-style-type: disc">Finally, Django runs the <code class="literal">ready()</code> method for each app configuration. This method is a correct place to register signal handlers, if you have any. The <code class="literal">ready()</code> method is optional.</li><li class="listitem" style="list-style-type: disc">In our example, the <code class="literal">MagazineAppConfig</code> class sets the configuration for the <code class="literal">magazine</code> app. The <code class="literal">name</code> parameter defines the name of the current app. The <code class="literal">verbose_name</code> parameter is used in the Django model administration, where models are presented and grouped by apps. The <code class="literal">ready()</code> method imports and activates the signal handlers that, when in DEBUG mode, print in the terminal that a <code class="literal">NewsArticle</code> was saved or deleted.</li></ul></div></div><div class="section" title="There is more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec70"/>There is more…</h2></div></div></div><p>After calling <code class="literal">django.setup()</code>, you can load the app configurations and models from the registry as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; from django.apps import apps as django_apps</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; magazine_app_config = django_apps.get_app_config("magazine")</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; magazine_app_config</strong></span>
<span class="strong"><strong>&lt;MagazineAppConfig: magazine&gt;</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; magazine_app_config.models_module</strong></span>
<span class="strong"><strong>&lt;module 'magazine.models' from 'magazine/models.pyc'&gt;</strong></span>
<span class="strong"><strong>NewsArticle = django_apps.get_model("magazine", "NewsArticle")</strong></span>
</pre></div><p>You can<a class="indexterm" id="id71"/> read more about app configuration in the official Django <a class="indexterm" id="id72"/>documentation at <a class="ulink" href="https://docs.djangoproject.com/en/1.8/ref/applications/">https://docs.djangoproject.com/en/1.8/ref/applications/</a></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec71"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Working with a virtual environment</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Defining overwritable app settings</em></span> recipe</li><li class="listitem" style="list-style-type: disc"><a class="link" href="ch06.html" title="Chapter 6. Model Administration">Chapter 6</a>, <span class="emphasis"><em>Model Administration</em></span></li></ul></div></div></div>
<div class="section" title="Defining overwritable app settings"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec25"/>Defining overwritable app settings</h1></div></div></div><p>This recipe will show you how to define settings for your app that can be then overwritten <a class="indexterm" id="id73"/>in your project's <code class="literal">settings.py</code> or <code class="literal">local_settings.py</code> file. This is useful especially for reusable apps.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec72"/>Getting ready</h2></div></div></div><p>Either create your Django app manually or using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>(myproject_env)$ django-admin.py startapp myapp1</strong></span>
</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec73"/>How to do it…</h2></div></div></div><p>If you just have one or two settings, you can use the following pattern in your <code class="literal">models.py</code> file. If the settings are extensive and you want to have them organized better, create an <code class="literal">app_settings.py</code> file in the app and put the settings in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># models.py or app_settings.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from django.conf import settings
from django.utils.translation import ugettext_lazy as _

SETTING1 = getattr(settings, "MYAPP1_SETTING1", u"default value")
MEANING_OF_LIFE = getattr(settings, "MYAPP1_MEANING_OF_LIFE", 42)
STATUS_CHOICES = getattr(settings, "MYAPP1_STATUS_CHOICES", (
    ("draft", _("Draft")),
    ("published", _("Published")),
    ("not_listed", _("Not Listed")),
))</pre></div><p>Then, you can use the app settings in <code class="literal">models.py</code>, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># models.py</strong></span>
# -*- coding: UTF-8 -*-
from __future__ import unicode_literals
from django.db import models
from django.utils.translation import ugettext_lazy as _

from .app_settings import STATUS_CHOICES

class NewsArticle(models.Model):
    # …
    status = models.CharField(_("Status"),
        max_length=20, choices=STATUS_CHOICES
    )</pre></div><p>If you want to overwrite the <code class="literal">STATUS_CHOICES</code> setting for just one project, you simply open <code class="literal">settings.py</code> and<a class="indexterm" id="id74"/> add the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># settings.py</strong></span>
# …
from django.utils.translation import ugettext_lazy as _
MYAPP1_STATUS_CHOICES = (
    ("imported", _("Imported")),
    ("draft", _("Draft")),
    ("published", _("Published")),
    ("not_listed", _("Not Listed")),
    ("expired", _("Expired")),
)</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec74"/>How it works…</h2></div></div></div><p>The <code class="literal">getattr(object, attribute_name[, default_value])</code> Python function tries to get the <code class="literal">attribute_name</code> attribute from object and returns <code class="literal">default_value</code> if it is not found. In this case, different settings are tried in order to be taken from the Django project settings module, and if they are not found, the default values are assigned.</p></div></div></body></html>