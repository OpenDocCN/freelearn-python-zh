<html><head></head><body>
		<div id="_idContainer062">
			<h1 id="_idParaDest-314" class="chapter-number"><a id="_idTextAnchor388"/>8</h1>
			<h1 id="_idParaDest-315"><a id="_idTextAnchor389"/>Advanced Server-Side Development Techniques</h1>
			<p>In <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, you learned how to write methods for a model class, how to extend methods from inherited models, and how to work with record sets. This chapter will deal with more advanced topics, such as working with the environment of a record set, calling a method upon a button click, and working with <strong class="source-inline">onchange</strong> methods. The recipes in this chapter will help you manage more complex business problems. You will learn how to create an understanding by incorporating visual elements and clarifying the process of creating interactive features within Odoo’s application <span class="No-Break">development process.</span></p>
			<p>In this chapter, we will look at the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>Changing the user that performs <span class="No-Break">an action</span></li>
				<li>Calling a method with a <span class="No-Break">modified context</span></li>
				<li>Executing raw <span class="No-Break">SQL queries</span></li>
				<li>Writing a wizard to guide <span class="No-Break">the user</span></li>
				<li>Defining <span class="No-Break"><strong class="source-inline">onchange</strong></span><span class="No-Break"> methods</span></li>
				<li>Calling <strong class="source-inline">onchange</strong> methods on the <span class="No-Break">server side</span></li>
				<li>Defining <strong class="source-inline">onchange</strong> with the <span class="No-Break"><strong class="source-inline">compute</strong></span><span class="No-Break"> method</span></li>
				<li>Defining a model based on a <span class="No-Break">SQL view</span></li>
				<li>Adding custom <span class="No-Break">Settings options</span></li>
				<li>Implementing <span class="No-Break"><strong class="source-inline">init</strong></span><span class="No-Break"> hooks</span></li>
			</ul>
			<h1 id="_idParaDest-316"><a id="_idTextAnchor390"/>Technical requirements</h1>
			<p>For this chapter, you’ll require the Odoo <span class="No-Break">online platform.</span></p>
			<p>All the code used in this chapter can be downloaded from this book’s GitHub repository <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter08"><span class="No-Break">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter08</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-317"><a id="_idTextAnchor391"/>Changing the user that performs an action</h1>
			<p>When writing business logic<a id="_idIndexMarker481"/> code, you may have to perform some actions with a different security context. A typical case is performing an action with <strong class="source-inline">superuser</strong> rights, bypassing security checks. Such a requirement arises when business requirements necessitate operating on records for which users do not have security <span class="No-Break">access rights.</span></p>
			<p>This recipe will show you how to allow normal users to create the <strong class="source-inline">room</strong> record by using <strong class="source-inline">sudo()</strong>. Put simply, we will allow users to create <strong class="source-inline">room</strong> by themselves, even if they do not have the right to create a assign the <span class="No-Break"><strong class="source-inline">room</strong></span><span class="No-Break"> record.</span></p>
			<h2 id="_idParaDest-318"><a id="_idTextAnchor392"/>Getting ready</h2>
			<p>For easier understanding, we will add a new model to manage the hostel room. We will add a new model called <strong class="source-inline">hostel.student</strong>. You can refer to the following definition to add <span class="No-Break">this model:</span></p>
			<pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _description = "Hostel Student Information"
   name = fields.Char("Student Name")
   gender = fields.Selection([("male", "Male"),
       ("female", "Female"), ("other", "Other")],
       string="Gender", help="Student gender")
   active = fields.Boolean("Active", default=True,
       help="Activate/Deactivate hostel record")
   hostel_id = fields.Many2one("hostel.hostel", "hostel", help="Name of hostel")
   room_id = fields.Many2one("hostel.room", "Room",
       help="Select hostel room")
   status = fields.Selection([("draft", "Draft"),
       ("reservation", "Reservation"), ("pending", "Pending"),
       ("paid", "Done"),("discharge", "Discharge"), ("cancel", "Cancel")],
       string="Status", copy=False, default="draft",
       help="State of the student hostel")
   admission_date = fields.Date("Admission Date",
       help="Date of admission in hostel",
       default=fields.Datetime.today)
   discharge_date = fields.Date("Discharge Date",
       help="Date on which student discharge")
   duration = fields.Integer("Duration", compute="_compute_check_duration", inverse="_inverse_duration",
                              help="Enter duration of living")</pre>			<p>You will <a id="_idIndexMarker482"/>need to add a form view, an action, and a menu item to see this new model from the user interface. You will also need to add security rules for the hostel so that they can issue the hostel student. Please refer to <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>, if you don’t know how to add <span class="No-Break">these things.</span></p>
			<p>Alternatively, you can use the ready-made initial module from our GitHub code examples to save time. This module is available in the <strong class="source-inline">Chapter08/00_initial_module</strong> folder. The GitHub code examples are available <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter08/00_initial_module"><span class="No-Break">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter08/00_initial_module</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-319"><a id="_idTextAnchor393"/>How to do it...</h2>
			<p>If you have tested <a id="_idIndexMarker483"/>the module, you will find that only users who have <strong class="source-inline">hostel.room</strong> access rights can mark a room as a manager. Non-hostel users cannot create a room by themselves; they need to ask a <span class="No-Break">manager user:</span></p>
			<ol>
				<li>This user has <strong class="bold">Hostel Manager</strong> access rights, which means they can create <strong class="bold">Hostel </strong><span class="No-Break"><strong class="bold">Room</strong></span><span class="No-Break"> records:</span></li>
			</ol>
			<div>
				<div id="_idContainer055" class="IMG---Figure">
					<img src="image/B20997_08_1.jpg" alt="Figure 8.1 – This user has Hostel Manager access rights"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – This user has Hostel Manager access rights</p>
			<p class="list-inset">As shown in the following screenshot, <strong class="bold">Hostel Manager</strong> can also create <span class="No-Break">room records:</span></p>
			<div>
				<div id="_idContainer056" class="IMG---Figure">
					<img src="image/B20997_08_2.jpg" alt="Figure 8.2 – Hostel Manager can create room records"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – Hostel Manager can create room records</p>
			<ol>
				<li value="2">This <a id="_idIndexMarker484"/>user has <strong class="bold">Hostel User</strong> <span class="No-Break">access rights:</span></li>
			</ol>
			<div>
				<div id="_idContainer057" class="IMG---Figure">
					<img src="image/B20997_08_2.jpg" alt="Figure 8.3 – This user has Hostel User access rights"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – This user has Hostel User access rights</p>
			<p class="list-inset">They can only see <strong class="bold">Hostel </strong><span class="No-Break"><strong class="bold">Room</strong></span><span class="No-Break"> records:</span></p>
			<div>
				<div id="_idContainer058" class="IMG---Figure">
					<img src="image/B20997_08_4.jpg" alt="Figure 8.4 – Hostel User can see only Hostel Room records"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – Hostel User can see only Hostel Room records</p>
			<p class="list-inset">Suppose that we want to add a new feature so that non-hostel users can create a room by themselves, for themselves. We will do this without giving them the access rights for the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model.</span></p>
			<p class="list-inset">So, let’s learn <a id="_idIndexMarker485"/>how to let normal hostel <span class="No-Break">users student.</span></p>
			<ol>
				<li value="3">Add the <strong class="source-inline">action_assign_room()</strong> method to the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span><pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
    ...
    def action_assign_room(self):</pre></li>				<li>In the method, ensure that we are acting on a <span class="No-Break">single record:</span><pre class="source-code">
self.ensure_one()</pre></li>				<li>Raise a warning if a student is not paid (make sure you have imported <strong class="source-inline">UserError</strong> at <span class="No-Break">the top):</span><pre class="source-code">
if self.status != "paid":
           raise UserError(_("You can't assign a room if it's not paid."))</pre></li>				<li>Get the empty recordset of <strong class="source-inline">hostel.room</strong> as <span class="No-Break">a superuser:</span><pre class="source-code">
room_as_superuser = self.env['hostel.room'].sudo()</pre></li>				<li>Create a new <strong class="source-inline">room</strong> record with the <span class="No-Break">appropriate values:</span><pre class="source-code">
room_rec = room_as_superuser.create({
           "name": "Room A-103",
           "room_no": "A-103",
           "floor_no": 1,
           "room_category_id": self.env.ref("my_hostel.single_room_categ").id,
           "hostel_id": self.hostel_id.id,
       })</pre></li>				<li>To trigger<a id="_idIndexMarker486"/> this method from the user interface, add the button to the student <span class="No-Break">form view:</span><pre class="source-code">
&lt;button name="action_assign_room"
                           string="Assign Room"
                           type="object"
                           class="btn-primary"
                       /&gt;</pre></li>				<li>Restart the server and update <strong class="source-inline">my_hostel</strong> to apply the given changes. After the update, you will see an <strong class="bold">Assign Room</strong> button on the student form view, as <span class="No-Break">shown here:</span></li>
			</ol>
			<div>
				<div id="_idContainer059" class="IMG---Figure">
					<img src="image/B20997_08_5.jpg" alt="Figure 8.5 – The Assign Room button on the student form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – The Assign Room button on the student form view</p>
			<p>When you click on that, a new room record will be created. This will also work for non-hostel users. You can test this by accessing Odoo as a <span class="No-Break">demo user.</span></p>
			<h2 id="_idParaDest-320"><a id="_idTextAnchor394"/>How it works...</h2>
			<p>In the first three steps, we added a <a id="_idIndexMarker487"/>new method called <strong class="source-inline">action_assign_room()</strong>. This method will be called when the user clicks on the <strong class="bold">Assign Room</strong> button on the student <span class="No-Break">form view.</span></p>
			<p>In <em class="italic">Step 4</em>, we used <strong class="source-inline">sudo()</strong>. This method returns a new recordset with a modified <strong class="source-inline">environment</strong> in which the user has <strong class="source-inline">superuser</strong> rights. When <strong class="source-inline">recordset</strong> is called with <strong class="source-inline">sudo()</strong>, the environment will modify the <strong class="source-inline">environment</strong> attribute to <strong class="source-inline">su</strong>, which indicates the <strong class="source-inline">superuser</strong> state of the environment. You can access its status via <strong class="source-inline">recordset.env.su</strong>. All method calls through this <strong class="source-inline">sudo</strong> recordset are made with superuser privileges. To get a better idea of this, remove <strong class="source-inline">.sudo()</strong> from the method and then click on the <strong class="bold">Assign Room</strong> button. It will raise <strong class="source-inline">Access Error</strong> and the user will no longer have access to the model. Simply using <strong class="source-inline">sudo()</strong> will bypass all <span class="No-Break">security rules.</span></p>
			<p>If you need a specific user, you can pass a recordset containing either that user or the database ID of the user, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
public_user = self.env.ref('base.public_user')
hostel_room = self.env['hostel.room'].with_user(public_user)
hostel_room.search([('name', 'ilike', 'Room 101')])</pre>			<p>This code snippet allows you to search for rooms that are visible using the <span class="No-Break"><strong class="source-inline">public</strong></span><span class="No-Break"> user.</span></p>
			<h2 id="_idParaDest-321"><a id="_idTextAnchor395"/>There’s more...</h2>
			<p>Using <strong class="source-inline">sudo()</strong>, you can bypass the access rights and security record rules. Sometimes, you can access multiple records that are meant to be isolated, such as records from different companies in multi-company environments. The <strong class="source-inline">sudo()</strong> recordset bypasses all the security rules <span class="No-Break">of Odoo.</span></p>
			<p>If you are not careful, records that are searched for in this environment may be linked to any company present in the database, which means that you may be leaking information to a user; worse, you may be silently corrupting the database by linking records that belong to <span class="No-Break">different companies.</span></p>
			<p>When using <strong class="source-inline">sudo()</strong>, exercise caution<a id="_idIndexMarker488"/> to avoid unintended consequences, such as inadvertently linking records from different companies. Ensure proper data segregation and consider the potential impact on data integrity and security rules before bypassing <span class="No-Break">access rights.</span></p>
			<p class="callout-heading">Important tip</p>
			<p class="callout">When using <strong class="source-inline">sudo()</strong>, always double-check to ensure that your calls to <strong class="source-inline">search()</strong> do not rely on the standard record rules to filter <span class="No-Break">the results.</span></p>
			<p class="callout">Without using <strong class="source-inline">sudo()</strong>, <strong class="source-inline">search()</strong> calls would respect standard record rules, potentially restricting access to records based on user permissions. This could lead to incomplete or inaccurate search results, affecting data visibility and <span class="No-Break">application functionality.</span></p>
			<h2 id="_idParaDest-322"><a id="_idTextAnchor396"/>See also</h2>
			<p>Check out these references for <span class="No-Break">more information:</span></p>
			<ul>
				<li>If you want to learn more about environments, refer to the <em class="italic">Obtaining an empty recordset for a model</em> recipe in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic </em><span class="No-Break"><em class="italic">Server-Side Development</em></span></li>
				<li>For more information about access control lists and record rules, check out <a href="B20997_10.xhtml#_idTextAnchor549"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <span class="No-Break"><em class="italic">Security Access</em></span></li>
			</ul>
			<h1 id="_idParaDest-323"><a id="_idTextAnchor397"/>Calling a method with a modified context</h1>
			<p><strong class="source-inline">context</strong> is part of the<a id="_idIndexMarker489"/> environment of a recordset. It is used to pass extra information, such as the time zone and the language of the user, from the user interface. You <a id="_idIndexMarker490"/>can also use the context to pass the parameters specified in the actions. Several methods in the standard Odoo add-ons use the context to adapt their business logic based on these context values. It is sometimes necessary to modify the context on a <strong class="source-inline">recordset</strong> value to get the desired results from a method call or the desired value for a <span class="No-Break">computed field.</span></p>
			<p>This recipe will show you how to change the behavior of a method based on values in the <span class="No-Break">environmental context.</span></p>
			<h2 id="_idParaDest-324"><a id="_idTextAnchor398"/>Getting ready</h2>
			<p>For this<a id="_idIndexMarker491"/> recipe, we will use the <strong class="source-inline">my_hostel</strong> module from the previous recipe. On the form view of the <strong class="source-inline">hostel.room</strong> model, we will add a button to remove room members. If a regular resident of a hostel removes other occupants from their assigned room without permission or authorization, it could create disruptions and issues within the accommodation. Note that we already have the same button in the form view of the room, but here, we will explore context usage in Odoo, gaining insights into how it influences system operations <span class="No-Break">and outcomes.</span></p>
			<h2 id="_idParaDest-325"><a id="_idTextAnchor399"/>How to do it...</h2>
			<p>To add a button, you need to perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Add a <strong class="bold">Remove Room Members</strong> button to the form view <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break">:</span><pre class="source-code">
&lt;button name="action_remove_room_members"
                           string="Remove Room Members"
                           type="object"
                           class="btn-primary"
                       /&gt;</pre></li>				<li>Add the <strong class="source-inline">action_remove_room_members()</strong> method to the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span><pre class="source-code">
def action_remove_room_members(self):
   ...</pre></li>				<li>Add the following code to the method to change the context of the environment and call the method to remove the <span class="No-Break">room members:</span><pre class="source-code">
student.with_context(is_hostel_room=True).action_remove_room()</pre></li>				<li>Update <a id="_idIndexMarker492"/>the <strong class="source-inline">action_remove_room()</strong> method of the <strong class="source-inline">hostel.student </strong>model so that a different behavior <span class="No-Break">is exhibited:</span><pre class="source-code">
def action_remove_room(self):
       if self.env.context.get("is_hostel_room"):
           self.room_id = False</pre></li>			</ol>
			<h2 id="_idParaDest-326"><a id="_idTextAnchor400"/>How it works…</h2>
			<p>In Odoo, to modify behavior influenced by context, we did <span class="No-Break">the following:</span></p>
			<ol>
				<li>Identified the <span class="No-Break">target behavior.</span></li>
				<li>Defined the <span class="No-Break">contextual parameters.</span></li>
				<li>Adapted the relevant <span class="No-Break">code sections.</span></li>
				<li>Tested the <span class="No-Break">changes thoroughly.</span></li>
				<li>Ensured compatibility <span class="No-Break">across modules.</span></li>
			</ol>
			<p>In <em class="italic">Step 1</em>, we removed the <span class="No-Break">room members.</span></p>
			<p>In <em class="italic">Step 2</em>, we added a new button, <strong class="bold">Remove Room Members</strong>. The user will use this button to <strong class="bold">Remove </strong><span class="No-Break"><strong class="bold">the Members</strong></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Steps 3</em> and <em class="italic">4</em>, we added a method that will be called when the user clicks on the <strong class="bold">Remove Room </strong><span class="No-Break"><strong class="bold">Members</strong></span><span class="No-Break"> button.</span></p>
			<p>In <em class="italic">Step 5</em>, we called <strong class="source-inline">student.with_context()</strong> with some keyword arguments. This returns a new version of the <strong class="source-inline">room_id</strong> recordset with an updated context. We are adding one key to the context here, <strong class="source-inline">is_hostel_room=True</strong>, but you can add multiple keys if you want. We used <span class="No-Break"><strong class="source-inline">sudo()</strong></span><span class="No-Break"> here.</span></p>
			<p>In <em class="italic">Step 6</em>, we checked whether the context had a positive value for the <span class="No-Break"><strong class="source-inline">is_hostel_room</strong></span><span class="No-Break"> key.</span></p>
			<p>Now, when<a id="_idIndexMarker493"/> the hostel room removes room members in the student form view, the <strong class="source-inline">room</strong> recordset <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">False</strong></span><span class="No-Break">.</span></p>
			<p>This is just a simple example of a modified context, but you can use any method, such as <strong class="source-inline">create()</strong>, <strong class="source-inline">write()</strong>, <strong class="source-inline">unlink()</strong>, and so on. You can also use any custom method based on <span class="No-Break">your requirements.</span></p>
			<h2 id="_idParaDest-327"><a id="_idTextAnchor401"/>There’s more...</h2>
			<p>It is also possible to pass a dictionary to <strong class="source-inline">with_context()</strong>. In this case, the dictionary is used as the new context, which overwrites the current one. So, <em class="italic">Step 5</em> can also be written <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
new_context = self.env.context.copy()
new_context.update({'is_hostel_room': True})
student.with_context(new_context)</pre>			<h2 id="_idParaDest-328"><a id="_idTextAnchor402"/>See also</h2>
			<p>Refer to the following recipes to learn more about contexts <span class="No-Break">in Odoo:</span></p>
			<ul>
				<li>The <em class="italic">Obtaining an empty recordset for a model</em> recipe in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, explains what the <span class="No-Break">environment is</span></li>
				<li>The <em class="italic">Passing parameters to forms and actions – context</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, explains how to modify the context in <span class="No-Break">action definitions</span></li>
				<li>The <em class="italic">Search for records</em> recipe in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, explains <span class="No-Break">active records</span></li>
			</ul>
			<h1 id="_idParaDest-329"><a id="_idTextAnchor403"/>Executing raw SQL queries</h1>
			<p>Most of the <a id="_idIndexMarker494"/>time, you can perform the operations you want by using Odoo’s ORM – for example, you can use the <strong class="source-inline">search()</strong> method to fetch records. However, sometimes, you need more; either you cannot express what you want using the domain syntax (for which some operations are tricky, if not downright impossible) or your query requires several calls to <strong class="source-inline">search()</strong>, which ends up <span class="No-Break">being inefficient.</span></p>
			<p>This recipe<a id="_idIndexMarker495"/> shows you how to use raw SQL queries to get the name and amount a user keeps in a <span class="No-Break">particular room.</span></p>
			<h2 id="_idParaDest-330"><a id="_idTextAnchor404"/>Getting ready</h2>
			<p>For this recipe, we will use the <strong class="source-inline">my_hostel</strong> module from the previous recipe. For simplicity, we will just print the results in a log, but in real scenarios, you will need to use the query result in your business logic. In <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, we will display the result of this query in the <span class="No-Break">user interface.</span></p>
			<h2 id="_idParaDest-331"><a id="_idTextAnchor405"/>How to do it...</h2>
			<p>To get information about the name and amount a user keeps in a particular room, you need to perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Add the <strong class="source-inline">action_category_with_amount()</strong> method <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break">:</span><pre class="source-code">
def action_category_with_amount(self):
    ...</pre></li>				<li>In the method, write the following <span class="No-Break">SQL query:</span><pre class="source-code">
"""
           SELECT
               hrc.name,
               hrc.amount
           FROM
               hostel_room AS hostel_room
           JOIN
               hostel_room_category as hrc ON hrc.id = hostel_room.room_category_id
           WHERE hostel_room.room_category_id = %(cate_id)s;""",
           {'cate_id': self.room_category_id.id}</pre></li>				<li>Execute <span class="No-Break">the query:</span><pre class="source-code">
self.env.cr.execute("""
           SELECT
               hrc.name,
               hrc.amount
           FROM
               hostel_room AS hostel_room
           JOIN
               hostel_room_category as hrc ON hrc.id = hostel_room.room_category_id
           WHERE hostel_room.room_category_id = %(cate_id)s;""",
           {'cate_id': self.room_category_id.id})</pre></li>				<li>Fetch the<a id="_idIndexMarker496"/> result and log it (make sure you have <span class="No-Break">imported </span><span class="No-Break"><strong class="source-inline">logger</strong></span><span class="No-Break">):</span><pre class="source-code">
result = self.env.cr.fetchall()
       _logger.warning("Hostel Room With Amount: %s", result)</pre></li>				<li>Add a button in the form view of the <strong class="source-inline">hostel.room</strong> mode to trigger <span class="No-Break">our method:</span><pre class="source-code">
&lt;button name="action_category_with_amount"
                           string="Log Category With Amount"
                           type="object"
                           class="btn-primary"/&gt;</pre></li>			</ol>
			<p>Don’t forget to import <strong class="source-inline">logger</strong> in this file. Then, restart and update the <span class="No-Break"><strong class="source-inline">my_hostel</strong></span><span class="No-Break"> module.</span></p>
			<h2 id="_idParaDest-332"><a id="_idTextAnchor406"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we <a id="_idIndexMarker497"/>added the <strong class="source-inline">action_category_with_amount()</strong> method, which will be called when the user clicks on the <strong class="bold">Log Category With </strong><span class="No-Break"><strong class="bold">Amount.</strong></span><span class="No-Break"> button.</span></p>
			<p>In <em class="italic">Step 2</em>, we declared a SQL <strong class="bold">SELECT</strong> query. This will return the category that states the amount in a hostel room. If you run this query in the PostgreSQL CLI, you will get a result based on your room data. Here is the sample date based on <span class="No-Break">my database:</span></p>
			<pre class="console">
+---------------------------------------+-------+
| name                                  | amount|
|---------------------------------------+-------|
| Single Room                           | 3000  |
+---------------------------------------+-------+</pre>			<p>In <em class="italic">Step 4</em>, we called the <strong class="source-inline">execute()</strong> method on the database cursor stored in <strong class="source-inline">self.env.cr</strong>. This sends the query to PostgreSQL and <span class="No-Break">executes it.</span></p>
			<p>In <em class="italic">Step 5</em>, we used the <strong class="source-inline">fetchall()</strong> method of the cursor to retrieve a list of rows selected by the query. This method returns a list of rows. In my case, this is <strong class="source-inline">[('Single Room', 3000)]</strong>. From the form of the query we execute, we know that each row will have exactly two values, the first being <strong class="source-inline">name</strong> and the other being the amount a user holds in a particular room. Then, we simply <span class="No-Break">log it.</span></p>
			<p>In <em class="italic">step 6</em>, we added an <strong class="source-inline">Add</strong> button to handle <span class="No-Break">user actions.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If you are executing an <strong class="source-inline">UPDATE</strong> query, you need to manually invalidate the cache since Odoo ORM’s cache is unaware of the changes you made with the <strong class="source-inline">UPDATE</strong> query. To invalidate the cache, you can <span class="No-Break">use </span><span class="No-Break"><strong class="source-inline">self.invalidate_cache()</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-333"><a id="_idTextAnchor407"/>There’s more...</h2>
			<p>The object in <strong class="source-inline">self.env.cr</strong> is a thin <a id="_idIndexMarker498"/>wrapper around a <strong class="source-inline">psycopg2</strong> cursor. The following methods are the ones that you will want to use most of <span class="No-Break">the time:</span></p>
			<ul>
				<li><strong class="source-inline">execute(query, params)</strong>: This executes the SQL query with the parameters marked as <strong class="source-inline">%s</strong> in the query substituted with the values in <strong class="source-inline">params</strong>, which is <span class="No-Break">a tuple</span></li>
			</ul>
			<p class="callout-heading">Warning</p>
			<p class="callout">Never do the substitution yourself; always use formatting options such as <strong class="source-inline">%s</strong>. If you use a technique such as string concatenation, it can make the code vulnerable to <span class="No-Break">SQL injection.</span></p>
			<ul>
				<li><strong class="source-inline">fetchone()</strong>: This returns one row from the database, wrapped in a tuple (even if only one column has been selected by <span class="No-Break">the query)</span></li>
				<li><strong class="source-inline">fetchall()</strong>: This returns all the rows from the database as a list <span class="No-Break">of tuples</span></li>
				<li><strong class="source-inline">dictfetchall()</strong>: This returns all the rows from the database as a list of dictionaries mapping column names <span class="No-Break">to values</span></li>
			</ul>
			<p>Be very careful when dealing with raw <span class="No-Break">SQL queries:</span></p>
			<ul>
				<li>You are bypassing all the security of the application. Ensure that you call <strong class="source-inline">search([('id', 'in', tuple(ids)])</strong> with any list of IDs you are retrieving to filter out records to which the user has <span class="No-Break">no access.</span></li>
				<li>Any modifications you are making are bypassing the constraints set by the add-on modules, except the <strong class="source-inline">NOT NULL</strong>, <strong class="source-inline">UNIQUE</strong>, and <strong class="source-inline">FOREIGN KEY</strong> constraints, which are enforced at the database level. This is also the case for any computed field recomputation triggers, so you may end up corrupting <span class="No-Break">the database.</span></li>
				<li>Avoid the <strong class="source-inline">INSERT/UPDATE</strong> query – inserting or updating records via queries will not run any business logic written by overriding the <strong class="source-inline">create()</strong> and <strong class="source-inline">write()</strong> methods. It will not update stored compute fields and the ORM constraints will be <span class="No-Break">bypassed too.</span></li>
			</ul>
			<h2 id="_idParaDest-334"><a id="_idTextAnchor408"/>See also</h2>
			<p>For access rights management, refer to <a href="B20997_10.xhtml#_idTextAnchor549"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <span class="No-Break"><em class="italic">Security Access</em></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-335"><a id="_idTextAnchor409"/>Writing a wizard to guide the user</h1>
			<p>In the <em class="italic">Using abstract models for reusable model features</em> recipe in <a href="B20997_04.xhtml#_idTextAnchor118"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">Application Models</em>, the <strong class="source-inline">models.TransientModel</strong> base class was introduced. This class has a lot in common with normal models, except that the records of transient models are <a id="_idIndexMarker499"/>periodically cleaned up in the database, hence the name transient. These are used to create wizards or dialogue boxes, which are filled in the user interface by the users and are generally used to perform actions on the persistent records of <span class="No-Break">the database.</span></p>
			<h2 id="_idParaDest-336"><a id="_idTextAnchor410"/>Getting ready</h2>
			<p>For this recipe, we will use the <strong class="source-inline">my_hostel</strong> module from the previous recipes. This recipe will add a new wizard. With this wizard, the user will be assigned <span class="No-Break">the room.</span></p>
			<h2 id="_idParaDest-337"><a id="_idTextAnchor411"/>How to do it...</h2>
			<p>Follow these  steps to add a new wizard for updating the assign room and <span class="No-Break">hostel records:</span></p>
			<ol>
				<li>Add a new transient model to the module with the <span class="No-Break">following definition:</span><pre class="source-code">
class AssignRoomStudentWizard(models.TransientModel):
   _name = 'assign.room.student.wizard'
   room_id = fields.Many2one("hostel.room", "Room", required=True)</pre></li>				<li>Add the <strong class="source-inline">callback</strong> method that performs the action on the transient model. Add the<a id="_idIndexMarker500"/> following code to the <span class="No-Break"><strong class="source-inline">AssignRoomStudentWizard</strong></span><span class="No-Break"> class:</span><pre class="source-code">
def add_room_in_student(self):
       hostel_room_student = self.env['hostel.student'].browse(
           self.env.context.get('active_id'))
       if hostel_room_student:
           hostel_room_student.update({
               'hostel_id': self.room_id.hostel_id.id,
               'room_id': self.room_id.id,
               'admission_date': datetime.today(),
           })</pre></li>				<li>Create a form view for the model. Add the following view definition to the <span class="No-Break">module views:</span><pre class="source-code">
&lt;record id='assign_room_student_wizard_form' model='ir.ui.view'&gt;
   &lt;field name='name'&gt;assign room student wizard form view&lt;/field&gt;
   &lt;field name='model'&gt;assign.room.student.wizard&lt;/field&gt;
   &lt;field name='arch' type='xml'&gt;
       &lt;form string="Assign Room"&gt;
           &lt;sheet&gt;
               &lt;group&gt;
                   &lt;field name='room_id'/&gt;
               &lt;/group&gt;
           &lt;/sheet&gt;
           &lt;footer&gt;
               &lt;button string='Update' name='add_room_in_student' class='btn-primary' type='object'/&gt;
               &lt;button string='Cancel' class='btn-default' special='cancel'/&gt;
           &lt;/footer&gt;
       &lt;/form&gt;
   &lt;/field&gt;
&lt;/record&gt;</pre></li>				<li>Create an <a id="_idIndexMarker501"/>action and a menu entry to display the wizard. Add the following declarations to the module <span class="No-Break">menu file:</span><pre class="source-code">
&lt;record model="ir.actions.act_window" id="action_assign_room_student_wizard"&gt;
   &lt;field name="name"&gt;Assign Room&lt;/field&gt;
   &lt;field name="res_model"&gt;assign.room.student.wizard&lt;/field&gt;
   &lt;field name="view_mode"&gt;form&lt;/field&gt;
   &lt;field name="target"&gt;new&lt;/field&gt;
&lt;/record&gt;</pre></li>				<li>Add access rights for <strong class="source-inline">assign.room.student.wizard</strong> in the <span class="No-Break"><strong class="source-inline">ir.model.access.csv</strong></span><span class="No-Break"> file:</span><pre class="source-code">
access_assign_room_student_wizard_manager,access.assign.room.student.wizard.manager,model_assign_room_student_wizard,my_hostel.group_hostel_manager,1,1,1,1</pre></li>				<li>Update the <strong class="source-inline">my_hostel</strong> module to apply <span class="No-Break">the changes.</span></li>
			</ol>
			<h2 id="_idParaDest-338"><a id="_idTextAnchor412"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we defined a new model. It is no different from other models, apart from the base class, which is <strong class="source-inline">TransientModel</strong> instead of <strong class="source-inline">Model</strong>. Both <strong class="source-inline">TransientModel</strong> and <strong class="source-inline">Model</strong> share a common base class, called <strong class="source-inline">BaseModel</strong>, and if you check the source code of Odoo, you will see that 99% of the work is in <strong class="source-inline">BaseModel</strong> and that both <strong class="source-inline">Model</strong> and <strong class="source-inline">TransientModel</strong> are <span class="No-Break">almost empty.</span></p>
			<p>The only things <a id="_idIndexMarker502"/>that change for the <strong class="source-inline">TransientModel</strong> records are <span class="No-Break">as follows:</span></p>
			<ul>
				<li>Records are periodically removed from the database so that the tables for transient models do not grow <span class="No-Break">over time</span></li>
				<li>You are not allowed to define <strong class="source-inline">one2many</strong> fields on a <strong class="source-inline">TransientModel</strong> instance that refers to a normal model as this will add a column on the persistent model that links to <span class="No-Break">transient data</span></li>
			</ul>
			<p>Use <em class="italic">many2many</em> relations in this case. You can, of course, use <em class="italic">one2many</em> fields if the related model in <em class="italic">one2many</em> is <span class="No-Break">also </span><span class="No-Break"><strong class="source-inline">TransientModel</strong></span><span class="No-Break">.</span></p>
			<p>We define one field in the model for storing the room. We can add other scalar fields so that we can record a scheduled return date, <span class="No-Break">for instance.</span></p>
			<p>In <em class="italic">Step 2</em>, we added the code to the wizard class that will be called when the button defined in <em class="italic">Step 3</em> is clicked on. This code reads the values from the wizard and updates the <span class="No-Break"><strong class="source-inline">hostel.student</strong></span><span class="No-Break"> record.</span></p>
			<p>In <em class="italic">Step 3</em>, we defined a view for our wizard. Refer to the <em class="italic">Document-style forms</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, for details. The important point here is the button in the footer; the <strong class="source-inline">type</strong> attribute is set to <strong class="source-inline">'object'</strong>, which means that when the user clicks on the button, the method with the name specified by the name attribute of the button will <span class="No-Break">be called.</span></p>
			<p>In <em class="italic">Step 4</em>, we ensured that we had an entry point for our wizard in the menu of the application. We use <strong class="source-inline">target='new'</strong> in the action so that the form view is displayed as a dialogue box over the current form. Refer to the <em class="italic">Adding a menu item and window action</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, <span class="No-Break">for details:</span></p>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="image/B20997_08_6.jpg" alt="Figure 8.6 – Wizard for assigning a room to a student"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – Wizard for assigning a room to a student</p>
			<p>In <em class="italic">Step 5</em>, we added<a id="_idIndexMarker503"/> access rights for the <strong class="source-inline">assign.room.student.wizard</strong> model. With this, the manager user will get full rights to the <span class="No-Break"><strong class="source-inline">assign.room.student.wizard</strong></span><span class="No-Break"> model.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Before Odoo v14, <strong class="source-inline">TransientModel</strong> didn’t require any access rules. Anyone can create a record, and they can only access records created by themselves. With Odoo v14, access rights are compulsory <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">TransientModel</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-339"><a id="_idTextAnchor413"/>There’s more...</h2>
			<p>Here are some tips to enhance <span class="No-Break">your wizards.</span></p>
			<h3>Using the context to compute default values</h3>
			<p>The<a id="_idIndexMarker504"/> wizard we are presenting requires the user to fill in the name of the member in the form. There is a feature of the web client that we can<a id="_idIndexMarker505"/> use to save some typing. When an action is executed, <strong class="source-inline">context</strong> is updated with some values that can be used <span class="No-Break">by wizards:</span></p>
			<ul>
				<li><strong class="source-inline">active_model</strong>: This is the name of the model related to the action. This is generally the model being <span class="No-Break">displayed onscreen.</span></li>
				<li><strong class="source-inline">active_id</strong>: This indicates that a single record is active and provides the ID of <span class="No-Break">that record.</span></li>
				<li><strong class="source-inline">active_ids</strong>: If several records are selected, this will be a list containing the IDs. This happens when several items are selected in a tree view when the action is triggered. In a form view, you <span class="No-Break">get </span><span class="No-Break"><strong class="source-inline">[active_id]</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">active_domain</strong>: This is an additional domain on which the wizard <span class="No-Break">will operate.</span></li>
			</ul>
			<p>These values can be used to compute the default values of the model or even directly in the method<a id="_idIndexMarker506"/> called by the button. To improve on the example<a id="_idIndexMarker507"/> in this recipe, if we had a button displayed on the form view of a <strong class="source-inline">hostel.room</strong> model to launch the wizard, the context of the creation of the wizard would contain <strong class="source-inline">{'active_model': 'hostel.room', 'active_id': &lt;hostel_room_id&gt;}</strong>. In that case, you could define the <strong class="source-inline">room_id</strong> field to get a default value computed by the <span class="No-Break">following method:</span></p>
			<pre class="source-code">
def _default_member(self):
    if self.context.get('active_model') == 'hostel.room':
        return self.context.get('active_id', False)</pre>			<h3>Wizards and code reuse</h3>
			<p>In <em class="italic">Step 2</em>, we <a id="_idIndexMarker508"/>can add <strong class="source-inline">self.ensure_one()</strong> at the beginning of the method, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
def add_room_in_student(self):
       hostel_room_student = self.env['hostel.student'].browse(
           self.env.context.get('active_id'))
       if hostel_room_student:
           hostel_room_student.update({
               'hostel_id': self.room_id.hostel_id.id,
               'room_id': self.room_id.id,
               'admission_date': datetime.today(),
           })</pre>			<p>We recommend using v17 in this recipe. It will allow us to reuse the wizard from other parts of the code by creating records for the wizard and putting them in a single recordset (refer to the <em class="italic">Combining recordsets</em> recipe in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, to see how to do this) before calling <strong class="source-inline">add_room_in_student()</strong> on the recordset. Here, the code is trivial, and you don’t need to jump through all those hoops to record that some rooms have been assigned by different students. However, in an Odoo<a id="_idIndexMarker509"/> instance, some operations are much more complex, and it is always nice to have a wizard available that does the right thing. When using these wizards, ensure that you check the source code for any possible use of the <strong class="source-inline">active_model/active_id/active_ids</strong> keys from the context. If this is the case, you need to pass a custom context (refer to the <em class="italic">Calling a method with a modified </em><span class="No-Break"><em class="italic">context</em></span><span class="No-Break"> recipe).</span></p>
			<h2 id="_idParaDest-340"><a id="_idTextAnchor414"/>Redirecting the user</h2>
			<p>The <a id="_idIndexMarker510"/>method in <em class="italic">Step 2</em> doesn’t return anything. This will cause the wizard dialogue to be closed after the action is performed. Another possibility is to have the method return a dictionary with the fields of <strong class="source-inline">ir.action</strong>. In this case, the web client will process the action as if a menu entry had been clicked on by the user. The <strong class="source-inline">get_formview_action()</strong> method defined in the <strong class="source-inline">BaseModel</strong> class can be used to achieve this. For instance, if we wanted to display the form view of the hostel room, we could have written <span class="No-Break">the following:</span></p>
			<pre class="source-code">
def add_room_in_student(self):
       hostel_room_student = self.env['hostel.student'].browse(
           self.env.context.get('active_id'))
       if hostel_room_student:
           hostel_room_student.update({
               'hostel_id': self.room_id.hostel_id.id,
               'room_id': self.room_id.id,
               'admission_date': datetime.today(),
           })
       rooms = self.mapped('room_id')
       action = rooms.get_formview_action()
       if len(rooms.ids) &gt; 1:
           action['domain'] = [('id', 'in', tuple(rooms.ids))]
           action['view_mode'] = 'tree,form'
       return action</pre>			<p>This <a id="_idIndexMarker511"/>builds a list of rooms that have rooms from this wizard (in practice, there will only be one such room when the wizard is called from the user interface) and creates a dynamic action, which displays the room with the <span class="No-Break">specified IDs.</span></p>
			<p>The <em class="italic">redirecting the user</em> technique can be used to create a wizard that must perform several steps one after the other. Each step in the wizard can use the values of the previous steps by providing a <strong class="bold">Next</strong> button. This will call a method defined on the wizard that updates some fields on the wizard, returns an action that will redisplay the same updated wizard, and gets ready for the <span class="No-Break">next step.</span></p>
			<h2 id="_idParaDest-341"><a id="_idTextAnchor415"/>See also</h2>
			<p>Please refer to the following recipes for <span class="No-Break">more details:</span></p>
			<ul>
				<li>Refer to the <em class="italic">Document-style forms</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, for more details on defining a view for <span class="No-Break">a wizard</span></li>
				<li>To understand more about views and calling server-side methods, refer to the <em class="italic">Adding a menu item and window action</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span></li>
				<li>For more details on creating records for the wizard and putting them in a single recordset, refer to the <em class="italic">Combining recordsets</em> recipe in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic </em><span class="No-Break"><em class="italic">Server-Side Development</em></span></li>
			</ul>
			<h1 id="_idParaDest-342"><a id="_idTextAnchor416"/>Defining onchange methods</h1>
			<p>When <a id="_idIndexMarker512"/>writing business logic, it is often the case that some fields are interrelated. We looked at how to specify constraints between fields in the <em class="italic">Adding constraint validations to a model</em> recipe in <a href="B20997_04.xhtml#_idTextAnchor118"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">Application Models</em>. This recipe illustrates a slightly different concept. Here, <strong class="source-inline">onchange</strong> methods are called when a field is modified in the user interface to update the values of other fields of the record in the web client, usually in a <span class="No-Break">form view.</span></p>
			<p>We will illustrate this by providing a wizard similar to the one defined in the <em class="italic">Writing a wizard to guide the user</em> recipe, but that can be used to record duration returns. When a date is set in the form view, the duration is updated for the student. While we are demonstrating <strong class="source-inline">onchange</strong> methods on <strong class="source-inline">Model</strong>, these features are also available on normal <span class="No-Break"><strong class="source-inline">Transient</strong></span><span class="No-Break"> models.</span></p>
			<h2 id="_idParaDest-343"><a id="_idTextAnchor417"/>Getting ready</h2>
			<p>For this recipe, we<a id="_idIndexMarker513"/> will use the <strong class="source-inline">my_hostel</strong> module from the <em class="italic">Writing a form to guide the user</em> recipe of this chapter. We will create a hostel student and add an <strong class="source-inline">onchange</strong> method that will auto-fill the duration when a user selects a discharge date or admission <span class="No-Break">date field.</span></p>
			<p>You will also want to prepare your work by defining the following model for the <span class="No-Break">form view:</span></p>
			<pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _description = "Hostel Student Information"
   admission_date = fields.Date("Admission Date",
       help="Date of admission in hostel",
       default=fields.Datetime.today)
   discharge_date = fields.Date("Discharge Date",
       help="Date on which student discharge")
   duration = fields.Integer("Duration",          inverse="_inverse_duration",help="Enter duration of living")</pre>			<p>Finally, you will need to define a view. These steps will be left as an exercise for you to <span class="No-Break">carry out.</span></p>
			<h2 id="_idParaDest-344"><a id="_idTextAnchor418"/>How to do it...</h2>
			<p>To automatically populate<a id="_idIndexMarker514"/> the duration to return when the user is changed, you need to add an <strong class="source-inline">onchange</strong> method in the <strong class="source-inline">HostelStudent</strong> step, with the <span class="No-Break">following definition:</span></p>
			<pre class="source-code">
   @api.onchange('admission_date', 'discharge_date')
   def onchange_duration(self):
       if self.discharge_date and self.admission_date:
           self.duration = (self.discharge_date.year - \
                           self.admission_date.year) * 12 + \
                           (self.discharge_date.month - \
                           self.admission_date.month)</pre>			<h2 id="_idParaDest-345"><a id="_idTextAnchor419"/>How it works...</h2>
			<p>An <strong class="source-inline">onchange</strong> method uses the <strong class="source-inline">@api.onchange</strong> decorator, which is passed the names of the fields that change and will thus trigger the call to the method. In our case, we say that whenever <strong class="source-inline">admission_date</strong> or <strong class="source-inline">discharge_date</strong> is modified in the user interface, the method must <span class="No-Break">be called.</span></p>
			<p>In the body of the method, we calculated the duration, and we used an attribute assignment to update the <strong class="source-inline">duration</strong> attribute of the <span class="No-Break">from view.</span></p>
			<h2 id="_idParaDest-346"><a id="_idTextAnchor420"/>There’s more...</h2>
			<p>As we have seen in this recipe, the basic use of <strong class="source-inline">onchange</strong> methods is to compute new values for fields when some other fields are changed in the <span class="No-Break">user interface.</span></p>
			<p>Inside the body of the method, you get access to the fields that are displayed in the current view of the record, but not necessarily all the fields of the model. This is because <strong class="source-inline">onchange</strong> methods can be called while the record is being created in the user interface before it is stored in the database! Inside an <strong class="source-inline">onchange</strong> method, <strong class="source-inline">self</strong> is in a special state, denoted by the fact that <strong class="source-inline">self.id</strong> is not an integer, but an instance of <strong class="source-inline">odoo.models.NewId</strong>. Therefore, you must not make any changes to the database in an <strong class="source-inline">onchange</strong> method since the user may end up canceling the creation of the record, which will not roll back any changes made by the <strong class="source-inline">onchange</strong> method during the process <span class="No-Break">of editing.</span></p>
			<h1 id="_idParaDest-347"><a id="_idTextAnchor421"/>Calling onchange methods on the server side</h1>
			<p>The <strong class="source-inline">onchange</strong> method <a id="_idIndexMarker515"/>has a limitation: it will not be invoked when you are performing operations on the server side. <strong class="source-inline">onchange</strong> is only invoked automatically when the dependent operations are performed through the Odoo user interface. Yet, in several cases, these <strong class="source-inline">onchange</strong> methods must be called because they update important fields in the created or updated record. Of course, you can do the required computation yourself, but this is not always possible since the <strong class="source-inline">onchange</strong> method can be added or modified by a third-party add-on module that’s been installed on the instance that you don’t <span class="No-Break">know about.</span></p>
			<p>This recipe explains how to call the <strong class="source-inline">onchange</strong> methods on a record by manually invoking the <strong class="source-inline">onchange</strong> method before creating <span class="No-Break">a record.</span></p>
			<h2 id="_idParaDest-348"><a id="_idTextAnchor422"/>Getting ready</h2>
			<p>In the <em class="italic">Changing the user that performs an action</em> recipe, we added a <strong class="bold">Return Room</strong> button so that users can update the room and hostel by themselves. We now want to do the same for returning the room and hostel; we will just use the <strong class="bold">Assign Room</strong> <span class="No-Break">return wizard.</span></p>
			<h2 id="_idParaDest-349"><a id="_idTextAnchor423"/>How to do it...</h2>
			<p>In this recipe, we will manually update a record of the <strong class="source-inline">hostel.room</strong> model. To do this, you need to perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Import <strong class="source-inline">Form</strong> from the <strong class="source-inline">tests</strong> utility in the <span class="No-Break"><strong class="source-inline">hostel.student.py</strong></span><span class="No-Break"> file:</span><pre class="source-code">
from odoo.tests.common import Form</pre></li>				<li>Create the <strong class="source-inline">return_room</strong> method in the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span><pre class="source-code">
def return_room(self):
    self.ensure_one()</pre></li>				<li>Get an empty recordset <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">assign.room.student.wizard</strong></span><span class="No-Break">:</span><pre class="source-code">
wizard = self.env['assign.room.student.wizard']</pre></li>				<li>Create a <a id="_idIndexMarker516"/>wizard <strong class="source-inline">Form</strong> block, <span class="No-Break">like this:</span><pre class="source-code">
with Form(wizard) as return_form:</pre></li>				<li>Trigger <strong class="source-inline">onchange</strong> by assigning a room and then return the updated value <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">room_id</strong></span><span class="No-Break">:</span><pre class="source-code">
return_form.room_id = self.env.ref('my_hostel.101_room')
       record = return_form.save()                            record.with_context(active_id=self.id).add_room_in_student()</pre></li>			</ol>
			<h2 id="_idParaDest-350"><a id="_idTextAnchor424"/>How it works...</h2>
			<p>For an explanation of <em class="italic">Steps 1</em> to <em class="italic">3</em>, refer to the <em class="italic">Creating new records</em> recipe in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic </em><span class="No-Break"><em class="italic">Server-Side Development</em></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Step 4</em>, we created a virtual form to handle onchange specifications, such as <span class="No-Break">the GUI.</span></p>
			<p><em class="italic">Step 5</em> contains the full logic to return the room and hostel. In the first line, we assigned <strong class="source-inline">room_id</strong> in the wizard. Then, we called the <strong class="source-inline">save()</strong> method of the form, which returned a wizard record. After that, we called the <strong class="source-inline">add_room_in_student()</strong> method to execute the logic to return the updated room <span class="No-Break">and hostel.</span></p>
			<p>The <strong class="source-inline">onchange</strong> method is mostly invoked from the user interface. But in this recipe, we have learned how to use/trigger the business logic of the <strong class="source-inline">onchange</strong> method on the server side. This way, we can create records without bypassing any <span class="No-Break">business logic.</span></p>
			<h2 id="_idParaDest-351"><a id="_idTextAnchor425"/>See also</h2>
			<p>If you want to learn more about creating and updating records, refer to the <em class="italic">Creating new records</em> and <em class="italic">Updating the values of recordset records</em> recipes in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic </em><span class="No-Break"><em class="italic">Server-Side Development</em></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-352"><a id="_idTextAnchor426"/>Defining onchange with the compute method</h1>
			<p>In the <a id="_idIndexMarker517"/>last two recipes, we saw how to define and call the <strong class="source-inline">onchange</strong> method. We also saw its limitation, which is that it can only<a id="_idIndexMarker518"/> be invoked automatically from the user interface. As a solution to this problem, Odoo v13 introduced a new way to define <strong class="source-inline">onchange</strong> behavior. In this recipe, we will learn how to use the <strong class="source-inline">compute</strong> method to produce behavior similar to that of the <span class="No-Break"><strong class="source-inline">onchange</strong></span><span class="No-Break"> method.</span></p>
			<h2 id="_idParaDest-353"><a id="_idTextAnchor427"/>Getting ready</h2>
			<p>For this recipe, we will use the <strong class="source-inline">my_hostel</strong> module from the previous recipe. We will replace the <strong class="source-inline">onchange</strong> method of <strong class="source-inline">hostel.student</strong> with the <span class="No-Break"><strong class="source-inline">compute</strong></span><span class="No-Break"> method.</span></p>
			<h2 id="_idParaDest-354"><a id="_idTextAnchor428"/>How to do it...</h2>
			<p>Follow these steps to modify the <strong class="source-inline">onchange</strong> method with the <span class="No-Break"><strong class="source-inline">compute</strong></span><span class="No-Break"> method:</span></p>
			<ol>
				<li>Replace <strong class="source-inline">api.onchange</strong> in the <strong class="source-inline">onchange_duration()</strong> method with <strong class="source-inline">depends</strong>, <span class="No-Break">like this:</span><pre class="source-code">
@api.depends('admission_date', 'discharge_date')
 def onchange_duration(self):
        ...</pre></li>				<li>Add the <strong class="source-inline">compute</strong> parameter in the definition of the field, <span class="No-Break">like this:</span><pre class="source-code">
duration = fields.Integer("Duration", compute="onchange_duration", inverse="_inverse_duration",
                              help="Enter duration of living")</pre></li>			</ol>
			<p>Upgrade the <strong class="source-inline">my_hostel</strong> module to apply the code, then test the return duration form to see <span class="No-Break">the change.</span></p>
			<h2 id="_idParaDest-355"><a id="_idTextAnchor429"/>How it works...</h2>
			<p>Functionally, our computed <strong class="source-inline">onchange</strong> works like the normal <strong class="source-inline">onchange</strong> method. The only<a id="_idIndexMarker519"/> difference is<a id="_idIndexMarker520"/> that now, <strong class="source-inline">onchange</strong> will be trigged upon backend <span class="No-Break">changes too.</span></p>
			<p>In <em class="italic">Step 1</em>, we replaced <strong class="source-inline">@api.onchange</strong> with <strong class="source-inline">@api.depends</strong>. This is required to recompute the method when the field <span class="No-Break">value changes.</span></p>
			<p>In <em class="italic">Step 2</em>, we registered the <strong class="source-inline">compute</strong> method with the field. As you may have noticed, we used <strong class="source-inline">readonly=False</strong> with the <strong class="source-inline">compute</strong> field definition. By default, <strong class="source-inline">compute</strong> methods are read-only, but by setting <strong class="source-inline">readonly=False</strong>, we are making sure that the field is editable and can <span class="No-Break">be stored.</span></p>
			<h2 id="_idParaDest-356"><a id="_idTextAnchor430"/>See also</h2>
			<p>To learn more about computed fields, refer to the <em class="italic">Adding computed fields to a model</em> recipe in <a href="B20997_04.xhtml#_idTextAnchor118"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <span class="No-Break"><em class="italic">Application Models</em></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-357"><a id="_idTextAnchor431"/>Defining a model based on a SQL view</h1>
			<p>When<a id="_idIndexMarker521"/> working on the design of an <em class="italic">add-on</em> module, we model the data in classes that are then mapped to database tables by Odoo’s ORM. We apply some well-known design principles, such as <em class="italic">separation of concerns</em> and <em class="italic">data normalization</em>. However, at later stages of the module design, it can be useful to aggregate data from several models in a single table and to maybe perform some operations on them on the way, especially for reporting or producing dashboards. To make this easier, and to make use of the full power of the underlying <strong class="source-inline">PostgreSQL</strong> database engine in Odoo, it is possible to define a read-only model backed by a PostgreSQL view, rather than <span class="No-Break">a table.</span></p>
			<p>In this recipe, we will reuse the room model from the <em class="italic">Writing a wizard to guide the user</em> recipe in this chapter, and we will create a new model to make it easier to gather availability about rooms <span class="No-Break">and authors.</span></p>
			<h2 id="_idParaDest-358"><a id="_idTextAnchor432"/>Getting ready</h2>
			<p>For this recipe, we<a id="_idIndexMarker522"/> will use the <strong class="source-inline">my_hostel</strong> module from the previous recipe. We will create a new model called <strong class="source-inline">hostel.room.availability</strong> to hold the <span class="No-Break">availability data.</span></p>
			<h2 id="_idParaDest-359"><a id="_idTextAnchor433"/>How to do it...</h2>
			<p>To create a new model backed by a PostgreSQL view, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Create a new model with the <strong class="source-inline">_auto</strong> class attribute set <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">False</strong></span><span class="No-Break">:</span><pre class="source-code">
class HostelRoomAvailability(models.Model):
   _name = 'hostel.room.availability'
   _auto = False</pre></li>				<li>Declare the fields you want to see in the model, setting them <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">readonly</strong></span><span class="No-Break">:</span><pre class="source-code">
room_id = fields.Many2one('hostel.room', 'Room', readonly=True)
student_per_room = fields.Integer(string="Student Per Rooom",                   readonly=True)
availability = fields.Integer(string="Availability",readonly=True)
amount = fields.Integer(string="Amount", readonly=True)</pre></li>				<li>Define the <strong class="source-inline">init()</strong> method to create <span class="No-Break">the view:</span><pre class="source-code">
def init(self):
       tools.drop_view_if_exists(self.env.cr, self._table)
       query = """
       CREATE OR REPLACE VIEW hostel_room_availability AS (
       SELECT
               min(h_room.id) as id,
               h_room.id as room_id,
               h_room.student_per_room as student_per_room,
               h_room.availability as availability,
               h_room.rent_amount as amount
           FROM
               hostel_room AS h_room
           GROUP BY h_room.id
       );
       """
       self.env.cr.execute(query)</pre></li>				<li>You can <a id="_idIndexMarker523"/>now define views for the new model. A pivot view is especially useful to explore data (refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">).</span></li>
				<li>Don’t forget to define some access rules for the new model (take a look at <a href="B20997_10.xhtml#_idTextAnchor549"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <span class="No-Break"><em class="italic">Security Access</em></span><span class="No-Break">).</span></li>
			</ol>
			<h2 id="_idParaDest-360"><a id="_idTextAnchor434"/>How it works...</h2>
			<p>Normally, Odoo will create a new table for the model you are defining by using the field definitions for the columns. This is because, in the <strong class="source-inline">BaseModel</strong> class, the <strong class="source-inline">_auto</strong> attribute defaults to <strong class="source-inline">True</strong>. In <em class="italic">Step 1</em>, by setting this class attribute to <strong class="source-inline">False</strong>, we tell Odoo that we will manage this <span class="No-Break">by ourselves.</span></p>
			<p>In <em class="italic">Step 2</em>, we defined some fields that will be used by Odoo to generate a table. We took care to flag them as <strong class="source-inline">readonly=True</strong> so that the views do not enable modifications that you will not be able to save since PostgreSQL views <span class="No-Break">are read-only.</span></p>
			<p>In <em class="italic">Step 3</em>, we defined the <strong class="source-inline">init()</strong> method. This method normally does nothing; it is called after <strong class="source-inline">_auto_init()</strong> (which is responsible for table creation when <strong class="source-inline">_auto = True</strong> but<a id="_idIndexMarker524"/> does nothing otherwise), and we use it to create a new SQL view (or to update the existing view in the case of a module upgrade). The view creation query must create a view with column names that match the field names of <span class="No-Break">the model.</span></p>
			<p class="callout-heading">Important tip</p>
			<p class="callout">It is a common mistake to forget to rename the columns in the view definition query. This will cause an error message when Odoo cannot find <span class="No-Break">the column.</span></p>
			<p>Note that we also need to provide an <strong class="source-inline">integer column</strong> value called <strong class="source-inline">ID</strong> that contains <span class="No-Break">unique values.</span></p>
			<h2 id="_idParaDest-361"><a id="_idTextAnchor435"/>There’s more...</h2>
			<p>It is also possible to have some computed and related fields on such models. The only restriction is that the fields cannot be stored (and therefore, you cannot use them to group records <span class="No-Break">or search).</span></p>
			<p>If you need to group by base user, you need to store the field by adding it to the view definition, rather than using a <span class="No-Break">related field.</span></p>
			<h2 id="_idParaDest-362"><a id="_idTextAnchor436"/>See also</h2>
			<p>To learn more, take a look at the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>To learn more about UI views for user actions, refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span></li>
				<li>For a better understanding of access control and record rules, take a look at <a href="B20997_10.xhtml#_idTextAnchor549"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <span class="No-Break"><em class="italic">Security Access</em></span></li>
			</ul>
			<h1 id="_idParaDest-363"><a id="_idTextAnchor437"/>Adding custom Settings options</h1>
			<p>In Odoo, you<a id="_idIndexMarker525"/> can provide optional features through the <strong class="bold">Settings</strong> options. The user can enable or disable this option at any time. We will illustrate how to create <strong class="bold">Settings</strong> options in <span class="No-Break">this recipe.</span></p>
			<h2 id="_idParaDest-364"><a id="_idTextAnchor438"/>Getting ready</h2>
			<p>In previous recipes, we added buttons so that hostel users can click and return rooms. This is not the case for every hostel; however, we will create a <strong class="bold">Settings</strong> option to enable and disable this feature. We will do this by hiding these buttons. In this recipe, we will use the same <strong class="source-inline">my_hostel</strong> module from the <span class="No-Break">previous recipes.</span></p>
			<h2 id="_idParaDest-365"><a id="_idTextAnchor439"/>How to do it...</h2>
			<p>To create custom <strong class="bold">Settings</strong> options, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Add a new field by inheriting the <span class="No-Break"><strong class="source-inline">res.config.settings</strong></span><span class="No-Break"> model:</span><pre class="source-code">
class ResConfigSettings(models.TransientModel):
   _inherit = 'res.config.settings'
   group_hostel_user = fields.Boolean(string="Hostel User", implied_group='my_hostel.group_hostel_user')</pre></li>				<li>Add this field to the existing <strong class="bold">Settings</strong> view with <strong class="source-inline">xpath</strong> (for more details, refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">):</span><pre class="source-code">
&lt;record id="res_config_settings_view_form" model="ir.ui.view"&gt;
       &lt;field name="name"&gt;res.config.settings.view.form.inherit.hostel&lt;/field&gt;
       &lt;field name="model"&gt;res.config.settings&lt;/field&gt;
       &lt;field name="priority" eval="5"/&gt;
       &lt;field name="inherit_id" ref="base.res_config_settings_view_form"/&gt;
       &lt;field name="arch" type="xml"&gt;
           &lt;xpath expr="//div[hasclass('settings')]" position="inside"&gt;
               &lt;div class="app_settings_block" data-string="Hostel" string="Hostel" data-key="my_hostel" groups="my_hostel.group_hostel_manager"&gt;
                   &lt;h2&gt;Hostel&lt;/h2&gt;
                   &lt;div class="row mt16 o_settings_container"&gt;
                       &lt;div class="col-12 col-lg-6 o_setting_box" id="hostel"&gt;
                           &lt;div class="o_setting_left_pane"&gt;
                               &lt;field name="group_hostel_user"/&gt;
                           &lt;/div&gt;
                           &lt;div class="o_setting_right_pane"&gt;
                               &lt;label for="group_hostel_user"/&gt;
                               &lt;div class="text-muted"&gt;
                                   Allow users to hostel user
                               &lt;/div&gt;
                           &lt;/div&gt;
                       &lt;/div&gt;
                   &lt;/div&gt;
               &lt;/div&gt;
           &lt;/xpath&gt;
       &lt;/field&gt;
   &lt;/record&gt;</pre></li>				<li>Add some actions<a id="_idIndexMarker526"/> and a menu <span class="No-Break">for </span><span class="No-Break"><strong class="bold">Settings</strong></span><span class="No-Break">:</span><pre class="source-code">
&lt;record id="hostel_config_settings_action" model="ir.actions.act_window"&gt;
       &lt;field name="name"&gt;Settings&lt;/field&gt;
       &lt;field name="type"&gt;ir.actions.act_window&lt;/field&gt;
       &lt;field name="res_model"&gt;res.config.settings&lt;/field&gt;
       &lt;field name="view_id" ref="res_config_settings_view_form"/&gt;
       &lt;field name="view_mode"&gt;form&lt;/field&gt;
       &lt;field name="target"&gt;inline&lt;/field&gt;
       &lt;field name="context"&gt;{'module' : 'my_hostel'}&lt;/field&gt;
   &lt;/record&gt;
   &lt;menuitem name="Settings" id="hostel_setting_menu" parent="hostel_main_menu" action="hostel_config_settings_action" sequence="50"/&gt;</pre></li>				<li>Restart the server and update the <strong class="source-inline">my_hostel</strong> module to apply the changes, as <span class="No-Break">shown here:</span></li>
			</ol>
			<div>
				<div id="_idContainer061" class="IMG---Figure">
					<img src="image/B20997_08_7.jpg" alt="Figure 8.7 – The hostel user access right settings option to enable and disable this feature"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7 – The hostel user access right settings option to enable and disable this feature</p>
			<h2 id="_idParaDest-366"><a id="_idTextAnchor440"/>How it works...</h2>
			<p>In Odoo, all <a id="_idIndexMarker527"/>settings options are added in the <strong class="source-inline">res.config.settings</strong> model. <strong class="source-inline">res.config.settings</strong> is a transient model. In <em class="italic">Step 1</em>, we created a new security group. We will use this group to create the <strong class="bold">Hide</strong> and <span class="No-Break"><strong class="bold">Show</strong></span><span class="No-Break"> buttons.</span></p>
			<p>In <em class="italic">step 2</em>, we added a new <strong class="source-inline">Boolean</strong> field in the <strong class="source-inline">res.config.settings</strong> model by inheriting it. We added an <strong class="source-inline">implied_group</strong> attribute with a value of <strong class="source-inline">my_hostel.group_hostel_user</strong>. This group will be assigned to all <strong class="source-inline">odoo</strong> users when the admin enables or disables options with the <span class="No-Break"><strong class="source-inline">Boolean</strong></span><span class="No-Break"> field.</span></p>
			<p><strong class="bold">Settings</strong> uses a form view to display settings options on a user interface. All of these options are added in a single form view with an external ID <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">base.res_config_settings_view_form</strong></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Step 3</em>, we added our option to the user interface by inheriting this setting from the view. We used <strong class="source-inline">xpath</strong> to add our <strong class="source-inline">setting</strong> option. We will cover this in more detail in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>. In the form definition, you will find that the attribute data-key value of this option will be your module name. This is only needed when you are adding a whole new tab in <strong class="bold">Settings</strong>. Otherwise, you can just add your option to the <strong class="bold">Settings</strong> tab of the existing module <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">xpath</strong></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Step 4</em>, we added an action and a menu to access the configuration options from the user interface. You will need to pass the <strong class="source-inline">{'module': 'my_hostel'}</strong> context from the action to open the <strong class="bold">Settings</strong> tab of the <strong class="source-inline">my_hostel</strong> module by default when the menu <span class="No-Break">is clicked.</span></p>
			<p>In <em class="italic">Step 5</em>, we added <strong class="source-inline">my_hostel.group_hostel_user</strong> groups to the buttons. Because of this group, the <strong class="bold">Hostel User</strong> and <strong class="bold">Return</strong> buttons will be hidden or shown, based on the <span class="No-Break"><strong class="bold">Settings</strong></span><span class="No-Break"> options.</span></p>
			<p>After this, you <a id="_idIndexMarker528"/>will see a separate <strong class="bold">Settings</strong> tab for the hostel, and, in the tab, you will see a <strong class="source-inline">Boolean</strong> field to enable or disable the <strong class="bold">Hostel User</strong> option. When you enable or disable this option, in the background, Odoo will apply or remove <strong class="source-inline">implied_group</strong> to or from all <strong class="source-inline">odoo</strong> users. Because we added the groups to buttons, the buttons will be displayed if the user has groups and will be hidden if the user doesn’t have groups. We will look at security groups in detail in <a href="B20997_10.xhtml#_idTextAnchor549"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <span class="No-Break"><em class="italic">Security Access</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-367"><a id="_idTextAnchor441"/>There’s more...</h2>
			<p>There are a few other ways to manage the <strong class="bold">Settings</strong> options. One of them is to separate features in the new module and <strong class="source-inline">install</strong> or <strong class="source-inline">uninstall</strong> them through various options. To do this, you will need to add a <strong class="source-inline">Boolean</strong> field with the name of the module prefixed with <strong class="source-inline">module_</strong>. If, for example, we create a new module called <strong class="source-inline">my_hostel_extras</strong>, you will need to add a <strong class="source-inline">Boolean</strong> field, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
module_my_hostel_extras = fields.Boolean(
    string='Hostel Extra Features')</pre>			<p>When you enable or disable this option, <strong class="source-inline">odoo</strong> will <strong class="source-inline">install</strong> or <strong class="source-inline">uninstall</strong> the <span class="No-Break"><strong class="source-inline">my_hostel_extras</strong></span><span class="No-Break"> module.</span></p>
			<p>Another way to manage settings is to use system parameters. Such data is stored in the <strong class="source-inline">ir.config_parameter</strong> model. Here’s how you can create system-wide <span class="No-Break">global parameters:</span></p>
			<pre class="source-code">
digest_emails = fields.Boolean(
        string="Digest Emails",
        config_parameter='digest.default_digest_emails')</pre>			<p>The <strong class="source-inline">config_parameter</strong> attribute in the fields will ensure the user data is stored in <strong class="bold">System Parameters</strong>, under the <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Parameters</strong> | <strong class="bold">System</strong> <strong class="bold">Parameters</strong> menu. The data will be stored with the <span class="No-Break"><strong class="source-inline">digest.default_digest_emails</strong></span><span class="No-Break"> key.</span></p>
			<p>Settings<a id="_idIndexMarker529"/> options are used to make your application generic. These options give freedom to users and allow them to enable or disable features on the fly. When you convert a feature into options, you can serve more customers with one module and your customers can enable the feature whenever <span class="No-Break">they like.</span></p>
			<h1 id="_idParaDest-368"><a id="_idTextAnchor442"/>Implementing init hooks</h1>
			<p>In <a href="B20997_06.xhtml#_idTextAnchor319"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">Managing Module Data</em>, you learned how to add, update, and delete records from XML or CSV files. Sometimes, however, the business case is complex, and it can’t be solved using data files. In such cases, you can use the <strong class="source-inline">init</strong> hook from the manifest file to perform the operations <span class="No-Break">you want.</span></p>
			<p>Complex <a id="_idIndexMarker530"/>business cases may require dynamic initialization of data beyond standard XML or CSV files. Examples include integrating with external systems, performing complex calculations, or configuring records based on runtime conditions, facilitated by the <strong class="source-inline">init</strong> hook in the <span class="No-Break">manifest file.</span></p>
			<h2 id="_idParaDest-369"><a id="_idTextAnchor443"/>Getting ready</h2>
			<p>We will use the same <strong class="source-inline">my_hostel</strong> module from the previous recipe. For simplicity, in this recipe, we will just create some room records <span class="No-Break">through </span><span class="No-Break"><strong class="source-inline">post_init_hook</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-370"><a id="_idTextAnchor444"/>How to do it...</h2>
			<p>To add <strong class="source-inline">post_init_hook</strong>, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Register the hook in the <strong class="source-inline">__manifest__.py</strong> file with the <span class="No-Break"><strong class="source-inline">post_init_hook</strong></span><span class="No-Break"> key:</span><pre class="source-code">
...
'post_init_hook': 'add_room_hook',
...</pre></li>				<li>Add the <strong class="source-inline">add_room_hook()</strong> method to the <span class="No-Break"><strong class="source-inline">__init__.py</strong></span><span class="No-Break"> file:</span><pre class="source-code">
from odoo import api, SUPERUSER_ID
def add_room_hook(cr, registry):
   env = api.Environment(cr, SUPERUSER_ID, {})
   room_data1 = {'name': 'Room 1', 'room_no': '01'}
   room_data2 = {'name': 'Room 2', 'room_no': '02'}
   env['hostel.room'].create([room_data1, room_data2])</pre></li>			</ol>
			<h2 id="_idParaDest-371"><a id="_idTextAnchor445"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we registered <strong class="source-inline">post_init_hook</strong> in the manifest file with the <strong class="source-inline">add_room_hook</strong> value. This means that after the module is installed, Odoo will look for the <strong class="source-inline">add_room_hook</strong> method in <strong class="source-inline">__init__.py</strong>. The <strong class="source-inline">post_init_hook</strong> value receives the environment as an argument, showcasing an instance of the <strong class="source-inline">add_room_hook</strong> function that executes after <span class="No-Break">module installation.</span></p>
			<p>In <em class="italic">Step 2</em>, we <a id="_idIndexMarker531"/>declared the <strong class="source-inline">add_room_hook()</strong> method, which will be called after the module is installed. We created two records from this method. In real-life scenarios, you can write complex business <span class="No-Break">logic here.</span></p>
			<p>In this example, we looked at <strong class="source-inline">post_init_hook</strong>, but Odoo supports two <span class="No-Break">more hooks:</span></p>
			<ul>
				<li><strong class="source-inline">pre_init_hook</strong>: This hook will be invoked when you start installing a module. It is the opposite of <strong class="source-inline">post_init_hook</strong>; it will be invoked after installing the <span class="No-Break">current module:</span><ol><li class="Alphabets">Register the hook in the <strong class="source-inline">__manifest__.py</strong> file with the <span class="No-Break"><strong class="source-inline">pre_init_hook</strong></span><span class="No-Break"> key:</span></li></ol><pre class="source-code">
...
'pre_init_hook': 'pre_init_hook_hostel',
...</pre></li>			</ul>
			<ol>
				<li class="Alphabets" value="2">Add the <strong class="source-inline">pre_init_hook_hostel()</strong> method to the <span class="No-Break"><strong class="source-inline">__init__.py </strong></span><span class="No-Break">file:</span></li>
			</ol>
			<pre class="source-code">
def pre_init_hook_hostel(env):
   env['ir.model.data'].search([
       ('model', 'like', 'hostel.hostel'),
   ]).unlink()</pre>			<ul>
				<li><strong class="source-inline">uninstall_hook</strong>: This hook will be invoked when you uninstall the module. This is mostly used when your module needs a <span class="No-Break">garbage-collection mechanism:</span></li>
			</ul>
			<ol>
				<li class="Alphabets" value="3">Register the hook in the <strong class="source-inline">__manifest__.py</strong> file with the <span class="No-Break"><strong class="source-inline">uninstall_hook</strong></span><span class="No-Break"> key:</span></li>
			</ol>
			<pre class="source-code">
...
'uninstall_hook': 'uninstall_hook_user',
...</pre>			<ol>
				<li class="Alphabets" value="4">Add <strong class="source-inline">uninstall_hook_user()</strong> method to the <span class="No-Break"><strong class="source-inline">__init__.py</strong></span><span class="No-Break"> file:</span></li>
			</ol>
			<pre class="source-code">
def uninstall_hook_user(env):
   hostel = env['res.users'].search([])
   hostel.write({'active': False})</pre>			<p>Hooks are<a id="_idIndexMarker532"/> functions that run before, after, or in place of existing code. Hooks – functions that are displayed as strings – are contained in the <strong class="source-inline">__init__ .py</strong> file of an <span class="No-Break">Odoo module.</span></p>
		</div>
	</body></html>