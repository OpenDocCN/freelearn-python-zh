<html><head></head><body>
		<div>
			<div id="_idContainer126" class="Content">
			</div>
		</div>
		<div id="_idContainer127" class="Content">
			<h1 id="_idParaDest-140"><a id="_idTextAnchor143"/>4. Introduction to Django Admin</h1>
		</div>
		<div id="_idContainer190" class="Content">
			<p class="callout-heading">Overview</p>
			<p class="callout">This chapter introduces you to the basic functionality of the Django admin app. You will start by creating superuser accounts for the Bookr app, before moving on to executing <strong class="bold">Create Read Update Delete</strong> (<strong class="bold">CRUD</strong>) operations with the admin app. You will learn how to integrate your Django app with the admin app and you'll also look at the behavior of <strong class="source-inline">ForeignKeys</strong> in the admin app. At the end of this chapter, you will see how you can customize the admin app according to a unique set of preferences by sub-classing the <strong class="source-inline">AdminSite</strong> and <strong class="source-inline">ModelAdmin</strong> classes, to make its interface more intuitive and user-friendly.</p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor144"/>Introduction</h1>
			<p>When developing an app, there is often a need to populate it with data and then alter that data. We have already seen in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>, how this can be done on the command line using the Python <strong class="source-inline">manage.py</strong> shell. In <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>, we learned how to develop a web form interface to our model using Django's views and templates. But neither of these approaches is ideal for administering the data from the classes in <strong class="source-inline">reviews/models.py</strong>. Using the shell to manage data is too technical for non-programmers and building individual web pages would be a laborious process as it would see us repeating the same view logic and very similar template features for each table in the model. Fortunately, a solution to this problem was devised in the early days of Django when it was still being developed.</p>
			<p>Django admin is actually written as a Django app. It offers an intuitively rendered web interface to give administrative access to the model data. The admin interface is designed to be used by the administrators of the website. It is not intended to be used by non-privileged users who interact with the site. In our case of a book review system, the general population of book reviewers will never encounter the admin app. They will see the app pages, like those that we built with views and templates in <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>, and will write their reviews on the pages.</p>
			<p>Also, while developers put in a lot of effort to create a simple and inviting web interface for general users, the admin interface, being aimed at administrative users, maintains a utilitarian feel that typically displays the intricacies of the model. It may have escaped your attention, but you already have an admin app in your Bookr project. Look at the list of installed apps in <strong class="source-inline">bookr/settings.py</strong>:</p>
			<p class="source-code">INSTALLED_APPS = [</p>
			<p class="source-code">    'django.contrib.admin',</p>
			<p class="source-code">    …</p>
			<p class="source-code">]</p>
			<p>Now, look at the URL patterns in <strong class="source-inline">bookr/urls.py</strong>:</p>
			<p class="source-code">urlpatterns = [</p>
			<p class="source-code">    path('admin/', admin.site.urls),</p>
			<p class="source-code">    …</p>
			<p class="source-code">]</p>
			<p>If we put this path into our browser, we can see the link to the admin app on the development server is <strong class="source-inline">http://127.0.0.1:8000/admin/</strong>. Before we make use of it though, we need to create a superuser through the command line.</p>
			<h1 id="_idParaDest-142"><a id="_idTextAnchor145"/>Creating a Superuser Account</h1>
			<p>Our Bookr application has just found a new user. Her name is Alice, and she wants to start adding her reviews right away. Bob, who is already using Bookr, has just informed us that his profile seems incomplete and needs to be updated. David no longer wants to use the application and wants his account to be deleted. For security reasons, we do not want just any user performing these tasks for us. That's why we need to create a <strong class="bold">superuser</strong> with elevated privileges. Let's start by doing just that.</p>
			<p>In Django's authorization model, a superuser is one with the <strong class="source-inline">Staff</strong> attribute set. We will examine this later in the chapter and learn more about this authorization model in <em class="italic">Chapter 9</em>, <em class="italic">Sessions and Authentication</em>.</p>
			<p>We can create a superuser by using the <strong class="source-inline">manage.py</strong> script that we have explored in earlier chapters. Again, we need to be in the project directory when we enter it. We will use the <strong class="source-inline">createsuperuser</strong> subcommand by entering the following command in the command line (you will need to write <strong class="source-inline">python</strong> instead of <strong class="source-inline">python3</strong> if you're using Windows):</p>
			<p class="source-code">python3 manage.py createsuperuser</p>
			<p>Let's go ahead and create our superuser.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In this chapter, we will use email addresses that fall under the <em class="italic">example.com</em> domain. This follows an established convention to use this reserved domain for testing and documentation. You could use your own email addresses if you prefer.</p>
			<h2 id="_idParaDest-143"><a id="_idTextAnchor146"/>Exercise 4.01: Creating a Superuser Account</h2>
			<p>In this exercise, you will create a superuser account that lets the user log into the admin site. This functionality will be used in the upcoming exercises as well, to implement changes that only a superuser can. The following steps will help you complete this exercise:</p>
			<ol>
				<li>Enter the following command to create a superuser:<p class="source-code">python manage.py createsuperuser</p><p>On executing this command, you will be prompted to create a superuser. This command will prompt you for a superuser name, an optional email address, and a password.</p></li>
				<li>Add the username and email for the superuser as follows. Here, we are entering <strong class="source-inline">bookradmin</strong> (highlighted) at the prompt and pressing the <em class="italic">Enter</em> key. Similarly, at the next prompt, which asks you to enter your email address, you can add <strong class="source-inline">bookradmin@example.com</strong> (highlighted). Press the <em class="italic">Enter</em> key to continue:<p class="source-code">Username (leave blank to use 'django'): <strong class="bold">bookradmin</strong></p><p class="source-code">Email address: <strong class="bold">bookradmin@example.com</strong></p><p class="source-code">Password: </p><p>This will assign the name <strong class="source-inline">bookradmin</strong> to the superuser. Note that you won't see any output immediately.</p></li>
				<li>The next prompt in the shell is for your password. Add a strong password and press the <em class="italic">Enter</em> key to confirm it once again:<p class="source-code">Password:</p><p class="source-code">Password (again): </p><p>You should see the following message on your screen:</p><p class="source-code">Superuser created successfully.</p><p>Note that the password is validated according to the following criteria:</p><p>It cannot be among the 20,000 most common passwords.</p><p>It should have a minimum of eight characters.</p><p>It cannot be only numerical characters.</p><p>It cannot be derived from the username, first name, last name, or email address of the user.</p><p>With this, you have created a superuser named <strong class="source-inline">bookradmin</strong> who can log in to the admin app. <em class="italic">Figure 4.1</em> shows how this looks in the shell:</p><div id="_idContainer128" class="IMG---Figure"><img src="image/B15509_04_01.jpg" alt="Figure 4.1: Creating a superuser&#13;&#10;"/></div><p class="figure-caption">Figure 4.1: Creating a superuser</p></li>
				<li>Visit the admin app at <strong class="source-inline">http://127.0.0.1:8000/admin</strong> and log in with the superuser account that you have created:<div id="_idContainer129" class="IMG---Figure"><img src="image/B15509_04_02.jpg" alt=" Figure 4.2 The Django administration login form&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption"> Figure 4.2 The Django administration login form</p>
			<p>In this exercise, you created a superuser account that we will be using for the rest of this chapter, to assign or remove privileges as needed.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The codes for all the exercises and activities used in this chapter can be found on the book's GitHub repository at <a href="http://packt.live/3pC5CRr">http://packt.live/3pC5CRr</a>.</p>
			<h1 id="_idParaDest-144"><a id="_idTextAnchor147"/>CRUD Operations Using the Django Admin App</h1>
			<p>Let's get back to the requests we got from Bob, Alice, and David. As a superuser, your tasks will involve creating, updating, retrieving, and deleting various user accounts, reviews, and title names. This set of activities is collectively termed CRUD. CRUD operations are central to the behavior of the admin app. It turns out that the admin app is already aware of the models from another Django app, <strong class="source-inline">Authentication and Authorization</strong> – referenced in <strong class="source-inline">INSTALLED_APPS</strong> as <strong class="source-inline">'django.contrib.auth'</strong>. When logging into <strong class="source-inline">http://127.0.0.1:8000/admin/</strong>, we are presented with the models from the authorization application, as shown in <em class="italic">Figure 4.3</em>:</p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="image/B15509_04_03.jpg" alt="Figure 4.3: The Django administration window &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3: The Django administration window </p>
			<p>When the admin app is initialized, it calls its <strong class="source-inline">autodiscover()</strong> method to detect whether any other installed apps contain an admin module. If so, these admin models are imported. In our case, it has discovered <strong class="source-inline">'django.contrib.auth.admin'</strong>. Now that the modules are imported and our superuser account is ready, let's start by working on the requests from Bob, Alice, and David.</p>
			<h2 id="_idParaDest-145"><a id="_idTextAnchor148"/>Create</h2>
			<p>Before Alice starts writing her reviews, we need to create an account for her through the admin app. Once that is done, we can then look at the levels of administrative access that we can assign to her. To <strong class="bold">Create</strong> a user, we need only click the <strong class="source-inline">+ Add</strong> link next to <strong class="source-inline">Users</strong> (refer to <em class="italic">Figure 4.3</em>), and fill out the form, as shown in <em class="italic">Figure 4.4</em>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">We don't want any random user to have access to the Bookr users' accounts. Therefore, it is imperative that we choose strong, secure passwords.</p>
			<div>
				<div id="_idContainer131" class="IMG---Figure">
					<img src="image/B15509_04_04.jpg" alt="Figure 4.4: The Add user page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4: The Add user page</p>
			<p>There are three buttons at the bottom of the form:</p>
			<ul>
				<li><strong class="source-inline">Save and add another</strong> creates the user and renders the same <strong class="source-inline">Add user</strong> page again, with blank fields.</li>
				<li><strong class="source-inline">Save and continue editing</strong> creates the user and loads the <strong class="source-inline">Change user</strong> page. The <strong class="source-inline">Change user</strong> page lets you add additional information that wasn't present on the <strong class="source-inline">Add user</strong> page, such as <strong class="source-inline">First name</strong>, <strong class="source-inline">Last name</strong>, and more (see <em class="italic">Figure 4.5</em>). Note that <strong class="source-inline">Password</strong> does not have an editable field on the form. Instead, it shows information about the hashing technique that it is stored with, in addition to a link to a separate <em class="italic">change password</em> form.</li>
				<li><strong class="source-inline">SAVE</strong> creates the user and lets the user navigate to the <strong class="source-inline">Select user to change</strong> list page, as depicted in <em class="italic">Figure 4.6</em>.<div id="_idContainer132" class="IMG---Figure"><img src="image/B15509_04_05.jpg" alt="Figure 4.5: The Change user page presented after clicking Save and continue editing&#13;&#10;"/></div></li>
			</ul>
			<p class="figure-caption">Figure 4.5: The Change user page presented after clicking Save and continue editing</p>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor149"/>Retrieve</h2>
			<p>The administrative tasks need to be divided among some users, and for this, the admin (the person with the superuser account) would like to view those users whose email addresses end with <em class="italic">n@example.com</em> and assign the tasks to these users. This is where the <strong class="bold">Retrieve</strong> functionality can come in handy. After we have clicked the <strong class="source-inline">SAVE</strong> button on the <strong class="source-inline">Add user</strong> page (refer to <em class="italic">Figure 4.4</em>), we are taken to the <strong class="source-inline">Select user to change</strong> list page (as shown in <em class="italic">Figure 4.6</em>), which carries out the <strong class="bold">Retrieve</strong> operation. Note that the <strong class="source-inline">Create</strong> form is also reachable by clicking on the <strong class="source-inline">ADD USER</strong> button on the <strong class="source-inline">Select user to change</strong> list page. So, after we have added a few more users, the change list will look something like this:</p>
			<div>
				<div id="_idContainer133" class="IMG---Figure">
					<img src="image/B15509_04_06.jpg" alt="Figure 4.6: The Select user to change page &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6: The Select user to change page </p>
			<p>At the top of the form is a <strong class="source-inline">Search</strong> bar that searches the contents of the username, email address, and first and last names of users. On the right-hand side is a <strong class="source-inline">FILTER</strong> panel that narrows down the selection based on the values of <strong class="source-inline">staff status</strong>, <strong class="source-inline">superuser status</strong>, and <strong class="source-inline">active</strong>. In <em class="italic">Figure 4.7</em>, we will see what happens when we search the string <strong class="source-inline">n@example.com</strong> and see the results. This will return only the names of the users whose email addresses consist of a username ending in <em class="italic">n</em> and a domain starting with <em class="italic">example.com</em>. We will only see three users with email addresses matching this requirement – <strong class="source-inline">bookradmin@example.com</strong>, <strong class="source-inline">carol.brown@example.com</strong>, and <strong class="source-inline">david.green@example.com</strong>:</p>
			<div>
				<div id="_idContainer134" class="IMG---Figure">
					<img src="image/B15509_04_07.jpg" alt="Figure 4.7: Searching for users by a portion of their email address&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7: Searching for users by a portion of their email address</p>
			<h2 id="_idParaDest-147"><a id="_idTextAnchor150"/>Update</h2>
			<p>Remember that Bob wanted his profile to be updated. Let's <strong class="bold">Update</strong> Bob's unfinished profile by clicking the <strong class="source-inline">bob</strong> username link in the <strong class="source-inline">Select user to change</strong> list:</p>
			<div>
				<div id="_idContainer135" class="IMG---Figure">
					<img src="image/B15509_04_08.jpg" alt="Figure 4.8: Selecting bob from the Select user to change list &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8: Selecting bob from the Select user to change list </p>
			<p>This will take us back to the <strong class="source-inline">Change user</strong> form where the values for <strong class="source-inline">First name</strong>, <strong class="source-inline">Last name</strong>, and <strong class="source-inline">Email address</strong> can be entered: </p>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="image/B15509_04_09.jpg" alt="Figure 4.9: Adding personal info&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9: Adding personal info</p>
			<p>As can be seen from <em class="italic">Figure 4.9</em>, we are adding personal information about Bob here – his name, surname, and email address, specifically.</p>
			<p>Another type of update operation is "soft deleting." The <strong class="source-inline">Active</strong> Boolean property allows us to deactivate a user rather than deleting the entire record and losing all the data that has dependencies on the account. This practice of using a Boolean flag to denote a record as inactive or removed (and subsequently filtering these flagged records out of queries) is referred to as a <strong class="bold">Soft Delete</strong>. Similarly, we can upgrade the user to <strong class="source-inline">Staff status</strong> or <strong class="source-inline">Superuser status</strong> by ticking the respective checkboxes for those:</p>
			<div>
				<div id="_idContainer137" class="IMG---Figure">
					<img src="image/B15509_04_10.jpg" alt="Figure 4.10: Active, Staff status, and Superuser status Booleans&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.10: Active, Staff status, and Superuser status Booleans</p>
			<h2 id="_idParaDest-148"><a id="_idTextAnchor151"/>Delete</h2>
			<p>David no longer wants to use the Bookr application and has requested that we delete his account. The auth admin caters to this too. Select a user or user records on the <strong class="source-inline">Select user to change</strong> list page and choose the <strong class="source-inline">Delete selected users</strong> option from the <strong class="source-inline">Action</strong> dropdown. Then hit the <strong class="source-inline">Go</strong> button (<em class="italic">Figure 4.11</em>):</p>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="image/B15509_04_11.jpg" alt="Figure 4.11: Deleting from the Select user to change list page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.11: Deleting from the Select user to change list page</p>
			<p>You will be presented with a confirmation screen and taken back to the <strong class="source-inline">Select user to change</strong> list once you have deleted the object:</p>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="image/B15509_04_12.jpg" alt="Figure 4.12: User deletion confirmation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.12: User deletion confirmation</p>
			<p>You will see the following message once the user is deleted:</p>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="image/B15509_04_13.jpg" alt="Figure 4.13: User deletion notification&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.13: User deletion notification</p>
			<p>After that confirmation, you will find that David's account no longer exists.</p>
			<p>So far, we have learned how we can add a new user, get the details of another user, make changes to the data for a user, and delete a user. These skills helped us cater to Alice, Bob, and David's requests. As the number of users of our app grows, managing requests from hundreds of users will eventually become quite difficult. One way around this problem would be to delegate some of the administrative responsibilities to a selected set of users. We'll learn how to do that in the section that follows.</p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor152"/>Users and Groups</h2>
			<p>Django's authentication model consists of users, groups, and permissions. Users can belong to many groups and this is a way of categorizing users. It also streamlines the implementation of permissions by allowing permissions to be assigned to collections of users as well as individuals.</p>
			<p>In <em class="italic">Exercise 4.01</em>, <em class="italic">Creating a Superuser Account</em>, we saw how we could cater to Alice, David, and Bob's requests to make modifications to their profiles. It was quite easy to do and our application seems well-equipped to handle their requests.</p>
			<p>What will happen when the number of users grows? Will the admin user be able to manage 100 or 150 users at once? As you can imagine, this can be quite a complicated task. To overcome this, we can give elevated permissions to a certain set of users and they can help ease the admin's tasks. And that's where groups come in handy. Though we'll learn more about users, groups, and permissions in <em class="italic">Chapter 9</em>, <em class="italic">Sessions and Authentication</em>, we can start understanding groups and their functionality by creating a <strong class="source-inline">Help Desk user group</strong> that contains accounts having access to the admin interface but lacking many powerful features, such as the ability to add, edit, or delete groups or to add or delete users.</p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor153"/>Exercise 4.02: Adding and Modifying Users and Groups through the Admin app</h2>
			<p>In this exercise, we will grant a certain level of administrative access to one of our Bookr users, Carol. First, we will define the level of access for a group, and then we will add Carol to the group. This will allow Carol to update user profiles and check user logs. The following steps will help you implement this exercise:</p>
			<ol>
				<li value="1">Visit the admin interface at <strong class="source-inline">http://127.0.0.1:8000/admin/</strong> and log in as <strong class="source-inline">bookradmin</strong> using the account set up with the superuser command.</li>
				<li>In the admin interface, follow the links to <strong class="source-inline">Home</strong> › <strong class="source-inline">Authentication and Authorization</strong> › <strong class="source-inline">Groups</strong>:<div id="_idContainer141" class="IMG---Figure"><img src="image/B15509_04_14.jpg" alt="Figure 4.14: The Groups and Users options on the Authentication AND Authorization page&#13;&#10;"/></div><p class="figure-caption">Figure 4.14: The Groups and Users options on the Authentication AND Authorization page</p></li>
				<li>Use <strong class="source-inline">ADD GROUP +</strong> in the top right-hand corner to add a new group:<div id="_idContainer142" class="IMG---Figure"><img src="image/B15509_04_15.jpg" alt="Figure 4.15: Adding a new group&#13;&#10;"/></div><p class="figure-caption">Figure 4.15: Adding a new group</p></li>
				<li>Name the group <strong class="source-inline">Help Desk User</strong> and give it the following permissions, as shown in <em class="italic">Figure 4.16</em>:<p><strong class="source-inline">Can view log entry</strong></p><p><strong class="source-inline">Can view permission</strong></p><p><strong class="source-inline">Can change user</strong></p><p><strong class="source-inline">Can view user</strong></p><div id="_idContainer143" class="IMG---Figure"><img src="image/B15509_04_16.jpg" alt="Figure 4.16: Selecting the permissions&#13;&#10;"/></div><p class="figure-caption">Figure 4.16: Selecting the permissions</p><p>This can be done by selecting the permissions from <strong class="source-inline">Available permissions</strong> and clicking the right arrow in the middle so that they appear under <strong class="source-inline">Chosen permissions</strong>. Note that to add multiple permissions at a time, you can hold down the <em class="italic">Ctrl</em> key (or <em class="italic">Command</em> for Mac) to select more than one:</p><div id="_idContainer144" class="IMG---Figure"><img src="image/B15509_04_17.jpg" alt="Figure 4.17: Adding selected permissions into Chosen permissions&#13;&#10;"/></div><p class="figure-caption">Figure 4.17: Adding selected permissions into Chosen permissions</p><p>Once you click the <strong class="source-inline">SAVE</strong> button, you will see a confirmation message, stating that the group <strong class="source-inline">Help Desk User</strong> was added successfully:</p><div id="_idContainer145" class="IMG---Figure"><img src="image/B15509_04_18.jpg" alt="Figure 4.18: Message confirming that the group Help Desk User was added&#13;&#10;"/></div><p class="figure-caption">Figure 4.18: Message confirming that the group Help Desk User was added</p></li>
				<li>Now, navigate to <strong class="source-inline">Home</strong> › <strong class="source-inline">Authentication and Authorization</strong> › <strong class="source-inline">Users</strong> and click the link of the user with the first name <strong class="source-inline">carol</strong>:<div id="_idContainer146" class="IMG---Figure"><img src="image/B15509_04_19.jpg" alt="Figure 4.19: Clicking on the username carol&#13;&#10;"/></div><p class="figure-caption">Figure 4.19: Clicking on the username carol</p></li>
				<li>Scroll down to the <strong class="source-inline">Permissions</strong> fields set and select the <strong class="source-inline">Staff status</strong> checkbox. This is required for Carol to be able to log in to the admin app:<div id="_idContainer147" class="IMG---Figure"><img src="image/B15509_04_20.jpg" alt="Figure 4.20: Clicking the Staff status checkbox&#13;&#10;"/></div><p class="figure-caption">Figure 4.20: Clicking the Staff status checkbox</p></li>
				<li>Add Carol to the <strong class="source-inline">Help Desk User</strong> group that we created in the previous steps by selecting it from the <strong class="source-inline">Available groups</strong> selection box (refer <em class="italic">Figure 4.20</em>) and clicking the right arrow to shift it into her list of <strong class="source-inline">Chosen groups</strong> (as shown in <em class="italic">Figure 4.21</em>). Note that unless you do this, Carol won't be able to log in to the admin interface using her credentials:<div id="_idContainer148" class="IMG---Figure"><img src="image/B15509_04_21.jpg" alt="Figure 4.21: Shifting the Help Desk User group into the list of Chosen groups for Carol&#13;&#10;"/></div><p class="figure-caption">Figure 4.21: Shifting the Help Desk User group into the list of Chosen groups for Carol</p></li>
				<li>Let's test whether what we've done up till now has yielded the right outcome. To do this, log out of the admin site and log in again as <strong class="source-inline">carol</strong>. Upon logging out, you should see the following on your screen:<div id="_idContainer149" class="IMG---Figure"><img src="image/B15509_04_22.jpg" alt="Figure 4.22: Logout screen&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 4.22: Logout screen</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you don't recall the password that you initially gave her, you can change the password at the command line by typing <strong class="source-inline">python3 manage.py changepassword carol</strong>.</p>
			<p>Upon successful login, on the admin dashboard, you can see that there is no link to <strong class="source-inline">Groups</strong>: </p>
			<div>
				<div id="_idContainer150" class="IMG---Figure">
					<img src="image/B15509_04_23.jpg" alt="Figure 4.23: Admin dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.23: Admin dashboard</p>
			<p>As we did not assign any group permissions, not even <strong class="source-inline">auth | group | Can view group</strong>, to the <strong class="source-inline">Help Desk User</strong> group, when Carol logs in, the <strong class="source-inline">Groups</strong> admin interface is not available to her. Similarly, navigate to <strong class="source-inline">Home › Authentication and Authorization › Users</strong>. Clicking a user link, you will see that there are no options to edit or delete the user. This is because of the permissions that were granted to the Help Desk User group, of which Carol is a member. The members of the group can view and edit users but cannot add or delete any user. </p>
			<p>In this exercise, we learned how we can grant a certain amount of administrative privileges to users of our Django app.</p>
			<h1 id="_idParaDest-151"><a id="_idTextAnchor154"/>Registering the Reviews Model</h1>
			<p>Let's say that Carol is tasked with improving the Reviews section in Bookr; that is, only the most relevant and comprehensive reviews should be shown, and duplicate or spammy entries should be removed. For this, she will need access to the <strong class="source-inline">reviews</strong> model. As we have seen above with our investigation of groups and users, the admin app already contains admin pages for the models from the authentication and authorization app, but it does not yet reference the models in our Reviews app. </p>
			<p>To make the admin app aware of the models, we need to explicitly register them with the admin app. Fortunately, we don't need to modify the admin app's code to do so as we can instead import the admin app into our project and use its API to register our models. This has already been done in the authentication and authorization app, so let's try it with our Reviews app. Our aim is to be able to use the admin app to edit the data in our <strong class="source-inline">reviews</strong> model.</p>
			<p>Take a look at the <strong class="source-inline">reviews/admin.py</strong> file. It is a placeholder file that was generated with the <strong class="source-inline">startapp</strong> subcommand that we used in <em class="italic">Chapter 1</em>, <em class="italic">Introduction to Django</em>, and currently contains these lines:</p>
			<p class="source-code">from django.contrib import admin</p>
			<p class="source-code"># Register your models here.</p>
			<p>Now we can try to expand this. To make the admin app aware of our models, we can modify the <strong class="source-inline">reviews/admin.py</strong> file and import the models. Then we could register the models with the <strong class="source-inline">AdminSite</strong> object, <strong class="source-inline">admin.site</strong>. The <strong class="source-inline">AdminSite</strong> object contains the instance of the Django admin application (later, we will learn how to subclass this <strong class="source-inline">AdminSite</strong> and override many of its properties). Then, our <strong class="source-inline">reviews/admin.py</strong> will look as follows:</p>
			<p class="source-code">from django.contrib import admin</p>
			<p class="source-code">from reviews.models import Publisher, Contributor, \</p>
			<p class="source-code">Book, BookContributor, Review</p>
			<p class="source-code"># Register your models here.</p>
			<p class="source-code">admin.site.register(Publisher)</p>
			<p class="source-code">admin.site.register(Contributor)</p>
			<p class="source-code">admin.site.register(Book)</p>
			<p class="source-code">admin.site.register(BookContributor)</p>
			<p class="source-code">admin.site.register(Review)</p>
			<p>The <strong class="source-inline">admin.site.register</strong> method makes the models available to the admin app by adding it to a registry of classes contained in <strong class="source-inline">admin.site._registry</strong>. If we chose not to make a model accessible through the admin interface, we would simply not register it. When you reload <strong class="source-inline">http://127.0.0.1:8000/admin/</strong> in your browser, you will see the following on the admin app landing page. Note the change in the appearance of the admin page after the <strong class="source-inline">reviews</strong> model has been imported:</p>
			<div>
				<div id="_idContainer151" class="IMG---Figure">
					<img src="image/B15509_04_24.jpg" alt="Figure 4.24: Admin app landing page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.24: Admin app landing page</p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor155"/>Change Lists</h2>
			<p>We now have change lists populated for our models. If we click the <strong class="source-inline">Publishers</strong> link, we will be taken to <strong class="source-inline">http://127.0.0.1:8000/admin/reviews/publisher</strong> and see a change list containing links to the publishers. These links are designated by the <strong class="source-inline">id</strong> field of the <strong class="source-inline">Publisher</strong> objects. </p>
			<p>If your database has been populated with the script in <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>, you will see a list with seven publishers that looks like <em class="italic">Figure 4.25</em>:</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Depending on the state of your database and based on the activities you have completed, the object IDs, URLs, and links in these examples may be numbered differently from those listed here.</p>
			<div>
				<div id="_idContainer152" class="IMG---Figure">
					<img src="image/B15509_04_25.jpg" alt="Figure 4.25: Select publisher to change list&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.25: Select publisher to change list</p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor156"/>The Publisher Change Page</h2>
			<p>The publisher change page at <strong class="source-inline">http://127.0.0.1:8000/admin/reviews/publisher/1</strong> contains what we might expect (see <em class="italic">Figure 4.26</em>). There is a form for editing the publisher's details. These details have been derived from the <strong class="source-inline">reviews.models.Publisher</strong> class:</p>
			<div>
				<div id="_idContainer153" class="IMG---Figure">
					<img src="image/B15509_04_26.jpg" alt="Figure 4.26: Publisher change page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.26: Publisher change page</p>
			<p>If we had clicked the <strong class="source-inline">ADD PUBLISHER</strong> button, the admin app would have returned a similar form for adding a publisher. The beauty of the admin app is that it gives us all of this CRUD functionality with just one line of coding – <strong class="source-inline">admin.site.register(Publisher)</strong> – using the definition of the <strong class="source-inline">reviews.models.Publisher</strong> attributes as a schema for the page content:</p>
			<p class="source-code">class Publisher(models.Model):</p>
			<p class="source-code">    """A company that publishes books."""</p>
			<p class="source-code">    name = models.CharField\</p>
			<p class="source-code">           (help_text="The name of the Publisher.",\</p>
			<p class="source-code">            max_length=50)</p>
			<p class="source-code">    website = models.URLField\</p>
			<p class="source-code">              (help_text="The Publisher's website.")</p>
			<p class="source-code">    email = models.EmailField\</p>
			<p class="source-code">            (help_text="The Publisher's email address.")</p>
			<p>The publisher <strong class="source-inline">Name</strong> field is constrained to 50 characters as specified in the model. The help text that appears in gray below each field is derived from the <strong class="source-inline">help_text</strong> attributes specified on the model. We can see that <strong class="source-inline">models.CharField</strong>,  <strong class="source-inline">models.URLField</strong>, and <strong class="source-inline">models.EmailField</strong> are rendered in HTML as input elements of type <strong class="source-inline">text</strong>, <strong class="source-inline">url</strong>, and <strong class="source-inline">email</strong> respectively. </p>
			<p>The fields in the form come with validation where appropriate. Unless model fields are set to <strong class="source-inline">blank=True</strong> or <strong class="source-inline">null=True</strong>, the form will throw an error if the field is left blank, as is the case for the <strong class="source-inline">Publisher.name</strong> field. Similarly, as <strong class="source-inline">Publisher.website</strong> and <strong class="source-inline">Publisher.email</strong> are respectively defined as instances of <strong class="source-inline">models.URLField</strong> and <strong class="source-inline">models.EmailField</strong>, they are validated accordingly. In <em class="italic">Figure 4.27</em>, we can see validation of <strong class="source-inline">Name</strong> as a required field, validation of <strong class="source-inline">Website</strong> as a URL, and validation of <strong class="source-inline">Email</strong> as an email address:</p>
			<div>
				<div id="_idContainer154" class="IMG---Figure">
					<img src="image/B15509_04_27.jpg" alt="Figure 4.27: Field validation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.27: Field validation</p>
			<p>It is useful to examine how the admin app renders elements of the models to understand how it functions. In your browser, right-click <strong class="source-inline">View Page Source</strong> and examine the HTML that has been rendered for this form. You will see a browser tab displaying something like this:</p>
			<p class="source-code">&lt;fieldset class="module aligned "&gt;</p>
			<p class="source-code">    &lt;div class="form-row errors field-name"&gt;</p>
			<p class="source-code">        &lt;ul class="errorlist"&gt;&lt;li&gt;This field is required.&lt;/li&gt;&lt;/ul&gt;</p>
			<p class="source-code">            &lt;div&gt;</p>
			<p class="source-code">                    &lt;label class="required" for="id_name"&gt;Name:&lt;/label&gt;</p>
			<p class="source-code">                        &lt;input type="text" name="name" class="vTextField"</p>
			<p class="source-code">                         maxlength="50" required id="id_name"&gt;</p>
			<p class="source-code">                    &lt;div class="help"&gt;The name of the Publisher.&lt;/div&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">    &lt;/div&gt;</p>
			<p class="source-code">    &lt;div class="form-row errors field-website"&gt;</p>
			<p class="source-code">        &lt;ul class="errorlist"&gt;&lt;li&gt;Enter a valid URL.&lt;/li&gt;&lt;/ul&gt;</p>
			<p class="source-code">            &lt;div&gt;</p>
			<p class="source-code">                    &lt;label class="required" for="id_website"&gt;Website:&lt;/label&gt;</p>
			<p class="source-code">                        &lt;input type="url" name="website" value="packtcom"</p>
			<p class="source-code">                         class="vURLField" maxlength="200" required</p>
			<p class="source-code">                         id="id_website"&gt;</p>
			<p class="source-code">                    &lt;div class="help"&gt;The Publisher's website.&lt;/div&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">    &lt;/div&gt;</p>
			<p class="source-code">    &lt;div class="form-row errors field-email"&gt;</p>
			<p class="source-code">        &lt;ul class="errorlist"&gt;&lt;li&gt;Enter a valid email address.&lt;/li&gt;&lt;/ul&gt;</p>
			<p class="source-code">            &lt;div&gt;</p>
			<p class="source-code">                    &lt;label class="required" for="id_email"&gt;Email:&lt;/label&gt;</p>
			<p class="source-code">                        &lt;input type="email" name="email" value="infoatpackt.com"</p>
			<p class="source-code">                         class="vTextField" maxlength="254" required</p>
			<p class="source-code">                         id="id_email"&gt;</p>
			<p class="source-code">                    &lt;div class="help"&gt;The Publisher's email address.&lt;/div&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">  &lt;/div&gt;</p>
			<p class="source-code">&lt;/fieldset&gt;</p>
			<p>The form has an ID of <strong class="source-inline">publisher_form</strong> and it contains a fieldset with HTML elements corresponding to the data structure of the <strong class="source-inline">Publisher</strong> model in <strong class="source-inline">reviews/models.py</strong>, shown as follows:</p>
			<p class="source-code">class Publisher(models.Model):</p>
			<p class="source-code">    """A company that publishes books."""</p>
			<p class="source-code">    name = models.CharField\</p>
			<p class="source-code">           (max_length=50,</p>
			<p class="source-code">            help_text="The name of the Publisher.")</p>
			<p class="source-code">    website = models.URLField\</p>
			<p class="source-code">              (help_text="The Publisher's website.")</p>
			<p class="source-code">    email = models.EmailField\</p>
			<p class="source-code">            (help_text="The Publisher's email address.")</p>
			<p>Note that for the name, the input field is rendered like this:</p>
			<p class="source-code">&lt;input type="text" name="name" value="Packt Publishing"</p>
			<p class="source-code">                   class="vTextField" maxlength="50" required="" id="id_name"&gt;</p>
			<p>It is a required field, and it has a type of <strong class="source-inline">text</strong> and a <strong class="source-inline">maxlength</strong> of 50, as defined by the <strong class="source-inline">max_length</strong> parameter in the model definition:</p>
			<p class="source-code">    name = models.CharField\</p>
			<p class="source-code">           (help_text="The name of the Publisher.",\</p>
			<p class="source-code">            max_length=50)</p>
			<p>Similarly, we can see the website and email being defined in the model as <strong class="source-inline">URLField</strong> and <strong class="source-inline">EmailField</strong> are rendered in HTML as input elements of type <strong class="source-inline">url</strong> and <strong class="source-inline">email</strong> respectively:</p>
			<p class="source-code">&lt;input type="url" name="website" value="https://www.packtpub.com/"</p>
			<p class="source-code">                     class="vURLField" maxlength="200" required=""</p>
			<p class="source-code">                     id="id_website"&gt;            </p>
			<p class="source-code">&lt;input type="email" name="email" value="info@packtpub.com"</p>
			<p class="source-code">                    class="vTextField" maxlength="254" required=""</p>
			<p class="source-code">                    id="id_email"&gt;</p>
			<p>We have learned that this Django admin app derives sensible HTML representations of Django models based on the model definitions that we have provided.</p>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor157"/>The Book Change Page</h2>
			<p>Similarly, there is a change page that can be reached by selecting <strong class="source-inline">Books</strong> from the <strong class="source-inline">Site administration</strong> page and then selecting a specific book in the change list:</p>
			<div>
				<div id="_idContainer155" class="IMG---Figure">
					<img src="image/B15509_04_28.jpg" alt="Figure 4.28: Selecting Books from the Site administration page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.28: Selecting Books from the Site administration page</p>
			<p>After clicking <strong class="source-inline">Books</strong> as shown in the preceding screenshot, you will see the following on your screen:</p>
			<div>
				<div id="_idContainer156" class="IMG---Figure">
					<img src="image/B15509_04_29.jpg" alt="Figure 4.29: The book change page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.29: The book change page</p>
			<p>In this instance, selecting the book <em class="italic">Architects of Intelligence</em> will take us to the URL <strong class="source-inline">http://127.0.0.1:8000/admin/reviews/book/3/change/</strong>. In the previous example, all the model fields were rendered as simple HTML text widgets. The rendering of some other subclasses of <strong class="source-inline">django.db.models.Field</strong> used in <strong class="source-inline">models.Book</strong> are worthy of closer examination:</p>
			<p> </p>
			<div>
				<div id="_idContainer157" class="IMG---Figure">
					<img src="image/B15509_04_30.jpg" alt="Figure 4.30: The Change book page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.30: The Change book page</p>
			<p>Here, <strong class="source-inline">publication_date</strong> is defined using <strong class="source-inline">models.DateField</strong>. It is rendered using a date selection widget. The visual representation of the widgets will vary amongst operating systems and choice of browser:</p>
			<div>
				<div id="_idContainer158" class="IMG---Figure">
					<img src="image/B15509_04_31.jpg" alt="Figure 4.31: Date selection widget&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.31: Date selection widget</p>
			<p>As <strong class="source-inline">Publisher</strong> is defined as a foreign key relation, it is rendered by a <strong class="source-inline">Publisher</strong> dropdown with a list of <strong class="source-inline">Publisher</strong> objects:</p>
			<div>
				<div id="_idContainer159" class="IMG---Figure">
					<img src="image/B15509_04_32.jpg" alt="Figure 4.32: Publisher dropdown&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.32: Publisher dropdown</p>
			<p>This brings us to how the admin app handles deletion. The admin app takes its cue from the models' foreign key constraints when determining how to implement deletion functionality. In the <strong class="source-inline">BookContributor</strong> model, <strong class="source-inline">Contributor</strong> is defined as a foreign key. The code in <strong class="source-inline">reviews/models.py</strong> looks as follows:</p>
			<p class="source-code">contributor = models.ForeignKey(Contributor, on_delete=models.CASCADE)</p>
			<p>By setting <strong class="source-inline">on_delete=CASCADE</strong> on a foreign key, the model is specifying the database behavior required when a record is deleted; the deletion is cascaded to other objects that are referenced by the foreign key.</p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor158"/>Exercise 4.03: Foreign Keys and Deletion Behavior in the Admin App</h2>
			<p>At present, all <strong class="source-inline">ForeignKey</strong> relations in the <strong class="source-inline">reviews</strong> models are defined with an <strong class="source-inline">on_delete=CASCADE</strong> behavior. For instance, think of a case wherein an admin deletes one of the publishers. This would delete all the books that are associated with the publisher. We do not want that to happen, and that is precisely the behavior that we will be changing in this exercise:</p>
			<ol>
				<li value="1">Visit the <strong class="source-inline">Contributors</strong> change list at <strong class="source-inline">http://127.0.0.1:8000/admin/reviews/contributor/</strong> and select a contributor to delete. Make sure that the contributor is the author of a book.</li>
				<li>Click the <strong class="source-inline">Delete</strong> button, but don't click <strong class="source-inline">Yes, I'm sure</strong> on the confirmation dialog. You will see a message like the one in <em class="italic">Figure 4.33</em>:<div id="_idContainer160" class="IMG---Figure"><img src="image/B15509_04_33.jpg" alt="Figure 4.33: Cascading delete confirmation dialog&#13;&#10;"/></div><p class="figure-caption">Figure 4.33: Cascading delete confirmation dialog</p><p>In accordance with the <strong class="source-inline">on_delete=CASCADE</strong> argument to the foreign key, we are warned that deleting this Contributor object will have a cascading effect on a <strong class="source-inline">BookContributor</strong> object.</p></li>
				<li>In the <strong class="source-inline">reviews/models.py</strong> file, modify the <strong class="source-inline">Contributor</strong> attribute of <strong class="source-inline">BookContributor</strong> to the following and save the file:<p class="source-code">contributor = models.ForeignKey(Contributor, \</p><p class="source-code">                                on_delete=models.PROTECT)</p></li>
				<li>Now, try deleting the <strong class="source-inline">Contributor</strong> object again. You will see a message similar to the one in <em class="italic">Figure 4.34</em>:<div id="_idContainer161" class="IMG---Figure"><img src="image/B15509_04_34.jpg" alt="Figure 4.34: Foreign key protection error&#13;&#10;"/></div><p class="figure-caption">Figure 4.34: Foreign key protection error</p><p>Because the <strong class="source-inline">on_delete</strong> argument is <strong class="source-inline">PROTECT</strong>, our attempt to delete the object with dependencies will throw an error. If we used this approach in our model, we would need to delete objects in the <strong class="source-inline">ForeignKey</strong> relation before we deleted the original object. In this case, it would mean deleting the <strong class="source-inline">BookContributor</strong> object before deleting the <strong class="source-inline">Contributor</strong> object.</p></li>
				<li>Now that we have learned about how the admin app handles <strong class="source-inline">ForeignKey</strong> relations, let's revert the <strong class="source-inline">ForeignKey</strong> definition in the <strong class="source-inline">BookContributor</strong> class to this:<p class="source-code">contributor = models.ForeignKey(Contributor, \</p><p class="source-code">                                on_delete=models.CASCADE)</p></li>
			</ol>
			<p>We have examined how the admin app's behavior adapts to the <strong class="source-inline">ForeignKey</strong> constraints that are expressed in model definitions. If the <strong class="source-inline">on_delete</strong> behavior is set to <strong class="source-inline">models.PROTECT</strong>, the admin app returns an error explaining why a protected object is blocking the deletion. This functionality can come in handy while building real-world apps, as there is often a chance of a manual error inadvertently leading to the deletion of important records. In the next section, we will look at how we can customize our admin app interface for a smoother user experience.</p>
			<h1 id="_idParaDest-156"><a id="_idTextAnchor159"/>Customizing the Admin Interface</h1>
			<p>When first developing an application, the convenience of the default admin interface is excellent for building a rapid prototype of the app. Indeed, for many simpler applications or projects that require minimal data maintenance, this default admin interface may be entirely adequate. However, as the application matures to the point of release, the admin interface will generally need to be customized to facilitate more intuitive use and to robustly control data, subject to user permissions. You might want to retain certain aspects of the default admin interface, and at the same time, make some tweaks to certain features to better suit your purposes. For example, you would want the publisher list to show the complete names of the publishing houses, instead of "<strong class="source-inline">Publisher(1)</strong>, <strong class="source-inline">Publisher(2)</strong>…" and so on. In addition to the aesthetic appeal, this makes it easier to use and navigate through the app.</p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor160"/>Site-Wide Django Admin Customizations</h2>
			<p>We have seen a page titled <strong class="source-inline">Log in | Django site admin</strong> containing a <strong class="source-inline">Django Administration</strong> form. However, an administrative user of the Bookr application may be somewhat perplexed by all this Django jargon, and it would be very confusing and a recipe for error if they had to deal with multiple Django apps that all had identical admin apps. As a developer of an intuitive and user-friendly application, you would want to customize this. Global properties like these are specified as attributes of the <strong class="source-inline">AdminSite</strong> object. The following table details some of the simplest customizations to improve the usability of your app's admin interface:</p>
			<div>
				<div id="_idContainer162" class="IMG---Figure">
					<img src="image/B15509_04_35.jpg" alt="Figure 4.35: Important AdminSite attributes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.35: Important AdminSite attributes</p>
			<h2 id="_idParaDest-158"><a id="_idTextAnchor161"/>Examining the AdminSite object from the Python Shell</h2>
			<p>Let's take a deeper look at the <strong class="source-inline">AdminSite</strong> class. We have already encountered an object of class <strong class="source-inline">AdminSite</strong>. It is the <strong class="source-inline">admin.site</strong> object that we used in the previous section, <em class="italic">Registering the Reviews Model</em>. If the development server is not running, start it now with the <strong class="source-inline">runserver</strong> subcommand, as follows (use <strong class="source-inline">python</strong> instead of <strong class="source-inline">python3</strong> for Windows):</p>
			<p class="source-code">python3 manage.py runserver</p>
			<p>We can examine the <strong class="source-inline">admin.site</strong> object by importing the admin app in the Django shell, using the <strong class="source-inline">manage.py</strong> script again:</p>
			<p class="source-code">python3 manage.py shell</p>
			<p class="source-code">&gt;&gt;&gt;from django.contrib import admin</p>
			<p>We can interactively examine the default values of <strong class="source-inline">site_title</strong>, <strong class="source-inline">site_header</strong>, and <strong class="source-inline">index_title</strong> and see that they match the expected values of <strong class="source-inline">'Django site admin'</strong>, <strong class="source-inline">'Django administration'</strong>, and <strong class="source-inline">'Site administration'</strong> that we have already observed on the rendered web pages of the Django admin app:</p>
			<p class="source-code">&gt;&gt;&gt; admin.site.site_title</p>
			<p class="source-code">'Django site admin'</p>
			<p class="source-code">&gt;&gt;&gt; admin.site.site_header</p>
			<p class="source-code">'Django administration'</p>
			<p class="source-code">&gt;&gt;&gt; admin.site.index_title</p>
			<p class="source-code">'Site administration'</p>
			<p>The <strong class="source-inline">AdminSite</strong> class also specifies which forms and views are used to render the admin interface and determine its global behavior.</p>
			<h3 id="_idParaDest-159"><a id="_idTextAnchor162"/>Subclassing AdminSite</h3>
			<p>We can make some modifications to the <strong class="source-inline">reviews/admin.py</strong> file. Instead of importing the <strong class="source-inline">django.contrib.admin</strong> module and using its site object, we will import <strong class="source-inline">AdminSite</strong>, subclass it, and instantiate our customized <strong class="source-inline">admin_site</strong> object. Consider the following code snippet. Here, <strong class="source-inline">BookrAdminSite</strong> is a subclass of <strong class="source-inline">AdminSite</strong> that contains custom values for <strong class="source-inline">site_title</strong>,  <strong class="source-inline">site_header</strong>, and <strong class="source-inline">index_title</strong>; <strong class="source-inline">admin_site</strong> is an instance of <strong class="source-inline">BookrAdminSite</strong>; and we can use this instead of the default <strong class="source-inline">admin.site</strong> object, to register our models. The <strong class="source-inline">reviews/admin.py</strong> file will look as follows:</p>
			<p class="source-code">from django.contrib.admin import AdminSite</p>
			<p class="source-code">from reviews.models import (Publisher, Contributor, Book,\</p>
			<p class="source-code">     BookContributor, Review)</p>
			<p class="source-code">class BookrAdminSite(AdminSite):</p>
			<p class="source-code">    title_header = 'Bookr Admin'</p>
			<p class="source-code">    site_header = 'Bookr administration'</p>
			<p class="source-code">    index_title = 'Bookr site admin'</p>
			<p class="source-code">admin_site = BookrAdminSite(name='bookr')</p>
			<p class="source-code"># Register your models here.</p>
			<p class="source-code">admin_site.register(Publisher)</p>
			<p class="source-code">admin_site.register(Contributor)</p>
			<p class="source-code">admin_site.register(Book)</p>
			<p class="source-code">admin_site.register(BookContributor)</p>
			<p class="source-code">admin_site.register(Review)</p>
			<p>As we have now created our own <strong class="source-inline">admin_site</strong> object that overrides the behavior of the <strong class="source-inline">admin.site</strong> object, we need to remove the existing references in our code to the <strong class="source-inline">admin.site</strong> object. In <strong class="source-inline">bookr/urls.py</strong>, we need to point admin to the new <strong class="source-inline">admin_site</strong> object and update our URL patterns. Otherwise, we would still be using the default admin site and our customizations would be ignored. The change will look as follows:</p>
			<p class="source-code">from reviews.admin import admin_site</p>
			<p class="source-code">from django.urls import include, path</p>
			<p class="source-code">import reviews.views</p>
			<p class="source-code">urlpatterns = [<strong class="bold">path('admin/', admin_site.urls),</strong>\</p>
			<p class="source-code">               path('', reviews.views.index),\</p>
			<p class="source-code">               path('book-search/', reviews.views.book_search, \</p>
			<p class="source-code">                    name='book_search'),\</p>
			<p class="source-code">               path('', include('reviews.urls'))]</p>
			<p>This produces the expected results on the login screen:</p>
			<div>
				<div id="_idContainer163" class="IMG---Figure">
					<img src="image/B15509_04_36.jpg" alt="Figure 4.36: Customizing the login screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.36: Customizing the login screen</p>
			<p>However, now there is a problem; that is, we have lost the interface for auth objects. Previously, the admin app was discovering the models registered in <strong class="source-inline">reviews/admin.py</strong> and in <strong class="source-inline">django.contrib.auth.admin</strong> through the auto-discovery process, but now we have overridden this behavior by creating a new <strong class="source-inline">AdminSite</strong>:</p>
			<div>
				<div id="_idContainer164" class="IMG---Figure">
					<img src="image/B15509_04_37.jpg" alt="Figure 4.37: Customized AdminSite is missing Authentication and Authorization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.37: Customized AdminSite is missing Authentication and Authorization</p>
			<p>We could go down the path of referencing both <strong class="source-inline">AdminSite</strong> objects to URL patterns in <strong class="source-inline">bookr/urls.py</strong>, but this approach would mean that we would end up with two separate admin apps for authentication and reviews. So, the URL <strong class="source-inline">http://127.0.0.1:8000/admin</strong> will take you to the original admin app derived from the <strong class="source-inline">admin.site</strong> object, while <strong class="source-inline">http://127.0.0.1:8000/bookradmin</strong> will take you to our <strong class="source-inline">BookrAdminSite</strong>  <strong class="source-inline">admin_site</strong>. This is not what we want to do, as we are still left with the admin app without the customizations that we added when we sub-classed <strong class="source-inline">BookrAdminSite</strong>:</p>
			<p class="source-code">from django.contrib import admin</p>
			<p class="source-code">from reviews.admin import admin_site</p>
			<p class="source-code">from django.urls import path</p>
			<p class="source-code">urlpatterns = [path('admin/', admin.site.urls),\</p>
			<p class="source-code">               path('bookradmin/', admin_site.urls),]</p>
			<p>This has been a clumsy problem with the Django admin interface that has led to a lot of ad hoc solutions in earlier versions. Since Django 2.1 came out, there is a simple way of integrating a customized interface for the admin app without breaking auto-discovery or any of its other default features. As <strong class="source-inline">BookrAdminSite</strong> is project-specific, the code does not really belong under our <strong class="source-inline">reviews</strong> folder. We should move <strong class="source-inline">BookrAdminSite</strong> to a new file called <strong class="source-inline">admin.py</strong> at the top level of the <strong class="source-inline">Bookr</strong> project directory:</p>
			<p class="source-code">from django.contrib import admin</p>
			<p class="source-code">class BookrAdminSite(admin.AdminSite):</p>
			<p class="source-code">    title_header = 'Bookr Admin'</p>
			<p class="source-code">    site_header = 'Bookr administration'</p>
			<p class="source-code">    index_title = 'Bookr site admin'</p>
			<p>The URL settings path in <strong class="source-inline">bookr/urls.py</strong> changes to <strong class="source-inline">path('admin/', admin.site.urls)</strong> and we define our <strong class="source-inline">ReviewsAdminConfig</strong>. The <strong class="source-inline">reviews/apps.py</strong> file will contain these additional lines:</p>
			<p class="source-code">from django.contrib.admin.apps import AdminConfig</p>
			<p class="source-code">class ReviewsAdminConfig(AdminConfig):</p>
			<p class="source-code">    default_site = 'admin.BookrAdminSite'</p>
			<p>Replace <strong class="source-inline">django.contrib.admin</strong> with <strong class="source-inline">reviews.apps.ReviewsAdminConfig</strong>, so that <strong class="source-inline">INSTALLED_APPS</strong> in the <strong class="source-inline">bookr/settings.py</strong> file will look as follows:</p>
			<p class="source-code">INSTALLED_APPS = [<strong class="bold">'reviews.apps.ReviewsAdminConfig'</strong>,\</p>
			<p class="source-code">                  'django.contrib.auth',\</p>
			<p class="source-code">                  'django.contrib.contenttypes',\</p>
			<p class="source-code">                  'django.contrib.sessions',\</p>
			<p class="source-code">                  'django.contrib.messages',\</p>
			<p class="source-code">                  'django.contrib.staticfiles',\</p>
			<p class="source-code">                  'reviews']</p>
			<p>With the <strong class="source-inline">ReviewsAdminConfig</strong> specification of <strong class="source-inline">default_site</strong>, we no longer need to replace references to <strong class="source-inline">admin.site</strong> with a custom <strong class="source-inline">AdminSite</strong> object, <strong class="source-inline">admin_site</strong>. We can replace those <strong class="source-inline">admin_site</strong> calls with the <strong class="source-inline">admin.site</strong> calls that we had originally. Now, <strong class="source-inline">reviews/admin.py</strong> reverts to the following:</p>
			<p class="source-code">from django.contrib import admin</p>
			<p class="source-code">from reviews.models import (Publisher, Contributor, Book,\</p>
			<p class="source-code">     BookContributor, Review)</p>
			<p class="source-code"># Register your models here.</p>
			<p class="source-code">admin.site.register(Publisher)</p>
			<p class="source-code">admin.site.register(Contributor)</p>
			<p class="source-code">admin.site.register(Book, BookAdmin)</p>
			<p class="source-code">admin.site.register(BookContributor)</p>
			<p class="source-code">admin.site.register(Review)</p>
			<p>There are other aspects of <strong class="source-inline">AdminSite</strong> that we can customize, but we will revisit these in <em class="italic">Chapter 9</em>, <em class="italic">Sessions and Authentication </em>once we have a fuller understanding of Django's templates and forms.</p>
			<h2 id="_idParaDest-160">Ac<a id="_idTextAnchor163"/>tivity 4.01: Customizing the SiteAdmin</h2>
			<p>You have learned how to modify attributes of the <strong class="source-inline">AdminSite</strong> object in a Django project. This activity will challenge you to use these skills to customize a new project and override its site title, site header, and index header. Also, you will replace the logout message by creating a project-specific template and setting it in our custom <strong class="source-inline">SiteAdmin</strong> object. You are developing a Django project that implements a message board, called <em class="italic">Comment8or</em>. <em class="italic">Comment8or</em> is geared toward a technical demographic, so you need to make the phraseology succinct and abbreviated:</p>
			<ol>
				<li value="1">The <em class="italic">Comment8or</em> admin site will be referred to as <strong class="source-inline">c8admin</strong>. This will appear on the site header and index title.</li>
				<li>For the title header, it will say <strong class="source-inline">c8 site admin</strong>.</li>
				<li>The default Django admin logout message is <strong class="source-inline">Thanks for spending some quality time with the Web site today.</strong> In Comment8or, it will say <strong class="source-inline">Bye from c8admin.</strong></li>
			</ol>
			<p>These are the steps that you need to follow to complete this activity:</p>
			<ol>
				<li value="1">Following the process that you learned in <em class="italic">Chapter 1</em>, <em class="italic">Introduction to Django</em>, create a new Django project called <strong class="source-inline">comment8or</strong>, an app called <strong class="source-inline">messageboard</strong>, and run the migrations. Create a superuser called <strong class="source-inline">c8admin</strong>.</li>
				<li>In the Django source code, there is a template for the logout page located in <strong class="source-inline">django/contrib/admin/templates/registration/logged_out.html</strong>. </li>
				<li>Make a copy of it in your project's directory under <strong class="source-inline">comment8or/templates/comment8or</strong>. Modify the message in the template following the requirements.</li>
				<li>Inside the project, create an <strong class="source-inline">admin.py</strong> file that implements a custom <strong class="source-inline">SiteAdmin</strong> object. Set the appropriate values for the attributes <strong class="source-inline">index_title</strong>, <strong class="source-inline">title_header</strong>, <strong class="source-inline">site_header</strong>, and <strong class="source-inline">logout_template</strong>, based on the requirements.</li>
				<li>Add a custom <strong class="source-inline">AdminConfig</strong> subclass to <strong class="source-inline">messageboard/apps.py</strong>.</li>
				<li>Replace the admin app with the custom <strong class="source-inline">AdminConfig</strong> subclass in <strong class="source-inline">comment8or/settings.py</strong>.</li>
				<li>Configure the <strong class="source-inline">TEMPLATES</strong> setting so that the project's template is discoverable.<p>When the project is first created, the login, app index, and logout pages will look as follows:</p><div id="_idContainer165" class="IMG---Figure"><img src="image/B15509_04_38.jpg" alt="Figure 4.38: Login page for the project&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 4.38: Login page for the project</p>
			<div>
				<div id="_idContainer166" class="IMG---Figure">
					<img src="image/B15509_04_39.jpg" alt="Figure 4.39: App index page for the project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.39: App index page for the project</p>
			<div>
				<div id="_idContainer167" class="IMG---Figure">
					<img src="image/B15509_04_40.jpg" alt="Figure 4.40: Logout page for the project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.40: Logout page for the project</p>
			<p>After you have completed this activity, the login, app index, and logout pages will appear with the following customizations:</p>
			<div>
				<div id="_idContainer168" class="IMG---Figure">
					<img src="image/B15509_04_41.jpg" alt="Figure 4.41: Login page after customization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.41: Login page after customization</p>
			<div>
				<div id="_idContainer169" class="IMG---Figure">
					<img src="image/B15509_04_42.jpg" alt="Figure 4.42: App index page after customization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.42: App index page after customization</p>
			<div>
				<div id="_idContainer170" class="IMG---Figure">
					<img src="image/B15509_04_43.jpg" alt="Figure 4.43: Logout page after customization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.43: Logout page after customization</p>
			<p>You have successfully customized the admin app by sub-classing <strong class="source-inline">AdminSite</strong>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h2 id="_idParaDest-161"><a id="_idTextAnchor164"/>Customizing the ModelAdmin Classes</h2>
			<p>Now that we've learned how a sub-classed <strong class="source-inline">AdminSite</strong> can be used to customize the global appearance of the admin app, we will look at how to customize the admin app's interface to individual models. Owing to the admin interface being generated automatically from the models' structure, it has an overly generic appearance and needs to be customized for the sake of aesthetics and usability. Click one of the <strong class="source-inline">Books</strong> links in the admin app and compare it to the <strong class="source-inline">Users</strong> link. Both links take you to change list pages. These are the pages that a Bookr administrator visits when they want to add new books or add or alter the privileges of a user. As explained above, a change list page presents a list of model objects with the option of selecting a group of them for bulk deletion (or other bulk activity), examining an individual object with a view to editing it, or adding a new object. Notice the difference between the two change list pages with a view to making our vanilla <strong class="source-inline">Books</strong> page as fully featured as the <strong class="source-inline">Users</strong> page. </p>
			<p>The following screenshot from the <strong class="source-inline">Authentication and Authorization</strong> app contains useful features such as a search bar, sortable column headers for important user fields, and a result filter:</p>
			<div>
				<div id="_idContainer171" class="IMG---Figure">
					<img src="image/B15509_04_44.jpg" alt="Figure 4.44: The Users change list contains customized ModelAdmin features&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.44: The Users change list contains customized ModelAdmin features</p>
			<h3 id="_idParaDest-162"><a id="_idTextAnchor165"/>The List Display Fields</h3>
			<p>On the <strong class="source-inline">Users</strong> change list page, you will see the following:</p>
			<ul>
				<li>There is a list of user objects presented, summarized by their <strong class="source-inline">USERNAME</strong>, <strong class="source-inline">EMAIL ADDRESS</strong>, <strong class="source-inline">FIRST NAME</strong>, <strong class="source-inline">LAST NAME</strong>, and <strong class="source-inline">STAFF STATUS</strong> attributes.</li>
				<li>These individual attributes are sortable. The sorting order can be changed by clicking the headers.</li>
				<li>There is a search bar at the top of the page.</li>
				<li>In the right-hand column, there is a selection filter that allows the selection of several user fields, including some not appearing in the list display.</li>
			</ul>
			<p>However, the behavior for the <strong class="source-inline">Books</strong> change list page is a lot less helpful. The books are listed by their titles but not in alphabetical order. The title column is not sortable and there are no filter or search options present:</p>
			<div>
				<div id="_idContainer172" class="IMG---Figure">
					<img src="image/B15509_04_45.jpg" alt="Figure 4.45: The Books change list&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.45: The Books change list</p>
			<p>Recall from <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>, that we defined <strong class="source-inline">__str__</strong> methods on the <strong class="source-inline">Publisher</strong>, <strong class="source-inline">Book</strong>, and <strong class="source-inline">Contributor</strong> classes. In the case of the <strong class="source-inline">Book</strong> class, it had a <strong class="source-inline">__str__()</strong> representation that returns the book object's title:</p>
			<p class="source-code">class Book(models.Model):</p>
			<p class="source-code">    …</p>
			<p class="source-code">    def __str__(self):</p>
			<p class="source-code">        return "{} ({})".format(self.title, self.isbn)</p>
			<p>If we had not defined the <strong class="source-inline">__str__()</strong> method on the <strong class="source-inline">Book</strong> class, it would have inherited it from the base <strong class="source-inline">Model</strong> class, <strong class="source-inline">django.db.models.Model</strong>. </p>
			<p>This base class provides an abstract way to give a string representation of an object. When we have <strong class="source-inline">Book</strong> with a primary key, in this case, the <strong class="source-inline">id</strong> field, with a value of <strong class="source-inline">17</strong>, then we will end up with a string representation of <strong class="source-inline">Book object (17)</strong>:</p>
			<div>
				<div id="_idContainer173" class="IMG---Figure">
					<img src="image/B15509_04_46.jpg" alt="Figure 4.46: The Books change list using the Model __str__ representation &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.46: The Books change list using the Model __str__ representation </p>
			<p>It could be useful in our application to represent a <strong class="source-inline">Book</strong> object as a composite of several fields. For example, if we wanted the books to be represented as <strong class="source-inline">Title (ISBN)</strong>, the following code snippet would produce the desired results:</p>
			<p class="source-code">class Book(models.Model):</p>
			<p class="source-code">    …</p>
			<p class="source-code">    def __str__(self):</p>
			<p class="source-code">        return "{} ({})".format(self.title, self.isbn)</p>
			<p>This is a useful change in and of itself as it makes the representation of the object more intuitive in the app: </p>
			<div>
				<div id="_idContainer174" class="IMG---Figure">
					<img src="image/B15509_04_47.jpg" alt="Figure 4.47: A portion of the Books change list with the custom string representation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.47: A portion of the Books change list with the custom string representation</p>
			<p>We are not limited to using the <strong class="source-inline">__str__</strong> representation of the object in the <strong class="source-inline">list_display</strong> field. The columns that appear in the list display are determined by the <strong class="source-inline">ModelAdmin</strong> class of the Django admin app. At the Django shell, we can import the <strong class="source-inline">ModelAdmin</strong> class and examine its <strong class="source-inline">list_display</strong> attribute:</p>
			<p class="source-code">python manage.py shell</p>
			<p class="source-code">&gt;&gt;&gt; from django.contrib.admin import ModelAdmin</p>
			<p class="source-code">&gt;&gt;&gt; ModelAdmin.list_display</p>
			<p class="source-code">('__str__',)</p>
			<p>This explains why the default behavior of <strong class="source-inline">list_display</strong> is to display a single-columned table of the objects' <strong class="source-inline">__str__</strong> representations, so that we can customize the list display by overriding this value. The best practice is to subclass <strong class="source-inline">ModelAdmin</strong> for each object. If we wanted the <strong class="source-inline">Book</strong> list display to contain two separate columns for <strong class="source-inline">Title</strong> and <strong class="source-inline">ISBN</strong>, rather than having a single column containing both values as in <em class="italic">Figure 4.47</em>, we would subclass <strong class="source-inline">ModelAdmin</strong> as <strong class="source-inline">BookAdmin</strong> and specify the custom <strong class="source-inline">list_display</strong>. The benefit of doing this is that we are now able to sort books by <strong class="source-inline">Title</strong> and by <strong class="source-inline">ISBN</strong>. We can add this class to <strong class="source-inline">reviews/admin.py</strong>:</p>
			<p class="source-code">class BookAdmin(admin.ModelAdmin):</p>
			<p class="source-code">    list_display = ('title', 'isbn')</p>
			<p>Now that we've created a <strong class="source-inline">BookAdmin</strong> class, we should reference it when we register our <strong class="source-inline">reviews.models.Book</strong> class with the admin site. In the same file, we also need to modify the model registration to use <strong class="source-inline">BookAdmin</strong> instead of the default value of <strong class="source-inline">admin.ModelAdmin</strong>, so the <strong class="source-inline">admin.site.register</strong> call now becomes the following:</p>
			<p class="source-code">admin.site.register(Book, BookAdmin)</p>
			<p>Once these two changes have been made to the <strong class="source-inline">reviews/admin.py</strong> file, we will get a <strong class="source-inline">Books</strong> change list page that looks like this:</p>
			<div>
				<div id="_idContainer175" class="IMG---Figure">
					<img src="image/B15509_04_48.jpg" alt="Figure 4.48: A portion of the Books change list with a two-column list display&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.48: A portion of the Books change list with a two-column list display</p>
			<p>This gives us a hint as to how flexible <strong class="source-inline">list_display</strong> is. It can take four types of values:</p>
			<ul>
				<li>It takes field names from the model, such as <strong class="source-inline">title</strong> or <strong class="source-inline">isbn</strong>.</li>
				<li>It takes a function that takes the model instance as an argument, such as this function that gives an initialized version of a person's name:<p class="source-code">def initialled_name(obj):</p><p class="source-code">    """ obj.first_names='Jerome David', obj.last_names='Salinger'</p><p class="source-code">        =&gt; 'Salinger, JD' """</p><p class="source-code">    initials = ''.join([name[0] for name in \</p><p class="source-code">                        obj.first_names.split(' ')])</p><p class="source-code">    return "{}, {}".format(obj.last_names, initials)</p><p class="source-code">class ContributorAdmin(admin.ModelAdmin):</p><p class="source-code">    list_display = (initialled_name,)</p></li>
				<li>It takes a method from the <strong class="source-inline">ModelAdmin</strong> subclass that takes the model object as a single argument. Note that this needs to be specified as a string argument as it would be out of scope and undefined within the class:<p class="source-code">class BookAdmin(admin.ModelAdmin):</p><p class="source-code">    list_display = ('title', 'isbn13')</p><p class="source-code">    def isbn13(self, obj):</p><p class="source-code">        """ '9780316769174' =&gt; '978-0-31-676917-4' """</p><p class="source-code">        return "{}-{}-{}-{}-{}".format\</p><p class="source-code">                                (obj.isbn[0:3], obj.isbn[3:4],\</p><p class="source-code">                                 obj.isbn[4:6], obj.isbn[6:12],\</p><p class="source-code">                                 obj.isbn[12:13])</p></li>
				<li>It takes a method (or a non-field attribute) of the model class, such as <strong class="source-inline">__str__</strong>, as long as it accepts the model object as an argument. For example, we could convert <strong class="source-inline">isbn13</strong> to a method on the <strong class="source-inline">Book</strong> model class:<p class="source-code">class Book(models.Model):</p><p class="source-code">    def isbn13(self):</p><p class="source-code">        """ '9780316769174' =&gt; '978-0-31-676917-4' """</p><p class="source-code">        return "{}-{}-{}-{}-{}".format\</p><p class="source-code">                                (self.isbn[0:3], self.isbn[3:4],\</p><p class="source-code">                                 self.isbn[4:6], self.isbn[6:12],\</p><p class="source-code">                                 self.isbn[12:13])</p><p>Now when viewing the <strong class="source-inline">Books</strong> change list at <strong class="source-inline">http://127.0.0.1:8000/admin/reviews/book</strong>, we can see the hyphenated <strong class="source-inline">ISBN13</strong> field:</p></li>
			</ul>
			<div>
				<div id="_idContainer176" class="IMG---Figure">
					<img src="image/B15509_04_49.jpg" alt="Figure 4.49: A portion of the Books change list with the hyphenated ISBN13&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.49: A portion of the Books change list with the hyphenated ISBN13</p>
			<p>It is worth noting that computed fields such as <strong class="source-inline">__str__</strong> or our <strong class="source-inline">isbn13</strong> methods do not make for sortable fields on the summary page. Also, we cannot include fields of type <strong class="source-inline">ManyToManyField</strong> in <strong class="source-inline">display_list</strong>.</p>
			<h3 id="_idParaDest-163"><a id="_idTextAnchor166"/>The Filter</h3>
			<p>Once the admin interface needs to deal with a significant number of records, it is convenient to narrow down the results that appear on change list pages. The simplest filters select individual values. For example, the user filter depicted in <em class="italic">Figure 4.6</em> allows the selection of users by <strong class="source-inline">staff status</strong>, by <strong class="source-inline">superuser status</strong>, and <strong class="source-inline">active</strong>. We've seen on the user filter that <strong class="source-inline">BooleanField</strong> can be used as a filter. We can also implement filters on <strong class="source-inline">CharField</strong>, <strong class="source-inline">DateField</strong>, <strong class="source-inline">DateTimeField</strong>, <strong class="source-inline">IntegerField</strong>, <strong class="source-inline">ForeignKey</strong>, and <strong class="source-inline">ManyToManyField</strong>. In this case, adding <strong class="source-inline">publisher</strong> as a <strong class="source-inline">ForeignKey</strong> of <strong class="source-inline">Book</strong>, it is defined on the <strong class="source-inline">Book</strong> class as follows:</p>
			<p class="source-code">publisher = models.ForeignKey(Publisher, \</p>
			<p class="source-code">                              on_delete=models.CASCADE)</p>
			<p>Filters are implemented using the <strong class="source-inline">list_filter</strong> attribute of a <strong class="source-inline">ModelAdmin</strong> subclass. In our Bookr app, filtering by book title or ISBN would be impractical as it would produce a large list of filter options that return only one record. The filter that would occupy the right-hand side of the page would take up more space than the actual change list. A practical option would be to filter books by publisher. We defined a custom <strong class="source-inline">__str__</strong> method for the <strong class="source-inline">Publisher</strong> model that returns the publisher's <strong class="source-inline">name</strong> attribute, so our filter options will be listed as publisher names.</p>
			<p>We can specify our change list filter in <strong class="source-inline">reviews/admin.py</strong> in the <strong class="source-inline">BookAdmin</strong> class:</p>
			<p class="source-code">    list_filter = ('publisher',)</p>
			<p>Here is how the <strong class="source-inline">Books</strong> change page should look now:</p>
			<div>
				<div id="_idContainer177" class="IMG---Figure">
					<img src="image/B15509_04_50.jpg" alt="Figure 4.50: The Books change page with the publisher filter&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.50: The Books change page with the publisher filter</p>
			<p>With that line of code, we have implemented a useful publisher filter on the <strong class="source-inline">Books</strong> change list page.</p>
			<h2 id="_idParaDest-164"><a id="_idTextAnchor167"/>Exercise 4.04: Adding a Date list_filter and date_hierarchy</h2>
			<p>We have seen that the <strong class="source-inline">admin.ModelAdmin</strong> class provides useful attributes to customize filters on change list pages. For example, filtering by date is crucial functionality for many applications and can also help us make our app more user-friendly. In this exercise, we will examine how date filtering can be implemented by including a date field in the filter and look at the <strong class="source-inline">date_hierarchy</strong> filter:</p>
			<ol>
				<li value="1">Edit the <strong class="source-inline">reviews/admin.py</strong> file and modify the <strong class="source-inline">list_filter</strong> attribute in the <strong class="source-inline">BookAdmin</strong> class to include <strong class="source-inline">'publication_date'</strong>:<p class="source-code">class BookAdmin(admin.ModelAdmin):</p><p class="source-code">    list_display = ('title', 'isbn')</p><p class="source-code">    list_filter = ('publisher', <strong class="bold">'publication_date'</strong>)</p></li>
				<li>Reload the <strong class="source-inline">Books</strong> change page and confirm that the filter now includes date settings:<div id="_idContainer178" class="IMG---Figure"><img src="image/B15509_04_51.jpg" alt="Figure 4.51: Confirming that the Books change page includes date settings&#13;&#10;"/></div><p class="figure-caption">Figure 4.51: Confirming that the Books change page includes date settings</p><p>This publication date filter would be convenient if the Bookr project was receiving a lot of new releases, and we wanted to filter books by what was published in the last 7 days or a month. Sometimes though, we might like to filter by a specific year or a specific month in a specific year. Fortunately, the <strong class="source-inline">admin.ModelAdmin</strong> class comes with a custom filter attribute that is geared towards navigating hierarchies of temporal information. It is called <strong class="source-inline">date_hierarchy</strong>.</p></li>
				<li>Add a <strong class="source-inline">date_hierarchy</strong> attribute to <strong class="source-inline">BookAdmin</strong> and set its value to <strong class="source-inline">publication_date</strong>:<p class="source-code">class BookAdmin(admin.ModelAdmin):</p><p class="source-code">    <strong class="bold">date_hierarchy = 'publication_date'</strong></p><p class="source-code">    list_display = ('title', 'isbn')</p><p class="source-code">    list_filter = ('publisher', 'publication_date')</p></li>
				<li>Reload the <strong class="source-inline">Books</strong> change page and confirm that the date hierarchy appears above the <strong class="source-inline">Action</strong> dropdown:<div id="_idContainer179" class="IMG---Figure"><img src="image/B15509_04_52.jpg" alt="Figure 4.52: Confirming that the date hierarchy appears above the Action dropdown&#13;&#10;"/></div><p class="figure-caption">Figure 4.52: Confirming that the date hierarchy appears above the Action dropdown</p></li>
				<li>Select a year from the date hierarchy and confirm that it contains a list of months in that year containing book titles and a total list of books:<div id="_idContainer180" class="IMG---Figure"><img src="image/B15509_04_53.jpg" alt="Figure 4.53: Confirming that the selection of a year from the date hierarchy shows the books published that year&#13;&#10;"/></div><p class="figure-caption">Figure 4.53: Confirming that the selection of a year from the date hierarchy shows the books published that year</p></li>
				<li>Confirm that selecting one of these months further filters down to days in the month:<div id="_idContainer181" class="IMG---Figure"><img src="image/B15509_04_54.jpg" alt="Figure 4.54: Filtering months down to days in the month&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 4.54: Filtering months down to days in the month</p>
			<p>The <strong class="source-inline">date_hierarchy</strong> filter is a convenient way of customizing a change list that contains a large set of time-sortable data in order to facilitate faster record selection, as we saw in this exercise. Let's now look at the implementation of a search bar in our app.</p>
			<h2 id="_idParaDest-165"><a id="_idTextAnchor168"/>The Search Bar</h2>
			<p>This brings us to the remaining piece of functionality that we wanted to implement – the search bar. Like filters, a basic search bar is quite simple to implement. We only need to add the <strong class="source-inline">search_fields</strong> attribute to the <strong class="source-inline">ModelAdmin</strong> class. The obvious character fields in our <strong class="source-inline">Book</strong> class to search on are <strong class="source-inline">title</strong> and <strong class="source-inline">isbn</strong>. At present, the <strong class="source-inline">Books</strong> change list appears with a date hierarchy across the top of the change list. The search bar will appear above this:</p>
			<div>
				<div id="_idContainer182" class="IMG---Figure">
					<img src="image/B15509_04_55.jpg" alt="Figure 4.55: Books change list before the search bar is added&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.55: Books change list before the search bar is added</p>
			<p>We can start by adding this attribute to <strong class="source-inline">BookAdmin</strong> in <strong class="source-inline">reviews/admin.py</strong> and examine the result:</p>
			<p class="source-code">    search_fields = ('title', 'isbn')</p>
			<p>The result would look like this:</p>
			<div>
				<div id="_idContainer183" class="IMG---Figure">
					<img src="image/B15509_04_56.jpg" alt="Figure 4.56: Books change list with the search bar&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.56: Books change list with the search bar</p>
			<p>Now we can perform a simple text search on fields that match the title field or ISBN. This search requires precise string matches, so "color" won't match "colour." It also lacks the deep semantic processing that we expect from more sophisticated search facilities such as <strong class="bold">Elasticsearch</strong>. ISBN lookup is a very good feature if you happen to have a barcode scanner. Limiting our search to fields on the <strong class="source-inline">Books</strong> model is quite restrictive. We might want to search by publisher name too. Fortunately, <strong class="source-inline">search_fields</strong> is flexible enough to accomplish this. To search on <strong class="source-inline">ForeignKeyField</strong> or <strong class="source-inline">ManyToManyField</strong>, we just need to specify the field name on the current model and the field on the related model separated by two underscores. In this case, <strong class="source-inline">Book</strong> has a foreign key, <strong class="source-inline">publisher</strong>, and we want to search on the <strong class="source-inline">Publisher.name</strong> field so it can be specified as <strong class="source-inline">'publisher__name'</strong> on <strong class="source-inline">BookAdmin.search_fields</strong>:</p>
			<p class="source-code">    search_fields = ('title', 'isbn', 'publisher__name')</p>
			<p>If we wanted to restrict a search field to an exact match rather than return results that contain the search string, then the field can be suffixed with <strong class="source-inline">'__exact'</strong>. So, replacing <strong class="source-inline">'isbn'</strong> with <strong class="source-inline">'isbn__exact'</strong> will require the complete ISBN to be matched, and we won't be able to get a match using a portion of the ISBN.</p>
			<p>Similarly, we constrain the search field to only return results that start with the search string by using the <strong class="source-inline">'__startswith'</strong> suffix. Qualifying the publisher name search field as <strong class="source-inline">'publisher__name__startswith'</strong> means that we will get results searching for "pack" but not for "ackt."</p>
			<h2 id="_idParaDest-166"><a id="_idTextAnchor169"/>Excluding and Grouping Fields</h2>
			<p>There are occasions when it is appropriate to restrict the visibility of some of the fields in the model in the admin interface. This can be achieved with the <strong class="source-inline">exclude</strong> attribute. </p>
			<p>This is the review form screen with the <strong class="source-inline">Date edited</strong> field visible. Note that the <strong class="source-inline">Date created</strong> field does not appear – it is already a hidden view because <strong class="source-inline">date_created</strong> is defined on the model with the <strong class="source-inline">auto_now_add</strong> parameter:</p>
			<div>
				<div id="_idContainer184" class="IMG---Figure">
					<img src="image/B15509_04_57.jpg" alt="Figure 4.57: The review form&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.57: The review form</p>
			<p>If we wanted to exclude the <strong class="source-inline">Date edited</strong> field from the review form, we would do this in the <strong class="source-inline">ReviewAdmin</strong> class:</p>
			<p class="source-code">exclude = ('date_edited')</p>
			<p>Then the review form would appear without <strong class="source-inline">Date edited</strong>: </p>
			<div>
				<div id="_idContainer185" class="IMG---Figure">
					<img src="image/B15509_04_58.jpg" alt="Figure 4.58: The review form with the Date edited field excluded&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.58: The review form with the Date edited field excluded</p>
			<p>Conversely, it might be more prudent to restrict the admin fields to those that have been explicitly permitted. This is achieved with the <strong class="source-inline">fields</strong> attribute. The advantage of this approach is that if new fields are added in the model, they won't be available in the admin form unless they have been added to the <strong class="source-inline">fields</strong> tuple in the <strong class="source-inline">ModelAdmin</strong> subclass:</p>
			<p class="source-code">fields = ('content', 'rating', 'creator', 'book')</p>
			<p>This will give us the same result that we saw earlier.</p>
			<p>Another option is to use the <strong class="source-inline">fieldsets</strong> attribute of the <strong class="source-inline">ModelAdmin</strong> subclass to specify the form layout as a series of grouped fields. Each grouping in <strong class="source-inline">fieldsets</strong> consists of a title followed by a dictionary containing a <strong class="source-inline">'fields'</strong> key pointing to a list of field name strings:</p>
			<p class="source-code">    fieldsets = (('Linkage', {'fields': ('creator', 'book')}),\</p>
			<p class="source-code">                 ('Review content', \</p>
			<p class="source-code">                   {'fields': ('content', 'rating')}))</p>
			<p>The review form should look as follows:</p>
			<div>
				<div id="_idContainer186" class="IMG---Figure">
					<img src="image/B15509_04_59.jpg" alt="Figure 4.59: The review form with fieldsets&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.59: The review form with fieldsets</p>
			<p>If we want to omit the title on a fieldset, we can do so by assigning the value <strong class="source-inline">None</strong> to it:</p>
			<p class="source-code">    fieldsets = ((<strong class="bold">None</strong>, {'fields': ('creator', 'book')}),\</p>
			<p class="source-code">                 ('Review content', \</p>
			<p class="source-code">                   {'fields': ('content', 'rating')}))</p>
			<p>Now, the review form should appear as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer187" class="IMG---Figure">
					<img src="image/B15509_04_60.jpg" alt="Figure 4.60: The review form with the first fieldset untitled&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.60: The review form with the first fieldset untitled</p>
			<h2 id="_idParaDest-167">Activity 4.02: Customizin<a id="_idTextAnchor170"/>g the Model Admins</h2>
			<p>In our data model, the <strong class="source-inline">Contributor</strong> class is used to store data for book contributors -- they can be authors, contributors, or editors. This activity focuses on modifying the <strong class="source-inline">Contributor</strong> class and adding a <strong class="source-inline">ContributorAdmin</strong> class to improve the user-friendliness of the admin app. At present, the <strong class="source-inline">Contributor</strong> change list defaults to a single column, <strong class="source-inline">FirstNames</strong>, based on the <strong class="source-inline">__str__</strong> method created in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>. We will investigate some alternative ways of representing this. These steps will help you complete the activity:</p>
			<ol>
				<li value="1">Edit <strong class="source-inline">reviews/models.py</strong> to add additional functionality to the <strong class="source-inline">Contributor</strong> model.</li>
				<li>Add an <strong class="source-inline">initialled_name</strong> method to <strong class="source-inline">Contributor</strong> that takes no arguments (like the <strong class="source-inline">Book.isbn13</strong> method).</li>
				<li>The <strong class="source-inline">initialled_name</strong> method will return a string containing <strong class="source-inline">Contributor.last_names</strong> followed by a comma and the initials of the given names. For example, for a <strong class="source-inline">Contributor</strong> object with <strong class="source-inline">first_names</strong> of <strong class="source-inline">Jerome David</strong> and <strong class="source-inline">last_names</strong> of <strong class="source-inline">Salinger</strong>, <strong class="source-inline">initialled_name</strong> will return <strong class="source-inline">Salinger, JD</strong>.</li>
				<li>Replace the <strong class="source-inline">__str__</strong> method for <strong class="source-inline">Contributor</strong> with one that calls <strong class="source-inline">initialled_name()</strong>.<p>At this point, the <strong class="source-inline">Contributors</strong> display list will look like this:</p><div id="_idContainer188" class="IMG---Figure"><img src="image/B15509_04_61.jpg" alt="Figure 4.61: Contributors display list&#13;&#10;"/></div><p class="figure-caption">Figure 4.61: Contributors display list</p></li>
				<li>Add a <strong class="source-inline">ContributorAdmin</strong> class in <strong class="source-inline">reviews/admin.py</strong>. It should inherit from <strong class="source-inline">admin.ModelAdmin</strong>. </li>
				<li>Modify it so that on the <strong class="source-inline">Contributors</strong> change list, records are displayed with two sortable columns – <strong class="source-inline">Last Names</strong> and <strong class="source-inline">First Names</strong>.</li>
				<li>Add a search bar that searches on <strong class="source-inline">Last Names</strong> and <strong class="source-inline">First Names</strong>. Modify it so that it only matches the start of <strong class="source-inline">Last Names</strong>.</li>
				<li>Add a filter on <strong class="source-inline">Last Names</strong>.</li>
			</ol>
			<p>By completing the activity, you should be able to see something like this:</p>
			<div>
				<div id="_idContainer189" class="IMG---Figure">
					<img src="image/B15509_04_62.jpg" alt="Figure 4.62: Expected output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.62: Expected output</p>
			<p>Changes such as these can be made to improve the functionality of the admin user interface. By implementing <strong class="source-inline">First Names</strong> and <strong class="source-inline">Last Names</strong> columns as separate columns in the <strong class="source-inline">Contributors</strong> change list, we are giving the user an option to sort on either of the fields. By considering what columns are most useful in search retrieval and filter selections, we can improve the efficient retrieval of records.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h1 id="_idParaDest-168"><a id="_idTextAnchor171"/>Summary</h1>
			<p>In this chapter, we saw how to create superusers through the Django command line and how to use them to access the admin app. After a brief tour of the admin app's basic functionality, we examined how to register our models with it to produce a CRUD interface for our data.</p>
			<p>Then we learned how to refine this interface by modifying site-wide features. We altered how the admin app presents model data to the user by registering custom model admin classes with the admin site. This allowed us to make fine-grained changes to the representation of our models' interfaces. These modifications included customizing change list pages by adding additional columns, filters, date hierarchies, and search bars. We also modified the layout of the model admin pages by grouping and excluding fields.</p>
			<p>This was only a very shallow dive into the functionality of the admin app. We will revisit the rich functionality of <strong class="source-inline">AdminSite</strong> and <strong class="source-inline">ModelAdmin</strong> in <em class="italic">Chapter 10</em>, <em class="italic">Advanced Django Admin and Customization</em>. But first, we need to learn some more intermediate features of Django. In the next chapter, we will learn how to organize and serve static content, such as CSS, JavaScript, and images, from a Django app.</p>
		</div>
	</body></html>