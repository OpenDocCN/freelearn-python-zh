<html><head></head><body>
		<div><div></div>
		</div>
		<div><h1 id="_idParaDest-140"><a id="_idTextAnchor143"/>4. Introduction to Django Admin</h1>
		</div>
		<div><p class="callout-heading">Overview</p>
			<p class="callout">This chapter introduces you to the basic functionality of the Django admin app. You will start by creating superuser accounts for the Bookr app, before moving on to executing <code>ForeignKeys</code> in the admin app. At the end of this chapter, you will see how you can customize the admin app according to a unique set of preferences by sub-classing the <code>AdminSite</code> and <code>ModelAdmin</code> classes, to make its interface more intuitive and user-friendly.</p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor144"/>Introduction</h1>
			<p>When developing an app, there is often a need to populate it with data and then alter that data. We have already seen in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>, how this can be done on the command line using the Python <code>manage.py</code> shell. In <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>, we learned how to develop a web form interface to our model using Django's views and templates. But neither of these approaches is ideal for administering the data from the classes in <code>reviews/models.py</code>. Using the shell to manage data is too technical for non-programmers and building individual web pages would be a laborious process as it would see us repeating the same view logic and very similar template features for each table in the model. Fortunately, a solution to this problem was devised in the early days of Django when it was still being developed.</p>
			<p>Django admin is actually written as a Django app. It offers an intuitively rendered web interface to give administrative access to the model data. The admin interface is designed to be used by the administrators of the website. It is not intended to be used by non-privileged users who interact with the site. In our case of a book review system, the general population of book reviewers will never encounter the admin app. They will see the app pages, like those that we built with views and templates in <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>, and will write their reviews on the pages.</p>
			<p>Also, while developers put in a lot of effort to create a simple and inviting web interface for general users, the admin interface, being aimed at administrative users, maintains a utilitarian feel that typically displays the intricacies of the model. It may have escaped your attention, but you already have an admin app in your Bookr project. Look at the list of installed apps in <code>bookr/settings.py</code>:</p>
			<pre>INSTALLED_APPS = [
    'django.contrib.admin',
    …
]</pre>
			<p>Now, look at the URL patterns in <code>bookr/urls.py</code>:</p>
			<pre>urlpatterns = [
    path('admin/', admin.site.urls),
    …
]</pre>
			<p>If we put this path into our browser, we can see the link to the admin app on the development server is <code>http://127.0.0.1:8000/admin/</code>. Before we make use of it though, we need to create a superuser through the command line.</p>
			<h1 id="_idParaDest-142"><a id="_idTextAnchor145"/>Creating a Superuser Account</h1>
			<p>Our Bookr application has just found a new user. Her name is Alice, and she wants to start adding her reviews right away. Bob, who is already using Bookr, has just informed us that his profile seems incomplete and needs to be updated. David no longer wants to use the application and wants his account to be deleted. For security reasons, we do not want just any user performing these tasks for us. That's why we need to create a <strong class="bold">superuser</strong> with elevated privileges. Let's start by doing just that.</p>
			<p>In Django's authorization model, a superuser is one with the <code>Staff</code> attribute set. We will examine this later in the chapter and learn more about this authorization model in <em class="italic">Chapter 9</em>, <em class="italic">Sessions and Authentication</em>.</p>
			<p>We can create a superuser by using the <code>manage.py</code> script that we have explored in earlier chapters. Again, we need to be in the project directory when we enter it. We will use the <code>createsuperuser</code> subcommand by entering the following command in the command line (you will need to write <code>python</code> instead of <code>python3</code> if you're using Windows):</p>
			<pre>python3 manage.py createsuperuser</pre>
			<p>Let's go ahead and create our superuser.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In this chapter, we will use email addresses that fall under the <em class="italic">example.com</em> domain. This follows an established convention to use this reserved domain for testing and documentation. You could use your own email addresses if you prefer.</p>
			<h2 id="_idParaDest-143"><a id="_idTextAnchor146"/>Exercise 4.01: Creating a Superuser Account</h2>
			<p>In this exercise, you will create a superuser account that lets the user log into the admin site. This functionality will be used in the upcoming exercises as well, to implement changes that only a superuser can. The following steps will help you complete this exercise:</p>
			<ol>
				<li>Enter the following command to create a superuser:<pre>python manage.py createsuperuser</pre><p>On executing this command, you will be prompted to create a superuser. This command will prompt you for a superuser name, an optional email address, and a password.</p></li>
				<li>Add the username and email for the superuser as follows. Here, we are entering <code>bookradmin</code> (highlighted) at the prompt and pressing the <em class="italic">Enter</em> key. Similarly, at the next prompt, which asks you to enter your email address, you can add <code>bookradmin@example.com</code> (highlighted). Press the <em class="italic">Enter</em> key to continue:<pre>Username (leave blank to use 'django'): <code>bookradmin</code> to the superuser. Note that you won't see any output immediately.</p></li>
				<li>The next prompt in the shell is for your password. Add a strong password and press the <em class="italic">Enter</em> key to confirm it once again:<pre>Password:
Password (again): </pre><p>You should see the following message on your screen:</p><pre>Superuser created successfully.</pre><p>Note that the password is validated according to the following criteria:</p><p>It cannot be among the 20,000 most common passwords.</p><p>It should have a minimum of eight characters.</p><p>It cannot be only numerical characters.</p><p>It cannot be derived from the username, first name, last name, or email address of the user.</p><p>With this, you have created a superuser named <code>bookradmin</code> who can log in to the admin app. <em class="italic">Figure 4.1</em> shows how this looks in the shell:</p><div><img src="img/B15509_04_01.jpg" alt="Figure 4.1: Creating a superuser&#13;&#10;"/></div><p class="figure-caption">Figure 4.1: Creating a superuser</p></li>
				<li>Visit the admin app at <code>http://127.0.0.1:8000/admin</code> and log in with the superuser account that you have created:<div><img src="img/B15509_04_02.jpg" alt=" Figure 4.2 The Django administration login form&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption"> Figure 4.2 The Django administration login form</p>
			<p>In this exercise, you created a superuser account that we will be using for the rest of this chapter, to assign or remove privileges as needed.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The codes for all the exercises and activities used in this chapter can be found on the book's GitHub repository at <a href="http://packt.live/3pC5CRr">http://packt.live/3pC5CRr</a>.</p>
			<h1 id="_idParaDest-144"><a id="_idTextAnchor147"/>CRUD Operations Using the Django Admin App</h1>
			<p>Let's get back to the requests we got from Bob, Alice, and David. As a superuser, your tasks will involve creating, updating, retrieving, and deleting various user accounts, reviews, and title names. This set of activities is collectively termed CRUD. CRUD operations are central to the behavior of the admin app. It turns out that the admin app is already aware of the models from another Django app, <code>Authentication and Authorization</code> – referenced in <code>INSTALLED_APPS</code> as <code>'django.contrib.auth'</code>. When logging into <code>http://127.0.0.1:8000/admin/</code>, we are presented with the models from the authorization application, as shown in <em class="italic">Figure 4.3</em>:</p>
			<div><div><img src="img/B15509_04_03.jpg" alt="Figure 4.3: The Django administration window &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3: The Django administration window </p>
			<p>When the admin app is initialized, it calls its <code>autodiscover()</code> method to detect whether any other installed apps contain an admin module. If so, these admin models are imported. In our case, it has discovered <code>'django.contrib.auth.admin'</code>. Now that the modules are imported and our superuser account is ready, let's start by working on the requests from Bob, Alice, and David.</p>
			<h2 id="_idParaDest-145"><a id="_idTextAnchor148"/>Create</h2>
			<p>Before Alice starts writing her reviews, we need to create an account for her through the admin app. Once that is done, we can then look at the levels of administrative access that we can assign to her. To <code>+ Add</code> link next to <code>Users</code> (refer to <em class="italic">Figure 4.3</em>), and fill out the form, as shown in <em class="italic">Figure 4.4</em>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">We don't want any random user to have access to the Bookr users' accounts. Therefore, it is imperative that we choose strong, secure passwords.</p>
			<div><div><img src="img/B15509_04_04.jpg" alt="Figure 4.4: The Add user page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4: The Add user page</p>
			<p>There are three buttons at the bottom of the form:</p>
			<ul>
				<li><code>Save and add another</code> creates the user and renders the same <code>Add user</code> page again, with blank fields.</li>
				<li><code>Save and continue editing</code> creates the user and loads the <code>Change user</code> page. The <code>Change user</code> page lets you add additional information that wasn't present on the <code>Add user</code> page, such as <code>First name</code>, <code>Last name</code>, and more (see <em class="italic">Figure 4.5</em>). Note that <code>Password</code> does not have an editable field on the form. Instead, it shows information about the hashing technique that it is stored with, in addition to a link to a separate <em class="italic">change password</em> form.</li>
				<li><code>SAVE</code> creates the user and lets the user navigate to the <code>Select user to change</code> list page, as depicted in <em class="italic">Figure 4.6</em>.<div><img src="img/B15509_04_05.jpg" alt="Figure 4.5: The Change user page presented after clicking Save and continue editing&#13;&#10;"/></div></li>
			</ul>
			<p class="figure-caption">Figure 4.5: The Change user page presented after clicking Save and continue editing</p>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor149"/>Retrieve</h2>
			<p>The administrative tasks need to be divided among some users, and for this, the admin (the person with the superuser account) would like to view those users whose email addresses end with <em class="italic">n@example.com</em> and assign the tasks to these users. This is where the <code>SAVE</code> button on the <code>Add user</code> page (refer to <em class="italic">Figure 4.4</em>), we are taken to the <code>Select user to change</code> list page (as shown in <em class="italic">Figure 4.6</em>), which carries out the <code>Create</code> form is also reachable by clicking on the <code>ADD USER</code> button on the <code>Select user to change</code> list page. So, after we have added a few more users, the change list will look something like this:</p>
			<div><div><img src="img/B15509_04_06.jpg" alt="Figure 4.6: The Select user to change page &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6: The Select user to change page </p>
			<p>At the top of the form is a <code>Search</code> bar that searches the contents of the username, email address, and first and last names of users. On the right-hand side is a <code>FILTER</code> panel that narrows down the selection based on the values of <code>staff status</code>, <code>superuser status</code>, and <code>active</code>. In <em class="italic">Figure 4.7</em>, we will see what happens when we search the string <code>n@example.com</code> and see the results. This will return only the names of the users whose email addresses consist of a username ending in <em class="italic">n</em> and a domain starting with <em class="italic">example.com</em>. We will only see three users with email addresses matching this requirement – <code>bookradmin@example.com</code>, <code>carol.brown@example.com</code>, and <code>david.green@example.com</code>:</p>
			<div><div><img src="img/B15509_04_07.jpg" alt="Figure 4.7: Searching for users by a portion of their email address&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7: Searching for users by a portion of their email address</p>
			<h2 id="_idParaDest-147"><a id="_idTextAnchor150"/>Update</h2>
			<p>Remember that Bob wanted his profile to be updated. Let's <code>bob</code> username link in the <code>Select user to change</code> list:</p>
			<div><div><img src="img/B15509_04_08.jpg" alt="Figure 4.8: Selecting bob from the Select user to change list &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8: Selecting bob from the Select user to change list </p>
			<p>This will take us back to the <code>Change user</code> form where the values for <code>First name</code>, <code>Last name</code>, and <code>Email address</code> can be entered: </p>
			<div><div><img src="img/B15509_04_09.jpg" alt="Figure 4.9: Adding personal info&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9: Adding personal info</p>
			<p>As can be seen from <em class="italic">Figure 4.9</em>, we are adding personal information about Bob here – his name, surname, and email address, specifically.</p>
			<p>Another type of update operation is "soft deleting." The <code>Active</code> Boolean property allows us to deactivate a user rather than deleting the entire record and losing all the data that has dependencies on the account. This practice of using a Boolean flag to denote a record as inactive or removed (and subsequently filtering these flagged records out of queries) is referred to as a <code>Staff status</code> or <code>Superuser status</code> by ticking the respective checkboxes for those:</p>
			<div><div><img src="img/B15509_04_10.jpg" alt="Figure 4.10: Active, Staff status, and Superuser status Booleans&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.10: Active, Staff status, and Superuser status Booleans</p>
			<h2 id="_idParaDest-148"><a id="_idTextAnchor151"/>Delete</h2>
			<p>David no longer wants to use the Bookr application and has requested that we delete his account. The auth admin caters to this too. Select a user or user records on the <code>Select user to change</code> list page and choose the <code>Delete selected users</code> option from the <code>Action</code> dropdown. Then hit the <code>Go</code> button (<em class="italic">Figure 4.11</em>):</p>
			<div><div><img src="img/B15509_04_11.jpg" alt="Figure 4.11: Deleting from the Select user to change list page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.11: Deleting from the Select user to change list page</p>
			<p>You will be presented with a confirmation screen and taken back to the <code>Select user to change</code> list once you have deleted the object:</p>
			<div><div><img src="img/B15509_04_12.jpg" alt="Figure 4.12: User deletion confirmation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.12: User deletion confirmation</p>
			<p>You will see the following message once the user is deleted:</p>
			<div><div><img src="img/B15509_04_13.jpg" alt="Figure 4.13: User deletion notification&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.13: User deletion notification</p>
			<p>After that confirmation, you will find that David's account no longer exists.</p>
			<p>So far, we have learned how we can add a new user, get the details of another user, make changes to the data for a user, and delete a user. These skills helped us cater to Alice, Bob, and David's requests. As the number of users of our app grows, managing requests from hundreds of users will eventually become quite difficult. One way around this problem would be to delegate some of the administrative responsibilities to a selected set of users. We'll learn how to do that in the section that follows.</p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor152"/>Users and Groups</h2>
			<p>Django's authentication model consists of users, groups, and permissions. Users can belong to many groups and this is a way of categorizing users. It also streamlines the implementation of permissions by allowing permissions to be assigned to collections of users as well as individuals.</p>
			<p>In <em class="italic">Exercise 4.01</em>, <em class="italic">Creating a Superuser Account</em>, we saw how we could cater to Alice, David, and Bob's requests to make modifications to their profiles. It was quite easy to do and our application seems well-equipped to handle their requests.</p>
			<p>What will happen when the number of users grows? Will the admin user be able to manage 100 or 150 users at once? As you can imagine, this can be quite a complicated task. To overcome this, we can give elevated permissions to a certain set of users and they can help ease the admin's tasks. And that's where groups come in handy. Though we'll learn more about users, groups, and permissions in <em class="italic">Chapter 9</em>, <em class="italic">Sessions and Authentication</em>, we can start understanding groups and their functionality by creating a <code>Help Desk user group</code> that contains accounts having access to the admin interface but lacking many powerful features, such as the ability to add, edit, or delete groups or to add or delete users.</p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor153"/>Exercise 4.02: Adding and Modifying Users and Groups through the Admin app</h2>
			<p>In this exercise, we will grant a certain level of administrative access to one of our Bookr users, Carol. First, we will define the level of access for a group, and then we will add Carol to the group. This will allow Carol to update user profiles and check user logs. The following steps will help you implement this exercise:</p>
			<ol>
				<li value="1">Visit the admin interface at <code>http://127.0.0.1:8000/admin/</code> and log in as <code>bookradmin</code> using the account set up with the superuser command.</li>
				<li>In the admin interface, follow the links to <code>Home</code> › <code>Authentication and Authorization</code> › <code>Groups</code>:<div><img src="img/B15509_04_14.jpg" alt="Figure 4.14: The Groups and Users options on the Authentication AND Authorization page&#13;&#10;"/></div><p class="figure-caption">Figure 4.14: The Groups and Users options on the Authentication AND Authorization page</p></li>
				<li>Use <code>ADD GROUP +</code> in the top right-hand corner to add a new group:<div><img src="img/B15509_04_15.jpg" alt="Figure 4.15: Adding a new group&#13;&#10;"/></div><p class="figure-caption">Figure 4.15: Adding a new group</p></li>
				<li>Name the group <code>Help Desk User</code> and give it the following permissions, as shown in <em class="italic">Figure 4.16</em>:<p><code>Can view log entry</code></p><p><code>Can view permission</code></p><p><code>Can change user</code></p><p><code>Can view user</code></p><div><img src="img/B15509_04_16.jpg" alt="Figure 4.16: Selecting the permissions&#13;&#10;"/></div><p class="figure-caption">Figure 4.16: Selecting the permissions</p><p>This can be done by selecting the permissions from <code>Available permissions</code> and clicking the right arrow in the middle so that they appear under <code>Chosen permissions</code>. Note that to add multiple permissions at a time, you can hold down the <em class="italic">Ctrl</em> key (or <em class="italic">Command</em> for Mac) to select more than one:</p><div><img src="img/B15509_04_17.jpg" alt="Figure 4.17: Adding selected permissions into Chosen permissions&#13;&#10;"/></div><p class="figure-caption">Figure 4.17: Adding selected permissions into Chosen permissions</p><p>Once you click the <code>SAVE</code> button, you will see a confirmation message, stating that the group <code>Help Desk User</code> was added successfully:</p><div><img src="img/B15509_04_18.jpg" alt="Figure 4.18: Message confirming that the group Help Desk User was added&#13;&#10;"/></div><p class="figure-caption">Figure 4.18: Message confirming that the group Help Desk User was added</p></li>
				<li>Now, navigate to <code>Home</code> › <code>Authentication and Authorization</code> › <code>Users</code> and click the link of the user with the first name <code>carol</code>:<div><img src="img/B15509_04_19.jpg" alt="Figure 4.19: Clicking on the username carol&#13;&#10;"/></div><p class="figure-caption">Figure 4.19: Clicking on the username carol</p></li>
				<li>Scroll down to the <code>Permissions</code> fields set and select the <code>Staff status</code> checkbox. This is required for Carol to be able to log in to the admin app:<div><img src="img/B15509_04_20.jpg" alt="Figure 4.20: Clicking the Staff status checkbox&#13;&#10;"/></div><p class="figure-caption">Figure 4.20: Clicking the Staff status checkbox</p></li>
				<li>Add Carol to the <code>Help Desk User</code> group that we created in the previous steps by selecting it from the <code>Available groups</code> selection box (refer <em class="italic">Figure 4.20</em>) and clicking the right arrow to shift it into her list of <code>Chosen groups</code> (as shown in <em class="italic">Figure 4.21</em>). Note that unless you do this, Carol won't be able to log in to the admin interface using her credentials:<div><img src="img/B15509_04_21.jpg" alt="Figure 4.21: Shifting the Help Desk User group into the list of Chosen groups for Carol&#13;&#10;"/></div><p class="figure-caption">Figure 4.21: Shifting the Help Desk User group into the list of Chosen groups for Carol</p></li>
				<li>Let's test whether what we've done up till now has yielded the right outcome. To do this, log out of the admin site and log in again as <code>carol</code>. Upon logging out, you should see the following on your screen:<div><img src="img/B15509_04_22.jpg" alt="Figure 4.22: Logout screen&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 4.22: Logout screen</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you don't recall the password that you initially gave her, you can change the password at the command line by typing <code>python3 manage.py changepassword carol</code>.</p>
			<p>Upon successful login, on the admin dashboard, you can see that there is no link to <code>Groups</code>: </p>
			<div><div><img src="img/B15509_04_23.jpg" alt="Figure 4.23: Admin dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.23: Admin dashboard</p>
			<p>As we did not assign any group permissions, not even <code>auth | group | Can view group</code>, to the <code>Help Desk User</code> group, when Carol logs in, the <code>Groups</code> admin interface is not available to her. Similarly, navigate to <code>Home › Authentication and Authorization › Users</code>. Clicking a user link, you will see that there are no options to edit or delete the user. This is because of the permissions that were granted to the Help Desk User group, of which Carol is a member. The members of the group can view and edit users but cannot add or delete any user. </p>
			<p>In this exercise, we learned how we can grant a certain amount of administrative privileges to users of our Django app.</p>
			<h1 id="_idParaDest-151"><a id="_idTextAnchor154"/>Registering the Reviews Model</h1>
			<p>Let's say that Carol is tasked with improving the Reviews section in Bookr; that is, only the most relevant and comprehensive reviews should be shown, and duplicate or spammy entries should be removed. For this, she will need access to the <code>reviews</code> model. As we have seen above with our investigation of groups and users, the admin app already contains admin pages for the models from the authentication and authorization app, but it does not yet reference the models in our Reviews app. </p>
			<p>To make the admin app aware of the models, we need to explicitly register them with the admin app. Fortunately, we don't need to modify the admin app's code to do so as we can instead import the admin app into our project and use its API to register our models. This has already been done in the authentication and authorization app, so let's try it with our Reviews app. Our aim is to be able to use the admin app to edit the data in our <code>reviews</code> model.</p>
			<p>Take a look at the <code>reviews/admin.py</code> file. It is a placeholder file that was generated with the <code>startapp</code> subcommand that we used in <em class="italic">Chapter 1</em>, <em class="italic">Introduction to Django</em>, and currently contains these lines:</p>
			<pre>from django.contrib import admin
# Register your models here.</pre>
			<p>Now we can try to expand this. To make the admin app aware of our models, we can modify the <code>reviews/admin.py</code> file and import the models. Then we could register the models with the <code>AdminSite</code> object, <code>admin.site</code>. The <code>AdminSite</code> object contains the instance of the Django admin application (later, we will learn how to subclass this <code>AdminSite</code> and override many of its properties). Then, our <code>reviews/admin.py</code> will look as follows:</p>
			<pre>from django.contrib import admin
from reviews.models import Publisher, Contributor, \
Book, BookContributor, Review
# Register your models here.
admin.site.register(Publisher)
admin.site.register(Contributor)
admin.site.register(Book)
admin.site.register(BookContributor)
admin.site.register(Review)</pre>
			<p>The <code>admin.site.register</code> method makes the models available to the admin app by adding it to a registry of classes contained in <code>admin.site._registry</code>. If we chose not to make a model accessible through the admin interface, we would simply not register it. When you reload <code>http://127.0.0.1:8000/admin/</code> in your browser, you will see the following on the admin app landing page. Note the change in the appearance of the admin page after the <code>reviews</code> model has been imported:</p>
			<div><div><img src="img/B15509_04_24.jpg" alt="Figure 4.24: Admin app landing page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.24: Admin app landing page</p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor155"/>Change Lists</h2>
			<p>We now have change lists populated for our models. If we click the <code>Publishers</code> link, we will be taken to <code>http://127.0.0.1:8000/admin/reviews/publisher</code> and see a change list containing links to the publishers. These links are designated by the <code>id</code> field of the <code>Publisher</code> objects. </p>
			<p>If your database has been populated with the script in <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>, you will see a list with seven publishers that looks like <em class="italic">Figure 4.25</em>:</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Depending on the state of your database and based on the activities you have completed, the object IDs, URLs, and links in these examples may be numbered differently from those listed here.</p>
			<div><div><img src="img/B15509_04_25.jpg" alt="Figure 4.25: Select publisher to change list&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.25: Select publisher to change list</p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor156"/>The Publisher Change Page</h2>
			<p>The publisher change page at <code>http://127.0.0.1:8000/admin/reviews/publisher/1</code> contains what we might expect (see <em class="italic">Figure 4.26</em>). There is a form for editing the publisher's details. These details have been derived from the <code>reviews.models.Publisher</code> class:</p>
			<div><div><img src="img/B15509_04_26.jpg" alt="Figure 4.26: Publisher change page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.26: Publisher change page</p>
			<p>If we had clicked the <code>ADD PUBLISHER</code> button, the admin app would have returned a similar form for adding a publisher. The beauty of the admin app is that it gives us all of this CRUD functionality with just one line of coding – <code>admin.site.register(Publisher)</code> – using the definition of the <code>reviews.models.Publisher</code> attributes as a schema for the page content:</p>
			<pre>class Publisher(models.Model):
    """A company that publishes books."""
    name = models.CharField\
           (help_text="The name of the Publisher.",\
            max_length=50)
    website = models.URLField\
              (help_text="The Publisher's website.")
    email = models.EmailField\
            (help_text="The Publisher's email address.")</pre>
			<p>The publisher <code>Name</code> field is constrained to 50 characters as specified in the model. The help text that appears in gray below each field is derived from the <code>help_text</code> attributes specified on the model. We can see that <code>models.CharField</code>,  <code>models.URLField</code>, and <code>models.EmailField</code> are rendered in HTML as input elements of type <code>text</code>, <code>url</code>, and <code>email</code> respectively. </p>
			<p>The fields in the form come with validation where appropriate. Unless model fields are set to <code>blank=True</code> or <code>null=True</code>, the form will throw an error if the field is left blank, as is the case for the <code>Publisher.name</code> field. Similarly, as <code>Publisher.website</code> and <code>Publisher.email</code> are respectively defined as instances of <code>models.URLField</code> and <code>models.EmailField</code>, they are validated accordingly. In <em class="italic">Figure 4.27</em>, we can see validation of <code>Name</code> as a required field, validation of <code>Website</code> as a URL, and validation of <code>Email</code> as an email address:</p>
			<div><div><img src="img/B15509_04_27.jpg" alt="Figure 4.27: Field validation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.27: Field validation</p>
			<p>It is useful to examine how the admin app renders elements of the models to understand how it functions. In your browser, right-click <code>View Page Source</code> and examine the HTML that has been rendered for this form. You will see a browser tab displaying something like this:</p>
			<pre>&lt;fieldset class="module aligned "&gt;
    &lt;div class="form-row errors field-name"&gt;
        &lt;ul class="errorlist"&gt;&lt;li&gt;This field is required.&lt;/li&gt;&lt;/ul&gt;
            &lt;div&gt;
                    &lt;label class="required" for="id_name"&gt;Name:&lt;/label&gt;
                        &lt;input type="text" name="name" class="vTextField"
                         maxlength="50" required id="id_name"&gt;
                    &lt;div class="help"&gt;The name of the Publisher.&lt;/div&gt;
            &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-row errors field-website"&gt;
        &lt;ul class="errorlist"&gt;&lt;li&gt;Enter a valid URL.&lt;/li&gt;&lt;/ul&gt;
            &lt;div&gt;
                    &lt;label class="required" for="id_website"&gt;Website:&lt;/label&gt;
                        &lt;input type="url" name="website" value="packtcom"
                         class="vURLField" maxlength="200" required
                         id="id_website"&gt;
                    &lt;div class="help"&gt;The Publisher's website.&lt;/div&gt;
            &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-row errors field-email"&gt;
        &lt;ul class="errorlist"&gt;&lt;li&gt;Enter a valid email address.&lt;/li&gt;&lt;/ul&gt;
            &lt;div&gt;
                    &lt;label class="required" for="id_email"&gt;Email:&lt;/label&gt;
                        &lt;input type="email" name="email" value="infoatpackt.com"
                         class="vTextField" maxlength="254" required
                         id="id_email"&gt;
                    &lt;div class="help"&gt;The Publisher's email address.&lt;/div&gt;
            &lt;/div&gt;
  &lt;/div&gt;
&lt;/fieldset&gt;</pre>
			<p>The form has an ID of <code>publisher_form</code> and it contains a fieldset with HTML elements corresponding to the data structure of the <code>Publisher</code> model in <code>reviews/models.py</code>, shown as follows:</p>
			<pre>class Publisher(models.Model):
    """A company that publishes books."""
    name = models.CharField\
           (max_length=50,
            help_text="The name of the Publisher.")
    website = models.URLField\
              (help_text="The Publisher's website.")
    email = models.EmailField\
            (help_text="The Publisher's email address.")</pre>
			<p>Note that for the name, the input field is rendered like this:</p>
			<pre>&lt;input type="text" name="name" value="Packt Publishing"
                   class="vTextField" maxlength="50" required="" id="id_name"&gt;</pre>
			<p>It is a required field, and it has a type of <code>text</code> and a <code>maxlength</code> of 50, as defined by the <code>max_length</code> parameter in the model definition:</p>
			<pre>    name = models.CharField\
           (help_text="The name of the Publisher.",\
            max_length=50)</pre>
			<p>Similarly, we can see the website and email being defined in the model as <code>URLField</code> and <code>EmailField</code> are rendered in HTML as input elements of type <code>url</code> and <code>email</code> respectively:</p>
			<pre>&lt;input type="url" name="website" value="https://www.packtpub.com/"
                     class="vURLField" maxlength="200" required=""
                     id="id_website"&gt;            
&lt;input type="email" name="email" value="info@packtpub.com"
                    class="vTextField" maxlength="254" required=""
                    id="id_email"&gt;</pre>
			<p>We have learned that this Django admin app derives sensible HTML representations of Django models based on the model definitions that we have provided.</p>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor157"/>The Book Change Page</h2>
			<p>Similarly, there is a change page that can be reached by selecting <code>Books</code> from the <code>Site administration</code> page and then selecting a specific book in the change list:</p>
			<div><div><img src="img/B15509_04_28.jpg" alt="Figure 4.28: Selecting Books from the Site administration page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.28: Selecting Books from the Site administration page</p>
			<p>After clicking <code>Books</code> as shown in the preceding screenshot, you will see the following on your screen:</p>
			<div><div><img src="img/B15509_04_29.jpg" alt="Figure 4.29: The book change page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.29: The book change page</p>
			<p>In this instance, selecting the book <em class="italic">Architects of Intelligence</em> will take us to the URL <code>http://127.0.0.1:8000/admin/reviews/book/3/change/</code>. In the previous example, all the model fields were rendered as simple HTML text widgets. The rendering of some other subclasses of <code>django.db.models.Field</code> used in <code>models.Book</code> are worthy of closer examination:</p>
			<p> </p>
			<div><div><img src="img/B15509_04_30.jpg" alt="Figure 4.30: The Change book page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.30: The Change book page</p>
			<p>Here, <code>publication_date</code> is defined using <code>models.DateField</code>. It is rendered using a date selection widget. The visual representation of the widgets will vary amongst operating systems and choice of browser:</p>
			<div><div><img src="img/B15509_04_31.jpg" alt="Figure 4.31: Date selection widget&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.31: Date selection widget</p>
			<p>As <code>Publisher</code> is defined as a foreign key relation, it is rendered by a <code>Publisher</code> dropdown with a list of <code>Publisher</code> objects:</p>
			<div><div><img src="img/B15509_04_32.jpg" alt="Figure 4.32: Publisher dropdown&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.32: Publisher dropdown</p>
			<p>This brings us to how the admin app handles deletion. The admin app takes its cue from the models' foreign key constraints when determining how to implement deletion functionality. In the <code>BookContributor</code> model, <code>Contributor</code> is defined as a foreign key. The code in <code>reviews/models.py</code> looks as follows:</p>
			<pre>contributor = models.ForeignKey(Contributor, on_delete=models.CASCADE)</pre>
			<p>By setting <code>on_delete=CASCADE</code> on a foreign key, the model is specifying the database behavior required when a record is deleted; the deletion is cascaded to other objects that are referenced by the foreign key.</p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor158"/>Exercise 4.03: Foreign Keys and Deletion Behavior in the Admin App</h2>
			<p>At present, all <code>ForeignKey</code> relations in the <code>reviews</code> models are defined with an <code>on_delete=CASCADE</code> behavior. For instance, think of a case wherein an admin deletes one of the publishers. This would delete all the books that are associated with the publisher. We do not want that to happen, and that is precisely the behavior that we will be changing in this exercise:</p>
			<ol>
				<li value="1">Visit the <code>Contributors</code> change list at <code>http://127.0.0.1:8000/admin/reviews/contributor/</code> and select a contributor to delete. Make sure that the contributor is the author of a book.</li>
				<li>Click the <code>Delete</code> button, but don't click <code>Yes, I'm sure</code> on the confirmation dialog. You will see a message like the one in <em class="italic">Figure 4.33</em>:<div><img src="img/B15509_04_33.jpg" alt="Figure 4.33: Cascading delete confirmation dialog&#13;&#10;"/></div><p class="figure-caption">Figure 4.33: Cascading delete confirmation dialog</p><p>In accordance with the <code>on_delete=CASCADE</code> argument to the foreign key, we are warned that deleting this Contributor object will have a cascading effect on a <code>BookContributor</code> object.</p></li>
				<li>In the <code>reviews/models.py</code> file, modify the <code>Contributor</code> attribute of <code>BookContributor</code> to the following and save the file:<pre>contributor = models.ForeignKey(Contributor, \
                                on_delete=models.PROTECT)</pre></li>
				<li>Now, try deleting the <code>Contributor</code> object again. You will see a message similar to the one in <em class="italic">Figure 4.34</em>:<div><img src="img/B15509_04_34.jpg" alt="Figure 4.34: Foreign key protection error&#13;&#10;"/></div><p class="figure-caption">Figure 4.34: Foreign key protection error</p><p>Because the <code>on_delete</code> argument is <code>PROTECT</code>, our attempt to delete the object with dependencies will throw an error. If we used this approach in our model, we would need to delete objects in the <code>ForeignKey</code> relation before we deleted the original object. In this case, it would mean deleting the <code>BookContributor</code> object before deleting the <code>Contributor</code> object.</p></li>
				<li>Now that we have learned about how the admin app handles <code>ForeignKey</code> relations, let's revert the <code>ForeignKey</code> definition in the <code>BookContributor</code> class to this:<pre>contributor = models.ForeignKey(Contributor, \
                                on_delete=models.CASCADE)</pre></li>
			</ol>
			<p>We have examined how the admin app's behavior adapts to the <code>ForeignKey</code> constraints that are expressed in model definitions. If the <code>on_delete</code> behavior is set to <code>models.PROTECT</code>, the admin app returns an error explaining why a protected object is blocking the deletion. This functionality can come in handy while building real-world apps, as there is often a chance of a manual error inadvertently leading to the deletion of important records. In the next section, we will look at how we can customize our admin app interface for a smoother user experience.</p>
			<h1 id="_idParaDest-156"><a id="_idTextAnchor159"/>Customizing the Admin Interface</h1>
			<p>When first developing an application, the convenience of the default admin interface is excellent for building a rapid prototype of the app. Indeed, for many simpler applications or projects that require minimal data maintenance, this default admin interface may be entirely adequate. However, as the application matures to the point of release, the admin interface will generally need to be customized to facilitate more intuitive use and to robustly control data, subject to user permissions. You might want to retain certain aspects of the default admin interface, and at the same time, make some tweaks to certain features to better suit your purposes. For example, you would want the publisher list to show the complete names of the publishing houses, instead of "<code>Publisher(1)</code>, <code>Publisher(2)</code>…" and so on. In addition to the aesthetic appeal, this makes it easier to use and navigate through the app.</p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor160"/>Site-Wide Django Admin Customizations</h2>
			<p>We have seen a page titled <code>Log in | Django site admin</code> containing a <code>Django Administration</code> form. However, an administrative user of the Bookr application may be somewhat perplexed by all this Django jargon, and it would be very confusing and a recipe for error if they had to deal with multiple Django apps that all had identical admin apps. As a developer of an intuitive and user-friendly application, you would want to customize this. Global properties like these are specified as attributes of the <code>AdminSite</code> object. The following table details some of the simplest customizations to improve the usability of your app's admin interface:</p>
			<div><div><img src="img/B15509_04_35.jpg" alt="Figure 4.35: Important AdminSite attributes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.35: Important AdminSite attributes</p>
			<h2 id="_idParaDest-158"><a id="_idTextAnchor161"/>Examining the AdminSite object from the Python Shell</h2>
			<p>Let's take a deeper look at the <code>AdminSite</code> class. We have already encountered an object of class <code>AdminSite</code>. It is the <code>admin.site</code> object that we used in the previous section, <em class="italic">Registering the Reviews Model</em>. If the development server is not running, start it now with the <code>runserver</code> subcommand, as follows (use <code>python</code> instead of <code>python3</code> for Windows):</p>
			<pre>python3 manage.py runserver</pre>
			<p>We can examine the <code>admin.site</code> object by importing the admin app in the Django shell, using the <code>manage.py</code> script again:</p>
			<pre>python3 manage.py shell
&gt;&gt;&gt;from django.contrib import admin</pre>
			<p>We can interactively examine the default values of <code>site_title</code>, <code>site_header</code>, and <code>index_title</code> and see that they match the expected values of <code>'Django site admin'</code>, <code>'Django administration'</code>, and <code>'Site administration'</code> that we have already observed on the rendered web pages of the Django admin app:</p>
			<pre>&gt;&gt;&gt; admin.site.site_title
'Django site admin'
&gt;&gt;&gt; admin.site.site_header
'Django administration'
&gt;&gt;&gt; admin.site.index_title
'Site administration'</pre>
			<p>The <code>AdminSite</code> class also specifies which forms and views are used to render the admin interface and determine its global behavior.</p>
			<h3 id="_idParaDest-159"><a id="_idTextAnchor162"/>Subclassing AdminSite</h3>
			<p>We can make some modifications to the <code>reviews/admin.py</code> file. Instead of importing the <code>django.contrib.admin</code> module and using its site object, we will import <code>AdminSite</code>, subclass it, and instantiate our customized <code>admin_site</code> object. Consider the following code snippet. Here, <code>BookrAdminSite</code> is a subclass of <code>AdminSite</code> that contains custom values for <code>site_title</code>,  <code>site_header</code>, and <code>index_title</code>; <code>admin_site</code> is an instance of <code>BookrAdminSite</code>; and we can use this instead of the default <code>admin.site</code> object, to register our models. The <code>reviews/admin.py</code> file will look as follows:</p>
			<pre>from django.contrib.admin import AdminSite
from reviews.models import (Publisher, Contributor, Book,\
     BookContributor, Review)
class BookrAdminSite(AdminSite):
    title_header = 'Bookr Admin'
    site_header = 'Bookr administration'
    index_title = 'Bookr site admin'
admin_site = BookrAdminSite(name='bookr')
# Register your models here.
admin_site.register(Publisher)
admin_site.register(Contributor)
admin_site.register(Book)
admin_site.register(BookContributor)
admin_site.register(Review)</pre>
			<p>As we have now created our own <code>admin_site</code> object that overrides the behavior of the <code>admin.site</code> object, we need to remove the existing references in our code to the <code>admin.site</code> object. In <code>bookr/urls.py</code>, we need to point admin to the new <code>admin_site</code> object and update our URL patterns. Otherwise, we would still be using the default admin site and our customizations would be ignored. The change will look as follows:</p>
			<pre>from reviews.admin import admin_site
from django.urls import include, path
import reviews.views
urlpatterns = [<strong class="bold">path('admin/', admin_site.urls),</strong>\
               path('', reviews.views.index),\
               path('book-search/', reviews.views.book_search, \
                    name='book_search'),\
               path('', include('reviews.urls'))]</pre>
			<p>This produces the expected results on the login screen:</p>
			<div><div><img src="img/B15509_04_36.jpg" alt="Figure 4.36: Customizing the login screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.36: Customizing the login screen</p>
			<p>However, now there is a problem; that is, we have lost the interface for auth objects. Previously, the admin app was discovering the models registered in <code>reviews/admin.py</code> and in <code>django.contrib.auth.admin</code> through the auto-discovery process, but now we have overridden this behavior by creating a new <code>AdminSite</code>:</p>
			<div><div><img src="img/B15509_04_37.jpg" alt="Figure 4.37: Customized AdminSite is missing Authentication and Authorization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.37: Customized AdminSite is missing Authentication and Authorization</p>
			<p>We could go down the path of referencing both <code>AdminSite</code> objects to URL patterns in <code>bookr/urls.py</code>, but this approach would mean that we would end up with two separate admin apps for authentication and reviews. So, the URL <code>http://127.0.0.1:8000/admin</code> will take you to the original admin app derived from the <code>admin.site</code> object, while <code>http://127.0.0.1:8000/bookradmin</code> will take you to our <code>BookrAdminSite</code>  <code>admin_site</code>. This is not what we want to do, as we are still left with the admin app without the customizations that we added when we sub-classed <code>BookrAdminSite</code>:</p>
			<pre>from django.contrib import admin
from reviews.admin import admin_site
from django.urls import path
urlpatterns = [path('admin/', admin.site.urls),\
               path('bookradmin/', admin_site.urls),]</pre>
			<p>This has been a clumsy problem with the Django admin interface that has led to a lot of ad hoc solutions in earlier versions. Since Django 2.1 came out, there is a simple way of integrating a customized interface for the admin app without breaking auto-discovery or any of its other default features. As <code>BookrAdminSite</code> is project-specific, the code does not really belong under our <code>reviews</code> folder. We should move <code>BookrAdminSite</code> to a new file called <code>admin.py</code> at the top level of the <code>Bookr</code> project directory:</p>
			<pre>from django.contrib import admin
class BookrAdminSite(admin.AdminSite):
    title_header = 'Bookr Admin'
    site_header = 'Bookr administration'
    index_title = 'Bookr site admin'</pre>
			<p>The URL settings path in <code>bookr/urls.py</code> changes to <code>path('admin/', admin.site.urls)</code> and we define our <code>ReviewsAdminConfig</code>. The <code>reviews/apps.py</code> file will contain these additional lines:</p>
			<pre>from django.contrib.admin.apps import AdminConfig
class ReviewsAdminConfig(AdminConfig):
    default_site = 'admin.BookrAdminSite'</pre>
			<p>Replace <code>django.contrib.admin</code> with <code>reviews.apps.ReviewsAdminConfig</code>, so that <code>INSTALLED_APPS</code> in the <code>bookr/settings.py</code> file will look as follows:</p>
			<pre>INSTALLED_APPS = [<strong class="bold">'reviews.apps.ReviewsAdminConfig'</strong>,\
                  'django.contrib.auth',\
                  'django.contrib.contenttypes',\
                  'django.contrib.sessions',\
                  'django.contrib.messages',\
                  'django.contrib.staticfiles',\
                  'reviews']</pre>
			<p>With the <code>ReviewsAdminConfig</code> specification of <code>default_site</code>, we no longer need to replace references to <code>admin.site</code> with a custom <code>AdminSite</code> object, <code>admin_site</code>. We can replace those <code>admin_site</code> calls with the <code>admin.site</code> calls that we had originally. Now, <code>reviews/admin.py</code> reverts to the following:</p>
			<pre>from django.contrib import admin
from reviews.models import (Publisher, Contributor, Book,\
     BookContributor, Review)
# Register your models here.
admin.site.register(Publisher)
admin.site.register(Contributor)
admin.site.register(Book, BookAdmin)
admin.site.register(BookContributor)
admin.site.register(Review)</pre>
			<p>There are other aspects of <code>AdminSite</code> that we can customize, but we will revisit these in <em class="italic">Chapter 9</em>, <em class="italic">Sessions and Authentication </em>once we have a fuller understanding of Django's templates and forms.</p>
			<h2 id="_idParaDest-160">Ac<a id="_idTextAnchor163"/>tivity 4.01: Customizing the SiteAdmin</h2>
			<p>You have learned how to modify attributes of the <code>AdminSite</code> object in a Django project. This activity will challenge you to use these skills to customize a new project and override its site title, site header, and index header. Also, you will replace the logout message by creating a project-specific template and setting it in our custom <code>SiteAdmin</code> object. You are developing a Django project that implements a message board, called <em class="italic">Comment8or</em>. <em class="italic">Comment8or</em> is geared toward a technical demographic, so you need to make the phraseology succinct and abbreviated:</p>
			<ol>
				<li value="1">The <em class="italic">Comment8or</em> admin site will be referred to as <code>c8admin</code>. This will appear on the site header and index title.</li>
				<li>For the title header, it will say <code>c8 site admin</code>.</li>
				<li>The default Django admin logout message is <code>Thanks for spending some quality time with the Web site today.</code> In Comment8or, it will say <code>Bye from c8admin.</code></li>
			</ol>
			<p>These are the steps that you need to follow to complete this activity:</p>
			<ol>
				<li value="1">Following the process that you learned in <em class="italic">Chapter 1</em>, <em class="italic">Introduction to Django</em>, create a new Django project called <code>comment8or</code>, an app called <code>messageboard</code>, and run the migrations. Create a superuser called <code>c8admin</code>.</li>
				<li>In the Django source code, there is a template for the logout page located in <code>django/contrib/admin/templates/registration/logged_out.html</code>. </li>
				<li>Make a copy of it in your project's directory under <code>comment8or/templates/comment8or</code>. Modify the message in the template following the requirements.</li>
				<li>Inside the project, create an <code>admin.py</code> file that implements a custom <code>SiteAdmin</code> object. Set the appropriate values for the attributes <code>index_title</code>, <code>title_header</code>, <code>site_header</code>, and <code>logout_template</code>, based on the requirements.</li>
				<li>Add a custom <code>AdminConfig</code> subclass to <code>messageboard/apps.py</code>.</li>
				<li>Replace the admin app with the custom <code>AdminConfig</code> subclass in <code>comment8or/settings.py</code>.</li>
				<li>Configure the <code>TEMPLATES</code> setting so that the project's template is discoverable.<p>When the project is first created, the login, app index, and logout pages will look as follows:</p><div><img src="img/B15509_04_38.jpg" alt="Figure 4.38: Login page for the project&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 4.38: Login page for the project</p>
			<div><div><img src="img/B15509_04_39.jpg" alt="Figure 4.39: App index page for the project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.39: App index page for the project</p>
			<div><div><img src="img/B15509_04_40.jpg" alt="Figure 4.40: Logout page for the project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.40: Logout page for the project</p>
			<p>After you have completed this activity, the login, app index, and logout pages will appear with the following customizations:</p>
			<div><div><img src="img/B15509_04_41.jpg" alt="Figure 4.41: Login page after customization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.41: Login page after customization</p>
			<div><div><img src="img/B15509_04_42.jpg" alt="Figure 4.42: App index page after customization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.42: App index page after customization</p>
			<div><div><img src="img/B15509_04_43.jpg" alt="Figure 4.43: Logout page after customization&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.43: Logout page after customization</p>
			<p>You have successfully customized the admin app by sub-classing <code>AdminSite</code>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h2 id="_idParaDest-161"><a id="_idTextAnchor164"/>Customizing the ModelAdmin Classes</h2>
			<p>Now that we've learned how a sub-classed <code>AdminSite</code> can be used to customize the global appearance of the admin app, we will look at how to customize the admin app's interface to individual models. Owing to the admin interface being generated automatically from the models' structure, it has an overly generic appearance and needs to be customized for the sake of aesthetics and usability. Click one of the <code>Books</code> links in the admin app and compare it to the <code>Users</code> link. Both links take you to change list pages. These are the pages that a Bookr administrator visits when they want to add new books or add or alter the privileges of a user. As explained above, a change list page presents a list of model objects with the option of selecting a group of them for bulk deletion (or other bulk activity), examining an individual object with a view to editing it, or adding a new object. Notice the difference between the two change list pages with a view to making our vanilla <code>Books</code> page as fully featured as the <code>Users</code> page. </p>
			<p>The following screenshot from the <code>Authentication and Authorization</code> app contains useful features such as a search bar, sortable column headers for important user fields, and a result filter:</p>
			<div><div><img src="img/B15509_04_44.jpg" alt="Figure 4.44: The Users change list contains customized ModelAdmin features&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.44: The Users change list contains customized ModelAdmin features</p>
			<h3 id="_idParaDest-162"><a id="_idTextAnchor165"/>The List Display Fields</h3>
			<p>On the <code>Users</code> change list page, you will see the following:</p>
			<ul>
				<li>There is a list of user objects presented, summarized by their <code>USERNAME</code>, <code>EMAIL ADDRESS</code>, <code>FIRST NAME</code>, <code>LAST NAME</code>, and <code>STAFF STATUS</code> attributes.</li>
				<li>These individual attributes are sortable. The sorting order can be changed by clicking the headers.</li>
				<li>There is a search bar at the top of the page.</li>
				<li>In the right-hand column, there is a selection filter that allows the selection of several user fields, including some not appearing in the list display.</li>
			</ul>
			<p>However, the behavior for the <code>Books</code> change list page is a lot less helpful. The books are listed by their titles but not in alphabetical order. The title column is not sortable and there are no filter or search options present:</p>
			<div><div><img src="img/B15509_04_45.jpg" alt="Figure 4.45: The Books change list&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.45: The Books change list</p>
			<p>Recall from <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>, that we defined <code>__str__</code> methods on the <code>Publisher</code>, <code>Book</code>, and <code>Contributor</code> classes. In the case of the <code>Book</code> class, it had a <code>__str__()</code> representation that returns the book object's title:</p>
			<pre>class Book(models.Model):
    …
    def __str__(self):
        return "{} ({})".format(self.title, self.isbn)</pre>
			<p>If we had not defined the <code>__str__()</code> method on the <code>Book</code> class, it would have inherited it from the base <code>Model</code> class, <code>django.db.models.Model</code>. </p>
			<p>This base class provides an abstract way to give a string representation of an object. When we have <code>Book</code> with a primary key, in this case, the <code>id</code> field, with a value of <code>17</code>, then we will end up with a string representation of <code>Book object (17)</code>:</p>
			<div><div><img src="img/B15509_04_46.jpg" alt="Figure 4.46: The Books change list using the Model __str__ representation &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.46: The Books change list using the Model __str__ representation </p>
			<p>It could be useful in our application to represent a <code>Book</code> object as a composite of several fields. For example, if we wanted the books to be represented as <code>Title (ISBN)</code>, the following code snippet would produce the desired results:</p>
			<pre>class Book(models.Model):
    …
    def __str__(self):
        return "{} ({})".format(self.title, self.isbn)</pre>
			<p>This is a useful change in and of itself as it makes the representation of the object more intuitive in the app: </p>
			<div><div><img src="img/B15509_04_47.jpg" alt="Figure 4.47: A portion of the Books change list with the custom string representation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.47: A portion of the Books change list with the custom string representation</p>
			<p>We are not limited to using the <code>__str__</code> representation of the object in the <code>list_display</code> field. The columns that appear in the list display are determined by the <code>ModelAdmin</code> class of the Django admin app. At the Django shell, we can import the <code>ModelAdmin</code> class and examine its <code>list_display</code> attribute:</p>
			<pre>python manage.py shell
&gt;&gt;&gt; from django.contrib.admin import ModelAdmin
&gt;&gt;&gt; ModelAdmin.list_display
('__str__',)</pre>
			<p>This explains why the default behavior of <code>list_display</code> is to display a single-columned table of the objects' <code>__str__</code> representations, so that we can customize the list display by overriding this value. The best practice is to subclass <code>ModelAdmin</code> for each object. If we wanted the <code>Book</code> list display to contain two separate columns for <code>Title</code> and <code>ISBN</code>, rather than having a single column containing both values as in <em class="italic">Figure 4.47</em>, we would subclass <code>ModelAdmin</code> as <code>BookAdmin</code> and specify the custom <code>list_display</code>. The benefit of doing this is that we are now able to sort books by <code>Title</code> and by <code>ISBN</code>. We can add this class to <code>reviews/admin.py</code>:</p>
			<pre>class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'isbn')</pre>
			<p>Now that we've created a <code>BookAdmin</code> class, we should reference it when we register our <code>reviews.models.Book</code> class with the admin site. In the same file, we also need to modify the model registration to use <code>BookAdmin</code> instead of the default value of <code>admin.ModelAdmin</code>, so the <code>admin.site.register</code> call now becomes the following:</p>
			<pre>admin.site.register(Book, BookAdmin)</pre>
			<p>Once these two changes have been made to the <code>reviews/admin.py</code> file, we will get a <code>Books</code> change list page that looks like this:</p>
			<div><div><img src="img/B15509_04_48.jpg" alt="Figure 4.48: A portion of the Books change list with a two-column list display&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.48: A portion of the Books change list with a two-column list display</p>
			<p>This gives us a hint as to how flexible <code>list_display</code> is. It can take four types of values:</p>
			<ul>
				<li>It takes field names from the model, such as <code>title</code> or <code>isbn</code>.</li>
				<li>It takes a function that takes the model instance as an argument, such as this function that gives an initialized version of a person's name:<pre>def initialled_name(obj):
    """ obj.first_names='Jerome David', obj.last_names='Salinger'
        =&gt; 'Salinger, JD' """
    initials = ''.join([name[0] for name in \
                        obj.first_names.split(' ')])
    return "{}, {}".format(obj.last_names, initials)
class ContributorAdmin(admin.ModelAdmin):
    list_display = (initialled_name,)</pre></li>
				<li>It takes a method from the <code>ModelAdmin</code> subclass that takes the model object as a single argument. Note that this needs to be specified as a string argument as it would be out of scope and undefined within the class:<pre>class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'isbn13')
    def isbn13(self, obj):
        """ '9780316769174' =&gt; '978-0-31-676917-4' """
        return "{}-{}-{}-{}-{}".format\
                                (obj.isbn[0:3], obj.isbn[3:4],\
                                 obj.isbn[4:6], obj.isbn[6:12],\
                                 obj.isbn[12:13])</pre></li>
				<li>It takes a method (or a non-field attribute) of the model class, such as <code>__str__</code>, as long as it accepts the model object as an argument. For example, we could convert <code>isbn13</code> to a method on the <code>Book</code> model class:<pre>class Book(models.Model):
    def isbn13(self):
        """ '9780316769174' =&gt; '978-0-31-676917-4' """
        return "{}-{}-{}-{}-{}".format\
                                (self.isbn[0:3], self.isbn[3:4],\
                                 self.isbn[4:6], self.isbn[6:12],\
                                 self.isbn[12:13])</pre><p>Now when viewing the <code>Books</code> change list at <code>http://127.0.0.1:8000/admin/reviews/book</code>, we can see the hyphenated <code>ISBN13</code> field:</p></li>
			</ul>
			<div><div><img src="img/B15509_04_49.jpg" alt="Figure 4.49: A portion of the Books change list with the hyphenated ISBN13&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.49: A portion of the Books change list with the hyphenated ISBN13</p>
			<p>It is worth noting that computed fields such as <code>__str__</code> or our <code>isbn13</code> methods do not make for sortable fields on the summary page. Also, we cannot include fields of type <code>ManyToManyField</code> in <code>display_list</code>.</p>
			<h3 id="_idParaDest-163"><a id="_idTextAnchor166"/>The Filter</h3>
			<p>Once the admin interface needs to deal with a significant number of records, it is convenient to narrow down the results that appear on change list pages. The simplest filters select individual values. For example, the user filter depicted in <em class="italic">Figure 4.6</em> allows the selection of users by <code>staff status</code>, by <code>superuser status</code>, and <code>active</code>. We've seen on the user filter that <code>BooleanField</code> can be used as a filter. We can also implement filters on <code>CharField</code>, <code>DateField</code>, <code>DateTimeField</code>, <code>IntegerField</code>, <code>ForeignKey</code>, and <code>ManyToManyField</code>. In this case, adding <code>publisher</code> as a <code>ForeignKey</code> of <code>Book</code>, it is defined on the <code>Book</code> class as follows:</p>
			<pre>publisher = models.ForeignKey(Publisher, \
                              on_delete=models.CASCADE)</pre>
			<p>Filters are implemented using the <code>list_filter</code> attribute of a <code>ModelAdmin</code> subclass. In our Bookr app, filtering by book title or ISBN would be impractical as it would produce a large list of filter options that return only one record. The filter that would occupy the right-hand side of the page would take up more space than the actual change list. A practical option would be to filter books by publisher. We defined a custom <code>__str__</code> method for the <code>Publisher</code> model that returns the publisher's <code>name</code> attribute, so our filter options will be listed as publisher names.</p>
			<p>We can specify our change list filter in <code>reviews/admin.py</code> in the <code>BookAdmin</code> class:</p>
			<pre>    list_filter = ('publisher',)</pre>
			<p>Here is how the <code>Books</code> change page should look now:</p>
			<div><div><img src="img/B15509_04_50.jpg" alt="Figure 4.50: The Books change page with the publisher filter&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.50: The Books change page with the publisher filter</p>
			<p>With that line of code, we have implemented a useful publisher filter on the <code>Books</code> change list page.</p>
			<h2 id="_idParaDest-164"><a id="_idTextAnchor167"/>Exercise 4.04: Adding a Date list_filter and date_hierarchy</h2>
			<p>We have seen that the <code>admin.ModelAdmin</code> class provides useful attributes to customize filters on change list pages. For example, filtering by date is crucial functionality for many applications and can also help us make our app more user-friendly. In this exercise, we will examine how date filtering can be implemented by including a date field in the filter and look at the <code>date_hierarchy</code> filter:</p>
			<ol>
				<li value="1">Edit the <code>reviews/admin.py</code> file and modify the <code>list_filter</code> attribute in the <code>BookAdmin</code> class to include <code>'publication_date'</code>:<pre>class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'isbn')
    list_filter = ('publisher', <strong class="bold">'publication_date'</strong>)</pre></li>
				<li>Reload the <code>Books</code> change page and confirm that the filter now includes date settings:<div><img src="img/B15509_04_51.jpg" alt="Figure 4.51: Confirming that the Books change page includes date settings&#13;&#10;"/></div><p class="figure-caption">Figure 4.51: Confirming that the Books change page includes date settings</p><p>This publication date filter would be convenient if the Bookr project was receiving a lot of new releases, and we wanted to filter books by what was published in the last 7 days or a month. Sometimes though, we might like to filter by a specific year or a specific month in a specific year. Fortunately, the <code>admin.ModelAdmin</code> class comes with a custom filter attribute that is geared towards navigating hierarchies of temporal information. It is called <code>date_hierarchy</code>.</p></li>
				<li>Add a <code>date_hierarchy</code> attribute to <code>BookAdmin</code> and set its value to <code>publication_date</code>:<pre>class BookAdmin(admin.ModelAdmin):
    <strong class="bold">date_hierarchy = 'publication_date'</strong>
    list_display = ('title', 'isbn')
    list_filter = ('publisher', 'publication_date')</pre></li>
				<li>Reload the <code>Books</code> change page and confirm that the date hierarchy appears above the <code>Action</code> dropdown:<div><img src="img/B15509_04_52.jpg" alt="Figure 4.52: Confirming that the date hierarchy appears above the Action dropdown&#13;&#10;"/></div><p class="figure-caption">Figure 4.52: Confirming that the date hierarchy appears above the Action dropdown</p></li>
				<li>Select a year from the date hierarchy and confirm that it contains a list of months in that year containing book titles and a total list of books:<div><img src="img/B15509_04_53.jpg" alt="Figure 4.53: Confirming that the selection of a year from the date hierarchy shows the books published that year&#13;&#10;"/></div><p class="figure-caption">Figure 4.53: Confirming that the selection of a year from the date hierarchy shows the books published that year</p></li>
				<li>Confirm that selecting one of these months further filters down to days in the month:<div><img src="img/B15509_04_54.jpg" alt="Figure 4.54: Filtering months down to days in the month&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 4.54: Filtering months down to days in the month</p>
			<p>The <code>date_hierarchy</code> filter is a convenient way of customizing a change list that contains a large set of time-sortable data in order to facilitate faster record selection, as we saw in this exercise. Let's now look at the implementation of a search bar in our app.</p>
			<h2 id="_idParaDest-165"><a id="_idTextAnchor168"/>The Search Bar</h2>
			<p>This brings us to the remaining piece of functionality that we wanted to implement – the search bar. Like filters, a basic search bar is quite simple to implement. We only need to add the <code>search_fields</code> attribute to the <code>ModelAdmin</code> class. The obvious character fields in our <code>Book</code> class to search on are <code>title</code> and <code>isbn</code>. At present, the <code>Books</code> change list appears with a date hierarchy across the top of the change list. The search bar will appear above this:</p>
			<div><div><img src="img/B15509_04_55.jpg" alt="Figure 4.55: Books change list before the search bar is added&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.55: Books change list before the search bar is added</p>
			<p>We can start by adding this attribute to <code>BookAdmin</code> in <code>reviews/admin.py</code> and examine the result:</p>
			<pre>    search_fields = ('title', 'isbn')</pre>
			<p>The result would look like this:</p>
			<div><div><img src="img/B15509_04_56.jpg" alt="Figure 4.56: Books change list with the search bar&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.56: Books change list with the search bar</p>
			<p>Now we can perform a simple text search on fields that match the title field or ISBN. This search requires precise string matches, so "color" won't match "colour." It also lacks the deep semantic processing that we expect from more sophisticated search facilities such as <code>Books</code> model is quite restrictive. We might want to search by publisher name too. Fortunately, <code>search_fields</code> is flexible enough to accomplish this. To search on <code>ForeignKeyField</code> or <code>ManyToManyField</code>, we just need to specify the field name on the current model and the field on the related model separated by two underscores. In this case, <code>Book</code> has a foreign key, <code>publisher</code>, and we want to search on the <code>Publisher.name</code> field so it can be specified as <code>'publisher__name'</code> on <code>BookAdmin.search_fields</code>:</p>
			<pre>    search_fields = ('title', 'isbn', 'publisher__name')</pre>
			<p>If we wanted to restrict a search field to an exact match rather than return results that contain the search string, then the field can be suffixed with <code>'__exact'</code>. So, replacing <code>'isbn'</code> with <code>'isbn__exact'</code> will require the complete ISBN to be matched, and we won't be able to get a match using a portion of the ISBN.</p>
			<p>Similarly, we constrain the search field to only return results that start with the search string by using the <code>'__startswith'</code> suffix. Qualifying the publisher name search field as <code>'publisher__name__startswith'</code> means that we will get results searching for "pack" but not for "ackt."</p>
			<h2 id="_idParaDest-166"><a id="_idTextAnchor169"/>Excluding and Grouping Fields</h2>
			<p>There are occasions when it is appropriate to restrict the visibility of some of the fields in the model in the admin interface. This can be achieved with the <code>exclude</code> attribute. </p>
			<p>This is the review form screen with the <code>Date edited</code> field visible. Note that the <code>Date created</code> field does not appear – it is already a hidden view because <code>date_created</code> is defined on the model with the <code>auto_now_add</code> parameter:</p>
			<div><div><img src="img/B15509_04_57.jpg" alt="Figure 4.57: The review form&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.57: The review form</p>
			<p>If we wanted to exclude the <code>Date edited</code> field from the review form, we would do this in the <code>ReviewAdmin</code> class:</p>
			<pre>exclude = ('date_edited')</pre>
			<p>Then the review form would appear without <code>Date edited</code>: </p>
			<div><div><img src="img/B15509_04_58.jpg" alt="Figure 4.58: The review form with the Date edited field excluded&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.58: The review form with the Date edited field excluded</p>
			<p>Conversely, it might be more prudent to restrict the admin fields to those that have been explicitly permitted. This is achieved with the <code>fields</code> attribute. The advantage of this approach is that if new fields are added in the model, they won't be available in the admin form unless they have been added to the <code>fields</code> tuple in the <code>ModelAdmin</code> subclass:</p>
			<pre>fields = ('content', 'rating', 'creator', 'book')</pre>
			<p>This will give us the same result that we saw earlier.</p>
			<p>Another option is to use the <code>fieldsets</code> attribute of the <code>ModelAdmin</code> subclass to specify the form layout as a series of grouped fields. Each grouping in <code>fieldsets</code> consists of a title followed by a dictionary containing a <code>'fields'</code> key pointing to a list of field name strings:</p>
			<pre>    fieldsets = (('Linkage', {'fields': ('creator', 'book')}),\
                 ('Review content', \
                   {'fields': ('content', 'rating')}))</pre>
			<p>The review form should look as follows:</p>
			<div><div><img src="img/B15509_04_59.jpg" alt="Figure 4.59: The review form with fieldsets&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.59: The review form with fieldsets</p>
			<p>If we want to omit the title on a fieldset, we can do so by assigning the value <code>None</code> to it:</p>
			<pre>    fieldsets = ((<strong class="bold">None</strong>, {'fields': ('creator', 'book')}),\
                 ('Review content', \
                   {'fields': ('content', 'rating')}))</pre>
			<p>Now, the review form should appear as shown in the following screenshot:</p>
			<div><div><img src="img/B15509_04_60.jpg" alt="Figure 4.60: The review form with the first fieldset untitled&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.60: The review form with the first fieldset untitled</p>
			<h2 id="_idParaDest-167">Activity 4.02: Customizin<a id="_idTextAnchor170"/>g the Model Admins</h2>
			<p>In our data model, the <code>Contributor</code> class is used to store data for book contributors -- they can be authors, contributors, or editors. This activity focuses on modifying the <code>Contributor</code> class and adding a <code>ContributorAdmin</code> class to improve the user-friendliness of the admin app. At present, the <code>Contributor</code> change list defaults to a single column, <code>FirstNames</code>, based on the <code>__str__</code> method created in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>. We will investigate some alternative ways of representing this. These steps will help you complete the activity:</p>
			<ol>
				<li value="1">Edit <code>reviews/models.py</code> to add additional functionality to the <code>Contributor</code> model.</li>
				<li>Add an <code>initialled_name</code> method to <code>Contributor</code> that takes no arguments (like the <code>Book.isbn13</code> method).</li>
				<li>The <code>initialled_name</code> method will return a string containing <code>Contributor.last_names</code> followed by a comma and the initials of the given names. For example, for a <code>Contributor</code> object with <code>first_names</code> of <code>Jerome David</code> and <code>last_names</code> of <code>Salinger</code>, <code>initialled_name</code> will return <code>Salinger, JD</code>.</li>
				<li>Replace the <code>__str__</code> method for <code>Contributor</code> with one that calls <code>initialled_name()</code>.<p>At this point, the <code>Contributors</code> display list will look like this:</p><div><img src="img/B15509_04_61.jpg" alt="Figure 4.61: Contributors display list&#13;&#10;"/></div><p class="figure-caption">Figure 4.61: Contributors display list</p></li>
				<li>Add a <code>ContributorAdmin</code> class in <code>reviews/admin.py</code>. It should inherit from <code>admin.ModelAdmin</code>. </li>
				<li>Modify it so that on the <code>Contributors</code> change list, records are displayed with two sortable columns – <code>Last Names</code> and <code>First Names</code>.</li>
				<li>Add a search bar that searches on <code>Last Names</code> and <code>First Names</code>. Modify it so that it only matches the start of <code>Last Names</code>.</li>
				<li>Add a filter on <code>Last Names</code>.</li>
			</ol>
			<p>By completing the activity, you should be able to see something like this:</p>
			<div><div><img src="img/B15509_04_62.jpg" alt="Figure 4.62: Expected output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.62: Expected output</p>
			<p>Changes such as these can be made to improve the functionality of the admin user interface. By implementing <code>First Names</code> and <code>Last Names</code> columns as separate columns in the <code>Contributors</code> change list, we are giving the user an option to sort on either of the fields. By considering what columns are most useful in search retrieval and filter selections, we can improve the efficient retrieval of records.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h1 id="_idParaDest-168"><a id="_idTextAnchor171"/>Summary</h1>
			<p>In this chapter, we saw how to create superusers through the Django command line and how to use them to access the admin app. After a brief tour of the admin app's basic functionality, we examined how to register our models with it to produce a CRUD interface for our data.</p>
			<p>Then we learned how to refine this interface by modifying site-wide features. We altered how the admin app presents model data to the user by registering custom model admin classes with the admin site. This allowed us to make fine-grained changes to the representation of our models' interfaces. These modifications included customizing change list pages by adding additional columns, filters, date hierarchies, and search bars. We also modified the layout of the model admin pages by grouping and excluding fields.</p>
			<p>This was only a very shallow dive into the functionality of the admin app. We will revisit the rich functionality of <code>AdminSite</code> and <code>ModelAdmin</code> in <em class="italic">Chapter 10</em>, <em class="italic">Advanced Django Admin and Customization</em>. But first, we need to learn some more intermediate features of Django. In the next chapter, we will learn how to organize and serve static content, such as CSS, JavaScript, and images, from a Django app.</p>
		</div>
	</body></html>