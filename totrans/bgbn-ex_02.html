<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Circuit Fundamentals and GPIO</h1></div></div></div><p>In this chapter, we will be learning the basics of setting up an external electronic circuit that you can interface with the BeagleBone board using the <strong>general-purpose input/output</strong> (<strong>GPIO</strong>) pins <a id="id115" class="indexterm"/>available on it. The chapter will focus on making the reader understand how to wire electronic circuits with an explanation of how they work followed by using the GPIOs available on the BeagleBone board for their operation.</p><p>For readers who are from an electronics background, most of what is covered in the first three topics will be familiar but still I suggest you skim through the topics to brush up the basics. Since the book is written in such a way that readers without prior knowledge of electronics also get to understand and work on the projects, these topics have to be included in the chapter.</p><p>The contents of the chapter are divided into the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Prerequisites</li><li class="listitem" style="list-style-type: disc">Fundamentals of electrical and electronic circuits</li><li class="listitem" style="list-style-type: disc">Use of BreadBoards</li><li class="listitem" style="list-style-type: disc">Switches and LEDs</li><li class="listitem" style="list-style-type: disc">GPIOs</li><li class="listitem" style="list-style-type: disc">Adding libraries to Python</li><li class="listitem" style="list-style-type: disc">Using python to access GPIOs</li><li class="listitem" style="list-style-type: disc">Simple project: Blinking an LED using a Python script</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Prerequisites</h1></div></div></div><p>This topic will cover what parts you need to get started with BeagleBone Black online. You can buy these parts<a id="id116" class="indexterm"/> from your favorite online store or from any of your local stores. individual electronic components such as resistors, transistors, LEDs, and so on are connected with a power source element such as a battery or other power supply source using conductive wires through which current flows through these electronic components, it forms an electronic circuit:</p><div><img src="img/4602_02_01.jpg" alt="Prerequisites"/></div><p>We will see how to make our first simple electric circuit using an LED followed by connecting a switch to it in the <em>Switches and LEDs</em> section of this chapter.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Usage of breadboards</h1></div></div></div><p>In this section, you will learn about what breadboards are, why they are called so, and how to use them. Once you are done with it, you should have a basic understanding of how breadboards work and be able to start using it to build basic circuits on a breadboard. </p><p>A breadboard is composed <a id="id117" class="indexterm"/>of electrical connections in rows and columns. Each column is electrically connected to each point on the row, you can see the black column line, that has connectivity. You can use wires to connect any column with another. There are larger rows on the top and bottom which are usually used for power supply positive and negative, in other words, VCC (power) and GND (ground) signals. You can use these to easily connect any column to VCC or GND or use it for any other purpose as per your wish as there is no restriction, it's just like any other row:</p><div><img src="img/4602_02_02.jpg" alt="Usage of breadboards"/></div><p>You can learn how<a id="id118" class="indexterm"/> to use a Breadboard by connecting the circuit given in the previous section to test it by setting up the same circuit on breadboard as shown in the following figure:</p><div><img src="img/4602_02_03.jpg" alt="Usage of breadboards"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Switches and LEDs</h1></div></div></div><p>Switches are one of the the<a id="id119" class="indexterm"/> elementary components in electronic circuits:</p><div><img src="img/4602_02_23.jpg" alt="Switches and LEDs"/></div><p>All they do is make or break a <a id="id120" class="indexterm"/>circuit, meaning it either opens a connection or closes it between two terminals. The two states of a switch are as shown in the following figure:</p><div><img src="img/4602_02_24.jpg" alt="Switches and LEDs"/></div><p>There are a lot of different types of switches. But there are two most commonly used ones in our circuits that we will discuss in this section, which are the momentary switch and the toggle switch. Before we discuss the different types of switches, as mentioned during the introduction of this chapter, let's see what LEDs are and how to create a basic circuit using them, as during the explanation of the switch operations, it will be useful for better understanding. </p><p>To create your first<a id="id121" class="indexterm"/> simple circuit, take a battery, resistor, and LED with wires to connect them as shown in the following figure. By doing this, you can understand what an LED is. LED stands for light emitting diode, which is nothing but an electronic component that emits light when suitable voltage is applied to its leads in the proper configuration. An LED has two leads: the cathode and the anode, as shown in the following figure:</p><div><img src="img/4602_02_25.jpg" alt="Switches and LEDs"/></div><p>The anode<a id="id122" class="indexterm"/> terminal should be connected to the positive terminal of the power supply / battery and the cathode terminal should be connected to the negative terminal of the power supply / battery to make the LED glow. Connecting in reverse won't make the LED glow. If you would like to know more about why and how an LED works, do your research online or read books to find out more. </p><p>Now, let's go ahead and make an electronic circuit where current flows through the wires through a resistor and LED which are connected to a power source, in other words, a battery, as shown in the following diagram:</p><div><img src="img/4602_02_26.jpg" alt="Switches and LEDs"/></div><p>So, as shown in the preceding diagram, the resistor can be on any side of the LED. The resistor is a component that reduces the value of current flowing through the circuit. It is used to increase the lifetime of the LED and is necessary for most LEDs. I would suggest you learn more about how<a id="id123" class="indexterm"/> much value of resistor should be used and for particular battery and LEDs that you use because this chapter and most of the sections in it are intended to give you a basic getting started idea regarding electronic circuits. As mentioned at the beginning of the chapter, electrical and electronics is a vast topic and we can't put all the concepts involved in it in just one chapter.</p><p>If you successfully make the LED glow with a battery and LED with a resistor in between, you will have made your first basic electronic circuit. But have an LED glow all time is something that now one would want right. We will always need an element to control another element. So here comes the switch, where if you connect a switch in between this circuit, you can turn the LED on and off when you want it to glow or not glow. So let's go ahead and look at the two most-used types of switches in electronic circuits, which we will be using in the coming chapters to interface with the BeagleBone board to give inputs from the outside world.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec06"/>Momentary switch</h2></div></div></div><p>If you look at the following<a id="id124" class="indexterm"/> figure, you can see that the momentary switch has a push button actuator, a plunger in between the movable contact that touches the stationary contacts of two terminals.</p><div><img src="img/4602_02_27.jpg" alt="Momentary switch"/></div><p>The switch shown in the preceding figure is normally open as the stationary contacts are not in contact with the movable contact during normal state as the plunger pulls the movable contact upwards. Whenever you press the button on top, the movable contact goes down and touches the two stationary terminals to make contact and close the line. When you remove the pressure you applied to press the push button switch, the plunger pulls back the movable contact and the circuit opens up. The explanation is illustrated in the following figure with an LED connected to a battery. Have a look at them to understand better and try it yourself using a push button momentary switch, a battery, a resistor, and an LED:</p><div><img src="img/4602_02_28.jpg" alt="Momentary switch"/><div><p>Pushbutton Open Circuit - No Current Flow so LED is OFF</p></div></div><div><img src="img/4602_02_29.jpg" alt="Momentary switch"/><div><p>Pushbutton Closed Circuit - Current Flows so LED is ON</p></div></div><p>Please note that there are other types of push button momentary switches also available on the market which are<a id="id125" class="indexterm"/> normally closed, where the switch opens the circuit when the button is pressed and closes in normal state. Depending on which switch you use, the operation will differ for the circuit shown in the preceding figure. For normally closed, the LED will be always on and when you press the button, it will go off. For normally open, the operation will be as shown in the preceding figure, where the LED is off in normal state but goes on when you press the push button switch.</p><p>The next type of switch we will discuss will be the Toggle switch.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec07"/>Toggle switch</h2></div></div></div><p>A toggle switch is similar to the traditional switches used in wall-mounted electrical switch boards that help<a id="id126" class="indexterm"/> you open and close the connection to switch the circuit on and off. Here is how it looks with the circuit symbol:</p><div><img src="img/4602_02_30.jpg" alt="Toggle switch"/></div><p>Now that you are familiar with how a switch operation works, you can easily understand the concept of the toggle switch. Basically, it switches the state from on to off as we switch the position of the switch. Unlike the momentary switch, where we need to hold the switch button to switch the state, here, once you toggle the position, it stays in the position you left it. So we can toggle the switch from the Off to the On state, in other words, from the open to the closed state, as well as vice versa, and leave it as such and it will stay in the same position, in other words, in the state of either On or Off, as there is no spring mechanism to push the switch back to its previous position. The following diagrams will help you understand better:</p><div><img src="img/4602_02_31.jpg" alt="Toggle switch"/><div><p>Toggle Switch Open Circuit - No Current Flow so LED is OFF</p></div></div><div><img src="img/4602_02_32.jpg" alt="Toggle switch"/><div><p>Toggle Switch Closed Circuit - Current Flows so LED is ON</p></div></div><p>So, as shown in the preceding figure, if you have successfully set up the circuit and made the LED glow by switching the switch, by now you must have understood the concept of an electrical circuit and <a id="id127" class="indexterm"/>switching an electrical and electronic circuit using a switch. But using our BeagleBone board instead of doing it manually, we will be using the GPIOs to switch elements as well as read the switching inputs. We will see this in detail with experiments in the next chapters. For now, in the next section, you will learn what GPIOs basically are and what kind of GPIOs are available on the BeagleBone board.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec22"/>GPIOs</h1></div></div></div><p>As we discussed in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with BeagleBone">Chapter 1</a>, <em>Getting Started with BeagleBone</em>, BeagleBone boards have GPIO pin headers on either side of the board. In this section, we will be discussing what these GPIOs are and how we can use them to interface external electronic components to the board.</p><p>The following figure <a id="id128" class="indexterm"/>shows the GPIOs available and the pin mapping of each of them. This pin mapping or, in general, the names assigned to these pins will be helpful for us while accessing them from the software running on the operating system. You will see this in detail at the end of the chapter, when we will be accessing the GPIO from python:</p><div><img src="img/4602_02_04.jpg" alt="GPIOs"/></div><p>So, these GPIOs are ports <a id="id129" class="indexterm"/>which can act either as input or output from our definition from software running on the operating system. There are several methods to define these pins as input and output, as well as to change the state of these pins when defined as outputs and read the state when defined as inputs. In this book, as we will be using python as the primary programming language, we will be accessing these pins from the python program. To get started, you will first need to add a few libraries to python that will help you do it. How to install those libraries and validate them is explained in the next topic.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Adding libraries to Python</h1></div></div></div><p>To make it easy to <a id="id130" class="indexterm"/>work with GPIOs on BeagleBone boards using Python programming<a id="id131" class="indexterm"/> language, we will be installing the <code class="literal">Adafruit-BeagleBone-IO-Python</code> library. The following steps will walk you through how to do it:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to your BeagleBone board.<p>As we did in the previous chapter, the first thing you need to do is boot the BeagleBone board from the microSD card and log in to it via SSH:</p><p> </p><div><img src="img/4602_02_05.jpg" alt="Adding libraries to Python"/></div><p>
</p></li><li class="listitem">Update the repositories.<p>Your next step <a id="id132" class="indexterm"/>will be to update the software dependency<a id="id133" class="indexterm"/> repositories in Debian running on the BeagleBone board before we start installing the other dependencies that are not installed and the libraries.</p><p>You can use the <code class="literal">apt-get update</code> command to do this:</p><div><img src="img/4602_02_06.jpg" alt="Adding libraries to Python"/></div></li><li class="listitem">Install the dependencies.<p>In this step, we <a id="id134" class="indexterm"/>will be installing certain software packages that are necessary for<a id="id135" class="indexterm"/> the library to work with the BeagleBone board. The command that you need to execute is as follows:</p><div><pre class="programlisting">
<strong>sudo apt-get install build-essential python-dev python-setuptools python-pip python-smbus –y</strong>
</pre></div><p>The output that you will see is shown in the following screenshot:</p><div><img src="img/4602_02_07.jpg" alt="Adding libraries to Python"/></div></li><li class="listitem">Install the BBIO library.<p>Now, once you have updated the repositories and installed the necessary dependencies, we can go ahead and install the <code class="literal">Adafruit_BBIO</code> <a id="id136" class="indexterm"/>Python Library that we will be using to access the GPIO pins on the<a id="id137" class="indexterm"/> BeagleBone board using Python running on it.</p><p>To install the <code class="literal">Adafruit_BBIO</code> library, execute the following command:</p><div><pre class="programlisting">
<strong>sudo pip install Adafruit_BBIO</strong>
</pre></div><p>You will see the following output:</p><div><img src="img/4602_02_08.jpg" alt="Adding libraries to Python"/></div></li><li class="listitem">Test your installation.<p>Now, let us check whether the installation happened properly or not. To do this, just execute the command given following:</p><div><pre class="programlisting">
<strong>sudo python -c "import Adafruit_BBIO.GPIO as GPIO; print GPIO"</strong>
</pre></div><p>Now, if you see the output shown in the following screenshot, it means the installation was successful and we have successfully installed the <code class="literal">Adafruit_BBIO</code> library:</p><div><img src="img/4602_02_09.jpg" alt="Adding libraries to Python"/></div><p>We can validate this by importing the library into python and testing it, as shown in step 6.</p></li><li class="listitem">Validate the installation.<p>In this step, first you need to open Python's interactive shell to use the instructions, as shown following:</p><div><img src="img/4602_02_10.jpg" alt="Adding libraries to Python"/></div></li></ol></div><p>If you see the module <a id="id138" class="indexterm"/>available and its path when you print GPIO, it confirms that <a id="id139" class="indexterm"/>we have successfully installed and added the <code class="literal">Adafruit_BBIO</code> Library to Python. Now let's go ahead and access the GPIO from python to change its state from Python's interactive shell in the next section.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Using Python to access GPIOs</h1></div></div></div><p>In this section, we will see<a id="id140" class="indexterm"/> how we can change the state of a GPIO on the BeagleBone board from python's interactive shell interface with the help of functions available in the <code class="literal">Adafruit_BBIO</code> Library.</p><p>You will have to connect an<a id="id141" class="indexterm"/> LED with one of the GPIO pins on the BeagleBone Black to understand how these GPIOs work. The following steps will walk you through the program that you can execute step by step on the Python's interactive shell interface to understand how you can change the state of a GPIO from LOW to HIGH and vice versa from python:</p><div><ol class="orderedlist arabic"><li class="listitem">Connect an LED circuit to the BeagleBone board.<p>To get started, we will need our Breadboard, LED, resistor, and hookup wires to connect the LED circuit with a GPIO available on the BeagleBone Black. Once you have them, connect the circuit as shown in the following figure:</p><div><img src="img/4602_02_11.jpg" alt="Using Python to access GPIOs"/></div><p>You can see that the cathode of the LED is connected to the Gnd pin on the <a id="id142" class="indexterm"/>BeagleBone Black through a 470-ohm resistor and the anode is connected to the GPIO pin 60 on the P9 header. You can refer to the expansion headers of BeagleBone Black for reference. Once you have connected the circuit with the BeagleBone Black, we can go ahead and start working<a id="id143" class="indexterm"/> with Python to make this LED turn on and off.</p></li><li class="listitem">Open Python's interactive shell and import Adafruit's BBIO Library:<div><img src="img/4602_02_12.jpg" alt="Using Python to access GPIOs"/></div><p>As shown in the preceding screenshot, in this step, you will open Python's Interactive Shell and import the <code class="literal">Adafruit_BBIO</code> Module into it using the command shown in the preceding screenshot.</p></li><li class="listitem">Set up pin GPIO_60 as OUTPUT.<p>Our next step<a id="id144" class="indexterm"/> will be to set up or define GPIO_60 as an output pin as we will be<a id="id145" class="indexterm"/> changing the state of the pin. You can note that these GPIO pins can be made to act as inputs or outputs. We will be seeing how they will be used as inputs in the next chapter. Right now we will be making this act as an output pin to change the state of the pin to high and low or vice versa, so we will define it as an output pin. To do this, the command is as follows:</p><div><pre class="programlisting">
<strong>GPIO.setup("P9_12", GPIO.OUT)</strong>
</pre></div><div><img src="img/4602_02_13.jpg" alt="Using Python to access GPIOs"/></div><p>P9_12 is nothing but pin <strong>GPIO_60</strong>, which is the 12th pin on the P9 header. See the following figure to understand the idea behind the notation:</p><div><img src="img/4602_02_14.jpg" alt="Using Python to access GPIOs"/></div></li><li class="listitem">Set Pin GPIO_60 as HIGH.<p>Once we have defined the pin as an output pin, we can go ahead and change the <a id="id146" class="indexterm"/>state of the pin to HIGH or LOW. The function given following, when<a id="id147" class="indexterm"/> executed, will perform that operation:</p><div><pre class="programlisting">
<strong>GPIO.output("P9_12", GPIO.HIGH)</strong>
</pre></div><div><img src="img/4602_02_15.jpg" alt="Using Python to access GPIOs"/></div><p>Now you will be able to see that the LED has turned on, as shown in the following image:</p><div><img src="img/4602_02_16.jpg" alt="Using Python to access GPIOs"/></div><p>What exactly happens when you execute the function is one of the transistors inside the processor chip is turned on from the software and this makes GPIO_60 to HIGH state and it switches on and supplies 3.3V output, which makes the LED glow. You can now turn off the led by setting the GPIO_60 pin to the LOW state, as shown in the next step, by<a id="id148" class="indexterm"/> modifying the <code class="literal">GPIO.output</code> function to LOW.</p></li><li class="listitem">Set Pin GPIO_60 as LOW:<div><pre class="programlisting">
<strong>GPIO.output("P9_12", GPIO.LOW)</strong>
</pre></div><div><img src="img/4602_02_17.jpg" alt="Using Python to access GPIOs"/></div><p>Now you will<a id="id149" class="indexterm"/> be able to see that the LED has turned off, as shown in the following image:</p><div><img src="img/4602_02_18.jpg" alt="Using Python to access GPIOs"/></div><p>As in the previous step, now the software turns off the transistor inside the microprocessor on the BeagleBone board to turn off the GPIO_60 so it turns off and becomes LOW, and doesn't give out the 3.3V supply so the LED is turned off. </p></li><li class="listitem">Clean up the GPIO settings.<p>So, now you will have got an idea that the GPIO states can be changed from<a id="id150" class="indexterm"/> the software running on the board. These GPIO pins stay in the<a id="id151" class="indexterm"/> previous state until they are changed to another state. But in situations where you stop the software in the middle of an operation, you might need the GPIO pins to go back to their default state, which is LOW for most of them. To do this, the <code class="literal">Adafruit_BBIO</code> library provides us with a function <code class="literal">GPIO.cleanup()</code>, which we will be using to clear the previous states and definitions of the GPIOs set from the software.</p><p>It is recommended that you use this function at the end of every program that you write, to avoid unnecessary, undesired output:</p><div><img src="img/4602_02_19.jpg" alt="Using Python to access GPIOs"/></div></li></ol></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Project – blinking an LED using Python script</h1></div></div></div><p>In the previous section, we saw how we can access the GPIO pin from Python's interactive shell and<a id="id152" class="indexterm"/> change its state. Let's now write a python code and save it as a <code class="literal">.py</code> file and run it like we did at the end of the previous chapter. The python<a id="id153" class="indexterm"/> program that is discussed in this section will make an LED blink at an interval of 1 second. The LED will be On for 1 second and Off for another 1 second; this will loop continuously until you break the loop.</p><p>The following screenshot shows the program:</p><div><img src="img/4602_02_20.jpg" alt="Project – blinking an LED using Python script"/></div><p>The code imports the time module and the <code class="literal">Adafruit_BBIO</code> module just as we did in the interactive shell in the previous<a id="id154" class="indexterm"/> section of this chapter and then we set up GPIO_60 as an output pin and then <a id="id155" class="indexterm"/>changed the state of the pin to HIGH and LOW in the while loop that runs continuously. We use the <code class="literal">time.sleep(1)</code> function to pause the code for 1 second in between the state changes. The code also has the <code class="literal">GPIO.clean()</code> function that gets executed when a keyboard interrupt is given when the code is running.</p><p>To run the command, execute the following command after you save the code as a file called <code class="literal">Blink.py</code>:</p><div><pre class="programlisting">
<strong>sudo python Blink.py</strong>
</pre></div><p>You should see output as shown in the following screenshot and the LED connected to the BeagleBone board blinks at an interval of 1 second and the console also prints the text <strong>Blinking</strong>:</p><div><img src="img/4602_02_21.jpg" alt="Project – blinking an LED using Python script"/></div><p>When you hit <em>Ctrl</em> + <em>C</em> to kill the program, it will clean up the GPIO to the default state and exit the program:</p><div><img src="img/4602_02_22.jpg" alt="Project – blinking an LED using Python script"/></div><p>So, now you can go <a id="id156" class="indexterm"/>ahead and try to use different GPIOs and turn on and turn<a id="id157" class="indexterm"/> off the LED using decision-making statements and more from the Python program. If you remember, in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with BeagleBone">Chapter 1</a>, <em>Getting Started with BeagleBone</em>, we used the BoneScript library to make the LEDs which are on the board turn on and stay on for a timeout interval. You can try writing some code of that sort also in python and try keeping the LED on for some interval of time. And turn it off based on the input you will be giving.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Summary</h1></div></div></div><p>Here we are at the end of this chapter, where we learnt the basic principle behind a simple electronic circuit using LEDs and switches. We saw what GPIOs are and how we can access them from python and wrote a simple code to make an LED blink at a particular interval. Then we added external libraries to python on BeagleBone boards. In the next chapter, we will be seeing how we can get an input from the external world and build a system that reacts to that input.</p></div></body></html>