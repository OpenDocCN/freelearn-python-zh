<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-261"><a id="_idTextAnchor266"/>11</h1>
<h1 id="_idParaDest-262"><a id="_idTextAnchor267"/>Understanding Database Management in PyCharm</h1>
<p>What do horseshoe crabs, coelacanths, crocodiles, and relational databases have in common? I’ll wait while you go look up <em class="italic">coelacanth</em>. All four of these have been around for millions of years and yet have evolved very little. OK, databases haven’t been around for millions of years, but they have been around for millions of internet years. Everybody knows that internet years are very short. JavaScript developers often joke that before lunchtime, anywhere in the world, dozens of new frameworks have been invented, risen to prominence, fallen out of favor, and then been abandoned all before you finish your noodles.</p>
<p>In the early 1970s, a researcher named E. F. Codd was working at IBM’s San Jose Research Laboratory in California. He developed a revolutionary concept called <strong class="bold">the relational model of data</strong>. In his <a id="_idIndexMarker894"/>seminal paper titled <em class="italic">A Relational Model of Data for Large Shared Data Banks</em>, published in 1970, Codd outlined the principles and foundations of this new approach to organizing and retrieving data.</p>
<p>Codd’s relational model proposed a way to represent data as a collection of tables, known as relations, with each table consisting of rows and columns. He introduced the concept of <strong class="bold">relational algebra</strong>, a mathematical framework for manipulating and querying data in these tables. The model emphasized the use of mathematical <strong class="bold">set theory</strong> and logic to define relationships and perform operations on the data.</p>
<p>Codd’s ideas challenged the prevailing hierarchical and network database models of the time, which were more complex and less flexible. The relational model offered a simpler and more intuitive way to manage data, providing a foundation for <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>) and other tools used in relational databases.</p>
<p>In 1974, IBM released the first <a id="_idIndexMarker895"/>commercially available <strong class="bold">relational database management system</strong> (<strong class="bold">RDBMS</strong>), called <em class="italic">System R</em>, based on Codd’s work. System R implemented many of the concepts outlined in Codd’s research and became an influential precursor to subsequent relational database systems. In 1974, IBM released System R based on Codd’s work, but the product wasn’t aggressively marketed or sold because IBM executives were worried about cannibalizing sales on other database systems sold by the company. During that time, another start-up database company was born: <strong class="bold">Oracle</strong>. The initial release of Oracle was developed by Larry Ellison, Bob Miner, and Ed Oates. Released in 1983, Oracle is generally considered to be the first commercial success even though IBM had a serious head start.</p>
<p>Relational database technology evolved throughout the 80s and 90s, and along the way, it became a staple of corporate IT in every industry in every corner of the globe. In 1986, the SQL language became standardized. The standard evolved over time, but to be honest, 49 years after the invention of SQL, most development is done with the simplest and oldest set of language statements.</p>
<p>A moment ago, I stated that Codd’s ideas challenged the prevailing hierarchical and network database models of the time, which were more complex and less flexible. It is interesting to note that in the early 2000s, there was a shift away from relational database technology toward what we call <strong class="bold">NoSQL databases</strong>. The world of IT often acts like a pendulum, forever swinging back and forth. We used to have relatively low-powered PCs capable of playing video files at 12 frames per second in a postage stamp-sized window. Technology improved to the point where we could watch a 4K high-definition video at full speed on a PC, but then we invented small hand-held devices, such as the iPod, and we were back to low-end processing and choppy, grainy video. Eventually, those improved into the iPhone, which can play video at high definition and high frame rates. Some iPhones are bigger than the TV I had in college.</p>
<p>Likewise, with databases, one day the world was using hierarchical and network-oriented databases. The next day everything swung to a new thing called <em class="italic">relational</em>. Today, we see a swing back in the other direction. More and more projects today favor non-relational databases, many of which support hierarchical data. Regardless of which technology you might favor, it is safe to say that just about any project you build, especially in the corporate IT world, will interact with some database in some big way.</p>
<p>In 2015, JetBrains created a new product aimed at becoming a popular IDE for database developers. <strong class="bold">DataGrip</strong> was created to provide a unified interface and robust toolset for working with various databases. It offers features such as intelligent code completion, advanced SQL editing capabilities, schema navigation, data analysis, and integration with version control systems. Like the web development product by JetBrains, WebStorm, the DataGrip product is integrated into the Professional edition of PyCharm through its plugin system. Consider that your 99 USD investment in PyCharm Professional gets you a Python IDE, a JavaScript IDE, an IDE for web frontend work in HTML and CSS, and now a fully fledged IDE for database work and you’ll see you’ve gotten a solid deal!</p>
<p>In this chapter, we will cover the features of PyCharm related to databases. By the end of the chapter, you will have learned the following:</p>
<ul>
<li>Some database history and some basics just to make sure we’re all on the same page in terms of terminology. If you’ve been developing software for a while, this might be a review. If you’re new, I will endeavor to provide you with the best possible introduction to database technology.</li>
<li>How to navigate to the database tools in PyCharm, which are hidden away in a tab on the right side of the interface. I have met many developers who have used PyCharm for years yet don’t know these tools are even present.</li>
<li>How to connect to different databases, including how to add the necessary connection drivers to PyCharm. JetBrains has made this very easy!</li>
<li>How to configure SQL dialects for individual projects as well as globally.</li>
<li>How to use SQL generation templates to help you write SQL queries more quickly.</li>
<li>How to generate an <strong class="bold">entity relationship </strong><strong class="bold">diagram</strong> (<strong class="bold">ERD</strong>).</li>
<li>How to use the graphical designers to build tables easily.</li>
<li>How to use consoles to create and run ad hoc queries against any database.</li>
</ul>
<p>On a personal note, besides learning to code in BASIC when I was 12, relational technology was the first skill I mastered when I got into the IT field over 30 years ago. This is a skill set that has always been in demand, and will probably continue to be in demand for many years to come. It is a subject I have extensive experience in, and I am excited to share that experience with you in this chapter. So, let’s get to it<a id="_idTextAnchor268"/>!</p>
<h1 id="_idParaDest-263"><a id="_idTextAnchor269"/>Technical requirements</h1>
<p>In order to proceed with this chapter, and indeed the rest of the book, you will need the following:</p>
<p>An installed and working Python interpreter. I’ll be using the latest from <a href="https://python.org">https://python.org</a>.</p>
<p>An installed and working copy of PyCharm. Installation was covered in <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a>, <em class="italic">Installation and Configuration</em>, in case you are jumping into the middle of the book.</p>
<p>A database server is a nice-to-have in this chapter so you can practice on a real database. There are dozens of popular relational databases to choose from, so it is not practical for me to cover all of them. I will be running <strong class="bold">MySQL</strong> using <strong class="bold">Docker Desktop</strong>. If you plan on following along, you’ll need to have Docker Desktop installed on your computer. You can find instructions for installation at <a href="https://www.docker.com/products/docker-desktop/">https://www.docker.com/products/docker-desktop/</a>.</p>
<p>This book’s sample source code is from GitHub. We covered cloning the code in <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a>, <em class="italic">Installation and Configuration</em>. You’ll find this chapter’s relevant code at <a href="https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-11">https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-11</a>.</p>
<h1 id="_idParaDest-264"><a id="_idTextAnchor270"/>Relational databases in a nutshell</h1>
<p>The idea of relational data conceived by E. F. Codd is based on a few simple principles. Firstly, data can be represented in<a id="_idIndexMarker896"/> sets called <em class="italic">tables</em>. A <code>books</code>. The <code>books</code> table will contain columns that define the data within those columns – maybe something like this:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-4">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Title</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">ISBN</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Page Count</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Author</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Price</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>The Art of War</p>
</td>
<td class="No-Table-Style">
<p>1599869772</p>
</td>
<td class="No-Table-Style">
<p>68</p>
</td>
<td class="No-Table-Style">
<p>Sun Tzu</p>
</td>
<td class="No-Table-Style">
<p>4.99</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Book of Five Rings</p>
</td>
<td class="No-Table-Style">
<p>8387743849</p>
</td>
<td class="No-Table-Style">
<p>43</p>
</td>
<td class="No-Table-Style">
<p>Miyamoto Musashi</p>
</td>
<td class="No-Table-Style">
<p>4.50</p>
</td>
</tr>
</tbody>
</table>
<p>This table has five columns designed to <a id="_idIndexMarker900"/>structure data about books. We have two books, which are stored as rows in the table.</p>
<h1 id="_idParaDest-265"><a id="_idTextAnchor271"/>Structured Query Language</h1>
<p>E. F. Codd’s paper that<a id="_idIndexMarker901"/> defined relational algebra served as the basis for SQL. SQL is unlike any other coding language you will ever use because it is one of only a handful of languages that use a declarative paradigm. Most languages you use, including Python, use an imperative paradigm. In short, the language serves as a syntactical framework to give a computer instructions on what you want it to do. You are basically a micro-manager. You specify every input, every output and every step the program will take during the processing that happens to get the input to the output. You must be meticulous, as the computer will take you literally. If you leave out even a single detail, you are setting things up to malfunction.</p>
<p><strong class="bold">Declarative programming</strong>, on the other hand, entails <a id="_idIndexMarker902"/>merely specifying the output you want from an implicit input. You have little to no control over the operations performed to derive the output from the input. Consider this SQL statement designed to get some rows from your bookstore database:</p>
<pre class="source-code">
SELECT title AS Title, isbn AS ISBN, author AS Author, price AS Price FROM books ORDER BY price DESC</pre> <p>This query will produce some output consisting of a table that has a few of the columns from your original database, which serves as the implicit input. You’ll get the following columns:</p>
<p><code>Title</code></p>
<p><code>ISBN</code></p>
<p><code>Author</code></p>
<p><code>Price</code></p>
<p>But you won’t get the page count because you didn’t ask for it in the query. The input data source is implied in the <code>FROM books</code> section of the query. At the end, we have a request to order the results by price in descending order (<code>DESC</code>), which will make our resulting tabular list of books appear from the most expensive to the cheapest.</p>
<h2 id="_idParaDest-266"><a id="_idTextAnchor272"/>The two halves of SQL</h2>
<p>SQL itself is split into two separate sets of syntax: <code>SELECT</code> statement presented earlier is an example of a read operation. SQL has keywords for <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operations for records which are straightforward, so I want to focus on DDL since this is going to be a big part of your work in PyCharm.</p>
<p>Our earlier example of a table to be used in a bookstore application had one table in it called <code>books</code>. That table contained a set of columns, which we would define using DDL like this:</p>
<pre class="source-code">
CREATE TABLE books (
  title VARCHAR(255),
  isbn VARCHAR(255) UNIQUE,
  price DECIMAL(10, 2),
  author VARCHAR(255),
  page_count INT
);</pre> <p>If you are new to SQL, you might have noticed the keywords are capitalized. In fact, I’ll bet you correctly assumed that the capitalized words were keywords. While it isn’t a requirement to capitalize keywords, it is good practice – particularly if your project’s database lead is a large man retired from the United States Marine Corps who is particular about the details of syntax in <em class="italic">his</em> database! In this case, good practice might become a matter of survival.</p>
<p>Most of what you read in the table’s DDL is easy to figure out. We’re creating a table called <code>books</code>. We already knew about the column names. SQL uses a strong type system, meaning you have to define the type of data that will go into a column, and violating that constraint might come with consequences. I’ve said many times before that a developer’s job is to protect a program from entering an invalid state. Likewise, it is a database developer’s job, as well as that <a id="_idIndexMarker906"/>of a <code>VARCHAR</code> refers to a variable-length set of characters. Programmers call this a <em class="italic">string</em>. The number (<code>255</code>) after the type refers to the maximum length of <code>VARCHAR</code>. All of the <code>VARCHAR</code> (string) fields in the database are limited to 255 characters in length. The number 255 is very common because many of us old-timers grew up in the world of 8-bit computing. The number 255, being the maximum value of an 8-bit unsigned integer, was a common maximum for the length of the field. We’d set it to that when we weren’t sure how long the data might be.</p>
<p>Naturally, today, we normally work in 32- and even 64-bit architectures, so the maximum can be much higher. It is normal to constrain ourselves to the old maximum because 255 characters are generally enough for most things. Specifying sane maximums helps keep your database storage and memory requirements reasonable.</p>
<p>Look at the <code>price</code> field. It is specified as the <code>DECIMAL</code> type, which is obviously like a float. Database systems have different names for their types, so you should always consult your database system’s documentation to get the exact naming. <code>DECIMAL</code> is indeed a floating-point number, but we also specified the level of precision with <code>(10,2)</code>. This means we can have a 10-digit number with 2 decimal places. This is commonly used to specify prices. Some database systems have specialized types specifically for currency. SQL Server is an example of this with their <code>MONEY</code> and <code>SMALLMONEY</code> types. Again, check your database system’s documentation for appropriate types since these specialized types aren’t part of standard SQL.</p>
<h2 id="_idParaDest-267"><a id="_idTextAnchor273"/>Relationships</h2>
<p>Consider our bookstore<a id="_idIndexMarker909"/> will naturally grow in size and complexity. Let’s say we’ve added some different fields and removed some we weren’t using. Our new table structure looks like this:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table002">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Title</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Author_name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Author_email</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Pages</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Price</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>C Programming Language, 2nd Edition</p>
</td>
<td class="No-Table-Style">
<p>Brian Kernighan and Dennis Ritchie</p>
</td>
<td class="No-Table-Style">
<p>bkernigan@notrealaddress.com</p>
</td>
<td class="No-Table-Style">
<p>272</p>
</td>
<td class="No-Table-Style">
<p>53.60</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Real-World Implementation of C# Design Patterns</p>
</td>
<td class="No-Table-Style">
<p>Bruce Van Horn</p>
</td>
<td class="No-Table-Style">
<p>bvanhorn@notrealaddress.com</p>
</td>
<td class="No-Table-Style">
<p>442</p>
</td>
<td class="No-Table-Style">
<p>44.99</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Hands-On Application Development with PyCharm</p>
</td>
<td class="No-Table-Style">
<p>Quan Nguyen</p>
</td>
<td class="No-Table-Style">
<p>qnguyen@notrealaddress.com</p>
</td>
<td class="No-Table-Style">
<p>785</p>
</td>
<td class="No-Table-Style">
<p>35.45</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Hands-On Application Development with PyCharm, 2nd Edition</p>
</td>
<td class="No-Table-Style">
<p>Bruce Van Horn</p>
</td>
<td class="No-Table-Style">
<p>bvanhorn@notrealaddress.com</p>
</td>
<td class="No-Table-Style">
<p>840</p>
</td>
<td class="No-Table-Style">
<p>44.99</p>
</td>
</tr>
</tbody>
</table>
<p>Besides the complexity coming<a id="_idIndexMarker910"/> from more records, we’ve introduced some complexity in terms of design. At some point, it became important for us to track more information about the authors of any given book. We added fields for the name and email address, which seemed to solve our problems at first, but ultimately led to more issues.</p>
<p>The C book has two authors, but we only have one field. While it might be fine to store both authors as we did, there is also a field for the email address and this can only accommodate one address. This is not ideal since our objective might be to send royalty statements or sales reports to the authors. One address is a problem.</p>
<p>The email addresses will be duplicated in the event we store two books with the same author. If the author changes email addresses, all of the records have to be updated. This is the equivalent of hardcoded values kept in multiple places in a program. You have to remember to change it in lots of places. The problem is compounded if this email address data is duplicated in several different tables.</p>
<p>The solution to this is prescribed by SQL and the ideas behind relational algebra. You need a single source of truth for <a id="_idIndexMarker911"/>the author’s data instead of mixing it in with other tables. So, we create a new table for authors:</p>
<pre class="source-code">
CREATE TABLE authors (
  id SERIAL PRIMARY KEY,
  first_name VARCHAR(255),
  last_name VARCHAR(255),
  email_address VARCHAR(255)
);</pre> <p>This table has fields for the first and last names as well as the email address. It also has a field called <code>id</code>, which is going to the server as a primary key. A primary key is a field that can uniquely identify the information in that row. The idea here is that every author gets only one row to store their information. We need some piece of data to uniquely identify that row. Consider my own records. My first and last names make poor choices to uniquely define my record in the database. I know of at least three other people named Bruce Van Horn. One was my father, who published in the medical field. One is a motivational speaker who publishes books in that literary field. I found another Bruce Van Horn on LinkedIn, and believe it or not, he too is a software developer! So the name is a poor choice as a unique identifier.</p>
<p>Email addresses might work, except that we’ve already figured out that email addresses can change. I have no fewer than five email addresses and at least one of these is so overtaken with spam that I no longer even check it. Email isn’t going to work.</p>
<p>The best practice is to use some piece of data that is unique but arbitrary, with no bearing at all on the rest of the data in the record. There are two ways to do this. The most common is to use a database <a id="_idIndexMarker912"/>sequence. A <strong class="bold">sequence</strong> is an automatically incrementing source of integers. Each time a record is inserted into a table, the sequencer generates a sequential number, which is guaranteed to be unique.</p>
<p>The other approach is to use <code>6f35e0e7-d99a-4437-b894-f73ff35bd3ad</code> versus a record with the <code>id</code> value of <code>16</code>. Which would you rather type into your queries?</p>
<p>Now that we have a field that uniquely identifies an author’s record, we can adjust our book table structure like this:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table003">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><a id="_idTextAnchor274"/></strong><strong class="bold">Title</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">pages</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">price</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">author_id</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Real-World Implementation of C# Design Patterns</p>
</td>
<td class="No-Table-Style">
<p>442</p>
</td>
<td class="No-Table-Style">
<p>44.99</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Hands-On Application Development with PyCharm</p>
</td>
<td class="No-Table-Style">
<p>785</p>
</td>
<td class="No-Table-Style">
<p>35.45</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Hands-On Application Development with PyCharm, 2nd Edition</p>
</td>
<td class="No-Table-Style">
<p>840</p>
</td>
<td class="No-Table-Style">
<p>44.99</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
</tr>
</tbody>
</table>
<p>Our <code>authors</code> table looks like this:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table004">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">author_id</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">first_name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">last_name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">email</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>Quan</p>
</td>
<td class="No-Table-Style">
<p>Nguyen</p>
</td>
<td class="No-Table-Style">
<p>qnugyen@notrealaddress.com</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>Bruce</p>
</td>
<td class="No-Table-Style">
<p>Van Horn</p>
</td>
<td class="No-Table-Style">
<p>bvanhorn@notrealaddress.com</p>
</td>
</tr>
</tbody>
</table>
<p>The author ID in the <code>authors</code> table is used as a related column in the <code>books</code> table using a one-to-many relationship. Each author will have one record, which is related to many records in the <code>books</code> table.</p>
<h2 id="_idParaDest-268"><a id="_idTextAnchor275"/>More relational structures</h2>
<p>We’ve solved a big problem using our <a id="_idIndexMarker915"/>one-to-many table structure. We no longer have duplicate data in multiple records for our authors. We didn’t, however, solve all of our problems. For example, the C book has multiple authors. How can we store authors in a way that allows each book to support multiple authors?</p>
<p>I’m afraid we’ve reached the point where I tell you that this isn’t a book on SQL, nor is it a book on relational theory. If I’ve hooked you on this, I can recommend some excellent books that I used when I learned these things. We’ve presented enough relational database vocabulary to help you relate to what you will see in PyCharm’s tooling and that was my real objective.</p>
<p>Since I am not a total <a id="_idIndexMarker916"/>degenerate, regardless of what you may read about me on Stack Overflow, I will give you the solution quickly and without many pages of explanation.</p>
<p>You’d solve it using what we call a mapping table. Your structure would require the addition of a table called <code>books_authors_map</code>:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table005">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Id</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Book_id</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Author_id</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
</tr>
</tbody>
</table>
<p>Your <code>books</code> table would look like this:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table006">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Book_id</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Title</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Pages</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Price</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>The C Programming Language</p>
</td>
<td class="No-Table-Style">
<p>442</p>
</td>
<td class="No-Table-Style">
<p>44.99</p>
</td>
</tr>
</tbody>
</table>
<p>We took out the <code>author_id</code> field and added a <code>book_id</code> field, which really should have been there all along. The <code>authors</code> table would look the same:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table007">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Author_id</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">First_name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Last_name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Email</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>Brian</p>
</td>
<td class="No-Table-Style">
<p>Kernighan</p>
</td>
<td class="No-Table-Style">
<p>bkernigan@notrealaddress.com</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>Dennis</p>
</td>
<td class="No-Table-Style">
<p>Ritchie</p>
</td>
<td class="No-Table-Style">
<p>dritche@noterealaddress.com</p>
</td>
</tr>
</tbody>
</table>
<p>The mapping table can map a <code>books</code> and <code>authors</code>! If either author goes solo and publishes a book without their co-author, that will work! The <code>books</code> table’s record will have one related record in the map, which has one related record in the <code>authors</code> table.</p>
<p>If a book has 10 authors, it will have 1 book record, 10 author records, and 10 mapping entries. Relational algebra is pretty cool! It is an <a id="_idIndexMarker917"/>underrated skill in today’s <a id="_idIndexMarker918"/>world of <strong class="bold">object relational mappers</strong> (<strong class="bold">ORMs</strong>), which abstract all of this into normal object structures. Developers today tend to <a id="_idIndexMarker919"/>lose this skill. If you do, you give up a lot. You can make fine-grained modifications in your DDL that lead to huge performance gains for your application.</p>
<p>Speaking of that, let’s learn about PyCharm’s tooling for database development.</p>
<h2 id="_idParaDest-269"><a id="_idTextAnchor276"/>Database terminology uses simple English plurals</h2>
<p>As we go through some of the terminology <a id="_idIndexMarker920"/>used when talking about databases, I feel compelled to point out something that bothered me for a very long time. Many terms used when talking about databases come from Latin root <a id="_idIndexMarker921"/>words. For example, an <strong class="bold">index</strong> is an addition to a table that can speed up data retrieval at the cost of the speed of inserting new data. It is also a Latin word that refers to <em class="italic">a pointer, indicator, or signpost</em>. A <strong class="bold">schema</strong> refers to a way <a id="_idIndexMarker922"/>of partitioning off tables and other structures in a database. The word <em class="italic">schema</em> originated with the Greek word σχῆμα (<em class="italic">skema</em>) and in both languages means <em class="italic">shape, form, </em><em class="italic">or plan</em>.</p>
<p>When talking about the plural forms, the words might not be as you expect if you received a classical education as I did. If you come from a country where your language is based on Latin, you might notice this issue as well.</p>
<p>I would expect the plural form of <em class="italic">schema</em> to be <em class="italic">schemata</em>, and the plural of <em class="italic">index</em> to be <em class="italic">indices</em>. If you expect this, you will always be disappointed. The industry has standardized simple plural forms such as <em class="italic">schemas</em> and <em class="italic">indexes</em>.</p>
<h1 id="_idParaDest-270"><a id="_idTextAnchor277"/>Database tooling in PyCharm</h1>
<p>The database tooling in PyCharm is <a id="_idIndexMarker923"/>complete but generic. By this, I mean that PyCharm attempts to support every database out there, and as such, it generally supports features common to all. You may find yourself sometimes leaning on more specific tools, such as <strong class="bold">SQL Server Management Studio</strong> (<strong class="bold">SSMS</strong>) for SQL Server. However, for general <a id="_idIndexMarker924"/>development work, the tooling in PyCharm is more than sufficient. The starting point for working with databases in PyCharm is opening the database tools and creating a connection. For this, you also need a database. PyCharm supports dozens of the most popular database servers. Since this is true, it would be impossible for me to predict which one you<a id="_idIndexMarker925"/> prefer, so I’m going to fall back on one that I know well: MySQL. Regardless of your favorite, the tooling in PyCharm is generic, so as long as you pick a relational database that is standards-compliant, the processes are the same.</p>
<h1 id="_idParaDest-271"><a id="_idTextAnchor278"/>Setting up a MySQL database server with Docker</h1>
<p>The easiest way to try out any database system, or pretty much any server technology at all, is to use Docker. I have more<a id="_idIndexMarker926"/> plans for Docker later in the book, and I will be using Docker Desktop, along with the command line. I like the desktop’s GUI for seeing what is running graphically, but you should master Docker<a id="_idIndexMarker927"/> command-line skills in order to remain competitive. If you don’t have Docker Desktop installed, you can find the installation instructions at <a href="https://www.docker.com/products/docker-desktop/">https://www.docker.com/products/docker-desktop/</a>. Naturally, there are other options, such as installing a database server on your computer. I personally rail against this because database servers are very complicated. Installing something such as SQL Server or Oracle will make modifications to your OS at a level that makes these software packages hard to uninstall. It used to be a rule of thumb that if you made any mistakes installing the database server, the smartest option was the wipe the OS and start over. I’m relatively sure that’s no longer the case, but I still treat database servers with respect because of all the moving parts in your solution, this one is easily the most complicated. The last thing you want is a broken database server on your laptop while in the middle of developing an epic project. So, I recommend Docker. If something goes wrong, you delete the container and make a new one.</p>
<p>Likewise, you can create a VM using products <a id="_idIndexMarker928"/>such as <strong class="bold">VMware Workstation</strong> or <strong class="bold">Oracle VirtualBox</strong>. This is <a id="_idIndexMarker929"/>another fine way to work, though it takes up more space and resources than Docker will, and you must remember to keep your VMs up to date.</p>
<p>Another fine option is to spin up your database server of choice in your favorite cloud. I recommend <strong class="bold">DigitalOcean</strong> for this since<a id="_idIndexMarker930"/> their pricing and setup are both extremely easy to understand. I use this service to host the companion website for this book. If your computer isn’t up for running a database server, VMware, or Docker, using a cloud provider is your best option.</p>
<p>All these options are great, but I need to pick <a id="_idIndexMarker931"/>one, so I’m going to be working with Docker. Remember, this isn’t a book on <a id="_idIndexMarker932"/>Docker. My coverage is going to be tacit. Your objective is to get a database server up and running so you can practice. If you can do that with something besides Docker, go ahead and skip to the next section.</p>
<h2 id="_idParaDest-272"><a id="_idTextAnchor279"/>Installing and running the MySQL container</h2>
<p>I’m assuming you have<a id="_idIndexMarker933"/> Docker running on your computer and that your Docker <a id="_idIndexMarker934"/>commands are available in your <code>PATH</code>. We can confirm this by opening our terminal and typing this command:</p>
<pre class="source-code">
docker ps -a</pre> <p>This command will list all the containers currently running, or stopped. If you just installed Docker, you should see an empty list, which is to say, nothing at all. The test is really to make sure the command runs and doesn’t throw any errors. If it doesn’t, you’re ready to grab MySQL using this command:</p>
<pre class="source-code">
docker pull mysql</pre> <p>You’ll see a nicely animated display of the installation, as shown in <em class="italic">Figure 11</em><em class="italic">.1</em>.</p>
<div><div><img alt="Figure 11.1: The Docker command used to pull the images needed for MySQL" src="img/B19644_11_001.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1: The Docker command used to pull the images needed for MySQL</p>
<p>This command pulled all the requirements needed to run one or more containers for MySQL. Next, we need to create and run a<a id="_idIndexMarker935"/> container with this command:</p>
<pre class="source-code">
docker run --name pycharm-mysql -e MYSQL_ROOT_PASSWORD=P@ssw0rd –p 3306:3306 -d mysql</pre> <p>This command will create and run <a id="_idIndexMarker936"/>a container named <code>pycharm-mysql</code>. It sets the root password for the MySQL database to <code>P@ssw0rd</code>. The <code>–p</code> flag maps port <code>3306</code>, which is the standard port for MySQL, to the same value between your container and the host. This will make it seem as though you are running the MySQL server directly on your computer. The <code>-d</code> flag tells Docker to run MySQL as a background process rather than waiting for it to exit. This is common with server software. I hope I don’t need to remind you that <em class="italic">this is not production ready</em>. If you are in a small group where the developers are responsible for standing up a production environment, don’t simply duplicate your development environment on a server open to the internet. You should at least map your database to more robust permanent storage, as well as harden MySQL, use non-privileged accounts for your app, and use a non-obvious root password.</p>
<p>We are now running the MySQL server. When you run the Docker command, your output is somewhat cryptic and unsatisfying. You can see mine in <em class="italic">Figure 11</em><em class="italic">.2</em>.</p>
<div><div><img alt="Figure 11.2: A long string of seemingly random letters and numbers is Docker’s way of saying “I love you,” or at least that your container is running" src="img/B19644_11_002.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2: A long string of seemingly random letters and numbers is Docker’s way of saying “I love you,” or at least that your container is running</p>
<p>There is an old saying that goes, <em class="italic">Tell a man there are a trillion stars in the galaxy, and he’ll believe you. Tell him his container is successfully running in Docker and he’ll run</em><code> docker ps -a</code><em class="italic"> to be sure.</em> In truth, I might have just made that up. Nevertheless, let’s make sure:</p>
<pre class="source-code">
docker ps -a</pre> <p>You should see proof like mine in <em class="italic">Figure 11</em><em class="italic">.3</em>. The <code>CONTAINER ID</code> value will be different for every run, so don’t expect yours to match mine.</p>
<div><div><img alt="Figure 11.3: I can see my container named pycharm-mysql is running and has exposed port 3306" src="img/B19644_11_003.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3: I can see my container named pycharm-mysql is running and has exposed port 3306</p>
<h2 id="_idParaDest-273"><a id="_idTextAnchor280"/>Stopping and starting the container</h2>
<p>When you’re ready to retire for the day, you might want to stop the container:</p>
<pre class="source-code">
docker stop pycharm-mysql</pre> <p>This stops the container. You can<a id="_idIndexMarker937"/> check with the same <code>docker ps -a</code> command we’ve been using to <a id="_idIndexMarker938"/>confirm the status changed from <em class="italic">Up</em> to <em class="italic">Stopped</em>. Tomorrow morning, when you come back, type the following:</p>
<pre class="source-code">
docker start pycharm-mysql</pre> <p>This starts things up so you can pick up where you left off.</p>
<h1 id="_idParaDest-274"><a id="_idTextAnchor281"/>Connecting to data sources using PyCharm</h1>
<p>Open PyCharm Professional and <a id="_idIndexMarker939"/>create a new Python project called <code>database_fun</code>. Now, locate the database tools. You can find them on the right side toolbar via the database icon that looks like a three-layer cake (yum!). Alternatively, you can find it via the hamburger (yum!) menu by clicking <strong class="bold">View</strong> | <strong class="bold">Tool Windows</strong> | <strong class="bold">Database</strong>. Both options are shown in <em class="italic">Figure 11</em><em class="italic">.4</em>.</p>
<div><div><img alt="Figure 11.4: Two options for opening database tools – one from the menu, and the second by clicking the database tools icon" src="img/B19644_11_004.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4: Two options for opening database tools – one from the menu, and the second by clicking the database tools icon</p>
<p>With the database tools open, you need to create a new <strong class="bold">data source</strong>. Note the generic terminology. PyCharm supports relational as well as non-relational databases, so the term <em class="italic">data source</em> is just a generic way of pointing that out. Click the <strong class="bold">+</strong> icon shown in <em class="italic">Figure 11</em><em class="italic">.5</em>, then hover over <strong class="bold">Data Source</strong>. You’ll see a long list of supported data sources. Find <strong class="bold">MySQL</strong> and click it.</p>
<div><div><img alt="Figure 11.5: Supported data sources in PyCharm" src="img/B19644_11_005.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5: Supported data sources in PyCharm</p>
<p>You’ll see a configuration window like mine in <em class="italic">Figure 11</em><em class="italic">.6</em>.</p>
<div><div><img alt="Figure 11.6: Configuration window for a MySQL database" src="img/B19644_11_006.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6: Configuration window for a MySQL database</p>
<p>Each database server may have slightly different settings, but essentially they boil down to the IP address (or DNS name), port, security credentials, and, very often, the default database, which may not yet exist. We <a id="_idIndexMarker940"/>defined the root password for our MySQL server as <code>P@ssw0rd</code>, and we know since we’re running in Docker our IP is just going to be <code>localhost</code>. You might also remember the port that was displayed in the output of the <code>docker ps -a</code> command we ran earlier is <code>3306</code>. The arrow in the preceding figure points to an important aspect of database tooling in PyCharm.</p>
<p>PyCharm, like most JetBrains IDEs, is written in Java. As such, PyCharm relies on <strong class="bold">Java Database Connectivity</strong> (<strong class="bold">JDBC</strong>) drivers in order to <a id="_idIndexMarker941"/>work. Most JDBC drivers are written by the same company or group that publishes the database, which means it’s generally not legal for JetBrains to bundle those drivers with PyCharm without getting lawyers involved. Nobody wants that! JetBrains did the next best thing. The IDE can download and install the driver automatically, but you have to initiate this by clicking the <strong class="bold">Download missing driver files</strong> link on this screen. This only needs to be done the first time you use the database driver. Once the drivers are installed, the option shown by the arrow in <em class="italic">Figure 11</em><em class="italic">.6</em> no longer appears. You can test your connection by clicking the <strong class="bold">Test Connection</strong> link. If everything works, you’ll get a confirmation message stating your database connection was successful. Click <strong class="bold">OK</strong> to close the connection dialog.</p>
<p>Once the connection dialog is closed, you’ll see a list of data source connections for your project in the <strong class="bold">Database</strong> panel. There is a <a id="_idIndexMarker942"/>small toolbar visible at the top of the database panel, as shown in <em class="italic">Figure 11</em><em class="italic">.7</em>.</p>
<div><div><img alt="Figure 11.7: The database panel has a small menu bar at the top" src="img/B19644_11_007.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7: The database panel has a small menu bar at the top</p>
<p>As usual, I’ve numbered the options in the figure. Let’s review them:</p>
<ol>
<li>The <strong class="bold">Add Data Source</strong> button, which we’ve already seen, allows you to add new data sources to your project.</li>
<li>The <strong class="bold">Duplicate</strong> button allows you to make a quick copy, presumably with some minor adjustments. Many of my projects entail multiple databases on one server. All I have to do is set up the first one, then duplicate the connection and change the name of the database. This option makes this a quick and easy process.</li>
<li>The <strong class="bold">Refresh</strong> button reloads the metadata for your connections. Remember this one. PyCharm doesn’t automatically keep track of all your database changes, especially if they are made outside of PyCharm. You’ll need to click the <strong class="bold">Refresh</strong> button periodically to make sure you’re viewing the latest information on your data sources.</li>
<li>The <strong class="bold">Data source properties</strong> button will display a dialog that allows you to change the settings of the data source configuration.</li>
<li>The <strong class="bold">Disconnect</strong> button will disconnect you from a database server.</li>
<li>The <strong class="bold">Edit data</strong> button allows you to directly edit data in tables in your database using a graphical, spreadsheet-like UI. This is nice for quickly adding or changing test data.</li>
<li>The <strong class="bold">Go To DDL</strong> button will take you to the SQL definition of whatever you have currently selected. You <a id="_idIndexMarker943"/>need to have a DDL mapping for this to work properly.</li>
<li><strong class="bold">Compare Structure</strong> lets us compare two database structures. This is usually used to help migrate one database structure to another after changes were made during the normal development process. Migration technology in PyCharm 2023 is only partially complete, so this feature might have changed at the time you are reading this book.</li>
<li><strong class="bold">Jump to Query Console</strong> is pretty much your go-to tool for interacting with the database at the command line. A query console was opened automatically when you first connected to the database, but if you closed it, this button opens it and brings it into focus.</li>
<li>The filter button allows you to filter what you see in the data sources you have defined. By default, everything is turned on, which might be a bit much for most developers who are not usually accustomed to seeing all the guts of the database so explicitly displayed.</li>
</ol>
<p>Besides these tools, there are others that pertain to setting up how you view and work with your data sources. These will be a little easier to explain once we have a database to play with. Let’s take a moment to create one.</p>
<h2 id="_idParaDest-275"><a id="_idTextAnchor282"/>Creating a new database</h2>
<p>Before we do anything else, we<a id="_idIndexMarker944"/> need a new database. Most database servers just call this “a new database.” MySQL is a little different. They call a new database a new <code>@localhost</code>) and click <strong class="bold">New</strong> | <strong class="bold">Schema</strong>, as shown in <em class="italic">Figure 11</em><em class="italic">.8</em>.</p>
<p class="IMG---Figure"> </p>
<div><div><img alt="Figure 11.8: Create a new database by right-clicking the server (indicated by the arrow), then New | Schema" src="img/B19644_11_008.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8: Create a new database by right-clicking the server (indicated by the arrow), then New | Schema</p>
<p>When you do this, you are prompted to<a id="_idIndexMarker945"/> name the schema, as shown in <em class="italic">Figure 11</em><em class="italic">.9</em>. I’ll name my schema to match my project in PyCharm. I’ll call it <code>database_fun</code>.</p>
<div><div><img alt="Figure 11.9: Name your schema using this dialog" src="img/B19644_11_009.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9: Name your schema using this dialog</p>
<p>Beneath the covers, PyCharm is just<a id="_idIndexMarker946"/> generating and executing DDL statements. This is how it is able to be so agnostic with respect to so many database options. You can see the preview of the command it will run in <em class="italic">Figure 11</em><em class="italic">.9</em>. Click <strong class="bold">OK</strong> to execute the command, and the database window will update to show the new schema.</p>
<p>You’ve just created a new database! It is just as easy using any other database server software supported by PyCharm.</p>
<p>Before we get into working on the structure of our database, there are a few more setup options to consider.</p>
<h2 id="_idParaDest-276"><a id="_idTextAnchor283"/>Setting the SQL dialect (this is crucial)</h2>
<p>Since PyCharm supports dozens<a id="_idIndexMarker947"/> of different databases, each with its own dialect of SQL, it stands to reason that you might need to tell PyCharm which SQL dialect you intend to use. You won’t have any trouble remembering to do this because PyCharm nags you until you fill in the setting.</p>
<p>In your project window, right-click the project and create a new file called <code>test.sql</code>. It’s the same process we’ve been using for Python files, except there isn’t a template in the list. Right-click the project, then click <strong class="bold">New File</strong>, as shown in <em class="italic">Figure 11</em><em class="italic">.10</em>.</p>
<div><div><img alt="Figure 11.10: There isn’t a specific listing for SQL files, so just right-click and pick New | File" src="img/B19644_11_010.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10: There isn’t a specific listing for SQL files, so just right-click and pick New | File</p>
<p>A small dialog will appear. Type the <a id="_idIndexMarker948"/>name of the file as <code>test.sql</code>. The moment you do this, the nagging begins. You’ll see a message stating the SQL dialect is not configured, as shown in <em class="italic">Figure 11</em><em class="italic">.11</em>.</p>
<div><div><img alt="Figure 11.11: PyCharm will hound you until you configure the SQL dialect" src="img/B19644_11_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11: PyCharm will hound you until you configure the SQL dialect</p>
<p>If PyCharm were me and the user of PyCharm were my 13-year-old daughter, there would be a lot of eye-rolling, an exasperated grunt, followed by, “Fine! I’ll set the SQL dialog! But none of my friends do!” Then I’d say, “If you’re friends all installed Windows 7 on their computers, would you follow their example?” Then she’d sag her head and say, “No, of course not.”</p>
<p>Nobody wants this dialogue playing out, so we’d better <a id="_idIndexMarker949"/>make our IDE overlord happy. Click the link in <em class="italic">Figure 11</em><em class="italic">.11</em> to set the dialect. You’ll need to set it locally and globally. The configuration is shown in <em class="italic">Figure 11</em><em class="italic">.12</em>.</p>
<div><div><img alt="Figure 11.12: Set the SQL dialects globally and locally" src="img/B19644_11_012.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12: Set the SQL dialects globally and locally</p>
<p>The global setting carries across all projects, so if you’re like me and you only ever use one database server type, you can set it globally here, and it will be set for all your projects. The project dialect is a little more nuanced. If you value your sanity, you really need to create a folder for your SQL files, then set the dialect for the folder. Here, I’m just showing you where the settings are. Go ahead and pick <strong class="bold">MySQL</strong> for your global and local dialect and we’ll worry about the whole folder idea a little later.</p>
<h2 id="_idParaDest-277"><a id="_idTextAnchor284"/>Grouping and color coding data sources</h2>
<p>My own work consists of creating the SaaS product sold by my employer. This means that for the first seven years of the project, I only had one database to deal with. As the product grew in capability, we <a id="_idIndexMarker950"/>added two more SQL databases, a <a id="_idIndexMarker951"/>MongoDB database, and several Redis data caches to the project. My project is still pretty tame compared to some I’ve worked on. If you have many databases to deal with, PyCharm allows you to organize them in several different ways.</p>
<h3>Organizing by folders</h3>
<p>You can organize your data sources by grouping them into folders. We only have one, but we’ll go through the process anyway. Click the data source indicated by the arrow in <em class="italic">Figure 11</em><em class="italic">.8</em>. Last time, we right-clicked; this time, just click the data source and press <em class="italic">F6</em> on your keyboard. This brings up a<a id="_idIndexMarker952"/> dialog, as shown in <em class="italic">Figure 11</em><em class="italic">.13</em>.</p>
<div><div><img alt="Figure 11.13: Create a new folder for your data source" src="img/B19644_11_013.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13: Create a new folder for your data source</p>
<p>Organizing by folder can be useful if you have lots of databases in your project, or maybe you have separate sets of connections for<a id="_idIndexMarker953"/> development, <strong class="bold">user acceptance testing</strong> (<strong class="bold">UAT</strong>), and production.</p>
<h3>Color coding databases</h3>
<p>I’m fond of this feature since I<a id="_idIndexMarker954"/> have four environments:</p>
<ul>
<li>A local database, just like we have now</li>
<li>A central development testing database where the development validates their designs before the product team is allowed to see our changes</li>
<li>A staging database that is connected to a staged version of our application for UAT</li>
<li>A production database</li>
</ul>
<p>I always color code everything! You can set a color for the data source by opening up the <strong class="bold">Data Source Properties</strong> window. To do this, click the <strong class="bold">Data Source Properties</strong> button on the toolbar. I showed you this earlier in <em class="italic">Figure 11</em><em class="italic">.7 (4)</em>. Clicking this button reveals a dialog box similar to the one you used to create the data source earlier. Look at mine in <em class="italic">Figure 11</em><em class="italic">.14</em>.</p>
<div><div><img alt="Figure 11.14: Click the innocuous dot next to the data source name in the properties window to set a color for your data source" src="img/B19644_11_014.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14: Click the innocuous dot next to the data source name in the properties window to set a color for your data source</p>
<p>You can probably figure it out from here. Once you dismiss the dialog, your database elements in the IDE become awash with lovely pastel hues. Personally, I set my local development environment to violet, the dev environment to green, staging to yellow, and production to red. Not rose from the selection, but a bright, obnoxious, over-the-top, fire engine red picked from the custom dialog at the bottom of the list. As the project’s development lead, there are<a id="_idIndexMarker955"/> times when I need to go look at the project in production. I want to make sure I remember where I am! Color coding helps!</p>
<h3>Sharing a data source between projects</h3>
<p>If you have many projects that<a id="_idIndexMarker956"/> use the same data source, it would be tedious to have to set the same thing over and over for each project. Thankfully, you don’t have to. PyCharm allows you to make a data source global, meaning it is available to all your projects in PyCharm. In the data source properties window shown in <em class="italic">Figure 11</em><em class="italic">.15</em>, find the button indicated by the arrow.</p>
<div><div><img alt="Figure 11.15: You can make your data source configuration global so it is available to all your projects" src="img/B19644_11_015.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15: You can make your data source configuration global so it is available to all your projects</p>
<p>If you click it, the dialog changes very subtly to indicate the data source is now global. If you want to check, just make a <a id="_idIndexMarker957"/>new project like we did earlier. Open the database tools and you’ll find the data source is already there. I made a project called <code>more_database_fun</code>, and as you can see in <em class="italic">Figure 11</em><em class="italic">.16</em>, the data source indeed carried over.</p>
<div><div><img alt="Figure 11.16: I made a new project and opened the database tools. The global data source is there" src="img/B19644_11_016.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.16: I made a new project and opened the database tools. The global data source is there</p>
<p>Since there is no code in this second <a id="_idIndexMarker958"/>project, I did not include it in the chapter source code.</p>
<p>Another fun feature is the global data sources are exported when you export your IDE settings. Refer back to <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a>, <em class="italic">Installation and Configuration</em>, if you need a refresher on importing and exporting settings, but I’ll go ahead and point out the export settings I’m talking about here in <em class="italic">Figure 11</em><em class="italic">.17</em>.</p>
<div><div><img alt="Figure 11.17: You can export your global data sources to the settings export ZIP file, allowing others to simply import the relevant settings" src="img/B19644_11_017.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.17: You can export your global data sources to the settings export ZIP file, allowing others to simply import the relevant settings</p>
<p>If you are a development lead, you might consider creating an export of your IDE settings that does not include things such as color and font size. Those are likely more personal preferences and make sense when you want to copy your settings between a laptop and a workstation. But it does make sense to export more work-specific settings such as your data sources so your<a id="_idIndexMarker959"/> team can easily import them. If you do this, remember you are also potentially copying credentials! You should only make development data sources available as global exports lest your <code>settings.zip</code> file falls into the wrong hands. This is especially important in an age where more and more of us are using cloud database servers rather than locally installed servers.</p>
<p>If you need tight control over credentials, PyCharm can integrate with a product called <em class="italic">KeePass</em>. Since that is fairly niche, I’ll not cover it here, but I will leave a link with more details in the <em class="italic">Further reading</em> section of <a id="_idIndexMarker960"/>this chapter.</p>
<h3>Connecting with SSL and SSH options</h3>
<p>For even more security, especially with respect to cloud data sources, PyCharm supports SSL and SSH <a id="_idIndexMarker961"/>configuration options. See <em class="italic">Figure 11</em><em class="italic">.18</em> for your security setup options for your data sources.</p>
<div><div><img alt="Figure 11.18: SSH and SSL security options can be found in the data source settings on the SSH/SSL tab" src="img/B19644_11_018.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.18: SSH and SSL security options can be found in the data source settings on the SSH/SSL tab</p>
<p>I won’t go deep into this here, but you need to know where these settings lie in the IDE since you will need them for cloud providers such as Microsoft Azure.</p>
<h1 id="_idParaDest-278"><a id="_idTextAnchor285"/>Database design and manipulation</h1>
<p>Let’s move on to the part you’ve probably <a id="_idIndexMarker962"/>been waiting for: the part where we get to build a database! We already created the schema, but at the moment, we don’t have any tables. Let’s fix that first!</p>
<h2 id="_idParaDest-279"><a id="_idTextAnchor286"/>Creating a table</h2>
<p>Right-click the schema, <strong class="bold">database_fun</strong>, which we created <a id="_idIndexMarker963"/>earlier, and click <strong class="bold">New</strong> | <strong class="bold">Table</strong>, as shown in <em class="italic">Figure 11</em><em class="italic">.19</em>.</p>
<div><div><img alt="Figure 11.19: Right-click on the schema indicated by the arrow, then click New | Table" src="img/B19644_11_019.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.19: Right-click on the schema indicated by the arrow, then click New | Table</p>
<p>You’ll get a new window, as shown in <em class="italic">Figure 11</em><em class="italic">.20</em>.</p>
<div><div><img alt="Figure 11.20: New window" src="img/B19644_11_020.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.20: New window</p>
<p>I had to stretch mine out a little to see it all, as shown in the figure. The next few steps will build our table. I went ahead and <a id="_idIndexMarker964"/>typed the table name in the <strong class="bold">Name</strong> field at the top. You can see what’s going on here. As before, with the schema creation DDL, PyCharm is building a DDL script in the preview at the bottom of the window. Right now, we have a red squiggly line under the semicolon because we have yet to add any fields, so this DDL is invalid.</p>
<p>At the top left of the window is a button with a <strong class="bold">+</strong> icon. Click that to see a list of elements you can add to the table, as shown in <em class="italic">Figure 11</em><em class="italic">.21</em>.</p>
<div><div><img alt="Figure 11.21: You can add to the table by clicking the + button" src="img/B19644_11_021.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.21: You can add to the table by clicking the + button</p>
<p>From here, you can pick whatever it is you need to add. We’re going to add our primary key field first. If you’re new to relational database design and you need a good primer, <em class="italic">Database Design for Mere Mortals</em> by Michael<a id="_idIndexMarker965"/> Hernandez is a must-read. I’ve used it as a textbook in my classes for over 20 years! Hernandez has an equally impactful book on SQL queries, as does another author, named Ben Forta. I’ll leave the details in the <em class="italic">Further reading</em> section of this chapter.</p>
<p>In short, every table we create should have a field that can uniquely identify individual records. It should not consist of data that is related to the domain of data contained in the table. By this I mean we are making a table to hold information about book authors. We should not use any field related to the author as the primary key, the record’s unique identifier. Instead, we should use something unrelated. With MySQL, the norm is to use an auto-incrementing integer field.</p>
<p>An auto-incrementing integer field refers to a field that will automatically populate a number from a sequence starting with the number 1 and increasing automatically with each record insertion. The increment is not something you should do in code. This is a feature of the database itself. This is important. Relational databases are designed to be atomic, meaning all transactions are isolated. This is important because it means the database will never generate the same value for the auto-incrementing key even if two record insertions happen within microseconds of one another. This is something you cannot guarantee with your own code. You<a id="_idIndexMarker966"/> need to rely on the server for this.</p>
<p>Using the menu shown in <em class="italic">Figure 11</em><em class="italic">.21</em>, add a column and set it as shown in <em class="italic">Figure 11</em><em class="italic">.22</em>.</p>
<div><div><img alt="Figure 11.22: Add the first column with the settings shown here" src="img/B19644_11_022.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.22: Add the first column with the settings shown here</p>
<p>Here, we’ve created an auto-incrementing integer field called <code>author_id</code>. I’m using snake case here, but this is not required. Use whatever naming conventions your project requires. Note I haven’t yet officially made it the primary key. That’s coming. First, let’s finish out the rest of our columns.</p>
<p>This can be done quickly if you leave the <code>author_id</code> field selected, then click the plus button three times. When you have a column selected, or even when you have the <code>columns</code> folder selected in the window, PyCharm assumes that when you click the <strong class="bold">+</strong> button, you want a column. Likewise, you can <a id="_idIndexMarker967"/>select any of the other folders for things such as primary keys, foreign keys, and indexes. PyCharm will simply create it without making you use the menu we saw earlier.</p>
<p>Configure the three fields like so:</p>
<ul>
<li><code>first_name</code>: <code>varchar(30)</code></li>
<li><code>last_name</code>: <code>varchar(30)</code></li>
<li><code>email</code>: <code>varchar(255) </code><code>not null</code></li>
</ul>
<p><em class="italic">Figure 11</em><em class="italic">.23</em> shows the last field configuration. I gave this one the <code>not null</code> constraint, which will prevent a record insertion from completing if the <code>email</code> field is left empty. This is done by clicking the checkbox titled <strong class="bold">Not null</strong>, as seen in <em class="italic">Figure 11</em><em class="italic">.22</em>.</p>
<div><div><img alt="Figure 11.23: Configure the email field as shown" src="img/B19644_11_023.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.23: Configure the email field as shown</p>
<p>It’s starting to look<a id="_idIndexMarker968"/> like a table, isn’t it? There are just a couple more things we need. Let’s go ahead and configure the <code>author_id</code> field to be a proper primary key.</p>
<h3>Setting the primary key</h3>
<p>Click on the <code>keys</code> folder, then <a id="_idIndexMarker969"/>click the <strong class="bold">+</strong> button. You’re asked whether you want to create a primary or unique key, as shown in <em class="italic">Figure 11</em><em class="italic">.24</em>.</p>
<div><div><img alt="Figure 11.24: Make sure the keys folder is selected, as shown in this figure, then click the + icon and pick Primary Key" src="img/B19644_11_024.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.24: Make sure the keys folder is selected, as shown in this figure, then click the + icon and pick Primary Key</p>
<p>This will bring up a different<a id="_idIndexMarker970"/> window, as seen in <em class="italic">Figure 11</em><em class="italic">.25</em>.</p>
<div><div><img alt="Figure 11.25: Adding a primary key entails clicking the + icon and then selecting the field name from the dropdown" src="img/B19644_11_025.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.25: Adding a primary key entails clicking the + icon and then selecting the field name from the dropdown</p>
<p>To add the key, click the <code>author_id</code> field to add it as the primary key. The relational theory allows for the creation of compound<a id="_idIndexMarker971"/> keys, which is why you could potentially add more than one field. It isn’t used in general practice since if you stick to an auto-incrementing integer for your key, creating a compound primary key isn’t needed. In fact, I consider a compound key to be a code smell.</p>
<h3>Adding a unique key constraint</h3>
<p>Next, let’s constrain the <code>email</code> field so that the value of any inserted record must be unique. This prevents data toxicity <a id="_idIndexMarker972"/>problems arising from promiscuous inserts. There should really only be one record for each email address. Let’s enforce it formally with a unique key.</p>
<p>The process is the same as with the primary key, except this time we’ll pick a unique key instead of the primary key and we’ll specify the <code>email</code> field. There’s a trick though. This time, you’ll need to right-click the <code>keys</code> folder to pick the <strong class="bold">Unique Key</strong>. If you just click the <strong class="bold">+</strong> icon, it will add another primary key field, which isn’t what we want. <em class="italic">Figure 11</em><em class="italic">.26</em> shows you what to do.</p>
<div><div><img alt="Figure 11.26: Right-click keys, then click New | Unique Key to avoid creating a second primary key" src="img/B19644_11_026.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.26: Right-click keys, then click New | Unique Key to avoid creating a second primary key</p>
<p>Right-click the <code>keys</code> folder, indicated by<a id="_idIndexMarker973"/> the arrow in the preceding figure, then click <code>email</code> field. I would also change the name from the generated <code>authors_pk2</code> value to <code>authors_uq</code>. This will tell you at a glance in the DDL that it is a unique field constraint.</p>
<h3>Adding an index</h3>
<p>Adding an index to a table will make filtered <a id="_idIndexMarker974"/>read operations more performant. It would be a reasonable requirement to expect an application to allow users to search for an author by their email address. Adding an index to the <code>email</code> field will make this search faster at the expense of making new record inserts slightly slower. The insert performance hit is small, but if you were to add an index to every single field, it would become noticeable, so pick the fields you want to index carefully.</p>
<p>The process is the same for creating the keys. Refer to <em class="italic">Figure 11</em><em class="italic">.27</em>.</p>
<div><div><img alt="Figure 11.27: Right-click the indexes folder and add the index as shown" src="img/B19644_11_027.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.27: Right-click the indexes folder and add the index as shown</p>
<p>This time, we right-click<a id="_idIndexMarker975"/> the <code>indexes</code> folder and click <strong class="bold">New</strong> | <strong class="bold">Index</strong>. From here, the dialog is familiar, as shown in <em class="italic">Figure 11</em><em class="italic">.28</em>.</p>
<div><div><img alt="Figure 11.28: We’ve added an index to the email field" src="img/B19644_11_028.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.28: We’ve added an index to the email field</p>
<p>At this point, our table code won’t fit in a<a id="_idIndexMarker976"/> screenshot, so here’s what we have:</p>
<pre class="source-code">
create table authors
(
  author_id int auto_increment,
  first_name varchar(30) null,
  last_name varchar(30) null,
  email   varchar(255) not null,
  constraint authors_pk
    primary key (author_id)
);
create unique index authors_email_uindex
  on authors (email);
alter table authors
  add constraint authors_uq
    unique (email);</pre> <p>When you’re happy with your table structure, click <strong class="bold">OK</strong> and PyCharm will apply the DDL code generated to the database. You<a id="_idIndexMarker977"/> can see the results in the data source. Check mine out in <em class="italic">Figure 11</em><em class="italic">.29</em>.</p>
<div><div><img alt="Figure 11.29: The results of our hard work are shown in the data source panel" src="img/B19644_11_029.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.29: The results of our hard work are shown in the data source panel</p>
<h2 id="_idParaDest-280"><a id="_idTextAnchor287"/>Altering existing structures</h2>
<p>I’ve seen a lot of tools over the<a id="_idIndexMarker978"/> years that are good at allowing you to graphically create a database structure, but when it comes to altering existing structures, they fall flat. Microsoft SSMS springs to mind! It will let you merrily design away only to tell you when you try to commit your changes that it can’t do it.</p>
<p>PyCharm’s not like that. PyCharm handles changes the way your company’s DBA wants you to do it. If you’re new to the field, a DBA is in charge of the database. They’re the boss. If you are lucky enough to be granted<a id="_idIndexMarker979"/> the <em class="italic">privilege</em> of creating anything in their database, you will follow their rules. And they want you to alter structures using SQL <code>alter</code> statements.</p>
<p>Right-click the <code>authors</code> table and click <strong class="bold">Modify Table…</strong>, as shown in <em class="italic">Figure 11</em><em class="italic">.30</em>.</p>
<div><div><img alt="Figure 11.30: You can alter existing tables by right-clicking the table" src="img/B19644_11_30.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.30: You can alter existing tables by right-clicking the table</p>
<p>When you do this, you get a window like the one shown in <em class="italic">Figure 11</em><em class="italic">.31</em>.</p>
<div><div><img alt="Figure 11.31: Changes you make here are generated as an alter statement, which is a best practice in database development" src="img/B19644_11_31.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.31: Changes you make here are generated as an alter statement, which is a best practice in database development</p>
<p>In <em class="italic">Figure 11</em><em class="italic">.31</em>, I’ve added a column called <code>date_of_birthd</code> with the type of date. As you can see in the preview window, PyCharm is generating an <code>alter</code> statement rather than trying to drop and<a id="_idIndexMarker980"/> recreate the table as many database editors do. If you wanted to drop the table, there was an option for that in the menu displayed in <em class="italic">Figure 11</em><em class="italic">.30</em>.</p>
<h2 id="_idParaDest-281"><a id="_idTextAnchor288"/>Generating scripts</h2>
<p>PyCharm has a very powerful utility for<a id="_idIndexMarker981"/> generating all kinds of SQL scripts. Since we’re talking about DDL here, it makes sense to learn how to generate the full SQL script that will create the table we’ve been working on.</p>
<p>Right-click the database, as shown in <em class="italic">Figure 11</em><em class="italic">.32</em>, and click the <strong class="bold">SQL Scripts</strong> | <strong class="bold">SQL Generator…</strong> menu item.</p>
<div><div><img alt="Figure 11.32: SQL Generator generates the create script for our database" src="img/B19644_11_32.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.32: SQL Generator generates the create script for our database</p>
<p>The panel on the left allows you to set <a id="_idIndexMarker982"/>a few interesting options. As you click them, the generated SQL will change if applicable. I say <em class="italic">if applicable</em> because not every database platform supports every syntax option in the list. We’re using MySQL, which supports the <code>Use CREATE IF NOT EXISTS</code> syntax but doesn’t support the <code>CREATE OR REPLACE</code> syntax, which you would find in Postgres or Oracle. Clicking a syntax that isn’t supported simply doesn’t change the syntax in the preview window.</p>
<p>When the DDL script meets your needs, you can use the buttons on the far right (circled in <em class="italic">Figure 11</em><em class="italic">.32</em>) to copy, save, or run the script in <a id="_idIndexMarker983"/>a query window.</p>
<h3>Generating a database diagram</h3>
<p>Very traditional database practices typically <a id="_idIndexMarker984"/>entail a design document such as a database schema diagram. In the good old days, we’d use dedicated tools for diagramming. PyCharm has a diagramming tool built in, and the best part is the diagram is generated based on the structure of the database, rather than being drawn from scratch.</p>
<p>To generate a diagram, just right-click your database, find the <strong class="bold">Diagrams</strong> menu item, and pick either option shown in <em class="italic">Figure 11</em><em class="italic">.33</em>.</p>
<div><div><img alt="Figure 11.33: The Diagrams menu items are shown along with a generated diagram" src="img/B19644_11_33.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.33: The Diagrams menu items are shown along with a generated diagram</p>
<p>The only difference between the two options is one draws the diagram directly in the content area of the IDE while the other generates it in a pop-up window. The pop-up window is useful for viewing the diagram on another monitor. You can navigate the diagram with zooming tools, as well as panning around by right-clicking within the diagram while dragging.</p>
<p>You’ll also find export options on the top toolbar for exporting your diagram to image files, as well as data files that can be<a id="_idIndexMarker985"/> imported into dedicated diagramming tools.</p>
<h1 id="_idParaDest-282"><a id="_idTextAnchor289"/>Querying the data source using SQL</h1>
<p>Querying the database is probably the second most useful feature of having database tooling built right into the IDE. As <a id="_idIndexMarker986"/>with many of the features in PyCharm, this one ensures you never need to leave PyCharm to get your work done.</p>
<p>There are several places that<a id="_idIndexMarker987"/> allow you to run queries. You can run ad hoc queries in a query console, or you can run queries directly from <code>.</code><code>sql</code> files.</p>
<h2 id="_idParaDest-283"><a id="_idTextAnchor290"/>Ad hoc queries</h2>
<p>Ad hoc queries are simply queries for an<a id="_idIndexMarker988"/> immediate purpose. An ad hoc query has a number of<a id="_idIndexMarker989"/> characteristics:</p>
<ul>
<li><strong class="bold">Unplanned</strong>: Ad hoc queries are not part of a predefined set of queries. They are written on the spot to address a particular need.</li>
<li><strong class="bold">Temporary</strong>: They are used to retrieve data for a specific task or situation and are not saved for future use. They aren’t part of your application, though after some experimentation and tweaking, you might formalize them in your code.</li>
<li><strong class="bold">No optimization</strong>: Ad hoc queries might not be optimized for efficiency, as they are quickly put together without the time for fine-tuning.</li>
<li><strong class="bold">Variability</strong>: The syntax and structure of ad hoc queries can vary depending on the user’s knowledge and experience.</li>
<li><strong class="bold">Not stored</strong>: Unlike stored procedures or views, ad hoc queries are not stored in the database as with, say, a view or a stored procedure. This means they cannot be called or executed again later unless you save them to a file later.</li>
</ul>
<p>Ad hoc queries are executed in a database console. A console window appears automatically when you complete your connection to the data source, but there are many places in the interface where you can create a new console view. Look at <em class="italic">Figure 11</em><em class="italic">.34</em> and you’ll see the data source window. A button labeled <strong class="bold">QL</strong>, for <strong class="bold">Query Language</strong>, is circled. It doesn’t say <em class="italic">SQL</em> because, remember, PyCharm also supports NoSQL databases, such as <a id="_idIndexMarker990"/>MongoDB, Apache Cassandra, and Redis.</p>
<div><div><img alt="Figure 11.34: Any place you see a QL icon like this you can launch a console window and query your data source using an ad hoc query" src="img/B19644_11_034.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.34: Any place you see a QL icon like this you can launch a console window and query your data source using an ad hoc query</p>
<p>The <strong class="bold">QL</strong> button is sensitive to the database selected in the data source window, so if you have more than one data source, you can open a query source to any of them by selecting them in the data source window and then hitting the <strong class="bold">QL</strong> button. I actually closed the console that was automatically launched when I created the data source. To create a new <a id="_idIndexMarker991"/>console, I’ll hit the <strong class="bold">QL</strong> button and select <strong class="bold">New Console</strong>.</p>
<p>The first console you open becomes the <strong class="bold">default console</strong>. PyCharm keeps track of your consoles in the <strong class="bold">Scratches and Consoles</strong> folder, as shown in <em class="italic">Figure 11</em><em class="italic">.35</em>.</p>
<div><div><img alt="Figure 11.35: PyCharm tracks consoles along with scratch files in a dedicated folder in the IDE" src="img/B19644_11_35.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.35: PyCharm tracks consoles along with scratch files in a dedicated folder in the IDE</p>
<p>If you’ve typed any SQL in the console, PyCharm will keep the contents even between sessions. Empty consoles will disappear when you exit PyCharm. This is handy for keeping track of your ad hoc work.</p>
<h2 id="_idParaDest-284"><a id="_idTextAnchor291"/>Generating SQL statements</h2>
<p>We need to create some seed <a id="_idIndexMarker992"/>records, which will ultimately be saved as a seed script. A seed script is a script that can be used for testing an application by seeding the database with some initial test data. We’re moving away from the strictly DDL statements we’ve used so far. We’re going to be using more DML, which are the statements used to work with data rather than database structure. Seed scripts are also useful for filling in data tables with static data that rarely changes.</p>
<p>We’re going to seed our <code>authors</code> table with a few records, but we’re going to have PyCharm generate a lot of the SQL for us. Begin by creating a console if you don’t have one open already. Right-click the <code>authors</code> table, hover over <strong class="bold">SQL Scripts</strong>, then find <strong class="bold">Insert rows into a table</strong>. Check out <em class="italic">Figure 11</em><em class="italic">.36</em> to see it in action.</p>
<p class="IMG---Figure">s</p>
<div><div><img alt="Figure 11.36: PyCharm will generate DML queries for you automatically!" src="img/B19644_11_36.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.36: PyCharm will generate DML queries for you automatically!</p>
<p>Once you click the option, you’ll find an <code>insert</code> statement has <a id="_idIndexMarker993"/>been inserted (oh yes!) directly into the console. You can see mine in <em class="italic">Figure 11</em><em class="italic">.37</em>.</p>
<div><div><img alt="Figure 11.37: PyCharm generated an insert statement for the table we selected" src="img/B19644_11_037.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.37: PyCharm generated an insert statement for the table we selected</p>
<p>Note the bounding box around the<a id="_idIndexMarker994"/> text. We’ve seen this before. You’re looking at a template! This means we can tab from place to place in the templated text, which is why you shouldn’t mess with the text as I did.</p>
<p class="callout-heading">Copy-paste warning!</p>
<p class="callout">If you have an electronic copy of this book that allows you to copy and paste from the e-book itself, be careful with any code that relies on single quotation marks as the upcoming SQL statement does. The process of editing the book often turns them into special characters that won’t work when you paste them into a console. Make sure the single quotation marks are really single quotation marks!</p>
<p><code>insert</code> statements can be divided into two halves:</p>
<pre class="source-code">
insert into authors (first_name, last_name, email)
values ('Bruce', 'Van Horn', 'bruce@test.com');</pre> <p>The halves I’m talking about are the parts of the statement that aren’t boilerplate – the parts in the two sets of parentheses. The first set specifies which fields you’ll be filling, and the second set is the values. You have to match the order and type of the fields in the first half when you type values for each field. If you hit the <em class="italic">Tab</em> key, you’ll move between the two halves of the <code>insert</code> statement, allowing you to modify it as you see fit.</p>
<p class="callout-heading">Unconventional generated SQL</p>
<p class="callout">PyCharm doesn’t generate SQL keywords in all caps by default, which is the normal convention. You might notice that statements that I type are all caps, but generated ones aren’t. I had to resist the temptation to fix that for the sake of the book, but I also need to explain why there are inconsistencies at play.</p>
<p>PyCharm generated a placeholder for the primary key, which is a field you wouldn’t normally populate since the<a id="_idIndexMarker995"/> database fills that in automatically. Go ahead and take that first field out of the field set in the first parentheses as I did in the preceding code.</p>
<p>Next, tab over to the <code>values</code> section, and begin to fill in values. Remember, in SQL, <code>varchar (string)</code> values must be enclosed in single quotes. Python allows you to use either single or double quotes but SQL does not. As you type values, PyCharm will give you hints about the field you are matching for the value. It does this with a tooltip over the text in the editor, but it also color codes the current field in the top half of the statement. See <em class="italic">Figure 11</em><em class="italic">.38</em> to see what I mean.</p>
<div><div><img alt="Figure 11.38: PyCharm gives tooltips for the field and type you are currently filling in the second half of the query" src="img/B19644_11_038.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.38: PyCharm gives tooltips for the field and type you are currently filling in the second half of the query</p>
<p>This is huge! How many times have you written a long <code>insert</code> statement only to find that you have more values than fields? Or worse, you discover you’ve transposed a few fields and you enter a bunch of garbage data by mistake? PyCharm gives you a visual indicator to make sure you know exactly which field you’re entering by showing you a tooltip with the field and type you are filling in. It also shades the field in the top half of the SQL statement.</p>
<h2 id="_idParaDest-285"><a id="_idTextAnchor292"/>Running the query</h2>
<p>You probably don’t need me to tell you this because, at this point, you’re probably used to seeing green run arrows where it<a id="_idIndexMarker996"/> is appropriate to run something. You can run the contents of the console by clicking the green arrow at the top of the console’s tab in the IDE. You can also highlight a section of the console’s contents and run a portion of the query.</p>
<p>Change the contents of your console to match this code:</p>
<pre class="source-code">
insert into authors (first_name, last_name, email)
values ('Bruce', 'Van Horn', 'bruce@test.com');
insert into authors (first_name, last_name, email)
values ('Kinnari', 'Chohan', 'kinnari@test.com');
insert into authors (first_name, last_name, email)
values ('Prajakta', 'Naik', 'prajakta@test.com');
insert into authors (first_name, last_name, email)
values ('Jubit', 'Pincy', 'jubit@test.com');</pre> <p>All I did was copy the same SQL four times, then I changed the names for a little variety, and to give a shout-out to my Packt crew (holla!). Next, highlight the first statement and run the query. The <strong class="bold">Services</strong> panel will open to show the results of the query. As you can see in <em class="italic">Figure 11</em><em class="italic">.39</em>, only one record was inserted.</p>
<div><div><img alt="Figure 11.39: You can execute single statements by selecting them and clicking the Run button" src="img/B19644_11_039.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.39: You can execute single statements by selecting them and clicking the Run button</p>
<p>If you select the remainder <a id="_idIndexMarker997"/>and run again, you’ll find three insertions.</p>
<p>Now that we have some data, let’s query with a <code>SELECT</code> statement. Add this code to your console:</p>
<pre class="console">
SELECT * FROM authors;</pre> <p>I could have generated <code>select</code>, but this query is short. I wanted to show you how PyCharm displays the results. Take a look at <em class="italic">Figure 11</em><em class="italic">.40</em>.</p>
<div><div><img alt="Figure 11.40: By default, select statements produce a nice, tabular output" src="img/B19644_11_040.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.40: By default, select statements produce a nice, tabular output</p>
<p>This is a dense panel! You can do a lot here. By <a id="_idIndexMarker998"/>default, you see a tabular view of the data (<strong class="bold">1</strong>). You can double-click the cells and edit the data in place. You can also add and delete rows using this UI (<strong class="bold">2</strong>). After you’ve edited the data to your liking, you can submit your changes using the small green up arrow on the toolbar (<strong class="bold">2</strong>) in <em class="italic">Figure 11</em><em class="italic">.40</em>.</p>
<p>If you’d rather change the output view from tabular to either raw text or a tree view (which makes more sense for querying hierarchical data), you can click the eyeball icon in the toolbar (<strong class="bold">2</strong>) in <em class="italic">Figure 11</em><em class="italic">.41</em>.</p>
<h2 id="_idParaDest-286"><a id="_idTextAnchor293"/>Exporting query results</h2>
<p>You can export the results of your <code>select</code> statements <a id="_idIndexMarker999"/>using the export button <em class="italic">Figure 11</em><em class="italic">.41</em>. <em class="italic">Figure 11</em><em class="italic">.41</em> shows what this looks like.</p>
<div><div><img alt="Figure 11.41: Exporting data is easy in PyCharm" src="img/B19644_11_041.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.41: Exporting data is easy in PyCharm</p>
<p>The export format <a id="_idIndexMarker1000"/>defaults to <strong class="bold">comma-separated values</strong> (<strong class="bold">CSV</strong>), which is a common format for tabular data exchange. PyCharm supports <a id="_idIndexMarker1001"/>dozens of other useful formats, which you’ll find in the <strong class="bold">Extractor</strong> drop-down list. Change the output file to something you like, then click the <strong class="bold">Export to </strong><strong class="bold">file</strong> button.</p>
<h2 id="_idParaDest-287"><a id="_idTextAnchor294"/>Working with SQL files</h2>
<p>PyCharm supports <a id="_idIndexMarker1002"/>files with a <code>.sql</code> or <code>.ddl</code> file extension. Like other recognized file types, you’ll get auto-completion, syntax highlighting, and so on. You can also run statements directly in the SQL file just like we can in the console.</p>
<p>Let’s immortalize our console work so far as a proper script. Create a new file in PyCharm called <code>seed.sql</code>. Next, add this line to the top of the script file:</p>
<pre class="source-code">
USE database_fun;
TRUNCATE TABLE authors;</pre> <p>The <code>USE</code> statement is MySQL-specific and ensures you have the <code>database_fun</code> database selected prior to executing the SQL statements. The <code>TRUNCATE</code> statement will delete all the records in the <code>authors</code> table and reset the auto-incrementor sequence on the table back to its initial value. This is useful for development testing since now the seed script can reset to a clean set of testing values. Just be careful to never run the seed script in production!</p>
<p>Next, cut and paste the contents of your console beneath the <code>TRUNCATE</code> statement. Note that I said cut. You want the<a id="_idIndexMarker1003"/> console empty. The script should look like this:</p>
<pre class="source-code">
USE database_fun;
TRUNCATE TABLE authors;
insert into authors (first_name, last_name, email)
values ('Bruce', 'Van Horn', 'bruce@test.com');
insert into authors (first_name, last_name, email)
values ('Kinnari', 'Chohan', 'kinnari@test.com');
insert into authors (first_name, last_name, email)
values ('Prajakta', 'Naik', 'prajakta@test.com');
insert into authors (first_name, last_name, email)
values ('Jubit', 'Pincy', 'jubit@test.com');
SELECT * FROM authors;</pre> <p>Save your seed script and run it. It should execute successfully.</p>
<h1 id="_idParaDest-288"><a id="_idTextAnchor295"/>Summary</h1>
<p>I have this terrible feeling that I haven’t covered everything. That’s because I didn’t. I could write a whole book just on the database features of PyCharm, but if I did, I might as well title it something like <em class="italic">Hands-On Database Programming with DataGrip</em>. Don’t forget, we’re seeing a whole other IDE crammed into the crevices of PyCharm much as we did with WebStorm in <a href="B19644_07.xhtml#_idTextAnchor172"><em class="italic">Chapter 7</em></a>, <em class="italic">Web Development with JavaScript, HTML, and CSS</em>. The feature set is truly staggering and I didn’t cover some of the really interesting features owing to either lack of space in this book or because some of the really cool features are still works in progress.</p>
<p>For example, you can set code as a data source and synchronize the code to the structure of the database. At present, it isn’t 100% complete, which is why I left it out. As a database developer, I would expect to be able to have a round-trip experience where changes to the code are reflected in the database and changes to the database are copied back to the code. I think we’re well on our way.</p>
<p>What we did cover, though, was pretty complete coverage for either full stack web development or a data science practitioner needing to tap multiple database platforms and data storage paradigms.</p>
<p>We started out with a little history. I like covering the history in this and previous chapters because I have the advantage of a long career behind me. I was around for most of what I’m describing, and I had a front-row seat. I was in the first grade when E. F. Codd formalized relational algebra. Part of me wishes I could brag about using his early work, but in truth, I was a bigger fan of watching the Saturday morning TV show <em class="italic">Lassie and the Rescue Rangers</em> in my footy pajamas than I was of <code>SELECT</code> statements. When I was older, I got to work on IBM mainframes, so I did eventually catch up.</p>
<p>Moving into more practical matters, we learned that PyCharm, using separately installed JDBC drivers, can connect to dozens of different database platforms. We learned it supports not only relational databases but NoSQL as well. After we learned how to open the database tools and connect our data source, we learned how to design a database using a host of tools that generate DDL for us.</p>
<p>Then we moved on to using PyCharm to generate the DML that would power our work once we got some data in our tables. Finally, after working in a console to create our initial work, we saved our SQL into a <code>.</code><code>sql</code> file.</p>
<p>The positioning of this chapter in the book is very intentional. I’ve restrained myself from doing a lot of coding in the full stack frameworks we covered in the last few chapters. In real life, you would most assuredly have databases attached to such projects. While many developers rely on ORMs to handle the database work for them, it never hurts to at least be able to examine the database and its contents directly using a console.</p>
<p>If you’re like me, and you forgo ORMs entirely, you now have the missing piece to the puzzle. You can create your database code using a marvelous set of tools without leaving PyCharm.</p>
<p>This chapter also offered a logical split as the next few chapters start coverage of PyCharm Professional’s power data science feature set. It only makes sense to preface that set of chapters with coverage of these most ubiquitous engines for data storage and retrieval.</p>
<p>In the next chapter, we’ll be turning on <em class="italic">science mode</em>! Go pick up your lab coat from the dry cleaners, grab yourself a big cup of C8H10N4O2, and I’ll see you in the next chapter!</p>
<h1 id="_idParaDest-289"><a id="_idTextAnchor296"/>Further reading</h1>
<p>Be sure to check out the companion website for the book at <a href="https://www.pycharm-book.com">https://www.pycharm-book.com</a>.</p>
<ul>
<li>Docker Desktop installation instructions: <a href="https://www.docker.com/products/docker-desktop/">https://www.docker.com/products/docker-desktop/</a>.</li>
<li>Using KeePass in PyCharm: <a href="https://www.jetbrains.com/help/pycharm/reference-ide-settings-password-safe.html">https://www.jetbrains.com/help/pycharm/reference-ide-settings-password-safe.html</a>.</li>
<li>Codd, E. F. (1983). A relational model of data for large shared data banks. <em class="italic">Communications of the ACM</em>, <em class="italic">26</em>(1), 64-69.</li>
<li>Forta, B. (2013). <em class="italic">Sams teach yourself SQL in 10 minutes</em>. Pearson Education.</li>
<li>Hernandez, M. J. (2013). <em class="italic">Database Design for Mere Mortals: A Hands-On Guide to Relational Database Design</em>. Pearson Education.</li>
<li>Pettit, T. and Cossetino, S. (2022). <em class="italic">The MySQL Workshop</em>. Packt Publishing.</li>
<li>Poulton, N. (2023). <em class="italic">Docker Deep Dive – 2nd Edition.</em> Packt Publishing.</li>
<li>Viescas, J. L. and Hernandez, M. J. (2014). <em class="italic">SQL Queries for Mere Mortals: A Hands-On Guide to Data Manipulation in SQL</em>. Pearson Education.</li>
</ul>
</div>


<div><h1 id="_idParaDest-290" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor297"/>Part 4: Data Science with PyCharm</h1>
<p>Similar to the previous part, this part of the book focuses on a specific application of Python programming, this time data analysis and data science. Readers will be able to use PyCharm and its features to efficiently work on their data science and scientific computing projects.</p>
<p>This part has the following chapters:</p>
<ul>
<li><a href="B19644_12.xhtml#_idTextAnchor298"><em class="italic">Chapter 12</em></a>, <em class="italic">Turning on Scientific Mode</em></li>
<li><a href="B19644_13.xhtml#_idTextAnchor318"><em class="italic">Chapter 13</em></a>, <em class="italic">Dynamic Data Viewing with SciView and Jupyter</em></li>
<li><a href="B19644_14.xhtml#_idTextAnchor340"><em class="italic">Chapter 14</em></a>, <em class="italic">Building a Data Pipeline in PyCharm</em></li>
</ul>
</div>
<div><div></div>
</div>
<div><div></div>
</div>
</body></html>