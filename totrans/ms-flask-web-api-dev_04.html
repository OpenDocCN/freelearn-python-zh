<html><head></head><body>
		<div id="_idContainer034">
			<h1 id="_idParaDest-86" class="chapter-number"><a id="_idTextAnchor087"/><st c="0">4</st></h1>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor088"/><st c="2">Utilizing Flask Extensions</st></h1>
			<p><st c="28">Flask is popular due to its extensions, which are installable external or third-party modules or plugins that add support and even enhance some built-in features that may seem redundant to create, such as form handling, session handling, authentication procedures, </st><span class="No-Break"><st c="294">and caching.</st></span></p>
			<p><st c="306">Applying Flask extensions to project development can save time and effort compared to re-creating the same features again. </st><st c="430">Also, these modules can have interdependence with other essential Python and Flask modules without requiring too much configuration, which is convenient for adding new features to the baseline project. </st><st c="632">Despite the positive factors, however, there are also some side effects of installing extensions for our Flask applications, such as having collisions with some installed modules and version problems with the current Flask version, which results in us having to downgrade some Flask extensions or the Flask version itself. </st><st c="955">Version collisions, deprecation, and non-support remain the core concerns when utilizing Flask extensions; therefore, it is advisable to read the documentation of every Flask extension before installing each on </st><span class="No-Break"><st c="1166">the platform.</st></span></p>
			<p><st c="1179">This chapter will showcase the same project components that were created in </st><em class="italic"><st c="1256">Chapters 1</st></em><st c="1266"> to </st><em class="italic"><st c="1270">3</st></em><st c="1271">, including web forms, REST services, backend databases, web sessions, and look-and-feel, but using their respective Flask extension modules. </st><st c="1413">Moreover, this chapter will also show you how to apply caching and integrate mail features into </st><span class="No-Break"><st c="1509">the application.</st></span></p>
			<p><st c="1525">This chapter will cover the </st><span class="No-Break"><st c="1554">following topics:</st></span></p>
			<ul>
				<li><st c="1571">Applying database migration </st><span class="No-Break"><st c="1600">with Flask-Migrate</st></span></li>
				<li><st c="1618">Designing the UI </st><span class="No-Break"><st c="1636">using Bootstrap-Flask</st></span></li>
				<li><st c="1657">Building Flask forms </st><span class="No-Break"><st c="1679">with Flask-WTF</st></span></li>
				<li><st c="1693">Building RESTful services </st><span class="No-Break"><st c="1720">with Flask-RESTful</st></span></li>
				<li><st c="1738">Implementing session handling </st><span class="No-Break"><st c="1769">with Flask-Session</st></span></li>
				<li><st c="1787">Applying caching </st><span class="No-Break"><st c="1805">using Flask-Caching</st></span></li>
				<li><st c="1824">Adding mail features </st><span class="No-Break"><st c="1846">with Flask-Mail</st></span></li>
			</ul>
			<h1 id="_idParaDest-88"><a id="_idTextAnchor089"/><st c="1861">Technical requirements</st></h1>
			<p><st c="1884">This chapter will highlight two prototypes for an </st><em class="italic"><st c="1935">Online Complaint Management System</st></em><st c="1969"> that utilizes different popular Flask 3.0 extensions. </st><st c="2024">These extensions will build the complaint, administration, login, and report modules. </st><st c="2110">The </st><strong class="source-inline"><st c="2114">ch04-web</st></strong><st c="2122"> project will consist of the form-based side, while the </st><strong class="source-inline"><st c="2178">ch04-api</st></strong><st c="2186"> project contains RESTful services to cater to the various complaint details. </st><st c="2264">Both applications will utilize </st><strong class="source-inline"><st c="2295">Blueprints</st></strong><st c="2305"> to organize their directory structure and use </st><em class="italic"><st c="2352">SQLAlchemy</st></em><st c="2362"> to perform CRUD transactions with their PostgreSQL database. </st><st c="2424">All these projects have been uploaded </st><span class="No-Break"><st c="2462">at </st></span><a href="https://github.com/PacktPublishing/Mastering-Flask-Web-Development/tree/main/ch04"><span class="No-Break"><st c="2465">https://github.com/PacktPublishing/Mastering-Flask-Web-Development/tree/main/ch04</st></span></a><span class="No-Break"><st c="2546">.</st></span></p>
			<h1 id="_idParaDest-89"><a id="_idTextAnchor090"/><st c="2547">Applying database migration with Flask-Migrate</st></h1>
			<p><st c="2594">The significant third-party Flask module to use when building an application is a module that will manage the data model layer, and that is the </st><strong class="bold"><st c="2739">Flask-Migrate</st></strong><st c="2752"> extension. </st><st c="2764">Although it is sometimes appropriate to</st><a id="_idIndexMarker201"/><st c="2803"> customize database migration using </st><em class="italic"><st c="2839">Alembic</st></em><st c="2846">, </st><em class="italic"><st c="2848">Flask-Migrate</st></em><st c="2861"> offers easy setup and configuration with less coding </st><a id="_idIndexMarker202"/><st c="2915">and </st><span class="No-Break"><st c="2919">fast results.</st></span></p>
			<p class="callout-heading"><st c="2932">Important note</st></p>
			<p class="callout"><st c="2947">Alembic is a lightweight and fast database migration tool for SQLAlchemy that can be customized to support various </st><span class="No-Break"><st c="3063">database backends.</st></span></p>
			<p><strong class="bold"><st c="3081">Database migration</st></strong><st c="3100"> is a way of deriving </st><a id="_idIndexMarker203"/><st c="3122">and generating the database schema from the Flask model classes and allowing the changes to be monitored and audited in these schemas throughout the application’s lifespan, such as adding and dropping table columns, modifying table constraints, and renaming columns without ruining the current data. </st><st c="3422">All these mechanisms are managed </st><span class="No-Break"><st c="3455">by </st></span><span class="No-Break"><em class="italic"><st c="3458">Flask-Migrate</st></em></span><span class="No-Break"><st c="3471">.</st></span></p>
			<p><st c="3472">Now, let’s understand how to set up a database backend of our application using </st><em class="italic"><st c="3553">Flask-Migrate</st></em><st c="3566"> instead of manually creating the </st><span class="No-Break"><st c="3600">table schemas.</st></span></p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor091"/><st c="3614">Installing Flask-Migrate and Flask-SQLAlchemy</st></h2>
			<p><st c="3660">First, since our applications will utilize </st><em class="italic"><st c="3704">SQLAlchemy</st></em><st c="3714"> as the ORM choice, install </st><strong class="source-inline"><st c="3742">flask-sqlalchemy</st></strong><st c="3758"> through the </st><span class="No-Break"><strong class="source-inline"><st c="3771">pip</st></strong></span><span class="No-Break"><st c="3774"> command:</st></span></p>
			<pre class="console"><st c="3783">
pip install flask-sqlalchemy</st></pre>			<p><st c="3812">Second, enable </st><strong class="source-inline"><st c="3828">SQLAlchemy</st></strong><st c="3838"> by creating the </st><strong class="source-inline"><st c="3855">engine</st></strong><st c="3861">, </st><strong class="source-inline"><st c="3863">db_session</st></strong><st c="3873">, and </st><strong class="source-inline"><st c="3879">Base</st></strong><st c="3883"> classes since our prototypes will utilize</st><a id="_idIndexMarker204"/><st c="3925"> the </st><em class="italic"><st c="3930">declarative approach</st></em><st c="3950"> of database connectivity. </st><st c="3977">This</st><a id="_idIndexMarker205"/><st c="3981"> setup can be found in the </st><strong class="source-inline"><st c="4008">/model/config.py</st></strong><st c="4024"> module of </st><span class="No-Break"><st c="4035">both applications.</st></span></p>
			<p><st c="4053">Now, using the </st><strong class="source-inline"><st c="4069">Base</st></strong><st c="4073"> class, create the model classes, which will become the basis of the database migration. </st><st c="4162">The following code snippets show how to implement model classes using SQLAlchemy’s </st><span class="No-Break"><strong class="source-inline"><st c="4245">Base</st></strong></span><span class="No-Break"><st c="4249"> class:</st></span></p>
			<pre class="source-code"><st c="4256">
class Complaint(</st><strong class="bold"><st c="4273">Base</st></strong><st c="4278">):
   __tablename__ = 'complaint'
   id = Column(Integer, </st><strong class="bold"><st c="4331">Sequence('complaint_id_seq', increment=1)</st></strong><st c="4372">, </st><strong class="bold"><st c="4374">primary_key = True</st></strong><st c="4392">)
   cid = Column(Integer, </st><strong class="bold"><st c="4417">ForeignKey('complainant.id')</st></strong><st c="4445">, nullable = False)
   catid = Column(Integer, </st><strong class="bold"><st c="4489">ForeignKey('category.id')</st></strong><st c="4514">, nullable = False)
   ctype = Column(Integer, </st><strong class="bold"><st c="4558">ForeignKey('complaint_type.id')</st></strong><st c="4589">, nullable = False)
   </st><strong class="bold"><st c="4609">category = relationship('Category', back_populates="complaints")</st></strong><strong class="bold"><st c="4673">complainants = relationship('Complainant', back_populates="complaints")</st></strong>
<strong class="bold"><st c="4745">   complaint_type = relationship('ComplaintType', back_populates="complaints")</st></strong>
<strong class="bold"><st c="4821">   complaint_details = relationship('ComplaintDetails', back_populates="complaint", uselist=False)</st></strong></pre>			<p><st c="4917">The declarative approach uses the </st><strong class="source-inline"><st c="4952">Base</st></strong><st c="4956"> class to create an SQLAlchemy model class that will depict the schema of its corresponding table. </st><st c="5055">For instance, a given </st><strong class="source-inline"><st c="5077">Complaint</st></strong><st c="5086"> class corresponds to the </st><strong class="source-inline"><st c="5112">complaint</st></strong><st c="5121"> table with the </st><strong class="source-inline"><st c="5137">id</st></strong><st c="5139">, </st><strong class="source-inline"><st c="5141">cid</st></strong><st c="5144">, </st><strong class="source-inline"><st c="5146">catid</st></strong><st c="5151">, and </st><strong class="source-inline"><st c="5157">ctype</st></strong><st c="5162"> columns, as defined by the </st><strong class="source-inline"><st c="5190">Column</st></strong><st c="5196"> helper class </st><a id="_idIndexMarker206"/><st c="5210">with the matching column type classes. </st><st c="5249">All column metadata must be </st><a id="_idIndexMarker207"/><st c="5277">correct since </st><em class="italic"><st c="5291">Flask-Migrate</st></em><st c="5304"> will derive the table schema details from this metadata during migration. </st><st c="5379">All column metadata, including the </st><em class="italic"><st c="5414">primary</st></em><st c="5421">, </st><em class="italic"><st c="5423">unique</st></em><st c="5429">, and </st><em class="italic"><st c="5435">foreign key constraints</st></em><st c="5458">, will be part of this database migration. </st><st c="5501">After migration, the following model classes will generate sub-tables for the </st><span class="No-Break"><strong class="source-inline"><st c="5579">complaint</st></strong></span><span class="No-Break"><st c="5588"> table:</st></span></p>
			<pre class="source-code"><st c="5595">
class Category(</st><strong class="bold"><st c="5611">Base</st></strong><st c="5616">):
   __tablename__ = 'category'
   id = Column(Integer, </st><strong class="bold"><st c="5668">Sequence('category_id_seq', increment=1)</st></strong><st c="5708">, </st><strong class="bold"><st c="5710">primary_key = True</st></strong><st c="5728">)
   name = Column(String(45), nullable = False)
   </st><strong class="bold"><st c="5775">complaints = relationship('Complaint', back_populates="category")</st></strong><st c="5840">
   … … … … … …
class ComplaintType(Base):
   __tablename__ = 'complaint_type'
   id = Column(Integer, </st><strong class="bold"><st c="5933">Sequence('complaint_type_id_seq', increment=1)</st></strong><st c="5979">, </st><strong class="bold"><st c="5981">primary_key = True</st></strong><st c="5999">)
   name = Column(String(45), nullable = False)
   </st><strong class="bold"><st c="6046">complaints = relationship('Complaint', back_populates="complaint_type")</st></strong><st c="6117">
    … … … … … …
class ComplaintDetails(</st><strong class="bold"><st c="6152">Base</st></strong><st c="6157">):
   __tablename__ = 'complaint_details'
   id = Column(Integer, </st><strong class="bold"><st c="6218">Sequence('complaint_details_id_seq', increment=1)</st></strong><st c="6267">, </st><strong class="bold"><st c="6269">primary_key = True</st></strong><st c="6287">)
   compid = Column(Integer, </st><strong class="bold"><st c="6315">ForeignKey('complaint.id')</st></strong><st c="6341">, nullable = False, </st><strong class="bold"><st c="6361">unique=True</st></strong><st c="6372">)
   statement = Column(String(100), nullable = False)
   status = Column(String(50))
   resolution = Column(String(100))
   date_resolved = Column(Date)
   </st><strong class="bold"><st c="6515">complaint = relationship('Complaint', back_populates="complaint_details")</st></strong><st c="6588">
   … … … … … …</st></pre>			<p><st c="6599">The </st><strong class="source-inline"><st c="6604">Category</st></strong><st c="6612">, </st><strong class="source-inline"><st c="6614">ComplaintType</st></strong><st c="6627">, and </st><strong class="source-inline"><st c="6633">ComplaintDetails</st></strong><st c="6649"> classes all reference the parent </st><strong class="source-inline"><st c="6683">Complaint</st></strong><st c="6692">, as depicted by </st><a id="_idIndexMarker208"/><st c="6709">their respective </st><span class="No-Break"><strong class="source-inline"><st c="6726">relationship()</st></strong></span><span class="No-Break"><st c="6740"> parameters.</st></span></p>
			<p><st c="6752">With SQLAlchemy set up, install the </st><strong class="source-inline"><st c="6789">flask-migrate</st></strong> <span class="No-Break"><st c="6802">extension module:</st></span></p>
			<pre class="console"><st c="6820">
pip install flask-migrate</st></pre>			<p><st c="6846">Before running the migration commands from the extension module, create a module file (not </st><strong class="source-inline"><st c="6938">main.py</st></strong><st c="6945">) to provide the</st><a id="_idIndexMarker209"/><st c="6962"> necessary helper classes to run the migration commands locally. </st><st c="7027">The following </st><strong class="source-inline"><st c="7041">manage.py</st></strong><st c="7050"> file of our prototypes will run the module’s </st><strong class="source-inline"><st c="7096">install</st></strong><st c="7103">, </st><strong class="source-inline"><st c="7105">manage</st></strong><st c="7111">, and </st><strong class="source-inline"><st c="7117">upgrade</st></strong> <span class="No-Break"><st c="7124">CLI commands:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="7138">from flask_migrate import Migrate</st></strong>
<strong class="bold"><st c="7172">from flask_sqlalchemy import SQLAlchemy</st></strong>
<strong class="bold"><st c="7212">from model.config import Base</st></strong><st c="7242">
from main import app
import toml
app.config.from_file('config-dev.toml', toml.load)
</st><strong class="bold"><st c="7327">db = SQLAlchemy(app, metadata=Base.metadata)</st></strong>
<strong class="bold"><st c="7371">migrate = Migrate(app, db)</st></strong></pre>			<p><st c="7398">If our SQLAlchemy setup uses the usual </st><strong class="source-inline"><st c="7438">flask-sqlalchemy</st></strong><st c="7454"> approach, where the instance of the </st><strong class="source-inline"><st c="7491">SQLAlchemy</st></strong><st c="7501"> class creates the model classes, instantiating the </st><strong class="source-inline"><st c="7553">Migrate</st></strong><st c="7560"> class just involves passing the </st><strong class="source-inline"><st c="7593">app</st></strong><st c="7596"> instance and the SQLAlchemy instance. </st><st c="7635">In this approach, SQLAlchemy is still vital to the migration process, but its explicit instantiation will depend on the </st><strong class="source-inline"><st c="7755">Base.metadata</st></strong><st c="7768"> constructor parameter aside from the </st><strong class="source-inline"><st c="7806">app</st></strong><st c="7809"> instance. </st><st c="7820">The instantiation </st><a id="_idIndexMarker210"/><st c="7838">of the </st><strong class="source-inline"><st c="7845">Migration</st></strong><st c="7854"> class also requires the </st><strong class="source-inline"><st c="7879">app</st></strong><st c="7882"> instance and the derived SQLAlchemy instance, as shown in the given </st><span class="No-Break"><st c="7951">module script.</st></span></p>
			<p><st c="7965">Now, if the migration </st><a id="_idIndexMarker211"/><st c="7988">setup is ready and correct, the </st><strong class="source-inline"><st c="8020">migrate</st></strong><st c="8027"> instance provided by </st><strong class="source-inline"><st c="8049">manage.py</st></strong><st c="8058"> can run the </st><strong class="source-inline"><st c="8071">init</st></strong><st c="8075"> CLI command. </st><st c="8089">This execution will generate the Alembic files needed for the </st><span class="No-Break"><st c="8151">migration process.</st></span></p>
			<h2 id="_idParaDest-91"><a id="_idTextAnchor092"/><st c="8169">Setting up the Alembic configuration</st></h2>
			<p><st c="8206">Flask-Migrate uses Alembic to establish</st><a id="_idIndexMarker212"/><st c="8246"> and manage database migrations. </st><st c="8279">Running the </st><strong class="source-inline"><st c="8291">init</st></strong><st c="8295"> CLI command from the </st><strong class="source-inline"><st c="8317">migrate</st></strong><st c="8324"> instance will generate the Alembic configuration files inside the project directory. </st><st c="8410">The following Python command runs Flask-Migrate’s </st><strong class="source-inline"><st c="8460">init</st></strong><st c="8464"> CLI command using our </st><span class="No-Break"><strong class="source-inline"><st c="8487">manage.py</st></strong></span><span class="No-Break"><st c="8496"> file:</st></span></p>
			<pre class="console"><st c="8502">
python -m flask --app manage.py db init</st></pre>			<p><st c="8542">In the preceding command, </st><strong class="source-inline"><st c="8569">db</st></strong><st c="8571"> specifies the SQLAlchemy </st><strong class="source-inline"><st c="8597">db</st></strong><st c="8599"> instance that’s passed to the </st><strong class="source-inline"><st c="8630">migrate</st></strong><st c="8637"> instance, while </st><strong class="source-inline"><st c="8654">init</st></strong><st c="8658"> is the CLI command that is part of the </st><strong class="source-inline"><st c="8698">flask_migrate</st></strong><st c="8711"> module. </st><st c="8720">Running the preceding command will create logs that list all the folders and files generated by the </st><strong class="source-inline"><st c="8820">init</st></strong><st c="8824"> command, as depicted in </st><span class="No-Break"><em class="italic"><st c="8849">Figure 4</st></em></span><span class="No-Break"><em class="italic"><st c="8857">.1</st></em></span><span class="No-Break"><st c="8859">:</st></span></p>
			<div>
				<div id="_idContainer026" class="IMG---Figure">
					<img src="image/B19383_04_1.jpg" alt="Figure 4.1 – The init CLI command logs"/><st c="8861"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="9611">Figure 4.1 – The init CLI command logs</st></p>
			<p><st c="9649">All the Alembic files are inside the </st><strong class="source-inline"><st c="9687">migrations</st></strong><st c="9697"> folder and are auto-generated by the preceding command. </st><st c="9754">The </st><strong class="source-inline"><st c="9758">migrations</st></strong><st c="9768"> folder contains the main Alembic file, </st><strong class="source-inline"><st c="9808">env.py</st></strong><st c="9814">, which can be tweaked or further configured to support some additional migration requirements. </st><span class="No-Break"><em class="italic"><st c="9910">Figure 4</st></em></span><em class="italic"><st c="9918">.2</st></em><st c="9920"> shows the content of the </st><span class="No-Break"><strong class="source-inline"><st c="9946">migrations</st></strong></span><span class="No-Break"><st c="9956"> folder:</st></span></p>
			<div>
				<div id="_idContainer027" class="IMG---Figure">
					<img src="image/B19383_04_2.jpg" alt="Figure 4.2 – The migrations folder"/><st c="9964"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="10027">Figure 4.2 – The migrations folder</st></p>
			<p><st c="10061">Aside from </st><strong class="source-inline"><st c="10073">env.py</st></strong><st c="10079">, the following files are also included in the </st><span class="No-Break"><strong class="source-inline"><st c="10126">migrations</st></strong></span><span class="No-Break"><st c="10136"> folder:</st></span></p>
			<ul>
				<li><st c="10144">The </st><strong class="source-inline"><st c="10149">alembic.ini</st></strong><st c="10160"> file, which contains the default Alembic </st><span class="No-Break"><st c="10202">configuration variables.</st></span></li>
				<li><st c="10226">The </st><strong class="source-inline"><st c="10231">script.py.mako</st></strong><st c="10245"> file, which serves as the template file for the </st><span class="No-Break"><st c="10294">migration files.</st></span></li>
			</ul>
			<p><st c="10310">There will also be a </st><strong class="source-inline"><st c="10332">versions</st></strong><st c="10340"> folder that will contain </st><a id="_idIndexMarker213"/><st c="10366">the migration scripts after running the </st><span class="No-Break"><strong class="source-inline"><st c="10406">migrate</st></strong></span><span class="No-Break"><st c="10413"> command.</st></span></p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor093"/><st c="10422">Creating the migrations</st></h2>
			<p><st c="10446">After generating the Alembic files, the </st><strong class="source-inline"><st c="10487">migrate</st></strong><st c="10494"> CLI command will be ready to start the </st><em class="italic"><st c="10534">initial migration</st></em><st c="10551">. Running the </st><strong class="source-inline"><st c="10565">migrate</st></strong><st c="10572"> command for</st><a id="_idIndexMarker214"/><st c="10584"> the first time generates all the tables from the ground up based on the SQLAlchemy model classes. </st><st c="10683">The Python command to run the </st><strong class="source-inline"><st c="10713">migrate</st></strong><st c="10720"> CLI command is </st><span class="No-Break"><st c="10736">as follows:</st></span></p>
			<pre class="console"><st c="10747">
python -m flask --app manage.py db migrate -m "Initial"</st></pre>			<p><span class="No-Break"><em class="italic"><st c="10803">Figure 4</st></em></span><em class="italic"><st c="10812">.3</st></em><st c="10814"> shows the log messages after running this </st><span class="No-Break"><st c="10857">initial migration:</st></span></p>
			<div>
				<div id="_idContainer028" class="IMG---Figure">
					<img src="image/B19383_04_3.jpg" alt="Figure 4.3 – The migrate CLI command logs"/><st c="10875"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="11707">Figure 4.3 – The migrate CLI command logs</st></p>
			<p><st c="11748">A successful initial migration will</st><a id="_idIndexMarker215"/><st c="11784"> create an </st><strong class="source-inline"><st c="11795">alembic_version</st></strong><st c="11810"> table in the database. </st><span class="No-Break"><em class="italic"><st c="11834">Figure 4</st></em></span><em class="italic"><st c="11842">.4</st></em><st c="11844"> shows the content of the </st><strong class="source-inline"><st c="11870">ocms</st></strong><st c="11874"> database after the initial </st><span class="No-Break"><st c="11902">database migration:</st></span></p>
			<div>
				<div id="_idContainer029" class="IMG---Figure">
					<img src="image/B19383_04_4.jpg" alt="Figure 4.4 – The alembic_version table"/><st c="11921"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="12131">Figure 4.4 – The alembic_version table</st></p>
			<p><st c="12169">Every execution of the </st><strong class="source-inline"><st c="12193">migrate</st></strong><st c="12200"> command creates a migration script with a filename similar to its assigned unique </st><em class="italic"><st c="12283">version number</st></em><st c="12297">. Flask-Migrate logs these version numbers in the </st><strong class="source-inline"><st c="12347">alembic_version</st></strong><st c="12362"> table and places all migration scripts inside the </st><strong class="source-inline"><st c="12413">migrations</st></strong><st c="12423"> folder under the </st><strong class="source-inline"><st c="12441">/versions</st></strong><st c="12450"> sub-directory. </st><st c="12466">The following is a sample of this </st><span class="No-Break"><st c="12500">migration script:</st></span></p>
			<pre class="source-code"><st c="12517">
"""empty message
Revision ID: 9eafa601a7db
Revises:
Create Date: 2023-06-08 06:51:46.327352
"""
from alembic import op
import sqlalchemy as sa
# revision identifiers, used by Alembic.
</st><strong class="bold"><st c="12702">revision = '9eafa601a7db'</st></strong><st c="12727">
down_revision = None
branch_labels = None
depends_on = None
</st><strong class="bold"><st c="12788">def upgrade():</st></strong><st c="12802">
    # ### commands auto generated by Alembic - please adjust! </st><st c="12861">###
    op.create_table('category',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=45), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('complaint_type',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=45), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
  … … … … … … …</st></pre>			<p><st c="13212">These auto-generated migration scripts sometimes need to be validated, edited, and re-coded because they aren’t always the exact depiction of the SQLAlchemy model classes. </st><st c="13385">Sometimes, these scripts do not </st><a id="_idIndexMarker216"/><st c="13417">capture the required changes in the table relationships and metadata that’s applied to </st><span class="No-Break"><st c="13504">the models.</st></span></p>
			<p><st c="13515">Now, to implement the final migration script, the </st><strong class="source-inline"><st c="13566">upgrade</st></strong><st c="13573"> CLI command needs to </st><span class="No-Break"><st c="13595">be executed.</st></span></p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor094"/><st c="13607">Applying the database changes</st></h2>
			<p><st c="13637">The complete Python command to run </st><a id="_idIndexMarker217"/><st c="13673">the </st><strong class="source-inline"><st c="13677">upgrade</st></strong><st c="13684"> CLI command is </st><span class="No-Break"><st c="13700">as follows:</st></span></p>
			<pre class="console"><st c="13711">
python -m flask --app manage.py db upgrade</st></pre>			<p><span class="No-Break"><em class="italic"><st c="13754">Figure 4</st></em></span><em class="italic"><st c="13763">.6</st></em><st c="13765"> shows the log messages after running the </st><strong class="source-inline"><st c="13807">upgrade</st></strong> <span class="No-Break"><st c="13814">CLI command:</st></span></p>
			<div>
				<div id="_idContainer030" class="IMG---Figure">
					<img src="image/B19383_04_5.jpg" alt="Figure 4.5 – The upgrade CLI command logs"/><st c="13827"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="14141">Figure 4.5 – The upgrade CLI command logs</st></p>
			<p><st c="14182">The initial upgrade execution generates all the tables as defined in the initial migration script. </st><st c="14282">Moreover, the succeeding scripts will always modify the schemas depending on the changes that are applied to the model classes. </st><st c="14410">On the</st><a id="_idIndexMarker218"/><st c="14416"> other hand, </st><strong class="bold"><st c="14429">Flask-Migrate</st></strong><st c="14442"> also has a rollback mechanism that can be implemented by running the </st><strong class="source-inline"><st c="14512">downgrade</st></strong><st c="14521"> CLI command. </st><st c="14535">This command restores the previous version of </st><span class="No-Break"><st c="14581">the database.</st></span></p>
			<p><st c="14594">Database migration in Flask projects will not be straightforward and seamless without Flask-Migrate. </st><st c="14696">Writing the migration setup and processes from scratch will be time-consuming and rigorous to </st><span class="No-Break"><st c="14790">some extent.</st></span></p>
			<p><st c="14802">The next extension that can help the development team save time handling Bootstrap’s static files and importing them into Jinja2 templates </st><span class="No-Break"><st c="14942">is </st></span><span class="No-Break"><em class="italic"><st c="14945">Bootstrap-Flask</st></em></span><span class="No-Break"><st c="14960">.</st></span></p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor095"/><st c="14961">Designing the UI using Bootstrap-Flask</st></h1>
			<p><st c="15000">There are several ways to</st><a id="_idIndexMarker219"/><st c="15026"> render context data with look-and-feel to the Jinja2 templates</st><a id="_idIndexMarker220"/><st c="15089"> without stressing too much about downloading the resources files or referencing the static files from the </st><strong class="bold"><st c="15196">content delivery network</st></strong><st c="15220"> (</st><strong class="bold"><st c="15222">CDN</st></strong><st c="15225">) repository </st><a id="_idIndexMarker221"/><st c="15239">and importing them into the template pages to manage the best UI design for the renditions. </st><st c="15331">One of the most ideal and up-to-date </st><a id="_idIndexMarker222"/><st c="15368">options is </st><strong class="bold"><st c="15379">Bootstrap-Flask</st></strong><st c="15394">, a far different module from the </st><em class="italic"><st c="15428">Flask-Bootstrap</st></em><st c="15443"> extension module. </st><st c="15462">The latter uses only Bootstrap version 3.0, while </st><em class="italic"><st c="15512">Bootstrap-Flask</st></em><st c="15527"> can support up to </st><em class="italic"><st c="15546">Bootstrap 5.0</st></em><st c="15559">. So, it is recommended to uninstall Flask-Bootstrap and other UI-related modules first before setting up Flask-Bootstrap to</st><a id="_idIndexMarker223"/><st c="15683"> avoid unexpected conflicts. </st><st c="15712">Allowing only Bootstrap-Flask to manage the UI designs can provide </st><span class="No-Break"><st c="15779">better results.</st></span></p>
			<p><st c="15794">But first, let’s install </st><em class="italic"><st c="15820">Bootstrap-Flask</st></em><st c="15835"> by running the following </st><span class="No-Break"><strong class="source-inline"><st c="15861">pip</st></strong></span><span class="No-Break"><st c="15864"> command:</st></span></p>
			<pre class="console"><st c="15873">
pip install bootstrap-flask</st></pre>			<p><st c="15901">Next, we’ll set up the Bootstrap module </st><a id="_idIndexMarker224"/><st c="15942">with the desired Bootstrap </st><span class="No-Break"><st c="15969">framework distribution.</st></span></p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor096"/><st c="15992">Setting up the UI module</st></h2>
			<p><st c="16017">For the module to work with the Flask platform, it must be set up in the </st><strong class="source-inline"><st c="16091">main.py</st></strong><st c="16098"> module. </st><st c="16107">The </st><strong class="source-inline"><st c="16111">bootstrap_flask</st></strong><st c="16126"> module has </st><strong class="source-inline"><st c="16138">Bootstrap4</st></strong><st c="16148"> and </st><strong class="source-inline"><st c="16153">Bootstrap5</st></strong><st c="16163"> core classes that must be wired to the Flask instance before we can apply the framework’s assets. </st><st c="16262">An application can only use one </st><a id="_idIndexMarker225"/><st c="16294">Bootstrap distribution: our </st><strong class="source-inline"><st c="16322">ch04-web</st></strong><st c="16330"> application utilizes the </st><strong class="source-inline"><st c="16356">Bootstrap4</st></strong><st c="16366"> class to maintain consistency from </st><a href="B19383_03.xhtml#_idTextAnchor076"><span class="No-Break"><em class="italic"><st c="16402">Chapter 3</st></em></span></a><st c="16411">’s Bootstrap preference. </st><st c="16437">The following </st><strong class="source-inline"><st c="16451">main.py</st></strong><st c="16458"> module instantiates </st><strong class="source-inline"><st c="16479">Bootstrap4</st></strong><st c="16489">, which enables the </st><span class="No-Break"><st c="16509">extension module:</st></span></p>
			<pre class="source-code"><st c="16526">
from flask import Flask
</st><strong class="bold"><st c="16551">from flask_bootstrap import Bootstrap4</st></strong><st c="16589">
import toml
from model.config import init_db
init_db()
app = Flask(__name__, template_folder='pages', static_folder="resources")
app.config.from_file('config-dev.toml', toml.load)
</st><strong class="bold"><st c="16770">bootstrap = Bootstrap4(app)</st></strong></pre>			<p><st c="16797">The </st><strong class="source-inline"><st c="16802">Bootstrap4</st></strong><st c="16812"> class requires the </st><strong class="source-inline"><st c="16832">app</st></strong><st c="16835"> instance as its constructor argument to proceed with the instantiation. </st><st c="16908">After this setup, the Jinja2</st><a id="_idIndexMarker226"/><st c="16936"> templates can now load the necessary built-in resource files and start the web </st><span class="No-Break"><st c="17016">design process.</st></span></p>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor097"/><st c="17031">Applying the Bootstrap files and assets</st></h2>
			<p><st c="17071">Bootstrap-Flask has a </st><strong class="source-inline"><st c="17094">bootstrap.load_css()</st></strong><st c="17114"> helper function that loads the CSS resources into the Jinja2 template and a </st><strong class="source-inline"><st c="17191">bootstrap.load_js()</st></strong><st c="17210"> helper function that loads all Bootstrap</st><a id="_idIndexMarker227"/><st c="17251"> JavaScript files. </st><st c="17270">The following is the </st><strong class="source-inline"><st c="17291">login.html</st></strong><st c="17301"> template of the </st><strong class="source-inline"><st c="17318">ch04-web</st></strong><st c="17326"> application with the preceding two </st><span class="No-Break"><st c="17362">helper functions:</st></span></p>
			<pre class="source-code"><st c="17379">
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;meta http-equiv="x-ua-compatible" content="ie=edge" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;
    &lt;title&gt;Online Complaint Management System&lt;/title&gt;
    </st><strong class="bold"><st c="17622">{{ bootstrap.load_css() }}</st></strong><st c="17648">
  &lt;/head&gt;
  &lt;body&gt;
      … … … … … …
    </st><strong class="bold"><st c="17675">{{ bootstrap.load_js() }}</st></strong><st c="17700">
&lt;/body&gt;
&lt;/html&gt;</st></pre>			<p><st c="17716">It is always the standard to call </st><strong class="source-inline"><st c="17751">bootstrap.load_css()</st></strong><st c="17771"> in </st><strong class="source-inline"><st c="17775">&lt;head&gt;</st></strong><st c="17781">, which is the appropriate markup to call the </st><strong class="source-inline"><st c="17827">&lt;style&gt;</st></strong><st c="17834"> tag. </st><st c="17840">Calling </st><strong class="source-inline"><st c="17848">bootstrap.load_js()</st></strong><st c="17867"> in </st><strong class="source-inline"><st c="17871">&lt;head&gt;</st></strong><st c="17877"> is also feasible, but for many, the custom is to load all the JavaScript files in the last part of the </st><strong class="source-inline"><st c="17981">&lt;body&gt;</st></strong><st c="17987"> content, which is why </st><strong class="source-inline"><st c="18010">bootstrap.load_css()</st></strong><st c="18030"> is present there. </st><st c="18049">On the other hand, if there are custom </st><strong class="source-inline"><st c="18088">styles.css</st></strong><st c="18098"> or JavaScript files for the applications, the module can allow their imports in the Jinja2 templates, so long as there are no conflicts with the </st><span class="No-Break"><st c="18244">Bootstrap resources.</st></span></p>
			<p><st c="18264">After loading the CSS and </st><a id="_idIndexMarker228"/><st c="18291">JavaScript, we can start designing the pages with the Bootstrap components. </st><st c="18367">The following code shows the content of the given </st><strong class="source-inline"><st c="18417">login.html</st></strong><st c="18427"> page with all the needed </st><em class="italic"><st c="18453">Bootstrap </st></em><span class="No-Break"><em class="italic"><st c="18463">4</st></em></span><span class="No-Break"><st c="18464"> components:</st></span></p>
			<pre class="source-code"><st c="18476">
&lt;body&gt;
    &lt;section class="</st><strong class="bold"><st c="18500">position-relative py-4 py-xl-5</st></strong><st c="18531">"&gt;
        &lt;div class="</st><strong class="bold"><st c="18547">container position-relative</st></strong><st c="18575">"&gt;
            &lt;div class="</st><strong class="bold"><st c="18591">row mb-5</st></strong><st c="18600">"&gt;
                &lt;div class="</st><strong class="bold"><st c="18616">col-md-8 col-xl-6 text-center</st></strong> <strong class="bold"><st c="18646">mx-auto</st></strong><st c="18654">"&gt;
                    &lt;h2 class="</st><strong class="bold"><st c="18669">display-3</st></strong><st c="18679">"&gt;User Login&lt;/h2&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="</st><strong class="bold"><st c="18724">row d-flex justify-content-center</st></strong><st c="18758">"&gt;
                &lt;div class="</st><strong class="bold"><st c="18774">col-md-6 col-xl-4</st></strong><st c="18792">"&gt;
                    &lt;div class="</st><strong class="bold"><st c="18808">card</st></strong><st c="18813">"&gt;
                        &lt;div class="</st><strong class="bold"><st c="18829">card-body text-center</st></strong> <strong class="bold"><st c="18851">d-flex flex-column align-items-center</st></strong><st c="18889">"&gt;
                         &lt;form action="{{ request.path }}" method = "post"&gt;
                               … … … … … …
                         &lt;/form&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/section&gt;
   … … … … … …
&lt;/body&gt;</st></pre>			<p><span class="No-Break"><em class="italic"><st c="19029">Figure 4</st></em></span><em class="italic"><st c="19038">.6</st></em><st c="19040"> shows the </st><a id="_idIndexMarker229"/><st c="19051">published version of the given </st><strong class="source-inline"><st c="19082">login.html</st></strong> <span class="No-Break"><st c="19092">web design:</st></span></p>
			<div>
				<div id="_idContainer031" class="IMG---Figure">
					<img src="image/B19383_04_6.jpg" alt="Figure 4.6 – The login.html page using Bootstrap 4"/><st c="19104"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="19143">Figure 4.6 – The login.html page using Bootstrap 4</st></p>
			<p><st c="19193">Aside from the updated Bootstrap support, the Bootstrap-Flask module has macros and built-in configurations that applications can use to create a better </st><span class="No-Break"><st c="19347">UI design.</st></span></p>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor098"/><st c="19357">Utilizing built-in features</st></h2>
			<p><st c="19385">The extension module</st><a id="_idIndexMarker230"/><st c="19406"> has five built-in </st><em class="italic"><st c="19425">macros</st></em><st c="19431"> that Jinja2 templates can import to create fewer HTML codes and manageable components. </st><st c="19519">These built-in macros are </st><span class="No-Break"><st c="19545">as follows:</st></span></p>
			<ul>
				<li><strong class="source-inline"><st c="19556">bootstrap4/form.html</st></strong><st c="19577">: This can render </st><em class="italic"><st c="19596">Flask-WTF</st></em><st c="19605"> forms or form components and their hidden </st><span class="No-Break"><st c="19648">error messages.</st></span></li>
				<li><strong class="source-inline"><st c="19663">bootstrap4/nav.html</st></strong><st c="19683">: This can render navigations </st><span class="No-Break"><st c="19714">and breadcrumbs.</st></span></li>
				<li><strong class="source-inline"><st c="19730">bootstrap4/pagination.html</st></strong><st c="19757">: This can provide paginations to </st><span class="No-Break"><em class="italic"><st c="19792">Flask-SQLAlchemy</st></em></span><span class="No-Break"><st c="19808"> data.</st></span></li>
				<li><strong class="source-inline"><st c="19814">bootstrap4/table.html</st></strong><st c="19836">: This can render table-formatted </st><span class="No-Break"><st c="19871">context data.</st></span></li>
				<li><strong class="source-inline"><st c="19884">bootstrap4/utils.html</st></strong><st c="19906">: This can provide other utilities, such as rendering flash messages, icons, and resource </st><span class="No-Break"><st c="19997">reference code.</st></span></li>
			</ul>
			<p><st c="20012">The module also has built-in </st><em class="italic"><st c="20042">configuration variables</st></em><st c="20065"> to enable and disable some features and customize Bootstrap components. </st><st c="20138">For instance, </st><strong class="source-inline"><st c="20152">BOOTSTRAP_SERVE_LOCAL</st></strong><st c="20173"> disables the process of loading built-in CSS and JavaScript when set to </st><strong class="source-inline"><st c="20246">false</st></strong><st c="20251"> and allows us to refer to CDN or local resources in </st><strong class="source-inline"><st c="20304">/static</st></strong><st c="20311"> instead. </st><st c="20321">In addition, </st><strong class="source-inline"><st c="20334">BOOTSTRAP_BTN_SIZE</st></strong><st c="20352"> and </st><strong class="source-inline"><st c="20357">BOOTSTRAP_BTN_STYLE</st></strong><st c="20376"> can</st><a id="_idIndexMarker231"/><st c="20380"> customize buttons. </st><st c="20400">The </st><strong class="bold"><st c="20404">TOML</st></strong><st c="20408"> or any configuration file is where all these </st><a id="_idIndexMarker232"/><st c="20454">configuration variables are registered </st><span class="No-Break"><st c="20493">and set.</st></span></p>
			<p><st c="20501">Next, we’ll focus on </st><em class="italic"><st c="20523">Flask-WTF</st></em><st c="20532">, a module supported </st><span class="No-Break"><st c="20553">by </st></span><span class="No-Break"><em class="italic"><st c="20556">Bootstrap-Flask</st></em></span><span class="No-Break"><st c="20571">.</st></span></p>
			<h1 id="_idParaDest-98"><a id="_idTextAnchor099"/><st c="20572">Building Flask forms with Flask-WTF</st></h1>
			<p><strong class="bold"><st c="20608">Flask-WTF</st></strong><st c="20618"> is a flexible Flask extension module that uses classes to create forms, form fields, validations, and form</st><a id="_idIndexMarker233"/><st c="20725"> renditions. </st><st c="20738">It uses the </st><strong class="source-inline"><st c="20750">WTForms</st></strong><st c="20757"> library to enhance form handling in Flask applications. </st><st c="20814">Instead of using HTML markup, Flask-WTF provides </st><a id="_idIndexMarker234"/><st c="20863">the necessary utilities</st><a id="_idIndexMarker235"/><st c="20886"> to manage the web forms in a Pythonic way through </st><span class="No-Break"><st c="20937">form models.</st></span></p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor100"/><st c="20949">Creating the form models</st></h2>
			<p><st c="20974">Form models must extend the </st><strong class="source-inline"><st c="21003">FlaskForm</st></strong><st c="21012"> core class to create and render the </st><strong class="source-inline"><st c="21049">&lt;form&gt;</st></strong><st c="21055"> tag. </st><st c="21061">Its attributes </st><a id="_idIndexMarker236"/><st c="21076">correspond to the form fields defined by the following </st><span class="No-Break"><st c="21131">helper classes:</st></span></p>
			<ul>
				<li><strong class="source-inline"><st c="21146">StringField</st></strong><st c="21158">: Defines and creates a text input field that accepts </st><span class="No-Break"><st c="21213">string-typed data.</st></span></li>
				<li><strong class="source-inline"><st c="21231">IntegerField</st></strong><st c="21244">: Defines and creates a text input field that </st><span class="No-Break"><st c="21291">accepts integers.</st></span></li>
				<li><strong class="source-inline"><st c="21308">DecimalField</st></strong><st c="21321">: Defines and creates a text input field that asks for </st><span class="No-Break"><st c="21377">decimal values.</st></span></li>
				<li><strong class="source-inline"><st c="21392">DateField</st></strong><st c="21402">: Defines and creates a text input field that supports </st><strong class="source-inline"><st c="21458">Date</st></strong><st c="21462"> types with the default format </st><span class="No-Break"><st c="21493">of </st></span><span class="No-Break"><strong class="source-inline"><st c="21496">yyyy-mm-dd</st></strong></span><span class="No-Break"><st c="21506">.</st></span></li>
				<li><strong class="source-inline"><st c="21507">EmailField</st></strong><st c="21518">: Defines and creates a text input that uses a regular expression to manage </st><span class="No-Break"><st c="21595">email-formatted </st></span><span class="No-Break"><a id="_idIndexMarker237"/></span><span class="No-Break"><st c="21611">values.</st></span></li>
				<li><strong class="source-inline"><st c="21618">SelectField</st></strong><st c="21630">: Defines and creates a </st><span class="No-Break"><st c="21655">combo box.</st></span></li>
				<li><strong class="source-inline"><st c="21665">SelectMultipleField</st></strong><st c="21685">: Defines and creates a combo box with a list </st><span class="No-Break"><st c="21732">of options.</st></span></li>
				<li><strong class="source-inline"><st c="21743">TextAreaField</st></strong><st c="21757">: Defines a text area for multi-line </st><span class="No-Break"><st c="21795">text input.</st></span></li>
				<li><strong class="source-inline"><st c="21806">FileField</st></strong><st c="21816">: Defines and creates a file upload field for </st><span class="No-Break"><st c="21863">uploading files.</st></span></li>
				<li><strong class="source-inline"><st c="21879">PasswordField</st></strong><st c="21893">: Defines a password </st><span class="No-Break"><st c="21915">input field.</st></span></li>
			</ul>
			<p><st c="21927">The following code shows a form model that utilizes the given helper classes to build the </st><strong class="source-inline"><st c="22018">Complainant</st></strong><st c="22029"> form </st><em class="italic"><st c="22035">widgets</st></em><st c="22042"> for the </st><span class="No-Break"><strong class="source-inline"><st c="22051">add_complainant()</st></strong></span><span class="No-Break"><st c="22068"> view:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="22074">from flask_wtf import FlaskForm</st></strong>
<strong class="bold"><st c="22106">from wtforms import StringField, IntegerField, SelectField, DateField, EmailField</st></strong>
<strong class="bold"><st c="22188">from wtforms.validators import InputRequired, Length, Regexp, Email</st></strong><st c="22256">
class ComplainantForm(</st><strong class="bold"><st c="22279">FlaskForm</st></strong><st c="22289">):
    id = </st><strong class="bold"><st c="22298">SelectField</st></strong><st c="22309">('Choose Login ID: ', validators=[InputRequired()])
    firstname = </st><strong class="bold"><st c="22374">StringField</st></strong><st c="22385">('Enter firstname:', validators=[InputRequired(), Length(max=50)])
    middlename = </st><strong class="bold"><st c="22466">StringField</st></strong><st c="22477">('Enter middlename:', validators=[InputRequired(), Length(max=50)])
    lastname = </st><strong class="bold"><st c="22557">StringField</st></strong><st c="22568">('Enter lastname:', validators=[InputRequired(), Length(max=50)])
    email = </st><strong class="bold"><st c="22643">EmailField</st></strong><st c="22653">('Enter email:', validators=[InputRequired(), Length(max=20), Email()])
    mobile = </st><strong class="bold"><st c="22735">StringField</st></strong><st c="22746">('Enter mobile:', validators=[InputRequired(), Length(max=20), Regexp(regex=r"^(\+63)[-]{1}\d{3}
                [-]{1}\d{3}[-]{1}\d{4}$", message="Valid phone number format is +63-xxx-xxx-xxxx")])
    address = </st><strong class="bold"><st c="22939">StringField</st></strong><st c="22950">('Enter address:', validators=[InputRequired(), Length(max=100)])
    zipcode = </st><strong class="bold"><st c="23027">IntegerField</st></strong><st c="23039">('Enter zip code:',  validators=[InputRequired()])
    status = </st><strong class="bold"><st c="23099">SelectField</st></strong><st c="23110">('Enter status:', choices=[('active', 'ACTIVE'),
          ('inactive','INACTIVE'), ('blocked','BLOCKED')], validators=[InputRequired()])
    date_registered = </st><strong class="bold"><st c="23257">DateField</st></strong><st c="23266">('Enter date registered', </st><strong class="bold"><st c="23293">format='%Y-%m-%d'</st></strong><st c="23310">, validators=[InputRequired()])</st></pre>			<p><st c="23341">Here, </st><strong class="source-inline"><st c="23348">firstname</st></strong><st c="23357">, </st><strong class="source-inline"><st c="23359">middlename</st></strong><st c="23369">, </st><strong class="source-inline"><st c="23371">lastname</st></strong><st c="23379">, and </st><strong class="source-inline"><st c="23385">address</st></strong><st c="23392"> are input-type text boxes with varying lengths and are required form parameters. </st><st c="23474">For specific input types, </st><strong class="source-inline"><st c="23500">date_registered</st></strong><st c="23515"> is a required form parameter of the </st><strong class="source-inline"><st c="23552">Date</st></strong><st c="23556"> type with a date format of </st><strong class="source-inline"><st c="23584">yyyy-mm-dd</st></strong><st c="23594">, while </st><strong class="source-inline"><st c="23602">email</st></strong><st c="23607"> is an email-type text box. </st><st c="23635">On the other hand, the </st><strong class="source-inline"><st c="23658">status</st></strong><st c="23664"> and </st><strong class="source-inline"><st c="23669">id</st></strong><st c="23671"> form parameters are combo boxes, but the difference is the absence of options in </st><strong class="source-inline"><st c="23753">id</st></strong><st c="23755">. The </st><strong class="source-inline"><st c="23761">status</st></strong><st c="23767"> form parameter has its </st><strong class="source-inline"><st c="23791">choices</st></strong><st c="23798"> options already defined in the form, while in the </st><strong class="source-inline"><st c="23849">id</st></strong><st c="23851"> form </st><a id="_idIndexMarker238"/><st c="23857">parameter, the view function will populate these fields at runtime. </st><st c="23925">The following is a snippet of the </st><strong class="source-inline"><st c="23959">add_complainant()</st></strong><st c="23976"> view that manages the </st><strong class="source-inline"><st c="23999">id</st></strong> <span class="No-Break"><st c="24001">parameter’s </st></span><span class="No-Break"><a id="_idIndexMarker239"/></span><span class="No-Break"><st c="24014">options:</st></span></p>
			<pre class="source-code"><st c="24022">
@complainant_bp.route('/complainant/add', methods=['GET', 'POST'])
def add_complainant():
    </st><strong class="bold"><st c="24113">form:ComplainantForm = ComplainantForm()</st></strong><st c="24153">
    login_repo = LoginRepository(db_session)
    users = login_repo.select_all()
    </st><strong class="bold"><st c="24227">form.id.choices = [(f"{u.id}", f"{u.username}") for u</st></strong> <strong class="bold"><st c="24280">in users]</st></strong><strong class="bold"><st c="24290">if request.method == 'GET':</st></strong><strong class="bold"><st c="24318">return render_template('complainant_add.html',</st></strong> <strong class="bold"><st c="24365">form=form), 200</st></strong><strong class="bold"><st c="24381">else:</st></strong><strong class="bold"><st c="24387">if form.validate_on_submit():</st></strong><strong class="bold"><st c="24417">details = dict()</st></strong><strong class="bold"><st c="24434">details["id"] = int(form.id.data)</st></strong><strong class="bold"><st c="24468">details["firstname"] = form.firstname.data</st></strong><strong class="bold"><st c="24511">details["lastname"]  = form.lastname.data</st></strong><st c="24552">
            … … … … … …
            </st><strong class="bold"><st c="24564">complainant:Complainant =</st></strong> <strong class="bold"><st c="24589">Complainant(**details)</st></strong><strong class="bold"><st c="24612">complainant_repo:ComplainantRepository =</st></strong> <strong class="bold"><st c="24653">ComplainantRepository(db_session)</st></strong><strong class="bold"><st c="24687">result = complainant_repo.insert(complainant)</st></strong><st c="24733">
            if result:
                records = complainant_repo.select_all()
                return render_template( 'complainant_list_all.html', records=records), 200
            </st><strong class="bold"><st c="24860">else:</st></strong><strong class="bold"><st c="24865">return render_template('complainant_add.html',</st></strong><strong class="bold"><st c="24912">form=form), 500</st></strong><st c="24928">
        else:
            return render_template('complainant_add.html', form=form), 500</st></pre>			<p><st c="24997">The preceding view accesses the </st><strong class="source-inline"><st c="25030">choices</st></strong><st c="25037"> parameter of the </st><strong class="source-inline"><st c="25055">id</st></strong><st c="25057"> form parameter to assign it with a list of </st><strong class="source-inline"><st c="25101">(id, username) Tuple</st></strong><st c="25121">, with </st><strong class="source-inline"><st c="25128">username</st></strong><st c="25136"> as the label and </st><strong class="source-inline"><st c="25154">id</st></strong><st c="25156"> as </st><span class="No-Break"><st c="25160">its value.</st></span></p>
			<p><st c="25170">On the other hand, the HTTP POST transaction of the </st><strong class="source-inline"><st c="25223">add_complainant()</st></strong><st c="25240"> view will verify form validation errors after submission through the </st><strong class="source-inline"><st c="25310">form</st></strong><st c="25314"> parameter’s </st><strong class="source-inline"><st c="25327">validate_on_submit()</st></strong><st c="25347">. If there is none, the view function will extract all form data from the </st><strong class="source-inline"><st c="25421">form</st></strong><st c="25425"> object, insert the</st><a id="_idIndexMarker240"/><st c="25444"> complaint details into the database, and render a list of all complainants. </st><st c="25521">Otherwise, it will return the form page with the submitted </st><strong class="source-inline"><st c="25580">ComplainantForm</st></strong><st c="25595"> instance with form data values. </st><st c="25628">Now that we’ve implemented the form models and the view functions that manage them, we can focus on how to map these models to their respective </st><strong class="source-inline"><st c="25772">&lt;form&gt;</st></strong><st c="25778"> tags using </st><span class="No-Break"><st c="25790">Jinja2 templates.</st></span></p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor101"/><st c="25807">Rendering the forms</st></h2>
			<p><st c="25827">Before returning the WTF form model to the Jinja2 template, the view function must access and instantiate the FlaskForm sub-class, and even populate some fields with values in preparation for the </st><strong class="source-inline"><st c="26024">&lt;form&gt;</st></strong><st c="26030"> mapping. </st><st c="26040">Assigning the model form with the appropriate values can avoid Jinja2 errors during </st><strong class="source-inline"><st c="26124">&lt;</st></strong><span class="No-Break"><strong class="source-inline"><st c="26125">form&gt;</st></strong></span><span class="No-Break"><st c="26130"> loading.</st></span></p>
			<p><st c="26139">Now, the form rendition happens </st><a id="_idIndexMarker241"/><st c="26172">only when there is an </st><em class="italic"><st c="26194">HTTP GET</st></em><st c="26202"> request for form loading or when an HTTP POST encounters validation errors during submission, requiring the form page that’s showing the current values and the error status to be reloaded. </st><st c="26392">The type of HTTP request determines what values to assign to the form model’s fields before rendering the form. </st><st c="26504">Thus, in the given </st><strong class="source-inline"><st c="26523">add_complainant()</st></strong><st c="26540"> view, checking if </st><strong class="source-inline"><st c="26559">request.method</st></strong><st c="26573"> is a </st><em class="italic"><st c="26579">GET</st></em><st c="26582"> request means verifying when to render the </st><strong class="source-inline"><st c="26626">complainant_add.html</st></strong><st c="26646"> form template with the </st><strong class="source-inline"><st c="26670">ComplainantForm</st></strong><st c="26685"> instance with base or initialized values. </st><st c="26728">Otherwise, it will be a rendition of a</st><a id="_idIndexMarker242"/><st c="26766"> form page with the current form values and </st><span class="No-Break"><st c="26810">validation errors.</st></span></p>
			<p><st c="26828">The following </st><strong class="source-inline"><st c="26843">complainant_add.html</st></strong><st c="26863"> page maps the </st><strong class="source-inline"><st c="26878">ComplainantForm</st></strong><st c="26893"> fields, with base or current values, to the </st><strong class="source-inline"><st c="26938">&lt;</st></strong><span class="No-Break"><strong class="source-inline"><st c="26939">form&gt;</st></strong></span><span class="No-Break"><st c="26944"> tag:</st></span></p>
			<pre class="source-code"><st c="26949">
&lt;form action = "{{ request.path }}" method = "post"&gt;
        </st><strong class="bold"><st c="27003">{{ form.csrf_token }}</st></strong><st c="27024">
  &lt;div class="mb-3"&gt;{{ </st><strong class="bold"><st c="27046">form.id</st></strong><st c="27053">(</st><strong class="bold"><st c="27055">size</st></strong><st c="27059">=1, </st><strong class="bold"><st c="27064">class</st></strong><st c="27069">="form-control") }}&lt;/div&gt;
  &lt;div class="mb-3"&gt; {{ </st><strong class="bold"><st c="27118">form.firstname</st></strong><st c="27132">(</st><strong class="bold"><st c="27134">size</st></strong><st c="27138">=50, </st><strong class="bold"><st c="27144">placeholder</st></strong><st c="27155">='Firstname', </st><strong class="bold"><st c="27170">class</st></strong><st c="27175">="form-control") }}
  &lt;/div&gt;
        </st><strong class="bold"><st c="27203">{% if form.firstname.errors %}</st></strong><strong class="bold"><st c="27233">&lt;ul&gt;</st></strong><strong class="bold"><st c="27238">{% for error in form.username.errors %}</st></strong><strong class="bold"><st c="27278">&lt;li&gt;{{ error }}&lt;/li&gt;</st></strong><strong class="bold"><st c="27299">{% endfor %}</st></strong><strong class="bold"><st c="27312">&lt;/ul&gt;</st></strong><strong class="bold"><st c="27318">{% endif %}</st></strong><st c="27330">
  … … … … … …
  &lt;div class="mb-3"&gt; {{ </st><strong class="bold"><st c="27364">form.mobile</st></strong><st c="27375">(</st><strong class="bold"><st c="27377">size</st></strong><st c="27381">=50, </st><strong class="bold"><st c="27387">placeholder</st></strong><st c="27398">='+63-XXX-XXX-XXXX', </st><strong class="bold"><st c="27420">class</st></strong><st c="27425">="form-control") }}
  &lt;/div&gt;
  … … … … … …
  &lt;div class="mb-3"&gt; {{ </st><strong class="bold"><st c="27487">form.email</st></strong><st c="27497">(</st><strong class="bold"><st c="27499">size</st></strong><st c="27503">=50,</st><strong class="bold"><st c="27508">placeholder</st></strong><st c="27520">='xxxxxxx@xxxx.xxx', </st><strong class="bold"><st c="27542">class</st></strong><st c="27547">="form-control") }}
  &lt;/div&gt;
  … … … … … …
   &lt;div class="mb-3"&gt; {{ </st><strong class="bold"><st c="27609">form.zipcode</st></strong><st c="27621">(</st><strong class="bold"><st c="27623">size</st></strong><st c="27627">=50, </st><strong class="bold"><st c="27633">placeholder</st></strong><st c="27644">='Zip Code', </st><strong class="bold"><st c="27658">class</st></strong><st c="27663">="form-control") }}
   &lt;/div&gt;
   … … … … … …
&lt;/form&gt;</st></pre>			<p><st c="27710">Binding the individual model field to </st><strong class="source-inline"><st c="27749">&lt;form&gt;</st></strong><st c="27755"> requires calling the property of the field – for example, </st><strong class="source-inline"><st c="27814">context_name.field()</st></strong><st c="27834">. So, to render the </st><strong class="source-inline"><st c="27854">firstname</st></strong><st c="27863"> form field of </st><strong class="source-inline"><st c="27878">ComplainantForm</st></strong><st c="27893">, for instance, the Jinja2 template must call </st><strong class="source-inline"><st c="27939">form.firstname()</st></strong><st c="27955"> inside the </st><strong class="source-inline"><st c="27967">{{}}</st></strong><st c="27971"> statement. </st><st c="27983">The method call can also include its </st><strong class="source-inline"><st c="28020">kwargs</st></strong><st c="28026"> or </st><em class="italic"><st c="28030">keyword arguments</st></em><st c="28047"> of widget </st><a id="_idIndexMarker243"/><st c="28058">properties, such as </st><strong class="source-inline"><st c="28078">size</st></strong><st c="28082">, </st><strong class="source-inline"><st c="28084">placeholder</st></strong><st c="28095">, and </st><strong class="source-inline"><st c="28101">class</st></strong><st c="28106">, if there is a change in the default widget settings during the rendition. </st><st c="28182">As shown in the template, the </st><em class="italic"><st c="28212">Flask-WTF</st></em><st c="28221"> widgets support the Bootstrap components provided by the </st><em class="italic"><st c="28279">Bootstrap-Flask</st></em><st c="28294"> module extension. </st><st c="28313">Adding custom CSS styles is also feasible with widgets, so long the CSS properties are set in the </st><span class="No-Break"><st c="28411">widget’s </st></span><span class="No-Break"><strong class="source-inline"><st c="28420">kwargs</st></strong></span><span class="No-Break"><st c="28426">.</st></span></p>
			<p><st c="28427">Now, let’s explore if Flask can secure</st><a id="_idIndexMarker244"/><st c="28466"> form transactions from </st><strong class="bold"><st c="28490">cross-site request forgery</st></strong><st c="28516"> (</st><strong class="bold"><st c="28518">CSRF</st></strong><st c="28522">) problems like in </st><span class="No-Break"><st c="28542">Django’s forms.</st></span></p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor102"/><st c="28557">Applying CSRF</st></h2>
			<p><st c="28571">Flask-WTF has built-in CSRF</st><a id="_idIndexMarker245"/><st c="28599"> support through its </st><strong class="source-inline"><st c="28620">csrf_token</st></strong><st c="28630"> generation. </st><st c="28643">To </st><a id="_idIndexMarker246"/><st c="28646">enable CSRF through Flask-WTF, instantiate </st><strong class="source-inline"><st c="28689">CSRFProtect</st></strong><st c="28700"> from the </st><strong class="source-inline"><st c="28710">flask_wtf</st></strong><st c="28719"> module in </st><strong class="source-inline"><st c="28730">main.py</st></strong><st c="28737">, as shown in the </st><span class="No-Break"><st c="28755">following snippet:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="28773">from flask_wtf import CSRFProtect</st></strong><st c="28807">
app = Flask(__name__, template_folder='pages', static_folder="resources")
app.config.from_file('config-dev.toml', toml.load)
bootstrap = Bootstrap4(app)
</st><strong class="bold"><st c="28961">csrf = CSRFProtect(app)</st></strong></pre>			<p><st c="28984">Calling the generated CSRF token (</st><strong class="source-inline"><st c="29019">csrf_token</st></strong><st c="29030">) using the WTF form context inside the </st><strong class="source-inline"><st c="29071">{{}}</st></strong><st c="29075"> statement enables the token generation per-user access, as shown in the given </st><strong class="source-inline"><st c="29154">complainant_add.html</st></strong><st c="29174"> template. </st><st c="29185">Flask-WTF generates a unique token for every rendition of the form fields. </st><st c="29260">Note </st><a id="_idIndexMarker247"/><st c="29265">that CRSF protection is only possible with Flask-WTF if the </st><strong class="source-inline"><st c="29325">SECRET_KEY</st></strong><st c="29335"> configuration variable is part of the configuration file and has the appropriate </st><span class="No-Break"><st c="29417">hash value.</st></span></p>
			<p><st c="29428">CRSF protection occurs in every form submission that involves the form model instance. </st><st c="29516">Now, let’s discuss the general flow of form submission with the </st><span class="No-Break"><st c="29580">Flask-WTF module.</st></span></p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor103"/><st c="29597">Submitting the form</st></h2>
			<p><st c="29617">After clicking the submit button, the </st><em class="italic"><st c="29656">HTTP POST</st></em><st c="29665"> request transaction of </st><strong class="source-inline"><st c="29689">add_complainant()</st></strong><st c="29706"> retrieves the</st><a id="_idIndexMarker248"/><st c="29720"> form values after the validation, as shown in the preceding snippet. </st><st c="29790">Flask-WTF sends the form data to the view function through the </st><em class="italic"><st c="29853">HTTP POST</st></em><st c="29862"> request method, requiring the view function to have validation for the incoming </st><strong class="source-inline"><st c="29943">POST</st></strong><st c="29947"> requests. </st><st c="29958">If </st><strong class="source-inline"><st c="29961">request.method</st></strong><st c="29975"> is </st><strong class="source-inline"><st c="29979">POST</st></strong><st c="29983">, the view must perform another evaluation on the extension’s </st><strong class="source-inline"><st c="30045">validate_on_submit()</st></strong><st c="30065"> to check for violation of some form constraints. </st><st c="30115">If the results for all these evaluations are </st><strong class="source-inline"><st c="30160">True</st></strong><st c="30164">, the view function can access all the form data in </st><strong class="source-inline"><st c="30216">form_object.&lt;field_name&gt;.data</st></strong><st c="30245">. Otherwise, the view function will redirect the users to the form page with the corresponding error message(s) and </st><em class="italic"><st c="30361">HTTP Status </st></em><span class="No-Break"><em class="italic"><st c="30373">Code 500</st></em></span><span class="No-Break"><st c="30381">.</st></span></p>
			<p><st c="30382">But what comprises Flask-WTF’s form </st><a id="_idIndexMarker249"/><st c="30419">validation framework, or what criteria are the basis of the </st><strong class="source-inline"><st c="30479">validate_on_submit()</st></strong><st c="30499"> result after </st><span class="No-Break"><st c="30513">form submission?</st></span></p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor104"/><st c="30529">Validating form fields</st></h2>
			<p><st c="30552">Flask-WTF has a list of useful built-in </st><a id="_idIndexMarker250"/><st c="30593">validator classes that support core validation rules such as </st><strong class="source-inline"><st c="30654">InputRequired()</st></strong><st c="30669">, which imposes the HTML-required constraint. </st><st c="30715">Some constraints are specific to widgets, such as the </st><strong class="source-inline"><st c="30769">Length()</st></strong><st c="30777"> validator, which can restrict the input length of the </st><strong class="source-inline"><st c="30832">StringField</st></strong><st c="30843"> values, and </st><strong class="source-inline"><st c="30856">RegExp()</st></strong><st c="30864">, which can impose regular expressions for mobile and telephone data formats. </st><st c="30942">Moreover, some validators require dependency modules to be installed, such as </st><strong class="source-inline"><st c="31020">Email()</st></strong><st c="31027">, which needs an email-validator external library. </st><st c="31078">All these built-in validators are ready to be imported from </st><em class="italic"><st c="31138">Flask-WTF</st></em><st c="31147">’s </st><strong class="source-inline"><st c="31151">wtforms.validators</st></strong><st c="31169"> module. </st><st c="31178">The </st><strong class="source-inline"><st c="31182">validators</st></strong><st c="31192"> parameter of every </st><em class="italic"><st c="31212">FlaskForm</st></em><st c="31221"> attribute can accept any callables from validator classes to impose </st><span class="No-Break"><st c="31290">constraint rules.</st></span></p>
			<p><st c="31307">Violations are added to the field’s errors list that can trigger </st><strong class="source-inline"><st c="31373">validate_on_submit()</st></strong><st c="31393"> to return </st><strong class="source-inline"><st c="31404">False</st></strong><st c="31409">. The form template must render all such error messages per field during redirection after an </st><em class="italic"><st c="31503">HTTP Status Code </st></em><span class="No-Break"><em class="italic"><st c="31520">500</st></em></span><span class="No-Break"><st c="31523"> error.</st></span></p>
			<p><st c="31530">The module can also support </st><a id="_idIndexMarker251"/><st c="31559">custom validation for some constraints that are not typical. </st><st c="31620">There are many ways to implement custom validations, and one is through the </st><em class="italic"><st c="31696">in-line validator approach</st></em><st c="31722"> exhibited in the </st><span class="No-Break"><st c="31740">following snippet:</st></span></p>
			<pre class="source-code"><st c="31758">
class ComplainantForm(FlaskForm):
    … … … … … …
    zipcode = IntegerField('Enter zip code:',  validators=[InputRequired()])
    … … … … … …
    def validate_</st><strong class="bold"><st c="31902">zipcode</st></strong><st c="31910">(self, </st><strong class="bold"><st c="31918">zipcode</st></strong><st c="31925">):
          if not len(str(zipcode.data)) == 4:
            </st><strong class="bold"><st c="31965">raise ValueError('zip code must be 4 digits')</st></strong></pre>			<p><st c="32010">An </st><em class="italic"><st c="32014">in-line validator</st></em><st c="32031"> is a custom </st><strong class="source-inline"><st c="32044">FlaskForm</st></strong><st c="32053"> function with the method name prefixed with </st><strong class="source-inline"><st c="32098">validate_</st></strong><st c="32107">, followed by the form field name it validates, that takes that form field as a parameter. </st><st c="32198">The given </st><strong class="source-inline"><st c="32208">validate_zipcode()</st></strong><st c="32226"> checks whether the form field’s </st><strong class="source-inline"><st c="32259">zipcode</st></strong><st c="32266"> checks if the input is a four-number value. </st><st c="32311">Otherwise, it throws an exception class. </st><st c="32352">Another approach is to implement validators as </st><em class="italic"><st c="32399">typical FlaskForm functions</st></em><st c="32426">, but the validator </st><a id="_idIndexMarker252"/><st c="32446">function needs to be injected explicitly into the </st><strong class="source-inline"><st c="32496">validators</st></strong><st c="32506"> parameter of the field </st><span class="No-Break"><st c="32530">it validates.</st></span></p>
			<p><st c="32543">Lastly, </st><em class="italic"><st c="32552">a closure-like or callable approach</st></em><st c="32587"> to validator implementation is also possible. </st><st c="32634">Here </st><strong class="source-inline"><st c="32639">disallow_invalid_dates()</st></strong><st c="32663"> is a closure-type validator that does not allow date input before the </st><span class="No-Break"><st c="32734">given </st></span><span class="No-Break"><strong class="source-inline"><st c="32740">date_after</st></strong></span><span class="No-Break"><st c="32750">:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="32752">from wtforms.validators ValidationError</st></strong><st c="32791">
class ComplainantForm(FlaskForm):
    </st><strong class="bold"><st c="32826">def disallow_invalid_dates(date_after):</st></strong><st c="32865">
         message = 'Must be after %s.' </st><st c="32896">% (date_after)
       </st><strong class="bold"><st c="32911">def _disallow_invalid_dates(form, field):</st></strong><st c="32952">
          base_date = datetime.strptime(date_after, '%Y-%m-%d').date()
          if field.data &lt; base_date:
             </st><strong class="bold"><st c="33041">raise ValidationError(message)</st></strong><strong class="bold"><st c="33071">return _disallow_invalid_dates</st></strong><st c="33102">
     … … … … … …
     … … … … … …
     date_registered = DateField('Enter date registered', format='%Y-%m-%d', validators=[InputRequired(), </st><strong class="bold"><st c="33227">disallow_invalid_dates('2000-01-01')</st></strong><st c="33263">])</st></pre>			<p><st c="33266">In this approach, a validator </st><a id="_idIndexMarker253"/><st c="33297">function serves as a factory of a closure or local function that implements the validation rule. </st><st c="33394">In the case of </st><strong class="source-inline"><st c="33409">disallow_invalid_dates()</st></strong><st c="33433">, the closure is </st><strong class="source-inline"><st c="33450">_disallow_invalid_dates(form, field)</st></strong><st c="33486">, which raises </st><strong class="source-inline"><st c="33501">ValidationError</st></strong><st c="33516"> when the </st><strong class="source-inline"><st c="33526">field.data</st></strong><st c="33536"> or </st><strong class="source-inline"><st c="33540">date_registered</st></strong><st c="33555"> form value is before the specified boundary date’s </st><strong class="source-inline"><st c="33607">date_after</st></strong><st c="33617"> provided by the validator function. </st><st c="33654">To apply validators, you can call them just like a typical method – that is, with parameter values in the </st><strong class="source-inline"><st c="33760">validators</st></strong><st c="33770"> parameter of the </st><span class="No-Break"><st c="33788">field class.</st></span></p>
			<p><st c="33800">Another extension module that is popular nowadays and supports the recent Flask framework is the </st><em class="italic"><st c="33898">Flask-RESTful</st></em><st c="33911"> module. </st><st c="33920">We’ll take a look at it in the </st><span class="No-Break"><st c="33951">next section.</st></span></p>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor105"/><st c="33964">Building RESTful services with Flask-RESTful</st></h1>
			<p><st c="34009">The </st><strong class="source-inline"><st c="34014">flask-RESTful</st></strong><st c="34027"> module uses the </st><em class="italic"><st c="34044">class-based view strategy</st></em><st c="34069"> of Flask to build RESTful services. </st><st c="34106">It provides a </st><strong class="source-inline"><st c="34120">Resource</st></strong><st c="34128"> class to create custom resources to build from the ground up HTTP-based services instead of </st><span class="No-Break"><st c="34221">endpoint-based routes.</st></span></p>
			<p><st c="34243">This chapter specifies another </st><a id="_idIndexMarker254"/><st c="34275">application, </st><strong class="source-inline"><st c="34288">ch04-api</st></strong><st c="34296">, that implements </st><a id="_idIndexMarker255"/><st c="34314">RESTful endpoints for managing user complaints and related details. </st><st c="34382">Here’s one of the resource-based implementations of our application’s </st><span class="No-Break"><st c="34452">API endpoints:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="34466">from flask_restful import Resource</st></strong><st c="34501">
class ListComplaintRestAPI(</st><strong class="bold"><st c="34529">Resource</st></strong><st c="34538">):
    </st><strong class="bold"><st c="34542">def get(self):</st></strong><st c="34556">
        repo = ComplaintRepository(db_session)
        records = repo.select_all()
        complaint_rec = [rec.to_json() for rec in records]
        return make_response(jsonify(complaint_rec), 201)</st></pre>			<p><st c="34724">Here, </st><strong class="source-inline"><st c="34731">flask_restful</st></strong><st c="34744"> provides the </st><strong class="source-inline"><st c="34758">Resource</st></strong><st c="34766"> class that creates resources for views. </st><st c="34807">In this case, </st><strong class="source-inline"><st c="34821">ListComplaintRestAPI</st></strong><st c="34841"> sub-classes the </st><strong class="source-inline"><st c="34858">Resource</st></strong><st c="34866"> class to override its </st><strong class="source-inline"><st c="34889">get()</st></strong><st c="34894"> instance method, which will retrieve all complaints from the database through an HTTP </st><em class="italic"><st c="34981">GET</st></em><st c="34984"> request. </st><st c="34994">On the other hand, </st><strong class="source-inline"><st c="35013">AddComplaintRestAPI</st></strong><st c="35032"> implements the </st><em class="italic"><st c="35048">INSERT</st></em><st c="35054"> complaint transaction through an HTTP </st><span class="No-Break"><em class="italic"><st c="35093">POST</st></em></span><span class="No-Break"><st c="35097"> request:</st></span></p>
			<pre class="source-code"><st c="35106">
class AddComplaintRestAPI(</st><strong class="bold"><st c="35133">Resource</st></strong><st c="35142">):
    </st><strong class="bold"><st c="35146">def post(self):</st></strong><st c="35161">
        complaint_json = request.get_json()
        repo = ComplaintRepository(db_session)
        complaint = Complaint(**complaint_json)
        result = repo.insert(complaint)
        if result:
            content = jsonify(complaint_json)
            return make_response(content, 201)
        else:
            content = jsonify(message="insert complaint record encountered a problem")
            return make_response(content, 500)</st></pre>			<p><st c="35504">The </st><strong class="source-inline"><st c="35509">Resource</st></strong><st c="35517"> class</st><a id="_idIndexMarker256"/><st c="35523"> has a </st><strong class="source-inline"><st c="35530">post()</st></strong><st c="35536"> method that needs to be overridden to </st><a id="_idIndexMarker257"/><st c="35575">create </st><em class="italic"><st c="35582">POST</st></em><st c="35586"> transactions. </st><st c="35601">The following </st><strong class="source-inline"><st c="35615">UpdateComplainantRestAPI</st></strong><st c="35639">, </st><strong class="source-inline"><st c="35641">DeleteComplaintRestAPI</st></strong><st c="35663">, and </st><strong class="source-inline"><st c="35669">UpdateComplaintRestAPI</st></strong><st c="35691"> resources implement HTTP </st><em class="italic"><st c="35717">PATCH</st></em><st c="35722">, </st><em class="italic"><st c="35724">DELETE</st></em><st c="35730">, and </st><span class="No-Break"><em class="italic"><st c="35736">PUT</st></em></span><span class="No-Break"><st c="35739">, respectively:</st></span></p>
			<pre class="source-code"><st c="35754">
class UpdateComplainantRestAPI(</st><strong class="bold"><st c="35786">Resource</st></strong><st c="35795">):
    </st><strong class="bold"><st c="35799">def patch(self, id):</st></strong><st c="35819">
        complaint_json = request.get_json()
        repo = ComplaintRepository(db_session)
        result = repo.update(id, complaint_json)
        if result:
            content = jsonify(complaint_json)
            return make_response(content, 201)
        else:
            content = jsonify(message="update complainant ID encountered a problem")
            return make_response(content, 500)</st></pre>			<p><st c="36129">The </st><strong class="source-inline"><st c="36134">Resource</st></strong><st c="36142"> class’ </st><strong class="source-inline"><st c="36150">patch()</st></strong><st c="36157"> method implements the HTTP </st><em class="italic"><st c="36185">PATCH</st></em><st c="36190"> request when overridden. </st><st c="36216">Like HTTP </st><em class="italic"><st c="36226">GET</st></em><st c="36229">, </st><strong class="source-inline"><st c="36231">patch()</st></strong><st c="36238"> can also accept path variables or request parameters by declaring local parameters to the override. </st><st c="36339">The </st><strong class="source-inline"><st c="36343">id</st></strong><st c="36345"> parameter in the </st><strong class="source-inline"><st c="36363">patch()</st></strong><st c="36370"> method of </st><strong class="source-inline"><st c="36381">UpdateComplaintRestAPI</st></strong><st c="36403"> is a path variable for a complainant ID. </st><st c="36445">This is</st><a id="_idIndexMarker258"/><st c="36452"> required to retrieve the </st><span class="No-Break"><st c="36478">complainant’s profile:</st></span></p>
			<pre class="source-code"><st c="36500">
class DeleteComplaintRestAPI(</st><strong class="bold"><st c="36530">Resource</st></strong><st c="36539">):
    </st><strong class="bold"><st c="36543">def delete(self, id):</st></strong><st c="36564">
        repo = ComplaintRepository(db_session)
        result = repo.delete(id)
        if result:
            content = jsonify(message=f'complaint {id} deleted')
            return make_response(content, 201)
        else:
            content = jsonify(message="delete complaint record encountered a problem")
            return make_response(content, 500)</st></pre>			<p><st c="36843">The </st><strong class="source-inline"><st c="36848">delete()</st></strong><st c="36856"> override of </st><strong class="source-inline"><st c="36869">DeleteComplaintRestAPI</st></strong><st c="36891"> also has an </st><strong class="source-inline"><st c="36904">id</st></strong><st c="36906"> parameter that’s used to delete </st><span class="No-Break"><st c="36939">the</st></span><span class="No-Break"><a id="_idIndexMarker259"/></span><span class="No-Break"><st c="36942"> complaint:</st></span></p>
			<pre class="source-code"><st c="36953">
class UpdateComplaintRestAPI(</st><strong class="bold"><st c="36983">Resource</st></strong><st c="36992">):
    </st><strong class="bold"><st c="36996">def put(self):</st></strong><st c="37010">
        complaint_json = request.get_json()
        repo = ComplaintRepository(db_session)
        result = repo.update(complaint_json['id'], complaint_json)
        if result:
            content = jsonify(complaint_json)
            return make_response(content, 201)
        else:
            content = jsonify(message="update complaint record encountered a problem")
            return make_response(content, 500)</st></pre>			<p><st c="37340">To utilize all the preceding resources, the Flask-RESTful extension module has an </st><strong class="source-inline"><st c="37423">Api</st></strong><st c="37426"> class that must be instantiated with</st><a id="_idIndexMarker260"/><st c="37463"> the </st><strong class="source-inline"><st c="37468">Flask</st></strong><st c="37473"> or </st><strong class="source-inline"><st c="37477">Blueprint</st></strong><st c="37486"> instance as its constructor argument. </st><st c="37525">Since</st><a id="_idIndexMarker261"/><st c="37530"> the </st><strong class="source-inline"><st c="37535">ch04-api</st></strong><st c="37543"> project uses blueprints, the following </st><strong class="source-inline"><st c="37583">__init__.py</st></strong><st c="37594"> file of the complaint blueprint module highlights how to create the </st><strong class="source-inline"><st c="37663">Api</st></strong><st c="37666"> instance and map all these resources with their respective </st><span class="No-Break"><st c="37726">URL patterns:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="37739">from flask import Blueprint</st></strong>
<strong class="bold"><st c="37767">from flask_restful import Api</st></strong>
<strong class="bold"><st c="37797">complaint_bp</st></strong><st c="37810"> = Blueprint('complaint_bp', __name__)
from modules.complaint.api.complaint import AddComplaintRestAPI, ListComplaintRestAPI, UpdateComplainantRestAPI, UpdateComplaintRestAPI, DeleteComplaintRestAPI
… … … … … …
</st><strong class="bold"><st c="38021">api = Api(complaint_bp)</st></strong><st c="38044">
api.</st><strong class="bold"><st c="38049">add_resource</st></strong><st c="38062">(</st><strong class="bold"><st c="38064">AddComplaintRestAPI</st></strong><st c="38083">, '/complaint/add', endpoint='add_complaint')
api.</st><strong class="bold"><st c="38133">add_resource</st></strong><st c="38146">(</st><strong class="bold"><st c="38148">ListComplaintRestAPI</st></strong><st c="38168">, '/complaint/list/all', endpoint='list_all_complaint')
api.</st><strong class="bold"><st c="38228">add_resource</st></strong><st c="38241">(</st><strong class="bold"><st c="38243">UpdateComplainantRestAPI</st></strong><st c="38267">, '/complaint/update/complainant/&lt;int:id&gt;', endpoint='update_complainant')
api.</st><strong class="bold"><st c="38346">add_resource</st></strong><st c="38359">(</st><strong class="bold"><st c="38361">UpdateComplaintRestAPI</st></strong><st c="38383">, '/complaint/update', endpoint='update_complaint')
api.</st><strong class="bold"><st c="38439">add_resource</st></strong><st c="38452">(</st><strong class="bold"><st c="38454">DeleteComplaintRestAPI</st></strong><st c="38476">, '/complaint/delete/&lt;int:id&gt;', endpoint='delete_complaint')</st></pre>			<p><st c="38536">The </st><strong class="source-inline"><st c="38541">Api</st></strong><st c="38544"> class has an </st><strong class="source-inline"><st c="38558">add_resource()</st></strong><st c="38572"> method that maps every resource to its </st><em class="italic"><st c="38612">URL pattern</st></em><st c="38623"> and </st><em class="italic"><st c="38628">endpoint</st></em><st c="38636"> or </st><em class="italic"><st c="38640">view function name</st></em><st c="38658">. This script shows how all the complaint module’s resource classes are injected</st><a id="_idIndexMarker262"/><st c="38738"> into the platform as full-fledged API endpoints. </st><st c="38788">Conflicts on endpoint names </st><a id="_idIndexMarker263"/><st c="38816">and URLs within and outside the blueprint modules will cause compile-time errors, so all details must be unique to </st><span class="No-Break"><st c="38931">each resource.</st></span></p>
			<p><st c="38945">The next module extension, </st><em class="italic"><st c="38973">Flask-Session</st></em><st c="38986">, provides Flask with a better session-handling solution than its </st><span class="No-Break"><st c="39052">built-in implementation.</st></span></p>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor106"/><st c="39076">Implementing session handling with Flask-Session</st></h1>
			<p><st c="39125">The </st><strong class="bold"><st c="39130">Flask-Session</st></strong><st c="39143"> module, like Flask’s built-in session, is easy to configure and use, except the module extension does not</st><a id="_idIndexMarker264"/><st c="39249"> store session</st><a id="_idIndexMarker265"/><st c="39263"> data in the </st><span class="No-Break"><st c="39276">web browser.</st></span></p>
			<p><st c="39288">Before you can configure this module, you must install it using the </st><span class="No-Break"><strong class="source-inline"><st c="39357">pip</st></strong></span><span class="No-Break"><st c="39360"> command:</st></span></p>
			<pre class="console"><st c="39369">
pip install flask-session</st></pre>			<p><st c="39395">Then, import the </st><strong class="source-inline"><st c="39413">Session</st></strong><st c="39420"> class into the </st><strong class="source-inline"><st c="39436">main.py</st></strong><st c="39443"> module to instantiate and integrate the extension module into the Flask platform. </st><st c="39526">The following </st><strong class="source-inline"><st c="39540">main.py</st></strong><st c="39547"> snippet shows the configuration </st><span class="No-Break"><st c="39580">of </st></span><span class="No-Break"><em class="italic"><st c="39583">Flask-Session</st></em></span><span class="No-Break"><st c="39596">:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="39598">from flask_session import Session</st></strong><st c="39631">
app = Flask(__name__)
app.config.from_file('config-dev.toml', toml.load)
</st><strong class="bold"><st c="39705">sess = Session()</st></strong>
<strong class="bold"><st c="39721">sess.init_app(app)</st></strong></pre>			<p><st c="39740">The </st><strong class="source-inline"><st c="39745">Session</st></strong><st c="39752"> instance is only used for configuration and not for session handling per se. </st><st c="39830">Flask’s </st><strong class="source-inline"><st c="39838">session</st></strong><st c="39845"> proxy object should always directly access the session data for storage </st><span class="No-Break"><st c="39918">and retrieval.</st></span></p>
			<p><st c="39932">Afterward, set some Flask-Session configuration variables, such as </st><strong class="source-inline"><st c="40000">SESSION_FILE_THRESHOLD</st></strong><st c="40022">, which sets the maximum number of data the session stores before deletion, and </st><strong class="source-inline"><st c="40102">SESSION_TYPE</st></strong><st c="40114">, which determines the kind of data storage for the session data. </st><st c="40180">The following are some </st><span class="No-Break"><strong class="source-inline"><st c="40203">SESSION_TYPE</st></strong></span><span class="No-Break"><st c="40215"> options:</st></span></p>
			<ul>
				<li><strong class="source-inline"><st c="40224">null</st></strong><st c="40229"> (default): This utilizes </st><strong class="source-inline"><st c="40255">NullSessionInterface</st></strong><st c="40275">, which triggers an </st><span class="No-Break"><strong class="source-inline"><st c="40295">Exception</st></strong></span><span class="No-Break"><st c="40304"> error.</st></span></li>
				<li><strong class="source-inline"><st c="40311">redis</st></strong><st c="40317">: This utilizes </st><strong class="source-inline"><st c="40334">RedisSessionInterface</st></strong><st c="40355"> to use </st><em class="italic"><st c="40363">Redis</st></em><st c="40368"> as a </st><span class="No-Break"><st c="40374">data store.</st></span></li>
				<li><strong class="source-inline"><st c="40385">memcached</st></strong><st c="40395">: This utilizes </st><strong class="source-inline"><st c="40412">MemcachedSessionInterface</st></strong><st c="40437"> to </st><span class="No-Break"><st c="40441">use </st></span><span class="No-Break"><em class="italic"><st c="40445">memcached</st></em></span><span class="No-Break"><st c="40454">.</st></span></li>
				<li><strong class="source-inline"><st c="40455">filesystem</st></strong><st c="40466">: This utilizes </st><strong class="source-inline"><st c="40483">FileSystemSessionInterface</st></strong><st c="40509"> to use the </st><em class="italic"><st c="40521">filesystem</st></em><st c="40531"> as </st><span class="No-Break"><st c="40535">the datastore.</st></span></li>
				<li><strong class="source-inline"><st c="40549">mongodb</st></strong><st c="40557">: This utilizes </st><strong class="source-inline"><st c="40574">MongoDBSessionInterface</st></strong><st c="40597"> to use the </st><span class="No-Break"><st c="40609">MongoDB database.</st></span></li>
				<li><strong class="source-inline"><st c="40626">sqlalchemy</st></strong><st c="40637">: This uses </st><strong class="source-inline"><st c="40650">SqlAlchemySessionInterface</st></strong><st c="40676"> to apply the SQLAlchemy ORM for a</st><a id="_idIndexMarker266"/><st c="40710"> relational database as </st><span class="No-Break"><st c="40734">session</st></span><span class="No-Break"><a id="_idIndexMarker267"/></span><span class="No-Break"><st c="40741"> storage.</st></span></li>
			</ul>
			<p><st c="40750">The module can also recognize Flask session config variables such </st><span class="No-Break"><st c="40817">as </st></span><span class="No-Break"><strong class="source-inline"><st c="40820">SESSION_LIFETIME</st></strong></span><span class="No-Break"><st c="40836">.</st></span></p>
			<p><st c="40837">The following configuration variables are registered in the </st><strong class="source-inline"><st c="40898">config-dev.toml</st></strong><st c="40913"> file for </st><span class="No-Break"><st c="40923">both applications:</st></span></p>
			<pre class="source-code"><st c="40941">
SESSION_LIFETIME = true
</st><strong class="bold"><st c="40966">SESSION_TYPE = "filesystem"</st></strong><st c="40993">
SESSION_FILE_THRESHOLD = 600
SESSION_PERMANENT = true</st></pre>			<p><st c="41047">Lastly, start the Flask server to load all the configurations and check the module’s integration. </st><st c="41146">The module will establish database connectivity to the specified data storage at server startup. </st><st c="41243">In our case, the </st><em class="italic"><st c="41260">Flask-Session</st></em><st c="41273"> module will create a </st><strong class="source-inline"><st c="41295">flask_session</st></strong><st c="41308"> directory inside the project </st><a id="_idIndexMarker268"/><st c="41338">directory when the </st><span class="No-Break"><st c="41357">application starts.</st></span></p>
			<p><span class="No-Break"><em class="italic"><st c="41376">Figure 4</st></em></span><em class="italic"><st c="41385">.7</st></em><st c="41387"> shows the </st><strong class="source-inline"><st c="41398">flask_session</st></strong><st c="41411"> folder and </st><span class="No-Break"><st c="41423">its content:</st></span></p>
			<div>
				<div id="_idContainer032" class="IMG---Figure">
					<img src="image/B19383_04_7.jpg" alt="Figure 4.7 – The session files inside the flask_session folder"/><st c="41435"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="41502">Figure 4.7 – The session files inside the flask_session folder</st></p>
			<p><st c="41564">With everything set up, utilize</st><a id="_idIndexMarker269"/><st c="41596"> Flask’s </st><strong class="source-inline"><st c="41605">session</st></strong><st c="41612"> to handle session data. </st><st c="41637">This can be seen in </st><strong class="source-inline"><st c="41657">login_db_auth()</st></strong><st c="41672">, which stores </st><strong class="source-inline"><st c="41687">username</st></strong><st c="41695"> as a session attribute for other </st><span class="No-Break"><st c="41729">views’ reach:</st></span></p>
			<pre class="source-code"><st c="41742">
from flask import session
@login_bp.route('/login/auth', methods=['GET', 'POST'])
def login_db_auth():
    authForm:LoginAuthForm = LoginAuthForm()
    … … … … … …
    if authForm.validate_on_submit():
        repo = LoginRepository(db_session)
        username = authForm.username.data
        … … … … … …
        if user == None:
            return render_template('login.html', form=authForm) , 500
        elif not user.password == password:
            return render_template('login.html', form=authForm) , 500
        else:
            </st><strong class="bold"><st c="42189">session['username'] = request.form['username']</st></strong><st c="42235">
            return redirect('/ch04/login/add')
    else:
      return render_template('login.html', form=authForm) , 500</st></pre>			<p><st c="42334">Similar to </st><em class="italic"><st c="42346">Flask-Session</st></em><st c="42359">, another </st><a id="_idIndexMarker270"/><st c="42369">extension module that can help</st><a id="_idIndexMarker271"/><st c="42399"> build a better enterprise-grade Flask application is the </st><span class="No-Break"><em class="italic"><st c="42457">Flask-Caching</st></em></span><span class="No-Break"><st c="42470"> module.</st></span></p>
			<h1 id="_idParaDest-106"><a id="_idTextAnchor107"/><st c="42478">Applying caching using Flask-Caching</st></h1>
			<p><strong class="bold"><st c="42515">Flask-Caching</st></strong><st c="42529"> provides enhanced</st><a id="_idIndexMarker272"/><st c="42547"> caching support for views, data rendered by Jinja2 templates, and the custom functions, such as repository or service functions, of any </st><a id="_idIndexMarker273"/><st c="42684">Flask application. </st><st c="42703">It also supports built-in caching of Flask and allows you to customize a cache through the </st><strong class="source-inline"><st c="42794">BaseCache</st></strong><st c="42803"> class from its </st><span class="No-Break"><strong class="source-inline"><st c="42819">flask_caching.backends.base</st></strong></span><span class="No-Break"><st c="42846"> module.</st></span></p>
			<p><st c="42854">Before we can configure Flask-Caching, we must install the </st><strong class="source-inline"><st c="42914">flask-caching</st></strong><st c="42927"> module via the </st><span class="No-Break"><strong class="source-inline"><st c="42943">pip</st></strong></span><span class="No-Break"><st c="42946"> command:</st></span></p>
			<pre class="console"><st c="42955">
pip install flask-caching</st></pre>			<p><st c="42981">Then, we must register some of its configuration variables in the configuration file, such as </st><strong class="source-inline"><st c="43076">CACHE_TYPE</st></strong><st c="43086">, which sets the cache type suited for the application, and </st><strong class="source-inline"><st c="43146">CACHE_DEFAULT_TIMEOUT</st></strong><st c="43167">, which sets the caching timeout. </st><st c="43201">The following are the applications’ caching configuration variables declared in their respective </st><span class="No-Break"><strong class="source-inline"><st c="43298">config-dev.toml</st></strong></span><span class="No-Break"><st c="43313"> files:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="43320">CACHE_TYPE = "FileSystemCache"</st></strong><st c="43351">
CACHE_DEFAULT_TIMEOUT = 300
CACHE_DIR = "./cache_dir/"
CACHE_THRESHOLD = 800</st></pre>			<p><st c="43428">Here, </st><strong class="source-inline"><st c="43435">CACHE_DIR</st></strong><st c="43444"> sets the cache folder for the filesystem cache type, while </st><strong class="source-inline"><st c="43504">CACHE_THRESHOLD</st></strong><st c="43519"> sets the maximum number of cached items before it starts </st><span class="No-Break"><st c="43577">deleting some.</st></span></p>
			<p><st c="43591">Afterward, to avoid cyclic collisions, create a</st><a id="_idIndexMarker274"/><st c="43639"> separate module file, such as </st><strong class="source-inline"><st c="43670">main_cache.py</st></strong><st c="43683">, to instantiate</st><a id="_idIndexMarker275"/><st c="43699"> the </st><strong class="source-inline"><st c="43704">Cache</st></strong><st c="43709"> class from the </st><strong class="source-inline"><st c="43725">flask_caching</st></strong><st c="43738"> module. </st><st c="43747">Access to the </st><strong class="source-inline"><st c="43761">cache</st></strong><st c="43766"> instance must be done from </st><strong class="source-inline"><st c="43794">main_cache.py</st></strong><st c="43807">, not </st><strong class="source-inline"><st c="43813">main.py</st></strong><st c="43820">, even though the final setup of the extension module occurs in </st><strong class="source-inline"><st c="43884">main.py</st></strong><st c="43891">. The following snippet integrates the </st><em class="italic"><st c="43930">Flask-Caching</st></em><st c="43943"> module into the </st><span class="No-Break"><st c="43960">Flask platform:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="43975">from main_cache import cache</st></strong><st c="44004">
app = Flask(__name__, template_folder='pages', static_folder="resources")
app.config.from_file('config-dev.toml', toml.load)
</st><strong class="bold"><st c="44130">cache.init_app(app)</st></strong></pre>			<p><st c="44149">Finally, run the Flask server to check for compile-time errors and if the module successfully created the cache. </st><st c="44263">In our setup, a directory called </st><strong class="source-inline"><st c="44296">cache_dir</st></strong><st c="44305"> must be created inside the main folder, as shown in </st><span class="No-Break"><em class="italic"><st c="44358">Figure 4</st></em></span><span class="No-Break"><em class="italic"><st c="44366">.8</st></em></span><span class="No-Break"><st c="44368">:</st></span></p>
			<div>
				<div id="_idContainer033" class="IMG---Figure">
					<img src="image/B19383_04_8.jpg" alt="Figure 4.8 – The cache files in cache_dir"/><st c="44370"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="44449">Figure 4.8 – The cache files in cache_dir</st></p>
			<p><st c="44490">If the setup is successful, components can now access </st><strong class="source-inline"><st c="44545">main_cache.py</st></strong><st c="44558"> for the cache instance. </st><st c="44583">It has a </st><strong class="source-inline"><st c="44592">cached()</st></strong><st c="44600"> decorator that can provide caching for various functions. </st><st c="44659">First, it can cache views, usually with an HTTP </st><em class="italic"><st c="44707">GET</st></em><st c="44710"> request to retrieve bulk records from the database. </st><st c="44763">The following view function from the </st><strong class="source-inline"><st c="44800">complainant.py</st></strong><st c="44814"> module of the </st><strong class="source-inline"><st c="44829">ch04-web</st></strong><st c="44837"> application caches all its results to </st><strong class="source-inline"><st c="44876">cache_dir</st></strong><st c="44885"> for </st><span class="No-Break"><st c="44890">optimal performance:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="44910">from main_cache import cache</st></strong><st c="44939">
@complainant_bp.route('/complainant/list/all', methods=['GET'])
</st><strong class="bold"><st c="45004">@cache.cached(timeout=50, key_prefix="all_complaints")</st></strong><st c="45058">
def list_all_complainant():
     repo:ComplainantRepository = ComplainantRepository(db_session)
     records = repo.select_all()
     return render_template('complainant_list_all.html', records=records), 200</st></pre>			<p><st c="45251">The exact area to decorate</st><a id="_idIndexMarker276"/><st c="45278"> the </st><strong class="source-inline"><st c="45283">cached()</st></strong><st c="45291"> decorator is between the</st><a id="_idIndexMarker277"/><st c="45316"> function definition and the route decorator of the view function. </st><st c="45383">The decorator needs </st><strong class="source-inline"><st c="45403">key_prefix</st></strong><st c="45413"> to generate </st><strong class="source-inline"><st c="45426">cache_key</st></strong><st c="45435">. If not specified, </st><em class="italic"><st c="45455">Flask-Caching</st></em><st c="45468"> will use the default </st><strong class="source-inline"><st c="45490">request.path</st></strong><st c="45502"> as the </st><strong class="source-inline"><st c="45510">cache_key</st></strong><st c="45519"> value. </st><st c="45527">Note that </st><strong class="source-inline"><st c="45537">cache_key</st></strong><st c="45546"> is the key that’s used to access the cached value of the function and is solely for the module to access. </st><st c="45653">The given </st><strong class="source-inline"><st c="45663">list_all_complainant()</st></strong><st c="45685"> caches the rendered list of complaints with </st><strong class="source-inline"><st c="45730">prefix_key</st></strong><st c="45740"> set </st><span class="No-Break"><st c="45745">to </st></span><span class="No-Break"><strong class="source-inline"><st c="45748">all_complaints</st></strong></span><span class="No-Break"><st c="45762">.</st></span></p>
			<p><st c="45763">Moreover, the endpoint functions of the resource-based API created by Flask-RESTful can also cache their returned values through the </st><strong class="source-inline"><st c="45897">@cached()</st></strong><st c="45906"> decorator. </st><st c="45918">The following code shows </st><strong class="source-inline"><st c="45943">ListComplaintDetailsRestAPI</st></strong><st c="45970"> from the </st><strong class="source-inline"><st c="45980">ch04-api</st></strong><st c="45988"> application, which caches the list of </st><strong class="source-inline"><st c="46027">ComplaintDetails</st></strong><st c="46043"> records </st><span class="No-Break"><st c="46052">into </st></span><span class="No-Break"><strong class="source-inline"><st c="46057">cache_dir</st></strong></span><span class="No-Break"><st c="46066">:</st></span></p>
			<pre class="source-code"><st c="46068">
class ListComplaintDetailsRestAPI(Resource):
    </st><strong class="bold"><st c="46114">@cache.cached(timeout=50)</st></strong><st c="46139">
    def get(self):
        repo = ComplaintDetailsRepository(db_session)
        records = repo.select_all()
        compdetails_rec = [rec.to_json() for rec in records]
        return make_response(jsonify(compdetails_rec), 201)</st></pre>			<p><st c="46333">As shown in the preceding code snippet, the decorator is placed above the overridden method of the </st><strong class="source-inline"><st c="46433">Resource</st></strong><st c="46441"> class. </st><st c="46449">This rule is also valid with the other </st><span class="No-Break"><st c="46488">class-based views.</st></span></p>
			<p><st c="46506">The module can also cache repository and</st><a id="_idIndexMarker278"/><st c="46547"> service functions that retrieve large amounts of data during user access. </st><st c="46622">The</st><a id="_idIndexMarker279"/><st c="46625"> following code shows a </st><strong class="source-inline"><st c="46649">select_all()</st></strong><st c="46661"> function that retrieves data from the </st><span class="No-Break"><strong class="source-inline"><st c="46700">login</st></strong></span><span class="No-Break"><st c="46705"> table:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="46712">from main_cache import cache</st></strong><st c="46741">
class LoginRepository:
    def __init__(self, sess:Session):
        self.sess = sess
    … … … … … …
    </st><strong class="bold"><st c="46828">@cache.cached(timeout=50, key_prefix='all_login')</st></strong><st c="46877">
    def select_all(self) -&gt; List[Any]:
        users = self.sess.query(Login).all()
        return users
    … … … … … …</st></pre>			<p><st c="46974">Moreover, the module also supports the </st><em class="italic"><st c="47014">memoization</st></em><st c="47025"> process to store values, similar to caching, but for custom functions that are frequently accessed. </st><st c="47126">The </st><strong class="source-inline"><st c="47130">cache</st></strong><st c="47135"> instance has a </st><strong class="source-inline"><st c="47151">memoize()</st></strong><st c="47160"> decorator that manages these functions to improve performance. </st><st c="47224">The following code shows the </st><strong class="source-inline"><st c="47253">@memoize</st></strong><st c="47261"> decorated method </st><span class="No-Break"><st c="47279">of </st></span><span class="No-Break"><strong class="source-inline"><st c="47282">ComplaintRepository</st></strong></span><span class="No-Break"><st c="47301">:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="47303">from main_cache import cache</st></strong><st c="47331">
class ComplaintRepository:
    def __init__(self, sess:Session):
        self.sess = sess
    </st><strong class="bold"><st c="47410">@cache.memoize(timeout=50)</st></strong><st c="47436">
    def select_all(self) -&gt; List[Any]:
        complaint = self.sess.query(Complaint).all()
        return complaint</st></pre>			<p><st c="47533">The given </st><strong class="source-inline"><st c="47544">select_all()</st></strong><st c="47556"> method will cache all the queried records for 50 seconds to improve its data retrieval performance. </st><st c="47657">To clear the </st><a id="_idIndexMarker280"/><st c="47670">caches after server startup, always call </st><strong class="source-inline"><st c="47711">cache.clear()</st></strong><st c="47724"> in the </st><strong class="source-inline"><st c="47732">main.py</st></strong><st c="47739"> module</st><a id="_idIndexMarker281"/><st c="47746"> after </st><span class="No-Break"><st c="47753">blueprint registration.</st></span></p>
			<p><st c="47776">To be able to send complaints through emails, let’s showcase a popular extension module </st><span class="No-Break"><st c="47865">called </st></span><span class="No-Break"><em class="italic"><st c="47872">Flask-Mail</st></em></span><span class="No-Break"><st c="47882">.</st></span></p>
			<h1 id="_idParaDest-107"><a id="_idTextAnchor108"/><st c="47883">Adding mail features using Flask-Mail</st></h1>
			<p><strong class="bold"><st c="47921">Flask-Mail</st></strong><st c="47932"> is an extension module that</st><a id="_idIndexMarker282"/><st c="47960"> handles sending emails to an email server without too </st><span class="No-Break"><st c="48015">much configuration.</st></span></p>
			<p><st c="48034">First, install the </st><strong class="source-inline"><st c="48054">flask-mail</st></strong><st c="48064"> module using the </st><span class="No-Break"><strong class="source-inline"><st c="48082">pip</st></strong></span><span class="No-Break"><st c="48085"> command:</st></span></p>
			<pre class="console"><st c="48094">
pip install flask-mail</st></pre>			<p><st c="48117">Then, create a separate module script, such as </st><strong class="source-inline"><st c="48165">mail_config.py</st></strong><st c="48179">, to instantiate the </st><strong class="source-inline"><st c="48200">Mail</st></strong><st c="48204"> class. </st><st c="48212">This approach solves the cyclic collisions that occur when views or endpoint functions access the </st><strong class="source-inline"><st c="48310">mail</st></strong><st c="48314"> instance for the </st><span class="No-Break"><st c="48332">utility methods.</st></span></p>
			<p><st c="48348">Despite the separate module, the </st><strong class="source-inline"><st c="48382">main.py</st></strong><st c="48389"> module still needs to access the </st><strong class="source-inline"><st c="48423">mail</st></strong><st c="48427"> instance to integrate the module into the Flask platform. </st><st c="48486">The following </st><strong class="source-inline"><st c="48500">main.py</st></strong><st c="48507"> snippet shows how to set up the </st><em class="italic"><st c="48540">Flask-Mail</st></em><st c="48550"> module </st><span class="No-Break"><st c="48558">with Flask:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="48569">from mail_config import mail</st></strong><st c="48598">
app = Flask(__name__, template_folder='pages', static_folder="resources")
app.config.from_file('config-dev.toml', toml.load)
</st><strong class="bold"><st c="48724">mail.init_app(app)</st></strong></pre>			<p><st c="48742">Afterward, the setup requires some configuration variables to be set in the config file. </st><st c="48832">The following configuration </st><a id="_idIndexMarker283"/><st c="48860">variables are the most essential settings for our applications in </st><span class="No-Break"><st c="48926">this chapter:</st></span></p>
			<pre class="source-code"><st c="48939">
MAIL_SERVER ="smtp.gmail.com"
MAIL_PORT = 465
</st><strong class="bold"><st c="48986">MAIL_USERNAME = "your_email@gmail.com"</st></strong>
<strong class="bold"><st c="49024">MAIL_PASSWORD = "xxxxxxxxxxxxxxxx"</st></strong><st c="49059">
MAIL_USE_TLS = false
MAIL_USE_SSL = true</st></pre>			<p><st c="49100">These details pertain to a </st><em class="italic"><st c="49128">Gmail</st></em><st c="49133"> account, but you can replace them with </st><em class="italic"><st c="49173">Yahoo!</st></em><st c="49179"> account details. </st><st c="49197">Preferably, </st><strong class="source-inline"><st c="49209">MAIL_USE_SSL</st></strong><st c="49221"> must be set to </st><strong class="source-inline"><st c="49237">true</st></strong><st c="49241">. Note that </st><strong class="source-inline"><st c="49253">MAIL_PASSWORD</st></strong><st c="49266"> is a token that’s generated from the </st><em class="italic"><st c="49304">app password</st></em><st c="49316"> of the email account and not the actual one to establish a secure connection to the mail server. </st><st c="49414">After server startup, Flask-Mail is ready to use if there are no </st><span class="No-Break"><st c="49479">compiler errors.</st></span></p>
			<p><st c="49495">The following </st><strong class="source-inline"><st c="49510">email_complaint()</st></strong><st c="49527"> view function uses the </st><strong class="source-inline"><st c="49551">mail</st></strong><st c="49555"> instance to send a complaint through the </st><em class="italic"><st c="49597">Flask-WTF</st></em><st c="49606"> and </st><em class="italic"><st c="49611">Flask-Mail</st></em> <span class="No-Break"><st c="49621">extension modules:</st></span></p>
			<pre class="source-code">
<strong class="bold"><st c="49640">from flask_mail import Message</st></strong>
<strong class="bold"><st c="49671">from mail_config import mail</st></strong><st c="49700">
@complaint_bp.route("/complaint/email")
def email_complaint():
    </st><strong class="bold"><st c="49764">form:EmailComplaintForm = EmailComplaintForm()</st></strong><st c="49810">
    if request.method == 'GET':
        return render_template('email_form.html', form=form), 200
    if form.validate_on_submit():
       try:
           recipients = [rec for rec in str(form.to.data).split(';')]
           msg = </st><strong class="bold"><st c="49997">Message(form.subject, sender = 'your_email@gmail.com', recipients = recipients)</st></strong><strong class="bold"><st c="50076">msg.body = form.message.data</st></strong><strong class="bold"><st c="50105">mail.send(msg)</st></strong><st c="50120">
           form:EmailComplaintForm = EmailComplaintForm()
           return render_template('email_.html', form=form, message='Email sent.'), 200
       except:
         return render_template('email_.html', form=form), 500</st></pre>			<p><st c="50306">Here, </st><strong class="source-inline"><st c="50313">EmailComplaintForm</st></strong><st c="50331"> provides </st><a id="_idIndexMarker284"/><st c="50341">details for the </st><strong class="source-inline"><st c="50357">Message()</st></strong><st c="50366"> attributes, except for the sender, which is the email address that’s assigned to the </st><strong class="source-inline"><st c="50452">MAIL_USERNAME</st></strong><st c="50465"> configuration variable. </st><st c="50490">The </st><strong class="source-inline"><st c="50494">mail</st></strong><st c="50498"> instance provides the </st><strong class="source-inline"><st c="50521">send()</st></strong><st c="50527"> utility method to send the message to </st><span class="No-Break"><st c="50566">the recipient(s).</st></span></p>
			<h1 id="_idParaDest-108"><a id="_idTextAnchor109"/><st c="50583">Summary</st></h1>
			<p><st c="50591">This chapter explained how to utilize Flask extension modules when building applications. </st><st c="50682">Most extension modules will let us focus on the requirements rather than the complexities of configurations and setups, such as the </st><em class="italic"><st c="50814">Flask-WTF</st></em><st c="50823"> and </st><em class="italic"><st c="50828">Bootstrap-Flask</st></em><st c="50843"> modules. </st><st c="50853">Some will shorten development time instead of programming the snippets repeatedly or handling the details all over again, such as </st><em class="italic"><st c="50983">Flask-Migrate</st></em><st c="50996"> on database migrations and </st><em class="italic"><st c="51024">Flask-Mail</st></em><st c="51034"> for sending messages to email servers. </st><st c="51074">Some modules can enhance the built-in features of the Flask framework and provide better configuration options, such as </st><em class="italic"><st c="51194">Flask_Caching</st></em><st c="51207"> and </st><em class="italic"><st c="51212">Flask-Session</st></em><st c="51225">. Finally, a few will organize the concepts and the implementations of the components, such </st><span class="No-Break"><st c="51317">as </st></span><span class="No-Break"><em class="italic"><st c="51320">Flask-RESTful</st></em></span><span class="No-Break"><st c="51333">.</st></span></p>
			<p><st c="51334">Although problems may arise with version conflicts and outdated modules, the many advantages the extension modules provide supersede all of their drawbacks. </st><st c="51492">But above all, the software requirements must always come first when applying these extension modules. </st><st c="51595">You should always be able to choose the appropriate options among these modules that will best address the needed requirements, not because they can </st><span class="No-Break"><st c="51744">provide shortcuts.</st></span></p>
			<p><st c="51762">The next chapter will be about the Flask framework and </st><span class="No-Break"><st c="51818">asynchronous programming.</st></span></p>
		</div>
	<div id="charCountTotal" value="51843"/>

		<div id="_idContainer035" class="Content">
			<h1 id="_idParaDest-109" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor110"/><st c="0">Part 2:Building Advanced Flask 3.x Applications</st></h1>
			<p><st c="48">In this part, you will learn how to extend your Flask skills to build enterprise applications with enhanced performance using asynchronous views and API endpoints. </st><st c="213">You will learn to use the asynchronous SQLAlchemy to build asynchronous repository transactions and NoSQL databases to manage non-structured or semi-structured big data. </st><st c="383">Overall, this part will lead you to implement features that utilize asynchronous background tasks, upload XLSX and CSV files to generate charts, graphs, and tabular data, generate PDF documents, use WebSockets and </st><strong class="bold"><st c="597">Server-Sent Events</st></strong><st c="615"> (</st><strong class="bold"><st c="617">SSE</st></strong><st c="620">), implement non-BPMN and BPMN workflows, and secure the application from </st><span class="No-Break"><st c="695">web attacks.</st></span></p>
			<p><st c="707">This part includes the </st><span class="No-Break"><st c="731">following chapters:</st></span></p>
			<ul>
				<li><a href="B19383_05.xhtml#_idTextAnchor111"><em class="italic"><st c="750">Chapter 5</st></em></a><st c="760">, </st><em class="italic"><st c="762">Building Asynchronous Transactions</st></em></li>
				<li><a href="B19383_06.xhtml#_idTextAnchor143"><em class="italic"><st c="796">Chapter 6</st></em></a><st c="806">, </st><em class="italic"><st c="808">Developing Computational and Scientific Applications</st></em></li>
				<li><a href="B19383_07.xhtml#_idTextAnchor177"><em class="italic"><st c="860">Chapter 7</st></em></a><st c="870">, </st><em class="italic"><st c="872">Using Non-Relational Data Storage</st></em></li>
				<li><a href="B19383_08.xhtml#_idTextAnchor218"><em class="italic"><st c="905">Chapter 8</st></em></a><st c="915">, </st><em class="italic"><st c="917">Building Workflows with Flask</st></em></li>
				<li><a href="B19383_09.xhtml#_idTextAnchor256"><em class="italic"><st c="946">Chapter 9</st></em></a><st c="956">, </st><em class="italic"><st c="958">Securing Flask Applications</st></em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer036">
			</div>
		</div>
		<div>
			<div id="_idContainer037" class="Basic-Graphics-Frame">
			</div>
		</div>
	<div id="charCountTotal" value="985"/></body></html>