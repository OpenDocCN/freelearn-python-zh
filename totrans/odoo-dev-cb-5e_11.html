<html><head></head><body>
		<div id="_idContainer089">
			<h1 id="_idParaDest-515" class="chapter-number"><a id="_idTextAnchor595"/>11</h1>
			<h1 id="_idParaDest-516"><a id="_idTextAnchor596"/>Internationalization</h1>
			<p>Odoo supports a <a id="_idIndexMarker764"/>variety of languages and enables users to use the language(s) with which they are most comfortable. The Odoo i18n features that are already built-in help with this. With string translations, Odoo also supports date and <span class="No-Break">time formatting.</span></p>
			<p>In this chapter, you will discover how to upload translation files to your modules and enable various languages. Due to the diversity of countries and the prevalence of local languages, users often find it easier to connect with a system when it’s presented in their native tongue. To accommodate this, Odoo offers a feature that enables software text to be translated into the user’s preferred language. This functionality enhances the user experience by ensuring that the interface is accessible and comprehensible to individuals, regardless of their linguistic background, thereby promoting wider adoption and usability of the software across various regions and demographics. Utilizing these new functionalities will enhance the Odoo <span class="No-Break">user experience.</span></p>
			<p>The following recipes will be covered in <span class="No-Break">this chapter:</span></p>
			<ul>
				<li>Setting up a language installation and user <span class="No-Break">preference settings</span></li>
				<li>Setting up options relating <span class="No-Break">to language</span></li>
				<li>Text translation using a web client <span class="No-Break">user interface</span></li>
				<li>Exporting translation into <span class="No-Break">a file</span><a id="_idTextAnchor597"/></li>
				<li>Using <strong class="source-inline">gettext</strong> tools to make <span class="No-Break">translations easier</span></li>
				<li>Importing translation files <span class="No-Break">into Odoo</span></li>
				<li>Altering a website’s custom language <span class="No-Break">URL code</span></li>
			</ul>
			<p>Many of these recipes can be completed either from the web client user interface or from the command line. Wherever possible, we will see how to use both of these options. Odoo uses Transifex(Odoo) and Weblate (OCA) <span class="No-Break">translation platforms.</span></p>
			<h1 id="_idParaDest-517"><a id="_idTextAnchor598"/>Setting up a language installation and user preference settings</h1>
			<p>Odoo <a id="_idIndexMarker765"/>can be localized to accommodate various languages and locale settings, including date and <span class="No-Break">number formats.</span></p>
			<p>The only<a id="_idIndexMarker766"/> language that is initially installed is the standard English language. We need to install various localities and languages so that people may utilize them. This recipe describes how user preferences are implemented, as well as how they may <span class="No-Break">be established.</span></p>
			<h2 id="_idParaDest-518"><a id="_idTextAnchor599"/>How to do it…</h2>
			<p>Activate developer mode and follow these steps to install a new language in an <span class="No-Break">Odoo instance:</span></p>
			<ol>
				<li>Go to <strong class="bold">Settings</strong> | <strong class="bold">General Settings</strong> | <strong class="bold">Language</strong>. Here, you will see the <strong class="bold">Add Language</strong> link, as shown in the following screenshot. Click on that link; a dialogue box will open where you can <span class="No-Break">load languages:</span></li>
			</ol>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="image/B20997_11_1.jpg" alt="Figure 11.1 – Language options in the general settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – Language options in the general settings</p>
			<ol>
				<li value="2">Select the language you want <span class="No-Break">to load:</span></li>
			</ol>
			<div>
				<div id="_idContainer076" class="IMG---Figure">
					<img src="image/B20997_11_2.jpg" alt="Figure 11.2 – Dialogue to load a language"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Dialogue to load a language</p>
			<ol>
				<li value="3">Clicking<a id="_idIndexMarker767"/> on <strong class="bold">Add</strong> will load the selected language, and <a id="_idIndexMarker768"/>the confirmation dialogue box will open, <span class="No-Break">as follows:</span></li>
			</ol>
			<div>
				<div id="_idContainer077" class="IMG---Figure">
					<img src="image/B20997_11_3.jpg" alt="Figure 11.3 – Dialogue that shows a language has been loaded"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Dialogue that shows a language has been loaded</p>
			<ol>
				<li value="4">New languages can also be installed from the command line. The equivalent command for the preceding steps is <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --load-language=es_ES</strong></pre></li>				<li>To set the language that’s used by a user, go to <strong class="bold">Settings</strong> | <strong class="bold">Users &amp; Companies</strong> | <strong class="bold">Users</strong>, and, in the <strong class="bold">Preferences</strong> tab of the <strong class="bold">User</strong> form, set the <strong class="bold">Language</strong> <span class="No-Break">field value:</span></li>
			</ol>
			<div>
				<div id="_idContainer078" class="IMG---Figure">
					<img src="image/B20997_11_4.jpg" alt="Figure 11.4 – User’s form to set the language"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – User’s form to set the language</p>
			<p>Through <a id="_idIndexMarker769"/>the <strong class="bold">Preferences</strong> menu item, users may easily change these <a id="_idIndexMarker770"/>variables on their own. They may access this by clicking on their username in the top-right corner of the web <span class="No-Break">client window:</span></p>
			<div>
				<div id="_idContainer079" class="IMG---Figure">
					<img src="image/B20997_11_5.jpg" alt="Figure 11.5– Preferences option to set the language"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5– Preferences option to set the language</p>
			<h2 id="_idParaDest-519"><a id="_idTextAnchor600"/>How it works...</h2>
			<p>Users can<a id="_idIndexMarker771"/> have their own language and time zone preferences. The<a id="_idIndexMarker772"/> language settings are used to translate user interface text into the chosen language and apply local conventions for float and <span class="No-Break">monetary fields.</span></p>
			<p>Before a language is made available for the user to select, it must be installed with the <strong class="bold">Add language</strong> option. The list of available languages can be seen by going to the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Languages</strong> menu option in developer mode. The ones with the active flag set <span class="No-Break">are installed.</span></p>
			<p>Each Odoo add-on module is responsible for providing translation resources, which should be placed inside an <strong class="source-inline">i18n</strong> subdirectory. Each language’s data should be in a <strong class="source-inline">.po</strong> file. In our example, for the Spanish language, the translation data is loaded from the <strong class="source-inline">es_ES.po</strong> <span class="No-Break">data file.</span></p>
			<p>Odoo also supports the notion of a <strong class="bold">base language</strong>. For example, if we have an <strong class="source-inline">es.po</strong> file for Spanish and an <strong class="source-inline">es_MX.po</strong> file for Mexican Spanish, then <strong class="source-inline">es.po</strong> is detected as the base language for <strong class="source-inline">es_MX.po</strong>. When the Mexican Spanish language is installed, both data files are loaded; first the one for the base language and then the specific language. Therefore, in our case, the Mexican Spanish translation file simply has to contain the strings that are unique to the <span class="No-Break">language variety.</span></p>
			<p>The <strong class="source-inline">i18n</strong> subdirectory is also expected to have a <strong class="source-inline">&lt;module_name&gt;.pot</strong> file, providing a template for translations and containing all the translatable strings. The <em class="italic">Exporting translation strings to a file</em> recipe of this chapter explains how to export the translatable strings to generate <span class="No-Break">this file.</span></p>
			<p>In previous versions of Odoo, when an additional language is installed, the corresponding resources are loaded from all installed add-on modules and stored in the <strong class="bold">Translated Terms</strong> model. Its data can be viewed (and edited) within the <strong class="bold">Settings</strong> | <strong class="bold">Translations </strong>| <strong class="bold">Application Terms</strong> | <strong class="bold">Translated Terms</strong> menu option (note that this menu is only visible in <span class="No-Break">developer mode).</span></p>
			<p>From Odoo version 17 onwards, you won’t be able to find this menu as translated terms are now stored as native terms. Any field that is translatable now stores JSON data representing all translations of all translated language values. For example, translations of product names are now stored directly in the <strong class="source-inline">name</strong> field. The process of translations has not changed – you just can’t see the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Application Terms</strong> | <strong class="bold">Translated Terms</strong> menu item with all translated terms shown in <span class="No-Break">a list.</span></p>
			<p>Translation files for the<a id="_idIndexMarker773"/> installed languages are also loaded when a new add-on module is installed or an existing add-on module <span class="No-Break">is upgraded.</span></p>
			<h2 id="_idParaDest-520"><a id="_idTextAnchor601"/>There’s more...</h2>
			<p>By selecting <a id="_idIndexMarker774"/>the refresh symbol again next to the languages, translation files may be refreshed without you having to upgrade the add-on modules. You can do this if your translation files have been changed and you don’t want to deal with updating the modules (and all of <span class="No-Break">their dependencies).</span></p>
			<p>If the <strong class="bold">Overwrite Existing Terms</strong> checkbox is left empty, only the newly translated strings are loaded. Thus, the changed translated strings won’t be loaded. Check the box if you want the already-existing translations to also be loaded and overwrite the currently loaded translations. Note that this can potentially be problematic if someone changes the translations manually through <span class="No-Break">the interface.</span></p>
			<p>The <strong class="bold">Overwrite Existing Terms</strong> checkbox exists because we can edit specific translations by going to the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Application Terms</strong> | <strong class="bold">Translated Terms</strong> menu item, or by using the <strong class="bold">Technical Translation</strong> shortcut option in the <strong class="bold">Debug</strong> menu. Translations that are added or modified in this way won’t be overwritten unless the language is reloaded with the <strong class="bold">Overwrite Existing Terms</strong> <span class="No-Break">checkbox enabled.</span></p>
			<p>It can be useful to know that add-on modules can also have an <strong class="source-inline">i18n_extra</strong> subdirectory with extra translations. First, the <strong class="source-inline">.po</strong> files in the <strong class="source-inline">i18n</strong> subdirectory are downloaded. Then, Odoo ORM downloads files for the base language and, after that, for the language variant. Following this, the <strong class="source-inline">.po</strong> files in the <strong class="source-inline">i18n_extra</strong> subdirectory are downloaded, first for the base language and then for the language variant. The final string translation that is loaded is the one that ultimately <span class="No-Break">takes precedence.</span></p>
			<h1 id="_idParaDest-521"><a id="_idTextAnchor602"/>Setting up options relating to language</h1>
			<p>The <a id="_idIndexMarker775"/>locale settings should be the right ones, so long as the user is using the correct language, because they come with <span class="No-Break">suitable defaults.</span></p>
			<p>You may still want to change a language’s settings, though. For instance, you could opt to use the user interface’s default English language setting while changing the American date and number formats to better suit <span class="No-Break">your needs.</span></p>
			<p>Additionally, locale settings such as date and number formats are provided by languages and their variants (such as <strong class="source-inline">es_MX</strong> for <span class="No-Break">Mexican Spanish).</span></p>
			<h2 id="_idParaDest-522"><a id="_idTextAnchor603"/>Getting ready</h2>
			<p>We will require developer mode to be turned on. If it hasn’t previously been enabled, do it in the manner described in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment</em>, in the <em class="italic">Activating the Odoo developer tools</em> recipe, where you installed the Odoo <span class="No-Break">development environment.</span></p>
			<h2 id="_idParaDest-523"><a id="_idTextAnchor604"/>How to do it...</h2>
			<p>Follow these steps to change a language’s <span class="No-Break">locale settings:</span></p>
			<ol>
				<li>Select the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Languages</strong> menu option to view the installed languages and their options. A form with the necessary options will open when you click on one of the <span class="No-Break">installed languages:</span></li>
			</ol>
			<div>
				<div id="_idContainer080" class="IMG---Figure">
					<img src="image/B20997_11_6.jpg" alt="Figure 11.6 – Form to configure language settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Form to configure language settings</p>
			<ol>
				<li value="2">Edit the language settings. To change the date to the ISO format, change <strong class="bold">Date Format</strong> to <strong class="source-inline">%Y-%m-%d</strong>. To change the number format to use a comma as a decimal separator, modify the <strong class="bold">Decimal Separator</strong> and <strong class="bold">Thousands Separator</strong> <span class="No-Break">fields accordingly.</span></li>
			</ol>
			<h2 id="_idParaDest-524"><a id="_idTextAnchor605"/>How it works...</h2>
			<p>The <a id="_idIndexMarker776"/>user language is selected in the user preferences and placed <a id="_idIndexMarker777"/>in the <strong class="bold">lang</strong> context key when logging in and initiating a new Odoo user session. By translating the source texts into the user language and formatting the dates and numbers as per the language’s current locale settings, the output is <span class="No-Break">prepared accordingly.</span></p>
			<h2 id="_idParaDest-525"><a id="_idTextAnchor606"/>There’s more...</h2>
			<p>Server-side processes can modify the context in which actions are run. For example, to get a record where the dates are formatted according to the American English format, independent of the current user’s language preference, you can do <span class="No-Break">the following:</span></p>
			<pre class="source-code">
en_records = self.with_context(lang='en_US').search([])</pre>			<p>For more details, refer to the <em class="italic">Calling a method with a modified context</em> recipe in <a href="B20997_08.xhtml#_idTextAnchor388"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Advanced Server-Side </em><span class="No-Break"><em class="italic">Development Techniques</em></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-526"><a id="_idTextAnchor607"/>Text translation using a web client user interface</h1>
			<p>The <a id="_idIndexMarker778"/>simplest way to translate is to use the translation feature provided by the web client. These translation strings are stored<a id="_idIndexMarker779"/> in the database and can later be exported to a <strong class="source-inline">.po</strong> file, either to be included in an add-on module or just to be imported <span class="No-Break">back manually.</span></p>
			<p>Text fields can have translatable content, meaning that their value will depend on the current user’s language. We will also see how to set the language-dependent values on <span class="No-Break">these fields.</span></p>
			<h2 id="_idParaDest-527"><a id="_idTextAnchor608"/>Getting ready</h2>
			<p>We will need to have developer mode activated. If it’s not, activate it, as shown in the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo </em><span class="No-Break"><em class="italic">Development Environment</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-528"><a id="_idTextAnchor609"/>How to do it...</h2>
			<p>We will demonstrate how to translate terms through the web client using the <strong class="bold">User Groups</strong> feature as <span class="No-Break">an example:</span></p>
			<ol>
				<li>Navigate to the screen you want to translate. As an example, we will open the <strong class="bold">Groups</strong> view via the <strong class="bold">Settings</strong> | <strong class="bold">Users &amp; Companies</strong> | <strong class="bold">Groups</strong> <span class="No-Break">menu item:</span></li>
			</ol>
			<div>
				<div id="_idContainer081" class="IMG---Figure">
					<img src="image/B20997_11_7.jpg" alt="Figure 11.7 – Translation for groups"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Translation for groups</p>
			<ol>
				<li value="2">Open <a id="_idIndexMarker780"/>one of the group records <a id="_idIndexMarker781"/>in the form view, and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Edit</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer082" class="IMG---Figure">
					<img src="image/B20997_11_8.jpg" alt="Figure 11.8 – Translation for the field values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – Translation for the field values</p>
			<ol>
				<li value="3">Note that the <strong class="bold">Name</strong> field has a special icon on the far right. This indicates that it is a translatable field. Clicking on this icon opens a <strong class="bold">Translate</strong> list with the different installed languages. This allows us to set the translation for each of <span class="No-Break">those languages:</span></li>
			</ol>
			<div>
				<div id="_idContainer083" class="IMG---Figure">
					<img src="image/B20997_11_9.jpg" alt="Figure 11.9 – Translation for the field values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – Translation for the field values</p>
			<h2 id="_idParaDest-529"><a id="_idTextAnchor610"/>How it works…</h2>
			<p>All <a id="_idIndexMarker782"/>translated terms <a id="_idIndexMarker783"/>are saved in the name field of any mode/table. In our example, <strong class="bold">Access Rights</strong> belongs to the <strong class="source-inline">res_groups</strong> table; when you check the information stored in the name field, it will be saved as a dictionary, where the key is the language code and the value is the <span class="No-Break">translated phrases:</span></p>
			<div>
				<div id="_idContainer084" class="IMG---Figure">
					<img src="image/B20997_11_10.jpg" alt="Figure 11.10 – Translation for the field values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – Translation for the field values</p>
			<h1 id="_idParaDest-530"><a id="_idTextAnchor611"/>Exporting translation strings to a file</h1>
			<p>Translation strings <a id="_idIndexMarker784"/>can be exported with or without the translated texts for a selected language. This can either be to include <strong class="source-inline">i18n</strong> data in a module or to later perform translations with a text editor or perhaps with a <span class="No-Break">specialized tool.</span></p>
			<p>We will demonstrate how to do this using our custom <strong class="source-inline">My Hostel</strong> module, so feel free to replace <strong class="source-inline">My Hostel</strong> with your <span class="No-Break">own module.</span></p>
			<h2 id="_idParaDest-531"><a id="_idTextAnchor612"/>Getting ready</h2>
			<p>We will need <a id="_idIndexMarker785"/>to have developer mode activated. If it’s not already activated, activate it, as demonstrated in the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo </em><span class="No-Break"><em class="italic">Development Environment</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-532"><a id="_idTextAnchor613"/>How to do it…</h2>
			<p>To export the translation terms for the <strong class="source-inline">my_hostel</strong> module, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>In the web client user interface, from the <strong class="bold">Settings</strong> top menu, select the <strong class="bold">Translations</strong> | <strong class="bold">Import/Export</strong> | <strong class="bold">Export Translation</strong> <span class="No-Break">menu option.</span></li>
				<li>In the <strong class="bold">Export Translations</strong> dialogue box, choose the language translation to export, the file format, and the modules to export. To export a translation template file, select <strong class="bold">New Language (Empty translation template)</strong> from the <strong class="bold">Language</strong> selection list. It’s recommended to use the <strong class="source-inline">.po</strong> format and to export only one add-on module at a time – the <strong class="bold">My Hostel</strong> module (<strong class="source-inline">my_hostel</strong> is the technical name for the Discuss app), in <span class="No-Break">our example:</span></li>
			</ol>
			<div>
				<div id="_idContainer085" class="IMG---Figure">
					<img src="image/B20997_11_11.jpg" alt="Figure 11.11 – Dialogue to export translation terms"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – Dialogue to export translation terms</p>
			<ol>
				<li value="3">In <a id="_idIndexMarker786"/>Odoo version 17, you will find a new option in the export settings called <strong class="bold">Export Type</strong>, which contains two options: <strong class="bold">Module</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="bold">Model</strong></span><span class="No-Break">.</span></li>
				<li>setting Module Type to Model will provide the new option to select a specific model with a filter option, using which the user can export only specific <span class="No-Break">filter-based records:</span></li>
			</ol>
			<div>
				<div id="_idContainer086" class="IMG---Figure">
					<img src="image/B20997_11_12.jpg" alt="Figure 11.12 – Dialogue to export translation terms"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Dialogue to export translation terms</p>
			<ol>
				<li value="5">Once <a id="_idIndexMarker787"/>the export process is complete, a new window will be displayed, with a link to download the file and some <span class="No-Break">additional advice.</span></li>
				<li>To export a translation template file for the <strong class="source-inline">my_hostel</strong> add-on module from the Odoo command-line interface, enter the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --i18n-export=my_hostel.pot --modules=my_hostel</strong>
<strong class="bold">$ mv my_hostel.po ./addons/my_hostel/i18n/my_hostel .pot</strong></pre></li>				<li>To export<a id="_idIndexMarker788"/> the translation template file for a language – <strong class="source-inline">es_ES</strong> for Spanish, for example – from the Odoo command-line interface, enter the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --i18n-export=es_ES.po --modules=my_hostel</strong>
<strong class="bold">--language=es_ES</strong>
<strong class="bold">$ mv es_ES.po ./addons/my_hostel/i18n</strong></pre></li>			</ol>
			<h2 id="_idParaDest-533"><a id="_idTextAnchor614"/>How it works...</h2>
			<p>The <strong class="bold">Export Translation</strong> feature <a id="_idIndexMarker789"/>extracts the translatable strings from the target modules and then creates a file with the translation terms. This can be done both from the web client and the <span class="No-Break">command-line interface.</span></p>
			<p>When exporting from the web client, we can choose to either export an empty translation template – that is, a file with the strings to translate, along with empty translations – or export a language, resulting in a file with the strings to translate, along with the translation for the <span class="No-Break">selected language.</span></p>
			<p>The available file formats are CSV, PO, and TGZ. The TGZ file format exports a compressed file that contains a <strong class="source-inline">&lt;name&gt;/i18n/</strong> directory structure with the PO or <span class="No-Break">POT file.</span></p>
			<p>The CSV format can be useful for performing translations using a spreadsheet, but the format to use in the add-on modules is PO files. These are expected to be placed inside the <strong class="source-inline">i18n</strong> subdirectory. They are then automatically loaded once the corresponding language is installed. When exporting these PO files, we should export only one module at a time. The PO file is also a popular format supported by translation tools, such <span class="No-Break">as Poedit.</span></p>
			<p>Translations can also <a id="_idIndexMarker790"/>be exported directly from the command line by using the <strong class="source-inline">--i18n-export</strong> option. This recipe shows how to extract both the template files and the translated <span class="No-Break">language files.</span></p>
			<p>In <em class="italic">Step 4</em> of this recipe, we exported a template file. The <strong class="source-inline">--i18n-export</strong> option expects the path and the filename to export. Bear in mind that the file extension is required to be either CSV, PO, or TGZ. This option requires the <strong class="source-inline">-d</strong> option, which specifies the database<a id="_idIndexMarker791"/> to use. The <strong class="source-inline">--modules</strong> option is also needed to indicate the add-on modules to export. Note that the <strong class="source-inline">--stop-after-init</strong> option is not needed since the <strong class="source-inline">export</strong> command automatically returns to the command line <span class="No-Break">when finished.</span></p>
			<p>This exports a template file. The Odoo module expects this exported template in the <strong class="source-inline">i18n</strong> folder with the <strong class="source-inline">.pot</strong> extension. When working on a module, after the export operation, we usually want to move the exported PO file to the module’s <strong class="source-inline">i18n</strong> directory with a <strong class="source-inline">&lt;</strong><span class="No-Break"><strong class="source-inline">module&gt;.pot</strong></span><span class="No-Break"> name.</span></p>
			<p>In <em class="italic">Step 5</em>, the <strong class="source-inline">–language</strong> option was also used. With it, instead of an empty translation file, the translated terms for the selected language were also exported. One use case for this is to perform some translations through the web client user interface using the <strong class="bold">Technical Translation</strong> feature, and then export and include them in <span class="No-Break">the module.</span></p>
			<h2 id="_idParaDest-534"><a id="_idTextAnchor615"/>There’s more…</h2>
			<p>Text strings in view and model definitions are automatically extracted for translation. For models, the <strong class="source-inline">_description</strong> attribute, the field names (the <strong class="source-inline">string</strong> attribute), help text, and selection field options are extracted, as well as the user texts for model constraints (<strong class="source-inline">_constraints</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">_sql_constraints</strong></span><span class="No-Break">).</span></p>
			<p>Text strings to translate inside Python or JavaScript code can’t be automatically detected, so the code should identify those strings, wrapping them inside the <span class="No-Break">underscore function.</span></p>
			<p>In Python’s module file, we should ensure that the file is imported with <span class="No-Break">the following:</span></p>
			<pre class="source-code">
from odoo import _</pre>			<p>This file can then be used wherever a translatable text is used with something <span class="No-Break">like this:</span></p>
			<pre class="source-code">
_('Hello World')</pre>			<p>For strings that use additional context information, we should use Python string interpolation, as <span class="No-Break">shown here:</span></p>
			<pre class="source-code">
_('Hello %s') % 'World'</pre>			<p>Note that the interpolation should go outside the translation function. For example, <strong class="source-inline">_("Hello %s" % 'World')</strong> is wrong. String interpolations should also be preferred to string concatenation so that each interface text is just one <span class="No-Break">translation string.</span></p>
			<p>Be careful with the <strong class="source-inline">Selection</strong> fields! If you pass an explicit list of values to the field definition, the <a id="_idIndexMarker792"/>displayed strings are automatically flagged for translation. On the other hand, if you pass a method that returns the list of values, the display strings must be explicitly marked <span class="No-Break">for translation.</span></p>
			<p>Regarding manual translation work, any text file editor will do so, but using an editor that specifically supports the PO file syntax makes this work easier by reducing the risk of formatting errors. Such editors<a id="_idIndexMarker793"/> include those <span class="No-Break">listed here:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="bold">POEDIT</strong></span><span class="No-Break">: </span><a href="https://poedit.net/&#13;"><span class="No-Break">https://poedit.net/</span></a></li>
				<li><strong class="bold">Emacs (</strong><span class="No-Break"><strong class="bold">PO-mode)</strong></span><span class="No-Break">: </span><a href="https://www.gnu.org/software/gettext/manual/html_node/PO-Mode.html"><span class="No-Break">https://www.gnu.org/software/gettext/manual/html_node/PO-Mode.html</span></a><a href="https://www.gnu.org/software/gettext/manual/html_node/PO-Mode.html&#13;"/></li>
				<li><span class="No-Break"><strong class="bold">Lokalize</strong></span><span class="No-Break">: </span><a href="https://l10n.kde.org/tools/"><span class="No-Break">https://l10n.kde.org/tools/</span></a><a href="http://i18n.kde.org/tools&#13;"/></li>
				<li><span class="No-Break"><strong class="bold">Gtranslator</strong></span><span class="No-Break">: </span><a href="https://wiki.gnome.org/Apps/Gtranslator&#13;"><span class="No-Break">https://wiki.gnome.org/Apps/Gtranslator</span></a></li>
			</ul>
			<h1 id="_idParaDest-535"><a id="_idTextAnchor616"/>Using gettext tools to make translations easier</h1>
			<p>The PO file <a id="_idIndexMarker794"/>format is part of the <strong class="source-inline">gettext</strong> i18n and<a id="_idIndexMarker795"/> localization system that’s commonly used in Unix-like systems. This system includes tools to ease <span class="No-Break">translation work.</span></p>
			<p>This recipe demonstrates how to use these tools to help translate our add-on modules. We want to use it on a custom module, so the <strong class="source-inline">my_hostel</strong> module we created in <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>, is a good candidate. However, feel free to replace it with some other custom module you have at hand, replacing the tutorials’ <strong class="source-inline">my_hostel</strong> references <span class="No-Break">as appropriate.</span></p>
			<h2 id="_idParaDest-536"><a id="_idTextAnchor617"/>How to do it...</h2>
			<p>To <a id="_idIndexMarker796"/>manage translations from the command line, assuming that your Odoo installation is at <strong class="source-inline">~/odoo-work/odoo</strong>, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Create<a id="_idIndexMarker797"/> a compendium of translation terms for the target language – for example, Spanish. If we name our compendium file <strong class="source-inline">odoo_es.po</strong>, we should write the <span class="No-Break">following code:</span><pre class="source-code">
<strong class="bold">$ cd ~/odoo-work/odoo  # Use the path to your Odoo installation</strong>
<strong class="bold">$ find ./ -name es_ES.po | xargs msgcat --use-first | msgattrib</strong>
<strong class="bold">--translated  --no-fuzzy \ -o ./odoo_es.po</strong></pre></li>				<li>Export the translation template file for the add-on module from the Odoo command-line interface and place it in the module’s <span class="No-Break">expected location:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --i18n-export=my_module.po --modules=my_module</strong>
<strong class="bold">$ mv my_module.po ./addons/my_module/i18n/my_module.pot</strong></pre></li>				<li>If no translation file is available yet for the target language, create the PO translation file, reusing the terms that have been already found and translated in <span class="No-Break">the compendium:</span><pre class="source-code">
<strong class="bold">$ msgmerge --compendium ./odoo_es.po -o</strong>
<strong class="bold">./addons/my_module/i18n/es_ES.po \</strong>
<strong class="bold">/dev/null ./addons/my_module/i18n/my_module.pot</strong></pre></li>				<li>If a translation file exists, add the translations that can be found in <span class="No-Break">the compendium:</span><pre class="source-code">
<strong class="bold">$ mv ./addons/my_module/i18n/es_ES.po /tmp/my_module_es_old.po</strong>
<strong class="bold">$ msgmerge --compendium ./odoo_es.po -o./addons/my_module/i18n/es_ES.po</strong>
<strong class="bold">\ /tmp/my_module_es_old.po ./addons/my_module/i18n/my_module.pot</strong>
<strong class="bold">$ rm /tmp/my_module_es_old.po</strong></pre></li>				<li>To take<a id="_idIndexMarker798"/> a peek at the untranslated <a id="_idIndexMarker799"/>terms in a PO file, use the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ msgattrib --untranslated ./addons/my_module/i18n/es_ES.po</strong></pre></li>				<li>Use your favorite editor to complete <span class="No-Break">the translation.</span></li>
			</ol>
			<h2 id="_idParaDest-537"><a id="_idTextAnchor618"/>How it works...</h2>
			<p><em class="italic">Step 1</em> uses commands from the <strong class="source-inline">gettext</strong> toolbox to create a translation compendium for the chosen language – Spanish, in our case. It works by finding all the <strong class="source-inline">es_ES.po</strong> files in the Odoo code base and passing them to the <strong class="source-inline">msgcat</strong> command. We use the <strong class="source-inline">--use-first</strong> flag to avoid conflicting translations (there are a few in the Odoo code base). The result is passed to the <strong class="source-inline">msgattrib</strong> filter. We use the <strong class="source-inline">--translated</strong> option to filter out the untranslated entries and the <strong class="source-inline">--no-fuzzy</strong> option to remove fuzzy translations. We then save the result <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">odoo_es.po</strong></span><span class="No-Break">.</span></p>
			<p><em class="italic">Step 2</em>  calls <strong class="source-inline">odoo.py</strong> with the <strong class="source-inline">--i18n-export</strong> option. You need to specify a database on the command line, even if one is specified in the configuration file and the <strong class="source-inline">--modules</strong> option, with a comma-separated list of modules to export <span class="No-Break">the translation.</span></p>
			<p>In the <strong class="source-inline">gettext</strong> world, fuzzy translations are those created automatically by the <strong class="source-inline">msgmerge</strong> command (or other tools) using a proximity match on the source string. We want to avoid these in <span class="No-Break">the compendium.</span></p>
			<p><em class="italic">Step 3</em> creates<a id="_idIndexMarker800"/> a new translation file by using existing <a id="_idIndexMarker801"/>translated values found in the compendium. The <strong class="source-inline">msgmerge</strong> command is used with the <strong class="source-inline">--compendium</strong> option to find the <strong class="source-inline">msgid</strong> lines in the compendium files, matching those in the translation template file generated in <em class="italic">Step 2</em>. The result is saved in the <span class="No-Break"><strong class="source-inline">es_ES.po</strong></span><span class="No-Break"> file.</span></p>
			<p>If you have a preexisting <strong class="source-inline">.po</strong> file for your add-on with translations that you would like to preserve, you should rename it and replace the <strong class="source-inline">/dev/null</strong> argument with this file. The renaming procedure is required to avoid using the same file for input <span class="No-Break">and output.</span></p>
			<h2 id="_idParaDest-538"><a id="_idTextAnchor619"/>There’s more...</h2>
			<p>This tutorial only skims the surface of the rich tools that are available with the GNU <strong class="source-inline">gettext</strong> toolbox. Full coverage is well beyond the scope of this book. If you are interested, the GNU <strong class="source-inline">gettext</strong> documentation contains a wealth of precious information about PO file manipulation and is available <span class="No-Break">at </span><a href="http://www.gnu.org/software/gettext/manual/gettext.html"><span class="No-Break">http://www.gnu.org/software/gettext/manual/gettext.html</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-539"><a id="_idTextAnchor620"/>Importing translation files into Odoo</h1>
			<p>The standard <a id="_idIndexMarker802"/>method for loading translations is to store PO files in the module’s <strong class="source-inline">i18n</strong> subfolder. The translation files are loaded and additional translated strings are added whenever the add-on module is installed <span class="No-Break">or updated.</span></p>
			<p>However, there may be cases where we want to directly import a translation file. In this recipe, we will learn how to load a translation file, either from the web client or from the <span class="No-Break">command line.</span></p>
			<h2 id="_idParaDest-540"><a id="_idTextAnchor621"/>Getting ready</h2>
			<p>We need to have developer mode activated. If it’s not activated already, activate it, as demonstrated in the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment</em>. We will also need a translation <strong class="source-inline">po</strong> file, which we are going import in this tutorial – for example, the <span class="No-Break"><strong class="source-inline">myfile.po</strong></span><span class="No-Break"> file.</span></p>
			<h2 id="_idParaDest-541"><a id="_idTextAnchor622"/>How to do it...</h2>
			<p>To import the<a id="_idIndexMarker803"/> translation terms, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>In the web client user interface, from the <strong class="bold">Settings</strong> top menu, select the <strong class="bold">Translations</strong> | <strong class="bold">Import/Export</strong> | <strong class="bold">Import Translation</strong> <span class="No-Break">menu option.</span></li>
				<li>In the <strong class="bold">Import Translations</strong> dialogue box, fill out the language name and the language code, and select the file to import. Finally, click on the <span class="No-Break"><strong class="bold">Import</strong></span><span class="No-Break"> button:</span></li>
			</ol>
			<div>
				<div id="_idContainer087" class="IMG---Figure">
					<img src="image/B20997_11_13.jpg" alt="Figure 11.13 – Dialogue to import a translation file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – Dialogue to import a translation file</p>
			<ol>
				<li value="3">To import a translation file from the Odoo command-line interface, we must place it inside the server add-ons path and then perform <span class="No-Break">the import:</span><pre class="source-code">
<strong class="bold">$ mv myfile.po ./addons/</strong>
<strong class="bold">$ ./odoo.py -d mydb --i18n-import="myfile.po" --lang=fr_BE</strong></pre></li>			</ol>
			<h2 id="_idParaDest-542"><a id="_idTextAnchor623"/>How it works...</h2>
			<p><strong class="bold">Import Translation</strong> reads <a id="_idIndexMarker804"/>a PO or CSV file and inserts the translation strings into the appropriate table. Previously, it was stored in the <strong class="source-inline">ir.translation</strong> table, but in newer versions of Odoo, that table is no longer present. As a result, all view-level translations for <strong class="source-inline">arch_db</strong>, such as button strings and selection field values, will be stored in the <strong class="source-inline">ir_ui_view</strong> table, and all field-level translations, such as field labels, will be stored in the <strong class="source-inline">ir_model_fields</strong> table under the <span class="No-Break"><strong class="source-inline">field_description</strong></span><span class="No-Break"> field.</span></p>
			<p>For example, our<a id="_idIndexMarker805"/> hostel table has a <strong class="source-inline">room_number</strong> model. Its field translation of “Room Number” will be stored at the database level as <strong class="source-inline">{"en_US": "Room Number", "fr_BE": "Numéro </strong><span class="No-Break"><strong class="source-inline">de chambre"}</strong></span><span class="No-Break">.</span></p>
			<p>The web client feature asks for the language name, but this is not used in the import process. It also has an overwrite option. If selected, it forces all the translation strings to be imported, even the ones that already exist, overwriting them in <span class="No-Break">the process.</span></p>
			<p>On the command line, the import can be done using the <strong class="source-inline">--i18n-import</strong> option. It must be provided with the path to the file, relative to an add-on’s path directory; <strong class="source-inline">-d</strong> and <strong class="source-inline">--language</strong> (or <strong class="source-inline">-l</strong>) are mandatory. Overwriting can also be achieved by adding the <strong class="source-inline">--i18n-overwrite</strong> option to the command. Note that we didn’t use the <strong class="source-inline">--stop-after-init</strong> option here. It isn’t needed since the import action stops the server when <span class="No-Break">it finishes.</span></p>
			<h1 id="_idParaDest-543"><a id="_idTextAnchor624"/>Altering a website’s custom language URL code</h1>
			<p>Odoo <a id="_idIndexMarker806"/>also supports multiple languages for websites. On a website, the current language is identified as a language string. In this recipe, you will learn how to change the language code in <span class="No-Break">a URL.</span></p>
			<h2 id="_idParaDest-544"><a id="_idTextAnchor625"/>Getting ready</h2>
			<p>Before following this recipe, make sure you have installed the <strong class="source-inline">website</strong> module and enabled multiple languages for <span class="No-Break">the website.</span></p>
			<h2 id="_idParaDest-545"><a id="_idTextAnchor626"/>How to do it...</h2>
			<p>To <a id="_idIndexMarker807"/>modify a language’s URL code, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Open the language list from the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Languages</strong> menu option. Clicking on one of the installed languages will open a form that looks <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer088" class="IMG---Figure">
					<img src="image/B20997_11_14.jpg" alt="Figure 11.14 – Language URL code for a website"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Language URL code for a website</p>
			<ol>
				<li value="2">Here, you will see the <strong class="bold">URL Code</strong> field. Set the value that you want. Make sure you don’t add spaces or special <span class="No-Break">characters here.</span></li>
			</ol>
			<p>After configuring this, you can test the results on your website. Open the home page and change the language; you will see the custom language code in <span class="No-Break">the URL.</span></p>
			<h2 id="_idParaDest-546"><a id="_idTextAnchor627"/>How it works...</h2>
			<p>Odoo identifies the languages for a website via the URL path. For example, <a href="https://www.odoo.com/fr_FR">www.odoo.com/fr_FR</a> is used for the French language and <a href="https://www.odoo.com/es_ES">www.odoo.com/es_ES</a> is used for the Spanish language. Here, the <strong class="source-inline">fr_FR</strong> and <strong class="source-inline">es_ES</strong> parts of the URL are the language ISO codes, and they are used by Odoo to detect the requested language. But sometimes, you want to set the language in a more user-friendly way. In that case, you can update the <strong class="bold">URL Code</strong> field. Once you have changed that, the Odoo website will use the <strong class="bold">URL Code</strong> value to identify the <a id="_idIndexMarker808"/>language. For example, you could set <strong class="bold">URL Code</strong> to <strong class="source-inline">fr</strong> for the French language. In this case, <a href="http://www.odoo.com/fr_FR">www.odoo.com/fr_FR</a> would be converted <span class="No-Break">into </span><a href="http://www.odoo.com/fr"><span class="No-Break">www.odoo.com/fr</span></a><span class="No-Break">.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Changing the URL code in production is not a problem; Odoo will automatically redirect the URL containing the language ISO code to your <span class="No-Break">custom URL.</span></p>
		</div>
	</body></html>