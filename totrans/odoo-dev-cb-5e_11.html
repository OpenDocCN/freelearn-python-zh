<html><head></head><body>
		<div><h1 id="_idParaDest-515" class="chapter-number"><a id="_idTextAnchor595"/>11</h1>
			<h1 id="_idParaDest-516"><a id="_idTextAnchor596"/>Internationalization</h1>
			<p>Odoo supports a <a id="_idIndexMarker764"/>variety of languages and enables users to use the language(s) with which they are most comfortable. The Odoo i18n features that are already built-in help with this. With string translations, Odoo also supports date and time formatting.</p>
			<p>In this chapter, you will discover how to upload translation files to your modules and enable various languages. Due to the diversity of countries and the prevalence of local languages, users often find it easier to connect with a system when it’s presented in their native tongue. To accommodate this, Odoo offers a feature that enables software text to be translated into the user’s preferred language. This functionality enhances the user experience by ensuring that the interface is accessible and comprehensible to individuals, regardless of their linguistic background, thereby promoting wider adoption and usability of the software across various regions and demographics. Utilizing these new functionalities will enhance the Odoo user experience.</p>
			<p>The following recipes will be covered in this chapter:</p>
			<ul>
				<li>Setting up a language installation and user preference settings</li>
				<li>Setting up options relating to language</li>
				<li>Text translation using a web client user interface</li>
				<li>Exporting translation into a file<a id="_idTextAnchor597"/></li>
				<li>Using <code>gettext</code> tools to make translations easier</li>
				<li>Importing translation files into Odoo</li>
				<li>Altering a website’s custom language URL code</li>
			</ul>
			<p>Many of these recipes can be completed either from the web client user interface or from the command line. Wherever possible, we will see how to use both of these options. Odoo uses Transifex(Odoo) and Weblate (OCA) translation platforms.</p>
			<h1 id="_idParaDest-517"><a id="_idTextAnchor598"/>Setting up a language installation and user preference settings</h1>
			<p>Odoo <a id="_idIndexMarker765"/>can be localized to accommodate various languages and locale settings, including date and number formats.</p>
			<p>The only<a id="_idIndexMarker766"/> language that is initially installed is the standard English language. We need to install various localities and languages so that people may utilize them. This recipe describes how user preferences are implemented, as well as how they may be established.</p>
			<h2 id="_idParaDest-518"><a id="_idTextAnchor599"/>How to do it…</h2>
			<p>Activate developer mode and follow these steps to install a new language in an Odoo instance:</p>
			<ol>
				<li>Go to <strong class="bold">Settings</strong> | <strong class="bold">General Settings</strong> | <strong class="bold">Language</strong>. Here, you will see the <strong class="bold">Add Language</strong> link, as shown in the following screenshot. Click on that link; a dialogue box will open where you can load languages:</li>
			</ol>
			<div><div><img src="img/B20997_11_1.jpg" alt="Figure 11.1 – Language options in the general settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – Language options in the general settings</p>
			<ol>
				<li value="2">Select the language you want to load:</li>
			</ol>
			<div><div><img src="img/B20997_11_2.jpg" alt="Figure 11.2 – Dialogue to load a language"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Dialogue to load a language</p>
			<ol>
				<li value="3">Clicking<a id="_idIndexMarker767"/> on <strong class="bold">Add</strong> will load the selected language, and <a id="_idIndexMarker768"/>the confirmation dialogue box will open, as follows:</li>
			</ol>
			<div><div><img src="img/B20997_11_3.jpg" alt="Figure 11.3 – Dialogue that shows a language has been loaded"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Dialogue that shows a language has been loaded</p>
			<ol>
				<li value="4">New languages can also be installed from the command line. The equivalent command for the preceding steps is as follows:<pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --load-language=es_ES</strong></pre></li>				<li>To set the language that’s used by a user, go to <strong class="bold">Settings</strong> | <strong class="bold">Users &amp; Companies</strong> | <strong class="bold">Users</strong>, and, in the <strong class="bold">Preferences</strong> tab of the <strong class="bold">User</strong> form, set the <strong class="bold">Language</strong> field value:</li>
			</ol>
			<div><div><img src="img/B20997_11_4.jpg" alt="Figure 11.4 – User’s form to set the language"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – User’s form to set the language</p>
			<p>Through <a id="_idIndexMarker769"/>the <strong class="bold">Preferences</strong> menu item, users may easily change these <a id="_idIndexMarker770"/>variables on their own. They may access this by clicking on their username in the top-right corner of the web client window:</p>
			<div><div><img src="img/B20997_11_5.jpg" alt="Figure 11.5– Preferences option to set the language"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5– Preferences option to set the language</p>
			<h2 id="_idParaDest-519"><a id="_idTextAnchor600"/>How it works...</h2>
			<p>Users can<a id="_idIndexMarker771"/> have their own language and time zone preferences. The<a id="_idIndexMarker772"/> language settings are used to translate user interface text into the chosen language and apply local conventions for float and monetary fields.</p>
			<p>Before a language is made available for the user to select, it must be installed with the <strong class="bold">Add language</strong> option. The list of available languages can be seen by going to the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Languages</strong> menu option in developer mode. The ones with the active flag set are installed.</p>
			<p>Each Odoo add-on module is responsible for providing translation resources, which should be placed inside an <code>i18n</code> subdirectory. Each language’s data should be in a <code>.po</code> file. In our example, for the Spanish language, the translation data is loaded from the <code>es_ES.po</code> data file.</p>
			<p>Odoo also supports the notion of a <code>es.po</code> file for Spanish and an <code>es_MX.po</code> file for Mexican Spanish, then <code>es.po</code> is detected as the base language for <code>es_MX.po</code>. When the Mexican Spanish language is installed, both data files are loaded; first the one for the base language and then the specific language. Therefore, in our case, the Mexican Spanish translation file simply has to contain the strings that are unique to the language variety.</p>
			<p>The <code>i18n</code> subdirectory is also expected to have a <code>&lt;module_name&gt;.pot</code> file, providing a template for translations and containing all the translatable strings. The <em class="italic">Exporting translation strings to a file</em> recipe of this chapter explains how to export the translatable strings to generate this file.</p>
			<p>In previous versions of Odoo, when an additional language is installed, the corresponding resources are loaded from all installed add-on modules and stored in the <strong class="bold">Translated Terms</strong> model. Its data can be viewed (and edited) within the <strong class="bold">Settings</strong> | <strong class="bold">Translations </strong>| <strong class="bold">Application Terms</strong> | <strong class="bold">Translated Terms</strong> menu option (note that this menu is only visible in developer mode).</p>
			<p>From Odoo version 17 onwards, you won’t be able to find this menu as translated terms are now stored as native terms. Any field that is translatable now stores JSON data representing all translations of all translated language values. For example, translations of product names are now stored directly in the <code>name</code> field. The process of translations has not changed – you just can’t see the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Application Terms</strong> | <strong class="bold">Translated Terms</strong> menu item with all translated terms shown in a list.</p>
			<p>Translation files for the<a id="_idIndexMarker773"/> installed languages are also loaded when a new add-on module is installed or an existing add-on module is upgraded.</p>
			<h2 id="_idParaDest-520"><a id="_idTextAnchor601"/>There’s more...</h2>
			<p>By selecting <a id="_idIndexMarker774"/>the refresh symbol again next to the languages, translation files may be refreshed without you having to upgrade the add-on modules. You can do this if your translation files have been changed and you don’t want to deal with updating the modules (and all of their dependencies).</p>
			<p>If the <strong class="bold">Overwrite Existing Terms</strong> checkbox is left empty, only the newly translated strings are loaded. Thus, the changed translated strings won’t be loaded. Check the box if you want the already-existing translations to also be loaded and overwrite the currently loaded translations. Note that this can potentially be problematic if someone changes the translations manually through the interface.</p>
			<p>The <strong class="bold">Overwrite Existing Terms</strong> checkbox exists because we can edit specific translations by going to the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Application Terms</strong> | <strong class="bold">Translated Terms</strong> menu item, or by using the <strong class="bold">Technical Translation</strong> shortcut option in the <strong class="bold">Debug</strong> menu. Translations that are added or modified in this way won’t be overwritten unless the language is reloaded with the <strong class="bold">Overwrite Existing Terms</strong> checkbox enabled.</p>
			<p>It can be useful to know that add-on modules can also have an <code>i18n_extra</code> subdirectory with extra translations. First, the <code>.po</code> files in the <code>i18n</code> subdirectory are downloaded. Then, Odoo ORM downloads files for the base language and, after that, for the language variant. Following this, the <code>.po</code> files in the <code>i18n_extra</code> subdirectory are downloaded, first for the base language and then for the language variant. The final string translation that is loaded is the one that ultimately takes precedence.</p>
			<h1 id="_idParaDest-521"><a id="_idTextAnchor602"/>Setting up options relating to language</h1>
			<p>The <a id="_idIndexMarker775"/>locale settings should be the right ones, so long as the user is using the correct language, because they come with suitable defaults.</p>
			<p>You may still want to change a language’s settings, though. For instance, you could opt to use the user interface’s default English language setting while changing the American date and number formats to better suit your needs.</p>
			<p>Additionally, locale settings such as date and number formats are provided by languages and their variants (such as <code>es_MX</code> for Mexican Spanish).</p>
			<h2 id="_idParaDest-522"><a id="_idTextAnchor603"/>Getting ready</h2>
			<p>We will require developer mode to be turned on. If it hasn’t previously been enabled, do it in the manner described in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, in the <em class="italic">Activating the Odoo developer tools</em> recipe, where you installed the Odoo development environment.</p>
			<h2 id="_idParaDest-523"><a id="_idTextAnchor604"/>How to do it...</h2>
			<p>Follow these steps to change a language’s locale settings:</p>
			<ol>
				<li>Select the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Languages</strong> menu option to view the installed languages and their options. A form with the necessary options will open when you click on one of the installed languages:</li>
			</ol>
			<div><div><img src="img/B20997_11_6.jpg" alt="Figure 11.6 – Form to configure language settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Form to configure language settings</p>
			<ol>
				<li value="2">Edit the language settings. To change the date to the ISO format, change <code>%Y-%m-%d</code>. To change the number format to use a comma as a decimal separator, modify the <strong class="bold">Decimal Separator</strong> and <strong class="bold">Thousands Separator</strong> fields accordingly.</li>
			</ol>
			<h2 id="_idParaDest-524"><a id="_idTextAnchor605"/>How it works...</h2>
			<p>The <a id="_idIndexMarker776"/>user language is selected in the user preferences and placed <a id="_idIndexMarker777"/>in the <strong class="bold">lang</strong> context key when logging in and initiating a new Odoo user session. By translating the source texts into the user language and formatting the dates and numbers as per the language’s current locale settings, the output is prepared accordingly.</p>
			<h2 id="_idParaDest-525"><a id="_idTextAnchor606"/>There’s more...</h2>
			<p>Server-side processes can modify the context in which actions are run. For example, to get a record where the dates are formatted according to the American English format, independent of the current user’s language preference, you can do the following:</p>
			<pre class="source-code">
en_records = self.with_context(lang='en_US').search([])</pre>			<p>For more details, refer to the <em class="italic">Calling a method with a modified context</em> recipe in <a href="B20997_08.xhtml#_idTextAnchor388"><em class="italic">Chapter 8</em></a>, <em class="italic">Advanced Server-Side </em><em class="italic">Development Techniques</em>.</p>
			<h1 id="_idParaDest-526"><a id="_idTextAnchor607"/>Text translation using a web client user interface</h1>
			<p>The <a id="_idIndexMarker778"/>simplest way to translate is to use the translation feature provided by the web client. These translation strings are stored<a id="_idIndexMarker779"/> in the database and can later be exported to a <code>.po</code> file, either to be included in an add-on module or just to be imported back manually.</p>
			<p>Text fields can have translatable content, meaning that their value will depend on the current user’s language. We will also see how to set the language-dependent values on these fields.</p>
			<h2 id="_idParaDest-527"><a id="_idTextAnchor608"/>Getting ready</h2>
			<p>We will need to have developer mode activated. If it’s not, activate it, as shown in the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo </em><em class="italic">Development Environment</em>.</p>
			<h2 id="_idParaDest-528"><a id="_idTextAnchor609"/>How to do it...</h2>
			<p>We will demonstrate how to translate terms through the web client using the <strong class="bold">User Groups</strong> feature as an example:</p>
			<ol>
				<li>Navigate to the screen you want to translate. As an example, we will open the <strong class="bold">Groups</strong> view via the <strong class="bold">Settings</strong> | <strong class="bold">Users &amp; Companies</strong> | <strong class="bold">Groups</strong> menu item:</li>
			</ol>
			<div><div><img src="img/B20997_11_7.jpg" alt="Figure 11.7 – Translation for groups"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Translation for groups</p>
			<ol>
				<li value="2">Open <a id="_idIndexMarker780"/>one of the group records <a id="_idIndexMarker781"/>in the form view, and click on <strong class="bold">Edit</strong>:</li>
			</ol>
			<div><div><img src="img/B20997_11_8.jpg" alt="Figure 11.8 – Translation for the field values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – Translation for the field values</p>
			<ol>
				<li value="3">Note that the <strong class="bold">Name</strong> field has a special icon on the far right. This indicates that it is a translatable field. Clicking on this icon opens a <strong class="bold">Translate</strong> list with the different installed languages. This allows us to set the translation for each of those languages:</li>
			</ol>
			<div><div><img src="img/B20997_11_9.jpg" alt="Figure 11.9 – Translation for the field values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – Translation for the field values</p>
			<h2 id="_idParaDest-529"><a id="_idTextAnchor610"/>How it works…</h2>
			<p>All <a id="_idIndexMarker782"/>translated terms <a id="_idIndexMarker783"/>are saved in the name field of any mode/table. In our example, <code>res_groups</code> table; when you check the information stored in the name field, it will be saved as a dictionary, where the key is the language code and the value is the translated phrases:</p>
			<div><div><img src="img/B20997_11_10.jpg" alt="Figure 11.10 – Translation for the field values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – Translation for the field values</p>
			<h1 id="_idParaDest-530"><a id="_idTextAnchor611"/>Exporting translation strings to a file</h1>
			<p>Translation strings <a id="_idIndexMarker784"/>can be exported with or without the translated texts for a selected language. This can either be to include <code>i18n</code> data in a module or to later perform translations with a text editor or perhaps with a specialized tool.</p>
			<p>We will demonstrate how to do this using our custom <code>My Hostel</code> module, so feel free to replace <code>My Hostel</code> with your own module.</p>
			<h2 id="_idParaDest-531"><a id="_idTextAnchor612"/>Getting ready</h2>
			<p>We will need <a id="_idIndexMarker785"/>to have developer mode activated. If it’s not already activated, activate it, as demonstrated in the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo </em><em class="italic">Development Environment</em>.</p>
			<h2 id="_idParaDest-532"><a id="_idTextAnchor613"/>How to do it…</h2>
			<p>To export the translation terms for the <code>my_hostel</code> module, follow these steps:</p>
			<ol>
				<li>In the web client user interface, from the <strong class="bold">Settings</strong> top menu, select the <strong class="bold">Translations</strong> | <strong class="bold">Import/Export</strong> | <strong class="bold">Export Translation</strong> menu option.</li>
				<li>In the <code>.po</code> format and to export only one add-on module at a time – the <code>my_hostel</code> is the technical name for the Discuss app), in our example:</li>
			</ol>
			<div><div><img src="img/B20997_11_11.jpg" alt="Figure 11.11 – Dialogue to export translation terms"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – Dialogue to export translation terms</p>
			<ol>
				<li value="3">In <a id="_idIndexMarker786"/>Odoo version 17, you will find a new option in the export settings called <strong class="bold">Export Type</strong>, which contains two options: <strong class="bold">Module</strong> and <strong class="bold">Model</strong>.</li>
				<li>setting Module Type to Model will provide the new option to select a specific model with a filter option, using which the user can export only specific filter-based records:</li>
			</ol>
			<div><div><img src="img/B20997_11_12.jpg" alt="Figure 11.12 – Dialogue to export translation terms"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Dialogue to export translation terms</p>
			<ol>
				<li value="5">Once <a id="_idIndexMarker787"/>the export process is complete, a new window will be displayed, with a link to download the file and some additional advice.</li>
				<li>To export a translation template file for the <code>my_hostel</code> add-on module from the Odoo command-line interface, enter the following command:<pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --i18n-export=my_hostel.pot --modules=my_hostel</strong>
<code>es_ES</code> for Spanish, for example – from the Odoo command-line interface, enter the following command:<pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --i18n-export=es_ES.po --modules=my_hostel</strong>
<strong class="bold">--language=es_ES</strong>
<strong class="bold">$ mv es_ES.po ./addons/my_hostel/i18n</strong></pre></li>			</ol>
			<h2 id="_idParaDest-533"><a id="_idTextAnchor614"/>How it works...</h2>
			<p>The <strong class="bold">Export Translation</strong> feature <a id="_idIndexMarker789"/>extracts the translatable strings from the target modules and then creates a file with the translation terms. This can be done both from the web client and the command-line interface.</p>
			<p>When exporting from the web client, we can choose to either export an empty translation template – that is, a file with the strings to translate, along with empty translations – or export a language, resulting in a file with the strings to translate, along with the translation for the selected language.</p>
			<p>The available file formats are CSV, PO, and TGZ. The TGZ file format exports a compressed file that contains a <code>&lt;name&gt;/i18n/</code> directory structure with the PO or POT file.</p>
			<p>The CSV format can be useful for performing translations using a spreadsheet, but the format to use in the add-on modules is PO files. These are expected to be placed inside the <code>i18n</code> subdirectory. They are then automatically loaded once the corresponding language is installed. When exporting these PO files, we should export only one module at a time. The PO file is also a popular format supported by translation tools, such as Poedit.</p>
			<p>Translations can also <a id="_idIndexMarker790"/>be exported directly from the command line by using the <code>--i18n-export</code> option. This recipe shows how to extract both the template files and the translated language files.</p>
			<p>In <em class="italic">Step 4</em> of this recipe, we exported a template file. The <code>--i18n-export</code> option expects the path and the filename to export. Bear in mind that the file extension is required to be either CSV, PO, or TGZ. This option requires the <code>-d</code> option, which specifies the database<a id="_idIndexMarker791"/> to use. The <code>--modules</code> option is also needed to indicate the add-on modules to export. Note that the <code>--stop-after-init</code> option is not needed since the <code>export</code> command automatically returns to the command line when finished.</p>
			<p>This exports a template file. The Odoo module expects this exported template in the <code>i18n</code> folder with the <code>.pot</code> extension. When working on a module, after the export operation, we usually want to move the exported PO file to the module’s <code>i18n</code> directory with a <code>&lt;</code><code>module&gt;.pot</code> name.</p>
			<p>In <em class="italic">Step 5</em>, the <code>–language</code> option was also used. With it, instead of an empty translation file, the translated terms for the selected language were also exported. One use case for this is to perform some translations through the web client user interface using the <strong class="bold">Technical Translation</strong> feature, and then export and include them in the module.</p>
			<h2 id="_idParaDest-534"><a id="_idTextAnchor615"/>There’s more…</h2>
			<p>Text strings in view and model definitions are automatically extracted for translation. For models, the <code>_description</code> attribute, the field names (the <code>string</code> attribute), help text, and selection field options are extracted, as well as the user texts for model constraints (<code>_constraints</code> and <code>_sql_constraints</code>).</p>
			<p>Text strings to translate inside Python or JavaScript code can’t be automatically detected, so the code should identify those strings, wrapping them inside the underscore function.</p>
			<p>In Python’s module file, we should ensure that the file is imported with the following:</p>
			<pre class="source-code">
from odoo import _</pre>			<p>This file can then be used wherever a translatable text is used with something like this:</p>
			<pre class="source-code">
_('Hello World')</pre>			<p>For strings that use additional context information, we should use Python string interpolation, as shown here:</p>
			<pre class="source-code">
_('Hello %s') % 'World'</pre>			<p>Note that the interpolation should go outside the translation function. For example, <code>_("Hello %s" % 'World')</code> is wrong. String interpolations should also be preferred to string concatenation so that each interface text is just one translation string.</p>
			<p>Be careful with the <code>Selection</code> fields! If you pass an explicit list of values to the field definition, the <a id="_idIndexMarker792"/>displayed strings are automatically flagged for translation. On the other hand, if you pass a method that returns the list of values, the display strings must be explicitly marked for translation.</p>
			<p>Regarding manual translation work, any text file editor will do so, but using an editor that specifically supports the PO file syntax makes this work easier by reducing the risk of formatting errors. Such editors<a id="_idIndexMarker793"/> include those listed here:</p>
			<ul>
				<li><strong class="bold">POEDIT</strong>: <a href="https://poedit.net/&#13;">https://poedit.net/</a></li>
				<li><strong class="bold">Emacs (</strong><strong class="bold">PO-mode)</strong>: <a href="https://www.gnu.org/software/gettext/manual/html_node/PO-Mode.html">https://www.gnu.org/software/gettext/manual/html_node/PO-Mode.html</a><a href="https://www.gnu.org/software/gettext/manual/html_node/PO-Mode.html&#13;"/></li>
				<li><strong class="bold">Lokalize</strong>: <a href="https://l10n.kde.org/tools/">https://l10n.kde.org/tools/</a><a href="http://i18n.kde.org/tools&#13;"/></li>
				<li><strong class="bold">Gtranslator</strong>: <a href="https://wiki.gnome.org/Apps/Gtranslator&#13;">https://wiki.gnome.org/Apps/Gtranslator</a></li>
			</ul>
			<h1 id="_idParaDest-535"><a id="_idTextAnchor616"/>Using gettext tools to make translations easier</h1>
			<p>The PO file <a id="_idIndexMarker794"/>format is part of the <code>gettext</code> i18n and<a id="_idIndexMarker795"/> localization system that’s commonly used in Unix-like systems. This system includes tools to ease translation work.</p>
			<p>This recipe demonstrates how to use these tools to help translate our add-on modules. We want to use it on a custom module, so the <code>my_hostel</code> module we created in <a href="B20997_03.xhtml#_idTextAnchor083"><em class="italic">Chapter 3</em></a>, <em class="italic">Creating Odoo Add-On Modules</em>, is a good candidate. However, feel free to replace it with some other custom module you have at hand, replacing the tutorials’ <code>my_hostel</code> references as appropriate.</p>
			<h2 id="_idParaDest-536"><a id="_idTextAnchor617"/>How to do it...</h2>
			<p>To <a id="_idIndexMarker796"/>manage translations from the command line, assuming that your Odoo installation is at <code>~/odoo-work/odoo</code>, follow these steps:</p>
			<ol>
				<li>Create<a id="_idIndexMarker797"/> a compendium of translation terms for the target language – for example, Spanish. If we name our compendium file <code>odoo_es.po</code>, we should write the following code:<pre class="source-code">
<strong class="bold">$ cd ~/odoo-work/odoo  # Use the path to your Odoo installation</strong>
<strong class="bold">$ find ./ -name es_ES.po | xargs msgcat --use-first | msgattrib</strong>
<strong class="bold">--translated  --no-fuzzy \ -o ./odoo_es.po</strong></pre></li>				<li>Export the translation template file for the add-on module from the Odoo command-line interface and place it in the module’s expected location:<pre class="source-code">
<strong class="bold">$ ./odoo-bin -d mydb --i18n-export=my_module.po --modules=my_module</strong>
<strong class="bold">$ mv my_module.po ./addons/my_module/i18n/my_module.pot</strong></pre></li>				<li>If no translation file is available yet for the target language, create the PO translation file, reusing the terms that have been already found and translated in the compendium:<pre class="source-code">
<strong class="bold">$ msgmerge --compendium ./odoo_es.po -o</strong>
<strong class="bold">./addons/my_module/i18n/es_ES.po \</strong>
<strong class="bold">/dev/null ./addons/my_module/i18n/my_module.pot</strong></pre></li>				<li>If a translation file exists, add the translations that can be found in the compendium:<pre class="source-code">
<strong class="bold">$ mv ./addons/my_module/i18n/es_ES.po /tmp/my_module_es_old.po</strong>
<strong class="bold">$ msgmerge --compendium ./odoo_es.po -o./addons/my_module/i18n/es_ES.po</strong>
<strong class="bold">\ /tmp/my_module_es_old.po ./addons/my_module/i18n/my_module.pot</strong>
<strong class="bold">$ rm /tmp/my_module_es_old.po</strong></pre></li>				<li>To take<a id="_idIndexMarker798"/> a peek at the untranslated <a id="_idIndexMarker799"/>terms in a PO file, use the following command:<pre class="source-code">
<strong class="bold">$ msgattrib --untranslated ./addons/my_module/i18n/es_ES.po</strong></pre></li>				<li>Use your favorite editor to complete the translation.</li>
			</ol>
			<h2 id="_idParaDest-537"><a id="_idTextAnchor618"/>How it works...</h2>
			<p><em class="italic">Step 1</em> uses commands from the <code>gettext</code> toolbox to create a translation compendium for the chosen language – Spanish, in our case. It works by finding all the <code>es_ES.po</code> files in the Odoo code base and passing them to the <code>msgcat</code> command. We use the <code>--use-first</code> flag to avoid conflicting translations (there are a few in the Odoo code base). The result is passed to the <code>msgattrib</code> filter. We use the <code>--translated</code> option to filter out the untranslated entries and the <code>--no-fuzzy</code> option to remove fuzzy translations. We then save the result in <code>odoo_es.po</code>.</p>
			<p><em class="italic">Step 2</em>  calls <code>odoo.py</code> with the <code>--i18n-export</code> option. You need to specify a database on the command line, even if one is specified in the configuration file and the <code>--modules</code> option, with a comma-separated list of modules to export the translation.</p>
			<p>In the <code>gettext</code> world, fuzzy translations are those created automatically by the <code>msgmerge</code> command (or other tools) using a proximity match on the source string. We want to avoid these in the compendium.</p>
			<p><em class="italic">Step 3</em> creates<a id="_idIndexMarker800"/> a new translation file by using existing <a id="_idIndexMarker801"/>translated values found in the compendium. The <code>msgmerge</code> command is used with the <code>--compendium</code> option to find the <code>msgid</code> lines in the compendium files, matching those in the translation template file generated in <em class="italic">Step 2</em>. The result is saved in the <code>es_ES.po</code> file.</p>
			<p>If you have a preexisting <code>.po</code> file for your add-on with translations that you would like to preserve, you should rename it and replace the <code>/dev/null</code> argument with this file. The renaming procedure is required to avoid using the same file for input and output.</p>
			<h2 id="_idParaDest-538"><a id="_idTextAnchor619"/>There’s more...</h2>
			<p>This tutorial only skims the surface of the rich tools that are available with the GNU <code>gettext</code> toolbox. Full coverage is well beyond the scope of this book. If you are interested, the GNU <code>gettext</code> documentation contains a wealth of precious information about PO file manipulation and is available at <a href="http://www.gnu.org/software/gettext/manual/gettext.html">http://www.gnu.org/software/gettext/manual/gettext.html</a>.</p>
			<h1 id="_idParaDest-539"><a id="_idTextAnchor620"/>Importing translation files into Odoo</h1>
			<p>The standard <a id="_idIndexMarker802"/>method for loading translations is to store PO files in the module’s <code>i18n</code> subfolder. The translation files are loaded and additional translated strings are added whenever the add-on module is installed or updated.</p>
			<p>However, there may be cases where we want to directly import a translation file. In this recipe, we will learn how to load a translation file, either from the web client or from the command line.</p>
			<h2 id="_idParaDest-540"><a id="_idTextAnchor621"/>Getting ready</h2>
			<p>We need to have developer mode activated. If it’s not activated already, activate it, as demonstrated in the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>. We will also need a translation <code>po</code> file, which we are going import in this tutorial – for example, the <code>myfile.po</code> file.</p>
			<h2 id="_idParaDest-541"><a id="_idTextAnchor622"/>How to do it...</h2>
			<p>To import the<a id="_idIndexMarker803"/> translation terms, follow these steps:</p>
			<ol>
				<li>In the web client user interface, from the <strong class="bold">Settings</strong> top menu, select the <strong class="bold">Translations</strong> | <strong class="bold">Import/Export</strong> | <strong class="bold">Import Translation</strong> menu option.</li>
				<li>In the <strong class="bold">Import Translations</strong> dialogue box, fill out the language name and the language code, and select the file to import. Finally, click on the <strong class="bold">Import</strong> button:</li>
			</ol>
			<div><div><img src="img/B20997_11_13.jpg" alt="Figure 11.13 – Dialogue to import a translation file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – Dialogue to import a translation file</p>
			<ol>
				<li value="3">To import a translation file from the Odoo command-line interface, we must place it inside the server add-ons path and then perform the import:<pre class="source-code">
<strong class="bold">$ mv myfile.po ./addons/</strong>
<strong class="bold">$ ./odoo.py -d mydb --i18n-import="myfile.po" --lang=fr_BE</strong></pre></li>			</ol>
			<h2 id="_idParaDest-542"><a id="_idTextAnchor623"/>How it works...</h2>
			<p><code>ir.translation</code> table, but in newer versions of Odoo, that table is no longer present. As a result, all view-level translations for <code>arch_db</code>, such as button strings and selection field values, will be stored in the <code>ir_ui_view</code> table, and all field-level translations, such as field labels, will be stored in the <code>ir_model_fields</code> table under the <code>field_description</code> field.</p>
			<p>For example, our<a id="_idIndexMarker805"/> hostel table has a <code>room_number</code> model. Its field translation of “Room Number” will be stored at the database level as <code>{"en_US": "Room Number", "fr_BE": "Numéro </code><code>de chambre"}</code>.</p>
			<p>The web client feature asks for the language name, but this is not used in the import process. It also has an overwrite option. If selected, it forces all the translation strings to be imported, even the ones that already exist, overwriting them in the process.</p>
			<p>On the command line, the import can be done using the <code>--i18n-import</code> option. It must be provided with the path to the file, relative to an add-on’s path directory; <code>-d</code> and <code>--language</code> (or <code>-l</code>) are mandatory. Overwriting can also be achieved by adding the <code>--i18n-overwrite</code> option to the command. Note that we didn’t use the <code>--stop-after-init</code> option here. It isn’t needed since the import action stops the server when it finishes.</p>
			<h1 id="_idParaDest-543"><a id="_idTextAnchor624"/>Altering a website’s custom language URL code</h1>
			<p>Odoo <a id="_idIndexMarker806"/>also supports multiple languages for websites. On a website, the current language is identified as a language string. In this recipe, you will learn how to change the language code in a URL.</p>
			<h2 id="_idParaDest-544"><a id="_idTextAnchor625"/>Getting ready</h2>
			<p>Before following this recipe, make sure you have installed the <code>website</code> module and enabled multiple languages for the website.</p>
			<h2 id="_idParaDest-545"><a id="_idTextAnchor626"/>How to do it...</h2>
			<p>To <a id="_idIndexMarker807"/>modify a language’s URL code, follow these steps:</p>
			<ol>
				<li>Open the language list from the <strong class="bold">Settings</strong> | <strong class="bold">Translations</strong> | <strong class="bold">Languages</strong> menu option. Clicking on one of the installed languages will open a form that looks like this:</li>
			</ol>
			<div><div><img src="img/B20997_11_14.jpg" alt="Figure 11.14 – Language URL code for a website"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Language URL code for a website</p>
			<ol>
				<li value="2">Here, you will see the <strong class="bold">URL Code</strong> field. Set the value that you want. Make sure you don’t add spaces or special characters here.</li>
			</ol>
			<p>After configuring this, you can test the results on your website. Open the home page and change the language; you will see the custom language code in the URL.</p>
			<h2 id="_idParaDest-546"><a id="_idTextAnchor627"/>How it works...</h2>
			<p>Odoo identifies the languages for a website via the URL path. For example, <a href="https://www.odoo.com/fr_FR">www.odoo.com/fr_FR</a> is used for the French language and <a href="https://www.odoo.com/es_ES">www.odoo.com/es_ES</a> is used for the Spanish language. Here, the <code>fr_FR</code> and <code>es_ES</code> parts of the URL are the language ISO codes, and they are used by Odoo to detect the requested language. But sometimes, you want to set the language in a more user-friendly way. In that case, you can update the <code>fr</code> for the French language. In this case, <a href="http://www.odoo.com/fr_FR">www.odoo.com/fr_FR</a> would be converted into <a href="http://www.odoo.com/fr">www.odoo.com/fr</a>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Changing the URL code in production is not a problem; Odoo will automatically redirect the URL containing the language ISO code to your custom URL.</p>
		</div>
	</body></html>