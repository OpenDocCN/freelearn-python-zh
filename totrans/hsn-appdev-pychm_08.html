<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-200"><a id="_idTextAnchor203"/>8</h1>
<h1 id="_idParaDest-201"><a id="_idTextAnchor204"/>Building a Dynamic Web Application with Flask</h1>
<p>I am fortunate enough to have been around the field of web development since its inception. I was a software engineer before there was a World Wide Web, at least one used by the general public. I remember the first time someone asked me to build a web application. I had to ask what it was. The guy told me, and I remember thinking “Well that’s dumb! Why wouldn’t people just use CompuServe or <strong class="bold">America Online</strong> (<strong class="bold">AOL</strong>) for that?” I thought the internet was going to be, at best, a fad. It was complicated, loaded with jargon, the UI was terrible compared with online services of the day, and it all just seemed kind of janky. I guess I was wrong.</p>
<p>Once I figured that out, I learned HTML and JavaScript. CSS wasn’t even a thing yet. It wasn’t long before I hit a wall with HTML’s capabilities. As you well know, HTML isn’t a programming language. It is a content markup language that controls the presentation of static content. The earliest version of JavaScript wasn’t very useful. You could validate forms. That’s about it. Dynamic content generation with JavaScript wasn’t a feature until HTML 3 came out.</p>
<p>Like I said, I hit a wall. I needed to take user interaction data from the browser and use it to interact with a database, generate files, and more. With HTML and JavaScript, this simply wasn’t possible. I needed a backend language. Initially, that was the C language. Even that was limited. You had to write modules in C that could interoperate with the Apache web server using<a id="_idIndexMarker673"/> an interface called the <strong class="bold">common gateway </strong><strong class="bold">interface</strong> (<strong class="bold">CGI</strong>).</p>
<p>So that was it for the first few years. Writing dynamic web applications was hard, and nothing like the capabilities of today. New languages and paradigms emerged to make the practice of web development more accessible. My first good experience was with a product called <code>.cfml</code> extension and process those files differently than normal HTML files. I was able to access an Oracle database very easily and, coupled with a lot of long nights and the creativity of my youth, I created some graphics pipeline software that garnered my employer a software patent.</p>
<p>CFML was part of a growing trend. The same technology was employed by lots of other nascent companies and stacks, including the following:</p>
<ul>
<li>Microsoft created <strong class="bold">Active Server Pages </strong>(<strong class="bold">ASP Classic</strong>)</li>
<li>Sun Microsystems introduced <strong class="bold">Java Server </strong><strong class="bold">Pages </strong>(<strong class="bold">JSP</strong>)</li>
<li><strong class="bold">Hypertext </strong><strong class="bold">Preprocessor</strong> (<strong class="bold">PHP</strong>)</li>
<li>The <strong class="bold">National Center for Supercomputing Applications </strong>(<strong class="bold">NCSA)</strong> created <strong class="bold">Server -side Includes </strong>(<strong class="bold">SSIs</strong>), which were not as feature-rich as the others in this list, but nevertheless existed as a way to generate dynamic content</li>
</ul>
<p>In this chapter, we’re going to take a quantum leap forward and look at a more modern framework for creating dynamic content, which is generated on the server side rather than the client side within the browser. Specifically, we’ll be looking at a framework called <strong class="bold">Flask</strong>, a popular, unopinionated <a id="_idIndexMarker676"/>solution for creating web applications in Python. By the end of this chapter, you will understand the following:</p>
<ul>
<li>The basics of web development<a id="_idIndexMarker677"/> such as <strong class="bold">client-server architecture</strong>, and the stateless <strong class="bold">request-response model</strong> employed by the web</li>
<li>What Flask is, and how it compares to other Python frameworks for web development</li>
<li>How to create a Flask application in PyCharm</li>
<li>How to work with <strong class="bold">Jinja2</strong> templates in PyCharm, which are used to serve dynamic content mixed with regular HTML markup, CSS styling, and JavaScript interactivity</li>
<li>How to create a RESTful API endpoint that returns data in JSON format rather than content</li>
<li>How to use PyCharm’s HTTP Requests feature to test your API</li>
</ul>
<p>Bear in mind, this chapter isn’t meant to be a tutorial on Flask. It is a tutorial on how to use PyCharm to work with Flask. If you’re looking for a full tutorial on Flask, visit my website at <a href="https://www.maddevskilz.com">https://www.maddevskilz.com</a>. There are several expanded tutorials on Flask that go into a deep dive and entail building entire proje<a id="_idTextAnchor205"/>cts.</p>
<h1 id="_idParaDest-202"><a id="_idTextAnchor206"/>Technical requirements</h1>
<p>In order to proceed through this chapter, and indeed the rest of the book, you will need the following:</p>
<ul>
<li>An installed and working Python interpreter. I’ll be using the latest from <a href="https://python.org">https://python.org</a>.</li>
<li>Installed copies of <code>pip</code> and <code>virtualenv</code>. You get these automatically when you install Python on Windows, and macOS has them included on every system. If you are using Linux, you need to install the package managers, such as <code>pip</code>, and virtual environment tools, such as <code>virtualenv</code>, separately. Our examples will use <code>pip</code> and <code>virtualenv</code>.</li>
<li>An installed and working copy of PyCharm. Installation was covered in <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a><em class="italic">, Installation and Configuration</em>, in case you are jumping into the middle of the book.</li>
<li>This book’s sample source code is from GitHub. We covered cloning the code in <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a><em class="italic">, Installation and Configuration</em>. You’ll find this chapter’s relevant code at <a href="https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-08">https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-08</a>.</li>
</ul>
<h1 id="_idParaDest-203"><a id="_idTextAnchor207"/>Web basics – client-server architecture</h1>
<p>When I began my career in IT back in 1991, I worked for a company called <strong class="bold">Electronic Data Systems </strong>(<strong class="bold">EDS</strong>). It was a <a id="_idIndexMarker678"/>different era. Back then, any serious computing was performed by monolithic systems called <strong class="bold">mainframes</strong>. Imagine a<a id="_idIndexMarker679"/> mainframe <a id="_idIndexMarker680"/>computer as an incredibly powerful and large-scale computer that existed before the era of personal computers and smartphones. It was like a supercomputer, capable of handling massive amounts of data and performing complex computations.</p>
<p>Mainframe computers were typically housed in specially designed rooms or data centers because they required a lot of space and specialized power and cooling systems to function properly. The typical mainframe was usually about the size of a minivan while its separate <strong class="bold">Power Distribution Unit</strong> (<strong class="bold">PDU</strong>) was <a id="_idIndexMarker681"/>roughly twice the size of a typical <a id="_idIndexMarker682"/>clothes dryer. The <strong class="bold">Direct Access Storage Device</strong> (<strong class="bold">DASD</strong>) was in yet another similarly large rectangular metal box. Connecting these various components were heavy cables about the diameter of a spent paper towel roll. Models from IBM’s Z14 series weighed between 2,500 and 4,000 kg (5,500 and 8,800 lbs).</p>
<p>In the past, mainframe computers were commonly used by large organizations, such as banks, government agencies, universities, and large <a id="_idIndexMarker683"/>corporations. They were responsible for processing and managing huge volumes of data, running critical business applications, and supporting the operations of entire enterprises. In my case, I worked with the IBM mainframe systems responsible for running the automotive assembly line operations for <strong class="bold">General Motors</strong> (<strong class="bold">GM</strong>), among others.</p>
<p>Mainframes were known for their reliability, security, and high-performance capabilities. They could handle multiple tasks simultaneously and provide fast response times, even when dealing with extensive workloads. People would access mainframes through terminals or other connected devices to perform tasks or retrieve information.</p>
<p>With the advancement of technology and the emergence of personal computers, the role of mainframes has evolved. While they still play a vital role in certain industries, many of the computing tasks that were once exclusive to mainframes are now handled by distributed systems, relatively cheap rack-mounted Intel and IBM Power-based systems, cloud computing, and smaller devices such as laptops and smartphones.</p>
<p>Mainframes were, and I suppose still are, very expensive to own and operate. Not only was the hardware expensive but it also generally took a team of expert computer operators and maintainers to keep the system running. The cost was out of reach for all but the largest corporations and universities. Smaller companies and even smaller nations had to buy time on other people’s mainframes to gain access to computing at scale. This, in fact, was the service rendered by EDS. We had acres of space in several very large data centers located throughout the world, and we sold time and provided services to nearly all of the Fortune 500 companies. The cost eventually, along with the implications of Moore’s Law, led to the downfall of the mainframe.</p>
<p><strong class="bold">Moore’s Law</strong> is an observation <a id="_idIndexMarker684"/>and projection made by Gordon Moore, the co-founder of Intel Corporation, in 1965. It states that the number of transistors on a microchip doubles approximately every two years, leading to a significant increase in computing power and performance while reducing the cost of electronic devices.</p>
<p>Moore originally noted that this exponential growth in transistor density had been occurring since the invention of the integrated circuit, and he predicted that it would continue for the foreseeable future. Over the years, Moore’s Law has held remarkably true, with advancements in semiconductor manufacturing technology allowing for increasingly smaller transistors and more complex integrated circuits.</p>
<p>The doubling of transistor density every <a id="_idIndexMarker685"/>two years has had profound implications for the field of computing. It has enabled the development of more powerful and efficient computers, with increased processing speed, memory capacity, and storage capabilities. As more transistors can be packed onto a chip, the overall performance of electronic devices has improved while their physical size has decreased.</p>
<p>As computers became smaller, and chip <a id="_idIndexMarker686"/>architectures such as <strong class="bold">Reduced Instruction Set Computing </strong>(<strong class="bold">RISC</strong>) and eventually Intel’s x86 architecture appeared, a new model of computing emerged: <strong class="bold">client-server</strong>.</p>
<p>Mainframes were centralized and accessed using “dumb” terminals. These terminals had no compute capability, no storage, and only enough memory to maintain a communications buffer to send whatever you typed on the keyboard to the mainframe for processing.</p>
<p>Client-server architecture shifted some of the compute, storage, and memory to a local client, which was usually a PC. The client was<a id="_idIndexMarker687"/> connected via a <strong class="bold">local area network</strong> (<strong class="bold">LAN</strong>) to a server, which was generally more powerful than a PC and capable of running enterprise-grade computing loads. You typically had client software, which was composed of a desktop user interface running on the PC’s operating system. The client software interfaced with centralized software running on the server.</p>
<p>Besides client and server hardware, one final piece came into existence around the same time: a standardized network protocol known as <strong class="bold">Transmission Control Protocol/Internet Protocol </strong>(<strong class="bold">TCP/IP</strong>). I was in <a id="_idIndexMarker688"/>college before TCP/IP and in order to interact with the University of Oklahoma’s mainframe, I had to keep a stack of floppy disks on hand that held an odd, mismatched collection of communication protocols. Some systems used a protocol called <strong class="bold">Kernel for Efficient, Remote, and Multiple Computer Interactions</strong> (<strong class="bold">KERMIT</strong>). I also had disks for <em class="italic">XMODEM</em>, <em class="italic">YMODEM</em>, and <em class="italic">ZMODEM</em>. Depending on which type of computer I <a id="_idIndexMarker689"/>wanted to access, I had to employ a different protocol. TCP/IP changed all that with a standard set of protocols supported by everything from mainframes and PCs to modern smartphones and internet-connected toasters.</p>
<p>If this sounds like the<a id="_idIndexMarker690"/> internet to you, you’d be right – but with a few caveats:</p>
<ul>
<li>The client server was very slow, and often not even full duplex, meaning data could only flow in one direction at a time.</li>
<li>Most client programs did not have a real GUI and didn’t support mouse interactions. They were known as “green screen” interfaces<a id="_idIndexMarker691"/> because they were rendered using textual menus on monochrome screens that were often green. Later thick-client applications had real GUIs usually written in Java, Visual Basic, C++, or Delphi. They were called thick because the size of the program was large enough that downloading the GUI could take many hours over a typical connection. This sits in stark contrast to a typical web application running on the modern internet.</li>
<li>The client software was always designed around a specialized set of use cases. In contrast, web browsers today, which comprise the client, can be used to run any kind of software from general word processing applications to specific lines of business applications.</li>
</ul>
<p>The web is the natural evolution in client server architecture. Lightweight client software, the web browser, connects to a centralized server where the bulk of the real work is handled using universally accepted networking protocols.</p>
<h1 id="_idParaDest-204"><a id="_idTextAnchor208"/>Exploring the request-response mechanism in HTTP – how clients and servers communicate</h1>
<p>One of the great accomplishments of the 1980s, besides CFC-laden hairspray, was the development of a universal set of networking protocols known as TCP/IP. In case you are new to this, the correct <a id="_idIndexMarker692"/>way to pronounce this is as letters: <em class="italic">tea sea pea eye pea</em>. The slash is silent, just like it is with ninjas.</p>
<p>It took a while for it to be universally adopted, but ultimately it was, and the protocols of TCP/IP form the basis of the modern web. While there are many useful protocols serving a myriad of functions, I want to focus your attention on the <strong class="bold">Hypertext Transfer Protocol </strong>(<strong class="bold">HTTP</strong>). You can go ahead and include the secure counterpart, <em class="italic">HTTPS</em>, where the <em class="italic">S</em> stands for <em class="italic">secure</em>. They effectively work the same way, except that HTTPS is encrypted.</p>
<p>The request-response mechanism entails a chain of events that describes a conversation that happens between the web browser or client, and the web server. You can watch this conversation unfold in <em class="italic">Figure 8</em><em class="italic">.1</em>.</p>
<div><div><img alt="Figure 8.1: The request-response mechanism in HTTP conveys a request from a browser to the server, which computes a response and sends it back to the browser" src="img/B19644_08_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1: The request-response mechanism in HTTP conveys a request from a browser to the server, which computes a response and sends it back to the browser</p>
<p>The request-response mechanism used by HTTP is the fundamental communication pattern between clients, such as web browsers or mobile applications, and servers on the World Wide Web. It works like this:</p>
<ol>
<li><code>GET</code>, <code>POST</code>, <code>PUT</code>, or <code>DELETE</code>, which indicates the desired<a id="_idIndexMarker693"/> action to be performed on the server’s resources, along with additional headers and, in some cases, a request body that carries data.</li>
<li><strong class="bold">The request is received by the server</strong>: Upon receiving the request, the server processes the information provided in the request. This may involve accessing databases, performing calculations, or executing other server-side operations based on the nature of the request. The simplest request is one for an HTML document, or other file that is simply returned.</li>
<li><strong class="bold">The server generates a response and sends it back to the user</strong>: After processing the request, the server generates an HTTP response. The response contains an appropriate status code indicating the outcome of the request. For example, a request that is successful bears a status code in the response header of 200. If you request a resource on the server that isn’t there, you’ll get a 404 code signaling the resource was not found. The response header also includes additional fields providing more information and a response body that contains the requested data or any relevant information.</li>
<li><strong class="bold">The browser receives the response data</strong>: The client receives the HTTP response from the server and processes the information contained within it. This could involve rendering HTML content, processing data, or performing other actions based on the response.</li>
<li><strong class="bold">Request-response cycle is complete</strong>: With the response received, the request-response cycle is complete. The client may choose to send additional requests to the server to perform further interactions, or the process may end.</li>
</ol>
<p>This request-response mechanism forms the basis of how information is exchanged between clients and servers over HTTP. It allows clients to request resources or perform actions on the server, and the server responds with the corresponding results or necessary information. This cycle enables the dynamic and interactive nature of web applications and services.</p>
<p>One thing to remember is that HTTP is stateless. This means that every request-response cycle is discrete. There is no native way in HTTP to share or retain data between requests.</p>
<h1 id="_idParaDest-205"><a id="_idTextAnchor209"/>What is Flask?</h1>
<p>Flask is an unopinionated framework for <a id="_idIndexMarker694"/>working with the request-response mechanism found in HTTP. It does one thing and only one thing: it helps you receive requests into a simple Python object structure, then craft responses using Python code.</p>
<p>Let’s go back to the word <em class="italic">unopinionated</em>. By this, I mean Flask by design only handles the request-response cycle. I realize I said that already, but it bears repeating. When you compare Flask to its virtual antithesis, which is Django, the difference is stark.</p>
<p>Django is extremely opinionated about how you create your web application. Django dictates the file structure, the application patterns, and the database to be used. It features its own object relational mapper, its own request response mechanism, and its own set of coding conventions. In short, Django will dictate your stack and most of the architectural details for your project.</p>
<p>Flask proffers some suggestions, but they are not set in stone, and you don’t have to use them if you don’t want to. A few years ago, I re-wrote my company’s flagship software product, Visual Storage<a id="_idIndexMarker695"/> Intelligence (see <a href="https://www.visualstorageintelligence.com">https://www.visualstorageintelligence.com</a>) as a Flask application strictly because it is unopinionated. I consider myself an expert at selecting the best stack given my knowledge, experience, and understanding of my company’s business requirements.</p>
<p>For example, I pretty much never use an ORM. I have deep expertise in SQL and relational database systems. I can write and tune queries, stored procedures, and views to build a fast, responsive web application in a variety of commercial and open source databases. An ORM is designed to take all that out of your hands and give you a layer of abstraction above the database so a developer need only deal with objects.</p>
<p>An ORM is effectively a black box. Most developers don’t know how it works or how to improve the performance of the queries the ORM generates. To me, it’s just overhead. Personally, I would rather build and tweak those guts myself. Incidentally, if any of these database-related terms are mystifying to you, stay tuned. I’ll talk a lot more about databases in <em class="italic">Chapter 11</em><em class="italic">, Understanding Database Management </em><em class="italic">with PyCharm</em>.</p>
<p>The point is, Flask doesn’t care how I interact with my database. It doesn’t care about how I structure my application, and it doesn’t care what my stack looks like. It only does two things, and one of them is optional.</p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor210"/>Request-response handling and routing with Werkzeug</h2>
<p>The first thing Flask does for us is to<a id="_idIndexMarker696"/> make dealing with the request-response mechanism in HTTP very easy. Strictly speaking, an inbound<a id="_idIndexMarker697"/> request is binary in nature. As developers, we would really rather deal with text-like object abstractions of binary structures. Dealing with binary anything directly is soooo 1939. Thankfully, <a id="_idIndexMarker698"/>there is a Python library that handles this called Werkzeug.</p>
<p>The library’s name, “Werkzeug," is derived from the German language, where it translates to “tool” or “instrument.” The Flask framework, including its underlying utility library, Werkzeug, was originally developed by Armin Ronacher, a German software developer.</p>
<p>The name “Werkzeug” was chosen to reflect the nature of the library as a versatile and powerful toolset for building web applications. Just as a craftsperson relies on a set of tools to create and shape their work, developers can leverage Werkzeug to handle various aspects of web development, such as routing, request handling, and HTTP utilities. Flask builds on top of Werkzeug; it adds additional abstractions and features to provide a lightweight and user-friendly web framework.</p>
<p>Flask uses Werkzeug’s functionalities to handle the low-level details of HTTP requests and responses, allowing developers to focus on building web applications quickly and efficiently. The effect is the ability to create web applications as simple as you would create any other Python application: you create functions to handle an incoming HTTP request, which returns a properly formatted HTTP response. If you can write a function in Python, you can create a web application.</p>
<p>The implementation in Flask looks like this:</p>
<pre class="source-code">
@app.route('/hello')
def hello_world():
  return 'Hello, World!'</pre> <p>As you can see, this is a simple Python function that takes no arguments and returns a string. The only thing odd about it is the decoration above the function definition. We’ll learn a lot more about this later. For now, understand that this decoration matches a route on your application’s URL. You are used to typing in a URL with the usual syntax of <a href="https://www.maddevskilz.com/">https://www.maddevskilz.com/</a>, which would take you to the root document of the website at that address. In the preceding code block, our function would answer any web request made to <a href="https://www.maddevskilz.com/hello">https://www.maddevskilz.com/hello</a> with the string <code>'Hello, World!'</code>. Naturally, you’ll learn to do more than deal with a simple request like this, but my point remains: if you can create a function in Python, you can write a web application!</p>
<p>Using this feature of Flask is <a id="_idIndexMarker699"/>non-negotiable. If you don’t want to use this abstraction of Werkzeug, then you don’t want to use Flask. Flask is, again, unopinionated, meaning this is really the only thing it “cares” about. We’ll see a contrast in <a href="B19644_12.xhtml#_idTextAnchor298"><em class="italic">Chapter 12</em></a><em class="italic">, Building a Web Application in Django</em>. Django is <a id="_idIndexMarker700"/>highly opinionated. It wants you to use its pre-defined stack. Flask doesn’t care. It does, however, make one strong suggestion that you can safely ignore if you’d like.</p>
<h2 id="_idParaDest-207"><a id="_idTextAnchor211"/>Templating with Jinja2</h2>
<p>Flask does come with a default suggestion regarding a templating library called Jinja2. When you<a id="_idIndexMarker701"/> install Flask, you get Jinja2 as a dependency. Templating systems <a id="_idIndexMarker702"/>are designed to allow you to inject content into a markup document. Here is an example of a Jinja2 script that generates some items in an unordered list on an HTML page:</p>
<pre class="source-code">
from jinja2 import Template
# Define the template
template_str = '''
&lt;ul&gt;
{% for item in items %}
 &lt;li&gt;{{ item }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
'''</pre> <p>The template is just a string that contains some special characters indicating where Python-like code is to be executed. This is how all templating languages work, from classic ASP to JSP to PHP. The Flask process gets the request from the web server. It parses the request, and here we’re rendering the response with our template. The template itself is a markup fragment. A variable called <code>template_str</code> is created and set to an empty string. Remember, this isn’t Python code, it’s Python-like code because it exists within the context of markup. The single quotes are escaped by single quotes, meaning <code>``</code> is interpreted as a single quote in the code.</p>
<p>As you can see, we have a <code>for</code> loop iterating over some list called <code>items</code>, which will be passed into the template as data. The code in the template is delineated with <code>{%</code> and <code>%}</code>. Each <code>&lt;li&gt;</code> has an expression bound in double curly braces. In this case, the expression is just the iterating <a id="_idIndexMarker703"/>variable item defined with the loop.</p>
<p>In my example, the template string is defined in the code, but in real life, the template is usually in a file since that is much easier to<a id="_idIndexMarker704"/> maintain. Next, we create the <code>template</code> object and pass the <code>template</code> string into the template constructor:</p>
<pre class="source-code">
# Create the Jinja2 template object
template = Template(template_str)</pre> <p>Now, we’re back to being in plain Python code. We’ll make a list called <code>items</code> and populate it:</p>
<pre class="source-code">
# Generate the list of items
items = ['Item 1', 'Item 2', 'Item 3', 'Item 4', 'Item 5', 'Item 6', 'Item 7', 'Item 8', 'Item 9', 'Item 10']</pre> <p>Now, we render <code>template</code>, which produces a new string set to a variable called <code>output</code>:</p>
<pre class="source-code">
# Render the template with the items
output = template.render(items=items)</pre> <p>Here we are printing the output, but in the context of a Flask application, the output would be returned as the response:</p>
<pre class="source-code">
# Print the rendered output
print(output)</pre> <p>Jijna2 has a robust set of language features common to most good templating systems. Remember though that Flask bills itself as <em class="italic">unopinionated</em>. You don’t have to use Jinja2. There are other templating libraries out there, or you can forgo the use of a template system entirely. In my company’s product, <em class="italic">Visual Storage Intelligence</em>, I used Jinja2 for version 4 of the product. At the time, I didn’t know Python very well and was used to Microsoft’s MVC template for C# web <a id="_idIndexMarker705"/>applications. I limited my learning curve to meet my deadline. Jinja2 is not difficult to learn at all. It is mostly HTML with some extra syntax. In version 5 of the product, I went back and replaced the UI layer of the application with a React <a id="_idIndexMarker706"/>frontend. This didn’t require any changes to the Flask application beyond deleting the templates that I no longer used.</p>
<p class="callout-heading">Reminder – this isn’t a book on Flask</p>
<p class="callout">I’ve spent some time going over the high-level basics of Flask in case you are encountering this as a web development novice. While it may appear that I’m about to teach you Flask, I only intend to cover the features of Flask development as they relate to PyCharm. While we will be building a project, I won’t be doing any really deep dives on how and why the code is what it is.</p>
<p class="callout">As such, if you are indeed a novice and you are intrigued by the intentionally tacit coverage of Flask I’m providing here and you’d like a proper tutorial, I will include more in-depth resources in the <em class="italic">Further reading</em> section at the end of this chapter.</p>
<h1 id="_idParaDest-208"><a id="_idTextAnchor212"/>A note on naming files and folders</h1>
<p>Before we get further into<a id="_idIndexMarker707"/> creating the next project, I want to give you some advice based on a principle I always point out to my students. <code>%20</code> to be considered valid. Web servers automatically handle this encoding, but manually encoding spaces can lead to readability issues in URLs, and it can cause issues when trying to run your projects on your local computer.</p>
<p>In a web project, most of your <a id="_idIndexMarker708"/>project paths will become URLs at some point. This can happen even when your project isn’t even intended for the web. To add to the problem, different operating systems treat characters differently in their filesystems. Windows filenames are case insensitive. If you name your file or folder <code>MyProject</code>, and then try to create a folder called <code>myproject</code>, you’ll get a collision since the folder already exists, despite the difference in upper and lowercase letters in the name. On Linux and macOS, file and folder names are case sensitive. It is totally fine to have <code>MyProject</code> and <code>myproject</code> together in the same folder.</p>
<p>My suggestion in all of this is to pick a standard you like and use it. For Python projects, the most common convention is to <a id="_idIndexMarker709"/>name your files with <code>MyProject</code>. Instead, you would call it <code>my_project</code>.</p>
<p>With that said, most of my projects in <a id="_idIndexMarker710"/>this book are named with the PyCharm defaults, which are often rendered in camel or Pascal case. In these case standards, typically employed by Java and C# developers, spaces are omitted and the boundary between words is emphasized using capital letters. <code>myProject</code> and <code>MyProject</code> would be an example of camel and Pascal case respectively. I suspect the use of camel case in the project name defaults probably comes from the fact that PyCharm’s ancestry is a Java IDE. Other strategies exist for eliminating spaces in code files. Kebab case is common in JavaScript development and uses dashes<a id="_idIndexMarker711"/> instead of underscores. <code>MyProject</code> becomes <code>my-project</code>.</p>
<p>I heartily recommend breaking any habit of using spaces in any of your folder or file names in your coding practice. This includes any upstream folders such as your operating system’s home folder.</p>
<h1 id="_idParaDest-209"><a id="_idTextAnchor213"/>Creating a Flask application in PyCharm Professional</h1>
<p>The tooling for Flask is a feature<a id="_idIndexMarker712"/> found only in the Professional <a id="_idIndexMarker713"/>edition of PyCharm. Naturally, you can make a Flask app in the free version of PyCharm, but you’ll be on your own in terms of creating the files and setting up run profiles, special debugging, and so on.</p>
<p>To create a Flask App in PyCharm, just select <strong class="bold">File</strong> | <strong class="bold">New Project</strong> and select the <strong class="bold">Flask</strong> template, as shown in <em class="italic">Figure 8</em><em class="italic">.2</em>.</p>
<div><div><img alt="Figure 8.2: To create a new Flask project in PyCharm Professional, choose the template from the New Project dialog" src="img/B19644_08_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2: To create a new Flask project in PyCharm Professional, choose the template from the New Project dialog</p>
<p>I’ve numbered the<a id="_idIndexMarker714"/> most important <a id="_idIndexMarker715"/>parts in <em class="italic">Figure 8</em><em class="italic">.2</em>:</p>
<ol>
<li>In the <strong class="bold">New Project</strong> dialog of PyCharm Professional, you’ll find a template for <strong class="bold">Flask</strong> projects.</li>
<li>This part is no different than any project we’ve done so far. Fill in the location for the project.</li>
<li>Create your virtual environment. Once everything is filled in, PyCharm creates and activates the virtual environment and installs Flask and its dependencies.</li>
<li>This section is unique to Flask projects. I mentioned that Flask encourages the use of the Jinja2 templating engine. You can choose to leave it out and PyCharm will take care of that for you. There is also a setting for the folder you want to use for your Jinja2 templates. We’re <a id="_idIndexMarker716"/>going to keep the defaults and I recommend if you are going to<a id="_idIndexMarker717"/> use Jinja2 templates that you leave the settings as they are because that is where most developers will expect them.</li>
</ol>
<p>Once you have everything filled in, click the <strong class="bold">Create</strong> button at the bottom of the dialog and PyCharm will set up your project for you, including the creation of some starter code, as seen in <em class="italic">Figure 8</em><em class="italic">.3</em>.</p>
<div><div><img alt="Figure 8.3: PyCharm generates your Flask project automatically" src="img/B19644_08_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3: PyCharm generates your Flask project automatically</p>
<p>At position <code>Hello World</code> idiom from earlier, except this one is responding to the root route of your web application. At the top, we import Flask, then we instantiate Flask as the <code>app</code> variable. Now that you know that, the decoration for the route on <em class="italic">line 6</em> makes more sense; <code>app.route</code> is simply coming from the <code>app</code> instance of Flask.</p>
<p>All this code is <a id="_idIndexMarker718"/>contained in <code>app.py</code> at position <strong class="bold">(2)</strong> of <em class="italic">Figure 8</em><em class="italic">.3</em>. The name isn’t a requirement, and you can change it if <a id="_idIndexMarker719"/>you’d like. You can also see, at position <strong class="bold">(3)</strong>, that PyCharm has generated two folders for Jinja2 templates and static files such as your images, CSS, and JavaScript files.</p>
<h1 id="_idParaDest-210"><a id="_idTextAnchor214"/>Creating a dynamic web application</h1>
<p>The <code>Hello World</code> program generated by PyCharm is a good starting point for new applications. It provides you with some nice cognitive prompting in case it’s been a while since you created the Flask application from scratch. Naturally, we’ll be wanting to replace <code>Hello World</code> with something a tad more useful.</p>
<p>Let’s create a very simple application for cataloging new Python libraries! This kind of project is usually done with a database, but it doesn’t have to be. Our app is going to hold a list of Python libraries along with<a id="_idIndexMarker720"/> their description and a rating from 1-5 on how useful we think they are. To accomplish the database part, we’re going to simply use an in-memory array of lists. Using this approach prevents the need to do a deep dive on the database features of PyCharm, which isn’t coming until <a href="B19644_11.xhtml#_idTextAnchor266"><em class="italic">Chapter 11</em></a><em class="italic">, Understanding Database Management with PyCharm</em>. We’ll also exercise every excuse to cover some features we’ve covered earlier in a practical setting, such as using the HTML features from the last chapter.</p>
<h2 id="_idParaDest-211"><a id="_idTextAnchor215"/>Setting up the static parts</h2>
<p>The easiest place to start when building a<a id="_idIndexMarker721"/> web application is to get the static parts working. I’m talking about the non-dynamic parts of the application such as the <code>index.html</code> page with its basic structure, any CSS, images, and JavaScript we might need.</p>
<p>Start off by right-clicking in the <code>Templates</code> folder and creating a new file called <code>index.html</code>. This is going to be a Jinja2 template, so it belongs in the <code>Templates</code> folder rather than the <code>static</code> folder.</p>
<div><div><img alt="Figure 8.4: Right-click﻿ing the Templates folder and creat﻿ing a new HTML file" src="img/B19644_08_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4: Right-clicking the Templates folder and creating a new HTML file</p>
<p>Note that we created a plain HTML file. There is no special file type for a Jinja2 file. The file is created using the Emmet templating<a id="_idIndexMarker722"/> system we covered in <a href="B19644_07.xhtml#_idTextAnchor172"><em class="italic">Chapter 7</em></a><em class="italic">, Web Development with JavaScript</em>, <em class="italic">HTML, and CSS</em>. As you hopefully<a id="_idIndexMarker723"/> remember, <code>title</code> attribute in the HTML file, allowing you to fill in that blank spot in the HTML template. You can see mine in <em class="italic">Figure 8</em><em class="italic">.5</em>.</p>
<div><div><img alt="Figure 8.5: The HTML creation template puts your cursor in the title tag so you can fill in that part of the page" src="img/B19644_08_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5: The HTML creation template puts your cursor in the title tag so you can fill in that part of the page</p>
<p>Next, let’s modify the contents<a id="_idIndexMarker724"/> of the <code>&lt;head&gt;</code> tag like this:</p>
<pre class="source-code">
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3
  .0/dist/css/bootstrap.min.css" rel="stylesheet"
     integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
     crossorigin="anonymous"&gt;
  &lt;title&gt;Python Libraries R Us&lt;/title&gt;
&lt;/head&gt;</pre> <p>This brings in the bootstrap CSS and<a id="_idIndexMarker725"/> JavaScript libraries from a <strong class="bold">content delivery network</strong> (<strong class="bold">CDN</strong>). If you don’t want to type all that in, you can copy the code from the book’s repository code, or you can go to <a href="https://getbootstrap.com">https://getbootstrap.com</a> and find the latest in the <strong class="bold">Getting Started</strong> section of their site, which usually includes copyable links to their CDN.</p>
<p>We’re using the CDN so we don’t need to keep these common files in our project. Besides, CDNs usually serve<a id="_idIndexMarker726"/> these kinds of files faster than will your own web server once you move your amazing app into production.</p>
<p>Next, change the contents of the <code>&lt;body&gt;</code> tag to the following:</p>
<pre class="source-code">
&lt;body&gt;
  &lt;h1&gt;Python Libraries R Us&lt;/h1&gt;
  &lt;h2&gt;All the libraries that are fit to use!&lt;/h2&gt;
&lt;/body&gt;</pre> <p>Next, we’re going to use the Emmet feature we learned about in <a href="B19644_07.xhtml#_idTextAnchor172"><em class="italic">Chapter 7</em></a><em class="italic">, Web Development with JavaScript, HTML, and CSS,</em> to generate an HTML table header. Type this Emmet code into the editor on a new line just below the <code>&lt;</code><code>h2&gt;</code> tag:</p>
<pre class="source-code">
table&gt;thead&gt;tr&gt;th*4</pre> <p>This abbreviation will generate a table, followed by a <code>thead</code> tag, with one table row (<code>tr</code>) and four table head fields (<code>th*4</code>). Press <em class="italic">Tab</em> to expand the abbreviation. PyCharm’s Emmet plugin will generate your code and take you straight to the contents of the <code>th</code> tags, as shown in <em class="italic">Figure 8</em><em class="italic">.6</em>.</p>
<div><div><img alt="Figure 8.6: Emmet expands the code into all the code you need for the table header" src="img/B19644_08_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6: Emmet expands the code into all the code you need for the table header</p>
<p>Once Emmet has expanded your <a id="_idIndexMarker727"/>code, you’ll see the prompts inside the <code>th</code> tags allowing you to edit the content, as shown in <em class="italic">Figure 8</em><em class="italic">.7</em>.</p>
<div><div><img alt="Figure 8.7: Emmet expands the shorthand in line 15 in Figure 8.6 to what we see here" src="img/B19644_08_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7: Emmet expands the shorthand in line 15 in Figure 8.6 to what we see here</p>
<p>Traditionally, you’d use <strong class="bold">Tab</strong> to move between the fields, but in PyCharm, the <em class="italic">Tab</em> key is bound to the action that expands Emmet, as we just saw. You can’t use <em class="italic">Tab</em> to navigate as you’d expect if you’re coming from a different Emmet-enabled editor. Instead, you’ll need to find out what the shortcut is on your system since this will depend on which keyboard shortcut layout you configured when you installed PyCharm. I chose the Windows layout, so for me, moving <a id="_idIndexMarker728"/>between the fields is done using <em class="italic">Alt + Shift + ]</em>.</p>
<p>Inside the first <code>th</code> tag, type <code>Library Name</code>. Then use <em class="italic">Alt + Shift + ]</em> to move to the next field and change it to <code>Description</code>. The third field will be called <code>Rating</code> and the fourth is titled <code>URL</code>.</p>
<p>If <em class="italic">Alt + Shift + ]</em> doesn’t do it for you, let’s find out what will. Go into PyCharm’s settings and find the <strong class="bold">Keymap</strong> settings as shown in <em class="italic">Figure 8</em><em class="italic">.8</em>.</p>
<p>I’ve typed <code>Emmet</code> into the search box and I can see that my <strong class="bold">Navigate &gt; Next / Previous Emmet Edit Point</strong> settings are <strong class="bold">Alt + Shift + ]</strong> and <strong class="bold">Alt + Shift + [,</strong> respectively. If yours are different, you’ll see what they are here, and as we’ve learned, you can change them to anything you’d like so long as the change doesn’t conflict with something else.</p>
<div><div><img alt="Figure 8.8: Your Emmet navigation settings are found and set here in Settings" src="img/B19644_08_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.8: Your Emmet navigation settings are found and set here in Settings</p>
<p>At this stage, your HTML <code>table</code><a id="_idIndexMarker729"/> code should look like this:</p>
<pre class="source-code">
&lt;table&gt;
    &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Library Name&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
      &lt;th&gt;Rating&lt;/th&gt;
      &lt;th&gt;URL&lt;/th&gt;
    &lt;/tr&gt;
    &lt;/thead&gt;
  &lt;/table&gt;</pre> <p>Let’s add one more thing to the <code>table</code><a id="_idIndexMarker730"/> code. Put this below the <code>&lt;/thead&gt;</code> closure but before the <code>&lt;/</code><code>table&gt;</code> closure:</p>
<pre class="source-code">
&lt;tbody&gt;
  &lt;tr&gt;
    &lt;td colspan="4"&gt;No libraries to display&lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;</pre> <p>If your code got messy, use PyCharm’s reformat code feature to clean things up. This is usually <em class="italic">Ctrl + Alt + L</em>, or <em class="italic">Cmd + Opt + L</em> on a Mac.</p>
<p>We have a basic web page laid out. Before we make it dynamic, let’s create a run configuration for the app so we can preview our handiwork.</p>
<h2 id="_idParaDest-212"><a id="_idTextAnchor216"/>Running the Flask app</h2>
<p>When we created our project, PyCharm<a id="_idIndexMarker731"/> created a Flask run configuration for us. Let’s take a look at it so we can <a id="_idIndexMarker732"/>understand how the app will be run by PyCharm. Click the <strong class="bold">Run configuration</strong> dropdown and click <strong class="bold">Edit Configurations…</strong>, as seen in <em class="italic">Figure 8</em><em class="italic">.9</em>.</p>
<div><div><img alt="Figure 8.9: Edit﻿ing the run configurations so we can see what they’re made of" src="img/B19644_08_09.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.9: Editing the run configurations so we can see what they’re made of</p>
<p>The settings look like those<a id="_idIndexMarker733"/> shown in <em class="italic">Figure 8</em><em class="italic">.10</em>.</p>
<div><div><img alt="Figure 8.10: Flask run configuration generated by PyCharm" src="img/B19644_08_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.10: Flask run configuration generated by PyCharm</p>
<p>Most of these settings will be familiar <a id="_idIndexMarker734"/>now, so only a few are marked.</p>
<p>There are a couple of ways to run a Flask app. The easiest is to just run the <code>app.py</code> file, which is the <code>dunder-main</code> line that runs the app, this works just fine. Recall the code at the bottom of <code>app.py</code>:</p>
<pre class="source-code">
if __name__ == '__main__':
  app.run()</pre> <p>You can also run it using the module name, but let’s stick with what PyCharm generated for now.</p>
<p>At position <code>FLASK_DEBUG</code> environment<a id="_idIndexMarker735"/> variable gets its own checkbox. When you check this box, it puts the dedicated Flask development server into debug mode, which yields several benefits. The greatest of these is that the app server will restart whenever you change the code. This saves you from having to remember to stop and restart the server every time you make a change. Generally speaking, you want this box checked. Above the check is a commonly used <code>FLASK_ENV</code> environment variable that is also passed to the running app. It defaults to <code>development</code>. You can use this environment variable to turn on and off certain behaviors in your app, including setting log detail levels.</p>
<p>The two <code>PYTHONPATH</code> checkboxes at position <code>PYTHONPATH</code> folder, which prevents you from getting an error stating Python can’t find your application. You want these checked.</p>
<p>Note that with all these checkboxes, PyCharm gives you the ability to set common environment variables that are passed into the running app. This is nice, because setting them at the OS level is extra work that we often forget, and changing environment variables often doesn’t work as well as it should depending on your operating system. When you use environment variables at the OS level, you generally need to either reboot or log out and log back in to make sure the new values are active. PyCharm injects variables directly into the running development server, which saves a lot of time and frustration.</p>
<p>Click <strong class="bold">OK</strong> to close the run configuration dialog.</p>
<p>Before we fire it up, we need to make a code change to <code>app.py</code>. We need to alter our <code>Hello World</code> code to load and display our template. The altered code looks like this:</p>
<pre class="source-code">
from flask import Flask<strong class="bold">, render_template</strong>
app = Flask(__name__)
@app.route('/'<strong class="bold">, methods=["GET"]</strong>)
def root():
  <strong class="bold">return render_template("index.html")</strong>
if __name__ == '__main__':
  app.run()</pre> <p>First, I’ve added an import for the <code>render_template</code> method from Flask. We’ll use this to, you guessed it, render our Jinja2 HTML template.</p>
<p>Next, I’ve added some code to the route decorator. Previously, we had <code>@app.route('/')</code>, which defines the <code>root</code> route for our site that will be handed by our <code>root</code> function. I’ve added a second argument, <code>methods=["GET"]</code>. Flask allows you to lock a route to one or<a id="_idIndexMarker736"/> more of the HTTP request methods I described earlier in the chapter. Locking Flask application endpoints to a particular HTTP method, such as <code>GET</code> or <code>POST</code>, is a fundamental practice in web development for several important reasons:</p>
<ul>
<li><strong class="bold">Security</strong>: Different HTTP methods have different purposes and security implications. For example, GET requests are typically used for retrieving data, and they should not have any side effects on the server. In contrast, POST requests are used for submitting data to the server, and they can have side effects, such as creating, updating, or deleting resources. By restricting endpoints to specific HTTP methods, you<a id="_idIndexMarker737"/> can prevent unintended or malicious actions. This is known as “method-based access control.”</li>
<li><strong class="bold">Predictability</strong>: Locking endpoints to specific HTTP methods makes your API or web application more predictable and self-documenting. Other developers (or even your future self) will have a clearer understanding of how to interact with your application. For example, if an endpoint is designed for GET requests, it’s clear that it’s meant for data retrieval.</li>
<li><strong class="bold">Consistency</strong>: Consistency in your API design can improve the user experience and reduce confusion. When users or clients know that a specific HTTP method is expected for an endpoint, they are less likely to make incorrect requests.</li>
<li><strong class="bold">Preventing accidents</strong>: Accidental misuse of an endpoint can lead to unintended consequences. By restricting the allowed HTTP methods, you reduce the chances of UI developers making mistakes, such as trying to delete data with a GET request.</li>
<li><strong class="bold">Framework support</strong>: Flask, along with many other web frameworks, provides built-in support for routing requests based on HTTP methods. This makes it easier to implement method-based access control, as you can define separate routes and handlers for each HTTP method.</li>
</ul>
<p>If you look closely, the argument we’re passing is an array. You can pass one or more methods allowing one route to handle <a id="_idIndexMarker738"/>one or several methods differently. Here, we’re locking the <code>root</code> route function to the HTTP GET method, which is what your browser issues when you visit a site.</p>
<p>Next, we’ve added Flask’s <code>render_template</code> method to our import. I changed the name of the function from <code>hello_world</code> to <code>root</code>, then I changed the return from the <code>'Hello World'</code> string to the result of the <code>render_template</code> function that takes the filename of a template. Flask knows to find <code>index.html</code> in the <code>Templates</code> folder.</p>
<p>Now we’re ready to try it out. Make sure your Flask app is selected in the run configuration dropdown and click the green <strong class="bold">Run</strong> button. The <strong class="bold">Run</strong> tab will appear at the bottom of the PyCharm screen. Mine appears as shown in <em class="italic">Figure 8</em><em class="italic">.11</em>.</p>
<div><div><img alt="Figure 8.11: The Run window for our Flask app" src="img/B19644_08_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.11: The Run window for our Flask app</p>
<p>There are a couple of remarkable elements to point out. The first is the big red warning message. I know, it’s gray for you, but you’ll see it the first time you try this out. We’re running our app using Flask’s built-in development web server. Please don’t use this in production. Instead, you need to use a production-quality app server such as Green Unicorn. This falls outside the scope of developing with PyCharm, but it is such a huge mistake to deploy your app using the<a id="_idIndexMarker739"/> built-in server that I felt it needed to point out and justify this warning being in big red letters.</p>
<p>Second, it tells you the app is running at <code>http://127.0.0.1:5000</code>. The address is listed as a hyperlink, which you can click to open your browser. I have mine open in <em class="italic">Figure 8</em><em class="italic">.12</em>.</p>
<div><div><img alt="Figure 8.12: It worked, but 1991 just called on the phone and they want their web design back" src="img/B19644_08_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.12: It worked, but 1991 just called on the phone and they want their web design back</p>
<p>It is awfully ugly, isn’t it? We went to the trouble of adding Bootstrap, the least we can do is use it.</p>
<h2 id="_idParaDest-213"><a id="_idTextAnchor217"/>Let’s make it look a little better</h2>
<p>The page doesn’t have much happening in terms of design, and while we won’t be building some amazing user experience <a id="_idIndexMarker740"/>that might land you a design job at Apple, we can at least make this a little more presentable by adding some Bootstrap classes. We’ll be doing this within the <code>body</code> tag inside our Jinja2 template, <code>index.html</code>.</p>
<p>First, let’s set up Bootstrap’s layout grid. This allows us to create apps that gracefully adjust to any size screen from the tiniest phone browser to the largest 8K display.</p>
<p>Add this code just inside the <code>body</code> tag. When you’re done, it should bump up against the <code>table</code> code we created earlier:</p>
<pre class="source-code">
&lt;div class="container-fluid h-100"&gt;
  &lt;div class="row"&gt;
    &lt;div class="col-12"&gt;
      &lt;h1&gt;Python Libraries
        &lt;span class="flipped-letter"&gt;R&lt;/span&gt; Us&lt;/h1&gt;
      &lt;h2&gt;All the libraries that are fit to use!&lt;/h2&gt;
      &lt;hr/&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class="row"&gt;
    &lt;div class="col-8"&gt;
      &lt;h5&gt;Here are the libraries:&lt;/h5&gt;</pre> <p>Here, we’ve added a <code>div</code> marked with the <code>container-fluid</code> class. This is going to give us some much-needed layout and padding so our content doesn’t slam up against the edges of the browser window. I’ve also set this to take up the full height available in the browser window in anticipation of there being many useful libraries in our table. I did this with Bootstrap’s <code>h-100</code> class.</p>
<p>After that, I added a <code>div</code> to act as a row followed by one acting as a column. I’ve set the class on the column to <code>col-12</code>, which in Bootstrap means it should take up the full width of the browser window with appropriate margins and padding defined by the <code>container-fluid</code> class in the ancestral <code>div</code> tag we added earlier.</p>
<p>The next three tags are just content additions – some labeling that explains what the user is seeing using <code>H1</code> and <code>H2</code> tags followed by a horizontal rule. I added a CSS class to flip the letter R so it is reminiscent of a popular, yet presently bankrupt toy shop in the US. One more icon from my childhood has bitten the dust. Bear in mind, we haven’t created this CSS class yet. We’ll do that<a id="_idIndexMarker741"/> in just a minute.</p>
<p>Let’s add the Bootstrap <code>.table</code> class to the table. Change your <code>table</code> code by adding <code>class="table"</code>:</p>
<pre class="source-code">
&lt;h5&gt;Here are the libraries:&lt;/h5&gt;
            &lt;table <strong class="bold">class="table"</strong>&gt;
                &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;Library Name&lt;/th&gt;
                    &lt;th&gt;Description&lt;/th&gt;
                    &lt;th&gt;Rating&lt;/th&gt;
                    &lt;th&gt;URL&lt;/th&gt;
                &lt;/tr&gt;</pre> <p>This will fix up the spacing in and around the table so everything isn’t squished together.</p>
<p>To close all this out, we need to add all the necessary closing tags after our table is closed. That’s just three nested <code>div</code> closures:</p>
<pre class="source-code">
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre> <p>The first closes the column, the second closes the row, and the third closes the container. The last step is to add some CSS.</p>
<h2 id="_idParaDest-214"><a id="_idTextAnchor218"/>Adding some CSS</h2>
<p>Right-click the <code>static</code> folder and <a id="_idIndexMarker742"/>create a new CSS file called <code>index.css</code>. Add the following code to the file:</p>
<pre class="source-code">
body {
  margin: 92px;
  height: 100%;
}
.flipped-letter {
 display: inline-block;
 transform: scaleX(-1);
}
.gold-star {
  color: gold;
}</pre> <p>In this CSS file, we’re adding some extra margin around the page and setting the height to 100% so we don’t wind up with a stubby little page that is fully dependent on how much content is in our table.</p>
<p>I added a <code>flipped-letter</code> class in <code>index.css</code> to flip the letter R in our imaginary site’s title. We’re going to be displaying a rating for each library. I thought, instead of just a boring old number, we’d put some stars in there. Not just any stars – gold stars! So, there’s a class for that, which I called <code>.gold-star</code>. If you’re new to CSS, the leading dot is significant. It flags the rest, <code>gold-star</code> as a custom class. In CSS, a class has nothing to do with object-oriented development, so if you’ve learned some Java or other class based language, the word <em class="italic">class</em> is not related to the concepts from those languages. You’ll see in a minute when the class is used within the HTML, the dot will be absent. This is not an error.</p>
<p>Now that we have a CSS file in the <code>static</code> folder, we need to reference it in the HTML file. Since it is in the static folder, which has special meaning in a Flask app, our code is a little different than a straight CSS reference like those we saw earlier with plain HTML. Add this line of code inside your <code>head</code> tag:</p>
<pre class="source-code">
&lt;link href="{{ url_for('static', filename='index.css') }}"
     rel="stylesheet"
     type="text/css"&gt;</pre> <p>Note the Jinja2 expression that resolves the location of the static folder.</p>
<p>I mentioned a moment ago that I want to<a id="_idIndexMarker743"/> use stars to show my ratings. I don’t really want to use graphics for this. Instead, I’d rather use a font, specifically <strong class="bold">Font Awesome</strong>. Font Awesome<a id="_idIndexMarker744"/> is essentially agigantic web font that, instead of containing alphabetical characters, contains hundreds of useful  graphical icons useful for making modern UI and website designs. For more information on Font Awesome, see <a href="https://www.fontawesome.com">https://www.fontawesome.com</a>.</p>
<p>Rather than include Font Awesome in our project, which of course is an option, I’m going to link to a version of it <a id="_idIndexMarker745"/>hosted on a <strong class="bold">content delivery network</strong> (<strong class="bold">CDN</strong>). CDNs are a desirable way to host content because they are designed to serve static content with great speed. They do this not only through normal server optimizations but also by strategically positioning servers all over the world. When your page loads static content from a CDN, the request for that content is routed to the closest server. Your users in India will reach a CDN server in India, while users in Kansas (the middle of the United States) will be served the content from a server much closer.</p>
<p>Font Awesome lists its CDN links on its website. I’m going to use a link I have copied from the Font Awesome website and add this to the <code>head</code> tag of our page. Since this is coming from a CDN instead of the static folder, I don’t need any Jinja2 voodoo magic to resolve it:</p>
<pre class="source-code">
&lt;link rel="stylesheet"
     href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"&gt;</pre> <p>Things should be looking much better! I’ll hold off on the revealing screenshot until we’ve added the dynamic content. I don’t want to spoil the big reveal! Don’t forget, you can check the final code in the chapter’s repository folder cloned from GitHub.</p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor219"/>Making the page dynamic</h2>
<p>We’ve created a Flask app and gotten a template working. Let’s add dynamism to the page using Flask and Jinja2. We’re going to <a id="_idIndexMarker746"/>simulate a database using a list of <code>dicts</code> with fields that correspond to the fields we’ve put in our table.</p>
<p>Switch to the <code>app.py</code> file and find this line, which should be near line number 3:</p>
<pre class="source-code">
app = Flask(__name__)</pre> <p>This line, which was generated by PyCharm when we created the project, creates an instance of Flask and assigns that instance to a variable called <code>app</code>. We’ll begin adding new code below this line. Let’s start by creating a global variable to hold our data:</p>
<pre class="source-code">
library_data = list()
library_data.append({"python_library": "Flask",
           "description": "An unopinionated web framework",
           "rating": 5,
           "url": "https://pypi.org/project/Flask"})
library_data.append({"python_library": "Jinja2",
           "description": "Templating library",
           "rating": 3,
           "url": "https://pypi.org/project/Jinja2"})</pre> <p>In general, global variables, especially in a large program, are to be avoided. In this case, we’re using the global variable to simulate a database connection, which is generally an exception to the rule.</p>
<p>Here, we’re adding a few records to our fake database. If you’re a fan of Jinja2, please don’t hate me. I rated it a 3 in the content just to have some visual difference between the two sample records.</p>
<p>There’s just one more change. Add a second parameter to the <code>render_template</code> call:</p>
<pre class="source-code">
return render_template("index.html", library_data=library_data)</pre> <p>The <code>render_template</code> method is a <strong class="bold">variadic function</strong>. You can pass as many parameters into it as you’d like. Jinja2<a id="_idIndexMarker747"/> will be able to render the passed data in the template. Here, we’re just adding one data <a id="_idIndexMarker748"/>variable.</p>
<p>We’re done with <code>app.py</code>! The final code looks like this:</p>
<pre class="source-code">
from flask import Flask, render_template
app = Flask(__name__)
library_data = list()
library_data.append({"python_library": "Flask",
           "description": "An unopinionated web framework",
           "rating": 5,
           "url": "https://pypi.org/project/Flask"})
library_data.append({"python_library": "Jinja2",
           "description": "Templating library",
           "rating": 3,
           "url": "https://pypi.org/project/Jinja2"})
@app.route('/', methods=['GET'])
def root(): # put application's code here
  return render_template("index.html", library_data=library_data)
if __name__ == '__main__':
  app.run()</pre> <p>Now that we’re passing some data into the template, we need to go back and modify the <code>index.html</code> template to render the data. You need to change the contents of the <code>tbody</code> tag to this:</p>
<pre class="source-code">
&lt;tbody&gt;
        {% if library_data|length &gt; 0 %}</pre> <p>The <code>{%</code> and <code>{{</code> markers in the template are marking out places where logic and content take place. Here, we are checking the length<a id="_idIndexMarker749"/> of the array. If it is greater than zero, we’re rendering table rows using the contents of the array. Further down, there’s an <code>else</code> that will render what we have now, which is a single row stating there is no data:</p>
<pre class="source-code">
          {% for data in library_data %}
            &lt;tr&gt;
              &lt;td&gt;{{ data.python_library }} &lt;/td&gt;
              &lt;td&gt;{{ data.description }}&lt;/td&gt;
              &lt;td&gt;
                {% for _ in range(data.rating) %}
                  &lt;i class="fas fa-star gold-star"&gt;&lt;/i&gt;
                {% endfor %}
              &lt;/td&gt;
              &lt;td&gt;&lt;a href="{{ data.url }}"
                  target="_blank"&gt;View on pypi.org&lt;/a&gt;&lt;/td&gt;
            &lt;/tr&gt;
          {% endfor %}</pre> <p>In the preceding code, we are looping through the <code>library_data</code> list and generating a table row (<code>tr</code>). The table row is then supplied with columns. The <code>{{ }}</code> placeholders denote where contents from the <code>dict</code> from the current list iteration should be placed. The first column shows the contents of <code>data.python_library</code>. The second shows the description.</p>
<p>The third is where we add some razzle-dazzle! We add a code block that loops using a range to generate stars in that column. If<a id="_idIndexMarker750"/> the rating is 3, the loop runs 3 times and we get 3 stars!</p>
<p>For the URL, I used the value of <code>data.url</code> as the <code>href</code> attribute on a hyperlink.</p>
<p>That just leaves the <code>else</code> statement I told you about:</p>
<pre class="source-code">
        {% else %}
          &lt;tr&gt;
            &lt;td colspan="4"&gt;No libraries to display&lt;/td&gt;
          &lt;/tr&gt;
        {% endif %}
        &lt;/tbody&gt;</pre> <p>To summarize, if we pass in an array with zero elements, Jinja2 will render the row we had before, which states there is no data. If there’s data in the array, Jinja2 loops over the array and generates a table row for each row in the data.</p>
<p>Run the project and direct your browser to <code>http://localhost:5000</code>. You’ll see a table rendered with two records, as seen in <em class="italic">Figure 8</em><em class="italic">.13</em>.</p>
<div><div><img alt="Figure 8.13: The big reveal! Our page is now dynamic﻿" src="img/B19644_08_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.13: The big reveal! Our page is now dynamic</p>
<p>Let’s pause for a moment and take stock of how PyCharm has helped us.</p>
<h2 id="_idParaDest-216"><a id="_idTextAnchor220"/>Editor enhancements for working with Flask and Jinja2</h2>
<p>You’ve been getting a lot <a id="_idIndexMarker751"/>of help during this exercise. If you don’t believe me, try repeating this exercise with Vim or Notepad! By now, you’re becoming accustomed to how much PyCharm takes <a id="_idIndexMarker752"/>off your plate in terms of lightening your cognitive<a id="_idIndexMarker753"/> load, and physically handling a lot of typing.</p>
<p>You might not have even noticed the following:</p>
<ul>
<li>The HTML editing features, such as syntax highlighting, automatic tag closures, and color-coded indicators for your nested opening and closing tags in the markup.</li>
<li>We used Emmet to generate some of our markups.</li>
<li>PyCharm understands Jinja2 syntax and the inspection doesn’t freak out when you start putting curly braces everywhere.</li>
<li>In fact, it auto-closes the curly braces for both <code>{{ expressions }}</code> and <code>{% code </code><code>blocks %}</code>.</li>
<li>If you made any mistakes along the way, you might have noticed that PyCharm’s inspections and suggestions clearly understand how to use Flask. It’s not simple introspective auto-completion. PyCharm will give you specific assistance tailored to Flask development.</li>
</ul>
<p>Let’s look at a few features that are not so obvious:</p>
<ul>
<li>Switch to <code>app.py</code>, put your cursor inside the template filename (<code>index.html</code>), then press <em class="italic">Ctrl </em>/<em class="italic"> Cmd </em>+<em class="italic"> B</em>. This activates the <code>library_data</code> variable in the template and press <em class="italic">Ctrl </em>/<em class="italic"> Cmd </em>+<em class="italic"> B</em>, it will take you to the render template call, which passes that variable into Jinja2.</li>
<li>It shouldn’t surprise you that the debugger works in <code>app.py</code>. It also works in the Jinja2 template within the code blocks. Place a breakpoint in the <code>for</code> loop in the Jinja2 template, <code>index.html</code>. Start <a id="_idIndexMarker754"/>your app with <code>debug</code>, and the debugger will stop on the loop. You<a id="_idIndexMarker755"/> can use the same step-through capabilities as with anything else you are debugging. You can inspect template variables just as you would variables in a normal Python script. Considering Jinja2 is effectively a meta-language, completely distinct from Python, and specialized in what it can do, this is quite remarkable.</li>
<li>If you made any mistakes, Werkzeug has a nifty error page with links to your stack trace, which includes a<a id="_idIndexMarker756"/> trace of your template. PyCharm captures this information and displays it, complete with hyperlinks in the <strong class="bold">Run</strong> window. The hyperlinks take you to the code in PyCharm rather than just displaying it as Werkzeug does in the browser window.</li>
<li>You’ll see the same level of support for popular Flask plugins as you do for Jinja2. Flask is designed to be extensible. There is a plethora of plugins to make your life easier in many areas of web development, from REST API development to database ORMs to session handling and authentication. You’ll find PyCharm guiding you through development in any Flask development scenario in which you find yourself.</li>
</ul>
<h1 id="_idParaDest-217"><a id="_idTextAnchor221"/>Summary</h1>
<p>I’ve pointed out a few times now that this chapter is a poor tutorial on Flask. We just barely scratched the surface of what Flask can do, but we covered all the ways PyCharm can help you with Flask development and it is one of the few IDEs that provides the level of help and tooling we’ve seen as we developed this simple project.</p>
<p>For starters, Flask provides an easy way to generate a project structure and starter code for a Flask project. Like any other project, PyCharm sets up your virtual environment and gives you some starter code. When we use the Flask template in PyCharm Professional, PyCharm also installs your project dependencies for you and sets up a specialized run configuration for your project.</p>
<p>Once you get into editing your project, you find all the features we’ve covered in earlier chapters coming together. The HTML, CSS, and JavaScript-related features work not only with normal HTML projects but also with the Jinja2 templating language native to Flask. We get Flask-specific inspections, code hints, and documentation not just for Flask but also for the extended Flask ecosystem.</p>
<p>We even found we can debug Jinja2 templates as if they were actually Python code! Combine that with some very nice navigational enhancements to help you move between presentation logic and backend logic and you’ve got an unbeatable combination of power and functionality at your fingertips as a Flask developer.</p>
<p>Flask isn’t the only game in town. Newer<a id="_idIndexMarker757"/> development models have become popular over the last few years: specifically <strong class="bold">single-page apps</strong> (<strong class="bold">SPAs</strong>) combined with pure RESTful APIs on the backend. The next chapter focuses on a fast, modern approach to building RESTful APIs using a framework called FastAPI. </p>
<p>As you will see, FastAPI bears some resemblence to Flask but with some important differences. Flask uses a worker model to serve content or data while FastAPI works a little more like NodeJS, which uses an asychronous programming model. FastAPI tends to focus solely on creating RESTful APIs and lacks the templating utilities found in Flask.</p>
<h1 id="_idParaDest-218"><a id="_idTextAnchor222"/>Further reading</h1>
<p>Be sure to check out the companion website for the book at <a href="https://www.pycharm-book.com">https://www.pycharm-book.com</a>. The site allows me to list newer resources as they become available. The following resources will also be useful:</p>
<ul>
<li>Gaspar, D., &amp; Stouffer, J. (2018). <em class="italic">Mastering Flask Web Development: Build Enterprise-grade, Scalable Python Web Applications</em>. Packt Publishing Ltd.</li>
<li>Van Horn II, B. (2019). <em class="italic">Building RESTful APIs with Flask</em>. LinkedIn Learning: <a href="https://www.linkedin.com/learning/building-restful-apis-with-flask/restful-apis-with-python-3-and-fl">https://www.linkedin.com/learning/building-restful-apis-with-flask/restful-apis-with-python-3-and-flask-4</a>.</li>
<li>Van Horn II, B. (2021). MongoDB for Python Developers. MadDevSkilz.com. <a href="https://www.maddevskilz.com/courses/mongodb-for-python-developers">https://www.maddevskilz.com/courses/mongodb-for-python-developers</a>. Note:  Despite the title, this is a short tutorial on creating a Flask application that uses MongoDB. It is very similar to, and newer than, my LinkedIn course.</li>
</ul>
</div>
</body></html>