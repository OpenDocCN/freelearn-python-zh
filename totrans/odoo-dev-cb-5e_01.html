<html><head></head><body>
		<div id="_idContainer024">
			<h1 id="_idParaDest-21" class="chapter-number"><a id="_idTextAnchor020"/>1</h1>
			<h1 id="_idParaDest-22"><a id="_idTextAnchor021"/>Installing the Odoo Development Environment</h1>
			<p>To begin our Odoo development journey, we must set up our development environment by installing Odoo using source code that we can use to enhance, debug, and improve our development skills. There are several ways to set up an Odoo development environment, but this chapter proposes the best of them. You will find several other tutorials on the web explaining the other approaches. Keep in mind that this chapter is about setting up a development environment that has different requirements from a production environment; production has different parameters we must set in the config file, as per the volume of data and number of users in the system. We will cover configuration file parameters and their usage in <span class="No-Break">this chapter.</span></p>
			<p>If you are new to Odoo development, you must know about certain aspects of the Odoo ecosystem. The first recipe will give you a brief introduction to the Odoo ecosystem, after which we will install Odoo for <span class="No-Break">development purposes.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>Understanding the <span class="No-Break">Odoo ecosystem</span></li>
				<li>Installing Odoo from <span class="No-Break">the source</span></li>
				<li>Managing Odoo <span class="No-Break">server databases</span></li>
				<li>Storing the instance configuration in <span class="No-Break">a file</span></li>
				<li>Activating Odoo <span class="No-Break">developer tools</span></li>
				<li>Updating the add-on <span class="No-Break">modules list</span></li>
			</ul>
			<h1 id="_idParaDest-23"><a id="_idTextAnchor022"/>Technical requirements</h1>
			<p>All the code that’s used in this chapter can be downloaded from this book’s GitHub repository <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter01"><span class="No-Break">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter01</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-24"><a id="_idTextAnchor023"/>Understanding the Odoo ecosystem</h1>
			<p>Odoo provides developers with out-of-the-box modularity and its powerful framework helps them build projects quickly. There are various characters in the Odoo ecosystem that you should <a id="_idIndexMarker000"/>be familiar with before embarking on your journey of becoming a successful <span class="No-Break">Odoo developer.</span></p>
			<p>Let’s assume you have a system with 4 CPU cores, 8 GB of RAM, and 30 concurrent <span class="No-Break">Odoo users.</span></p>
			<p>To determine the number of workers needed, divide the number of users by 6. In this case, 30 users divided by 6 equals 5, which is the theoretical number of <span class="No-Break">workers required.</span></p>
			<p>To calculate the theoretical maximum number of workers, multiply the number of CPU cores by 2 and add 1. For 4 CPU cores, (4 * 2) + 1 equals 9, which is the theoretical maximum number <span class="No-Break">of workers.</span></p>
			<p>Based on these calculations, you can use 5 workers for the Odoo users and an additional worker for the cron worker, making a total of <span class="No-Break">6 workers.</span></p>
			<p>To estimate the RAM consumption, use the <span class="No-Break">following formula:</span></p>
			<p><strong class="source-inline">RAM = Number of workers * ((0.8 * 150) + (0.2 * </strong><span class="No-Break"><strong class="source-inline">1024))</strong></span></p>
			<p>In this case, 6 workers multiplied by <strong class="source-inline">((0.8 * 150) + (0.2 * 1024))</strong> equals approximately 2 GB <span class="No-Break">of RAM.</span></p>
			<p>Therefore, based on these calculations, the Odoo installation will require around 2 GB <span class="No-Break">of RAM.</span></p>
			<h2 id="_idParaDest-25"><a id="_idTextAnchor024"/>Odoo editions</h2>
			<p>Odoo comes in two <a id="_idIndexMarker001"/>different editions. The first one is <strong class="bold">Community Edition</strong>, which is open source, while the second one is <strong class="bold">Enterprise Edition</strong>, which has licensing fees. Unlike other software vendors, Odoo Enterprise Edition is just a pack of extra applications that adds extra features or new apps to the Community Edition. The Enterprise Edition runs on top of the Community Edition. The Community <a id="_idIndexMarker002"/>Edition comes under the <strong class="bold">Lesser General Public License v3.0</strong> (<strong class="bold">LGPLv3</strong>) and comes with all of the basic <strong class="bold">enterprise resource planning</strong> (<strong class="bold">ERP</strong>) applications, such as sales, <strong class="bold">customer relationship management</strong> (<strong class="bold">CRM</strong>), invoicing, purchases, and a website builder. Alternatively, the <a id="_idIndexMarker003"/>Enterprise Edition comes with the Odoo <a id="_idIndexMarker004"/>Enterprise Edition license, which is a proprietary license. Odoo <a id="_idIndexMarker005"/>Enterprise Edition has <a id="_idIndexMarker006"/>several advanced features, such as full accounting, studio, <strong class="bold">Voice over Internet Protocol</strong> (<strong class="bold">VoIP</strong>), mobile responsive design, e-sign, marketing <a id="_idIndexMarker007"/>automation, delivery and banking integrations, <strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>), and more. The Enterprise Edition also provides you with unlimited <em class="italic">bugfix support</em>. The following diagram shows that the Enterprise Edition depends on the Community Edition, which is why you need the latter to use <span class="No-Break">the former:</span></p>
			<div>
				<div id="_idContainer005" class="IMG---Figure">
					<img src="image/B20997_01_1.jpg" alt="Figure 1.1 – Differences between the Community Edition and Enterprise Edition"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Differences between the Community Edition and Enterprise Edition</p>
			<p>You can find a full comparison of both editions <span class="No-Break">here: </span><a href="https://www.odoo.com/page/editions"><span class="No-Break">https://www.odoo.com/page/editions</span></a><span class="No-Break">.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Odoo has the largest number of community developers among all open source ERPs on the market with 20K+ forks on GitHub, hence why you will find a large number of third-party apps (modules) on the <a id="_idIndexMarker008"/>app store. Some of the free apps use an <strong class="bold">Affero General Public License version 3</strong> (<strong class="bold">AGPLv3</strong>). You cannot use the proprietary license on your app if your application has dependencies on such apps. Apps with an Odoo proprietary license can only be developed on modules that have LGPL or other <span class="No-Break">proprietary licenses.</span></p>
			<h2 id="_idParaDest-26"><a id="_idTextAnchor025"/>Git repositories</h2>
			<p>The entire code base of Odoo is hosted on GitHub. You can post bugs/issues for stable versions here. You <a id="_idIndexMarker009"/>can also propose a new feature by submitting a <strong class="bold">pull request</strong> (<strong class="bold">PR</strong>). There are <a id="_idIndexMarker010"/>several repositories in Odoo. See the following table for <span class="No-Break">more information:</span></p>
			<table id="table001-1" class="No-Table-Style _idGenTablePara-1">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="bold">Repositories</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="bold">Purpose</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><a href="https://github.com/odoo/odoo"><span class="No-Break">https://github.com/odoo/odoo</span></a></p>
						</td>
						<td class="No-Table-Style">
							<p>This is the Community Edition of Odoo. It’s <span class="No-Break">available publicly.</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><a href="https://github.com/odoo/enterprise"><span class="No-Break">https://github.com/odoo/enterprise</span></a></p>
						</td>
						<td class="No-Table-Style">
							<p>This is the Enterprise Edition of Odoo. It’s available to official Odoo <span class="No-Break">partners only.</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><a href="https://github.com/odoo-dev/odoo"><span class="No-Break">https://github.com/odoo-dev/odoo</span></a></p>
						</td>
						<td class="No-Table-Style">
							<p>This is an ongoing development repository. It’s <span class="No-Break">available publicly.</span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 1.1 – Odoo git repositories</p>
			<p>Every year, Odoo releases a major release, which is a long-term support version that will last for 3 years, and a few <a id="_idIndexMarker011"/>minor versions. Minor versions are mostly used in Odoo’s online <strong class="bold">Software-as-a-Service</strong> (<strong class="bold">SaaS</strong>) offering, meaning that Odoo SaaS users get early access to these features. Major version branches have names such as 17.0, 16.0, 15.0, 14.0, 13.0, and 12.0, while minor version branches have names such as saas-17.1 and saas-17.2 on GitHub. These minor versions are mostly used for Odoo’s SaaS platform. The <strong class="source-inline">master</strong> branch is under development and is unstable, so it is advisable not to use this for production since it might break <span class="No-Break">your database.</span></p>
			<h2 id="_idParaDest-27"><a id="_idTextAnchor026"/>Runbot</h2>
			<p>Runbot is Odoo’s automated testing environment. Whenever there is a new commit in Odoo’s GitHub branch, Runbot pulls those latest changes and creates the builds for the last four commits. Here, you can <a id="_idIndexMarker012"/>test all stable and in-development branches. You can even play with the Enterprise Edition and its <span class="No-Break">development branches.</span></p>
			<p>Every build has a different background color, which indicates the status of the test cases. A green background color means that all of the test cases run successfully and you can test that branch, while a red background color means that some test cases have failed on this branch and some features might be broken on that build. You can view the logs for all test cases, which show exactly what happens during installation. Every build has two databases. The <strong class="source-inline">all</strong> database has all of the modules installed on it, while the <strong class="source-inline">base</strong> database only has base Odoo modules installed. Every build is installed with basic demo data, so you can test it quickly without <span class="No-Break">extra configurations.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can <a id="_idIndexMarker013"/>access Runbot <span class="No-Break">at </span><a href="http://runbot.odoo.com/runbo"><span class="No-Break">http://runbot.odoo.com/runbo</span></a><span class="No-Break"><span class="P---URL">t</span></span><span class="No-Break">.</span></p>
			<p>The following credentials can be used to access any <span class="No-Break">Runbot build:</span></p>
			<ul>
				<li><strong class="bold">Login ID</strong>: admin <span class="No-Break"><strong class="bold">Password</strong></span><span class="No-Break">: admin</span></li>
				<li><strong class="bold">Login ID</strong>: demo <span class="No-Break"><strong class="bold">Password</strong></span><span class="No-Break">: demo</span></li>
				<li><strong class="bold">Login ID</strong>: portal <span class="No-Break"><strong class="bold">Password</strong></span><span class="No-Break">: portal</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">This is a public testing environment, so other users might be using/testing the same branch that you <span class="No-Break">are testing.</span></p>
			<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/>Odoo app store</h2>
			<p>Odoo launched <a id="_idIndexMarker014"/>the app store a few years back, and it was an instant hit. At the time of writing, over 39,000+ different apps are hosted there. You will find lots of free and paid applications for different versions here. This includes specific solutions for different business verticals, such as education, food industries, and medicine. It also includes apps that extend or add new features to existing Odoo applications. The app store also provides numerous beautiful themes for the Odoo website builder. In <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>, you will learn how to set pricing and currency for your <span class="No-Break">custom module.</span></p>
			<p>You can <a id="_idIndexMarker015"/>access the Odoo app store by going <span class="No-Break">to </span><a href="https://www.odoo.com/apps"><span class="No-Break">https://www.odoo.com/apps</span></a><span class="No-Break">.</span></p>
			<p>You can <a id="_idIndexMarker016"/>access Odoo’s themes by going <span class="No-Break">to </span><a href="https://www.odoo.com/apps/themes"><span class="No-Break">https://www.odoo.com/apps/themes</span></a><span class="No-Break">.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Odoo has open sourced several themes after version 13 and now works with an advanced JavaScript called <em class="italic">OWL</em>. We will cover this in <a href="B20997_16.xhtml#_idTextAnchor929"><span class="No-Break"><em class="italic">Chapter 16</em></span></a>. Note that these were paid themes in previous versions. This means that, in Odoo versions 15 and 16, you can download and use those beautiful themes at no <span class="No-Break">extra cost.</span></p>
			<h2 id="_idParaDest-29"><a id="_idTextAnchor028"/>Odoo Community Association</h2>
			<p><strong class="bold">Odoo Community Association</strong> (<strong class="bold">OCA</strong>) is a non-profit organization that develops/manages community-based Odoo modules. All OCA modules are open source and maintained <a id="_idIndexMarker017"/>by Odoo community members. OCA’s GitHub account contains multiple repositories for different Odoo applications. Apart from Odoo modules, it also contains various tools, a migration library, accounting localizations, and <span class="No-Break">so on.</span></p>
			<p>Here is the <a id="_idIndexMarker018"/>URL for OCA’s official GitHub <span class="No-Break">account: </span><a href="https://github.com/OCA"><span class="No-Break">https://github.com/OCA</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>Official Odoo help forum</h2>
			<p>Odoo has a very powerful framework, and tons of things can be achieved just by using/activating <a id="_idIndexMarker019"/>options or by following specific patterns. Consequently, if you run into some technical issues or if you are not sure about some complex cases, then you can post your query on Odoo’s official help forum. Lots of developers are active on this forum, including some official <span class="No-Break">Odoo employees.</span></p>
			<p>You can <a id="_idIndexMarker020"/>search for questions or post your new questions by going <span class="No-Break">to </span><a href="https://www.odoo.com/forum/help-1"><span class="No-Break">https://www.odoo.com/forum/help-1</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/>Odoo’s eLearning platform</h2>
			<p>Recently, Odoo has launched a new eLearning platform. This platform provides lots of videos that <a id="_idIndexMarker021"/>explain how to use different Odoo applications. At the time of writing, this platform does not have technical videos, just <span class="No-Break">functional ones.</span></p>
			<p>Here is the <a id="_idIndexMarker022"/>URL for Odoo’s eLearning <span class="No-Break">platform: </span><a href="https://www.odoo.com/slides"><span class="No-Break">https://www.odoo.com/slides</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-32"><a id="_idTextAnchor031"/>Installing Odoo from the source</h1>
			<p>It is highly <a id="_idIndexMarker023"/>recommended that you use the <strong class="bold">Linux Ubuntu</strong> operating system to install Odoo since this is the operating system that Odoo uses for all its tests, debugging, and installations <a id="_idIndexMarker024"/>of Odoo Enterprise. Additionally, most Odoo developers use GNU/Linux distributions, so they are much more likely to get support from the Odoo community for operating system-level <a id="_idIndexMarker025"/>issues that occur in <strong class="bold">GNU/Linux</strong> than <em class="italic">Windows</em> <span class="No-Break">or </span><span class="No-Break"><em class="italic">macOS</em></span><span class="No-Break">.</span></p>
			<p>It is also recommended to develop Odoo add-on modules using the same environment (the same distribution and the same version) as the one that will be used in production. This will avoid nasty surprises, such as discovering on the day of deployment that a library has a different version than expected, with a slightly different and incompatible behavior. If your <a id="_idIndexMarker026"/>workstation is using a different operating system, a good approach is to set up a <strong class="bold">virtual machine</strong> (<strong class="bold">VM</strong>) on your workstation and install a GNU/Linux distribution in <span class="No-Break">the VM.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Ubuntu is available <a id="_idIndexMarker027"/>as an app in the <strong class="bold">Microsoft Store</strong>, so you can use that if you don’t want to switch <span class="No-Break">to Ubuntu.</span></p>
			<p>For this book, we will be using Ubuntu Server 22.04 LTS, but you can use any other Debian GNU/Linux operating system. Whatever Linux distribution you choose, you should have some notion of how to use it from the command line, and knowing about system administration will certainly not do <span class="No-Break">any harm.</span></p>
			<h2 id="_idParaDest-33"><a id="_idTextAnchor032"/>Getting ready</h2>
			<p>We are assuming that you have Ubuntu 22.04 up and running and that you have an account with <a id="_idIndexMarker028"/>root access or that <strong class="source-inline">sudo</strong> has been configured. In the following sections, we will install Odoo’s dependencies and download Odoo’s source code <span class="No-Break">from GitHub.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Some of the configurations require a system login username, so we will use <strong class="source-inline">$(whoami)</strong> whenever a login username is required in a command line. This is a shell command that will substitute your login in the command you <span class="No-Break">are typing.</span></p>
			<p>Some operations will be easier if you have a GitHub account. If you don’t have one already, go to <a href="https://github.com">https://github.com</a> and <span class="No-Break">create one.</span></p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/>How to do it...</h2>
			<p>To install Odoo from the source, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Run the following commands to install the <span class="No-Break">main dependencies:</span><pre class="source-code">
<strong class="bold">$ sudo apt-get update</strong>
<strong class="bold">$ sudo apt install openssh-server fail2ban python3-pip python3-dev libxml2-dev libxslt1-dev zlib1g-dev libsasl2-dev libldap2-dev build-essential libssl-dev libffi-dev libmysqlclient-dev libpq-dev libjpeg8-dev liblcms2-dev libblas-dev libatlas-base-dev git curl python3-venv python3.10-venv fontconfig libxrender1 xfonts-75dpi xfonts-base -y</strong></pre></li>				<li>Download and <span class="No-Break">install </span><span class="No-Break"><strong class="bold">wkhtmltopdf</strong></span><span class="No-Break">:</span><pre class="source-code">
<strong class="bold">$ wget https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6.1-2/wkhtmltox_0.12.6.1-2.jammy_amd64.deb</strong>
<strong class="bold">$ sudo dpkg -i wkhtmltox_0.12.6.1-2.jammy_amd64.deb</strong></pre><p class="list-inset">If you encounter any errors after running the previous command, force install the dependencies with the <span class="No-Break">following command:</span></p><pre class="source-code"><strong class="bold">$ sudo apt-get install -f</strong></pre></li>				<li>Now, install <a id="_idIndexMarker029"/>the <span class="No-Break">PostgreSQL database:</span><pre class="source-code">
<strong class="bold">$ sudo apt install postgresql -y</strong></pre></li>				<li><span class="No-Break">Configure PostgreSQL:</span><pre class="source-code">
<strong class="bold">$ sudo -i -u postgres createuser -s  $(whoami)</strong>
<strong class="bold">$ sudo su postgres</strong>
<strong class="bold">$ psql</strong>
<strong class="bold">alter user $(whoami) with password 'your_password';</strong>
<strong class="bold">\q</strong>
<strong class="bold">exit</strong></pre></li>				<li><span class="No-Break">Configure </span><span class="No-Break"><strong class="source-inline">git</strong></span><span class="No-Break">:</span><pre class="source-code">
<strong class="bold">$ git config --global user.name "Your Name"</strong>
<strong class="bold">$ git config --global user.email youremail@example.com</strong></pre></li>				<li>Clone the Odoo <span class="No-Break">code base:</span><pre class="source-code">
<strong class="bold">$ mkdir ~/odoo-dev</strong>
<strong class="bold">$ cd ~/odoo-dev</strong>
<strong class="bold">$ git clone -b 17.0 --single-branch --depth 1 https://github.com/odoo/odoo.git</strong></pre></li>				<li>Create an <strong class="source-inline">odoo-17.0</strong> virtual environment and <span class="No-Break">activate it:</span><pre class="source-code">
<strong class="bold">$ python3 -m venv ~/venv-odoo-17.0</strong>
<strong class="bold">$ source ~/venv-odoo-17.0/bin/activate</strong></pre></li>				<li>Install the Python dependencies of Odoo <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">venv</strong></span><span class="No-Break">:</span><pre class="source-code">
<strong class="bold">$ cd ~/odoo-dev/odoo/</strong>
<strong class="bold">$ pip3 install -r requirements.txt</strong></pre></li>				<li>Create and <a id="_idIndexMarker030"/>start your first <span class="No-Break">Odoo instances:</span><pre class="source-code">
<strong class="bold">$ createdb odoo-test</strong>
<strong class="bold">$ python3 odoo-bin -d odoo-test </strong><strong class="bold">-</strong><strong class="bold">i base --addons-path=addons --db-filter=odoo-test$</strong></pre></li>				<li>Point your browser to <strong class="source-inline">http://localhost:8069</strong> and authenticate it by using the <strong class="source-inline">admin</strong> account and using <strong class="source-inline">admin</strong> as <span class="No-Break">the password.</span></li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">If you need RTL support, please install <strong class="source-inline">node</strong> and <strong class="source-inline">rtlcss</strong> by running <strong class="source-inline">sudo apt-get install nodejs npm -y sudo npm install -</strong><span class="No-Break"><strong class="source-inline">g rtlcss</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we installed <a id="_idIndexMarker031"/>several core dependencies. These dependencies include <a id="_idIndexMarker032"/>various tools, such as <strong class="bold">git</strong>, <strong class="bold">pip3</strong>, <strong class="bold">wget</strong>, Python setup tools, and more. These core <a id="_idIndexMarker033"/>tools will help us install other Odoo dependencies using <span class="No-Break">simple commands.</span></p>
			<p>In <em class="italic">step 2</em>, we downloaded and installed the <strong class="source-inline">wkhtmltopdf</strong> package, which is used in Odoo to print PDF documents such as sale orders, invoices, and other reports. Odoo 17.0 needs version 0.12.6.1 of <strong class="source-inline">wkhtmltopdf</strong>, and that exact version might be not included in the current Linux distributions. Fortunately for us, the maintainers of <strong class="source-inline">wkhtmltopdf</strong> provide pre-built packages for various distributions at <a href="http://wkhtmltopdf.org/downloads.html">http://wkhtmltopdf.org/downloads.html</a> and we have downloaded and installed it from <span class="No-Break">that URL.</span></p>
			<p>After this, we configured PostgreSQL, which is used for Odoo’s <span class="No-Break">database management.</span></p>
			<h3>PostgreSQL configuration</h3>
			<p>In <em class="italic">step 3</em>, we installed the <span class="No-Break">PostgreSQL database.</span></p>
			<p>In <em class="italic">step 4</em>, we created a <a id="_idIndexMarker034"/>new database user with the login name of our system. <strong class="source-inline">$(whoami)</strong> is used to fetch your login name, and the <strong class="source-inline">-s</strong> option is used to give superuser rights. Let’s see why we need <span class="No-Break">these configurations.</span></p>
			<p>Odoo uses the <strong class="source-inline">psycopg2</strong> Python library to connect with a PostgreSQL database. To access a PostgreSQL database with the <strong class="source-inline">psycopg2</strong> library, Odoo uses the following values <span class="No-Break">by default:</span></p>
			<ul>
				<li>By default, <strong class="source-inline">psycopg2</strong> tries to connect to a database with the same username as the current user on local connections, which enables password-less authentication (this is good for the <span class="No-Break">development environment)</span></li>
				<li>The local connection uses Unix <span class="No-Break">domain sockets</span></li>
				<li>The database server listens on <span class="No-Break">port </span><span class="No-Break"><strong class="source-inline">5432</strong></span></li>
			</ul>
			<p>That’s it! Your PostgreSQL database is now ready to be connected <span class="No-Break">with Odoo.</span></p>
			<p>As this is a development server, we have given <strong class="source-inline">--superuser</strong> rights to the user. It is OK to give the PostgreSQL user more rights as this will be your development instance. For a production instance, you can use the <strong class="source-inline">--createdb</strong> command line instead of <strong class="source-inline">--superuser</strong> to restrict rights. The <strong class="source-inline">–superuser</strong> rights in a production server will give additional leverage to an attacker exploiting a vulnerability in some part of the <span class="No-Break">deployed code.</span></p>
			<p>If you want to use a database user with a different login, you will need to provide a password for the user. This is done by passing the <strong class="source-inline">--pwprompt</strong> flag on the command line when creating the user, in which case the command will prompt you for <span class="No-Break">the password.</span></p>
			<p>If the user has already been created and you want to set a password (or modify a forgotten password), you can use the <span class="No-Break">following command:</span></p>
			<pre class="console">
$ psql -c "alter role $(whoami) with password 'newpassword'"</pre>			<p>If this command fails with an error message saying that the database does not exist, it is because you did not create a database named after your login name in <em class="italic">step 4</em> of this recipe. That’s fine; just add the <strong class="source-inline">--dbname</strong> option with an existing database name, such as <strong class="source-inline">--</strong><span class="No-Break"><strong class="source-inline">dbname template1</strong></span><span class="No-Break">.</span></p>
			<h3>Git configuration</h3>
			<p>For the development environment, we are using Odoo sourced from GitHub. With <strong class="source-inline">git</strong>, you can easily <a id="_idIndexMarker035"/>switch between different Odoo versions. Note that you can fetch the latest changes with the <strong class="source-inline">git </strong><span class="No-Break"><strong class="source-inline">pull</strong></span><span class="No-Break"> command.</span></p>
			<p>In <em class="italic">step 5</em>, we configured our <span class="No-Break"><strong class="source-inline">git</strong></span><span class="No-Break"> user.</span></p>
			<p>In <em class="italic">step 6</em>, we downloaded the source code from Odoo’s official GitHub repository. We used the <strong class="source-inline">git clone</strong> command to download Odoo’s source code. We used a single branch as we only wanted a branch for the 17.0 version. We also used <strong class="source-inline">--depth 1</strong> to avoid downloading the full commit history of the branch. These options will download the source code very quickly, but if you want, you can omit <span class="No-Break">those options.</span></p>
			<p>Odoo developers also propose nightly builds, which are available as tarballs and distribution packages. The main advantage of using <strong class="source-inline">git clone</strong> is that you will be able to update your repository when new bug fixes are committed in the source tree. You will also be able to easily test any proposed fixes and track regressions so that you can make your bug reports more precise and helpful <span class="No-Break">for developers.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you have access to the Enterprise Edition source code, you can download that in a separate folder under the <strong class="source-inline">~/</strong><span class="No-Break"><strong class="source-inline">odoo-dev</strong></span><span class="No-Break"> directory.</span></p>
			<h3>Virtual environments</h3>
			<p>Python <strong class="bold">virtual environments</strong>, or <strong class="bold">venvs</strong> for short, are isolated Python workspaces. These are <a id="_idIndexMarker036"/>very useful to Python developers because they allow different workspaces with different versions of various Python libraries to be installed, possibly on different Python <span class="No-Break">interpreter versions.</span></p>
			<p>You can create as many environments as you wish using the <strong class="source-inline">python3 -m venv ~/newvenv</strong> command. This will create a <strong class="source-inline">newvenv</strong> directory in the specified location, containing a <strong class="source-inline">bin/</strong> subdirectory and a <span class="No-Break"><strong class="source-inline">lib/python3.10</strong></span><span class="No-Break"> subdirectory.</span></p>
			<p>In <em class="italic">step 7</em>, we created a new virtual environment in the <strong class="source-inline">~/venv-odoo-17.0</strong> directory. This will be our isolated Python environment for Odoo, and all of Odoo’s Python dependencies will be installed in <span class="No-Break">this environment.</span></p>
			<p>To activate the <a id="_idIndexMarker037"/>virtual environment, we need to use the <strong class="source-inline">source</strong> command. We used the <strong class="source-inline">source ~/venv-odoo-17.0/bin/activate</strong> command to activate the <span class="No-Break">virtual environment.</span></p>
			<h3>Installing Python packages</h3>
			<p>Odoo’s source code has a list of Python dependencies in <strong class="source-inline">requirements.txt</strong>. In <em class="italic">step 8</em>, we installed <a id="_idIndexMarker038"/>all those requirements via the <strong class="source-inline">pip3 </strong><span class="No-Break"><strong class="source-inline">install</strong></span><span class="No-Break"> command.</span></p>
			<p>That’s it. Now, you can run the <span class="No-Break">Odoo instance.</span></p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/>Starting the instance</h2>
			<p>Now comes the moment you’ve been waiting for. To start our first instance, in <em class="italic">step 9</em>, we created a <a id="_idIndexMarker039"/>new empty database, used the <strong class="source-inline">odoo-bin</strong> script, and then started the Odoo instance with the <span class="No-Break">following command:</span></p>
			<pre class="console">
python3 odoo-bin -d odoo-test -i base --addons-path=addons --db-filter=odoo-test$</pre>			<p>You can also omit <strong class="source-inline">python3</strong> by using <strong class="source-inline">./</strong> before <strong class="source-inline">odoo-bin</strong> as it is an executable <span class="No-Break">Python script:</span></p>
			<pre class="console">
./odoo-bin -d odoo-test -i base --addons-path=addons --db-filter=odoo-test$</pre>			<p>With <strong class="source-inline">odoo-bin</strong>, a script with the following command-line arguments <span class="No-Break">is used:</span></p>
			<ul>
				<li><strong class="source-inline">-d database_name</strong>: Use this database <span class="No-Break">by default.</span></li>
				<li><strong class="source-inline">--db-filter=database_name$</strong>: Only try to connect to databases that match the supplied regular expression. One Odoo installation can serve multiple instances that live in separate databases, and this argument limits the available databases. The trailing <strong class="source-inline">$</strong> is important as the regular expression is used in match mode. This enables you to avoid selecting names starting with the <span class="No-Break">specified string.</span></li>
				<li><strong class="source-inline">--addons-path=directory1,directory2,...</strong>: This is a comma-separated list of directories in which Odoo will look for add-ons. This list is scanned at instance creation time to populate the list of available add-on modules in the instance. If you want to use Odoo’s Enterprise Edition, then add its directory with <span class="No-Break">this option.</span></li>
				<li><strong class="source-inline">-i base</strong>: This is used to install a base module. This is required when you have created a database via the <span class="No-Break">command line.</span></li>
			</ul>
			<p>If you are using a <a id="_idIndexMarker040"/>database user with a database login that is different from your Linux login, you need to pass the following <span class="No-Break">additional arguments:</span></p>
			<ul>
				<li><strong class="source-inline">--db_host=localhost</strong>: Use a TCP connection to the <span class="No-Break">database server</span></li>
				<li><strong class="source-inline">--db_user=database_username</strong>: Use the specified <span class="No-Break">database login</span></li>
				<li><strong class="source-inline">--db_password=database_password</strong>: This is the password for authenticating against the <span class="No-Break">PostgreSQL server</span></li>
			</ul>
			<p>To get an overview of all available options, use the <strong class="source-inline">--help</strong> argument. We will see more of the <strong class="source-inline">odoo-bin</strong> script later in <span class="No-Break">this chapter.</span></p>
			<p>When Odoo is started on an empty database, it will create the database structure that’s needed to support its operations. It will also scan the add-on path to find the available add-on modules and insert some into the initial records in the database. This includes the <strong class="source-inline">admin</strong> user with the default <strong class="source-inline">admin</strong> password, which you will use <span class="No-Break">for authentication.</span></p>
			<p>Pointing your web browser to <strong class="source-inline">http://localhost:8069/</strong> leads you to the login page of your newly created instance, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer006" class="IMG---Figure">
					<img src="image/B20997_01_2.jpg" alt="Figure 1.2 – Login screen of the Odoo instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Login screen of the Odoo instance</p>
			<p>This is because <a id="_idIndexMarker041"/>Odoo includes an HTTP server. By default, it listens on all local network interfaces on TCP <span class="No-Break">port </span><span class="No-Break"><strong class="source-inline">8069</strong></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-37"><a id="_idTextAnchor036"/>Managing Odoo server databases</h1>
			<p>When working <a id="_idIndexMarker042"/>with Odoo, all the data in your instance is stored in a PostgreSQL database. All the standard database management tools you are used to are available, but Odoo also proposes a web interface for some <span class="No-Break">common operations.</span></p>
			<h2 id="_idParaDest-38"><a id="_idTextAnchor037"/>Getting ready</h2>
			<p>We are assuming that your work environment is set up and that you have an <span class="No-Break">instance running.</span></p>
			<h2 id="_idParaDest-39"><a id="_idTextAnchor038"/>How to do it...</h2>
			<p>The Odoo database management interface provides tools to create, duplicate, remove, back up, and restore a database. There is also a way to change the master password, which is used <a id="_idIndexMarker043"/>to protect access to the database <span class="No-Break">management interface.</span></p>
			<h3>Accessing the database management interface</h3>
			<p>To access <a id="_idIndexMarker044"/>the database, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Go to the login screen of your instance (if you are authenticated, <span class="No-Break">log out).</span></li>
				<li>Click on <strong class="bold">Manage Databases</strong>. This will navigate you to <a href="http://localhost:8069/web/database/manager">http://localhost:8069/web/database/manager</a> (you can also point your browser directly to <span class="No-Break">that URL):</span></li>
			</ol>
			<div>
				<div id="_idContainer007" class="IMG---Figure">
					<img src="image/B20997_01_3.jpg" alt="Figure 1.3 – Database manager"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – Database manager</p>
			<h3>Setting or changing the master password</h3>
			<p>If you’ve <a id="_idIndexMarker045"/>set up your instance with default <a id="_idIndexMarker046"/>values and haven’t modified it yet, as we will explain in the following section, the database management <a id="_idIndexMarker047"/>screen will display a <a id="_idIndexMarker048"/>warning, telling you that the <strong class="source-inline">master password</strong> instance hasn’t been set and will advise you to set one with a <span class="No-Break">direct link:</span></p>
			<div>
				<div id="_idContainer008" class="IMG---Figure">
					<img src="image/B20997_01_4.jpg" alt="Figure 1.4 – Master password warning"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.4 – Master password warning</p>
			<p>To set the master password, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Click on the <strong class="bold">Set Master Password</strong> button. You will get a dialog box asking you to fill in the <strong class="bold">New Master </strong><span class="No-Break"><strong class="bold">Password</strong></span><span class="No-Break"> field:</span></li>
			</ol>
			<div>
				<div id="_idContainer009" class="IMG---Figure">
					<img src="image/B20997_01_5.jpg" alt="Figure 1.5 – Setting a new master password"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.5 – Setting a new master password</p>
			<ol>
				<li value="2">Type in <a id="_idIndexMarker049"/>a complex new password and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Continue</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>If the master <a id="_idIndexMarker050"/>password is already set, click on the <strong class="bold">Set Master Password</strong> button at the bottom of the screen to change it. In the dialog box that opens, type the previous master password and the new one, and then <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Continue</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer010" class="IMG---Figure">
					<img src="image/B20997_01_6.0.jpg" alt="Figure 1.6 – Changing the master password"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.6 – Changing the master password</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The master <a id="_idIndexMarker051"/>password is the server <a id="_idIndexMarker052"/>configuration file under the <strong class="source-inline">admin_passwd</strong> key. If the server is started without a configuration file being specified, a new one will be generated in <strong class="source-inline">~/.odoorc</strong>. Refer to the next recipe for more information about the <span class="No-Break">configuration file.</span></p>
			<h3>Creating a new database</h3>
			<p>This dialog <a id="_idIndexMarker053"/>box can be used to create a new database instance that will be handled by the current Odoo server. Follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>On the database management screen, click on the <strong class="bold">Create Database</strong> button, which can be found at the bottom of the screen. This will bring up the <span class="No-Break">following dialog:</span></li>
			</ol>
			<div>
				<div id="_idContainer011" class="IMG---Figure">
					<img src="image/B20997_01_7.0.jpg" alt="Figure 1.7 – The Create Database dialog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.7 – The Create Database dialog</p>
			<ol>
				<li value="2">Fill in <a id="_idIndexMarker054"/>the form, <span class="No-Break">as follows:</span><ul><li><strong class="bold">Master Password</strong>: This is the master password for <span class="No-Break">this instance.</span></li><li><strong class="bold">Database Name</strong>: Input the name of the database you wish <span class="No-Break">to create.</span></li><li><strong class="bold">Email</strong>: Add your email address here; this will be your <span class="No-Break">username later.</span></li><li><strong class="bold">Password</strong>: Type in the password you want to set for the admin user of the <span class="No-Break">new instance.</span></li><li><strong class="bold">Phone Number</strong>: Set your phone <span class="No-Break">number (optional).</span></li><li><strong class="bold">Language</strong>: Select the language that you wish to be installed by default in the <a id="_idIndexMarker055"/>new database in the drop-down list. Odoo will automatically load the translations for the <span class="No-Break">selected language.</span></li><li><strong class="bold">Country</strong>: Select the country of the main company in the drop-down list. Selecting this will automatically configure a few things, including the <span class="No-Break">company’s currency.</span></li><li><strong class="bold">Demo data</strong>: Check this box to obtain demonstration data. This is useful for running interactive tests or setting up a demonstration for a customer, but it should not be checked for a database that is designed to contain <span class="No-Break">production data.</span></li></ul></li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">If you wish to use the database to run automated tests for the modules (refer to <a href="B20997_07.xhtml#_idTextAnchor363"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Debugging Modules</em>), you need to have the demonstration data since the vast majority of the automated tests in Odoo depend on these records to <span class="No-Break">run successfully.</span></p>
			<ol>
				<li value="3">Click <strong class="bold">Continue</strong> and wait until the new database is initialized. After, you will be redirected to the instance and connected as <span class="No-Break">the administrator.</span></li>
			</ol>
			<p class="callout-heading">Troubleshooting</p>
			<p class="callout">If you are redirected to a login screen, this is probably because the <strong class="bold">--db-filter</strong> option was passed to Odoo and the new database name didn’t match the <strong class="source-inline">filter</strong> option. Note that the <strong class="source-inline">odoo-bin start</strong> command does this silently, making only the current database available. To work around this, simply restart Odoo without the <strong class="source-inline">start</strong> command, as shown in the <em class="italic">Installing Odoo from the source</em> recipe. If you have a configuration file (refer to the <em class="italic">Storing the instance configuration in a file</em> recipe later in this chapter), check that the <strong class="source-inline">db_filter</strong> option is unset or set to a value matching the new <span class="No-Break">database name.</span></p>
			<h3>Duplicating a database</h3>
			<p>Often, you will have an existing database, and you will want to experiment with it to try a procedure <a id="_idIndexMarker056"/>or run a test, but without modifying the existing data. The solution here is simple: duplicate the database and run the test on the copy. Repeat this as many times <span class="No-Break">as required:</span></p>
			<ol>
				<li>On the database management screen, click on the <strong class="bold">Duplicate Database</strong> link next to the name of the database you wish <span class="No-Break">to clone:</span></li>
			</ol>
			<div>
				<div id="_idContainer012" class="IMG---Figure">
					<img src="image/B20997_01_8.0.jpg" alt="Figure 1.8 – The Duplicate Database dialog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.8 – The Duplicate Database dialog</p>
			<ol>
				<li value="2">Fill in the form, <span class="No-Break">as follows:</span><ul><li><strong class="bold">Master Password</strong>: This is the master password of the <span class="No-Break">Odoo server</span></li><li><strong class="bold">New Name</strong>: The name you want to give to <span class="No-Break">the copy</span></li></ul></li>
				<li><span class="No-Break">Click </span><span class="No-Break"><strong class="bold">Continue</strong></span><span class="No-Break">.</span></li>
				<li>You can then <a id="_idIndexMarker057"/>click on the name of the newly created database on the database management screen to access the login screen for <span class="No-Break">that database.</span></li>
			</ol>
			<h3>Removing a database</h3>
			<p>When <a id="_idIndexMarker058"/>you have finished your tests, you will want to clean up the duplicated databases. To do this, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>On the database management screen, you will find the <strong class="bold">Delete</strong> button next to the name of the database. Clicking on it will bring up the <span class="No-Break">following dialog:</span></li>
			</ol>
			<div>
				<div id="_idContainer013" class="IMG---Figure">
					<img src="image/B20997_01_9.0.jpg" alt="Figure 1.9 – The Delete Database dialog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.9 – The Delete Database dialog</p>
			<ol>
				<li value="2">Fill in the form, as well as the <strong class="bold">Master Password</strong> field, which is the master password <a id="_idIndexMarker059"/>of the <span class="No-Break">Odoo server.</span></li>
				<li><span class="No-Break">Click </span><span class="No-Break"><strong class="bold">Delete</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p class="callout-heading">Caution! Potential data loss!</p>
			<p class="callout">If you selected the wrong database and have no backup, there is no way to recover the <span class="No-Break">lost data.</span></p>
			<h3>Backing up a database</h3>
			<p>To create a <a id="_idIndexMarker060"/>backup, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>On the database management screen, you will find the <strong class="bold">Backup</strong> button next to the database’s name. Clicking on it will bring up the <span class="No-Break">following dialog:</span></li>
			</ol>
			<div>
				<div id="_idContainer014" class="IMG---Figure">
					<img src="image/B20997_01_10.jpg" alt="Figure 1.10 – The Backup Database dialog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.10 – The Backup Database dialog</p>
			<ol>
				<li value="2">Fill in the form, <span class="No-Break">as follows:</span><ul><li><strong class="bold">Master Password</strong>: This is the master password of the <span class="No-Break">Odoo server.</span></li><li><strong class="bold">Backup Format</strong>: Always use <strong class="source-inline">zip</strong> for a production database since this is the only <a id="_idIndexMarker061"/>real full backup format. Only use the <strong class="source-inline">pg_dump</strong> format for a development database when you don’t care about the <span class="No-Break">file store.</span></li></ul></li>
				<li>Click <strong class="bold">Backup</strong>. The backup file will be downloaded to <span class="No-Break">your browser.</span></li>
			</ol>
			<h3>Restoring a database backup</h3>
			<p>If you need <a id="_idIndexMarker062"/>to restore a backup, this is what you need <span class="No-Break">to do:</span></p>
			<ol>
				<li>On the database management screen, you will find a <strong class="bold">Restore Database</strong> button at the bottom of the screen. Clicking on it will bring up the <span class="No-Break">following dialog:</span></li>
			</ol>
			<div>
				<div id="_idContainer015" class="IMG---Figure">
					<img src="image/B20997_01_11.jpg" alt="Figure 1.11 – The Restore Database dialog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.11 – The Restore Database dialog</p>
			<ol>
				<li value="2">Fill in <a id="_idIndexMarker063"/>the form, <span class="No-Break">as follows:</span><ul><li><strong class="bold">Master Password</strong>: This is the master password of the <span class="No-Break">Odoo server.</span></li><li><strong class="bold">File</strong>: This is a previously downloaded <span class="No-Break">Odoo backup.</span></li><li><strong class="bold">Database Name</strong>: Provide the name of the database in which the backup will be restored. The database must not exist on <span class="No-Break">the server.</span></li><li><strong class="bold">This database might have been moved or copied</strong>: Choose <strong class="bold">This database was moved</strong> if the original database was on another server or if it has been deleted from the current server. Otherwise, choose <strong class="bold">This database is a copy</strong>, which is the safe <span class="No-Break">default option.</span></li></ul></li>
				<li><span class="No-Break">Click </span><span class="No-Break"><strong class="bold">Continue</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">It isn’t <a id="_idIndexMarker064"/>possible to restore a database on top of itself. If you try to do this, you will get an error message (<strong class="bold">Database restore error: Database already exists</strong>). You need to remove the <span class="No-Break">database first.</span></p>
			<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/>How it works...</h2>
			<p>These features, apart from the <strong class="bold">Change master password</strong> screen, run PostgreSQL administration commands on the server and report back through the <span class="No-Break">web interface.</span></p>
			<p>The master password <a id="_idIndexMarker065"/>is a very important piece of information that only lives in the Odoo server configuration file and is never stored in the database. There used to be a default value of <strong class="source-inline">admin</strong>, but using this value is a security liability. In Odoo v9 and later, this is identified as an <em class="italic">unset</em> master password, and you are urged to change it when accessing the database administration interface. Even if it is stored in the configuration file under the <strong class="source-inline">admin_passwd</strong> entry, this is not the same as the password of the <strong class="source-inline">admin</strong> user; these are two independent passwords. The master password is set for an Odoo server process, which itself can handle multiple database instances, each of which has an independent <strong class="source-inline">admin</strong> user with their <span class="No-Break">own password.</span></p>
			<p class="callout-heading">Security considerations</p>
			<p class="callout">Remember that we are considering a development environment in this chapter. The Odoo database management interface is something that needs to be secured when you are working on a production server as it gives access to a lot of sensitive information, especially if the server hosts Odoo instances for several <span class="No-Break">different clients.</span></p>
			<p>To create a new database, Odoo uses the PostgreSQL <strong class="source-inline">createdb</strong> utility and calls the internal Odoo function to initialize the new database in the same way as when you start Odoo on an <span class="No-Break">empty database.</span></p>
			<p>To duplicate a database, Odoo uses the <strong class="source-inline">--template</strong> option of <strong class="source-inline">createdb</strong>, passing the original database as an argument. This duplicates the structure of the template database in the new database using internal and optimized PostgreSQL routines, which is much faster than creating a backup and restoring it (especially when using the web interface, which requires you to download the backup file and upload <span class="No-Break">it again).</span></p>
			<p>Backup and <a id="_idIndexMarker066"/>restore operations use the <strong class="source-inline">pg_dump</strong> and <strong class="source-inline">pg_restore</strong> utilities, respectively. When using the <strong class="source-inline">zip</strong> format, the backup will also include a copy of the file store that contains a copy of the documents when you configure Odoo so that it doesn’t keep these in the database; this is the default option in 14.0. Unless you change it, these files reside <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">~/.local/share/Odoo/filestore</strong></span><span class="No-Break">.</span></p>
			<p>If the backup becomes too large, downloading it may fail. This will be either because the Odoo server itself is unable to handle the large file in memory or because the server is running behind a reverse proxy because there is a limit to the size of HTTP responses that were set in the proxy. Conversely, for the same reasons, you will likely experience issues with the database restore operation. When you start running into these issues, it’s time to invest in a more robust external <span class="No-Break">backup solution.</span></p>
			<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/>There’s more...</h2>
			<p>Experienced Odoo developers generally don’t use the database management interface and perform operations from the command line. To initialize a new database with demo data, for instance, the following single-line command can <span class="No-Break">be used:</span></p>
			<pre class="console">
$ createdb testdb &amp;&amp; odoo-bin -d testdb</pre>			<p>The bonus of using this command line is that you can request add-ons to be installed while you are using it – for instance, <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">i sale,purchase,stock</strong></span><span class="No-Break">.</span></p>
			<p>To duplicate a database, stop the server and run the <span class="No-Break">following commands:</span></p>
			<pre class="console">
$ createdb -T dbname newdbname
$ cd ~/.local/share/Odoo/filestore # adapt if you have changed the data_dir
$ cp -r dbname newdbname
$ cd -</pre>			<p>Note that, in the <a id="_idIndexMarker067"/>context of development, the file store is <span class="No-Break">often omitted.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The use of <strong class="source-inline">createdb -T</strong> only works if there are no active sessions on the database, which means that you have to shut down your Odoo server before duplicating the database from the <span class="No-Break">command line.</span></p>
			<p>To remove an instance, run the <span class="No-Break">following command:</span></p>
			<pre class="console">
$ dropdb dbname
$ rm -rf ~/.local/share/Odoo/filestore/dbname</pre>			<p>To create a backup (assuming that the PostgreSQL server is running locally), use the <span class="No-Break">following command:</span></p>
			<pre class="console">
$ pg_dump -Fc -f dbname.dump dbname
$ tar cjf dbname.tgz dbname.dump ~/.local/share/Odoo/filestore/dbname</pre>			<p>To restore the backup, run the <span class="No-Break">following command:</span></p>
			<pre class="console">
$ tar xf dbname.tgz
$ pg_restore -C -d dbname dbname.dump</pre>			<p class="callout-heading">Caution!</p>
			<p class="callout">If your Odoo instance uses a different user to connect to the database, you need to pass <strong class="source-inline">-U username</strong> so that the correct user is the owner of the <span class="No-Break">restored database.</span></p>
			<h1 id="_idParaDest-42"><a id="_idTextAnchor041"/>Storing the instance configuration in a file</h1>
			<p>The <strong class="source-inline">odoo-bin</strong> script has dozens of options, and it is tedious to remember them all, as well as how <a id="_idIndexMarker068"/>to remember to set them properly when starting the server. Fortunately, it is possible to store them all in a configuration file and only specify the ones you want to alter for development, <span class="No-Break">for example.</span></p>
			<h2 id="_idParaDest-43"><a id="_idTextAnchor042"/>How to do it...</h2>
			<p>For this recipe, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>To generate a configuration file for your Odoo instance, run the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin --save --config myodoo.cfg --stop-after-init</strong></pre></li>				<li>You can add additional options, and their values will be saved in the generated file. All the unset options will be saved with their default value set. To get a list of possible options, use the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin --help | less</strong></pre><p class="list-inset">This will provide you with some help about what the various <span class="No-Break">options perform.</span></p></li>				<li>To convert from the command-line form into the configuration form, use the long option name, remove the leading dashes, and convert the dashes in the middle into underscores. So, in this case, <strong class="source-inline">--without-demo</strong> will become <strong class="source-inline">without_demo</strong>. This works for most options, but there are a few exceptions, all of which are listed in the <span class="No-Break">following section.</span></li>
				<li>Edit the <strong class="source-inline">myodoo.cfg</strong> file (use the table in the following section for some parameters you may want to change). Then, to start the server with the saved options, run the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">$ ./odoo-bin -c myodoo.cfg</strong></pre></li>			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="source-inline">--config</strong> option is commonly abbreviated <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">-c</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-44"><a id="_idTextAnchor043"/>How it works...</h2>
			<p>At startup, Odoo loads its configuration in three passes. First, a set of default values for all options is initialized from the source code. After, the configuration is parsed, and then any value that’s defined in the file overrides the defaults. Finally, the command-line options are analyzed, and their values override the configuration that was obtained from the <span class="No-Break">previous pass.</span></p>
			<p>As we mentioned earlier, the names of the configuration variables can be found by looking at the <a id="_idIndexMarker069"/>names of the command-line options by removing the leading dashes and converting the middle dashes into underscores. There are a few exceptions to this, notably <span class="No-Break">the following:</span></p>
			<div>
				<div id="_idContainer016" class="IMG---Figure">
					<img src="image/Table_01.jpg" alt="Table 1.1 – Difference in Odoo parameters regarding the command line and the configuration file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 1.1 – Difference in Odoo parameters regarding the command line and the configuration file</p>
			<p>Here’s a list of options that are commonly set through the <span class="No-Break">configuration file:</span></p>
			<div>
				<div id="_idContainer017" class="IMG---Figure">
					<img src="image/Table_02.jpg" alt="Table 1.2 – Odoo parameters and their usage"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 1.2 – Odoo parameters and their usage</p>
			<p>Here’s a list <a id="_idIndexMarker070"/>of configuration options related to <span class="No-Break">the database:</span></p>
			<div>
				<div id="_idContainer018" class="IMG---Figure">
					<img src="image/Table_03.jpg" alt="Table 1.3 – Odoo parameters and their usage"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 1.3 – Odoo parameters and their usage</p>
			<p>The configuration file is parsed by Odoo using the Python <strong class="source-inline">ConfigParser</strong> module. However, the implementation in Odoo 11.0 has changed, and it is no longer possible to use variable interpolation. So, if you are used to defining values for variables from the values of other variables using the <strong class="source-inline">%(section.variable)s</strong> notation, you will need to change <a id="_idIndexMarker071"/>your habits and revert to <span class="No-Break">explicit values.</span></p>
			<p>Some options are not used in config files, but they are widely used <span class="No-Break">during development:</span></p>
			<div>
				<div id="_idContainer019" class="IMG---Figure">
					<img src="image/Table_04.jpg" alt="Table 1.4 – Odoo parameters and their usage"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 1.4 – Odoo parameters and their usage</p>
			<h1 id="_idParaDest-45"><a id="_idTextAnchor044"/>Activating Odoo developer tools</h1>
			<p>When using Odoo <a id="_idIndexMarker072"/>as a developer, you need to know how to activate <strong class="bold">developer mode</strong> in the <a id="_idIndexMarker073"/>web interface so that you can access the technical settings menu and developer information. Enabling debug mode will expose several advanced configuration options and fields. These options and fields are hidden in Odoo for better usability because they are not <span class="No-Break">used daily.</span></p>
			<h2 id="_idParaDest-46"><a id="_idTextAnchor045"/>How to do it...</h2>
			<p>To activate developer mode in the web interface, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Connect to your instance and authenticate <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">admin</strong></span><span class="No-Break">.</span></li>
				<li>Go to the <span class="No-Break"><strong class="bold">Settings</strong></span><span class="No-Break"> menu.</span></li>
				<li>Scroll to the bottom and locate the <strong class="bold">Developer </strong><span class="No-Break"><strong class="bold">Tools</strong></span><span class="No-Break"> section:</span></li>
			</ol>
			<div>
				<div id="_idContainer020" class="IMG---Figure">
					<img src="image/B20997_01_12.jpg" alt="Figure 1.12 – Links to activate different developer modes"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.12 – Links to activate different developer modes</p>
			<ol>
				<li value="4">Click    <strong class="bold">Activate the </strong><span class="No-Break"><strong class="bold">developer mode</strong></span><span class="No-Break">.</span></li>
				<li>Wait <a id="_idIndexMarker074"/>for the UI <span class="No-Break">to reload.</span></li>
			</ol>
			<p class="callout-heading">Alternative way</p>
			<p class="callout">It is also possible to activate developer mode by editing the URL. Before the <strong class="source-inline">#</strong> sign, insert <strong class="source-inline">?debug=1</strong>. For example, if your current URL is <strong class="source-inline">http://localhost:8069/web#menu_id=102&amp;action=94</strong> and you want to enable developer mode, then you need to change that URL to <strong class="source-inline">http://localhost:8069/web?debug=1#menu_id=102&amp;action=94</strong>. Furthermore, if you want to use debug mode with assets, then change the URL <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">http://localhost:8069/web?debug=assets#menu_id=102&amp;action=94</strong></span><span class="No-Break">.</span></p>
			<p>To exit developer mode, you can perform any one of the <span class="No-Break">following operations:</span></p>
			<ul>
				<li>Edit the URL and write <strong class="source-inline">?debug=0</strong> in the <span class="No-Break">query string</span></li>
				<li>Use <strong class="bold">Deactivate the developer mode</strong> from the same place in the <span class="No-Break"><strong class="bold">Settings</strong></span><span class="No-Break"> menu</span></li>
				<li>Click on the bug icon in the top menu and click on the <strong class="bold">Leave Developer </strong><span class="No-Break"><strong class="bold">Tools</strong></span><span class="No-Break"> option</span></li>
			</ul>
			<p>Lots of developers are using browser extensions to toggle debug mode. By doing this, you can toggle debug mode quickly without accessing the <strong class="bold">Settings</strong> menu. These extensions <a id="_idIndexMarker075"/>are available for Firefox and Chrome. The following screenshot shows one such plugin you can use and find in the <span class="No-Break">Chrome store:</span></p>
			<div>
				<div id="_idContainer021" class="IMG---Figure">
					<img src="image/B20997_01_13.jpg" alt="Figure 1.13 – Browser extension for debug mode"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.13 – Browser extension for debug mode</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The behavior of the debug mode has changed since Odoo v13. Since v13, the status of debug mode is stored in the session, implying that even if you have removed <strong class="source-inline">?debug</strong> from the URL, debug mode will still <span class="No-Break">be active.</span></p>
			<h2 id="_idParaDest-47"><a id="_idTextAnchor046"/>How it works...</h2>
			<p>In developer mode, two <span class="No-Break">things happen:</span></p>
			<ul>
				<li>You get tooltips when hovering over a field in a form view or over a column in a list view. These provide technical information about the field (internal name, type, and <span class="No-Break">so on).</span></li>
				<li>A drop-down menu with a bug icon is displayed next to the user’s menu in the top-right corner, giving you access to technical information about the model being displayed, the various related view definitions, the workflow, custom filter management, and <span class="No-Break">so on.</span></li>
			</ul>
			<p>There is a variant of developer mode called <strong class="bold">Developer mode (with assets)</strong>. This mode behaves like the normal developer mode, but the JavaScript and CSS code that’s sent to the <a id="_idIndexMarker076"/>browser is not minified, which means that the web development tools of your browser can easily be used to debug the JavaScript code (more on this in <a href="B20997_15.xhtml#_idTextAnchor861"><span class="No-Break"><em class="italic">Chapter 15</em></span></a>, <em class="italic">Web </em><span class="No-Break"><em class="italic">Client Development</em></span><span class="No-Break">).</span></p>
			<p class="callout-heading">Caution!</p>
			<p class="callout">Test your add-ons both with and without developer mode since the unminified versions of the JavaScript libraries can hide bugs that only bite you in the <span class="No-Break">minified version.</span></p>
			<h1 id="_idParaDest-48"><a id="_idTextAnchor047"/>Updating the add-on modules list</h1>
			<p>When a new <a id="_idIndexMarker077"/>add-on module is added, you need to run the <strong class="bold">Update Module List</strong> wizard to get your new application in the app list. In this recipe, you will learn how to update the <span class="No-Break">app list.</span></p>
			<h2 id="_idParaDest-49"><a id="_idTextAnchor048"/>Getting ready</h2>
			<p>Start your instance and connect to it using your <strong class="bold">Administrator</strong> account. After doing this, activate developer mode (if you don’t know how to activate developer mode, refer to the <em class="italic">Activating Odoo developer </em><span class="No-Break"><em class="italic">tools</em></span><span class="No-Break"> recipe).</span></p>
			<h2 id="_idParaDest-50"><a id="_idTextAnchor049"/>How to do it…</h2>
			<p>To update the list of available add-on modules in your instance, you need to perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Open the <span class="No-Break"><strong class="bold">Apps</strong></span><span class="No-Break"> menu.</span></li>
				<li>Click <strong class="bold">Update </strong><span class="No-Break"><strong class="bold">Apps List</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer022" class="IMG---Figure">
					<img src="image/B20997_01_14.jpg" alt="Figure 1.14 – Update Apps List"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.14 – Update Apps List</p>
			<ol>
				<li value="3">In the <a id="_idIndexMarker078"/>dialog that appears, <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Update</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer023" class="IMG---Figure">
					<img src="image/B20997_01_15.jpg" alt="Figure 1.15 – Dialog to update the apps list"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.15 – Dialog to update the apps list</p>
			<ol>
				<li value="4">At the end of the update, you can click on the <strong class="bold">Apps</strong> entry to see the updated list of available add-on modules. You will need to remove the default filter on <strong class="bold">Apps</strong> in the search box to see all <span class="No-Break">of them.</span></li>
			</ol>
			<h2 id="_idParaDest-51"><a id="_idTextAnchor050"/>How it works…</h2>
			<p>When the <strong class="bold">Update</strong> button is clicked, Odoo will read the add-on path configuration variable. For each directory in the list, it will look for immediate subdirectories containing an add-on manifest file, which is a file named <strong class="source-inline">__manifest__.py</strong> that’s stored in the add-on module directory. Odoo reads the manifest, expecting to find a Python dictionary. Unless the manifest contains a key <strong class="source-inline">installable</strong> instance set to <strong class="source-inline">False</strong>, the add-on <a id="_idIndexMarker079"/>module metadata is recorded in the database. If the module is already present, the information is updated. If not, a new record is created. If a previously available add-on module is not found, the record is not deleted from <span class="No-Break">the list.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">An updated apps list is only required if you add the new add-on path after initializing the database. If you add the new add-on path to the configuration file before initializing the database, then there will be no need to update the module <span class="No-Break">list manually.</span></p>
			<p>To summarize what we have learned so far, after installing, you can start the Odoo server by using the following command line (if you are using a virtual environment, then you need to activate <span class="No-Break">it first):</span></p>
			<pre class="console">
python3 odoo-bin -d odoo-test -i base --addons-path=addons --db-filter=odoo-test</pre>			<p>Once you’ve run the module, you can access Odoo <span class="No-Break">from </span><span class="No-Break">http://localhost:8069</span><span class="No-Break">.</span></p>
			<p>You can also use a configuration file to run Odoo, <span class="No-Break">as follows:</span></p>
			<pre class="console">
./odoo-bin -c myodoo.cfg</pre>			<p>Once you start the Odoo server, you can install/update modules from the <span class="No-Break"><strong class="bold">App</strong></span><span class="No-Break"> menu.</span></p>
		</div>
	</body></html>