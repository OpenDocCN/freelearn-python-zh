- en: <st c="0">9</st>
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: <st c="0">9</st>
- en: <st c="2">Letting Users Create, Read, Update, and Delete Movie Reviews</st>
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: <st c="2">让用户创建、阅读、更新和删除电影评论</st>
- en: <st c="62">Having implemented the authentication system, it is now time to let
    logged-in users perform the standard CRUD operations on reviews for movies.</st>
    <st c="207">This chapter will teach you how to perform complete CRUD operations
    and how to</st> <st c="286">manage authorizations.</st>
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="62">实现了认证系统后，现在是时候让登录用户对电影的评论执行标准的 CRUD 操作了。</st> <st c="207">本章将教您如何执行完整的
    CRUD 操作以及如何</st> <st c="286">管理授权。</st>
- en: <st c="308">In this chapter, we will cover the</st> <st c="344">following topics:</st>
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="308">在本章中，我们将涵盖以下主题：</st>
- en: <st c="361">Creating a</st> <st c="373">review model</st>
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="361">创建评论模型</st>
- en: <st c="385">Creating reviews</st>
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="385">创建评论</st>
- en: <st c="402">Reading reviews</st>
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="402">阅读评论</st>
- en: <st c="418">Updating</st> <st c="428">a review</st>
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="418">更新</st> <st c="428">评论</st>
- en: <st c="436">Deleting</st> <st c="446">a review</st>
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="436">删除</st> <st c="446">评论</st>
- en: <st c="454">By the end of the chapter, you will have learned how to create CRUD
    operations for your models and handle authorizations.</st> <st c="577">You will
    also recap how to use forms and how to manage different</st> <st c="642">HTTP
    methods.</st>
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="454">到本章结束时，您将学会如何为您的模型创建 CRUD 操作并处理授权。</st> <st c="577">您还将回顾如何使用表单以及如何管理不同的</st>
    <st c="642">HTTP 方法。</st>
- en: <st c="655">Technical requirements</st>
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: <st c="655">技术要求</st>
- en: <st c="678">In this chapter, we will be using Python 3.10 or above.</st> <st
    c="735">Additionally, we will be using the</st> **<st c="770">VS Code</st>** <st
    c="777">editor in this book, which you can download</st> <st c="822">from</st>
    [<st c="827">https://code.visualstudio.com/</st>](https://code.visualstudio.com/)<st
    c="857">.</st>
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="678">在本章中，我们将使用 Python 3.10 或更高版本。</st> <st c="735">此外，本书中将使用</st> **<st
    c="770">VS Code</st>** <st c="777">编辑器，您可以从</st> <st c="822">以下位置下载</st> [<st
    c="827">https://code.visualstudio.com/</st>](https://code.visualstudio.com/)<st
    c="857">。</st>
- en: <st c="858">The code for this chapter is located</st> <st c="896">at</st> [<st
    c="899">https://github.com/PacktPublishing/Django-5-for-the-Impatient-Second-Edition/tree/main/Chapter09/moviesstore</st>](https://github.com/PacktPublishing/Django-5-for-the-Impatient-Second-Edition/tree/main/Chapter09/moviesstore)<st
    c="1007">.</st>
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="858">本章的代码位于</st> <st c="896">以下位置</st> [<st c="899">https://github.com/PacktPublishing/Django-5-for-the-Impatient-Second-Edition/tree/main/Chapter09/moviesstore</st>](https://github.com/PacktPublishing/Django-5-for-the-Impatient-Second-Edition/tree/main/Chapter09/moviesstore)<st
    c="1007">。</st>
- en: <st c="1008">The CiA video for this chapter can be found</st> <st c="1053">at</st>
    [<st c="1056">https://packt.link/dsqdR</st>](https://packt.link/dsqdR)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="1008">本章的 CiA 视频可以在</st> <st c="1053">以下位置找到</st> [<st c="1056">https://packt.link/dsqdR</st>](https://packt.link/dsqdR)
- en: <st c="1080">Creating a review model</st>
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: <st c="1080">创建评论模型</st>
- en: <st c="1104">To store the movies’ review</st> <st c="1133">information, we need
    to create a review Django model and follow the</st> <st c="1201">next steps:</st>
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="1104">为了存储电影的评论</st> <st c="1133">信息，我们需要创建一个评论 Django 模型并遵循</st> <st
    c="1201">以下步骤：</st>
- en: <st c="1212">Create the</st> <st c="1224">review model.</st>
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: <st c="1212">创建</st> <st c="1224">评论模型。</st>
- en: <st c="1237">Apply migrations.</st>
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: <st c="1237">应用迁移。</st>
- en: <st c="1255">Add the review model to the</st> <st c="1284">admin panel.</st>
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: <st c="1255">将评论模型添加到</st> <st c="1284">管理面板。</st>
- en: <st c="1296">Create the review model</st>
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: <st c="1296">创建评论模型</st>
- en: <st c="1320">The review information is closely connected to movies.</st> <st
    c="1376">Therefore, we will include this model in the</st> `<st c="1421">movies</st>`
    <st c="1427">app.</st> <st c="1433">In the</st> `<st c="1440">/movies/models.py</st>`
    <st c="1457">file, add the following parts that are highlighted</st> <st c="1509">in
    bold:</st>
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="1320">评论信息与电影紧密相关。</st> <st c="1376">因此，我们将此模型包含在</st> `<st c="1421">movies</st>`
    <st c="1427">应用中。</st> <st c="1433">在</st> `<st c="1440">/movies/models.py</st>`
    <st c="1457">文件中，添加以下加粗的部分：</st> <st c="1509">：</st>
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**<st c="1958">Let’s explain the</st> <st c="1977">preceding code:</st>'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="1958">让我们解释一下</st> <st c="1977">前面的代码：</st>'
- en: <st c="1992">We import the</st> `<st c="2007">User</st>` <st c="2011">model
    from Django’s</st> `<st c="2032">django.contrib.auth.models</st>` <st c="2058">module.</st>
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="1992">我们从 Django 的</st> `<st c="2007">User</st>` <st c="2011">模型中导入</st>
    `<st c="2032">django.contrib.auth.models</st>` <st c="2058">模块。</st>
- en: <st c="2066">We define a Python class named</st> `<st c="2098">Review</st>`<st
    c="2104">, which inherits from</st> `<st c="2126">models.Model</st>`<st c="2138">.
    This means that</st> `<st c="2156">Review</st>` <st c="2162">is a Django</st>
    <st c="2175">model class.</st>
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="2066">我们定义了一个名为</st> `<st c="2098">Review</st>`<st c="2104">的Python类，它继承自</st>
    `<st c="2126">models.Model</st>`<st c="2138">。这意味着</st> `<st c="2156">Review</st>`
    <st c="2162">是一个Django</st> <st c="2175">模型类。</st>
- en: <st c="2187">Inside the</st> `<st c="2199">Review</st>` <st c="2205">class,
    we define</st> <st c="2223">several fields:</st>
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="2187">在</st> `<st c="2199">Review</st>` <st c="2205">类中，我们定义了</st> <st
    c="2223">几个字段：</st>
- en: '`<st c="2238">id</st>` <st c="2241">is an</st> `<st c="2248">AutoField</st>`<st
    c="2257">, which automatically increments its value for each new record added
    to the database.</st> <st c="2343">The</st> `<st c="2347">primary_key=True</st>`
    <st c="2363">parameter specifies that this field is</st> <st c="2402">the primary
    key for the table, uniquely identifying</st> <st c="2455">each record.</st>'
  id: totrans-26
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<st c="2238">id</st>` <st c="2241">是一个</st> `<st c="2248">AutoField</st>`<st
    c="2257">，它自动为数据库中添加的每个新记录增加其值。</st> <st c="2343">`<st c="2347">primary_key=True</st>`
    <st c="2363">参数指定该字段是表的</st> <st c="2402">主键，唯一标识</st> <st c="2455">每条记录。</st>'
- en: '`<st c="2467">comment</st>` <st c="2475">is a</st> `<st c="2481">CharField</st>`<st
    c="2490">, which represents a string field with a maximum length of 255 characters.</st>
    <st c="2565">It stores the movie</st> <st c="2585">review text.</st>'
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<st c="2467">评论</st>` <st c="2475">是一个</st> `<st c="2481">CharField</st>`<st
    c="2490">，它代表一个最大长度为255个字符的字符串字段。</st> <st c="2565">它存储电影评论文本。</st>'
- en: '`<st c="2597">date</st>` <st c="2602">is a</st> `<st c="2608">DateTimeField</st>`
    <st c="2621">, which is used for date and time data.</st> <st c="2661">The</st>
    `<st c="2665">auto_now_add=True</st>` <st c="2682">ensures that the date and time
    are automatically set to the current date and time when the review</st> <st c="2781">is
    created.</st>'
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<st c="2597">日期</st>` <st c="2602">是一个</st> `<st c="2608">DateTimeField</st>`
    <st c="2621">，用于日期和时间数据。</st> <st c="2661">`<st c="2665">auto_now_add=True</st>`
    <st c="2682">确保在创建评论时，日期和时间会自动设置为当前日期和时间。</st>'
- en: '`<st c="2792">movie</st>` <st c="2798">is a foreign key relationship to the</st>
    `<st c="2836">Movie</st>` <st c="2841">model.</st> <st c="2849">A review is associated
    with a movie.</st> <st c="2886">The</st> `<st c="2890">on_delete</st>` <st c="2899">parameter
    specifies how to handle the deletion of a movie that a review is associated with.</st>
    <st c="2992">In this case,</st> `<st c="3006">on_delete=models.CASCADE</st>` <st
    c="3030">means that if the related movie is deleted, the associated review will
    also</st> <st c="3107">be deleted.</st>'
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<st c="2792">电影</st>` <st c="2798">是与</st> `<st c="2836">Movie</st>` <st c="2841">模型的外键关系。</st>
    <st c="2849">评论与电影相关联。</st> <st c="2886">`<st c="2890">on_delete</st>` <st c="2899">参数指定如何处理与评论相关联的电影的删除。</st>
    <st c="2992">在这种情况下，</st> `<st c="3006">on_delete=models.CASCADE</st>` <st c="3030">意味着如果相关电影被删除，相关的评论也将被删除。</st>'
- en: '`<st c="3118">user</st>` <st c="3123">is another foreign key relationship but
    to the</st> `<st c="3171">User</st>` <st c="3175">model.</st> <st c="3183">A review
    is associated with a user (the person who wrote the review).</st> <st c="3253">Similar
    to the</st> `<st c="3268">movie</st>` <st c="3273">attribute,</st> `<st c="3285">on_delete=models.CASCADE</st>`
    <st c="3309">specifies that if the related user is deleted, the associated review
    will also</st> <st c="3389">be deleted.</st>'
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<st c="3118">用户</st>` <st c="3123">是另一个外键关系，但指向</st> `<st c="3171">User</st>`
    <st c="3175">模型。</st> <st c="3183">评论与用户（撰写评论的人）相关联。</st> <st c="3253">类似于</st>
    `<st c="3268">电影</st>` <st c="3273">属性，</st> `<st c="3285">on_delete=models.CASCADE</st>`
    <st c="3309">指定如果相关用户被删除，相关的评论也将被删除。</st>'
- en: '`<st c="3400">__str__</st>` <st c="3408">is a method that returns a string
    representation of the review.</st> <st c="3473">In this case, it returns a string
    that is composed of the review ID and the name of the movie associated with</st>
    <st c="3583">the</st> <st c="3586">review.</st>'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<st c="3400">__str__</st>` <st c="3408">是一个返回评论字符串表示的方法。</st> <st c="3473">在这种情况下，它返回一个由评论ID和与评论相关的电影名称组成的字符串。</st>
    <st c="3583">的</st> <st c="3586">评论。</st>'
- en: <st c="3594">Apply migrations</st>
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: <st c="3594">应用迁移</st>
- en: <st c="3611">Now that we have created the</st> `<st c="3641">Review</st>` <st
    c="3647">model, let’s apply those changes to our database by running the following</st>
    <st c="3722">commands according to your</st> <st c="3749">operating system:</st>
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="3611">现在我们已经创建了</st> `<st c="3641">Review</st>` <st c="3647">模型，让我们通过运行以下</st>
    <st c="3722">命令将更改应用到我们的数据库中，具体命令根据您的</st> <st c="3749">操作系统</st> <st c="3752">而定：</st>
- en: <st c="3766">For macOS,</st> <st c="3778">run this:</st>
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="3766">For macOS,</st> <st c="3778">run this:</st>
- en: '[PRE1]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: <st c="3846">For Windows,</st> <st c="3860">run this:</st>
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: <st c="3846">For Windows,</st> <st c="3860">run this:</st>
- en: '[PRE2]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: <st c="3926">Now, you should see something like in</st> *<st c="3965">Figure
    9</st>**<st c="3973">.1</st>*<st c="3975">:</st>
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="3926">Now, you should see something like in</st> *<st c="3965">Figure
    9</st>**<st c="3973">.1</st>*<st c="3975">:</st>
- en: '![Figure 9.1 – Applying the review migration](img/B22457_09_1.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![Figure 9.1 – Applying the review migration](img/B22457_09_1.jpg)'
- en: <st c="4052">Figure 9.1 – Applying the review migration</st>
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="4052">Figure 9.1 – Applying the review migration</st>
- en: <st c="4094">Add the review model to the admin panel</st>
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: <st c="4094">Add the review model to the admin panel</st>
- en: <st c="4134">To add the</st> `<st c="4146">Review</st>` <st c="4152">model to</st>
    `<st c="4162">admin</st>`<st c="4167">, go back to</st> `<st c="4180">/movies/admin.py</st>`
    <st c="4196">and register it by adding the</st> <st c="4227">following parts that
    are highlighted</st> <st c="4264">in bold:</st>
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="4134">To add the</st> `<st c="4146">Review</st>` <st c="4152">model to</st>
    `<st c="4162">admin</st>`<st c="4167">, go back to</st> `<st c="4180">/movies/admin.py</st>`
    <st c="4196">and register it by adding the</st> <st c="4227">following parts that
    are highlighted</st> <st c="4264">in bold:</st>
- en: '[PRE3]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: …
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: <p><b>Price:</b> ${{ template_data.movie.price }}</p> <st c="5459">{% if user.is_authenticated
    %}</st>
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <p><b>Price:</b> ${{ template_data.movie.price }}</p> <st c="5459">{% if user.is_authenticated
    %}</st>
- en: <st c="5489"><div class="container mt-4"></st>
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="5489"><div class="container mt-4"></st>
- en: <st c="5518"><div class="row justify-content-center"></st>
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="5518"><div class="row justify-content-center"></st>
- en: <st c="5559"><div class="col-12"></st>
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="5559"><div class="col-12"></st>
- en: <st c="5580"><div class="card shadow p-3 mb-4 rounded"></st>
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="5580"><div class="card shadow p-3 mb-4 rounded"></st>
- en: <st c="5623"><div class="card-body"></st>
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="5623"><div class="card-body"></st>
- en: <st c="5647"><b class="text-start">Create a review</st>
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="5647"><b class="text-start">Create a review</st>
- en: '**<st c="5685"></b><br /><br /></st>**'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5685"></b><br /><br /></st>**'
- en: '**<st c="5702"><form method="POST" action=</st>**'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5702"><form method="POST" action=</st>**'
- en: '**<st c="5730">"{% url ''movies.create_review''</st>**'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5730">"{% url ''movies.create_review''</st>**'
- en: '**<st c="5761">id=template_data.movie.id %}"></st>**'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5761">id=template_data.movie.id %}"></st>**'
- en: '**<st c="5792">{% csrf_token %}</st>**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5792">{% csrf_token %}</st>**'
- en: '**<st c="5809"><p></st>**'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5809"><p></st>**'
- en: '**<st c="5813"><label for="comment">Comment:</label></st>**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5813"><label for="comment">Comment:</label></st>**'
- en: '**<st c="5851"><textarea name="comment" required</st>**'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5851"><textarea name="comment" required</st>**'
- en: '**<st c="5885">class="form-control"</st>**'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5885">class="form-control"</st>**'
- en: '**<st c="5906">id="comment"></textarea></st>**'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5906">id="comment"></textarea></st>**'
- en: '****<st c="5931"></p></st>**'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '****<st c="5931"></p></st>**'
- en: '**<st c="5936"><div class="text-center"></st>**'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5936"><div class="text-center"></st>**'
- en: '**<st c="5962"><button type="submit"</st>**'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5962"><button type="submit"</st>**'
- en: '**<st c="5984">class="btn bg-dark text-white"></st>**'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="5984">class="btn bg-dark text-white"></st>**'
- en: '**<st c="6016">Add Review</st>**'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6016">Add Review</st>**'
- en: '**<st c="6027"></button></st>**'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6027"></button></st>**'
- en: '**<st c="6037"></div></st>**'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6037"></div></st>**'
- en: '**<st c="6044"></form></st>**'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6044"></form></st>**'
- en: '**<st c="6052"></div></st>**'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6052"></div></st>**'
- en: '**<st c="6059"></div></st>**'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6059"></div></st>**'
- en: '**<st c="6066"></div></st>**'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6066"></div></st>**'
- en: '**<st c="6073"></div></st>**'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6073"></div></st>**'
- en: '**<st c="6080"></div></st>**'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6080"></div></st>**'
- en: '**<st c="6087">{% endif %}</st>** <st c="6099"></div>'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="6087">{% endif %}</st>** <st c="6099"></div>'
- en: <div class="col-md-6 mx-auto mb-3 text-center">
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: <div class="col-md-6 mx-auto mb-3 text-center">
- en: <img src="img/{{ template_data.movie.image.url }}"
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <img src="img/{{ template_data.movie.image.url }}"
- en: class="rounded img-card-400" />
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: class="rounded img-card-400" />
- en: </div>
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: </div>
- en: …
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: …
- en: '{% endblock content %}</st>**'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '{% endblock content %}</st>**'
- en: '[PRE4]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: from django.shortcuts import render<st c="7048">, redirect</st> from .models
    import Movie<st c="7084">, Review</st>
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: from django.shortcuts import render<st c="7048">, redirect</st> from .models
    import Movie<st c="7084">, Review</st>
- en: '<st c="7092">from django.contrib.auth.decorators import login_required</st>
    def index(request):'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '<st c="7092">from django.contrib.auth.decorators import login_required</st>
    def index(request):'
- en: …
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: …
- en: 'def show(request):'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 'def show(request):'
- en: … <st c="7194">@login_required</st>
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: … <st c="7194">@login_required</st>
- en: <st c="7209">def create_review(request, id):</st>
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="7209">def create_review(request, id):</st>
- en: <st c="7241">if request.method == 'POST' and request.POST['comment']</st>
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="7241">if request.method == 'POST' and request.POST['comment']</st>
- en: '**<st c="7297">!= '''':</st>**'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7297">!= '''':</st>**'
- en: '**<st c="7303">movie = Movie.objects.get(id=id)</st>**'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7303">movie = Movie.objects.get(id=id)</st>**'
- en: '**<st c="7336">review = Review()</st>**'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7336">review = Review()</st>**'
- en: '**<st c="7354">review.comment = request.POST[''comment'']</st>**'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7354">review.comment = request.POST[''comment'']</st>**'
- en: '**<st c="7395">review.movie = movie</st>**'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7395">review.movie = movie</st>**'
- en: '**<st c="7416">review.user = request.user</st>**'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7416">review.user = request.user</st>**'
- en: '**<st c="7443">review.save()</st>**'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7443">review.save()</st>**'
- en: '**<st c="7457">return redirect(''movies.show'', id=id)</st>**'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7457">return redirect(''movies.show'', id=id)</st>**'
- en: '**<st c="7495">else:</st>**'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7495">else:</st>**'
- en: '**<st c="7501">return redirect(''movies.show'', id=id)</st>**'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="7501">return redirect(''movies.show'', id=id)</st>**'
- en: '[PRE5]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: from django.urls import path
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: from django.urls import path
- en: from . import views
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: from . import views
- en: urlpatterns = [
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: urlpatterns = [
- en: path('', views.index, name='movies.index'),
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: path('', views.index, name='movies.index'),
- en: path('<int:id>/', views.show, name='movies.show'), <st c="9179">path('<int:id>/review/create/',
    views.create_review,</st>
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: path('<int:id>/', views.show, name='movies.show'), <st c="9179">path('<int:id>/review/create/',
    views.create_review,</st>
- en: <st c="9231">name='movies.create_review'),</st> ]
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="9231">name='movies.create_review'),</st> ]
- en: '[PRE6]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: …
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: <p><b>Price:</b> ${{ template_data.movie.price }}
  id: totrans-109
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <p><b>价格：</b> ${{ template_data.movie.price }}
- en: </p> <st c="10987"><h2>Reviews</h2></st>
  id: totrans-110
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </p> <st c="10987"><h2>评论</h2></st>
- en: <st c="11003"><hr /></st>
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11003"><hr /></st>
- en: <st c="11010"><ul class="list-group"></st>
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11010"><ul class="list-group"></st>
- en: <st c="11034">{% for review in template_data.reviews %}</st>
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11034">{% for review in template_data.reviews %}</st>
- en: <st c="11076"><li class="list-group-item pb-3 pt-3"></st>
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11076"><li class="list-group-item pb-3 pt-3"></st>
- en: <st c="11115"><h5 class="card-title"></st>
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11115"><h5 class="card-title"></st>
- en: <st c="11139">Review by {{ review.user.username }}</st>
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11139">评论者：{{ review.user.username }}</st>
- en: <st c="11176"></h5></st>
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11176"></h5></st>
- en: <st c="11182"><h6 class="card-subtitle mb-2 text-muted"></st>
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11182"><h6 class="card-subtitle mb-2 text-muted"></st>
- en: <st c="11225">{{ review.date }}</st>
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11225">{{ review.date }}</st>
- en: <st c="11243"></h6></st>
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11243"></h6></st>
- en: <st c="11249"><p class="card-text">{{ review.comment }}</p></st>
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11249"><p class="card-text">{{ review.comment }}</p></st>
- en: <st c="11295"></li></st>
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11295"></li></st>
- en: <st c="11301">{% endfor %}</st>
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11301">{% endfor %}</st>
- en: <st c="11314"></ul></st> {% if user.is_authenticated %}
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="11314"></ul></st> {% if user.is_authenticated %}
- en: …
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: …
- en: '[PRE7]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: …
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: 'def show(request, id):'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 'def show(request, id):'
- en: movie =  Movie.objects.get(id=id) <st c="11695">reviews = Review.objects.filter(movie=movie)</st>
    template_data = {}
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: movie =  Movie.objects.get(id=id) <st c="11695">reviews = Review.objects.filter(movie=movie)</st>
    template_data = {}
- en: template_data['title'] = movie.name
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: template_data['title'] = movie.name
- en: template_data['movie'] = movie <st c="11826">template_data['reviews'] = reviews</st>
    return render(request, 'movies/show.html',
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: template_data['movie'] = movie <st c="11826">template_data['reviews'] = reviews</st>
    return render(request, 'movies/show.html',
- en: '{''template_data'': template_data})'
  id: totrans-132
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{''template_data'': template_data})'
- en: …
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: '[PRE8]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: …
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: '{% for review in template_data.reviews %}'
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{% for review in template_data.reviews %}'
- en: <li class="list-group-item pb-3 pt-3">
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <li class="list-group-item pb-3 pt-3">
- en: <h5 class="card-title">
  id: totrans-138
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <h5 class="card-title">
- en: Review by {{ review.user.username }}
  id: totrans-139
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 评论者：{{ review.user.username }}
- en: </h5>
  id: totrans-140
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </h5>
- en: <h6 class="card-subtitle mb-2 text-muted">
  id: totrans-141
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <h6 class="card-subtitle mb-2 text-muted">
- en: '{{ review.date }}'
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{{ review.date }}'
- en: </h6>
  id: totrans-143
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </h6>
- en: <p class="card-text">{{ review.comment }}</p> <st c="13360">{% if user.is_authenticated
    and user ==</st>
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <p class="card-text">{{ review.comment }}</p> <st c="13360">{% if user.is_authenticated
    and user ==</st>
- en: <st c="13399">review.user %}</st>
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13399">review.user %}</st>
- en: <st c="13414"><a class="btn btn-primary"</st>
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13414"><a class="btn btn-primary"</st>
- en: <st c="13441">href="{% url 'movies.edit_review'</st>
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13441">href="{% url 'movies.edit_review'</st>
- en: <st c="13475">id=template_data.movie.id</st>
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13475">id=template_data.movie.id</st>
- en: <st c="13501">review_id=review.id %}">Edit</st>
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13501">review_id=review.id %}">编辑</st>
- en: <st c="13530"></a></st>
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13530"></a></st>
- en: <st c="13535">{% endif %}</st> </li>
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="13535">{% endif %}</st> </li>
- en: '{% endfor %}'
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{% endfor %}'
- en: …
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: …
- en: '[PRE9]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '{% extends ''base.html'' %}'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '{% extends ''base.html'' %}'
- en: '{% block content %}'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '{% block content %}'
- en: <div class="p-3">
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: <div class="p-3">
- en: <div class="container">
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: <div class="container">
- en: <div class="row mt-3">
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: <div class="row mt-3">
- en: <div class="col mx-auto mb-3">
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: <div class="col mx-auto mb-3">
- en: <h2>Edit Review</h2>
  id: totrans-161
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <h2>编辑审查</h2>
- en: <hr />
  id: totrans-162
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <hr />
- en: <form method="POST">
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <form method="POST">
- en: '{% csrf_token %}'
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{% csrf_token %}'
- en: <p>
  id: totrans-165
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <p>
- en: <label for="comment">Comment:</label>
  id: totrans-166
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <label for="comment">评论：</label>
- en: <textarea name="comment" required
  id: totrans-167
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <textarea name="comment" required
- en: class="form-control" id="comment">{{
  id: totrans-168
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: class="form-control" id="comment">{{
- en: template_data.review.comment }}</textarea>
  id: totrans-169
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: template_data.review.comment }}</textarea>
- en: </p>
  id: totrans-170
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </p>
- en: <div class="text-start">
  id: totrans-171
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <div class="text-start">
- en: <button type="submit"
  id: totrans-172
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <button type="submit"
- en: class="btn bg-dark text-white">Edit Review
  id: totrans-173
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: class="btn bg-dark text-white">编辑评论
- en: </button>
  id: totrans-174
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </button>
- en: </div>
  id: totrans-175
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </div>
- en: </form>
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </form>
- en: </div>
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: </div>
- en: </div>
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: </div>
- en: </div>
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: </div>
- en: </div>
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: </div>
- en: '{% endblock content %}'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '{% endblock content %}'
- en: '[PRE10]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: from django.shortcuts import render, redirect<st c="14998">, get_object_or_404</st>
    … <st c="15019">@login_required</st>
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: from django.shortcuts import render, redirect<st c="14998">, get_object_or_404</st>
    … <st c="15019">@login_required</st>
- en: <st c="15034">def edit_review(request, id, review_id):</st>
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15034">def edit_review(request, id, review_id):</st>
- en: <st c="15075">review = get_object_or_404(Review, id=review_id)</st>
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15075">review = get_object_or_404(Review, id=review_id)</st>
- en: <st c="15124">if request.user != review.user:</st>
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15124">if request.user != review.user:</st>
- en: <st c="15156">return redirect('movies.show', id=id)</st>
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15156">return redirect('movies.show', id=id)</st>
- en: <st c="15194">if request.method == 'GET':</st>
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15194">如果请求方法为'GET':</st>
- en: <st c="15222">template_data = {}</st>
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15222">template_data = {}</st>
- en: <st c="15241">template_data['title'] = 'Edit Review'</st>
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15241">template_data['title'] = '编辑评论'</st>
- en: <st c="15280">template_data['review'] = review</st>
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="15280">template_data['review'] = review</st>
- en: <st c="15313">return render(request, 'movies/edit_review.html',</st>
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: '<st c="15313">返回渲染请求，模板为''movies/edit_review.html''，参数为{''template_data'':
    template_data})</st>'
- en: '**<st c="15363">{''template_data'': template_data})</st>**'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15363">{''template_data'': template_data})</st>**'
- en: '**<st c="15397">elif request.method == ''POST'' and</st>**'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15397">如果请求方法为''POST''并且</st>**'
- en: '**<st c="15431">request.POST[''comment''] != '''':</st>**'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15431">请求的POST数据中的''comment''字段不为空</st>**'
- en: '**<st c="15462">review = Review.objects.get(id=review_id)</st>**'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15462">获取Review对象，id为review_id)</st>**'
- en: '**<st c="15504">review.comment = request.POST[''comment'']</st>**'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15504">评论的评论内容设置为请求的POST数据中的''comment''字段</st>**'
- en: '**<st c="15545">review.save()</st>**'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15545">保存评论)</st>**'
- en: '**<st c="15559">return redirect(''movies.show'', id=id)</st>**'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15559">返回重定向到''movies.show''，参数id为id)</st>**'
- en: '**<st c="15597">else:</st>**'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15597">否则:</st>**'
- en: '**<st c="15603">return redirect(''movies.show'', id=id)</st>**'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="15603">返回重定向到''movies.show''，参数id为id)</st>**'
- en: '[PRE11]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: from django.urls import path
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 从 django.urls 导入 path
- en: from . import views
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 从 . 导入 views
- en: urlpatterns = [
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: urlpatterns = [
- en: path('', views.index, name='movies.index'),
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 路径('', views.index, name='movies.index'),
- en: path('<int:id>/', views.show, name='movies.show'),
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 路径('<int:id>/', views.show, name='movies.show'),
- en: path('<int:id>/review/create/', views.create_review,
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 路径('<int:id>/review/create/', views.create_review,
- en: name='movies.create_review'), <st c="17432">path('<int:id>/review/<int:review_id>/edit/',</st><st
    c="17477">views.edit_review, name='movies.edit_review'),</st> ]
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: name='movies.create_review'), <st c="17432">路径('<int:id>/review/<int:review_id>/edit/',</st><st
    c="17477">views.edit_review, name='movies.edit_review'),</st> ]
- en: '[PRE12]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: …
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: <h5 class="card-title">
  id: totrans-212
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <h5 class="card-title">
- en: Review by {{ review.user.username }}
  id: totrans-213
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 评论者：{{ review.user.username }}
- en: </h5>
  id: totrans-214
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </h5>
- en: <h6 class="card-subtitle mb-2 text-muted">
  id: totrans-215
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <h6 class="card-subtitle mb-2 text-muted">
- en: '{{ review.date }}'
  id: totrans-216
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{{ review.date }}'
- en: </h6>
  id: totrans-217
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </h6>
- en: <p class="card-text">{{ review.comment }}</p>
  id: totrans-218
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <p class="card-text">{{ review.comment }}</p>
- en: '{% if user.is_authenticated and user =='
  id: totrans-219
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{% if user.is_authenticated and user =='
- en: review.user %}
  id: totrans-220
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: review.user %}
- en: <a class="btn btn-primary"
  id: totrans-221
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: <a class="btn btn-primary"
- en: href="{% url 'movies.edit_review'
  id: totrans-222
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: href="{% url 'movies.edit_review' %}
- en: id=template_data.movie.id
  id: totrans-223
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: id=template_data.movie.id
- en: review_id=review.id %}">Edit
  id: totrans-224
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: review_id=review.id %}">编辑
- en: </a> <st c="19184"><a class="btn btn-danger"</st>
  id: totrans-225
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: </a> <st c="19184"><a class="btn btn-danger"</st>
- en: <st c="19209">href="{% url 'movies.delete_review'</st>
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="19209">href="{% url 'movies.delete_review' %}</st>
- en: <st c="19245">id=template_data.movie.id</st>
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="19245">id=template_data.movie.id</st>
- en: <st c="19271">review_id=review.id %}">Delete</st>
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="19271">review_id=review.id %}">删除</st>
- en: <st c="19302"></a></st> {% endif %}
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="19302"></a></st> {% endif %}
- en: …
  id: totrans-230
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: …
- en: '[PRE13]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: … <st c="19591">@login_required</st>
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: … <st c="19591">@login_required</st>
- en: <st c="19606">def delete_review(request, id, review_id):</st>
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="19606">def delete_review(request, id, review_id):</st>
- en: '**<st c="19649">review = get_object_or_404(Review, id=review_id,</st>**'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="19649">获取Review对象，id为review_id，如果不存在则返回404</st>**'
- en: '**<st c="19698">user=request.user)</st>**'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="19698">user=request.user)</st>**'
- en: '**<st c="19717">review.delete()</st>**'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="19717">删除评论)</st>'
- en: '**<st c="19733">return redirect(''movies.show'', id=id)</st>**'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: '**<st c="19733">返回重定向到''movies.show''，参数id为id)</st>**'
- en: '[PRE14]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: …
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: …
- en: urlpatterns = [
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: urlpatterns = [
- en: …
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: …
- en: path('<int:id>/review/<int:review_id>/edit/',
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 路径('<int:id>/review/<int:review_id>/edit/',
- en: views.edit_review, name='movies.edit_review'), <st c="20581">path('<int:id>/review/<int:review_id>/delete/',</st>
  id: totrans-243
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: views.edit_review, name='movies.edit_review'), <st c="20581">路径('<int:id>/review/<int:review_id>/delete/',</st>
- en: <st c="20628">views.delete_review, name='movies.delete_review'),</st> ]
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: <st c="20628">删除评论视图，名称为'movies.delete_review'),</st> ]
- en: '[PRE15]**'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE15]**'
