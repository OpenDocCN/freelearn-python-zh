<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-45"><a id="_idTextAnchor044"/>3</h1>
<h1 id="_idParaDest-46"><a id="_idTextAnchor045"/>FX Market Overview from a Developer's Standpoint</h1>
<p>The FX market has long been very attractive for developers, mostly because there’s a lot of free stuff associated with this market, such as market data, trading software, and various third-party solutions. However, the quality of freely available solutions is frequently so low that it’s in fact not possible to use them for any serious trading.</p>
<p>The main problem with trading in the FX markets is their strong fragmentation. Historically, FX was an interbank market with no dedicated center. So, trading venues offer not only different trading platforms but also different market data, different types of orders, and different access to liquidity. This fragmentation may be quite confusing, so it’s essential to obtain a sufficient level of understanding in order to avoid making mistakes, which at times can be quite painful.</p>
<p>In this chapter, we will look at this market from a developer’s standpoint to discover some important – and overlooked – features that may be critical for the overall success of any project in FX algo trading. We will start with the organization of this market and see the obstacles it creates for the developer. We will learn about the essential types of market participants, why the price moves at all, and whether a particular movement is something we can make money with. We will also consider various ways to access this market, their pros and cons for various practical trading applications, and estimate how expensive it may be.</p>
<p>All this knowledge is absolutely essential for sustained success in FX algo trading. This market is one of the most rapidly changing markets. Without understanding how these changes may affect the performance of your trading strategies, it will be difficult to survive this market from a long-term perspective. In this chapter, we will cover the following topics:</p>
<ul>
<li>Trading venues – where money meets… other money</li>
<li>Trade mechanics – again, some terminology</li>
<li>Market makers – comfortable, sophisticated, expensive</li>
<li>Liquidity providers – the whales that support this planet</li>
<li>ECN – looks like a fair game, but is it?</li>
<li>Aggregation – in search of the best price</li>
<li>Trading the FX market – what and how</li>
<li>Why do I need all this?</li>
</ul>
<h1 id="_idParaDest-47"><a id="_idTextAnchor046"/>Trading venues – where money meets… other money</h1>
<p>First, let me note that despite the overall colloquial language used in this book, I am always trying to stick to the traditional academic approach that follows the same paradigm: definition | logical conclusions | theory | experiment | proof. Without proper definitions, especially <a id="_idIndexMarker101"/>when we talk about the foundation of the subject domain, we won’t be able to make logical conclusions, suggest a theory, or test and finally prove a theory – which in our case, means making money. In even simpler words, without a full understanding of the subject, we are unable to suggest appropriate methods to use it.</p>
<p>So, as we mentioned in <a href="B19145_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, financial markets facilitate buying and selling assets at special <a id="_idIndexMarker102"/>marketplaces called <strong class="bold">trading venues</strong>. A bit too vague to be useful, right? Well, let’s go into specifics.</p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor047"/>Organizing chaos – types of trading venues</h2>
<p>A trading venue in the financial world is a place where buyers meet sellers – both physically and <a id="_idIndexMarker103"/>electronically. There are different kinds of trading venues, each having its advantages and disadvantages and requiring a special approach to trade.</p>
<p>A formal classification of today’s trading venues is based on a number of criteria including the regulatory environment, types of market participants, methods of dissemination of market information among them, and many, many more. Therefore, such a classification is very complex and definitely lies way beyond the scope of this book.</p>
<p>The good news is that not all of these criteria are important for us as developers of buy-side trading applications. We will try to suggest a few informal criteria looking at this subject domain with the eyes of a developer.</p>
<p>From the structural standpoint, the key difference between trading venues is the way the market price is determined. To better understand it, let’s again consider our example of a farmer’s market.</p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor048"/>Auction (open outcry)</h2>
<p>Buyers and farmers <a id="_idIndexMarker104"/>stand in a crowd, crying out loudly about quantities they would like to buy or sell along with their prices. As soon as two parties find each other, a contract is made.</p>
<p>This is exactly how trading had been performed for many centuries and even thousands of years. In the <a id="_idIndexMarker105"/>financial world, such a marketplace is called an <strong class="bold">exchange</strong>, and the market square where buyers and sellers squawk their prices is called a <strong class="bold">pit</strong>. Although this <a id="_idIndexMarker106"/>method looks fair, it has one global intrinsic limitation: the marketplace cannot physically accommodate all those willing to trade. So, traders soon became elite with unlimited access to liquidity and began acting on behalf of others for a commission. Of course, such a privileged position asked for misbehavior and many traders could not resist the temptation to trade against their clients, thus doubling their profits – which in turn caused changes in regulations and severe punishments. Although very interesting, this is another story.</p>
<p>Pit trading in its natural form has almost died out completely in the last 15 years. Electronic trading made <a id="_idIndexMarker107"/>access to markets far more democratic and available to virtually <a id="_idIndexMarker108"/>anyone (with important limitations and restrictions – as always), so pit traders are no longer needed.</p>
<p>Nevertheless, the <em class="italic">structure</em> of such a market, where <em class="italic">price discovery</em> is performed by direct communication between multiple parties in an <em class="italic">auction</em>, is still very popular. Modern trading venues operate electronically but use the same paradigm.</p>
<p>We can see <a id="_idIndexMarker109"/>that there are two ways a buy-side order can be placed in such a market. We can just cry out, <em class="italic">“I buy!”</em> or <em class="italic">“I sell!”</em> and such an order will be executed <a id="_idIndexMarker110"/>at whatever price comes first. Such an order is called a <strong class="bold">market order</strong> (see <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a><em class="italic">, Types of Orders and Their Simulation in Python</em>) and if a market order is sent to the market, we say that we buy or sell <strong class="bold">at market</strong>.</p>
<p>Alternatively, we can cry, <em class="italic">“I buy at $100 or cheaper!”</em> or <em class="italic">“I sell at $200 or higher!”</em> and then such an order will be executed only when there’s a seller or a buyer for such an order respectively. Such an order is called a <strong class="bold">limit order</strong> (again, see <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a><em class="italic">, Types of Orders and Their Simulation in Python</em>, for details), and sending such an order to the market is called buying or selling <strong class="bold">at a </strong><strong class="bold">certain price</strong>.</p>
<p class="callout-heading">Note</p>
<p class="callout">Although a limit order helps limit the price (to avoid buying too high or selling too low), it is not guaranteed that such an order will be executed at all: there may be no buyers who would like to buy from you or no sellers to sell to you at your desired price.</p>
<p>As with any auction, the price of the traded asset can jump or fall very quickly. Thus, for us as algo trading <a id="_idIndexMarker111"/>developers, it’s important to remember that in such a market it would be a good idea to follow some useful guidelines:</p>
<ul>
<li>Never buy at market without checking the supply first. Such an action would mean <em class="italic">“I am ready to buy this at whatever price will be”</em> and you will be filled at the worst possible price.</li>
<li>Never sell at market at all. Always specify the price you’re ready to sell at. It is essential to send your sell orders in advance, posting the price you’re ready to sell.</li>
</ul>
<h2 id="_idParaDest-50"><a id="_idTextAnchor049"/>Exchange and order book</h2>
<p>Buyers and farmers arrive at the market, but do not enter it. Instead, they are welcomed by an officer who <a id="_idIndexMarker112"/>records their bids (orders to buy) and offers (orders to sell) in a book. If a new buyer comes in with a bid at $10 but there is already another order at $10 in the officer’s book, then this newcomer’s order is placed in the queue and will be filled only after the previous order has been executed.</p>
<p>Similarly, farmers do not show off their goods on shelves; instead, the same officer records their offers (the prices at which they would like to sell goods). Similar to buyers, if a new farmer comes in with an offer to sell at $11 and there is already another farmer willing to sell at $11, then the newcomer’s order is recorded in the book after the already existing order and will be executed only after the preceding order has been filled.</p>
<p>As long as buyers come in with prices lower than offered and farmers do not want to sell at a lower price, no contract is made and no trade happens.</p>
<p>So, in such a market, the only way for a trade to happen is as follows:</p>
<ul>
<li> A buyer agrees to buy at a higher price</li>
<li>A farmer agrees to sell at a lower price</li>
</ul>
<p>Although it looks a bit awkward from a common sense standpoint, such an organization of the market has a clear <a id="_idIndexMarker113"/>advantage: all buyers and sellers are served on a <strong class="bold">first in – first out</strong> (<strong class="bold">FIFO</strong>) basis and have equal opportunities.</p>
<p>The marketplace which works this way is also called an exchange and the officer who registers bids and <a id="_idIndexMarker114"/>asks is today replaced by computers and is normally called <strong class="bold">matching engine</strong>. The book into which bids and offers are recorded is called the <strong class="bold">order book</strong>. The information <a id="_idIndexMarker115"/>about orders in the book is called <strong class="bold">depth of market</strong> or <strong class="bold">DOM</strong>.</p>
<p class="callout-heading">Note</p>
<p class="callout">Open outcry and order book trading can co-exist at the same exchange and for the same market. For example, stock trading sessions start with an opening auction and then continue with trading through the order book.</p>
<p>The difference <a id="_idIndexMarker116"/>between the highest bid and the lowest offer price is called the <strong class="bold">spread</strong>. When someone <a id="_idIndexMarker117"/>concludes a deal, it is called <strong class="bold">crossing </strong><strong class="bold">the spread</strong>.</p>
<p>From a programmer’s <a id="_idIndexMarker118"/>standpoint, we have a two-dimensional structure where the price is along the vertical axis and orders are along the horizontal one. As new orders come in, they are sent to the <a id="_idIndexMarker119"/>respective FIFO queue on each price level and are called <strong class="bold">limit orders</strong>. <em class="italic">Figure 3</em><em class="italic">.1</em> presents a schematic view of such a structure, where each block in a horizontal lane means the number of contracts sent to the order book as the limit order size:</p>
<div><div><img alt="Figure 3.1 – The two-dimensional nature of the order book" src="img/B19145_3_1.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – The two-dimensional nature of the order book</p>
<p class="callout-heading">Important note</p>
<p class="callout">If you send an order and there are 10 more orders already in the book, your order is going to be filled only after all 10 preceding orders have been filled.</p>
<p>This is why <em class="italic">a lot</em> of trading strategies that use limit orders work well only <em class="italic">on paper</em>, that is, they rely on <a id="_idIndexMarker120"/>guaranteed execution of all generated orders, while in reality only 40-50% of these orders are indeed executed. We will look into this and other problems in detail in <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a><em class="italic">, Types of Orders and Their Simulation in Python</em>. <em class="italic">Figure 3</em><em class="italic">.2</em> shows a typical DOM for one of the exchange-traded assets:</p>
<div><div><img alt="Figure 3.2 – DOM screen shows consolidated liquidity on each price level (level 2 data) – source: MultiCharts" src="img/B19145_3_2.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – DOM screen shows consolidated liquidity on each price level (level 2 data) – source: MultiCharts</p>
<p>This window shows the consolidated liquidity instead of individual orders: the sizes of all orders for a particular price level are summed and the sum is displayed to the left or to the right of the price axis.</p>
<p class="callout-heading">Important note</p>
<p class="callout">Level 2 data normally does not contain information about individual orders, so you never know whether 1,000 contracts means a single order from a solid large-volume trader or 1,000 orders by 1 contract sent by retail traders.</p>
<p>Exchanges are <a id="_idIndexMarker121"/>de-facto industry standard trading venues for equities (stocks, exchange-traded funds, and so on), commodities, and some derivatives. In the FX world, mostly derivatives, such as <a id="_idIndexMarker122"/>currency futures, are traded at exchanges. Most of the cash, swaps, and forward contracts are traded <strong class="bold">over the </strong><strong class="bold">counter</strong> (<strong class="bold">OTC</strong>).</p>
<h2 id="_idParaDest-51"><a id="_idTextAnchor050"/>OTC markets</h2>
<p>Farmers arrive at the market but do not reveal their goods at all. Buyers walk between them and ask <a id="_idIndexMarker123"/>for the price. The farmer looks at the buyer and decides what price to offer based on the buyer’s appearance.</p>
<p>This scenario may sound truly ridiculous, but it gives a very good first impression of how an OTC market works.</p>
<p>As we saw previously, in the case of an exchange-traded market, all market participants at any moment know the <em class="italic">three </em><em class="italic">key prices</em>:</p>
<ul>
<li>Best bid</li>
<li>Best ask</li>
<li>Last trade</li>
</ul>
<p>These prices are identical for everyone and the difference between professional and non-professional market participants is mostly in the latency of the data feed and some data compression (see <a href="B19145_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a><em class="italic">, Developing Trading Strategies - Why They Are Different</em>, for the <a id="_idIndexMarker124"/>discussion on market data and related issues). So, in exchange-traded markets, these three prices are commonly called <strong class="bold">market price</strong>.</p>
<p>The term <em class="italic">OTC</em> means in the financial world that the contract can be made at virtually any price as long as this price satisfies the buyer and the seller – regardless of whatever price at which the previous contract was made.</p>
<p>In essence, this renders the very concept of market price meaningless to a considerable extent because not all of these prices are reported and made publicly available. Therefore, in OTC markets there is <a id="_idIndexMarker125"/>no such thing as a public quotation (as is the case with exchange-traded markets) but instead, they use <em class="italic">indicative price</em>, which is an <em class="italic">approximate</em> representation of the last traded price or a number of last traded prices.</p>
<p>At this point, I think it will be natural for you to ask, <em class="italic">“wow, but who uses these markets and why?”</em> The answer is very simple and can be found in the structure of the exchange-traded market.</p>
<p>As you hopefully remember from the previous section, any exchange-traded market is based on the order book. The number of orders in the order book forms liquidity in this market.</p>
<p>Now, imagine a situation when a really large market participant (such as a hedge fund, a mutual fund, an investment bank, and so on) comes in with a desire to buy a really large amount of an asset and the amount <em class="italic">exceeds the existing liquidity</em>. Such an action would swipe the entire order book by moving the last trade price very far from the previous readings in a moment and even worse – leaving one side of the order book totally empty. Of course, this is a scenario that all market participants and the exchange itself would like to avoid.</p>
<p>So, here comes the OTC market. If you are a bank dealer, you can find the best price for your large order over your own network of contacts and do it privately, without too much fanfare about it.</p>
<p>Another important feature of OTC markets is that they are far less regulated than regular, exchange-traded markets. There were attempts to add regulation to these markets, the most remarkable probably being MiFID and MiFID II, but still, OTC markets are far more <em class="italic">relaxed</em>. If you are interested in learning more about market regulations and how they impact pricing, liquidity, and overall trading, I would recommend starting with <a href="https://tokenist.com/investing/guide-to-forex-regulations-in-the-us/">https://tokenist.com/investing/guide-to-forex-regulations-in-the-us/</a> where the basics are explained. I would also recommend reading this interview with Phil Lloyd, head of trading and sales delivery at NatWest (<a href="https://www.natwest.com/corporates/insights/regulation/regulation-and-market-structure-what-to-look-out-for-in-2021.html">https://www.natwest.com/corporates/insights/regulation/regulation-and-market-structure-what-to-look-out-for-in-2021.html</a>), who provides very interesting insights on global challenges, changes in regulations, and their relationships with the market.</p>
<p>Understanding the structure of OTC markets leads us to a number of very important conclusions.</p>
<p>First, OTC markets are ideal <a id="_idIndexMarker126"/>for large-volume trades. If you are a small retail trader then trading at an OTC market would probably be problematic because of the arbitrary pricing – and you can be sure that small traders always get the worst possible execution for their orders.</p>
<p>Second, you cannot really know at which price your order will be executed if you send a market order (an order to buy <em class="italic">right now</em>, regardless of the price). You won’t ever be able to argue about the price at which your trade was made.</p>
<p class="callout-heading">Note</p>
<p class="callout">As the immediate corollary from the aforementioned, you should always check the actual price at which your order was executed in your code and subtract a certain amount from the theoretical returns of your model while doing tests. This will make the theoretical results at least a tiny bit closer to reality.</p>
<p>The third, and probably the most counterintuitive conclusion is the fact that in an OTC market <em class="italic">there can be multiple different prices for the same financial instrument</em>. It is normal that each liquidity provider, market maker, bank, fund, and any other market participant in such a market offers their own price for the same product and that these prices co-exist at the very same moment in time.</p>
<p>This market fragmentation can be exploited by <strong class="bold">arbitrage strategies</strong>: strategies that look for <a id="_idIndexMarker127"/>situations where the same instrument is quoted differently at different trading venues. They make <a id="_idIndexMarker128"/>money by simultaneously buying and selling the same instrument at different trading venues in cases where the price difference is sufficient.</p>
<p class="callout-heading">Note</p>
<p class="callout">Arbitrage strategies can be developed and tested using Python but they cannot actually be run using it because arbitrage opportunities typically last for milliseconds. Production code for arbitrage strategies is normally written in C or C++, or by using Numba or Cython (see <a href="B19145_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a>, <em class="italic">Using Python for </em><em class="italic">Trading Strategies</em>).</p>
<p>Fourth, you can never, ever offer your own price in this market – unlike an exchange-traded market, where any order, even one contract received from a retail trader, goes into the <em class="italic">same order book</em>, which is identical for everyone. You can only accept the price offered by <a id="_idIndexMarker129"/>other market participants who have permission to <a id="_idIndexMarker130"/>post prices into this market. These market participants are called <strong class="bold">liquidity providers</strong> or <strong class="bold">market makers</strong> (although it’s important to note <a id="_idIndexMarker131"/>that these are not synonyms) and they are commonly known as <strong class="bold">price givers</strong>, while retail traders (or any other trader who only accepts offered prices) are <a id="_idIndexMarker132"/>known as <strong class="bold">price takers</strong>.</p>
<p>Finally, the worst news for us, the FX traders, is that about 90% of the FX market is traded OTC. So, we have to live with it and find the right solutions to survive in this quite unfriendly environment.</p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor051"/>Liquidity and order limitations</h2>
<p>A trading venue <a id="_idIndexMarker133"/>in the financial world is not only a place where buyers meet sellers but they also trade under the supervision of the venue’s management. Thus, a traditional farmers’ market is not a financial trading venue in this regard, whereas a stock exchange definitely is. The key difference is that trading at a trading venue is always supervised or moderated. For example, if someone comes into a grocery market and offers to buy whatever produce the sellers have at the moment, most likely, the farmers will sell the produce and the market will close till next Sunday. If anything similar happens in the financial world, it would be a real disaster. So, the trading venue always moderates incoming orders, and if the requested trading size is too big, the order will be rejected (or, to be more precise, considered a <strong class="bold">block order</strong> and treated in a special way – see <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a><em class="italic">, Types of Orders and Their Simulation </em><em class="italic">in Python</em>).</p>
<p>Another possible issue with order execution is <em class="italic">partial fill</em>. This happens when the liquidity in the order book is not sufficient to fill the entire order, so only part of the order is filled. Normally, you can explicitly specify the order type which decides whether the order is to be rejected or partially filled if the liquidity is not sufficient. In either case, you have to add an order execution control module to your trading application that handles, rejects, and partially fills orders.</p>
<p>Getting your order filled at a non-desired price is probably the last thing you may want to happen, and still, it is quite possible if you use market orders (remember, a market order means <em class="italic">“I want to buy/sell now, regardless of the price”</em>). Now, you understand the reasons <a id="_idIndexMarker134"/>why an order may be filled at an <em class="italic">unexpected</em> price – those same liquidity issues. So, in production, it is reasonable to consider using limit orders instead of market orders even if the strategy assumes buying and selling at market.</p>
<p>Ordering will be discussed in detail in <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a><em class="italic">, Types of Orders and Their Simulation </em><em class="italic">in Python</em>.</p>
<p>Now that we’ve got more or less familiar with the most general types of trading venues, it’s time we familiarized ourselves with their market participants. This will give us a better understanding of how trades are made and which risks to expect and avoid in the market.</p>
<p>But before we proceed to market participants, let’s learn some new terms.</p>
<h1 id="_idParaDest-53"><a id="_idTextAnchor052"/>Trade mechanics – again, some terminology</h1>
<p>A trade is made when two <a id="_idIndexMarker135"/>parties meet and agree to buy or sell from each other. These parties are called <strong class="bold">counterparties</strong>.</p>
<p>If I buy 1 million euros for the equivalent in US dollars and the exchange rate is 1.1, then I paid 1.1 million US dollars to have <em class="italic">a position</em> of 1 million EURUSD. I am going to have this position until I sell back this amount of euros for the equivalent amount of US dollars and, therefore, <em class="italic">liquidate</em> my position and become <em class="italic">market neutral</em> again until I open a new position.</p>
<p>If I improve the asking price by sending an offer that is lower than the previous best offer, then I <em class="italic">provide liquidity</em> to the market.</p>
<p>If I simultaneously improve ask <em class="italic">and</em> bid, and other traders become counterparties for both, then I <em class="italic">make the market</em>. Making the market means earning the spread (the difference between bid and offer) while remaining market neutral. The market participant <a id="_idIndexMarker136"/>whose main business is making the market is called a <strong class="bold">market maker</strong>.</p>
<p>As opposed to making the market or being a <em class="italic">price giver</em>, traders who take the other side of the trade are <em class="italic">price takers</em>. Price takers can only buy or sell at the prices offered by price givers, and unlike price givers, price takers <em class="italic">always pay </em><em class="italic">the spread</em>.</p>
<p class="callout-heading">Important</p>
<p class="callout">If a price taker opens any position using a market order, the very moment the position is opened, its running profit is already in the negative zone.</p>
<p>This happens because, in most markets, offer prices are always greater than bid prices, and price takers can only buy at the offer price and sell at the bid price. Therefore, if you bought an asset, this means you paid the offer price. If you want to immediately liquidate your position, you can do that only at the bid price. If the market price hasn’t changed since the moment you entered the market, you will lose the difference between the bid and ask prices – which is the spread. That’s why we say that price takers always pay the spread to price givers, who in turn, earn the spread.</p>
<p>If I buy an asset then I have a <em class="italic">long</em> position. This term came from stock trading and means that you bought something and now hold it (normally, investors hold shares for a long time). If I sell an asset, and this sale was not liquidation of a previously opened long position, then I have a <em class="italic">short</em> position. Again, this term has the same origin and means that you sold something without previously having it.</p>
<p>You may wonder how it’s possible to sell something that you don’t own. Well, in financial markets it’s really easy. If we talk about equities trading then most brokers have an <em class="italic">inventory</em> of equities and traders can borrow from this inventory to sell. If the price of the asset sold this way goes down further, then the trader liquidates the position, returns the asset to the broker, and pockets some profit. If the price of the asset goes up then… well, the trader liquidates the position anyway, returns the asset to the broker, and pays the difference – which means pocketing a loss this time.</p>
<p>If I have a position, then my profit (or loss) is calculated as the difference between the price at which the position is liquidated and the price at which I bought it. If I opened a long position and the liquidation price is greater than the opening price then I made a profit; if it is lower then I suffer a loss. Symmetrically, for short positions: if the liquidation price is lower than the opening price then I made a profit, and vice versa.</p>
<p>As long as I have an open position, my <em class="italic">potential</em> profit or loss can be recalculated at any moment, even if the <a id="_idIndexMarker137"/>position is not liquidated yet. This potential profit or loss is called <strong class="bold">running profit or loss</strong> (<strong class="bold">running PnL</strong> or <strong class="bold">P/L</strong>).</p>
<p>To be able to send orders to the market, I either have to be a member of an exchange with direct access to the order book (which is quite expensive) or use the services of a third party that takes my <a id="_idIndexMarker138"/>orders and brings them to the market. Such a third party is called a <strong class="bold">broker</strong>.</p>
<p class="callout-heading">Important note</p>
<p class="callout">There is a lot of confusion between brokers and market makers in FX trading. Read the following sections carefully as we are going to clarify this confusion once and for all.</p>
<p>If I have $100 and the rate of the euro versus the US dollar is 1.1, then I can buy approximately €91. But if the broker provides me with a <strong class="bold">credit line</strong>, then I can buy from €3,000 to €9,000, or <a id="_idIndexMarker139"/>even more with just my $100. This credit line is called a <strong class="bold">margin</strong> and the ratio of how much I could buy without a margin to how much I can buy with a margin is called the <strong class="bold">leverage</strong>. Normally, the leverage in the FX market is up to 30:1 for <a id="_idIndexMarker140"/>non-professionals and 100:1 for professional traders.</p>
<p>If I opened a position on a margin and the market price moved against me to the extent that I have nothing in my trading account, then I would have entered a situation called a <strong class="bold">margin call</strong>. Historically, this <a id="_idIndexMarker141"/>meant that the broker would call the client asking to add funds to the account to maintain the position. Such a practice is difficult to find today, at least among retail brokers. Today, brokers prefer to just force close the positions that drive the client’s account into the negative zone because otherwise, it may cause problems not only for the client but also for the broker.</p>
<p>If I open a position on margin then the size of my position is called the <strong class="bold">notional amount</strong>. This means <a id="_idIndexMarker142"/>that I don’t actually possess €9,000 if I opened a long position in EURUSD with the $100 in my account and a leverage of 100:1. I have a notional position of €9,000, which I would have to liquidate before any <em class="italic">real</em> money condenses in (or thaws from) the trading account.</p>
<p>If I buy an asset directly, then it is an <strong class="bold">outright </strong>asset. If I buy a financial instrument that gives me the right <a id="_idIndexMarker143"/>or obliges me to buy or sell the asset in the future, then it is a <strong class="bold">derivative</strong> asset. In fact, derivatives can be much more sophisticated than this but <a id="_idIndexMarker144"/>they are mostly available to only professional market participants. A discussion on derivatives is way beyond the scope of this book.</p>
<p>If I buy an <em class="italic">obligation to buy or sell the asset in the future at a certain price on a certain date,</em> then I am buying a <strong class="bold">future contract</strong>, or simply a <strong class="bold">future</strong>. The date is called an <strong class="bold">expiration date</strong> or simply an <strong class="bold">expiration</strong>. For example, the current price of the asset is $10 but I may buy <a id="_idIndexMarker145"/>a future that guarantees that its seller will sell me the same asset at $9 in a month, a quarter, or any other time span. Then, this month, quarter, or other time span is the expiration term of this future contract. In the case that the price of the asset itself is greater than $9 by its expiration, then I make money: the seller of the future is obliged to sell me the asset at $9 and I can immediately resell it at a higher price. If the price of the asset by the expiration is lower than $9, then I lost money as I now have the obligation to buy the asset at $9 anyway and I can do whatever I want with it (most likely sell and take a loss).</p>
<p>If I buy <a id="_idIndexMarker146"/>the <em class="italic">right to buy or sell the asset in the future at a certain price</em>, then I am buying an <strong class="bold">option</strong>. Options trading is quite a complex subject and is not considered in this book.</p>
<p>That is enough on terminology. Now that we know all we need to learn about the key market participants, we need to know what they do and how we can actually participate in this market as well.</p>
<h1 id="_idParaDest-54"><a id="_idTextAnchor053"/>Market makers – comfortable, sophisticated, expensive</h1>
<p>The term <em class="italic">market makers</em> actually <a id="_idIndexMarker147"/>has two different meanings, although they lie quite close to each other.</p>
<p>In cases where both buyers and sellers need to meet each other at a single <em class="italic">marketplace</em> – which is an exchange in most cases, as we saw earlier – such a market is called a <strong class="bold">two-sided market</strong>. In two-sided markets, market makers provide liquidity to the market and this activity will be <a id="_idIndexMarker148"/>considered in the <em class="italic">Liquidity providers – the whales that support this </em><em class="italic">planet</em> section.</p>
<p>In OTC markets, the situation is different. In these markets, only dedicated market participants can publish their bids or offers, and in some cases, they are not published at all. So, finding a counterparty for your trade could potentially be even more complex than in a two-sided market, and given that the quoting is not public, you can get your orders executed at really surprising prices (and of course, it’s not going to be a pleasant surprise).</p>
<p>So, at this point, enter <a id="_idIndexMarker149"/>the market makers. In OTC markets, market makers act both as liquidity providers and counterparties for their own clients.</p>
<p>What does this mean?</p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor054"/>Counterparties that provide liquidity</h2>
<p>If you come to an exchange, then your orders are visible to all other market participants and anyone can take the other side of the order. Say, you want to buy just one contract of a currency future – then you can actually buy it from a retail trader and from a large bank (but, most likely, you will never know who was the seller). But if you trade with a market maker, then it is this very market maker – and no one else – who will be the counterparty for all your orders. Only this market maker will always buy from you and sell to you.</p>
<p>It means that a market maker is a professional market participant who <em class="italic">quotes the market for their clients</em>. These quotes are different for different clients and mostly depend on the trading volume of the client and their order size.</p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor055"/>How do market makers make money?</h2>
<p>Market makers are rewarded by earning the <em class="italic">spread</em> (the difference between the bid and the ask), and in this regard, their business is very similar to that of a liquidity provider. Market makers always sell at a price that is greater than the price at which they are ready to <a id="_idIndexMarker150"/>buy. So in cases where there are multiple clients with this market marker that generate a constant <strong class="bold">order flow</strong> (stream of orders to buy and sell at virtually the same time), then our market maker buys and sells simultaneously, pocketing the difference between bids and asks.</p>
<p>As you can see, the source of profits for market makers is quite different from that of their clients. Market makers as <em class="italic">price givers</em> (see the <em class="italic">OTC markets</em> section) remain <em class="italic">market neutral, </em>while their clients open and close <em class="italic">positions </em>in the market due to situations when the clients have bought something but haven’t sold it yet.</p>
<p>However, the market maker from which I bought and then sold my position to has remained market neutral while I had a position because they have multiple clients and, most likely, at the very same moment when I was buying 1 million EURUSD from the market maker, another client was selling 1 million EURUSD to them. So, the market maker earned the spread and I and another unknown trader went away with two positions: I had a long position and the unknown trader had a short position.</p>
<p>It looks like a free lunch (for market makers, of course) and an unfair advantage (again, for market makers), but in reality, this is just another risky business – as everything in the world of trading is. Imagine a situation where someone bought from a market maker, but no one sold. Now, imagine that this happens once and then happens very quickly again. Such a scenario can easily develop when most traders think the price is going to move in a certain direction and they begin buying or selling massively. For the market maker, it <a id="_idIndexMarker151"/>means that they no longer earn the spread. Even worse, in such a situation, the market maker holds an open position in the market – instead of being market neutral – and becomes a trader with their PnL now depending on the price movement! Moreover, this position immediately creates a floating loss for the market maker (floating means that the position is not liquidated yet, so the loss may decrease or further increase with each new tick). Of course, market makers don’t like having positions and, therefore, they protect themselves.</p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor056"/>Market risk and how market makers mitigate it</h2>
<p>There are two essential <a id="_idIndexMarker152"/>options for a market maker to mitigate their market risks.</p>
<p>First, market makers can hedge their net position elsewhere. To better understand it, let’s consider an example.</p>
<p>On average, during the so-called normal market hours, the amount of open long and short positions is more or less the same. As we already know, there’s not much publicly available data from OTC markets in general and the FX market in particular, but even from public sources, we can see that this statement is very close to reality. For example, FXSSI has nice tools which visualize traders’ sentiment, the ratios of open long and short positions, and <a id="_idIndexMarker153"/>snapshots of the depth of the market. You can find these tools at <a href="https://fxssi.com/tools/">https://fxssi.com/tools/</a> and can check them out yourself. Pay particular attention to the open position ratios (<a href="https://fxssi.com/tools/ratios">https://fxssi.com/tools/ratios</a>). These charts report positions from a number of trading venues and it is clearly seen that the larger the client base of a trading venue, the more linear the chart of the ratio of the open positions. This essentially means that the ratio doesn’t change significantly over time and that newly opened long positions are in balance with newly opened short ones.</p>
<p>If we sum up all long positions and subtract from this the amount of all short positions currently <a id="_idIndexMarker154"/>opened with this market maker, then we get the so-called <strong class="bold">net position</strong> of this market maker. Under normal market conditions, and given <a id="_idIndexMarker155"/>the market maker has a sufficient number of clients, this net position is always close to zero.</p>
<p>If there’s panic in the market, or if due to whatever reason most traders begin to open more long positions than short (or vice versa), or just a single but very large trader opens a very large position, then the market maker’s net position is substantially greater than zero. In this case, the market maker opens another position that equals their own net position, but in the opposite direction. Say the market maker has a client’s net position of 1 million long, then the market maker opens a position of 1 million short. In this case, the market maker remains market neutral.</p>
<p>You may wonder how a market maker can open a position themselves. This is possible because OTC markets are very fragmented and there are many large and small market participants who may or may not be directly connected. For example, a market maker can easily access liquidity provided by large banks and, therefore, hedge their net positions there, but their clients, retail traders, are really unlikely to access the same.</p>
<p>The second thing market makers can do to protect themselves is to increase the spread. As you’ll remember, in an OTC market, the spread is not determined by all market participants as there’s no such thing as a centralized exchange and a single order book. Instead, any price giver can offer their own price, and market makers are no exception. Normally, a market maker has access to better bid and ask prices than what they offer to their clients. In this sense, market makers act as retailers, buying wholesale liquidity at lower prices and re-selling it to retail at higher prices.</p>
<p>Of course, wide spreads are not good for traders in general. However, there are several reasons that we will discuss closer to the end of this section that may make us consider wider spreads as extra costs of trading that we pay to get some benefits.</p>
<p>Now, we have come to the very point that causes a lot of criticism from traders.</p>
<p>The point is that in an OTC market, where price discovery is not uniform and prices of the same asset differ from one trading venue to another, one price giver to another, and especially in weakly regulated OTC markets, it is quite possible for a market maker to play tricks against their own clients.</p>
<p>This behavior (or, rather, misbehavior) was especially widespread in the early 2000s when forex was only becoming more and more popular. A lot of market makers who called themselves <em class="italic">brokers</em> appeared, offering trading at ridiculous leverage such as 200:1, 500:1, and even 1000:1, promising to <em class="italic">open client positions in real forex</em> and accepting negligibly <a id="_idIndexMarker156"/>small accounts of $100, $10, and even $1. The main source of income for those market makers was not the spread but rather the accounts of their clients because, under such extremely risky conditions, more than 80% of their clients completely lost their money in less than a month.</p>
<p>Obviously, a consistently winning client was a disaster for such a market maker. Any position liquidated with a profit was a direct loss for such a business. Therefore, quite often, market makers of this sort started playing against their own clients by giving them worse quotes and even rejecting their orders without any serious reason. Their only goal was to make trading for a successful trader so uncomfortable that they would prefer to close the account and try their luck elsewhere.</p>
<p>Is this unfair and nasty behavior?</p>
<p>Of course.</p>
<p>Is trading with market makers the only way for retail and institutional traders to trade on the FX market?</p>
<p>No, there are alternatives and we are going to discuss them later in this chapter.</p>
<p>But what is the reason to trade with market makers, then?</p>
<p>Well, there is more than one reason and all of them are quite solid.</p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor057"/>Reasons to trade with market makers</h2>
<p>First, regulations have improved since the early days of retail FX trading, and today such (mis)behavior is almost not possible for a regulated market maker.</p>
<p>Moreover, regulations require that market makers explicitly call themselves market makers and brokers <a id="_idIndexMarker157"/>explicitly call themselves brokers. This puts an end to almost two decades of confusion between the two, which cost the reputations of many fair businesses and the FX market itself, at least in the eyes of retail traders.</p>
<p>Second, regulated market makers are required by regulators to maintain liquidity and quote the market virtually at any moment, even if there’s panic in the market. This means that you can open or liquidate a position any time you want and this is quite the opposite of how you can open or close positions at an exchange. Advanced traders can even take advantage of this, placing trades before or after important economical news is released and liquidity quickly evaporates from the market and prices may differ from one trading venue to another very significantly – which opens excellent opportunities for arbitrage trading. We will consider arbitrage in various forms in <a href="B19145_09.xhtml#_idTextAnchor152"><em class="italic">Chapter 9</em></a><em class="italic">, Trading Strategies and their </em><em class="italic">Core Elements</em>.</p>
<p>To be able to survive even the most disastrous price movements, regulators require that market makers have sufficient capital. The now famous <strong class="bold">currency crash</strong> when the Swiss franc appreciated almost twice against the euro in a few minutes in 2015 clearly showed which market makers met the regulatory requirements: they are still in business while others were swept away. If you are interested in learning more about what happened on January 15, 2015, I’d recommend reading this article (<a href="https://fbs.com/analytics/news/5-years-aninversary-of-the-notorious-eurchf-usdchf-crash-7595">https://fbs.com/analytics/news/5-years-aninversary-of-the-notorious-eurchf-usdchf-crash-7595</a>) that focuses more on the macro-economical side of the event, or this article (<a href="https://fxssi.com/swiss-franc-15-january-2015">https://fxssi.com/swiss-franc-15-january-2015</a>) that looks at the sequence of events from a more technical standpoint.</p>
<p>Third, market makers are excellent for large-volume traders. If you need to fill orders that exceed typical liquidity presently in the order book, you have only two options: to split your order into parts and fill them one by one (without any guarantee that the price remains the same during the process) or ask your market maker for a quote and fill the entire amount in a single chunk. Quite an advantage, isn’t it?</p>
<p>Fourth, market makers often offer products that are really hard to find in any two-sided market. A good example could be binary options (contracts with <em class="italic">all-or-nothing</em> outcomes depending on whether a certain event happens or not, quite similar to betting) or structured products (for example, a mix of fixed income, currency, and equities traded as one single contract).</p>
<p>Lastly, market makers can offer derivatives that are priced very closely to the underlying asset but are not technically considered as the asset itself. One of the most well-known derivatives is <strong class="bold">contracts for difference</strong> (<strong class="bold">CFDs</strong>) — a contract that you make with the market maker <a id="_idIndexMarker158"/>and according to which the market maker is obliged to pay you the difference if you purchased the contract and the price of the underlying asset went higher (or if you sold the contract and the price of the asset went lower). So, a CFD typically works as a proxy for the asset. The reason for using CFDs instead of <a id="_idIndexMarker159"/>the underlying asset is that in certain jurisdictions, any income from CFD trading is not taxed at all. Isn’t it a good reason to consider trading with a reputable regulated market maker?</p>
<p>Of course, market makers are not the only important market participants in the FX market. Let’s get to know another no less important type of market participant.</p>
<h1 id="_idParaDest-59"><a id="_idTextAnchor058"/>Liquidity providers – the whales that support this planet</h1>
<p>In the previous section, we already noted that some activities of market makers are similar to those of <strong class="bold">liquidity providers </strong>(<strong class="bold">LPs</strong>). An LP is a market participant whose business is to <a id="_idIndexMarker160"/>earn the spread by providing liquidity to the market, that is, always maintaining orders to buy or sell on both sides of the order book at the same time. Therefore, as in the case of market makers, LPs act as price givers earning the spread.</p>
<p>In two-sided exchange-traded markets, it’s hard to tell the difference between a market maker and a liquidity provider. However, in OTC markets it becomes fundamental.</p>
<p>In an OTC market, a market maker is an entity that has its own clients and quotes the market for them. A liquidity provider normally does have clients which trade directly with them, regardless <a id="_idIndexMarker161"/>of whether it’s a small retail client or a large fund. LPs only provide liquidity to an order book – or multiple order books – as OTC markets are very fragmented and there are multiple trading venues for the same financial instrument (see the <em class="italic">OTC markets</em> section). So, a typical LP’s clients are banks, ECNs, and brokers.</p>
<p>Many traders think that LPs are <em class="italic">parasites</em> of the market and that without them, pricing would be more transparent, the execution of their orders would be better, and eventually, they would have made more money (or, rather, would make money instead of losing it). This is a common delusion and we will explore why.</p>
<p>Do you remember the typical order book that we saw in the <em class="italic">Exchange and order book </em>section? It clearly shows the liquidity currently present in the market. In that particular example, each price level lists a few hundred orders, which is in fact not much for a large market. Now, what happens if a large order, say, to buy a couple of thousand contracts, hits the market?</p>
<p>Such an order will immediately swipe the order book, buying out all offers first from the best ask price level, then the next price level, then the next, and the next, pushing the price up, higher and higher. All this would happen in a fraction of a millisecond so other market participants wouldn’t have time to react.</p>
<p>On the contrary, if there is sufficient liquidity in the order book then price movements become more moderate as it becomes more difficult to push the price up or down by any significant distance.</p>
<p class="callout-heading">Note</p>
<p class="callout">So LPs play a very important role in OTC markets: they facilitate trading in large volume – and not only to large traders but for any buy-side traders, including retail.</p>
<p>At the same time, LPs make the life of speculators more difficult because the greater the liquidity in the market, the smaller the price movements, and the more difficult it is to profit from buy-side speculations based on the ancient principle, <em class="italic">buy low, </em><em class="italic">sell high</em>.</p>
<p>Every speculative trader must understand that markets were not invented for speculation. The purpose of <a id="_idIndexMarker162"/>any financial market is to facilitate the exchange of goods or money and to find the best price for them. The fact that it is possible to make money by speculation is only a side effect and not the purpose of the market itself.</p>
<h2 id="_idParaDest-60"><a id="_idTextAnchor059"/>Liquidity and volatility – how one transforms into another</h2>
<p>As the number of LPs grows, the market price becomes less and less <strong class="bold">volatile</strong>. Volatility is one of the key metrics of both the market price and the returns of a trading strategy. In simple terms, volatility means ease of price movement: greater volatility means that the price is expected <a id="_idIndexMarker163"/>to jump up and down at a greater distance within the same period of time, while lower volatility means that the price is <strong class="bold">not</strong> expected to move to any significant distance within the same period of time. There are many methodologies to measure volatility <a id="_idIndexMarker164"/>and the subject itself is quite complex and multifaceted (there is even a special term <strong class="bold">volatility trading</strong>) but this lies beyond the scope of this <a id="_idIndexMarker165"/>book. For now, it is sufficient to remember that volatility means how easily a price can move in any direction.</p>
<p>We can illustrate volatility by calculating the difference between the highest price and the lowest price for a fixed period of time and plotting it as a histogram. <em class="italic">Figure 3</em><em class="italic">.3</em> shows such a plot for the euro versus the US dollar, sampled at one-minute intervals:</p>
<div><div><img alt="Figure 3.3 – A simple representation of intraday volatility (chart by MultiCharts)" src="img/B19145_3_3.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – A simple representation of intraday volatility (chart by MultiCharts)</p>
<p>In this illustration, we can clearly see that <strong class="bold">intraday</strong> volatility (the one measured for sampling rate less than 24 hours) in this market is cyclic and that it is always lower during nighttime. This is <a id="_idIndexMarker166"/>quite natural as most of the large market participants trade during normal business hours.</p>
<p>This illustration, however, does not give us an idea about how LPs affect volatility. In order to see this effect, we <a id="_idIndexMarker167"/>need to look at a much bigger picture. Let’s plot the same representation <a id="_idIndexMarker168"/>of volatility for daily time intervals and look into its history back to the beginning of the 21st century. <em class="italic">Figure 3</em><em class="italic">.4</em> shows such a volatility chart for the euro versus the US dollar:</p>
<div><div><img alt="Figure 3.4 – Daily volatility, EURUSD (chart by MultiCharts)" src="img/B19145_3_4.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – Daily volatility, EURUSD (chart by MultiCharts)</p>
<p>In this illustration, we can see multi-year cycles that start with a financial crisis (clearly seen as an increase in daily volatility) and the following continuous decline in volatility that lasts for 4-5 years.</p>
<p>One of the possible <a id="_idIndexMarker169"/>explanations for this phenomenon is that during crisis time, LPs and <a id="_idIndexMarker170"/>market makers are the first to suffer from a sharp increase in demand or supply as they are obliged to maintain liquidity in the market. So, after the initial series of big losses for the sell side and margin calls among the buy side, LPs review their risk metrics and start to withdraw liquidity from the market. We already know that when liquidity goes down volatility goes up; this is what we, the traders, observe as sharp price movements and the rest of the world calls a <em class="italic">crisis</em> or a <em class="italic">catastrophe</em>.</p>
<p>So, all in all, LPs and market makers do a very important job of keeping the market together and ensuring its efficiency – the ability to buy or sell any quantity of the asset at any time.</p>
<p>We have gotten acquainted with the two most important sell-side market participants and we already know that there are many buy-side market participants including ourselves. But how do we all find each other? Where are all our orders sent to and how are they matched?</p>
<h1 id="_idParaDest-61"><a id="_idTextAnchor060"/>ECN – looks like a fair game, but is it?</h1>
<p>When I speak about the structure of OTC markets, especially the fact that prices in them are offered by <a id="_idIndexMarker171"/>just select market participants and can vary significantly for different buy-side clients, many traders say, <em class="italic">“This is not fair! Why won’t FX work in the same manner as other regulated markets with centralized exchanges where anyone can improve </em><em class="italic">the price?”</em></p>
<p>There is no single and simple answer to this question.</p>
<p>First, the FX market trades money for money and not any asset for money. Its original purpose was to facilitate currency exchange rather than speculative trading with various financial instruments. And (fortunately!) we don’t have to go to an exchange to just get some British pounds for euros or Indian rupees for US dollars. Therefore, OTC trades are quite natural for this purpose and a currency exchange shop is an excellent example of trading OTC.</p>
<p>Second, the FX market consists of multiple financial instruments that are quite flexible in their specifications. For example, cash constitutes only a small fraction of this market, while forward contracts make up to 50% of its daily turnover. These forward contracts can be made directly between banks and other market participants without any need for an exchange. We will look into the FX instruments a bit later in this chapter, in the <em class="italic">FX </em><em class="italic">instruments</em> section.</p>
<p>However, as time went on and markets became more and more computerized, traders thought such a market design was not fair enough. Many professional buy-side traders along with market makers, LPs, and brokers thought the same. Buy-side traders sought better, more efficient ways to find the best price in the market rather than just calling multiple banks on the phone and talking to desk dealers. Sell-side traders were keen on providing the best bid and ask prices because this increases the chance to make money earning the spread.</p>
<p>This is of course true not only for the FX market but for any market: the battle for the best execution has a long history. In 1969, the first electronic network that allowed placing bids <a id="_idIndexMarker172"/>and asks by qualified market participants was introduced. It was a revolutionary improvement that allowed negotiating <a id="_idIndexMarker173"/>prices and finding the best bid and best ask much quicker than before. The <strong class="bold">Securities and Exchanges Commission</strong> (<strong class="bold">SEC</strong>) acknowledged this network and named it an <strong class="bold">electronic communication network </strong>(<strong class="bold">ECN</strong>). In 1975, the SEC adopted amendments to the Securities Act (the main legal document that <a id="_idIndexMarker174"/>regulates securities trading in the US), which opened doors to the explosive growth of ECNs and electronic trading.</p>
<p>So, what is an ECN anyway?</p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor061"/>The organization of ECNs</h2>
<p>If you connect to an ECN and retrieve market data from there, you will see something really similar <a id="_idIndexMarker175"/>to the depth of market data received from an exchange. You will see multiple price levels and liquidity on each price level. Depending on your subscription, you may be able to see just the top level, top 5 levels, top 10 levels, or the entire order book. You can wait for the price that is required by your trading strategy and send an order to buy or sell – pretty much like you do that at an exchange.</p>
<p>So, can we say that ECN is an <em class="italic">exchange</em>?</p>
<p>No, it is not.</p>
<p>The key difference between an ECN and an exchange is the availability of its order book. At an exchange, its order book is available for <em class="italic">any </em>order from <em class="italic">any </em>market participant. Anyone can send an order of any size and it will get into the single, universal order book. With an ECN, <em class="italic">only qualified market participants</em> can send their bids and asks to the order book. In the case of the FX market, these are mostly banks, LPs, market makers, and other professional sell-side market participants. Simply put, most likely, you will not be able to send your own bid or ask for the order book at an ECN.</p>
<p>At this point, we should revisit the description of the trade mechanics as it’s going on at an exchange. If you send a limit order – that is, an order to buy or sell an asset at a price that is respectively lower or higher than the current last price – then your order enters the order book at the respective price level and is added to the end of the queue (see the <em class="italic">Exchange and order book</em> section). Anyone in the market can see this order as the liquidity at this price level will have increased.</p>
<p>However, if you do the same at an ECN, the order book does not change visually. Instead, your <a id="_idIndexMarker176"/>order is kept by the ECN matching engine and is executed only when the last price approaches this order. No one, including yourself, will see your order in the order book and you do not have the ability to improve the best bid and the best ask. Only qualified ECN members can improve the best bid and ask.</p>
<h2 id="_idParaDest-63"><a id="_idTextAnchor062"/>ECN – not all market participants were created equal</h2>
<p>So, going back to the discussion of market <em class="italic">fairness</em> at the beginning of this section, can we now say that an ECN is a <em class="italic">fair</em> market? Well, if compared to an exchange – probably not. But it solves <a id="_idIndexMarker177"/>the main problem of OTC markets: it facilitates price discovery among multiple sell-side market participants, adding competition between them, and thus improving the best bid/ask for the sell side.</p>
<p>Trading with an ECN was originally available only to professional market participants, but for over a decade, it has been available virtually to anyone. All you need is to find a broker who supports the <strong class="bold">Straight-Through Processing</strong> (<strong class="bold">STP</strong>) business model. STP means that <a id="_idIndexMarker178"/>the broker does not act as a market maker for their clients, they only route client orders to an ECN.</p>
<p>Let’s recap trading with an ECN once again. LPs and market makers send in their bids and offers and buy-side traders consume this liquidity.</p>
<p>Now, let’s perform the same imaginary experiment – a stress test for such a structure as we did with the exchange order book. Let’s imagine that a large volume buy-side trader comes in with an order to buy or sell more than presently exists in the order book.</p>
<p>In most cases, such an order will swipe the entire liquidity in the order book leaving one of its sides empty for a few moments – a situation that is less than acceptable for LPs. So, if a trader does it only once then there will most likely be no reaction – LPs will rebalance <a id="_idIndexMarker179"/>their order books and liquidity reappears in the market. But if this trader repeats this action, then such an activity is considered <strong class="bold">predatory</strong>,<strong class="bold"> </strong>and the order flow generated by the trader is called <strong class="bold">toxic</strong>. A wide range of <a id="_idIndexMarker180"/>sanctions may follow, from just a call from the broker to a permanent ban at the ECN.</p>
<p>You may think that this issue is not relevant to small-volume traders, such as retail, but in fact, it is.</p>
<p>Let’s revise the definition of the toxic order flow: it is a sequence of orders that systematically and consistently tries to swipe the order book, that is, consume the entire liquidity on either side (bid or ask).</p>
<p>During normal business hours, it is indeed hard to achieve with small order sizes. But do not forget that not all LPs work 24 hours a day. Moreover, there are moments, and even spans of time that last for minutes, when liquidity at the ECN is really close to zero (see an explanation of bank settlement and associated issues in the <em class="italic">FX instruments</em> section in this chapter). If even a small retail trader sends a small order at such a moment, it would drain the thin order book completely, leading to the execution of this order at an absurd price and a phone call from the broker or the exchange with unpleasant questions about the trader’s behavior.</p>
<p class="callout-heading">Note</p>
<p class="callout">If you trade with an ECN, always check the liquidity in the order book before sending any order to avoid really unpleasant situations.</p>
<p>Today, trading at an ECN ensures the second most efficient price discovery process. But what is the <a id="_idIndexMarker181"/>most efficient then, you may wonder. Well, we are now going to discuss<strong class="bold"> </strong><em class="italic">aggregation</em>.</p>
<h1 id="_idParaDest-64"><a id="_idTextAnchor063"/>Aggregation – in search of the best price</h1>
<p>Do you remember that any OTC market in general, and the FX in particular, is highly fragmented? There <a id="_idIndexMarker182"/>are multiple market participants offering different prices for the same asset at the same moment in time.</p>
<p>This is true for any market participant and any trading venue, and ECNs are no exception. If ECNs were closed systems without any links to the outer world, then the price could potentially be very different from prices in the rest of the FX market. Indeed, if we have there an exchange-like trading venue then even though bids and asks are posted by only a small group of qualified members, the price will be determined by supply and demand, quite like in any other market. This means that price takers will be those who drive the price up or take it down. In a closed system, the price is determined only by members of this system.</p>
<p>It may seem that theoretically nothing prevents the price of the same euro versus the US dollar to be 1 at one ECN, 2 at another, and 10 at the third – as long as members of the third ECN think the euro should cost that much!</p>
<p>However – and luckily – this is not true. If each ECN traded a <strong class="bold">separate </strong>asset such as a unique currency, then <a id="_idIndexMarker183"/>indeed its price would be determined only by the supply and demand at this very ECN. But as long as they all trade the same asset, like in our example, someone could buy the same euro at 1 dollar at one ECN and sell it for 10 dollars <a id="_idIndexMarker184"/>at another. Be sure that these smart traders are always present in <a id="_idIndexMarker185"/>any market. They are called <strong class="bold">arbitrageurs</strong> and their trading strategy is called <strong class="bold">arbitrage</strong>.</p>
<p>Besides that, ECNs are not closed systems. All LPs participate in multiple ECNs and other liquidity pools; many of them run their own dealing desks or act as market makers for their clients. Moreover, an ECN can also act as an LP to another ECN!</p>
<p>So, instead of a centralized market, we can again see a very fragmented, very complex network where market participants are linked to each other and to other groups, then these groups are also linked, and so on, and so on. Both buy-side traders (arbitrageurs) and sell-side market participants (LPs and market makers) make the price across the entire FX market far more uniform than in our simplified example previously.</p>
<p>Although we no longer expect as dramatic a difference in price as 1,000% from one trading venue to another, due to the intrinsic fragmentation of the FX market, prices are still slightly different here and there. For example, that same euro can be quoted at 1.13458 at one ECN and 1.13459 at another, and at the same time a market maker can quote it at 1.13461 and a bank at 1.13456. The difference is very tiny and running classical arbitrage <a id="_idIndexMarker186"/>as described is very difficult in the today’s FX market. However, we can look at this price diversity from another angle: what if we could find the absolute best price in the market by checking all available prices?</p>
<p>This is the core idea of <strong class="bold">price aggregation</strong>. An aggregator is not a trading venue as such because it <a id="_idIndexMarker187"/>doesn’t have its own order book and LPs. Instead, an aggregator scans trading venues in search of the absolute best bid and offer and then routes orders to the respective venue.</p>
<p>Due to the nature of aggregation, it is normal that for a brief moment, typically milliseconds or shorter, the best bid price would be <strong class="bold">greater</strong> than the best ask. Think about it! A price at which you could buy is lower than the price at which you could sell! No wonder aggregators very quickly became the favorite trading venues for arbitrage traders – and not only for them. Indeed, price aggregation is the way to get the best execution in a fragmented OTC market.</p>
<p>Unfortunately, today aggregators are available only to professional market participants, such as banks and brokers. So, E<a id="_idTextAnchor064"/><a id="_idTextAnchor065"/>CN trading remains the most efficient among what is available to a wider audience.</p>
<h1 id="_idParaDest-65"><a id="_idTextAnchor066"/>Trading the FX market – what and how</h1>
<p>We have talked <a id="_idIndexMarker188"/>quite a lot about where it is possible to trade but wait! We totally forgot to discuss what is possible to trade and how it is possible to place trades. Let’s fill this gap immediately.</p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor067"/>FX instruments</h2>
<p>You probably heard <a id="_idIndexMarker189"/>that the FX market is the largest market in the world, with a daily turnover of over 2 trillion dollars. But have you ever wondered what instruments are traded in such enormous quantities? Do you imagine piles of cash or gold coins? Maybe instant transfers of money from one bank account to another?</p>
<p>No, of course, this is not the way this market operates. When we say <em class="italic">forex</em> we generally mean trading obligations to deliver one currency for another currency.</p>
<p>If I come to a currency exchange shop and exchange €100 for the equivalent amount of British pounds, then such a transaction is done immediately. My obligations to deliver the euro as the seller and the shop’s obligations to deliver the British pounds to me as the buyer is fulfilled at the moment we make a deal.</p>
<p>However, if I wanted to exchange 1 million euros for the respective amount of British pounds, I would <a id="_idIndexMarker190"/>rather call my bank and ask for the price. The bank would be happy to make a special offer as the amount to exchange is quite attractive. This offered price would be way better than anything a cash exchange shop could offer.</p>
<p>Start getting the point? That’s how multiple prices for the same asset may exist in an OTC market.</p>
<p>I may go even further and check prices with various financial institutions, especially those specializing in currency exchange and international money transfers – and, most likely, I would find the best offer at which I agree to place my trade.</p>
<p>But the price I am offered by the financial institution is by far not the best possible offer on the market. They will then go to the <em class="italic">big</em> forex and place their offer to sell the euros for British pounds at a price that is higher than the one they purchased the euros from me.</p>
<p>This may look simple and straightforward but it’s not.</p>
<p>The problem is that I get a deal now but it’s quite possible that it will take time for my money to get transferred from my bank account to the chosen financial institution that performs the exchange. The exchange rate is already fixed with me. So, for this financial institution, it is critical to be able to hedge their position or liquidate it the very moment they get a deal with me, and not at a later time as the market price may be quite different and they may suffer a loss from such an operation.</p>
<p>So, the financial institution places its offer in a so-called forwards market. A forward contract is an obligation to deliver physical goods (or, in the case of currency markets, a currency) on a certain date at the price fixed at the moment the contract is made. For example, that same financial institution can sell a forward contract that means, <em class="italic">“we will fix the exchange rate of the euro versus the British pound at 0.85 now but I will deliver you the </em><em class="italic">euros later.”</em></p>
<p>During a business day, a financial institution can make lots of forward contracts with various <a id="_idIndexMarker191"/>counterparties. To understand how much they owe to whom and how much others are due to them, there is a special process called <strong class="bold">settlement</strong>. This is the <a id="_idIndexMarker192"/>procedure of netting all mutual obligations of all market participants and figuring out their daily profits and losses.</p>
<p class="callout-heading">Note</p>
<p class="callout">For most currency pairs that involve the US dollar, the settlement time is 5 P.M. New York time. It is extremely important to take special care trading around this time because there is almost no liquidity in the market. It’s always best to avoid trading at all 15 minutes before the settlement and 15-30 minutes after the settlement.</p>
<p>There are various forward contracts among which the heavily-traded contracts are the following:</p>
<ul>
<li><strong class="bold">Today</strong> (<strong class="bold">TOD</strong>) – a forward contract with the delivery date on the same business day, or <em class="italic">T</em></li>
<li><strong class="bold">Tomorrow</strong> (<strong class="bold">TOM</strong>) – a forward contract with the delivery date on the next business day, or <em class="italic">T+1</em></li>
<li><strong class="bold">SPOT</strong> – a forward contract with the delivery date in 2 business days, or <em class="italic">T+2</em></li>
</ul>
<p>As of 2022, the overall daily turnover in all the FX markets is at about $6.6 trillion. SPOT is the largest part of the average daily turnover in forwards, with a value of about $2 trillion. Other forward contracts contribute another $1 trillion. The remaining $3.6 trillion is mostly taken by <strong class="bold">swap contracts</strong> or <strong class="bold">swaps</strong>.</p>
<p>Swaps are very interesting financial instruments mostly used by manufacturers and importers/exporters to hedge their currency risks. If I make a swap contract with you this means that I give you a certain amount of euros and you give me a certain amount in British pounds (or any other currency) and we fix the exchange rate. Then, after some time, typically a year or more, we will exchange our currencies back – and what is most important at this point, at the same exchange rate we traded it originally.</p>
<p>So, a currency swap contract assumes a currency risk for each of us because the exchange rate <a id="_idIndexMarker193"/>in the forwards market may change quite substantially during the term of our swap agreement. But this risk can be sold for a premium and this is how swap traders can make money.</p>
<p>We are not going to consider this class of financial instruments. If you are interested in learning more about them, I’d recommend starting at <a href="https://www.investopedia.com/terms/c/currencyswap.asp">https://www.investopedia.com/terms/c/currencyswap.asp</a>.</p>
<p>Besides cash, forwards, and swaps markets, there are many derivatives – contracts that may and may not assume physical delivery of the asset. One of the most well-known currency <a id="_idIndexMarker194"/>derivatives is currency futures, which are available to trade at <strong class="bold">Chicago Mercantile </strong><strong class="bold">Exchange</strong> (<strong class="bold">CME</strong>).</p>
<p class="callout-heading">Note</p>
<p class="callout">The most important markets for retail traders and active speculators are SPOT and currency futures. These are the two markets that we will be discussing further in the book.</p>
<h2 id="_idParaDest-67"><a id="_idTextAnchor068"/>Naming conventions</h2>
<p>Let’s quickly clarify the way the currencies market uses the names of its instruments.</p>
<p>International <a id="_idIndexMarker195"/>standards (ISO 4217 to be precise) assume that each currency has a numeric three-digit code and a three-letter alphabetic code. Thus, the numeric code for the euro is 978 and the alphabetic code is EUR.</p>
<p>Forex is a special market because we don’t buy goods for money, we buy and sell money for money. Therefore, any instrument in this market is a currency pair and its respective code (which is often called a ticker) consists of two alphabetical currency codes.</p>
<p>The first currency in a pair is the one that is quoted and the second currency is the one in which it is quoted. In other words, the first currency acts as an asset and the second acts as the measuring unit. For example, EURUSD means how many US dollars there are in 1 euro, USDJPY means how many Japanese yen there are in 1 US dollar, and so on.</p>
<p class="callout-heading">Note</p>
<p class="callout">Be extremely careful with FX tickers! Always remember what you buy and what you sell as it’s very easy to confuse.</p>
<p>Prices in the FX market are quoted in fractional amounts. For example, if EURUSD is quoted at 1.0345, it <a id="_idIndexMarker196"/>means that I will get 10,345 US dollars if I sell 10,000 euros, and a quote of 113.78 USDJPY means that I will pay 11,378 Japanese yen to get 100 US dollars. It’s very easy to calculate if you multiply the rate by the respective power of 10 to get rid of fractions.</p>
<p>For many decades, there were mostly four-digit and two-digit prices in the FX market, such as those in the preceding example. The minimal price fluctuation – which is the minimal change <a id="_idIndexMarker197"/>in the fourth or second digit – is called a <strong class="bold">price interest </strong><strong class="bold">point</strong> (<strong class="bold">pip</strong>).</p>
<p>However, a few years ago they got an extra digit. So instead of four-digit prices such as 1.2345 we now have 5-digit prices such as 1.23456, and similarly three digits instead of two digits.</p>
<p class="callout-heading">Note</p>
<p class="callout">Although now most of the prices use five-digit or three-digit notation, the pip is still considered to be in the fourth or second digit respectively. So, the extra digit is called fractional pip or fractional price.</p>
<p>One of the possible explanations as to why this extra digit was added could be the fact that the FX market has been evolving rapidly and a lot of LPs literally flooded it with money. Do you remember our discussion on volatility and its relationship with liquidity in the <em class="italic">Liquidity and volatility: how one transforms into another</em> section? Well, the greater the liquidity, the lower the volatility, and at some point, if we continue using the old 4-digit prices then the spread (the difference between the bid and ask) is zero. In turn, this means that the sell-side market participants no longer can earn on liquidity provision. So, introducing more granular price levels was the only reasonable solution to the problem of excessive liquidity.</p>
<p>So, the introduction of more granular prices is a reliable indicator of growing liquidity in the market. Is it good or bad?</p>
<p>At first glance, it’s definitely good news: the greater the liquidity, the easier it is to make contracts and, therefore, traders get a better execution for their orders. However, if every buyer <a id="_idIndexMarker198"/>and seller can immediately satisfy their needs, the price stops moving anywhere. So, highly liquid markets are attractive for the sell side, but for buy-side speculators, it becomes more and more difficult to make money using directional trading strategies.</p>
<p>To give you an idea about how liquidity can affect the performance of buy-side speculators: in 2001-2004, it was possible to use a quite simplistic trend following trading strategies and it was considered normal if such a strategy made about 10 pips per trade, on average. Today, following the trend almost completely ceased to work in the FX majors and the average profit per trade fell down to 1 pip. This is the price traders pay for the ability to fill their orders more efficiently.</p>
<h2 id="_idParaDest-68"><a id="_idTextAnchor069"/>How do I place a trade?</h2>
<p>Alright, now that we <a id="_idIndexMarker199"/>know what we can trade, it’s time to figure out how we can do that.</p>
<p>In the case of cash exchange, it’s more or less clear: I can go to an exchange shop or go to a bank. But don’t forget that, in this case, I will have to get one price and this price will most likely be very far from the best in the market.</p>
<p>So, if I want to benefit from a market where liquidity is huge and prices are really competitive, I need to be able to access it somehow. Unless I am a financial institution myself (which is most likely not the case), I have to use the services of various intermediaries that <a id="_idIndexMarker200"/>introduce me to the market and provide access to trading venues. These intermediaries are called <strong class="bold">brokers</strong>.</p>
<p>A broker is a market participant whose business is to route orders from clients to trading venues while checking them for market risk and, if necessary, providing leverage (see the <em class="italic">Trade mechanics: again some </em><em class="italic">terminology </em>section).</p>
<p>Again, as in the case of market makers, the very words <strong class="bold">forex broker</strong> are associated with something <a id="_idIndexMarker201"/>negative for many. No wonder in the early years of retail FX trading many dishonest businesses called themselves brokers but in reality, they never routed any order anywhere. This is again no surprise, the minimal ticket in the spot FX market <a id="_idIndexMarker202"/>in the late 1990s was 1 million base currency, and in the early 2000’s it went down to 100,000 – 10 times as low but still too big for small retail traders. So those <em class="italic">brokers</em> offered <em class="italic">mini contracts</em> and <em class="italic">micro contracts</em>, which of course never left this broker’s closed system.</p>
<p>So, in the early days of retail, FX trading brokers had only two options in case they wanted to work with small retail accounts:</p>
<ul>
<li>Act as market makers for their client</li>
<li>Do internal netting of clients’ positions and hedge the net amount in the <em class="italic">large</em> market</li>
</ul>
<p>Unfortunately, many so-called brokers chose the third option – to do nothing and just steal money from their clients. So, we can understand why the mention of forex brokers and the word <em class="italic">forex</em> in general sometimes causes quite an acute reaction.</p>
<p>However – and fortunately – times changed. Now, most of the surviving brokers are regulated and, at the very least, guarantee the safety of the client accounts. Of course, it is not a guarantee against losses in trading but that’s a completely different story.</p>
<p>Besides that, the structure of the FX market has evolved dramatically since the early 2000s. If at the beginning of the century it was populated mostly by banks, then today, the variety of both buy-side and sell-side market participants is very diverse and the number of trading venues available to virtually anyone is quite considerable.</p>
<p>Today, it is really easy to check the broker with the regulator and ask them to provide direct access to a liquidity pool or an ECN –and then trade along with professional market participants in quite a similar manner as if you traded at a centralized regulated exchange.</p>
<p class="callout-heading">Note</p>
<p class="callout">When we develop trading applications with Python, I assume that we directly connect to a trading venue such as an ECN, avoiding platforms such as MetaTrader or proprietary trading platforms because they only add unwanted latency to our orders. MetaTrader can be used as a monitoring tool to watch for open positions and check the correctness of order execution.</p>
<p>It’s been quite <a id="_idIndexMarker203"/>a long chapter and quite a long trip into the world of the FX markets – sometimes clear and straightforward, sometimes weird and spooky. But I am sure there is one question that has long been spinning in your mind while reading all of the aforementioned information.</p>
<h1 id="_idParaDest-69"><a id="_idTextAnchor070"/>Why do I need all this?</h1>
<p>Well, actually you don’t. Of course, you can just quickly download unclear historical price data from <a id="_idIndexMarker204"/>an unknown source, develop a model using tools you don’t fully understand and optimize it using this data, connect to an unknown broker and start trading. The question is: will this trading be successful? Most likely not.</p>
<p>If you read this chapter carefully, you’ll most likely already understand why.</p>
<p>Firstly, when you plan to use certain historical price data for your models you should realize what exactly you are going to use: whether it’s last trade, bid, ask, or both, or anything else. You should check if historical data contains correct timestamps and that no tick is dated earlier than the preceding one. You may want to make sure the data you use contains information about trading volume – otherwise, you won’t be able to develop a wide range of trading strategies. You should make sure that data is clean and consistent, and that there are no erroneous quotes that will affect the parameters of your strategy during its development.</p>
<p>Secondly, you should carefully choose the right trading venue for your strategy. Does it trade large volumes? Does it trade frequently? Does it attempt to trade in <em class="italic">problematic</em> periods of time when liquidity in the market is thin? Answers to all these questions will help you make the right choice.</p>
<p>Finally (something which probably should have been first) – you should make absolutely sure that your <a id="_idIndexMarker205"/>strategy generates trades that are executable and returns that will cover all trading costs, including the market spread and any commissions that your broker charges you.</p>
<p>So, at this point, I would recommend you read this chapter once again now and that you return to it from time to time in the future to keep your development consistent with the real market.</p>
<h1 id="_idParaDest-70"><a id="_idTextAnchor071"/>Summary</h1>
<p>In this chapter, we learned about the different ways a market can be organized and operated. We familiarized ourselves with key concepts such as exchange, order book, and liquidity, noted the possible impact of various factors on price behavior, and discovered important intrinsic factors that may negatively affect the performance of a trading strategy. With all this fundamental knowledge in mind, we’re ready to move on to study the architecture of a trading application in detail, to see what we should use in order to meet the challenges of the modern FX market. This is what we’re going to do in the next chapter.</p>
</div>


<div><h1 id="_idParaDest-71"><a id="_idTextAnchor072"/>Part 2: General Architecture of a Trading Application and A Detailed Study of Its Components</h1>
<p>Being familiar with the subject domain is essential for any software development, and <em class="italic">Part 1</em> introduced the basics of the FX market and the key features typical of trading applications. Now, it’s time to outline the architecture of such an application and consider its main components in greater detail.</p>
<p><em class="italic">Part 2</em> suggests several solutions used to retrieve and handle market data, explains the difference between fundamental and technical analysis, focuses on the meaning of classical <strong class="bold">technical analysis</strong> (<strong class="bold">TA</strong>) indicators from a market process standpoint, and provides possible implementations of these indicators in Python, in a way compatible with further developments. We will also familiarize ourselves with the basics of simple data visualization, which is typically used to quickly check market data and the correctness of calculations, and generate entry and exit orders.</p>
<p>This part comprises the following chapters:</p>
<ul>
<li><a href="B19145_04.xhtml#_idTextAnchor073"><em class="italic">Chapter 4</em></a>, <em class="italic">Trading Application – What’s Inside?</em></li>
<li><a href="B19145_05.xhtml#_idTextAnchor086"><em class="italic">Chapter 5</em></a>, <em class="italic">Retrieving and Handling Market Data with Python</em></li>
<li><a href="B19145_06.xhtml#_idTextAnchor101"><em class="italic">Chapter 6</em></a>, <em class="italic">Basics of Fundamental Analysis and Its Possible Use in FX Trading</em></li>
<li><a href="B19145_07.xhtml#_idTextAnchor114"><em class="italic">Chapter 7</em></a>, <em class="italic">Technical Analysis and Its Implementation in Python</em></li>
<li><a href="B19145_08.xhtml#_idTextAnchor130"><em class="italic">Chapter 8</em></a>, <em class="italic">Data Visualization in FX Trading with Python</em></li>
</ul>
</div>
<div><div></div>
</div>
</body></html>