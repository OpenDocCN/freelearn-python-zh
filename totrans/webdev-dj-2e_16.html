<html><head></head><body>
		<div><div></div>
		</div>
		<div><h1 id="_idParaDest-441"><a id="_idTextAnchor471"/>16. Using a Frontend JavaScript Library with Django</h1>
		</div>
		<div><p class="callout-heading">Overview</p>
			<p class="callout">This chapter introduces the basics of JavaScript and ends with building an interactive web frontend for Bookr using the React JavaScript framework. You will learn how to include the React JavaScript framework in a Django template, and how to build React components. This chapter also includes an introduction to <code>fetch</code> JavaScript function which is used to retrieve information from a REST API. Toward the end of the chapter, you will be introduced to the Django <code>{% verbatim %}</code> template tag, which is used to include unparsed data in a Django template.</p>
			<h1 id="_idParaDest-442"><a id="_idTextAnchor472"/>Introduction</h1>
			<p>Django is a great tool for building the backend of an application. You have seen how easy it is to set up the database, route URLs, and render templates. Without using JavaScript, though, when those pages are rendered to the browser, they are static and do not provide any form of interaction. By using JavaScript, your pages can be transformed into applications that are fully interactive in the browser.</p>
			<p>This chapter will be a brief introduction to JavaScript frameworks and how to use them with Django. While it won't be a deep dive into how to build an entire JavaScript application from scratch (that would be a book in itself), we will give enough of an introduction so that you can add interactive components to your own Django application. In this chapter, we will primarily be working with the React framework. Even if you do not have any JavaScript experience, we will introduce enough about it so that, by the end of this chapter, you will be comfortable writing your own React components. In <em class="italic">Chapter 12</em>, <em class="italic">Building a REST API</em>, you built a REST API for Bookr. We will interact with that API using JavaScript to retrieve data. We will enhance Bookr by showing some review previews on the main page that are dynamically loaded and can be paged through.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The code for the exercises and activities in this chapter can be found in this book's GitHub repository at <a href="http://packt.live/3iasIMl">http://packt.live/3iasIMl</a>.</p>
			<h1 id="_idParaDest-443"><a id="_idTextAnchor473"/>JavaScript Frameworks</h1>
			<p>These days, real-time interactivity is a fundamental part of web applications. While simple interactions can be added without a framework (developing without a framework is often called <em class="italic">Vanilla JS</em>), as your web application grows, it can be much easier to manage with the use of a framework. Without a framework, you would need to do all these things yourself:</p>
			<ul>
				<li>Manually define the database schema.</li>
				<li>Convert data from HTTP requests into native objects.</li>
				<li>Write form validation.</li>
				<li>Write SQL queries to save data.</li>
				<li>Construct HTML to show a response.</li>
			</ul>
			<p>Compare this to what Django provides. Its <strong class="bold">ORM</strong> (<strong class="bold">Object Relational Mapping</strong>), automatic form parsing and validation, and templating drastically cut down on the amount of code you need to write. JavaScript frameworks bring similar time-saving enhancements to JavaScript development. Without them, you would have to manually update the HTML elements in the browser as your data changes. Let's take a simple example: showing the count of the number of times a button has been clicked. Without a framework, you would have to do the following:</p>
			<ol>
				<li>Assign a handler to the button click event.</li>
				<li>Increment the variable that stored the count.</li>
				<li>Locate the element containing the click count display.</li>
				<li>Replace the element's text with the new click count.</li>
			</ol>
			<p>When using a framework, the button count variable is bound to the display (HTML), so the process you have to code is as follows: </p>
			<ol>
				<li value="1">Handle the button click.</li>
				<li>Increment the variable.</li>
			</ol>
			<p>The framework takes care of automatically re-rendering the number display. This is just a simple example, though; as your application grows, the disparity in complexity between the two approaches expands. There are several JavaScript frameworks available, each with different features and some supported and used by large companies. Some of the most popular are React (<a href="https://reactjs.org">https://reactjs.org</a>), Vue (<a href="http://vuejs.org">http://vuejs.org</a>), Angular (<a href="https://angularjs.org">https://angularjs.org</a>), Ember (<a href="https://emberjs.com">https://emberjs.com</a>), and Backbone.js (<a href="https://backbonejs.org">https://backbonejs.org</a>).</p>
			<p>In this chapter, we will be using React, as it is easy to drop into an existing web application and allows <em class="italic">progressive enhancement</em>. This means that rather than having to build your application from scratch, targeting React, you can simply apply it to certain parts of the HTML that Django generates; for example, a single text field that automatically interprets Markdown and shows the result without reloading the page. We will also cover some of the features that Django offers that can help integrate several JavaScript frameworks.</p>
			<p>There are several different levels that JavaScript can be incorporated into a web application at. <em class="italic">Figure 16.1</em> shows our current stack, with no JavaScript (note that the following diagrams do not show requests to the server):</p>
			<div><div><img src="img/B15509_16_01.jpg" alt="Figure 16.1: Current stack&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.1: Current stack</p>
			<p>You can base your entire application on JavaScript using <strong class="bold">Node.js</strong> (a server-side JavaScript interpreter), which would take the place of Python and Django in the stack. <em class="italic">Figure 16.2</em> shows how this might look:</p>
			<div><div><img src="img/B15509_16_02.jpg" alt="Figure 16.2: Using Node.js to generate HTML&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.2: Using Node.js to generate HTML</p>
			<p>Or, you can have your frontend and templates entirely in JavaScript, and just use Django to act as a REST API to provide data to render. <em class="italic">Figure 16.3</em> shows this stack:</p>
			<div><div><img src="img/B15509_16_03.jpg" alt="Figure 16.3: Sending JSON from Django and rendering it in the browser&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.3: Sending JSON from Django and rendering it in the browser</p>
			<p>The final approach is progressive enhancement, which is (as mentioned) what we will be using. In this way, Django is still generating the HTML templates and React sits on top of this to add interactivity:</p>
			<div><div><img src="img/B15509_16_04.jpg" alt="Figure 16.4: HTML generated with Django with React providing progressive enhancement&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.4: HTML generated with Django with React providing progressive enhancement</p>
			<p>Note that it is common to use multiple techniques together. For example, Django may generate the initial HTML to which React is applied in the browser. The browser can then query Django for JSON data to be rendered, using React.</p>
			<h1 id="_idParaDest-444">Java<a id="_idTextAnchor474"/>Script Introduction</h1>
			<p>In this section, we will briefly introduce some basic JavaScript concepts, such as variables and functions. Different operators will be covered as we introduce them.</p>
			<p><strong class="bold">Loading JavaScript</strong></p>
			<p>JavaScript can either be inline in an HTML page or included from a separate JavaScript file. Both methods use the <code>&lt;script&gt;</code> tag. With inline JavaScript, the JavaScript code is written directly inside the <code>&lt;script&gt;</code> tags in an HTML file; for example, like this:</p>
			<pre>&lt;script&gt;
    // comments in JavaScript can start with //
    /* Block comments are also supported. This comment is multiple
      lines and doesn't end until we use a star then slash:
    */
    let a = 5; // declare the variable a, and set its value to 5
    console.log(a); // print a (5) to the browser console
&lt;/script&gt;</pre>
			<p>Note that the <code>console.log</code> function prints out data to the browser console that is visible in the developer tools of your browser:</p>
			<div><div><img src="img/B15509_16_05.jpg" alt="Figure 16.5: The result of the console.log(a) call – 5 is printed to the browser console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.5: The result of the console.log(a) call – 5 is printed to the browser console</p>
			<p>We could also put the code into its own file (we would not include the <code>&lt;script&gt;</code> tags in the standalone file). We then load it into the page using the <code>&lt;script&gt;</code> tag's <code>src</code> attribute, as we saw in <em class="italic">Chapter 5</em>, <em class="italic">Serving Static Files</em>:</p>
			<pre>&lt;script src="img/{% static 'file.js' }"&gt;&lt;/script&gt;</pre>
			<p>The source code, whether inline or included, will be executed as soon as the browser loads the <code>&lt;script&gt;</code> tag.</p>
			<p><strong class="bold">Variables and Constants</strong></p>
			<p>Unlike in Python, variables in JavaScript must be declared, using either the <code>var</code>, <code>let</code>, or <code>const</code> keyword:</p>
			<pre>var a = 1; // variable a has the numeric value 1
let b = 'a'; // variable b has the string value 'a'
const pi = 3.14; // assigned as a constant and can't be redefined</pre>
			<p>Just like in Python, though, a type for a variable does not need to be declared. You will notice that the lines end with semicolons. JavaScript does not require lines to be terminated with semicolons – they are optional. However, some style guides enforce their use. You should try to stick with a single convention for any project.</p>
			<p>You should use the <code>let</code> keyword to declare a variable. Variable declarations are scoped. For example, a variable declared with <code>let</code> inside a <code>for</code> loop will not be defined outside the loop. In this example, we'll loop through and sum the multiples of 10 till 90, and then print the result to <code>console.log</code>. You'll notice we can access variables declared at the function level inside the <code>for</code> loop, but not the other way around:</p>
			<pre>let total = 0;
for (let i = 0; i&lt; 10; i++){  // variable i is scoped to the loop
    let toAdd = i * 10;  // variable toAdd is also scoped
    total += toAdd;  // we can access total since it's in the outer scope
}
console.log(total);  // prints 450
console.log(toAdd);  /* throws an exception as the variable is not   declared in the outer scope */
console.log(i);  /* this code is not executed since an exception was   thrown the line before, but it would also generate the same     exception */</pre>
			<p><code>const</code> is for constant data and cannot be redefined. That does not mean that the object it points to cannot be changed, though. For example, you couldn't do this:</p>
			<pre>const pi = 3.1416;
pi = 3.1;  /* raises exception since const values can't be   reassigned */</pre>
			<p>The <code>var</code> keyword is required by older browsers that don't support <code>let</code> or <code>const</code>. Only 1% of browsers these days don't support those keywords, so throughout the rest of the chapter, we will only use <code>let</code> or <code>const</code>. Like <code>let</code>, variables declared with <code>var</code> can be reassigned; however, they are scoped at the function level only.</p>
			<p>JavaScript supports several different types of variables, including strings, arrays, objects (which are like dictionaries), and numbers. We will cover arrays and objects in their own sections now.</p>
			<p><strong class="bold">Arrays</strong></p>
			<p>Arrays are defined similarly to how they are in Python, with square brackets. They can contain different types of data, just like with Python:</p>
			<pre>const myThings = [1, 'foo', 4.5];</pre>
			<p>Another thing to remember with the use of <code>const</code> is that it prevents reassigning the constant but does not prevent changing the variable or object being pointed to. For example, we would not be allowed to do this:</p>
			<pre>myThings = [1, 'foo', 4.5, 'another value'];</pre>
			<p>However, you could update the contents of the <code>myThings</code> array by using the <code>push</code> method (like Python's <code>list.append</code>) to append a new item:</p>
			<pre>myThings.push('another value');</pre>
			<p><strong class="bold">Objects</strong></p>
			<p>JavaScript objects are like Python dictionaries, providing a key-value store. The syntax to declare them is similar as well:</p>
			<pre>const o = {foo: 'bar', baz: 4};</pre>
			<p>Note that, unlike Python, JavaScript object/dictionary keys do not need to be quoted when creating them – unless they contain special characters (spaces, dashes, dots, and more). </p>
			<p>The values from <code>o</code> can be accessed either with item access or attribute access:</p>
			<pre>o.foo; // 'bar'
o['baz']; // 4</pre>
			<p>Also note that since <code>o</code> was declared as a constant, we cannot reassign it, but we can alter the object's attributes:</p>
			<pre>o.anotherKey = 'another value'  // this is allowed</pre>
			<p><strong class="bold">Functions</strong></p>
			<p>There are a few different ways to define functions in JavaScript. We will look at three. You can define them using the <code>function</code> keyword:</p>
			<pre>function myFunc(a, b, c) {
  if (a == b)
    return c;
  else if (a &gt; b)
    return 0;
  return 1;
}</pre>
			<p>All arguments to a function are optional in JavaScript; that is, you could call the preceding function like this: <code>myFunc()</code>, and no error would be raised (at least during call time). The <code>a</code>, <code>b</code>, and <code>c</code> variables would all be the special type <code>undefined</code>. This would cause issues in the logic of the function. <code>undefined</code> is kind of like <code>None</code> in Python – although JavaScript also has <code>null</code>, which is more similar to <code>None</code>. Functions can also be defined by assigning them to a variable (or constant):</p>
			<pre>const myFunc = function(a, b, c) {
    // function body is implemented the same as above
}</pre>
			<p>We can also define functions using an arrow syntax. For example, we can also define <code>myFunc</code> like this:</p>
			<pre>const myFunc = (a, b, c) =&gt; {
    // function body as above
}</pre>
			<p>This is more common when defining functions as part of an object, for example:</p>
			<pre>const o = {
myFunc: (a, b, c) =&gt; {
    // function body
    }
}</pre>
			<p>In this case, it would be called like this: </p>
			<pre>o.myFunc(3, 4, 5);</pre>
			<p>We will return to the reasons for using arrow functions after introducing classes.</p>
			<p><strong class="bold">Classes and Methods</strong></p>
			<p>Classes are defined with the <code>class</code> keyword. Inside a <code>class</code> definition, methods are defined without the <code>function</code> keyword. The JavaScript interpreter can recognize the syntax and tell that it is a method. Here is an example class, which takes a number to add (through <code>toAdd</code>) when instantiated. That number will be added to whatever is passed to the <code>add</code> method, and the result returned:</p>
			<pre>class Adder {
    // A class to add a certain value to any number
    // this is like Python's __init__ method
    constructor (toAdd) {
        //"this" is like "self" in Python
        //it's implicit and not manually passed into every method
        this.toAdd = toAdd;
    }
    add (n) {
        // add our instance's value to the passed in number
        return this.toAdd + n;
    }
}</pre>
			<p>Classes are instantiated with the <code>new</code> keyword. Other than that, their usage is very similar to classes in Python:</p>
			<pre>const a = new Adder(5);
console.log(a.add(3)); // prints "8"</pre>
			<p><strong class="bold">Arrow Functions</strong></p>
			<p>Now that we've introduced the <code>this</code> keyword, we can return to the purpose of arrow functions. Not only are they shorter to write, but they also preserve the context of <code>this</code>. Unlike <code>self</code> in Python, which always refers to a specific object because it is passed into methods, the object that <code>this</code> refers to can change based on context. Usually, it is due to the nesting of functions, which is common in JavaScript. </p>
			<p>Let's look at two examples. First, an object with a function called <code>outer</code>. This <code>outer</code> function contains an <code>inner</code> function. We refer to <code>this</code> in both the <code>inner</code> and <code>outer</code> functions:</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The next code example refers to the <code>window</code> object. In JavaScript, <code>window</code> is a special global variable that exists in each browser tab and represents information about that tab. It is an instance of the <code>window</code> class. Some examples of the attributes <code>window</code> has are <code>document</code> (which stores the current HTML document), <code>location</code> (which is the current location shown in the tab's address bar), and <code>outerWidth</code> and <code>outerHeight</code> (which represent the width and height of the browser window respectively). For example, to print the current tab's location to the browser console, you would write <code>console.log(window.location)</code>.</p>
			<pre>const o1 = {
    outer: function() {
        console.log(this);  // "this" refers to o1
        const inner = function() {
            console.log(this);  // "this" refers to the "window"               object
        }
        inner();
    }
}</pre>
			<p>Inside the <code>outer</code> function, <code>this</code> refers to <code>o1</code> itself, whereas inside the <code>inner</code> function, <code>this</code> refers to the window (an object that contains information about the browser window).</p>
			<p>Compare this to defining the inner function using arrow syntax:</p>
			<pre>const o2 = {
    outer: function() {
        console.log(this);  // refers to o2
        const inner = () =&gt; {
            console.log(this);  // also refers to o2
        }
        inner();
    }
}</pre>
			<p>When we use arrow syntax, <code>this</code> is consistent and refers to <code>o2</code> in both cases. Now that we have had a very brief introduction to JavaScript, let's introduce React.</p>
			<p class="callout-heading">Further Reading</p>
			<p class="callout">Covering all the concepts of JavaScript is beyond the scope of this book. For a complete, hands-on course on JavaScript, you can always refer to <em class="italic">The JavaScript Workshop</em>: <a href="https://courses.packtpub.com/courses/javascript">https://courses.packtpub.com/courses/javascript</a>.</p>
			<h2 id="_idParaDest-445">React<a id="_idTextAnchor475"/></h2>
			<p>React allows you to build applications using components. Each component can <em class="italic">render</em> itself, by generating HTML to be inserted on the page. </p>
			<p>A component may also keep track of its own <em class="italic">state</em>. If it does track its own state, when the state changes, the component will automatically re-render itself. This means if you have an action method that updates a state variable on a component, you don't need to then figure out whether the component needs to be redrawn; React will do this for you. A web app should track its own state so that it doesn't need to query the server to find out how it needs to update to display data.</p>
			<p>Data is passed between components using properties, or <em class="italic">props</em> for short. The method of passing properties looks kind of like HTML attributes, but there are some differences, which we will cover later in the chapter. Properties are received by a component in a single <code>props</code> object.</p>
			<p>To illustrate with an example, you might build a shopping list app with React. You would have a component for the list container (<code>ListContainer</code>), and a component for a list item (<code>ListItem</code>). <code>ListItem</code> would be instantiated multiple times, once for each item on the shopping list. The container would hold a state, containing a list of the items' names. Each item name would be passed to the <code>ListItem</code> instances as a <em class="italic">prop</em>. Each <code>ListItem</code> would then store the item's name and an <code>isBought</code> flag in its own state. As you click an item to mark it off the list, <code>isBought</code> would be set to <code>true</code>. Then React would automatically call <code>render</code> on that <code>ListItem</code> to update the display.</p>
			<p>There are a few different methods of using React with your application. If you want to build a deep and complex React application, you should use <code>npm</code> (<code>&lt;script&gt;</code> tag:</p>
			<pre>&lt;scri<a id="_idTextAnchor476"/>pt crossorigin src="img/react.development.js"&gt;&lt;/script&gt;
&lt;script crossorigin src="img/react-dom.development.js"&gt;&lt;/script&gt;</pre>
			<p class="callout-heading">Note</p>
			<p class="callout">The <code>crossorigin</code> attribute is for security and means cookies or other data cannot be sent to the remote server. This is necessary when using a public CDN such as <a href="https://unpkg.com/">https://unpkg.com/</a>, in case a malicious script has been hosted there by someone.</p>
			<p>These should be placed on a page that you want to add React to, just before the closing <code>&lt;/body&gt;</code> tag. The reason for putting the tags here instead of in the <code>&lt;head&gt;</code> of the page is that the script might want to refer to HTML elements on the page. If we put the script tag in the head, it will be executed before the page elements are available (as they come after).</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The links to the latest React versions can be found at <a href="https://reactjs.org/docs/cdn-links.html">https://reactjs.org/docs/cdn-links.html</a>.</p>
			<h2 id="_idParaDest-446">Compo<a id="_idTextAnchor477"/>nents</h2>
			<p>There are two ways to build a component in React: with functions or with classes. Regardless of the approach, to get displayed on a page, the component must return some HTML elements to display. A functional component is a single function that returns elements, whereas a class-based component will return elements from its <code>render</code> method. Functional components cannot keep track of their own state.</p>
			<p>React is like Django in that it automatically escapes HTML in strings that are returned from <code>render</code>. To generate HTML elements, you must construct them using their tag, the attributes/properties they should have, and their content. This is done with the <code>React.createElement</code> function. A component will return a React element, which may contain sub-elements.</p>
			<p>Let us look at two implementations of the same component, first as a function then as a class. The functional component takes <code>props</code> as an argument. This is an object containing the properties that are passed to it. The following function returns an <code>h1</code> element:</p>
			<pre>function HelloWorld(props) {
return React.createElement('h1', null, 'Hello, ' +   props.name + '!');
}</pre>
			<p>Note that it is conventional for the function to have an uppercase first character.</p>
			<p>While a functional component is a single function that generates HTML, a class-based component must implement a <code>render</code> method to do this. The code in the <code>render</code> method is the same as in the functional component, with one difference: the class-based component accepts the <code>props</code> object in its constructor, and then <code>render</code> (or other) methods can refer to <code>props</code> using <code>this.props</code>. Here is the same <code>HelloWorld</code> component, implemented as a class:</p>
			<pre>class HelloWorld extends React.Component {
render() {
return React.createElement('h1', null, 'Hello, ' +   this.props.name + '!');
  }
}</pre>
			<p>When using classes, all components extend from the <code>React.Component</code> class. Class-based components have an advantage over functional components, which is that they encapsulate the handling actions/event, and their own state. For simple components, using the functional style means less code. For more information on components and properties, see <a href="https://reactjs.org/docs/components-and-props.html">https://reactjs.org/docs/components-and-props.html</a>.</p>
			<p>Whichever method you choose to define a component, it is used in the same way. In this chapter, we will only be using class-based components.</p>
			<p>To put this component onto an HTML page, we first need to add a place for React to render it. Normally, this is done using <code>&lt;div&gt;</code> with an <code>id</code> attribute. For example:</p>
			<pre>&lt;div id="react_container"&gt;&lt;/div&gt;</pre>
			<p>Note that <code>id</code> does not have to be <code>react_container</code>, it just needs to be unique for the page. Then, in the JavaScript code, after defining all your components, they are rendered on the page using the <code>ReactDOM.render</code> function. This takes two arguments: the root React element (not the component) and the HTML element in which it should be rendered.</p>
			<p>We would use it like this:</p>
			<pre>const container = document.getElementById('react_container');
const componentElement = React.createElement(HelloWorld, {name:   'Ben'});
ReactDOM.render(componentElement, container);</pre>
			<p>Note that the <code>HelloWorld</code> component (class/function) itself is not being passed to the <code>render</code> function, it is wrapped in a <code>React.createElement</code> call to instantiate it and transform it into an element.</p>
			<p>As you might have guessed from its name, the <code>document.getElementById</code> function locates an HTML element in the document and returns a reference to it.</p>
			<p>The final output in the browser when the component is rendered is like this:</p>
			<pre>&lt;h1&gt;Hello, Ben!&lt;/h1&gt;</pre>
			<p>Let's look at a more advanced example component. Note that since <code>React.createElement</code> is such a commonly used function, it's common to alias to a shorter name, such as <code>e</code>: that's what the first line of this example does.</p>
			<p>This component displays a button and has an internal state that keeps track of how many times the button was clicked. First, let's look at the component class in its entirety:</p>
			<pre>const e = React.createElement;
class ClickCounter extends React.Component {
  constructor(props) {
    super(props);
    this.state = { clickCount: 0 };
  }
  render() {
    return e(
      'button',  // the element name
      {onClick: () =&gt; this.setState({ 
       clickCount: this.state.clickCount + 1 }) },//element props
       this.state.clickCount  // element content
    );
  }
}</pre>
			<p>Some things to note about the <code>ClickCounter</code> class:</p>
			<ul>
				<li>The <code>props</code> argument is an object (dictionary) of attribute values that have been passed to the component when it is used in HTML. For example:<pre>&lt;ClickCounter foo="bar" rex="baz"/&gt;</pre><p>The <code>props</code> dictionary would contain the key <code>foo</code> with a value of bar, and the key <code>rex</code> with the value <code>baz</code>.</p></li>
				<li><code>super(props)</code> calls the super class's <code>constructor</code> method and passes the <code>props</code> variable. This is analogous to the <code>super()</code> method in Python.</li>
				<li>Each React class has a <code>state</code> variable, which is an object. <code>constructor</code> can initialize it. The state should be changed using the <code>setState</code> method, rather than being manipulated directly. When it is changed, the <code>render</code> method will be automatically called to redraw the component.</li>
			</ul>
			<p>The <code>render</code> method returns a new HTML element, using the <code>React.createElement</code> function (remember, the <code>e</code> variable was aliased to this function). In this case, the arguments to <code>React.createElement</code> will return a <code>&lt;button&gt;</code> element with a click handler, and with the text content <code>this.state.clickCount</code>. Essentially, it will return an element like this (when <code>clickCount</code> is <code>0</code>):</p>
			<pre>&lt;button onClick="this.setState(…)"&gt;
  0
&lt;/button&gt;</pre>
			<p>The <code>onClick</code> function is set as an anonymous function with arrow syntax. This is similar to having a function as follows (although not quite the same since it's in a different context):</p>
			<pre>const onClick = () =&gt; {
this.setState({clickCount: this.state.clickCount + 1})
}</pre>
			<p>Since the function is only one line, we can also remove one set of wrapping braces, and we end up with this:</p>
			<pre>{ onClick: () =&gt; this.setState({clickCount:   this.state.clickCount + 1}) }</pre>
			<p>We covered how to place <code>ClickCounter</code> onto a page earlier in this section, something like this:</p>
			<pre>ReactDOM.render(e(ClickCounter), document.getElementById   ('react_container'));</pre>
			<p>The screenshot in the following figure shows the counter in the button when the page loads:</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In the following figure, <code>DjDt</code> refers to the debug toolbar that we learned about in the <em class="italic">Django Debug Toolbar</em> section in <em class="italic">Chapter 15</em>, <em class="italic">Django Third-Party Libraries</em>.</p>
			<div><div><img src="img/B15509_16_06.jpg" alt="Figure 16.6: Button with 0 for the count&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.6: Button with 0 for the count</p>
			<p>After clicking the button a few times, the button looks as shown in <em class="italic">Figure 16.7</em>:</p>
			<div><div><img src="img/B15509_16_07.jpg" alt="Figure 16.7: Button after clicking seven times&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.7: Button after clicking seven times</p>
			<p>Now, just to demonstrate how <em class="italic">not</em> to write the <code>render</code> function, we'll look at what happens if we just return HTML as a string, like this:</p>
			<pre>render() {
    return '&lt;button&gt;' + this.state.clickCount + '&lt;/button&gt;'
}</pre>
			<p>Now the rendered page looks as shown in <em class="italic">Figure 16.8</em>:</p>
			<div><div><img src="img/B15509_16_08.jpg" alt="Figure 16.8: Returned HTML rendered as a string&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.8: Returned HTML rendered as a string</p>
			<p>This shows React's automatic escaping of HTML in action. Now that we have had a brief intro to JavaScript and React, let's add an example page to Bookr so you can see it in action.</p>
			<h2 id="_idParaDest-447">Exercise<a id="_idTextAnchor478"/> 16.01: Setting Up a React Example</h2>
			<p>In this exercise, we will create an example view and template to use with React. Then we will implement the <code>ClickCounter</code> component. At the end of the exercise, you will be able to interact with it with the <code>ClickCounter</code> button:</p>
			<ol>
				<li value="1">In PyCharm, go to <code>New</code> -&gt; <code>File</code> inside the project's <code>static</code> directory. Name the new file <code>react-example.js</code>.</li>
				<li>Inside it, put this code, which will define the React component, then render it into the <code>react_container</code> <code>&lt;div&gt;</code> that we will be creating:<pre>const e = React.createElement;
class ClickCounter extends React.Component {
  constructor(props) {
    super(props);
    this.state = { clickCount: 0 };
  }
  render() {
    return e(
      'button',
      { onClick: () =&gt; this.setState({ 
           clickCount: this.state.clickCount + 1 
           }) 
},
      this.state.clickCount
    );
  }
}
ReactDOM.render(e(ClickCounter), document.getElementById   ('react_container'))</pre><p>You can now save <code>react-example.js</code>.</p></li>
				<li>Go to <code>New</code> -&gt; <code>HTML File</code> inside the project's <code>templates</code> directory:<div><img src="img/B15509_16_09.jpg" alt="Figure 16.9: Create a new HTML file&#13;&#10;"/></div><p class="figure-caption">Figure 16.9: Create a new HTML file</p><p>Name the new file <code>react-example.html</code>:</p><div><img src="img/B15509_16_10.jpg" alt="Figure 16.10: Name the file react-example.html&#13;&#10;"/></div><p class="figure-caption">Figure 16.10: Name the file react-example.html</p><p>You can change the title inside the <code>&lt;title&gt;</code> element to <em class="italic">React Example</em>, but that is not necessary for this exercise.</p></li>
				<li><code>react-example.html</code> is created with some HTML boilerplate as we have seen before. Add the following <code>&lt;script&gt;</code> tags to include React just before the closing <code>&lt;/body&gt;</code> tag:<pre>&lt;script crossorigin src="img/react.development.js"&gt;&lt;/script&gt;
&lt;script crossorigin src="img/react-dom.development.js"&gt;&lt;/script&gt;</pre></li>
				<li>The <code>react-example.js</code> file will be included using a <code>&lt;script&gt;</code> tag, and we need to generate the script path using the <code>static</code> template tag. First, <code>load</code> the static template library at the start of the file by adding this on the second line:<pre>{% load static %}</pre><p>The first few lines of your file will look like <em class="italic">Figure 16.11</em>:</p><div><img src="img/B15509_16_11.jpg" alt="Figure 16.11: The load static template tag included&#13;&#10;"/></div><pre>&lt;script src="img/{% static 'react-example.js' %}"&gt;&lt;/script&gt;</pre></li>
				<li>We now need to add the containing <code>&lt;div&gt;</code> that React will render into. Add this element after the opening <code>&lt;body&gt;</code> tag:<pre>&lt;div id="react_container"&gt;&lt;/div&gt;</pre><p>You can save <code>react-example.html</code>.</p></li>
				<li>Now we'll add a view to render the template. Open the <code>reviews</code> app's <code>views.py</code> and add a <code>react_example</code> view at the end of the file:<pre>def react_example(request):
    return render(request, "react-example.html")</pre><p>In this simple view, we are just rendering the <code>react-example.html</code> template with no context data.</p></li>
				<li>Finally, we need to map a URL to the new view. Open the <code>bookr</code> package's <code>urls.py</code> file. Add this map to the <code>urlpatterns</code> variable:<pre>path('react-example/', reviews.views.react_example)</pre><p>You can save and close <code>urls.py</code>.</p></li>
				<li>Start the Django dev server if it's not already running, then go to <code>http://127.0.0.1:8000/react-example/</code>. You should see the <code>ClickCount</code> button rendered as in <em class="italic">Figure 16.12</em>:<div><img src="img/B15509_16_12.jpg" alt="Figure 16.12: ClickCount button&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 16.12: ClickCount button</p>
			<p>Try clicking the button a few times and watch the counter increment.</p>
			<p>In this example, we created our first React component, then added a template and view to render it. We included the React framework source from a CDN. In the next section, we will introduce <strong class="bold">JSX</strong>, which is a method of combining templates and code into a single file that can simplify our code.</p>
			<h2 id="_idParaDest-448"><a id="_idTextAnchor479"/>JSX</h2>
			<p>It can b<a id="_idTextAnchor480"/>e quite verbose to define each element using the <code>React.createElement</code> function – even when we alias to a shorter variable name. The verbosity is exacerbated when we start building larger components.</p>
			<p>When using React, we can use JSX instead to build the HTML elements. JSX stands for JavaScript XML – since both JavaScript and XML are written in the same file. For example, consider the following code in which we are creating a button using the <code>render</code> method:</p>
			<pre>return React.createElement('button', { onClick: … },   'Button Text')</pre>
			<p>Instead of this, we can return its HTML directly, as follows:</p>
			<pre>return &lt;button onClick={…}&gt;Button Text&lt;/button&gt;;</pre>
			<p>Note that the HTML is not quoted and returned as a string. That is, we are not doing this:</p>
			<pre>return '&lt;button onClick={…}&gt;Button Text&lt;/button&gt;';</pre>
			<p>Since JSX is an unusual syntax (a combination of HTML and JavaScript in a single file), we need to include another JavaScript library before it can be used: Babel (<a href="https://babeljs.io">https://babeljs.io</a>). This is a library that can <em class="italic">transpile</em> code between different versions of JavaScript. You can write code using the latest syntax and have it <em class="italic">transpiled</em> (a combination of translate and compile) into a version of code that older browsers can understand.</p>
			<p>Babel can be included with a <code>&lt;script&gt;</code> tag like this:</p>
			<pre>&lt;script crossorigin src="img/  babel.min.js"&gt;&lt;/script&gt;</pre>
			<p>This should be included on the page after your other React-related script tags, but before you include any files containing JSX.</p>
			<p>Any JavaScript source code that includes JSX must have the <code>type="text/babel"</code> attribute added:</p>
			<pre>&lt;script src="img/file.js" type="text/babel"&gt;&lt;/script&gt;</pre>
			<p>This is so Babel knows to parse the file rather than just treating it as plain JavaScript.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Note that using Babel in this way can be slow for large projects. It is designed to be used as part of the build process in an <code>npm</code> project and to have your JSX files transpiled ahead of time (rather than in real time as we are doing here). <code>npm</code> project setup is beyond the scope of this book. For our purposes and with the small amount of JSX we are using, using Babel will be fine.</p>
			<p>JSX uses braces to include JavaScript data inside HTML, similar to Django's double braces in templates. JavaScript inside braces will be executed. We'll now look at how to convert our button creation example to JSX. Our <code>render</code> method can be changed to this:</p>
			<pre>render() {
    return &lt;button onClick={() =&gt;this.setState({ 
            clickCount: this.state.clickCount + 1 
          })
    }&gt;
    {this.state.clickCount}
&lt;/button&gt;;
  }</pre>
			<p>Note that the <code>onClick</code> attribute has no quotes around its value; instead, it is wrapped in braces. This is passing the JavaScript function that is defined inline to the component. It will be available in that component's <code>props</code> dictionary that is passed to the <code>constructor</code> method. For example, imagine that we had passed it like this:</p>
			<pre>onClick="() =&gt;this.setState…"</pre>
			<p>In such a case, it would be passed to the component as a string value and thus would not work.</p>
			<p>We are also rendering the current value of <code>clickCount</code> as the content of the <code>button</code>. JavaScript could be executed inside these braces too. To show the click count plus one, we could do this:</p>
			<pre>{this.state.clickCount + 1}</pre>
			<p>In the next exercise, we will include Babel in our template and then convert our component to use JSX.</p>
			<h2 id="_idParaDest-449">Exercise 16.<a id="_idTextAnchor481"/>02: JSX and Babel</h2>
			<p>In this exercise, we want to implement JSX in our component to simplify our code. To do this, we need to make a couple of changes to the <code>react-example.js</code> file and <code>react-example.html</code> file to switch to JSX to render <code>ClickCounter</code>:</p>
			<ol>
				<li value="1">In PyCharm, open <code>react-example.js</code> and change the <code>render</code> method to use JSX instead, by replacing it with the following code. You can refer to <em class="italic">step 2</em> from <em class="italic">Exercise 16.01</em>, <em class="italic">Setting Up a React Example</em>, where we defined this method:<pre>render() {
return &lt;button onClick={() =&gt; this.setState({ 
       clickCount: this.state.clickCount + 1 
       })
    }&gt;
    {this.state.clickCount}
&lt;/button&gt;;  }</pre></li>
				<li>We can now treat <code>ClickCounter</code> as an element itself. In the <code>ReactDOM.render</code> call at the end of the file, you can replace the first argument, <code>e(ClickCounter)</code>, with a <code>&lt;ClickCounter/&gt;</code> element, like this:<pre>ReactDOM.render(&lt;ClickCounter/&gt;, document.getElementById   ('react_container'));</pre></li>
				<li>Since we're no longer using the <code>React.create</code> function that we created in <em class="italic">step 2</em> of <em class="italic">Exercise 16.01</em>, <em class="italic">Setting Up a React Example</em>, we can remove the alias we created; delete the first line:<pre>const e = React.createElement;</pre><p>You can save and close the file.</p></li>
				<li>Open the <code>react-example.html</code> template. You need to include the Babel library JavaScript. Add this code between the React <code>script</code> elements and the <code>react-example.js</code> element:<pre>&lt;script crossorigin src="img/babel.min.js"&gt;&lt;/script&gt;</pre></li>
				<li>Add a <code>type="text/babel"</code> attribute to the <code>react-example.html</code> <code>&lt;script&gt;</code> tag:<pre>&lt;script src="img/{% static 'react-example.js' %}" type="text/babel"&gt;&lt;/script&gt;</pre><p>Save <code>react-example.html</code>.</p></li>
				<li>Start the Django dev server if it is not already running and go to <code>http://127.0.0.1:8000/react-example/</code>. You should see the same button as we had before (<em class="italic">Figure 16.12</em>). When clicking the button, you should see the count increment as well.</li>
			</ol>
			<p>In this exercise, we did not change the behavior of the <code>ClickCounter</code> React component. Instead, we refactored it to use JSX. This makes it easier to write the component's output directly as HTML and cut down on the amount of code we need to write. In the next section, we will look at passing properties to a JSX React component.</p>
			<h2 id="_idParaDest-450">JSX Properti<a id="_idTextAnchor482"/>es</h2>
			<p>Properties on JSX-based React components are set in the same way as attributes on a standard HTML element. The important thing to remember is whether you are setting them as a string or a JavaScript value.</p>
			<p>Let's look at some examples using the <code>ClickCounter</code> component. Say that we want to extend <code>ClickCounter</code> so that a <code>target</code> number can be specified. When the target is reached, the button should be replaced with the text <code>Well done, &lt;name&gt;!</code>. These values should be passed into <code>ClickCounter</code> as properties.</p>
			<p>When using variables, we have to pass them as JSX values:</p>
			<pre>let name = 'Ben'
let target = 5;
ReactDOM.render(&lt;ClickCounter name={name} target={target}/&gt;,   document.getElementById('react_container'));</pre>
			<p>We can mix and match the method of passing the values too. This is also valid:</p>
			<pre>ReactDOM.render(&lt;ClickCounter name="Ben" target={5}/&gt;,   document.getElementById('react_container'));</pre>
			<p>In the next exercise, we will update <code>ClickCounter</code> to read these values from properties and change its behavior when the target is reached. We will pass these values in from the Django template.</p>
			<h2 id="_idParaDest-451">Exercise 16.<a id="_idTextAnchor483"/>03: React Component Properties</h2>
			<p>In this exercise, you will modify <code>ClickCounter</code> to read the values of <code>target</code> and <code>name</code> from its <code>props</code>. You will pass these in from the Django view and use the <code>escapejs</code> filter to make the <code>name</code> value safe for use in a JavaScript string. When you are finished, you will be able to click on the button until it reaches a target, and then see a <code>Well done</code> message:</p>
			<ol>
				<li value="1">In PyCharm, open the <code>reviews</code> app's <code>views.py</code>. We will modify the <code>react_example</code> view's <code>render</code> call to pass through a context containing <code>name</code> and <code>target</code>, like this:<pre>return render(request, "react-example.html", {"name": "Ben", \
                                              "target": 5})</pre><p>You can use your own name and pick a different target value if you like. Save <code>views.py</code>.</p></li>
				<li>Open the <code>react-example.js</code> file. We will update the <code>state</code> setting in the <code>constructor</code> method to set the name and target from <code>props</code>, like this:<pre>constructor(props) {
    super(props);
    this.state = { clickCount: 0, name: props.name, target:       props.target
    };
}</pre></li>
				<li>Change the behavior of the <code>render</code> method to return <code>Well done, &lt;name&gt;!</code> once <code>target</code> has been reached. Add this <code>if</code> statement inside the <code>render</code> method:<pre>if (this.state.clickCount === this.state.target) {
    return &lt;span&gt;Well done, {this.state.name}!&lt;/span&gt;;
}</pre></li>
				<li>To pass the values in, move the <code>ReactDOM.render</code> call into the template so that Django can render that piece of code. Cut this <code>ReactDOM.render</code> line from the end of <code>react-example.js</code>:<pre>ReactDOM.render(&lt;ClickCounter/&gt;, document.getElementById   ('react_container'));</pre><p>We will paste it into the template file in <em class="italic">step 6</em>. <code>react-example.js</code> should now only contain the <code>ClickCounter</code> class. Save and close the file.</p></li>
				<li>Open <code>react-example.html</code>. After all the existing <code>&lt;script&gt;</code> tags (but before the closing <code>&lt;/body&gt;</code> tag), add opening and closing <code>&lt;script&gt;</code> tags with the <code>type="text/babel"</code> attribute. Inside them, we need to assign the Django context values that were passed to the template to JavaScript variables. Altogether, you should be adding this code:<pre>&lt;script type="text/babel"&gt;
let name = "{{ name|escapejs }}";
let target = {{ target }};
&lt;/script&gt;</pre><p>The first assigns the <code>name</code> variable with the <code>name</code> context variable. We use the <code>escapejs</code> template filter; otherwise, we could generate invalid JavaScript code if our name had a double quote in it. The second value, <code>target</code>, is assigned from <code>target</code>. This is a number, so it does not need to be escaped.</p><p class="callout-heading">Note</p><p class="callout">Due to the way Django escapes the values for JavaScript, <code>name</code> cannot be passed directly to the component property like this:</p><p class="callout"><code>&lt;ClickCounter name="{{ name|escapejs }}"/&gt;</code></p><p class="callout">The JSX will not un-escape the values correctly and you will end up with escape sequences.</p><p class="callout">However, you could pass the numerical value target in like this:</p><p class="callout"><code>&lt;ClickCounter target="{ {{ target }} }"/&gt;</code></p><p class="callout">Also, be aware of the spacing between the Django braces and JSX braces. In this book, we will stick with assigning all properties to variables first, then passing them to the component, for consistency.</p></li>
				<li>Underneath these variable declarations, paste in the <code>ReactDOM.render</code> call that you copied from <code>react-example.js</code>. Then, add the <code>target={ target }</code> and <code>name={ name }</code> properties to <code>ClickCounter</code>. Remember, these are the JavaScript variables being passed in, not the Django context variables – they just happen to have the same name. The <code>&lt;script&gt;</code> block should now look like this:<pre>&lt;script type="text/babel"&gt;
    let name = "{{ name|escapejs }}";
    let target = {{ target }};
    ReactDOM.render(&lt;ClickCounter name={ name }       target={ target }/&gt;, document.getElementById         ('react_container'));
&lt;/script&gt;</pre><p>You can save <code>react-example.html</code>.</p></li>
				<li>Start the Django dev server if it is not already running, then go to <code>http://127.0.0.1:8000/react-example/</code>. Try clicking the button a few times – it should increment until you click it <code>target</code> number of times. Then, it will be replaced with the <code>Well done, &lt;name&gt;!</code> text. See <em class="italic">Figure 16.13</em> for how it should look after you've clicked it enough times:<div><img src="img/B15509_16_13.jpg" alt="Figure 16.13: Well done message&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 16.13: Well done message</p>
			<p>In this exercise, we passed data to a React component using <code>props</code>. We escaped the data when assigning it to a JavaScript variable using the <code>escapejs</code> template filter. In the next section, we will cover how to fetch data over HTTP using JavaScript.</p>
			<p class="callout-heading">Further Reading</p>
			<p class="callout">For a more detailed, hands-on course on React, you can always refer to <em class="italic">The React Workshop</em>: <a href="https://courses.packtpub.com/courses/react">https://courses.packtpub.com/courses/react</a>.</p>
			<h2 id="_idParaDest-452"><a id="_idTextAnchor484"/>JavaScript Promises</h2>
			<p>To prevent blocking on long-running operations, many JavaScript functions are implemented asynchronously. The way they work is by returning immediately, but then invoking a callback function when a result is available. The object these types of functions return is a <code>Promise</code>. Callback functions are provided to the <code>Promise</code> object by calling its <code>then</code> method. When the function finishes running, it will either <code>resolve</code> the <code>Promise</code> (call the <code>success</code> function) or <code>reject</code> it (call the <code>failure</code> function).</p>
			<p>We will illustrate the wrong and right way of using promises. Consider a hypothetical long-running function that performs a big calculation, called <code>getResult</code>. Instead of returning the result, it returns a <code>Promise</code>. You would not use it like this:</p>
			<pre>const result = getResult();
console.log(result);  // incorrect, this is a Promise</pre>
			<p>Instead, it should be invoked like this, with a callback function passed to <code>then</code> on the returned <code>Promise</code>. We will assume that <code>getResult</code> can never fail, so we only provide it with a <code>success</code> function for the resolve case:</p>
			<pre>const promise = getResult();
promise.then((result) =&gt; {
    console.log(result);  /* this is called when the Promise       resolves*/
});</pre>
			<p>Normally, you wouldn't assign the returned <code>Promise</code> to a variable. Instead, you'd chain the <code>then</code> call to the function call. We'll show this in the next example, along with a failure callback (assume <code>getResult</code> can now fail). We'll also add some comments illustrating the order in which the code executes:</p>
			<pre>getResult().then( 
(result) =&gt; {
        // success function
        console.log(result);  
// this is called 2nd, but only on success
}, 
    () =&gt; {
        // failure function
        console.log("getResult failed");
        // this is called 2nd, but only on failure
})
// this will be called 1st, before either of the callbacks
console.log("Waiting for callback");</pre>
			<p>Now that we've introduced promises, we can look at the <code>fetch</code> function, which makes HTTP requests. It is asynchronous and works by returning promises.</p>
			<h2 id="_idParaDest-453"><a id="_idTextAnchor485"/>fetch</h2>
			<p>Most br<a id="_idTextAnchor486"/>owsers (95%) support a function called <code>fetch</code>, which allows you to make HTTP requests. It uses an asynchronous callback interface with promises. </p>
			<p>The <code>fetch</code> function takes two arguments. The first is the URL to make the request to and the second is an object (dictionary) with settings for the request. For example, consider this:</p>
			<pre>const promise = fetch("http://www.google.com", {…settings});</pre>
			<p>The settings are things such as the following:</p>
			<ul>
				<li><code>method</code>: The request HTTP method (<code>GET</code>, <code>POST</code>, and more).</li>
				<li><code>headers</code>: Another object (dictionary) of HTTP headers to send.</li>
				<li><code>body</code>: The HTTP body to send (for <code>POST</code>/<code>PUT</code> requests).</li>
				<li><code>credentials</code>: By default, <code>fetch</code> does not send any cookies. This means your requests will act like you are not authenticated. To have it set cookies in its requests, this should be set to the value <code>same-origin</code> or <code>include</code>.</li>
			</ul>
			<p>Let's look at it in action with a simple request:</p>
			<pre>fetch('/api/books/', {
    method: 'GET',
    headers: {
        Accept: 'application/json'
    }
}).then((resp) =&gt; {
    console.log(resp)
})</pre>
			<p>This code will fetch from <code>/api/book-list/</code> and then call a function that logs the request to the browser's console using <code>console.log</code>.</p>
			<p><em class="italic">Figure 16.14</em> shows the console output in Firefox for the preceding response:</p>
			<div><div><img src="img/B15509_16_14.jpg" alt="Figure 16.14: Response output in the console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.14: Response output in the console</p>
			<p>As you can see, there isn't much information that is output. We need to decode the response before we can work with it. We can use the <code>json</code> method on the response object to decode the response body to a JSON object. This also returns a <code>Promise</code>, so we will ask to get the JSON, then work with the data in our callback. The full code block to do that looks like this:</p>
			<pre>fetch('/api/books/', {
    method: 'GET',
    headers: {
        Accept: 'application/json'
    }
}).then((resp) =&gt; {
    return resp.json(); // doesn't return JSON, returns a Promise
}).then((data) =&gt; {
    console.log(data);
});</pre>
			<p>This will log the decoded object that was in JSON format to the browser console. In Firefox, the output looks like <em class="italic">Figure 16.15</em>:</p>
			<div><div><img src="img/B15509_16_15.jpg" alt="Figure 16.15: Decoded book list output to console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.15: Decoded book list output to console</p>
			<p>In <em class="italic">Exercise 16.04</em>, <em class="italic">Fetching and Rendering Books</em>, we will write a new React component that will fetch a list of books and then render each one as a list item (<code>&lt;li&gt;</code>). Before that, we need to learn about the JavaScript <code>map</code> method and how to use it to build HTML in React.</p>
			<h3 id="_idParaDest-454">The JavaScript <a id="_idTextAnchor487"/>map Method</h3>
			<p>Sometimes we want to execute the same piece of code (JavaScript or JSX) multiple times for different input data. In this chapter, it will be most useful to generate JSX elements with the same HTML tags but different content. In JavaScript, the <code>map</code> method iterates over the target array and then executes a callback function for each element in the array. Each of these elements is then added to a new array, which is then returned. For example, this short snippet uses <code>map</code> to double each number in the <code>numbers</code> array:</p>
			<pre>const numbers = [1, 2, 3];
const doubled = numbers.map((n) =&gt; {
    return n * 2;
});</pre>
			<p>The <code>doubled</code> array now contains the values <code>[2, 4, 6]</code>. </p>
			<p>We can also create a list of JSX values using this method. The only thing to note is that each item in the list must have a unique <code>key</code> property set. In this next short example, we are transforming an array of numbers into <code>&lt;li&gt;</code> elements. We can then use them inside <code>&lt;ul&gt;</code>. Here is an example <code>render</code> function to do this:</p>
			<pre>render() {
    const numbers = [1, 2, 3];
    const listItems = numbers.map((n) =&gt; {
      return &lt;li key={n}&gt;{n}&lt;/li&gt;;
      });
    return &lt;ul&gt;{listItems}&lt;/ul&gt;
}</pre>
			<p>When rendered, this will generate the following HTML:</p>
			<pre>&lt;ul&gt;
&lt;li&gt;1&lt;/li&gt;
&lt;li&gt;2&lt;/li&gt;
&lt;li&gt;3&lt;/li&gt;
&lt;/ul&gt;</pre>
			<p>In the next exercise, we will build a React component with a button that will fetch the list of books from the API when it is clicked. The list of books will then be displayed.</p>
			<h2 id="_idParaDest-455">Exercise 16.04:<a id="_idTextAnchor488"/> Fetching and Rendering Books</h2>
			<p>In this exercise, you will create a new component named <code>BookDisplay</code> that renders an array of books inside <code>&lt;ul&gt;</code>. The books will be retrieved using <code>fetch</code>. To do this, we add the React component into the <code>react-example.js</code> file. Then we pass the URL of the book list to the component inside the Django template:</p>
			<ol>
				<li value="1">In PyCharm, open <code>react-example.js</code>, which you previously used in <em class="italic">step 9</em> of <em class="italic">Exercise 16.03</em>, <em class="italic">React Component Properties</em>. You can delete the entire <code>ClickCounter</code> class.</li>
				<li>Create a new class called <code>BookDisplay</code> that <code>extends</code> from <code>React.Component</code>.</li>
				<li>Then, add a <code>constructor</code> method that takes <code>props</code> as an argument. It should call <code>super(props)</code> and then set its state like this:<pre>this.state = { books: [], url: props.url, fetchInProgress:   false };</pre><p>This will initialize <code>books</code> as an empty array, read the API URL from the passed-in property <code>url</code>, and set a <code>fetchInProgress</code> flag to <code>false</code>. The code of your <code>constructor</code> method should be like this:</p><pre>constructor(props) {
  super(props);
  this.state = { books: [], url: props.url, fetchInProgress:   false };
}</pre></li>
				<li>Next, add a <code>doFetch</code> method. You can copy and paste this code to create it:<pre>doFetch() {
  if (this.state.fetchInProgress)
      return;
this.setState({ fetchInProgress: true })
  fetch(this.state.url, {
      method: 'GET',
      headers: {
          Accept: 'application/json'
      }
  }
  ).then((response) =&gt; {
      return response.json();
  }).then((data) =&gt; {
this.setState({ fetchInProgress: false, books: data })
  })
}</pre><p>First, with the <code>if</code> statement, we check if a fetch has already been started. If so, we <code>return</code> from the function. Then, we use <code>setState</code> to update the state, setting <code>fetchInProgress</code> to <code>true</code>. This will both update our button display text and stop multiple requests from being run at once. We then <code>fetch</code> the <code>this.state.url</code> (which we will pass in through the template later in the exercise). The response is retrieved with the <code>GET</code> method and we only want to <code>Accept</code> a JSON response. After we get a response, we then return its JSON using the <code>json</code> method. This returns a <code>Promise</code>, so we use another <code>then</code> to handle the callback when the JSON is parsed. In that final callback, we set the state of the component, with <code>fetchInProgress</code> going back to <code>false</code>, and the <code>books</code> array being set to the decoded JSON data.</p></li>
				<li>Next, create the <code>render</code> method. You can copy and paste this code too:<pre>render() {
  const bookListItems = this.state.books.map((book) =&gt; {
      return &lt;li key={ book.pk }&gt;{ book.title }&lt;/li&gt;;
  })
  const buttonText = this.state.fetchInProgress  ? 
  'Fetch in Progress' : 'Fetch';
  return &lt;div&gt;
&lt;ul&gt;{ bookListItems }&lt;/ul&gt;
&lt;button onClick={ () =&gt;this.doFetch() } 
        disabled={ this.state.fetchInProgress }&gt;
          {buttonText}
&lt;/button&gt;
&lt;/div&gt;;
}</pre><p>This uses the <code>map</code> method to iterate over the array of books in <code>state</code>. We generate <code>&lt;li&gt;</code> for each book, using the book's <code>pk</code> as the <code>key</code> instance for the list item. The content of <code>&lt;li&gt;</code> is the book's title. We define a <code>buttonText</code> variable to store (and update) the text that the button will display. If we currently have a <code>fetch</code> operation running, then this will be <em class="italic">Fetch in Progress</em>. Otherwise, it will be <em class="italic">Fetch</em>. Finally, we return a <code>&lt;div&gt;</code> that contains all the data we want. The content of <code>&lt;ul&gt;</code> is the <code>bookListItems</code> variable (the array of <code>&lt;li&gt;</code> instances). It also contains a <code>&lt;button&gt;</code> instance added in a similar way to in the previous exercises. The <code>onClick</code> method calls the <code>doFetch</code> method of the class. We can make the button <code>disabled</code> (that is, the user can't click the button) if there is a fetch in progress. We set the button text to the <code>buttonText</code> variable we created earlier. You can now save and close <code>react-example.js</code>.</p></li>
				<li>Open <code>react-example.html</code>. We need to replace the <code>ClickCounter</code> render (from <em class="italic">Exercise 16.03</em>, <em class="italic">React Component Properties</em>) with a <code>BookDisplay</code> render. Delete the <code>name</code> and <code>target</code> variable definitions. We will instead render the <code>&lt;BookDisplay&gt;</code>. Set the <code>url</code> property as a string and pass in the URL to the book list API, using the <code>{% url %}</code> template tag to generate it. The <code>ReactDOM.render</code> call should then look like this:<pre>ReactDOM.render(&lt;BookDisplay url="{% url 'api:book-list' %}" /&gt;,  document.getElementById('react_container'));</pre><p>You can now save and close <code>react-example.html</code>.</p></li>
				<li>Start the Django dev server if it's not already running, then visit <code>http://127.0.0.1:8000/react-example/</code>. You should see a single <code>Fetch</code> button on the page (<em class="italic">Figure 16.16</em>):<div><img src="img/B15509_16_16.jpg" alt="Figure 16.16: Book Fetch button&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 16.16: Book Fetch button</p>
			<p>After clicking the <code>Fetch</code> button, it should become disabled and have its text changed to <code>Fetch in Progress</code>, as we can see here:</p>
			<div><div><img src="img/B15509_16_17.jpg" alt="Figure 16.17: Fetch in Progress&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.17: Fetch in Progress</p>
			<p>Once the fetch is complete, you should see the list of books rendered as follows:</p>
			<div><div><img src="img/B15509_16_18.jpg" alt="Figure 16.18: Book fetch complete&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.18: Book fetch complete</p>
			<p>This exercise was a chance to integrate React with the Django REST API you built in <em class="italic">Chapter 12</em>, <em class="italic">Building a REST API</em>. We built a new component (<code>BookDisplay</code>) with a call to <code>fetch</code> to get a list of books. We used the JavaScript <code>map</code> method to transform the book array to some <code>&lt;li&gt;</code> elements. As we had seen before, we used <code>button</code> to trigger <code>fetch</code> when it was clicked. We then provided the book list API URL to the React component in the Django template. Later, we saw a list of books in Bookr that were loaded dynamically using the REST API.</p>
			<p>Before we move onto the activity for this chapter, we will talk about some considerations for other JavaScript frameworks when working with Django.</p>
			<h2 id="_idParaDest-456">The verbatim Templ<a id="_idTextAnchor489"/>ate Tag</h2>
			<p>We have seen that when using React, we can use JSX interpolation values in Django templates. This is because JSX uses single braces to interpolate values, and Django uses double braces. As long as there are spaces between the JSX and Django braces, it should work fine.</p>
			<p>Other frameworks, such as Vue, also use double braces for variable interpolation. What that means is if you had a Vue component's HTML in your template, you might try to interpolate a value like this:</p>
			<pre>&lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;</pre>
			<p>Of course, when Django renders the template, it will interpolate the <code>name</code> value before the Vue framework gets a chance to render.</p>
			<p>We can use the <code>verbatim</code> template tag to have Django output the data exactly as it appears in the template, without performing any rendering or variable interpolation. Using it with the previous example is simple:</p>
			<pre>{% verbatim %}
&lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;
{% endverbatim %}</pre>
			<p>Now when Django renders the template, the HTML between the template tags will be output exactly as it is written, allowing Vue (or another framework) to take over and interpolate the variables itself. Many other frameworks separate their templates into their own files, which should not conflict with Django's templates. </p>
			<p>There are many JavaScript frameworks available, and which one you ultimately decide to use will depend on your own opinion or what your company/team uses. If you do run into conflicts, the solution will depend on your particular framework. The examples in this section should help lead you in the right direction.</p>
			<p>We have now covered most things you will need to integrate React (or other JavaScript frameworks) with Django. In the next activity, you will implement these learnings to fetch the most recent reviews on Bookr.</p>
			<h2 id="_idParaDest-457">Activity 16.01: Re<a id="_idTextAnchor490"/>views Preview</h2>
			<p>In this activity, we will update the Bookr main page to fetch the six most recent reviews and display them. The user will be able to click buttons to go forward to the next six reviews, and then back to the previous ones.</p>
			<p>These steps will help you complete the activity:</p>
			<ol>
				<li value="1">First, we can clean up some code from previous exercises. You can take backups of these files to preserve them for later reference if you like. Alternatively, you can use the GitHub versions too, for future reference. Delete the <code>react_example</code> view, <code>react-example</code> URL, <code>react-example.html</code> template, and <code>react-example.js</code> file.</li>
				<li>Create a <code>recent-reviews.js</code> static file.</li>
				<li>Create two components, a <code>ReviewDisplay</code> component that displays the data for a single review, and a <code>RecentReviews</code> component that handles fetching the review data and displaying a list of <code>ReviewDisplay</code> components.<p>First, create the <code>ReviewDisplay</code> class. In its constructor, you should read the <code>review</code> being passed in through the <code>props</code> and assign it to the state.</p></li>
				<li>The <code>render</code> method of <code>ReviewDisplay</code> should return JSX HTML like this:<pre>&lt;div className="col mb-4"&gt;
&lt;div className="card"&gt;
&lt;div className="card-body"&gt;
&lt;h5 className="card-title"&gt;{ BOOK_TITLE }
&lt;strong&gt;({ REVIEW_RATING })&lt;/strong&gt;
&lt;/h5&gt;
&lt;h6 className="card-subtitle mb-2 text-muted"&gt;CREATOR_EMAIL&lt;/h6&gt;
&lt;p className="card-text"&gt;REVIEW_CONTENT&lt;/p&gt;
&lt;/div&gt;
&lt;div className="card-footer"&gt;
&lt;a href={'/books/' + BOOK_ID` + '/' } className="card-link"&gt;  View Book&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</pre><p>However, you should replace the <code>BOOK_TITLE</code>, <code>REVIEW_RATING</code>, <code>CREATOR_EMAIL</code>, <code>REVIEW_CONTENT</code>, and <code>BOOK_ID</code> placeholders with their proper values from the <code>review</code> that the component has fetched.</p><p class="callout-heading">Note</p><p class="callout">Note that when working with JSX and React, the <code>class</code> of an element is set with the <code>className</code> attribute, not <code>class</code>. When it's rendered as HTML, it becomes <code>class</code>.</p></li>
				<li>Create another React component called <code>RecentReviews</code>. Its <code>constructor</code> method should set up the <code>state</code> with the following keys/values:<p><code>reviews</code>: <code>[]</code> (empty list)</p><p><code>currentUrl</code>: <code>props.url</code></p><p><code>nextUrl</code>: <code>null</code></p><p><code>previousUrl</code>: <code>null</code></p><p><code>loading</code>: <code>false</code></p></li>
				<li>Implement a method to download the reviews from the REST API. Call it <code>fetchReviews</code>. It should return immediately if <code>state.loading</code> is <code>true</code>. Then, it should set the <code>loading</code> property of <code>state</code> to <code>true</code>.</li>
				<li>Implement <code>fetch</code> in the same way as you did in <em class="italic">Exercise 16.04</em>, <em class="italic">Fetching and Rendering Books</em>. It should follow the same pattern of requesting <code>state.currentUrl</code> and then getting the JSON data from the response. Then, set the following values in <code>state</code>:<p><code>loading</code>: <code>false</code></p><p><code>reviews</code>: <code>data.results</code></p><p><code>nextUrl</code>: <code>data.next</code></p><p><code>previousUrl</code>: <code>data.previous</code></p></li>
				<li>Implement a <code>componentDidMount</code> method. This is a method that is called when React has loaded the component onto the page. It should call the <code>fetchReviews</code> method.</li>
				<li>Create a <code>loadNext</code> method. If the <code>nextUrl</code> in <code>state</code> is null, it should return immediately. Otherwise, it should set <code>state.currentUrl</code> to <code>state.nextUrl</code>, then call <code>fetchReviews</code>.</li>
				<li>Similarly, create a <code>loadPrevious</code> method; however, this should set <code>state.currentUrl</code> to <code>state.previousUrl</code>.</li>
				<li>Implement the render method. If the state is loading, then it should return the text <code>Loading…</code> inside an <code>&lt;h5&gt;</code> element.</li>
				<li>Create two variables to store the <code>previousButton</code> and <code>nextButton</code> HTML. They both should have the <code>btn btn-secondary</code> class and the next button should also have the <code>float-right</code> class. They should have <code>onClick</code> attributes set to call the <code>loadPrevious</code> or <code>loadNext</code> methods. They should have their <code>disabled</code> attributes set to <code>true</code> if the respective <code>previousUrl</code> or <code>nextUrl</code> attributes are <code>null</code>. The button text should be <em class="italic">Previous</em> or <em class="italic">Next</em>.</li>
				<li>Iterate over the reviews using the <code>map</code> method and store the result to a variable. Each <code>review</code> should be represented by a <code>ReviewDisplay</code> component with the attribute <code>key</code> set to the review's <code>pk</code> and <code>review</code> set to the <code>Review</code> class. If there are no reviews (<code>reviews.length === 0</code>), then the variable instead should be an <code>&lt;h5&gt;</code> element with the content <em class="italic">No reviews to display</em>.</li>
				<li>Finally, return all the content wrapped in <code>&lt;div&gt;</code> elements, like this:<pre>&lt;div&gt;
&lt;div className="row row-cols-1 row-cols-sm-2 row-cols-md-3"&gt;
      { reviewItems }
&lt;/div&gt;
&lt;div&gt;
      {previousButton}
      {nextButton}
&lt;/div&gt;
&lt;/div&gt;</pre><p>The <code>className</code> we are using here will display each review preview in one, two, or three columns depending on the screen size.</p></li>
				<li>Next, edit <code>base.html</code>. You will add all the new content inside the <code>content</code> block so that it will not be displayed on the non-main pages that override this block. Add an <code>&lt;h4&gt;</code> element with the content <code>Recent Reviews</code>.</li>
				<li>Add a <code>&lt;div&gt;</code> element for React to render into. Make sure you give it a unique <code>id</code>.</li>
				<li>Include the <code>&lt;script&gt;</code> tags to include React, React DOM, Babel, and the <code>recent-reviews.js</code> file. These four tags should be similar to what you had in <em class="italic">Exercise 16.04</em>, <em class="italic">Fetching and Rendering Books</em>.</li>
				<li>The last thing to add is another <code>&lt;script&gt;</code> tag containing the <code>ReactDOM.render</code> call code. The root component being rendered is <code>RecentReviews</code>. It should have a <code>url</code> attribute set to the value <code>url="{% url 'api:review-list' %}?limit=6"</code>. This does a URL lookup for <code>ReviewViewSet</code> and then appends a page size argument of <code>6</code>, limiting the number of reviews that are retrieved to a maximum of <code>6</code>.</li>
			</ol>
			<p>Once you have completed these steps, you should be able to navigate to <code>http://127.0.0.1:8000/</code> (the main Bookr page) and see a page like this:</p>
			<div><div><img src="img/B15509_16_19.jpg" alt="Figure 16.19: Completed reviews preview&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.19: Completed reviews preview</p>
			<p>In the screenshot, the page has been scrolled to show the <code>Previous</code>/<code>Next</code> buttons. Notice the <code>Previous</code> button is disabled because we are on the first page.</p>
			<p>If you click <code>Next</code>, you should see the next page of reviews. If you click <code>Next</code> enough times (depending on how many reviews you have), you will eventually reach the last page and then the <code>Next</code> button will be disabled:</p>
			<div><div><img src="img/B15509_16_20.jpg" alt="Figure 16.20: Next button disabled&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.20: Next button disabled</p>
			<p>If you have no reviews, then you should see the message <code>No reviews to display</code>:</p>
			<div><div><img src="img/B15509_16_21.jpg" alt="Figure 16.21: No reviews to display. text&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.21: No reviews to display. text</p>
			<p>While the page is loading the reviews, you should see the text <code>Loading…</code>; however, it will probably only display for a split second since the data is being loaded off your own computer:</p>
			<div><div><img src="img/B15509_16_22.jpg" alt="Figure 16.22: Loading text&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.22: Loading text</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h1 id="_idParaDest-458"><a id="_idTextAnchor491"/>Summary</h1>
			<p>In this chapter, we introduced JavaScript frameworks and described how they work with Django to enhance templates and add interactivity. We introduced the JavaScript language and covered some of its main features, variable types, and classes. We then introduced the concepts behind React and how it builds HTML by using components. We built a React component using just JavaScript and the <code>React.createElement</code> function. After that, we introduced JSX and saw how it made the development of components easier, by letting you directly write HTML in your React components. The concepts of <code>promises</code> and the <code>fetch</code> function were introduced, and we saw how to get data from a REST API using <code>fetch</code>. The chapter finished with an exercise that retrieved reviews from Bookr using the REST API and rendered them to the page in an interactive component.</p>
			<p>In the next chapter, we will look at how to deploy our Django project to a production web server. You can download the chapter from the GitHub repository for this book at <a href="http://packt.live/2Kx6FmR">http://packt.live/2Kx6FmR</a>.</p>
		</div>
	</body></html>