<html><head></head><body>
		<div>
			<div id="_idContainer446" class="Content">
			</div>
		</div>
		<div id="_idContainer447" class="Content">
			<h1 id="_idParaDest-441"><a id="_idTextAnchor471"/>16. Using a Frontend JavaScript Library with Django</h1>
		</div>
		<div id="_idContainer470" class="Content">
			<p class="callout-heading">Overview</p>
			<p class="callout">This chapter introduces the basics of JavaScript and ends with building an interactive web frontend for Bookr using the React JavaScript framework. You will learn how to include the React JavaScript framework in a Django template, and how to build React components. This chapter also includes an introduction to <strong class="bold">JSX</strong>, a special format that combines JavaScript code and HTML – you will also learn how <strong class="bold">Babel</strong> transpiles JSX into plain JavaScript. Later, you will learn about the <strong class="source-inline">fetch</strong> JavaScript function which is used to retrieve information from a REST API. Toward the end of the chapter, you will be introduced to the Django <strong class="source-inline">{% verbatim %}</strong> template tag, which is used to include unparsed data in a Django template.</p>
			<h1 id="_idParaDest-442"><a id="_idTextAnchor472"/>Introduction</h1>
			<p>Django is a great tool for building the backend of an application. You have seen how easy it is to set up the database, route URLs, and render templates. Without using JavaScript, though, when those pages are rendered to the browser, they are static and do not provide any form of interaction. By using JavaScript, your pages can be transformed into applications that are fully interactive in the browser.</p>
			<p>This chapter will be a brief introduction to JavaScript frameworks and how to use them with Django. While it won't be a deep dive into how to build an entire JavaScript application from scratch (that would be a book in itself), we will give enough of an introduction so that you can add interactive components to your own Django application. In this chapter, we will primarily be working with the React framework. Even if you do not have any JavaScript experience, we will introduce enough about it so that, by the end of this chapter, you will be comfortable writing your own React components. In <em class="italic">Chapter 12</em>, <em class="italic">Building a REST API</em>, you built a REST API for Bookr. We will interact with that API using JavaScript to retrieve data. We will enhance Bookr by showing some review previews on the main page that are dynamically loaded and can be paged through.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The code for the exercises and activities in this chapter can be found in this book's GitHub repository at <a href="http://packt.live/3iasIMl">http://packt.live/3iasIMl</a>.</p>
			<h1 id="_idParaDest-443"><a id="_idTextAnchor473"/>JavaScript Frameworks</h1>
			<p>These days, real-time interactivity is a fundamental part of web applications. While simple interactions can be added without a framework (developing without a framework is often called <em class="italic">Vanilla JS</em>), as your web application grows, it can be much easier to manage with the use of a framework. Without a framework, you would need to do all these things yourself:</p>
			<ul>
				<li>Manually define the database schema.</li>
				<li>Convert data from HTTP requests into native objects.</li>
				<li>Write form validation.</li>
				<li>Write SQL queries to save data.</li>
				<li>Construct HTML to show a response.</li>
			</ul>
			<p>Compare this to what Django provides. Its <strong class="bold">ORM</strong> (<strong class="bold">Object Relational Mapping</strong>), automatic form parsing and validation, and templating drastically cut down on the amount of code you need to write. JavaScript frameworks bring similar time-saving enhancements to JavaScript development. Without them, you would have to manually update the HTML elements in the browser as your data changes. Let's take a simple example: showing the count of the number of times a button has been clicked. Without a framework, you would have to do the following:</p>
			<ol>
				<li>Assign a handler to the button click event.</li>
				<li>Increment the variable that stored the count.</li>
				<li>Locate the element containing the click count display.</li>
				<li>Replace the element's text with the new click count.</li>
			</ol>
			<p>When using a framework, the button count variable is bound to the display (HTML), so the process you have to code is as follows: </p>
			<ol>
				<li value="1">Handle the button click.</li>
				<li>Increment the variable.</li>
			</ol>
			<p>The framework takes care of automatically re-rendering the number display. This is just a simple example, though; as your application grows, the disparity in complexity between the two approaches expands. There are several JavaScript frameworks available, each with different features and some supported and used by large companies. Some of the most popular are React (<a href="https://reactjs.org">https://reactjs.org</a>), Vue (<a href="http://vuejs.org">http://vuejs.org</a>), Angular (<a href="https://angularjs.org">https://angularjs.org</a>), Ember (<a href="https://emberjs.com">https://emberjs.com</a>), and Backbone.js (<a href="https://backbonejs.org">https://backbonejs.org</a>).</p>
			<p>In this chapter, we will be using React, as it is easy to drop into an existing web application and allows <em class="italic">progressive enhancement</em>. This means that rather than having to build your application from scratch, targeting React, you can simply apply it to certain parts of the HTML that Django generates; for example, a single text field that automatically interprets Markdown and shows the result without reloading the page. We will also cover some of the features that Django offers that can help integrate several JavaScript frameworks.</p>
			<p>There are several different levels that JavaScript can be incorporated into a web application at. <em class="italic">Figure 16.1</em> shows our current stack, with no JavaScript (note that the following diagrams do not show requests to the server):</p>
			<div>
				<div id="_idContainer448" class="IMG---Figure">
					<img src="image/B15509_16_01.jpg" alt="Figure 16.1: Current stack&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.1: Current stack</p>
			<p>You can base your entire application on JavaScript using <strong class="bold">Node.js</strong> (a server-side JavaScript interpreter), which would take the place of Python and Django in the stack. <em class="italic">Figure 16.2</em> shows how this might look:</p>
			<div>
				<div id="_idContainer449" class="IMG---Figure">
					<img src="image/B15509_16_02.jpg" alt="Figure 16.2: Using Node.js to generate HTML&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.2: Using Node.js to generate HTML</p>
			<p>Or, you can have your frontend and templates entirely in JavaScript, and just use Django to act as a REST API to provide data to render. <em class="italic">Figure 16.3</em> shows this stack:</p>
			<div>
				<div id="_idContainer450" class="IMG---Figure">
					<img src="image/B15509_16_03.jpg" alt="Figure 16.3: Sending JSON from Django and rendering it in the browser&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.3: Sending JSON from Django and rendering it in the browser</p>
			<p>The final approach is progressive enhancement, which is (as mentioned) what we will be using. In this way, Django is still generating the HTML templates and React sits on top of this to add interactivity:</p>
			<div>
				<div id="_idContainer451" class="IMG---Figure">
					<img src="image/B15509_16_04.jpg" alt="Figure 16.4: HTML generated with Django with React providing progressive enhancement&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.4: HTML generated with Django with React providing progressive enhancement</p>
			<p>Note that it is common to use multiple techniques together. For example, Django may generate the initial HTML to which React is applied in the browser. The browser can then query Django for JSON data to be rendered, using React.</p>
			<h1 id="_idParaDest-444">Java<a id="_idTextAnchor474"/>Script Introduction</h1>
			<p>In this section, we will briefly introduce some basic JavaScript concepts, such as variables and functions. Different operators will be covered as we introduce them.</p>
			<p><strong class="bold">Loading JavaScript</strong></p>
			<p>JavaScript can either be inline in an HTML page or included from a separate JavaScript file. Both methods use the <strong class="source-inline">&lt;script&gt;</strong> tag. With inline JavaScript, the JavaScript code is written directly inside the <strong class="source-inline">&lt;script&gt;</strong> tags in an HTML file; for example, like this:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">    // comments in JavaScript can start with //</p>
			<p class="source-code">    /* Block comments are also supported. This comment is multiple</p>
			<p class="source-code">      lines and doesn't end until we use a star then slash:</p>
			<p class="source-code">    */</p>
			<p class="source-code">    let a = 5; // declare the variable a, and set its value to 5</p>
			<p class="source-code">    console.log(a); // print a (5) to the browser console</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>Note that the <strong class="source-inline">console.log</strong> function prints out data to the browser console that is visible in the developer tools of your browser:</p>
			<div>
				<div id="_idContainer452" class="IMG---Figure">
					<img src="image/B15509_16_05.jpg" alt="Figure 16.5: The result of the console.log(a) call – 5 is printed to the browser console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.5: The result of the console.log(a) call – 5 is printed to the browser console</p>
			<p>We could also put the code into its own file (we would not include the <strong class="source-inline">&lt;script&gt;</strong> tags in the standalone file). We then load it into the page using the <strong class="source-inline">&lt;script&gt;</strong> tag's <strong class="source-inline">src</strong> attribute, as we saw in <em class="italic">Chapter 5</em>, <em class="italic">Serving Static Files</em>:</p>
			<p class="source-code">&lt;script src="{% static 'file.js' }"&gt;&lt;/script&gt;</p>
			<p>The source code, whether inline or included, will be executed as soon as the browser loads the <strong class="source-inline">&lt;script&gt;</strong> tag.</p>
			<p><strong class="bold">Variables and Constants</strong></p>
			<p>Unlike in Python, variables in JavaScript must be declared, using either the <strong class="source-inline">var</strong>, <strong class="source-inline">let</strong>, or <strong class="source-inline">const</strong> keyword:</p>
			<p class="source-code">var a = 1; // variable a has the numeric value 1</p>
			<p class="source-code">let b = 'a'; // variable b has the string value 'a'</p>
			<p class="source-code">const pi = 3.14; // assigned as a constant and can't be redefined</p>
			<p>Just like in Python, though, a type for a variable does not need to be declared. You will notice that the lines end with semicolons. JavaScript does not require lines to be terminated with semicolons – they are optional. However, some style guides enforce their use. You should try to stick with a single convention for any project.</p>
			<p>You should use the <strong class="source-inline">let</strong> keyword to declare a variable. Variable declarations are scoped. For example, a variable declared with <strong class="source-inline">let</strong> inside a <strong class="source-inline">for</strong> loop will not be defined outside the loop. In this example, we'll loop through and sum the multiples of 10 till 90, and then print the result to <strong class="source-inline">console.log</strong>. You'll notice we can access variables declared at the function level inside the <strong class="source-inline">for</strong> loop, but not the other way around:</p>
			<p class="source-code">let total = 0;</p>
			<p class="source-code">for (let i = 0; i&lt; 10; i++){  // variable i is scoped to the loop</p>
			<p class="source-code">    let toAdd = i * 10;  // variable toAdd is also scoped</p>
			<p class="source-code">    total += toAdd;  // we can access total since it's in the outer scope</p>
			<p class="source-code">}</p>
			<p class="source-code">console.log(total);  // prints 450</p>
			<p class="source-code">console.log(toAdd);  /* throws an exception as the variable is not   declared in the outer scope */</p>
			<p class="source-code">console.log(i);  /* this code is not executed since an exception was   thrown the line before, but it would also generate the same     exception */</p>
			<p><strong class="source-inline">const</strong> is for constant data and cannot be redefined. That does not mean that the object it points to cannot be changed, though. For example, you couldn't do this:</p>
			<p class="source-code">const pi = 3.1416;</p>
			<p class="source-code">pi = 3.1;  /* raises exception since const values can't be   reassigned */</p>
			<p>The <strong class="source-inline">var</strong> keyword is required by older browsers that don't support <strong class="source-inline">let</strong> or <strong class="source-inline">const</strong>. Only 1% of browsers these days don't support those keywords, so throughout the rest of the chapter, we will only use <strong class="source-inline">let</strong> or <strong class="source-inline">const</strong>. Like <strong class="source-inline">let</strong>, variables declared with <strong class="source-inline">var</strong> can be reassigned; however, they are scoped at the function level only.</p>
			<p>JavaScript supports several different types of variables, including strings, arrays, objects (which are like dictionaries), and numbers. We will cover arrays and objects in their own sections now.</p>
			<p><strong class="bold">Arrays</strong></p>
			<p>Arrays are defined similarly to how they are in Python, with square brackets. They can contain different types of data, just like with Python:</p>
			<p class="source-code">const myThings = [1, 'foo', 4.5];</p>
			<p>Another thing to remember with the use of <strong class="source-inline">const</strong> is that it prevents reassigning the constant but does not prevent changing the variable or object being pointed to. For example, we would not be allowed to do this:</p>
			<p class="source-code">myThings = [1, 'foo', 4.5, 'another value'];</p>
			<p>However, you could update the contents of the <strong class="source-inline">myThings</strong> array by using the <strong class="source-inline">push</strong> method (like Python's <strong class="source-inline">list.append</strong>) to append a new item:</p>
			<p class="source-code">myThings.push('another value');</p>
			<p><strong class="bold">Objects</strong></p>
			<p>JavaScript objects are like Python dictionaries, providing a key-value store. The syntax to declare them is similar as well:</p>
			<p class="source-code">const o = {foo: 'bar', baz: 4};</p>
			<p>Note that, unlike Python, JavaScript object/dictionary keys do not need to be quoted when creating them – unless they contain special characters (spaces, dashes, dots, and more). </p>
			<p>The values from <strong class="source-inline">o</strong> can be accessed either with item access or attribute access:</p>
			<p class="source-code">o.foo; // 'bar'</p>
			<p class="source-code">o['baz']; // 4</p>
			<p>Also note that since <strong class="source-inline">o</strong> was declared as a constant, we cannot reassign it, but we can alter the object's attributes:</p>
			<p class="source-code">o.anotherKey = 'another value'  // this is allowed</p>
			<p><strong class="bold">Functions</strong></p>
			<p>There are a few different ways to define functions in JavaScript. We will look at three. You can define them using the <strong class="source-inline">function</strong> keyword:</p>
			<p class="source-code">function myFunc(a, b, c) {</p>
			<p class="source-code">  if (a == b)</p>
			<p class="source-code">    return c;</p>
			<p class="source-code">  else if (a &gt; b)</p>
			<p class="source-code">    return 0;</p>
			<p class="source-code">  return 1;</p>
			<p class="source-code">}</p>
			<p>All arguments to a function are optional in JavaScript; that is, you could call the preceding function like this: <strong class="source-inline">myFunc()</strong>, and no error would be raised (at least during call time). The <strong class="source-inline">a</strong>, <strong class="source-inline">b</strong>, and <strong class="source-inline">c</strong> variables would all be the special type <strong class="source-inline">undefined</strong>. This would cause issues in the logic of the function. <strong class="source-inline">undefined</strong> is kind of like <strong class="source-inline">None</strong> in Python – although JavaScript also has <strong class="source-inline">null</strong>, which is more similar to <strong class="source-inline">None</strong>. Functions can also be defined by assigning them to a variable (or constant):</p>
			<p class="source-code">const myFunc = function(a, b, c) {</p>
			<p class="source-code">    // function body is implemented the same as above</p>
			<p class="source-code">}</p>
			<p>We can also define functions using an arrow syntax. For example, we can also define <strong class="source-inline">myFunc</strong> like this:</p>
			<p class="source-code">const myFunc = (a, b, c) =&gt; {</p>
			<p class="source-code">    // function body as above</p>
			<p class="source-code">}</p>
			<p>This is more common when defining functions as part of an object, for example:</p>
			<p class="source-code">const o = {</p>
			<p class="source-code">myFunc: (a, b, c) =&gt; {</p>
			<p class="source-code">    // function body</p>
			<p class="source-code">    }</p>
			<p class="source-code">}</p>
			<p>In this case, it would be called like this: </p>
			<p class="source-code">o.myFunc(3, 4, 5);</p>
			<p>We will return to the reasons for using arrow functions after introducing classes.</p>
			<p><strong class="bold">Classes and Methods</strong></p>
			<p>Classes are defined with the <strong class="source-inline">class</strong> keyword. Inside a <strong class="source-inline">class</strong> definition, methods are defined without the <strong class="source-inline">function</strong> keyword. The JavaScript interpreter can recognize the syntax and tell that it is a method. Here is an example class, which takes a number to add (through <strong class="source-inline">toAdd</strong>) when instantiated. That number will be added to whatever is passed to the <strong class="source-inline">add</strong> method, and the result returned:</p>
			<p class="source-code">class Adder {</p>
			<p class="source-code">    // A class to add a certain value to any number</p>
			<p class="source-code">    // this is like Python's __init__ method</p>
			<p class="source-code">    constructor (toAdd) {</p>
			<p class="source-code">        //"this" is like "self" in Python</p>
			<p class="source-code">        //it's implicit and not manually passed into every method</p>
			<p class="source-code">        this.toAdd = toAdd;</p>
			<p class="source-code">    }</p>
			<p class="source-code">    add (n) {</p>
			<p class="source-code">        // add our instance's value to the passed in number</p>
			<p class="source-code">        return this.toAdd + n;</p>
			<p class="source-code">    }</p>
			<p class="source-code">}</p>
			<p>Classes are instantiated with the <strong class="source-inline">new</strong> keyword. Other than that, their usage is very similar to classes in Python:</p>
			<p class="source-code">const a = new Adder(5);</p>
			<p class="source-code">console.log(a.add(3)); // prints "8"</p>
			<p><strong class="bold">Arrow Functions</strong></p>
			<p>Now that we've introduced the <strong class="source-inline">this</strong> keyword, we can return to the purpose of arrow functions. Not only are they shorter to write, but they also preserve the context of <strong class="source-inline">this</strong>. Unlike <strong class="source-inline">self</strong> in Python, which always refers to a specific object because it is passed into methods, the object that <strong class="source-inline">this</strong> refers to can change based on context. Usually, it is due to the nesting of functions, which is common in JavaScript. </p>
			<p>Let's look at two examples. First, an object with a function called <strong class="source-inline">outer</strong>. This <strong class="source-inline">outer</strong> function contains an <strong class="source-inline">inner</strong> function. We refer to <strong class="source-inline">this</strong> in both the <strong class="source-inline">inner</strong> and <strong class="source-inline">outer</strong> functions:</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The next code example refers to the <strong class="source-inline">window</strong> object. In JavaScript, <strong class="source-inline">window</strong> is a special global variable that exists in each browser tab and represents information about that tab. It is an instance of the <strong class="source-inline">window</strong> class. Some examples of the attributes <strong class="source-inline">window</strong> has are <strong class="source-inline">document</strong> (which stores the current HTML document), <strong class="source-inline">location</strong> (which is the current location shown in the tab's address bar), and <strong class="source-inline">outerWidth</strong> and <strong class="source-inline">outerHeight</strong> (which represent the width and height of the browser window respectively). For example, to print the current tab's location to the browser console, you would write <strong class="source-inline">console.log(window.location)</strong>.</p>
			<p class="source-code">const o1 = {</p>
			<p class="source-code">    outer: function() {</p>
			<p class="source-code">        console.log(this);  // "this" refers to o1</p>
			<p class="source-code">        const inner = function() {</p>
			<p class="source-code">            console.log(this);  // "this" refers to the "window"               object</p>
			<p class="source-code">        }</p>
			<p class="source-code">        inner();</p>
			<p class="source-code">    }</p>
			<p class="source-code">}</p>
			<p>Inside the <strong class="source-inline">outer</strong> function, <strong class="source-inline">this</strong> refers to <strong class="source-inline">o1</strong> itself, whereas inside the <strong class="source-inline">inner</strong> function, <strong class="source-inline">this</strong> refers to the window (an object that contains information about the browser window).</p>
			<p>Compare this to defining the inner function using arrow syntax:</p>
			<p class="source-code">const o2 = {</p>
			<p class="source-code">    outer: function() {</p>
			<p class="source-code">        console.log(this);  // refers to o2</p>
			<p class="source-code">        const inner = () =&gt; {</p>
			<p class="source-code">            console.log(this);  // also refers to o2</p>
			<p class="source-code">        }</p>
			<p class="source-code">        inner();</p>
			<p class="source-code">    }</p>
			<p class="source-code">}</p>
			<p>When we use arrow syntax, <strong class="source-inline">this</strong> is consistent and refers to <strong class="source-inline">o2</strong> in both cases. Now that we have had a very brief introduction to JavaScript, let's introduce React.</p>
			<p class="callout-heading">Further Reading</p>
			<p class="callout">Covering all the concepts of JavaScript is beyond the scope of this book. For a complete, hands-on course on JavaScript, you can always refer to <em class="italic">The JavaScript Workshop</em>: <a href="https://courses.packtpub.com/courses/javascript">https://courses.packtpub.com/courses/javascript</a>.</p>
			<h2 id="_idParaDest-445">React<a id="_idTextAnchor475"/></h2>
			<p>React allows you to build applications using components. Each component can <em class="italic">render</em> itself, by generating HTML to be inserted on the page. </p>
			<p>A component may also keep track of its own <em class="italic">state</em>. If it does track its own state, when the state changes, the component will automatically re-render itself. This means if you have an action method that updates a state variable on a component, you don't need to then figure out whether the component needs to be redrawn; React will do this for you. A web app should track its own state so that it doesn't need to query the server to find out how it needs to update to display data.</p>
			<p>Data is passed between components using properties, or <em class="italic">props</em> for short. The method of passing properties looks kind of like HTML attributes, but there are some differences, which we will cover later in the chapter. Properties are received by a component in a single <strong class="source-inline">props</strong> object.</p>
			<p>To illustrate with an example, you might build a shopping list app with React. You would have a component for the list container (<strong class="source-inline">ListContainer</strong>), and a component for a list item (<strong class="source-inline">ListItem</strong>). <strong class="source-inline">ListItem</strong> would be instantiated multiple times, once for each item on the shopping list. The container would hold a state, containing a list of the items' names. Each item name would be passed to the <strong class="source-inline">ListItem</strong> instances as a <em class="italic">prop</em>. Each <strong class="source-inline">ListItem</strong> would then store the item's name and an <strong class="source-inline">isBought</strong> flag in its own state. As you click an item to mark it off the list, <strong class="source-inline">isBought</strong> would be set to <strong class="source-inline">true</strong>. Then React would automatically call <strong class="source-inline">render</strong> on that <strong class="source-inline">ListItem</strong> to update the display.</p>
			<p>There are a few different methods of using React with your application. If you want to build a deep and complex React application, you should use <strong class="source-inline">npm</strong> (<strong class="bold">Node Package Manager</strong>, a tool for managing Node.js applications) to set up a React project. Since we are just going to be using React to enhance some of our pages, we can just include the React framework code using a <strong class="source-inline">&lt;script&gt;</strong> tag:</p>
			<p class="source-code">&lt;scri<a id="_idTextAnchor476"/>pt crossorigin src="https://unpkg.com/react@16/umd/react.development.js"&gt;&lt;/script&gt;</p>
			<p class="source-code">&lt;script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"&gt;&lt;/script&gt;</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="source-inline">crossorigin</strong> attribute is for security and means cookies or other data cannot be sent to the remote server. This is necessary when using a public CDN such as <a href="https://unpkg.com/">https://unpkg.com/</a>, in case a malicious script has been hosted there by someone.</p>
			<p>These should be placed on a page that you want to add React to, just before the closing <strong class="source-inline">&lt;/body&gt;</strong> tag. The reason for putting the tags here instead of in the <strong class="source-inline">&lt;head&gt;</strong> of the page is that the script might want to refer to HTML elements on the page. If we put the script tag in the head, it will be executed before the page elements are available (as they come after).</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The links to the latest React versions can be found at <a href="https://reactjs.org/docs/cdn-links.html">https://reactjs.org/docs/cdn-links.html</a>.</p>
			<h2 id="_idParaDest-446">Compo<a id="_idTextAnchor477"/>nents</h2>
			<p>There are two ways to build a component in React: with functions or with classes. Regardless of the approach, to get displayed on a page, the component must return some HTML elements to display. A functional component is a single function that returns elements, whereas a class-based component will return elements from its <strong class="source-inline">render</strong> method. Functional components cannot keep track of their own state.</p>
			<p>React is like Django in that it automatically escapes HTML in strings that are returned from <strong class="source-inline">render</strong>. To generate HTML elements, you must construct them using their tag, the attributes/properties they should have, and their content. This is done with the <strong class="source-inline">React.createElement</strong> function. A component will return a React element, which may contain sub-elements.</p>
			<p>Let us look at two implementations of the same component, first as a function then as a class. The functional component takes <strong class="source-inline">props</strong> as an argument. This is an object containing the properties that are passed to it. The following function returns an <strong class="source-inline">h1</strong> element:</p>
			<p class="source-code">function HelloWorld(props) {</p>
			<p class="source-code">return React.createElement('h1', null, 'Hello, ' +   props.name + '!');</p>
			<p class="source-code">}</p>
			<p>Note that it is conventional for the function to have an uppercase first character.</p>
			<p>While a functional component is a single function that generates HTML, a class-based component must implement a <strong class="source-inline">render</strong> method to do this. The code in the <strong class="source-inline">render</strong> method is the same as in the functional component, with one difference: the class-based component accepts the <strong class="source-inline">props</strong> object in its constructor, and then <strong class="source-inline">render</strong> (or other) methods can refer to <strong class="source-inline">props</strong> using <strong class="source-inline">this.props</strong>. Here is the same <strong class="source-inline">HelloWorld</strong> component, implemented as a class:</p>
			<p class="source-code">class HelloWorld extends React.Component {</p>
			<p class="source-code">render() {</p>
			<p class="source-code">return React.createElement('h1', null, 'Hello, ' +   this.props.name + '!');</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p>When using classes, all components extend from the <strong class="source-inline">React.Component</strong> class. Class-based components have an advantage over functional components, which is that they encapsulate the handling actions/event, and their own state. For simple components, using the functional style means less code. For more information on components and properties, see <a href="https://reactjs.org/docs/components-and-props.html">https://reactjs.org/docs/components-and-props.html</a>.</p>
			<p>Whichever method you choose to define a component, it is used in the same way. In this chapter, we will only be using class-based components.</p>
			<p>To put this component onto an HTML page, we first need to add a place for React to render it. Normally, this is done using <strong class="source-inline">&lt;div&gt;</strong> with an <strong class="source-inline">id</strong> attribute. For example:</p>
			<p class="source-code">&lt;div id="react_container"&gt;&lt;/div&gt;</p>
			<p>Note that <strong class="source-inline">id</strong> does not have to be <strong class="source-inline">react_container</strong>, it just needs to be unique for the page. Then, in the JavaScript code, after defining all your components, they are rendered on the page using the <strong class="source-inline">ReactDOM.render</strong> function. This takes two arguments: the root React element (not the component) and the HTML element in which it should be rendered.</p>
			<p>We would use it like this:</p>
			<p class="source-code">const container = document.getElementById('react_container');</p>
			<p class="source-code">const componentElement = React.createElement(HelloWorld, {name:   'Ben'});</p>
			<p class="source-code">ReactDOM.render(componentElement, container);</p>
			<p>Note that the <strong class="source-inline">HelloWorld</strong> component (class/function) itself is not being passed to the <strong class="source-inline">render</strong> function, it is wrapped in a <strong class="source-inline">React.createElement</strong> call to instantiate it and transform it into an element.</p>
			<p>As you might have guessed from its name, the <strong class="source-inline">document.getElementById</strong> function locates an HTML element in the document and returns a reference to it.</p>
			<p>The final output in the browser when the component is rendered is like this:</p>
			<p class="source-code">&lt;h1&gt;Hello, Ben!&lt;/h1&gt;</p>
			<p>Let's look at a more advanced example component. Note that since <strong class="source-inline">React.createElement</strong> is such a commonly used function, it's common to alias to a shorter name, such as <strong class="source-inline">e</strong>: that's what the first line of this example does.</p>
			<p>This component displays a button and has an internal state that keeps track of how many times the button was clicked. First, let's look at the component class in its entirety:</p>
			<p class="source-code">const e = React.createElement;</p>
			<p class="source-code">class ClickCounter extends React.Component {</p>
			<p class="source-code">  constructor(props) {</p>
			<p class="source-code">    super(props);</p>
			<p class="source-code">    this.state = { clickCount: 0 };</p>
			<p class="source-code">  }</p>
			<p class="source-code">  render() {</p>
			<p class="source-code">    return e(</p>
			<p class="source-code">      'button',  // the element name</p>
			<p class="source-code">      {onClick: () =&gt; this.setState({ </p>
			<p class="source-code">       clickCount: this.state.clickCount + 1 }) },//element props</p>
			<p class="source-code">       this.state.clickCount  // element content</p>
			<p class="source-code">    );</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p>Some things to note about the <strong class="source-inline">ClickCounter</strong> class:</p>
			<ul>
				<li>The <strong class="source-inline">props</strong> argument is an object (dictionary) of attribute values that have been passed to the component when it is used in HTML. For example:<p class="source-code">&lt;ClickCounter foo="bar" rex="baz"/&gt;</p><p>The <strong class="source-inline">props</strong> dictionary would contain the key <strong class="source-inline">foo</strong> with a value of bar, and the key <strong class="source-inline">rex</strong> with the value <strong class="source-inline">baz</strong>.</p></li>
				<li><strong class="source-inline">super(props)</strong> calls the super class's <strong class="source-inline">constructor</strong> method and passes the <strong class="source-inline">props</strong> variable. This is analogous to the <strong class="source-inline">super()</strong> method in Python.</li>
				<li>Each React class has a <strong class="source-inline">state</strong> variable, which is an object. <strong class="source-inline">constructor</strong> can initialize it. The state should be changed using the <strong class="source-inline">setState</strong> method, rather than being manipulated directly. When it is changed, the <strong class="source-inline">render</strong> method will be automatically called to redraw the component.</li>
			</ul>
			<p>The <strong class="source-inline">render</strong> method returns a new HTML element, using the <strong class="source-inline">React.createElement</strong> function (remember, the <strong class="source-inline">e</strong> variable was aliased to this function). In this case, the arguments to <strong class="source-inline">React.createElement</strong> will return a <strong class="source-inline">&lt;button&gt;</strong> element with a click handler, and with the text content <strong class="source-inline">this.state.clickCount</strong>. Essentially, it will return an element like this (when <strong class="source-inline">clickCount</strong> is <strong class="source-inline">0</strong>):</p>
			<p class="source-code">&lt;button onClick="this.setState(…)"&gt;</p>
			<p class="source-code">  0</p>
			<p class="source-code">&lt;/button&gt;</p>
			<p>The <strong class="source-inline">onClick</strong> function is set as an anonymous function with arrow syntax. This is similar to having a function as follows (although not quite the same since it's in a different context):</p>
			<p class="source-code">const onClick = () =&gt; {</p>
			<p class="source-code">this.setState({clickCount: this.state.clickCount + 1})</p>
			<p class="source-code">}</p>
			<p>Since the function is only one line, we can also remove one set of wrapping braces, and we end up with this:</p>
			<p class="source-code">{ onClick: () =&gt; this.setState({clickCount:   this.state.clickCount + 1}) }</p>
			<p>We covered how to place <strong class="source-inline">ClickCounter</strong> onto a page earlier in this section, something like this:</p>
			<p class="source-code">ReactDOM.render(e(ClickCounter), document.getElementById   ('react_container'));</p>
			<p>The screenshot in the following figure shows the counter in the button when the page loads:</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In the following figure, <strong class="source-inline">DjDt</strong> refers to the debug toolbar that we learned about in the <em class="italic">Django Debug Toolbar</em> section in <em class="italic">Chapter 15</em>, <em class="italic">Django Third-Party Libraries</em>.</p>
			<div>
				<div id="_idContainer453" class="IMG---Figure">
					<img src="image/B15509_16_06.jpg" alt="Figure 16.6: Button with 0 for the count&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.6: Button with 0 for the count</p>
			<p>After clicking the button a few times, the button looks as shown in <em class="italic">Figure 16.7</em>:</p>
			<div>
				<div id="_idContainer454" class="IMG---Figure">
					<img src="image/B15509_16_07.jpg" alt="Figure 16.7: Button after clicking seven times&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.7: Button after clicking seven times</p>
			<p>Now, just to demonstrate how <em class="italic">not</em> to write the <strong class="source-inline">render</strong> function, we'll look at what happens if we just return HTML as a string, like this:</p>
			<p class="source-code">render() {</p>
			<p class="source-code">    return '&lt;button&gt;' + this.state.clickCount + '&lt;/button&gt;'</p>
			<p class="source-code">}</p>
			<p>Now the rendered page looks as shown in <em class="italic">Figure 16.8</em>:</p>
			<div>
				<div id="_idContainer455" class="IMG---Figure">
					<img src="image/B15509_16_08.jpg" alt="Figure 16.8: Returned HTML rendered as a string&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.8: Returned HTML rendered as a string</p>
			<p>This shows React's automatic escaping of HTML in action. Now that we have had a brief intro to JavaScript and React, let's add an example page to Bookr so you can see it in action.</p>
			<h2 id="_idParaDest-447">Exercise<a id="_idTextAnchor478"/> 16.01: Setting Up a React Example</h2>
			<p>In this exercise, we will create an example view and template to use with React. Then we will implement the <strong class="source-inline">ClickCounter</strong> component. At the end of the exercise, you will be able to interact with it with the <strong class="source-inline">ClickCounter</strong> button:</p>
			<ol>
				<li value="1">In PyCharm, go to <strong class="source-inline">New</strong> -&gt; <strong class="source-inline">File</strong> inside the project's <strong class="source-inline">static</strong> directory. Name the new file <strong class="source-inline">react-example.js</strong>.</li>
				<li>Inside it, put this code, which will define the React component, then render it into the <strong class="source-inline">react_container</strong> <strong class="source-inline">&lt;div&gt;</strong> that we will be creating:<p class="source-code">const e = React.createElement;</p><p class="source-code">class ClickCounter extends React.Component {</p><p class="source-code">  constructor(props) {</p><p class="source-code">    super(props);</p><p class="source-code">    this.state = { clickCount: 0 };</p><p class="source-code">  }</p><p class="source-code">  render() {</p><p class="source-code">    return e(</p><p class="source-code">      'button',</p><p class="source-code">      { onClick: () =&gt; this.setState({ </p><p class="source-code">           clickCount: this.state.clickCount + 1 </p><p class="source-code">           }) </p><p class="source-code">},</p><p class="source-code">      this.state.clickCount</p><p class="source-code">    );</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">ReactDOM.render(e(ClickCounter), document.getElementById   ('react_container'))</p><p>You can now save <strong class="source-inline">react-example.js</strong>.</p></li>
				<li>Go to <strong class="source-inline">New</strong> -&gt; <strong class="source-inline">HTML File</strong> inside the project's <strong class="source-inline">templates</strong> directory:<div id="_idContainer456" class="IMG---Figure"><img src="image/B15509_16_09.jpg" alt="Figure 16.9: Create a new HTML file&#13;&#10;"/></div><p class="figure-caption">Figure 16.9: Create a new HTML file</p><p>Name the new file <strong class="source-inline">react-example.html</strong>:</p><div id="_idContainer457" class="IMG---Figure"><img src="image/B15509_16_10.jpg" alt="Figure 16.10: Name the file react-example.html&#13;&#10;"/></div><p class="figure-caption">Figure 16.10: Name the file react-example.html</p><p>You can change the title inside the <strong class="source-inline">&lt;title&gt;</strong> element to <em class="italic">React Example</em>, but that is not necessary for this exercise.</p></li>
				<li><strong class="source-inline">react-example.html</strong> is created with some HTML boilerplate as we have seen before. Add the following <strong class="source-inline">&lt;script&gt;</strong> tags to include React just before the closing <strong class="source-inline">&lt;/body&gt;</strong> tag:<p class="source-code">&lt;script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"&gt;&lt;/script&gt;</p><p class="source-code">&lt;script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"&gt;&lt;/script&gt;</p></li>
				<li>The <strong class="source-inline">react-example.js</strong> file will be included using a <strong class="source-inline">&lt;script&gt;</strong> tag, and we need to generate the script path using the <strong class="source-inline">static</strong> template tag. First, <strong class="source-inline">load</strong> the static template library at the start of the file by adding this on the second line:<p class="source-code">{% load static %}</p><p>The first few lines of your file will look like <em class="italic">Figure 16.11</em>:</p><div id="_idContainer458" class="IMG---Figure"><img src="image/B15509_16_11.jpg" alt="Figure 16.11: The load static template tag included&#13;&#10;"/></div><p class="figure-caption">Figure 16.11: The load static template tag included</p><p>Then, just before the closing <strong class="source-inline">&lt;/body&gt;</strong> tag, but after the <strong class="source-inline">&lt;script&gt;</strong> tags that were added in <em class="italic">step 4</em>, add this script tag to include your <strong class="source-inline">react-example.js</strong>:</p><p class="source-code">&lt;script src="{% static 'react-example.js' %}"&gt;&lt;/script&gt;</p></li>
				<li>We now need to add the containing <strong class="source-inline">&lt;div&gt;</strong> that React will render into. Add this element after the opening <strong class="source-inline">&lt;body&gt;</strong> tag:<p class="source-code">&lt;div id="react_container"&gt;&lt;/div&gt;</p><p>You can save <strong class="source-inline">react-example.html</strong>.</p></li>
				<li>Now we'll add a view to render the template. Open the <strong class="source-inline">reviews</strong> app's <strong class="source-inline">views.py</strong> and add a <strong class="source-inline">react_example</strong> view at the end of the file:<p class="source-code">def react_example(request):</p><p class="source-code">    return render(request, "react-example.html")</p><p>In this simple view, we are just rendering the <strong class="source-inline">react-example.html</strong> template with no context data.</p></li>
				<li>Finally, we need to map a URL to the new view. Open the <strong class="source-inline">bookr</strong> package's <strong class="source-inline">urls.py</strong> file. Add this map to the <strong class="source-inline">urlpatterns</strong> variable:<p class="source-code">path('react-example/', reviews.views.react_example)</p><p>You can save and close <strong class="source-inline">urls.py</strong>.</p></li>
				<li>Start the Django dev server if it's not already running, then go to <strong class="source-inline">http://127.0.0.1:8000/react-example/</strong>. You should see the <strong class="source-inline">ClickCount</strong> button rendered as in <em class="italic">Figure 16.12</em>:<div id="_idContainer459" class="IMG---Figure"><img src="image/B15509_16_12.jpg" alt="Figure 16.12: ClickCount button&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 16.12: ClickCount button</p>
			<p>Try clicking the button a few times and watch the counter increment.</p>
			<p>In this example, we created our first React component, then added a template and view to render it. We included the React framework source from a CDN. In the next section, we will introduce <strong class="bold">JSX</strong>, which is a method of combining templates and code into a single file that can simplify our code.</p>
			<h2 id="_idParaDest-448"><a id="_idTextAnchor479"/>JSX</h2>
			<p>It can b<a id="_idTextAnchor480"/>e quite verbose to define each element using the <strong class="source-inline">React.createElement</strong> function – even when we alias to a shorter variable name. The verbosity is exacerbated when we start building larger components.</p>
			<p>When using React, we can use JSX instead to build the HTML elements. JSX stands for JavaScript XML – since both JavaScript and XML are written in the same file. For example, consider the following code in which we are creating a button using the <strong class="source-inline">render</strong> method:</p>
			<p class="source-code">return React.createElement('button', { onClick: … },   'Button Text')</p>
			<p>Instead of this, we can return its HTML directly, as follows:</p>
			<p class="source-code">return &lt;button onClick={…}&gt;Button Text&lt;/button&gt;;</p>
			<p>Note that the HTML is not quoted and returned as a string. That is, we are not doing this:</p>
			<p class="source-code">return '&lt;button onClick={…}&gt;Button Text&lt;/button&gt;';</p>
			<p>Since JSX is an unusual syntax (a combination of HTML and JavaScript in a single file), we need to include another JavaScript library before it can be used: Babel (<a href="https://babeljs.io">https://babeljs.io</a>). This is a library that can <em class="italic">transpile</em> code between different versions of JavaScript. You can write code using the latest syntax and have it <em class="italic">transpiled</em> (a combination of translate and compile) into a version of code that older browsers can understand.</p>
			<p>Babel can be included with a <strong class="source-inline">&lt;script&gt;</strong> tag like this:</p>
			<p class="source-code">&lt;script crossorigin src="https://unpkg.com/babel-standalone@6/  babel.min.js"&gt;&lt;/script&gt;</p>
			<p>This should be included on the page after your other React-related script tags, but before you include any files containing JSX.</p>
			<p>Any JavaScript source code that includes JSX must have the <strong class="source-inline">type="text/babel"</strong> attribute added:</p>
			<p class="source-code">&lt;script src="path/to/file.js" type="text/babel"&gt;&lt;/script&gt;</p>
			<p>This is so Babel knows to parse the file rather than just treating it as plain JavaScript.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Note that using Babel in this way can be slow for large projects. It is designed to be used as part of the build process in an <strong class="source-inline">npm</strong> project and to have your JSX files transpiled ahead of time (rather than in real time as we are doing here). <strong class="source-inline">npm</strong> project setup is beyond the scope of this book. For our purposes and with the small amount of JSX we are using, using Babel will be fine.</p>
			<p>JSX uses braces to include JavaScript data inside HTML, similar to Django's double braces in templates. JavaScript inside braces will be executed. We'll now look at how to convert our button creation example to JSX. Our <strong class="source-inline">render</strong> method can be changed to this:</p>
			<p class="source-code">render() {</p>
			<p class="source-code">    return &lt;button onClick={() =&gt;this.setState({ </p>
			<p class="source-code">            clickCount: this.state.clickCount + 1 </p>
			<p class="source-code">          })</p>
			<p class="source-code">    }&gt;</p>
			<p class="source-code">    {this.state.clickCount}</p>
			<p class="source-code">&lt;/button&gt;;</p>
			<p class="source-code">  }</p>
			<p>Note that the <strong class="source-inline">onClick</strong> attribute has no quotes around its value; instead, it is wrapped in braces. This is passing the JavaScript function that is defined inline to the component. It will be available in that component's <strong class="source-inline">props</strong> dictionary that is passed to the <strong class="source-inline">constructor</strong> method. For example, imagine that we had passed it like this:</p>
			<p class="source-code">onClick="() =&gt;this.setState…"</p>
			<p>In such a case, it would be passed to the component as a string value and thus would not work.</p>
			<p>We are also rendering the current value of <strong class="source-inline">clickCount</strong> as the content of the <strong class="source-inline">button</strong>. JavaScript could be executed inside these braces too. To show the click count plus one, we could do this:</p>
			<p class="source-code">{this.state.clickCount + 1}</p>
			<p>In the next exercise, we will include Babel in our template and then convert our component to use JSX.</p>
			<h2 id="_idParaDest-449">Exercise 16.<a id="_idTextAnchor481"/>02: JSX and Babel</h2>
			<p>In this exercise, we want to implement JSX in our component to simplify our code. To do this, we need to make a couple of changes to the <strong class="source-inline">react-example.js</strong> file and <strong class="source-inline">react-example.html</strong> file to switch to JSX to render <strong class="source-inline">ClickCounter</strong>:</p>
			<ol>
				<li value="1">In PyCharm, open <strong class="source-inline">react-example.js</strong> and change the <strong class="source-inline">render</strong> method to use JSX instead, by replacing it with the following code. You can refer to <em class="italic">step 2</em> from <em class="italic">Exercise 16.01</em>, <em class="italic">Setting Up a React Example</em>, where we defined this method:<p class="source-code">render() {</p><p class="source-code">return &lt;button onClick={() =&gt; this.setState({ </p><p class="source-code">       clickCount: this.state.clickCount + 1 </p><p class="source-code">       })</p><p class="source-code">    }&gt;</p><p class="source-code">    {this.state.clickCount}</p><p class="source-code">&lt;/button&gt;;  }</p></li>
				<li>We can now treat <strong class="source-inline">ClickCounter</strong> as an element itself. In the <strong class="source-inline">ReactDOM.render</strong> call at the end of the file, you can replace the first argument, <strong class="source-inline">e(ClickCounter)</strong>, with a <strong class="source-inline">&lt;ClickCounter/&gt;</strong> element, like this:<p class="source-code">ReactDOM.render(&lt;ClickCounter/&gt;, document.getElementById   ('react_container'));</p></li>
				<li>Since we're no longer using the <strong class="source-inline">React.create</strong> function that we created in <em class="italic">step 2</em> of <em class="italic">Exercise 16.01</em>, <em class="italic">Setting Up a React Example</em>, we can remove the alias we created; delete the first line:<p class="source-code">const e = React.createElement;</p><p>You can save and close the file.</p></li>
				<li>Open the <strong class="source-inline">react-example.html</strong> template. You need to include the Babel library JavaScript. Add this code between the React <strong class="source-inline">script</strong> elements and the <strong class="source-inline">react-example.js</strong> element:<p class="source-code">&lt;script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"&gt;&lt;/script&gt;</p></li>
				<li>Add a <strong class="source-inline">type="text/babel"</strong> attribute to the <strong class="source-inline">react-example.html</strong> <strong class="source-inline">&lt;script&gt;</strong> tag:<p class="source-code">&lt;script src="{% static 'react-example.js' %}" type="text/babel"&gt;&lt;/script&gt;</p><p>Save <strong class="source-inline">react-example.html</strong>.</p></li>
				<li>Start the Django dev server if it is not already running and go to <strong class="source-inline">http://127.0.0.1:8000/react-example/</strong>. You should see the same button as we had before (<em class="italic">Figure 16.12</em>). When clicking the button, you should see the count increment as well.</li>
			</ol>
			<p>In this exercise, we did not change the behavior of the <strong class="source-inline">ClickCounter</strong> React component. Instead, we refactored it to use JSX. This makes it easier to write the component's output directly as HTML and cut down on the amount of code we need to write. In the next section, we will look at passing properties to a JSX React component.</p>
			<h2 id="_idParaDest-450">JSX Properti<a id="_idTextAnchor482"/>es</h2>
			<p>Properties on JSX-based React components are set in the same way as attributes on a standard HTML element. The important thing to remember is whether you are setting them as a string or a JavaScript value.</p>
			<p>Let's look at some examples using the <strong class="source-inline">ClickCounter</strong> component. Say that we want to extend <strong class="source-inline">ClickCounter</strong> so that a <strong class="source-inline">target</strong> number can be specified. When the target is reached, the button should be replaced with the text <strong class="source-inline">Well done, &lt;name&gt;!</strong>. These values should be passed into <strong class="source-inline">ClickCounter</strong> as properties.</p>
			<p>When using variables, we have to pass them as JSX values:</p>
			<p class="source-code">let name = 'Ben'</p>
			<p class="source-code">let target = 5;</p>
			<p class="source-code">ReactDOM.render(&lt;ClickCounter name={name} target={target}/&gt;,   document.getElementById('react_container'));</p>
			<p>We can mix and match the method of passing the values too. This is also valid:</p>
			<p class="source-code">ReactDOM.render(&lt;ClickCounter name="Ben" target={5}/&gt;,   document.getElementById('react_container'));</p>
			<p>In the next exercise, we will update <strong class="source-inline">ClickCounter</strong> to read these values from properties and change its behavior when the target is reached. We will pass these values in from the Django template.</p>
			<h2 id="_idParaDest-451">Exercise 16.<a id="_idTextAnchor483"/>03: React Component Properties</h2>
			<p>In this exercise, you will modify <strong class="source-inline">ClickCounter</strong> to read the values of <strong class="source-inline">target</strong> and <strong class="source-inline">name</strong> from its <strong class="source-inline">props</strong>. You will pass these in from the Django view and use the <strong class="source-inline">escapejs</strong> filter to make the <strong class="source-inline">name</strong> value safe for use in a JavaScript string. When you are finished, you will be able to click on the button until it reaches a target, and then see a <strong class="source-inline">Well done</strong> message:</p>
			<ol>
				<li value="1">In PyCharm, open the <strong class="source-inline">reviews</strong> app's <strong class="source-inline">views.py</strong>. We will modify the <strong class="source-inline">react_example</strong> view's <strong class="source-inline">render</strong> call to pass through a context containing <strong class="source-inline">name</strong> and <strong class="source-inline">target</strong>, like this:<p class="source-code">return render(request, "react-example.html", {"name": "Ben", \</p><p class="source-code">                                              "target": 5})</p><p>You can use your own name and pick a different target value if you like. Save <strong class="source-inline">views.py</strong>.</p></li>
				<li>Open the <strong class="source-inline">react-example.js</strong> file. We will update the <strong class="source-inline">state</strong> setting in the <strong class="source-inline">constructor</strong> method to set the name and target from <strong class="source-inline">props</strong>, like this:<p class="source-code">constructor(props) {</p><p class="source-code">    super(props);</p><p class="source-code">    this.state = { clickCount: 0, name: props.name, target:       props.target</p><p class="source-code">    };</p><p class="source-code">}</p></li>
				<li>Change the behavior of the <strong class="source-inline">render</strong> method to return <strong class="source-inline">Well done, &lt;name&gt;!</strong> once <strong class="source-inline">target</strong> has been reached. Add this <strong class="source-inline">if</strong> statement inside the <strong class="source-inline">render</strong> method:<p class="source-code">if (this.state.clickCount === this.state.target) {</p><p class="source-code">    return &lt;span&gt;Well done, {this.state.name}!&lt;/span&gt;;</p><p class="source-code">}</p></li>
				<li>To pass the values in, move the <strong class="source-inline">ReactDOM.render</strong> call into the template so that Django can render that piece of code. Cut this <strong class="source-inline">ReactDOM.render</strong> line from the end of <strong class="source-inline">react-example.js</strong>:<p class="source-code">ReactDOM.render(&lt;ClickCounter/&gt;, document.getElementById   ('react_container'));</p><p>We will paste it into the template file in <em class="italic">step 6</em>. <strong class="source-inline">react-example.js</strong> should now only contain the <strong class="source-inline">ClickCounter</strong> class. Save and close the file.</p></li>
				<li>Open <strong class="source-inline">react-example.html</strong>. After all the existing <strong class="source-inline">&lt;script&gt;</strong> tags (but before the closing <strong class="source-inline">&lt;/body&gt;</strong> tag), add opening and closing <strong class="source-inline">&lt;script&gt;</strong> tags with the <strong class="source-inline">type="text/babel"</strong> attribute. Inside them, we need to assign the Django context values that were passed to the template to JavaScript variables. Altogether, you should be adding this code:<p class="source-code">&lt;script type="text/babel"&gt;</p><p class="source-code">let name = "{{ name|escapejs }}";</p><p class="source-code">let target = {{ target }};</p><p class="source-code">&lt;/script&gt;</p><p>The first assigns the <strong class="source-inline">name</strong> variable with the <strong class="source-inline">name</strong> context variable. We use the <strong class="source-inline">escapejs</strong> template filter; otherwise, we could generate invalid JavaScript code if our name had a double quote in it. The second value, <strong class="source-inline">target</strong>, is assigned from <strong class="source-inline">target</strong>. This is a number, so it does not need to be escaped.</p><p class="callout-heading">Note</p><p class="callout">Due to the way Django escapes the values for JavaScript, <strong class="source-inline">name</strong> cannot be passed directly to the component property like this:</p><p class="callout"><strong class="source-inline">&lt;ClickCounter name="{{ name|escapejs }}"/&gt;</strong></p><p class="callout">The JSX will not un-escape the values correctly and you will end up with escape sequences.</p><p class="callout">However, you could pass the numerical value target in like this:</p><p class="callout"><strong class="source-inline">&lt;ClickCounter target="{ {{ target }} }"/&gt;</strong></p><p class="callout">Also, be aware of the spacing between the Django braces and JSX braces. In this book, we will stick with assigning all properties to variables first, then passing them to the component, for consistency.</p></li>
				<li>Underneath these variable declarations, paste in the <strong class="source-inline">ReactDOM.render</strong> call that you copied from <strong class="source-inline">react-example.js</strong>. Then, add the <strong class="source-inline">target={ target }</strong> and <strong class="source-inline">name={ name }</strong> properties to <strong class="source-inline">ClickCounter</strong>. Remember, these are the JavaScript variables being passed in, not the Django context variables – they just happen to have the same name. The <strong class="source-inline">&lt;script&gt;</strong> block should now look like this:<p class="source-code">&lt;script type="text/babel"&gt;</p><p class="source-code">    let name = "{{ name|escapejs }}";</p><p class="source-code">    let target = {{ target }};</p><p class="source-code">    ReactDOM.render(&lt;ClickCounter name={ name }       target={ target }/&gt;, document.getElementById         ('react_container'));</p><p class="source-code">&lt;/script&gt;</p><p>You can save <strong class="source-inline">react-example.html</strong>.</p></li>
				<li>Start the Django dev server if it is not already running, then go to <strong class="source-inline">http://127.0.0.1:8000/react-example/</strong>. Try clicking the button a few times – it should increment until you click it <strong class="source-inline">target</strong> number of times. Then, it will be replaced with the <strong class="source-inline">Well done, &lt;name&gt;!</strong> text. See <em class="italic">Figure 16.13</em> for how it should look after you've clicked it enough times:<div id="_idContainer460" class="IMG---Figure"><img src="image/B15509_16_13.jpg" alt="Figure 16.13: Well done message&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 16.13: Well done message</p>
			<p>In this exercise, we passed data to a React component using <strong class="source-inline">props</strong>. We escaped the data when assigning it to a JavaScript variable using the <strong class="source-inline">escapejs</strong> template filter. In the next section, we will cover how to fetch data over HTTP using JavaScript.</p>
			<p class="callout-heading">Further Reading</p>
			<p class="callout">For a more detailed, hands-on course on React, you can always refer to <em class="italic">The React Workshop</em>: <a href="https://courses.packtpub.com/courses/react">https://courses.packtpub.com/courses/react</a>.</p>
			<h2 id="_idParaDest-452"><a id="_idTextAnchor484"/>JavaScript Promises</h2>
			<p>To prevent blocking on long-running operations, many JavaScript functions are implemented asynchronously. The way they work is by returning immediately, but then invoking a callback function when a result is available. The object these types of functions return is a <strong class="source-inline">Promise</strong>. Callback functions are provided to the <strong class="source-inline">Promise</strong> object by calling its <strong class="source-inline">then</strong> method. When the function finishes running, it will either <strong class="source-inline">resolve</strong> the <strong class="source-inline">Promise</strong> (call the <strong class="source-inline">success</strong> function) or <strong class="source-inline">reject</strong> it (call the <strong class="source-inline">failure</strong> function).</p>
			<p>We will illustrate the wrong and right way of using promises. Consider a hypothetical long-running function that performs a big calculation, called <strong class="source-inline">getResult</strong>. Instead of returning the result, it returns a <strong class="source-inline">Promise</strong>. You would not use it like this:</p>
			<p class="source-code">const result = getResult();</p>
			<p class="source-code">console.log(result);  // incorrect, this is a Promise</p>
			<p>Instead, it should be invoked like this, with a callback function passed to <strong class="source-inline">then</strong> on the returned <strong class="source-inline">Promise</strong>. We will assume that <strong class="source-inline">getResult</strong> can never fail, so we only provide it with a <strong class="source-inline">success</strong> function for the resolve case:</p>
			<p class="source-code">const promise = getResult();</p>
			<p class="source-code">promise.then((result) =&gt; {</p>
			<p class="source-code">    console.log(result);  /* this is called when the Promise       resolves*/</p>
			<p class="source-code">});</p>
			<p>Normally, you wouldn't assign the returned <strong class="source-inline">Promise</strong> to a variable. Instead, you'd chain the <strong class="source-inline">then</strong> call to the function call. We'll show this in the next example, along with a failure callback (assume <strong class="source-inline">getResult</strong> can now fail). We'll also add some comments illustrating the order in which the code executes:</p>
			<p class="source-code">getResult().then( </p>
			<p class="source-code">(result) =&gt; {</p>
			<p class="source-code">        // success function</p>
			<p class="source-code">        console.log(result);  </p>
			<p class="source-code">// this is called 2nd, but only on success</p>
			<p class="source-code">}, </p>
			<p class="source-code">    () =&gt; {</p>
			<p class="source-code">        // failure function</p>
			<p class="source-code">        console.log("getResult failed");</p>
			<p class="source-code">        // this is called 2nd, but only on failure</p>
			<p class="source-code">})</p>
			<p class="source-code">// this will be called 1st, before either of the callbacks</p>
			<p class="source-code">console.log("Waiting for callback");</p>
			<p>Now that we've introduced promises, we can look at the <strong class="source-inline">fetch</strong> function, which makes HTTP requests. It is asynchronous and works by returning promises.</p>
			<h2 id="_idParaDest-453"><a id="_idTextAnchor485"/>fetch</h2>
			<p>Most br<a id="_idTextAnchor486"/>owsers (95%) support a function called <strong class="source-inline">fetch</strong>, which allows you to make HTTP requests. It uses an asynchronous callback interface with promises. </p>
			<p>The <strong class="source-inline">fetch</strong> function takes two arguments. The first is the URL to make the request to and the second is an object (dictionary) with settings for the request. For example, consider this:</p>
			<p class="source-code">const promise = fetch("http://www.google.com", {…settings});</p>
			<p>The settings are things such as the following:</p>
			<ul>
				<li><strong class="source-inline">method</strong>: The request HTTP method (<strong class="source-inline">GET</strong>, <strong class="source-inline">POST</strong>, and more).</li>
				<li><strong class="source-inline">headers</strong>: Another object (dictionary) of HTTP headers to send.</li>
				<li><strong class="source-inline">body</strong>: The HTTP body to send (for <strong class="source-inline">POST</strong>/<strong class="source-inline">PUT</strong> requests).</li>
				<li><strong class="source-inline">credentials</strong>: By default, <strong class="source-inline">fetch</strong> does not send any cookies. This means your requests will act like you are not authenticated. To have it set cookies in its requests, this should be set to the value <strong class="source-inline">same-origin</strong> or <strong class="source-inline">include</strong>.</li>
			</ul>
			<p>Let's look at it in action with a simple request:</p>
			<p class="source-code">fetch('/api/books/', {</p>
			<p class="source-code">    method: 'GET',</p>
			<p class="source-code">    headers: {</p>
			<p class="source-code">        Accept: 'application/json'</p>
			<p class="source-code">    }</p>
			<p class="source-code">}).then((resp) =&gt; {</p>
			<p class="source-code">    console.log(resp)</p>
			<p class="source-code">})</p>
			<p>This code will fetch from <strong class="source-inline">/api/book-list/</strong> and then call a function that logs the request to the browser's console using <strong class="source-inline">console.log</strong>.</p>
			<p><em class="italic">Figure 16.14</em> shows the console output in Firefox for the preceding response:</p>
			<div>
				<div id="_idContainer461" class="IMG---Figure">
					<img src="image/B15509_16_14.jpg" alt="Figure 16.14: Response output in the console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.14: Response output in the console</p>
			<p>As you can see, there isn't much information that is output. We need to decode the response before we can work with it. We can use the <strong class="source-inline">json</strong> method on the response object to decode the response body to a JSON object. This also returns a <strong class="source-inline">Promise</strong>, so we will ask to get the JSON, then work with the data in our callback. The full code block to do that looks like this:</p>
			<p class="source-code">fetch('/api/books/', {</p>
			<p class="source-code">    method: 'GET',</p>
			<p class="source-code">    headers: {</p>
			<p class="source-code">        Accept: 'application/json'</p>
			<p class="source-code">    }</p>
			<p class="source-code">}).then((resp) =&gt; {</p>
			<p class="source-code">    return resp.json(); // doesn't return JSON, returns a Promise</p>
			<p class="source-code">}).then((data) =&gt; {</p>
			<p class="source-code">    console.log(data);</p>
			<p class="source-code">});</p>
			<p>This will log the decoded object that was in JSON format to the browser console. In Firefox, the output looks like <em class="italic">Figure 16.15</em>:</p>
			<div>
				<div id="_idContainer462" class="IMG---Figure">
					<img src="image/B15509_16_15.jpg" alt="Figure 16.15: Decoded book list output to console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.15: Decoded book list output to console</p>
			<p>In <em class="italic">Exercise 16.04</em>, <em class="italic">Fetching and Rendering Books</em>, we will write a new React component that will fetch a list of books and then render each one as a list item (<strong class="source-inline">&lt;li&gt;</strong>). Before that, we need to learn about the JavaScript <strong class="source-inline">map</strong> method and how to use it to build HTML in React.</p>
			<h3 id="_idParaDest-454">The JavaScript <a id="_idTextAnchor487"/>map Method</h3>
			<p>Sometimes we want to execute the same piece of code (JavaScript or JSX) multiple times for different input data. In this chapter, it will be most useful to generate JSX elements with the same HTML tags but different content. In JavaScript, the <strong class="source-inline">map</strong> method iterates over the target array and then executes a callback function for each element in the array. Each of these elements is then added to a new array, which is then returned. For example, this short snippet uses <strong class="source-inline">map</strong> to double each number in the <strong class="source-inline">numbers</strong> array:</p>
			<p class="source-code">const numbers = [1, 2, 3];</p>
			<p class="source-code">const doubled = numbers.map((n) =&gt; {</p>
			<p class="source-code">    return n * 2;</p>
			<p class="source-code">});</p>
			<p>The <strong class="source-inline">doubled</strong> array now contains the values <strong class="source-inline">[2, 4, 6]</strong>. </p>
			<p>We can also create a list of JSX values using this method. The only thing to note is that each item in the list must have a unique <strong class="source-inline">key</strong> property set. In this next short example, we are transforming an array of numbers into <strong class="source-inline">&lt;li&gt;</strong> elements. We can then use them inside <strong class="source-inline">&lt;ul&gt;</strong>. Here is an example <strong class="source-inline">render</strong> function to do this:</p>
			<p class="source-code">render() {</p>
			<p class="source-code">    const numbers = [1, 2, 3];</p>
			<p class="source-code">    const listItems = numbers.map((n) =&gt; {</p>
			<p class="source-code">      return &lt;li key={n}&gt;{n}&lt;/li&gt;;</p>
			<p class="source-code">      });</p>
			<p class="source-code">    return &lt;ul&gt;{listItems}&lt;/ul&gt;</p>
			<p class="source-code">}</p>
			<p>When rendered, this will generate the following HTML:</p>
			<p class="source-code">&lt;ul&gt;</p>
			<p class="source-code">&lt;li&gt;1&lt;/li&gt;</p>
			<p class="source-code">&lt;li&gt;2&lt;/li&gt;</p>
			<p class="source-code">&lt;li&gt;3&lt;/li&gt;</p>
			<p class="source-code">&lt;/ul&gt;</p>
			<p>In the next exercise, we will build a React component with a button that will fetch the list of books from the API when it is clicked. The list of books will then be displayed.</p>
			<h2 id="_idParaDest-455">Exercise 16.04:<a id="_idTextAnchor488"/> Fetching and Rendering Books</h2>
			<p>In this exercise, you will create a new component named <strong class="source-inline">BookDisplay</strong> that renders an array of books inside <strong class="source-inline">&lt;ul&gt;</strong>. The books will be retrieved using <strong class="source-inline">fetch</strong>. To do this, we add the React component into the <strong class="source-inline">react-example.js</strong> file. Then we pass the URL of the book list to the component inside the Django template:</p>
			<ol>
				<li value="1">In PyCharm, open <strong class="source-inline">react-example.js</strong>, which you previously used in <em class="italic">step 9</em> of <em class="italic">Exercise 16.03</em>, <em class="italic">React Component Properties</em>. You can delete the entire <strong class="source-inline">ClickCounter</strong> class.</li>
				<li>Create a new class called <strong class="source-inline">BookDisplay</strong> that <strong class="source-inline">extends</strong> from <strong class="source-inline">React.Component</strong>.</li>
				<li>Then, add a <strong class="source-inline">constructor</strong> method that takes <strong class="source-inline">props</strong> as an argument. It should call <strong class="source-inline">super(props)</strong> and then set its state like this:<p class="source-code">this.state = { books: [], url: props.url, fetchInProgress:   false };</p><p>This will initialize <strong class="source-inline">books</strong> as an empty array, read the API URL from the passed-in property <strong class="source-inline">url</strong>, and set a <strong class="source-inline">fetchInProgress</strong> flag to <strong class="source-inline">false</strong>. The code of your <strong class="source-inline">constructor</strong> method should be like this:</p><p class="source-code">constructor(props) {</p><p class="source-code">  super(props);</p><p class="source-code">  this.state = { books: [], url: props.url, fetchInProgress:   false };</p><p class="source-code">}</p></li>
				<li>Next, add a <strong class="source-inline">doFetch</strong> method. You can copy and paste this code to create it:<p class="source-code">doFetch() {</p><p class="source-code">  if (this.state.fetchInProgress)</p><p class="source-code">      return;</p><p class="source-code">this.setState({ fetchInProgress: true })</p><p class="source-code">  fetch(this.state.url, {</p><p class="source-code">      method: 'GET',</p><p class="source-code">      headers: {</p><p class="source-code">          Accept: 'application/json'</p><p class="source-code">      }</p><p class="source-code">  }</p><p class="source-code">  ).then((response) =&gt; {</p><p class="source-code">      return response.json();</p><p class="source-code">  }).then((data) =&gt; {</p><p class="source-code">this.setState({ fetchInProgress: false, books: data })</p><p class="source-code">  })</p><p class="source-code">}</p><p>First, with the <strong class="source-inline">if</strong> statement, we check if a fetch has already been started. If so, we <strong class="source-inline">return</strong> from the function. Then, we use <strong class="source-inline">setState</strong> to update the state, setting <strong class="source-inline">fetchInProgress</strong> to <strong class="source-inline">true</strong>. This will both update our button display text and stop multiple requests from being run at once. We then <strong class="source-inline">fetch</strong> the <strong class="source-inline">this.state.url</strong> (which we will pass in through the template later in the exercise). The response is retrieved with the <strong class="source-inline">GET</strong> method and we only want to <strong class="source-inline">Accept</strong> a JSON response. After we get a response, we then return its JSON using the <strong class="source-inline">json</strong> method. This returns a <strong class="source-inline">Promise</strong>, so we use another <strong class="source-inline">then</strong> to handle the callback when the JSON is parsed. In that final callback, we set the state of the component, with <strong class="source-inline">fetchInProgress</strong> going back to <strong class="source-inline">false</strong>, and the <strong class="source-inline">books</strong> array being set to the decoded JSON data.</p></li>
				<li>Next, create the <strong class="source-inline">render</strong> method. You can copy and paste this code too:<p class="source-code">render() {</p><p class="source-code">  const bookListItems = this.state.books.map((book) =&gt; {</p><p class="source-code">      return &lt;li key={ book.pk }&gt;{ book.title }&lt;/li&gt;;</p><p class="source-code">  })</p><p class="source-code">  const buttonText = this.state.fetchInProgress  ? </p><p class="source-code">  'Fetch in Progress' : 'Fetch';</p><p class="source-code">  return &lt;div&gt;</p><p class="source-code">&lt;ul&gt;{ bookListItems }&lt;/ul&gt;</p><p class="source-code">&lt;button onClick={ () =&gt;this.doFetch() } </p><p class="source-code">        disabled={ this.state.fetchInProgress }&gt;</p><p class="source-code">          {buttonText}</p><p class="source-code">&lt;/button&gt;</p><p class="source-code">&lt;/div&gt;;</p><p class="source-code">}</p><p>This uses the <strong class="source-inline">map</strong> method to iterate over the array of books in <strong class="source-inline">state</strong>. We generate <strong class="source-inline">&lt;li&gt;</strong> for each book, using the book's <strong class="source-inline">pk</strong> as the <strong class="source-inline">key</strong> instance for the list item. The content of <strong class="source-inline">&lt;li&gt;</strong> is the book's title. We define a <strong class="source-inline">buttonText</strong> variable to store (and update) the text that the button will display. If we currently have a <strong class="source-inline">fetch</strong> operation running, then this will be <em class="italic">Fetch in Progress</em>. Otherwise, it will be <em class="italic">Fetch</em>. Finally, we return a <strong class="source-inline">&lt;div&gt;</strong> that contains all the data we want. The content of <strong class="source-inline">&lt;ul&gt;</strong> is the <strong class="source-inline">bookListItems</strong> variable (the array of <strong class="source-inline">&lt;li&gt;</strong> instances). It also contains a <strong class="source-inline">&lt;button&gt;</strong> instance added in a similar way to in the previous exercises. The <strong class="source-inline">onClick</strong> method calls the <strong class="source-inline">doFetch</strong> method of the class. We can make the button <strong class="source-inline">disabled</strong> (that is, the user can't click the button) if there is a fetch in progress. We set the button text to the <strong class="source-inline">buttonText</strong> variable we created earlier. You can now save and close <strong class="source-inline">react-example.js</strong>.</p></li>
				<li>Open <strong class="source-inline">react-example.html</strong>. We need to replace the <strong class="source-inline">ClickCounter</strong> render (from <em class="italic">Exercise 16.03</em>, <em class="italic">React Component Properties</em>) with a <strong class="source-inline">BookDisplay</strong> render. Delete the <strong class="source-inline">name</strong> and <strong class="source-inline">target</strong> variable definitions. We will instead render the <strong class="source-inline">&lt;BookDisplay&gt;</strong>. Set the <strong class="source-inline">url</strong> property as a string and pass in the URL to the book list API, using the <strong class="source-inline">{% url %}</strong> template tag to generate it. The <strong class="source-inline">ReactDOM.render</strong> call should then look like this:<p class="source-code">ReactDOM.render(&lt;BookDisplay url="{% url 'api:book-list' %}" /&gt;,  document.getElementById('react_container'));</p><p>You can now save and close <strong class="source-inline">react-example.html</strong>.</p></li>
				<li>Start the Django dev server if it's not already running, then visit <strong class="source-inline">http://127.0.0.1:8000/react-example/</strong>. You should see a single <strong class="source-inline">Fetch</strong> button on the page (<em class="italic">Figure 16.16</em>):<div id="_idContainer463" class="IMG---Figure"><img src="image/B15509_16_16.jpg" alt="Figure 16.16: Book Fetch button&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 16.16: Book Fetch button</p>
			<p>After clicking the <strong class="source-inline">Fetch</strong> button, it should become disabled and have its text changed to <strong class="source-inline">Fetch in Progress</strong>, as we can see here:</p>
			<div>
				<div id="_idContainer464" class="IMG---Figure">
					<img src="image/B15509_16_17.jpg" alt="Figure 16.17: Fetch in Progress&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.17: Fetch in Progress</p>
			<p>Once the fetch is complete, you should see the list of books rendered as follows:</p>
			<div>
				<div id="_idContainer465" class="IMG---Figure">
					<img src="image/B15509_16_18.jpg" alt="Figure 16.18: Book fetch complete&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.18: Book fetch complete</p>
			<p>This exercise was a chance to integrate React with the Django REST API you built in <em class="italic">Chapter 12</em>, <em class="italic">Building a REST API</em>. We built a new component (<strong class="source-inline">BookDisplay</strong>) with a call to <strong class="source-inline">fetch</strong> to get a list of books. We used the JavaScript <strong class="source-inline">map</strong> method to transform the book array to some <strong class="source-inline">&lt;li&gt;</strong> elements. As we had seen before, we used <strong class="source-inline">button</strong> to trigger <strong class="source-inline">fetch</strong> when it was clicked. We then provided the book list API URL to the React component in the Django template. Later, we saw a list of books in Bookr that were loaded dynamically using the REST API.</p>
			<p>Before we move onto the activity for this chapter, we will talk about some considerations for other JavaScript frameworks when working with Django.</p>
			<h2 id="_idParaDest-456">The verbatim Templ<a id="_idTextAnchor489"/>ate Tag</h2>
			<p>We have seen that when using React, we can use JSX interpolation values in Django templates. This is because JSX uses single braces to interpolate values, and Django uses double braces. As long as there are spaces between the JSX and Django braces, it should work fine.</p>
			<p>Other frameworks, such as Vue, also use double braces for variable interpolation. What that means is if you had a Vue component's HTML in your template, you might try to interpolate a value like this:</p>
			<p class="source-code">&lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;</p>
			<p>Of course, when Django renders the template, it will interpolate the <strong class="source-inline">name</strong> value before the Vue framework gets a chance to render.</p>
			<p>We can use the <strong class="source-inline">verbatim</strong> template tag to have Django output the data exactly as it appears in the template, without performing any rendering or variable interpolation. Using it with the previous example is simple:</p>
			<p class="source-code">{% verbatim %}</p>
			<p class="source-code">&lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;</p>
			<p class="source-code">{% endverbatim %}</p>
			<p>Now when Django renders the template, the HTML between the template tags will be output exactly as it is written, allowing Vue (or another framework) to take over and interpolate the variables itself. Many other frameworks separate their templates into their own files, which should not conflict with Django's templates. </p>
			<p>There are many JavaScript frameworks available, and which one you ultimately decide to use will depend on your own opinion or what your company/team uses. If you do run into conflicts, the solution will depend on your particular framework. The examples in this section should help lead you in the right direction.</p>
			<p>We have now covered most things you will need to integrate React (or other JavaScript frameworks) with Django. In the next activity, you will implement these learnings to fetch the most recent reviews on Bookr.</p>
			<h2 id="_idParaDest-457">Activity 16.01: Re<a id="_idTextAnchor490"/>views Preview</h2>
			<p>In this activity, we will update the Bookr main page to fetch the six most recent reviews and display them. The user will be able to click buttons to go forward to the next six reviews, and then back to the previous ones.</p>
			<p>These steps will help you complete the activity:</p>
			<ol>
				<li value="1">First, we can clean up some code from previous exercises. You can take backups of these files to preserve them for later reference if you like. Alternatively, you can use the GitHub versions too, for future reference. Delete the <strong class="source-inline">react_example</strong> view, <strong class="source-inline">react-example</strong> URL, <strong class="source-inline">react-example.html</strong> template, and <strong class="source-inline">react-example.js</strong> file.</li>
				<li>Create a <strong class="source-inline">recent-reviews.js</strong> static file.</li>
				<li>Create two components, a <strong class="source-inline">ReviewDisplay</strong> component that displays the data for a single review, and a <strong class="source-inline">RecentReviews</strong> component that handles fetching the review data and displaying a list of <strong class="source-inline">ReviewDisplay</strong> components.<p>First, create the <strong class="source-inline">ReviewDisplay</strong> class. In its constructor, you should read the <strong class="source-inline">review</strong> being passed in through the <strong class="source-inline">props</strong> and assign it to the state.</p></li>
				<li>The <strong class="source-inline">render</strong> method of <strong class="source-inline">ReviewDisplay</strong> should return JSX HTML like this:<p class="source-code">&lt;div className="col mb-4"&gt;</p><p class="source-code">&lt;div className="card"&gt;</p><p class="source-code">&lt;div className="card-body"&gt;</p><p class="source-code">&lt;h5 className="card-title"&gt;{ BOOK_TITLE }</p><p class="source-code">&lt;strong&gt;({ REVIEW_RATING })&lt;/strong&gt;</p><p class="source-code">&lt;/h5&gt;</p><p class="source-code">&lt;h6 className="card-subtitle mb-2 text-muted"&gt;CREATOR_EMAIL&lt;/h6&gt;</p><p class="source-code">&lt;p className="card-text"&gt;REVIEW_CONTENT&lt;/p&gt;</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;div className="card-footer"&gt;</p><p class="source-code">&lt;a href={'/books/' + BOOK_ID` + '/' } className="card-link"&gt;  View Book&lt;/a&gt;</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;/div&gt;</p><p>However, you should replace the <strong class="source-inline">BOOK_TITLE</strong>, <strong class="source-inline">REVIEW_RATING</strong>, <strong class="source-inline">CREATOR_EMAIL</strong>, <strong class="source-inline">REVIEW_CONTENT</strong>, and <strong class="source-inline">BOOK_ID</strong> placeholders with their proper values from the <strong class="source-inline">review</strong> that the component has fetched.</p><p class="callout-heading">Note</p><p class="callout">Note that when working with JSX and React, the <strong class="source-inline">class</strong> of an element is set with the <strong class="source-inline">className</strong> attribute, not <strong class="source-inline">class</strong>. When it's rendered as HTML, it becomes <strong class="source-inline">class</strong>.</p></li>
				<li>Create another React component called <strong class="source-inline">RecentReviews</strong>. Its <strong class="source-inline">constructor</strong> method should set up the <strong class="source-inline">state</strong> with the following keys/values:<p><strong class="source-inline">reviews</strong>: <strong class="source-inline">[]</strong> (empty list)</p><p><strong class="source-inline">currentUrl</strong>: <strong class="source-inline">props.url</strong></p><p><strong class="source-inline">nextUrl</strong>: <strong class="source-inline">null</strong></p><p><strong class="source-inline">previousUrl</strong>: <strong class="source-inline">null</strong></p><p><strong class="source-inline">loading</strong>: <strong class="source-inline">false</strong></p></li>
				<li>Implement a method to download the reviews from the REST API. Call it <strong class="source-inline">fetchReviews</strong>. It should return immediately if <strong class="source-inline">state.loading</strong> is <strong class="source-inline">true</strong>. Then, it should set the <strong class="source-inline">loading</strong> property of <strong class="source-inline">state</strong> to <strong class="source-inline">true</strong>.</li>
				<li>Implement <strong class="source-inline">fetch</strong> in the same way as you did in <em class="italic">Exercise 16.04</em>, <em class="italic">Fetching and Rendering Books</em>. It should follow the same pattern of requesting <strong class="source-inline">state.currentUrl</strong> and then getting the JSON data from the response. Then, set the following values in <strong class="source-inline">state</strong>:<p><strong class="source-inline">loading</strong>: <strong class="source-inline">false</strong></p><p><strong class="source-inline">reviews</strong>: <strong class="source-inline">data.results</strong></p><p><strong class="source-inline">nextUrl</strong>: <strong class="source-inline">data.next</strong></p><p><strong class="source-inline">previousUrl</strong>: <strong class="source-inline">data.previous</strong></p></li>
				<li>Implement a <strong class="source-inline">componentDidMount</strong> method. This is a method that is called when React has loaded the component onto the page. It should call the <strong class="source-inline">fetchReviews</strong> method.</li>
				<li>Create a <strong class="source-inline">loadNext</strong> method. If the <strong class="source-inline">nextUrl</strong> in <strong class="source-inline">state</strong> is null, it should return immediately. Otherwise, it should set <strong class="source-inline">state.currentUrl</strong> to <strong class="source-inline">state.nextUrl</strong>, then call <strong class="source-inline">fetchReviews</strong>.</li>
				<li>Similarly, create a <strong class="source-inline">loadPrevious</strong> method; however, this should set <strong class="source-inline">state.currentUrl</strong> to <strong class="source-inline">state.previousUrl</strong>.</li>
				<li>Implement the render method. If the state is loading, then it should return the text <strong class="source-inline">Loading…</strong> inside an <strong class="source-inline">&lt;h5&gt;</strong> element.</li>
				<li>Create two variables to store the <strong class="source-inline">previousButton</strong> and <strong class="source-inline">nextButton</strong> HTML. They both should have the <strong class="source-inline">btn btn-secondary</strong> class and the next button should also have the <strong class="source-inline">float-right</strong> class. They should have <strong class="source-inline">onClick</strong> attributes set to call the <strong class="source-inline">loadPrevious</strong> or <strong class="source-inline">loadNext</strong> methods. They should have their <strong class="source-inline">disabled</strong> attributes set to <strong class="source-inline">true</strong> if the respective <strong class="source-inline">previousUrl</strong> or <strong class="source-inline">nextUrl</strong> attributes are <strong class="source-inline">null</strong>. The button text should be <em class="italic">Previous</em> or <em class="italic">Next</em>.</li>
				<li>Iterate over the reviews using the <strong class="source-inline">map</strong> method and store the result to a variable. Each <strong class="source-inline">review</strong> should be represented by a <strong class="source-inline">ReviewDisplay</strong> component with the attribute <strong class="source-inline">key</strong> set to the review's <strong class="source-inline">pk</strong> and <strong class="source-inline">review</strong> set to the <strong class="source-inline">Review</strong> class. If there are no reviews (<strong class="source-inline">reviews.length === 0</strong>), then the variable instead should be an <strong class="source-inline">&lt;h5&gt;</strong> element with the content <em class="italic">No reviews to display</em>.</li>
				<li>Finally, return all the content wrapped in <strong class="source-inline">&lt;div&gt;</strong> elements, like this:<p class="source-code">&lt;div&gt;</p><p class="source-code">&lt;div className="row row-cols-1 row-cols-sm-2 row-cols-md-3"&gt;</p><p class="source-code">      { reviewItems }</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;div&gt;</p><p class="source-code">      {previousButton}</p><p class="source-code">      {nextButton}</p><p class="source-code">&lt;/div&gt;</p><p class="source-code">&lt;/div&gt;</p><p>The <strong class="source-inline">className</strong> we are using here will display each review preview in one, two, or three columns depending on the screen size.</p></li>
				<li>Next, edit <strong class="source-inline">base.html</strong>. You will add all the new content inside the <strong class="source-inline">content</strong> block so that it will not be displayed on the non-main pages that override this block. Add an <strong class="source-inline">&lt;h4&gt;</strong> element with the content <strong class="source-inline">Recent Reviews</strong>.</li>
				<li>Add a <strong class="source-inline">&lt;div&gt;</strong> element for React to render into. Make sure you give it a unique <strong class="source-inline">id</strong>.</li>
				<li>Include the <strong class="source-inline">&lt;script&gt;</strong> tags to include React, React DOM, Babel, and the <strong class="source-inline">recent-reviews.js</strong> file. These four tags should be similar to what you had in <em class="italic">Exercise 16.04</em>, <em class="italic">Fetching and Rendering Books</em>.</li>
				<li>The last thing to add is another <strong class="source-inline">&lt;script&gt;</strong> tag containing the <strong class="source-inline">ReactDOM.render</strong> call code. The root component being rendered is <strong class="source-inline">RecentReviews</strong>. It should have a <strong class="source-inline">url</strong> attribute set to the value <strong class="source-inline">url="{% url 'api:review-list' %}?limit=6"</strong>. This does a URL lookup for <strong class="source-inline">ReviewViewSet</strong> and then appends a page size argument of <strong class="source-inline">6</strong>, limiting the number of reviews that are retrieved to a maximum of <strong class="source-inline">6</strong>.</li>
			</ol>
			<p>Once you have completed these steps, you should be able to navigate to <strong class="source-inline">http://127.0.0.1:8000/</strong> (the main Bookr page) and see a page like this:</p>
			<div>
				<div id="_idContainer466" class="IMG---Figure">
					<img src="image/B15509_16_19.jpg" alt="Figure 16.19: Completed reviews preview&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.19: Completed reviews preview</p>
			<p>In the screenshot, the page has been scrolled to show the <strong class="source-inline">Previous</strong>/<strong class="source-inline">Next</strong> buttons. Notice the <strong class="source-inline">Previous</strong> button is disabled because we are on the first page.</p>
			<p>If you click <strong class="source-inline">Next</strong>, you should see the next page of reviews. If you click <strong class="source-inline">Next</strong> enough times (depending on how many reviews you have), you will eventually reach the last page and then the <strong class="source-inline">Next</strong> button will be disabled:</p>
			<div>
				<div id="_idContainer467" class="IMG---Figure">
					<img src="image/B15509_16_20.jpg" alt="Figure 16.20: Next button disabled&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.20: Next button disabled</p>
			<p>If you have no reviews, then you should see the message <strong class="source-inline">No reviews to display</strong>:</p>
			<div>
				<div id="_idContainer468" class="IMG---Figure">
					<img src="image/B15509_16_21.jpg" alt="Figure 16.21: No reviews to display. text&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.21: No reviews to display. text</p>
			<p>While the page is loading the reviews, you should see the text <strong class="source-inline">Loading…</strong>; however, it will probably only display for a split second since the data is being loaded off your own computer:</p>
			<div>
				<div id="_idContainer469" class="IMG---Figure">
					<img src="image/B15509_16_22.jpg" alt="Figure 16.22: Loading text&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 16.22: Loading text</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h1 id="_idParaDest-458"><a id="_idTextAnchor491"/>Summary</h1>
			<p>In this chapter, we introduced JavaScript frameworks and described how they work with Django to enhance templates and add interactivity. We introduced the JavaScript language and covered some of its main features, variable types, and classes. We then introduced the concepts behind React and how it builds HTML by using components. We built a React component using just JavaScript and the <strong class="source-inline">React.createElement</strong> function. After that, we introduced JSX and saw how it made the development of components easier, by letting you directly write HTML in your React components. The concepts of <strong class="source-inline">promises</strong> and the <strong class="source-inline">fetch</strong> function were introduced, and we saw how to get data from a REST API using <strong class="source-inline">fetch</strong>. The chapter finished with an exercise that retrieved reviews from Bookr using the REST API and rendered them to the page in an interactive component.</p>
			<p>In the next chapter, we will look at how to deploy our Django project to a production web server. You can download the chapter from the GitHub repository for this book at <a href="http://packt.live/2Kx6FmR">http://packt.live/2Kx6FmR</a>.</p>
		</div>
	</body></html>