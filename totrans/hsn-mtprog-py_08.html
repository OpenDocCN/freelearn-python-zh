<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer077">
<h1 id="_idParaDest-78"><em class="italic"><a id="_idTextAnchor080"/>Chapter 6</em>: Implementing Reflection on Python Objects</h1>
<p>In this chapter, we will look at reflection in Python 3 and understand how it is useful in metaprogramming.<span class="superscript"> </span><strong class="bold">Reflection</strong> is a <a id="_idIndexMarker276"/>continuation of introspection, or it can be looked upon as a concept where we can make use of the information we learn from the introspection of properties or attributes of objects in Python and apply them to manipulate the objects, and so perform metaprogramming.</p>
<p>Why reflection? As we know from the previous chapter, introspection is an information-gathering process for Python objects. Reflection is the process of utilizing the information gathered from objects through introspection, and in turn, performing generic operations on them by manipulating them externally to perform metaprogramming.</p>
<p>Throughout this chapter, we will look at implementing reflection using each function that helped us introspect objects in the previous chapter and perform metaprogramming on the objects we use in our programs.</p>
<p>In this chapter, we will take a look at the following main topics:</p>
<ul>
<li>Introducing built-in functions used in reflection</li>
<li>Using <strong class="source-inline">id</strong> to delete duplicates</li>
<li>Using <strong class="source-inline">callable</strong> to dynamically check and generate methods</li>
<li>Using <strong class="source-inline">hasattr</strong> to set values</li>
<li>Using <strong class="source-inline">isinstance</strong> to modify an object</li>
<li>Using <strong class="source-inline">issubclass</strong> to modify a class</li>
<li>Applying <strong class="source-inline">property</strong> on a coupon</li>
</ul>
<p>By the end of this chapter, you should be able to apply built-in functions to reflect on Python objects, apply them to examples, and use them to generate or modify code.</p>
<h1 id="_idParaDest-79"><a id="_idTextAnchor081"/>Technical requirements</h1>
<p>The code examples shared in this chapter are available on GitHub for this chapter here: <a href="https://github.com/PacktPublishing/Metaprogramming-with-Python/tree/main/Chapter06">https://github.com/PacktPublishing/Metaprogramming-with-Python/tree/main/Chapter06</a>.</p>
<h1 id="_idParaDest-80"><a id="_idTextAnchor082"/>Introducing built-in functions used in reflection</h1>
<p>To understand <a id="_idIndexMarker277"/>reflection and the usage of Python’s built-in functions to perform reflection, we will continue making use of our core example of <em class="italic">ABC Megamart</em> throughout this chapter. We will be specifically looking at the concept and examples based <a id="_idIndexMarker278"/>on coupons in a retail store throughout this chapter. Coupons are a technique used by retail stores or manufacturers to promote their products among consumers. Coupons are generated and posted through various modes of advertisements, and they are used to attract customers to a specific store or product.</p>
<p>We will make use of the same set of built-in functions as in introspection, to apply reflection on Python objects:</p>
<ul>
<li><strong class="source-inline">id()</strong></li>
<li><strong class="source-inline">eval()</strong></li>
<li><strong class="source-inline">callable()</strong></li>
<li><strong class="source-inline">hastattr()</strong></li>
<li><strong class="source-inline">getattr()</strong></li>
<li><strong class="source-inline">isinstance()</strong></li>
<li><strong class="source-inline">issubclass()</strong></li>
<li><strong class="source-inline">property()</strong></li>
</ul>
<p>Reflection on Python objects helps in the metaprogramming of these objects using the built-in functions that can introspect Python objects, and we will look at some examples for these in this chapter.</p>
<h1 id="_idParaDest-81"><a id="_idTextAnchor083"/>Using id to delete duplicates</h1>
<p>We <a id="_idIndexMarker279"/>reviewed the <strong class="source-inline">id</strong> function in the previous chapter, which covered introspection. In Python 3, <strong class="source-inline">id</strong> is used to identify an object using the object’s memory address. Identifying <strong class="source-inline">id</strong> of an object can be used to reflect on an object and avoid redundancies or errors that can possibly occur while using an object throughout a program. </p>
<p>To understand this further, we will be creating a class named <strong class="source-inline">Coupon</strong>, which generates a unique random coupon ID and prints a coupon for any product that is provided as input. In the following code, we will start with creating a class named <strong class="source-inline">Coupon</strong> and will be adding the coupon details as attributes. We will also create a method named <strong class="source-inline">generate_coupon</strong> to print five coupons for a product along with its unique random coupon ID:</p>
<pre class="source-code">class Coupon:</pre>
<pre class="source-code">    def __init__(self, product_name, product_category, \</pre>
<pre class="source-code">      brand,source, expiry_date, quantity):</pre>
<pre class="source-code">        self.product_name = product_name</pre>
<pre class="source-code">        self.product_category = product_category</pre>
<pre class="source-code">        self.brand = brand</pre>
<pre class="source-code">        self.source = source</pre>
<pre class="source-code">        self.expiry_date = expiry_date</pre>
<pre class="source-code">        self.quantity = quantity</pre>
<pre class="source-code">   def generate_coupon(self):</pre>
<pre class="source-code">        import random</pre>
<pre class="source-code">        couponId =  random.sample(range(1,9),5)</pre>
<pre class="source-code">        for i in couponId:</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<pre class="source-code">            print('Product:', self.product_name)</pre>
<pre class="source-code">            print('Product Category:', \</pre>
<pre class="source-code">              self.product_category)</pre>
<pre class="source-code">            print('Coupon ID:', i)</pre>
<pre class="source-code">            print('Brand:', self.brand)</pre>
<pre class="source-code">            print('Source:', self.source)</pre>
<pre class="source-code">            print('Expiry Date:', self.expiry_date)</pre>
<pre class="source-code">            print('Quantity:', self.quantity)</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<p>Let’s now create a <strong class="source-inline">Coupon1</strong> variable and assign the <strong class="source-inline">Coupon</strong> class to it:</p>
<pre class="source-code">Coupon1 = Coupon</pre>
<p>In this case, we<a id="_idIndexMarker280"/> are intentionally assigning the <strong class="source-inline">Coupon</strong> class to a variable to demonstrate the usage of the <strong class="source-inline">id</strong> function. Ideally, this function will come in handy to debug and ensure when the class is actually assigned unintentionally and thus leading to issues later on in the code. At this point in time, let’s assume that the assignment of the <strong class="source-inline">Coupon</strong> class to a variable is unintentional. </p>
<p>Let’s look at how to identify and resolve such unintentional assignments of a class and review the coupon generation results if <strong class="source-inline">Coupon1</strong> was called by some other object when <strong class="source-inline">Coupon</strong> was the only class that should have been available to generate the coupons.</p>
<p>In the preceding <strong class="source-inline">Coupon</strong> class, the expectation was to generate only five coupons for a product with unique random coupon identifiers. Since we have assigned the class to a variable, the class identifier is also assigned to the variable:</p>
<pre class="source-code">id(Coupon)</pre>
<pre class="source-code"><strong class="bold">2175775727280</strong></pre>
<pre class="source-code">id(Coupon1)</pre>
<pre class="source-code"><strong class="bold">2175775727280</strong></pre>
<p>Let’s now call the <strong class="source-inline">generate_coupon</strong> method of the <strong class="source-inline">Coupon</strong> class along with its attributes and look at the results:</p>
<pre class="source-code">Coupon("Potato Chips","Snacks","ABCBrand1","Manhattan Store","10/1/2021",2).generateCoupon()</pre>
<p>The output for coupon 1 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 5</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The <a id="_idIndexMarker281"/>output for coupon 2 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 1</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 3 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 4</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output <a id="_idIndexMarker282"/>for coupon 4 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 8</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 5 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 3</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>Calling the preceding method resulted in the generation of five unique coupons for the potato chips product. Coupon identifiers are unique and should not be regenerated at any other part of the code in the future; therefore, the preceding method will be called only once in<a id="_idIndexMarker283"/> the code. Since we have already assigned the <strong class="source-inline">Coupon</strong> class to another variable named <strong class="source-inline">Coupon1</strong>, let’s look at what will happen if <strong class="source-inline">Coupon1</strong> is called in some other part of the code unintentionally:</p>
<pre class="source-code">Coupon1("Potato Chips","Snacks","ABCBrand1","Manhattan Store","10/1/2021",2).generate_coupon()</pre>
<p>The output for coupon 1 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 7</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 2 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 8</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output<a id="_idIndexMarker284"/> for coupon 3 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 1</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 4 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 6</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 5 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Potato Chips</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Snacks</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 2</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand1</strong></pre>
<pre class="source-code"><strong class="bold">Source: Manhattan Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>In this example, <strong class="source-inline">Coupon1</strong> should not be called in the code since calling it would generate duplicate coupons, possibly with the same IDs. This might lead to the creation of five more coupons <a id="_idIndexMarker285"/>for the same product, which is not required; among these, two of them would be duplicates with coupon identifiers <strong class="source-inline">1</strong> and <strong class="source-inline">8</strong>. This leads to making coupons <strong class="source-inline">1</strong> and <strong class="source-inline">8</strong> void when distributed to consumers since each coupon is expected to have one unique identifier to redeem it.</p>
<p>Let’s now look at how to resolve this issue by developing a function named <strong class="source-inline">delete_duplicates</strong> that checks and deletes such duplicate assignments of the <strong class="source-inline">Coupon</strong> class. This function looks at the list of Python objects in the directory that has duplicates and deletes the duplicates of classes. Refer to the following code:</p>
<pre class="source-code">def delete_duplicates(directory = dir()):</pre>
<pre class="source-code">    class_id_count = {}</pre>
<pre class="source-code">    duplicates = []</pre>
<pre class="source-code">    ids = []</pre>
<pre class="source-code">    classes = []</pre>
<pre class="source-code">    classnames = []</pre>
<pre class="source-code">    for obj in directory:</pre>
<pre class="source-code">        if type(eval(obj)) == type:</pre>
<pre class="source-code">            ids.append(id(eval(obj)))</pre>
<pre class="source-code">            classes.append(eval(obj))</pre>
<pre class="source-code">            classnames.append(obj)</pre>
<pre class="source-code">    for i in ids:</pre>
<pre class="source-code">        if i not in class_id_count:</pre>
<pre class="source-code">            class_id_count[i] = 1</pre>
<pre class="source-code">        elif (class_id_count[i] == 1):</pre>
<pre class="source-code">            duplicates.append(i)</pre>
<pre class="source-code">            class_id_count[i] += 1</pre>
<pre class="source-code">    dupe_set = {}</pre>
<pre class="source-code">    for cls,clsname in zip(classes,classnames):</pre>
<pre class="source-code">        for clsid in duplicates:</pre>
<pre class="source-code">            if (id(cls)==clsid):</pre>
<pre class="source-code">                print(clsname,cls)</pre>
<pre class="source-code">                dupe_set[clsname] = \</pre>
<pre class="source-code">                  str(cls).split('.')[1].rstrip("'&gt;'")</pre>
<pre class="source-code">    for key,value in dupe_set.items():</pre>
<pre class="source-code">        if (key!=value):</pre>
<pre class="source-code">            del globals()[key]</pre>
<p>The first three <strong class="source-inline">for</strong> loops in <a id="_idIndexMarker286"/>the preceding code were previously discussed in the <em class="italic">Debug unintentional assignments using id</em> section in the previous chapter, which covered introspection. The last <strong class="source-inline">for</strong> loop checks whether duplicate items are present in the dictionary named <strong class="source-inline">dupe_set</strong>, and deletes the duplicate variables only and not the actual classes.</p>
<p>Calling the preceding function results in the deletion of the duplicate <strong class="source-inline">Coupon1</strong> variable:</p>
<pre class="source-code">delete_duplicates(directory = dir())</pre>
<pre class="source-code">Coupon &lt;class '__main__.Coupon'&gt;</pre>
<pre class="source-code">Coupon1 &lt;class '__main__.Coupon'&gt;</pre>
<pre class="source-code">Coupon</pre>
<pre class="source-code">__main__.Coupon</pre>
<pre class="source-code">Coupon1</pre>
<p>Checking<a id="_idIndexMarker287"/> whether <strong class="source-inline">Coupon1</strong> still exists results in the following error:</p>
<div>
<div class="IMG---Figure" id="_idContainer075">
<img alt="Figure 6.1 – Error on calling Coupon1 after it is deleted " height="121" src="image/Figure_6.1_B13426.jpg" width="644"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.1 – Error on calling Coupon1 after it is deleted</p>
<p>The preceding error confirms that the duplicate variable was deleted by the <strong class="source-inline">delete_duplicates</strong> function. In the following section, we will look at applying reflection using the function named <strong class="source-inline">callable</strong>.</p>
<h1 id="_idParaDest-82"><a id="_idTextAnchor084"/>Using callable to dynamically check and generate methods</h1>
<p>We will now<a id="_idIndexMarker288"/> look into another familiar<a id="_idIndexMarker289"/> function named <strong class="source-inline">callable</strong> to<a id="_idIndexMarker290"/> check on how it can be used to perform<a id="_idIndexMarker291"/> reflection on an object. </p>
<p class="callout-heading">Note</p>
<p class="callout">A class, method, or a function is callable in Python, while class objects or variables are not callable. </p>
<p>In this example, we will check whether a class is callable, and if it returns <strong class="source-inline">true</strong>, we will dynamically add a method to the class. To test the usage of the <strong class="source-inline">callable</strong> function, we will first create a coupon class and name it <strong class="source-inline">SimpleCoupon</strong>:</p>
<pre class="source-code">class SimpleCoupon:</pre>
<pre class="source-code">    pass</pre>
<p>Let’s check whether the preceding class is callable:</p>
<pre class="source-code">callable(SimpleCoupon)</pre>
<pre class="source-code">True</pre>
<p>In the<a id="_idIndexMarker292"/> following code, we will create a function <a id="_idIndexMarker293"/>that generates another<a id="_idIndexMarker294"/> function if called. We will create a <strong class="source-inline">create_coupon</strong> function<a id="_idIndexMarker295"/> that, in turn, creates a <strong class="source-inline">generate_coupon</strong> function or method when called:</p>
<pre class="source-code">def create_coupon( product, product_category, brand, source, expiry_date, quantity:</pre>
<pre class="source-code">    def generate_coupon(product, product_category, brand, \</pre>
<pre class="source-code">      source, expiry_date, quantity):</pre>
<pre class="source-code">        import random</pre>
<pre class="source-code">        couponId =  random.sample(range(100000000000,900000000000),3)</pre>
<pre class="source-code">        for i in couponId:</pre>
<pre class="source-code">            print(\</pre>
<pre class="source-code">             '***********------------------**************')</pre>
<pre class="source-code">            print('Product:',product)</pre>
<pre class="source-code">            print('Product Category:', product_category)</pre>
<pre class="source-code">            print('Coupon ID:', i)</pre>
<pre class="source-code">            print('Brand:', brand)</pre>
<pre class="source-code">            print('Source:',  source)</pre>
<pre class="source-code">            print('Expiry Date:',  expiry_date)</pre>
<pre class="source-code">            print('Quantity:',  quantity)</pre>
<pre class="source-code">            print(\</pre>
<pre class="source-code">             '***********------------------**************')</pre>
<pre class="source-code">    return generate_coupon</pre>
<p>Let’s now <a id="_idIndexMarker296"/>check whether the <strong class="source-inline">SimpleCoupon</strong> class is callable and if it is callable, we will add a <strong class="source-inline">coupon_details</strong> variable to<a id="_idIndexMarker297"/> provide all the <a id="_idIndexMarker298"/>required input parameters to initialize<a id="_idIndexMarker299"/> the call:</p>
<pre class="source-code">if callable(SimpleCoupon):</pre>
<pre class="source-code">    SimpleCoupon.coupon_details = {</pre>
<pre class="source-code">                          "product": "Honey Mustard Sauce",</pre>
<pre class="source-code">                          "product_category": "Condiments",</pre>
<pre class="source-code">                          "brand": "ABCBrand3",</pre>
<pre class="source-code">                          "source": "Pasadena Store",</pre>
<pre class="source-code">                          "expiry_date": "10/1/2021",</pre>
<pre class="source-code">                          "quantity": 2}</pre>
<p>In the next step, let’s check on how to create a method dynamically and add it to the class if the class is callable. To add the <strong class="source-inline">generate_coupon</strong> method to the <strong class="source-inline">SimpleCoupon</strong> class, let’s call the <strong class="source-inline">create_coupon</strong> function:</p>
<pre class="source-code">if callable(SimpleCoupon):</pre>
<pre class="source-code">    SimpleCoupon.generate_coupon = create_coupon(SimpleCoupon.coupon_details['product'], SimpleCoupon.coupon_details['product_category'],                                                SimpleCoupon.coupon_details['brand'], SimpleCoupon.coupon_details['source'],                                                SimpleCoupon.coupon_details['expiry_date'],SimpleCoupon.coupon_details['quantity'])</pre>
<p>After adding the <strong class="source-inline">generate_coupon</strong> method, we can run the method as follows and check the results:</p>
<pre class="source-code">SimpleCoupon.generate_coupon(SimpleCoupon.coupon_details['product'], SimpleCoupon.coupon_details['product_category'],                              SimpleCoupon.coupon_details['brand'], SimpleCoupon.coupon_details['source'],                             SimpleCoupon.coupon_details['expiry_date'], SimpleCoupon.coupon_details['quantity'])</pre>
<p>The <a id="_idIndexMarker300"/>output for <a id="_idIndexMarker301"/>coupon 1 is <a id="_idIndexMarker302"/>as<a id="_idIndexMarker303"/> follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Honey Mustard Sauce</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Condiments</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 579494488135</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand3</strong></pre>
<pre class="source-code"><strong class="bold">Source: Pasadena Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 2 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Honey Mustard Sauce</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Condiments</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 657317674875</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand3</strong></pre>
<pre class="source-code"><strong class="bold">Source: Pasadena Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>The output for coupon 3 is as follows:</p>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Honey Mustard Sauce</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Condiments</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 689256610872</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand3</strong></pre>
<pre class="source-code"><strong class="bold">Source: Pasadena Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 2</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>In this <a id="_idIndexMarker304"/>section, we have looked at how to<a id="_idIndexMarker305"/> make use of <strong class="source-inline">callable</strong> to <a id="_idIndexMarker306"/>modify a class and add attributes and methods<a id="_idIndexMarker307"/> to a class by externally verifying whether the class is callable. We have successfully verified whether the <strong class="source-inline">SimpleCoupon</strong> class is callable and then we have also added a <strong class="source-inline">coupon_details</strong> list and a <strong class="source-inline">generate_coupon</strong> method to the class. This explains the use of <strong class="source-inline">callable</strong> as a built-in function in handling reflection on Python objects.</p>
<p>With this understanding, we will look at how the <strong class="source-inline">hasattr</strong> function helps in applying reflection on Python objects.</p>
<h1 id="_idParaDest-83"><a id="_idTextAnchor085"/>Using hasattr to set values</h1>
<p>We <a id="_idIndexMarker308"/>will now look into the <strong class="source-inline">hasattr</strong> function, which can <a id="_idIndexMarker309"/>be used to check whether a Python object has attributes. Using this function as a condition to test the objects, we can apply reflection on objects externally.</p>
<p>In this example, we will look at creating custom coupons by changing one of its variables using the <strong class="source-inline">hasattr</strong> function. The classes and methods throughout this chapter are used to understand reflection with relevant examples explained under each section. We will now create <a id="_idIndexMarker310"/>another class named <strong class="source-inline">CustomCoupon</strong>. We will add and define class attributes to this class within the class itself and we will be adding a method to generate coupons: </p>
<pre class="source-code">class CustomCoupon:</pre>
<pre class="source-code">    product_name = "Honey Mustard Sauce"</pre>
<pre class="source-code">    product_category = "Condiments"</pre>
<pre class="source-code">    brand = "ABCBrand3"</pre>
<pre class="source-code">    source = "Store"</pre>
<pre class="source-code">    expiry_date = "10/1/2021"</pre>
<pre class="source-code">    quantity = 10</pre>
<pre class="source-code">    manufacturer = None</pre>
<pre class="source-code">    store = None</pre>
<pre class="source-code">    </pre>
<pre class="source-code">    def generate_coupon(self):</pre>
<pre class="source-code">        import random</pre>
<pre class="source-code">        couponId =  random.sample(</pre>
<pre class="source-code">          range(100000000000,900000000000),1)</pre>
<pre class="source-code">        for i in couponId:</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<pre class="source-code">            print('Product:', self.product_name)</pre>
<pre class="source-code">            print('Product Category:', </pre>
<pre class="source-code">              self.product_category)</pre>
<pre class="source-code">            print('Coupon ID:', i)</pre>
<pre class="source-code">            print('Brand:', self.brand)</pre>
<pre class="source-code">            print('Source:', self.source)</pre>
<pre class="source-code">            print('Expiry Date:', self.expiry_date)</pre>
<pre class="source-code">            print('Quantity:', self.quantity)</pre>
<pre class="source-code">            if(self.manufacturer is not None):</pre>
<pre class="source-code">                print('Manufacturer:', self.manufacturer)</pre>
<pre class="source-code">            elif(self.store is not None):</pre>
<pre class="source-code">                print('Store:', self.store)</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<p>Look at three <a id="_idIndexMarker311"/>attributes of the preceding class – <strong class="source-inline">source</strong>, <strong class="source-inline">manufacturer</strong>, and <strong class="source-inline">store</strong>. If we want to change the behavior of these attributes from outside the class, we can do so by first checking whether the class has these attributes, and when the attributes are present, we can then modify the behavior of these attributes. Let’s look at how to perform this using the <strong class="source-inline">hasattr</strong> function. We will first start with creating an object for the class:</p>
<pre class="source-code">coupon = CustomCoupon()</pre>
<p>Let’s check whether the object coupon has an attribute named <strong class="source-inline">source</strong>, and if it is present, then we will get the value of the attribute:</p>
<pre class="source-code">if hasattr(coupon, 'source'):</pre>
<pre class="source-code">    print(getattr(coupon, 'source'))</pre>
<p class="source-code">Store</p>
<p>Let’s now proceed with calling the method to generate the coupon:</p>
<pre class="source-code">coupon.generate_coupon()</pre>
<p class="source-code">***********------------------**************</p>
<p class="source-code">Product: Honey Mustard Sauce</p>
<p class="source-code">Product Category: Condiments</p>
<p class="source-code">Coupon ID: 728417424745</p>
<p class="source-code">Brand: ABCBrand3</p>
<p class="source-code">Source: Store</p>
<p class="source-code">Expiry Date: 10/1/2021</p>
<p class="source-code">Quantity: 10</p>
<p class="source-code">***********------------------**************</p>
<p>The<a id="_idIndexMarker312"/> implementation of reflection on the object coupon will start in the following code. We will create a <strong class="source-inline">check_attribute</strong> function that takes in three parameters. The first parameter is the class object’s name followed by the <strong class="source-inline">store</strong> attribute and then the <strong class="source-inline">manufacturer</strong> attribute. This function checks whether the given input object has the attribute named <strong class="source-inline">source</strong> with a <strong class="source-inline">Store</strong> value, and when it returns <strong class="source-inline">true</strong>, it sets a value for the attribute store, and when it returns <strong class="source-inline">false</strong>, it sets <strong class="source-inline">None</strong> as the value for the attribute store. Similarly, when the <strong class="source-inline">source</strong> attribute has a <strong class="source-inline">Manufacturer</strong> value, then the value is set for another attribute manufacturer, as follows:</p>
<pre class="source-code">def check_attribute(couponobj, store, manufacturer):</pre>
<pre class="source-code">    if hasattr(couponobj, 'source'):</pre>
<pre class="source-code">        if(str(getattr(couponobj, 'source')) == 'Store'):</pre>
<pre class="source-code">            setattr(couponobj, 'store', store)</pre>
<pre class="source-code">        else:</pre>
<pre class="source-code">            setattr(couponobj, 'store', None)</pre>
<pre class="source-code">        if(str(getattr(couponobj,'source')) == </pre>
<pre class="source-code">          'Manufacturer'):</pre>
<pre class="source-code">            setattr(couponobj, 'manufacturer', </pre>
<pre class="source-code">              manufacturer)</pre>
<pre class="source-code">        else:</pre>
<pre class="source-code">            setattr(couponobj, 'manufacturer', None)    </pre>
<p>Let’s now check the value of the <strong class="source-inline">source</strong> attribute:</p>
<pre class="source-code">coupon.source</pre>
<p class="source-code">'Store'</p>
<p>We can <a id="_idIndexMarker313"/>now call <strong class="source-inline">check_attribute</strong> to add a store and let’s also add a manufacturer. Since the source has been set to <strong class="source-inline">Store</strong>, the function should set the value for the <strong class="source-inline">store</strong> variable and not for the <strong class="source-inline">manufacturer</strong> variable:</p>
<pre class="source-code">check_attribute(coupon,"Brooklyn Store", "XYZ Manufacturer")</pre>
<pre class="source-code">coupon.generate_coupon()</pre>
<p class="source-code">***********------------------**************</p>
<p class="source-code">Product: Honey Mustard Sauce</p>
<p class="source-code">Product Category: Condiments</p>
<p class="source-code">Coupon ID: 220498341601</p>
<p class="source-code">Brand: ABCBrand3</p>
<p class="source-code">Source: Store</p>
<p class="source-code">Expiry Date: 10/1/2021</p>
<p class="source-code">Quantity: 10</p>
<p class="source-code">Store: Brooklyn Store</p>
<p class="source-code">***********------------------**************</p>
<p>Let’s now reset the <strong class="source-inline">source</strong> value to <strong class="source-inline">Manufacturer</strong> and run <strong class="source-inline">check_attribute</strong> again:</p>
<pre class="source-code">coupon.source = 'Manufacturer'</pre>
<pre class="source-code">check_attribute(coupon,"Brooklyn Store", "XYZ Manufacturer")</pre>
<pre class="source-code">coupon.manufacturer</pre>
<p class="source-code">'XYZ Manufacturer'</p>
<p>Let’s now check what has happened to the <strong class="source-inline">store</strong> variable:</p>
<pre class="source-code">coupon.store</pre>
<p>It <a id="_idIndexMarker314"/>returns no value. Resetting the source to <strong class="source-inline">Store</strong> again sets the <strong class="source-inline">store</strong> value and resets <strong class="source-inline">manufacturer</strong> as follows:</p>
<pre class="source-code">coupon.source = 'Store'</pre>
<pre class="source-code">check_attribute(coupon,"Malibu Store", "XYZ Manufacturer")</pre>
<pre class="source-code">coupon.generate_coupon()</pre>
<pre class="source-code">***********------------------**************</pre>
<pre class="source-code">Product: Honey Mustard Sauce</pre>
<pre class="source-code">Product Category: Condiments</pre>
<pre class="source-code">Coupon ID: 498746188585</pre>
<pre class="source-code">Brand: ABCBrand3</pre>
<pre class="source-code">Source: Store</pre>
<pre class="source-code">Expiry Date: 10/1/2021</pre>
<pre class="source-code">Quantity: 10</pre>
<pre class="source-code">Store: Malibu Store</pre>
<pre class="source-code">***********------------------**************</pre>
<p>In this example, we looked at implementing the <strong class="source-inline">hasattr</strong> function on <em class="italic">ABC Megamart</em> coupon information. This example explains reflection using the <strong class="source-inline">hasattr</strong> function. With this understanding, let’s proceed further to look at <strong class="source-inline">isinstance</strong>.</p>
<h1 id="_idParaDest-84"><a id="_idTextAnchor086"/>Using isinstance to modify an object</h1>
<p>We will<a id="_idIndexMarker315"/> now look at another built-in function named <strong class="source-inline">isinstance</strong>. This<a id="_idIndexMarker316"/> function <a id="_idIndexMarker317"/>is used to identify whether an object is an instance of a class. We will be implementing reflection on class objects by checking whether they are instances of a specific class and then customizing the object of the class accordingly. This example uses the same attributes (<strong class="source-inline">source</strong>, <strong class="source-inline">store</strong>, and <strong class="source-inline">manufacturer</strong>) as in the preceding example of the <strong class="source-inline">hasattr</strong> function.</p>
<p>To begin with, let’s <a id="_idIndexMarker318"/>create two objects for two<a id="_idIndexMarker319"/> different classes and apply the <strong class="source-inline">isinstance</strong> function to the objects of the classes to understand how this function can help in changing the behavior of Python objects. We will be reusing the <strong class="source-inline">CustomCoupon</strong> class from the preceding section and we will also be creating another <strong class="source-inline">SimpleCoupon</strong> class. We will then add two objects, <strong class="source-inline">coupon1</strong> and <strong class="source-inline">coupon2</strong>, as follows:</p>
<pre class="source-code">coupon1 = CustomCoupon()</pre>
<pre class="source-code">class SimpleCoupon:</pre>
<pre class="source-code">    product_name = "Strawberry Ice Cream"</pre>
<pre class="source-code">    product_category = "Desserts"</pre>
<pre class="source-code">    brand = "ABCBrand3"</pre>
<pre class="source-code">    store = "Los Angeles Store"</pre>
<pre class="source-code">    expiry_date = "10/1/2021"</pre>
<pre class="source-code">    quantity = 10</pre>
<pre class="source-code">coupon2 = SimpleCoupon()</pre>
<p>In the following figure, let’s look at the attributes of each object:</p>
<div>
<div class="IMG---Figure" id="_idContainer076">
<img alt="Figure 6.2 – Attributes of the coupon 1 and coupon 2 objects " height="305" src="image/Figure_6.2_B13426.jpg" width="761"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.2 – Attributes of the coupon 1 and coupon 2 objects</p>
<p>Let’s now check whether the objects are instances of a specific class using the <strong class="source-inline">isinstance</strong> function:</p>
<pre class="source-code">isinstance(coupon1,CustomCoupon)</pre>
<p class="source-code">True</p>
<pre class="source-code">isinstance(coupon2,SimpleCoupon)</pre>
<p class="source-code">True</p>
<p>We will <a id="_idIndexMarker320"/>now <a id="_idIndexMarker321"/>define a function named <strong class="source-inline">check_instance</strong>, which makes use of <strong class="source-inline">isinstance</strong> to implement reflection that customizes the object externally. This function takes an object, a class name, a <strong class="source-inline">store</strong> value, and a <strong class="source-inline">manufacturer</strong> value as input parameters and checks whether the object is an instance of a specific coupon class, and also checks whether it has the attribute named <strong class="source-inline">source</strong> and updates the <strong class="source-inline">store</strong> or <strong class="source-inline">manufacturer</strong> values accordingly. If none of these conditions are met, it returns a message that the object cannot be customized:</p>
<pre class="source-code">def check_instance(couponobject, couponclass, store, manufacturer):</pre>
<pre class="source-code">    if isinstance(couponobject, couponclass):</pre>
<pre class="source-code">        if hasattr(couponobject, 'source'):</pre>
<pre class="source-code">            if(str(getattr(couponobject, 'source')) == </pre>
<pre class="source-code">              'Store'):</pre>
<pre class="source-code">                setattr(couponobject, 'store', store)</pre>
<pre class="source-code">            else:</pre>
<pre class="source-code">                setattr(couponobject, 'store', None)</pre>
<pre class="source-code">            if(str(getattr(couponobject,'source')) == </pre>
<pre class="source-code">              'Manufacturer'):</pre>
<pre class="source-code">                setattr(couponobject,'manufacturer', </pre>
<pre class="source-code">                  manufacturer)</pre>
<pre class="source-code">            else:</pre>
<pre class="source-code">                setattr(couponobject,'manufacturer', None)</pre>
<pre class="source-code">    else:</pre>
<pre class="source-code">        print(couponobject,'cannot be customized')</pre>
<p>Let’s now<a id="_idIndexMarker322"/> call <strong class="source-inline">check_instance</strong> on the <strong class="source-inline">coupon1</strong> object and see whether the <strong class="source-inline">store</strong> value is updated in<a id="_idIndexMarker323"/> the object:</p>
<pre class="source-code">check_instance(coupon1, CustomCoupon, 'Malibu Beach Store', 'XYZ Manufacturer')</pre>
<pre class="source-code">coupon1.store</pre>
<pre class="source-code"><strong class="bold">'Malibu Beach Store'</strong></pre>
<pre class="source-code">coupon1.generate_coupon()</pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Honey Mustard Sauce</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Condiments</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 535933905876</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand3</strong></pre>
<pre class="source-code"><strong class="bold">Source: Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 10</strong></pre>
<pre class="source-code"><strong class="bold">Store: Malibu Beach Store</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>Let’s further call <strong class="source-inline">check_instance</strong> on the <strong class="source-inline">coupon2</strong> object and check whether the object is customized:</p>
<pre class="source-code">check_instance(coupon2, CustomCoupon, 'Malibu Beach Store', 'XYZ Manufacturer')</pre>
<pre class="source-code"><strong class="bold">&lt;__main__.SimpleCoupon object at 0x0000023B51AD2B88&gt; cannot be customized</strong></pre>
<p>In the <a id="_idIndexMarker324"/>preceding object, the conditions<a id="_idIndexMarker325"/> specified in <strong class="source-inline">check_instance</strong> were not met and so the object could not be customized.</p>
<p>This example explains reflection using the <strong class="source-inline">isinstance</strong> function. With this understanding, let’s proceed further to look at <strong class="source-inline">issubclass</strong>.</p>
<h1 id="_idParaDest-85"><a id="_idTextAnchor087"/>Using issubclass to modify a class</h1>
<p>In this<a id="_idIndexMarker326"/> section, we will look at the <strong class="source-inline">issubclass</strong> built-in function. This function can be used to apply reflection on classes that are inherited by one or more <a id="_idIndexMarker327"/>parent classes or superclasses. This<a id="_idIndexMarker328"/> function is used to verify whether a class is a subclass of a specific parent and then modify the class accordingly. </p>
<p>Let’s begin by creating two classes with a simple set of variables. The classes will be named <strong class="source-inline">StoreCoupon</strong> and <strong class="source-inline">ManufacturerCoupon</strong>:</p>
<pre class="source-code">class StoreCoupon:</pre>
<pre class="source-code">    product_name = "Strawberry Ice Cream"</pre>
<pre class="source-code">    product_category = "Desserts"</pre>
<pre class="source-code">    brand = "ABCBrand3"</pre>
<pre class="source-code">    store = "Los Angeles Store"</pre>
<pre class="source-code">    expiry_date = "10/1/2021"</pre>
<pre class="source-code">    quantity = 10</pre>
<pre class="source-code">class ManufacturerCoupon:</pre>
<pre class="source-code">    product_name = "Strawberry Ice Cream"</pre>
<pre class="source-code">    product_category = "Desserts"</pre>
<pre class="source-code">    brand = "ABCBrand3"</pre>
<pre class="source-code">    manufacturer = "ABC Manufacturer"</pre>
<pre class="source-code">    expiry_date = "10/1/2021"</pre>
<pre class="source-code">    quantity = 10</pre>
<p>We will also <a id="_idIndexMarker329"/>create two functions that in turn create<a id="_idIndexMarker330"/> new functions to generate <strong class="source-inline">store coupon</strong> and <strong class="source-inline">manufacturer coupon</strong>, respectively:</p>
<pre class="source-code">def create_store_coupon(product_name, product_category, brand, store, expiry_date, quantity):</pre>
<pre class="source-code">    def generate_store_coupon(product_name, </pre>
<pre class="source-code">      product_category, brand, store, expiry_date, </pre>
<pre class="source-code">      quantity):</pre>
<pre class="source-code">        import random</pre>
<pre class="source-code">        couponId =  random.sample(</pre>
<pre class="source-code">          range(100000000000,900000000000),1)</pre>
<pre class="source-code">        for i in couponId:</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<pre class="source-code">            print('Product:', product_name)</pre>
<pre class="source-code">            print('Product Category:', product_category)</pre>
<pre class="source-code">            print('Coupon ID:', i)</pre>
<pre class="source-code">            print('Brand:', brand)</pre>
<pre class="source-code">            print('Store:', store)</pre>
<pre class="source-code">            print('Expiry Date:', expiry_date)</pre>
<pre class="source-code">            print('Quantity:', quantity)</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<pre class="source-code">    return generate_store_coupon</pre>
<pre class="source-code">def create_manufacturer_coupon(product_name, product_category, brand, manufacturer, expiry_date, quantity):</pre>
<pre class="source-code">    def generate_manufacturer_coupon(product_name, product_category, brand, manufacturer, expiry_date, quantity):</pre>
<pre class="source-code">        import random</pre>
<pre class="source-code">        couponId =  random.sample(</pre>
<pre class="source-code">          range(100000000000,900000000000),1)</pre>
<pre class="source-code">        for i in couponId:</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<pre class="source-code">            print('Product:', product_name)</pre>
<pre class="source-code">            print('Product Category:', product_category)</pre>
<pre class="source-code">            print('Coupon ID:', i)</pre>
<pre class="source-code">            print('Brand:', brand)</pre>
<pre class="source-code">            print('Manufacturer:', manufacturer)</pre>
<pre class="source-code">            print('Expiry Date:', expiry_date)</pre>
<pre class="source-code">            print('Quantity:', quantity)</pre>
<pre class="source-code">            print('***********------------------**************')</pre>
<pre class="source-code">    return generate_manufacturer_coupon</pre>
<p>We <a id="_idIndexMarker331"/>will further create a new class named <strong class="source-inline">IceCreamCoupon</strong>, which<a id="_idIndexMarker332"/> inherits <strong class="source-inline">StoreCoupon</strong> as the parent:</p>
<pre class="source-code">class IceCreamCoupon(StoreCoupon):</pre>
<pre class="source-code">    pass</pre>
<p>Let’s now define a function to check whether a specific class is the parent class of <strong class="source-inline">IceCreamCoupon</strong>. If the subclass has <strong class="source-inline">StoreCoupon</strong> as a parent class, a function to generate <strong class="source-inline">StoreCoupon</strong> should be created, and if it has <strong class="source-inline">ManufacturerCoupon</strong> as a parent class, then <a id="_idIndexMarker333"/>a function to generate <strong class="source-inline">ManufacturerCoupon</strong> should be created:</p>
<pre class="source-code"> def check_parent():</pre>
<pre class="source-code">    if issubclass(IceCreamCoupon, StoreCoupon):</pre>
<pre class="source-code">        IceCreamCoupon.generate_store_coupon = create_store_coupon(IceCreamCoupon.product_name,                                                                    IceCreamCoupon.product_category,                                                                   IceCreamCoupon.brand, IceCreamCoupon.store,                                                                   IceCreamCoupon.expiry_date, IceCreamCoupon.quantity)</pre>
<pre class="source-code">    elif issubclass(IceCreamCoupon, ManufacturerCoupon):</pre>
<pre class="source-code">        IceCreamCoupon.generate_manufacturer_coupon = create_manufacturer_coupon(IceCreamCoupon.product_name,                                                                                  IceCreamCoupon.product_category,                                                                                 IceCreamCoupon.brand,                                                                                  IceCreamCoupon.manufacturer,                                                                                 IceCreamCoupon.expiry_date,                                                                                  IceCreamCoupon.quantity)</pre>
<p>Running <strong class="source-inline">check_parent</strong> will <a id="_idIndexMarker334"/>now add <strong class="source-inline">generate_store_coupon</strong> to the <strong class="source-inline">IceCreamCoupon</strong> class, as follows:</p>
<pre class="source-code">check_parent()</pre>
<pre class="source-code">IceCreamCoupon.generate_store_coupon(IceCreamCoupon.product_name, IceCreamCoupon.product_category,                                     IceCreamCoupon.brand,IceCreamCoupon.store,                                     IceCreamCoupon.expiry_date,IceCreamCoupon.quantity)</pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Strawberry Ice Cream</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Desserts</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 548296039957</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand3</strong></pre>
<pre class="source-code"><strong class="bold">Store: Los Angeles Store</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 10</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code">class IceCreamCoupon(ManufacturerCoupon):</pre>
<pre class="source-code">    pass</pre>
<pre class="source-code">check_parent()</pre>
<pre class="source-code">IceCreamCoupon.generate_manufacturer_coupon(IceCreamCoupon.product_name,IceCreamCoupon.product_category,                                            IceCreamCoupon.brand,IceCreamCoupon.manufacturer,                                            IceCreamCoupon.expiry_date,IceCreamCoupon.quantity)</pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<pre class="source-code"><strong class="bold">Product: Strawberry Ice Cream</strong></pre>
<pre class="source-code"><strong class="bold">Product Category: Desserts</strong></pre>
<pre class="source-code"><strong class="bold">Coupon ID: 193600674937</strong></pre>
<pre class="source-code"><strong class="bold">Brand: ABCBrand3</strong></pre>
<pre class="source-code"><strong class="bold">Manufacturer: ABC Manufacturer</strong></pre>
<pre class="source-code"><strong class="bold">Expiry Date: 10/1/2021</strong></pre>
<pre class="source-code"><strong class="bold">Quantity: 10</strong></pre>
<pre class="source-code"><strong class="bold">***********------------------**************</strong></pre>
<p>In this example, we looked at how to make use of the <strong class="source-inline">issubclass</strong> function to implement <a id="_idIndexMarker335"/>reflection on Python classes and, in turn, modify the classes from a metaprogram rather<a id="_idIndexMarker336"/> than directly changing the function definition. With this understanding, we will look at the last section of this chapter on implementing property on a class.</p>
<h1 id="_idParaDest-86"><a id="_idTextAnchor088"/>Applying property on a class</h1>
<p>In this section, we <a id="_idIndexMarker337"/>will look at the usage of <strong class="source-inline">property</strong>, which is another <a id="_idIndexMarker338"/>built-in function that can be added as a decorator in a class and can update the properties of the methods of the class by implementing the <strong class="source-inline">getter</strong>, <strong class="source-inline">setter</strong>, and <strong class="source-inline">delete</strong> methods on a class method. In <a href="B13426_05_Final_PG_epub.xhtml#_idTextAnchor068"><em class="italic">Chapter 5</em></a>, we looked at the usage of <strong class="source-inline">property</strong> as a function. In this section, we will implement <strong class="source-inline">property</strong> in an example to check how it works on reflection. We will be looking at the same coupon example to understand this.</p>
<p>Let’s now create a new class and name it <strong class="source-inline">CouponwithProperty</strong>, initialize the class with a <strong class="source-inline">_coupon_details</strong> variable, and set it to <strong class="source-inline">none</strong>. We will then add <strong class="source-inline">property</strong> as a decorator and define a <strong class="source-inline">coupon_details</strong> method and add <strong class="source-inline">getter</strong>, <strong class="source-inline">setter</strong>, and <strong class="source-inline">delete</strong> to get, set, and delete values for the coupon details. In this example, we will define <strong class="source-inline">getter</strong> to get coupon details and <strong class="source-inline">setter</strong> to set coupon details, but we will define <strong class="source-inline">deleter</strong> in such a way that <strong class="source-inline">coupon_details</strong> can never be deleted. This is possible through reflection:</p>
<pre class="source-code">class CouponwithProperty:</pre>
<pre class="source-code">    def __init__(self):</pre>
<pre class="source-code">        self._coupon_details = None</pre>
<pre class="source-code">    @property</pre>
<pre class="source-code">    def coupon_details(self):</pre>
<pre class="source-code">        return self.coupon_details    </pre>
<pre class="source-code">    @coupon_details.getter</pre>
<pre class="source-code">    def coupon_details(self):</pre>
<pre class="source-code">        print("get coupon_details")</pre>
<pre class="source-code">        return self._coupon_details</pre>
<pre class="source-code">    @coupon_details.setter</pre>
<pre class="source-code">    def coupon_details(self, coupon):</pre>
<pre class="source-code">        print("set coupon_details")</pre>
<pre class="source-code">        self._coupon_details = coupon</pre>
<pre class="source-code">    @coupon_details.deleter</pre>
<pre class="source-code">    def coupon_details(self):</pre>
<pre class="source-code">        print("Sorry this attribute cannot be </pre>
<pre class="source-code">          deleted")      </pre>
<p>Let’s now create <a id="_idIndexMarker339"/>an object for the preceding class:</p>
<pre class="source-code">fmcgCoupon = CouponwithProperty()</pre>
<p>We can<a id="_idIndexMarker340"/> test whether <strong class="source-inline">getter</strong> is working by calling the <strong class="source-inline">coupon_details</strong> attribute:</p>
<pre class="source-code">fmcgCoupon.coupon_details</pre>
<pre class="source-code"><strong class="bold">get coupon_details</strong></pre>
<p>Similarly, we can check whether <strong class="source-inline">setter</strong> is working by setting a value for the <strong class="source-inline">coupon_details</strong> attribute:</p>
<pre class="source-code">fmcgCoupon.coupon_details = {</pre>
<pre class="source-code">        'Product': 'Strawberry Ice Cream',</pre>
<pre class="source-code">        'Product Category': 'Desserts',</pre>
<pre class="source-code">        'Coupon ID': 190537749828,</pre>
<pre class="source-code">        'Brand': 'ABCBrand3',</pre>
<pre class="source-code">        'Manufacturer': 'ABCBrand3',</pre>
<pre class="source-code">        'Expiry Date': 'ABC Manufacturer',</pre>
<pre class="source-code">        'Quantity': '10/1/2021'</pre>
<pre class="source-code">        }</pre>
<pre class="source-code"><strong class="bold">set coupon_details</strong></pre>
<p>Calling <strong class="source-inline">getter</strong> again<a id="_idIndexMarker341"/> after setting the values will result <a id="_idIndexMarker342"/>in the following:</p>
<pre class="source-code">fmcgCoupon.coupon_details</pre>
<pre class="source-code"><strong class="bold">get coupon_details</strong></pre>
<pre class="source-code"><strong class="bold">{'Product': 'Strawberry Ice Cream',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Product Category': 'Desserts',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Coupon ID': 190537749828,</strong></pre>
<pre class="source-code"><strong class="bold"> 'Brand': 'ABCBrand3',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Manufacturer': 'ABCBrand3',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Expiry Date': 'ABC Manufacturer',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Quantity': '10/1/2021'}</strong></pre>
<p>The most important change we made on the attribute was disabling the <strong class="source-inline">delete</strong> operation from happening by setting <strong class="source-inline">deleter</strong>. Let’s check whether it is working as expected:</p>
<pre class="source-code">del fmcgCoupon.coupon_details</pre>
<pre class="source-code"><strong class="bold">Sorry this attribute cannot be deleted</strong></pre>
<pre class="source-code">fmcgCoupon.coupon_details</pre>
<pre class="source-code"><strong class="bold">get coupon_details</strong></pre>
<pre class="source-code"><strong class="bold">{'Product': 'Strawberry Ice Cream',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Product Category': 'Desserts',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Coupon ID': 190537749828,</strong></pre>
<pre class="source-code"><strong class="bold"> 'Brand': 'ABCBrand3',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Manufacturer': 'ABCBrand3',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Expiry Date': 'ABC Manufacturer',</strong></pre>
<pre class="source-code"><strong class="bold"> 'Quantity': '10/1/2021'}</strong></pre>
<p>When we <a id="_idIndexMarker343"/>call <strong class="source-inline">del</strong> on an attribute, it deletes the attribute but, in<a id="_idIndexMarker344"/> this case, <strong class="source-inline">del</strong> is unable to delete the attribute because we have programmed <strong class="source-inline">deleter</strong> to disable deletion.</p>
<p>These are some of the examples of how reflection can be applied to Python objects using Python’s built-in functions. </p>
<h1 id="_idParaDest-87"><a id="_idTextAnchor089"/>Summary</h1>
<p>In this chapter, we have learned how to examine function objects in Python using the concept of reflection and the corresponding applications of reflection, in which we saw how to implement reflection using built-in functions such as <strong class="source-inline">id</strong>, <strong class="source-inline">callable</strong>, <strong class="source-inline">hasattr</strong>, <strong class="source-inline">isinstance</strong>, <strong class="source-inline">issubclass</strong>, and <strong class="source-inline">property</strong> on various Python objects, and we also learned how to apply them to our core example. From all of these concepts, we learned how to examine Python objects such as classes, methods, and functions. From the examples covered under each topic, we also learned how to apply reflection in practical use cases.</p>
<p>Similar to other chapters covered in this book, this chapter, which covered the concept of reflection, also covered changing the behavior of Python objects externally using metaprogramming.</p>
<p>In the next chapter, we will be looking at the concept of <em class="italic">generics</em> with some interesting examples.</p>
</div>
</div></body></html>