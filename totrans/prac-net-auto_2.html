<html><head></head><body>
        

                            
                    <h1 class="header-title">Python for Network Engineers</h1>
                
            
            
                
<p class="mce-root">As we are now familiar with how to write a program using the concepts used in programming languages, as well as best practices, now let's dig deep into writing an actual Python program or script. Keeping the primary focus on how to write a program in Python, we will also see how to write the same program in PowerShell, since there might be times where we would need to use PowerShell to achieve the results that we are looking for. We will cover various aspects of creating a program with some explanations of each of the statements and provide some tips and tricks to get through those tricky situations.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Python interpreter and data types</li>
<li>Writing Python scripts using conditional loops</li>
<li>Functions</li>
<li>Installing new modules/libraries</li>
<li>Passing arguments from command line for scripts</li>
<li>Using Netmiko to interact with network devices</li>
<li>Multithreading</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Python interpreter and data types</h1>
                
            
            
                
<p>An interpreter, as the name suggests, is used to interpret instructions so that they are understandable by others. In our case, it is used to convert our Python language to a machine-understandable format that governs the flow of instructions that we gave to the machine.</p>
<p>It is also used to convert the set of values and messages given by a machine to a human-readable format in order to give us insights into how our program is being executed.</p>
<p>As mentioned in <a href="864fa562-ce4b-4b1f-a418-f91c2ac56f1f.xhtml" target="_blank">Chapter 1</a>, <em>Fundamental Concepts</em>, the interpreter that we are focusing on is Python 3.6. I will be using it on the Windows platform, but the site has clear instructions on how to download and install the same on other OS like Unix or Linux machines. Once we install it by downloading it from the Python community  which can be found at URL <a href="https://www.python.org/downloads" target="_blank">https://www.python.org/downloads</a>, we can simply click on the setup file to install it. From the installation directory we just need to invoke <kbd>python.exe</kbd>, which will invoke the Python interpreter.</p>
<p>In order to call Python from anywhere in your Command Prompt, just add the Python installation folder in your PATH variable.<br/>
Here's an example: <kbd>set path=%path%;C:\python36</kbd>. This is going to add the Python36 path in the current path. Once this is done, <kbd>python.exe</kbd> can be called from anywhere in the Command Prompt.</p>
<p>Once we invoke the interpreter, the first step to take is to create a variable and assign a value to it.</p>
<p>Python, as with any other programming language, supports various data types for the variables. A data type typically defines the type of value that can be stored in a variable, but Python and PowerShell have the ability to auto-evaluate the type of variable based upon the value. Python supports a large number of data types, but typically in our daily usage we refer to native data types multiple times.</p>
<p>The Python data type supports:</p>
<ul>
<li><strong>Numbers</strong>: These are integer types, such as 1, 2, 100, and 1,000.</li>
<li><strong>String</strong>: These are single or multiple characters and possibly every letter of ASCII, such as Python, network, age123, and India. Additionally, a string needs to be stored inside a double quote (<kbd>"</kbd>) or a single quote (<kbd>'</kbd>) to specify that a value is a string. Hence, <kbd>1</kbd> and <kbd>'1'</kbd> would be interpreted differently by Python.</li>
<li><strong>Boolean</strong>: This can be either a true or a false value.</li>
<li><strong>Byte</strong>: These are typically binary values.</li>
<li><strong>Lists</strong>: These are an ordered sequence of values.</li>
<li><strong>Tuples</strong>: These are similar to lists, but the values or length cannot be altered.</li>
<li><strong>Sets</strong>: These are similar to lists, but not ordered.</li>
<li><strong>Dictionary</strong> or <strong>hash</strong> <strong>values</strong>: These are key-value pairs, like a telephone directory in which one primary value (name) is attached with both phone numbers and addresses.</li>
</ul>
<p>An example on data types is as follows:</p>
<div><img src="img/c2474970-452c-46e0-b805-55f593a095d6.jpg"/></div>
<p>As we can see in the preceding example, we declared the variables with various values, and based upon the value, Python automatically interprets the specific data type. If we just type the variable name again, it prints out the value stored in the variable based upon its data type.</p>
<p>Similarly, the following example specifies other native data types:</p>
<div><img class="alignnone size-full wp-image-134 image-border" src="img/67d39b74-ca58-4e21-881e-a2592fe25836.png" style="width:41.33em;height:19.92em;"/></div>
<p>Additionally, to see the data type we can use the <kbd>type()</kbd> function, which returns the type of a variable based upon the value we gave. The variable is passed as an argument to the <kbd>type()</kbd> function to get the data type value:</p>
<div><img class="alignnone size-full wp-image-135 image-border" src="img/034db3f3-17cb-44ed-8d5a-57fddeea6b8d.png" style="width:42.00em;height:10.58em;"/></div>
<p class="mce-root">A PowerShell example of the same Python code is as follows:</p>
<pre>#PowerShell code<br/>$value=5<br/>$value="hello"<br/>write-host $value<br/>write-host $value.gettype()<br/>#This is remark<br/>#A variable in powershell is declared with '$' sign in front.<br/># The gettype() function in powershell is used to get the type of variable.<br/><br/></pre>
<p>There are operations, such as addition (<kbd>+</kbd>), for specific variables with particular data types. We have to be sure what types of variable we are adding. If we have an incompatible data type variable being added to another one, Python would throw an error stating the reason.</p>
<p>Here in the following code, we see the result of adding two string variables:</p>
<div><img src="img/6cd58d98-458f-41c4-9183-d08529901ace.jpg"/></div>
<p>Similarly, observe the difference if we use the same addition on integer variables:</p>
<div><img src="img/ddcd7f1c-857a-4917-bc41-eb6872f455de.jpg"/></div>
<p>As mentioned, let's see what happens when we try to add a string and an integer variable together:</p>
<div><img class="alignnone size-full wp-image-136 image-border" src="img/10dc9f9f-7ee2-4592-9ef8-dad80e6403d2.png" style="width:43.08em;height:15.00em;"/></div>
<p>The error clearly specifies that we cannot add two different data types because the interpreter cannot recognize which data type needs to be assigned to the mixed value variable.</p>
<p>Sometimes, if necessary, we can convert the values from one data type to another by calling specific functions that convert the data type to another. For example, <kbd>int("1")</kbd> will convert the string value 1 to integer value 1, or <kbd>str(1)</kbd> will convert the integer value 1 to the string value 1.</p>
<p>We will be extensively using the various data types depending upon the logic and requirements of the scripts, and also, if necessary, converting one data type to another to achieve certain results.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Conditions and loops</h1>
                
            
            
                
<p>Conditions are checked using a left and right value comparison. The evaluation returns either true or false, and a specific action is performed depending on the result.</p>
<p>There are certain condition operators that are used to evaluate the left and right value comparisons:</p>
<table>
<tbody>
<tr>
<td><strong>Operators</strong></td>
<td><strong>Meaning</strong></td>
</tr>
<tr>
<td><kbd>==</kbd></td>
<td>If both values are equal</td>
</tr>
<tr>
<td><kbd>!=</kbd></td>
<td>If both values are NOT equal</td>
</tr>
<tr>
<td><kbd>&gt;</kbd></td>
<td>If the left value is greater than the right value</td>
</tr>
<tr>
<td><kbd>&lt;</kbd></td>
<td>If the left value is smaller than the right value</td>
</tr>
<tr>
<td><kbd>&gt;=</kbd></td>
<td>If the left value is greater than or equal to the right value</td>
</tr>
<tr>
<td><kbd>&lt;=</kbd></td>
<td>If the left value is lesser than or equal to the right value</td>
</tr>
<tr>
<td><kbd>in</kbd></td>
<td>If the left value is part of the right value</td>
</tr>
</tbody>
</table>
<p> </p>
<p>An example of the condition evaluation is as follows:</p>
<div><img src="img/eaf5ab12-2d1b-4b85-a714-f3999aa28d03.jpg"/></div>
<p class="mce-root">As we can see, we are checking whether <kbd>2&gt;3</kbd> (2 is greater that 3). Of course, this would result in false, so the action in the <kbd>else</kbd> section is executed. If we reverse the check, <kbd>3&gt;2</kbd>, then the output would have been <kbd>left value is greater</kbd>.</p>
<p class="mce-root">In the preceding example, we used the <kbd>if</kbd> condition block, which consists of the following:</p>
<pre class="mce-root">if &lt;condition&gt;:     <br/>perform action<br/>else:   <br/>perform action2</pre>
<p class="mce-root">Notice the indentation, which is compulsory in Python. If we had not intended it, Python would not interpret what action to execute in which condition, and hence would have thrown an error of incorrect indentation.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Nested and multiple conditions</h1>
                
            
            
                
<p>Sometimes we need to check multiple conditions in a single <kbd>if</kbd> condition.</p>
<p>Let's see an example of this:</p>
<div><img src="img/d3f16bcc-36f0-4ac8-8008-d1d459ac3155.jpg"/></div>
<p>Here, we are checking the range of the marks. The flow of the program is as follows:</p>
<p>Assign a value of <kbd>85</kbd> to the <kbd>marks</kbd> variable. If <kbd>marks</kbd> is less than or equal to <kbd>45</kbd>, print <kbd>Grade C</kbd>, else if <kbd>marks</kbd> is greater than <kbd>45</kbd> and less than equal to <kbd>75</kbd>, print <kbd>Grade B</kbd>, else if <kbd>marks</kbd> is greater than <kbd>75</kbd>, print <kbd>Grade A</kbd>, else if none of the preceding conditions match, then print <kbd>Unable to determine</kbd>.</p>
<p>The PowerShell sample code for the preceding Python task is as follows:</p>
<pre>#PowerShell sample code:<br/>$marks=85<br/>if ($marks -le 45)<br/>{<br/>    write-host "Grade C"<br/>}<br/>elseif (($marks -gt 45) -and ($marks -le 75))<br/>{<br/>    write-host "Grade B"<br/>}<br/>elseif ($marks -gt 75)<br/>{<br/>    write-host "Grade A"<br/>}<br/>else<br/>{<br/>    write-host "Unable to determine"<br/>}</pre>
<p>Similarly, here is an example of a nested condition (note the indentation that differentiates it from the earlier example of multiple conditions):</p>
<div><img src="img/de31a5bc-0ed1-4d3f-86d0-60f80aafb500.jpg" style="width:44.75em;height:29.17em;"/></div>
<p>As we can see in the condition, the internal conditions will only be executed if its parent condition evaluates to true. If there is a false, the corresponding <kbd>else</kbd> action will be taken. In the example, if the <kbd>car_details</kbd> variable contains <kbd>Car</kbd>, contains <kbd>blue</kbd>, and it contains <kbd>sedan</kbd>, only then will the action <kbd>I will buy this car</kbd> be performed. If any of those conditions are not met, the relevant else action will be performed.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Loops</h1>
                
            
            
                
<p>A loop is used to repeat a set of instructions until a specific condition is fulfilled. There are two common ways of creating a loop in Python, which are discussed as follows:</p>


            

            
        
    

        

                            
                    <h1 class="header-title">For next loop</h1>
                
            
            
                
<p>This type of loop checks for a condition and repeats the instructions inside the loop until the condition is met:</p>
<pre>for &lt;incremental variable&gt; in final value:<br/>  statements</pre>
<p>Here's an example of printing numbers from 1 to 10 in a for loop:</p>
<div><img src="img/02d90031-e8fd-4810-bfcc-36b8a0552521.jpg"/></div>
<p>As we can see, we use a built-in <kbd>range(starting value, max value)</kbd> function, which specifies the loop to repeat from the starting value until the incremental value reaches the maximum value. In this case, the variable <kbd>x</kbd> is incremented by 1 and in each loop, the value is printed out. This is repeated until the value of <kbd>x</kbd> reaches <kbd>10</kbd>, where the <kbd>for</kbd> loop terminates.</p>
<p>In a similar way, we can also iterate through the items in a given list:</p>
<div><img class="alignnone size-full wp-image-137 image-border" src="img/2defea05-0fb5-4f17-aa98-c432036f90de.png" style="width:55.83em;height:22.00em;"/></div>
<p>PowerShell sample for the preceding Python code is as follows:</p>
<pre>#PowerShell sample code:<br/>$countries="India","UK","USA","France"<br/>foreach ($country in $countries)<br/>{<br/>    write-host ($country+" is good")<br/>}</pre>
<p>Here, we can see that the values are assigned to the countries variable as a list. The <kbd>for</kbd> loop now iterates through each item in the list, and the print statement adds the string value to another string value and prints the result. This loop is repeated until all the items in the list are printed.</p>
<p class="mce-root">There might be times when we do not want to parse through an entire <kbd>for</kbd> loop. To break from the loop while it is iterating, we use a <kbd>break</kbd> statement. Here's an example in which we want to stop printing after <kbd>UK</kbd> in the <kbd>country</kbd> list:</p>
<pre class="mce-root"> for country in countries:<br/>     if 'UK' in country:<br/>         break<br/>     else:<br/>         print (country)</pre>


            

            
        
    

        

                            
                    <h1 class="header-title">While loop</h1>
                
            
            
                
<p><kbd>While</kbd> loop is different from <kbd>for</kbd> loop, as no new variable is needed in this loop, and any current variable can be used to perform the tasks inside the <kbd>while</kbd> loop. An example is as follows:</p>
<pre>while True:<br/>     perform instructions<br/>     if condition():<br/>       break</pre>
<div><img src="img/a39d5bde-5e97-44ff-865b-ca5221817d1f.jpg"/></div>
<p>This is similar to <kbd>for</kbd>, but in this case the actions are performed first, and then the condition is checked. In the preceding example, the value of <kbd>x</kbd> is printed first, and we repeat the same set of instructions until the value of <kbd>x</kbd> reaches <kbd>10</kbd> or greater. Once the <kbd>if</kbd> condition is met, we break out of the loop. If we do not specify a <kbd>break</kbd> condition, we will go into an infinite loop with a increment of 1 for each <kbd>x</kbd> value.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Writing Python scripts</h1>
                
            
            
                
<p>We are now familiar with the basic concepts of Python. Now we will write an actual program or script in Python.</p>
<p>Ask for the input of a country name, and check whether the last character of the country is a vowel:</p>
<pre>countryname=input("Enter country name:")<br/>countryname=countryname.lower()<br/>lastcharacter=countryname.strip()[-1]<br/>if 'a' in lastcharacter:<br/>    print ("Vowel found")<br/>elif 'e' in lastcharacter:<br/>    print ("Vowel found")<br/>elif 'i' in lastcharacter:<br/>    print ("Vowel found")<br/>elif 'o' in lastcharacter:<br/>    print ("Vowel found")<br/>elif 'u' in lastcharacter:<br/>    print ("Vowel found")<br/>else:<br/>    print ("No vowel found")</pre>
<p>Output of the preceding code is as follows:</p>
<div><img class="alignnone size-full wp-image-138 image-border" src="img/be66c59e-ff2b-4145-88ea-a1c92005b60c.png" style="width:56.58em;height:26.33em;"/></div>
<ol>
<li>We ask for the input of a country name. The <kbd>input()</kbd> method is used to get an input from the user. The value entered is in the string format, and in our case the <kbd>countryname</kbd> variable has been assigned the input value.</li>
<li>In the next line, <kbd>countryname.lower()</kbd> specifies that the input that we receive needs to converted into all lowercase and stored in the same <kbd>countryname</kbd> variable. This effectively will have the same value that we entered earlier but in lowercase.</li>
<li>In the next line, <kbd>countryname.strip()[-1]</kbd> specifies two actions in one statement:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><kbd>countryname.strip()</kbd> ensures that the variable has all the leading and trailing extra values removed, such as new line or tab characters.</li>
<li>Once we get the clean variable, remove the last character of the string, which in our case is the last character of the country name. The <kbd>-1</kbd> denotes the character from right to left or end to start, whereas <kbd>+1</kbd> would denote from left to right.</li>
</ul>
</li>
</ul>
<ol start="4">
<li>Once we have the last character stored in the <kbd>lastcharacter</kbd> variable, all that is needed is a nested condition check and, based upon the result, print the value.</li>
</ol>
<p>To save this program, we need to save this file as <kbd>somename.py</kbd>, which will specify that this program needs to be executed in Python:</p>
<p>The PowerShell sample code for the preceding Python task is as follows:</p>
<pre>#PowerShell sample code<br/>$countryname=read-host "Enter country name" <br/>$countryname=$countryname.tolower()<br/>$lastcharacter=$countryname[-1]<br/>if ($lastcharacter -contains 'a')<br/>{<br/>    write-host "Vowel found"<br/>}<br/>elseif ($lastcharacter -contains 'e')<br/>{<br/>    write-host "Vowel found"<br/>}<br/>elseif ($lastcharacter -contains 'i')<br/>{<br/>    write-host "Vowel found"<br/>}<br/>elseif ($lastcharacter -contains '0')<br/>{<br/>    write-host "Vowel found"<br/>}<br/>elseif ($lastcharacter -contains 'u')<br/>{<br/>    write-host "Vowel found"<br/>}<br/>else<br/>{<br/>write-host "No vowel found"<br/>}</pre>
<p>Python is very strict in terms of indentation. As we can see in the example, if we change the indentations or tabs even by a space, Python will spit out an error stating the indentation is not correct and the compilation will fail. This will result in an error and unless the indentation is fixed, the execution will not be performed.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Functions</h1>
                
            
            
                
<p>For any recurring set of instructions, we can define a function. In other words, a function is a closed set of instructions to perform a specific logic or task. Depending upon the input provided, a function has the ability to return the results or parse the input with specific instructions to get results without any return values.</p>
<p>A function is defined by the <kbd>def</kbd> keyword, which specifies that we need to define a function and provide a set of instructions related to that function.</p>
<p>In this task we will print the greater of two input numbers:</p>
<pre>def checkgreaternumber(number1,number2):<br/>    if number1 &gt; number2:<br/>      print ("Greater number is ",number1)<br/>    else:<br/>     print ("Greater number is",number2)<br/>checkgreaternumber(2,4)<br/>checkgreaternumber(3,1)</pre>
<div><img src="img/4571fb2a-3fbf-48bb-96ff-88a7f8fbd78f.jpg"/></div>
<p>As we can see in the preceding output, the first time we call the <kbd>checkgreaternumber(2,4)</kbd> function, the function prints the greater value as <kbd>4</kbd>, and the second time we call the function with different numbers, the function prints the greater value as <kbd>3</kbd>.</p>
<p class="mce-root">The PowerShell sample code for the preceding task is as follows:</p>
<pre>#PowerShell sample code<br/>function checkgreaternumber($number1,$number2)<br/>{<br/>    if ($number1 -gt $number2)<br/>    {<br/>        write-host ("Greater number is "+$number1)<br/>    }<br/>    else<br/>    {<br/>        write-host ("Greater number is "+$number2)<br/>    }<br/>}<br/><br/>checkgreaternumber 2 4<br/>checkgreaternumber 3 1</pre>
<p>We can rewrite the same function, but rather than printing the value inside the function, it should return the greater number:</p>
<pre>def checkgreaternumber(number1,number2):<br/>    if number1 &gt; number2:<br/>      return number1<br/>    else:<br/>     return number2<br/><br/>print ("My greater number in 2 and 4 is ",checkgreaternumber(2,4))<br/>print ("My greater number in 3 and 1 is ",checkgreaternumber(3,1))</pre>
<p>In this case, as we can see, the function returns the value, and the result is returned on the line where the function was called. In this case, as it was called inside the <kbd>print</kbd> function, it evaluates the input and returns the value, which also gets printed out inside the same <kbd>print</kbd> function.</p>
<pre>#PowerShell sample code<br/>function checkgreaternumber($number1,$number2)<br/>{<br/>    if ($number1 -gt $number2)<br/>    {<br/>        return $number1<br/>    }<br/>    else<br/>    {<br/>        return $number2<br/>    }<br/>}<br/><br/>write-host ("My greater number in 2 and 4 is ",(checkgreaternumber 2 4))<br/>write-host ("My greater number in 3 and 1 is ",(checkgreaternumber 3 1))</pre>
<p>Another important aspect of a function is the default values that we can provide in a function. Sometimes we need to write functions that might take multiple, say 4, 5, or more, values as inputs. Since it becomes hard to know what values we need and in which order for the function, we can ensure that the default value is taken into consideration if any value is not provided when calling that specific function:</p>
<pre>def checkgreaternumber(number1,number2=5):<br/>    if number1 &gt; number2:<br/>      return number1<br/>    else:<br/>     return number2<br/>print ("Greater value is",checkgreaternumber(3))<br/>print ("Greater value is",checkgreaternumber(6))<br/>print ("Greater value is",checkgreaternumber(1,4))</pre>
<p>The output of the code execution is given as:</p>
<div><img src="img/1754e6c1-c7d9-4ab7-b3e5-e291d27f051e.jpg"/></div>
<ol>
<li>As we can see in the preceding output, we specified the default value of <kbd>number2</kbd> as <kbd>5</kbd>. Now, as we can see in the first call to the function, we only give the value <kbd>3</kbd>. Now, as the function needs two inputs or parameters, but we provided only one, the second value for the function is taken from the default one, which is <kbd>5</kbd> in this case. Hence, a comparison will be done between <kbd>3</kbd> and <kbd>5</kbd> to get the greater number.</li>
<li>In the second call to the function, a similar call is made with <kbd>6</kbd>, and since no other value was provided, the comparison was between <kbd>6</kbd> and <kbd>5</kbd>, and result returned was the greater value, which is <kbd>6</kbd>.</li>
<li>In the third call, we provide both values, which overrides any default value, so a comparison was done between <kbd>1</kbd> and <kbd>4</kbd>. The result was evaluated and the output of <kbd>4</kbd> was returned.</li>
</ol>
<p>Another important consideration is the localization of a variable in a function:</p>
<pre>globalval=6<br/><br/>def checkglobalvalue():<br/>    return globalval<br/><br/>def localvariablevalue():<br/>    globalval=8<br/>    return globalval<br/><br/>print ("This is global value",checkglobalvalue())<br/>print ("This is global value",globalval)<br/>print ("This is local value",localvariablevalue())<br/>print ("This is global value",globalval)</pre>
<p>The output of the preceding code is as follows:</p>
<div><img src="img/5121cf2b-ada9-4b82-89c4-614b8d454e78.jpg" style="width:44.00em;height:33.83em;"/></div>
<ol>
<li>In the preceding output, we define a variable named as <kbd>globalval</kbd> with a value of <kbd>6</kbd>. In the <kbd>checkglobalvalue</kbd> function, we just return the value of the <kbd>globalvalvariable</kbd>, which prints a value of <kbd>6</kbd> as we call the first <kbd>print</kbd> function.</li>
<li>The second <kbd>print</kbd> function just prints the value of the same variable, which also prints <kbd>6</kbd>.</li>
<li>Now, in the third <kbd>print</kbd> function, <kbd>localvariablevalue</kbd>, we call the same <kbd>globalval</kbd>, but give it a value of <kbd>8</kbd> and return the value of <kbd>globalval</kbd>. In the print value of local, it prints the result as value 8. It is not assumed that the <kbd>globalval</kbd> variable has a value of <kbd>8</kbd> now. But, as we can see in the last <kbd>print</kbd> function, it still prints a value of <kbd>6</kbd>, when we call the <kbd>print</kbd> function to print the value of <kbd>globalval</kbd>.</li>
</ol>
<p>This clearly shows that any variable inside a function is locally effective, or is localized, but does not have any impact on any variables outside the function. We need to use the <kbd>global</kbd> command to reference the global variable and remove the localization impact of it.</p>
<p>Here is the same example before using the <kbd>global</kbd> command:</p>
<div><img src="img/6d0972af-9161-44b9-9abb-590e9e129527.jpg" style="width:33.75em;height:27.00em;"/></div>
<p>As can we see in the preceding output, if we change the value of the <kbd>globalval</kbd> global variable inside the <kbd>localvariablevalue</kbd> function, we see the effect on the global variable with a new value of <kbd>8</kbd>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Passing arguments from the command line</h1>
                
            
            
                
<p>Sometimes it is necessary to pass arguments to the script from the command line. This is generally needed when we need to perform some quick actions in our script, rather than the script asking us for the inputs.</p>
<p>Consider the following lines of code where we pass two numbers as arguments to scripts, and print the sum of them:</p>
<pre>import sys<br/>print ("Total output is ")<br/>print (int(sys.argv[1])+int(sys.argv[2]))</pre>
<p>When we run this script, say it's saved as <kbd>checkargs.py</kbd>, and execute it as follows:</p>
<pre><strong>python checkargs.py 5 6</strong></pre>
<p>The output returned is as follows:</p>
<pre><strong>Total output is</strong><br/><strong>11</strong></pre>
<p>The key here is the import of the <kbd>sys</kbd> module, which is a predefined module in Python to handle any system-related tasks of Python. The values that we pass as arguments are stored in <kbd>sys.argv[1]</kbd> onwards, since <kbd>sys.argv[0]</kbd> is the name of actual script being run. In this case, <kbd>sys.argv[0]</kbd> will be <kbd>checkargs.py</kbd>, <kbd>sys.argv[1]</kbd> will be <kbd>5</kbd>, and <kbd>sys.argv[2]</kbd> will be <kbd>6</kbd>.</p>
<p>The PowerShell code for the preceding task is as follows:</p>
<pre>#PowerShell sample code<br/>$myvalue=$args[0]<br/>write-host ("Argument passed to PowerShell is "+$myvalue)</pre>
<p>The arguments passed in a Python script are in string format, so we need to explicitly convert them to the right type for the expected output. In the preceding script, if we had not converted it to the integer type by using the <kbd>int()</kbd> function, then the output would have been <kbd>56</kbd> instead of <kbd>int(5)</kbd> + <kbd>int(6)</kbd> = <kbd>11</kbd>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Python modules and packages</h1>
                
            
            
                
<p>Because Python is the most popular open source coding language, there are many developers who contribute their expertise by creating specific modules and sharing them for others to use. These modules are a specific set of functions or instructions that are used to perform specialized tasks and can be called easily in our programs. The modules can be easily called using the <kbd>import</kbd> command inside the scripts. Python has many built-in modules that are directly called using <kbd>import</kbd>, but for specialized modules, an external installation is needed. Luckily, Python provides a very easy way to download and install these modules.</p>
<p>As an example, let's install a module named <kbd>Netmiko</kbd> that can help us work on logging into network devices more efficiently. Python provides a well-documented reference for each of the modules, and for our module, the documentation can be found at <a href="https://pypi.python.org/pypi/netmiko" target="_blank">https://pypi.python.org/pypi/netmiko. </a>For installation, all we have to do is go into the folder from the command line where <kbd>python.exe</kbd> is installed or is present. There is a sub folder in that location called <kbd>scripts</kbd>.</p>
<p>Inside that folder, we have two options that can be used for installing modules, <kbd>easy_install.exe</kbd> or <kbd>pip.exe</kbd>.</p>
<p>Installing the library for Python, can be done in two ways:</p>
<ul>
<li>The syntax of <kbd>easy_install</kbd> is as follows:</li>
</ul>
<pre style="padding-left: 90px"><strong>easy_install &lt;name of module&gt;</strong></pre>
<p style="padding-left: 60px">For example:</p>
<pre style="padding-left: 90px"><strong>easy_install netmiko</strong></pre>
<ul>
<li>The syntax of <kbd>pip install</kbd> is as follows:</li>
</ul>
<pre style="padding-left: 90px"><strong>pip install &lt;name of module&gt;</strong></pre>
<p style="padding-left: 60px">For example:</p>
<pre style="padding-left: 90px"><strong>pip install netmiko</strong></pre>
<p>Once we install the required module, we need to restart Python by closing all open sessions and invoking IDLE again so the modules can be loaded. More information on modules can be gathered from <a href="https://docs.python.org/2/tutorial/modules.html" target="_blank">https://docs.python.org/2/tutorial/modules.html.</a></p>


            

            
        
    

        

                            
                    <h1 class="header-title">Multithreading for parallel processing</h1>
                
            
            
                
<p>As we are now focusing on writing our scripts efficiently, a major aspect of this is how efficiently, quickly, and correctly we fetch the information. When we use the <kbd>for</kbd> loop, we parse through each item one by one, which is fine if we get results quickly.</p>
<p>Now, if each item in a <kbd>for</kbd> loop is a router from which we need to get the output of show version, and if each router takes around 10 seconds to log in, gather the output, and log out, and we have around 30 routers that we need to get this information from, we would need 10*30 = 300 seconds for the program to complete the execution. If we are looking for more advanced or complex calculations on each output, which might take up to a minute, then it will take 30 minutes for just 30 routers.</p>
<p>This starts becoming very inefficient when our complexity and scalability grows. To help with this, we need to add parallelism to our programs. What this simply means is, we log in simultaneously on all 30 routers, and perform the same task to fetch the output at the same time. Effectively, this means that we now get the output on all  30 routers in 10 seconds, because we have 30 parallel threads being called.</p>
<p>A thread is nothing but another instance of the same function being called, and calling it 30 times means we are invoking 30 threads at the same time to perform the same tasks.</p>
<p>Here's an example:</p>
<pre>import datetime<br/>from threading import Thread<br/><br/>def checksequential():<br/>    for x in range(1,10):<br/>        print (datetime.datetime.now().time())<br/><br/>def checkparallel():<br/>    print (str(datetime.datetime.now().time())+"\n")<br/><br/>checksequential()<br/>print ("\nNow printing parallel threads\n")<br/>threads = []<br/>for x in range(1,10):<br/>    t = Thread(target=checkparallel)<br/>    t.start()<br/>    threads.append(t)<br/><br/>for t in threads:<br/>    t.join()</pre>
<p>The output of the multi-threading code is as follows:</p>
<div><img src="img/f806c994-8e32-4a82-90e9-68d1d06f0c12.jpg" style="width:42.25em;height:40.08em;"/></div>
<ol>
<li>As we can see in the preceding example, we created two functions, named <kbd>checksequential</kbd> and <kbd>checkparallel</kbd>, to print the system's date time. The <kbd>datetime</kbd> module is used to get the system's date time in this case. In the <kbd>for</kbd> loop, a sequential run was done that shows the increment time in the output when the function was called.</li>
</ol>
<p> </p>
<ol start="2">
<li>For the threading, we use a blank array named <kbd>threads</kbd>. Each of the instances that is created has a unique thread number or value, which is stored in this empty thread array each time the <kbd>checkparallel</kbd> method is spawned. This unique number or reference for each thread identifies each thread as and when its executed. The <kbd>start()</kbd> method is used to get the thread to perform the function called in the thread.</li>
<li>The last loop is important in the thread. What it signifies is that the program will wait for all the threads to complete before moving forward. The <kbd>join()</kbd> method specifies that until all the threads are complete, the program will not proceed to the next step.</li>
</ol>
<p>Now, as we can see in the output of the thread, some of the timestamps are the same, which means that all those instances were invoked and executed at the same time in parallel rather than sequentially.</p>
<p>The output in the program is not in order for parallel threads, because the moment any thread is completed, the output is printed, irrespective of the order. This is different to sequential execution, since parallel threads do not wait for any previous thread to complete before executing another. So, any thread that completes will print its value and end.</p>
<p>PowerShell sample code for the preceding task is as follows:</p>
<pre>#PowerShell sample code<br/>Get-Job  #This get the current running threads or Jobs in PowerShell<br/>Remove-Job -Force * # This commands closes forcible all the previous threads<br/><br/>$Scriptblock = {<br/>      Param (<br/>         [string]$ipaddress<br/>      )<br/>    if (Test-Connection $ipaddress -quiet)<br/>    { <br/>        return ("Ping for "+$ipaddress+" is successful")<br/>     }<br/>    else<br/>    {<br/>       return ("Ping for "+$ipaddress+" FAILED") <br/>    }<br/>   }<br/><br/>$iplist="4.4.4.4","8.8.8.8","10.10.10.10","20.20.20.20","4.2.2.2"<br/><br/>foreach ($ip in $iplist)<br/>{<br/>    Start-Job -ScriptBlock $Scriptblock -ArgumentList $ip | Out-Null<br/>    #The above command is used to invoke the $scriptblock in a multithread<br/>}<br/><br/>#Following logic waits for all the threads or Jobs to get completed<br/>While (@(Get-Job | Where { $_.State -eq "Running" }).Count -ne 0)<br/>  { # Write-Host "Waiting for background jobs..."<br/>     Start-Sleep -Seconds 1<br/>  }<br/><br/>#Following logic is used to print all the values that are returned by each thread and then remove the thread # #or job from memory<br/>ForEach ($Job in (Get-Job)) {<br/>  Receive-Job $Job<br/>  Remove-Job $Job<br/>  }</pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Netmiko for SSH and network device interaction</h1>
                
            
            
                
<p>Netmiko (<a href="https://github.com/ktbyers/netmiko" target="_blank">https://github.com/ktbyers/netmiko</a>) is a library in Python that is used extensively an interaction with network devices. This is a multi-vendor library with support for Cisco IOS, NXOS, firewalls, and many other devices. The underlying library of this is Paramiko, which is again used extensively for SSH into various devices.</p>
<p>Netmiko extends the Paramiko ability of SSH to add enhancements, such as going into configuration mode in network routers, sending commands, receiving output based upon the commands, adding enhancements to wait for certain commands to finish executing, and also taking care of yes/no prompts during command execution.</p>
<p>Here's an example of a simple script to log in to the router and show the version:</p>
<pre>from netmiko import ConnectHandler<br/><br/>device = ConnectHandler(device_type='cisco_ios', ip='192.168.255.249', username='cisco', password='cisco')<br/>output = device.send_command("show version")<br/>print (output)<br/>device.disconnect()</pre>
<p>The output of the execution of code against a router is as follows:</p>
<div><img src="img/a66c311b-136d-4147-b78f-10eb7cfbc53d.jpg" style="width:51.00em;height:50.58em;"/></div>
<p>As we can see in the sample code, we call the <kbd>ConnectHandler</kbd> function from the Netmiko library, which takes four inputs (<kbd>platform type</kbd>, <kbd>IP address of device</kbd>, <kbd>username</kbd>, and <kbd>password</kbd>):</p>
<p>Netmiko works with a variety of vendors. Some of the supported platform types and their abbreviations to be called in Netmiko are:<br/>
<br/>
'a10': A10SSH,<br/>
'accedian': AccedianSSH,<br/>
'alcatel_aos': AlcatelAosSSH,<br/>
'alcatel_sros': AlcatelSrosSSH,<br/>
'arista_eos': AristaSSH,<br/>
'aruba_os': ArubaSSH,<br/>
'avaya_ers': AvayaErsSSH,<br/>
'avaya_vsp': AvayaVspSSH,<br/>
'brocade_fastiron': BrocadeFastironSSH,<br/>
'brocade_netiron': BrocadeNetironSSH,<br/>
'brocade_nos': BrocadeNosSSH,<br/>
'brocade_vdx': BrocadeNosSSH,<br/>
'brocade_vyos': VyOSSSH,<br/>
'checkpoint_gaia': CheckPointGaiaSSH,<br/>
'ciena_saos': CienaSaosSSH,<br/>
'cisco_asa': CiscoAsaSSH,<br/>
<strong>'cisco_ios': CiscoIosBase</strong>,<br/>
'cisco_nxos': CiscoNxosSSH,<br/>
'cisco_s300': CiscoS300SSH,<br/>
'cisco_tp': CiscoTpTcCeSSH,<br/>
'cisco_wlc': CiscoWlcSSH,<br/>
'cisco_xe': CiscoIosBase,<br/>
'cisco_xr': CiscoXrSSH,<br/>
'dell_force10': DellForce10SSH,<br/>
'dell_powerconnect': DellPowerConnectSSH,<br/>
'eltex': EltexSSH,<br/>
'enterasys': EnterasysSSH,<br/>
'extreme': ExtremeSSH,<br/>
'extreme_wing': ExtremeWingSSH,<br/>
'f5_ltm': F5LtmSSH,<br/>
'fortinet': FortinetSSH,<br/>
'generic_termserver': TerminalServerSSH,<br/>
'hp_comware': HPComwareSSH,<br/>
'hp_procurve': HPProcurveSSH,<br/>
'huawei': HuaweiSSH,<br/>
'juniper': JuniperSSH,<br/>
'juniper_junos': JuniperSSH,<br/>
'linux': LinuxSSH,<br/>
'mellanox_ssh': MellanoxSSH,<br/>
'mrv_optiswitch': MrvOptiswitchSSH,<br/>
'ovs_linux': OvsLinuxSSH,<br/>
'paloalto_panos': PaloAltoPanosSSH,<br/>
'pluribus': PluribusSSH,<br/>
'quanta_mesh': QuantaMeshSSH,<br/>
'ubiquiti_edge': UbiquitiEdgeSSH,<br/>
'vyatta_vyos': VyOSSSH,<br/>
'vyos': VyOSSSH,</p>
<p>Depending upon the selection of the platform type, Netmiko can understand the returned prompt and the correct way to SSH to the specific device. Once the connection is made, we can send commands to the device using the <kbd>send</kbd> method.</p>
<p>Once we get the return value, the value stored in the <kbd>output</kbd> variable is displayed, which is the string output of the command that we sent to the device. The last line, which uses the <kbd>disconnect</kbd> function, ensures that the connection is terminated cleanly once we are done with our task.</p>
<p>For configuration (example: We need to provide a description to the router interface <kbd>FastEthernet 0/0</kbd>), we use Netmiko as shown in the following example:</p>
<pre>from netmiko import ConnectHandler<br/><br/>print ("Before config push")<br/>device = ConnectHandler(device_type='cisco_ios', ip='192.168.255.249', username='cisco', password='cisco')<br/>output = device.send_command("show running-config interface fastEthernet 0/0")<br/>print (output)<br/><br/>configcmds=["interface fastEthernet 0/0", "description my test"]<br/>device.send_config_set(configcmds)<br/><br/>print ("After config push")<br/>output = device.send_command("show running-config interface fastEthernet 0/0")<br/>print (output)<br/><br/>device.disconnect()</pre>
<p>The output of the execution of the preceding code is as follows:</p>
<div><img src="img/135a58fa-bf71-45c9-992e-875816852d6e.jpg"/></div>
<ul>
<li>As we can see, for <kbd>config push</kbd> we do not have to perform any additional configs but just specify the commands in the same order as we will send them manually to the router in a list, and pass that list as an argument to the <kbd>send_config_set</kbd> function.</li>
<li>The output in <kbd>Before config push</kbd> is a simple output of the <kbd>FastEthernet0/0</kbd> interface, but the output under <kbd>After config push</kbd> is now with the description that we configured using the list of commands.</li>
</ul>
<p>In a similar way, we can pass multiple commands to the router, and Netmiko will go into configuration mode, write those commands to the router, and exit config mode.</p>
<p>If we want to save the configuration, we use the following command after the <kbd>send_config_set</kbd> command:</p>
<pre class="mce-root">device.send_command("write memory")</pre>
<p>This ensures that the router writes the newly pushed config in memory.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Network automation use case</h1>
                
            
            
                
<p>As we have now interacted with multiple sections of Python and device interaction, let's create a use case to incorporate what we have learned so far. The use case is as follows<strong>:</strong></p>
<p>Log into the router and fetch some information:</p>
<ol>
<li class="mce-root"><kbd>task1()</kbd>: Show the version, show the IP in brief, show the clock, and show the configured usernames on the router.</li>
<li><kbd>task2()</kbd>: Create another username on the <kbd>test</kbd> router with the password <kbd>test</kbd> and check whether we can log in successfully with the newly created username.</li>
<li><kbd>task3()</kbd>: Log in with the newly created username <kbd>test</kbd>, and delete all the other usernames from the <kbd>running-config</kbd>. Once this is done, return all the current usernames configured on the router to confirm whether only the <kbd>test</kbd> username is configured on the router.</li>
</ol>
<p>Let's build a script to tackle these tasks one by one:</p>
<pre>from netmiko import ConnectHandler<br/><br/>device = ConnectHandler(device_type='cisco_ios', ip='192.168.255.249', username='cisco', password='cisco')<br/><br/>def task1():<br/>    output = device.send_command("show version")<br/>    print (output)<br/>    output= device.send_command("show ip int brief")<br/>    print (output)<br/>    output= device.send_command("show clock")<br/>    print (output)<br/>    output= device.send_command("show running-config | in username")<br/>    output=output.splitlines()<br/>    for item in output:<br/>        if ("username" in item):<br/>            item=item.split(" ")<br/>            print ("username configured: ",item[1])<br/>            <br/><br/>def task2():<br/>    global device<br/>    configcmds=["username test privilege 15 secret test"]<br/>    device.send_config_set(configcmds)<br/>    output= device.send_command("show running-config | in username")<br/>    output=output.splitlines()<br/>    for item in output:<br/>        if ("username" in item):<br/>            item=item.split(" ")<br/>            print ("username configured: ",item[1])<br/>    device.disconnect()<br/>    try:<br/>        device = ConnectHandler(device_type='cisco_ios', ip='192.168.255.249', username='test', password='test')<br/>        print ("Authenticated successfully with username test")<br/>        device.disconnect()<br/>    except:<br/>        print ("Unable to authenticate with username test")<br/><br/>def task3():<br/>    device = ConnectHandler(device_type='cisco_ios', ip='192.168.255.249', username='test', password='test')<br/>    output= device.send_command("show running-config | in username")<br/>    output=output.splitlines()<br/>    for item in output:<br/>        if ("username" in item):<br/>            if ("test" not in item):<br/>                item=item.split(" ")<br/>                cmd="no username "+item[1]<br/>                outputnew=device.send_config_set(cmd)<br/>    output= device.send_command("show running-config | in username")<br/>    output=output.splitlines()<br/>    for item in output:<br/>        if ("username" in item):<br/>            item=item.split(" ")<br/>            print ("username configured: ",item[1])<br/>            <br/>    device.disconnect()<br/>    <br/>    <br/>#Call task1 by writing task1()<br/>#task1()<br/>#Call task2 by writing task2()<br/>#task2()<br/>#Call task3 by writing task3()<br/>#task3()</pre>
<p>As we can see, the three tasks given are defined as three different functions:</p>
<ol>
<li>The first line indicates that we have imported the Netmiko library, and in the second line we are connecting to our <kbd>test</kbd> router with the Cisco credentials.</li>
<li>In the <kbd>task1()</kbd> function, we are fetching the outputs of all show commands. Additionally, since we do not want to expose the passwords of the current usernames we have added an extra logic wherein the returned output for <kbd>show running-config | in username</kbd> will be parsed by each line for every username, and each line will be split by a space character <kbd>" "</kbd>. Also, since the Cisco device returns the actual username in the second position in the output (for example, username <kbd>test</kbd> privilege 15 secret 5 <em>)</em>, we print the value of the second item after we split the output string, which is our actual username.</li>
</ol>
<p style="padding-left: 60px">Here's the output for the <kbd>task1()</kbd> method:</p>
<div><img src="img/51c0ad39-caeb-4baa-bba0-c6b95c760bfe.jpg" style="width:56.17em;height:38.00em;"/></div>
<ol start="3">
<li>In the <kbd>task2()</kbd> method, we are going to create a username <kbd>test</kbd> with the password <kbd>test</kbd>, and authenticate with the new username. We have added a <kbd>try:</kbd> exception block in this method, which checks for any errors/exceptions for all the statements in the <kbd>try:</kbd> section, and if there are any exceptions, rather than breaking the script, it runs the code that is given in the exception section (under the <kbd>except:</kbd> keyword). If there are no errors, it continues with the statements in the <kbd>try:</kbd> section.</li>
</ol>
<p style="padding-left: 60px">Here's the output for <kbd>task2()</kbd>:</p>
<div><img class="alignnone size-full wp-image-139 image-border" src="img/62f5c790-3c76-4fd4-a2d5-1c61b2744d35.png" style="width:43.50em;height:13.67em;"/></div>
<p style="padding-left: 60px">We can see that we now have two usernames configured, and the router is also now successfully responding to authentication with the <kbd>test</kbd> username.</p>
<ol start="4">
<li>In <kbd>task3()</kbd> function, this will first fetch all the usernames that are in <kbd>running-config</kbd>, and if there are any usernames that are not <kbd>test</kbd>, it will create a dynamic command with no username <kbd>&lt;username&gt;</kbd> and send it to the router. Once it is done with all the usernames, it will go ahead and recheck and list out all the usernames not on the router. A success criteria is only the configured username as <kbd>test</kbd> should be available on the router.</li>
</ol>
<p style="padding-left: 60px">Here's the output of <kbd>task3()</kbd>:</p>
<div><img src="img/44b7d3eb-4dda-4bf2-b055-a5a1e81e3d54.jpg" style="width:44.42em;height:13.42em;"/></div>
<p style="padding-left: 60px">The result of <kbd>task3()</kbd> is the result of all configured usernames, which in this case is now only test.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we learned some advanced techniques for writing scripts by using functions, conditions, and loops; we covered multi-threading our scripts for faster and parallel execution, we got familiar with using Netmiko to interact with network devices, and looked at a real-world example of achieving a certain set of tasks using a single script.</p>
<p>The next chapter will focus on automation tasks using web. We will also discuss how to call Python scripts from the web and perform tasks using web framework.</p>
<p>Additionally, there will be a basic introduction to creating your own API so that others can use it for specific tasks.</p>
<p> </p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    </body></html>