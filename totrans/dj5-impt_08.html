<html><head></head><body>
		<div><h1 id="_idParaDest-131" class="chapter-number"><a id="_idTextAnchor137"/><st c="0">8</st></h1>
			<h1 id="_idParaDest-132"><a id="_idTextAnchor138"/><st c="2">Implementing User Signup and Login</st></h1>
			<p><st c="36">The next part of our app will concern user authentication, where we allow users to sign up and log in. </st><st c="140">Implementing user authentication is famously hard. </st><st c="191">Fortunately, we can use Django’s powerful built-in authentication system to take care of the many security pitfalls that could arise if we were to create our own user authentication </st><st c="373">from scratch.</st></p>
			<p><st c="386">In this chapter, we will cover the </st><st c="422">following topics:</st></p>
			<ul>
				<li><st c="439">Creating an </st><st c="452">accounts app</st></li>
				<li><st c="464">Creating a basic </st><st c="482">signup page</st></li>
				<li><st c="493">Improving a signup page to handle </st><code><st c="528">POST</st></code><st c="532"> actions</st></li>
				<li><st c="540">Customizing </st><code><st c="553">UserCreationForm</st></code></li>
				<li><st c="569">Creating a </st><st c="581">login page</st></li>
				<li><st c="591">Implementing the </st><st c="609">logout functionality</st></li>
			</ul>
			<p><st c="629">By the end of this chapter, you will know how to implement an authentication system and handle common </st><st c="732">authentication actions.</st></p>
			<h1 id="_idParaDest-133"><a id="_idTextAnchor139"/><st c="755">Technical requirements</st></h1>
			<p><st c="778">In this chapter, we will use Python 3.10+. </st><st c="822">Additionally, we will use the VS Code editor in this book, which you can download </st><st c="904">from </st><a href="https://code.visualstudio.com/"><st c="909">https://code.visualstudio.com/</st></a><st c="939">.</st></p>
			<p><st c="940">The code for this chapter is located </st><st c="978">at </st><a href="https://github.com/PacktPublishing/Django-5-for-the-Impatient-Second-Edition/tree/main/Chapter08/moviesstore"><st c="981">https://github.com/PacktPublishing/Django-5-for-the-Impatient-Second-Edition/tree/main/Chapter08/moviesstore</st></a><st c="1089">.</st></p>
			<p><st c="1090">The CiA video for this chapter can be found </st><st c="1135">at </st><a href="https://packt.link/XmYIk"><st c="1138">https://packt.link/XmYIk</st></a></p>
			<h1 id="_idParaDest-134"><a id="_idTextAnchor140"/><st c="1162">Creating an accounts app</st></h1>
			<p><st c="1187">The </st><a id="_idIndexMarker240"/><st c="1192">complete user authentication system involves a set of functionalities such as a signup, a login, a logout, and some validations. </st><st c="1321">None of these functionalities seem to belong to our </st><em class="italic"><st c="1373">home</st></em><st c="1377"> app or </st><em class="italic"><st c="1385">movies</st></em><st c="1391"> app, so let’s separate them inside a new app. </st><st c="1438">This new app will be </st><st c="1459">called </st><code><st c="1466">accounts</st></code><st c="1474">.</st></p>
			<p><st c="1475">We will follow these steps to create and configure the </st><st c="1531">new app:</st></p>
			<ol>
				<li><st c="1539">Create an </st><st c="1550">accounts app.</st></li>
				<li><st c="1563">Add the accounts app to the </st><st c="1592">settings file.</st></li>
				<li><st c="1606">Include an accounts URL file in the project-level </st><st c="1657">URL file.</st></li>
			</ol>
			<p><st c="1666">Let’s go through each of these steps in detail in the next </st><st c="1726">few sections.</st></p>
			<h2 id="_idParaDest-135"><a id="_idTextAnchor141"/><st c="1739">Creating an accounts app</st></h2>
			<p><st c="1764">Navigate to the top </st><code><st c="1785">moviesstore</st></code><st c="1796"> folder (the one that contains the </st><code><st c="1831">manage.py</st></code><st c="1840"> file) and run the following in </st><st c="1872">the terminal:</st></p>
			<ul>
				<li><st c="1885">For macOS, run the </st><st c="1905">following command:</st><pre class="source-code">
<strong class="bold"><st c="1923">python3 manage.py startapp accounts</st></strong></pre></li>				<li><st c="1959">For Windows, run the </st><st c="1981">following command:</st><pre class="source-code">
<strong class="bold"><st c="1999">python manage.py startapp accounts</st></strong></pre></li>			</ul>
			<p><em class="italic"><st c="2034">Figure 8</st></em><em class="italic"><st c="2043">.1</st></em><st c="2045"> shows the new project structure. </st><st c="2079">Verify that it matches your current </st><st c="2115">folder structure.</st></p>
			<div><div><img src="img/B22457_08_1.jpg" alt="Figure 8.1 – The MOVIESSTORE project structure containing the accounts app"/><st c="2132"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="2293">Figure 8.1 – The MOVIESSTORE project structure containing the accounts app</st></p>
			<p><st c="2367">Now, let’s add </st><a id="_idIndexMarker241"/><st c="2383">the accounts app to the </st><st c="2407">settings file.</st></p>
			<h2 id="_idParaDest-136"><a id="_idTextAnchor142"/><st c="2421">Adding the accounts app to the settings file</st></h2>
			<p><st c="2466">Remember </st><a id="_idIndexMarker242"/><st c="2476">that we must register each newly created app in the </st><code><st c="2528">settings.py</st></code><st c="2539"> file.</st></p>
			<p><st c="2545">In </st><code><st c="2549">/moviesstore/settings.py</st></code><st c="2573">, under </st><code><st c="2581">INSTALLED_APPS</st></code><st c="2595">, add the following line </st><st c="2620">in </st><strong class="bold"><st c="2623">bold</st></strong><st c="2627">:</st></p>
			<pre class="source-code"><st c="2629">
…
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'home',
    'movies',
</st><strong class="bold"><st c="2830">    'accounts',</st></strong><st c="2841">
]
…</st></pre>			<p><st c="2845">Now, let’s </st><a id="_idIndexMarker243"/><st c="2857">include the accounts URL file in </st><st c="2890">our project.</st></p>
			<h2 id="_idParaDest-137"><a id="_idTextAnchor143"/><st c="2902">Including the accounts URL file in the project-level URL file</st></h2>
			<p><st c="2964">In </st><code><st c="2968">/moviesstore/urls.py</st></code><st c="2988">, add </st><a id="_idIndexMarker244"/><st c="2994">the following line that is </st><st c="3021">in bold:</st></p>
			<pre class="source-code"><st c="3029">
…
urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('home.urls')),
    path('movies/', include('movies.urls')),
    </st><strong class="bold"><st c="3153">path('accounts/', include('accounts.urls')),</st></strong><st c="3197">
]
…</st></pre>			<p><st c="3201">All the URLs defined in the </st><code><st c="3230">accounts.urls</st></code><st c="3243"> file will contain an </st><code><st c="3265">accounts/</st></code><st c="3274"> prefix (as defined in the previous path). </st><st c="3317">We will create the </st><code><st c="3336">accounts.urls</st></code> <st c="3349">file later.</st></p>
			<p><st c="3361">Now that we have created the accounts app, let’s create the first functionality, the signup page. </st></p>
			<h1 id="_idParaDest-138"><a id="_idTextAnchor144"/><st c="3460">Creating a basic signup page</st></h1>
			<p><st c="3488">The </st><a id="_idIndexMarker245"/><st c="3493">signup page has a complex functionality. </st><st c="3534">We will need to consider many possible scenarios. </st><st c="3584">For now, let’s implement a basic signup page. </st><st c="3630">We will refactor and improve this functionality in the </st><st c="3685">upcoming sections.</st></p>
			<p><st c="3703">To implement a basic signup page, we will follow the </st><st c="3757">following steps:</st></p>
			<ol>
				<li><st c="3773">Configure a </st><st c="3786">signup URL.</st></li>
				<li><st c="3797">Define a </st><code><st c="3807">signup</st></code><st c="3813"> function.</st></li>
				<li><st c="3823">Create an accounts </st><st c="3843">signup template.</st></li>
				<li><st c="3859">Add a signup link to the </st><st c="3885">base template.</st></li>
			</ol>
			<p><st c="3899">Let’s look at these steps in </st><st c="3929">detail next.</st></p>
			<h2 id="_idParaDest-139"><a id="_idTextAnchor145"/><st c="3941">Configuring a signup URL</st></h2>
			<p><st c="3966">In </st><code><st c="3970">/accounts/</st></code><st c="3980">, create</st><a id="_idIndexMarker246"/><st c="3988"> a new file called </st><code><st c="4007">urls.py</st></code><st c="4014">. This file will contain the path relating to the URLs of the accounts app. </st><st c="4090">For now, fill it in with the </st><st c="4119">following code:</st></p>
			<pre class="source-code"><st c="4134">
from django.urls import path
from . </st><st c="4171">import views
urlpatterns = [
    path('signup', views.signup, name='accounts.signup'),
]</st></pre>			<p><st c="4255">We defined a </st><code><st c="4269">/signup</st></code><st c="4276"> path, but remember that the project-level URL file defined a </st><code><st c="4338">/accounts</st></code><st c="4347"> prefix for this </st><code><st c="4364">urls.py</st></code><st c="4371"> file. </st><st c="4378">So, if a URL matches the </st><code><st c="4403">/accounts/signup</st></code><st c="4419"> path, it will execute the </st><code><st c="4446">signup</st></code><st c="4452"> function defined in the </st><code><st c="4477">views</st></code><st c="4482"> file. </st><st c="4489">Next, we will implement the </st><code><st c="4517">signup</st></code><st c="4523"> function.</st></p>
			<h2 id="_idParaDest-140"><a id="_idTextAnchor146"/><st c="4533">Defining the signup function</st></h2>
			<p><st c="4562">In </st><code><st c="4566">/accounts/views.py</st></code><st c="4584">, add </st><a id="_idIndexMarker247"/><st c="4590">the following lines that are </st><st c="4619">in bold:</st></p>
			<pre class="source-code"><st c="4627">
from django.shortcuts import render
</st><strong class="bold"><st c="4664">from django.contrib.auth.forms import UserCreationForm</st></strong>
<strong class="bold"><st c="4718">def signup(request):</st></strong>
<strong class="bold"><st c="4739">    template_data = {}</st></strong>
<strong class="bold"><st c="4758">    template_data['title'] = 'Sign Up'</st></strong>
<strong class="bold"><st c="4793">    if request.method == 'GET':</st></strong>
<strong class="bold"><st c="4821">        template_data['form'] = UserCreationForm()</st></strong>
<strong class="bold"><st c="4864">        return render(request, 'accounts/signup.html',</st></strong>
<strong class="bold"><st c="4911">            {'template_data': template_data})</st></strong></pre>			<p><st c="4945">Let’s explain </st><st c="4960">the code:</st></p>
			<ul>
				<li><st c="4969">We imported </st><code><st c="4982">UserCreationForm</st></code><st c="4998">, which is a built-in form class provided by Django. </st><st c="5051">It is designed to facilitate the creation of user registration forms, specifically to create new user accounts. </st><st c="5163">In Django, we can create our own HTML forms, use some of these Django forms, or even customize the Django forms. </st><st c="5276">We will learn and use all these three approaches in </st><st c="5328">this book.</st></li>
				<li><st c="5338">We created our </st><code><st c="5354">template_data</st></code><st c="5367"> variable and assigned it </st><st c="5393">a title.</st></li>
				<li><st c="5401">Then, we checked whether the current HTTP request method is </st><code><st c="5462">GET</st></code><st c="5465">. If it is a </st><code><st c="5478">GET</st></code><st c="5481"> request, it means that it’s a user navigating to the signup form via the </st><code><st c="5555">localhost:8000/accounts/signup</st></code><st c="5585"> URL, in which case we simply send an instance of </st><code><st c="5635">UserCreationForm</st></code><st c="5651"> to the template. </st><st c="5669">Finally, we rendered the </st><code><st c="5694">accounts/signup.html</st></code><st c="5714"> template.</st></li>
			</ul>
			<p><st c="5724">Now, let’s continue by creating the </st><st c="5761">signup template.</st></p>
			<h2 id="_idParaDest-141"><a id="_idTextAnchor147"/><st c="5777">Creating accounts signup template</st></h2>
			<p><st c="5811">In </st><code><st c="5815">/accounts/</st></code><st c="5825">, create</st><a id="_idIndexMarker248"/><st c="5833"> a </st><code><st c="5836">templates</st></code><st c="5845"> folder. </st><st c="5854">Then, in </st><code><st c="5863">/accounts/templates/</st></code><st c="5883">, create an </st><code><st c="5895">accounts</st></code><st c="5903"> folder.</st></p>
			<p><st c="5911">Now, in </st><code><st c="5920">/accounts/templates/accounts/</st></code><st c="5949">, create a new</st><a id="_idIndexMarker249"/><st c="5963"> file, </st><code><st c="5970">signup.html</st></code><st c="5981">. For now, fill it in with </st><st c="6008">the following:</st></p>
			<pre class="source-code"><st c="6022">
{% extends 'base.html' %}
{% block content %}
&lt;div class="p-3 mt-4"&gt;
  &lt;div class="container"&gt;
    &lt;div class="row justify-content-center"&gt;
      &lt;div class="col-md-8"&gt;
        &lt;div class="card shadow p-3 mb-4 rounded"&gt;
          &lt;div class="card-body"&gt;
            &lt;h2&gt;Sign Up&lt;/h2&gt;
            &lt;hr /&gt;
            &lt;form method="POST"&gt;
              {% csrf_token %}
              {{ template_data.form.as_p }}
              &lt;button type="submit"
                class="btn bg-dark text-white"&gt;Sign Up
              &lt;/button&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
{% endblock content %}</st></pre>			<p><st c="6482">Let’s</st><a id="_idIndexMarker250"/><st c="6488"> explain </st><st c="6497">this code:</st></p>
			<ul>
				<li><st c="6507">We extend the </st><code><st c="6522">base.html</st></code><st c="6531"> template.</st></li>
				<li><st c="6541">We define a heading element with the text </st><code><st c="6584">Sign Up</st></code><st c="6591">.</st></li>
				<li><st c="6592">We define </st><code><st c="6603">form</st></code><st c="6607"> with its method as </st><code><st c="6627">POST</st></code><st c="6631">. This means that when the form is submitted, the data will be sent to the current server URL using the HTTP </st><code><st c="6740">POST </st></code><st c="6745">method.</st></li>
				<li><st c="6752">Inside the form, we use the DTL </st><code><st c="6785">csrf_token</st></code><st c="6795"> template tag. </st><st c="6810">It generates a </st><strong class="bold"><st c="6825">Cross-Site Request Forgery</st></strong><st c="6851"> (</st><strong class="bold"><st c="6853">CSRF</st></strong><st c="6857">) token, which </st><a id="_idIndexMarker251"/><st c="6873">helps prevent CSRF attacks. </st><st c="6901">It ensures that the form submission originates from the same site where the form is rendered. </st><st c="6995">You should use this tag for all your </st><st c="7032">Django forms.</st></li>
				<li><st c="7045">Inside the form, we render </st><code><st c="7073">template_data.form</st></code><st c="7091">, which represents the </st><code><st c="7114">UserCreationForm</st></code><st c="7130"> instance passed from the view function. </st><code><st c="7171">.as_p</st></code><st c="7176"> renders the form fields as HTML paragraphs (</st><code><st c="7221">&lt;p&gt;</st></code><st c="7225">), with each form field wrapped in its own paragraph. </st><st c="7280">By default, </st><code><st c="7292">UserCreationForm</st></code><st c="7308"> contains three form fields – </st><code><st c="7338">username</st></code><st c="7346">, </st><code><st c="7348">password</st></code><st c="7356">, and </st><code><st c="7362">password confirmation</st></code><st c="7383">.</st></li>
				<li><st c="7384">Inside the form, we include a </st><code><st c="7415">submit</st></code><st c="7421"> button. </st><st c="7430">This button will direct to the current URL using the HTTP </st><code><st c="7488">POST</st></code><st c="7492"> method. </st><st c="7501">Currently, our signup view function only specifies the logic for a </st><code><st c="7568">GET</st></code><st c="7571"> method. </st><st c="7580">Later, we will implement the logic for the </st><code><st c="7623">POST</st></code><st c="7627"> method.</st></li>
			</ul>
			<p class="callout-heading"><st c="7635">Note</st></p>
			<p class="callout"><st c="7640">In addition to </st><code><st c="7656">form.as_p</st></code><st c="7665">, there are other options to render form elements using different HTML tags. </st><st c="7742">You can find more information </st><st c="7772">here: </st><a href="https://docs.djangoproject.com/en/5.0/ref/forms/api/#output-styles"><st c="7778">https://docs.djangoproject.com/en/5.0/ref/forms/api/#output-styles</st></a><st c="7844">.</st></p>
			<p><st c="7845">Now, let’s finalize by adding the signup link to the </st><st c="7899">base template.</st></p>
			<h2 id="_idParaDest-142"><a id="_idTextAnchor148"/><st c="7913">Adding the signup link to the base template</st></h2>
			<p><st c="7957">In </st><code><st c="7961">/moviesstore/templates/base.html</st></code><st c="7993">, in the header section, add the following </st><a id="_idIndexMarker252"/><st c="8036">lines that are </st><st c="8051">in bold:</st></p>
			<pre class="source-code"><st c="8059">
        …
        &lt;div class="collapse navbar-collapse"
                    id="navbarNavAltMarkup"&gt;
          &lt;div class="navbar-nav ms-auto navbar-ml"&gt;
            &lt;a class="nav-link"
              href="{% url 'home.about' %}"&gt;About&lt;/a&gt;
            &lt;a class="nav-link" href=
              "{% url 'movies.index' %}"&gt;Movies&lt;/a&gt;
            </st><strong class="bold"><st c="8291">&lt;div class="vr bg-white mx-2 d-none</st></strong>
<strong class="bold"><st c="8326">              d-lg-block"&gt;&lt;/div&gt;</st></strong>
<strong class="bold"><st c="8345">            &lt;a class="nav-link"</st></strong>
<strong class="bold"><st c="8365">              href="{% url 'accounts.signup' %}"&gt;</st></strong>
<strong class="bold"><st c="8401">              Sign Up</st></strong>
<strong class="bold"><st c="8409">            &lt;/a&gt;</st></strong><st c="8414">
          &lt;/div&gt;
        &lt;/div&gt;
        …</st></pre>			<p><st c="8429">Now, save those files, run the server, and go to </st><a href="http://localhost:8000/accounts/signup"><st c="8479">http://localhost:8000/accounts/signup</st></a><st c="8516">; you should see the new </st><em class="italic"><st c="8542">signup</st></em><st c="8548"> page (</st><em class="italic"><st c="8555">Figure 8</st></em><em class="italic"><st c="8564">.2</st></em><st c="8566">).</st></p>
			<div><div><img src="img/B22457_08_2.jpg" alt="Figure 8.2 – The Sign Up page"/><st c="8569"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="9044">Figure 8.2 – The Sign Up page</st></p>
			<p><st c="9073">Note that if </st><a id="_idIndexMarker253"/><st c="9087">you try to complete and submit the form, it will display an error. </st><st c="9154">This is because we haven’t completed the </st><code><st c="9195">signup</st></code><st c="9201"> function.</st></p>
			<h1 id="_idParaDest-143"><a id="_idTextAnchor149"/><st c="9211">Improving the signup page to handle POST actions</st></h1>
			<p><st c="9260">When a</st><a id="_idIndexMarker254"/><st c="9267"> user submits the signup form, we will have to handle the request and create a user in admin. </st><st c="9361">To implement this, we will modify the </st><code><st c="9399">signup</st></code><st c="9405"> function.</st></p>
			<p><st c="9415">In </st><code><st c="9419">/accounts/views.py</st></code><st c="9437">, add the following lines that are </st><st c="9472">in bold:</st></p>
			<pre class="source-code"><st c="9480">
from django.shortcuts import render
from django.contrib.auth.forms import UserCreationForm
</st><strong class="bold"><st c="9572">from django.shortcuts import redirect</st></strong><st c="9609">
def signup(request):
    template_data = {}
    template_data['title'] = 'Sign Up'
    if request.method == 'GET':
        template_data['form'] = UserCreationForm()
        return render(request, 'accounts/signup.html',
            {'template_data': template_data})
</st><strong class="bold"/><strong class="bold"><st c="9837">elif request.method == 'POST':</st></strong>
<strong class="bold"><st c="9867">        form = UserCreationForm(request.POST)</st></strong>
<strong class="bold"><st c="9905">        if form.is_valid():</st></strong>
<strong class="bold"><st c="9925">            form.save()</st></strong>
<strong class="bold"><st c="9937">            return redirect('home.index')</st></strong>
<strong class="bold"><st c="9967">        else:</st></strong>
<strong class="bold"><st c="9973">            template_data['form'] = form</st></strong>
<strong class="bold"><st c="10002">            return render(request, 'accounts/signup.html',</st></strong>
<strong class="bold"><st c="10049">                {'template_data': template_data})</st></strong></pre>			<p><st c="10083">Let’s explain</st><a id="_idIndexMarker255"/> <st c="10097">this code:</st></p>
			<ul>
				<li><st c="10108">We import the </st><code><st c="10123">redirect</st></code><st c="10131"> function, which is used to redirect the user to a different URL within </st><st c="10203">the application.</st></li>
				<li><st c="10219">We add an </st><code><st c="10230">elif</st></code><st c="10234"> section. </st><st c="10244">This section checks whether the HTTP request method is </st><code><st c="10299">POST</st></code><st c="10303">, indicating that the form has </st><st c="10334">been submitted.</st></li>
				<li><st c="10349">Inside the </st><code><st c="10361">elif</st></code><st c="10365"> section, we create an instance of the </st><code><st c="10404">UserCreationForm</st></code><st c="10420"> class, passing the data from the request’s </st><code><st c="10464">POST</st></code><st c="10468"> parameters (</st><code><st c="10481">request.POST</st></code><st c="10494">) to populate the form fields. </st><st c="10526">This initializes the form with the </st><st c="10561">submitted data.</st></li>
				<li><st c="10576">The </st><code><st c="10581">if form.is_valid()</st></code><st c="10599"> checks whether the submitted form data is valid, according to the validation rules defined in the </st><code><st c="10698">UserCreationForm</st></code><st c="10714"> class. </st><st c="10722">These </st><a id="_idIndexMarker256"/><st c="10728">validations include that the two password fields match, the password is not common, and the username is unique, </st><st c="10840">among others.</st><ul><li><st c="10853">If the form data is valid, </st><code><st c="10881">form.save()</st></code><st c="10892"> saves the user data to the database. </st><st c="10930">This means creating a new user account with the provided username and password. </st><st c="11010">Also, we redirect the user to the </st><code><st c="11044">home</st></code><st c="11048"> page based on the URL </st><st c="11071">pattern name.</st></li><li><st c="11084">If the form data is not valid, the </st><code><st c="11120">else</st></code><st c="11124"> section is executed, and we pass the form (including the errors) to the template and render the </st><code><st c="11221">accounts/signup.html</st></code> <st c="11241">template again.</st></li></ul></li>
			</ul>
			<p><st c="11257">Now, run the server, and go to </st><a href="http://localhost:8000/accounts/signup"><st c="11289">http://localhost:8000/accounts/signup</st></a><st c="11326">. First, try to register a user with two passwords that don’t match (</st><em class="italic"><st c="11395">Figure 8</st></em><em class="italic"><st c="11404">.3</st></em><st c="11406">).</st></p>
			<div><div><img src="img/B22457_08_3.jpg" alt="Figure 8.3 – The Sign Up page with errors"/><st c="11409"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="11843">Figure 8.3 – The Sign Up page with errors</st></p>
			<p><st c="11884">Then, try to register </st><a id="_idIndexMarker257"/><st c="11907">a user with proper information, and you should be redirected to the </st><em class="italic"><st c="11975">home</st></em><st c="11979"> page. </st><st c="11986">Then, go to </st><a href="http://127.0.0.1:8000/admin/"><st c="11998">http://127.0.0.1:8000/admin/</st></a><st c="12026">, navigate to the </st><em class="italic"><st c="12044">users</st></em><st c="12049"> section, and you should see the new user registered in the database (</st><em class="italic"><st c="12119">Figure 8</st></em><em class="italic"><st c="12128">.4</st></em><st c="12130">).</st></p>
			<div><div><img src="img/B22457_08_4.jpg" alt="Figure 8.4 – The users admin page"/><st c="12133"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="12355">Figure 8.4 – The users admin page</st></p>
			<p><st c="12388">We can now </st><a id="_idIndexMarker258"/><st c="12400">register users. </st><st c="12416">Now, let’s </st><st c="12427">customize </st><code><st c="12437">UserCreationForm</st></code><st c="12453">.</st></p>
			<h1 id="_idParaDest-144"><a id="_idTextAnchor150"/><st c="12454">Customizing UserCreationForm</st></h1>
			<p><code><st c="12483">UserCreationForm</st></code><st c="12500"> currently </st><a id="_idIndexMarker259"/><st c="12511">shows quite a lot of additional help text (included by default) that is cluttering our form. </st><st c="12604">To remedy this, we can customize </st><code><st c="12637">UserCreationForm</st></code><st c="12653"> (which is a big topic on its own). </st><st c="12689">Here, we will apply some simple modifications to improve the look and feel of our </st><st c="12771">signup page.</st></p>
			<p><st c="12783">To </st><a id="_idIndexMarker260"/><st c="12787">implement these modifications, we will follow </st><st c="12833">these steps:</st></p>
			<ol>
				<li><st c="12845">Create </st><code><st c="12853">CustomUserCreationForm</st></code><st c="12875">.</st></li>
				<li><st c="12876">Update the </st><code><st c="12888">signup</st></code><st c="12894"> function to </st><st c="12907">use </st><code><st c="12911">CustomUserCreationForm</st></code><st c="12933">.</st></li>
				<li><st c="12934">Customize the way errors </st><st c="12960">are displayed.</st></li>
			</ol>
			<p><st c="12974">We will </st><a id="_idIndexMarker261"/><st c="12983">undertake each of these steps in detail in the next </st><st c="13035">few subsections.</st></p>
			<h2 id="_idParaDest-145"><a id="_idTextAnchor151"/><st c="13051">Creating CustomUserCreationForm</st></h2>
			<p><st c="13083">In </st><code><st c="13087">/accounts/</st></code><st c="13097">, create a </st><a id="_idIndexMarker262"/><st c="13108">new file called </st><code><st c="13124">forms.py</st></code><st c="13132">. This file will contain the custom forms of the </st><em class="italic"><st c="13181">accounts</st></em><st c="13189"> app. </st><st c="13195">For now, fill it in with the </st><st c="13224">following code:</st></p>
			<pre class="source-code"><st c="13239">
from django.contrib.auth.forms import UserCreationForm
class CustomUserCreationForm(UserCreationForm):
    def __init__(self, *args, **kwargs):
        super(CustomUserCreationForm, self).__init__
            (*args, **kwargs)
        for fieldname in ['username', 'password1',
        'password2']:
            self.fields[fieldname].help_text = None
            self.fields[fieldname].widget.attrs.update(
                {'class': 'form-control'}
            )</st></pre>			<p><st c="13611">Let’s explain </st><st c="13626">the code:</st></p>
			<ul>
				<li><st c="13635">We import the </st><code><st c="13650">UserCreationForm</st></code><st c="13666"> class from Django’s </st><st c="13687">authentication forms.</st></li>
				<li><st c="13708">We create a new class named </st><code><st c="13737">CustomUserCreationForm</st></code><st c="13759">, which inherits from </st><code><st c="13781">UserCreationForm</st></code><st c="13797">, making it a subclass of Django’s built-in user </st><st c="13846">creation form.</st></li>
				<li><st c="13860">We define the class constructor (the </st><code><st c="13898">__init__</st></code><st c="13906"> method). </st><st c="13916">The constructor calls the constructor of the parent class (</st><code><st c="13975">UserCreationForm</st></code><st c="13992">) through the </st><code><st c="14007">super</st></code><st c="14012"> method.</st></li>
				<li><st c="14020">Then, we</st><a id="_idIndexMarker263"/><st c="14029"> iterate through the fields provided by </st><code><st c="14069">UserCreationForm</st></code><st c="14085">. These are </st><code><st c="14097">'username'</st></code><st c="14107">, </st><code><st c="14109">'password1'</st></code><st c="14120">, and </st><code><st c="14126">'password2'</st></code><st c="14137">. For each field specified in the loop, we set the </st><code><st c="14188">help_text</st></code><st c="14197"> attribute to </st><code><st c="14211">None</st></code><st c="14215">, which removes any help text associated with these fields. </st><st c="14275">Finally, for each field specified in the loop, we add the CSS </st><code><st c="14337">form-control</st></code><st c="14349"> class to the field’s widget. </st><st c="14379">This is a Bootstrap class that improves the look and feel of </st><st c="14440">the fields.</st></li>
			</ul>
			<p><st c="14451">Next, let’s use </st><code><st c="14468">CustomUserCreationForm</st></code><st c="14490"> in our </st><code><st c="14498">signup</st></code><st c="14504"> function.</st></p>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor152"/><st c="14514">Updating the signup function to use CustomUserCreationForm</st></h2>
			<p><st c="14573">Let’s use the new </st><a id="_idIndexMarker264"/><st c="14592">form to improve the look and feel of the </st><st c="14633">signup page.</st></p>
			<p><st c="14645">In </st><code><st c="14649">/accounts/views.py</st></code><st c="14667">, add the following lines that are </st><st c="14702">in bold:</st></p>
			<pre class="source-code"><st c="14710">
from django.shortcuts import render
</st><strong class="bold"><st c="14747">from .forms import CustomUserCreationForm</st></strong><st c="14788">
from django.shortcuts import redirect
def signup(request):
    template_data = {}
    template_data['title'] = 'Sign Up'
    if request.method == 'GET':
        template_data['form'] = </st><strong class="bold"><st c="14954">CustomUserCreationForm</st></strong><st c="14976">()
        return render(request, 'accounts/signup.html',
            {'template_data': template_data})
    elif request.method == 'POST':
        form = </st><strong class="bold"><st c="15099">CustomUserCreationForm</st></strong><st c="15121">(request.POST)
        if form.is_valid():
            form.save()
            return redirect('home.index')
        else:
            template_data['form'] = form
            return render(request, 'accounts/signup.html',
                {'template_data': template_data})</st></pre>			<p><st c="15314">In the</st><a id="_idIndexMarker265"/><st c="15321"> updated code, we removed the import of </st><code><st c="15361">UserCreationForm</st></code><st c="15377"> and added the import of </st><code><st c="15402">CustomUserCreationForm</st></code><st c="15424">. Then, we replaced the calls of </st><code><st c="15457">UserCreationForm()</st></code><st c="15475"> with the calls </st><st c="15491">of </st><code><st c="15494">CustomUserCreationForm()</st></code><st c="15518">.</st></p>
			<p><st c="15519">Now, save those files, run the server, go to </st><a href="http://localhost:8000/accounts/signup"><st c="15565">http://localhost:8000/accounts/signup</st></a><st c="15602">, and try to register a user with two passwords that don’t match (</st><em class="italic"><st c="15668">Figure 8</st></em><em class="italic"><st c="15677">.5</st></em><st c="15679">); you will see that the look and feel </st><st c="15719">have improved.</st></p>
			<div><div><img src="img/B22457_08_5.jpg" alt="Figure 8.5 – An improved Sign Up page with errors"/><st c="15733"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="15798">Figure 8.5 – An improved Sign Up page with errors</st></p>
			<p><st c="15847">We can improve </st><a id="_idIndexMarker266"/><st c="15863">the way errors are displayed. </st><st c="15893">So, let’s customize this in the </st><st c="15925">next section.</st></p>
			<h2 id="_idParaDest-147"><a id="_idTextAnchor153"/><st c="15938">Customizing the way errors are displayed</st></h2>
			<p><st c="15979">Let’s customize the</st><a id="_idIndexMarker267"/><st c="15999"> way Django forms display errors. </st><st c="16033">In </st><code><st c="16036">/accounts/forms.py</st></code><st c="16054">, add the following lines that are </st><st c="16089">in bold:</st></p>
			<pre class="source-code"><st c="16097">
from django.contrib.auth.forms import UserCreationForm
</st><strong class="bold"><st c="16153">from django.forms.utils import ErrorList</st></strong>
<strong class="bold"><st c="16193">from django.utils.safestring import mark_safe</st></strong>
<strong class="bold"><st c="16239">class CustomErrorList(ErrorList):</st></strong>
<strong class="bold"><st c="16273">    def __str__(self):</st></strong>
<strong class="bold"><st c="16292">        if not self:</st></strong>
<strong class="bold"><st c="16305">            return ''</st></strong>
<strong class="bold"><st c="16315">        return mark_safe(''.join([</st></strong>
<strong class="bold"><st c="16342">            f'&lt;div class="alert alert-danger" role="alert"&gt;</st></strong>
<strong class="bold"><st c="16390">            {e}&lt;/div&gt;' for e in self]))</st></strong><st c="16418">
class CustomUserCreationForm(UserCreationForm):
    …</st></pre>			<p><st c="16468">Let’s explain</st><a id="_idIndexMarker268"/> <st c="16482">the code:</st></p>
			<ul>
				<li><st c="16492">We import the </st><code><st c="16507">ErrorList</st></code><st c="16516"> class, which is a default class used to store and display validation error messages associated with </st><st c="16617">form fields.</st></li>
				<li><st c="16629">We import the </st><code><st c="16644">mark_safe</st></code><st c="16653"> function, which is used to mark a string as safe for HTML rendering, indicating that it doesn’t contain any harmful content and should be rendered as-is </st><st c="16807">without escaping.</st></li>
				<li><st c="16824">We define a new class named </st><code><st c="16853">CustomErrorList</st></code><st c="16868">, which extends Django’s </st><code><st c="16893">ErrorList</st></code><st c="16902"> class. </st><st c="16910">This will be the class to define our custom error look </st><st c="16965">and feel.</st></li>
				<li><st c="16974">We override the </st><code><st c="16991">__str__()</st></code><st c="17000"> method of the base </st><code><st c="17020">ErrorList</st></code><st c="17029"> class. </st><st c="17037">If the error list is empty (i.e., there are no errors), it returns an empty string, indicating that no HTML should be generated. </st><st c="17166">Otherwise, it defines a custom HTML code that uses </st><code><st c="17217">&lt;div&gt;</st></code><st c="17222"> elements and Bootstrap CSS classes to improve the way the errors are displayed. </st><st c="17303">It also uses the </st><code><st c="17320">mark_safe</st></code><st c="17329"> function to render the </st><st c="17353">code as-is.</st></li>
			</ul>
			<p><st c="17364">Now that we have defined this </st><code><st c="17395">CustomErrorList</st></code><st c="17410"> class, we just need to specify to our forms that we will </st><st c="17468">use it.</st></p>
			<p><st c="17475">In </st><code><st c="17479">/accounts/views.py</st></code><st c="17497">, add the following </st><st c="17517">in bold:</st></p>
			<pre class="source-code"><st c="17525">
from django.shortcuts import render
from .forms import CustomUserCreationForm</st><strong class="bold"><st c="17603">, CustomErrorList</st></strong><st c="17620">
from django.shortcuts import redirect
def signup(request):
    template_data = {}
    template_data['title'] = 'Sign Up'
    if request.method == 'GET':
        template_data['form'] = CustomUserCreationForm()
        return render(request, 'accounts/signup.html',
            {'template_data': template_data})
    elif request.method == 'POST':
        form = CustomUserCreationForm(request.POST</st><strong class="bold"><st c="17965">,</st></strong>
<strong class="bold"><st c="17966">            error_class=CustomErrorList</st></strong><st c="17994">)
        ...</st></pre>			<p><st c="18000">We imported </st><a id="_idIndexMarker269"/><st c="18013">our </st><code><st c="18017">CustomErrorList</st></code><st c="18032"> class, and we passed this class as an argument to </st><code><st c="18083">CustomUserCreationForm</st></code><st c="18105">. This time, if an error is found when we submit the signup form, the form will use our </st><code><st c="18193">CustomErrorList</st></code><st c="18208"> class and display the errors with our custom HTML and </st><st c="18263">CSS code.</st></p>
			<p><st c="18272">Now, save those files, run the server, go to </st><a href="http://localhost:8000/accounts/signup"><st c="18318">http://localhost:8000/accounts/signup</st></a><st c="18355">, and try to register a user with two passwords that don’t match (</st><em class="italic"><st c="18421">Figure 8</st></em><em class="italic"><st c="18430">.6</st></em><st c="18432">); you will see that the look and feel </st><st c="18472">have improved.</st></p>
			<div><div><img src="img/B22457_08_6.jpg" alt="Figure 8.6 – The Sign Up page with an improved error style"/><st c="18486"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="18581">Figure 8.6 – The Sign Up page with an improved error style</st></p>
			<p><st c="18639">We have improved </st><a id="_idIndexMarker270"/><st c="18657">the look and feel of our errors. </st><st c="18690">Now, let’s implement a </st><st c="18713">login page.</st></p>
			<h1 id="_idParaDest-148"><a id="_idTextAnchor154"/><st c="18724">Creating a login page</st></h1>
			<p><st c="18746">Let’s </st><a id="_idIndexMarker271"/><st c="18753">implement the login page. </st><st c="18779">This time, we won’t use Django forms; we will create our own HTML form (to learn a new approach). </st><st c="18877">Let’s follow the </st><st c="18894">following steps:</st></p>
			<ol>
				<li><st c="18910">Configure a </st><st c="18923">login URL.</st></li>
				<li><st c="18933">Define the </st><code><st c="18945">login</st></code><st c="18950"> function.</st></li>
				<li><st c="18960">Create an accounts </st><st c="18980">login template.</st></li>
				<li><st c="18995">Add a link to the </st><st c="19014">base template.</st></li>
				<li><st c="19028">Redirect a registered user to the </st><st c="19063">login page.</st></li>
			</ol>
			<p><st c="19074">We’ll see these steps to create a login page, in depth, in the next </st><st c="19143">few subsections.</st></p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor155"/><st c="19159">Configuring a login URL</st></h2>
			<p><st c="19183">In </st><code><st c="19187">/accounts/urls.py</st></code><st c="19204">, add </st><a id="_idIndexMarker272"/><st c="19210">the following path </st><st c="19229">in bold:</st></p>
			<pre class="source-code"><st c="19237">
from django.urls import path
from . </st><st c="19274">import views
urlpatterns = [
    path('signup', views.signup, name='accounts.signup'),
    </st><strong class="bold"><st c="19357">path('login/', views.login, name='accounts.login'),</st></strong><st c="19408">
]</st></pre>			<p><st c="19410">So, if a URL matches the </st><code><st c="19435">/accounts/login</st></code><st c="19450"> path, it will execute the </st><code><st c="19477">login</st></code><st c="19482"> function defined in the </st><code><st c="19507">views</st></code><st c="19512"> file.</st></p>
			<p><st c="19518">Now that we have the new path, let’s define the </st><code><st c="19567">login</st></code><st c="19572"> function.</st></p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor156"/><st c="19582">Defining login function</st></h2>
			<p><st c="19606">In </st><code><st c="19610">/accounts/views.py</st></code><st c="19628">, add</st><a id="_idIndexMarker273"/><st c="19633"> the following lines that are </st><st c="19663">in bold:</st></p>
			<pre class="source-code"><st c="19671">
from django.shortcuts import render
</st><strong class="bold"><st c="19708">from django.contrib.auth import login as auth_login, authenticate</st></strong><st c="19773">
from .forms import CustomUserCreationForm, CustomErrorList
from django.shortcuts import redirect
</st><strong class="bold"><st c="19871">def login(request):</st></strong>
<strong class="bold"><st c="19890">    template_data = {}</st></strong>
<strong class="bold"><st c="19909">    template_data['title'] = 'Login'</st></strong>
<strong class="bold"><st c="19942">    if request.method == 'GET':</st></strong>
<strong class="bold"><st c="19970">        return render(request, 'accounts/login.html',</st></strong>
<strong class="bold"><st c="20016">            {'template_data': template_data})</st></strong>
<strong class="bold"><st c="20050">    elif request.method == 'POST':</st></strong>
<strong class="bold"><st c="20081">        user = authenticate(</st></strong>
<strong class="bold"><st c="20102">            request,</st></strong>
<strong class="bold"><st c="20111">            username = request.POST['username'],</st></strong>
<strong class="bold"><st c="20148">            password = request.POST['password']</st></strong>
<strong class="bold"><st c="20184">        )</st></strong>
<strong class="bold"><st c="20186">        if user is None:</st></strong>
<strong class="bold"><st c="20203">            template_data['error'] =</st></strong>
<strong class="bold"><st c="20228">                'The username or password is incorrect.'</st></strong>
<strong class="bold"><st c="20269">            return render(request, 'accounts/login.html',</st></strong>
<strong class="bold"><st c="20315">                {'template_data': template_data})</st></strong>
<strong class="bold"><st c="20349">        else:</st></strong>
<strong class="bold"><st c="20355">            auth_login(request, user)</st></strong>
<strong class="bold"><st c="20381">            return redirect('home.index')</st></strong><st c="20411">
def signup(request):
    …</st></pre>			<p><st c="20434">Let’s </st><a id="_idIndexMarker274"/><st c="20441">explain </st><st c="20449">the code:</st></p>
			<ul>
				<li><st c="20458">We import </st><code><st c="20469">login</st></code><st c="20474"> and </st><code><st c="20479">authenticate</st></code><st c="20491">. These are used for user authentication. </st><st c="20533">We import </st><code><st c="20543">login</st></code><st c="20548"> with an alias (</st><code><st c="20564">auth_login</st></code><st c="20575">) to avoid confusion with the </st><code><st c="20606">login</st></code> <st c="20611">function name.</st></li>
				<li><st c="20626">We create the </st><code><st c="20641">login</st></code><st c="20646"> function. </st><st c="20657">This function defines </st><code><st c="20679">template_data</st></code><st c="20692"> and </st><st c="20697">checks </st><code><st c="20704">request.method</st></code><st c="20718">.</st></li>
				<li><st c="20719">For </st><code><st c="20724">GET</st></code><st c="20727"> requests, the function renders the </st><code><st c="20763">accounts/login.html</st></code><st c="20782"> template.</st></li>
				<li><st c="20792">For </st><code><st c="20797">POST</st></code><st c="20801"> requests, the function attempts to authenticate the user using the provided </st><code><st c="20878">username</st></code><st c="20886"> and </st><code><st c="20891">password</st></code><st c="20899">. If authentication fails, it renders the login template again with an error message. </st><st c="20985">If authentication succeeds, it logs the user in and </st><a id="_idIndexMarker275"/><st c="21037">redirects them to the </st><em class="italic"><st c="21059">home</st></em><st c="21063"> page.</st></li>
			</ul>
			<p><st c="21069">Now, let’s create the template that requires the </st><code><st c="21119">login</st></code><st c="21124"> function.</st></p>
			<h2 id="_idParaDest-151"><a id="_idTextAnchor157"/><st c="21134">Creating accounts login template</st></h2>
			<p><st c="21167">In </st><code><st c="21171">/accounts/templates/accounts/</st></code><st c="21200">, create a new file, </st><code><st c="21221">login.html</st></code><st c="21231">. This file </st><a id="_idIndexMarker276"/><st c="21243">contains the HTML for the login page. </st><st c="21281">For now, fill </st><a id="_idIndexMarker277"/><st c="21295">it in with </st><st c="21306">the following:</st></p>
			<pre class="source-code"><st c="21320">
{% extends 'base.html' %}
{% block content %}
&lt;div class="p-3 mt-4"&gt;
  &lt;div class="container"&gt;
    &lt;div class="row justify-content-center"&gt;
      &lt;div class="col-md-8"&gt;
        &lt;div class="card shadow p-3 mb-4 rounded"&gt;
          &lt;div class="card-body"&gt;
            &lt;h2&gt;Login&lt;/h2&gt;
            &lt;hr /&gt;
            {% if template_data.error %}
            &lt;div class="alert alert-danger" role="alert"&gt;
              {{ template_data.error }}
            &lt;/div&gt;
            {% endif %}
            &lt;form method="POST"&gt;
              {% csrf_token %}
              &lt;p&gt;
                &lt;label for="username"&gt;Username&lt;/label&gt;
                &lt;input id="username" type="text"
                       name="username" required
                       autocomplete="username"
                       class="form-control"&gt;
              &lt;/p&gt;
              &lt;p&gt;
                &lt;label for="password"&gt;Password&lt;/label&gt;
                &lt;input id="password" type="password"
                       name="password" required
                       autocomplete="current-password"
                       class="form-control"&gt;
              &lt;/p&gt;
              &lt;div class="text-center"&gt;
                &lt;button type="submit"
                  class="btn bg-dark text-white"&gt;Login
                &lt;/button&gt;
              &lt;/div&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
{% endblock content %}</st></pre>			<p><st c="22215">Let’s </st><a id="_idIndexMarker278"/><st c="22222">explain </st><a id="_idIndexMarker279"/><st c="22230">the code:</st></p>
			<ul>
				<li><st c="22239">We extend the </st><code><st c="22254">base.html</st></code><st c="22263"> template and define a heading element with the </st><st c="22311">text </st><code><st c="22316">Login</st></code><st c="22321">.</st></li>
				<li><st c="22322">We check whether there is an error and, if so, </st><st c="22370">display it.</st></li>
				<li><st c="22381">We create an HTML form with a </st><code><st c="22412">POST</st></code><st c="22416"> method and the </st><code><st c="22432">csrf_token</st></code><st c="22442"> token. </st><st c="22450">This form contains two inputs, one for the username and another for the password. </st><st c="22532">It also contains a </st><st c="22551">submit button.</st></li>
			</ul>
			<p><st c="22565">Let’s continue by adding the login link to the </st><st c="22613">base template.</st></p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor158"/><st c="22627">Adding the link to the base template</st></h2>
			<p><st c="22664">Let’s </st><a id="_idIndexMarker280"/><st c="22671">add the login link in the base template. </st><st c="22712">In </st><code><st c="22715">/moviesstore/templates/base.html</st></code><st c="22747">, in the header section, add the following line that is </st><st c="22803">in bold:</st></p>
			<pre class="source-code"><st c="22811">
          …
          &lt;div class="navbar-nav ms-auto navbar-ml"&gt;
            &lt;a class="nav-link"
              href="{% url 'home.about' %}"&gt;About&lt;/a&gt;
            &lt;a class="nav-link"
              href="{% url 'movies.index' %}"&gt;Movies&lt;/a&gt;
            &lt;div class=
              "vr bg-white mx-2 d-none d-lg-block"&gt;&lt;/div&gt;
</st><strong class="bold"><st c="23035">            &lt;a class="nav-link"</st></strong>
<strong class="bold"><st c="23054">              href="{% url 'accounts.login' %}"&gt;Login&lt;/a&gt;</st></strong><st c="23098">
            &lt;a class="nav-link"
              href="{% url 'accounts.signup' %}"&gt;Sign Up
            &lt;/a&gt;
          &lt;/div&gt;
          …</st></pre>			<p><st c="23175">Now, save</st><a id="_idIndexMarker281"/><st c="23185"> those files, run the server, and go to </st><a href="http://localhost:8000/accounts/login"><st c="23225">http://localhost:8000/accounts/login</st></a><st c="23261">; you will see the new </st><strong class="bold"><st c="23285">Login</st></strong><st c="23290"> page (</st><em class="italic"><st c="23297">Figure 8</st></em><em class="italic"><st c="23306">.7</st></em><st c="23308">).</st></p>
			<div><div><img src="img/B22457_08_7.jpg" alt="Figure 8.7 – The Login page"/><st c="23311"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="23367">Figure 8.7 – The Login page</st></p>
			<p><st c="23394">Now that we have a login page, let’s redirect the user to it when they create </st><st c="23473">an account.</st></p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor159"/><st c="23484">Redirecting a registered user to the login page</st></h2>
			<p><st c="23532">Let’s finalize</st><a id="_idIndexMarker282"/><st c="23547"> this section by redirecting a user who just registered to the </st><code><st c="23625">/accounts/views.py</st></code><st c="23643">, add the following </st><st c="23663">in bold:</st></p>
			<pre class="source-code"><st c="23671">
…
def signup(request):
    template_data = {}
    template_data['title'] = 'Sign Up'
    if request.method == 'GET':
        template_data['form'] = CustomUserCreationForm()
        return render(request, 'accounts/signup.html',
            {'template_data': template_data})
    elif request.method == 'POST':
        form = CustomUserCreationForm(request.POST,
            error_class=CustomErrorList)
        if form.is_valid():
            form.save()
            return redirect(</st><strong class="bold"><st c="24058">'accounts.login</st></strong><st c="24074">')
            …</st></pre>			<p><st c="24079">We just modified the redirection to the </st><strong class="bold"><st c="24120">Login</st></strong><st c="24125"> page. </st><st c="24132">Try to create a new user, and they should be redirected to the </st><strong class="bold"><st c="24195">Login</st></strong><st c="24200"> page.</st></p>
			<p><st c="24206">Let’s finalize this chapter by implementing a </st><st c="24253">logout functionality.</st></p>
			<h1 id="_idParaDest-154"><a id="_idTextAnchor160"/><st c="24274">Implementing a logout functionality</st></h1>
			<p><st c="24310"> We’ll </st><a id="_idIndexMarker283"/><st c="24317">follow the </st><st c="24328">following steps:</st></p>
			<ol>
				<li><st c="24344">Configure a </st><st c="24357">logout URL.</st></li>
				<li><st c="24368">Define the </st><code><st c="24380">logout</st></code><st c="24386"> function.</st></li>
				<li><st c="24396">Add a </st><a id="_idIndexMarker284"/><st c="24403">link to the </st><st c="24415">base template.</st></li>
			</ol>
			<p><st c="24429">We’ll undertake these steps in the </st><st c="24465">upcoming sections.</st></p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor161"/><st c="24483">Configuring a logout URL</st></h2>
			<p><st c="24508">In </st><code><st c="24512">/accounts/urls.py</st></code><st c="24529">, add</st><a id="_idIndexMarker285"/><st c="24534"> the path that is </st><st c="24552">in bold:</st></p>
			<pre class="source-code"><st c="24560">
from django.urls import path
from . </st><st c="24597">import views
urlpatterns = [
    path('signup', views.signup, name='accounts.signup'),
    path('login/', views.login, name='accounts.login'),
    </st><strong class="bold"><st c="24732">path('logout/', views.logout, name='accounts.logout'),</st></strong><st c="24786">
]</st></pre>			<p><st c="24788">Now, if a URL matches the </st><code><st c="24814">/accounts/logout</st></code><st c="24830"> path, it will execute the </st><code><st c="24857">logout</st></code><st c="24863"> function defined in the </st><code><st c="24888">views</st></code><st c="24893"> file.</st></p>
			<h2 id="_idParaDest-156"><a id="_idTextAnchor162"/><st c="24899">Defining the logout function</st></h2>
			<p><st c="24928">In </st><code><st c="24932">/accounts/views.py</st></code><st c="24950">, add </st><a id="_idIndexMarker286"/><st c="24956">the following lines that are </st><st c="24985">in bold:</st></p>
			<pre class="source-code"><st c="24993">
from django.shortcuts import render
from django.contrib.auth import login as auth_login, authenticate</st><strong class="bold"><st c="25095">, logout as auth_logout</st></strong><st c="25118">
from .forms import CustomUserCreationForm, CustomErrorList
from django.shortcuts import redirect
</st><strong class="bold"><st c="25216">from django.contrib.auth.decorators import login_required</st></strong>
<strong class="bold"><st c="25273">@login_required</st></strong>
<strong class="bold"><st c="25289">def logout(request):</st></strong>
<strong class="bold"><st c="25310">    auth_logout(request)</st></strong>
<strong class="bold"><st c="25331">    return redirect('home.index')</st></strong><st c="25361">
def login(request):
    …</st></pre>			<p><st c="25383">Let’s explain</st><a id="_idIndexMarker287"/> <st c="25397">the code:</st></p>
			<ul>
				<li><st c="25407">We import the </st><code><st c="25422">logout</st></code><st c="25428"> function as </st><code><st c="25441">auth_logout</st></code><st c="25452">. This is used to log a </st><st c="25476">user out.</st></li>
				<li><st c="25485">We import </st><code><st c="25496">login_required</st></code><st c="25510">, which is a decorator to ensure that only authenticated users can access specific view functions. </st><st c="25609">A Django </st><strong class="bold"><st c="25618">decorator</st></strong><st c="25627"> is a function that</st><a id="_idIndexMarker288"/><st c="25646"> wraps another function or method to modify its behavior. </st><st c="25704">Decorators are commonly used for things such as authentication, permissions, </st><st c="25781">and logging.</st></li>
				<li><st c="25793">We create the </st><code><st c="25808">logout</st></code><st c="25814"> function, which uses the </st><code><st c="25840">login_required</st></code><st c="25854"> decorator. </st><st c="25866">This means that only authenticated users can access </st><st c="25918">this function.</st></li>
				<li><st c="25932">The </st><code><st c="25937">logout</st></code><st c="25943"> function calls </st><code><st c="25959">auth_logout</st></code><st c="25970">, which is used to log out the current user. </st><st c="26015">Then, the function redirects the user to the </st><em class="italic"><st c="26060">home</st></em><st c="26064"> page.</st></li>
			</ul>
			<p><st c="26070">Next, let’s add the logout link to the </st><st c="26110">base template.</st></p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor163"/><st c="26124">Adding the link to the base template</st></h2>
			<p><st c="26161">In </st><code><st c="26165">/moviesstore/templates/base.html</st></code><st c="26197">, in the header section, add the following</st><a id="_idIndexMarker289"/><st c="26239"> lines that are </st><st c="26255">in bold:</st></p>
			<pre class="source-code"><st c="26263">
          …
            &lt;a class="nav-link"
              href="{% url 'home.about' %}"&gt;About&lt;/a&gt;
            &lt;a class="nav-link"
              href="{% url 'movies.index' %}"&gt;Movies&lt;/a&gt;
            &lt;div class=
              "vr bg-white mx-2 d-none d-lg-block"&gt;&lt;/div&gt;
            </st><strong class="bold"><st c="26444">{% if user.is_authenticated %}</st></strong>
<strong class="bold"><st c="26474">            &lt;a class="nav-link"</st></strong>
<strong class="bold"><st c="26494">              href="{% url 'accounts.logout' %}"&gt;Logout ({{</st></strong>
<strong class="bold"><st c="26540">              user.username }})&lt;/a&gt;</st></strong>
<strong class="bold"><st c="26562">            {% else %}</st></strong><st c="26573">
            &lt;a class="nav-link"
              href="{% url 'accounts.login' %}"&gt;Login&lt;/a&gt;
            &lt;a class="nav-link"
              href="{% url 'accounts.signup' %}"&gt;Sign Up
            &lt;/a&gt;
            </st><strong class="bold"><st c="26706">{% endif %}</st></strong><st c="26717">
          …</st></pre>			<p><st c="26718">We use a </st><a id="_idIndexMarker290"/><st c="26727">Django template tag that checks whether the user is authenticated (logged in). </st><st c="26806">This validation comes from Django’s authentication system. </st><st c="26865">If the user is authenticated, we display the </st><em class="italic"><st c="26910">logout</st></em><st c="26916"> option (which includes the username). </st><st c="26955">Otherwise, we display the </st><em class="italic"><st c="26981">login</st></em><st c="26986"> and </st><em class="italic"><st c="26991">sign </st></em><em class="italic"><st c="26996">up</st></em><st c="26998"> options.</st></p>
			<p><st c="27007">Now, save those files, run the server, and go to </st><a href="http://localhost:8000/"><st c="27057">http://localhost:8000/</st></a><st c="27079">; you will see how the navbar options change whether the user is logged in or not (</st><em class="italic"><st c="27163">Figure 8</st></em><em class="italic"><st c="27172">.8</st></em><st c="27174">).</st></p>
			<div><div><img src="img/B22457_08_8.jpg" alt="Figure 8.8 – The home page with the navbar updated"/><st c="27177"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><st c="27300">Figure 8.8 – The home page with the navbar updated</st></p>
			<p><st c="27350">We have completed our</st><a id="_idIndexMarker291"/><st c="27372"> user signup, login, and </st><st c="27397">logout system.</st></p>
			<h1 id="_idParaDest-158"><a id="_idTextAnchor164"/><st c="27411">Summary</st></h1>
			<p><st c="27419">In this chapter, we implemented a complete authentication system. </st><st c="27486">Now, users can sign up, log in, and log out. </st><st c="27531">We also learned how to take advantage of some Django forms, how to create our own HTML forms, and how to handle validations </st><st c="27655">and errors.</st></p>
			<p><st c="27666">In the next chapter, we will implement a movie </st><st c="27714">review system.</st></p>
		</div>
	<div></body></html>