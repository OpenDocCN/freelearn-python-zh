<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><div id="_idContainer187">
			<h1 id="_idParaDest-344"><em class="italic"><a id="_idTextAnchor325"/>Chapter 21</em>: The Bridge Pattern</h1>
			<p>In the previous two chapters, we covered our first structural pattern, <strong class="bold">adapter</strong>, which is used to make two incompatible interfaces compatible, and <strong class="bold">decorator</strong>, which allows us to add responsibilities to an object in a dynamic way. There are more similar patterns. Let's continue with the series!</p>
			<p>A third structural pattern to look at is the <strong class="bold">bridge</strong> pattern. We can actually compare the <em class="italic">bridge</em> and the <em class="italic">adapter</em> patterns by looking at the way they work. While the adapter is used to make unrelated classes work together (as we saw in the implementation example discussed in <a href="B17499_19_Final_SS_ePub.xhtml#_idTextAnchor310"><em class="italic">Chapter 19</em></a>, <em class="italic">The Adapter Pattern</em>), the bridge pattern is designed upfront to decouple an implementation from its abstraction, as we are going to see in this chapter. </p>
			<p>Specifically, we will discuss the following topics:</p>
			<ul>
				<li>Real-world examples</li>
				<li>Use cases</li>
				<li>Implementation</li>
			</ul>
			<p>By the end of this chapter, we will know how to implement this design pattern and understand better the aforementioned difference with the adapter pattern.</p>
			<h1 id="_idParaDest-345"><a id="_idTextAnchor326"/>Technical requirements</h1>
			<p>The code files for this chapter can be accessed through this link: <a href="https://github.com/PacktPublishing/Advanced-Python-Programming-Second-Edition/tree/main/Chapter21">https://github.com/PacktPublishing/Advanced-Python-Programming-Second-Edition/tree/main/Chapter21</a>.</p>
			<h1 id="_idParaDest-346"><a id="_idTextAnchor327"/>Real-world examples</h1>
			<p>In our modern, everyday lives, one <a id="_idIndexMarker1264"/>example of the bridge pattern that I can think of is <strong class="bold">information products</strong> from the <em class="italic">digital economy</em>. Nowadays, the information product, or <strong class="bold">infoproduct</strong> is part of the resources you can find online for training, self-improvement, or your ideas and business development. The purpose of an information product found on certain marketplaces, or the website of the provider, is to deliver information on a given topic in such a way that it is easy to access <a id="_idIndexMarker1265"/>and consume. The material provided can be a PDF document or ebook, an ebook series, a video, a video series, an online course, a subscription-based newsletter, or a combination of all those formats.</p>
			<p>In the software realm, <strong class="bold">device drivers</strong> are often cited as an example of the bridge pattern, when <a id="_idIndexMarker1266"/>the developer of an <strong class="bold">operating system</strong> (<strong class="bold">OS</strong>) defines the interface <a id="_idIndexMarker1267"/>for device vendors to implement it.</p>
			<p>Next, let's discuss when this design pattern should be employed.</p>
			<h1 id="_idParaDest-347"><a id="_idTextAnchor328"/>Use cases</h1>
			<p>Using the bridge pattern is a good idea when you want to share an implementation among multiple objects. Basically, instead <a id="_idIndexMarker1268"/>of implementing several specialized classes, defining all that is required within each class, you can define the following special components:</p>
			<ul>
				<li>An abstraction that applies to all the classes</li>
				<li>A separate interface for the different objects involved</li>
			</ul>
			<p>Next, we will see an implementation example that illustrates this approach.</p>
			<h1 id="_idParaDest-348"><a id="_idTextAnchor329"/>Implementation</h1>
			<p>Let's assume we are building an application where the user is going to manage and deliver content after <a id="_idIndexMarker1269"/>fetching it from diverse sources, which could be the following:</p>
			<ul>
				<li>A web page (based on its URL)</li>
				<li>A resource accessed on an FTP server</li>
				<li>A file on the local filesystem</li>
				<li>A database server</li>
			</ul>
			<p>So, here is the idea: instead of implementing several content classes, each holding the methods responsible for getting the content pieces, assembling them, and showing them inside the <a id="_idIndexMarker1270"/>application, we can define an abstraction for the <strong class="source-inline">Resource Content</strong><em class="italic"> </em>and a separate interface for the objects that are responsible for fetching the content. Let's try it!</p>
			<p>We begin with the class for our <strong class="source-inline">Resource Content</strong> abstraction, called <strong class="source-inline">ResourceContent</strong>. Then, we <a id="_idIndexMarker1271"/>will need to define the interface for implementation classes that help fetch content, that is, the <strong class="source-inline">ResourceContentFetcher</strong> class. This concept is called the <strong class="bold">Implementor</strong>.</p>
			<p>The first trick we use here is to use the <strong class="source-inline">_imp </strong>attribute on the <strong class="source-inline">ResourceContent</strong> class to maintain a reference to the object, which represents the <em class="italic">Implementor</em>:</p>
			<p class="source-code">class ResourceContent:</p>
			<p class="source-code">    """</p>
			<p class="source-code">    Define the abstraction's interface.</p>
			<p class="source-code">    Maintain a reference to an object which represents \</p>
			<p class="source-code">      the Implementor.</p>
			<p class="source-code">    """</p>
			<p class="source-code">    def __init__(self, imp):</p>
			<p class="source-code">        self._imp = imp</p>
			<p class="source-code">    def show_content(self, path):</p>
			<p class="source-code">        self._imp.fetch(path)</p>
			<p>As you may know by now, we <a id="_idIndexMarker1272"/>define the equivalent of an interface in the Python language using two features: the <strong class="source-inline">metaclass</strong> feature (which helps define the <em class="italic">type of a type</em>), and <strong class="bold">abstract base classes</strong> (<strong class="bold">ABC</strong>), as shown here:</p>
			<p class="source-code">class ResourceContentFetcher(metaclass=abc.ABCMeta):</p>
			<p class="source-code">    """</p>
			<p class="source-code">    Define the interface for implementation classes that \ </p>
			<p class="source-code">      fetch content.</p>
			<p class="source-code">    """</p>
			<p class="source-code">    </p>
			<p class="source-code">    @abc.abstractmethod</p>
			<p class="source-code">    def fetch(path):</p>
			<p class="source-code">        pass</p>
			<p>Now, we can add an <a id="_idIndexMarker1273"/>implementation class called <strong class="source-inline">URLFetcher</strong> to fetch content from a web page or resource:</p>
			<p class="source-code">class URLFetcher(ResourceContentFetcher):</p>
			<p class="source-code">    """</p>
			<p class="source-code">    Implement the Implementor interface and define its \</p>
			<p class="source-code">      concrete</p>
			<p class="source-code">    implementation.</p>
			<p class="source-code">    """</p>
			<p class="source-code">    </p>
			<p class="source-code">    def fetch(self, path):</p>
			<p class="source-code">        # path is an URL</p>
			<p class="source-code">        req = urllib.request.Request(path)</p>
			<p class="source-code">        with urllib.request.urlopen(req) as response:</p>
			<p class="source-code">            if response.code == 200:</p>
			<p class="source-code">                the_page = response.read()</p>
			<p class="source-code">                print(the_page)</p>
			<p>We can also add an implementation class called <strong class="source-inline">LocalFileFecher</strong> to fetch content from a file on the local filesystem:</p>
			<p class="source-code">class LocalFileFetcher(ResourceContentFetcher):</p>
			<p class="source-code">    """</p>
			<p class="source-code">    Implement the Implementor interface and define its \ </p>
			<p class="source-code">      concrete</p>
			<p class="source-code">    implementation.</p>
			<p class="source-code">    """</p>
			<p class="source-code">    def fetch(self, path):</p>
			<p class="source-code">        # path is the filepath to a text file</p>
			<p class="source-code">        with open(path) as f:</p>
			<p class="source-code">            print(r.read())</p>
			<p>Based on that, our <strong class="source-inline">main</strong> function for <a id="_idIndexMarker1274"/>showing content using both <em class="italic">content fetchers </em>could look like the following:</p>
			<p class="source-code">def main():</p>
			<p class="source-code">    url_fetcher = URLFetcher()</p>
			<p class="source-code">    iface = ResourceContent(url_fetcher)</p>
			<p class="source-code">    iface.show_content('http://python.org')</p>
			<p class="source-code">    print('===================')</p>
			<p class="source-code">    </p>
			<p class="source-code">    localfs_fetcher = LocalFileFetcher()</p>
			<p class="source-code">    iface = ResourceContent(localfs_fetcher)</p>
			<p class="source-code">    iface.show_content('file.txt')</p>
			<p>Overall, our process could be summarized in the following UML diagram, where <strong class="source-inline">LocalFileFetcher</strong> and <strong class="source-inline">URLFetcher</strong> both inherit from <strong class="source-inline">ResrouceContentFetcher</strong>, and <strong class="source-inline">ResourceContent</strong> stores a <strong class="source-inline">Fetcher</strong> object in its <strong class="source-inline">_imp</strong> field:</p>
			<div>
				<div id="_idContainer186" class="IMG---Figure">
					<img src="image/Figure_21.1_B17499.jpg" alt="Figure 21.1 — UML diagram of the content-fetching application " width="1650" height="594"/>
				</div>
			</div>
			<p class="figure-caption">Figure 21.1 — UML diagram of the content-fetching application</p>
			<p>Let's see a summary for the complete code of our example (the <strong class="source-inline">bridge.py</strong> file):</p>
			<ol>
				<li>We import the three <a id="_idIndexMarker1275"/>modules we need for the program (<strong class="source-inline">abc</strong>, <strong class="source-inline">urllib.parse</strong>, and <strong class="source-inline">urllib.request</strong>).</li>
				<li>We define the <strong class="source-inline">ResourceContent</strong> class for the interface of the abstraction.</li>
				<li>We define the <strong class="source-inline">ResourceContentFetcher</strong> class for the implementator.</li>
				<li>We define two <strong class="source-inline">implementation</strong> classes:<ul><li><strong class="source-inline">URLFetcher</strong> for fetching content from a URL</li><li><strong class="source-inline">LocalFileFetcher</strong> for fetching content from the local filesystem</li></ul></li>
				<li>Finally, we add the <strong class="source-inline">main()</strong> function, as shown previously, and the usual trick to call it.</li>
			</ol>
			<p>Here is some sample output when executing the <strong class="source-inline">python bridge.py</strong> command:</p>
			<p class="source-code">[output truncated]</p>
			<p class="source-code">des.js"&gt;&lt;/script&gt;\n\n    &lt;script type="text/javascript" </p>
			<p class="source-code">src="/static/js/main-min.dd72c1659644.js" charset="utf-</p>
			<p class="source-code">8"&gt;&lt;/script&gt;\n    \n\n    &lt;!--[if lte IE 7]&gt;\n    &lt;script </p>
			<p class="source-code">type="text/javascript" src="/static/js/plugins/IE8-</p>
			<p class="source-code">min.8af6e26c7a3b.js" charset="utf-8"&gt;&lt;/script&gt;\n    \n    </p>
			<p class="source-code">\n    &lt;![endif]--&gt;\n\n    &lt;!--[if lte IE 8]&gt;\n    &lt;script </p>
			<p class="source-code">type="text/javascript" </p>
			<p class="source-code">src="/static/js/plugins/getComputedStyle-</p>
			<p class="source-code">min.d41d8cd98f00.js" charset="utf-8"&gt;&lt;/script&gt;\n    \n    </p>
			<p class="source-code">\n    &lt;![endif]--&gt;\n\n    \n\n    \n    </p>
			<p class="source-code">\n\n&lt;/body&gt;\n&lt;/html&gt;\n'</p>
			<p class="source-code">===================</p>
			<p class="source-code">Lorem ipsum dolor sit amet, consectetur adipiscing elit. </p>
			<p class="source-code">Proin in nibh in enim euismod mattis placerat in velit. </p>
			<p class="source-code">Donec malesuada risus sed venenatis pharetra. Proin </p>
			<p class="source-code">tincidunt porttitor euismod. Etiam non odio sodales, </p>
			<p class="source-code">tincidunt elit ac, sodales nisi. Donec massa felis, </p>
			<p class="source-code">pharetra ut libero nec, consectetur venenatis dui. </p>
			<p class="source-code">Phasellus nec sem non erat ultricies finibus. Donec sed </p>
			<p class="source-code">blandit arcu. Aliquam erat volutpat. Donec aliquam ipsum </p>
			<p class="source-code">risus, et accumsan nibh faucibus non. Aenean faucibus </p>
			<p class="source-code">feugiat diam vitae rutrum. Sed ullamcorper leo sed orci </p>
			<p class="source-code">efficitur rhoncus.</p>
			<p class="source-code">Duis vitae dolor vestibulum nibh semper faucibus. Vivamus </p>
			<p class="source-code">libero quam, ultrices quis sapien vel, blandit ultricies </p>
			<p class="source-code">purus. Nunc nisl lorem, rutrum id aliquam nec, dictum non </p>
			<p class="source-code">ligula. Duis ullamcorper, nulla quis luctus commodo, massa </p>
			<p class="source-code">lorem tristique orci, quis aliquam diam est semper nisi. </p>
			<p class="source-code">Maecenas tempor odio auctor nulla efficitur, non convallis </p>
			<p class="source-code">tellus iaculis. Fusce quis purus nibh. Nulla tempor est vel </p>
			<p class="source-code">metus sodales, in dapibus risus molestie. Donec tristique </p>
			<p class="source-code">tellus in pretium pulvinar. Pellentesque ut vehicula </p>
			<p class="source-code">mauris. Vivamus pellentesque, tellus in dictum vehicula, </p>
			<p class="source-code">justo ex volutpat sem, at cursus nisl elit non ex. Sed sed </p>
			<p class="source-code">leo eget eros lobortis laoreet. Sed ornare vitae mi a </p>
			<p class="source-code">vestibulum. Suspendisse potenti. Donec sed ligula ac enim </p>
			<p class="source-code">mattis posuere.</p>
			<p>This is a basic illustration <a id="_idIndexMarker1276"/>of how, using the bridge pattern in your design, you can extract content from different sources and integrate the results in the same data manipulation system or user interface.</p>
			<h1 id="_idParaDest-349"><a id="_idTextAnchor330"/>Summary</h1>
			<p>In this chapter, we discussed the bridge pattern. Sharing similarities with the adapter pattern, the bridge pattern differs in the sense that it is used upfront to define an abstraction and its implementation in a decoupled way so that both can vary independently.</p>
			<p>The bridge pattern is useful when writing software for problem domains such as OSs, device drivers, GUIs, and website builders where we have multiple themes, and we need to change the theme of a website based on certain properties.</p>
			<p>To help you understand this pattern, we discussed an example in the domain of content extraction and management, where we defined an interface for the abstraction, an interface for the Implementor, and two implementations.</p>
			<p>In the next chapter, we are going to cover the façade pattern.</p>
			<h1 id="_idParaDest-350"><a id="_idTextAnchor331"/>Questions</h1>
			<ol>
				<li value="1">What is the main motivation for the bridge pattern?</li>
				<li>How does the bridge pattern differ from the adapter pattern?</li>
				<li>How is the bridge pattern implemented in the Python example of content extraction we considered?</li>
			</ol>
		</div>
	</div>
</div>
</body></html>