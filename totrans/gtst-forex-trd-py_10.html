<html><head></head><body>
<div id="_idContainer103">
<h1 class="chapter-number" id="_idParaDest-170"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-171"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.2.1">Types of Orders and Their Simulation in Python</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the previous chapter, we considered a number of classical trading strategies usually employed in FX trading. </span><span class="koboSpan" id="kobo.3.2">All of them can be automated – that is, the decision to place a trade can be made based on quantitative data only, and placing a trade in the market can be done by an algorithm. </span><span class="koboSpan" id="kobo.3.3">So, we need now to find a proper way to place trades and control </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">their execution.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">We already mentioned (see </span><a href="B19145_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Developing Trading Strategies – Why They Are Different</span></em><span class="koboSpan" id="kobo.9.1">) that any trade, manual or automated, can be placed in the market by using an order: an instruction to the broker (or any other intermediary) to buy or sell. </span><span class="koboSpan" id="kobo.9.2">What could be simpler? </span><span class="koboSpan" id="kobo.9.3">However, the reality is always more complex. </span><span class="koboSpan" id="kobo.9.4">You may want to trade at a certain price, no worse than a certain price, no more than a specified amount of pips (points) from a certain price, and so on. </span><span class="koboSpan" id="kobo.9.5">Besides that, in the real market, there is real liquidity, which is always very far from infinite, so you may have your orders rejected, filled partially, or executed at the </span><em class="italic"><span class="koboSpan" id="kobo.10.1">wrong</span></em><span class="koboSpan" id="kobo.11.1"> prices, and many more unexpected and undesired things may happen if you are </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">not prepared.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">Now, it’s time we learn about the main types of orders typically supported by most FX liquidity pools, consider the difference in execution depending on the order type, understand the choice of order types depending on the goal, and get prepared to outline the architecture of an order simulation engine, which imitates possible execution issues and, along with the trade logic, helps you test and improve your strategy to fit the real-life conditions before putting real money </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">at stake.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.17.1">Order ticket – what you send is what </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">you get</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Market orders – the way to get maximum control over </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">transactional risk</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Limit orders – guaranteed price, but </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">not execution</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Time in force – better control </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">over execution</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">Stop orders – maximum </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">uncontrolled risk</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.27.1">Compound orders</span></span></li>
</ul>
<h1 id="_idParaDest-172"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.28.1">Order ticket – what you send is what you get</span></h1>
<p><span class="koboSpan" id="kobo.29.1">Let’s start with drafting a prototype of a general order ticket – something that is sent to a </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">trading venue.</span></span></p>
<p><span class="koboSpan" id="kobo.31.1">Normally, orders are sent either as FIX messages (see </span><a href="B19145_04.xhtml#_idTextAnchor073"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.32.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.33.1">, </span><em class="italic"><span class="koboSpan" id="kobo.34.1">Trading Application – What’s Inside?</span></em><span class="koboSpan" id="kobo.35.1">) or in JSON format according to the venue’s specifications. </span><span class="koboSpan" id="kobo.35.2">As we also noted in </span><a href="B19145_04.xhtml#_idTextAnchor073"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.36.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.37.1">, every venue has its own data and ordering interfaces, but the core properties of an order always remain </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">the same.</span></span></p>
<p><span class="koboSpan" id="kobo.39.1">Actually, the list of these properties is quite logical. </span><span class="koboSpan" id="kobo.39.2">Let’s prepare an empty form and fill in its fields one </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">by one.</span></span></p>
<p><span class="koboSpan" id="kobo.41.1">First, each order should go out with an ID. </span><span class="koboSpan" id="kobo.41.2">Otherwise, how do we or the trading venue refer to it? </span><span class="koboSpan" id="kobo.41.3">If we trade live, then the trading venue will generate an order ID that we receive, but if we run a backtest and want to modify orders that had been sent earlier, we need an internally generated order ID. </span><span class="koboSpan" id="kobo.41.4">Anyway, number one in our order form is </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.42.1">Order ID</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer094">
<span class="koboSpan" id="kobo.44.1"><img alt="Figure ﻿10.1 – The first attribute of an order is Order ID" src="image/B19145_10_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.45.1">Figure 10.1 – The first attribute of an order is Order ID</span></p>
<p><span class="koboSpan" id="kobo.46.1">Next, we need to let the venue know which market we want to trade in. </span><span class="koboSpan" id="kobo.46.2">As always, please keep in mind that every trading venue has its own specification. </span><span class="koboSpan" id="kobo.46.3">For example, EURUSD can be sent as </span><em class="italic"><span class="koboSpan" id="kobo.47.1">EURUSD</span></em><span class="koboSpan" id="kobo.48.1">, </span><em class="italic"><span class="koboSpan" id="kobo.49.1">EUR/USD</span></em><span class="koboSpan" id="kobo.50.1">, </span><em class="italic"><span class="koboSpan" id="kobo.51.1">eur-usd</span></em><span class="koboSpan" id="kobo.52.1">, and so on. </span><span class="koboSpan" id="kobo.52.2">So, check the venue’s documentation before actually sending orders. </span><span class="koboSpan" id="kobo.52.3">Let’s add the second record to the order ticket – </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.53.1">Instrument ID</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer095">
<span class="koboSpan" id="kobo.55.1"><img alt="Figure ﻿10.2 – Instrument ID added" src="image/B19145_10_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.56.1">Figure 10.2 – Instrument ID added</span></p>
<p><span class="koboSpan" id="kobo.57.1">We also need to specify the amount we want to trade or the trading size. </span><span class="koboSpan" id="kobo.57.2">The trading size can be specified in lots (again, refer to the venue’s documentation regarding how much one lot is) or just </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">in money.</span></span></p>
<p><span class="koboSpan" id="kobo.59.1">For example, with LMAX, an order to buy 1 lot of EUR USD would mean buying 1,000 euros and selling the respective amount of the US dollars, and with Interactive Brokers, an order to sell 100,000 USD JPY would mean actually selling 100,000 USD and buying the respective amount of the Japanese yen. </span><span class="koboSpan" id="kobo.59.2">Be careful when specifying the order size! </span><span class="koboSpan" id="kobo.59.3">Now, our order ticket consists of </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">three records:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer096">
<span class="koboSpan" id="kobo.61.1"><img alt="Figure ﻿10.3 – Trading size specified in the order" src="image/B19145_10_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.62.1">Figure 10.3 – Trading size specified in the order</span></p>
<p><span class="koboSpan" id="kobo.63.1">And of course, we should specify the side of the trade: whether we want to buy or sell. </span><span class="koboSpan" id="kobo.63.2">Some venues just use </span><em class="italic"><span class="koboSpan" id="kobo.64.1">BUY</span></em><span class="koboSpan" id="kobo.65.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.66.1">SELL</span></em><span class="koboSpan" id="kobo.67.1"> specifiers, while others suggest using </span><em class="italic"><span class="koboSpan" id="kobo.68.1">BID</span></em><span class="koboSpan" id="kobo.69.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.70.1">ASK</span></em><span class="koboSpan" id="kobo.71.1"> to denote the side, so as you can see, the advice to consult the venue’s documentation is the only stable thing in algo trading. </span><span class="koboSpan" id="kobo.71.2">All in all, now we have four records in the </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">order ticket:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer097">
<span class="koboSpan" id="kobo.73.1"><img alt="Figure ﻿10.4 – Specifying the side of the trade" src="image/B19145_10_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.74.1">Figure 10.4 – Specifying the side of the trade</span></p>
<p><span class="koboSpan" id="kobo.75.1">Are we ready to go? </span><span class="koboSpan" id="kobo.75.2">Seems so, but not really. </span><span class="koboSpan" id="kobo.75.3">The trading venue expects a few other parameters of our trade to be specified: we should say </span><em class="italic"><span class="koboSpan" id="kobo.76.1">how</span></em><span class="koboSpan" id="kobo.77.1"> we want the order to be executed, </span><em class="italic"><span class="koboSpan" id="kobo.78.1">at which price</span></em><span class="koboSpan" id="kobo.79.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.80.1">when</span></em><span class="koboSpan" id="kobo.81.1">. </span><span class="koboSpan" id="kobo.81.2">The first of these three extra parameters is called the order type, and we normally distinguish between </span><em class="italic"><span class="koboSpan" id="kobo.82.1">market orders</span></em><span class="koboSpan" id="kobo.83.1">, </span><em class="italic"><span class="koboSpan" id="kobo.84.1">limit orders</span></em><span class="koboSpan" id="kobo.85.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.86.1">stop orders</span></em><span class="koboSpan" id="kobo.87.1">. </span><span class="koboSpan" id="kobo.87.2">There are also so-called </span><strong class="bold"><span class="koboSpan" id="kobo.88.1">compound</span></strong><span class="koboSpan" id="kobo.89.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.90.1">conditional orders</span></strong><span class="koboSpan" id="kobo.91.1">, which essentially are combinations of these basic three order types, but they are not supported by all venues. </span><span class="koboSpan" id="kobo.91.2">So we will consider in detail only the three main types </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">of orders.</span></span></p>
<h1 id="_idParaDest-173"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.93.1">Market orders – the way to get maximum control over transactional risk</span></h1>
<p><span class="koboSpan" id="kobo.94.1">Let’s start with the most simplistic (at least at first glance) type of order: the market order. </span><span class="koboSpan" id="kobo.94.2">A </span><strong class="bold"><span class="koboSpan" id="kobo.95.1">market order</span></strong><span class="koboSpan" id="kobo.96.1"> is an order to buy or sell a certain amount of an asset at a </span><strong class="bold"><span class="koboSpan" id="kobo.97.1">market price</span></strong><span class="koboSpan" id="kobo.98.1">. </span><span class="koboSpan" id="kobo.98.2">By market price, we normally assume the best bid or the best ask (see </span><a href="B19145_03.xhtml#_idTextAnchor044"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.99.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.100.1">, </span><em class="italic"><span class="koboSpan" id="kobo.101.1">FX Market Overview from a Developer’s Standpoint,</span></em><span class="koboSpan" id="kobo.102.1"> for the explanation of the best bid and ask), and most trading strategy developers test their ideas using only the best bid/ask historical data. </span><span class="koboSpan" id="kobo.102.2">So, we can add another record to our order ticket prototype, and this record represents the </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">order type:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer098">
<span class="koboSpan" id="kobo.104.1"><img alt="Figure ﻿10.5 – Specifying the order type" src="image/B19145_10_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.105.1">Figure 10.5 – Specifying the order type</span></p>
<p><span class="koboSpan" id="kobo.106.1">We already saw (see again </span><a href="B19145_03.xhtml#_idTextAnchor044"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.107.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.108.1">, </span><em class="italic"><span class="koboSpan" id="kobo.109.1">FX Market Overview from a Developer’s Standpoint</span></em><span class="koboSpan" id="kobo.110.1">) that liquidity may have a substantial impact on how orders are executed in reality and it is considered quite a frequent situation when a single large order may move the best bid or ask during its execution. </span><span class="koboSpan" id="kobo.110.2">So, it’s important to make sure that the order will be executed at a price closest to the last best bid or best ask seen in the order book immediately before sending the order to </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">the market.</span></span></p>
<p><span class="koboSpan" id="kobo.112.1">Using this order type makes sure that if the order is executed, then you get the exact amount of the traded asset specified in the order. </span><span class="koboSpan" id="kobo.112.2">At the same time, it doesn’t guarantee that the average execution price will be the same as the top of the book because this kind of execution method allows buying or selling up to the entire amount currently present in the </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">order book.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">For example, let’s have a look back at the example of an order book shown in </span><a href="B19145_03.xhtml#_idTextAnchor044"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.115.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.116.1"> (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.117.1">Figure 3</span></em></span><em class="italic"><span class="koboSpan" id="kobo.118.1">.1</span></em><span class="koboSpan" id="kobo.119.1"> in the </span><em class="italic"><span class="koboSpan" id="kobo.120.1">Exchange and order book</span></em><span class="koboSpan" id="kobo.121.1"> section). </span><span class="koboSpan" id="kobo.121.2">Imagine that we send a market order to buy 1,000 contracts. </span><span class="koboSpan" id="kobo.121.3">Will it be executed? </span><span class="koboSpan" id="kobo.121.4">Yes, because there are more than 1,000 contracts in the order book. </span><span class="koboSpan" id="kobo.121.5">But at which price will it </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">be filled?</span></span></p>
<p><span class="koboSpan" id="kobo.123.1">The order book at the moment of sending the order had 155 contracts at the best ask price (2,149.25), then 306 contracts at 2,149.50, then 291 contracts at 2,149.75, and 532 contracts at 2,150.0. </span><span class="koboSpan" id="kobo.123.2">So our order will consume all liquidity from the first 3 price levels and 248 contracts from the 4th. </span><span class="koboSpan" id="kobo.123.3">The resulting average execution price can be calculated using the standard weighted </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">average formula:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer099">
<span class="koboSpan" id="kobo.125.1"><img alt="" src="image/Formula_B19145_10_001.jpg"/></span>
</div>
</div>
<p><span class="koboSpan" id="kobo.126.1">Here, </span><em class="italic"><span class="koboSpan" id="kobo.127.1">P</span></em><span class="koboSpan" id="kobo.128.1"> means the weighted average price, </span><em class="italic"><span class="koboSpan" id="kobo.129.1">p</span></em><span class="koboSpan" id="kobo.130.1"> denotes the price in the order book, and </span><em class="italic"><span class="koboSpan" id="kobo.131.1">q</span></em><span class="koboSpan" id="kobo.132.1"> means the quantity, the number of contracts traded at the price, </span><em class="italic"><span class="koboSpan" id="kobo.133.1">p</span></em><span class="koboSpan" id="kobo.134.1">. </span><span class="koboSpan" id="kobo.134.2">In our example, it will be about 2,149.658, which is quite far from 2,145.25, which used to be the best ask at the moment we fired </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">our order.</span></span></p>
<p><span class="koboSpan" id="kobo.136.1">The phenomenon of an order being executed at a worse market price or the process of filling the order in parts according </span><a id="_idIndexMarker680"/><span class="koboSpan" id="kobo.137.1">to the present liquidity is </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">called </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.139.1">slippage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.141.1">So, market orders can be useful when we need to fill the exact trading size, but this also may lead to filling at a price worse than expected. </span><span class="koboSpan" id="kobo.141.2">Why then did we say that market orders are </span><em class="italic"><span class="koboSpan" id="kobo.142.1">the way to get maximum control over transactional risk</span></em><span class="koboSpan" id="kobo.143.1"> in the very title of </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">this section?</span></span></p>
<p><span class="koboSpan" id="kobo.145.1">The reason is that by using market orders, you can be as granular and as precise with the ordering as possible. </span><span class="koboSpan" id="kobo.145.2">Indeed, nothing prevents us from developing an algorithm that would first check the liquidity in the order book and then send orders only of the amount that would not destroy it. </span><span class="koboSpan" id="kobo.145.3">In case you need to fill an order with a large size (for example, you work for a financial institution), you can split this order into parts and send multiple market orders in sequence until the entire amount is filled – again, without disturbing the order book </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">too much.</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">Another </span><em class="italic"><span class="koboSpan" id="kobo.148.1">benefit</span></em><span class="koboSpan" id="kobo.149.1">, if I may say so, of using market orders is that this is the only type of order that is accepted </span><a id="_idIndexMarker681"/><span class="koboSpan" id="kobo.150.1">by all trading venues without a single exception. </span><span class="koboSpan" id="kobo.150.2">Although we are going to consider orders of other types, such as limit and stop, remember that they are not always supported by the venue with which you plan </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">to work.</span></span></p>
<h2 id="_idParaDest-174"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.152.1">Possible execution issues</span></h2>
<p><span class="koboSpan" id="kobo.153.1">Besides the liquidity and average price fills just discussed, the main issue with market orders is that </span><a id="_idIndexMarker682"/><span class="koboSpan" id="kobo.154.1">such an order (if sent without a time-in-force specifier – see later in this chapter) will be executed at whatever price is currently present in the market. </span><span class="koboSpan" id="kobo.154.2">Yes, 99% of the time, it doesn’t cause real issues as the liquidity is quite sufficient, especially if you trade major currency pairs (those that constitute the US dollar index, see </span><a href="B19145_09.xhtml#_idTextAnchor152"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.155.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.156.1">, </span><em class="italic"><span class="koboSpan" id="kobo.157.1">Trading Strategies and Their Core Elements</span></em><span class="koboSpan" id="kobo.158.1">, the </span><em class="italic"><span class="koboSpan" id="kobo.159.1">Common FX benchmarks – US dollar index</span></em><span class="koboSpan" id="kobo.160.1"> section), but do you remember what happens around the time important economic news is released? </span><span class="koboSpan" id="kobo.160.2">Just have a quick look back at </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.161.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.162.1">.2</span></em><span class="koboSpan" id="kobo.163.1"> and </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.164.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.165.1">.4</span></em><span class="koboSpan" id="kobo.166.1"> in </span><a href="B19145_06.xhtml#_idTextAnchor101"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.167.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.168.1">, </span><em class="italic"><span class="koboSpan" id="kobo.169.1">Basics of Fundamental Analysis and its Possible Use in FX Trading</span></em><span class="koboSpan" id="kobo.170.1">, and refresh </span><a id="_idIndexMarker683"/><span class="koboSpan" id="kobo.171.1">the US </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">non-farm payroll</span></strong><span class="koboSpan" id="kobo.173.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.174.1">NFP</span></strong><span class="koboSpan" id="kobo.175.1">) and UK GDP cases: the gaps or the distance in price between just adjacent ticks during such an event may reach dozens </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">of pips.</span></span></p>
<p><span class="koboSpan" id="kobo.177.1">So, if we consider the US NFP case, and assume that you wanted to sell at 1.0230 with a market order a second before the NFP was released, so the order most likely would have been executed at the first tick after the news release, which was at 1.0210 – 20 pips away from the </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">desired price!</span></span></p>
<p><span class="koboSpan" id="kobo.179.1">Alright, seems like it’s more or less clear with market orders: we say </span><em class="italic"><span class="koboSpan" id="kobo.180.1">buy</span></em><span class="koboSpan" id="kobo.181.1"> or </span><em class="italic"><span class="koboSpan" id="kobo.182.1">sell</span></em><span class="koboSpan" id="kobo.183.1"> and get filled immediately (with or without liquidity-related issues). </span><span class="koboSpan" id="kobo.183.2">But what to do if we want to buy or sell </span><em class="italic"><span class="koboSpan" id="kobo.184.1">at a certain price</span></em><span class="koboSpan" id="kobo.185.1">, or, to be even more precise, to get our order executed at no worse than a certain price? </span><span class="koboSpan" id="kobo.185.2">Well, here comes the </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">limit order.</span></span></p>
<h1 id="_idParaDest-175"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.187.1">Limit orders – guaranteed price, but not execution</span></h1>
<p><span class="koboSpan" id="kobo.188.1">In general and brief, a </span><strong class="bold"><span class="koboSpan" id="kobo.189.1">limit order</span></strong><span class="koboSpan" id="kobo.190.1"> is an </span><a id="_idIndexMarker684"/><span class="koboSpan" id="kobo.191.1">order to buy or sell the specified amount of the asset at the specified price </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">or better.</span></span></p>
<p><span class="koboSpan" id="kobo.193.1">What does </span><em class="italic"><span class="koboSpan" id="kobo.194.1">better</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.195.1">mean here?</span></span></p>
<p><span class="koboSpan" id="kobo.196.1">This means that if I send a limit order to </span><em class="italic"><span class="koboSpan" id="kobo.197.1">buy</span></em><span class="koboSpan" id="kobo.198.1"> EURUSD at 1.0100, then any price </span><em class="italic"><span class="koboSpan" id="kobo.199.1">below</span></em><span class="koboSpan" id="kobo.200.1"> 1.0100 will match my order. </span><span class="koboSpan" id="kobo.200.2">On the contrary, if I send a limit order to </span><em class="italic"><span class="koboSpan" id="kobo.201.1">sell</span></em><span class="koboSpan" id="kobo.202.1"> EURUSD at 1.0100, then any price </span><em class="italic"><span class="koboSpan" id="kobo.203.1">above</span></em><span class="koboSpan" id="kobo.204.1"> this level will match. </span><span class="koboSpan" id="kobo.204.2">In other words, by using a limit order, I say that </span><em class="italic"><span class="koboSpan" id="kobo.205.1">I am ready to buy or sell at any price no worse than the one specified in </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.206.1">the order</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">What happens if you send a limit order at a price that is better than the current market price? </span><span class="koboSpan" id="kobo.208.2">For example, a </span><em class="italic"><span class="koboSpan" id="kobo.209.1">buy limit</span></em><span class="koboSpan" id="kobo.210.1"> order at a price that is </span><em class="italic"><span class="koboSpan" id="kobo.211.1">below</span></em><span class="koboSpan" id="kobo.212.1"> the current ask? </span><span class="koboSpan" id="kobo.212.2">Well, it depends on the particular implementation of limit orders used by your broker or execution venue. </span><span class="koboSpan" id="kobo.212.3">If you trade at an exchange (for example, if you trade currency futures), then your order will be routed directly into the </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">order book.</span></span></p>
<p><span class="koboSpan" id="kobo.214.1">If you trade spot or forward contracts, then most likely, such an order will reside in the trading venue’s system until the market price touches the order level and then the order will be converted into a market order. </span><span class="koboSpan" id="kobo.214.2">If the market price never reaches the order level, the order may be canceled or may reside in the broker’s order book virtually forever (actually not forever, of course, every broker has their own rules on what to do with </span><em class="italic"><span class="koboSpan" id="kobo.215.1">forgotten</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.216.1">limit orders).</span></span></p>
<p><span class="koboSpan" id="kobo.217.1">What happens if we send a limit buy order at a price that is worse than the current market price – for example, a </span><em class="italic"><span class="koboSpan" id="kobo.218.1">buy limit</span></em><span class="koboSpan" id="kobo.219.1"> order at a price that is </span><em class="italic"><span class="koboSpan" id="kobo.220.1">above</span></em><span class="koboSpan" id="kobo.221.1"> the current ask? </span><span class="koboSpan" id="kobo.221.2">In this case, the order will be executed immediately, and it will start absorbing the liquidity from the order book level by level, pushing the price higher and higher, but </span><em class="italic"><span class="koboSpan" id="kobo.222.1">this process will stop as soon as the limit price is hit</span></em><span class="koboSpan" id="kobo.223.1">. </span><span class="koboSpan" id="kobo.223.2">Thus, a limit order sent at a price worse than the market can be considered a </span><em class="italic"><span class="koboSpan" id="kobo.224.1">market order </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.225.1">with protection</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">Now we know that besides market orders, we can use limit orders, and in case we use them, we should specify a new field in our order ticket prototype: </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.228.1">order price</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer100">
<span class="koboSpan" id="kobo.230.1"><img alt="Figure ﻿10.6 – Price attribute added for stop and limit orders" src="image/B19145_10_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.231.1">Figure 10.6 – Price attribute added for stop and limit orders</span></p>
<p><span class="koboSpan" id="kobo.232.1">So far, it looks like </span><a id="_idIndexMarker685"/><span class="koboSpan" id="kobo.233.1">limit orders are the best to use in all situations, but is it really true? </span><span class="koboSpan" id="kobo.233.2">Of course, as there’s neither a free lunch nor a Holy Grail in trading, limit orders are no panacea to execution issues. </span><span class="koboSpan" id="kobo.233.3">Let’s take a deep dive into this domain, as execution issues with limit orders are far less obvious than those of </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">market orders.</span></span></p>
<h2 id="_idParaDest-176"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.235.1">Possible execution issues</span></h2>
<p><span class="koboSpan" id="kobo.236.1">While the main execution issue with market orders is that they guarantee the execution itself but do </span><a id="_idIndexMarker686"/><span class="koboSpan" id="kobo.237.1">not guarantee the execution price, the main issue with limit orders is exactly the opposite: a limit order guarantees the execution price (just by its definition) but does not guarantee the execution </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">as such.</span></span></p>
<p><span class="koboSpan" id="kobo.239.1">Indeed, let’s carefully consider both cases: if we send a limit order to be executed at a </span><em class="italic"><span class="koboSpan" id="kobo.240.1">better price</span></em><span class="koboSpan" id="kobo.241.1"> (that is, a </span><em class="italic"><span class="koboSpan" id="kobo.242.1">lower than the current price</span></em><span class="koboSpan" id="kobo.243.1"> for a </span><em class="italic"><span class="koboSpan" id="kobo.244.1">buy limit</span></em><span class="koboSpan" id="kobo.245.1"> and a </span><em class="italic"><span class="koboSpan" id="kobo.246.1">higher than the current price</span></em><span class="koboSpan" id="kobo.247.1"> for a </span><em class="italic"><span class="koboSpan" id="kobo.248.1">sell limit</span></em><span class="koboSpan" id="kobo.249.1">) to an exchange, and if we send such an order to a broker or </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">an ECN.</span></span></p>
<p><span class="koboSpan" id="kobo.251.1">If we work with an exchange, limit orders go straight into the order book (well, actually not really straight: first they pass the broker’s risk management systems that check whether you have sufficient margin to send such an order, but it doesn’t matter in the current context). </span><span class="koboSpan" id="kobo.251.2">However, we should remember that the order book is, in reality, two-dimensional (see </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.252.1">Figure 3</span></em></span><em class="italic"><span class="koboSpan" id="kobo.253.1">.2</span></em><span class="koboSpan" id="kobo.254.1"> in </span><a href="B19145_03.xhtml#_idTextAnchor044"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.255.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.256.1">, </span><em class="italic"><span class="koboSpan" id="kobo.257.1">FX Market Overview from Developer’s Standpoint</span></em><span class="koboSpan" id="kobo.258.1">, in the </span><em class="italic"><span class="koboSpan" id="kobo.259.1">Exchange and order book</span></em><span class="koboSpan" id="kobo.260.1"> section) and that our order will always be put at the end of the current order queue at the same price level. </span><span class="koboSpan" id="kobo.260.2">So, when the market price touches the order level, that is, someone actually traded at the order price, there is no guarantee that the size of that trade was sufficient to match all orders from the same price level – </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">including ours.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.262.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.263.1">One of the most common mistakes during the research and development phase of an algo trading project is assuming that all limit orders are executed, even if their prices were touched by a single tick. </span><span class="koboSpan" id="kobo.263.2">This erroneous assumption often leads to the creation of various </span><em class="italic"><span class="koboSpan" id="kobo.264.1">Holy Grails</span></em><span class="koboSpan" id="kobo.265.1"> of trading that work only </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">on paper.</span></span></p>
<p><span class="koboSpan" id="kobo.267.1">If we trade with an FX broker or an ECN, then most likely, our limit order won’t go into any order book </span><a id="_idIndexMarker687"/><span class="koboSpan" id="kobo.268.1">and no one will see it except for that same broker – until the market price reaches the order level. </span><span class="koboSpan" id="kobo.268.2">At this moment, the limit order is transformed into a market order and actually sent to the market. </span><span class="koboSpan" id="kobo.268.3">With this approach, we may suffer from the same disease as when trading with market orders – potentially, it could be executed at a price that is worse than the limit order price, which sounds exactly the opposite of the very definition of a </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">limit order.</span></span></p>
<p><span class="koboSpan" id="kobo.270.1">There are several workarounds for this issue, and most of these workarounds are implemented by execution venues. </span><span class="koboSpan" id="kobo.270.2">Most of them check the liquidity in the order book before actually sending the market order: if the order size exceeds the liquidity at the best bid/ask, then the order is executed only partially, up to the actual available amount. </span><span class="koboSpan" id="kobo.270.3">This way, the traditional behavior of a classical exchange order book </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">is imitated.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.272.1">Sounds disappointing?</span></span></p>
<p><span class="koboSpan" id="kobo.273.1">Well, in fact, some (not all, unfortunately) execution venues allow for somewhat greater control over the order execution. </span><span class="koboSpan" id="kobo.273.2">Checking the liquidity in the order book prior to sending an order is a good practice, but with some trading technology providers, we can also use special conditions, or specifiers, to control the order’s time </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">in force.</span></span></p>
<h1 id="_idParaDest-177"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.275.1">Time in force – better control over execution</span></h1>
<p><span class="koboSpan" id="kobo.276.1">The specifiers </span><a id="_idIndexMarker688"/><span class="koboSpan" id="kobo.277.1">mentioned previously are normally called </span><strong class="bold"><span class="koboSpan" id="kobo.278.1">time in force</span></strong><span class="koboSpan" id="kobo.279.1"> conditions, although, as you will see a bit later in this chapter, for some of them, it is not really obvious </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">or intuitive.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.281.1">Important disambiguation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.282.1">More often than not, these execution method specifiers are referred to as the </span><strong class="bold"><span class="koboSpan" id="kobo.283.1">type of order</span></strong><span class="koboSpan" id="kobo.284.1">. </span><span class="koboSpan" id="kobo.284.2">This can be found not only in some brokers’ documentation but also in books on trading, and even academic research. </span><span class="koboSpan" id="kobo.284.3">So, be very careful when you encounter </span><em class="italic"><span class="koboSpan" id="kobo.285.1">type of order</span></em><span class="koboSpan" id="kobo.286.1"> or </span><em class="italic"><span class="koboSpan" id="kobo.287.1">time in force</span></em><span class="koboSpan" id="kobo.288.1"> in any documentation, and make sure you understand what exactly the author had in mind: the type of order as such (market, limit, stop, etc.), the time during which it is valid, or how the order should be </span><span class="No-Break"><span class="koboSpan" id="kobo.289.1">executed liquidity-wise!</span></span></p>
<p><span class="koboSpan" id="kobo.290.1">In the following subsections, we will consider different order specifiers </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">in detail.</span></span></p>
<h2 id="_idParaDest-178"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.292.1">Immediate or cancel</span></h2>
<p><span class="koboSpan" id="kobo.293.1">An </span><strong class="bold"><span class="koboSpan" id="kobo.294.1">Immediate-or-Cancel</span></strong><span class="koboSpan" id="kobo.295.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.296.1">IOC</span></strong><span class="koboSpan" id="kobo.297.1">) instruction </span><a id="_idIndexMarker689"/><span class="koboSpan" id="kobo.298.1">attached to a market order means: I want to buy or sell </span><em class="italic"><span class="koboSpan" id="kobo.299.1">at most</span></em><span class="koboSpan" id="kobo.300.1"> X euros, dollars, lots, contracts, whatever, at the </span><a id="_idIndexMarker690"/><span class="koboSpan" id="kobo.301.1">market price (that is, current best bid/ask), but no worse than this price, and </span><em class="italic"><span class="koboSpan" id="kobo.302.1">I don’t care if I do not get the entire X euros, dollars, and so on, but only a smaller amount</span></em><span class="koboSpan" id="kobo.303.1">. </span><span class="koboSpan" id="kobo.303.2">If there’s not sufficient liquidity to fill my order, then fill in what is available and cancel </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">the rest.</span></span></p>
<p><span class="koboSpan" id="kobo.305.1">In other words, </span><em class="italic"><span class="koboSpan" id="kobo.306.1">with IOC, I prioritize price </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.307.1">over size</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.309.1">For example, I send an IOC market order to buy 1,000,000 EUR USD. </span><span class="koboSpan" id="kobo.309.2">The current ask price is 1.01234 and the currently available amount at ask is 500,000. </span><span class="koboSpan" id="kobo.309.3">Then, I will get 500,000 EURUSD bought at 1.01234 and the rest of my order (another 500,000) will </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">be canceled.</span></span></p>
<p><span class="koboSpan" id="kobo.311.1">Using IOC orders is probably the best way to prevent execution at an unwanted price, but you should remember that using it may lead to partial fills – so, your trading algorithm should somehow account for situations of </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">this sort.</span></span></p>
<h2 id="_idParaDest-179"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.313.1">Fill or kill</span></h2>
<p><span class="koboSpan" id="kobo.314.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">fill-or-kill</span></strong><span class="koboSpan" id="kobo.316.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.317.1">FOK</span></strong><span class="koboSpan" id="kobo.318.1">) instruction </span><a id="_idIndexMarker691"/><span class="koboSpan" id="kobo.319.1">means: I want to buy or sell </span><em class="italic"><span class="koboSpan" id="kobo.320.1">exactly X</span></em><span class="koboSpan" id="kobo.321.1"> euros, dollars, lots, contracts, and so on </span><em class="italic"><span class="koboSpan" id="kobo.322.1">at the market price</span></em><span class="koboSpan" id="kobo.323.1">, but if there is insufficient </span><a id="_idIndexMarker692"/><span class="koboSpan" id="kobo.324.1">liquidity at the best bid/ask to fill the entire order, then do not execute this order at all (or </span><em class="italic"><span class="koboSpan" id="kobo.325.1">kill</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.326.1">the order).</span></span></p>
<p><span class="koboSpan" id="kobo.327.1">In other words, </span><em class="italic"><span class="koboSpan" id="kobo.328.1">with FOK, I prioritize the integrity of the order over </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.329.1">its execution</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.331.1">In the same example, if I send a market buy FOK order for 1,000,000 EURUSD but there’s only 500,000 at the best ask, then the entire order will be killed (canceled) and no partial fill will </span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">be executed.</span></span></p>
<p><span class="koboSpan" id="kobo.333.1">You may wonder why both IOC and FOK are considered time-in-force specifiers: both assume immediate, instant execution of the order. </span><span class="koboSpan" id="kobo.333.2">Well, the answer is probably in the question: with IOC or FOK, we specify that the order should be executed </span><em class="italic"><span class="koboSpan" id="kobo.334.1">as quickly as possible</span></em><span class="koboSpan" id="kobo.335.1">; this way, we specify its time </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">in force.</span></span></p>
<p><span class="koboSpan" id="kobo.337.1">Most execution </span><a id="_idIndexMarker693"/><span class="koboSpan" id="kobo.338.1">venues support IOC or FOK only for market orders, but there are some that allow adding IOC or FOK to limit orders as well. </span><span class="koboSpan" id="kobo.338.2">This makes </span><a id="_idIndexMarker694"/><span class="koboSpan" id="kobo.339.1">sense because some execution venues just convert a limit order into a market one when the limit order’s price is touched by the market, so the market order’s time-in-force specifiers become absolutely valid in such </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">a scenario.</span></span></p>
<p><span class="koboSpan" id="kobo.341.1">Of course, there are other time-in-force specifiers that give an order a much longer life than IOC or FOK. </span><span class="koboSpan" id="kobo.341.2">The most common are </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">good for a day</span></strong><span class="koboSpan" id="kobo.343.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.344.1">good </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.345.1">till canceled</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">.</span></span></p>
<h2 id="_idParaDest-180"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.347.1">Good for a day (GTD) and good till canceled (GTC)</span></h2>
<p><span class="koboSpan" id="kobo.348.1">Both specifiers assume that the order can be filled in parts and set the time frame during which it can </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">be filled.</span></span></p>
<p><span class="koboSpan" id="kobo.350.1">A GTD order </span><a id="_idIndexMarker695"/><span class="koboSpan" id="kobo.351.1">tries to fill what is available at the best bid/ask and the </span><a id="_idIndexMarker696"/><span class="koboSpan" id="kobo.352.1">remaining will reside in the venue’s order book till the end of the day (that is, 5 P.M. </span><span class="koboSpan" id="kobo.352.2">New York time in most cases). </span><span class="koboSpan" id="kobo.352.3">Any moment the price returns to the order level, another portion of the order </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">is executed.</span></span></p>
<p><span class="koboSpan" id="kobo.354.1">A GTC order </span><a id="_idIndexMarker697"/><span class="koboSpan" id="kobo.355.1">behaves in a similar way, but there’s no explicitly </span><a id="_idIndexMarker698"/><span class="koboSpan" id="kobo.356.1">specified time until which the order remains actual. </span><span class="koboSpan" id="kobo.356.2">The trader should take care of all GTC orders, manually </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">or automatically.</span></span></p>
<p><span class="koboSpan" id="kobo.358.1">In reality, both specifiers are used with limit orders and simply mean the time during which such an order will remain in force, because if we take all appropriate measures by checking the liquidity, then in most cases, a limit order will be </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">executed instantly.</span></span></p>
<p><span class="koboSpan" id="kobo.360.1">Now that we are familiar with time-in-force specifiers, it’s time to update our proposed order </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">ticket structure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer101">
<span class="koboSpan" id="kobo.362.1"><img alt="Figure ﻿10.7 – Time in force attribute added" src="image/B19145_10_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.363.1">Figure 10.7 – Time in force attribute added</span></p>
<p><span class="koboSpan" id="kobo.364.1">So far, we have </span><a id="_idIndexMarker699"/><span class="koboSpan" id="kobo.365.1">discussed market (</span><em class="italic"><span class="koboSpan" id="kobo.366.1">I buy now</span></em><span class="koboSpan" id="kobo.367.1">) and </span><a id="_idIndexMarker700"/><span class="koboSpan" id="kobo.368.1">limit (</span><em class="italic"><span class="koboSpan" id="kobo.369.1">I buy at this price or better</span></em><span class="koboSpan" id="kobo.370.1">) orders. </span><span class="koboSpan" id="kobo.370.2">But it would be quite </span><a id="_idIndexMarker701"/><span class="koboSpan" id="kobo.371.1">logical to suppose that if we have an </span><em class="italic"><span class="koboSpan" id="kobo.372.1">at this price or better</span></em><span class="koboSpan" id="kobo.373.1"> order, then </span><a id="_idIndexMarker702"/><span class="koboSpan" id="kobo.374.1">there should exist an </span><em class="italic"><span class="koboSpan" id="kobo.375.1">at this price or worse</span></em><span class="koboSpan" id="kobo.376.1"> order, wouldn’t it? </span><span class="koboSpan" id="kobo.376.2">Yes, such an order type does exist, and it’s called the </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">stop order.</span></span></p>
<h1 id="_idParaDest-181"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.378.1">Stop orders – maximum uncontrolled risk</span></h1>
<p><span class="koboSpan" id="kobo.379.1">Essentially, a </span><strong class="bold"><span class="koboSpan" id="kobo.380.1">stop order</span></strong><span class="koboSpan" id="kobo.381.1"> is an </span><a id="_idIndexMarker703"/><span class="koboSpan" id="kobo.382.1">order to buy or sell the specified amount of the asset </span><em class="italic"><span class="koboSpan" id="kobo.383.1">at the specified price </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.384.1">or worse</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">You may ask at this point: why on Earth would I want to buy or sell at a price worse than I’d </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">like to?</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">The answer is very simple: both </span><em class="italic"><span class="koboSpan" id="kobo.389.1">better</span></em><span class="koboSpan" id="kobo.390.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.391.1">worse</span></em><span class="koboSpan" id="kobo.392.1"> are just references to where the order price is relative to the current </span><span class="No-Break"><span class="koboSpan" id="kobo.393.1">market price.</span></span></p>
<p><span class="koboSpan" id="kobo.394.1">For example, if the current price of EURUSD is 0.99673 and I send a buy-stop order at 0.9989, then my order will be executed at any price equal to or greater than 0.9989. </span><span class="koboSpan" id="kobo.394.2">Similar to limit orders, a stop order will reside in the broker’s order book until the market price touches the order price and then converted into a market order. </span><span class="koboSpan" id="kobo.394.3">Note that, unlike limit orders, stop orders are never sent to the order book immediately, even if you trade with an exchange. </span><span class="koboSpan" id="kobo.394.4">This is quite natural, in fact: if I send a limit order to the order book, then I improve the liquidity in the market as others may become my counterparties and then I become a liquidity provider to them in a certain sense. </span><span class="koboSpan" id="kobo.394.5">But if a stop order had been sent to an order book, it would just immediately match one of the limit orders there and move the price immediately by an </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">unpredictable distance.</span></span></p>
<p><span class="koboSpan" id="kobo.396.1">Indeed, let’s consider an example. </span><span class="koboSpan" id="kobo.396.2">Say we have an order book for EURUSD and the current market price (best bid/ask) is 1.00000/1.00005. </span><span class="koboSpan" id="kobo.396.3">There are some limit orders to buy at 0.99999, 0.99998, and so on, and some limit orders to sell at 1.00006, 1.00007, and so on. </span><span class="koboSpan" id="kobo.396.4">Now, imagine someone sends a stop order to buy at 1.0020 and this order is sent to the </span><a id="_idIndexMarker704"/><span class="koboSpan" id="kobo.397.1">order book. </span><span class="koboSpan" id="kobo.397.2">Of course, sellers (those on the </span><em class="italic"><span class="koboSpan" id="kobo.398.1">ask</span></em><span class="koboSpan" id="kobo.399.1"> side) will be more than happy to sell at 1.0020 and not at 1.0010 or 1.00008. </span><span class="koboSpan" id="kobo.399.2">So, a stop order sent to the order book would trigger the order book level that is the most distant from the current best bid/ask, which is strictly opposite to the very idea of an </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">order book.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.401.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.402.1">Not all execution venues support stop orders. </span><span class="koboSpan" id="kobo.402.2">Many institutional liquidity pools support only market and limit orders (and some of them only market orders). </span><span class="koboSpan" id="kobo.402.3">So it’s always a good idea to emulate stop </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">orders locally.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">So, going back to the question about the reason why we may want to use a stop order, now we understand that we can use it when we want to do one of these </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">two actions:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.406.1">Enter the market at a price that is greater than current if we want to buy, and at a price that is less than current if we want </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">to sell.</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">Exit a position when the price goes against it – that is, with a loss. </span><span class="koboSpan" id="kobo.408.2">It happens if the current price is less than the entry price for a long position (buy) or the current price is greater than the entry price for a short </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">position (sell).</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.410.1">If we use a stop </span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.411.1">order to exit from a losing position, then it is called a </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.412.1">stop-loss order</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.414.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.415.1">Quite frequently, stop orders are confused with stop-loss orders. </span><span class="koboSpan" id="kobo.415.2">However, stop orders can be used to both enter and exit the market, while stop-loss orders are always used only to exit from a losing position. </span><span class="koboSpan" id="kobo.415.3">In other words, </span><em class="italic"><span class="koboSpan" id="kobo.416.1">stop order</span></em><span class="koboSpan" id="kobo.417.1"> is a term with a more broad sense that pertains to general trading, and </span><em class="italic"><span class="koboSpan" id="kobo.418.1">stop-loss</span></em><span class="koboSpan" id="kobo.419.1"> is a narrow term pertaining to just trade logic. </span><span class="koboSpan" id="kobo.419.2">From the trading venue’s standpoint, there is no difference between a stop order used to open a position or to close it, so </span><em class="italic"><span class="koboSpan" id="kobo.420.1">stop-loss</span></em><span class="koboSpan" id="kobo.421.1"> orders may be mentioned only in a particular broker’s documentation, not that of a </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">trading venue.</span></span></p>
<p><span class="koboSpan" id="kobo.423.1">Now that </span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.424.1">we know that stop orders are somewhat </span><em class="italic"><span class="koboSpan" id="kobo.425.1">artificial</span></em><span class="koboSpan" id="kobo.426.1"> and actually executed as conditional market orders, we can understand the typical issues with </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">their execution.</span></span></p>
<h2 id="_idParaDest-182"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.428.1">Possible execution issues</span></h2>
<p><span class="koboSpan" id="kobo.429.1">Of course, the main execution issue with stop orders is similar to that of market orders: the slippage </span><a id="_idIndexMarker707"/><span class="koboSpan" id="kobo.430.1">with stop orders is potentially unlimited. </span><span class="koboSpan" id="kobo.430.2">If we send a buy-stop order, then it will be executed at any price equal to or greater than the order price. </span><span class="koboSpan" id="kobo.430.3">It is similar to a sell-stop order: it will be executed at any price equal to or less than the </span><span class="No-Break"><span class="koboSpan" id="kobo.431.1">order price.</span></span></p>
<p><span class="koboSpan" id="kobo.432.1">Stop orders guarantee execution but do not guarantee the price – and in this sense, they are somewhat similar to market orders. </span><span class="koboSpan" id="kobo.432.2">Let’s go back again to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.433.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.434.1">.2</span></em><span class="koboSpan" id="kobo.435.1"> in </span><a href="B19145_06.xhtml#_idTextAnchor101"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.436.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.437.1">, </span><em class="italic"><span class="koboSpan" id="kobo.438.1">Basics of Fundamental Analysis and its Possible Use in FX Trading</span></em><span class="koboSpan" id="kobo.439.1">, which illustrates the sequence of ticks (trades) around the publication of US NFP data. </span><span class="koboSpan" id="kobo.439.2">Imagine we have a long position before the news and we set a protective stop (stop-loss) order at 1.02250. </span><span class="koboSpan" id="kobo.439.3">With the very first tick after the news release, this stop order will be executed – but not at 1.02250. </span><span class="koboSpan" id="kobo.439.4">It will be executed at the first available price, which would be 1.02100 or </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">worse (lower).</span></span></p>
<p><span class="koboSpan" id="kobo.441.1">Always remember that even if you placed a stop-loss order, it doesn’t mean that you limited your losses by the order’s price level. </span><span class="koboSpan" id="kobo.441.2">It can be executed way beyond the requested price, thus increasing </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">the losses.</span></span></p>
<p><span class="koboSpan" id="kobo.443.1">It’s worth mentioning that some market makers offer </span><em class="italic"><span class="koboSpan" id="kobo.444.1">guaranteed stop-loss execution</span></em><span class="koboSpan" id="kobo.445.1">. </span><span class="koboSpan" id="kobo.445.2">This means that during an event such as US NFP or a similar situation when the price may jump beyond the stop order price in one tick, they would still execute the order at the requested price, not the market price. </span><span class="koboSpan" id="kobo.445.3">Only market makers can do that as it is they who quote the market for you as the price taker. </span><span class="koboSpan" id="kobo.445.4">Of course, there’s no free lunch here either, so market makers ask for a premium for this service. </span><span class="koboSpan" id="kobo.445.5">Such a premium typically means a wider spread or a </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">greater commission.</span></span></p>
<p><span class="koboSpan" id="kobo.447.1">Does it make sense to use </span><em class="italic"><span class="koboSpan" id="kobo.448.1">guaranteed</span></em><span class="koboSpan" id="kobo.449.1"> stop-loss orders? </span><span class="koboSpan" id="kobo.449.2">Well, it depends on the trade logic of your model and its statistics. </span><span class="koboSpan" id="kobo.449.3">If you use stop orders as a regular means of exiting the position even in a </span><em class="italic"><span class="koboSpan" id="kobo.450.1">calm</span></em><span class="koboSpan" id="kobo.451.1"> market, then the answer is probably no because you will lose more in spreads and commissions. </span><span class="koboSpan" id="kobo.451.2">If you use them only as a protective measure against an unexpected disastrous market price movement, then the answer is probably yes, as such a disastrous movement can ruin your account in one tick – just recall the case of the Swiss National Bank unpegging the rate of CHF from the euro described in </span><a href="B19145_09.xhtml#_idTextAnchor152"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.452.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.453.1">, </span><em class="italic"><span class="koboSpan" id="kobo.454.1">Trading Strategies and Their Core Elements</span></em><span class="koboSpan" id="kobo.455.1">, in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.456.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.457.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.459.1">With all that in mind, stop orders kept at the broker are mostly used as protective stop-loss orders, which exit from a losing position and cut running losses. </span><span class="koboSpan" id="kobo.459.2">If your strategy logic assumes entering the market along with the price movement, which is typical for a breakout strategy, for example, then it’s always a better idea to emulate such a stop order locally and send it to the market as a market or even a limit order to prevent </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">bad execution.</span></span></p>
<p><span class="koboSpan" id="kobo.461.1">Now, we can </span><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.462.1">suggest the final draft of our general order ticket, which would support all three main types of orders (market, limit, and stop) and all the essential attributes required to send the order to </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">a broker:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.464.1"><img alt="Figure ﻿10.8 – All types of orders are now supported in the order ticket" src="image/B19145_10_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.465.1">Figure 10.8 – All types of orders are now supported in the order ticket</span></p>
<p><span class="koboSpan" id="kobo.466.1">Similar to limit orders, IOC and FOK are not used with stop orders, but GTD and GTC are. </span><span class="koboSpan" id="kobo.466.2">Besides that, some execution venues offer an additional condition to trigger a stop order, which is to convert a stop order into a market order: whether it’s triggered when the bid or the ask price hits the order level. </span><span class="koboSpan" id="kobo.466.3">However, this specifier is </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">not common.</span></span></p>
<p><span class="koboSpan" id="kobo.468.1">Market, limit, and stop orders are de facto standard orders accepted by almost any trading venue. </span><span class="koboSpan" id="kobo.468.2">However, some venues offer other types of orders that are frequently referred to as compound orders, which we will explore in the next section. </span><span class="koboSpan" id="kobo.468.3">They are not common and not essential, but it’s worth at least knowing that they exist and how they work in very </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">general terms.</span></span></p>
<h1 id="_idParaDest-183"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.470.1">Compound orders</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.471.1">Compound orders</span></strong><span class="koboSpan" id="kobo.472.1"> are those </span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.473.1">that assume a certain logical chain in their execution. </span><span class="koboSpan" id="kobo.473.2">That’s why </span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.474.1">they are also referred to as </span><strong class="bold"><span class="koboSpan" id="kobo.475.1">conditional orders</span></strong><span class="koboSpan" id="kobo.476.1">. </span><span class="koboSpan" id="kobo.476.2">Strictly speaking, such an order is not a single order: it’s a sequence of orders that are triggered one </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">by another.</span></span></p>
<p><span class="koboSpan" id="kobo.478.1">As the most common example, let’s </span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.479.1">consider a </span><strong class="bold"><span class="koboSpan" id="kobo.480.1">stop-limit order</span></strong><span class="koboSpan" id="kobo.481.1">. </span><span class="koboSpan" id="kobo.481.2">Unlike stop or limit orders, it requires two prices to be specified: stop and limit. </span><span class="koboSpan" id="kobo.481.3">If such an order is sent to the execution venue, first, the venue’s matching engine waits till the stop price of the order is touched by the market (best bid/ask) price. </span><span class="koboSpan" id="kobo.481.4">After that, the order is executed using its limit price exactly like when executing a limit order. </span><span class="koboSpan" id="kobo.481.5">So, a stop limit order is a combination </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">of both.</span></span></p>
<p><span class="koboSpan" id="kobo.483.1">For example, if the current price of EUR USD is 1.01015 and I want to buy it at 1.0102, I can use a stop order to enter the market – but I remember that during the execution of a stop order, I can get a potentially unlimited slippage. </span><span class="koboSpan" id="kobo.483.2">Therefore, I send a stop limit order with two prices: a stop price of 1.0102 and a limit price of 1.01025. </span><span class="koboSpan" id="kobo.483.3">Then, as soon as 1.0102 is touched by the market (this means that either ask or bid becomes equal or greater than 1.0102; see the explanation on special execution conditions for stop orders in the previous section), a limit-buy order at 1.01025 is actually executed. </span><span class="koboSpan" id="kobo.483.4">So, I will buy EURUSD at any price between 1.0102 (the stop price) and 1.01025 (the </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">limit price).</span></span></p>
<p><span class="koboSpan" id="kobo.485.1">It’s worth mentioning that stop-limit orders are used only to enter the market and never used as stop-loss orders. </span><span class="koboSpan" id="kobo.485.2">A stop-loss order must ensure the entire order size is filled, but a stop-limit order, like any limit order, cannot guarantee the execution of the entire </span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">order size.</span></span></p>
<h1 id="_idParaDest-184"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.487.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.488.1">Now, we are familiar with orders of the three main types, and we know in which cases we prefer to use market, stop and limit orders, and in which cases we’d rather avoid using them. </span><span class="koboSpan" id="kobo.488.2">Besides that, from previous chapters, we remember how to receive and handle market data, and how to use technical analysis, and we remember the key risks and have at least some ideas on how to mitigate them. </span><span class="koboSpan" id="kobo.488.3">So, we are ready for the final, ultimate job of any algo trader in the research and development phase: we are about to start drafting a trading application, something that will receive data, process it, generate trading signals, convert them into orders, send the order to the broker, process the broker’s response, and collect the trading statistics, which can ultimately prove or disprove the trading idea. </span><span class="koboSpan" id="kobo.488.4">This is what we are going to do in the </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">next chapter.</span></span></p>
</div>
</body></html>