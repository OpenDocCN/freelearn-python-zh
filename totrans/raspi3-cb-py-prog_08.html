<html><head></head><body><div><h1 class="header-title">Building Face Detector and Face Recognition Applications</h1>
                
            
            
                
<p>This chapter presents the following recipes:</p>
<ul>
<li>Introduction to the face recognition system</li>
<li>Building a face detector application</li>
<li>Building a face recognition application</li>
<li>Applications of a face recognition system</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Introduction</h1>
                
            
            
                
<p>In recent years, face recognition has emerged as one of the hottest research areas. A face recognition system is a computer program with the ability to detect and recognize faces. In order to recognize a person, it considers their unique facial features. Recently, it has been adopted in several security and surveillance installations to ensure safety in high-risk areas, residential zones, private and public buildings, and so on.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Building a face detector application</h1>
                
            
            
                
<p>In this section, we discuss how human faces can be detected from webcam images. A USB webcam needs to be connected to Raspberry Pi 3 to implement real-time human face detection.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Import the necessary packages:</li>
</ol>
<pre style="padding-left: 60px">import cv2 
import numpy as np </pre>
<ol start="2">
<li>Load the face cascade file:</li>
</ol>
<pre style="padding-left: 60px">frontalface_cascade= cv2.CascadeClassifier('haarcascade_frontalface_alt.xml') </pre>
<ol start="3">
<li>Check whether the face cascade file has been loaded:</li>
</ol>
<pre style="padding-left: 60px">if frontalface_cascade.empty(): 
  raiseIOError('Unable to load the face cascade classifier xml file') </pre>
<ol start="4">
<li>Initialize the video capture object:</li>
</ol>
<pre style="padding-left: 60px">capture = cv2.VideoCapture(0) </pre>
<ol start="5">
<li>Define the scaling factor:</li>
</ol>
<pre style="padding-left: 60px">scale_factor = 0.5 </pre>
<ol start="6">
<li>Perform the operation until the <em>Esc</em> key is pressed:</li>
</ol>
<pre style="padding-left: 60px"># Loop until you hit the Esc key 
while True: </pre>
<ol start="7">
<li>Capture the current frame and resize it:</li>
</ol>
<pre style="padding-left: 60px">  ret, frame = capture.read() 
  frame = cv2.resize(frame, None, fx=scale_factor, fy=scale_factor,  
            interpolation=cv2.INTER_AREA) </pre>
<ol start="8">
<li>Convert the image frame into grayscale:</li>
</ol>
<pre style="padding-left: 60px">  gray_image = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY) </pre>
<ol start="9">
<li>Run the face detector on the grayscale image:</li>
</ol>
<pre style="padding-left: 60px">  face_rectangle = frontalface_cascade.detectMultiScale(gray_image, 1.3, 5)</pre>
<ol start="10">
<li>Draw the rectangles box:</li>
</ol>
<pre style="padding-left: 60px">  for (x,y,w,h) in face_rectangle: 
    cv2.rectangle(frame, (x,y), (x+w,y+h), (0,255,0), 3) </pre>
<ol start="11">
<li>Display the output image:</li>
</ol>
<pre style="padding-left: 60px">    cv2.imshow('Face Detector', frame) </pre>
<ol start="12">
<li>Check whether the <em>Esc</em> key has been pressed for operation termination:</li>
</ol>
<pre style="padding-left: 60px">  a = cv2.waitKey(1) 
  if a == 10: 
    break </pre>
<ol start="13">
<li>Stop the video capturing and terminate the operation:</li>
</ol>
<pre style="padding-left: 60px">capture.release() 
cv2.destroyAllWindows() </pre>
<p>The result obtained in the human face detection system is shown here:</p>
<div><img src="img/4f077283-1466-49ab-88d4-05563a10942a.png" width="320" height="261"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">Building a face recognition application</h1>
                
            
            
                
<p>Face recognition is a technique that is performed after face detection. The detected human face is compared with the images stored in the database. It extracts features from the input image and matches them with human features stored in the database.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Import the necessary packages:</li>
</ol>
<pre style="padding-left: 60px">import cv2 
import numpy as np   
from sklearn import preprocessing </pre>
<ol start="2">
<li>Load the encoding and decoding task operators:</li>
</ol>
<pre style="padding-left: 60px">class LabelEncoding(object): 
  # Method to encode labels from words to numbers 
  def encoding_labels(self, label_wordings): 
    self.le = preprocessing.LabelEncoder() 
    self.le.fit(label_wordings) </pre>
<ol start="3">
<li>Implement word-to-number conversion for the input label:</li>
</ol>
<pre style="padding-left: 60px">  def word_to_number(self, label_wordings): 
    return int(self.le.transform([label_wordings])[0]) </pre>
<ol start="4">
<li>Convert the input label from a number to word:</li>
</ol>
<pre style="padding-left: 60px">  def number_to_word(self, label_number): 
    return self.le.inverse_transform([label_number])[0] </pre>
<ol start="5">
<li>Extract images and labels from the input path:</li>
</ol>
<pre style="padding-left: 60px">def getting_images_and_labels(path_input): 
  label_wordings = [] </pre>
<ol start="6">
<li>Iterate the procedure for the input path and append the files:</li>
</ol>
<pre style="padding-left: 60px">  for roots, dirs, files in os.walk(path_input): 
    for fname in (x for x in files if x.endswith('.jpg')): 
      fpath = os.path.join(roots, fname) 
      label_wordings.append(fpath.split('/')[-2])</pre>
<ol start="7">
<li>Initialize the variables and parse the input register:</li>
</ol>
<pre style="padding-left: 60px">  images = [] 
  le = LabelEncoding() 
  le.encoding_labels(label_wordings) 
  labels = [] 
  # Parse the input directory 
  for roots, dirs, files in os.walk(path_input): 
    for fname in (x for x in files if x.endswith('.jpg')): 
      fpath = os.path.join(roots, fname) </pre>
<ol start="8">
<li>Read the grayscale image:</li>
</ol>
<pre style="padding-left: 60px">      img = cv2.imread(fpath, 0)  </pre>
<ol start="9">
<li>Extract the label:</li>
</ol>
<pre style="padding-left: 60px">      names = fpath.split('/')[-2] </pre>
<ol start="10">
<li>Perform face detection:</li>
</ol>
<pre style="padding-left: 60px">      face = faceCascade.detectMultiScale(img, 1.1, 2, minSize=(100,100)) </pre>
<ol start="11">
<li>Iterate the procedure with face rectangles:</li>
</ol>
<pre style="padding-left: 60px">      for (x, y, w, h) in face: 
        images.append(img[y:y+h, x:x+w]) 
        labels.append(le.word_to_number(names)) 
  return images, labels, le 
if __name__=='__main__': 
  path_cascade = "haarcascade_frontalface_alt.xml" 
  train_img_path = 'faces_dataset/train' 
  path_img_test = 'faces_dataset/test' </pre>
<ol start="12">
<li>Load the face cascade file:</li>
</ol>
<pre style="padding-left: 60px">  faceCascade = cv2.CascadeClassifier(path_cascade) </pre>
<ol start="13">
<li>Initialize face detection with local binary patterns:</li>
</ol>
<pre style="padding-left: 60px">  face_recognizer = cv2.createLBPHFaceRecognizer()</pre>
<ol start="14">
<li>Extract the face features from the training face dataset:</li>
</ol>
<pre style="padding-left: 60px">  imgs, labels, le = getting_images_and_labels(train_img_path) </pre>
<ol start="15">
<li>Train the face detection system:</li>
</ol>
<pre style="padding-left: 60px">  print "nTraining..." 
  face_recognizer.train(imgs, np.array(labels)) </pre>
<ol start="16">
<li>Test the face detection system:</li>
</ol>
<pre style="padding-left: 60px">  print 'nPerforming prediction on test images...' 
  flag_stop = False 
  for roots, dirs, files in os.walk(path_img_test): 
    for fname in (x for x in files if x.endswith('.jpg')): 
      fpath = os.path.join(roots, fname) </pre>
<ol start="17">
<li>Validate the face recognition system:</li>
</ol>
<pre style="padding-left: 60px">      predicting_img = cv2.imread(fpath, 0) 
            # Detect faces 
      face = faceCascade.detectMultiScale(predicting_img, 1.1,  
                    2, minSize=(100,100)) 
            # Iterate through face rectangles 
      for (x, y, w, h) in face: 
        # Predict the output 
        index_predicted, config = face_recognizer.predict( 
predicting_img[y:y+h, x:x+w]) 
        # Convert to word label 
        person_predicted = le.number_to_word(index_predicted) 
        # Overlay text on the output image and display it 
        cv2.putText(predicting_img, 'Prediction: ' +  person_predicted,  
                        (10,60), cv2.FONT_HERSHEY_SIMPLEX, 2, (255,255,255), 6) 
        cv2.imshow("Recognizing face", predicting_img) 
      a = cv2.waitKey(0) 
      if a == 27: 
        flag = True 
        break 
    if flag_stop: 
      break </pre>
<p>The face recognition output obtained is shown here:</p>
<div><img src="img/76b0c4c2-4db0-47e4-8121-2d07866ff76c.png" style="width:35.92em;height:28.17em;" width="663" height="519"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Face recognition systems are widely used to implement personal security systems. Readers can refer to the article <em>The system of face detection based on OpenCV</em> at <a href="http://ieeexplore.ieee.org/document/6242980/">http://ieeexplore.ieee.org/document/6242980/</a>.</p>
<p>See also <em>Study of Face Detection Algorithm for Real-time Face Detection System</em> at <a href="http://ieeexplore.ieee.org/document/5209668">http://ieeexplore.ieee.org/document/5209668</a>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">See also</h1>
                
            
            
                
<p>Please refer to the following articles:</p>
<ul>
<li><a href="http://www.ex-sight.com/technology.htm">http://www.ex-sight.com/technology.htm</a></li>
<li><a href="https://www.eurotech.com/en/products/devices/face+recognition+systems">https://www.eurotech.com/en/products/devices/face+recognition+systems</a></li>
<li><a href="https://arxiv.org/ftp/arxiv/papers/1403/1403.0485.pdf">https://arxiv.org/ftp/arxiv/papers/1403/1403.0485.pdf</a></li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Applications of a face recognition system</h1>
                
            
            
                
<p>Face recognition is widely used in security, healthcare, and marketing. Industries are developing novel face recognition systems using deep learning to recognize fraud, identify the difference between human faces and photographs, and so on. In healthcare, face recognition, combined with other computer vision algorithms, is used to detect facial skin diseases.</p>


            

            
        
    </div>



  </body></html>