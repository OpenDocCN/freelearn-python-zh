<html><head></head><body>
		<div><h1 id="_idParaDest-135"><em class="italic"><a id="_idTextAnchor152"/>Chapter 5</em>: Django Forms</h1>
			<p>In programming, a <strong class="bold">form</strong> is an object that contains input fields, drop-down boxes, radio buttons, checkboxes, and a submit button. The duty of the form is to capture information from the user; what is done after that can be anything including storing that information in a database, sending an email, or generating a reporting document using that data. In this chapter, we discuss as much as we can about how forms are used in Django. Form objects are a very complex subject to discuss; we only have enough room in this chapter to cover the essentials and some advanced topics. Some of the topics in this chapter can be combined with other topics covered later in <a href="B17243_08_ePub.xhtml#_idTextAnchor239"><em class="italic">Chapter 8</em></a>, <em class="italic">Working with the Django REST Framework</em>, to create form objects on SPA-like pages. </p>
			<p>In our first form, we will create a class called <code>ContactForm</code> and build an email field in three different ways. Later, when we render that form in the browser, we will observe how its behavior changes using those three different mechanisms. We want to watch how validation is performed on each email field and watch how the behavior differs among them. This will give us a better understanding of which mechanism is needed for the intended behavior that we wish to achieve as the outcome. We will even look into writing custom field classes and learn how they can benefit us in the long run.</p>
			<p>Depending on your project's needs, validation of your form may require a lot of custom JavaScript in order to accomplish your goals. The focus of this book is not on JavaScript but rather on the concepts of Django. However, by the end of this chapter, we will have provided an example that demonstrates how JavaScript can be blended into your project when working with dynamic inline formsets on a form object. You can expand upon this to build your own custom JavaScript functions that suit your project's needs.</p>
			<p>In this chapter, we will cover the following:</p>
			<ul>
				<li>Types of forms</li>
				<li>Using form fields</li>
				<li>Cleaning forms</li>
				<li>Creating custom form fields</li>
				<li>Working with form views</li>
				<li>Rendering forms in templates</li>
				<li>Linking models to a form</li>
				<li>Adding inline formsets</li>
			</ul>
			<h1 id="_idParaDest-136"><a id="_idTextAnchor153"/>Technical requirements</h1>
			<p>To work with the code in this chapter, the following tools will need to be installed on your local machine:</p>
			<ul>
				<li>Python version 3.9 – used as the underlying programming language for the project</li>
				<li>Django version 4.0 – used as the backend framework of the project</li>
				<li>pip package manager – used to manage third-party Python/Django packages</li>
			</ul>
			<p>We will continue to work with the solution created in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>. However, it is not necessary to use the Visual Studio IDE. The main project itself can be run using another IDE or run independently using a terminal or command-line window from within the project root folder. This is where the <code>manage.py</code> file resides. Whatever editor or IDE you are using, a virtual environment will also be needed to work with the Django project. Instructions for how to create a project and virtual environment can be found in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>. You will need a database to store the data contained in your project. PostgreSQL was chosen for the examples in the previous chapter; however, any database type that you choose for your project can be used to work with the examples in this chapter.</p>
			<p>We will also be using data that is in the form of a Django fixture, provided in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>, in the subsection titled <em class="italic">Loading the Chapter_3 data fixture</em>. Make sure the <code>chapter_3</code> fixture is loaded into your database; if this has already been done, then you may skip the next command. If you have already created the tables found in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>, and have not loaded that fixture yet, then run the following command, after activating your virtual environment:</p>
			<pre>(virtual_env) PS &gt; python manage.py loaddata chapter_3</pre>
			<p>All of the code created in this chapter can be found in the GitHub repository for this book: <a href="https://github.com/PacktPublishing/Becoming-an-Enterprise-Django-Developer">https://github.com/PacktPublishing/Becoming-an-Enterprise-Django-Developer</a>. <a id="_idTextAnchor154"/>The bulk of the code depicted in this chapter can be found in the <code>/becoming_a_django_entdev/becoming_a_django_entdev/chapter_5/</code> directory.</p>
			<p>Check out the following video to see the <em class="italic">Code in Action</em>: <a href="https://bit.ly/3xQQ2H3">https://bit.ly/3xQQ2H3</a>.</p>
			<h2 id="_idParaDest-137"><a id="_idTextAnchor155"/>Preparing for this chapter</h2>
			<p>Start by creating a new app in your project called <code>chapter_5</code> by following the steps discussed in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>, in the subsection titled <em class="italic">Creating a Django app</em>. As discussed in that section, don't forget to change the value of the <code>name =</code> variable for your app class found in the <code>/becoming_a_django_entdev/becoming_a_django_entdev/chapter_5/apps.py</code> file to now point to the path where you installed your app. Be sure to also include this app in your <code>INSTALLED_APPS</code> variable found in the <code>settings.py</code> file. At the end of <a href="B17243_04_ePub.xhtml#_idTextAnchor116"><em class="italic">Chapter 4</em></a>, <em class="italic">URLs, Views, and Templates</em>, we set <code>DEBUG = False</code> as part of an exercise. Be sure to set this back to <code>DEBUG = True</code> for the remainder of this book.</p>
			<p>In the main <code>urls.py</code> file of the site, add the following path, which points to the URL patterns of this chapter that we will be creating:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/urls.py</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">urlpatterns = [</pre>
			<pre class="source-code">    <strong class="bold">path(</strong></pre>
			<pre class="source-code">        <strong class="bold">'',   </strong></pre>
			<pre class="source-code">        <strong class="bold">include(</strong></pre>
			<pre class="source-code">            <strong class="bold">'becoming_a_django_entdev.chapter_5.urls'</strong></pre>
			<pre class="source-code">        <strong class="bold">)</strong></pre>
			<pre class="source-code">    <strong class="bold">)</strong>,</pre>
			<pre class="source-code">]</pre>
			<p>Now that we've created the app for this chapter, let's begin using the Django admin site to manage the models created in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>.</p>
			<h1 id="_idParaDest-138"><a id="_idTextAnchor156"/>Types of forms</h1>
			<p>Django is designed to simplify a great deal of work involved when handling forms. It does this by providing <a id="_idIndexMarker706"/>ways to render your form object as HTML and process data on form submission. There are a lot of different ways to use and work with form objects but they all start with a form class. Django provides two different classes for us to use, <code>ModelForm</code> and <code>Form</code>. The differences between the two are that one links directly to the tables in a database and the other does not. The <code>ModelForm</code> class, the one that links to a database, will automatically create fields and perform field validation based on the field constraints set within that model class, from the database level.</p>
			<p>Form classes also use a <code>Meta</code> subclass, as was used on a model class in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>. There are other form classes that Django provides, such as <code>BaseForm</code> and <code>BaseModelForm</code>, which are used to write abstract base form classes, but these form classes are beyond the scope of this book. Other classes relate to inline formsets, which are basically forms within a form. By the end of this chapter, we will have inserted an inline formset onto the page when the form gets rendered and used JavaScript to add more of them when the user clicks a button.</p>
			<p>Let's discuss importing and using the <code>Form</code> and <code>ModelForm</code> classes when creating a form class first.</p>
			<h2 id="_idParaDest-139"><a id="_idTextAnchor157"/>Form class – Form</h2>
			<p>The <code>Form</code> class is used to <a id="_idIndexMarker707"/>create fields that don't link to a database. This is used when a form is sending an email or generating a PDF report, just to name a few examples. </p>
			<p>Follow these <a id="_idIndexMarker708"/>steps to create your <code>Form</code> class:</p>
			<ol>
				<li>Create a file called <code>forms.py</code> in your <code>/becoming_a_django_entdev/chapter_5/</code> directory. </li>
				<li>Inside this file, include the following code:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
from django.forms 
import <strong class="bold">Form</strong>
class <strong class="bold">ContactForm</strong>(<strong class="bold">Form</strong>):
    pass</pre></li>
			</ol>
			<p>We will discuss working with <a id="_idIndexMarker709"/>fields in a moment, but let's discuss importing the <code>ModelForm</code> class next.</p>
			<h2 id="_idParaDest-140"><a id="_idTextAnchor158"/>Form class – ModelForm</h2>
			<p>The <code>ModelForm</code> class is used when we want to create or modify data directly in a database. Each field is linked to a column of the table it represents. Additional fields can be created and used in <a id="_idIndexMarker710"/>ways that are not linked to your database. For instance, you could fire off an email that contains the data from an added field. This field could also be a comment, timestamp, or another type of hidden data field. </p>
			<p>To create <a id="_idIndexMarker711"/>your <code>ModelForm</code> class, inside your existing <code>/chapter_5/forms.py</code> file, include the following class: </p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong></pre>
			<pre class="source-code">from django.forms </pre>
			<pre class="source-code">import Form, <strong class="bold">ModelForm</strong></pre>
			<pre class="source-code">class <strong class="bold">VehicleForm</strong>(<strong class="bold">ModelForm</strong>):</pre>
			<pre class="source-code">    pass</pre>
			<p>Later in this chapter, we will link this class to the <code>Vehicle</code> model, created in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>. </p>
			<p>Next, let's remove these <code>pass</code> statements and begin working with field arguments.</p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor159"/>Using form fields</h1>
			<p>Similar to the standard model field classes introduced in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>, Django also provides a number of form field classes that are available to use. The <a id="_idIndexMarker712"/>difference is that a model field class works with the columns of a database and a form field class is used only as an input field within an HTML <code>&lt;form&gt;&lt;/form&gt;</code> object in a template.</p>
			<p>The following table can be used as a cheat sheet to reference what fields are available when writing your <code>Form</code> and/or <code>ModelForm</code> classes:</p>
			<div><div><img src="img/Table_.jpg" alt=""/>
				</div>
			</div>
			<p>Form fields also accept a variety of different field arguments that customize the behavior of each field. In the next section, we will use some of the field types in the preceding list to write fields on our form classes, discussing the different arguments that can be used.</p>
			<p>For a complete breakdown of each of these field types, visit the official Django documentation <a id="_idIndexMarker713"/>on field classes and arguments, found here: <a href="https://docs.djangoproject.com/en/4.0/ref/forms/fields/">https://docs.djangoproject.com/en/4.0/ref/forms/fields/</a>. <a id="_idTextAnchor160"/></p>
			<h2 id="_idParaDest-142"><a id="_idTextAnchor161"/>Common field arguments</h2>
			<p>We will begin adding <a id="_idIndexMarker714"/>fields to a form class and introduce field arguments in this exercise. Field arguments are a way for us to set properties on a field. </p>
			<p>To create your field, in your <code>/chapter_5/forms.py</code> file, add the <code>import</code> statement highlighted in the following code block, and in the same <code>ContactForm</code> class, add a field called <code>full_name</code>:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong></pre>
			<pre class="source-code"><strong class="bold">from django </strong></pre>
			<pre class="source-code"><strong class="bold">import forms</strong></pre>
			<pre class="source-code">from django.forms </pre>
			<pre class="source-code">import <strong class="bold">Form</strong>, ModelForm</pre>
			<pre class="source-code">class <strong class="bold">ContactForm</strong>(<strong class="bold">Form</strong>):</pre>
			<pre class="source-code">    <strong class="bold">full_name</strong> = forms.CharField(</pre>
			<pre class="source-code">        <strong class="bold">label</strong> = 'Full Name',</pre>
			<pre class="source-code">        <strong class="bold">help_text</strong> = 'Enter your full name, first and last   name please',</pre>
			<pre class="source-code">        <strong class="bold">min_length</strong> = 2,</pre>
			<pre class="source-code">        <strong class="bold">max_length</strong> = 300,</pre>
			<pre class="source-code">        <strong class="bold">required</strong> = True,</pre>
			<pre class="source-code">        <strong class="bold">error_messages</strong> = {</pre>
			<pre class="source-code">            'required': 'Please provide us with a name to address you as',</pre>
			<pre class="source-code">            'min_length': 'Please lengthen your name, min 2 characters',</pre>
			<pre class="source-code">            'max_length': 'Please shorten your name, max 300 characters'</pre>
			<pre class="source-code">        }</pre>
			<pre class="source-code">    )</pre>
			<p>In the preceding example, we defined an HTML <code>&lt;input type="text"&gt;</code> object using the <code>forms.CharField</code> field class. A <code>CharField</code> object's default widget is an input <code>type="text"</code> field. The <code>label</code> argument lets us define the text that would render as <code>&lt;label for="my_field_id"&gt;My Form Field Label&lt;/label&gt;</code> of this field.</p>
			<p>The <code>help_text</code> argument <a id="_idIndexMarker715"/>will render a <code>&lt;span class="helptext"&gt;{{ your_help_text_message&lt;/span&gt;</code> element, right after your input field in the <strong class="bold">Document Object Model</strong> (<strong class="bold">DOM</strong>). </p>
			<p class="callout-heading">Document Object Model</p>
			<p class="callout">The DOM is an interface <a id="_idIndexMarker716"/>found in all browsers that presents HTML in a tree-like structure of nodes. The nodes represent objects in this tree, where the <code>&lt;span&gt;</code> or <code>&lt;input&gt;</code> nodes comprise a single object.</p>
			<p>The <code>min_length</code> and <code>max_length</code> arguments are used among most field types; they define the minimum and maximum character count, respectively, allowed in the field. The <code>required</code> argument will define whether the field must contain a value in order to be valid. These will render as attributes of an <code>&lt;input type="text" maxlength="300" minlength="2" required="" /&gt;</code> object. </p>
			<p>Next, let's discuss form validation a little bit more. In the next two subsections, we will cover the <code>widget</code> and <code>validator</code> arguments. For a complete breakdown of all the field arguments that <a id="_idIndexMarker717"/>are available and not covered, visit <a href="https://docs.djangoproject.com/en/4.0/ref/forms/fields/#core-field-arguments">https://docs.djangoproject.com/en/4.0/ref/forms/fields/#core-field-arguments</a>.</p>
			<h2 id="_idParaDest-143"><a id="_idTextAnchor162"/>Field widgets</h2>
			<p>A field's <code>widget</code> argument allows us to define what kind of field to use, such as an input object of the <a id="_idIndexMarker718"/>date, email, password, or text type. This can also be a <a id="_idIndexMarker719"/>checkbox, radio button, drop-down select, or text area, to name a few examples. We don't have to specify the <code>widget</code> argument unless we want to change the default widget or override its initial properties. </p>
			<p>Follow the next step to override the <code>full_name</code> field to render an input with the <code>id</code>, <code>class</code>, and <code>placeholder</code> attributes. The rendered output we hope to achieve should look like the following dummy code:</p>
			<pre class="source-code"><strong class="bold"># Demo Code</strong></pre>
			<pre class="source-code">&lt;input type="text" name="full_name" <strong class="bold">id</strong>="full-name" <strong class="bold">class</strong>="form-input-class" <strong class="bold">placeholder</strong>="Your Name, Written By..."&gt;</pre>
			<p>In your <code>/chapter_5/forms.py</code> file, edit your <code>full_name</code> field, as shown:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong></pre>
			<pre class="source-code">from django </pre>
			<pre class="source-code">import forms</pre>
			<pre class="source-code">from django.forms </pre>
			<pre class="source-code">import Form, ModelForm</pre>
			<pre class="source-code">class <strong class="bold">ContactForm</strong>(Form):</pre>
			<pre class="source-code">    full_name = forms.CharField(</pre>
			<pre class="source-code">        ...,</pre>
			<pre class="source-code">        <strong class="bold">widget</strong> = <strong class="bold">forms.TextInput</strong>(</pre>
			<pre class="source-code">            <strong class="bold">attrs</strong> = {</pre>
			<pre class="source-code">                <strong class="bold">'id'</strong>: 'full-name',</pre>
			<pre class="source-code">                <strong class="bold">'class'</strong>: 'form-input-class',</pre>
			<pre class="source-code">                <strong class="bold">'placeholder'</strong>: 'Your Name, Written By...'</pre>
			<pre class="source-code">            <strong class="bold">}</strong></pre>
			<pre class="source-code">        <strong class="bold">),</strong></pre>
			<pre class="source-code"><strong class="bold">    ),</strong></pre>
			<p>If we changed the default widget of a field from <code>forms.TextInput</code> to something else, such as <code>forms.EmailInput</code>, that would render as <code>&lt;input type="email"&gt;</code>. Changing <code>forms.TextInput</code> to <code>forms.DateInput</code> would render as <code>&lt;input type="date"&gt;</code>. Using <code>forms.TextArea</code> would render as a <code>&lt;textarea&gt;&lt;/textarea&gt;</code> object <a id="_idIndexMarker720"/>instead. Of course, these are just some of the many <a id="_idIndexMarker721"/>different options that exist. For a complete breakdown of all the widgets <a id="_idIndexMarker722"/>available and how they can help you construct your fields, visit <a href="https://docs.djangoproject.com/en/4.0/ref/forms/widgets/">https://docs.djangoproject.com/en/4.0/ref/forms/widgets/</a>. </p>
			<p>Let's discuss using field validators next.</p>
			<h2 id="_idParaDest-144"><a id="_idTextAnchor163"/>Field validators</h2>
			<p>When manually defining widgets, we sometimes have to write specific validation rules. For example, let's take <a id="_idIndexMarker723"/>a <code>forms.EmailInput</code> class; this would require adding validation rules that determine whether the value of the string the user provided is actually in <a href="mailto:example@example.com">example@example.com</a> format and not some random string, such as <code>IAmAString</code>. </p>
			<p>Follow these steps to create and validate an email field:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/forms.py</code> file, in the existing <code>ContactForm</code>, add the <code>email_1</code> field shown here:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
...
from django 
import forms
from django.forms 
import Form, ModelForm
from django.core.validators 
import <strong class="bold">EmailValidator</strong>
class <strong class="bold">ContactForm</strong>(Form):
    ...
    <strong class="bold">email_1 = forms.CharField</strong>(
        label = 'email_1 Field',
        min_length = 5,
        max_length = 254,
        <strong class="bold">required = False,</strong>
        help_text = 'Email address in example@example.com format.',
        <strong class="bold">validators</strong> = [
            <strong class="bold">EmailValidator</strong>(
                'Please enter a valid email address'
            ),
        ],
        error_messages = {
            'min_length': 'Please lengthen your name, min 5 characters',
            'max_length': 'Please shorten your name, max 254 characters'
        }
    )</pre></li>
			</ol>
			<p>While fields can be manipulated using validator arguments in this way, Django tries to provide <a id="_idIndexMarker724"/>developers with options that minimize or reduce the amount of code that they need to write. For example, instead of writing the preceding example to enforce an email format on <code>CharField</code>, we could just use the <code>EmailField</code> class instead, which already enforces this rule for us. The <code>EmailField</code> class includes all of the logic and validation to handle an email field. </p>
			<ol>
				<li value="2">To practice using the <code>EmailField</code> class, we will create an additional field to compare and <a id="_idIndexMarker725"/>contrast both code approaches. In your <code>/chapter_5/forms.py</code> file, in the same <code>ContactForm</code> class, add the <code>email_2</code> field shown here:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
from django 
import forms
from django.forms 
import Form, ModelForm
...
class <strong class="bold">ContactForm</strong>(Form):
    ...
    <strong class="bold">email_2 = forms.EmailField(</strong>
        label = 'email_2 Field',
        min_length = 5,
        max_length = 254,
        <strong class="bold">required = True,</strong>
        help_text = 'Email address in example@example.com format for contacting you should we have questions about your message.',
        error_messages = {
            'required': 'Please provide us an email address should we need to reach you',
            <strong class="bold">'email': 'Please enter a valid email address',</strong>
            'min_length': 'Please lengthen your name, min 5 characters',
            'max_length': 'Please shorten your name, max 254 characters'
        }
    )</pre></li>
			</ol>
			<p>The difference between the code found in <em class="italic">step 1</em> and <em class="italic">step 2</em> is that we do not need to define a widget or <a id="_idIndexMarker726"/>validator argument when using an <code>EmailField</code> class to produce the same behavior as with a <code>CharField</code> class. The error message is now located in the <code>error_messages</code> argument using the <code>email</code> key, as shown. </p>
			<p>For a complete breakdown <a id="_idIndexMarker727"/>of all of the validator classes and methods available, visit <a href="https://docs.djangoproject.com/en/4.0/ref/validators/">https://docs.djangoproject.com/en/4.0/ref/validators/</a>. Let's practice cleaning forms next, which is just another way to perform validation.</p>
			<h1 id="_idParaDest-145"><a id="_idTextAnchor164"/>Cleaning forms</h1>
			<p>We can perform validation on form fields in other ways as well. Within a form class, we can write methods that <a id="_idIndexMarker728"/>validate each field individually by writing them in this format: <code>def clean_{{ form_field_name }}()</code>. When doing this, only the value of the field that we are cleaning can be accessed. If we want to access other field values found in that form, we have to write a single <code>def clean()</code> method that will allow us to compare two fields against each other. For example, we could use the <code>def clean()</code> method to only require a field when another field's value is not empty. </p>
			<p>The following two subsections break down these two concepts.</p>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor165"/>Method – clean_{{ your_field_name }}()</h2>
			<p>To clean an <a id="_idIndexMarker729"/>individual form field, follow these steps:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/forms.py</code> file, in the same <code>ContactForm</code> class, add a new field called <code>email_3</code>, as shown:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
from django 
import forms
from django.forms 
import Form, ModelForm
...
class <strong class="bold">ContactForm</strong>(Form):
    <strong class="bold">email_3 = forms.CharField(</strong>
        label = 'Email Using CharField and Using Clean Method',
        <strong class="bold">required = False</strong>,
        help_text = 'Email address in example@example.com format for contacting you should we have questions about your message.',
    )</pre></li>
				<li>In that same <code>ContactForm</code> class, add the <code>clean_email_3</code> method shown here:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
...
from django.core.exceptions 
import <strong class="bold">ValidationError</strong>
from django.core.validators 
import (
    EmailValidator,
    <strong class="bold">validate_email</strong>
)
class <strong class="bold">ContactForm</strong>(Form):
    ...
    <strong class="bold">def clean_email_3(self):</strong>
        email = self.cleaned_data['email_3']
        if email != '':
            try:
                <strong class="bold">validate_email(</strong>email<strong class="bold">)</strong>
            except <strong class="bold">ValidationError</strong>:
                <strong class="bold">self.add_error(</strong>
                    'email_3', 
                    f'The following is not a valid email address: {email}'
                <strong class="bold">)</strong>
        else:
            <strong class="bold">self.add_error(</strong>
                'email_3', 
                'This field is required'
            <strong class="bold">)</strong>
        <strong class="bold">return email</strong></pre></li>
			</ol>
			<p>In the preceding example, we are importing the <code>validate_email()</code> method from the <code>django.core.validators</code> library, to determine whether the string is in email format. First, we are using a simple conditional statement to check whether the field has a value or not; if not, we are issuing an error message stating <code>"This field is required"</code>. We are <a id="_idIndexMarker730"/>performing a validation check even though the <code>email_3</code> field has a <code>required</code> argument set to <code>False</code>. This just illustrates another way we can do the same thing. If a value exists, we then wrap the <code>validate_em<a id="_idTextAnchor166"/>ail()</code> method in a <em class="italic">Try/Except</em> statement, and if validation fails, we are adding the <code>"The following is not a valid email address: {{ field_value }}"</code> error message.</p>
			<p>The <code>self.add_error()</code> method provided in the <code>Form</code> and <code>ModelForm</code> classes accepts two arguments: the first argument is the name of the field and the second is your custom error message. Instead of using <code>self.add_error('email_3', 'This field is required')</code> to add error messages to a form, we can use the <code>raise ValidationError('This field is required')</code> class instead. Except, there's one problem: using this class will remove this field from the <code>cleaned_data</code> values list. That will work if you only use the <code>clean_email_3()</code> method by itself. If you wanted to access that same cleaned data within the <code>def clean()</code> method, you'd need to return the value in <code>def clean_email_3()</code>, as depicted in the last line of <em class="italic">step 2</em> previously. Django will fire off the individual clean methods on each field before the <code>clean()</code> method is executed, saving that as the last method in the stack of cleaning methods. If your field value is not returned in the clean method specific to that field, we will not be able to access it when we need to later on.</p>
			<p>Let's use the <code>clean()</code> method next.</p>
			<h2 id="_idParaDest-147"><a id="_idTextAnchor167"/>Method – clean()</h2>
			<p>The <code>clean()</code> method is used to access all of the field data within a form, upon form submission. It is in this <a id="_idIndexMarker731"/>method that you could compare against the values of many fields before allowing a successful form submission. This next example will allow us to compare two fields against each other and raise one or more different field validation messages. </p>
			<p>Follow these steps to configure your <code>clean()</code> method:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/forms.py</code> file, add another field to your <code>ContactForm</code> class called <code>conditional_required</code>, as shown:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
from django 
import forms
from django.forms 
import Form, ModelForm
...
class <strong class="bold">ContactForm</strong>(Form):
    <strong class="bold">conditional_required</strong> = forms.CharField(
        label = 'Required only if field labeled "email_3" has a value',
        help_text = 'This field is only required if the field labeled "email_3 Field" has a value',
        <strong class="bold">required = False,</strong>
    )</pre></li>
				<li>In that <a id="_idIndexMarker732"/>same <code>ContactForm</code> class, add the following <code>clean()</code> method:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
from django 
import forms
from django.forms 
import Form, ModelForm
...
class <strong class="bold">ContactForm</strong>(Form):
    ...
    <strong class="bold">def clean(self):</strong>
        email = <strong class="bold">self.cleaned_data['email_3']</strong>
        text_field = self.cleaned_data[
            'conditional_required'
        ]
        if email and not text_field:
            <strong class="bold">self.add_error(</strong>
                'conditional_required', 
                'If there is a value in the field labeled "email_3" then this field is required'
            <strong class="bold">)</strong></pre></li>
			</ol>
			<p>In this <code>clean()</code> method, we are assigning the value of the <code>email_3</code> field to the variable called <code>email</code>. Then, we are assigning the value of the <code>conditional_required</code> field to the variable called <code>text_field</code>. Using a simple conditional <a id="_idIndexMarker733"/>statement, we then check to see whether <code>email</code> has a value present, and if so, check whether <code>text_field</code> has a value present. If this condition is met, we then add the required error to the <code>conditional_required</code> field. Since we set the <code>conditional_required</code> field to use the <code>required = False</code> argument, if there is no value in the <code>email_3</code> field, this field will not be required.</p>
			<p>Let's move on to creating our own custom form fields next.</p>
			<h1 id="_idParaDest-148"><a id="_idTextAnchor168"/>Creating custom form fields</h1>
			<p>Sometimes, the needs <a id="_idIndexMarker734"/>of the project outweigh the options that are provided to us. If a field class is not available by default, we have two options: create our own or use a third-party package where someone else has already written a field class for us. </p>
			<p>Continuing with the same <code>ContactForm</code> class, we will demonstrate the differences between validation mechanisms by building a <code>MultipleEmailField</code>. This will be a single field, accepting a single string of emails, all separated by commas. Each email item will then be checked <a id="_idIndexMarker735"/>independently to see whether it is in a valid email string format. We will use the same <code>validate_email()</code> function as we did before to enforce this constraint.</p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor169"/>Field class – Field</h2>
			<p>Django provides a class called <code>Field</code> found in the <code>django.forms.fields</code> library, used to construct <a id="_idIndexMarker736"/>custom field classes. Any of the options and methods found in this class can be overwritten as needed. For example, overriding the <code>def __init__()</code> method will provide a way to add, change, or remove field arguments, completely transforming how you work with these fields later on. We won't actually be overriding the <code>__init__()</code> method for this exercise; instead, we will be working with the <code>to_python()</code> and <code>validate()</code> methods. These will be the only two methods needed to perform the validation that we need on <code>MultipleEmailField</code>.</p>
			<p>Follow these steps to write your <code>Field</code> class:</p>
			<ol>
				<li value="1">Create a new file called <code>fields.py</code> in your <code>/becoming_a_django_entdev/chapter_5/</code> folder.</li>
				<li>In that file, add the following <code>MultipleEmailField</code> class and <code>import</code> statements:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/fields.py</strong>
from django.core.exceptions 
import <strong class="bold">ValidationError</strong>
from django.core.validators 
import <strong class="bold">validate_email</strong>
from django.forms.fields 
import <strong class="bold">Field</strong>
from django.forms.widgets 
import <strong class="bold">TextInput</strong>
class <strong class="bold">MultipleEmailField</strong>(<strong class="bold">Field</strong>):
    <strong class="bold">widget</strong> = <strong class="bold">TextInput</strong>
    <strong class="bold">default_validators</strong> = []
    <strong class="bold">default_error_messages</strong> = {
        <strong class="bold">'required'</strong>: 'Default Required Error Message',
        <strong class="bold">'email'</strong>: 'Please enter a valid email address or addresses separated by a comma with NO spaces'
    }</pre></li>
				<li>If you want to use some of the validators provided by Django, use the <code>default_validators</code> option shown in the preceding code. This is where you will define what validator to use. We are using our own logic found in the <code>validate</code> method of the <code>MultipleEmailField</code> class and will not be using a default validator <a id="_idIndexMarker737"/>for what we are trying to achieve. You are welcome to use any of the validators that Django provides for your field classes, found in the <code>django.core.validators</code> library.</li>
				<li>The <code>default_error_messages</code> option is used to define the default messages for a field class. In the <code>default_error_messages</code> option shown previously, we are specifying two keys: <code>required</code> and <code>email</code>. These two keys will act as the default message used when a required field has been submitted without a value present and when a value does not meet the email string format. When specifying a default error message in the <code>default_error_messages</code> option, we no longer have to use the <code>error_messages = {}</code> argument of a field. It is still possible to use the <code>error_messages</code> argument on a field-by-field basis if we wanted to.</li>
				<li>In that same <code>MultipleEmailField</code> class, add the following <code>to_python()</code> method:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/fields.py</strong>
...
class <strong class="bold">MultipleEmailField</strong>(Field):
    ...
    def <strong class="bold">to_python</strong>(self, value):
        if not value:
            return []
        value = value.replace(' ', '')
        return value.split(',')</pre></li>
			</ol>
			<p>The <code>to_python()</code> method is used to transform values into Python objects. This one in particular <a id="_idIndexMarker738"/>is written to transform a string into a list of emails, excluding the comma.</p>
			<ol>
				<li value="6">In that same <code>MultipleEmailField</code> class, add the following <code>validate()</code> method:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/fields.py</strong>
...
class <strong class="bold">MultipleEmailField</strong>(<strong class="bold">Field</strong>):
    ...
    def <strong class="bold">validate</strong>(self, value):
        super().validate(value)
        for email in value:
            try:
                <strong class="bold">validate_email(email)</strong>
            except <strong class="bold">ValidationError</strong>:
                <strong class="bold">raise ValidationError(</strong>
                    <strong class="bold">self.error_messages['email']</strong>, 
                    code = 'email'
                <strong class="bold">)</strong></pre></li>
			</ol>
			<p>The <code>validate()</code> method checks each item in the list of emails to make sure it is in email format. We are also overriding the options provided in the <code>Field</code> class, such as the <code>widget</code> option shown in <em class="italic">step 2</em>. The default widget is <code>TextInput</code>. Since that is already what we need, we don't actually have to include it; it was provided in the preceding example for illustrative purposes. When writing your <a id="_idIndexMarker739"/>own custom field, you can replace <code>TextInput</code> with any of the Django widgets found in the <code>django.forms.widgets</code> library. If you want to take your field one step further, you could even write your own custom widget class, but this is beyond the scope of this book.</p>
			<p>Let's work on using our custom field class next.</p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor170"/>Using a custom field</h2>
			<p>To use the <code>MultipleEmailField</code> that we <a id="_idIndexMarker740"/>created in the previous subsection, in your <code>/chapter_5/forms.py</code> file, add the following <code>import</code> statement and add the <code>multiple_emails</code> field to <code>ContactForm</code>, as shown:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">from django.forms </pre>
			<pre class="source-code">import Form, ModelForm</pre>
			<pre class="source-code">from .fields </pre>
			<pre class="source-code">import <strong class="bold">MultipleEmailField</strong></pre>
			<pre class="source-code">class <strong class="bold">ContactForm</strong>(Form):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    <strong class="bold">multiple_emails = MultipleEmailField(</strong></pre>
			<pre class="source-code">        label = 'Multiple Email Field',</pre>
			<pre class="source-code">        help_text = 'Please enter one or more email addresses, each separated by a comma and no spaces',</pre>
			<pre class="source-code">        required = True,</pre>
			<pre class="source-code">    <strong class="bold">)</strong></pre>
			<pre class="source-code">    ...</pre>
			<p>In the preceding example, we do not need to include any validation messages because we have already defined <a id="_idIndexMarker741"/>the messages we want in the <code>MultipleEmailField</code> class. </p>
			<p>The arguments that are available are listed here:</p>
			<div><div><img src="img/Table_2.jpg" alt=""/>
				</div>
			</div>
			<p>These are the arguments included within the <code>__init__()</code> method of the <code>Field</code> class in the Django library. If we needed to use arguments such as <code>min_length</code> and <code>max_length</code>, as we did for the <code>full_name</code> field, we should have constructed the <code>MultipleEmailField</code> class using the <code>CharField</code> class instead of the <code>Field</code> class like we did in <em class="italic">step 2</em> of the subsection titled <em class="italic">Field class – Field</em> of this chapter, as depicted here:</p>
			<pre class="source-code"><strong class="bold"># Dummy Code</strong></pre>
			<pre class="source-code">from django.forms.fields </pre>
			<pre class="source-code">import Field, <strong class="bold">CharField</strong></pre>
			<pre class="source-code">class MultipleEmailField(<strong class="bold">CharField</strong>):</pre>
			<p>The reason why we would want to use <code>CharField</code> instead of the <code>Field</code> class is that it extends the <code>Field</code> class and adds logic that includes the <code>min_length</code> and <code>max_length</code> arguments. Using <a id="_idIndexMarker742"/>this notion, you can extend any other field class, making available any of the unique arguments or behaviors of that class when writing your own custom class. </p>
			<p>Next, let's take our contact form and use it with a view class to serve up our contact page. </p>
			<h1 id="_idParaDest-151"><a id="_idTextAnchor171"/>Working with form views</h1>
			<p>A <strong class="bold">form view</strong> is just like any other <a id="_idIndexMarker743"/>view class, except that a form view class is <a id="_idIndexMarker744"/>designed to process and handle form objects and form submissions. </p>
			<p>Django offers <a id="_idIndexMarker745"/>four main form view classes, listed here: </p>
			<ul>
				<li><code>FormView</code></li>
				<li><code>CreateView</code></li>
				<li><code>UpdateView</code></li>
				<li><code>DeleteView</code></li>
			</ul>
			<p>These can all be found in the <code>django.views.generic.edit</code> library.</p>
			<p>If we were to create a view to work with the <code>ContactForm</code> class that we created earlier, which does <a id="_idIndexMarker746"/>not relate to any models, we would use a simple <code>FormView</code> class. The other three classes can be used with forms that relate to models. They each serve a different purpose: to create, update, or delete records in a database. For example, <code>CreateView</code> will render a form containing blank or default values intended to create a record that does not exist yet. <code>UpdateView</code> uses a form that looks up an existing record, displays the values that exist for that record, and allows changes to be made. <code>DeleteView</code> will display to the user a prompt or confirmation page, asking the user whether they actually want to proceed with this task, then delete that record. </p>
			<p>Let's use the <code>FormView</code> class to begin building a page that displays the <code>ContactForm</code> class object. We will be working with <code>CreateView</code> and <code>UpdateView</code> later in this chapter. For a complete <a id="_idIndexMarker747"/>breakdown of how to use all of these form view classes, visit <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-editing/">https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-editing/</a>. </p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor172"/>View class – FormView</h2>
			<p>Let's start by constructing a class called <code>FormClassView</code> using Django's <code>FormView</code> class. This class will have <a id="_idIndexMarker748"/>three options that we will define, the first option being <code>template_name</code>, which is used to define the path of the HTML template that we are using. The second option is the <code>form_class</code> option, which is used to define the name of the form class that this view is going to process, that being the <code>ContactForm</code> class. The third option is <code>success_url</code>, which specifies a relative URL path to redirect the user to when the form is successfully submitted. </p>
			<p>Follow these steps <a id="_idIndexMarker749"/>to configure your <code>FormClassView</code> class:</p>
			<ol>
				<li value="1">Make sure you have a file called <code>views.py</code> in your <code>/becoming_a_django_entdev/chapter_5/</code> folder. This is usually created automatically for you when a new Django app is created.</li>
				<li>In that same file, add the code shown here: <pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
from django.views.generic.edit 
import <strong class="bold">FormView</strong>
from .forms 
import <strong class="bold">ContactForm</strong>
class <strong class="bold">FormClassView</strong>(<strong class="bold">FormView</strong>):
    <strong class="bold">template_name</strong> = 'chapter_5/form-class.html'
    <strong class="bold">form_class</strong> = <strong class="bold">ContactForm</strong>
    <strong class="bold">success_url</strong> = '/chapter-5/contact-form-success/'</pre></li>
			</ol>
			<p>Any of these options can use a callable to gain those values, such as the use of the <code>reverse()</code> function to specify <code>success_url</code>. An example of how this can be done is depicted <a id="_idIndexMarker750"/>here, but this is not part of the actual exercise:</p>
			<pre><strong class="bold"># Dummy Code</strong>
from django.urls 
import <strong class="bold">reverse</strong>
from django.views.generic.edit 
import FormView
class <strong class="bold">FormClassView</strong>(FormView):
    ...
    def <code>get_success_url</code>(self, **kwargs):
        return <strong class="bold">reverse</strong>('pattern_name', args=(value,))</pre>
			<p>We won't actually need the callable shown here to formulate the success URL. All we need is the string representation of <code>'/chapter_5/contact-form-success/'</code>. </p>
			<ol>
				<li value="3">Next, configure the URL pattern for <code>http://localhost:8000/chapter-5/form-class/</code>. If this file was not automatically created for you, create the <code>/chapter_5/urls.py</code> file and add the following form page pattern and <code>import</code> statement:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/urls.py</strong>
from django.urls 
import re_path
from django.views.generic 
import (
    <strong class="bold">TemplateView</strong>
)
from .views 
import <strong class="bold">FormClassView</strong>
urlpatterns = [ 
    re_path(
        r'^chapter-5/form-class/?$', 
        <strong class="bold">FormClassView.as_view()</strong>
    ),
]</pre></li>
				<li>In that same file, add the <a id="_idIndexMarker751"/>following success pattern:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/urls.py</strong>
...
urlpatterns = [
    ...,
    re_path(
        r'^chapter-5/contact-form-success/?$', 
        <strong class="bold">TemplateView</strong>.as_view(
            template_name = 'chapter_5/contact-success.html'
        ),
        kwargs = {
            'title': 'FormClassView Success Page',
            'page_id': 'form-class-success',
            'page_class': 'form-class-success-page',
            'h1_tag': 'This is the FormClassView Success Page Using ContactForm',
        }
    ),
]</pre></li>
			</ol>
			<p>In this step, we added a second pattern to serve as the success page at <code>http://localhost:8000/chapter-5/contact-form-success/</code>. This success page <a id="_idIndexMarker752"/>will be used for all exercises in this chapter. </p>
			<p>Now that we have a view class to work with and some basic options defined, let's explore what it takes to work with the different reques<a id="_idTextAnchor173"/>t methods.</p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor174"/>HTTP request methods</h2>
			<p>Working with the <code>FormView</code> class in Django, there are two HTTP request methods: the <code>GET</code> and <code>POST</code> methods. The <code>GET</code> method <a id="_idIndexMarker753"/>is intended to render a form with <a id="_idIndexMarker754"/>blank or default values onto a page and wait for the user to fill out the form and submit it. Once the form has been submitted, the <code>POST</code> method will be executed.</p>
			<h3>GET</h3>
			<p>The <code>get()</code> method is just <a id="_idIndexMarker755"/>like any other GET method for a <a id="_idIndexMarker756"/>view class. It is the go-to method when the page first gets loaded. </p>
			<p>Follow these steps to configure your <code>FormClassView</code> class's <code>get()</code> method:</p>
			<ol>
				<li value="1">In the <code>/chapter_5/views.py</code> file, add the <code>get()</code> method to your existing <code>FormClassView</code> class using the following code:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
from django.views.generic.edit 
import <strong class="bold">FormView</strong>
from django.template.response 
import (
    <strong class="bold">TemplateResponse</strong>
)
class <strong class="bold">FormClassView</strong>(<strong class="bold">FormView</strong>):
    ...
    def <strong class="bold">get(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:
        <strong class="bold">return TemplateResponse(</strong>
            <strong class="bold">request,</strong>
            <strong class="bold">self.template_name,</strong> 
            {
                'title': 'FormClassView Page',
                'page_id': 'form-class-id',
                'page_class': 'form-class-page',
                'h1_tag': 'This is the FormClassView Page Using ContactForm',
                'form': self.form_class,
            }
        <strong class="bold">)</strong></pre></li>
			</ol>
			<p>In the preceding <code>get()</code> method, we <a id="_idIndexMarker757"/>are returning an HTTP response <a id="_idIndexMarker758"/>in the form of a <code>TemplateResponse</code> class, using the value of <code>self.template_name</code> as the path to the template location. We are providing that template with context unique to this page, such as the <code>title</code>, <code>page_id</code>, <code>page_class</code>, <code>h1_tag</code>, and <code>form</code> variables that are depicted in the preceding code block. The value of <code>self.form_class</code> is used to pass the form object into the template. Initial values can be defined on form fields when the page first gets loaded, which is when the form is initialized. </p>
			<ol>
				<li value="2">Add the <a id="_idIndexMarker759"/>following <code>initial</code> list to your existing <code>get()</code> method of <a id="_idIndexMarker760"/>the <code>FormClassView</code> class and pass it into your return context, as highlighted in the following code block: <pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
class <strong class="bold">FormClassView</strong>(FormView):
    def <strong class="bold">get(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:
        <strong class="bold">initial</strong> = {
            'full_name': 'FirstName LastName',
            'email_1': 'example1@example.com',
            # Add A Value For Every Field...
        }
        return TemplateResponse(
            request, self.template_name, {
                ...
                'form': self.form_class(<strong class="bold">initial</strong>),
            }
        )</pre></li>
			</ol>
			<p>In this <code>get()</code> method, we added the <code>initial</code> variable as a list and then passed that list into the <code>self.form_class(initial)</code> object, which lets us set the initial value <a id="_idIndexMarker761"/>on fields, defining field names <a id="_idIndexMarker762"/>as the keys shown previously with their corresponding values.</p>
			<h3>POST</h3>
			<p>A <code>post()</code> method is used to render the same page when a form has been submitted. In this method, we can <a id="_idIndexMarker763"/>determine whether the form is valid and if so, we want to redirect it to a success URL. If the form is not valid, the page will <a id="_idIndexMarker764"/>reload with the values that the user entered into the fields and display any error messages that may exist. We can also alter or add to the context of a page using a <code>post()</code> method.</p>
			<p>In your <code>/chapter_5/views.py</code> file, in the same <code>FormClassView</code> class, add the <code>post()</code> method shown here:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">from django.views.generic.edit </pre>
			<pre class="source-code">import <strong class="bold">FormView</strong></pre>
			<pre class="source-code">from django.http </pre>
			<pre class="source-code">import <strong class="bold">HttpResponseRedirect</strong></pre>
			<pre class="source-code">from django.template.response </pre>
			<pre class="source-code">import (</pre>
			<pre class="source-code">    <strong class="bold">TemplateResponse</strong></pre>
			<pre class="source-code">)</pre>
			<pre class="source-code">class <strong class="bold">FormClassView</strong>(<strong class="bold">FormView</strong>):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    def <strong class="bold">post(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:</pre>
			<pre class="source-code">        <strong class="bold">form = self.form_class(request.POST)</strong></pre>
			<pre class="source-code">        if form.is_valid():</pre>
			<pre class="source-code">            return <strong class="bold">HttpResponseRedirect(</strong></pre>
			<pre class="source-code">                self.success_url</pre>
			<pre class="source-code">            <strong class="bold">)</strong></pre>
			<pre class="source-code">        else:</pre>
			<pre class="source-code">            return <strong class="bold">TemplateResponse(</strong></pre>
			<pre class="source-code">                request, </pre>
			<pre class="source-code">                self.template_name, </pre>
			<pre class="source-code">                {</pre>
			<pre class="source-code">                    'title': 'FormClassView Page<strong class="bold"> - Please Correct The Errors Below</strong>',</pre>
			<pre class="source-code">                    'page_id': 'form-class-id',</pre>
			<pre class="source-code">                    'page_class': 'form-class-page <strong class="bold">errors-found</strong>',</pre>
			<pre class="source-code">                    'h1_tag': 'This is the FormClassView Page Using ContactForm&lt;br /&gt;<strong class="bold">&lt;small class="error-msg"&gt;Errors Found&lt;/small&gt;</strong>',</pre>
			<pre class="source-code">                    'form': form,</pre>
			<pre class="source-code">                }</pre>
			<pre class="source-code">            <strong class="bold">)</strong></pre>
			<p>Inside the <code>TemplateResponse</code> return statement, the highlighted text where the context is written represents the context that has changed from the <code>get()</code> method to the <code>post()</code> method. In order <a id="_idIndexMarker765"/>to preserve the data that the user has <a id="_idIndexMarker766"/>entered into the form, <code>request.POST</code> must be passed into the form class, where <code>self.form_class(request.POST)</code> is highlighted in the preceding step. If we didn't pass <code>request.POST</code> into <code>self.form_class()</code>, then we would have rendered a blank <a id="_idIndexMarker767"/>form, as if we were using the <code>get()</code> method, upon <a id="_idIndexMarker768"/>first visiting this page.</p>
			<p>Now that we have our view class written, we can work on the template that will render our form next.</p>
			<h1 id="_idParaDest-154"><a id="_idTextAnchor175"/>Rendering forms in templates</h1>
			<p>Django offers five main ways to easily and quickly render a form object onto a page. The first three are <a id="_idIndexMarker769"/>to render a form using a paragraph, table, or list <a id="_idIndexMarker770"/>structure. The other two include the traditional way of rendering a form, which is based on the template in the <code>django.forms.templates.django.forms</code> library called <code>default.html</code>, and then a way to render your own template. New to Django 4.0 is the <code>template_name</code> option on all form classes. This option allows you to point to a template file where you can structure your own HTML formatting.</p>
			<p>Follow these steps to render your form objects:</p>
			<ol>
				<li value="1">Copy the <code>base_template_1.html</code> file that was created in <a href="B17243_04_ePub.xhtml#_idTextAnchor116"><em class="italic">Chapter 4</em></a>, <em class="italic">URLs, Views, and Templates</em>, into your <code>/becoming_a_django_entdev/chapter_5/templates/chapter_5/base/</code> folder. Copy all related partial template files that are added as <code>{% include %}</code> statements into that file as well.</li>
				<li>That <code>base_template_1.html</code> file will be repurposed as the base template for this chapter's exercise. Adjust any paths to point to the new <code>chapter_5</code> folder, such as any CSS and JavaScript file paths. </li>
				<li>Copy all related CSS, JavaScript, and HTML files into your <code>chapter_5</code> app as well. These are not required to complete this exercise but will prevent 404 errors in your console logs. </li>
				<li>Create a new file called <code>form-class.html</code> inside your <code>/becoming_a_django_entdev/chapter_5/templates/chapter_5/</code> folder and include the tags we can see in the following code block:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/form-class.html</strong>
{% extends 'chapter_5/base/base_template_1.html' %}
{% load static %}
{% block page_title %}{{ title }}{% endblock %}
{% block head_stylesheets %}{% endblock %}
{% block js_scripts %}{% endblock %}
{% block page_id %}{{ page_id }}{% endblock %}
{% block page_class %}{{ block.super }} {{ page_class }}{% endblock %}</pre></li>
				<li>Inside <a id="_idIndexMarker771"/>your <code>/chapter_5/form-class.html</code> file, add <a id="_idIndexMarker772"/>the following code inside the <code>body_content</code> block, to render a form in the simplest way possible:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/form-class.html</strong>
...
{% block body_content %}
    ...
    &lt;form method="post"&gt;
        {% csrf_token %}
        <strong class="bold">{{ form }}</strong>
        &lt;input type="submit" value="Send Message"&gt;
    &lt;/form&gt;
{% endblock %}</pre></li>
			</ol>
			<p>Here, we need to at least write the <code>&lt;form&gt;</code> element and define an attribute of <code>method="post"</code> telling <a id="_idIndexMarker773"/>the browser how to handle a form <a id="_idIndexMarker774"/>submission. The <code>{{ form }}</code> tag renders any fields that exist for this form, using the <code>django.forms.templates.django.forms.default.html</code> library template. <code>{% csrf_token %}</code> is a cross-site request forgery token that is used for security measures and is required on all Django forms. <code>&lt;input type="submit"&gt;</code> specifies the button that is used to trigger the form's submit action.</p>
			<p>Let's dive into the remaining four mechanisms and how they are used.</p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor176"/>Render form – as_p</h2>
			<p>This option will render each field wrapped in a paragraph, <code>&lt;p&gt;&lt;/p&gt;</code>, element. The label will be stacked <a id="_idIndexMarker775"/>above the input field with the help text below it. If errors <a id="_idIndexMarker776"/>are present, each field will have its own list object rendered above the paragraph objects, listing all the errors relating to that field. </p>
			<p>To render your form with <code>as_p</code>, in your <code>/chapter_5/form-class.html</code> file, change the <code>{{ form }}</code> tag to <code>{{ form.as_p }}</code>. </p>
			<p>This should render each field to look like the demo code depicted here:</p>
			<pre class="source-code"><strong class="bold"># Dummy code rendered, for first_name field</strong></pre>
			<pre class="source-code">&lt;ul class="errorlist"&gt;</pre>
			<pre class="source-code">    &lt;li&gt;Please provide us with a name to address you as&lt;/li&gt;</pre>
			<pre class="source-code">&lt;/ul&gt;</pre>
			<pre class="source-code">&lt;p&gt;</pre>
			<pre class="source-code">    &lt;label for="full-name"&gt;Full Name:&lt;/label&gt;</pre>
			<pre class="source-code">    &lt;input type="text" name="full_name" id="full-name" class="form-input-class field-error" placeholder="Your Name, Written By..." maxlength="300" minlength="2" required=""&gt;</pre>
			<pre class="source-code">    &lt;span class="helptext"&gt;Enter your full name, first and last name please&lt;/span&gt;</pre>
			<pre class="source-code">&lt;/p&gt;</pre>
			<p>Let's render the <a id="_idIndexMarker777"/>form formatted <a id="_idIndexMarker778"/>as a table next.</p>
			<h2 id="_idParaDest-156"><a id="_idTextAnchor177"/>Render form – as_table</h2>
			<p>This option takes <a id="_idIndexMarker779"/>each field and wraps it in a <code>&lt;tr&gt;&lt;/tr&gt;</code> element. The label of this field is <a id="_idIndexMarker780"/>wrapped in a <code>&lt;th&gt;&lt;/th&gt;</code> element and the field itself is wrapped in a <code>&lt;td&gt;&lt;/td&gt;</code> element. The label will be stacked to the left with the input object and help text and error message displayed to the right, as shown:</p>
			<div><div><img src="img/Figure_5.1_B17243.jpg" alt="Figure 5.1 – Render form – as_table&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.1 – Render form – as_table</p>
			<p>To use this option, we still have to wrap the form tag in a <code>&lt;table&gt;&lt;/table&gt;</code> element because only the inner contents of a table are rendered. </p>
			<p>To render your form as a table, in your <code>/chapter_5/form-class.html</code> file, change your <code>{{ form }}</code> tag to <code>{{ form.as_table }}</code> and wrap it in the <code>&lt;table&gt;</code> tag, as shown: </p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/form-class.html</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">        &lt;table&gt;</pre>
			<pre class="source-code">            <strong class="bold">{{ form.as_table }}</strong></pre>
			<pre class="source-code">        &lt;/table&gt;</pre>
			<pre class="source-code">...</pre>
			<p>Let's render <a id="_idIndexMarker781"/>the form <a id="_idIndexMarker782"/>formatted as a list next.</p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor178"/>Render form – as_ul</h2>
			<p>This option will <a id="_idIndexMarker783"/>render your form as a list with each field wrapped in a <code>&lt;li&gt;&lt;/li&gt;</code> element. Inside <a id="_idIndexMarker784"/>that element, the label will come first, then the input field, and the help text last. If an error occurs, it gets injected as its own list item above that field, as shown:</p>
			<div><div><img src="img/Figure_5.2_B17243.jpg" alt="Figure 5.2 – Render form – As a list&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.2 – Render form – As a list</p>
			<p>We also have to wrap the form in an element with the <code>&lt;ul&gt;&lt;/ul&gt;</code> list element. To render your form as a list, in your <code>/chapter_5/form-class.html</code> file, change the <code>{{ form }}</code> tag to <code>{{ form.as_ul }}</code> and wrap it in the <code>&lt;ul&gt;</code> tag, as shown: </p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/form-class.html</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">        &lt;ul&gt;</pre>
			<pre class="source-code">            <strong class="bold">{{ form.as_ul }}</strong></pre>
			<pre class="source-code">        &lt;/ul&gt;</pre>
			<pre class="source-code">...</pre>
			<p>Let's use a new approach that was introduced in Django 4.0 next.</p>
			<h2 id="_idParaDest-158"><a id="_idTextAnchor179"/>Render form – using template_name</h2>
			<p>New to Django 4.0 is <a id="_idIndexMarker785"/>the <code>template_name</code> feature. This <a id="_idIndexMarker786"/>feature is used to render a form in the style written within a custom template. It gives developers the ability to structure their own HTML when fields are rendered. Developers can create many different template styles and use them as needed. Fields are accessed via the <code>{{ fields }}</code> tag inside that custom template.</p>
			<p>Follow these steps to configure your custom form template: </p>
			<ol>
				<li value="1">In your <code>/chapter_5/forms.py</code> file, add the <code>template_name</code> option to the existing <code>ContactForm</code> class, as highlighted:<pre><code>/chapter_5/form-class.html</code> file, you render your form using only the basic <code>{{ form }}</code> tag and not any of the other preconfigured form rendering methods.</p></li>
				<li>Next, create the <code>custom-form.html</code> file in your <code>/chapter_5/templates/chapter_5/forms/</code> folder. We will not be adding an <code>{% extends %}</code> tag <a id="_idIndexMarker787"/>to this file; instead, we <a id="_idIndexMarker788"/>will treat it as if we are using an <code>{% include %}</code> tag, where it is just a snippet and not an entire page of HTML. </li>
				<li>Inside your <code>/chapter_5/custom-forms.html</code> file, add the following code:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/forms/custom-forms.html</strong>
{% load static %}
<strong class="bold">{% for field, errors in fields %}</strong>
    &lt;div class="field-box{% if errors %} error{% endif %}"&gt;
        &lt;label for="{{ field.id_for_label }}"&gt;
            {% if field.field.required %}&lt;span class="required"&gt;*&lt;/span&gt;{% endif %}{{ field.label|safe }}
        &lt;/label&gt;
        &lt;div class="form-group"&gt;
            <strong class="bold">{{ field }}</strong>
            {{ errors|safe }}
            {% if field.help_text and field.help_text != '' %}
                &lt;span class="help-text"&gt;
                    <strong class="bold">{{ field.help_text|safe }}</strong>
                &lt;/span&gt;
            {% endif %}
        &lt;/div&gt;
    &lt;/div&gt;
{% endfor %}</pre></li>
			</ol>
			<p>Here, we are <a id="_idIndexMarker789"/>looping through all <a id="_idIndexMarker790"/>of the fields with the <code>{% for field, errors in fields %}</code> tag shown in the preceding code block. We've added our own HTML structure using the <code>&lt;div&gt;</code>, <code>&lt;label&gt;</code>, and <code>&lt;span&gt;</code> elements. The field itself is rendered using the <code>{{ field }}</code> tag. Other information, such as the help text, is used in conjunction with the <code>safe</code> filter in <code>{{ field.help_text|safe }}</code>. The <code>safe</code> filter is used to make sure that any HTML contained in the string gets rendered as HTML objects and not printed as the string representation of that object.</p>
			<p>Let's demonstrate all of these form renderings in action next.</p>
			<h2 id="_idParaDest-159"><a id="_idTextAnchor180"/>Render demo</h2>
			<p>By now, we should have a working form. In your browser, visit the URL <code>http://localhost:8000/chapter-5/form-class/</code>, and you should see your form rendered <a id="_idIndexMarker791"/>onto the page. Through all of the examples provided using the <code>ContactForm</code> class, we should see six fields on this page. Here, we can see how an email field can behave differently as we interact with the form. For example, if we set the required argument in the <code>email_1</code> field to equal <code>False</code>, we can submit the form with nothing entered into this field and it will succeed. In the field named <code>email_2</code>, we specified the <code>required</code> argument as equal to <code>True</code>. This added the <code>required</code> attribute to that input field, preventing the user from submitting that form. This means the user will never see the error message that we provided in the Django code. This route would require the use of JavaScript, such as the jQuery Validate library, to handle the error state and display an error message for us. Doing nothing would result in the browser handling the error state for us, and in Chrome, that would look as in the following screenshot:</p>
			<div><div><img src="img/Figure_5.3_B17243.jpg" alt="Figure 5.3 – ContactForm email_2 field&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.3 – ContactForm email_2 field</p>
			<p>However, on the field named <code>email_3</code>, we set the required argument to equal <code>False</code>, and in the clean method, we are performing the validation that checks whether the field has a value or not. This lets us submit the form and see the error message that was provided on postback, as shown:</p>
			<div><div><img src="img/Figure_5.4_B17243.jpg" alt="Figure 5.4 – ContactForm email_3 field&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.4 – ContactForm email_3 field</p>
			<p>Next, let's take <a id="_idIndexMarker792"/>Django forms a step further and start working with the models in a form class. We created a placeholder class for this, called <code>VehicleForm</code>, in the section titled <em class="italic">Form class – ModelForm</em>.</p>
			<h1 id="_idParaDest-160"><a id="_idTextAnchor181"/>Linking a model to a form</h1>
			<p>Linking a model <a id="_idIndexMarker793"/>to a form without needing any special field <a id="_idIndexMarker794"/>rendering is fairly easy.</p>
			<p>In your <code>/chapter_5/forms.py</code> file, add the following code to the existing <code>VehicleForm</code> class (remember to remove the <code>pass</code> statement that was added to this class earlier):</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">from django.forms </pre>
			<pre class="source-code">import Form, <strong class="bold">ModelForm</strong></pre>
			<pre class="source-code">from ..chapter_3.models </pre>
			<pre class="source-code">import <strong class="bold">Vehicle</strong></pre>
			<pre class="source-code">class <strong class="bold">VehicleForm</strong>(<strong class="bold">ModelForm</strong>):</pre>
			<pre class="source-code">    class <strong class="bold">Meta</strong>:</pre>
			<pre class="source-code">        model = <strong class="bold">Vehicle</strong></pre>
			<pre class="source-code">        fields = [</pre>
			<pre class="source-code">            'vin', </pre>
			<pre class="source-code">            'sold', </pre>
			<pre class="source-code">            'price', </pre>
			<pre class="source-code">            'make', </pre>
			<pre class="source-code">            'vehicle_model', </pre>
			<pre class="source-code">            'engine',</pre>
			<pre class="source-code">        ]</pre>
			<p>In the preceding example, we don't have to create fields for this form. Django will automatically use <a id="_idIndexMarker795"/>the form field type associated with the model field type that we <a id="_idIndexMarker796"/>wrote for the <code>Vehicle</code> model, created in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>. If any field behavior needed modifying, we would write form fields the same way we did for <code>ContactForm</code> and then customize them as we see fit. The <code>Meta</code> subclass used here defines what model class we are using and the <code>fields</code> option specifies what fields of that model we want to include and in what order they should be included.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Using <code>fields = '__all__'</code> will include all fields that exist for that model in the order that they were written for that model.</p>
			<p>Let's work with the <code>CreateView</code> class next.</p>
			<h2 id="_idParaDest-161"><a id="_idTextAnchor182"/>View class – CreateView</h2>
			<p>Using the <code>VehicleForm</code> class that we now have wired up to the <code>Vehicle</code> model, let's create a view that will <a id="_idIndexMarker797"/>render a form with no or default field values <a id="_idIndexMarker798"/>using the <code>CreateView</code> class. It will let us create a new vehicle record in the database when that form is successfully submitted.</p>
			<p>Follow these <a id="_idIndexMarker799"/>steps to configure your <code>CreateView</code> class:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/views.py</code> file, add the following <code>import</code> statements and create <a id="_idIndexMarker800"/>the <code>ModelFormClassCreateView</code> class, as follows:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
from django.http 
import <strong class="bold">HttpResponseRedirect</strong>
from django.views.generic.edit 
import (
    ..., 
    <strong class="bold">CreateView</strong>
)
from django.template.response 
import (
    <strong class="bold">TemplateResponse</strong>
)
from .forms 
import ContactForm, <strong class="bold">VehicleForm</strong>
class <strong class="bold">ModelFormClassCreateView</strong>(<strong class="bold">CreateView</strong>):
    template_name = 'chapter_5/model-form-class.html'
    form_class = <strong class="bold">VehicleForm</strong>
    success_url = '/chapter-5/vehicle-form-success/'</pre></li>
				<li>In that same <code>ModelFormClassCreateView</code> class, add the following <code>get()</code> method:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
class <strong class="bold">ModelFormClassCreateView</strong>(CreateView):
    ...
    def <strong class="bold">get(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:
        return <strong class="bold">TemplateResponse(</strong>
            request, 
            self.template_name, 
            {
                'title': 'ModelFormClassCreateView Page',
                'page_id': 'model-form-class-id',
                'page_class': 'model-form-class-page',
                'h1_tag': 'This is the ModelFormClassCreateView Class Page Using VehicleForm',
                <strong class="bold">'form': self.form_class(),</strong>
            }
        <strong class="bold">)</strong></pre></li>
				<li>In that <a id="_idIndexMarker801"/>same <code>ModelFormClassCreateView</code> class, add <a id="_idIndexMarker802"/>the following <code>post()</code> method:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
class <strong class="bold">ModelFormClassCreateView</strong>(CreateView):
    ...
    def <strong class="bold">post(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:
        form = self.form_class(request.POST)
        <strong class="bold">if form.is_valid():</strong>
            vehicle = form.instance
            <strong class="bold">vehicle.save()</strong>
            return <strong class="bold">HttpResponseRedirect(</strong>
                self.success_url
            <strong class="bold">)</strong>
        else:
            return <strong class="bold">TemplateResponse(</strong>
                request, 
                self.template_name, 
                {
                    'title': 'ModelFormClassCreateView Page - Please Correct The Errors Below',
                    'page_id': 'model-form-class-id',
                    'page_class': 'model-form-class-page errors-found',
                    'h1_tag': 'This is the ModelFormClassCreateView Page Using VehicleForm&lt;br /&gt;&lt;small class="error-msg"&gt;Errors Found&lt;/small&gt;',
                    'form': form,
                }
            <strong class="bold">)</strong></pre></li>
			</ol>
			<p>In this example, we gave this class the same two methods that we used earlier—<code>get()</code> and <code>post()</code>. These two methods work the same way as when used in a class constructed <a id="_idIndexMarker803"/>with the <code>FormView</code> class. In the <code>get()</code> method, we <a id="_idIndexMarker804"/>are passing just a blank form into the template as context using <code>self.form_class()</code>. In the <code>post()</code> method, we are once again passing <code>request</code> into the form to get the data that was submitted by the user, using <code>form = self.form_class(request.POST)</code>. In that <code>post()</code> method, validation is performed using <code>if form.is_valid():</code> and it will either redirect to a success page or refresh, serving up the form with the correct error messages. If the form is validated successfully, just before we perform the redirect, we are saving the form using <code>vehicle.save()</code>, the same way we did when we added data using the Django shell in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>.</p>
			<ol>
				<li value="4">Create a URL pattern using the <code>ModelFormClassCreateView</code> class, add the following path to your <code>/chapter_5/urls.py</code> file, and include the following <code>import</code> statements: <pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/urls.py</strong>
from django.urls 
import re_path
from django.views.generic 
import (
    <strong class="bold">TemplateView</strong>
)
from .views 
import (
    FormClassView,
    <strong class="bold">ModelFormClassCreateView</strong>
)
urlpatterns = [
    ...,
    re_path(
        r'^chapter-5/model-form-class/?$', 
        <strong class="bold">ModelFormClassCreateView.as_view()</strong>
    ),
]</pre></li>
				<li>In that <a id="_idIndexMarker805"/>same <code>/chapter_5/urls.py</code> file, add the <a id="_idIndexMarker806"/>following success URL pattern:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/urls.py</strong>
...
urlpatterns = [
    ...,
    re_path(
        <strong class="bold">r'^chapter-5/vehicle-form-success/?$', </strong>
        TemplateView.as_view(
            template_name = 'chapter_5/vehicle-success.html'
        ), 
        kwargs = {
            'title': 'ModelFormClass Success Page',
            'page_id': 'model-form-class-success',
            'page_class': 'model-form-class-success-page',
            'h1_tag': 'This is the ModelFormClass Success Page Using VehicleForm',
        }
    ),
]</pre></li>
			</ol>
			<p>We added the success URL pattern for a vehicle form at <code>http://localhost:8000/chapter-5/vehicle-form-success/</code>. </p>
			<ol>
				<li value="6">Next, construct <a id="_idIndexMarker807"/>your <code>/chapter_5/model-form-class.html</code> file the same way that we created <a id="_idIndexMarker808"/>the <code>/chapter_5/form-class.html</code> file. </li>
				<li>Now, visit the URL <code>http://localhost:8000/chapter-5/model-form-class/</code>, and if you are rendering your form using the standard <code>{{ form }}</code> tag, you should see the page looking as in the following screenshot:</li>
			</ol>
			<p class="figure-caption"> </p>
			<div><div><img src="img/Figure_5.5_B17243.jpg" alt="Figure 5.5 – VehicleForm using ModelFormClassCreateView&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.5 – VehicleForm using ModelFormClassCreateView</p>
			<p>Of course, this example is in its simplest form. If you wanted to use another format or a template of your own, you would follow the steps under the <em class="italic">Rendering forms in templates</em> section of this chapter.</p>
			<h2 id="_idParaDest-162"><a id="_idTextAnchor183"/>View class – UpdateView</h2>
			<p>In this example, we need <a id="_idIndexMarker809"/>to create a URL pattern using a path converter to capture <a id="_idIndexMarker810"/>the ID of the vehicle record that is being looked up. </p>
			<p>Follow these steps <a id="_idIndexMarker811"/>to configure your <code>UpdateView</code> class:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/urls.py</code> file, add the path shown here:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/urls.py</strong>
from django.urls 
import re_path
from .views 
import (
    ...,
    <strong class="bold">ModelFormClassUpdateView</strong>
)
...
urlpatterns = [
    ...,
    re_path(
        'chapter-5/model-form-class/(?P&lt;id&gt;[0-9])/?$', 
        <strong class="bold">ModelFormClassUpdateView</strong>.as_view(), 
        name = 'vehicle_detail'
    ),
]</pre></li>
			</ol>
			<p>This pattern will allow us to access a <code>Vehicle</code> record by ID, also known as a primary key, in a database. We specify the ID of the <code>Vehicle</code> that we <a id="_idIndexMarker812"/>want to look up in the URL itself, as in <code>http://localhost:8000/chapter-5/model-form-class/2/</code>. </p>
			<ol>
				<li value="2">In <a id="_idIndexMarker813"/>your <code>/chapter_5/views.py</code> file, add the <code>ModelFormClassUpdateView</code> class <a id="_idIndexMarker814"/>and <code>import</code> statements shown here:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
from django.http 
import <strong class="bold">HttpResponseRedirect</strong>
from django.template.response 
import (
    <strong class="bold">TemplateResponse</strong>
)
from django.views.generic.edit 
import (
    ..., 
    <strong class="bold">UpdateView</strong>
)
from .forms 
import <strong class="bold">VehicleForm</strong>
from ..chapter_3.models 
import <strong class="bold">Vehicle</strong>
class <strong class="bold">ModelFormClassUpdateView</strong>(<strong class="bold">UpdateView</strong>):
    template_name = 'chapter_5/model-form-class.html'
    form_class = <strong class="bold">VehicleForm</strong>
    success_url = '/chapter-5/vehicle-form-success/'</pre></li>
				<li>In that <a id="_idIndexMarker815"/>same <code>ModelFormClassUpdateView</code> class, add the <code>get()</code> and <code>post()</code> methods <a id="_idIndexMarker816"/>shown here:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
from django.template.response 
import (
    TemplateResponse
)
from django.views.generic.edit 
import (
    ...,
    UpdateView
)
from ..chapter_3.models 
import <strong class="bold">Vehicle</strong>
...
class <strong class="bold">ModelFormClassUpdateView</strong>(UpdateView):
    ...
    def <strong class="bold">get(</strong>self, request, id, *args, **kwargs<strong class="bold">)</strong>:
        try:
            vehicle = <strong class="bold">Vehicle</strong>.objects.get(pk=id)
        except Vehicle.DoesNotExist:
            form = self.form_class()
        else:
            form = self.form_class(instance=vehicle)
        return <strong class="bold">TemplateResponse(</strong>
            request, 
            self.template_name, 
            {
                'title': 'ModelFormClassUpdateView Page',
                'page_id': 'model-form-class-id',
                'page_class': 'model-form-class-page',
                'h1_tag': 'This is the ModelFormClassUpdateView Class Page Using VehicleForm',
                'form': form,
            }
        <strong class="bold">)</strong>
    def <strong class="bold">post(</strong>self, request, id, *args, **kwargs<strong class="bold">)</strong>:
        # Use the same code as we did for the ModelFormClassCreateView class</pre></li>
				<li>Now, navigate to the URL <code>http://localhost:8000/chapter-5/model-form-class/2/</code>, and you should see the form preloaded with the values found in <a id="_idIndexMarker817"/>the database for that Vehicle, as <a id="_idIndexMarker818"/>depicted in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_5.6_B17243.jpg" alt="Figure 5.6 – VehicleForm using ModelFormClassUpdateView&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.6 – VehicleForm using ModelFormClassUpdateView</p>
			<p>We once again use the same two <code>get()</code> and <code>post()</code> methods. One minor difference in how we are writing the <code>get()</code> method here is that we are performing the <code>Vehicle</code> query. We use a <code>try/except</code> statement to determine whether the object exists in the database using <code>vehicle = Vehicle.objects.get(pk=id)</code>. If it does not exist, we create the form object as a blank form using <code>form = self.form_class()</code>. If the <code>Vehicle</code> object is found, then we pass that instance into the form that we are initializing, using <code>form = self.form_class(instance=vehicle)</code>. The <code>post()</code> method <a id="_idIndexMarker819"/>is written the same as what we wrote for <code>ModelFormClassCreateView</code>, except that we updated the context string variables <a id="_idIndexMarker820"/>to reflect this class name.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">When working with fields that have an attribute of <code>unique = True</code> and saving that object in a form using the <code>UpdateView</code> class, you may get a postback error message telling you that the object already exists. To get around this, try removing the <code>unique</code> attribute on your model and implementing your own <code>clean()</code> method to enforce that uniqueness. There are also several other approaches to solve this while keeping the <code>unique</code> attribute; all are rather difficult to implement and go beyond the scope of this chapter. Practice building a form to update the <code>Engine</code> class on your own that does not contain a <code>unique</code> field.</p>
			<p>Let's add inline formsets next.</p>
			<h1 id="_idParaDest-163"><a id="_idTextAnchor184"/>Adding inline formsets</h1>
			<p>An inline formset is a <a id="_idIndexMarker821"/>form within a form. It's a way to provide dynamic fields, for example, for additional personnel, comments, or objects. They are commonly used in combination with <a id="_idIndexMarker822"/>JavaScript code on the frontend to create or remove sets of fields as desired by the user. In the next exercise, we will expand upon the <code>ModelFormClassCreateView</code> class to add our inline formset. This formset will capture prospective buyer information, to capture the first and last name of that lead. We will create an <strong class="bold">Add Another</strong> button for the user to add as many prospective buyers as they would like to. JavaScript is used to control creating and/or deleting the new DOM objects. It will also update the Django management form data in the process. You can build upon this concept to make your form more robust with <a id="_idIndexMarker823"/>added fields and controls for the user to manipulate inline formsets.</p>
			<p>Follow the steps in the following sections to get started with inline formsets.</p>
			<h2 id="_idParaDest-164"><a id="_idTextAnchor185"/>Formset function – formset_factory</h2>
			<p>A <strong class="bold">formset factory</strong> is a controller <a id="_idIndexMarker824"/>that we use to register <a id="_idIndexMarker825"/>inline formsets.</p>
			<p>Follow these <a id="_idIndexMarker826"/>steps to create your formset factory:</p>
			<ol>
				<li value="1">In the <code>/chapter_5/forms.py</code> file, add the following <code>ProspectiveBuyerForm</code> class, which will act as the inline form, capturing the first and last name of the prospective buyer:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
from django 
import <strong class="bold">forms</strong>
from django.forms 
import <strong class="bold">Form</strong>, ModelForm
...
class <strong class="bold">ProspectiveBuyerForm</strong>(<strong class="bold">Form</strong>):
    <strong class="bold">first_name = forms.CharField(</strong>
        label = 'First Name',
        help_text = 'Enter your first name only',
        required = True,
        error_messages = {
            'required': 'Please provide us with a first name',
        }
    <strong class="bold">)</strong>
    <strong class="bold">last_name = forms.CharField(</strong>
        label = 'Last Name',
        help_text = 'Enter your last name only',
        required = True,
        error_messages = {
            'required': 'Please provide us with a last name',
        }
    <strong class="bold">)</strong></pre></li>
			</ol>
			<p>We are doing nothing different in the <code>ProspectiveBuyerForm</code> class in the preceding code compared to what we did in <code>ContactForm</code> before. The same concepts and validation measures apply to the fields within an inline formset. Adjust the logic as necessary for your fields. </p>
			<ol>
				<li value="2">In the same <code>/chapter_5/forms.py</code> file, register that form as <code>formset_factory</code> using the following example. Make sure to place the <code>ProspectiveBuyerFormSet</code> class below the <code>ProspectiveBuyerForm</code> class <a id="_idIndexMarker827"/>in this file:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/forms.py</strong>
...
from django.forms 
import (
    ...,
    <strong class="bold">formset_factory</strong>
)
...
ProspectiveBuyerFormSet = formset_factory(
    <strong class="bold">ProspectiveBuyerForm</strong>,
    extra = 1
)</pre></li>
			</ol>
			<p>In the preceding example, we registered the <code>ProspectiveBuyerForm</code> class in a formset factory called <code>ProspectiveBuyerFormset</code>, which we will use next in our view class. The <code>extra = 1</code> argument is used to include only one instance of this formset when this <code>formset_factory</code> is first initialized. There are many other options available, and they are all explained in detail here: <a href="https://docs.djangoproject.com/en/4.0/topics/forms/formsets/">https://docs.djangoproject.com/en/4.0/topics/forms/formsets/</a>. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">In this example, we are using a standard <code>formset_factory</code> for a form with fields that are not linked to a model. Formsets that do link to models would use the <code>modelformset_factory()</code> method to link form fields to a model in your database. When using that method, data is saved in the view class the same way as when we saved the <code>VehicleForm</code> data.</p>
			<p>Let's use <a id="_idIndexMarker828"/>this inline formset in a view class next.</p>
			<h2 id="_idParaDest-165"><a id="_idTextAnchor186"/>Using inline formsets in the view class</h2>
			<p>Follow these steps to <a id="_idIndexMarker829"/>use your newly created inline formset <a id="_idIndexMarker830"/>in a view class:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/views.py</code> file, in the existing <code>ModelFormClassCreateView</code> class, add a few minor adjustments to the existing <code>get()</code> method, as highlighted in the following code:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
from django.http 
import HttpResponseRedirect
from django.template.response 
import (
    TemplateResponse
)
from django.views.generic.edit 
import (
    ..., 
    <strong class="bold">CreateView</strong>
)
from .forms 
import ..., <strong class="bold">ProspectiveBuyerFormSet</strong>
from ..chapter_3.models 
import Vehicle
class <strong class="bold">ModelFormClassCreateView</strong>(<strong class="bold">CreateView</strong>):
    ...
    def <strong class="bold">get(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:
        <strong class="bold">buyer_formset = ProspectiveBuyerFormSet()</strong>
        return TemplateResponse(
            request, 
            self.template_name, 
            {
                ...
                'form': self.form_class(),
                <strong class="bold">'buyer_formset': buyer_formset,</strong>
            }
        )</pre></li>
				<li>In the <a id="_idIndexMarker831"/>same <code>ModelFormClassCreateView</code> class, add a few minor adjustments to the existing <code>post()</code> method, as <a id="_idIndexMarker832"/>highlighted in the following code:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/views.py</strong>
...
class <strong class="bold">ModelFormClassCreateView</strong>(CreateView):
    ...
    def <strong class="bold">post(</strong>self, request, *args, **kwargs<strong class="bold">)</strong>:
        form = self.form_class(request.POST)
        <strong class="bold">buyer_formset = ProspectiveBuyerFormSet(</strong>
            <strong class="bold">request.POST</strong>
        <strong class="bold">)</strong>
        if form.is_valid():
            ...
        else:
            return TemplateResponse(
                request, 
                self.template_name, 
                {
                    ...
                    'form': form,
                    <strong class="bold">'buyer_formset': buyer_formset,</strong>
                }
            )</pre></li>
			</ol>
			<p>In the preceding steps, we are passing the inline <code>ProspectiveBuyerFormset</code> formset into the template as an additional context variable called <code>buyer_formset</code>. This and the form object should always be thought of as entirely separate objects. The form and the formset can <a id="_idIndexMarker833"/>also be related if they are <a id="_idIndexMarker834"/>using <code>ForeignKey</code>, <code>ManyToMany</code>, or <code>OneToOne</code> model relations.</p>
			<p>Let's render these inline formsets into a template next.</p>
			<h2 id="_idParaDest-166"><a id="_idTextAnchor187"/>Rendering inline formsets in the template</h2>
			<p>To render <a id="_idIndexMarker835"/>your newly created inline formsets into a template <a id="_idIndexMarker836"/>file, in your <code>/chapter_5/model-form-class.html</code> file, include all of the nodes, class names, and IDs that exist, as shown in the following code:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/model-form-class.html</strong></pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">{% extends 'chapter_5/base/base_template_1.html' %}</pre>
			<pre class="source-code">{% load static %}</pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">{% block body_content %}</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    &lt;form method="post" <strong class="bold">id="form"</strong>&gt;</pre>
			<pre class="source-code">        {% csrf_token %}</pre>
			<pre class="source-code">        <strong class="bold">{{ form }}</strong></pre>
			<pre class="source-code">        <strong class="bold">{% if buyer_formset %}</strong></pre>
			<pre class="source-code">            &lt;h3&gt;Prospective Buyers&lt;/h3&gt;</pre>
			<pre class="source-code">            {{ buyer_formset.non_form_errors }}</pre>
			<pre class="source-code">            {{ buyer_formset.management_form }}</pre>
			<pre class="source-code">            <strong class="bold">{% for form in buyer_formset %}</strong></pre>
			<pre class="source-code">                &lt;div class="<strong class="bold">formset-container</strong> {{ buyer_formset.prefix }}"&gt;</pre>
			<pre class="source-code">                    &lt;div class="first-name"&gt;</pre>
			<pre class="source-code">                        {{ form.first_name.label }}: {{ form.first_name }}</pre>
			<pre class="source-code">                    &lt;/div&gt;</pre>
			<pre class="source-code">                    &lt;div class="last-name"&gt;</pre>
			<pre class="source-code">                        {{ form.last_name.label }}: {{ form.last_name }}</pre>
			<pre class="source-code">                    &lt;/div&gt;</pre>
			<pre class="source-code">                &lt;/div&gt;</pre>
			<pre class="source-code">            {% endfor %}</pre>
			<pre class="source-code">        {% endif %}</pre>
			<pre class="source-code">        &lt;button <strong class="bold">id="add-formset"</strong> type="button"&gt;Add Another Prospective Buyer&lt;/button&gt;</pre>
			<pre class="source-code">        &lt;input type="submit" value="Save Vehicle"&gt;</pre>
			<pre class="source-code">    &lt;/form&gt;</pre>
			<pre class="source-code">{% endblock %}</pre>
			<p>The JavaScript we <a id="_idIndexMarker837"/>will soon write will depend on this structure, and as <a id="_idIndexMarker838"/>your structure changes, be sure to change your JavaScript as well. In the preceding code, the important parts of the form include the ID attribute of the form itself, called <code>id="form"</code>. We will use that to target the form as a whole in the JavaScript we are going to write. A conditional is used to check whether the <code>buyer_formset</code> variable exists before we do anything with it. For example, if you wanted to serve up an instance of this page that has no formsets at all, then this conditional will prevent breakage. </p>
			<p>An important feature to never forget to include is the management form data, which is added using the <code>{{ buyer_formset.management_form }}</code> tag. This will include important data that Django needs to process your inline formsets. We then loop through each form in the <code>buyer_formset</code> object using <code>{% for form in buyer_formset %}</code>. For each form that does exist, we wrap all of the internal HTML in a node called <code>&lt;div class="formset-container"&gt;&lt;/div&gt;</code>. This class is important as it will differentiate between each inline form when we work with JavaScript. Inside, you can structure your fields however you like. Lastly, outside of the loop, just before the submit button, we need to add a new <code>&lt;button&gt;</code> of <code>type="button"</code> to prevent accidentally submitting the form. Give that button an attribute of <code>id="add-formset"</code>. </p>
			<p>Now, visit the <a id="_idIndexMarker839"/>same URL that we went to before, to add a <a id="_idIndexMarker840"/>new vehicle at <code>http://localhost:8000/chapter-5/model-form-class/</code>. You should see a form resembling the following: </p>
			<div><div><img src="img/Figure_5.7_B17243.jpg" alt="Figure 5.7 – VehicleForm inline formset&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.7 – VehicleForm inline formset</p>
			<p>There will only be one instance of the prospective buyer for now. Next, we will add the JavaScript controls that let us add more instances to this form.</p>
			<h2 id="_idParaDest-167"><a id="_idTextAnchor188"/>Dynamic inline formsets</h2>
			<p>Follow these steps to <a id="_idIndexMarker841"/>configure the JavaScript needed to let the user add more instances of an inline formset:</p>
			<ol>
				<li value="1">In your <code>/chapter_5/base/base_template_1.html</code> file, there is already a reference to a JavaScript file in the <code>&lt;head&gt;</code> of that document. Make sure the following script is included in your <code>&lt;head&gt;</code> of that document:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/templates/chapter_5/base/base_template_1.html</strong>
...
&lt;html lang="en" xmlns="http://www.w3.org/1999/xhtml"&gt;
    &lt;head&gt;
        ...
        <strong class="bold">&lt;script defer type="text/javascript" src="img/site-js.js' %}"&gt;&lt;/script&gt;</strong>
    &lt;/head&gt;
    ...
&lt;/html&gt;</pre></li>
			</ol>
			<p>This will load a single JavaScript file that is used to make a form interactive and lets the user add another instance of the inline <code>ProspectiveBuyerFormset</code> formset. </p>
			<ol>
				<li value="2">If you didn't <a id="_idIndexMarker842"/>already copy the JavaScript files when copying the <code>base_template_1.html</code> file earlier in preparation for a previous exercise, then go ahead and create the <code>/chapter_5/static/chapter_5/</code> and <code>/chapter_5/static/chapter_5/js/</code> folders and the <code>site-js.js</code> file using your IDE, File Explorer, or the following commands:<pre><strong class="bold">(virtual_env) PS &gt; mkdir becoming_a_django_entdev/chapter_5/static/chapter_5</strong>
<strong class="bold">(virtual_env) PS &gt; mkdir becoming_a_django_entdev/chapter_5/static/chapter_5/js</strong>
<strong class="bold">(virtual_env) PS &gt; cd becoming_a_django_entdev/chapter_5/static/chapter_5/js</strong>
<strong class="bold">(virtual_env) PS &gt; touch site-js.js</strong></pre></li>
				<li>Inside your <code>/chapter_5/js/site-js.js</code> file, include the following variables:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/static/chapter_5/js/site-js.js</strong>
let formsetContainer = document.querySelectorAll(
        '.formset-container'
    ),
    form = document.querySelector('#form'),
    addFormsetButton = document.querySelector(
        '#add-formset'
    ),
    totalForms = document.querySelector(
        '#id_form-TOTAL_FORMS'
    ),
    formsetNum = formsetContainer.length - 1;</pre></li>
				<li>Add the following <a id="_idIndexMarker843"/>event listener to that same JavaScript file:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/static/chapter_5/js/site-js.js</strong>
...
addFormsetButton.addEventListener(
    'click', 
    $addFormset
);</pre></li>
				<li>Add the following <a id="_idIndexMarker844"/>function to that same JavaScript file:<pre><strong class="bold"># /becoming_a_django_entdev/chapter_5/static/chapter_5/js/site-js.js</strong>
...
function $addFormset(e) {
    e.preventDefault();
    let newForm = formsetContainer[0].cloneNode(true),
        formRegex = RegExp(`form-(\\d){1}-`,'g');
    formsetNum++
    newForm.innerHTML = newForm.innerHTML.replace(
        formRegex, 
        'form-${formsetNum}-'
    );
    form.insertBefore(newForm, addFormsetButton);
    totalForms.setAttribute(
        'value', 
        '${formsetNum + 1}'
    );
}</pre></li>
			</ol>
			<p>What we are doing is adding an event listener that listens for the click event of the <code>&lt;div class="formset-container"&gt;&lt;/div&gt;</code> and insert that cloned <a id="_idIndexMarker845"/>node just before the <code>&lt;button id="add-formset"&gt;&lt;/button&gt;</code> node. Since Django also requires the precise management of form data, we need to be sure that we update the relevant data every time an inline formset is added or removed. This is why we are finding the number of inline formsets that exist before we perform the clone action as the <code>formsetNum</code> variable. Then, we increment this number, which starts at index 0, using a regular expression method to search all the inner HTML nodes of the node with the <code>formset-container</code> CSS class. That incremented number is used to update all node attributes to the proper index of the new node that we inserted. We also update the value of the form object with <code>id="id_form-TOTAL_FORMS"</code> to the new total of inline formsets that exist.</p>
			<p>If successful, when we click the <strong class="bold">Add Another Prospective Buyer</strong> button, we should see additional inline formsets added, just like the following:</p>
			<div><div><img src="img/Figure_5.8_B17243.jpg" alt="Figure 5.8 – VehicleForm adding another inline formset&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.8 – VehicleForm adding another inline formset</p>
			<h1 id="_idParaDest-168"><a id="_idTextAnchor189"/>Summary</h1>
			<p>By now, we have completed two major forms, one to act as the contact form and another to handle the vehicle object, created in <a href="B17243_03_ePub.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Models, Relations, and Inheritance</em>. We added a variety of fields and discussed the differences between those field types. Using the email example over and over again as we did, we witnessed how validation works in many different ways. Depending on the requirements gathered for a project, we can then decide on several different writing patterns to align with those requirements. For example, if we wanted to completely eliminate the need for JavaScript validation, such as using my favorite library jQuery Validate, we could just write clean methods in form classes to perform all of the validation on the backend. This would use the power of Django to serve up the error messages. However, if we did use JavaScript-based validation on the frontend, we could write fields that create the node attributes for us, such as the <code>&lt;input&gt;</code> field attribute of <code>required=""</code>, which would prevent a form from submitting if it had no value.</p>
			<p>No matter the requirements of a project, we also discovered a really easy way to create our own field classes. Custom field classes let us preformat fields that support a <strong class="bold">Don't Repeat Yourself</strong> (<strong class="bold">DRY</strong>) style of writing. We explored the differences in view classes, form classes, and field classes, and then discussed ways to render those forms in a template. </p>
			<p>In the next chapter, we will explore a user interface specifically tailored for the rapid development of forms that lets users update, create, and delete model objects on their own. This is called the Django admin site, which is basically a glorified way to render forms related to model management.</p>
		</div>
	</body></html>