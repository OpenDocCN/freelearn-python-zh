- en: '9'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Creating an API in AWS
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we are going to learn how to create an **application programming
    interface** (**API**) via **API Gateway**. API Gateway is an AWS service that
    allows you to create and maintain an API. With the API Gateway service, you don’t
    need to provision a server; AWS manages it in the backend. In addition to that,
    API Gateway helps you to monitor incoming and outgoing requests. Another advantage
    of API Gateway is to scale up your API services when there is a huge request from
    users.
  prefs: []
  type: TYPE_NORMAL
- en: 'The chapter covers the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: What is API Gateway?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating an API using API Gateway
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What is API Gateway?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**API Gateway** is an AWS service that is used to create, maintain, and publish
    an API. API Gateway supports multiple API protocols, such as **RESTful** (also
    known as the REST API) and **WebSocket**.'
  prefs: []
  type: TYPE_NORMAL
- en: 'API Gateway is a single point of entry for the backend services. As you can
    see in the following architecture, API Gateway gets a request from a client and
    integrates the incoming request with microservices, databases, AWS Lambda, or
    another AWS service:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/Figure_9.01_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.1 – Architecture of API Gateway
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have a good idea of what API Gateway is, let’s have a look at its
    features.
  prefs: []
  type: TYPE_NORMAL
- en: Features of API Gateway
  prefs: []
  type: TYPE_NORMAL
- en: 'The features of API Gateway are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: It supports different protocols, such as RESTful and WebSocket.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can monitor incoming and outgoing API requests, which enhances the visibility
    of the service.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can easily create and maintain the API. It can be created either in AWS
    Management Console or the AWS CLI.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Security is important for cloud services, as well as the API. You can create
    a key to enable secure access to the API. In addition to that, you can add an
    SSL certificate to verify the request.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It has built-in integration with AWS services. When you implement an API, you
    can easily integrate it with AWS services.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is a scalable service that adds more resources when you have more requests.
    For example, on Black Friday, there is more load on e-commerce websites. In these
    cases, API Gateway automatically scales your API requests. In this case, you can
    also define a **Cross-Origin Resource Sharing** (**CORS**) policy as a security
    feature that controls the HTTP request.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this section, we have looked at the basic features of API Gateway, and now
    we will start to implement sample API applications.
  prefs: []
  type: TYPE_NORMAL
- en: Creating an API using API Gateway
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We are going to create a simple API that accepts a request from a client. The
    API accepts two numbers, sums up two numbers in a Lambda function, and returns
    the calculated values. AWS Lambda is going to be implemented via Python. You can
    see the high-level flow in the following architecture:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/Figure_9.02_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.2 – Data flow
  prefs: []
  type: TYPE_NORMAL
- en: We are going to start with the Lambda function creation. After the Lambda function
    creation, API Gateway is going to be set up with Lambda integration.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s create the Lambda function step by step:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the console and navigate to the **AWS** **Lambda** page:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.03_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.3 – Lambda function
  prefs: []
  type: TYPE_NORMAL
- en: 'Create a new Lambda function. Let’s name it `SumUpLambda`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.04_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.4 – Creating a new Lambda function
  prefs: []
  type: TYPE_NORMAL
- en: 'Click **Create function** and wait a few seconds while the function is created:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.05_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.5 – Clicking Create function
  prefs: []
  type: TYPE_NORMAL
- en: 'A few seconds later, you will see the Lambda function has been created with
    the template code:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/Figure_9.06_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.6 – Lambda template
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s create a Lambda function that sums up two values:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: This code snippet takes two numbers as parameters, such as `Number1` and `Number2`.
    The Lambda function calculates the sum of two values and returns a status code
    and the value of the sum. When we call this function from the API, it returns
    the sum value as well as `statusCode`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s paste this code block into the Lambda function:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/Figure_9.07_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.7 – Actual Lambda code
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, let’s follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Click **Test**. A new panel opens in which Lambda asks for a test parameter:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.08_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.8 – Test event
  prefs: []
  type: TYPE_NORMAL
- en: 'As can be seen in the preceding figure, you can paste the following JSON to
    see whether the Lambda function is running properly before integrating with the
    API:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Click **Save**, which is under the **Event** **JSON** panel:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.09_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.9 – Clicking on the Save button
  prefs: []
  type: TYPE_NORMAL
- en: 'Deploy the changes by clicking **Deploy**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.10_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.10 – Deploying Lambda
  prefs: []
  type: TYPE_NORMAL
- en: After the Lambda deployment, we are going to integrate API Gateway with AWS
    Lambda. Lambda will be used as the backend for API Gateway.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s create an API step by step:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the console and search for `api gateway`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.11_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.11 – The console
  prefs: []
  type: TYPE_NORMAL
- en: 'On the main screen, select **REST API**, and click **Build**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.12_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.12 – REST API
  prefs: []
  type: TYPE_NORMAL
- en: 'You will now see a new screen to be filled out. We will select **New API**
    in the **Create new API** section. Other options in this section allow you to
    create an example API or import a predefined API. In the **Settings** section,
    we will add the **API name** and **Description** details. In the **Endpoint Type**
    drop-down list, we will select **Regional**, which is used to create an API that
    is accessible from the same region:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.13_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.13 – Form for API creation
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you click **Create API** (as depicted in the preceding figure), you will
    be taken to a new page that allows you to define the details for a custom SumUp
    API:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.14_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.14 – API form
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, we are going to define the API details. Click on the **Actions** dropdown
    and select **Create Method**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.15_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.15 – Create Method
  prefs: []
  type: TYPE_NORMAL
- en: 'When we create a method, we select **POST** as the API type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.16_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.16 – Selecting POST
  prefs: []
  type: TYPE_NORMAL
- en: 'While you implement an API, you can select API types. The following are the
    most used API types:'
  prefs: []
  type: TYPE_NORMAL
- en: '**GET** is used to retrieve data from a source.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SumUp` from Lambda.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**PUT** is used to update the data in a source.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**DELETE** is used to delete the data in a source.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'When you select **POST**, you need to choose the integration type. For this
    example, we are going to select the **Lambda Function** integration type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.17_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.17 – Setting up the integration type
  prefs: []
  type: TYPE_NORMAL
- en: 'Select the **SumUpLambda** function that is implemented, and click **Save**,
    which is not depicted in the following figure but is situated at the bottom of
    the page:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.18_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.18 – Selecting Lambda
  prefs: []
  type: TYPE_NORMAL
- en: 'When you click **Save**, it asks for confirmation to allow the required permissions.
    Click **OK** and it will create the permissions:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.19_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.19 – Permissions
  prefs: []
  type: TYPE_NORMAL
- en: 'After setting the permissions, you can see the data flow for the API:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/Figure_9.20_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.20 – The API flow
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, we need to add a CORS policy. CORS is a security policy that allows a
    particular origin (domain or port) to browse your resource. Let’s enable a CORS
    policy:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Click the **Actions** drop-down button to list the available actions, and then
    click **Enable CORS**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.21_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.21 – List of actions
  prefs: []
  type: TYPE_NORMAL
- en: 'Fill out the form and click **Enable CORS and replace existing CORS headers**.
    You can retain the form details as is. The form defines the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Which methods are allowed access to the API by selecting **Methods**
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Which request header is required via **Access-Control-Allow-Headers**
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Which origins are able to call the API via **Access-Control-Allow-Origin**
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Gateway response types by selecting the **DEFAULT 4XX** or **DEFAULT 5XX**
    port. You can see the list here: [https://docs.aws.amazon.com/apigateway/latest/developerguide/supported-gateway-response-types.xhtml](https://docs.aws.amazon.com/apigateway/latest/developerguide/supported-gateway-response-types.xhtml).'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.22_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.22 – Enable CORS
  prefs: []
  type: TYPE_NORMAL
- en: Congrats! You have successfully created the Lambda function and an API gateway.
    The next step is to test the API.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s test the SumUp API:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on the **Test** button in the flow:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.23_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.23 – Testing the API
  prefs: []
  type: TYPE_NORMAL
- en: 'Enter the following code in the **Request Body** field to add a parameter for
    Lambda:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Click **Test** and see the results:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/Figure_9.24_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.24 – Adding a parameter
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are the results:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/Figure_9.25_B19195.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9.25 – The result of the API response
  prefs: []
  type: TYPE_NORMAL
- en: When you check the logs, you can see the results of the API response. As you
    can see, the sum of the values is `25`.
  prefs: []
  type: TYPE_NORMAL
- en: In this topic, we implemented an API that used Python in the Lambda code. As
    you saw, creating an API is an easy solution in AWS. This way, you can focus on
    the backend implementation instead of focusing on the infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we learned how to use the AWS API Gateway service and how to
    create an API gateway that has a backend service with Python Lambda. API Gateway
    is useful when you need to implement an API service with backend support via Python.
    It comes with scalability, logging, and monitoring advantages. In the next chapter,
    we will take a look at the basics of DynamoDB and NoSQL.
  prefs: []
  type: TYPE_NORMAL
