<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer265">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 class="chapterTitle" id="_idParaDest-225"><span class="koboSpan" id="kobo.2.1">Building an Online Shop</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, you created a follow system and built a user activity stream. </span><span class="koboSpan" id="kobo.3.2">You also learned how Django signals work and integrated Redis into your project to count image views.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will start a new Django project that consists of a fully featured online shop. </span><span class="koboSpan" id="kobo.4.2">This chapter and the following two chapters will show you how to build the essential functionalities of an e-commerce platform. </span><span class="koboSpan" id="kobo.4.3">Your online shop will enable clients to browse products, add them to the cart, apply discount codes, go through the checkout process, pay with a credit card, and obtain an invoice. </span><span class="koboSpan" id="kobo.4.4">You will also implement a recommendation engine to recommend products to your customers, and you will use internationalization to offer your site in multiple languages.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">In this chapter, you will learn how to:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Create a product catalog</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Build a shopping cart using Django sessions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Create custom template context processors</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Manage customer orders</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Configure Celery in your project with RabbitMQ as a message broker</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Send asynchronous notifications to customers using Celery</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Monitor Celery using Flower</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-226"><span class="koboSpan" id="kobo.13.1">Functional overview</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.14.1">Figure 8.1</span></em><span class="koboSpan" id="kobo.15.1"> shows a representation of the views, templates, and main functionalities that will be built in this chapter:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.16.1"><img alt="" role="presentation" src="../Images/B21088_08_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.17.1">Figure 8.1: Diagram of functionalities built in Chapter 8</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">In this chapter, you will implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.19.1">product_list</span></code><span class="koboSpan" id="kobo.20.1"> view to list all products and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.21.1">product_detail</span></code><span class="koboSpan" id="kobo.22.1"> view to display a single product. </span><span class="koboSpan" id="kobo.22.2">You will allow filtering products by category in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">product_list</span></code><span class="koboSpan" id="kobo.24.1"> view using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">category_slug</span></code><span class="koboSpan" id="kobo.26.1"> parameter. </span><span class="koboSpan" id="kobo.26.2">You will implement a shopping cart using sessions and you will build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.27.1">cart_detail</span></code><span class="koboSpan" id="kobo.28.1"> view to display the cart items. </span><span class="koboSpan" id="kobo.28.2">You will create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.29.1">cart_add</span></code><span class="koboSpan" id="kobo.30.1"> view to add products to the cart and update quantities, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.31.1">cart_remove</span></code><span class="koboSpan" id="kobo.32.1"> view to remove products from the cart. </span><span class="koboSpan" id="kobo.32.2">You will implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">cart</span></code><span class="koboSpan" id="kobo.34.1"> template context processor to display the number of cart items and total cost on the site header. </span><span class="koboSpan" id="kobo.34.2">You will also create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.35.1">order_create</span></code><span class="koboSpan" id="kobo.36.1"> view to place orders, and you will use Celery to implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.37.1">order_created</span></code><span class="koboSpan" id="kobo.38.1"> asynchronous task that sends out an email confirmation to clients when they place an order. </span><span class="koboSpan" id="kobo.38.2">This chapter will provide you with the knowledge to implement user sessions in your application and show you how to work with asynchronous tasks. </span><span class="koboSpan" id="kobo.38.3">Both are very common use cases that you can apply to almost any project.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.39.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter08"><span class="url"><span class="koboSpan" id="kobo.40.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter08</span></span></a><span class="koboSpan" id="kobo.41.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.42.1">All Python modules used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">requirements.txt</span></code><span class="koboSpan" id="kobo.44.1"> file in the source code that comes along with this chapter. </span><span class="koboSpan" id="kobo.44.2">You can follow the instructions to install each Python module below or you can install all requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.45.1">python</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.46.1">-m</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.47.1">pip</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.48.1">install</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.49.1">-r</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.50.1">requirements.txt</span></code><span class="koboSpan" id="kobo.51.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-227"><span class="koboSpan" id="kobo.52.1">Creating an online shop project</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.53.1">Letâ€™s start with a new Django project to build an online shop. </span><span class="koboSpan" id="kobo.53.2">Your users will be able to browse through a product catalog and add products to a shopping cart. </span><span class="koboSpan" id="kobo.53.3">Finally, they will be able to check out the </span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.54.1">cart and place an order. </span><span class="koboSpan" id="kobo.54.2">This chapter will cover the following functionalities of an online shop:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.55.1">Creating the product catalog models, adding them to the administration site, and building the basic views to display the catalog</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.56.1">Building a shopping cart system using Django sessions to allow users to keep selected products while they browse the site</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.57.1">Creating the form and functionality to place orders on the site</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.58.1">Sending an asynchronous email confirmation to users when they place an order</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.59.1">Open a shell and use the following command to create a new virtual environment for this project within the </span><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">env/</span></code><span class="koboSpan" id="kobo.61.1"> directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.62.1">python -m venv env/myshop
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.63.1">If you are using Linux or macOS, run the following command to activate your virtual environment:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.64.1">source env/myshop/bin/activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.65.1">If you are using Windows, use the following command instead:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.66.1">.\env\myshop\Scripts\activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.67.1">The shell prompt will display your active virtual environment, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.68.1">(myshop)laptop:~ zenx$
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.69.1">Install Django in your virtual environment with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.70.1">python -m pip install Django~=5.0.4
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.71.1">Start a new project called </span><code class="inlineCode"><span class="koboSpan" id="kobo.72.1">myshop</span></code><span class="koboSpan" id="kobo.73.1"> with an application called </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">shop</span></code><span class="koboSpan" id="kobo.75.1"> by opening a shell and running the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.76.1">django-admin startproject myshop
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.77.1">The initial project structure</span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.78.1"> has been created. </span><span class="koboSpan" id="kobo.78.2">Use the following commands to get into your project directory and create a new application named </span><code class="inlineCode"><span class="koboSpan" id="kobo.79.1">shop</span></code><span class="koboSpan" id="kobo.80.1">:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.81.1">cd myshop/
django-admin startapp shop
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.82.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.83.1">settings.py</span></code><span class="koboSpan" id="kobo.84.1"> and add the following line highlighted in bold to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.86.1"> list:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.87.1">INSTALLED_APPS = [
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.88.1">'django.contrib.admin'</span></span><span class="koboSpan" id="kobo.89.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.90.1">'django.contrib.auth'</span></span><span class="koboSpan" id="kobo.91.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.92.1">'django.contrib.contenttypes'</span></span><span class="koboSpan" id="kobo.93.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.94.1">'django.contrib.sessions'</span></span><span class="koboSpan" id="kobo.95.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.96.1">'django.contrib.messages'</span></span><span class="koboSpan" id="kobo.97.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.98.1">'django.contrib.staticfiles'</span></span><span class="koboSpan" id="kobo.99.1">,
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.100.1">'shop.apps.ShopConfig'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.101.1">,</span></strong></span><span class="koboSpan" id="kobo.102.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.103.1">Your application is now active for this project. </span><span class="koboSpan" id="kobo.103.2">Letâ€™s define the models for the product catalog.</span></p>
<h2 class="heading-2" id="_idParaDest-228"><span class="koboSpan" id="kobo.104.1">Creating product catalog models</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.105.1">The catalog of your shop will consist </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.106.1">of products that are organized into different categories. </span><span class="koboSpan" id="kobo.106.2">Each product will have a name, an optional description, an optional image, a price, and its availability.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.107.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.108.1">models.py</span></code><span class="koboSpan" id="kobo.109.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.110.1">shop</span></code><span class="koboSpan" id="kobo.111.1"> application that you just created and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.112.1">from</span></span><span class="koboSpan" id="kobo.113.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.114.1">import</span></span><span class="koboSpan" id="kobo.115.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.116.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.117.1">Category</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.118.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.119.1">    name = models.CharField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.120.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.121.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.122.1">    slug = models.SlugField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.123.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.124.1">, unique=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.125.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.126.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.127.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.128.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.129.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.130.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.131.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.132.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.133.1">        indexes = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.134.1">            models.Index(fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.135.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.136.1">]),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.137.1">        ]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.138.1">        verbose_name = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.139.1">'category'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.140.1">        verbose_name_plural = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.141.1">'categories'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.142.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.143.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.144.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.145.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.146.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.147.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.148.1"> self.name</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.149.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.150.1">Product</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.151.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.152.1">    category = models.ForeignKey(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.153.1">        Category,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.154.1">        related_name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.155.1">'products'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.156.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.157.1">        on_delete=models.CASCADE</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.158.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.159.1">    name = models.CharField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.160.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.161.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.162.1">    slug = models.SlugField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.163.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.164.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.165.1">    image = models.ImageField(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.166.1">        upload_to=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.167.1">'products/%Y/%m/%d'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.168.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.169.1">        blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.170.1">True</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.171.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.172.1">    description = models.TextField(blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.173.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.174.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.175.1">    price = models.DecimalField(max_digits=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.176.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.177.1">, decimal_places=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.178.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.179.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.180.1">    available = models.BooleanField(default=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.181.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.182.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.183.1">    created = models.DateTimeField(auto_now_add=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.184.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.185.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.186.1">    updated = models.DateTimeField(auto_now=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.187.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.188.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.189.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.190.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.191.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.192.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.193.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.194.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.195.1">        indexes = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.196.1">            models.Index(fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.197.1">'id'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.198.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.199.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.200.1">]),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.201.1">            models.Index(fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.202.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.203.1">]),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.204.1">            models.Index(fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.205.1">'-created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.206.1">]),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.207.1">        ]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.208.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.209.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.210.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.211.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.212.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.213.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.214.1"> self.name</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.215.1">These are the </span><code class="inlineCode"><span class="koboSpan" id="kobo.216.1">Category</span></code><span class="koboSpan" id="kobo.217.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.218.1">Product</span></code><span class="koboSpan" id="kobo.219.1"> models. </span><span class="koboSpan" id="kobo.219.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.220.1">Category</span></code><span class="koboSpan" id="kobo.221.1"> model consists of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.222.1">name</span></code><span class="koboSpan" id="kobo.223.1"> field and a unique </span><code class="inlineCode"><span class="koboSpan" id="kobo.224.1">slug</span></code><span class="koboSpan" id="kobo.225.1"> field (</span><code class="inlineCode"><span class="koboSpan" id="kobo.226.1">unique</span></code><span class="koboSpan" id="kobo.227.1"> implies the creation of an index). </span><span class="koboSpan" id="kobo.227.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">Meta</span></code><span class="koboSpan" id="kobo.229.1"> class of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.230.1">Category</span></code><span class="koboSpan" id="kobo.231.1"> model, we</span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.232.1"> have defined an index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">name</span></code><span class="koboSpan" id="kobo.234.1"> field.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.235.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.236.1">Product</span></code><span class="koboSpan" id="kobo.237.1"> model fields are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.238.1">category</span></code><span class="koboSpan" id="kobo.239.1">: A </span><code class="inlineCode"><span class="koboSpan" id="kobo.240.1">ForeignKey</span></code><span class="koboSpan" id="kobo.241.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.242.1">Category</span></code><span class="koboSpan" id="kobo.243.1"> model. </span><span class="koboSpan" id="kobo.243.2">This is a one-to-many relationship: a product belongs to one category and a category contains multiple products.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.244.1">name</span></code><span class="koboSpan" id="kobo.245.1">: The name of the product.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.246.1">slug</span></code><span class="koboSpan" id="kobo.247.1">: The slug for this product to build beautiful URLs.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.248.1">image</span></code><span class="koboSpan" id="kobo.249.1">: An optional product image.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.250.1">description</span></code><span class="koboSpan" id="kobo.251.1">: An optional description of the product.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">price</span></code><span class="koboSpan" id="kobo.253.1">: This field uses Pythonâ€™s </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">decimal.Decimal</span></code><span class="koboSpan" id="kobo.255.1"> type to store a fixed-precision decimal number. </span><span class="koboSpan" id="kobo.255.2">The maximum number of digits (including the decimal places) is set using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">max_digits</span></code><span class="koboSpan" id="kobo.257.1"> attribute and decimal places with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">decimal_places</span></code><span class="koboSpan" id="kobo.259.1"> attribute.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">available</span></code><span class="koboSpan" id="kobo.261.1">: A Boolean value that indicates whether the product is available or not. </span><span class="koboSpan" id="kobo.261.2">It will be used to enable/disable the product in the catalog.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">created</span></code><span class="koboSpan" id="kobo.263.1">: This field stores when the object was created.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.264.1">updated</span></code><span class="koboSpan" id="kobo.265.1">: This field stores when the object was last updated.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.266.1">For the </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">price</span></code><span class="koboSpan" id="kobo.268.1"> field, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.269.1">DecimalField</span></code><span class="koboSpan" id="kobo.270.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.271.1">FloatField</span></code><span class="koboSpan" id="kobo.272.1"> to avoid rounding issues.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.273.1">Always use </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">DecimalField</span></code><span class="koboSpan" id="kobo.275.1"> to store monetary amounts. </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">FloatField</span></code><span class="koboSpan" id="kobo.277.1"> uses Pythonâ€™s </span><code class="inlineCode"><span class="koboSpan" id="kobo.278.1">float</span></code><span class="koboSpan" id="kobo.279.1"> type internally, whereas </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">DecimalField</span></code><span class="koboSpan" id="kobo.281.1"> uses Pythonâ€™s </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">Decimal</span></code><span class="koboSpan" id="kobo.283.1"> type. </span><span class="koboSpan" id="kobo.283.2">By using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.284.1">Decimal</span></code><span class="koboSpan" id="kobo.285.1"> type, you will avoid </span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">float</span></code><span class="koboSpan" id="kobo.287.1"> rounding issues.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.288.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.289.1">Meta</span></code><span class="koboSpan" id="kobo.290.1"> class of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.291.1">Product</span></code><span class="koboSpan" id="kobo.292.1"> model, we have defined a multiple-field index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">id</span></code><span class="koboSpan" id="kobo.294.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.295.1">slug</span></code><span class="koboSpan" id="kobo.296.1"> fields. </span><span class="koboSpan" id="kobo.296.2">Both fields are indexed together to improve performance for queries that utilize the two fields.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.297.1">We plan to query products</span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.298.1"> by both </span><code class="inlineCode"><span class="koboSpan" id="kobo.299.1">id</span></code><span class="koboSpan" id="kobo.300.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.301.1">slug</span></code><span class="koboSpan" id="kobo.302.1">. </span><span class="koboSpan" id="kobo.302.2">We have added an index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.303.1">name</span></code><span class="koboSpan" id="kobo.304.1"> field and an index for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.305.1">created</span></code><span class="koboSpan" id="kobo.306.1"> field. </span><span class="koboSpan" id="kobo.306.2">We have used a hyphen before the field name to define the index in descending order.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.307.1">Figure 8.2</span></em><span class="koboSpan" id="kobo.308.1"> shows the two data models you have created:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.309.1"><img alt="Diagram  Description automatically generated" src="../Images/B21088_08_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.310.1">Figure 8.2: Models for the product catalog</span></p>
<p class="normal"><span class="koboSpan" id="kobo.311.1">In </span><em class="italic"><span class="koboSpan" id="kobo.312.1">Figure 8.2</span></em><span class="koboSpan" id="kobo.313.1">, you can see the different fields of the data models and the one-to-many relationship between the </span><code class="inlineCode"><span class="koboSpan" id="kobo.314.1">Category</span></code><span class="koboSpan" id="kobo.315.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.316.1">Product</span></code><span class="koboSpan" id="kobo.317.1"> models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.318.1">These models will result in the following database tables displayed in </span><em class="italic"><span class="koboSpan" id="kobo.319.1">Figure 8.3</span></em><span class="koboSpan" id="kobo.320.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.321.1"><img alt="A picture containing diagram  Description automatically generated" src="../Images/B21088_08_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.322.1">Figure 8.3: Database tables for the product catalog models</span></p>
<p class="normal"><span class="koboSpan" id="kobo.323.1">The one-to-many relationship between both tables is defined with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.324.1">category_id</span></code><span class="koboSpan" id="kobo.325.1"> field in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.326.1">shop_product</span></code><span class="koboSpan" id="kobo.327.1"> table, which is </span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.328.1">used to store the ID of the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.329.1">Category</span></code><span class="koboSpan" id="kobo.330.1"> for each </span><code class="inlineCode"><span class="koboSpan" id="kobo.331.1">Product</span></code><span class="koboSpan" id="kobo.332.1"> object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.333.1">Letâ€™s create the initial database migrations for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.334.1">shop</span></code><span class="koboSpan" id="kobo.335.1"> application. </span><span class="koboSpan" id="kobo.335.2">Since you are going to deal with images in your models, you will need to install the Pillow library. </span><span class="koboSpan" id="kobo.335.3">Remember that in </span><em class="italic"><span class="koboSpan" id="kobo.336.1">Chapter 4</span></em><span class="koboSpan" id="kobo.337.1">, </span><em class="italic"><span class="koboSpan" id="kobo.338.1">Building a Social Website</span></em><span class="koboSpan" id="kobo.339.1">, you learned how to install the Pillow library to manage images. </span><span class="koboSpan" id="kobo.339.2">Open the shell and install </span><code class="inlineCode"><span class="koboSpan" id="kobo.340.1">Pillow</span></code><span class="koboSpan" id="kobo.341.1"> with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.342.1">python -m pip install Pillow==10.3.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.343.1">Now run the next command to create initial migrations for your project:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.344.1">python manage.py makemigrations
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.345.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.346.1">Migrations for 'shop':
  shop/migrations/0001_initial.py
    - Create model Category
    - Create model Product
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.347.1">Run the next command to sync the database:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.348.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.349.1">You will see output that includes the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.350.1">Applying shop.0001_initial... </span><span class="koboSpan" id="kobo.350.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.351.1">The database is now</span><a id="_idIndexMarker729"/><span class="koboSpan" id="kobo.352.1"> synced with your models.</span></p>
<h2 class="heading-2" id="_idParaDest-229"><span class="koboSpan" id="kobo.353.1">Registering catalog models on the administration site</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.354.1">Letâ€™s add your models to the</span><a id="_idIndexMarker730"/><span class="koboSpan" id="kobo.355.1"> administration site so that you can easily manage categories and products. </span><span class="koboSpan" id="kobo.355.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1">admin.py</span></code><span class="koboSpan" id="kobo.357.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.358.1">shop</span></code><span class="koboSpan" id="kobo.359.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.360.1">from</span></span><span class="koboSpan" id="kobo.361.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.362.1">import</span></span><span class="koboSpan" id="kobo.363.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.364.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.365.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.366.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.367.1"> Category, Product</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.368.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.369.1">Category</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.370.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.371.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.372.1">CategoryAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.373.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.374.1">    list_display = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.375.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.376.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.377.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.378.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.379.1">    prepopulated_fields = {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.380.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.381.1">slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.382.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.383.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.384.1">,)}</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.385.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.386.1">Product</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.387.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.388.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.389.1">ProductAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.390.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.391.1">    list_display = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.392.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.393.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.394.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.395.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.396.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.397.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.398.1">'available'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.399.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.400.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.401.1">created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.402.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.403.1">'updated'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.404.1">    ]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.405.1">    list_filter = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.406.1">'available'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.407.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.408.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.409.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.410.1">'updated'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.411.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.412.1">    list_editable = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.413.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.414.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.415.1">'available'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.416.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.417.1">    prepopulated_fields = {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.418.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.419.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.420.1">'name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.421.1">,)}</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.422.1">Remember that you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.423.1">prepopulated_fields</span></code><span class="koboSpan" id="kobo.424.1"> attribute to specify fields where the value is automatically set using the value of other fields. </span><span class="koboSpan" id="kobo.424.2">As you have seen before, this is convenient for generating slugs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.425.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.426.1">list_editable</span></code><span class="koboSpan" id="kobo.427.1"> attribute in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.428.1">ProductAdmin</span></code><span class="koboSpan" id="kobo.429.1"> class to set the fields that can be edited from the list display page of the administration site. </span><span class="koboSpan" id="kobo.429.2">This will allow you to edit multiple rows at once. </span><span class="koboSpan" id="kobo.429.3">Any field in </span><code class="inlineCode"><span class="koboSpan" id="kobo.430.1">list_editable</span></code><span class="koboSpan" id="kobo.431.1"> must also be listed in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">list_display</span></code><span class="koboSpan" id="kobo.433.1"> attribute since </span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.434.1">only the fields displayed can be edited.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.435.1">Now create a superuser for your site using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.436.1">python manage.py createsuperuser
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.437.1">Enter the desired username, email, and password. </span><span class="koboSpan" id="kobo.437.2">Run the development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.438.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.439.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">http://127.0.0.1:8000/admin/shop/product/add/</span></code><span class="koboSpan" id="kobo.441.1"> in your browser and log in with the user that you just created. </span><span class="koboSpan" id="kobo.441.2">Add a new category and product using the administration interface. </span><span class="koboSpan" id="kobo.441.3">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.442.1">Add product</span></strong><span class="koboSpan" id="kobo.443.1"> form should look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.444.1"><img alt="" role="presentation" src="../Images/B21088_08_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.445.1">Figure 8.4: The product creation form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.446.1">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.447.1">SAVE</span></strong><span class="koboSpan" id="kobo.448.1"> button. </span><span class="koboSpan" id="kobo.448.2">The</span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.449.1"> product change list page of the administration page will then look like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.450.1"><img alt="" role="presentation" src="../Images/B21088_08_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.451.1">Figure 8.5: The product change list page</span></p>
<h2 class="heading-2" id="_idParaDest-230"><span class="koboSpan" id="kobo.452.1">Building catalog views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.453.1">In order to display the product catalog, you </span><a id="_idIndexMarker733"/><span class="koboSpan" id="kobo.454.1">need to create a view to list all the products or filter products by a given category. </span><span class="koboSpan" id="kobo.454.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.455.1">views.py</span></code><span class="koboSpan" id="kobo.456.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.457.1">shop</span></code><span class="koboSpan" id="kobo.458.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.459.1">from</span></span><span class="koboSpan" id="kobo.460.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.461.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.462.1">get_object_or_404, </span></strong></span><span class="koboSpan" id="kobo.463.1">render
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.464.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.465.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.466.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.467.1"> Category, Product</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.468.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.469.1">product_list</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.470.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.471.1">request, category_slug=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.472.1">None</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.473.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.474.1">    category = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.475.1">None</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.476.1">    categories = Category.objects.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.477.1">all</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.478.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.479.1">    products = Product.objects.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.480.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.481.1">(available=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.482.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.483.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.484.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.485.1"> category_slug:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.486.1">        category = get_object_or_404(Category, </span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.487.1">slug=category_slug)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.488.1">        products = products.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.489.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.490.1">(category=category)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.491.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.492.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.493.1">request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.494.1">'shop/product/list.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.495.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.496.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.497.1">'category'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.498.1">: category,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.499.1">'categories'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.500.1">: categories,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.501.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.502.1">products'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.503.1">: products</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.504.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.505.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.506.1">In the preceding code, you filter the </span><code class="inlineCode"><span class="koboSpan" id="kobo.507.1">QuerySet</span></code><span class="koboSpan" id="kobo.508.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.509.1">available=True</span></code><span class="koboSpan" id="kobo.510.1"> to retrieve only available products. </span><span class="koboSpan" id="kobo.510.2">You</span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.511.1"> use an optional </span><code class="inlineCode"><span class="koboSpan" id="kobo.512.1">category_slug</span></code><span class="koboSpan" id="kobo.513.1"> parameter to optionally filter products by a given category.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.514.1">You also need a view to retrieve and display a single product. </span><span class="koboSpan" id="kobo.514.2">Add the following view to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.515.1">views.py</span></code><span class="koboSpan" id="kobo.516.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.517.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.518.1">product_detail</span></span><span class="koboSpan" id="kobo.519.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.520.1">request, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.521.1">id</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.522.1">, slug</span></span><span class="koboSpan" id="kobo.523.1">):
    product = get_object_or_404(
        Product, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.524.1">id</span></span><span class="koboSpan" id="kobo.525.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.526.1">id</span></span><span class="koboSpan" id="kobo.527.1">, slug=slug, available=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.528.1">True</span></span>
<span class="hljs-literal"> </span><span class="koboSpan" id="kobo.529.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.530.1">return</span></span><span class="koboSpan" id="kobo.531.1"> render(
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.532.1">request,
</span><span class="hljs-keyword"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.533.1">shop/product/detail.html'</span></span><span class="koboSpan" id="kobo.534.1">,
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.535.1">{</span><span class="hljs-string"><span class="koboSpan" id="kobo.536.1">'product'</span></span><span class="koboSpan" id="kobo.537.1">: product}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.538.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.539.1">product_detail</span></code><span class="koboSpan" id="kobo.540.1"> view expects the </span><code class="inlineCode"><span class="koboSpan" id="kobo.541.1">id</span></code><span class="koboSpan" id="kobo.542.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.543.1">slug</span></code><span class="koboSpan" id="kobo.544.1"> parameters in order to retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">Product</span></code><span class="koboSpan" id="kobo.546.1"> instance. </span><span class="koboSpan" id="kobo.546.2">You can get this instance just through the ID since itâ€™s a unique attribute. </span><span class="koboSpan" id="kobo.546.3">However, you include the slug in the URL to build SEO-friendly URLs for products.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.547.1">After building the product list and detail views, you have to define URL patterns for them. </span><span class="koboSpan" id="kobo.547.2">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.548.1">shop</span></code><span class="koboSpan" id="kobo.549.1"> application directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.550.1">urls.py</span></code><span class="koboSpan" id="kobo.551.1">. </span><span class="koboSpan" id="kobo.551.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.552.1">from</span></span><span class="koboSpan" id="kobo.553.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.554.1">import</span></span><span class="koboSpan" id="kobo.555.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1">from</span></span><span class="koboSpan" id="kobo.557.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.558.1">import</span></span><span class="koboSpan" id="kobo.559.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.560.1">'shop'</span></span><span class="koboSpan" id="kobo.561.1">
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.562.1">''</span></span><span class="koboSpan" id="kobo.563.1">, views.product_list, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.564.1">'product_list'</span></span><span class="koboSpan" id="kobo.565.1">),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.566.1">'&lt;slug:category_slug&gt;/'</span></span><span class="koboSpan" id="kobo.567.1">,
        views.product_list,
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.568.1">'product_list_by_category'</span></span><span class="koboSpan" id="kobo.569.1">
    ),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.570.1">'&lt;int:id&gt;/&lt;slug:slug&gt;/'</span></span><span class="koboSpan" id="kobo.571.1">,
        views.product_detail,
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.572.1">'product_detail'</span></span><span class="koboSpan" id="kobo.573.1">
    ),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.574.1">These are the URL patterns for your product catalog. </span><span class="koboSpan" id="kobo.574.2">You have defined two different URL patterns for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.575.1">product_list</span></code><span class="koboSpan" id="kobo.576.1"> view: a pattern named </span><code class="inlineCode"><span class="koboSpan" id="kobo.577.1">product_list</span></code><span class="koboSpan" id="kobo.578.1">, which calls the </span><code class="inlineCode"><span class="koboSpan" id="kobo.579.1">product_list</span></code><span class="koboSpan" id="kobo.580.1"> view without any parameters, and a pattern named </span><code class="inlineCode"><span class="koboSpan" id="kobo.581.1">product_list_by_category</span></code><span class="koboSpan" id="kobo.582.1">, which provides a </span><code class="inlineCode"><span class="koboSpan" id="kobo.583.1">category_slug</span></code><span class="koboSpan" id="kobo.584.1"> parameter to the view for filtering products according to a given category. </span><span class="koboSpan" id="kobo.584.2">You added a pattern for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1">product_detail</span></code><span class="koboSpan" id="kobo.586.1"> view, which </span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.587.1">passes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.588.1">id</span></code><span class="koboSpan" id="kobo.589.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.590.1">slug</span></code><span class="koboSpan" id="kobo.591.1"> parameters to the view in order to retrieve a specific product.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.592.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">urls.py</span></code><span class="koboSpan" id="kobo.594.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">myshop</span></code><span class="koboSpan" id="kobo.596.1"> project to make it look like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.597.1">from</span></span><span class="koboSpan" id="kobo.598.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.599.1">import</span></span><span class="koboSpan" id="kobo.600.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.601.1">from</span></span><span class="koboSpan" id="kobo.602.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.603.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.604.1">include, </span></strong></span><span class="koboSpan" id="kobo.605.1">path
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.606.1">'admin/'</span></span><span class="koboSpan" id="kobo.607.1">, admin.site.urls),
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.608.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.609.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.610.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.611.1">'shop.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.612.1">, namespace=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.613.1">'shop'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.614.1">)),</span></strong></span><span class="koboSpan" id="kobo.615.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.616.1">In the main URL patterns of the project, you include URLs for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.617.1">shop</span></code><span class="koboSpan" id="kobo.618.1"> application under a custom namespace named </span><code class="inlineCode"><span class="koboSpan" id="kobo.619.1">shop</span></code><span class="koboSpan" id="kobo.620.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.621.1">Next, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.622.1">models.py</span></code><span class="koboSpan" id="kobo.623.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.624.1">shop</span></code><span class="koboSpan" id="kobo.625.1"> application, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.626.1">reverse()</span></code><span class="koboSpan" id="kobo.627.1"> function, and add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.628.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.629.1"> method</span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.630.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.631.1">Category</span></code><span class="koboSpan" id="kobo.632.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.633.1">Product</span></code><span class="koboSpan" id="kobo.634.1"> models, as follows. </span><span class="koboSpan" id="kobo.634.2">The new code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.635.1">from</span></span><span class="koboSpan" id="kobo.636.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.637.1">import</span></span><span class="koboSpan" id="kobo.638.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.639.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.640.1"> django.urls </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.641.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.642.1"> reverse</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.643.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.644.1">Category</span></span><span class="koboSpan" id="kobo.645.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.646.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.647.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.648.1">get_absolute_url</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.649.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.650.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.651.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.652.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.653.1"> reverse(</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.654.1">'shop:product_list_by_category'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.655.1">, args=[self.slug]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.656.1">        )</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.657.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.658.1">Product</span></span><span class="koboSpan" id="kobo.659.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.660.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.661.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.662.1">get_absolute_url</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.663.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.664.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.665.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.666.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.667.1"> reverse(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.668.1">'shop:product_detail'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.669.1">, args=[self.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.670.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.671.1">, self.slug])</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.672.1">As you already know, </span><code class="inlineCode"><span class="koboSpan" id="kobo.673.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.674.1"> is the convention to retrieve the URL for a given object. </span><span class="koboSpan" id="kobo.674.2">Here, you use the URL patterns that you just defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.675.1">urls.py</span></code><span class="koboSpan" id="kobo.676.1"> file.</span></p>
<h2 class="heading-2" id="_idParaDest-231"><span class="koboSpan" id="kobo.677.1">Creating catalog templates</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.678.1">Now you need to create</span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.679.1"> templates for the product list and detail views. </span><span class="koboSpan" id="kobo.679.2">Create the following directory and file structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.680.1">shop</span></code><span class="koboSpan" id="kobo.681.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.682.1">templates/
    shop/
        base.html
        product/
            list.html
            detail.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.683.1">You need to define a base template and then extend it in the product list and detail templates. </span><span class="koboSpan" id="kobo.683.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.684.1">shop/base.html</span></code><span class="koboSpan" id="kobo.685.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.686.1">{% load static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.687.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.688.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.689.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.690.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.691.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.692.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.693.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.694.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.695.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.696.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.697.1">meta</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.698.1">charset</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.699.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.700.1">"utf-8"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.701.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.702.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.703.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.704.1">&gt;</span></span><span class="koboSpan" id="kobo.705.1">{% block title %}My shop{% endblock %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.706.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.707.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.708.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.709.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.710.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.711.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.712.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.713.1">"{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.714.1">css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.715.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.716.1">base.css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.717.1">" %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.718.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.719.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.720.1">"stylesheet"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.721.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.722.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.723.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.724.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.725.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.726.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.727.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.728.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.729.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.730.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.731.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.732.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.733.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.734.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.735.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.736.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.737.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.738.1">"/"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.739.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.740.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.741.1">"logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.742.1">&gt;</span></span><span class="koboSpan" id="kobo.743.1">My shop</span><span class="hljs-tag"><span class="koboSpan" id="kobo.744.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.745.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.746.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.747.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.748.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.749.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.750.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.751.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.752.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.753.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.754.1">"subheader"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.755.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.756.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.757.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.758.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.759.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.760.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.761.1">&gt;</span></span><span class="koboSpan" id="kobo.762.1">
        Your cart is empty.
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.763.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.764.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.765.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.766.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.767.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.768.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.769.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.770.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.771.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.772.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.773.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.774.1">&gt;</span></span><span class="koboSpan" id="kobo.775.1">
      {% block content %}
      {% endblock %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.776.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.777.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.778.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.779.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.780.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.781.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.782.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.783.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.784.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.785.1">This is the base template that you will use for your shop. </span><span class="koboSpan" id="kobo.785.2">In order to include the CSS styles and images that are used by the templates, you need to copy the static files that accompany this chapter, which are </span><a id="_idIndexMarker738"/><span class="koboSpan" id="kobo.786.1">located in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.787.1">static/</span></code><span class="koboSpan" id="kobo.788.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.789.1">shop</span></code><span class="koboSpan" id="kobo.790.1"> application. </span><span class="koboSpan" id="kobo.790.2">Copy them to the same location in your project. </span><span class="koboSpan" id="kobo.790.3">You can find the contents of the directory at </span><a href="https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter08/myshop/shop/static"><span class="url"><span class="koboSpan" id="kobo.791.1">https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter08/myshop/shop/static</span></span></a><span class="koboSpan" id="kobo.792.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.793.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.794.1">shop/product/list.html</span></code><span class="koboSpan" id="kobo.795.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.796.1">{% extends "shop/base.html" %}
{% load static %}
{% block title %}
  {% if category %}{{ category.name }}{% else %}Products{% endif %}
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.797.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.798.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.799.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.800.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.801.1">"sidebar"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.802.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.803.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.804.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.805.1">&gt;</span></span><span class="koboSpan" id="kobo.806.1">Categories</span><span class="hljs-tag"><span class="koboSpan" id="kobo.807.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.808.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.809.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.810.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.811.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.812.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.813.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.814.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.815.1"> {% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.816.1">if</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.817.1">not</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.818.1">category</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.819.1"> %}</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.820.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.821.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.822.1">"selected"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.823.1">{% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.824.1">endif</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.825.1"> %}&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.826.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.827.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.828.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.829.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.830.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.831.1">shop:product_list</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.832.1">" %}"&gt;</span></span><span class="koboSpan" id="kobo.833.1">All</span><span class="hljs-tag"><span class="koboSpan" id="kobo.834.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.835.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.836.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.837.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.838.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.839.1">&gt;</span></span><span class="koboSpan" id="kobo.840.1">
      {% for c in categories %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.841.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.842.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.843.1"> {% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.844.1">if</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.845.1">category.slug</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.846.1"> == </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.847.1">c.slug</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.848.1"> %}</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.849.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.850.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.851.1">"selected"</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.852.1">        {% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.853.1">endif</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.854.1"> %}&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.855.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.856.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.857.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.858.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.859.1">"{{ c.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.860.1">&gt;</span></span><span class="koboSpan" id="kobo.861.1">{{ c.name }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.862.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.863.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.864.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.865.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.866.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.867.1">&gt;</span></span><span class="koboSpan" id="kobo.868.1">
      {% endfor %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.869.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.870.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.871.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.872.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.873.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.874.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.875.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.876.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.877.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.878.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.879.1">"main"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.880.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.881.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.882.1">"product-list"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.883.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.884.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.885.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.886.1">&gt;</span></span><span class="koboSpan" id="kobo.887.1">{% if category %}{{ category.name }}{% else %}Products
    {% endif %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.888.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.889.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.890.1">&gt;</span></span><span class="koboSpan" id="kobo.891.1">
    {% for product in products %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.892.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.893.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.894.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.895.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.896.1">"item"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.897.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.898.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.899.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.900.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.901.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.902.1">"{{ product.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.903.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.904.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.905.1">img</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.906.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.907.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.908.1">"{% if product.image %}{{ product.image.url }}{% else %}{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.909.1">img</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.910.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.911.1">no_image.png</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.912.1">" %}{% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.913.1">endif</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.914.1"> %}"&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.915.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.916.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.917.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.918.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.919.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.920.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.921.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.922.1">"{{ product.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.923.1">&gt;</span></span><span class="koboSpan" id="kobo.924.1">{{ product.name }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.925.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.926.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.927.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.928.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.929.1">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.930.1">&gt;</span></span><span class="koboSpan" id="kobo.931.1">
        ${{ product.price }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.932.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.933.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.934.1">&gt;</span></span><span class="koboSpan" id="kobo.935.1">
    {% endfor %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.936.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.937.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.938.1">&gt;</span></span><span class="koboSpan" id="kobo.939.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.940.1">Make sure that no template tag is split across multiple lines.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.941.1">This is the product list</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.942.1"> template. </span><span class="koboSpan" id="kobo.942.2">It extends the </span><code class="inlineCode"><span class="koboSpan" id="kobo.943.1">shop/base.html</span></code><span class="koboSpan" id="kobo.944.1"> template and uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.945.1">categories</span></code><span class="koboSpan" id="kobo.946.1"> context variable to display all the categories in a sidebar, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.947.1">products</span></code><span class="koboSpan" id="kobo.948.1"> to display the products of the current page. </span><span class="koboSpan" id="kobo.948.2">The same template is used for both listing all available products and listing products filtered by category. </span><span class="koboSpan" id="kobo.948.3">Since the </span><code class="inlineCode"><span class="koboSpan" id="kobo.949.1">image</span></code><span class="koboSpan" id="kobo.950.1"> field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.951.1">Product</span></code><span class="koboSpan" id="kobo.952.1"> model can be blank, you need to provide a default image for the products that donâ€™t have an image. </span><span class="koboSpan" id="kobo.952.2">The image is located in your static files directory with the relative path </span><code class="inlineCode"><span class="koboSpan" id="kobo.953.1">img/no_image.png</span></code><span class="koboSpan" id="kobo.954.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.955.1">Since you are using </span><code class="inlineCode"><span class="koboSpan" id="kobo.956.1">ImageField</span></code><span class="koboSpan" id="kobo.957.1"> to store product images, you need the development server to serve uploaded image files.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.958.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.959.1">settings.py</span></code><span class="koboSpan" id="kobo.960.1"> file of </span><code class="inlineCode"><span class="koboSpan" id="kobo.961.1">myshop</span></code><span class="koboSpan" id="kobo.962.1"> and add the following settings:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.963.1">MEDIA_URL = </span><span class="hljs-string"><span class="koboSpan" id="kobo.964.1">'media/'</span></span><span class="koboSpan" id="kobo.965.1">
MEDIA_ROOT = BASE_DIR / </span><span class="hljs-string"><span class="koboSpan" id="kobo.966.1">'media'</span></span>
</code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.967.1">MEDIA_URL</span></code><span class="koboSpan" id="kobo.968.1"> is the base URL that serves media files uploaded by users. </span><code class="inlineCode"><span class="koboSpan" id="kobo.969.1">MEDIA_ROOT</span></code><span class="koboSpan" id="kobo.970.1"> is the local path where these files reside, which you build by dynamically prepending the </span><code class="inlineCode"><span class="koboSpan" id="kobo.971.1">BASE_DIR</span></code><span class="koboSpan" id="kobo.972.1"> variable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.973.1">For Django to serve the</span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.974.1"> uploaded media files using the development server, edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.975.1">urls.py</span></code><span class="koboSpan" id="kobo.976.1"> file of </span><code class="inlineCode"><span class="koboSpan" id="kobo.977.1">myshop</span></code><span class="koboSpan" id="kobo.978.1"> and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.979.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.980.1"> django.conf </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.981.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.982.1"> settings</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.983.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.984.1"> django.conf.urls.static </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.985.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.986.1"> static</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.987.1">from</span></span><span class="koboSpan" id="kobo.988.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.989.1">import</span></span><span class="koboSpan" id="kobo.990.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.991.1">from</span></span><span class="koboSpan" id="kobo.992.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.993.1">import</span></span><span class="koboSpan" id="kobo.994.1"> include, path
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.995.1">'admin/'</span></span><span class="koboSpan" id="kobo.996.1">, admin.site.urls),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.997.1">''</span></span><span class="koboSpan" id="kobo.998.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.999.1">'shop.urls'</span></span><span class="koboSpan" id="kobo.1000.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1001.1">'shop'</span></span><span class="koboSpan" id="kobo.1002.1">)),
]
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1003.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1004.1"> settings.DEBUG:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1005.1">    urlpatterns += static(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1006.1">        settings.MEDIA_URL, document_root=settings.MEDIA_ROOT</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1007.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1008.1">Remember that you only serve static files this way during development. </span><span class="koboSpan" id="kobo.1008.2">In a production environment, you should never serve static files with Django; the Django development server doesnâ€™t serve static files in an efficient manner. </span><em class="italic"><span class="koboSpan" id="kobo.1009.1">Chapter 17</span></em><span class="koboSpan" id="kobo.1010.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1011.1">Going Live</span></em><span class="koboSpan" id="kobo.1012.1">, will teach you how to serve static files in a production environment.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1013.1">Run the development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1014.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1015.1">Add a couple of products to your shop using the administration site and open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1016.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.1017.1"> in your browser. </span><span class="koboSpan" id="kobo.1017.2">You will see the product list page, which will look similar to this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1018.1"><img alt="Graphical user interface, website  Description automatically generated" src="../Images/B21088_08_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1019.1">Figure 8.6: The product list page</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1020.1">Credits for images in this chapter:</span></p>
<ul>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1021.1">Green tea</span></em><span class="koboSpan" id="kobo.1022.1">: Photo by Jia Ye on Unsplash</span></li>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1023.1">Red tea</span></em><span class="koboSpan" id="kobo.1024.1">: Photo by Manki Kim on Unsplash</span></li>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1025.1">Tea powder</span></em><span class="koboSpan" id="kobo.1026.1">: Photo by Phuong Nguyen on Unsplash</span></li>
</ul>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1027.1">If you create a product </span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.1028.1">using the administration site and donâ€™t upload an image for it, the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.1029.1">no_image.png</span></code><span class="koboSpan" id="kobo.1030.1"> image will be displayed instead:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1031.1"><img alt="" role="presentation" src="../Images/B21088_08_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1032.1">Figure 8.7: The product list displaying a default image for products that have no image</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1033.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1034.1">shop/product/detail.html</span></code><span class="koboSpan" id="kobo.1035.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1036.1">{% extends "shop/base.html" %}
{% load static %}
{% block title %}
  {{ product.name }}
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1037.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1038.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1039.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1040.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1041.1">"product-detail"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1042.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1043.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1044.1">img</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1045.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1046.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1047.1">"{% if product.image %}{{ product.image.url }}{% else %}</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1048.1">    {% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1049.1">img</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1050.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1051.1">no_image.png</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1052.1">" %}{% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1053.1">endif</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1054.1"> %}"&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1055.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1056.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1057.1">&gt;</span></span><span class="koboSpan" id="kobo.1058.1">{{ product.name }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1059.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1060.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1061.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1062.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1063.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1064.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1065.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1066.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1067.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1068.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1069.1">"{{ product.category.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1070.1">&gt;</span></span><span class="koboSpan" id="kobo.1071.1">
        {{ product.category }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1072.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1073.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1074.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1075.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1076.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1077.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1078.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1079.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1080.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1081.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1082.1">"price"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1083.1">&gt;</span></span><span class="koboSpan" id="kobo.1084.1">${{ product.price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1085.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1086.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1087.1">&gt;</span></span><span class="koboSpan" id="kobo.1088.1">
    {{ product.description|linebreaks }}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1089.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1090.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1091.1">&gt;</span></span><span class="koboSpan" id="kobo.1092.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1093.1">In the preceding code, you</span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.1094.1"> call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1095.1">get_absolute_url()</span></code><span class="koboSpan" id="kobo.1096.1"> method on the related category object to display the available products that belong to the same category.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1097.1">Now open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1098.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.1099.1"> in your browser and click on any product to see the product detail page. </span><span class="koboSpan" id="kobo.1099.2">It will look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1100.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_08_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1101.1">Figure 8.8: The product detail page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1102.1">You have now created a basic product catalog. </span><span class="koboSpan" id="kobo.1102.2">Next, you will implement a shopping cart that allows users to add </span><a id="_idIndexMarker743"/><span class="koboSpan" id="kobo.1103.1">any product to it while browsing the online shop.</span></p>
<h1 class="heading-1" id="_idParaDest-232"><span class="koboSpan" id="kobo.1104.1">Building a shopping cart</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1105.1">After building the product catalog, the next step is to create a shopping cart so that users can pick the products that they want to purchase. </span><span class="koboSpan" id="kobo.1105.2">A shopping cart allows users to select products and set the amount they want to order, and then store this information temporarily while they browse the</span><a id="_idIndexMarker744"/><span class="koboSpan" id="kobo.1106.1"> site until they eventually place an order. </span><span class="koboSpan" id="kobo.1106.2">The cart has to be persisted in the session so that the cart items are maintained during a userâ€™s visit.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1107.1">You will use Djangoâ€™s session framework to persist the cart. </span><span class="koboSpan" id="kobo.1107.2">The cart will be kept in the session until it finishes or the user checks out the cart. </span><span class="koboSpan" id="kobo.1107.3">You will also need to build additional Django models for the cart and its items.</span></p>
<h2 class="heading-2" id="_idParaDest-233"><span class="koboSpan" id="kobo.1108.1">Using Django sessions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1109.1">Django provides a session framework that</span><a id="_idIndexMarker745"/><span class="koboSpan" id="kobo.1110.1"> supports anonymous and user sessions. </span><span class="koboSpan" id="kobo.1110.2">The session framework allows you to store arbitrary data for each visitor. </span><span class="koboSpan" id="kobo.1110.3">Session data is stored on the server side, and cookies contain the session ID unless you use the cookie-based session engine. </span><span class="koboSpan" id="kobo.1110.4">The session middleware manages the sending and receiving of cookies. </span><span class="koboSpan" id="kobo.1110.5">The default session engine stores session data in the database, but you can choose other session engines.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1111.1">To use sessions, you have to make sure that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1112.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.1113.1"> setting of your project contains </span><code class="inlineCode"><span class="koboSpan" id="kobo.1114.1">django.contrib.sessions.middleware.SessionMiddleware</span></code><span class="koboSpan" id="kobo.1115.1">. </span><span class="koboSpan" id="kobo.1115.2">This middleware manages sessions. </span><span class="koboSpan" id="kobo.1115.3">Itâ€™s added by default to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1116.1">MIDDLEWARE</span></code><span class="koboSpan" id="kobo.1117.1"> setting when you create a new project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">startproject</span></code><span class="koboSpan" id="kobo.1119.1"> command.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1120.1">The session middleware </span><a id="_idIndexMarker746"/><span class="koboSpan" id="kobo.1121.1">makes the current session available in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1122.1">request</span></code><span class="koboSpan" id="kobo.1123.1"> object. </span><span class="koboSpan" id="kobo.1123.2">You can access the current session using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1124.1">request.session</span></code><span class="koboSpan" id="kobo.1125.1">, treating it like a Python dictionary to store and retrieve session data. </span><span class="koboSpan" id="kobo.1125.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1126.1">session</span></code><span class="koboSpan" id="kobo.1127.1"> dictionary accepts any Python object by default that can be serialized to JSON. </span><span class="koboSpan" id="kobo.1127.2">You can set a variable in the session like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1128.1">request.session[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1129.1">'foo'</span></span><span class="koboSpan" id="kobo.1130.1">] = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1131.1">'bar'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1132.1">You can retrieve a session key as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1133.1">request.session.get(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1134.1">'foo'</span></span><span class="koboSpan" id="kobo.1135.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1136.1">You can delete a key you previously stored in the session as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1137.1">del</span></span><span class="koboSpan" id="kobo.1138.1"> request.session[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1139.1">'foo'</span></span><span class="koboSpan" id="kobo.1140.1">]
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1141.1">When users log in to the site, their anonymous session is lost, and a new session is created for authenticated users. </span><span class="koboSpan" id="kobo.1141.2">If you store items in an anonymous session that you need to keep after the user logs in, you will have to copy the old session data into the new session. </span><span class="koboSpan" id="kobo.1141.3">You can do this by retrieving the session data before you log in the user using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1142.1">login()</span></code><span class="koboSpan" id="kobo.1143.1"> function of the Django authentication system and storing it in the session after that.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-234"><span class="koboSpan" id="kobo.1144.1">Session settings</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1145.1">There are several settings you can</span><a id="_idIndexMarker747"/><span class="koboSpan" id="kobo.1146.1"> use to configure sessions for your project. </span><span class="koboSpan" id="kobo.1146.2">The most important is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1147.1">SESSION_ENGINE</span></code><span class="koboSpan" id="kobo.1148.1">. </span><span class="koboSpan" id="kobo.1148.2">This setting allows you to set the place where sessions are stored. </span><span class="koboSpan" id="kobo.1148.3">By default, Django stores sessions in the database using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1">Session</span></code><span class="koboSpan" id="kobo.1150.1"> model of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1151.1">django.contrib.sessions</span></code><span class="koboSpan" id="kobo.1152.1"> application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1153.1">Django offers the following options for storing session data:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1154.1">Database sessions</span></strong><span class="koboSpan" id="kobo.1155.1">: Session data is stored in the database. </span><span class="koboSpan" id="kobo.1155.2">This is the default session engine.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1156.1">File-based sessions</span></strong><span class="koboSpan" id="kobo.1157.1">: Session data is stored in the filesystem.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1158.1">Cached sessions</span></strong><span class="koboSpan" id="kobo.1159.1">: Session data is stored in a cache backend. </span><span class="koboSpan" id="kobo.1159.2">You can specify cache backends using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1160.1">CACHES</span></code><span class="koboSpan" id="kobo.1161.1"> setting. </span><span class="koboSpan" id="kobo.1161.2">Storing session data in a cache system provides the best performance.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1162.1">Cached database sessions</span></strong><span class="koboSpan" id="kobo.1163.1">: Session data is stored in a write-through cache and database. </span><span class="koboSpan" id="kobo.1163.2">Reads only use the database if the data is not already in the cache.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1164.1">Cookie-based sessions</span></strong><span class="koboSpan" id="kobo.1165.1">: Session data is stored in the cookies that are sent to the browser.</span></li>
</ul>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.1166.1">For better performance use a cache-based session engine. </span><span class="koboSpan" id="kobo.1166.2">Django supports Memcached out of the box and you can find third-party cache backends for Redis and other cache systems.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1167.1">You can customize sessions with </span><a id="_idIndexMarker748"/><span class="koboSpan" id="kobo.1168.1">specific settings. </span><span class="koboSpan" id="kobo.1168.2">Here are some of the important session-related settings:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">SESSION_COOKIE_AGE</span></code><span class="koboSpan" id="kobo.1170.1">: The duration of session cookies in seconds. </span><span class="koboSpan" id="kobo.1170.2">The default value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1171.1">1209600</span></code><span class="koboSpan" id="kobo.1172.1"> (two weeks).</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1173.1">SESSION_COOKIE_DOMAIN</span></code><span class="koboSpan" id="kobo.1174.1">: The domain used for session cookies. </span><span class="koboSpan" id="kobo.1174.2">Set this to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1175.1">mydomain.com</span></code><span class="koboSpan" id="kobo.1176.1"> to enable cross-domain cookies or use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1177.1">None</span></code><span class="koboSpan" id="kobo.1178.1"> for a standard domain cookie.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1179.1">SESSION_COOKIE_HTTPONLY</span></code><span class="koboSpan" id="kobo.1180.1">: Whether to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1181.1">HttpOnly</span></code><span class="koboSpan" id="kobo.1182.1"> flag on the session cookie. </span><span class="koboSpan" id="kobo.1182.2">If this is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1183.1">True</span></code><span class="koboSpan" id="kobo.1184.1">, client-side JavaScript will not be able to access the session cookie. </span><span class="koboSpan" id="kobo.1184.2">The default value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1">True</span></code><span class="koboSpan" id="kobo.1186.1"> for increased security against user session hijacking.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1187.1">SESSION_COOKIE_SECURE</span></code><span class="koboSpan" id="kobo.1188.1">: A Boolean indicating that the cookie should only be sent if the connection is an HTTPS connection. </span><span class="koboSpan" id="kobo.1188.2">The default value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1189.1">False</span></code><span class="koboSpan" id="kobo.1190.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1191.1">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></code><span class="koboSpan" id="kobo.1192.1">: A Boolean indicating that the session has to expire when the browser is closed. </span><span class="koboSpan" id="kobo.1192.2">The default value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1193.1">False</span></code><span class="koboSpan" id="kobo.1194.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1195.1">SESSION_SAVE_EVERY_REQUEST</span></code><span class="koboSpan" id="kobo.1196.1">: A Boolean that, if </span><code class="inlineCode"><span class="koboSpan" id="kobo.1197.1">True</span></code><span class="koboSpan" id="kobo.1198.1">, will save the session to the database on every request. </span><span class="koboSpan" id="kobo.1198.2">The session expiration is also updated each time itâ€™s saved. </span><span class="koboSpan" id="kobo.1198.3">The default value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1199.1">False</span></code><span class="koboSpan" id="kobo.1200.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1201.1">You can see all the session settings and their default values at </span><a href="https://docs.djangoproject.com/en/5.0/ref/settings/#sessions"><span class="url"><span class="koboSpan" id="kobo.1202.1">https://docs.djangoproject.com/en/5.0/ref/settings/#sessions</span></span></a><span class="koboSpan" id="kobo.1203.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-235"><span class="koboSpan" id="kobo.1204.1">Session expiration</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1205.1">You can choose to use browser-length </span><a id="_idIndexMarker749"/><span class="koboSpan" id="kobo.1206.1">sessions or persistent sessions using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1207.1">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></code><span class="koboSpan" id="kobo.1208.1"> setting. </span><span class="koboSpan" id="kobo.1208.2">This is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1209.1">False</span></code><span class="koboSpan" id="kobo.1210.1"> by default, forcing the session duration to the value stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1211.1">SESSION_COOKIE_AGE</span></code><span class="koboSpan" id="kobo.1212.1"> setting. </span><span class="koboSpan" id="kobo.1212.2">If you set </span><code class="inlineCode"><span class="koboSpan" id="kobo.1213.1">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></code><span class="koboSpan" id="kobo.1214.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1215.1">True</span></code><span class="koboSpan" id="kobo.1216.1">, the session will expire when the user closes the browser, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1217.1">SESSION_COOKIE_AGE</span></code><span class="koboSpan" id="kobo.1218.1"> setting will not have any effect.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1219.1">You can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1220.1">set_expiry()</span></code><span class="koboSpan" id="kobo.1221.1"> method of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1222.1">request.session</span></code><span class="koboSpan" id="kobo.1223.1"> to overwrite the duration of the current session.</span></p>
<h2 class="heading-2" id="_idParaDest-236"><span class="koboSpan" id="kobo.1224.1">Storing shopping carts in sessions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1225.1">You need to create a simple</span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.1226.1"> structure that can be serialized to JSON for storing cart items in a session. </span><span class="koboSpan" id="kobo.1226.2">The cart has to include the following data for each item contained in it:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1227.1">The ID of a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1228.1">Product</span></code><span class="koboSpan" id="kobo.1229.1"> instance</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1230.1">The quantity selected for the product</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1231.1">The unit price for the product</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1232.1">Since product prices may vary, letâ€™s take the approach of storing the productâ€™s price along with the product itself when itâ€™s added to the cart. </span><span class="koboSpan" id="kobo.1232.2">By doing so, you use the current price of the product when users add it to their cart, no matter whether the productâ€™s price is changed afterward. </span><span class="koboSpan" id="kobo.1232.3">This means that the price that the item has when the client adds it to the cart is maintained for that client in the session until checkout is completed or the session finishes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1233.1">Next, you have to build functionality to create shopping carts and associate them with sessions. </span><span class="koboSpan" id="kobo.1233.2">This has to work as follows:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1234.1">When a cart is needed, you check whether a custom session key is set. </span><span class="koboSpan" id="kobo.1234.2">If no cart is set in the session, you create a new cart and save it in the cart session key.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1235.1">For successive requests, you perform the same check and get the cart items from the cart session key. </span><span class="koboSpan" id="kobo.1235.2">You retrieve the cart items from the session and their related </span><code class="inlineCode"><span class="koboSpan" id="kobo.1236.1">Product</span></code><span class="koboSpan" id="kobo.1237.1"> objects from the database.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1238.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1239.1">settings.py</span></code><span class="koboSpan" id="kobo.1240.1"> file of your project and add the following setting to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1241.1">CART_SESSION_ID = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1242.1">'cart'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1243.1">This is the key that you are going to use to store the cart in the user session. </span><span class="koboSpan" id="kobo.1243.2">Since Django sessions are managed per visitor, you can use the same cart session key for all sessions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1244.1">Letâ€™s create an application for</span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.1245.1"> managing shopping carts. </span><span class="koboSpan" id="kobo.1245.2">Open the terminal and create a new application, running the following command from the project directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1246.1">python manage.py startapp cart
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1247.1">Then, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1248.1">settings.py</span></code><span class="koboSpan" id="kobo.1249.1"> file of your project and add the new application to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1250.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.1251.1"> setting with the following line highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1252.1">INSTALLED_APPS = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1253.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1254.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1255.1">cart.apps.CartConfig'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1256.1">,</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1257.1">'shop.apps.ShopConfig'</span></span><span class="koboSpan" id="kobo.1258.1">,
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1259.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1260.1">cart</span></code><span class="koboSpan" id="kobo.1261.1"> application directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1262.1">cart.py</span></code><span class="koboSpan" id="kobo.1263.1">. </span><span class="koboSpan" id="kobo.1263.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1264.1">from</span></span><span class="koboSpan" id="kobo.1265.1"> decimal </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1266.1">import</span></span><span class="koboSpan" id="kobo.1267.1"> Decimal
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1268.1">from</span></span><span class="koboSpan" id="kobo.1269.1"> django.conf </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1270.1">import</span></span><span class="koboSpan" id="kobo.1271.1"> settings
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1272.1">from</span></span><span class="koboSpan" id="kobo.1273.1"> shop.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1274.1">import</span></span><span class="koboSpan" id="kobo.1275.1"> Product
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1276.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1277.1">Cart</span></span><span class="koboSpan" id="kobo.1278.1">:
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1279.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1280.1">__init__</span></span><span class="koboSpan" id="kobo.1281.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1282.1">self, request</span></span><span class="koboSpan" id="kobo.1283.1">):
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1284.1">"""</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1285.1">        Initialize the cart.</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1286.1">        """</span></span><span class="koboSpan" id="kobo.1287.1">
        self.session = request.session
        cart = self.session.get(settings.CART_SESSION_ID)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1288.1">if</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1289.1">not</span></span><span class="koboSpan" id="kobo.1290.1"> cart:
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1291.1"># save an empty cart in the session</span></span><span class="koboSpan" id="kobo.1292.1">
            cart = self.session[settings.CART_SESSION_ID] = {}
        self.cart = cart
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1293.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">Cart</span></code><span class="koboSpan" id="kobo.1295.1"> class that will allow you to manage the shopping cart. </span><span class="koboSpan" id="kobo.1295.2">You require the cart to be initialized with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1">request</span></code><span class="koboSpan" id="kobo.1297.1"> object. </span><span class="koboSpan" id="kobo.1297.2">You store the current session using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">self.session = request.session</span></code><span class="koboSpan" id="kobo.1299.1"> to make it accessible to the other methods of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1">Cart</span></code><span class="koboSpan" id="kobo.1301.1"> class.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1302.1">First, you try to get the cart from the current session using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1303.1">self.session.get(settings.CART_SESSION_ID)</span></code><span class="koboSpan" id="kobo.1304.1">. </span><span class="koboSpan" id="kobo.1304.2">If no cart is present in the session, you create an empty cart by setting an empty dictionary in the session.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1305.1">You will build your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1306.1">cart</span></code><span class="koboSpan" id="kobo.1307.1"> dictionary with product IDs as keys, and for each product key, a dictionary will be a value that includes quantity and price. </span><span class="koboSpan" id="kobo.1307.2">By doing this, you can guarantee that a product will not be added more than once to the cart. </span><span class="koboSpan" id="kobo.1307.3">This way, you can also simplify retrieving </span><a id="_idIndexMarker752"/><span class="koboSpan" id="kobo.1308.1">cart items.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1309.1">Letâ€™s create a method to add products to the cart or update their quantity. </span><span class="koboSpan" id="kobo.1309.2">Add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1310.1">add()</span></code><span class="koboSpan" id="kobo.1311.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1312.1">save()</span></code><span class="koboSpan" id="kobo.1313.1"> methods to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1314.1">Cart</span></code><span class="koboSpan" id="kobo.1315.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1316.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1317.1">Cart</span></span><span class="koboSpan" id="kobo.1318.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1319.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1320.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1321.1">add</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1322.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1323.1">self, product, quantity=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1324.1">1</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1325.1">, override_quantity=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1326.1">False</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1327.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1328.1">"""</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1329.1">        Add a product to the cart or update its quantity.</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1330.1">        """</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1331.1">        product_id = </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1332.1">str</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1333.1">(product.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1334.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1335.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1336.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1337.1"> product_id </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1338.1">not</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1339.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1340.1"> self.cart:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1341.1">            self.cart[product_id] = {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1342.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1343.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1344.1">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1345.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1346.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1347.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1348.1">str</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1349.1">(product.price)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1350.1">            }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1351.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1352.1"> override_quantity:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1353.1">            self.cart[product_id][</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1354.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1355.1">] = quantity</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1356.1">else</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1357.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1358.1">            self.cart[product_id][</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1359.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1360.1">] += quantity</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1361.1">        self.save()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1362.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1363.1">save</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1364.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1365.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1366.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1367.1"># mark the session as "modified" to make sure it gets saved</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1368.1">        self.session.modified = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1369.1">True</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1370.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1371.1">add()</span></code><span class="koboSpan" id="kobo.1372.1"> method takes the following parameters as input:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1373.1">product</span></code><span class="koboSpan" id="kobo.1374.1">: The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1375.1">product</span></code><span class="koboSpan" id="kobo.1376.1"> instance to add or update in the cart.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1377.1">quantity</span></code><span class="koboSpan" id="kobo.1378.1">: An optional integer with the product quantity. </span><span class="koboSpan" id="kobo.1378.2">This defaults to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1379.1">1</span></code><span class="koboSpan" id="kobo.1380.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1">override_quantity</span></code><span class="koboSpan" id="kobo.1382.1">: A Boolean that indicates whether the quantity needs to be overridden with the given quantity (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1383.1">True</span></code><span class="koboSpan" id="kobo.1384.1">) or whether the new quantity has to be added to the existing quantity (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1385.1">False</span></code><span class="koboSpan" id="kobo.1386.1">).</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1387.1">You use the product ID as a key</span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.1388.1"> in the cartâ€™s content dictionary. </span><span class="koboSpan" id="kobo.1388.2">You convert the product ID into a string because Django uses JSON to serialize session data, and JSON only allows string key names. </span><span class="koboSpan" id="kobo.1388.3">The product ID is the key, and the value that you persist is a dictionary with quantity and price figures for the product. </span><span class="koboSpan" id="kobo.1388.4">The productâ€™s price is converted from decimal into a string to serialize it. </span><span class="koboSpan" id="kobo.1388.5">Finally, you call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1389.1">save()</span></code><span class="koboSpan" id="kobo.1390.1"> method to save the cart in the session.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1391.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1392.1">save()</span></code><span class="koboSpan" id="kobo.1393.1"> method marks the session as modified using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1394.1">session.modified = True</span></code><span class="koboSpan" id="kobo.1395.1">. </span><span class="koboSpan" id="kobo.1395.2">This tells Django that the session has changed and needs to be saved.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1396.1">You also need a method for removing products from the cart. </span><span class="koboSpan" id="kobo.1396.2">Add the following method to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1397.1">Cart</span></code><span class="koboSpan" id="kobo.1398.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1399.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1400.1">Cart</span></span><span class="koboSpan" id="kobo.1401.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1402.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1403.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1404.1">remove</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1405.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1406.1">self, product</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1407.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1408.1">"""</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1409.1">        Remove a product from the cart.</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1410.1">        """</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1411.1">        product_id = </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1412.1">str</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1413.1">(product.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1414.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1415.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1416.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1417.1"> product_id </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1418.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1419.1"> self.cart:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1420.1">del</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1421.1"> self.cart[product_id]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1422.1">            self.save()</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1423.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1424.1">remove()</span></code><span class="koboSpan" id="kobo.1425.1"> method removes a given product from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1426.1">cart</span></code><span class="koboSpan" id="kobo.1427.1"> dictionary and calls the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1428.1">save()</span></code><span class="koboSpan" id="kobo.1429.1"> method to update the cart in the session.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1430.1">You will have to iterate through the items contained in the cart and access the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.1431.1">Product</span></code><span class="koboSpan" id="kobo.1432.1"> instances. </span><span class="koboSpan" id="kobo.1432.2">To do so, you can define an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1433.1">__iter__()</span></code><span class="koboSpan" id="kobo.1434.1"> method in your class. </span><span class="koboSpan" id="kobo.1434.2">Add the following method to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1435.1">Cart</span></code><span class="koboSpan" id="kobo.1436.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1437.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1438.1">Cart</span></span><span class="koboSpan" id="kobo.1439.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1440.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1441.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1442.1">__iter__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1443.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1444.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1445.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1446.1">"""</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1447.1">        Iterate over the items in the cart and get the products</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1448.1">        from the database.</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1449.1">        """</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1450.1">        product_ids = self.cart.keys()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1451.1"># get the product objects and add them to the cart</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1452.1">        products = Product.objects.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1453.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1454.1">(id__in=product_ids)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1455.1">        cart = self.cart.copy()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1456.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1457.1"> product </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1458.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1459.1"> products:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1460.1">            cart[</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1461.1">str</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1462.1">(product.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1463.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1464.1">)][</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1465.1">'product'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1466.1">] = product</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1467.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1468.1"> item </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1469.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1470.1"> cart.values():</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1471.1">            item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1472.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1473.1">] = Decimal(item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1474.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1475.1">])</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1476.1">            item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1477.1">'total_price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1478.1">] = item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1479.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1480.1">] * item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1481.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1482.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1483.1">yield</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1484.1"> item</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1485.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">__iter__()</span></code><span class="koboSpan" id="kobo.1487.1"> method, you retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1488.1">Product</span></code><span class="koboSpan" id="kobo.1489.1"> instances that are present in the cart to include them in the cart </span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.1490.1">items. </span><span class="koboSpan" id="kobo.1490.2">You copy the current cart in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1491.1">cart</span></code><span class="koboSpan" id="kobo.1492.1"> variable and add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1493.1">Product</span></code><span class="koboSpan" id="kobo.1494.1"> instances to it. </span><span class="koboSpan" id="kobo.1494.2">Finally, you iterate over the cart items, converting each itemâ€™s price back into decimal, and adding a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1495.1">total_price</span></code><span class="koboSpan" id="kobo.1496.1"> attribute to each item. </span><span class="koboSpan" id="kobo.1496.2">This </span><code class="inlineCode"><span class="koboSpan" id="kobo.1497.1">__iter__()</span></code><span class="koboSpan" id="kobo.1498.1"> method will allow you to easily iterate over the items in the cart in views and templates.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1499.1">You also need a way to return the total number of items in the cart. </span><span class="koboSpan" id="kobo.1499.2">When the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1500.1">len()</span></code><span class="koboSpan" id="kobo.1501.1"> function is executed on an object, Python calls its </span><code class="inlineCode"><span class="koboSpan" id="kobo.1502.1">__len__()</span></code><span class="koboSpan" id="kobo.1503.1"> method to retrieve its length. </span><span class="koboSpan" id="kobo.1503.2">Next, you are going to define a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.1504.1">__len__()</span></code><span class="koboSpan" id="kobo.1505.1"> method to return the total number of items stored in the cart.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1506.1">Add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1507.1">__len__()</span></code><span class="koboSpan" id="kobo.1508.1"> method to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1509.1">Cart</span></code><span class="koboSpan" id="kobo.1510.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1511.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1512.1">Cart</span></span><span class="koboSpan" id="kobo.1513.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1514.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1515.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1516.1">__len__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1517.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1518.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1519.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1520.1">"""</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1521.1">        Count all items in the cart.</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1522.1">        """</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1523.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1524.1">sum</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1525.1">(item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1526.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1527.1">] </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1528.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1529.1"> item </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1530.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1531.1"> self.cart.values())</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1532.1">You return the sum of the quantities of all the cart items.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1533.1">Add the following method to calculate the total cost of the items in the cart:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1534.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1535.1">Cart</span></span><span class="koboSpan" id="kobo.1536.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1537.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1538.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1539.1">get_total_price</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1540.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1541.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1542.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1543.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1544.1">sum</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1545.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1546.1">Decimal(item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1547.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1548.1">]) * item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1549.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1550.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1551.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1552.1"> item </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1553.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1554.1"> self.cart.values()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1555.1">        )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1556.1">Finally, add a method to clear the cart session:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1557.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1558.1">Cart</span></span><span class="koboSpan" id="kobo.1559.1">:
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1560.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1561.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1562.1">clear</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1563.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1564.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1565.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1566.1"># remove cart from session</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1567.1">del</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1568.1"> self.session[settings.CART_SESSION_ID]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1569.1">        self.save()</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1570.1">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1571.1">Cart</span></code><span class="koboSpan" id="kobo.1572.1"> class is now ready to </span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.1573.1">manage shopping carts.</span></p>
<h2 class="heading-2" id="_idParaDest-237"><span class="koboSpan" id="kobo.1574.1">Creating shopping cart views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1575.1">Now that you have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1576.1">Cart</span></code><span class="koboSpan" id="kobo.1577.1"> class to </span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.1578.1">manage the cart, you need to create the </span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.1579.1">views to add, update, or remove items from it. </span><span class="koboSpan" id="kobo.1579.2">You need to create the following views:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1580.1">A view to add or update items in the cart that can handle current and new quantities</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1581.1">A view to remove items from the cart</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1582.1">A view to display cart items and totals</span></li>
</ul>
<h3 class="heading-3" id="_idParaDest-238"><span class="koboSpan" id="kobo.1583.1">Adding items to the cart</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1584.1">To add items to the cart, you need a form that</span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.1585.1"> allows the user to select a quantity. </span><span class="koboSpan" id="kobo.1585.2">Create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1586.1">forms.py</span></code><span class="koboSpan" id="kobo.1587.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1588.1">cart</span></code><span class="koboSpan" id="kobo.1589.1"> application directory and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1590.1">from</span></span><span class="koboSpan" id="kobo.1591.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1592.1">import</span></span><span class="koboSpan" id="kobo.1593.1"> forms
PRODUCT_QUANTITY_CHOICES = [(i, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1594.1">str</span></span><span class="koboSpan" id="kobo.1595.1">(i)) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1596.1">for</span></span><span class="koboSpan" id="kobo.1597.1"> i </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1598.1">in</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1599.1">range</span></span><span class="koboSpan" id="kobo.1600.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1601.1">1</span></span><span class="koboSpan" id="kobo.1602.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1603.1">21</span></span><span class="koboSpan" id="kobo.1604.1">)]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1605.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1606.1">CartAddProductForm</span></span><span class="koboSpan" id="kobo.1607.1">(forms.Form):
    quantity = forms.TypedChoiceField(
        choices=PRODUCT_QUANTITY_CHOICES,
        coerce=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1608.1">int</span></span><span class="koboSpan" id="kobo.1609.1">
    )
    override = forms.BooleanField(
        required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1610.1">False</span></span><span class="koboSpan" id="kobo.1611.1">,
        initial=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1612.1">False</span></span><span class="koboSpan" id="kobo.1613.1">,
        widget=forms.HiddenInput
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1614.1">You will use this form to add products to the cart. </span><span class="koboSpan" id="kobo.1614.2">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1615.1">CartAddProductForm</span></code><span class="koboSpan" id="kobo.1616.1"> class contains the following two fields:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1617.1">quantity</span></code><span class="koboSpan" id="kobo.1618.1">: This allows the user to select a quantity between 1 and 20. </span><span class="koboSpan" id="kobo.1618.2">You use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1619.1">TypedChoiceField</span></code><span class="koboSpan" id="kobo.1620.1"> field with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1621.1">coerce=int</span></code><span class="koboSpan" id="kobo.1622.1"> to convert the input into an integer.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1623.1">override</span></code><span class="koboSpan" id="kobo.1624.1">: This allows</span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.1625.1"> you to indicate whether the quantity has to be added to any existing quantity in the cart for this product (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1626.1">False</span></code><span class="koboSpan" id="kobo.1627.1">) or whether the existing quantity has to be overridden with the given quantity (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1628.1">True</span></code><span class="koboSpan" id="kobo.1629.1">). </span><span class="koboSpan" id="kobo.1629.2">You use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1630.1">HiddenInput</span></code><span class="koboSpan" id="kobo.1631.1"> widget for this field since you donâ€™t want to display it to the user.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1632.1">Letâ€™s create a view for adding items to the cart. </span><span class="koboSpan" id="kobo.1632.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1633.1">views.py</span></code><span class="koboSpan" id="kobo.1634.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1635.1">cart</span></code><span class="koboSpan" id="kobo.1636.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1637.1">from</span></span><span class="koboSpan" id="kobo.1638.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1639.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1640.1">get_object_or_404, redirect, </span></strong></span><span class="koboSpan" id="kobo.1641.1">render
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1642.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1643.1"> django.views.decorators.http </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1644.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1645.1"> require_POST</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1646.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1647.1"> shop.models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1648.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1649.1"> Product</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1650.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1651.1"> .cart </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1652.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1653.1"> Cart</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1654.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1655.1"> .forms </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1656.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1657.1"> CartAddProductForm</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1658.1">@require_POST</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1659.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1660.1">cart_add</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1661.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1662.1">request, product_id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1663.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1664.1">    cart = Cart(request)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1665.1">    product = get_object_or_404(Product, </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1666.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1667.1">=product_id)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1668.1">    form = CartAddProductForm(request.POST)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1669.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1670.1"> form.is_valid():</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1671.1">        cd = form.cleaned_data</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1672.1">        cart.add(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1673.1">            product=product,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1674.1">            quantity=cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1675.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1676.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1677.1">            override_quantity=cd[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1678.1">'override'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1679.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1680.1">        )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1681.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1682.1"> redirect(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1683.1">'cart:cart_detail'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1684.1">)</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1685.1">This is the view for adding products to the cart or updating quantities for existing products. </span><span class="koboSpan" id="kobo.1685.2">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1686.1">require_POST</span></code><span class="koboSpan" id="kobo.1687.1"> decorator to allow only </span><code class="inlineCode"><span class="koboSpan" id="kobo.1688.1">POST</span></code><span class="koboSpan" id="kobo.1689.1"> requests. </span><span class="koboSpan" id="kobo.1689.2">The view receives the product ID as a parameter. </span><span class="koboSpan" id="kobo.1689.3">You retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1690.1">Product</span></code><span class="koboSpan" id="kobo.1691.1"> instance with the given ID and validate </span><code class="inlineCode"><span class="koboSpan" id="kobo.1692.1">CartAddProductForm</span></code><span class="koboSpan" id="kobo.1693.1">. </span><span class="koboSpan" id="kobo.1693.2">If the form is valid, you either add or update the product in the cart. </span><span class="koboSpan" id="kobo.1693.3">The view redirects to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1694.1">cart_detail</span></code><span class="koboSpan" id="kobo.1695.1"> URL, which will display the contents of the cart. </span><span class="koboSpan" id="kobo.1695.2">You are</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.1696.1"> going to create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1697.1">cart_detail</span></code><span class="koboSpan" id="kobo.1698.1"> view shortly.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1699.1">You also need a view to remove items from the cart. </span><span class="koboSpan" id="kobo.1699.2">Add the following code to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1700.1">views.py</span></code><span class="koboSpan" id="kobo.1701.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1702.1">cart</span></code><span class="koboSpan" id="kobo.1703.1"> application:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.1704.1">@require_POST</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1705.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1706.1">cart_remove</span></span><span class="koboSpan" id="kobo.1707.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1708.1">request, product_id</span></span><span class="koboSpan" id="kobo.1709.1">):
    cart = Cart(request)
    product = get_object_or_404(Product, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1710.1">id</span></span><span class="koboSpan" id="kobo.1711.1">=product_id)
    cart.remove(product)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1712.1">return</span></span><span class="koboSpan" id="kobo.1713.1"> redirect(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1714.1">'cart:cart_detail'</span></span><span class="koboSpan" id="kobo.1715.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1716.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1717.1">cart_remove</span></code><span class="koboSpan" id="kobo.1718.1"> view receives the product ID as a parameter. </span><span class="koboSpan" id="kobo.1718.2">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1719.1">require_POST</span></code><span class="koboSpan" id="kobo.1720.1"> decorator to allow only </span><code class="inlineCode"><span class="koboSpan" id="kobo.1721.1">POST</span></code><span class="koboSpan" id="kobo.1722.1"> requests. </span><span class="koboSpan" id="kobo.1722.2">You retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1723.1">Product</span></code><span class="koboSpan" id="kobo.1724.1"> instance with the given ID and remove the product from the cart. </span><span class="koboSpan" id="kobo.1724.2">Then, you redirect the user to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1725.1">cart_detail</span></code><span class="koboSpan" id="kobo.1726.1"> URL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1727.1">Finally, you need a view to display the cart and its items. </span><span class="koboSpan" id="kobo.1727.2">Add the following view to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1728.1">views.py</span></code><span class="koboSpan" id="kobo.1729.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1730.1">cart</span></code><span class="koboSpan" id="kobo.1731.1"> application:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1732.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1733.1">cart_detail</span></span><span class="koboSpan" id="kobo.1734.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1735.1">request</span></span><span class="koboSpan" id="kobo.1736.1">):
    cart = Cart(request)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1737.1">return</span></span><span class="koboSpan" id="kobo.1738.1"> render(request, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1739.1">'cart/detail.html'</span></span><span class="koboSpan" id="kobo.1740.1">, {</span><span class="hljs-string"><span class="koboSpan" id="kobo.1741.1">'cart'</span></span><span class="koboSpan" id="kobo.1742.1">: cart})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1743.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1744.1">cart_detail</span></code><span class="koboSpan" id="kobo.1745.1"> view gets the current cart to display it.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1746.1">You have created views to add items to the cart, update quantities, remove items from the cart, and display the cartâ€™s contents. </span><span class="koboSpan" id="kobo.1746.2">Letâ€™s add URL patterns for these views. </span><span class="koboSpan" id="kobo.1746.3">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1747.1">cart</span></code><span class="koboSpan" id="kobo.1748.1"> application directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1749.1">urls.py</span></code><span class="koboSpan" id="kobo.1750.1">. </span><span class="koboSpan" id="kobo.1750.2">Add the following URL patterns to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1751.1">from</span></span><span class="koboSpan" id="kobo.1752.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1753.1">import</span></span><span class="koboSpan" id="kobo.1754.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1755.1">from</span></span><span class="koboSpan" id="kobo.1756.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1757.1">import</span></span><span class="koboSpan" id="kobo.1758.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1759.1">'cart'</span></span><span class="koboSpan" id="kobo.1760.1">
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1761.1">''</span></span><span class="koboSpan" id="kobo.1762.1">, views.cart_detail, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1763.1">'cart_detail'</span></span><span class="koboSpan" id="kobo.1764.1">),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1765.1">'add/&lt;int:product_id&gt;/'</span></span><span class="koboSpan" id="kobo.1766.1">, views.cart_add, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1767.1">'cart_add'</span></span><span class="koboSpan" id="kobo.1768.1">),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.1769.1">'remove/&lt;int:product_id&gt;/'</span></span><span class="koboSpan" id="kobo.1770.1">,
        views.cart_remove,
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1771.1">'cart_remove'</span></span>
<span class="hljs-string"> </span><span class="koboSpan" id="kobo.1772.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1773.1">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1774.1">urls.py</span></code><span class="koboSpan" id="kobo.1775.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1776.1">myshop</span></code><span class="koboSpan" id="kobo.1777.1"> project and add the following URL pattern highlighted in bold to include the </span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.1778.1">cart URLs:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1779.1">urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1780.1">'admin/'</span></span><span class="koboSpan" id="kobo.1781.1">, admin.site.urls),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1782.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1783.1">'cart/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1784.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1785.1">'cart.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1786.1">, namespace=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1787.1">'cart'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1788.1">)),</span></strong></span><span class="koboSpan" id="kobo.1789.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1790.1">''</span></span><span class="koboSpan" id="kobo.1791.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1792.1">'shop.urls'</span></span><span class="koboSpan" id="kobo.1793.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1794.1">'shop'</span></span><span class="koboSpan" id="kobo.1795.1">)),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1796.1">Make sure that you include this URL pattern before the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1797.1">shop.urls</span></code><span class="koboSpan" id="kobo.1798.1"> pattern since itâ€™s more restrictive than the latter.</span></p>
<h3 class="heading-3" id="_idParaDest-239"><span class="koboSpan" id="kobo.1799.1">Building a template to display the cart</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1800.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1801.1">cart_add</span></code><span class="koboSpan" id="kobo.1802.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1803.1">cart_remove</span></code><span class="koboSpan" id="kobo.1804.1"> views donâ€™t render </span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.1805.1">any templates, but you need to create a template for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1806.1">cart_detail</span></code><span class="koboSpan" id="kobo.1807.1"> view to display cart items and totals.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1808.1">Create the following file structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1809.1">cart</span></code><span class="koboSpan" id="kobo.1810.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1811.1">templates/
    cart/
        detail.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1812.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1813.1">cart/detail.html</span></code><span class="koboSpan" id="kobo.1814.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1815.1">{% extends "shop/base.html" %}
{% load static %}
{% block title %}
  Your shopping cart
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1816.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1817.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1818.1">&gt;</span></span><span class="koboSpan" id="kobo.1819.1">Your shopping cart</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1820.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1821.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1822.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1823.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1824.1">table</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1825.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1826.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1827.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1828.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1829.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1830.1">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1831.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1832.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1833.1">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1834.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1835.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1836.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1837.1">&gt;</span></span><span class="koboSpan" id="kobo.1838.1">Image</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1839.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1840.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1841.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1842.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1843.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1844.1">&gt;</span></span><span class="koboSpan" id="kobo.1845.1">Product</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1846.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1847.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1848.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1849.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1850.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1851.1">&gt;</span></span><span class="koboSpan" id="kobo.1852.1">Quantity</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1853.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1854.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1855.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1856.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1857.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1858.1">&gt;</span></span><span class="koboSpan" id="kobo.1859.1">Remove</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1860.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1861.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1862.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1863.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1864.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1865.1">&gt;</span></span><span class="koboSpan" id="kobo.1866.1">Unit price</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1867.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1868.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1869.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1870.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1871.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1872.1">&gt;</span></span><span class="koboSpan" id="kobo.1873.1">Price</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1874.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1875.1">th</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1876.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1877.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1878.1">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1879.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1880.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1881.1">thead</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1882.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1883.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1884.1">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1885.1">&gt;</span></span><span class="koboSpan" id="kobo.1886.1">
      {% for item in cart %}
        {% with product=item.product %}
          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1887.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1888.1">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1889.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1890.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1891.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1892.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1893.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1894.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1895.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1896.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1897.1">"{{ product.get_absolute_url }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1898.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1899.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1900.1">img</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1901.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1902.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1903.1">"{% if product.image %}{{ product.image.url }}</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1904.1">                {% else %}{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1905.1">img</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1906.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1907.1">no_image.png</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1908.1">" %}{% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1909.1">endif</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1910.1"> %}"&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1911.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1912.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1913.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1914.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1915.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1916.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1917.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1918.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1919.1">&gt;</span></span><span class="koboSpan" id="kobo.1920.1">{{ product.name }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1921.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1922.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1923.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1924.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1925.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1926.1">&gt;</span></span><span class="koboSpan" id="kobo.1927.1">{{ item.quantity }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1928.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1929.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1930.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1931.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1932.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1933.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1934.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1935.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1936.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1937.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1938.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1939.1">cart:cart_remove</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1940.1">" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1941.1">product.id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1942.1"> %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1943.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1944.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1945.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1946.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1947.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1948.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1949.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1950.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1951.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1952.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1953.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1954.1">"Remove"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1955.1">&gt;</span></span><span class="koboSpan" id="kobo.1956.1">
                {% csrf_token %}
              </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1957.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1958.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1959.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1960.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1961.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1962.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1963.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1964.1">td</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1965.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1966.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1967.1">"num"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1968.1">&gt;</span></span><span class="koboSpan" id="kobo.1969.1">${{ item.price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1970.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1971.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1972.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1973.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1974.1">td</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1975.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1976.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1977.1">"num"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1978.1">&gt;</span></span><span class="koboSpan" id="kobo.1979.1">${{ item.total_price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1980.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1981.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1982.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1983.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1984.1">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1985.1">&gt;</span></span><span class="koboSpan" id="kobo.1986.1">
        {% endwith %}
      {% endfor %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1987.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1988.1">tr</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1989.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1990.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1991.1">"total"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1992.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1993.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1994.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1995.1">&gt;</span></span><span class="koboSpan" id="kobo.1996.1">Total</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1997.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1998.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1999.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2000.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2001.1">td</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2002.1">colspan</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2003.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2004.1">"4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2005.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2006.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2007.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2008.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2009.1">td</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2010.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2011.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2012.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2013.1">num"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2014.1">&gt;</span></span><span class="koboSpan" id="kobo.2015.1">${{ cart.get_total_price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2016.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2017.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2018.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2019.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2020.1">tr</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2021.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2022.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2023.1">tbody</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2024.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2025.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2026.1">table</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2027.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2028.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2029.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2030.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2031.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2032.1">"text-right"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2033.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2034.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2035.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2036.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2037.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2038.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2039.1">shop:product_list</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2040.1">" %}" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2041.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2042.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2043.1">"button</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2044.1">    light"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2045.1">&gt;</span></span><span class="koboSpan" id="kobo.2046.1">Continue shopping</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2047.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2048.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2049.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2050.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2051.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2052.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2053.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2054.1">"#"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2055.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2056.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2057.1">"button"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2058.1">&gt;</span></span><span class="koboSpan" id="kobo.2059.1">Checkout</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2060.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2061.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2062.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2063.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2064.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2065.1">&gt;</span></span><span class="koboSpan" id="kobo.2066.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2067.1">Make sure that no template tag is split across multiple lines.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2068.1">This is the template that is used to</span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.2069.1"> display the cartâ€™s contents. </span><span class="koboSpan" id="kobo.2069.2">It contains a table with the items stored in the current cart. </span><span class="koboSpan" id="kobo.2069.3">You allow users to change the quantity of the selected products using a form that is posted to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2070.1">cart_add</span></code><span class="koboSpan" id="kobo.2071.1"> view. </span><span class="koboSpan" id="kobo.2071.2">You also allow users to remove items from the cart by providing a </span><strong class="keyWord"><span class="koboSpan" id="kobo.2072.1">Remove</span></strong><span class="koboSpan" id="kobo.2073.1"> button for each of them. </span><span class="koboSpan" id="kobo.2073.2">Finally, you use an HTML form with an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2074.1">action</span></code><span class="koboSpan" id="kobo.2075.1"> attribute that points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2076.1">cart_remove</span></code><span class="koboSpan" id="kobo.2077.1"> URL including the product ID.</span></p>
<h3 class="heading-3" id="_idParaDest-240"><span class="koboSpan" id="kobo.2078.1">Adding products to the cart</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.2079.1">Now you need to add an </span><strong class="screenText"><span class="koboSpan" id="kobo.2080.1">Add to cart</span></strong><span class="koboSpan" id="kobo.2081.1"> button to the product detail page. </span><span class="koboSpan" id="kobo.2081.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2082.1">views.py</span></code><span class="koboSpan" id="kobo.2083.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2084.1">shop</span></code><span class="koboSpan" id="kobo.2085.1"> application</span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.2086.1"> and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.2087.1">CartAddProductForm</span></code><span class="koboSpan" id="kobo.2088.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2089.1">product_detail</span></code><span class="koboSpan" id="kobo.2090.1"> view, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2091.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2092.1"> cart.forms </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2093.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2094.1"> CartAddProductForm</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.2095.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2096.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2097.1">product_detail</span></span><span class="koboSpan" id="kobo.2098.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2099.1">request, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2100.1">id</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2101.1">, slug</span></span><span class="koboSpan" id="kobo.2102.1">):
    product = get_object_or_404(
        Product, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2103.1">id</span></span><span class="koboSpan" id="kobo.2104.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2105.1">id</span></span><span class="koboSpan" id="kobo.2106.1">, slug=slug, available=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2107.1">True</span></span>
<span class="hljs-literal"> </span><span class="koboSpan" id="kobo.2108.1">)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2109.1">    cart_product_form = CartAddProductForm()</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2110.1">return</span></span><span class="koboSpan" id="kobo.2111.1"> render(
        request,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2112.1">'shop/product/detail.html'</span></span><span class="koboSpan" id="kobo.2113.1">,
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.2114.1">'product'</span></span><span class="koboSpan" id="kobo.2115.1">: product</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2116.1">,</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2117.1"> 'cart_product_form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2118.1">: cart_product_form</span></strong></span><span class="koboSpan" id="kobo.2119.1">}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2120.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2121.1">shop/product/detail.html</span></code><span class="koboSpan" id="kobo.2122.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2123.1">shop</span></code><span class="koboSpan" id="kobo.2124.1"> application and add the following form to the product</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.2125.1"> price, as follows. </span><span class="koboSpan" id="kobo.2125.2">New lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2126.1">...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2127.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2128.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2129.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2130.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2131.1">"price"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2132.1">&gt;</span></span><span class="koboSpan" id="kobo.2133.1">${{ product.price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2134.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2135.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2136.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2137.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2138.1">form</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2139.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2140.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2141.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2142.1">cart:cart_add</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2143.1">" </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2144.1">product.id</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2145.1"> %}" </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2146.1">method</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2147.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2148.1">"post"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2149.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2150.1">  {{ cart_product_form }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2151.1">  {% csrf_token %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2152.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2153.1">input</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2154.1">type</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2155.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2156.1">"submit"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2157.1">value</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2158.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2159.1">"Add to cart"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2160.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2161.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2162.1">form</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2163.1">&gt;</span></strong></span><span class="koboSpan" id="kobo.2164.1">
{{ product.description|linebreaks }}
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2165.1">Run the development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2166.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2167.1">Now open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2168.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.2169.1"> in your browser and navigate to a productâ€™s detail page. </span><span class="koboSpan" id="kobo.2169.2">It will contain a form to choose a quantity before adding the product to the cart. </span><span class="koboSpan" id="kobo.2169.3">The page will look like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2170.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_08_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2171.1">Figure 8.9: The product detail page, including the Add to cart button</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2172.1">Choose a quantity and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2173.1">Add to cart</span></strong><span class="koboSpan" id="kobo.2174.1"> button. </span><span class="koboSpan" id="kobo.2174.2">The form is submitted to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2175.1">cart_add</span></code><span class="koboSpan" id="kobo.2176.1"> view via </span><code class="inlineCode"><span class="koboSpan" id="kobo.2177.1">POST</span></code><span class="koboSpan" id="kobo.2178.1">. </span><span class="koboSpan" id="kobo.2178.2">The</span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.2179.1"> view adds the product to the cart in the session, including its current price and the selected quantity. </span><span class="koboSpan" id="kobo.2179.2">Then, it redirects the user to the cart detail page, which will look like </span><em class="italic"><span class="koboSpan" id="kobo.2180.1">Figure 8.10</span></em><span class="koboSpan" id="kobo.2181.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2182.1"><img alt="Graphical user interface, timeline  Description automatically generated with medium confidence" src="../Images/B21088_08_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2183.1">Figure 8.10: The cart detail page</span></p>
<h3 class="heading-3" id="_idParaDest-241"><span class="koboSpan" id="kobo.2184.1">Updating product quantities in the cart</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.2185.1">When users see the cart, they </span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.2186.1">might want to change product quantities before placing an order. </span><span class="koboSpan" id="kobo.2186.2">You are going to allow users to change quantities from the cart detail page.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2187.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2188.1">views.py</span></code><span class="koboSpan" id="kobo.2189.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2190.1">cart</span></code><span class="koboSpan" id="kobo.2191.1"> application and add the following lines highlighted in bold to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2192.1">cart_detail</span></code><span class="koboSpan" id="kobo.2193.1"> view:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2194.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2195.1">cart_detail</span></span><span class="koboSpan" id="kobo.2196.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2197.1">request</span></span><span class="koboSpan" id="kobo.2198.1">):
    cart = Cart(request)
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2199.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2200.1"> item </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2201.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2202.1"> cart:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2203.1">        item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2204.1">'update_quantity_form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2205.1">] = CartAddProductForm(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2206.1">            initial={</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2207.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2208.1">: item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2209.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2210.1">], </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2211.1">'override'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2212.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2213.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2214.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2215.1">        )</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2216.1">return</span></span><span class="koboSpan" id="kobo.2217.1"> render(request, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2218.1">'cart/detail.html'</span></span><span class="koboSpan" id="kobo.2219.1">, {</span><span class="hljs-string"><span class="koboSpan" id="kobo.2220.1">'cart'</span></span><span class="koboSpan" id="kobo.2221.1">: cart})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2222.1">You create an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2223.1">CartAddProductForm</span></code><span class="koboSpan" id="kobo.2224.1"> for each item in the cart to allow changing product quantities. </span><span class="koboSpan" id="kobo.2224.2">You initialize the form with the current item quantity and set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2225.1">override</span></code><span class="koboSpan" id="kobo.2226.1"> field to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2227.1">True</span></code><span class="koboSpan" id="kobo.2228.1"> so that when you submit the form to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2229.1">cart_add</span></code><span class="koboSpan" id="kobo.2230.1"> view, the current quantity is replaced </span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.2231.1">with the new one.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2232.1">Now edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2233.1">cart/detail.html</span></code><span class="koboSpan" id="kobo.2234.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2235.1">cart</span></code><span class="koboSpan" id="kobo.2236.1"> application and find the following line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2237.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2238.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2239.1">&gt;</span></span><span class="koboSpan" id="kobo.2240.1">{{ item.quantity }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2241.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2242.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2243.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2244.1">Replace the previous line with the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2245.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2246.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2247.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2248.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2249.1">form</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2250.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2251.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2252.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2253.1">cart:cart_add</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2254.1">" </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2255.1">product.id</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2256.1"> %}" </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2257.1">method</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2258.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2259.1">"post"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2260.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2261.1">    {{ item.update_quantity_form.quantity }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2262.1">    {{ item.update_quantity_form.override }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2263.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2264.1">input</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2265.1">type</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2266.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2267.1">"submit"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2268.1">value</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2269.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2270.1">"Update"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2271.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2272.1">    {% csrf_token %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2273.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2274.1">form</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2275.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2276.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2277.1">td</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2278.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2279.1">Run the development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2280.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2281.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2282.1">http://127.0.0.1:8000/cart/</span></code><span class="koboSpan" id="kobo.2283.1"> in your browser.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2284.1">You will see a form to edit the quantity for each cart item, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2285.1"><img alt="Graphical user interface, website  Description automatically generated" src="../Images/B21088_08_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2286.1">Figure 8.11: The cart detail page, including the form to update product quantities</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2287.1">Change the quantity of an item and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.2288.1">Update</span></strong><span class="koboSpan" id="kobo.2289.1"> button to test the new functionality. </span><span class="koboSpan" id="kobo.2289.2">You can also</span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.2290.1"> remove an item from the cart by clicking the </span><strong class="screenText"><span class="koboSpan" id="kobo.2291.1">Remove</span></strong><span class="koboSpan" id="kobo.2292.1"> button.</span></p>
<h2 class="heading-2" id="_idParaDest-242"><span class="koboSpan" id="kobo.2293.1">Creating a context processor for the current cart</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2294.1">You might have noticed that the message </span><strong class="screenText"><span class="koboSpan" id="kobo.2295.1">Your cart is empty</span></strong><span class="koboSpan" id="kobo.2296.1"> is displayed in the header of the site, even when the cart contains items. </span><span class="koboSpan" id="kobo.2296.2">You should display the total number of items in the cart and the total cost instead. </span><span class="koboSpan" id="kobo.2296.3">Since this has to be displayed on all pages, you need to build a context processor to include the current cart in the request context, regardless of the view that processes the request.</span></p>
<h3 class="heading-3" id="_idParaDest-243"><span class="koboSpan" id="kobo.2297.1">Context processors</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.2298.1">A context processor is a</span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.2299.1"> Python function that takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2300.1">request</span></code><span class="koboSpan" id="kobo.2301.1"> object as an argument and returns a dictionary that gets added to the request context. </span><span class="koboSpan" id="kobo.2301.2">Context processors come in handy when you need to make something available globally to all templates.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2302.1">By default, when you create a new project using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2303.1">startproject</span></code><span class="koboSpan" id="kobo.2304.1"> command, your project contains the following template context processors in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2305.1">context_processors</span></code><span class="koboSpan" id="kobo.2306.1"> option inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2307.1">TEMPLATES</span></code><span class="koboSpan" id="kobo.2308.1"> setting:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2309.1">django.template.context_processors.debug</span></code><span class="koboSpan" id="kobo.2310.1">: This sets the Boolean </span><code class="inlineCode"><span class="koboSpan" id="kobo.2311.1">debug</span></code><span class="koboSpan" id="kobo.2312.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2313.1">sql_queries</span></code><span class="koboSpan" id="kobo.2314.1"> variables in the context, representing the list of SQL queries executed in the request.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2315.1">django.template.context_processors.request</span></code><span class="koboSpan" id="kobo.2316.1">: This sets the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2317.1">request</span></code><span class="koboSpan" id="kobo.2318.1"> variable in the context.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2319.1">django.contrib.auth.context_processors.auth</span></code><span class="koboSpan" id="kobo.2320.1">: This sets the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2321.1">user</span></code><span class="koboSpan" id="kobo.2322.1"> variable in the request.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2323.1">django.contrib.messages.context_processors.messages</span></code><span class="koboSpan" id="kobo.2324.1">: This sets a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2325.1">messages</span></code><span class="koboSpan" id="kobo.2326.1"> variable in the context containing all the messages that have been generated using the messages framework.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2327.1">Django also enables </span><code class="inlineCode"><span class="koboSpan" id="kobo.2328.1">django.template.context_processors.csrf</span></code><span class="koboSpan" id="kobo.2329.1"> to avoid </span><strong class="keyWord"><span class="koboSpan" id="kobo.2330.1">cross-site request forgery</span></strong><span class="koboSpan" id="kobo.2331.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2332.1">CSRF</span></strong><span class="koboSpan" id="kobo.2333.1">) attacks. </span><span class="koboSpan" id="kobo.2333.2">This context </span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.2334.1">processor is not present in the settings, but it is always enabled and canâ€™t be</span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.2335.1"> turned off for security reasons.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2336.1">You can see the list of all built-in context processors at </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/api/#built-in-template-context-processors"><span class="url"><span class="koboSpan" id="kobo.2337.1">https://docs.djangoproject.com/en/5.0/ref/templates/api/#built-in-template-context-processors</span></span></a><span class="koboSpan" id="kobo.2338.1">.</span></p>
<h3 class="heading-3" id="_idParaDest-244"><span class="koboSpan" id="kobo.2339.1">Setting the cart in the request context</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.2340.1">Letâ€™s create a context processor to set </span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.2341.1">the current cart in the request context. </span><span class="koboSpan" id="kobo.2341.2">With it, you will be able to access the cart in any template.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2342.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2343.1">cart</span></code><span class="koboSpan" id="kobo.2344.1"> application directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2345.1">context_processors.py</span></code><span class="koboSpan" id="kobo.2346.1">. </span><span class="koboSpan" id="kobo.2346.2">Context processors can reside anywhere in your code but creating them here will keep your code well organized. </span><span class="koboSpan" id="kobo.2346.3">Add the following code to the file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2347.1">from</span></span><span class="koboSpan" id="kobo.2348.1"> .cart </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2349.1">import</span></span><span class="koboSpan" id="kobo.2350.1"> Cart
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2351.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2352.1">cart</span></span><span class="koboSpan" id="kobo.2353.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2354.1">request</span></span><span class="koboSpan" id="kobo.2355.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2356.1">return</span></span><span class="koboSpan" id="kobo.2357.1"> {</span><span class="hljs-string"><span class="koboSpan" id="kobo.2358.1">'cart'</span></span><span class="koboSpan" id="kobo.2359.1">: Cart(request)}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2360.1">In your context processor, you instantiate the cart using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2361.1">request</span></code><span class="koboSpan" id="kobo.2362.1"> object and make it available for the templates as a variable named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2363.1">cart</span></code><span class="koboSpan" id="kobo.2364.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2365.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2366.1">settings.py</span></code><span class="koboSpan" id="kobo.2367.1"> file of your project and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.2368.1">cart.context_processors.cart</span></code><span class="koboSpan" id="kobo.2369.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2370.1">context_processors</span></code><span class="koboSpan" id="kobo.2371.1"> option inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2372.1">TEMPLATES</span></code><span class="koboSpan" id="kobo.2373.1"> setting, as follows. </span><span class="koboSpan" id="kobo.2373.2">The new line is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2374.1">TEMPLATES = [
    {
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2375.1">'BACKEND'</span></span><span class="koboSpan" id="kobo.2376.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2377.1">'django.template.backends.django.DjangoTemplates'</span></span><span class="koboSpan" id="kobo.2378.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2379.1">'DIRS'</span></span><span class="koboSpan" id="kobo.2380.1">: [],
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2381.1">'APP_DIRS'</span></span><span class="koboSpan" id="kobo.2382.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2383.1">True</span></span><span class="koboSpan" id="kobo.2384.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2385.1">'OPTIONS'</span></span><span class="koboSpan" id="kobo.2386.1">: {
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.2387.1">'context_processors'</span></span><span class="koboSpan" id="kobo.2388.1">: [
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.2389.1">'django.template.context_processors.debug'</span></span><span class="koboSpan" id="kobo.2390.1">,
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.2391.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2392.1">django.template.context_processors.request'</span></span><span class="koboSpan" id="kobo.2393.1">,
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.2394.1">'django.contrib.auth.context_processors.auth'</span></span><span class="koboSpan" id="kobo.2395.1">,
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.2396.1">'django.contrib.messages.context_processors.messages'</span></span><span class="koboSpan" id="kobo.2397.1">,
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2398.1">'cart.context_processors.cart'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2399.1">,</span></strong></span><span class="koboSpan" id="kobo.2400.1">
            ],
        },
    },
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2401.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2402.1">cart</span></code><span class="koboSpan" id="kobo.2403.1"> context processor will be executed every time a template is rendered using Djangoâ€™s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2404.1">RequestContext</span></code><span class="koboSpan" id="kobo.2405.1">. </span><span class="koboSpan" id="kobo.2405.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2406.1">cart</span></code><span class="koboSpan" id="kobo.2407.1"> variable will be set in the context of your templates. </span><span class="koboSpan" id="kobo.2407.2">You can read more about </span><code class="inlineCode"><span class="koboSpan" id="kobo.2408.1">RequestContext</span></code><span class="koboSpan" id="kobo.2409.1"> at </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/api/#django.template.RequestContext"><span class="url"><span class="koboSpan" id="kobo.2410.1">https://docs.djangoproject.com/en/5.0/ref/templates/api/#django.template.RequestContext</span></span></a><span class="koboSpan" id="kobo.2411.1">.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.2412.1">Context processors are executed in all the requests that use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2413.1">RequestContext</span></code><span class="koboSpan" id="kobo.2414.1">. </span><span class="koboSpan" id="kobo.2414.2">You might want to create</span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.2415.1"> a custom template tag instead of a context processor if your functionality is not needed in all templates, especially if it involves database queries.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2416.1">Next, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2417.1">shop/base.html</span></code><span class="koboSpan" id="kobo.2418.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2419.1">shop</span></code><span class="koboSpan" id="kobo.2420.1"> application and find the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2421.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2422.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2423.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2424.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2425.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2426.1">&gt;</span></span><span class="koboSpan" id="kobo.2427.1">
  Your cart is empty.
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2428.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2429.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2430.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2431.1">Replace the previous lines with the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2432.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2433.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2434.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2435.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2436.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2437.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2438.1">  {% with total_items=cart|length %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2439.1">    {% if total_items &gt; 0 %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2440.1">      Your cart:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2441.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2442.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2443.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2444.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2445.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2446.1">cart:cart_detail</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2447.1">" %}"&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2448.1">        {{ total_items }} item{{ total_items|pluralize }},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2449.1">        ${{ cart.get_total_price }}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2450.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2451.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2452.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2453.1">    {% else %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2454.1">      Your cart is empty.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2455.1">    {% endif %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2456.1">  {% endwith %}</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2457.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2458.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2459.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2460.1">Restart the development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2461.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2462.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2463.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.2464.1"> in your browser and add some products to the cart.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2465.1">In the header of the website, you can now</span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.2466.1"> see the total number of items in the cart and the total cost, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2467.1"><img alt="Graphical user interface, website  Description automatically generated" src="../Images/B21088_08_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2468.1">Figure 8.12: The site header displaying the current items in the cart</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2469.1">Congratulations! </span><span class="koboSpan" id="kobo.2469.2">You have completed the shopping cart functionality. </span><span class="koboSpan" id="kobo.2469.3">This is a significant milestone in your online shop project. </span><span class="koboSpan" id="kobo.2469.4">Next, you are going to create the functionality to register customer orders, which is another foundational element of any e-commerce platform.</span></p>
<h1 class="heading-1" id="_idParaDest-245"><span class="koboSpan" id="kobo.2470.1">Registering customer orders</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2471.1">When a shopping cart is checked out, you need to save an order in the database. </span><span class="koboSpan" id="kobo.2471.2">Orders will contain information </span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.2472.1">about customers and the products they are buying.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2473.1">Create a new application for managing customer orders using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2474.1">python manage.py startapp orders
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2475.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2476.1">settings.py</span></code><span class="koboSpan" id="kobo.2477.1"> file of your project and add the new application to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2478.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.2479.1"> setting, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2480.1">INSTALLED_APPS = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2481.1"># ...</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2482.1">'cart.apps.CartConfig'</span></span><span class="koboSpan" id="kobo.2483.1">,
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2484.1">'orders.apps.OrdersConfig'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2485.1">,</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2486.1">'shop.apps.ShopConfig'</span></span><span class="koboSpan" id="kobo.2487.1">,
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2488.1">You have activated the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2489.1">orders</span></code><span class="koboSpan" id="kobo.2490.1"> application.</span></p>
<h2 class="heading-2" id="_idParaDest-246"><span class="koboSpan" id="kobo.2491.1">Creating order models</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2492.1">You will need a model to store</span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.2493.1"> the order details and a second model to store items bought, including their price and quantity. </span><span class="koboSpan" id="kobo.2493.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2494.1">models.py</span></code><span class="koboSpan" id="kobo.2495.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2496.1">orders</span></code><span class="koboSpan" id="kobo.2497.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2498.1">from</span></span><span class="koboSpan" id="kobo.2499.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2500.1">import</span></span><span class="koboSpan" id="kobo.2501.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2502.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2503.1">Order</span></span><span class="koboSpan" id="kobo.2504.1">(models.Model):
    first_name = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2505.1">50</span></span><span class="koboSpan" id="kobo.2506.1">)
    last_name = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2507.1">50</span></span><span class="koboSpan" id="kobo.2508.1">)
    email = models.EmailField()
    address = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2509.1">250</span></span><span class="koboSpan" id="kobo.2510.1">)
    postal_code = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2511.1">20</span></span><span class="koboSpan" id="kobo.2512.1">)
    city = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2513.1">100</span></span><span class="koboSpan" id="kobo.2514.1">)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2515.1">True</span></span><span class="koboSpan" id="kobo.2516.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2517.1">True</span></span><span class="koboSpan" id="kobo.2518.1">)
    paid = models.BooleanField(default=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2519.1">False</span></span><span class="koboSpan" id="kobo.2520.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2521.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2522.1">Meta</span></span><span class="koboSpan" id="kobo.2523.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.2524.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2525.1">-created'</span></span><span class="koboSpan" id="kobo.2526.1">]
        indexes = [
            models.Index(fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2527.1">'-created'</span></span><span class="koboSpan" id="kobo.2528.1">]),
        ]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2529.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2530.1">__str__</span></span><span class="koboSpan" id="kobo.2531.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2532.1">self</span></span><span class="koboSpan" id="kobo.2533.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2534.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2535.1">f'Order </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2536.1">{self.</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2537.1">id</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2538.1">}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2539.1">'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2540.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2541.1">get_total_cost</span></span><span class="koboSpan" id="kobo.2542.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2543.1">self</span></span><span class="koboSpan" id="kobo.2544.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2545.1">return</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2546.1">sum</span></span><span class="koboSpan" id="kobo.2547.1">(item.get_cost() </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2548.1">for</span></span><span class="koboSpan" id="kobo.2549.1"> item </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2550.1">in</span></span><span class="koboSpan" id="kobo.2551.1"> self.items.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2552.1">all</span></span><span class="koboSpan" id="kobo.2553.1">())
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2554.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2555.1">OrderItem</span></span><span class="koboSpan" id="kobo.2556.1">(models.Model):
    order = models.ForeignKey(
        Order,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2557.1">'items'</span></span><span class="koboSpan" id="kobo.2558.1">,
        on_delete=models.CASCADE
)
    product = models.ForeignKey(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2559.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2560.1">shop.Product'</span></span><span class="koboSpan" id="kobo.2561.1">,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2562.1">'order_items'</span></span><span class="koboSpan" id="kobo.2563.1">,
        on_delete=models.CASCADE
    )
    price = models.DecimalField(
        max_digits=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2564.1">10</span></span><span class="koboSpan" id="kobo.2565.1">,
        decimal_places=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2566.1">2</span></span>
<span class="hljs-number"> </span><span class="koboSpan" id="kobo.2567.1">)
    quantity = models.PositiveIntegerField(default=</span><span class="hljs-number"><span class="koboSpan" id="kobo.2568.1">1</span></span><span class="koboSpan" id="kobo.2569.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2570.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2571.1">__str__</span></span><span class="koboSpan" id="kobo.2572.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2573.1">self</span></span><span class="koboSpan" id="kobo.2574.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2575.1">return</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2576.1">str</span></span><span class="koboSpan" id="kobo.2577.1">(self.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2578.1">id</span></span><span class="koboSpan" id="kobo.2579.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2580.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2581.1">get_cost</span></span><span class="koboSpan" id="kobo.2582.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2583.1">self</span></span><span class="koboSpan" id="kobo.2584.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2585.1">return</span></span><span class="koboSpan" id="kobo.2586.1"> self.price * self.quantity
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2587.1">The order model contains </span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.2588.1">several fields to store customer information and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2589.1">paid</span></code><span class="koboSpan" id="kobo.2590.1"> Boolean field, which defaults to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2591.1">False</span></code><span class="koboSpan" id="kobo.2592.1">. </span><span class="koboSpan" id="kobo.2592.2">Later on, you are going to use this field to differentiate between paid and unpaid orders. </span><span class="koboSpan" id="kobo.2592.3">We have also defined a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2593.1">get_total_cost()</span></code><span class="koboSpan" id="kobo.2594.1"> method to obtain the total cost of the items bought in this order.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2595.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2596.1">OrderItem</span></code><span class="koboSpan" id="kobo.2597.1"> model allows you to store the product, quantity, and price paid for each item. </span><span class="koboSpan" id="kobo.2597.2">We have defined a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2598.1">get_cost()</span></code><span class="koboSpan" id="kobo.2599.1"> method that returns the cost of the item by multiplying the item price with the quantity. </span><span class="koboSpan" id="kobo.2599.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2600.1">product</span></code><span class="koboSpan" id="kobo.2601.1"> field, we use the string </span><code class="inlineCode"><span class="koboSpan" id="kobo.2602.1">'shop.Product'</span></code><span class="koboSpan" id="kobo.2603.1"> with the format </span><code class="inlineCode"><span class="koboSpan" id="kobo.2604.1">app.Model</span></code><span class="koboSpan" id="kobo.2605.1">, which is another way to point to related models and also a good method to avoid circular imports.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2606.1">Run the next command to </span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.2607.1">create initial migrations for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2608.1">orders</span></code><span class="koboSpan" id="kobo.2609.1"> application:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2610.1">python manage.py makemigrations
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2611.1">You will see output similar to the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2612.1">Migrations for 'orders':
  orders/migrations/0001_initial.py
    - Create model Order
    - Create model OrderItem
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2613.1">Run the following command to apply the new migration:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2614.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2615.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2616.1">Applying orders.0001_initial... </span><span class="koboSpan" id="kobo.2616.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2617.1">Your order models are now synced to the database.</span></p>
<h2 class="heading-2" id="_idParaDest-247"><span class="koboSpan" id="kobo.2618.1">Including order models in the administration site</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2619.1">Letâ€™s add the order models to the </span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.2620.1">administration site. </span><span class="koboSpan" id="kobo.2620.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2621.1">admin.py</span></code><span class="koboSpan" id="kobo.2622.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2623.1">orders</span></code><span class="koboSpan" id="kobo.2624.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2625.1">from</span></span><span class="koboSpan" id="kobo.2626.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2627.1">import</span></span><span class="koboSpan" id="kobo.2628.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2629.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2630.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2631.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2632.1"> Order, OrderItem</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2633.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2634.1">OrderItemInline</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2635.1">(admin.TabularInline):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2636.1">    model = OrderItem</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2637.1">    raw_id_fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2638.1">'product'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2639.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.2640.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2641.1">Order</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.2642.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2643.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2644.1">OrderAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2645.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2646.1">    list_display = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2647.1">'id'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2648.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2649.1">'first_name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2650.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2651.1">'last_name'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2652.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2653.1">'email'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2654.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2655.1">'address'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2656.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2657.1">'postal_code'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2658.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2659.1">'city'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2660.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2661.1">'paid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2662.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2663.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2664.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2665.1">'updated'</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"> </strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2666.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2667.1">    list_filter = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2668.1">'paid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2669.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2670.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2671.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2672.1">'updated'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2673.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2674.1">    inlines = [OrderItemInline]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2675.1">You use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2676.1">ModelInline</span></code><span class="koboSpan" id="kobo.2677.1"> class for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2678.1">OrderItem</span></code><span class="koboSpan" id="kobo.2679.1"> model to include it as an </span><em class="italic"><span class="koboSpan" id="kobo.2680.1">inline</span></em><span class="koboSpan" id="kobo.2681.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2682.1">OrderAdmin</span></code><span class="koboSpan" id="kobo.2683.1"> class. </span><span class="koboSpan" id="kobo.2683.2">An inline allows you to include a model on the same edit page as its related model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2684.1">Run the development </span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.2685.1">server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2686.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2687.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2688.1">http://127.0.0.1:8000/admin/orders/order/add/</span></code><span class="koboSpan" id="kobo.2689.1"> in your browser. </span><span class="koboSpan" id="kobo.2689.2">You will see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2690.1"><img alt="" role="presentation" src="../Images/B21088_08_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2691.1">Figure 8.13: The Add order form, including OrderItemInline</span></p>
<h2 class="heading-2" id="_idParaDest-248"><span class="koboSpan" id="kobo.2692.1">Creating customer orders</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2693.1">You will use the order models that you </span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.2694.1">created to persist the items contained in the shopping cart when the user finally places an order. </span><span class="koboSpan" id="kobo.2694.2">A new order will be created following these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2695.1">Present a user with an order form to fill in their data.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2696.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2697.1">Order</span></code><span class="koboSpan" id="kobo.2698.1"> instance with the data entered, and create an associated </span><code class="inlineCode"><span class="koboSpan" id="kobo.2699.1">OrderItem</span></code><span class="koboSpan" id="kobo.2700.1"> instance for each item in the cart.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2701.1">Clear all the cartâ€™s contents and redirect the user to a success page.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2702.1">First, you need a form to enter the order details. </span><span class="koboSpan" id="kobo.2702.2">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2703.1">orders</span></code><span class="koboSpan" id="kobo.2704.1"> application directory and </span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.2705.1">name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2706.1">forms.py</span></code><span class="koboSpan" id="kobo.2707.1">. </span><span class="koboSpan" id="kobo.2707.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2708.1">from</span></span><span class="koboSpan" id="kobo.2709.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2710.1">import</span></span><span class="koboSpan" id="kobo.2711.1"> forms
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2712.1">from</span></span><span class="koboSpan" id="kobo.2713.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2714.1">import</span></span><span class="koboSpan" id="kobo.2715.1"> Order
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2716.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2717.1">OrderCreateForm</span></span><span class="koboSpan" id="kobo.2718.1">(forms.ModelForm):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2719.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2720.1">Meta</span></span><span class="koboSpan" id="kobo.2721.1">:
        model = Order
        fields = [
</span><span class="hljs-string"><span class="koboSpan" id="kobo.2722.1">            'first_name'</span></span><span class="koboSpan" id="kobo.2723.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.2724.1">            'last_name'</span></span><span class="koboSpan" id="kobo.2725.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.2726.1">            'email'</span></span><span class="koboSpan" id="kobo.2727.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.2728.1">            'address'</span></span><span class="koboSpan" id="kobo.2729.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.2730.1">            'postal_code'</span></span><span class="koboSpan" id="kobo.2731.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.2732.1">            'city'</span></span>
<span class="hljs-string"> </span><span class="koboSpan" id="kobo.2733.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2734.1">This is the form that you are going to use to create new </span><code class="inlineCode"><span class="koboSpan" id="kobo.2735.1">Order</span></code><span class="koboSpan" id="kobo.2736.1"> objects. </span><span class="koboSpan" id="kobo.2736.2">Now you need a view to handle the form and create a new order. </span><span class="koboSpan" id="kobo.2736.3">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2737.1">views.py</span></code><span class="koboSpan" id="kobo.2738.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2739.1">orders</span></code><span class="koboSpan" id="kobo.2740.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2741.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2742.1"> cart.cart </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2743.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2744.1"> Cart</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2745.1">from</span></span><span class="koboSpan" id="kobo.2746.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2747.1">import</span></span><span class="koboSpan" id="kobo.2748.1"> render
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2749.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2750.1"> .forms </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2751.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2752.1"> OrderCreateForm</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2753.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2754.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2755.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2756.1"> OrderItem</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2757.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2758.1">order_create</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2759.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2760.1">request</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2761.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2762.1">    cart = Cart(request)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2763.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2764.1"> request.method == </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2765.1">'POST'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2766.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2767.1">        form = OrderCreateForm(request.POST)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2768.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2769.1"> form.is_valid():</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2770.1">            order = form.save()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2771.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2772.1"> item </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2773.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2774.1"> cart:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2775.1">                OrderItem.objects.create(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2776.1">                    order=order,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2777.1">                    product=item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2778.1">'product'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2779.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2780.1">                    price=item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2781.1">'price'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2782.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2783.1">                    quantity=item[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2784.1">'quantity'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2785.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2786.1">                )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2787.1"># clear the cart</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2788.1">            cart.clear()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2789.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2790.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2791.1">                request, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2792.1">'orders/order/created.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2793.1">, {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2794.1">'order'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2795.1">: order}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2796.1">            )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2797.1">else</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2798.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2799.1">        form = OrderCreateForm()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2800.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2801.1"> render(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2802.1">        request,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2803.1">'orders/order/create.html'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2804.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2805.1">        {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2806.1">'cart'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2807.1">: cart, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2808.1">'form'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2809.1">: form}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2810.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2811.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2812.1">order_create</span></code><span class="koboSpan" id="kobo.2813.1"> view, you </span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.2814.1">obtain the current cart from the session with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2815.1">cart = Cart(request)</span></code><span class="koboSpan" id="kobo.2816.1">. </span><span class="koboSpan" id="kobo.2816.2">Depending on the request method, you perform the following tasks:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.2817.1">GET request</span></strong><span class="koboSpan" id="kobo.2818.1">: Instantiates </span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.2819.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2820.1">OrderCreateForm</span></code><span class="koboSpan" id="kobo.2821.1"> form and renders the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2822.1">orders/order/create.html</span></code><span class="koboSpan" id="kobo.2823.1"> template.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.2824.1">POST request</span></strong><span class="koboSpan" id="kobo.2825.1">: Validates the</span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.2826.1"> data sent in the request. </span><span class="koboSpan" id="kobo.2826.2">If the data is valid, you create a new order in the database using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2827.1">order = form.save()</span></code><span class="koboSpan" id="kobo.2828.1">. </span><span class="koboSpan" id="kobo.2828.2">You iterate over the cart items and create an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2829.1">OrderItem</span></code><span class="koboSpan" id="kobo.2830.1"> for each of them. </span><span class="koboSpan" id="kobo.2830.2">Finally, you clear the cartâ€™s contents and render the template </span><code class="inlineCode"><span class="koboSpan" id="kobo.2831.1">orders/order/created.html</span></code><span class="koboSpan" id="kobo.2832.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2833.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2834.1">orders</span></code><span class="koboSpan" id="kobo.2835.1"> application directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2836.1">urls.py</span></code><span class="koboSpan" id="kobo.2837.1">. </span><span class="koboSpan" id="kobo.2837.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2838.1">from</span></span><span class="koboSpan" id="kobo.2839.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2840.1">import</span></span><span class="koboSpan" id="kobo.2841.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2842.1">from</span></span><span class="koboSpan" id="kobo.2843.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2844.1">import</span></span><span class="koboSpan" id="kobo.2845.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2846.1">'orders'</span></span><span class="koboSpan" id="kobo.2847.1">
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2848.1">'create/'</span></span><span class="koboSpan" id="kobo.2849.1">, views.order_create, name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2850.1">'order_create'</span></span><span class="koboSpan" id="kobo.2851.1">),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2852.1">This is the URL pattern for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2853.1">order_create</span></code><span class="koboSpan" id="kobo.2854.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2855.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2856.1">urls.py</span></code><span class="koboSpan" id="kobo.2857.1"> file of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2858.1">myshop</span></code><span class="koboSpan" id="kobo.2859.1"> and include the following pattern. </span><span class="koboSpan" id="kobo.2859.2">Remember to place it before the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2860.1">shop.urls</span></code><span class="koboSpan" id="kobo.2861.1"> pattern, as follows. </span><span class="koboSpan" id="kobo.2861.2">The new line is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2862.1">urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2863.1">'admin/'</span></span><span class="koboSpan" id="kobo.2864.1">, admin.site.urls),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2865.1">'cart/'</span></span><span class="koboSpan" id="kobo.2866.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2867.1">'cart.urls'</span></span><span class="koboSpan" id="kobo.2868.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2869.1">'cart'</span></span><span class="koboSpan" id="kobo.2870.1">)),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2871.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2872.1">'orders/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2873.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2874.1">'orders.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2875.1">, namespace=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2876.1">'orders'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2877.1">)),</span></strong></span><span class="koboSpan" id="kobo.2878.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2879.1">''</span></span><span class="koboSpan" id="kobo.2880.1">, include(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2881.1">'shop.urls'</span></span><span class="koboSpan" id="kobo.2882.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2883.1">'shop'</span></span><span class="koboSpan" id="kobo.2884.1">)),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2885.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2886.1">cart/detail.html</span></code><span class="koboSpan" id="kobo.2887.1"> template</span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.2888.1"> of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2889.1">cart</span></code><span class="koboSpan" id="kobo.2890.1"> application and find this line:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2891.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2892.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2893.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2894.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2895.1">"#"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2896.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2897.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2898.1">"button"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2899.1">&gt;</span></span><span class="koboSpan" id="kobo.2900.1">Checkout</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2901.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2902.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2903.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2904.1">Add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2905.1">order_create</span></code><span class="koboSpan" id="kobo.2906.1"> URL to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2907.1">href</span></code><span class="koboSpan" id="kobo.2908.1"> HTML attribute, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2909.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2910.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2911.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2912.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2913.1">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2914.1">{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2915.1">orders:order_create</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2916.1">" %}</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.2917.1">"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2918.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2919.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2920.1">"button"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2921.1">&gt;</span></span><span class="koboSpan" id="kobo.2922.1">
  Checkout
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2923.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2924.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2925.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2926.1">Users can now navigate from the cart detail page to the order form.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2927.1">You still need to define templates for creating orders. </span><span class="koboSpan" id="kobo.2927.2">Create the following file structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2928.1">orders</span></code><span class="koboSpan" id="kobo.2929.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2930.1">templates/
    orders/
        order/
            create.html
            created.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2931.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2932.1">orders/order/create.html</span></code><span class="koboSpan" id="kobo.2933.1"> template and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2934.1">{% extends "shop/base.html" %}
{% block title %}
  Checkout
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2935.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2936.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2937.1">&gt;</span></span><span class="koboSpan" id="kobo.2938.1">Checkout</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2939.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2940.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2941.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2942.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2943.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2944.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2945.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2946.1">"order-info"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2947.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2948.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2949.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2950.1">&gt;</span></span><span class="koboSpan" id="kobo.2951.1">Your order</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2952.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2953.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2954.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2955.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2956.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2957.1">&gt;</span></span><span class="koboSpan" id="kobo.2958.1">
      {% for item in cart %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2959.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2960.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2961.1">&gt;</span></span><span class="koboSpan" id="kobo.2962.1">
          {{ item.quantity }}x {{ item.product.name }}
          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2963.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2964.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2965.1">&gt;</span></span><span class="koboSpan" id="kobo.2966.1">${{ item.total_price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2967.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2968.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2969.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2970.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2971.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2972.1">&gt;</span></span><span class="koboSpan" id="kobo.2973.1">
      {% endfor %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2974.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2975.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2976.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2977.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2978.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2979.1">&gt;</span></span><span class="koboSpan" id="kobo.2980.1">Total: ${{ cart.get_total_price }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2981.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2982.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2983.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2984.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2985.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2986.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2987.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2988.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2989.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2990.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2991.1">"post"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2992.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2993.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2994.1">"order-form"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2995.1">&gt;</span></span><span class="koboSpan" id="kobo.2996.1">
    {{ form.as_p }}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2997.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2998.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2999.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3000.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.3001.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3002.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3003.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.3004.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3005.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3006.1">"Place order"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3007.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3008.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3009.1">&gt;</span></span><span class="koboSpan" id="kobo.3010.1">
    {% csrf_token %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.3011.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3012.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3013.1">&gt;</span></span><span class="koboSpan" id="kobo.3014.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3015.1">This template displays the cart</span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.3016.1"> items, including totals and the form to place an order.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3017.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3018.1">orders/order/created.html</span></code><span class="koboSpan" id="kobo.3019.1"> template and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3020.1">{% extends "shop/base.html" %}
{% block title %}
  Thank you
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.3021.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3022.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3023.1">&gt;</span></span><span class="koboSpan" id="kobo.3024.1">Thank you</span><span class="hljs-tag"><span class="koboSpan" id="kobo.3025.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3026.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3027.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.3028.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3029.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3030.1">&gt;</span></span><span class="koboSpan" id="kobo.3031.1">Your order has been successfully completed. </span><span class="koboSpan" id="kobo.3031.2">Your order number is
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.3032.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3033.1">strong</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3034.1">&gt;</span></span><span class="koboSpan" id="kobo.3035.1">{{ order.id }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.3036.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3037.1">strong</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3038.1">&gt;</span></span><span class="koboSpan" id="kobo.3039.1">.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.3040.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3041.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3042.1">&gt;</span></span><span class="koboSpan" id="kobo.3043.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3044.1">This is the template that you render when the order is successfully created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3045.1">Start the web development server to load new files. </span><span class="koboSpan" id="kobo.3045.2">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3046.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.3047.1"> in your browser, add a couple of products to the cart, and continue to the checkout page. </span><span class="koboSpan" id="kobo.3047.2">You will see the following form:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3048.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_08_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3049.1">Figure 8.14: The order creation page, including the chart checkout form and order details</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3050.1">Fill in the form with</span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.3051.1"> valid data and click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.3052.1">Place order</span></strong><span class="koboSpan" id="kobo.3053.1"> button. </span><span class="koboSpan" id="kobo.3053.2">The order will be created, and you will see a success page like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3054.1"><img alt="A picture containing text  Description automatically generated" src="../Images/B21088_08_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3055.1">Figure 8.15: The order created template displaying the order number</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3056.1">The order has been registered and the cart has been cleared.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3057.1">You might have </span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.3058.1">noticed that the message </span><strong class="screenText"><span class="koboSpan" id="kobo.3059.1">Your cart is empty</span></strong><span class="koboSpan" id="kobo.3060.1"> is displayed in the header when an order is completed. </span><span class="koboSpan" id="kobo.3060.2">This is because the cart has been cleared. </span><span class="koboSpan" id="kobo.3060.3">We can easily avoid this message for views that have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.3061.1">order</span></code><span class="koboSpan" id="kobo.3062.1"> object in the template context.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3063.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3064.1">shop/base.html</span></code><span class="koboSpan" id="kobo.3065.1"> template of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3066.1">shop</span></code><span class="koboSpan" id="kobo.3067.1"> application and replace the following line highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3068.1">...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.3069.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3070.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.3071.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3072.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3073.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3074.1">&gt;</span></span><span class="koboSpan" id="kobo.3075.1">
  {% with total_items=cart|length %}
    {% if total_items &gt; 0 %}
      Your cart:
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.3076.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3077.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.3078.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3079.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3080.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.3081.1">cart:cart_detail</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3082.1">" %}"&gt;</span></span><span class="koboSpan" id="kobo.3083.1">
        {{ total_items }} item{{ total_items|pluralize }},
        ${{ cart.get_total_price }}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.3084.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3085.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3086.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3087.1">    {% elif not order %}</span></strong></span><span class="koboSpan" id="kobo.3088.1">
      Your cart is empty.
    </span><span class="koboSpan" id="kobo.3088.2">{% endif %}
  {% endwith %}
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.3089.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.3090.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.3091.1">&gt;</span></span><span class="koboSpan" id="kobo.3092.1">
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3093.1">The message </span><strong class="screenText"><span class="koboSpan" id="kobo.3094.1">Your cart is empty</span></strong><span class="koboSpan" id="kobo.3095.1"> will not be displayed anymore when an order is created.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3096.1">Now open the administration site at </span><code class="inlineCode"><span class="koboSpan" id="kobo.3097.1">http://127.0.0.1:8000/admin/orders/order/</span></code><span class="koboSpan" id="kobo.3098.1">. </span><span class="koboSpan" id="kobo.3098.2">You will see that the order has been successfully created, like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3099.1"><img alt="" role="presentation" src="../Images/B21088_08_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3100.1">Figure 8.16: The order change list section of the administration site, including the order created</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3101.1">You have implemented</span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.3102.1"> the order system. </span><span class="koboSpan" id="kobo.3102.2">Now you will learn how to create asynchronous tasks to send confirmation emails to users when they place an order.</span></p>
<h1 class="heading-1" id="_idParaDest-249"><span class="koboSpan" id="kobo.3103.1">Creating asynchronous tasks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3104.1">When receiving an HTTP request, you need to</span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.3105.1"> return a response to the user as quickly as possible. </span><span class="koboSpan" id="kobo.3105.2">Remember that in </span><em class="chapterRef"><span class="koboSpan" id="kobo.3106.1">Chapter 7</span></em><span class="koboSpan" id="kobo.3107.1">, </span><em class="italic"><span class="koboSpan" id="kobo.3108.1">Tracking User Actions</span></em><span class="koboSpan" id="kobo.3109.1">, you used the Django Debug Toolbar to check the time for the different phases of the request/response cycle and the execution time for the SQL queries performed. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.3110.1">Every task executed during the course of the request/response cycle adds up to the total response time. </span><span class="koboSpan" id="kobo.3110.2">Long-running tasks can seriously slow down the server response. </span><span class="koboSpan" id="kobo.3110.3">How do we return a fast response to the user while still completing time-consuming tasks? </span><span class="koboSpan" id="kobo.3110.4">We can do it with asynchronous execution.</span></p>
<h2 class="heading-2" id="_idParaDest-250"><span class="koboSpan" id="kobo.3111.1">Working with asynchronous tasks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3112.1">We can offload work from the</span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.3113.1"> request/response cycle by executing certain tasks in the background. </span><span class="koboSpan" id="kobo.3113.2">For example, a video-sharing platform allows users to upload videos but requires a long time to transcode uploaded videos. </span><span class="koboSpan" id="kobo.3113.3">When the user uploads a video, the site might return a response informing them that the transcoding will start soon and start transcoding the video asynchronously. </span><span class="koboSpan" id="kobo.3113.4">Another</span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.3114.1"> example is sending emails to users. </span><span class="koboSpan" id="kobo.3114.2">If your site sends email notifications from a view, the </span><strong class="keyWord"><span class="koboSpan" id="kobo.3115.1">Simple Mail Transfer Protocol</span></strong><span class="koboSpan" id="kobo.3116.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.3117.1">SMTP</span></strong><span class="koboSpan" id="kobo.3118.1">) connection might fail or slow down the response. </span><span class="koboSpan" id="kobo.3118.2">By sending the email asynchronously, you avoid blocking the code execution.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3119.1">Asynchronous execution is </span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.3120.1">especially relevant for data-intensive, resource-intensive, and time-consuming processes or processes subject to failure, which might require a retry policy.</span></p>
<h2 class="heading-2" id="_idParaDest-251"><span class="koboSpan" id="kobo.3121.1">Workers, message queues, and message brokers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.3122.1">While your web server processes requests and returns responses, you need a second task-based server, named </span><strong class="keyWord"><span class="koboSpan" id="kobo.3123.1">worker</span></strong><span class="koboSpan" id="kobo.3124.1">, to process</span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.3125.1"> the asynchronous tasks. </span><span class="koboSpan" id="kobo.3125.2">One or multiple workers can be running and executing tasks in the background. </span><span class="koboSpan" id="kobo.3125.3">These workers can access the database, process files, send emails, and so on. </span><span class="koboSpan" id="kobo.3125.4">Workers can even queue future tasks, all while keeping the main web server free to process HTTP requests.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3126.1">To tell the workers what tasks to execute, we need to</span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.3127.1"> send </span><strong class="keyWord"><span class="koboSpan" id="kobo.3128.1">messages</span></strong><span class="koboSpan" id="kobo.3129.1">. </span><span class="koboSpan" id="kobo.3129.2">We communicate with brokers by adding messages to a </span><strong class="keyWord"><span class="koboSpan" id="kobo.3130.1">message queue</span></strong><span class="koboSpan" id="kobo.3131.1">, which is basically a </span><strong class="keyWord"><span class="koboSpan" id="kobo.3132.1">first in, first out</span></strong><span class="koboSpan" id="kobo.3133.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.3134.1">FIFO</span></strong><span class="koboSpan" id="kobo.3135.1">) data structure. </span><span class="koboSpan" id="kobo.3135.2">When</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.3136.1"> a broker becomes available, it takes </span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.3137.1">the first message from the queue and starts executing the corresponding task. </span><span class="koboSpan" id="kobo.3137.2">When finished, the broker takes the next message from the queue and executes the corresponding task. </span><span class="koboSpan" id="kobo.3137.3">Brokers become idle when the message queue is empty. </span><span class="koboSpan" id="kobo.3137.4">When using multiple brokers, each broker takes the first available message in order when they become available. </span><span class="koboSpan" id="kobo.3137.5">The queue ensures that each broker only gets one task at a time and that no task is processed by more than one worker.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.3138.1">Figure 8.17</span></em><span class="koboSpan" id="kobo.3139.1"> shows how a message queue works:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3140.1"><img alt="Shape  Description automatically generated with medium confidence" src="../Images/B21088_08_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3141.1">Figure 8.17: Asynchronous execution using a message queue and workers</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3142.1">A producer sends a message to the queue, and the worker(s) consumes the messages on a first-come, first-served basis; the first message added to the message queue is the first message to be processed by the worker(s).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3143.1">In order to manage the message queue, we need a </span><strong class="keyWord"><span class="koboSpan" id="kobo.3144.1">message broker</span></strong><span class="koboSpan" id="kobo.3145.1">. </span><span class="koboSpan" id="kobo.3145.2">The message broker is used to translate messages to a </span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.3146.1">formal messaging protocol and manage message queues for multiple receivers. </span><span class="koboSpan" id="kobo.3146.2">It provides reliable storage and guaranteed message delivery. </span><span class="koboSpan" id="kobo.3146.3">The message broker allows us to create message queues, route messages, distribute messages among workers, and so on.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3147.1">To implement asynchronous tasks in your project, you will use Celery for managing task queues and RabbitMQ as the message broker Celery employs. </span><span class="koboSpan" id="kobo.3147.2">Both technologies will be introduced in the following section.</span></p>
<h3 class="heading-3" id="_idParaDest-252"><span class="koboSpan" id="kobo.3148.1">Using Django with Celery and RabbitMQ</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.3149.1">Celery is a distributed task queue that can</span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.3150.1"> process vast amounts of messages. </span><span class="koboSpan" id="kobo.3150.2">We will use Celery to define asynchronous tasks as Python functions within our Django applications. </span><span class="koboSpan" id="kobo.3150.3">We will run Celery workers that will listen to the message broker to get new messages to</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.3151.1"> process asynchronous tasks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3152.1">Using Celery, not only can </span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.3153.1">you create asynchronous tasks easily and let them be executed by workers as soon as possible but you can also schedule them to run at a specific time. </span><span class="koboSpan" id="kobo.3153.2">You can find the Celery documentation at </span><a href="https://docs.celeryq.dev/en/stable/index.html"><span class="url"><span class="koboSpan" id="kobo.3154.1">https://docs.celeryq.dev/en/stable/index.html</span></span></a><span class="koboSpan" id="kobo.3155.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3156.1">Celery communicates via messages and requires a message broker to mediate between clients and workers. </span><span class="koboSpan" id="kobo.3156.2">There are</span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.3157.1"> several options for a message broker for Celery, including key/value stores such as Redis, or an actual message broker such as RabbitMQ.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3158.1">RabbitMQ is the most widely deployed message broker. </span><span class="koboSpan" id="kobo.3158.2">It supports multiple messaging protocols, such as the </span><strong class="keyWord"><span class="koboSpan" id="kobo.3159.1">Advanced Message Queuing Protocol</span></strong><span class="koboSpan" id="kobo.3160.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.3161.1">AMQP</span></strong><span class="koboSpan" id="kobo.3162.1">), and it is the recommended message </span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.3163.1">worker for Celery. </span><span class="koboSpan" id="kobo.3163.2">RabbitMQ is lightweight, easy to deploy, and can be configured for scalability and high availability.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.3164.1">Figure 8.18</span></em><span class="koboSpan" id="kobo.3165.1"> shows how we will use Django, Celery, and RabbitMQ to execute asynchronous tasks:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3166.1"><img alt="A picture containing diagram  Description automatically generated" src="../Images/B21088_08_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3167.1">Figure 8.18: Architecture for asynchronous tasks with Django, RabbitMQ, and Celery</span></p>
<h4 class="heading-4"><span class="koboSpan" id="kobo.3168.1">Installing Celery</span></h4>
<p class="normal"><span class="koboSpan" id="kobo.3169.1">Letâ€™s install Celery and integrate it into</span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.3170.1"> the project. </span><span class="koboSpan" id="kobo.3170.2">Install Celery via </span><code class="inlineCode"><span class="koboSpan" id="kobo.3171.1">pip</span></code><span class="koboSpan" id="kobo.3172.1"> using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3173.1">python -m pip install celery==5.4.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3174.1">You can find an introduction to Celery at </span><a href="https://docs.celeryq.dev/en/stable/getting-started/introduction.html"><span class="url"><span class="koboSpan" id="kobo.3175.1">https://docs.celeryq.dev/en/stable/getting-started/introduction.html</span></span></a><span class="koboSpan" id="kobo.3176.1">.</span></p>
<h4 class="heading-4"><span class="koboSpan" id="kobo.3177.1">Installing RabbitMQ</span></h4>
<p class="normal"><span class="koboSpan" id="kobo.3178.1">The RabbitMQ community provides a</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.3179.1"> Docker image that makes it very easy to deploy a RabbitMQ server with a standard configuration. </span><span class="koboSpan" id="kobo.3179.2">Remember that you learned how to install Docker in </span><em class="chapterRef"><span class="koboSpan" id="kobo.3180.1">Chapter 3</span></em><span class="koboSpan" id="kobo.3181.1">, </span><em class="italic"><span class="koboSpan" id="kobo.3182.1">Extending Your Blog Application</span></em><span class="koboSpan" id="kobo.3183.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3184.1">After installing Docker on your machine, you can easily pull the RabbitMQ Docker image by running the following command from the shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3185.1">docker pull rabbitmq:3.13.1-management
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3186.1">This will download the RabbitMQ Docker image to your local machine. </span><span class="koboSpan" id="kobo.3186.2">You can find information about the official RabbitMQ Docker image at </span><a href="https://hub.docker.com/_/rabbitmq"><span class="url"><span class="koboSpan" id="kobo.3187.1">https://hub.docker.com/_/rabbitmq</span></span></a><span class="koboSpan" id="kobo.3188.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3189.1">If you want to install RabbitMQ natively on your machine instead of using Docker, you will find detailed installation guides for different operating systems at </span><a href="https://www.rabbitmq.com/download.html"><span class="url"><span class="koboSpan" id="kobo.3190.1">https://www.rabbitmq.com/download.html</span></span></a><span class="koboSpan" id="kobo.3191.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3192.1">Execute the following command in the shell to start the RabbitMQ server with Docker:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3193.1">docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.13.1-management
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3194.1">With this command, we are</span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.3195.1"> telling RabbitMQ to run on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.3196.1">5672</span></code><span class="koboSpan" id="kobo.3197.1">, and we are running its web-based management user interface on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.3198.1">15672</span></code><span class="koboSpan" id="kobo.3199.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3200.1">You will see output that includes the following lines:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3201.1">Starting broker...
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3202.1">...</span></span><span class="koboSpan" id="kobo.3203.1">
completed with 4 plugins.
</span><span class="koboSpan" id="kobo.3203.2">Server startup complete; 4 plugins started.
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3204.1">RabbitMQ is running on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.3205.1">5672</span></code><span class="koboSpan" id="kobo.3206.1"> and ready to receive messages.</span></p>
<h4 class="heading-4"><span class="koboSpan" id="kobo.3207.1">Accessing RabbitMQâ€™s management interface</span></h4>
<p class="normal"><span class="koboSpan" id="kobo.3208.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3209.1">http://127.0.0.1:15672/</span></code><span class="koboSpan" id="kobo.3210.1"> in your </span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.3211.1">browser. </span><span class="koboSpan" id="kobo.3211.2">You will see the login screen for the management UI of RabbitMQ. </span><span class="koboSpan" id="kobo.3211.3">It will look like this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3212.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_08_19.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3213.1">Figure 8.19: The RabbitMQ management UI login screen</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3214.1">Enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.3215.1">guest</span></code><span class="koboSpan" id="kobo.3216.1"> as both the username and the password and click on </span><strong class="screenText"><span class="koboSpan" id="kobo.3217.1">Login</span></strong><span class="koboSpan" id="kobo.3218.1">. </span><span class="koboSpan" id="kobo.3218.2">You will see the following screen:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3219.1"><img alt="" role="presentation" src="../Images/B21088_08_20.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3220.1">Figure 8.20: The RabbitMQ management UI dashboard</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3221.1">This is the default admin user for RabbitMQ. </span><span class="koboSpan" id="kobo.3221.2">On this screen, you can monitor the current activity for </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.3222.1">RabbitMQ. </span><span class="koboSpan" id="kobo.3222.2">You can see that there is one node running with no connections or queues registered.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3223.1">If you use RabbitMQ in a production environment, you will need to create a new admin user and remove the default </span><code class="inlineCode"><span class="koboSpan" id="kobo.3224.1">guest</span></code><span class="koboSpan" id="kobo.3225.1"> user. </span><span class="koboSpan" id="kobo.3225.2">You can do that in the </span><strong class="screenText"><span class="koboSpan" id="kobo.3226.1">Admin</span></strong><span class="koboSpan" id="kobo.3227.1"> section of the management UI.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3228.1">Now we will add Celery to the project. </span><span class="koboSpan" id="kobo.3228.2">Then, we will run Celery and test the connection to RabbitMQ.</span></p>
<h4 class="heading-4"><span class="koboSpan" id="kobo.3229.1">Adding Celery to your project</span></h4>
<p class="normal"><span class="koboSpan" id="kobo.3230.1">You have to provide a configuration for the </span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.3231.1">Celery instance. </span><span class="koboSpan" id="kobo.3231.2">Create a new file next to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3232.1">settings.py</span></code><span class="koboSpan" id="kobo.3233.1"> file of </span><code class="inlineCode"><span class="koboSpan" id="kobo.3234.1">myshop</span></code><span class="koboSpan" id="kobo.3235.1"> and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.3236.1">celery.py</span></code><span class="koboSpan" id="kobo.3237.1">. </span><span class="koboSpan" id="kobo.3237.2">This file will contain the Celery configuration for your project. </span><span class="koboSpan" id="kobo.3237.3">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3238.1">import</span></span><span class="koboSpan" id="kobo.3239.1"> os
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3240.1">from</span></span><span class="koboSpan" id="kobo.3241.1"> celery </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3242.1">import</span></span><span class="koboSpan" id="kobo.3243.1"> Celery
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.3244.1"># set the default Django settings module for the 'celery' program.</span></span><span class="koboSpan" id="kobo.3245.1">
os.environ.setdefault(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3246.1">'DJANGO_SETTINGS_MODULE'</span></span><span class="koboSpan" id="kobo.3247.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3248.1">'myshop.settings'</span></span><span class="koboSpan" id="kobo.3249.1">)
app = Celery(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3250.1">'myshop'</span></span><span class="koboSpan" id="kobo.3251.1">)
app.config_from_object(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3252.1">'django.conf:settings'</span></span><span class="koboSpan" id="kobo.3253.1">, namespace=</span><span class="hljs-string"><span class="koboSpan" id="kobo.3254.1">'CELERY'</span></span><span class="koboSpan" id="kobo.3255.1">)
app.autodiscover_tasks()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3256.1">In this code, you do the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3257.1">You set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3258.1">DJANGO_SETTINGS_MODULE</span></code><span class="koboSpan" id="kobo.3259.1"> variable for the Celery command-line program.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3260.1">You create an instance of the application with </span><code class="inlineCode"><span class="koboSpan" id="kobo.3261.1">app = Celery('myshop')</span></code><span class="koboSpan" id="kobo.3262.1">.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3263.1">You load any </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.3264.1">custom configuration from your project settings using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3265.1">config_from_object()</span></code><span class="koboSpan" id="kobo.3266.1"> method. </span><span class="koboSpan" id="kobo.3266.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3267.1">namespace</span></code><span class="koboSpan" id="kobo.3268.1"> attribute specifies the prefix that Celery-related settings will have in your </span><code class="inlineCode"><span class="koboSpan" id="kobo.3269.1">settings.py</span></code><span class="koboSpan" id="kobo.3270.1"> file. </span><span class="koboSpan" id="kobo.3270.2">By setting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3271.1">CELERY</span></code><span class="koboSpan" id="kobo.3272.1"> namespace, all Celery settings need to include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3273.1">CELERY_</span></code><span class="koboSpan" id="kobo.3274.1"> prefix in their name (for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.3275.1">CELERY_BROKER_URL</span></code><span class="koboSpan" id="kobo.3276.1">).</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3277.1">Finally, you tell Celery to auto-discover asynchronous tasks for your applications. </span><span class="koboSpan" id="kobo.3277.2">Celery will look for a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3278.1">tasks.py</span></code><span class="koboSpan" id="kobo.3279.1"> file in each application directory of applications added to </span><code class="inlineCode"><span class="koboSpan" id="kobo.3280.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.3281.1"> in order to load asynchronous tasks defined in it.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.3282.1">You need to import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3283.1">celery</span></code><span class="koboSpan" id="kobo.3284.1"> module in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3285.1">__init__.py</span></code><span class="koboSpan" id="kobo.3286.1"> file of your project to ensure it is loaded when Django starts.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3287.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3288.1">myshop/__init__.py</span></code><span class="koboSpan" id="kobo.3289.1"> file and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.3290.1"># import celery</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3291.1">from</span></span><span class="koboSpan" id="kobo.3292.1"> .celery </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3293.1">import</span></span><span class="koboSpan" id="kobo.3294.1"> app </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3295.1">as</span></span><span class="koboSpan" id="kobo.3296.1"> celery_app
__all__ = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.3297.1">'celery_app'</span></span><span class="koboSpan" id="kobo.3298.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3299.1">You have added Celery to the Django project, and you can now start using it.</span></p>
<h4 class="heading-4"><span class="koboSpan" id="kobo.3300.1">Running a Celery worker</span></h4>
<p class="normal"><span class="koboSpan" id="kobo.3301.1">A Celery worker is a process that</span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.3302.1"> handles bookkeeping features like sending/receiving queue messages, registering tasks, killing hung tasks, tracking status, and so on. </span><span class="koboSpan" id="kobo.3302.2">A worker instance can consume from any number of message queues.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3303.1">Open another shell and start a Celery worker from your project directory, using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3304.1">celery -A myshop worker -l info
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3305.1">The Celery worker is now running and ready to process tasks. </span><span class="koboSpan" id="kobo.3305.2">Letâ€™s check if there is a connection between Celery and </span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.3306.1">RabbitMQ.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3307.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3308.1">http://127.0.0.1:15672/</span></code><span class="koboSpan" id="kobo.3309.1"> in your browser to access the RabbitMQ management UI. </span><span class="koboSpan" id="kobo.3309.2">You will now see a graph under </span><strong class="screenText"><span class="koboSpan" id="kobo.3310.1">Queued messages</span></strong><span class="koboSpan" id="kobo.3311.1"> and another graph under </span><strong class="screenText"><span class="koboSpan" id="kobo.3312.1">Message rates</span></strong><span class="koboSpan" id="kobo.3313.1">, as in </span><em class="italic"><span class="koboSpan" id="kobo.3314.1">Figure 8.21</span></em><span class="koboSpan" id="kobo.3315.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3316.1"><img alt="" role="presentation" src="../Images/B21088_08_21.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3317.1">Figure 8.21: The RabbitMQ management dashboard displaying connections and queues</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3318.1">Obviously, there are no queued messages as we havenâ€™t sent any messages to the message queue yet. </span><span class="koboSpan" id="kobo.3318.2">The graph under </span><strong class="screenText"><span class="koboSpan" id="kobo.3319.1">Message rates</span></strong><span class="koboSpan" id="kobo.3320.1"> should update every five seconds; you can see the refresh rate at the top right of the screen. </span><span class="koboSpan" id="kobo.3320.2">This time, both </span><strong class="screenText"><span class="koboSpan" id="kobo.3321.1">Connections</span></strong><span class="koboSpan" id="kobo.3322.1"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.3323.1">Queues</span></strong><span class="koboSpan" id="kobo.3324.1"> should display a number higher than zero.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3325.1">Now we can start programming asynchronous tasks.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.3326.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3327.1">CELERY_ALWAYS_EAGER</span></code><span class="koboSpan" id="kobo.3328.1"> setting allows you to execute tasks locally in a synchronous manner instead of sending them to the queue. </span><span class="koboSpan" id="kobo.3328.2">This is useful for running unit tests or executing the application in your local environment without running Celery.</span></p>
</div>
<h4 class="heading-4"><span class="koboSpan" id="kobo.3329.1">Adding asynchronous tasks to your application</span></h4>
<p class="normal"><span class="koboSpan" id="kobo.3330.1">Letâ€™s send a confirmation email to the user whenever an order is placed in the online shop. </span><span class="koboSpan" id="kobo.3330.2">We will implement </span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.3331.1">sending the email in a Python function and register it as a task with Celery. </span><span class="koboSpan" id="kobo.3331.2">Then, we will add it to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3332.1">order_create</span></code><span class="koboSpan" id="kobo.3333.1"> view to execute the task asynchronously.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3334.1">When the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3335.1">order_create</span></code><span class="koboSpan" id="kobo.3336.1"> view is executed, Celery will send the message to a message queue managed by RabbitMQ and then a Celery broker will execute the asynchronous task that we defined with a Python function.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3337.1">The convention for easy task discovery by Celery is to define asynchronous tasks for your application in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3338.1">tasks</span></code><span class="koboSpan" id="kobo.3339.1"> module within the application directory.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3340.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3341.1">orders</span></code><span class="koboSpan" id="kobo.3342.1"> application and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.3343.1">tasks.py</span></code><span class="koboSpan" id="kobo.3344.1">. </span><span class="koboSpan" id="kobo.3344.2">This is the place where Celery will look for asynchronous tasks. </span><span class="koboSpan" id="kobo.3344.3">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3345.1">from</span></span><span class="koboSpan" id="kobo.3346.1"> celery </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3347.1">import</span></span><span class="koboSpan" id="kobo.3348.1"> shared_task
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3349.1">from</span></span><span class="koboSpan" id="kobo.3350.1"> django.core.mail </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3351.1">import</span></span><span class="koboSpan" id="kobo.3352.1"> send_mail
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3353.1">from</span></span><span class="koboSpan" id="kobo.3354.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3355.1">import</span></span><span class="koboSpan" id="kobo.3356.1"> Order
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.3357.1">@shared_task</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3358.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3359.1">order_created</span></span><span class="koboSpan" id="kobo.3360.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.3361.1">order_id</span></span><span class="koboSpan" id="kobo.3362.1">):
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.3363.1">"""</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.3364.1">    Task to send an e-mail notification when an order is</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.3365.1">    successfully created.</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.3366.1">    """</span></span><span class="koboSpan" id="kobo.3367.1">
    order = Order.objects.get(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3368.1">id</span></span><span class="koboSpan" id="kobo.3369.1">=order_id)
    subject = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3370.1">f'Order nr. </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.3371.1">{order.</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3372.1">id</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.3373.1">}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3374.1">'</span></span><span class="koboSpan" id="kobo.3375.1">
    message = (
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.3376.1">f'Dear </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.3377.1">{order.first_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3378.1">,\n\n'</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.3379.1">f'You have successfully placed an order.'</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.3380.1">f'Your order ID is </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.3381.1">{order.</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3382.1">id</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.3383.1">}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3384.1">.'</span></span><span class="koboSpan" id="kobo.3385.1">
    )
    mail_sent = send_mail(
        subject, message, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3386.1">'admin@myshop.com'</span></span><span class="koboSpan" id="kobo.3387.1">, [order.email]
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3388.1">return</span></span><span class="koboSpan" id="kobo.3389.1"> mail_sent
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3390.1">We have defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3391.1">order_created</span></code><span class="koboSpan" id="kobo.3392.1"> task by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3393.1">@shared_task</span></code><span class="koboSpan" id="kobo.3394.1"> decorator. </span><span class="koboSpan" id="kobo.3394.2">As you can see, a Celery task is just a Python function decorated with </span><code class="inlineCode"><span class="koboSpan" id="kobo.3395.1">@shared_task</span></code><span class="koboSpan" id="kobo.3396.1">. </span><span class="koboSpan" id="kobo.3396.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3397.1">order_created</span></code><span class="koboSpan" id="kobo.3398.1"> task function receives an </span><code class="inlineCode"><span class="koboSpan" id="kobo.3399.1">order_id</span></code><span class="koboSpan" id="kobo.3400.1"> parameter. </span><span class="koboSpan" id="kobo.3400.2">Itâ€™s always recommended to only pass IDs to task functions and retrieve objects from the database when the task is executed. </span><span class="koboSpan" id="kobo.3400.3">By doing so, we avoid accessing outdated information since the data in the database might have changed</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.3401.1"> while the task was queued. </span><span class="koboSpan" id="kobo.3401.2">We have used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3402.1">send_mail()</span></code><span class="koboSpan" id="kobo.3403.1"> function provided by Django to send an email notification to the user who placed the order.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3404.1">You learned how to configure Django to use your SMTP server in </span><em class="italic"><span class="koboSpan" id="kobo.3405.1">Chapter 2</span></em><span class="koboSpan" id="kobo.3406.1">, </span><em class="italic"><span class="koboSpan" id="kobo.3407.1">Enhancing Your Blog with Advanced Features</span></em><span class="koboSpan" id="kobo.3408.1">. </span><span class="koboSpan" id="kobo.3408.2">If you donâ€™t want to set up email settings, you can tell Django to write emails to the console by adding the following setting to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3409.1">settings.py</span></code><span class="koboSpan" id="kobo.3410.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3411.1">EMAIL_BACKEND = </span><span class="hljs-string"><span class="koboSpan" id="kobo.3412.1">'django.core.mail.backends.console.EmailBackend'</span></span>
</code></pre>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.3413.1">Use asynchronous tasks not only for time-consuming processes but also for other processes that do not take so much time to be executed but that are subject to connection failures or require a retry policy.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.3414.1">Now you have to add the task to your </span><code class="inlineCode"><span class="koboSpan" id="kobo.3415.1">order_create</span></code><span class="koboSpan" id="kobo.3416.1"> view. </span><span class="koboSpan" id="kobo.3416.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3417.1">views.py</span></code><span class="koboSpan" id="kobo.3418.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3419.1">orders</span></code><span class="koboSpan" id="kobo.3420.1"> application, import the task, and call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3421.1">order_created</span></code><span class="koboSpan" id="kobo.3422.1"> asynchronous task after clearing the cart, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.3423.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3424.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3425.1"> .tasks </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3426.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3427.1"> order_created</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3428.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3429.1">order_create</span></span><span class="koboSpan" id="kobo.3430.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.3431.1">request</span></span><span class="koboSpan" id="kobo.3432.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3433.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3434.1">if</span></span><span class="koboSpan" id="kobo.3435.1"> request.method == </span><span class="hljs-string"><span class="koboSpan" id="kobo.3436.1">'POST'</span></span><span class="koboSpan" id="kobo.3437.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3438.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.3439.1">if</span></span><span class="koboSpan" id="kobo.3440.1"> form.is_valid():
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.3441.1"># ...</span></span><span class="koboSpan" id="kobo.3442.1">
            cart.clear()
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.3443.1"># launch asynchronous task</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3444.1">            order_created.delay(order.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.3445.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3446.1">)</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.3447.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3448.1">You call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3449.1">delay()</span></code><span class="koboSpan" id="kobo.3450.1"> method of the task to execute it asynchronously. </span><span class="koboSpan" id="kobo.3450.2">The task will be added to the message queue and executed by the Celery worker as soon as possible.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3451.1">Make sure RabbitMQ is running. </span><span class="koboSpan" id="kobo.3451.2">Then, stop the Celery worker process and start it again with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3452.1">celery -A myshop worker -l info
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3453.1">The Celery worker has now registered the task. </span><span class="koboSpan" id="kobo.3453.2">In another shell, start the development server from the project directory with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3454.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3455.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3456.1">http://127.0.0.1:8000/</span></code><span class="koboSpan" id="kobo.3457.1"> in your browser, add some products to your shopping cart, and complete an order. </span><span class="koboSpan" id="kobo.3457.2">In the </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.3458.1">shell where you started the Celery worker, you will see output similar to the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3459.1">[2024-01-02 20:25:19,569: INFO/MainProcess] Task orders.tasks.order_created[a94dc22e-372b-4339-bff7-52bc83161c5c] received
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.3460.1">...</span></span><span class="koboSpan" id="kobo.3461.1">
[2024-01-02 20:25:19,605: INFO/ForkPoolWorker-8] Task orders.tasks.order_created[a94dc22e-372b-4339-bff7-52bc83161c5c] succeeded in 0.015824042027816176s: 1
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3462.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.3463.1">order_created</span></code><span class="koboSpan" id="kobo.3464.1"> task has been executed and an email notification for the order has been sent. </span><span class="koboSpan" id="kobo.3464.2">If you are using the email backend </span><code class="inlineCode"><span class="koboSpan" id="kobo.3465.1">console.EmailBackend</span></code><span class="koboSpan" id="kobo.3466.1">, no email is sent but you should see the rendered text of the email in the output of the console.</span></p>
<h3 class="heading-3" id="_idParaDest-253"><span class="koboSpan" id="kobo.3467.1">Monitoring Celery with Flower</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.3468.1">Besides the RabbitMQ </span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.3469.1">management UI, you can use other tools to monitor the</span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.3470.1"> asynchronous tasks that are executed with Celery. </span><span class="koboSpan" id="kobo.3470.2">Flower is a useful web-based tool for monitoring Celery. </span><span class="koboSpan" id="kobo.3470.3">You can find the documentation for Flower at </span><a href="https://flower.readthedocs.io/"><span class="url"><span class="koboSpan" id="kobo.3471.1">https://flower.readthedocs.io/</span></span></a><span class="koboSpan" id="kobo.3472.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3473.1">Install Flower using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3474.1">python -m pip install flower==2.0.1
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3475.1">Once installed, you can launch Flower by running</span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.3476.1"> the following command in a new shell from your project directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3477.1">celery -A myshop flower
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3478.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3479.1">http://localhost:5555/</span></code><span class="koboSpan" id="kobo.3480.1"> in your browser. </span><span class="koboSpan" id="kobo.3480.2">You will be able to see the active Celery workers and</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.3481.1"> asynchronous task statistics. </span><span class="koboSpan" id="kobo.3481.2">The screen should look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3482.1"><img alt="" role="presentation" src="../Images/B21088_08_22.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3483.1">Figure 8.22: The Flower dashboard</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3484.1">You will see an active worker whose name starts with </span><strong class="screenText"><span class="koboSpan" id="kobo.3485.1">celery@</span></strong><span class="koboSpan" id="kobo.3486.1"> and whose status is </span><strong class="screenText"><span class="koboSpan" id="kobo.3487.1">Online</span></strong><span class="koboSpan" id="kobo.3488.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3489.1">Click on the workerâ€™s name and then click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.3490.1">Queues</span></strong><span class="koboSpan" id="kobo.3491.1"> tab. </span><span class="koboSpan" id="kobo.3491.2">You will see the following screen:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3492.1"><img alt="" role="presentation" src="../Images/B21088_08_23.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3493.1">Figure 8.23: Flower â€“ Worker Celery task queues</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3494.1">Here you can see the active queue </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.3495.1">named </span><strong class="screenText"><span class="koboSpan" id="kobo.3496.1">celery</span></strong><span class="koboSpan" id="kobo.3497.1">. </span><span class="koboSpan" id="kobo.3497.2">This is the active queue consumer connected to the message </span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.3498.1">broker.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3499.1">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.3500.1">Tasks</span></strong><span class="koboSpan" id="kobo.3501.1"> tab. </span><span class="koboSpan" id="kobo.3501.2">You will see the following screen:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3502.1"><img alt="" role="presentation" src="../Images/B21088_08_24.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3503.1">Figure 8.24: Flower â€“ Worker Celery tasks</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3504.1">Here you can see the tasks that have been processed and the number of times that they have been executed. </span><span class="koboSpan" id="kobo.3504.2">You should see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3505.1">order_created</span></code><span class="koboSpan" id="kobo.3506.1"> task and the total times that it has been executed. </span><span class="koboSpan" id="kobo.3506.2">This number might vary depending on how many orders you have placed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3507.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3508.1">http://localhost:8000/</span></code><span class="koboSpan" id="kobo.3509.1"> in your browser. </span><span class="koboSpan" id="kobo.3509.2">Add some items to the cart and then complete the checkout process.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3510.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3511.1">http://localhost:5555/</span></code><span class="koboSpan" id="kobo.3512.1"> in your browser. </span><span class="koboSpan" id="kobo.3512.2">Flower has registered the task as processed. </span><span class="koboSpan" id="kobo.3512.3">You should now see </span><code class="inlineCode"><span class="koboSpan" id="kobo.3513.1">1</span></code><span class="koboSpan" id="kobo.3514.1"> under </span><strong class="screenText"><span class="koboSpan" id="kobo.3515.1">Processed</span></strong><span class="koboSpan" id="kobo.3516.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3517.1">1</span></code><span class="koboSpan" id="kobo.3518.1"> under </span><strong class="screenText"><span class="koboSpan" id="kobo.3519.1">Succeeded</span></strong><span class="koboSpan" id="kobo.3520.1"> as well:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3521.1"><img alt="" role="presentation" src="../Images/B21088_08_25.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3522.1">Figure 8.25: Flower â€“ Celery workers</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3523.1">Under </span><strong class="screenText"><span class="koboSpan" id="kobo.3524.1">Tasks</span></strong><span class="koboSpan" id="kobo.3525.1">, you can see additional details about each task registered with Celery:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3526.1"><img alt="" role="presentation" src="../Images/B21088_08_26.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3527.1">Figure 8.26: Flower â€“ Celery tasks</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3528.1">Flower should never be deployed openly in a production environment without security. </span><span class="koboSpan" id="kobo.3528.2">Letâ€™s add authentication to</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.3529.1"> the Flower instance. </span><span class="koboSpan" id="kobo.3529.2">Stop Flower using </span><em class="italic"><span class="koboSpan" id="kobo.3530.1">Ctrl + C</span></em><span class="koboSpan" id="kobo.3531.1">, and restart it with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3532.1">--basic-auth</span></code><span class="koboSpan" id="kobo.3533.1"> option by executing the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.3534.1">celery -A myshop flower --basic-auth=user:pwd
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.3535.1">Replace </span><code class="inlineCode"><span class="koboSpan" id="kobo.3536.1">user</span></code><span class="koboSpan" id="kobo.3537.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3538.1">pwd</span></code><span class="koboSpan" id="kobo.3539.1"> with your desired username and password. </span><span class="koboSpan" id="kobo.3539.2">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.3540.1">http://localhost:5555/</span></code><span class="koboSpan" id="kobo.3541.1"> in your browser. </span><span class="koboSpan" id="kobo.3541.2">The browser will now prompt you for credentials, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.3542.1">Figure 8.27</span></em><span class="koboSpan" id="kobo.3543.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.3544.1"><img alt="" role="presentation" src="../Images/B21088_08_27.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.3545.1">Figure 8.27: Basic authentication required to access Flower</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3546.1">Flower provides other authentication options, such as Google, GitHub, or Okta OAuth. </span><span class="koboSpan" id="kobo.3546.2">You can read more about Flowerâ€™s authentication methods at </span><a href="https://flower.readthedocs.io/en/latest/auth.html"><span class="url"><span class="koboSpan" id="kobo.3547.1">https://flower.readthedocs.io/en/latest/auth.html</span></span></a><span class="koboSpan" id="kobo.3548.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-254"><span class="koboSpan" id="kobo.3549.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3550.1">In this chapter, you created a basic e-commerce application. </span><span class="koboSpan" id="kobo.3550.2">You made a product catalog and built a shopping cart using sessions. </span><span class="koboSpan" id="kobo.3550.3">You implemented a custom context processor to make the cart available to all templates and created a form for placing orders. </span><span class="koboSpan" id="kobo.3550.4">You also learned how to implement asynchronous tasks using Celery and RabbitMQ. </span><span class="koboSpan" id="kobo.3550.5">Having completed this chapter, you now understand the foundational elements of building an e-commerce platform with Django, including managing products, processing orders, and handling asynchronous tasks. </span><span class="koboSpan" id="kobo.3550.6">You are now also capable of developing projects that efficiently process user transactions and scale to handle complex background operations seamlessly.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.3551.1">In the next chapter, you will discover how to integrate a payment gateway into your shop, add custom actions to the administration site, export data in CSV format, and generate PDF files dynamically.</span></p>
<h1 class="heading-1" id="_idParaDest-255"><span class="koboSpan" id="kobo.3552.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3553.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3554.1">Source code for this chapter â€“ </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter08"><span class="url"><span class="koboSpan" id="kobo.3555.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter08</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3556.1">Static files for the project â€“ </span><a href="https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter08/myshop/shop/static "><span class="url"><span class="koboSpan" id="kobo.3557.1">https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter08/myshop/shop/static</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3558.1">Django session settings â€“ </span><a href="https://docs.djangoproject.com/en/5.0/ref/settings/#sessions"><span class="url"><span class="koboSpan" id="kobo.3559.1">https://docs.djangoproject.com/en/5.0/ref/settings/#sessions</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3560.1">Django built-in context processors â€“ </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/api/#built-in-template-context-processors"><span class="url"><span class="koboSpan" id="kobo.3561.1">https://docs.djangoproject.com/en/5.0/ref/templates/api/#built-in-template-context-processors</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3562.1">Information about </span><code class="inlineCode"><span class="koboSpan" id="kobo.3563.1">RequestContext</span></code><span class="koboSpan" id="kobo.3564.1"> â€“ </span><a href="https://docs.djangoproject.com/en/5.0/ref/templates/api/#django.template.RequestContext"><span class="url"><span class="koboSpan" id="kobo.3565.1">https://docs.djangoproject.com/en/5.0/ref/templates/api/#django.template.RequestContext</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3566.1">Celery documentation â€“ </span><a href="https://docs.celeryq.dev/en/stable/index.html"><span class="url"><span class="koboSpan" id="kobo.3567.1">https://docs.celeryq.dev/en/stable/index.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3568.1">Introduction to Celery â€“ </span><a href="https://docs.celeryq.dev/en/stable/getting-started/introduction.html"><span class="url"><span class="koboSpan" id="kobo.3569.1">https://docs.celeryq.dev/en/stable/getting-started/introduction.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3570.1">Official RabbitMQ Docker image â€“ </span><a href="https://hub.docker.com/_/rabbitmq"><span class="url"><span class="koboSpan" id="kobo.3571.1">https://hub.docker.com/_/rabbitmq</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3572.1">RabbitMQ installation instructions â€“ </span><a href="https://www.rabbitmq.com/download.html"><span class="url"><span class="koboSpan" id="kobo.3573.1">https://www.rabbitmq.com/download.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3574.1">Flower documentation â€“ </span><a href="https://flower.readthedocs.io/"><span class="url"><span class="koboSpan" id="kobo.3575.1">https://flower.readthedocs.io/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3576.1">Flower authentication methods â€“ </span><a href="https://flower.readthedocs.io/en/latest/auth.html"><span class="url"><span class="koboSpan" id="kobo.3577.1">https://flower.readthedocs.io/en/latest/auth.html</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-256"><span class="koboSpan" id="kobo.3578.1">Join us on Discord!</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3579.1">Read this book alongside other users, Django development experts, and the author himself. </span><span class="koboSpan" id="kobo.3579.2">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more.Scan the QR code or visit the link to join the community.</span></p>
<p class="normal"><a href="https://packt.link/Django5ByExample"><span class="url"><span class="koboSpan" id="kobo.3580.1">https://packt.link/Django5ByExample</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.3581.1"><img alt="" role="presentation" src="../Images/QR_Code287089408934129031.png"/></span></p>
</div>
</body></html>