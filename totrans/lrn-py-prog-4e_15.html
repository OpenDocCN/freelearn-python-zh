<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer238">
   <h1 class="chapterNumber">
    <span class="koboSpan" id="kobo.1.1">
     15
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-372">
    <span class="koboSpan" id="kobo.2.1">
     CLI Applications
    </span>
   </h1>
   <blockquote class="packt_quote">
    <p class="quote">
     <span class="koboSpan" id="kobo.3.1">
      A user interface is like a joke.
     </span>
     <span class="koboSpan" id="kobo.3.2">
      If you have to explain it, it’s not that good.
     </span>
    </p>
    <p class="cite">
     <span class="koboSpan" id="kobo.4.1">
      – Martin LeBlanc
     </span>
    </p>
   </blockquote>
   <p class="normal">
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we are going to learn how to create
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.6.1">
      Command-Line Interface
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.8.1">
      CLI
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     ) applications, also
    </span>
    <a id="_idIndexMarker1293">
    </a>
    <span class="koboSpan" id="kobo.10.1">
     known as
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.11.1">
      Command-Line Applications
     </span>
    </strong>
    <span class="koboSpan" id="kobo.12.1">
     , in Python.
    </span>
    <span class="koboSpan" id="kobo.12.2">
     A CLI
    </span>
    <a id="_idIndexMarker1294">
    </a>
    <span class="koboSpan" id="kobo.13.1">
     is a user interface where users type commands into a console or terminal.
    </span>
    <span class="koboSpan" id="kobo.13.2">
     Notable examples include
    </span>
    <a id="_idIndexMarker1295">
    </a>
    <span class="koboSpan" id="kobo.14.1">
     the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.15.1">
      Bash
     </span>
    </strong>
    <span class="koboSpan" id="kobo.16.1">
     and
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.17.1">
      Zsh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.18.1">
     shells on macOS, Linux, and other
    </span>
    <a id="_idIndexMarker1296">
    </a>
    <span class="koboSpan" id="kobo.19.1">
     UNIX-based operating systems, and the
    </span>
    <a id="_idIndexMarker1297">
    </a>
    <span class="koboSpan" id="kobo.20.1">
     Windows
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.21.1">
      Command Prompt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.22.1">
     and
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.23.1">
      PowerShell
     </span>
    </strong>
    <span class="koboSpan" id="kobo.24.1">
     .
    </span>
    <span class="koboSpan" id="kobo.24.2">
     A CLI application is an
    </span>
    <a id="_idIndexMarker1298">
    </a>
    <span class="koboSpan" id="kobo.25.1">
     application that is primarily used in such a command-line shell environment.
    </span>
    <span class="koboSpan" id="kobo.25.2">
     One executes a CLI application by typing a command, possibly followed by some arguments, into the shell.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.26.1">
     Although
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.27.1">
      Graphical User Interfaces
     </span>
    </strong>
    <span class="koboSpan" id="kobo.28.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.29.1">
      GUIs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.30.1">
     ) and web applications are far more popular, CLI applications still have their
    </span>
    <a id="_idIndexMarker1299">
    </a>
    <span class="koboSpan" id="kobo.31.1">
     place.
    </span>
    <span class="koboSpan" id="kobo.31.2">
     They are especially popular among developers, system administrators, network administrators, and other technical users.
    </span>
    <span class="koboSpan" id="kobo.31.3">
     There are several reasons for this popularity.
    </span>
    <span class="koboSpan" id="kobo.31.4">
     Once you are familiar with the required commands, you can often perform a task much faster by typing commands into a CLI than by clicking through menus and buttons in a GUI.
    </span>
    <span class="koboSpan" id="kobo.31.5">
     Most shells also allow connecting the output of one command directly to the input of another.
    </span>
    <span class="koboSpan" id="kobo.31.6">
     This is called piping, and it allows users to combine simple commands into data processing pipelines to perform more complex tasks.
    </span>
    <span class="koboSpan" id="kobo.31.7">
     Sequences of commands can be saved in scripts, allowing for repeatability and automation.
    </span>
    <span class="koboSpan" id="kobo.31.8">
     It is also easier to document instructions to perform a task by providing exact commands to type, rather than explaining how to navigate a GUI or web interface.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.32.1">
     CLI applications
    </span>
    <a id="_idIndexMarker1300">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     are much faster and easier to develop and maintain than graphical or web interfaces.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     For this reason, development teams sometimes prefer to implement tools for internal use as CLI applications.
    </span>
    <span class="koboSpan" id="kobo.33.3">
     This allows them to reduce the time and effort spent on building internal tools and focus more on customer-facing features.
    </span>
    <span class="koboSpan" id="kobo.33.4">
     Learning how to build command-line applications is also an excellent stepping stone toward learning how to build more complex software, such as GUI applications or distributed applications.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.34.1">
     In this chapter, we will create a command-line application for interacting with the railway API we studied in the previous chapter.
    </span>
    <span class="koboSpan" id="kobo.34.2">
     We will use this project to explore the following topics:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.35.1">
      Parsing command-line arguments
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.36.1">
      Structuring a CLI application by breaking it down into sub-commands
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.37.1">
      Securely dealing with passwords
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.38.1">
     We will end the chapter with some suggestions for further resources where you can learn more about CLI applications.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-373">
    <span class="koboSpan" id="kobo.39.1">
     Command-line arguments
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.40.1">
     The primary user interface
    </span>
    <a id="_idIndexMarker1301">
    </a>
    <span class="koboSpan" id="kobo.41.1">
     of a CLI application consists of the arguments that can be passed to it on the command line.
    </span>
    <span class="koboSpan" id="kobo.41.2">
     Before we start exploring the railway CLI project, let us take a brief look at command-line arguments and the mechanisms Python provides for working with them.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.42.1">
     Most
    </span>
    <a id="_idIndexMarker1302">
    </a>
    <span class="koboSpan" id="kobo.43.1">
     applications accept
    </span>
    <a id="_idIndexMarker1303">
    </a>
    <span class="koboSpan" id="kobo.44.1">
     various
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.45.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.46.1">
     (or
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.47.1">
      flags
     </span>
    </strong>
    <span class="koboSpan" id="kobo.48.1">
     ) as well as
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.49.1">
      positional arguments
     </span>
    </strong>
    <span class="koboSpan" id="kobo.50.1">
     .
    </span>
    <span class="koboSpan" id="kobo.50.2">
     Some applications consist of several
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.51.1">
      sub-commands
     </span>
    </strong>
    <span class="koboSpan" id="kobo.52.1">
     , each of
    </span>
    <a id="_idIndexMarker1304">
    </a>
    <span class="koboSpan" id="kobo.53.1">
     which has its own distinct set of options and positional arguments.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-374">
    <span class="koboSpan" id="kobo.54.1">
     Positional arguments
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.55.1">
     Positional
    </span>
    <a id="_idIndexMarker1305">
    </a>
    <span class="koboSpan" id="kobo.56.1">
     arguments
    </span>
    <a id="_idIndexMarker1306">
    </a>
    <span class="koboSpan" id="kobo.57.1">
     represent the main data or objects that the application should operate on.
    </span>
    <span class="koboSpan" id="kobo.57.2">
     They must be provided in a specific order and are usually not optional.
    </span>
    <span class="koboSpan" id="kobo.57.3">
     For example, consider the command:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.58.1">$ cp original.txt copy.txt
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.59.1">
     This command will create a copy of the file
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.60.1">
      original.txt
     </span>
    </code>
    <span class="koboSpan" id="kobo.61.1">
     , named
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.62.1">
      copy.txt
     </span>
    </code>
    <span class="koboSpan" id="kobo.63.1">
     .
    </span>
    <span class="koboSpan" id="kobo.63.2">
     Both positional arguments (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.64.1">
      original.txt
     </span>
    </code>
    <span class="koboSpan" id="kobo.65.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.66.1">
      copy.txt
     </span>
    </code>
    <span class="koboSpan" id="kobo.67.1">
     ) are required, and changing their order would change the meaning of the command.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-375">
    <span class="koboSpan" id="kobo.68.1">
     Options
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.69.1">
     Options
    </span>
    <a id="_idIndexMarker1307">
    </a>
    <span class="koboSpan" id="kobo.70.1">
     are used to
    </span>
    <a id="_idIndexMarker1308">
    </a>
    <span class="koboSpan" id="kobo.71.1">
     modify the behavior of an application.
    </span>
    <span class="koboSpan" id="kobo.71.2">
     They are normally optional and typically consist either of a single letter prefixed with a hyphen or a word prefixed with two hyphens.
    </span>
    <span class="koboSpan" id="kobo.71.3">
     Options do not need to appear in any particular order or position on the command line.
    </span>
    <span class="koboSpan" id="kobo.71.4">
     They can even be placed after or between the positional arguments.
    </span>
    <span class="koboSpan" id="kobo.71.5">
     For example, many applications accept a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.72.1">
      -v
     </span>
    </code>
    <span class="koboSpan" id="kobo.73.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.74.1">
      --verbose
     </span>
    </code>
    <span class="koboSpan" id="kobo.75.1">
     option to enable verbose output.
    </span>
    <span class="koboSpan" id="kobo.75.2">
     Some options behave like switches, turning some feature on (or off) simply by their presence (or absence).
    </span>
    <span class="koboSpan" id="kobo.75.3">
     Other options require an additional argument as a value.
    </span>
    <span class="koboSpan" id="kobo.75.4">
     For example, consider the command:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.76.1">$ grep -r --exclude '*.txt' hello .
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.77.1">
     This will recursively descend into the current directory and search for the string
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.78.1">
      hello
     </span>
    </code>
    <span class="koboSpan" id="kobo.79.1">
     in all files whose names do not end with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.80.1">
      .txt
     </span>
    </code>
    <span class="koboSpan" id="kobo.81.1">
     .
    </span>
    <span class="koboSpan" id="kobo.81.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.82.1">
      -r
     </span>
    </code>
    <span class="koboSpan" id="kobo.83.1">
     option causes grep to recursively search a directory.
    </span>
    <span class="koboSpan" id="kobo.83.2">
     Without this option, it would exit with an error when asked to search a directory instead of a regular file.
    </span>
    <span class="koboSpan" id="kobo.83.3">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.84.1">
      --exclude
     </span>
    </code>
    <span class="koboSpan" id="kobo.85.1">
     option requires a filename pattern (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.86.1">
      '*.txt'
     </span>
    </code>
    <span class="koboSpan" id="kobo.87.1">
     ) as an argument and causes grep to exclude files matching the pattern from the search.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.88.1">
      On Windows, options are traditionally prefixed with a forward-slash character (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.89.1">
       /
      </span>
     </code>
     <span class="koboSpan" id="kobo.90.1">
      ) rather than a hyphen.
     </span>
     <span class="koboSpan" id="kobo.90.2">
      However, many modern and cross-platform applications use hyphens for consistency with other operating systems.
     </span>
    </p>
   </div>
   <h2 class="heading-2" id="_idParaDest-376">
    <span class="koboSpan" id="kobo.91.1">
     Sub-commands
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.92.1">
     Complex
    </span>
    <a id="_idIndexMarker1309">
    </a>
    <span class="koboSpan" id="kobo.93.1">
     applications are often divided
    </span>
    <a id="_idIndexMarker1310">
    </a>
    <span class="koboSpan" id="kobo.94.1">
     into several sub-commands.
    </span>
    <span class="koboSpan" id="kobo.94.2">
     The
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.95.1">
      Git
     </span>
    </strong>
    <span class="koboSpan" id="kobo.96.1">
     revision control system
    </span>
    <a id="_idIndexMarker1311">
    </a>
    <span class="koboSpan" id="kobo.97.1">
     is an excellent example of this.
    </span>
    <span class="koboSpan" id="kobo.97.2">
     For example, consider the commands
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.98.1">$ git commit -m "Fix some bugs"
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.99.1">
     and
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.100.1">$ git ls-files -m
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.101.1">
     Here,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.102.1">
      commit
     </span>
    </code>
    <span class="koboSpan" id="kobo.103.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.104.1">
      ls-files
     </span>
    </code>
    <span class="koboSpan" id="kobo.105.1">
     are sub-commands of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.106.1">
      git
     </span>
    </code>
    <span class="koboSpan" id="kobo.107.1">
     application.
    </span>
    <span class="koboSpan" id="kobo.107.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.108.1">
      commit
     </span>
    </code>
    <span class="koboSpan" id="kobo.109.1">
     sub-command creates a new commit, using the text passed as an argument to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.110.1">
      -m
     </span>
    </code>
    <span class="koboSpan" id="kobo.111.1">
     option (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.112.1">
      "Fix some bugs"
     </span>
    </code>
    <span class="koboSpan" id="kobo.113.1">
     ) as the commit message.
    </span>
    <span class="koboSpan" id="kobo.113.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.114.1">
      ls-files
     </span>
    </code>
    <span class="koboSpan" id="kobo.115.1">
     command shows information about files in a Git repository.
    </span>
    <span class="koboSpan" id="kobo.115.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.116.1">
      -m
     </span>
    </code>
    <span class="koboSpan" id="kobo.117.1">
     option to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.118.1">
      ls-files
     </span>
    </code>
    <span class="koboSpan" id="kobo.119.1">
     instructs the command to only show files with modifications that have not been staged for committing.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.120.1">
     The use of sub-commands helps to structure and organize the application interface, making it easier for users to find the features they need.
    </span>
    <span class="koboSpan" id="kobo.120.2">
     Each sub-command can also have its own help messages, which means users can more easily learn how to use a feature without needing to read the full documentation for the entire application.
    </span>
    <span class="koboSpan" id="kobo.120.3">
     It also promotes the modularity of the code, which improves maintainability and allows adding new commands without modifying existing code.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-377">
    <span class="koboSpan" id="kobo.121.1">
     Argument parsing
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.122.1">
     Python applications can access the
    </span>
    <a id="_idIndexMarker1312">
    </a>
    <span class="koboSpan" id="kobo.123.1">
     command-line arguments passed to them
    </span>
    <a id="_idIndexMarker1313">
    </a>
    <span class="koboSpan" id="kobo.124.1">
     via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.125.1">
      sys.argv
     </span>
    </code>
    <span class="koboSpan" id="kobo.126.1">
     .
    </span>
    <span class="koboSpan" id="kobo.126.2">
     Let us write a simple script that just prints the value of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.127.1">
      sys.argv
     </span>
    </code>
    <span class="koboSpan" id="kobo.128.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.129.1"># argument_parsing/argv.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.130.1">import</span></span><span class="koboSpan" id="kobo.131.1"> sys
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.132.1">print</span></span><span class="koboSpan" id="kobo.133.1">(sys.argv)
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.134.1">
     When we run this without passing any arguments, the output looks as follows:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.135.1">$ python argument_parsing/argv.py
['argument_parsing/argv.py']
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.136.1">
     If we pass some arguments, we get the following:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.137.1">$ python argument_parsing/argv.py your lucky number is 13
['argument_parsing/argv.py', 'your', 'lucky', 'number', 'is', '13']
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.138.1">
     As you can see,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.139.1">
      sys.argv
     </span>
    </code>
    <span class="koboSpan" id="kobo.140.1">
     is a list of strings.
    </span>
    <span class="koboSpan" id="kobo.140.2">
     The first element is the command used to run the application.
    </span>
    <span class="koboSpan" id="kobo.140.3">
     The remaining elements contain the command-line arguments.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.141.1">
     Simple applications that do not accept any options can simply extract positional arguments directly from
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.142.1">
      sys.argv
     </span>
    </code>
    <span class="koboSpan" id="kobo.143.1">
     .
    </span>
    <span class="koboSpan" id="kobo.143.2">
     For applications that do take options, however, the argument parsing logic can get complicated.
    </span>
    <span class="koboSpan" id="kobo.143.3">
     Fortunately, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.144.1">
      argparse
     </span>
    </code>
    <span class="koboSpan" id="kobo.145.1">
     module in the Python standard library provides a command-line argument parser that makes it easy to parse arguments without needing to write any complicated logic.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.146.1">
      There are several third-party library alternatives to
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.147.1">
       argparse
      </span>
     </code>
     <span class="koboSpan" id="kobo.148.1">
      .
     </span>
     <span class="koboSpan" id="kobo.148.2">
      We will not cover any of these in this chapter, but we will provide some links for a few of the most popular ones at the end.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.149.1">
     For example, we have written a script that takes
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.150.1">
      name
     </span>
    </code>
    <span class="koboSpan" id="kobo.151.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.152.1">
      age
     </span>
    </code>
    <span class="koboSpan" id="kobo.153.1">
     as positional arguments and
    </span>
    <a id="_idIndexMarker1314">
    </a>
    <span class="koboSpan" id="kobo.154.1">
     prints out a greeting.
    </span>
    <span class="koboSpan" id="kobo.154.2">
     Given the name
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.155.1">
      Heinrich
     </span>
    </code>
    <span class="koboSpan" id="kobo.156.1">
     and age
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.157.1">
      42
     </span>
    </code>
    <span class="koboSpan" id="kobo.158.1">
     , it should print
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.159.1">
      "Hi Heinrich.
     </span>
     <span class="koboSpan" id="kobo.159.2">
      You are 42 years old."
     </span>
    </code>
    <span class="koboSpan" id="kobo.160.1">
     It accepts a custom greeting to use instead of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.161.1">
      "Hi"
     </span>
    </code>
    <span class="koboSpan" id="kobo.162.1">
     , via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.163.1">
      -g
     </span>
    </code>
    <span class="koboSpan" id="kobo.164.1">
     option.
    </span>
    <span class="koboSpan" id="kobo.164.2">
     Adding
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.165.1">
      -r
     </span>
    </code>
    <span class="koboSpan" id="kobo.166.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.167.1">
      --reverse
     </span>
    </code>
    <span class="koboSpan" id="kobo.168.1">
     to the command
    </span>
    <a id="_idIndexMarker1315">
    </a>
    <span class="koboSpan" id="kobo.169.1">
     line results in reversing the message before printing.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.170.1"># argument_parsing/greet.argparse.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.171.1">import</span></span><span class="koboSpan" id="kobo.172.1"> argparse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.173.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.174.1">main</span></span><span class="koboSpan" id="kobo.175.1">():
    args = parse_arguments()
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.176.1">print</span></span><span class="koboSpan" id="kobo.177.1">(args)
    msg = </span><span class="hljs-string"><span class="koboSpan" id="kobo.178.1">"{greet} {name}. </span><span class="koboSpan" id="kobo.178.2">You are {age} years old."</span></span><span class="koboSpan" id="kobo.179.1">.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.180.1">format</span></span><span class="koboSpan" id="kobo.181.1">(
        **</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.182.1">vars</span></span><span class="koboSpan" id="kobo.183.1">(args)
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.184.1">if</span></span><span class="koboSpan" id="kobo.185.1"> args.reverse:
        msg = msg[::-</span><span class="hljs-number"><span class="koboSpan" id="kobo.186.1">1</span></span><span class="koboSpan" id="kobo.187.1">]
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.188.1">print</span></span><span class="koboSpan" id="kobo.189.1">(msg)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.190.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.191.1">parse_arguments</span></span><span class="koboSpan" id="kobo.192.1">():
    parser = argparse.ArgumentParser()
    parser.add_argument(</span><span class="hljs-string"><span class="koboSpan" id="kobo.193.1">"name"</span></span><span class="koboSpan" id="kobo.194.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.195.1">help</span></span><span class="koboSpan" id="kobo.196.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.197.1">"Your name"</span></span><span class="koboSpan" id="kobo.198.1">)
    parser.add_argument(</span><span class="hljs-string"><span class="koboSpan" id="kobo.199.1">"age"</span></span><span class="koboSpan" id="kobo.200.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.201.1">type</span></span><span class="koboSpan" id="kobo.202.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.203.1">int</span></span><span class="koboSpan" id="kobo.204.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.205.1">help</span></span><span class="koboSpan" id="kobo.206.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.207.1">"Age"</span></span><span class="koboSpan" id="kobo.208.1">)
    parser.add_argument(</span><span class="hljs-string"><span class="koboSpan" id="kobo.209.1">"-r"</span></span><span class="koboSpan" id="kobo.210.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.211.1">"--reverse"</span></span><span class="koboSpan" id="kobo.212.1">, action=</span><span class="hljs-string"><span class="koboSpan" id="kobo.213.1">"store_true"</span></span><span class="koboSpan" id="kobo.214.1">)
    parser.add_argument(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.215.1">"-g"</span></span><span class="koboSpan" id="kobo.216.1">, default=</span><span class="hljs-string"><span class="koboSpan" id="kobo.217.1">"Hi"</span></span><span class="koboSpan" id="kobo.218.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.219.1">help</span></span><span class="koboSpan" id="kobo.220.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.221.1">"Custom greeting"</span></span><span class="koboSpan" id="kobo.222.1">, dest=</span><span class="hljs-string"><span class="koboSpan" id="kobo.223.1">"greet"</span></span><span class="koboSpan" id="kobo.224.1">
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.225.1">return</span></span><span class="koboSpan" id="kobo.226.1"> parser.parse_args()
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.227.1">if</span></span><span class="koboSpan" id="kobo.228.1"> __name__ == </span><span class="hljs-string"><span class="koboSpan" id="kobo.229.1">"__main__"</span></span><span class="koboSpan" id="kobo.230.1">:
    main()
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.231.1">
     Let us take a closer look at the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.232.1">
      parse_arguments()
     </span>
    </code>
    <span class="koboSpan" id="kobo.233.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.233.2">
     We start by creating an instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.234.1">
      ArgumentParser
     </span>
    </code>
    <span class="koboSpan" id="kobo.235.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.235.2">
     Then, we proceed to define the arguments we accept by calling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.236.1">
      add_argument()
     </span>
    </code>
    <span class="koboSpan" id="kobo.237.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.237.2">
     We start with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.238.1">
      name
     </span>
    </code>
    <span class="koboSpan" id="kobo.239.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.240.1">
      age
     </span>
    </code>
    <span class="koboSpan" id="kobo.241.1">
     positional arguments, providing help strings for each and specifying that
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.242.1">
      age
     </span>
    </code>
    <span class="koboSpan" id="kobo.243.1">
     must be an integer.
    </span>
    <span class="koboSpan" id="kobo.243.2">
     If no
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.244.1">
      type
     </span>
    </code>
    <span class="koboSpan" id="kobo.245.1">
     is specified, the arguments will be parsed as strings.
    </span>
    <span class="koboSpan" id="kobo.245.2">
     The next argument is an option, which can be specified on the command line as either
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.246.1">
      -r
     </span>
    </code>
    <span class="koboSpan" id="kobo.247.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.248.1">
      --reverse
     </span>
    </code>
    <span class="koboSpan" id="kobo.249.1">
     .
    </span>
    <span class="koboSpan" id="kobo.249.2">
     The last argument is the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.250.1">
      "-g"
     </span>
    </code>
    <span class="koboSpan" id="kobo.251.1">
     option, with the default value
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.252.1">
      "
     </span>
    </code>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.253.1">
      Hi"
     </span>
    </code>
    <span class="koboSpan" id="kobo.254.1">
     .
    </span>
    <span class="koboSpan" id="kobo.254.2">
     Finally, we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.255.1">
      parse_args()
     </span>
    </code>
    <span class="koboSpan" id="kobo.256.1">
     method of the parser, to parse the command-line arguments.
    </span>
    <span class="koboSpan" id="kobo.256.2">
     This will return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.257.1">
      Namespace
     </span>
    </code>
    <span class="koboSpan" id="kobo.258.1">
     object containing the argument values parsed from the command line.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.259.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.260.1">
      action
     </span>
    </code>
    <span class="koboSpan" id="kobo.261.1">
     keyword argument to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.262.1">
      add_argument()
     </span>
    </code>
    <span class="koboSpan" id="kobo.263.1">
     defines how the parser should process the corresponding command-line argument.
    </span>
    <span class="koboSpan" id="kobo.263.2">
     The default action, if none is specified, is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.264.1">
      "store"
     </span>
    </code>
    <span class="koboSpan" id="kobo.265.1">
     , which stores the value provided on the command line as an attribute on the object returned when parsing the arguments.
    </span>
    <span class="koboSpan" id="kobo.265.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.266.1">
      "store_true"
     </span>
    </code>
    <span class="koboSpan" id="kobo.267.1">
     action means that the option will be treated as a switch.
    </span>
    <span class="koboSpan" id="kobo.267.2">
     If it is present on the command line, the parser will store the value
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.268.1">
      True
     </span>
    </code>
    <span class="koboSpan" id="kobo.269.1">
     ; if it is absent, we get
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.270.1">
      False
     </span>
    </code>
    <span class="koboSpan" id="kobo.271.1">
     .
    </span>
    <span class="koboSpan" id="kobo.271.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.272.1">
      dest
     </span>
    </code>
    <span class="koboSpan" id="kobo.273.1">
     keyword argument specifies the name of the attribute in which the value will be stored.
    </span>
    <span class="koboSpan" id="kobo.273.2">
     If
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.274.1">
      dest
     </span>
    </code>
    <span class="koboSpan" id="kobo.275.1">
     is not specified, the parser defaults to using the name of a positional argument, or the first long option string for option arguments (with the leading
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.276.1">
      --
     </span>
    </code>
    <span class="koboSpan" id="kobo.277.1">
     removed).
    </span>
    <span class="koboSpan" id="kobo.277.2">
     If only a short option string is provided, that is used (with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.278.1">
      -
     </span>
    </code>
    <span class="koboSpan" id="kobo.279.1">
     removed).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.280.1">
     Let us see
    </span>
    <a id="_idIndexMarker1316">
    </a>
    <span class="koboSpan" id="kobo.281.1">
     what happens
    </span>
    <a id="_idIndexMarker1317">
    </a>
    <span class="koboSpan" id="kobo.282.1">
     when we run this script.
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.283.1">$ python argument_parsing/greet.argparse.py Heinrich -r 42
Namespace(name='Heinrich', age=42, reverse=True, greet='Hi')
.dlo sraey 24 era uoY .hcirnieH iH
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.284.1">
     If we provide incorrect arguments, we get a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.285.1">
      usage
     </span>
    </code>
    <span class="koboSpan" id="kobo.286.1">
     message indicating what the expected arguments are, as well as an error message telling us what we did wrong:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.287.1">$ python argument_parsing/greet.argparse.py -g -r Heinrich 42
usage: greet.argparse.py [-h] [-r] [-g GREET] name age
greet.argparse.py: error: argument -g: expected one argument
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.288.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.289.1">
      usage
     </span>
    </code>
    <span class="koboSpan" id="kobo.290.1">
     message mentions a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.291.1">
      -h
     </span>
    </code>
    <span class="koboSpan" id="kobo.292.1">
     option, which we did not add.
    </span>
    <span class="koboSpan" id="kobo.292.2">
     Let us see what it does:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.293.1">$ python argument_parsing/greet.argparse.py -h
usage: greet.argparse.py [-h] [-r] [-g GREET] name age
positional arguments:
  name           Your name
  age            Age
options:
  -h, --help     show this help message and exit
  -r, --reverse
  -g GREET       Custom greeting
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.294.1">
     The parser
    </span>
    <a id="_idIndexMarker1318">
    </a>
    <span class="koboSpan" id="kobo.295.1">
     automatically adds a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.296.1">
      help
     </span>
    </code>
    <span class="koboSpan" id="kobo.297.1">
     option, which shows detailed usage information, including the
    </span>
    <code class="inlineCode">
     <a id="_idIndexMarker1319">
     </a>
    </code>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.298.1">
      help
     </span>
    </code>
    <span class="koboSpan" id="kobo.299.1">
     strings we passed to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.300.1">
      add_argument()
     </span>
    </code>
    <span class="koboSpan" id="kobo.301.1">
     method.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.302.1">
      To help you appreciate the power of
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.303.1">
       argparse
      </span>
     </code>
     <span class="koboSpan" id="kobo.304.1">
      , we have added a version of the greeter script that does not use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.305.1">
       argparse
      </span>
     </code>
     <span class="koboSpan" id="kobo.306.1">
      in the source code for this chapter.
     </span>
     <span class="koboSpan" id="kobo.306.2">
      You can find it in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.307.1">
       argument_parsing/greet.argv.py
      </span>
     </code>
     <span class="koboSpan" id="kobo.308.1">
      file.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.309.1">
     We have only scratched the surface of what
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.310.1">
      argparse
     </span>
    </code>
    <span class="koboSpan" id="kobo.311.1">
     is capable of in this section.
    </span>
    <span class="koboSpan" id="kobo.311.2">
     We will show you a few more advanced features in the next section, as we explore the railway CLI application.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-378">
    <span class="koboSpan" id="kobo.312.1">
     Building a CLI client for the railway API
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.313.1">
     Now that we have
    </span>
    <a id="_idIndexMarker1320">
    </a>
    <span class="koboSpan" id="kobo.314.1">
     covered the basics of command-line argument parsing, we are ready to start working on a more complex CLI application.
    </span>
    <span class="koboSpan" id="kobo.314.2">
     You will find the code for the application under the project directory in the source code for this chapter.
    </span>
    <span class="koboSpan" id="kobo.314.3">
     Let us start by taking a look at the contents of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.315.1">
      project
     </span>
    </code>
    <span class="koboSpan" id="kobo.316.1">
     directory.
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.317.1">$ tree -a project
project
├── .env.example
├── railway_cli
│   ├── __init__.py
│   ├── __main__.py
│   ├── api
│   │   ├── __init__.py
│   │   ├── client.py
│   │   └── schemas.py
│   ├── cli.py
│   ├── commands
│   │   ├── __init__.py
│   │   ├── admin.py
│   │   ├── base.py
│   │   └── stations.py
│   ├── config.py
│   └── exceptions.py
└── secrets
    ├── railway_api_email
    └── railway_api_password
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.318.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.319.1">
      .env.example
     </span>
    </code>
    <span class="koboSpan" id="kobo.320.1">
     file is a template for creating a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.321.1">
      .env
     </span>
    </code>
    <span class="koboSpan" id="kobo.322.1">
     configuration file for the railway application.
    </span>
    <span class="koboSpan" id="kobo.322.2">
     The files in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.323.1">
      secrets
     </span>
    </code>
    <span class="koboSpan" id="kobo.324.1">
     directory contain credentials needed to authenticate with the railway API as an admin user.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.325.1">
      To successfully run the examples in this section, you need to have the API from
     </span>
     <em class="chapterRef">
      <span class="koboSpan" id="kobo.326.1">
       Chapter 14, Introduction to API Development
      </span>
     </em>
     <span class="koboSpan" id="kobo.327.1">
      , running.
     </span>
     <span class="koboSpan" id="kobo.327.2">
      You also need to create a copy of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.328.1">
       .env.example
      </span>
     </code>
     <span class="koboSpan" id="kobo.329.1">
      file named
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.330.1">
       .env
      </span>
     </code>
     <span class="koboSpan" id="kobo.331.1">
      and ensure it contains the correct URL for the API.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.332.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.333.1">
      railway_cli
     </span>
    </code>
    <span class="koboSpan" id="kobo.334.1">
     directory
    </span>
    <a id="_idIndexMarker1321">
    </a>
    <span class="koboSpan" id="kobo.335.1">
     is the Python package for the railway CLI application.
    </span>
    <span class="koboSpan" id="kobo.335.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.336.1">
      api
     </span>
    </code>
    <span class="koboSpan" id="kobo.337.1">
     sub-package contains the code for interacting with the railway API.
    </span>
    <span class="koboSpan" id="kobo.337.2">
     In the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.338.1">
      commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.339.1">
     sub-package, you will find the implementation of the sub-commands of the application.
    </span>
    <span class="koboSpan" id="kobo.339.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.340.1">
      exceptions.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.341.1">
     module defines exceptions for errors that can occur within the application.
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.342.1">
      config.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.343.1">
     contains code for handling global configuration settings.
    </span>
    <span class="koboSpan" id="kobo.343.2">
     The main function driving the CLI application is in
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.344.1">
      cli.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.345.1">
     .
    </span>
    <span class="koboSpan" id="kobo.345.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.346.1">
      __main__.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.347.1">
     module is a special file that makes the package executable.
    </span>
    <span class="koboSpan" id="kobo.347.2">
     When the package is executed with a command like
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.348.1">$ python -m railway_cli
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.349.1">
     Python will load and execute the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.350.1">
      __main__.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.351.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.351.2">
     Its contents are as follows:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.352.1"># project/railway_cli/__main__.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.353.1">from</span></span><span class="koboSpan" id="kobo.354.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.355.1">import</span></span><span class="koboSpan" id="kobo.356.1"> cli
cli.main()
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.357.1">
     All this module does
    </span>
    <a id="_idIndexMarker1322">
    </a>
    <span class="koboSpan" id="kobo.358.1">
     is import the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.359.1">
      cli
     </span>
    </code>
    <span class="koboSpan" id="kobo.360.1">
     module and call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.361.1">
      cli.main()
     </span>
    </code>
    <span class="koboSpan" id="kobo.362.1">
     function, which is the main entry point for the CLI application.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-379">
    <span class="koboSpan" id="kobo.363.1">
     Interacting with the railway API
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.364.1">
     Before we delve into the
    </span>
    <a id="_idIndexMarker1323">
    </a>
    <span class="koboSpan" id="kobo.365.1">
     command-line interface code, we want to briefly discuss the API client code.
    </span>
    <span class="koboSpan" id="kobo.365.2">
     Instead of looking at the code in detail, we will just give you a high-level overview.
    </span>
    <span class="koboSpan" id="kobo.365.3">
     We leave it as an exercise for you to study the code in depth.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.366.1">
     In the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.367.1">
      api
     </span>
    </code>
    <span class="koboSpan" id="kobo.368.1">
     sub-package, you will find two modules,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.369.1">
      client.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.370.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.371.1">
      schemas.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.372.1">
     :
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.373.1">
       schemas.py
      </span>
     </code>
     <span class="koboSpan" id="kobo.374.1">
      defines
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.375.1">
       pydantic
      </span>
     </code>
     <span class="koboSpan" id="kobo.376.1">
      models to represent the objects we expect to receive from the API (we have only defined models for stations and trains).
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.377.1">
       client.py
      </span>
     </code>
     <span class="koboSpan" id="kobo.378.1">
      contains three classes and some helper functions:
     </span>
     <ul>
      <li class="bulletList level-2">
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.379.1">
         HTTPClient
        </span>
       </code>
       <span class="koboSpan" id="kobo.380.1">
        is a generic class for making
       </span>
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.381.1">
         HTTP
        </span>
       </strong>
       <span class="koboSpan" id="kobo.382.1">
        requests.
       </span>
       <span class="koboSpan" id="kobo.382.2">
        It is a wrapper around a
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.383.1">
         Session
        </span>
       </code>
       <span class="koboSpan" id="kobo.384.1">
        object from the
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.385.1">
         requests
        </span>
       </code>
       <span class="koboSpan" id="kobo.386.1">
        library.
       </span>
       <span class="koboSpan" id="kobo.386.2">
        It has methods corresponding to the HTTP verbs the API uses (
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.387.1">
         get
        </span>
       </code>
       <span class="koboSpan" id="kobo.388.1">
        ,
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.389.1">
         post
        </span>
       </code>
       <span class="koboSpan" id="kobo.390.1">
        ,
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.391.1">
         put
        </span>
       </code>
       <span class="koboSpan" id="kobo.392.1">
        , and
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.393.1">
         delete
        </span>
       </code>
       <span class="koboSpan" id="kobo.394.1">
        ).
       </span>
       <span class="koboSpan" id="kobo.394.2">
        This class takes care of error handling and extracting data from API responses.
       </span>
      </li>
      <li class="bulletList level-2">
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.395.1">
         StationClient
        </span>
       </code>
       <span class="koboSpan" id="kobo.396.1">
        is a higher-level client for interacting with the API’s station endpoints.
       </span>
      </li>
      <li class="bulletList level-2">
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.397.1">
         AdminClient
        </span>
       </code>
       <span class="koboSpan" id="kobo.398.1">
        is a higher-level client for working with the admin endpoints.
       </span>
       <span class="koboSpan" id="kobo.398.2">
        It has a method for authenticating users with the
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.399.1">
         users/authenticate
        </span>
       </code>
       <span class="koboSpan" id="kobo.400.1">
        endpoint and a method for deleting a station via the
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.401.1">
         admin/stations/{station_id}
        </span>
       </code>
       <span class="koboSpan" id="kobo.402.1">
        endpoint.
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <h2 class="heading-2" id="_idParaDest-380">
    <span class="koboSpan" id="kobo.403.1">
     Creating the command-line interface
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.404.1">
     We will start our
    </span>
    <a id="_idIndexMarker1324">
    </a>
    <span class="koboSpan" id="kobo.405.1">
     exploration of the code with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.406.1">
      cli.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.407.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.407.2">
     We will examine it in chunks, starting with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.408.1">
      main()
     </span>
    </code>
    <span class="koboSpan" id="kobo.409.1">
     function.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.410.1"># project/railway_cli/cli.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.411.1">import</span></span><span class="koboSpan" id="kobo.412.1"> argparse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.413.1">import</span></span><span class="koboSpan" id="kobo.414.1"> sys
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.415.1">from</span></span><span class="koboSpan" id="kobo.416.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.417.1">import</span></span><span class="koboSpan" id="kobo.418.1"> __version__, commands, config, exceptions
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.419.1">from</span></span><span class="koboSpan" id="kobo.420.1"> .commands.base </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.421.1">import</span></span><span class="koboSpan" id="kobo.422.1"> Command
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.423.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.424.1">main</span></span><span class="koboSpan" id="kobo.425.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.426.1">cmdline: </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.427.1">list</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.428.1">[</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.429.1">str</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.430.1">] | </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.431.1">None</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.432.1"> = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.433.1">None</span></span><span class="koboSpan" id="kobo.434.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.435.1">None</span></span><span class="koboSpan" id="kobo.436.1">:
    arg_parser = get_arg_parser()
    args = arg_parser.parse_args(cmdline)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.437.1">try</span></span><span class="koboSpan" id="kobo.438.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.439.1"># args.command is expected to be a Command class</span></span><span class="koboSpan" id="kobo.440.1">
        command: Command = args.command(args)
        command.execute()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.441.1">except</span></span><span class="koboSpan" id="kobo.442.1"> exceptions.APIError </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.443.1">as</span></span><span class="koboSpan" id="kobo.444.1"> exc:
        sys.exit(</span><span class="hljs-string"><span class="koboSpan" id="kobo.445.1">f"API error: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.446.1">{exc}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.447.1">"</span></span><span class="koboSpan" id="kobo.448.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.449.1">except</span></span><span class="koboSpan" id="kobo.450.1"> exceptions.CommandError </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.451.1">as</span></span><span class="koboSpan" id="kobo.452.1"> exc:
        sys.exit(</span><span class="hljs-string"><span class="koboSpan" id="kobo.453.1">f"Command error: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.454.1">{exc}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.455.1">"</span></span><span class="koboSpan" id="kobo.456.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.457.1">except</span></span><span class="koboSpan" id="kobo.458.1"> exceptions.ConfigurationError </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.459.1">as</span></span><span class="koboSpan" id="kobo.460.1"> exc:
        sys.exit(</span><span class="hljs-string"><span class="koboSpan" id="kobo.461.1">f"Configuration error: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.462.1">{exc}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.463.1">"</span></span><span class="koboSpan" id="kobo.464.1">)
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.465.1">
     We start by importing the standard library modules
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.466.1">
      argparse
     </span>
    </code>
    <span class="koboSpan" id="kobo.467.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.468.1">
      sys
     </span>
    </code>
    <span class="koboSpan" id="kobo.469.1">
     .
    </span>
    <span class="koboSpan" id="kobo.469.2">
     We also import
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.470.1">
      __version__
     </span>
    </code>
    <span class="koboSpan" id="kobo.471.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.472.1">
      config
     </span>
    </code>
    <span class="koboSpan" id="kobo.473.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.474.1">
      commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.475.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.476.1">
      exceptions
     </span>
    </code>
    <span class="koboSpan" id="kobo.477.1">
     from the current package and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.478.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.479.1">
     class from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.480.1">
      commands.base
     </span>
    </code>
    <span class="koboSpan" id="kobo.481.1">
     module.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.482.1">
      It is a common convention for Python modules and packages to expose their version number under the name
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.483.1">
       __version__
      </span>
     </code>
     <span class="koboSpan" id="kobo.484.1">
      .
     </span>
     <span class="koboSpan" id="kobo.484.2">
      It is typically a string and is normally defined in the top-level
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.485.1">
       __init__.py
      </span>
     </code>
     <span class="koboSpan" id="kobo.486.1">
      file of a package.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.487.1">
     In the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.488.1">
      main()
     </span>
    </code>
    <span class="koboSpan" id="kobo.489.1">
     function, we call
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.490.1">
      get_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.491.1">
     to get an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.492.1">
      ArgumentParser
     </span>
    </code>
    <span class="koboSpan" id="kobo.493.1">
     instance and call its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.494.1">
      parse_args()
     </span>
    </code>
    <span class="koboSpan" id="kobo.495.1">
     method to parse the command-line arguments.
    </span>
    <span class="koboSpan" id="kobo.495.2">
     We expect the returned
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.496.1">
      Namespace
     </span>
    </code>
    <span class="koboSpan" id="kobo.497.1">
     object to have a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.498.1">
      command
     </span>
    </code>
    <span class="koboSpan" id="kobo.499.1">
     attribute, which should be a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.500.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.501.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.501.2">
     We create an instance of this class, passing it the parsed arguments.
    </span>
    <span class="koboSpan" id="kobo.501.3">
     Finally, we call the command’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.502.1">
      execute()
     </span>
    </code>
    <span class="koboSpan" id="kobo.503.1">
     method.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.504.1">
     We handle
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.505.1">
      APIError
     </span>
    </code>
    <span class="koboSpan" id="kobo.506.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.507.1">
      CommandError
     </span>
    </code>
    <span class="koboSpan" id="kobo.508.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.509.1">
      ConfigurationError
     </span>
    </code>
    <span class="koboSpan" id="kobo.510.1">
     exceptions by calling
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.511.1">
      sys.exit()
     </span>
    </code>
    <span class="koboSpan" id="kobo.512.1">
     to exit with an error message tailored to the type of exception that occurred.
    </span>
    <span class="koboSpan" id="kobo.512.2">
     These are the only exceptions raised in our application code.
    </span>
    <span class="koboSpan" id="kobo.512.3">
     If any other unexpected error happens, Python will terminate the application and print a full exception traceback to the user’s console.
    </span>
    <span class="koboSpan" id="kobo.512.4">
     This may not seem very user-friendly, but it will make debugging much easier.
    </span>
    <span class="koboSpan" id="kobo.512.5">
     Users of CLI applications also tend to be more technically adept and so are less likely to be put off by exception tracebacks than users of GUI or web applications.
    </span>
   </p>
   <div class="packt_tip">
    <p class="normal">
     <span class="koboSpan" id="kobo.513.1">
      Note that the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.514.1">
       main()
      </span>
     </code>
     <span class="koboSpan" id="kobo.515.1">
      function has an optional parameter
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.516.1">
       cmdline
      </span>
     </code>
     <span class="koboSpan" id="kobo.517.1">
      , which we pass to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.518.1">
       parse_args()
      </span>
     </code>
     <span class="koboSpan" id="kobo.519.1">
      method.
     </span>
     <span class="koboSpan" id="kobo.519.2">
      If
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.520.1">
       cmdline
      </span>
     </code>
     <span class="koboSpan" id="kobo.521.1">
      is
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.522.1">
       None
      </span>
     </code>
     <span class="koboSpan" id="kobo.523.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.524.1">
       parse_args()
      </span>
     </code>
     <span class="koboSpan" id="kobo.525.1">
      will default to parsing arguments from
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.526.1">
       sys.argv
      </span>
     </code>
     <span class="koboSpan" id="kobo.527.1">
      .
     </span>
     <span class="koboSpan" id="kobo.527.2">
      However, if we pass a list of strings,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.528.1">
       parse_args()
      </span>
     </code>
     <span class="koboSpan" id="kobo.529.1">
      will parse that instead.
     </span>
     <span class="koboSpan" id="kobo.529.2">
      Structuring the code like this is especially useful for unit testing as it allows us to avoid manipulating the global
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.530.1">
       sys.argv
      </span>
     </code>
     <span class="koboSpan" id="kobo.531.1">
      in our tests.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.532.1">
     We will look at the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.533.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.534.1">
     class and how the argument parser is set up to return the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.535.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.536.1">
     class to
    </span>
    <a id="_idIndexMarker1325">
    </a>
    <span class="koboSpan" id="kobo.537.1">
     execute shortly.
    </span>
    <span class="koboSpan" id="kobo.537.2">
     Let us first turn our attention to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.538.1">
      get_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.539.1">
     function, though.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.540.1"># project/railway_cli/cli.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.541.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.542.1">get_arg_parser</span></span><span class="koboSpan" id="kobo.543.1">() -&gt; argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        prog=__package__,
        description=</span><span class="hljs-string"><span class="koboSpan" id="kobo.544.1">"Commandline interface for the Railway API"</span></span><span class="koboSpan" id="kobo.545.1">,
        formatter_class=argparse.ArgumentDefaultsHelpFormatter,
    )
    parser.add_argument(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.546.1">"-V"</span></span><span class="koboSpan" id="kobo.547.1">,
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.548.1">"--version"</span></span><span class="koboSpan" id="kobo.549.1">,
        action=</span><span class="hljs-string"><span class="koboSpan" id="kobo.550.1">"version"</span></span><span class="koboSpan" id="kobo.551.1">,
        version=</span><span class="hljs-string"><span class="koboSpan" id="kobo.552.1">f"%(prog)s </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.553.1">{__version__}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.554.1">"</span></span><span class="koboSpan" id="kobo.555.1">,
    )
    config.configure_arg_parser(parser)
    commands.configure_parsers(parser)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1">return</span></span><span class="koboSpan" id="kobo.557.1"> parser
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.558.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.559.1">
      get_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.560.1">
     function creates and configures an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.561.1">
      ArgumentParser
     </span>
    </code>
    <span class="koboSpan" id="kobo.562.1">
     instance for the application.
    </span>
    <span class="koboSpan" id="kobo.562.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.563.1">
      prog
     </span>
    </code>
    <span class="koboSpan" id="kobo.564.1">
     argument specifies the program name to use in help messages.
    </span>
    <span class="koboSpan" id="kobo.564.2">
     Normally,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.565.1">
      argparse
     </span>
    </code>
    <span class="koboSpan" id="kobo.566.1">
     takes this from
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.567.1">
      sys.argv[0]
     </span>
    </code>
    <span class="koboSpan" id="kobo.568.1">
     ; however, for a package executed via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.569.1">
      python -m package_name
     </span>
    </code>
    <span class="koboSpan" id="kobo.570.1">
     , that is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.571.1">
      __main__.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.572.1">
     , so we override it with the name of the
    </span>
    <a id="_idIndexMarker1326">
    </a>
    <span class="koboSpan" id="kobo.573.1">
     package instead.
    </span>
    <span class="koboSpan" id="kobo.573.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.574.1">
      description
     </span>
    </code>
    <span class="koboSpan" id="kobo.575.1">
     argument provides a brief description of the program to display in the help message.
    </span>
    <span class="koboSpan" id="kobo.575.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.576.1">
      formatter_class
     </span>
    </code>
    <span class="koboSpan" id="kobo.577.1">
     determines how help messages are formatted (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.578.1">
      ArgumentDefaultsHelpFormatter
     </span>
    </code>
    <span class="koboSpan" id="kobo.579.1">
     adds the default values of all options to the help message).
    </span>
    <span class="koboSpan" id="kobo.579.2">
     We add a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.580.1">
      "-V"
     </span>
    </code>
    <span class="koboSpan" id="kobo.581.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.582.1">
      "--version"
     </span>
    </code>
    <span class="koboSpan" id="kobo.583.1">
     option using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.584.1">
      "version"
     </span>
    </code>
    <span class="koboSpan" id="kobo.585.1">
     action, which will print the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.586.1">
      version
     </span>
    </code>
    <span class="koboSpan" id="kobo.587.1">
     message and exit if this option is encountered on the command line.
    </span>
    <span class="koboSpan" id="kobo.587.2">
     Finally, we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.588.1">
      config.configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.589.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.590.1">
      commands.configure_parsers()
     </span>
    </code>
    <span class="koboSpan" id="kobo.591.1">
     functions to further configure the parser before returning it.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.592.1">
      The Python import system sets the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.593.1">
       __package__
      </span>
     </code>
     <span class="koboSpan" id="kobo.594.1">
      attribute of every imported module to the name of the package it belongs to.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.595.1">
     In the next sections, we will look at the command-line argument configuration for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.596.1">
      config
     </span>
    </code>
    <span class="koboSpan" id="kobo.597.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.598.1">
      commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.599.1">
     modules, starting with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.600.1">
      config
     </span>
    </code>
    <span class="koboSpan" id="kobo.601.1">
     .
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-381">
    <span class="koboSpan" id="kobo.602.1">
     Configuration files and secrets
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.603.1">
     Besides
    </span>
    <a id="_idIndexMarker1327">
    </a>
    <span class="koboSpan" id="kobo.604.1">
     command-line arguments, many CLI applications also read settings from configuration files.
    </span>
    <span class="koboSpan" id="kobo.604.2">
     Configuration files are often used for settings like API URLs that do not usually change from one invocation of an application to the next.
    </span>
    <span class="koboSpan" id="kobo.604.3">
     It would be rather tedious for users to provide these on the command line every time they run an application.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.605.1">
     Another common use case
    </span>
    <a id="_idIndexMarker1328">
    </a>
    <span class="koboSpan" id="kobo.606.1">
     for configuration files is to supply passwords and other secrets.
    </span>
    <span class="koboSpan" id="kobo.606.2">
     It is not considered good security practice to provide passwords as command-line arguments because, on most operating systems, any logged-in user can see the full command line of any running application.
    </span>
    <span class="koboSpan" id="kobo.606.3">
     Most shells also have a command history feature, which can potentially expose passwords that are passed as command-line arguments.
    </span>
    <span class="koboSpan" id="kobo.606.4">
     It is much more secure to provide passwords in configuration files or dedicated secret files, which are files used to configure a secret, such as a password.
    </span>
    <span class="koboSpan" id="kobo.606.5">
     The filename corresponds to the name of the secret and the content of the file is the secret itself.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.607.1">
      It is very important to remember that it is never safe to store secrets alongside our code.
     </span>
     <span class="koboSpan" id="kobo.607.2">
      Especially if you use a versioning system, like Git or Mercurial, be careful never to commit any secret with the source code.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.608.1">
     In the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.609.1">
      railway_cli
     </span>
    </code>
    <span class="koboSpan" id="kobo.610.1">
     application, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.611.1">
      config
     </span>
    </code>
    <span class="koboSpan" id="kobo.612.1">
     module is responsible for handling configuration files and secrets.
    </span>
    <span class="koboSpan" id="kobo.612.2">
     We use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.613.1">
      pydantic-settings
     </span>
    </code>
    <span class="koboSpan" id="kobo.614.1">
     library, which we already encountered in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.615.1">
      Chapter 14, Introduction to API Development
     </span>
    </em>
    <span class="koboSpan" id="kobo.616.1">
     , to manage the configuration.
    </span>
    <span class="koboSpan" id="kobo.616.2">
     Let us
    </span>
    <a id="_idIndexMarker1329">
    </a>
    <span class="koboSpan" id="kobo.617.1">
     look at the code in chunks.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.618.1"># project/railway_cli/config.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.619.1">import</span></span><span class="koboSpan" id="kobo.620.1"> argparse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.621.1">from</span></span><span class="koboSpan" id="kobo.622.1"> getpass </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.623.1">import</span></span><span class="koboSpan" id="kobo.624.1"> getpass
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.625.1">from</span></span><span class="koboSpan" id="kobo.626.1"> pydantic </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.627.1">import</span></span><span class="koboSpan" id="kobo.628.1"> EmailStr, Field, SecretStr, ValidationError
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.629.1">from</span></span><span class="koboSpan" id="kobo.630.1"> pydantic_settings </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.631.1">import</span></span><span class="koboSpan" id="kobo.632.1"> BaseSettings, SettingsConfigDict
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.633.1">from</span></span><span class="koboSpan" id="kobo.634.1"> .exceptions </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.635.1">import</span></span><span class="koboSpan" id="kobo.636.1"> ConfigurationError
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.637.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.638.1">Settings</span></span><span class="koboSpan" id="kobo.639.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.640.1">BaseSettings</span></span><span class="koboSpan" id="kobo.641.1">):
    url: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.642.1">str</span></span><span class="koboSpan" id="kobo.643.1">
    secrets_dir: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.644.1">str</span></span><span class="koboSpan" id="kobo.645.1"> | </span><span class="hljs-literal"><span class="koboSpan" id="kobo.646.1">None</span></span><span class="koboSpan" id="kobo.647.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.648.1">None</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.649.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.650.1">AdminCredentials</span></span><span class="koboSpan" id="kobo.651.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.652.1">BaseSettings</span></span><span class="koboSpan" id="kobo.653.1">):
    model_config = SettingsConfigDict(env_prefix=</span><span class="hljs-string"><span class="koboSpan" id="kobo.654.1">"railway_api_"</span></span><span class="koboSpan" id="kobo.655.1">)
    email: EmailStr
    password: SecretStr = Field(
        default_factory=</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.656.1">lambda</span></span><span class="koboSpan" id="kobo.657.1">: SecretStr(
            getpass(prompt=</span><span class="hljs-string"><span class="koboSpan" id="kobo.658.1">"Admin Password: "</span></span><span class="koboSpan" id="kobo.659.1">)
        )
    )
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.660.1">
     After the imports
    </span>
    <a id="_idIndexMarker1330">
    </a>
    <span class="koboSpan" id="kobo.661.1">
     at the top of the file, we have two classes:
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.662.1">
      Settings
     </span>
    </code>
    <span class="koboSpan" id="kobo.663.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.664.1">
      AdminCredentials
     </span>
    </code>
    <span class="koboSpan" id="kobo.665.1">
     .
    </span>
    <span class="koboSpan" id="kobo.665.2">
     Both inherit from
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.666.1">
      pydantic_settings.BaseSettings
     </span>
    </code>
    <span class="koboSpan" id="kobo.667.1">
     .
    </span>
    <span class="koboSpan" id="kobo.667.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.668.1">
      Settings
     </span>
    </code>
    <span class="koboSpan" id="kobo.669.1">
     class defines the general configuration for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.670.1">
      railway_cli
     </span>
    </code>
    <span class="koboSpan" id="kobo.671.1">
     application:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.672.1">
       url
      </span>
     </code>
     <span class="koboSpan" id="kobo.673.1">
      : is used to configure the railway API URL.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.674.1">
       secrets_dir
      </span>
     </code>
     <span class="koboSpan" id="kobo.675.1">
      : can be used to configure a path to a directory containing secret files.
     </span>
     <span class="koboSpan" id="kobo.675.2">
      The API admin credentials will be loaded from secret files in this directory.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.676.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.677.1">
      AdminCredentials
     </span>
    </code>
    <span class="koboSpan" id="kobo.678.1">
     class defines the credentials needed to authenticate with the API as an admin user.
    </span>
    <span class="koboSpan" id="kobo.678.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.679.1">
      env_prefix
     </span>
    </code>
    <span class="koboSpan" id="kobo.680.1">
     argument to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.681.1">
      SettingsConfigDict
     </span>
    </code>
    <span class="koboSpan" id="kobo.682.1">
     will be prefixed to the field names when looking up values in the secrets directory.
    </span>
    <span class="koboSpan" id="kobo.682.2">
     For example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.683.1">
      password
     </span>
    </code>
    <span class="koboSpan" id="kobo.684.1">
     will be looked up in a file named
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.685.1">
      railway_api_password
     </span>
    </code>
    <span class="koboSpan" id="kobo.686.1">
     .
    </span>
    <span class="koboSpan" id="kobo.686.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.687.1">
      AdminCredentials
     </span>
    </code>
    <span class="koboSpan" id="kobo.688.1">
     class contains the following fields:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.689.1">
       email
      </span>
     </code>
     <span class="koboSpan" id="kobo.690.1">
      : will contain the admin email address to authenticate with.
     </span>
     <span class="koboSpan" id="kobo.690.2">
      We use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.691.1">
       pydantic.EmailStr
      </span>
     </code>
     <span class="koboSpan" id="kobo.692.1">
      type to ensure that it contains a valid email address.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.693.1">
       password
      </span>
     </code>
     <span class="koboSpan" id="kobo.694.1">
      : will contain the admin password.
     </span>
     <span class="koboSpan" id="kobo.694.2">
      We use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.695.1">
       pydantic.SecretStr
      </span>
     </code>
     <span class="koboSpan" id="kobo.696.1">
      type to ensure that the value will be masked with asterisks when printed (for example, in application logs).
     </span>
     <span class="koboSpan" id="kobo.696.2">
      If no value is provided when the class is instantiated (via a secret file or an argument to the class constructor),
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.697.1">
       pydantic
      </span>
     </code>
     <span class="koboSpan" id="kobo.698.1">
      will call the function provided via the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.699.1">
       default_factory
      </span>
     </code>
     <span class="koboSpan" id="kobo.700.1">
      argument to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.701.1">
       Field
      </span>
     </code>
     <span class="koboSpan" id="kobo.702.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.702.2">
      We use this to call the standard library
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.703.1">
       getpass
      </span>
     </code>
     <span class="koboSpan" id="kobo.704.1">
      function to securely prompt the user for the admin password.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.705.1">
     Below these class definitions, you will find the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.706.1">
      configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.707.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.707.2">
     Let us look at that now:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.708.1"># project/railway_cli/config.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.709.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.710.1">configure_arg_parser</span></span><span class="koboSpan" id="kobo.711.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.712.1">parser: argparse.ArgumentParser</span></span><span class="koboSpan" id="kobo.713.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.714.1">None</span></span><span class="koboSpan" id="kobo.715.1">:
    config_group = parser.add_argument_group(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.716.1">"configuration"</span></span><span class="koboSpan" id="kobo.717.1">,
        description=</span><span class="hljs-string"><span class="koboSpan" id="kobo.718.1">"""The API URL must be set in the</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.719.1">        configuration file. </span><span class="koboSpan" id="kobo.719.2">The admin email and password should be</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.720.1">        configured via secrets files named email and password in a</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.721.1">        secrets directory."""</span></span><span class="koboSpan" id="kobo.722.1">,
    )
    config_group.add_argument(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.723.1">"--config-file"</span></span><span class="koboSpan" id="kobo.724.1">,
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.725.1">help</span></span><span class="koboSpan" id="kobo.726.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.727.1">"Load configuration from a file"</span></span><span class="koboSpan" id="kobo.728.1">,
        default=</span><span class="hljs-string"><span class="koboSpan" id="kobo.729.1">".env"</span></span><span class="koboSpan" id="kobo.730.1">,
    )
    config_group.add_argument(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.731.1">"--secrets-dir"</span></span><span class="koboSpan" id="kobo.732.1">,
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.733.1">help</span></span><span class="koboSpan" id="kobo.734.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.735.1">"""The secrets directory. </span><span class="koboSpan" id="kobo.735.2">Can also be set via the</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.736.1">        configuration file."""</span></span><span class="koboSpan" id="kobo.737.1">,
    )
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.738.1">
     We use the argument parser’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.739.1">
      add_argument_group()
     </span>
    </code>
    <span class="koboSpan" id="kobo.740.1">
     method to create an argument group named
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.741.1">
      "configuration"
     </span>
    </code>
    <span class="koboSpan" id="kobo.742.1">
     and give it a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.743.1">
      description
     </span>
    </code>
    <span class="koboSpan" id="kobo.744.1">
     .
    </span>
    <span class="koboSpan" id="kobo.744.2">
     We add options allowing a user to specify a configuration file name and a secrets directory to this group.
    </span>
    <span class="koboSpan" id="kobo.744.3">
     Note that argument groups do not affect how arguments are parsed or returned.
    </span>
    <span class="koboSpan" id="kobo.744.4">
     It only
    </span>
    <a id="_idIndexMarker1331">
    </a>
    <span class="koboSpan" id="kobo.745.1">
     means that these arguments will be grouped together under a common heading in the help message.
    </span>
   </p>
   <div class="packt_tip">
    <p class="normal">
     <span class="koboSpan" id="kobo.746.1">
      For the sake of simplicity, we set the default configuration file path in this example to
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.747.1">
       .env
      </span>
     </code>
     <span class="koboSpan" id="kobo.748.1">
      .
     </span>
     <span class="koboSpan" id="kobo.748.2">
      It is, however, considered best practice to use the standard configuration file locations for the platform your application is running on.
     </span>
     <span class="koboSpan" id="kobo.748.3">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.749.1">
       platformdirs
      </span>
     </code>
     <span class="koboSpan" id="kobo.750.1">
      library (
     </span>
     <a href="https://platformdirs.readthedocs.io">
      <span class="url">
       <span class="koboSpan" id="kobo.751.1">
        https://platformdirs.readthedocs.io
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.752.1">
      ) can
     </span>
     <a id="_idIndexMarker1332">
     </a>
     <span class="koboSpan" id="kobo.753.1">
      be particularly helpful for this.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.754.1">
     The final part of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.755.1">
      config.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.756.1">
     module consists of helper functions for retrieving the settings and admin credentials:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.757.1"># project/railway_cli/config.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.758.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.759.1">get_settings</span></span><span class="koboSpan" id="kobo.760.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.761.1">args: argparse.Namespace</span></span><span class="koboSpan" id="kobo.762.1">) -&gt; Settings:
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.763.1">try</span></span><span class="koboSpan" id="kobo.764.1">:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.765.1">return</span></span><span class="koboSpan" id="kobo.766.1"> Settings(_env_file=args.config_file)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.767.1">except</span></span><span class="koboSpan" id="kobo.768.1"> ValidationError </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.769.1">as</span></span><span class="koboSpan" id="kobo.770.1"> exc:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.771.1">raise</span></span><span class="koboSpan" id="kobo.772.1"> ConfigurationError(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.773.1">str</span></span><span class="koboSpan" id="kobo.774.1">(exc)) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.775.1">from</span></span><span class="koboSpan" id="kobo.776.1"> exc
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.777.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.778.1">get_admin_credentials</span></span><span class="koboSpan" id="kobo.779.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.780.1">    args: argparse.Namespace, settings: Settings</span></span><span class="koboSpan" id="kobo.781.1">
) -&gt; AdminCredentials:
    secrets_dir = args.secrets_dir
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.782.1">if</span></span><span class="koboSpan" id="kobo.783.1"> secrets_dir </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.784.1">is</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.785.1">None</span></span><span class="koboSpan" id="kobo.786.1">:
        secrets_dir = settings.secrets_dir
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.787.1">try</span></span><span class="koboSpan" id="kobo.788.1">:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.789.1">return</span></span><span class="koboSpan" id="kobo.790.1"> AdminCredentials(_secrets_dir=secrets_dir)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.791.1">except</span></span><span class="koboSpan" id="kobo.792.1"> ValidationError </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.793.1">as</span></span><span class="koboSpan" id="kobo.794.1"> exc:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.795.1">raise</span></span><span class="koboSpan" id="kobo.796.1"> ConfigurationError(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.797.1">str</span></span><span class="koboSpan" id="kobo.798.1">(exc)) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.799.1">from</span></span><span class="koboSpan" id="kobo.800.1"> exc
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.801.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.802.1">
      get_settings()
     </span>
    </code>
    <span class="koboSpan" id="kobo.803.1">
     function creates and returns an instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.804.1">
      Settings
     </span>
    </code>
    <span class="koboSpan" id="kobo.805.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.805.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.806.1">
      _env_file=args.config_file
     </span>
    </code>
    <span class="koboSpan" id="kobo.807.1">
     argument tells
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.808.1">
      pydantic-settings
     </span>
    </code>
    <span class="koboSpan" id="kobo.809.1">
     to load the settings from the file specified via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.810.1">
      --config-file
     </span>
    </code>
    <span class="koboSpan" id="kobo.811.1">
     command-line option (which defaults to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.812.1">
      .env
     </span>
    </code>
    <span class="koboSpan" id="kobo.813.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.813.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.814.1">
      get_admin_credentials()
     </span>
    </code>
    <span class="koboSpan" id="kobo.815.1">
     function creates and returns an instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.816.1">
      AdminCredentials
     </span>
    </code>
    <span class="koboSpan" id="kobo.817.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.817.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.818.1">
      _secrets_dir
     </span>
    </code>
    <span class="koboSpan" id="kobo.819.1">
     argument to the class specifies the secrets directory where
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.820.1">
      pydantic-settings
     </span>
    </code>
    <span class="koboSpan" id="kobo.821.1">
     will look for the credentials.
    </span>
    <span class="koboSpan" id="kobo.821.2">
     If
    </span>
    <a id="_idIndexMarker1333">
    </a>
    <span class="koboSpan" id="kobo.822.1">
     a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.823.1">
      --secrets-dir
     </span>
    </code>
    <span class="koboSpan" id="kobo.824.1">
     option was set on the command line, we will use that; otherwise, use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.825.1">
      settings.secrets_dir
     </span>
    </code>
    <span class="koboSpan" id="kobo.826.1">
     .
    </span>
    <span class="koboSpan" id="kobo.826.2">
     If that is also
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.827.1">
      None
     </span>
    </code>
    <span class="koboSpan" id="kobo.828.1">
     , no secrets directory will be used.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-382">
    <span class="koboSpan" id="kobo.829.1">
     Creating sub-commands
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.830.1">
     The railway API
    </span>
    <a id="_idIndexMarker1334">
    </a>
    <span class="koboSpan" id="kobo.831.1">
     has separate endpoints for listing stations, creating stations, getting departures, and so on.
    </span>
    <span class="koboSpan" id="kobo.831.2">
     It makes sense to have a similar structure in our application.
    </span>
    <span class="koboSpan" id="kobo.831.3">
     There are many ways of structuring the code for sub-commands.
    </span>
    <span class="koboSpan" id="kobo.831.4">
     In this application, we have chosen to use an object-oriented approach.
    </span>
    <span class="koboSpan" id="kobo.831.5">
     Each command is implemented as a class, with a method to configure the argument parser with the options and arguments it needs, and a method to execute the command.
    </span>
    <span class="koboSpan" id="kobo.831.6">
     All commands are subclasses of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.832.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.833.1">
     base class.
    </span>
    <span class="koboSpan" id="kobo.833.2">
     You will find it in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.834.1">
      commands/base.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.835.1">
     module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.836.1"># project/railway_cli/commands/base.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.837.1">import</span></span><span class="koboSpan" id="kobo.838.1"> argparse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.839.1">from</span></span><span class="koboSpan" id="kobo.840.1"> typing </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.841.1">import</span></span><span class="koboSpan" id="kobo.842.1"> ClassVar
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.843.1">from</span></span><span class="koboSpan" id="kobo.844.1"> ..api.client </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.845.1">import</span></span><span class="koboSpan" id="kobo.846.1"> HTTPClient
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.847.1">from</span></span><span class="koboSpan" id="kobo.848.1"> ..config </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.849.1">import</span></span><span class="koboSpan" id="kobo.850.1"> get_settings
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.851.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.852.1">Command</span></span><span class="koboSpan" id="kobo.853.1">:
    name: ClassVar[</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.854.1">str</span></span><span class="koboSpan" id="kobo.855.1">]
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.856.1">help</span></span><span class="koboSpan" id="kobo.857.1">: ClassVar[</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.858.1">str</span></span><span class="koboSpan" id="kobo.859.1">]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.860.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.861.1">__init__</span></span><span class="koboSpan" id="kobo.862.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.863.1">self, args: argparse.Namespace</span></span><span class="koboSpan" id="kobo.864.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.865.1">None</span></span><span class="koboSpan" id="kobo.866.1">:
        self.args = args
        self.settings = get_settings(args)
        self.api_client = HTTPClient(self.settings.url)
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.867.1">    @classmethod</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.868.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.869.1">configure_arg_parser</span></span><span class="koboSpan" id="kobo.870.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.871.1">        cls, parser: argparse.ArgumentParser</span></span>
<span class="hljs-params">    </span><span class="koboSpan" id="kobo.872.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.873.1">None</span></span><span class="koboSpan" id="kobo.874.1">:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.875.1">raise</span></span><span class="koboSpan" id="kobo.876.1"> NotImplementedError
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.877.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.878.1">execute</span></span><span class="koboSpan" id="kobo.879.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.880.1">self</span></span><span class="koboSpan" id="kobo.881.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.882.1">None</span></span><span class="koboSpan" id="kobo.883.1">:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.884.1">raise</span></span><span class="koboSpan" id="kobo.885.1"> NotImplementedError
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.886.1">
     As you can see, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.887.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.888.1">
     class is an ordinary class.
    </span>
    <span class="koboSpan" id="kobo.888.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.889.1">
      ClassVar
     </span>
    </code>
    <span class="koboSpan" id="kobo.890.1">
     annotation on
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.891.1">
      name
     </span>
    </code>
    <span class="koboSpan" id="kobo.892.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.893.1">
      help
     </span>
    </code>
    <span class="koboSpan" id="kobo.894.1">
     indicates that these are expected to be class attributes, rather than instance attributes.
    </span>
    <span class="koboSpan" id="kobo.894.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.895.1">
      __init__()
     </span>
    </code>
    <span class="koboSpan" id="kobo.896.1">
     method takes an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.897.1">
      argparse.Namespace
     </span>
    </code>
    <span class="koboSpan" id="kobo.898.1">
     object, which it
    </span>
    <a id="_idIndexMarker1335">
    </a>
    <span class="koboSpan" id="kobo.899.1">
     assigns to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.900.1">
      self.args
     </span>
    </code>
    <span class="koboSpan" id="kobo.901.1">
     .
    </span>
    <span class="koboSpan" id="kobo.901.2">
     It calls
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.902.1">
      get_settings()
     </span>
    </code>
    <span class="koboSpan" id="kobo.903.1">
     to load the configuration file.
    </span>
    <span class="koboSpan" id="kobo.903.2">
     Before returning, it also creates an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.904.1">
      HTTPClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.905.1">
     object (from
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.906.1">
      api/client.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.907.1">
     ) and assigns it to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.908.1">
      self.api_client
     </span>
    </code>
    <span class="koboSpan" id="kobo.909.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.910.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.911.1">
      configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.912.1">
     class method and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.913.1">
      execute()
     </span>
    </code>
    <span class="koboSpan" id="kobo.914.1">
     method both raise
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.915.1">
      NotImplementedError
     </span>
    </code>
    <span class="koboSpan" id="kobo.916.1">
     when called, which means that subclasses need to override these methods with their own implementations.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.917.1">
     To set up
    </span>
    <a id="_idIndexMarker1336">
    </a>
    <span class="koboSpan" id="kobo.918.1">
     argument parsing for the sub-commands, we need to create a parser for each sub-command and configure it by calling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.919.1">
      configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.920.1">
     class method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.921.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.922.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.922.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.923.1">
      commands.configure_parsers()
     </span>
    </code>
    <span class="koboSpan" id="kobo.924.1">
     function is responsible for this process.
    </span>
    <span class="koboSpan" id="kobo.924.2">
     Let us take a look at that now.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.925.1"># project/railway_cli/commands/__init__.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.926.1">import</span></span><span class="koboSpan" id="kobo.927.1"> argparse
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.928.1">from</span></span><span class="koboSpan" id="kobo.929.1"> .admin </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.930.1">import</span></span><span class="koboSpan" id="kobo.931.1"> admin_commands
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.932.1">from</span></span><span class="koboSpan" id="kobo.933.1"> .base </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.934.1">import</span></span><span class="koboSpan" id="kobo.935.1"> Command
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.936.1">from</span></span><span class="koboSpan" id="kobo.937.1"> .stations </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.938.1">import</span></span><span class="koboSpan" id="kobo.939.1"> station_commands
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.940.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.941.1">configure_parsers</span></span><span class="koboSpan" id="kobo.942.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.943.1">parser: argparse.ArgumentParser</span></span><span class="koboSpan" id="kobo.944.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.945.1">None</span></span><span class="koboSpan" id="kobo.946.1">:
    subparsers = parser.add_subparsers(
        description=</span><span class="hljs-string"><span class="koboSpan" id="kobo.947.1">"Available commands"</span></span><span class="koboSpan" id="kobo.948.1">, required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.949.1">True</span></span><span class="koboSpan" id="kobo.950.1">
    )
    command: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.951.1">type</span></span><span class="koboSpan" id="kobo.952.1">[Command]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.953.1">for</span></span><span class="koboSpan" id="kobo.954.1"> command </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.955.1">in</span></span><span class="koboSpan" id="kobo.956.1"> [*admin_commands, *station_commands]:
        command_parser = subparsers.add_parser(
            command.name, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.957.1">help</span></span><span class="koboSpan" id="kobo.958.1">=command.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.959.1">help</span></span><span class="koboSpan" id="kobo.960.1">
        )
        command.configure_arg_parser(command_parser)
        </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.961.1">command_parser.set_defaults(command=command)</span></strong></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.962.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.963.1">
      parser.add_subparsers()
     </span>
    </code>
    <span class="koboSpan" id="kobo.964.1">
     method returns an object that can be used to attach sub-command parsers to the main parser.
    </span>
    <span class="koboSpan" id="kobo.964.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.965.1">
      description
     </span>
    </code>
    <span class="koboSpan" id="kobo.966.1">
     argument is used to generate the help text for the sub-commands, and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.967.1">
      required=True
     </span>
    </code>
    <span class="koboSpan" id="kobo.968.1">
     ensures that the parser will produce an error if a sub-command is not supplied on the command line.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.969.1">
     We iterate over the list of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.970.1">
      admin_commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.971.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.972.1">
      station_commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.973.1">
     and create a sub-parser for each of them.
    </span>
    <span class="koboSpan" id="kobo.973.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.974.1">
      add_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.975.1">
     method expects the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.976.1">
      name
     </span>
    </code>
    <span class="koboSpan" id="kobo.977.1">
     of the sub-command and any arguments that can be passed to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.978.1">
      ArgumentParser
     </span>
    </code>
    <span class="koboSpan" id="kobo.979.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.979.2">
     It returns a new
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.980.1">
      ArgumentParser
     </span>
    </code>
    <span class="koboSpan" id="kobo.981.1">
     instance, which we pass to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.982.1">
      command.configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.983.1">
     class method.
    </span>
    <span class="koboSpan" id="kobo.983.2">
     Note that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.984.1">
      command: type[Command]
     </span>
    </code>
    <span class="koboSpan" id="kobo.985.1">
     type annotation indicates that we expect all elements of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.986.1">
      admin_commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.987.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.988.1">
      station_commands
     </span>
    </code>
    <span class="koboSpan" id="kobo.989.1">
     to be subclasses of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.990.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.991.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.992.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.993.1">
      set_defaults()
     </span>
    </code>
    <span class="koboSpan" id="kobo.994.1">
     method
    </span>
    <a id="_idIndexMarker1337">
    </a>
    <span class="koboSpan" id="kobo.995.1">
     allows us to set attributes on the namespace returned by the parser, independently of what is on the command line.
    </span>
    <span class="koboSpan" id="kobo.995.2">
     We use this to set the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.996.1">
      command
     </span>
    </code>
    <span class="koboSpan" id="kobo.997.1">
     attribute for each sub-parser to the corresponding
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.998.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.999.1">
     subclass.
    </span>
    <span class="koboSpan" id="kobo.999.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1000.1">
      Namespace
     </span>
    </code>
    <span class="koboSpan" id="kobo.1001.1">
     object returned by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1002.1">
      parse_args()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1003.1">
     method will only contain attributes from exactly one sub-parser (the one corresponding to the sub-command provided on the command line).
    </span>
    <span class="koboSpan" id="kobo.1003.2">
     Thus, when we call
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1004.1">
      args.command(args=args)
     </span>
    </code>
    <span class="koboSpan" id="kobo.1005.1">
     in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1006.1">
      cli.main()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1007.1">
     function, we are guaranteed to get an instance of the command class for the command selected by the user.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1008.1">
     Now that we have put together all the code to configure the argument parser, we can look at the help text that is generated when we run the application with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1009.1">
      -h
     </span>
    </code>
    <span class="koboSpan" id="kobo.1010.1">
     option.
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1011.1">$ python -m railway_cli -h
usage: railway_cli [-h] [-V] [--config-file CONFIG_FILE]
                   [--secrets-dir SECRETS_DIR]
                   {admin-delete-station,get-station,...}
                   ...
</span><span class="koboSpan" id="kobo.1011.2">Commandline interface for the Railway API
options:
  -h, --help            show this help message and exit
  -V, --version         show program's version number and exit
configuration:
  The API URL must be set in the configuration file. </span><span class="koboSpan" id="kobo.1011.3">...
  </span><span class="koboSpan" id="kobo.1011.4">--config-file CONFIG_FILE
                        Load configuration from a file (default:
                        .env)
  --secrets-dir SECRETS_DIR
                        The secrets directory. </span><span class="koboSpan" id="kobo.1011.5">Can also be set
                        via the configuration file. </span><span class="koboSpan" id="kobo.1011.6">(default:
                        None)
subcommands:
  Available commands
  {admin-delete-station,get-station,list-stations,...}
    admin-delete-station
                        Delete a station
    get-station         Get a station
    list-stations       List stations
    create-station      Create a station
    update-station      Update an existing station
    get-arrivals        Get arrivals for a station
    get-departures      Get departures for a station
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1012.1">
     We have trimmed some of the output and removed blank lines, but you can see that there is a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1013.1">
      usage
     </span>
    </code>
    <span class="koboSpan" id="kobo.1014.1">
     summary showing how to use the command, followed by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1015.1">
      description
     </span>
    </code>
    <span class="koboSpan" id="kobo.1016.1">
     we set when creating the argument parser.
    </span>
    <span class="koboSpan" id="kobo.1016.2">
     This is followed by the global
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1017.1">
      options
     </span>
    </code>
    <span class="koboSpan" id="kobo.1018.1">
     section with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1019.1">
      -h
     </span>
    </code>
    <span class="koboSpan" id="kobo.1020.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1021.1">
      --help
     </span>
    </code>
    <span class="koboSpan" id="kobo.1022.1">
     option and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1023.1">
      -V
     </span>
    </code>
    <span class="koboSpan" id="kobo.1024.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1025.1">
      --version
     </span>
    </code>
    <span class="koboSpan" id="kobo.1026.1">
     option.
    </span>
    <span class="koboSpan" id="kobo.1026.2">
     Next, we get a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1027.1">
      configuration
     </span>
    </code>
    <span class="koboSpan" id="kobo.1028.1">
     section with the description and options we configured in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1029.1">
      config.configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1030.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.1030.2">
     Finally, we have a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1031.1">
      subcommands
     </span>
    </code>
    <span class="koboSpan" id="kobo.1032.1">
     section, with the description we passed to the argument parser’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1033.1">
      add_subparsers()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1034.1">
     method in
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1035.1">
      commands.configure_parsers()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1036.1">
     and a list of all the available
    </span>
    <a id="_idIndexMarker1338">
    </a>
    <span class="koboSpan" id="kobo.1037.1">
     sub-commands with the help string we set for each of them.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1038.1">
     We have seen the base class for sub-commands and the code to configure the argument parser to work with sub-commands.
    </span>
    <span class="koboSpan" id="kobo.1038.2">
     Let us now look at the implementation of a sub-command.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-383">
    <span class="koboSpan" id="kobo.1039.1">
     Implementing sub-commands
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1040.1">
     The
    </span>
    <a id="_idIndexMarker1339">
    </a>
    <span class="koboSpan" id="kobo.1041.1">
     sub-command parsers are completely independent, so we can implement sub-commands without any risk that their command-line options might conflict with one another.
    </span>
    <span class="koboSpan" id="kobo.1041.2">
     We only need to ensure that the command names are unique.
    </span>
    <span class="koboSpan" id="kobo.1041.3">
     This means we can extend the application by adding commands without needing to modify any existing code.
    </span>
    <span class="koboSpan" id="kobo.1041.4">
     The class-based approach we have chosen for this application makes it easy to add commands.
    </span>
    <span class="koboSpan" id="kobo.1041.5">
     We just have to create a new
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1042.1">
      Command
     </span>
    </code>
    <span class="koboSpan" id="kobo.1043.1">
     subclass, define its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1044.1">
      name
     </span>
    </code>
    <span class="koboSpan" id="kobo.1045.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1046.1">
      help
     </span>
    </code>
    <span class="koboSpan" id="kobo.1047.1">
     text, and implement the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1048.1">
      configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1049.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1050.1">
      execute()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1051.1">
     methods.
    </span>
    <span class="koboSpan" id="kobo.1051.2">
     As an example, let us look at the code for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1052.1">
      create-station
     </span>
    </code>
    <span class="koboSpan" id="kobo.1053.1">
     command.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1054.1"># project/railway_cli/commands/stations.py</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1055.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1056.1">CreateStation</span></span><span class="koboSpan" id="kobo.1057.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1058.1">Command</span></span><span class="koboSpan" id="kobo.1059.1">):
    name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1060.1">"create-station"</span></span>
    <span class="hljs-built_in"><span class="koboSpan" id="kobo.1061.1">help</span></span><span class="koboSpan" id="kobo.1062.1"> = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1063.1">"Create a station"</span></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1064.1">    @classmethod</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.1065.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1066.1">configure_arg_parser</span></span><span class="koboSpan" id="kobo.1067.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.1068.1">        cls, parser: argparse.ArgumentParser</span></span>
<span class="hljs-params">    </span><span class="koboSpan" id="kobo.1069.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1070.1">None</span></span><span class="koboSpan" id="kobo.1071.1">:
        parser.add_argument(
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1072.1">"--code"</span></span><span class="koboSpan" id="kobo.1073.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1074.1">help</span></span><span class="koboSpan" id="kobo.1075.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1076.1">"The station code"</span></span><span class="koboSpan" id="kobo.1077.1">, required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1078.1">True</span></span><span class="koboSpan" id="kobo.1079.1">
        )
        parser.add_argument(
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1080.1">"--country"</span></span><span class="koboSpan" id="kobo.1081.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1082.1">help</span></span><span class="koboSpan" id="kobo.1083.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1084.1">"The station country"</span></span><span class="koboSpan" id="kobo.1085.1">, required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1086.1">True</span></span><span class="koboSpan" id="kobo.1087.1">
        )
        parser.add_argument(
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1088.1">"--city"</span></span><span class="koboSpan" id="kobo.1089.1">, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1090.1">help</span></span><span class="koboSpan" id="kobo.1091.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1092.1">"The station city"</span></span><span class="koboSpan" id="kobo.1093.1">, required=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1094.1">True</span></span><span class="koboSpan" id="kobo.1095.1">
        )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1096.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">execute</span></span><span class="koboSpan" id="kobo.1098.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1099.1">self</span></span><span class="koboSpan" id="kobo.1100.1">) -&gt; </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1101.1">None</span></span><span class="koboSpan" id="kobo.1102.1">:
        station_client = StationClient(self.api_client)
        station = station_client.create(
            code=self.args.code,
            country=self.args.country,
            city=self.args.city,
        )
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1103.1">print</span></span><span class="koboSpan" id="kobo.1104.1">(station)
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1105.1">
     Note that we
    </span>
    <a id="_idIndexMarker1340">
    </a>
    <span class="koboSpan" id="kobo.1106.1">
     have not reproduced the imports from the top of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1107.1">
      commands/stations.py
     </span>
    </code>
    <span class="koboSpan" id="kobo.1108.1">
     module here.
    </span>
    <span class="koboSpan" id="kobo.1108.2">
     As you can see, the code for the command is quite straightforward.
    </span>
    <span class="koboSpan" id="kobo.1108.3">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1109.1">
      configure_arg_parser()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1110.1">
     class method adds options for the station code, city, and country.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1111.1">
     Note that all
    </span>
    <a id="_idIndexMarker1341">
    </a>
    <span class="koboSpan" id="kobo.1112.1">
     three are marked as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1113.1">
      required
     </span>
    </code>
    <span class="koboSpan" id="kobo.1114.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1114.2">
     The Python
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1115.1">
      argparse
     </span>
    </code>
    <span class="koboSpan" id="kobo.1116.1">
     documentation discourages the use of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1117.1">
      required
     </span>
    </code>
    <span class="koboSpan" id="kobo.1118.1">
     options; however, in some circumstances, it can lead to a more user-friendly interface.
    </span>
    <span class="koboSpan" id="kobo.1118.2">
     If a command requires more than two arguments with different meanings, it can become difficult for users to remember the correct order.
    </span>
    <span class="koboSpan" id="kobo.1118.3">
     Using options instead means that the order does not matter, and it is immediately obvious what each of the arguments means.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1119.1">
     Let us see what happens when we run this command.
    </span>
    <span class="koboSpan" id="kobo.1119.2">
     First, with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1120.1">
      -h
     </span>
    </code>
    <span class="koboSpan" id="kobo.1121.1">
     option to see the help message:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1122.1">$ python -m railway_cli create-station -h
usage: railway_cli create-station [-h] --code CODE --country
                                  COUNTRY --city CITY
options:
  -h, --help         show this help message and exit
  --code CODE        The station code
  --country COUNTRY  The station country
  --city CITY        The station city
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1123.1">
     The help message clearly shows how to use the command.
    </span>
    <span class="koboSpan" id="kobo.1123.2">
     Now we can create a station:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1124.1">$ python -m railway_cli create-station --code LSB --city Lisbon \
    --country Portugal
id=12 code='LSB' country='Portugal' city='Lisbon'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1125.1">
     The output shows that the station was created successfully and assigned the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1126.1">
      id
     </span>
    </code>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1127.1">
      12
     </span>
    </code>
    <span class="koboSpan" id="kobo.1128.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1129.1">
     This brings us to the end of our exploration of the railway CLI application.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-384">
    <span class="koboSpan" id="kobo.1130.1">
     Other resources and tools
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1131.1">
     We will finish this chapter with some links to resources where you can learn more and some useful libraries for developing CLI applications:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1132.1">
      Although we have tried to make this chapter as comprehensive as we could, the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1133.1">
       argparse
      </span>
     </code>
     <span class="koboSpan" id="kobo.1134.1">
      module
     </span>
     <a id="_idIndexMarker1342">
     </a>
     <span class="koboSpan" id="kobo.1135.1">
      has many more features than we could showcase here.
     </span>
     <span class="koboSpan" id="kobo.1135.2">
      The official documentation at
     </span>
     <a href="https://docs.python.org/3/library/argparse.html">
      <span class="url">
       <span class="koboSpan" id="kobo.1136.1">
        https://docs.python.org/3/library/argparse.html
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1137.1">
      is excellent, though.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1138.1">
      If
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1139.1">
       argparse
      </span>
     </code>
     <span class="koboSpan" id="kobo.1140.1">
      is not to your liking, there are several third-party libraries available for command-line argument parsing.
     </span>
     <span class="koboSpan" id="kobo.1140.2">
      We suggest that you try them all:
     </span>
     <ul>
      <li class="bulletList level-2">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1141.1">
         Click
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1142.1">
        is by far the most popular third-party CLI library for Python.
       </span>
       <span class="koboSpan" id="kobo.1142.2">
        Besides
       </span>
       <a id="_idIndexMarker1343">
       </a>
       <span class="koboSpan" id="kobo.1143.1">
        command-line parsing, it also provides features for creating interactive applications (such as input prompts) and for producing colorful output.
       </span>
       <span class="koboSpan" id="kobo.1143.2">
        You can learn about it at
       </span>
       <a href="https://click.palletsprojects.com">
        <span class="url">
         <span class="koboSpan" id="kobo.1144.1">
          https://click.palletsprojects.com
         </span>
        </span>
       </a>
       <span class="koboSpan" id="kobo.1145.1">
        .
       </span>
      </li>
      <li class="bulletList level-2">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1146.1">
         Typer
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1147.1">
        was created by the same developers as FastAPI.
       </span>
       <span class="koboSpan" id="kobo.1147.2">
        It aims to apply the same principles FastAPI applies to API development to
       </span>
       <a id="_idIndexMarker1344">
       </a>
       <span class="koboSpan" id="kobo.1148.1">
        CLI development.
       </span>
       <span class="koboSpan" id="kobo.1148.2">
        You can read about it at
       </span>
       <a href="https://typer.tiangolo.com/">
        <span class="url">
         <span class="koboSpan" id="kobo.1149.1">
          https://typer.tiangolo.com/
         </span>
        </span>
       </a>
       <span class="koboSpan" id="kobo.1150.1">
        .
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1151.1">
       Pydantic Settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1152.1">
      , which we used for configuration management in this chapter and in
     </span>
     <em class="chapterRef">
      <span class="koboSpan" id="kobo.1153.1">
       Chapter 14, Introduction to API development
      </span>
     </em>
     <span class="koboSpan" id="kobo.1154.1">
      , also supports parsing command-line arguments.
     </span>
     <span class="koboSpan" id="kobo.1154.2">
      See
     </span>
     <a href="https://docs.pydantic.dev/latest/concepts/pydantic_settings/#command-line-support">
      <span class="url">
       <span class="koboSpan" id="kobo.1155.1">
        https://docs.pydantic.dev/latest/concepts/pydantic_settings/#command-line-support
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1156.1">
      to learn more
     </span>
     <a id="_idIndexMarker1345">
     </a>
     <span class="koboSpan" id="kobo.1157.1">
      about this.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1158.1">
      Most modern shells support programmable command-line tab completion.
     </span>
     <span class="koboSpan" id="kobo.1158.2">
      Providing command-line completion can make your CLI application much easier to use.
     </span>
     <span class="koboSpan" id="kobo.1158.3">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1159.1">
       argcomplete
      </span>
     </code>
     <span class="koboSpan" id="kobo.1160.1">
      library (
     </span>
     <a href="https://kislyuk.github.io/argcomplete/">
      <span class="url">
       <span class="koboSpan" id="kobo.1161.1">
        https://kislyuk.github.io/argcomplete/
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1162.1">
      ) provides
     </span>
     <a id="_idIndexMarker1346">
     </a>
     <span class="koboSpan" id="kobo.1163.1">
      command-line completion in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1164.1">
       bash
      </span>
     </code>
     <span class="koboSpan" id="kobo.1165.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1166.1">
       zsh
      </span>
     </code>
     <span class="koboSpan" id="kobo.1167.1">
      shells for applications that use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1168.1">
       argparse
      </span>
     </code>
     <span class="koboSpan" id="kobo.1169.1">
      to handle command-line arguments.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1170.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1171.1">
       Command Line Interface Guidelines
      </span>
     </em>
     <span class="koboSpan" id="kobo.1172.1">
      (
     </span>
     <a href="https://clig.dev/">
      <span class="url">
       <span class="koboSpan" id="kobo.1173.1">
        https://clig.dev/
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1174.1">
      ) is a
     </span>
     <a id="_idIndexMarker1347">
     </a>
     <span class="koboSpan" id="kobo.1175.1">
      comprehensive open-source resource with excellent advice for designing user-friendly command-line interfaces.
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-385">
    <span class="koboSpan" id="kobo.1176.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1177.1">
     In this chapter, we learned about command-line applications by developing a CLI client for the railway API that we created in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.1178.1">
      Chapter 14, Introduction to API Development
     </span>
    </em>
    <span class="koboSpan" id="kobo.1179.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1179.2">
     We learned how to parse command-line arguments with the standard library
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1180.1">
      argparse
     </span>
    </code>
    <span class="koboSpan" id="kobo.1181.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.1181.2">
     We looked at how to structure a CLI application interface by using sub-commands and saw how this can help us build modular applications that are easy to maintain and extend.
    </span>
    <span class="koboSpan" id="kobo.1181.3">
     We concluded the chapter with some links to other libraries for CLI application development in Python and some resources where you can learn more.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1182.1">
     Working with command-line applications is an excellent way to practice the skills you learned throughout this book.
    </span>
    <span class="koboSpan" id="kobo.1182.2">
     We encourage you to study the code for this chapter, extend it by adding more commands, and improve it by adding logging and tests.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1183.1">
     In the next chapter, we will learn how to package and publish Python applications.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-386">
    <span class="koboSpan" id="kobo.1184.1">
     Join our community on Discord
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1185.1">
     Join our community’s Discord space for discussions with the authors and other readers:
    </span>
   </p>
   <p class="normal">
    <a href="Chapter_15.xhtml">
     <span class="url">
      <span class="koboSpan" id="kobo.1186.1">
       https://discord.com/invite/uaKmaz7FEC
      </span>
     </span>
    </a>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1187.1">
     <img alt="img" src="../Images/QR_Code119001106417026468.png"/>
    </span>
   </p>
  </div>
 </body></html>