<html><head></head><body>
<div id="_idContainer301">
<h1 class="chapter-number" id="_idParaDest-219"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-220"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.2.1">Creating a RESTful API with FastAPI</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the last chapter, we learned about a framework called Flask. </span><span class="koboSpan" id="kobo.3.2">Flask represents Python in a landscape of traditional web development frameworks designed to generate content on the server and send it back to the browser. </span><span class="koboSpan" id="kobo.3.3">This is how we have developed web applications for decades. </span><span class="koboSpan" id="kobo.3.4">The 2010s brought a paradigm shift, but it didn’t </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">happen overnight.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In 2004, the term </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">AJAX</span></strong><span class="koboSpan" id="kobo.7.1">, an acronym for </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Asynchronous JavaScript and XML</span></strong><span class="koboSpan" id="kobo.9.1">, was coined by Jesse James Garrett in an article titled </span><em class="italic"><span class="koboSpan" id="kobo.10.1">Ajax: A New Approach to Web Applications</span></em><span class="koboSpan" id="kobo.11.1">. </span><span class="koboSpan" id="kobo.11.2">This article helped popularize the concept and techniques of asynchronous web applications. </span><span class="koboSpan" id="kobo.11.3">By 2005, mainstream browsers all supported a new </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">XMLHttpRequest</span></strong><span class="koboSpan" id="kobo.13.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.14.1">XHR</span></strong><span class="koboSpan" id="kobo.15.1">) web API call. </span><span class="koboSpan" id="kobo.15.2">The feature allowed a developer to request pure data instead of a generated HTML page with the data integrated </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">with markup.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">The rise of </span><strong class="bold"><span class="koboSpan" id="kobo.18.1">single-page applications </span></strong><span class="koboSpan" id="kobo.19.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.20.1">SPAs</span></strong><span class="koboSpan" id="kobo.21.1">) in the 2010s was closely associated with the advancement of JavaScript frameworks such as AngularJS (now Angular), React, and Vue.js. </span><span class="koboSpan" id="kobo.21.2">These provided developers with the tools and capabilities to build dynamic, interactive web applications differently from traditional applications, which make requests for HTML and data at the same time. </span><span class="koboSpan" id="kobo.21.3">SPAs load all their markup, CSS, and JavaScript in a single request. </span><span class="koboSpan" id="kobo.21.4">After that, the app uses XHR to request data, and in response to the data received and the user’s interactions, the developer used JavaScript to show and hide different elements in the user experience rather than re-rendering the entire page each time there was a change in data or a </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">user interaction.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.23.1">AngularJS</span></strong><span class="koboSpan" id="kobo.24.1">, released by Google in 2010, played a significant role in popularizing the concept of SPAs. </span><span class="koboSpan" id="kobo.24.2">It introduced a declarative approach to building web applications, allowing developers to create rich, responsive user interfaces without the need for full-page reloads. </span><span class="koboSpan" id="kobo.24.3">AngularJS provided a solid foundation for building SPAs, and its success inspired the development of other JavaScript frameworks that further refined and improved the SPA </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">development experience.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.26.1">React</span></strong><span class="koboSpan" id="kobo.27.1">, developed by Facebook and released in 2013, also contributed to the popularity of SPAs. </span><span class="koboSpan" id="kobo.27.2">React introduced a component-based architecture that made it easier to manage the state and UI components of an application. </span><span class="koboSpan" id="kobo.27.3">React’s virtual</span><strong class="bold"><span class="koboSpan" id="kobo.28.1"> DOM</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.30.1">Document Object Model</span></strong><span class="koboSpan" id="kobo.31.1">) diffing algorithm and efficient rendering mechanism made it well suited for building fast and </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">scalable SPAs.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.33.1">Vue.js</span></strong><span class="koboSpan" id="kobo.34.1">, created by Evan You and released in 2014, gained popularity as a lightweight and approachable framework for building SPAs. </span><span class="koboSpan" id="kobo.34.2">It offered a gentle learning curve and provided a flexible and intuitive way to build </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">user interfaces.</span></span></p>
<p><span class="koboSpan" id="kobo.36.1">Overall, the combination of these JavaScript frameworks, along with advancements in browser technologies and APIs, led to the rise of SPAs in the early 2010s onward. </span><span class="koboSpan" id="kobo.36.2">SPAs today continue to provide a more seamless and responsive user experience by dynamically updating content on a single web page, eliminating the need for full page reloads, and providing a more app-like feel to </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">web applications.</span></span></p>
<p><span class="koboSpan" id="kobo.38.1">We could certainly create an SPA backend using Flask, but it might not be the best choice. </span><span class="koboSpan" id="kobo.38.2">This is especially true if you expect your application’s user base to be large. </span><span class="koboSpan" id="kobo.38.3">Flask is criticized as being a bit slow when you have server requests at high volume. </span><span class="koboSpan" id="kobo.38.4">Thankfully, there are other players in the game, and in this chapter, we’re going to focus </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">on FastAPI.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">The interesting thing about FastAPI is the way it handles web requests. </span><span class="koboSpan" id="kobo.40.2">Most products, including Flask, use a worker model. </span><span class="koboSpan" id="kobo.40.3">A pool of workers is responsible for servicing multiple incoming requests on separate processes managed by the operating system. </span><span class="koboSpan" id="kobo.40.4">FastAPI uses an </span><strong class="bold"><span class="koboSpan" id="kobo.41.1">asynchronous programming</span></strong><span class="koboSpan" id="kobo.42.1"> model. </span><span class="koboSpan" id="kobo.42.2">In the realm of asynchronous programming, functions are invoked, but the immediate return of outcomes is not guaranteed. </span><span class="koboSpan" id="kobo.42.3">Let’s explore the following illustrative </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">Python code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.44.1">
async def add_two(a: int, b: int) -&gt; int:
    return a + b</span></pre> <p><span class="koboSpan" id="kobo.45.1">When calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">add_two</span></strong><span class="koboSpan" id="kobo.47.1"> in a synchronous programming context, the execution thread halts until the function is completed and the outcome is furnished. </span><span class="koboSpan" id="kobo.47.2">However, the mechanics differ when employing asynchronous programming. </span><span class="koboSpan" id="kobo.47.3">An asynchronous invocation doesn’t halt the invoking thread. </span><span class="koboSpan" id="kobo.47.4">Instead, the calling thread persists in execution after obtaining a </span><strong class="bold"><span class="koboSpan" id="kobo.48.1">coroutine</span></strong><span class="koboSpan" id="kobo.49.1">, which is linked to an event. </span><span class="koboSpan" id="kobo.49.2">In simpler terms, a coroutine signifies that a certain task will be carried out later, subsequent to some triggering event. </span><span class="koboSpan" id="kobo.49.3">In our scenario, we pledge to provide the sum of </span><strong class="source-inline"><span class="koboSpan" id="kobo.50.1">a + b</span></strong><span class="koboSpan" id="kobo.51.1"> once this computation has been executed. </span><span class="koboSpan" id="kobo.51.2">It’s important to acknowledge that this may not happen instantaneously, but during the computation, other operations remain unblocked. </span><span class="koboSpan" id="kobo.51.3">Naturally, performing an addition of integers is likely to </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">conclude swiftly.</span></span></p>
<p><span class="koboSpan" id="kobo.53.1">Consider an alternative scenario where a request is made to a networked resource, such as fetching a web page. </span><span class="koboSpan" id="kobo.53.2">The speed of response is no longer solely contingent on the processor’s execution speed. </span><span class="koboSpan" id="kobo.53.3">It encompasses factors such as computer performance, network latency, and various other elements that might introduce delays ranging from seconds to even minutes. </span><span class="koboSpan" id="kobo.53.4">This is particularly true for those who don’t reside in well-connected urban areas with high-speed internet access. </span><span class="koboSpan" id="kobo.53.5">Since the asynchronous software doesn’t block, it can serve many requests serially since none of them are waiting for the previous function call or, in this case, web request, to finish. </span><span class="koboSpan" id="kobo.53.6">You can think of it as a restaurant with one waiter. </span><span class="koboSpan" id="kobo.53.7">You submit your order serially with other diners, but the cook only returns your food when it has been cooked. </span><span class="koboSpan" id="kobo.53.8">With this expectation set, the cook is free to cook as many dishes at once as their stove allows, and there is an implicit promise given that once your food is cooked, the waiter will bring it to you. </span><span class="koboSpan" id="kobo.53.9">Someone who orders a glass of juice might get their order back immediately, whereas your baked Alaska will take a little longer </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">to produce.</span></span></p>
<p><span class="koboSpan" id="kobo.55.1">A synchronous restaurant, by contrast, would employ, say, eight cooks. </span><span class="koboSpan" id="kobo.55.2">Eight orders can come in at once, but each cook is completely dedicated to fixing that one order until it is complete. </span><span class="koboSpan" id="kobo.55.3">As it turns out, the throughput, at least for computers, is often faster when employing the asynchronous model for typical web </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">request workloads.</span></span></p>
<p><span class="koboSpan" id="kobo.57.1">In Python 3.4, we got a new module called </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">asyncio</span></strong><span class="koboSpan" id="kobo.59.1">, which brought asynchronous programming features to our favorite language. </span><span class="koboSpan" id="kobo.59.2">Three years later, we found the first GitHub commit to a library project called </span><strong class="bold"><span class="koboSpan" id="kobo.60.1">Starlette</span></strong><span class="koboSpan" id="kobo.61.1">. </span><span class="koboSpan" id="kobo.61.2">Starlette is an asynchronous web framework for building high-performance applications with Python. </span><span class="koboSpan" id="kobo.61.3">It provides the core functionality for handling HTTP requests and responses in an efficient manner. </span><span class="koboSpan" id="kobo.61.4">Starlette is known for its simplicity, speed, and support for modern Python features, making it an ideal foundation for building web applications. </span><span class="koboSpan" id="kobo.61.5">Like Werkzeug, though, which powers Flask, Starlette was only meant to be a foundation. </span><span class="koboSpan" id="kobo.61.6">This chapter covers </span><strong class="bold"><span class="koboSpan" id="kobo.62.1">FastAPI</span></strong><span class="koboSpan" id="kobo.63.1">, a framework built on top of Starlette that represents a full implementation of a web framework specializing in the development of </span><strong class="bold"><span class="koboSpan" id="kobo.64.1">RESTful Application Programming Interfaces </span></strong><span class="koboSpan" id="kobo.65.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.66.1">REST APIs</span></strong><span class="koboSpan" id="kobo.67.1">) Where Flask used a worker model, FastAPI uses an asynchronous model, and where Flask was designed to create traditional round trip, template-driven content generation, FastAPI normally used the SPAs to handle serving data in the form of </span><strong class="bold"><span class="koboSpan" id="kobo.68.1">JavaScript Object </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.69.1">Notation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.70.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.71.1">JSON</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.73.1">I realize we just introduced a lot of jargon, which may be new to Python developers who aren’t normally web developers. </span><span class="koboSpan" id="kobo.73.2">We’ll explain our terminology in context as we cover building a simple FastAPI project </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">using PyCharm.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">By the end of this chapter, you will be able to do </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.77.1">Explain the difference between a traditional template-driven content generation system such as Flask and one that strictly </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">serves data</span></span></li>
<li><span class="koboSpan" id="kobo.79.1">Describe the stateless nature of HTTP (and HTTPS) along with how </span><strong class="bold"><span class="koboSpan" id="kobo.80.1">representational state transfer</span></strong><span class="koboSpan" id="kobo.81.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.82.1">REST</span></strong><span class="koboSpan" id="kobo.83.1">) is used to mitigate the lack of state </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">in HTTP</span></span></li>
<li><span class="koboSpan" id="kobo.85.1">Create a FastAPI project using the built-in template provided in </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">PyCharm Professional</span></span></li>
<li><span class="koboSpan" id="kobo.87.1">Perform tests on your FastAPI project using PyCharm’s HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">REST client</span></span></li>
<li><span class="koboSpan" id="kobo.89.1">Create a React frontend application in a separate but connected (attached) project in PyCharm, allowing you to develop a full stack application without mingling the frontend JavaScript code with the backend </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">Python code</span></span></li>
<li><span class="koboSpan" id="kobo.91.1">Manage multiple run configurations and debug the entire request-response pipeline in </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">PyCharm’s debugger</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.93.1">Bear in mind that this chapter isn’t meant to be a full tutorial on either FastAPI or React. </span><span class="koboSpan" id="kobo.93.2">The core purpose of this book is to teach PyCharm within the context of creating applications. </span><span class="koboSpan" id="kobo.93.3">Our coverage of FastAPI might be tacit, whereas our coverage of PyCharm as a tool to make an application with FastAPI will be </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">very complete.</span></span></p>
<h1 id="_idParaDest-221"><a id="_idTextAnchor225"/><span class="koboSpan" id="kobo.95.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.96.1">In order to proceed through this chapter, and indeed the rest of the book, you will need </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.98.1">An installed and working Python interpreter. </span><span class="koboSpan" id="kobo.98.2">I’ll be using the latest </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">from </span></span><a href="https://python.org"><span class="No-Break"><span class="koboSpan" id="kobo.100.1">https://python.org</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.101.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.102.1">Installed copies of </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">pip</span></strong><span class="koboSpan" id="kobo.104.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">virtualenv</span></strong><span class="koboSpan" id="kobo.106.1">. </span><span class="koboSpan" id="kobo.106.2">You get these automatically when you install Python on Windows, and macOS has them included on every system. </span><span class="koboSpan" id="kobo.106.3">If you are using Linux, you need to install the package managers, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">pip</span></strong><span class="koboSpan" id="kobo.108.1">, and virtual environment tools, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">virtualenv</span></strong><span class="koboSpan" id="kobo.110.1">, separately. </span><span class="koboSpan" id="kobo.110.2">Our examples will be using </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">pip</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.112.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">virtualenv</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.115.1">An installed and working copy of PyCharm. </span><span class="koboSpan" id="kobo.115.2">Installation was covered in </span><a href="B19644_02.xhtml#_idTextAnchor028"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.116.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.117.1">,</span><em class="italic"><span class="koboSpan" id="kobo.118.1"> Installation and Configuration</span></em><span class="koboSpan" id="kobo.119.1">, in case you are jumping into the middle of </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">the book.</span></span></li>
<li><span class="koboSpan" id="kobo.121.1">This book’s sample source code is from GitHub. </span><span class="koboSpan" id="kobo.121.2">We covered cloning the code in </span><a href="B19644_02.xhtml#_idTextAnchor028"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.122.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.123.1">,  </span><em class="italic"><span class="koboSpan" id="kobo.124.1">Installation and Configuration</span></em><span class="koboSpan" id="kobo.125.1">. </span><span class="koboSpan" id="kobo.125.2">You’ll find this chapter’s relevant code </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">at </span></span><a href="https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-09"><span class="No-Break"><span class="koboSpan" id="kobo.127.1">https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-09</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.128.1">.</span></span></li>
</ul>
<h1 id="_idParaDest-222"><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.129.1">There is no REST in a wicked stateless world</span></h1>
<p><span class="koboSpan" id="kobo.130.1">I’ve heard it said that computers are the dumbest creatures on the planet. </span><span class="koboSpan" id="kobo.130.2">They only do exactly as they are told, and they take your instructions in an extremely literal way. </span><span class="koboSpan" id="kobo.130.3">This is what makes programming a computer so difficult. </span><span class="koboSpan" id="kobo.130.4">You must choose exactly the right syntax and structure your ideas precisely and succinctly because any ambiguity will result in </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">a bug.</span></span></p>
<p><span class="koboSpan" id="kobo.132.1">There is only one way to make our lives hard, and that is to base our work and our careers on a system with the attention span of a fruit fly. </span><span class="koboSpan" id="kobo.132.2">I’m talking about web servers, of course. </span><span class="koboSpan" id="kobo.132.3">The term web</span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.133.1"> server can mean two different things: it can refer to hardware or software. </span><span class="koboSpan" id="kobo.133.2">The hardware is any computer system running the software. </span><span class="koboSpan" id="kobo.133.3">I’ve seen people build web server hardware that fits in a matchbox, and I’ve seen web server hardware fill expansive rack mount systems in specially cooled data centers. </span><span class="koboSpan" id="kobo.133.4">In truth, for us at least, the hardware is the </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">boring part.</span></span></p>
<p><span class="koboSpan" id="kobo.135.1">Web server software is a little more interesting to those of </span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.136.1">us who write code. </span><span class="koboSpan" id="kobo.136.2">Web server software, such</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.137.1"> as </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">Apache</span></strong><span class="koboSpan" id="kobo.139.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">Nginx</span></strong><span class="koboSpan" id="kobo.141.1"> (pronounced “engine-ex”), </span><strong class="bold"><span class="koboSpan" id="kobo.142.1">LightHTTPD</span></strong><span class="koboSpan" id="kobo.143.1">, and others, are designed to be simple yet robust implementations </span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.144.1">of a common specification for the HTTP protocol. </span><span class="koboSpan" id="kobo.144.2">These specifications are internationally agreed to by the </span><strong class="bold"><span class="koboSpan" id="kobo.145.1">World Wide Web Consortium</span></strong><span class="koboSpan" id="kobo.146.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.147.1">W3C</span></strong><span class="koboSpan" id="kobo.148.1">). </span><span class="koboSpan" id="kobo.148.2">The protocol itself is </span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.149.1">very straightforward. </span><span class="koboSpan" id="kobo.149.2">We’ve mentioned a few things about it already in earlier chapters, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">the following:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.151.1">Client-server model</span></strong><span class="koboSpan" id="kobo.152.1">: HTTP follows a client-server model, where the client (typically a web browser) sends a request to </span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.153.1">the server, and the server responds with the </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">requested data.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.155.1">Request-response paradigm</span></strong><span class="koboSpan" id="kobo.156.1">: HTTP requests are made by clients to retrieve or send data. </span><span class="koboSpan" id="kobo.156.2">The request typically includes a </span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.157.1">method (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">GET</span></strong><span class="koboSpan" id="kobo.159.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">POST</span></strong><span class="koboSpan" id="kobo.161.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">PUT</span></strong><span class="koboSpan" id="kobo.163.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">DELETE</span></strong><span class="koboSpan" id="kobo.165.1">), a </span><strong class="bold"><span class="koboSpan" id="kobo.166.1">Uniform Resource Identifier</span></strong><span class="koboSpan" id="kobo.167.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.168.1">URI</span></strong><span class="koboSpan" id="kobo.169.1">) that identifies the</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.170.1"> resource being accessed, and headers that provide additional information. </span><span class="koboSpan" id="kobo.170.2">The server responds with a status code indicating the success or failure of the request and includes the requested data in the response body.  </span><span class="koboSpan" id="kobo.170.3">In case you missed it, there’s a full discussion of the request-response paradigm (complete with pictures) in </span><a href="B19644_08.xhtml#_idTextAnchor203"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.171.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.172.1">,  </span><em class="italic"><span class="koboSpan" id="kobo.173.1">Building a Dynamic Web Application </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.174.1">with Flask</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.176.1">Text-based protocol</span></strong><span class="koboSpan" id="kobo.177.1">: HTTP is a text-based protocol, meaning that both the request and response messages are</span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.178.1"> human-readable. </span><span class="koboSpan" id="kobo.178.2">The messages follow a specific format called the HTTP message format, which consists of headers and an optional </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">message body.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.180.1">Secure variant</span></strong><span class="koboSpan" id="kobo.181.1">: HTTP can be augmented</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.182.1"> with encryption and security features using </span><strong class="bold"><span class="koboSpan" id="kobo.183.1">HTTPS</span></strong><span class="koboSpan" id="kobo.184.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.185.1">HTTP Secure</span></strong><span class="koboSpan" id="kobo.186.1">). </span><span class="koboSpan" id="kobo.186.2">HTTPS adds a layer of </span><strong class="bold"><span class="koboSpan" id="kobo.187.1">Transport Layer Security</span></strong><span class="koboSpan" id="kobo.188.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.189.1">TLS</span></strong><span class="koboSpan" id="kobo.190.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.191.1">Secure Sockets Layer</span></strong><span class="koboSpan" id="kobo.192.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.193.1">SSL</span></strong><span class="koboSpan" id="kobo.194.1">) encryption</span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.195.1"> to protect the confidentiality and integrity of the data transmitted between the client and </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">the server.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.197.1">In our immediate discussion, I want to point out a nugget we have heretofore glossed over: HTTP is stateless. </span><span class="koboSpan" id="kobo.197.2">This means that each request from a client is treated independently, without any knowledge of previous requests. </span><span class="koboSpan" id="kobo.197.3">The server does not retain any information about the client’s previous interactions. </span><span class="koboSpan" id="kobo.197.4">In the US, there is a famous advertising campaign for the city of Las Vegas, which states “What happens in Vegas stays in Vegas.” </span><span class="koboSpan" id="kobo.197.5">Likewise, what happens within the request-response mechanism stays in that request-response life cycle. </span><span class="koboSpan" id="kobo.197.6">Once the response is received and acknowledged by the web browser, there is nothing other than a log entry somewhere that the request even </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">took place.</span></span></p>
<p><span class="koboSpan" id="kobo.199.1">In concert, what we have here is a dumb machine executing requests of which it has no memory. </span><span class="koboSpan" id="kobo.199.2">This can make our job somewhat frustrating. </span><span class="koboSpan" id="kobo.199.3">We want our users to be continually interacting with our</span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.200.1"> application, but the server isn’t going to help us do that without some form </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">of cajoling.</span></span></p>
<p><span class="koboSpan" id="kobo.202.1">Over the years, a number of mechanisms have been invented to help with the state in our application. </span><span class="koboSpan" id="kobo.202.2">If you’re not sure what I mean by state, I like to describe it as a saved game in your favorite </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">video game.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">Imagine you are playing an adventure game. </span><span class="koboSpan" id="kobo.204.2">You’ve been playing for quite a while, and you’ve found the entrance to the dark castle, which is on level three. </span><span class="koboSpan" id="kobo.204.3">You’ve answered the gatekeeper’s riddle, and you have obtained the vorpal sword of smiting. </span><span class="koboSpan" id="kobo.204.4">You have amassed 32,768 gold pieces and your character is at full health. </span><span class="koboSpan" id="kobo.204.5">Then your mom yells for you to go take out the trash. </span><span class="koboSpan" id="kobo.204.6">As we all know, this is “mom code” for “quit playing video games and do something productive.” </span><span class="koboSpan" id="kobo.204.7">She’ll never understand, will she? </span><span class="koboSpan" id="kobo.204.8">Naturally, you’d like to pick up where you left off, so you save your game. </span><span class="koboSpan" id="kobo.204.9">You can turn off your computer and turn it back on tomorrow, at which point you can load your game and it will behave as though you never stopped playing. </span><span class="koboSpan" id="kobo.204.10">This is because your saved game represents a saved state for the program. </span><span class="koboSpan" id="kobo.204.11">It is a snapshot of all the objects, variables, and data used by your game at the time you saved it. </span><span class="koboSpan" id="kobo.204.12">This is the program’s state. </span><span class="koboSpan" id="kobo.204.13">This is what web applications intrinsically lack, at least at the </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">protocol level.</span></span></p>
<p><span class="koboSpan" id="kobo.206.1">The state can be managed using a few techniques. </span><span class="koboSpan" id="kobo.206.2">Server</span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.207.1"> solutions such as Flask allow you to implement sticky sessions where HTTP requests generate a token. </span><span class="koboSpan" id="kobo.207.2">The request details can be stored between sessions with reference to the token. </span><span class="koboSpan" id="kobo.207.3">This is not handled by your web server, but by your application server, which leverages the web server for the communications part: the request-response mechanism. </span><span class="koboSpan" id="kobo.207.4">Sessions are generally not desirable because, in most cases, they don’t scale. </span><span class="koboSpan" id="kobo.207.5">If you have a lot of web traffic, it is common practice to balance the traffic load between several servers. </span><span class="koboSpan" id="kobo.207.6">If your session is stored on server A on the first request, and a subsequent request goes to server B, it won’t have your session. </span><span class="koboSpan" id="kobo.207.7">Naturally, we’ve come up with solutions for that too, but let’s not get down in </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">the weeds.</span></span></p>
<p><span class="koboSpan" id="kobo.209.1">You can use cookies, which store the data on the client side. </span><span class="koboSpan" id="kobo.209.2">Unfortunately, cookies have a bad reputation as they have been highly abused over the years. </span><span class="koboSpan" id="kobo.209.3">The major browsers expose the cookies you are saving, and your ever-paranoid users can choose to not accept your request to </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">store cookies.</span></span></p>
<p><span class="koboSpan" id="kobo.211.1">The best answer is to store the state of your application in the application itself. </span><span class="koboSpan" id="kobo.211.2">The idea here is called representational state </span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.212.1">transfer, or REST for short. </span><span class="koboSpan" id="kobo.212.2">In a RESTful scenario, we maintain the program’s state in memory on the client. </span><span class="koboSpan" id="kobo.212.3">We transfer any part of the state, or even (but not usually) the entire state using the request-response mechanism. </span><span class="koboSpan" id="kobo.212.4">The program essentially sends the parts of the state the server will need to fulfill the request. </span><span class="koboSpan" id="kobo.212.5">The server does whatever it is supposed to do, and then sends back the altered state in the response. </span><span class="koboSpan" id="kobo.212.6">If you are familiar with software design patterns, REST reminds me of the command pattern: the request encapsulates everything the server needs to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">the request.</span></span></p>
<p><span class="koboSpan" id="kobo.214.1">Now that the stage is set, let’s remember that SPAs are now responsible for maintaining their state, that all of the markup HTML, CSS, and JavaScript is loaded in the browser, and that all subsequent requests contain only the state data, which is sent to the server where it is altered </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">and returned.</span></span></p>
<p><span class="koboSpan" id="kobo.216.1">The format of the data transfer can be any form of text. </span><span class="koboSpan" id="kobo.216.2">Most often, it is JSON. </span><span class="koboSpan" id="kobo.216.3">Back in ye olde days of yore, we used XML, but we stopped because XML processing is ridiculously slow in a browser. </span><span class="koboSpan" id="kobo.216.4">JSON is faster since the browser already inherently understands JavaScript, so there is no parsing of the text required. </span><span class="koboSpan" id="kobo.216.5">Just in case this is your first rodeo, let’s compare the two formats. </span><span class="koboSpan" id="kobo.216.6">First, here’s </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">some XML:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.218.1">
&lt;person&gt;
  &lt;firstName&gt;Bruce&lt;/firstName&gt;
  &lt;lastName&gt;Van Horn&lt;/lastName&gt;
  &lt;dateOfBirth trueDate="Heck No"&gt;12/19/1987&lt;/dateOfBirth&gt;
&lt;/person&gt;</span></pre> <p><span class="koboSpan" id="kobo.219.1">XML is tag-based markup like HTML, but you can define your own tags using an XML schema. </span><span class="koboSpan" id="kobo.219.2">This was the format originally used in</span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.220.1"> browsers with the </span><strong class="bold"><span class="koboSpan" id="kobo.221.1">XMLHttpRequest </span></strong><span class="koboSpan" id="kobo.222.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.223.1">XHR</span></strong><span class="koboSpan" id="kobo.224.1">) API call. </span><span class="koboSpan" id="kobo.224.2">The </span><em class="italic"><span class="koboSpan" id="kobo.225.1">X</span></em><span class="koboSpan" id="kobo.226.1"> actually stands for </span><em class="italic"><span class="koboSpan" id="kobo.227.1">XML</span></em><span class="koboSpan" id="kobo.228.1">. </span><span class="koboSpan" id="kobo.228.2">XHR is still used, but almost nobody (Microsoft Azure API teams notwithstanding) still uses XML. </span><span class="koboSpan" id="kobo.228.3">Instead, for performance reasons already mentioned, I give you the same thing </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">in JSON:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.230.1">
{
  "person": {
    "firstName": "Bruce",
    "lastName": "Van Horn",
    "dateOfBirth": {
      "date": "12/19/1987",
      "trueDate": false
     }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.231.1">The same data is represented as is the structure of that data. </span><span class="koboSpan" id="kobo.231.2">As a Python developer, you’ve no doubt recognized this as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">dict</span></strong><span class="koboSpan" id="kobo.233.1">. </span><span class="koboSpan" id="kobo.233.2">Instead of tags with content and attributes, we have key-value pairs stored within curly braces. </span><span class="koboSpan" id="kobo.233.3">It is a rule of JSON that keys and textual values be enclosed in double quotations. </span><span class="koboSpan" id="kobo.233.4">Be careful here. </span><span class="koboSpan" id="kobo.233.5">JavaScript and Python both consider single and double quotation marks to be interchangeable, but JSON does not. </span><span class="koboSpan" id="kobo.233.6">Only double quotes are acceptable! </span><span class="koboSpan" id="kobo.233.7">Thankfully, Python has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">json</span></strong><span class="koboSpan" id="kobo.235.1"> library available within the standard library that will convert your structures to JSON, and back again, without </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">any fuss:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.237.1">
import json
# Convert dictionary to JSON
data_dict = {"name": "John", "age": 30, "city": "New York"}
json_data = json.dumps(data_dict)
# Print the JSON data
print("JSON data:", json_data)</span></pre> <p><span class="koboSpan" id="kobo.238.1">These first few lines import the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">json</span></strong><span class="koboSpan" id="kobo.240.1"> library, then convert it to a JSON object with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">json.dumps</span></strong><span class="koboSpan" id="kobo.242.1"> method. </span><span class="koboSpan" id="kobo.242.2">Just remember, we’re dumping to a string, hence </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">dumps</span></strong><span class="koboSpan" id="kobo.244.1"> (the </span><em class="italic"><span class="koboSpan" id="kobo.245.1">s</span></em><span class="koboSpan" id="kobo.246.1"> is for </span><em class="italic"><span class="koboSpan" id="kobo.247.1">string</span></em><span class="koboSpan" id="kobo.248.1">). </span><span class="koboSpan" id="kobo.248.2">Now let’s convert the </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">other direction:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.250.1">
# Convert JSON to dictionary
parsed_dict = json.loads(json_data)
# Access the dictionary
print("Name:", parsed_dict["name"])
print("Age:", parsed_dict["age"])
print("City:", parsed_dict["city"])</span></pre> <p><span class="koboSpan" id="kobo.251.1">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">json.loads</span></strong><span class="koboSpan" id="kobo.253.1"> to convert the JSON back to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">dict</span></strong><span class="koboSpan" id="kobo.255.1">. </span><span class="koboSpan" id="kobo.255.2">Just remember it as “We’re loading a JSON string,” hence </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">loads</span></strong><span class="koboSpan" id="kobo.257.1"> (the </span><em class="italic"><span class="koboSpan" id="kobo.258.1">s</span></em><span class="koboSpan" id="kobo.259.1"> is </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">for </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.261.1">string</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">You now understand the basic mechanics of what we’re going to be doing with FastAPI. </span><span class="koboSpan" id="kobo.263.2">Requests will be coming in like they did with Flask, but generally, instead of simple </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">GET</span></strong><span class="koboSpan" id="kobo.265.1"> requests, which are intercepted and processed using the Jinja2 template engine, the requests will contain JSON payloads, which we will process. </span><span class="koboSpan" id="kobo.265.2">The results of the processing will be returned as JSON. </span><span class="koboSpan" id="kobo.265.3">The request-response mechanism will be handled using asynchronous functions, so the code will look a little different than it did </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">with Flask.</span></span></p>
<p><span class="koboSpan" id="kobo.267.1">Let’s get our hands dirty so you can see what </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">I mean!</span></span></p>
<h1 id="_idParaDest-223"><a id="_idTextAnchor227"/><span class="koboSpan" id="kobo.269.1">Creating a FastAPI project in PyCharm Professional</span></h1>
<p><span class="koboSpan" id="kobo.270.1">By now, we’ve created </span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.271.1">many projects in PyCharm Professional and this isn’t very different. </span><span class="koboSpan" id="kobo.271.2">I’ll remind you that this set of features is only available in the Professional edition of PyCharm. </span><span class="koboSpan" id="kobo.271.3">If you need to use the Community edition, you can, but you’re on your own in terms of setting up the project since you won’t have access to the tooling we’re about </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">to use.</span></span></p>
<p><span class="koboSpan" id="kobo.273.1">Create a new project in PyCharm by clicking </span><strong class="bold"><span class="koboSpan" id="kobo.274.1">File</span></strong><span class="koboSpan" id="kobo.275.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.276.1">New Project</span></strong><span class="koboSpan" id="kobo.277.1">. </span><span class="koboSpan" id="kobo.277.2">Then, find </span><strong class="bold"><span class="koboSpan" id="kobo.278.1">FastAPI</span></strong><em class="italic"> </em><span class="koboSpan" id="kobo.279.1">in the list of templates. </span><span class="koboSpan" id="kobo.279.2">You can see mine in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.280.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.281.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer273">
<span class="koboSpan" id="kobo.283.1"><img alt="Figure 9.1: The PyCharm project menu contains a template for a FastAPI project" src="image/B19644_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.284.1">Figure 9.1: The PyCharm project menu contains a template for a FastAPI project</span></p>
<p><span class="koboSpan" id="kobo.285.1">As with Flask, the FastAPI project </span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.286.1">template generates some starter code and a run configuration for us, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.287.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.288.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.289.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer274">
<span class="koboSpan" id="kobo.290.1"><img alt="Figure 9.2: The template generates our FastAPI starter code and run configuration" src="image/B19644_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.291.1">Figure 9.2: The template generates our FastAPI starter code and run configuration</span></p>
<p><span class="koboSpan" id="kobo.292.1">There is a lot to talk about in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.293.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.294.1">.2</span></em><span class="koboSpan" id="kobo.295.1">, so I’ve numbered the diagram </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">for reference.</span></span></p>
<p><span class="koboSpan" id="kobo.297.1">PyCharm has created a virtual environment, along with two files as seen at </span><strong class="bold"><span class="koboSpan" id="kobo.298.1">(1)</span></strong><span class="koboSpan" id="kobo.299.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">main.py</span></strong><span class="koboSpan" id="kobo.301.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">test_main.http</span></strong><span class="koboSpan" id="kobo.303.1">. </span><span class="koboSpan" id="kobo.303.2">We’ll come back to the files in a moment. </span><span class="koboSpan" id="kobo.303.3">PyCharm generated a run configuration </span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.304.1">for us. </span><span class="koboSpan" id="kobo.304.2">You can tell because it is the currently selected run configuration at </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">(2)</span></strong><span class="koboSpan" id="kobo.306.1"> where that menu would normally say </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">Current File</span></strong><span class="koboSpan" id="kobo.308.1"> if PyCharm didn’t have a run configuration </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">set up.</span></span></p>
<p><span class="koboSpan" id="kobo.310.1">At position </span><strong class="bold"><span class="koboSpan" id="kobo.311.1">(3)</span></strong><span class="koboSpan" id="kobo.312.1">, we can see an example of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">Hello World</span></strong><span class="koboSpan" id="kobo.314.1"> endpoint for our FastAPI project. </span><span class="koboSpan" id="kobo.314.2">The power of these starter code templates is the psychological prompting they provide. </span><span class="koboSpan" id="kobo.314.3">If you have used any system for working with web routing and endpoints, regardless of language or framework, you can read this code and tell what </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">is happening.</span></span></p>
<p><span class="koboSpan" id="kobo.316.1">Lines 1 and 3 show us a typical constructor for the imported library instance of FastAPI. </span><span class="koboSpan" id="kobo.316.2">Line 6 shows us how FastAPI decorates endpoints. </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">@app</span></strong><span class="koboSpan" id="kobo.318.1"> comes from the instantiation on line 3 and we’re invoking the HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">GET</span></strong><span class="koboSpan" id="kobo.320.1"> method here so requests coming in using that method will be received and processed. </span><span class="koboSpan" id="kobo.320.2">If a client makes a request using another HTTP verb such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">PUT</span></strong><span class="koboSpan" id="kobo.322.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">POST</span></strong><span class="koboSpan" id="kobo.324.1">, they’ll receive an error since, currently, there is no code to handle that </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">HTTP method.</span></span></p>
<p><span class="koboSpan" id="kobo.326.1">Position </span><strong class="bold"><span class="koboSpan" id="kobo.327.1">(3)</span></strong><span class="koboSpan" id="kobo.328.1"> shows us our root route as indicated by the endpoint definition on line 6. </span><span class="koboSpan" id="kobo.328.2">As promised, all puns intended, we have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">async</span></strong><span class="koboSpan" id="kobo.330.1"> function below the decorator on line 7, and we can see we are returning something that looks like a </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">dict</span></strong><span class="koboSpan" id="kobo.332.1">, which also looks </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">like JSON.</span></span></p>
<p><span class="koboSpan" id="kobo.334.1">Position </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">(4)</span></strong><span class="koboSpan" id="kobo.336.1"> shows us another </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">GET</span></strong><span class="koboSpan" id="kobo.338.1"> endpoint defined as </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">/hello/{name}</span></strong><span class="koboSpan" id="kobo.340.1">. </span><span class="koboSpan" id="kobo.340.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">name</span></strong><span class="koboSpan" id="kobo.342.1"> variable offset in curly braces refers to part of the URL that can vary and is called a path parameter or a path variable. </span><span class="koboSpan" id="kobo.342.2">You can see it is duplicated in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">async</span></strong><span class="koboSpan" id="kobo.344.1"> function definition on line 12. </span><span class="koboSpan" id="kobo.344.2">The contents </span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.345.1">of the branches (</span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">name</span></strong><span class="koboSpan" id="kobo.347.1">) on line 11 should match the name of the parameter for the function on </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">line 12.</span></span></p>
<p><span class="koboSpan" id="kobo.349.1">Position </span><strong class="bold"><span class="koboSpan" id="kobo.350.1">(5)</span></strong><span class="koboSpan" id="kobo.351.1"> on line 13 shows us the path variable used in the return JSON where a Python </span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">f</span></strong><span class="koboSpan" id="kobo.353.1"> string expression fills the name into the data. </span><span class="koboSpan" id="kobo.353.2">There is no special templating mechanism other than a normal Python </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">f</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.355.1"> string.</span></span></p>
<h1 id="_idParaDest-224"><a id="_idTextAnchor228"/><span class="koboSpan" id="kobo.356.1">Running the FastAPI project</span></h1>
<p><span class="koboSpan" id="kobo.357.1">Naturally, we can run the FastAPI </span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.358.1">project by clicking the green arrowed run button near position </span><strong class="bold"><span class="koboSpan" id="kobo.359.1">(2)</span></strong><strong class="bold"> </strong><span class="koboSpan" id="kobo.360.1">in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.361.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.362.1">.2</span></em><span class="koboSpan" id="kobo.363.1">. </span><span class="koboSpan" id="kobo.363.2">If you’ve skipped the chapter on setting up and using run and debug configurations, you might want to peek at </span><a href="B19644_06.xhtml#_idTextAnchor145"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.364.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.365.1">, </span><em class="italic"><span class="koboSpan" id="kobo.366.1">Seamless Testing, Debugging, and Profiling</span></em><span class="koboSpan" id="kobo.367.1">, for details on how this feature works in PyCharm. </span><span class="koboSpan" id="kobo.367.2">You can see my program running in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.368.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.369.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.370.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer275">
<span class="koboSpan" id="kobo.371.1"><img alt="Figure 9.3: I clicked the green run button, which spawned a tab in the run window for my project in PyCharm" src="image/B19644_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.372.1">Figure 9.3: I clicked the green run button, which spawned a tab in the run window for my project in PyCharm</span></p>
<p><span class="koboSpan" id="kobo.373.1">This looks similar to the runs in </span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.374.1">Flask, but there isn’t a warning about the development server. </span><span class="koboSpan" id="kobo.374.2">This is because FastAPI runs in an application called </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">uvicorn</span></strong><span class="koboSpan" id="kobo.376.1">, which is a variant of Green Unicorn (</span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">gunicorn</span></strong><span class="koboSpan" id="kobo.378.1">). </span><span class="koboSpan" id="kobo.378.2">Uvicorn is production ready, so there is no warning. </span><span class="koboSpan" id="kobo.378.3">You can develop using the same application server software you will use when you deploy your application to your customers. </span><span class="koboSpan" id="kobo.378.4">The difference between </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">uvicorn</span></strong><span class="koboSpan" id="kobo.380.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">gunicorn</span></strong><span class="koboSpan" id="kobo.382.1">, which is most often used as a production server for Flask applications, is that </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">uvicorn</span></strong><span class="koboSpan" id="kobo.384.1"> handles the async programming model while </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">gunicorn</span></strong><span class="koboSpan" id="kobo.386.1"> uses traditional workers, as described earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">At this point, we are left with something of a quandary. </span><span class="koboSpan" id="kobo.388.2">When we did this with Flask, the app was generating some HTML for us to view. </span><span class="koboSpan" id="kobo.388.3">This one isn’t. </span><span class="koboSpan" id="kobo.388.4">You can view the endpoint in a browser if you would like, as I am in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.389.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.390.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer276">
<span class="koboSpan" id="kobo.392.1"><img alt="Figure 9.4: Visiting the root route isn’t very exciting, but it works" src="image/B19644_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.393.1">Figure 9.4: Visiting the root route isn’t very exciting, but it works</span></p>
<p><span class="koboSpan" id="kobo.394.1">I can also visit the other URL with </span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.395.1">the path parameter as part of the URL as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.396.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.397.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer277">
<span class="koboSpan" id="kobo.399.1"><img alt="Figure 9.5: Supplying a path parameter alters the data in the response" src="image/B19644_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.400.1">Figure 9.5: Supplying a path parameter alters the data in the response</span></p>
<p><span class="koboSpan" id="kobo.401.1">This time, I added the path parameter to the end of the URL, and as we saw in the code earlier, we’re getting back the generated </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">JSON data.</span></span></p>
<p><span class="koboSpan" id="kobo.403.1">There’s a problem with using the browser. </span><span class="koboSpan" id="kobo.403.2">The browser only allows you to submit HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">GET</span></strong><span class="koboSpan" id="kobo.405.1"> requests. </span><span class="koboSpan" id="kobo.405.2">There are quite a few more HTTP methods typically used in a REST API project. </span><span class="koboSpan" id="kobo.405.3">In fact, the four most popular methods, sometimes referred to as verbs, map to the typical CRUD operations used in database applications. </span><strong class="bold"><span class="koboSpan" id="kobo.406.1">CRUD</span></strong><span class="koboSpan" id="kobo.407.1"> is an acronym for </span><strong class="bold"><span class="koboSpan" id="kobo.408.1">Create</span></strong><strong class="bold"><span class="koboSpan" id="kobo.409.1">, Read, Update, Delete</span></strong><span class="koboSpan" id="kobo.410.1">. </span><span class="koboSpan" id="kobo.410.2">The </span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.411.1">verbs map as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.412.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.413.1">.6</span></em><span class="koboSpan" id="kobo.414.1">. </span><span class="koboSpan" id="kobo.414.2">Your request is defined by these operations. </span><span class="koboSpan" id="kobo.414.3">You don’t have to use these methods, but you should as a best practice. </span><span class="koboSpan" id="kobo.414.4">I’ve seen big, expensive, commercial applications only use </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">GET</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.416.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">POST</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.419.1">In addition to standards for your requests, your responses can be standardized via best practice by using proper HTTP status codes. </span><span class="koboSpan" id="kobo.419.2">These are documented in the HTTP specifications provided by the W3C. </span><span class="koboSpan" id="kobo.419.3">Reading the specification is a sure-fire cure for insomnia, so I’ll refer you to the </span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.420.1">excellent </span><strong class="bold"><span class="koboSpan" id="kobo.421.1">Mozilla Developer Network</span></strong><span class="koboSpan" id="kobo.422.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.423.1">MDN</span></strong><span class="koboSpan" id="kobo.424.1">) page for the status codes. </span><span class="koboSpan" id="kobo.424.2">This is a handy address to bookmark in your </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">browser: </span></span><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status"><span class="No-Break"><span class="koboSpan" id="kobo.426.1">https://developer.mozilla.org/en-US/docs/Web/HTTP/Status</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.427.1">.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.428.1">HTTP Verb / </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.429.1">Method</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.430.1">CRUD Operation</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.431.1">HTTP Status for </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.432.1">Successful Response</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.433.1">Explanation</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">GET</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">READ</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">200 (OK)</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.437.1">Used to retrieve or get information from the server or database. </span><span class="koboSpan" id="kobo.437.2">For example, getting a list of users in </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">your application.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">POST</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">CREATE</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">201 (Created)</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.442.1">Used to create a new record in a database. </span><span class="koboSpan" id="kobo.442.2">Use this anytime you are creating something on the server. </span><span class="koboSpan" id="kobo.442.3">For example, new </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">user registration.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">PUT</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">UPDATE</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">204 (No Content)</span></strong><span class="koboSpan" id="kobo.447.1"> or </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">200 (OK)</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.449.1">Use this method when you are sending an update to something that already exists, such as a database record. </span><span class="koboSpan" id="kobo.449.2">For example, updating </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">a password.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">DELETE</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">DELETE</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">204 (No Content)</span></strong><span class="koboSpan" id="kobo.454.1"> or </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.455.1">200 (OK)</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.456.1">Use this when you want to </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">delete something.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.458.1">Figure 9.6: HTTP methods map to CRUD operations 1:1 and have standard response codes to denote successful responses</span></p>
<p><span class="koboSpan" id="kobo.459.1">With your browser limited to HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">GET</span></strong><span class="koboSpan" id="kobo.461.1"> requests, and the 100% likelihood that we will want to use at least one of the other methods in our project, we need something better than just a browser for testing </span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.462.1">our API. </span><span class="koboSpan" id="kobo.462.2">We have a </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">few options:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.464.1">There are browser plugins that allow you to send different kinds of requests. </span><span class="koboSpan" id="kobo.464.2">You can find them in your favorite </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">browser’s marketplace.</span></span></li>
<li><span class="koboSpan" id="kobo.466.1">Command-line tools such as cURL allow you to craft HTTP requests using any of the </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">HTTP methods.</span></span></li>
<li><span class="koboSpan" id="kobo.468.1">Dedicated API testing tools such as Insomnia (</span><a href="https://www.insomnia.rest"><span class="koboSpan" id="kobo.469.1">https://www.insomnia.rest</span></a><span class="koboSpan" id="kobo.470.1">) or Postman (</span><a href="https://getpostman.com"><span class="koboSpan" id="kobo.471.1">https://getpostman.com</span></a><span class="koboSpan" id="kobo.472.1">) allow you a graphical tool for working with API requests. </span><span class="koboSpan" id="kobo.472.2">These tools can be very bloated as they are meant to do a lot more than just allow you to make the various request types. </span><span class="koboSpan" id="kobo.472.3">With that said, I use both because of their wide adoption rate. </span><span class="koboSpan" id="kobo.472.4">Believe it or not, there are developers on my</span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.473.1"> team who don’t </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1">use PyCharm.</span></span></li>
<li><span class="koboSpan" id="kobo.475.1">PyCharm’s built-in HTTP </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">Requests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.477.1"> feature.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.478.1">Obviously, we’re going to be focusing on the </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">fourth option.</span></span></p>
<h1 id="_idParaDest-225"><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.480.1">Working with PyCharm’s HTTP Requests</span></h1>
<p><span class="koboSpan" id="kobo.481.1">When we generated our</span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.482.1"> project, PyCharm created two files. </span><span class="koboSpan" id="kobo.482.2">It created </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">main.py</span></strong><span class="koboSpan" id="kobo.484.1">, which we have already examined. </span><span class="koboSpan" id="kobo.484.2">It also created a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">test_main.http</span></strong><span class="koboSpan" id="kobo.486.1">. </span><span class="koboSpan" id="kobo.486.2">This file is unique to PyCharm. </span><span class="koboSpan" id="kobo.486.3">Let’s examine the file shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.487.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.488.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer278">
<span class="koboSpan" id="kobo.490.1"><img alt="Figure 9.7: The HTTP test file generated by PyCharm as part of a FastAPI project" src="image/B19644_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.491.1">Figure 9.7: The HTTP test file generated by PyCharm as part of a FastAPI project</span></p>
<p><span class="koboSpan" id="kobo.492.1">You’ll find the file itself directly next to </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">main.py</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.494.1">(1)</span></strong><span class="koboSpan" id="kobo.495.1">. </span><span class="koboSpan" id="kobo.495.2">We mentioned this as one of the popular conventions for the placement of test files – right next to the file we’re testing. </span><span class="koboSpan" id="kobo.495.3">It is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">test-main.http</span></strong><span class="koboSpan" id="kobo.497.1">, which lets us know exactly what is being tested. </span><span class="koboSpan" id="kobo.497.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">main.py</span></strong><span class="koboSpan" id="kobo.499.1"> file will contain endpoints </span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.500.1">and </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">test_main.http</span></strong><span class="koboSpan" id="kobo.502.1"> will then contain tests for all </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">the endpoints.</span></span></p>
<p><span class="koboSpan" id="kobo.504.1">This </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">http</span></strong><span class="koboSpan" id="kobo.506.1"> test file isn’t code, as we saw in </span><a href="B19644_06.xhtml#_idTextAnchor145"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.507.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.508.1">, </span><em class="italic"><span class="koboSpan" id="kobo.509.1">Seamless Testing, Debugging, and Profiling</span></em><span class="koboSpan" id="kobo.510.1">. </span><span class="koboSpan" id="kobo.510.2">This is a specification for HTTP requests. </span><span class="koboSpan" id="kobo.510.3">Positions </span><strong class="bold"><span class="koboSpan" id="kobo.511.1">(3)</span></strong><span class="koboSpan" id="kobo.512.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">(4)</span></strong><span class="koboSpan" id="kobo.514.1"> reveal one test per endpoint in </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">main.py</span></strong><span class="koboSpan" id="kobo.516.1">, which is a good starting point. </span><span class="koboSpan" id="kobo.516.2">These tests are very simple, and like unit tests, they can be run individually using the green arrows. </span><span class="koboSpan" id="kobo.516.3">If you want to run all the tests in the file, you can use the toolbar </span><strong class="bold"><span class="koboSpan" id="kobo.517.1">(2)</span></strong><span class="koboSpan" id="kobo.518.1">, which has a button with two green arrows. </span><span class="koboSpan" id="kobo.518.2">There is also an environment selector, which we’ll come back to soon. </span><span class="koboSpan" id="kobo.518.3">Position </span><strong class="bold"><span class="koboSpan" id="kobo.519.1">(5)</span></strong><span class="koboSpan" id="kobo.520.1"> shows a link that gives you a set of examples that can be pasted into your test files. </span><span class="koboSpan" id="kobo.520.2">We’ll come back to that too. </span><span class="koboSpan" id="kobo.520.3">First, let’s exercise our test and see what it does. </span><span class="koboSpan" id="kobo.520.4">I’ll click the double arrow run button shown by the top arrow in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.521.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.522.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer279">
<span class="koboSpan" id="kobo.524.1"><img alt="Figure 9.8: Click the double arrow to run all the tests and you’ll find they both fail! Oh no!" src="image/B19644_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.525.1">Figure 9.8: Click the double arrow to run all the tests and you’ll find they both fail! </span><span class="koboSpan" id="kobo.525.2">Oh no!</span></p>
<p><span class="koboSpan" id="kobo.526.1">This isn’t good. </span><span class="koboSpan" id="kobo.526.2">Both of the tests fail spectacularly. </span><span class="koboSpan" id="kobo.526.3">I say </span><em class="italic"><span class="koboSpan" id="kobo.527.1">spectacularly</span></em><span class="koboSpan" id="kobo.528.1"> because PyCharm leaves no ambiguity. </span><span class="koboSpan" id="kobo.528.2">I see a red banner telling me my test failed. </span><span class="koboSpan" id="kobo.528.3">I see red text, by the lower arrow, telling me two tests failed. </span><span class="koboSpan" id="kobo.528.4">I see red Xs next to the test list. </span><span class="koboSpan" id="kobo.528.5">I see a message stating </span><strong class="bold"><span class="koboSpan" id="kobo.529.1">Stopped. </span><span class="koboSpan" id="kobo.529.2">Tests failed 2 of 2</span></strong><span class="koboSpan" id="kobo.530.1">. </span><span class="koboSpan" id="kobo.530.2">If that isn’t enough, there is a log area that also lets you know your code missed the mark. </span><span class="koboSpan" id="kobo.530.3">In short, there are more red marks on this screen than there are on this chapter’s manuscript after the editor made their first pass! </span><span class="koboSpan" id="kobo.530.4">Trust me, that’s a lot! </span><span class="koboSpan" id="kobo.530.5">What in the </span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.531.1">world could be wrong? </span><span class="koboSpan" id="kobo.531.2">Why would PyCharm generate a failing test code like that in a </span><em class="italic"><span class="koboSpan" id="kobo.532.1">Hello </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.533.1">World</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.534.1"> example?</span></span></p>
<p><span class="koboSpan" id="kobo.535.1">There’s nothing wrong with the</span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.536.1"> code! </span><span class="koboSpan" id="kobo.536.2">In </span><a href="B19644_06.xhtml#_idTextAnchor145"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.537.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.538.1">,</span><em class="italic"><span class="koboSpan" id="kobo.539.1"> Seamless Testing, Debugging, and Profiling</span></em><span class="koboSpan" id="kobo.540.1">, we learned about unit testing. </span><span class="koboSpan" id="kobo.540.2">Unit tests comprise code that exercises the code you are testing using assertions. </span><span class="koboSpan" id="kobo.540.3">The HTTP file doesn’t contain code, and this is not unit testing, this is integration testing. </span><span class="koboSpan" id="kobo.540.4">These tests require a running server in order to work. </span><span class="koboSpan" id="kobo.540.5">Let’s try this again. </span><span class="koboSpan" id="kobo.540.6">Examine </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.541.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.542.1">.9</span></em><span class="koboSpan" id="kobo.543.1"> and follow along if </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">you like:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer280">
<span class="koboSpan" id="kobo.545.1"><img alt="Figure 9.9: You have to run the development server before you run the HTTP tests" src="image/B19644_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.546.1">Figure 9.9: You have to run the development server before you run the HTTP tests</span></p>
<p><span class="koboSpan" id="kobo.547.1">Click the run button for the API project </span><strong class="bold"><span class="koboSpan" id="kobo.548.1">(1)</span></strong><span class="koboSpan" id="kobo.549.1">. </span><span class="koboSpan" id="kobo.549.2">Then click the run button for the tests </span><strong class="bold"><span class="koboSpan" id="kobo.550.1">(2)</span></strong><span class="koboSpan" id="kobo.551.1">. </span><span class="koboSpan" id="kobo.551.2">With the server running, all the tests will pass </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">(3)</span></strong><span class="koboSpan" id="kobo.553.1">. </span><span class="koboSpan" id="kobo.553.2">If they don’t, call JetBrains and ask for your money back. </span><span class="koboSpan" id="kobo.553.3">That probably won’t work, which is OK because your tests </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">should pass.</span></span></p>
<h2 id="_idParaDest-226"><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.555.1">Examining the details of the return</span></h2>
<p><span class="koboSpan" id="kobo.556.1">It isn’t enough to know we passed, because all that really means is both requests were made against the local development </span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.557.1">server, and both came back with a status code of </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">200</span></strong><span class="koboSpan" id="kobo.559.1">. </span><span class="koboSpan" id="kobo.559.2">What you really want, most of the time, is to be able to see the JSON data that came back on the response. </span><span class="koboSpan" id="kobo.559.3">Let’s go find that. </span><span class="koboSpan" id="kobo.559.4">Locate the output for the test and scroll down until you see a mention of a JSON file like the one shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.560.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.561.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer281">
<span class="koboSpan" id="kobo.563.1"><img alt="Figure 9.10: Scroll through the log and find the links to the JSON files. Click them to open the data in the tabbed area in the editor" src="image/B19644_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.564.1">Figure 9.10: Scroll through the log and find the links to the JSON files. </span><span class="koboSpan" id="kobo.564.2">Click them to open the data in the tabbed area in the editor</span></p>
<p><span class="koboSpan" id="kobo.565.1">This section in the log window tells us all the details about the request and response made in the test. </span><span class="koboSpan" id="kobo.565.2">We can see </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.567.1">The version of HTTP being </span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">used (1.1)</span></span></li>
<li><span class="koboSpan" id="kobo.569.1">The status code of the response (</span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">200 OK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.572.1">The date of </span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">the request</span></span></li>
<li><span class="koboSpan" id="kobo.574.1">The server that generated the </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">result (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">uvicorn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.578.1">The content type of the </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">response (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">application/json</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.582.1">The location where the test result </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">was saved</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.584.1">Yahtzee! </span><span class="koboSpan" id="kobo.584.2">PyCharm saved the result of the response in a JSON file that is date stamped, along with the status code, and presented it as a hyperlink in the log. </span><span class="koboSpan" id="kobo.584.3">If you click the link, the JSON file opens like any </span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.585.1">other text file in its own tab. </span><span class="koboSpan" id="kobo.585.2">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.586.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.587.1">.10</span></em><span class="koboSpan" id="kobo.588.1">, I had to expand the log to be large enough to make for a good screenshot, but this obscured the contents of the open tab, so check out </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.589.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.590.1">.11</span></em><span class="koboSpan" id="kobo.591.1"> to see the return data in its tab having clicked the hyperlink in </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">the log:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer282">
<span class="koboSpan" id="kobo.593.1"><img alt="Figure 9.11: The returned data appears in its own tab when you click the hyperlink" src="image/B19644_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.594.1">Figure 9.11: The returned data appears in its own tab when you click the hyperlink</span></p>
<p><span class="koboSpan" id="kobo.595.1">If you notice, it says the file is saved, but it doesn’t appear in the project files. </span><span class="koboSpan" id="kobo.595.2">If you are wondering where it was saved, you can right-click the tab as indicated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.596.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.597.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer283">
<span class="koboSpan" id="kobo.599.1"><img alt="Figure 9.12: Right-click the tab and use the Open In menu to open the location of the test result JSON file" src="image/B19644_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.600.1">Figure 9.12: Right-click the tab and use the Open In menu to open the location of the test result JSON file</span></p>
<p><span class="koboSpan" id="kobo.601.1">The contents of the menu</span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.602.1"> will differ depending on your operating system. </span><span class="koboSpan" id="kobo.602.2">You’re looking for the top option, which for me is </span><strong class="bold"><span class="koboSpan" id="kobo.603.1">Files</span></strong><span class="koboSpan" id="kobo.604.1">, which is the default file manager in </span><strong class="bold"><span class="koboSpan" id="kobo.605.1">Gnome 42</span></strong><span class="koboSpan" id="kobo.606.1">. </span><span class="koboSpan" id="kobo.606.2">Windows will have a reference to Explorer and macOS ought to have a reference to Finder. </span><span class="koboSpan" id="kobo.606.3">Clicking that option will show you the location in your OS-specific file manager. </span><span class="koboSpan" id="kobo.606.4">You can see mine in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.607.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.608.1">.13</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer284">
<span class="koboSpan" id="kobo.610.1"><img alt="Figure 9.13: My file manager reveals the location for the HTTP response files, which is in the project’s .idea folder" src="image/B19644_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.611.1">Figure 9.13: My file manager reveals the location for the HTTP response files, which is in the project’s .idea folder</span></p>
<p><span class="koboSpan" id="kobo.612.1">As you can see, the test results are stored in the PyCharm project folder: the hidden </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">.idea</span></strong><span class="koboSpan" id="kobo.614.1"> folder the IDE </span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.615.1">creates when you either create a new project or open a folder in PyCharm. </span><span class="koboSpan" id="kobo.615.2">Remember, any folder with a name beginning with a dot is hidden on a Mac or in Linux, but you can see them in Windows because Bill likes to be different. </span><span class="koboSpan" id="kobo.615.3">If you test often, as you should, these files might begin to stack up in numbers. </span><span class="koboSpan" id="kobo.615.4">I personally prefer to exclude these from </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">my repositories.</span></span></p>
<h2 id="_idParaDest-227"><a id="_idTextAnchor231"/><span class="koboSpan" id="kobo.617.1">We just generated a new run configuration</span></h2>
<p><span class="koboSpan" id="kobo.618.1">A neat side effect of running all tests </span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.619.1">from the test window is that PyCharm creates a new run configuration, which you will find in the run configuration dropdown shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.620.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.621.1">.14</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer285">
<span class="koboSpan" id="kobo.623.1"><img alt="Figure 9.14: PyCharm created a new run configuration automatically following the first time we ran the HTTP tests" src="image/B19644_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.624.1">Figure 9.14: PyCharm created a new run configuration automatically following the first time we ran the HTTP tests</span></p>
<p><span class="koboSpan" id="kobo.625.1">If we edit the configuration, you can </span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.626.1">see more details, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.627.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.628.1">.15</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.629.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer286">
<span class="koboSpan" id="kobo.630.1"><img alt="Figure 9.15: Options for HTTP Request test runs can be found in the run configuration editor" src="image/B19644_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.631.1">Figure 9.15: Options for HTTP Request test runs can be found in the run configuration editor</span></p>
<p><span class="koboSpan" id="kobo.632.1">As you can see, you can opt to</span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.633.1"> run individual requests or all the requests in the file. </span><span class="koboSpan" id="kobo.633.2">Running single requests is handy if you’re focusing on the code for one endpoint and you need to run it over and over. </span><span class="koboSpan" id="kobo.633.3">If you had many endpoints in the test, your tests might take a while </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">to complete.</span></span></p>
<h2 id="_idParaDest-228"><a id="_idTextAnchor232"/><span class="koboSpan" id="kobo.635.1">Using Before launch actions in run configurations</span></h2>
<p><span class="koboSpan" id="kobo.636.1">We’ve seen that every run of our HTTP tests generates a new JSON file containing the response. </span><span class="koboSpan" id="kobo.636.2">This can fill up a folder pretty quickly with hundreds of files. </span><span class="koboSpan" id="kobo.636.3">Since PyCharm gives us a run configuration, we have the opportunity to set up some automation to delete older files. </span><span class="koboSpan" id="kobo.636.4">In this section, we’ll explore some automation capabilities available in PyCharm’s run </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">configuration settings.</span></span></p>
<p><span class="koboSpan" id="kobo.638.1">To do this you’ll need a script to delete the JSON files as you see fit. </span><span class="koboSpan" id="kobo.638.2">Perhaps you want to delete everything older than a week, or maybe you just want to keep the last 25 runs. </span><span class="koboSpan" id="kobo.638.3">This part is up </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">to you.</span></span></p>
<p><span class="koboSpan" id="kobo.640.1">In order to automate this, you need to create a shell script for your operating system. </span><span class="koboSpan" id="kobo.640.2">If you aren’t a shell scripting guru, that’s OK, because modern artificial intelligence can come to your rescue. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.641.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.642.1">.16</span></em><span class="koboSpan" id="kobo.643.1"> shows me asking ChatGPT to create a shell script for the Bash shell that keeps only the last 25 JSON files generated by our </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">test runs:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer287">
<span class="koboSpan" id="kobo.645.1"><img alt="Figure 9.16: I’ve asked ChatGPT about a few different ways to delete old files and it has generated a script for me" src="image/B19644_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.646.1">Figure 9.16: I’ve asked ChatGPT about a few different ways to delete old files and it has generated a script for me</span></p>
<p><span class="koboSpan" id="kobo.647.1">I realize you can’t see the whole script for Bash in the figure, so I’ll be sure to include it in the project source for </span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">this chapter.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.649.1">Warning – never run generated scripts you don’t understand!</span></p>
<p class="callout"><span class="koboSpan" id="kobo.650.1">You should never blindly run a script generated by ChatGPT or anything (or anyone) else, including or even especially me, without fully understanding how it works! </span><span class="koboSpan" id="kobo.650.2">ChatGPT will probably not give you the same result it gave me, so exercise caution when running any script it gives you. </span><span class="koboSpan" id="kobo.650.3">Be especially wary if the script includes anything like </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">-Force</span></strong><span class="koboSpan" id="kobo.652.1"> switches, as in the PowerShell script in the figure. </span><span class="koboSpan" id="kobo.652.2">If you don’t know what the script does, don’t run it on </span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">your computer!</span></span></p>
<p><span class="koboSpan" id="kobo.654.1">To use the generated code, you can just add a new file to your project as you would any other. </span><span class="koboSpan" id="kobo.654.2">I’m going to right-click my project in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">Project</span></strong><span class="koboSpan" id="kobo.656.1"> window and create a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">delete-old-http-test-results.sh</span></strong><span class="koboSpan" id="kobo.658.1">. </span><span class="koboSpan" id="kobo.658.2">Naturally, if you are on Windows, you’ll want to use PowerShell, which typically bears an extension of </span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">.ps1</span></strong><span class="koboSpan" id="kobo.660.1">, so it would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">delete-old-http-test-results.ps1</span></strong><span class="koboSpan" id="kobo.662.1">. </span><span class="koboSpan" id="kobo.662.2">Copy the script generated by the AI once you fully understand the ramifications of running said script and save </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">the file.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.664.1">Make sure the script has run permissions</span></p>
<p class="callout"><span class="koboSpan" id="kobo.665.1">Make sure the script file you create has permission to run on your computer. </span><span class="koboSpan" id="kobo.665.2">Most editions of Windows heavily restrict running any PowerShell script, and your ability to do this might even be restricted by your employer’s </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">security policy.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.667.1">On Mac and Linux, you might need to run this in a terminal before PyCharm will execute </span><span class="No-Break"><span class="koboSpan" id="kobo.668.1">the script:</span></span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">chmod +</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">x delete-old-http-test-results.sh</span></strong></span></p>
<p class="callout"><span class="koboSpan" id="kobo.671.1">If you can’t run the script manually, it probably won’t work in </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">PyCharm either.</span></span></p>
<p><span class="koboSpan" id="kobo.673.1">Next, we need to create a run configuration that executes the script. </span><span class="koboSpan" id="kobo.673.2">Click the run configuration dropdown and click </span><strong class="bold"><span class="koboSpan" id="kobo.674.1">Edit Configurations</span></strong><span class="koboSpan" id="kobo.675.1">. </span><span class="koboSpan" id="kobo.675.2">If you don’t remember how to do this, review </span><a href="B19644_03.xhtml#_idTextAnchor052"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.676.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.677.1">,</span><em class="italic"><span class="koboSpan" id="kobo.678.1"> Customizing Interpreters and Virtual Environments</span></em><span class="koboSpan" id="kobo.679.1">. </span><span class="koboSpan" id="kobo.679.2">Add a new run configuration using the Shell Script template. </span><span class="koboSpan" id="kobo.679.3">You can see mine in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.680.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.681.1">.17</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer288">
<span class="koboSpan" id="kobo.683.1"><img alt="Figure 9.17: Create a run configuration for the shell script we just created" src="image/B19644_09_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.684.1">Figure 9.17: Create a run configuration for the shell script we just created</span></p>
<p><span class="koboSpan" id="kobo.685.1">You can navigate to the shell script using the folder button in the </span><strong class="bold"><span class="koboSpan" id="kobo.686.1">Script path</span></strong><span class="koboSpan" id="kobo.687.1"> textbox. </span><span class="koboSpan" id="kobo.687.2">Be sure to set </span><strong class="bold"><span class="koboSpan" id="kobo.688.1">Working directory</span></strong><span class="koboSpan" id="kobo.689.1"> for the script; otherwise, you might delete files in your project! </span><span class="koboSpan" id="kobo.689.2">We saw earlier that these files live in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">httpRequests</span></strong><span class="koboSpan" id="kobo.691.1"> folder inside the project’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">.idea</span></strong><span class="koboSpan" id="kobo.693.1"> folder. </span><span class="koboSpan" id="kobo.693.2">Click the folder icon in the </span><strong class="bold"><span class="koboSpan" id="kobo.694.1">Working directory</span></strong><span class="koboSpan" id="kobo.695.1"> textbox to browse this folder. </span><span class="koboSpan" id="kobo.695.2">If you are not on Windows, this will be a hidden folder, so be sure to turn on viewing hidden folders in the selection dialog as I did in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.696.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.697.1">.18</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer289">
<span class="koboSpan" id="kobo.699.1"><img alt="Figure 9.18: To find the httpRequests folder inside the .idea folder, you need to turn on hidden folders by clicking the eyeball (ouch) on the top toolbar" src="image/B19644_09_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.700.1">Figure 9.18: To find the httpRequests folder inside the .idea folder, you need to turn on hidden folders by clicking the eyeball (ouch) on the top toolbar</span></p>
<p><span class="koboSpan" id="kobo.701.1">You now have a run configuration that executes your </span><strong class="source-inline"><span class="koboSpan" id="kobo.702.1">delete</span></strong><span class="koboSpan" id="kobo.703.1"> script. </span><span class="koboSpan" id="kobo.703.2">You should test it. </span><span class="koboSpan" id="kobo.703.3">Run your tests 26 more times, and verify you only have the last 25 results in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">httpRequests</span></strong><span class="koboSpan" id="kobo.705.1"> folder. </span><span class="koboSpan" id="kobo.705.2">I’ll show you my results in the next 25 full-page color screenshots. </span><span class="koboSpan" id="kobo.705.3">Just kidding. </span><span class="koboSpan" id="kobo.705.4">Sometimes it’s fun to scare </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1">my editors.</span></span></p>
<p><span class="koboSpan" id="kobo.707.1">If it works, and you’re happy, then there’s one more thing you can do to make it extra awesome. </span><span class="koboSpan" id="kobo.707.2">You can chain your delete script run configuration with your test run configuration. </span><span class="koboSpan" id="kobo.707.3">Edit the run configuration for the tests and add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">Before build</span></strong><span class="koboSpan" id="kobo.709.1"> condition. </span><span class="koboSpan" id="kobo.709.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.710.1">+</span></strong><span class="koboSpan" id="kobo.711.1"> button to add a new condition. </span><span class="koboSpan" id="kobo.711.2">Click </span><strong class="bold"><span class="koboSpan" id="kobo.712.1">Run another run configuration</span></strong><span class="koboSpan" id="kobo.713.1">. </span><span class="koboSpan" id="kobo.713.2">Click </span><strong class="bold"><span class="koboSpan" id="kobo.714.1">Delete Old HTTP Results run configuration</span></strong><span class="koboSpan" id="kobo.715.1">. </span><span class="koboSpan" id="kobo.715.2">You should see something like </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.716.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.717.1">.19</span></em><span class="koboSpan" id="kobo.718.1">, which shows the deletion script will run before each new </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">test run:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer290">
<span class="koboSpan" id="kobo.720.1"><img alt="Figure 9.19: The deletion run configuration will now run before each launch of my tests" src="image/B19644_09_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.721.1">Figure 9.19: The deletion run configuration will now run before each launch of my tests</span></p>
<p><span class="koboSpan" id="kobo.722.1">For the sake of the book, I changed my retention number to the last five JSON files and tried it out. </span><span class="koboSpan" id="kobo.722.2">After each run, I can look in my file browser, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.723.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.724.1">.20</span></em><span class="koboSpan" id="kobo.725.1">, and see whether </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">it’s working:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer291">
<span class="koboSpan" id="kobo.727.1"><img alt="Figure 9.20: After my run, there are seven JSON files since the delete script reduces the file count to five before the run, and the test produces results for two endpoints" src="image/B19644_09_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.728.1">Figure 9.20: After my run, there are seven JSON files since the delete script reduces the file count to five before the run, and the test produces results for two endpoints</span></p>
<p><span class="koboSpan" id="kobo.729.1">You’ll only ever have at most 25 results in your folder, or however many you specified in your script! </span><span class="koboSpan" id="kobo.729.2">Don’t forget, though, the deletion script runs first and PyCharm will generate one new JSON file for each tested endpoint. </span><span class="koboSpan" id="kobo.729.3">If I set my delete script to retain five JSON files and I run the generated test script, I’ll have seven files after the run since there are two endpoints </span><span class="No-Break"><span class="koboSpan" id="kobo.730.1">being tested.</span></span></p>
<p><span class="koboSpan" id="kobo.731.1">Using this technique, you can enable a great many automation scenarios for your code. </span><span class="koboSpan" id="kobo.731.2">Python doesn’t generally have a build script, like many languages, so it’s nice to know you have this level of automation available in the IDE itself. </span><span class="koboSpan" id="kobo.731.3">There were several options besides running another run configuration. </span><span class="koboSpan" id="kobo.731.4">I recommend you explore all </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">the possibilities!</span></span></p>
<h2 id="_idParaDest-229"><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.733.1">Working with HTTP Request environments</span></h2>
<p><span class="koboSpan" id="kobo.734.1">Most web projects begin their life on a developer’s computer. </span><span class="koboSpan" id="kobo.734.2">When you test, you run your application locally on your laptop or PC, and all of your test requests are usually going to localhost, which is the</span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.735.1"> loopback address assigned to every computer with a network card. </span><span class="koboSpan" id="kobo.735.2">The project starts out there, but assuming the app enjoys any level of success, it will not </span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">stay there.</span></span></p>
<p><span class="koboSpan" id="kobo.737.1">Best practice dictates that applications intended for publication should use some sort of </span><strong class="bold"><span class="koboSpan" id="kobo.738.1">continuous integration</span></strong><span class="koboSpan" id="kobo.739.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.740.1">CI</span></strong><span class="koboSpan" id="kobo.741.1">) environment where </span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.742.1">automated tests can be run. </span><span class="koboSpan" id="kobo.742.2">In fact, JetBrains makes a CI product called Team City. </span><span class="koboSpan" id="kobo.742.3">I used Team City for many years and can attest that it is an excellent CI system that is easy to set up, and it is free for small teams. </span><span class="koboSpan" id="kobo.742.4">These days, there is even a cloud version, so you needn’t set up your own servers if that’s not your thing. </span><span class="koboSpan" id="kobo.742.5">Team City, though, has the same plugin we’ve been using to create tests for our HTTP endpoints in our FastAPI project. </span><span class="koboSpan" id="kobo.742.6">This allows you to test your project automatically every time someone commits code to your </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">source repository.</span></span></p>
<p><span class="koboSpan" id="kobo.744.1">Once your code passes muster with the CI system, it is common for the code to be deployed to a testing server. </span><span class="koboSpan" id="kobo.744.2">This should be a server that is as much like production as you can manage. </span><span class="koboSpan" id="kobo.744.3">Some people call this a staging </span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.745.1">server, some call it </span><strong class="bold"><span class="koboSpan" id="kobo.746.1">user acceptance test</span></strong><span class="koboSpan" id="kobo.747.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.748.1">UAT</span></strong><span class="koboSpan" id="kobo.749.1">). </span><span class="koboSpan" id="kobo.749.2">No matter what you call it, it represents an environment. </span><span class="koboSpan" id="kobo.749.3">Production too is an environment. </span><span class="koboSpan" id="kobo.749.4">An environment is simply a configuration environment where you can run your code. </span><span class="koboSpan" id="kobo.749.5">To be clear, so far, we’ve mentioned four </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">such environments:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.751.1">Your local </span><span class="No-Break"><span class="koboSpan" id="kobo.752.1">computer (localhost)</span></span></li>
<li><span class="koboSpan" id="kobo.753.1">A CI environment, which these days is probably a </span><span class="No-Break"><span class="koboSpan" id="kobo.754.1">Docker container</span></span></li>
<li><span class="koboSpan" id="kobo.755.1">A UAT/staging environment where you can test your app before you release it </span><span class="No-Break"><span class="koboSpan" id="kobo.756.1">to production</span></span></li>
<li><span class="koboSpan" id="kobo.757.1">A production environment where your real customers use </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">your app</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.759.1">Each of these environments might have different attributes. </span><span class="koboSpan" id="kobo.759.2">For example, your FastAPI app running on your laptop can be accessed using the IP address </span><strong class="source-inline"><span class="koboSpan" id="kobo.760.1">127.0.0.1</span></strong><span class="koboSpan" id="kobo.761.1">. </span><span class="koboSpan" id="kobo.761.2">By default, the app runs on port </span><strong class="source-inline"><span class="koboSpan" id="kobo.762.1">8000</span></strong><span class="koboSpan" id="kobo.763.1">, and also by default, the protocol used is HTTP and not HTTPS since few developers take the time to set up an SSL/TLS certificate on </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">their laptops.</span></span></p>
<p><span class="koboSpan" id="kobo.765.1">However, when you test your application in staging, all of those parameters are different. </span><span class="koboSpan" id="kobo.765.2">You probably will have an SSL certificate, so you’ll use HTTPS as your protocol. </span><span class="koboSpan" id="kobo.765.3">You’ll definitely have a different IP address. </span><span class="koboSpan" id="kobo.765.4">You might even have a domain name server resolving a nice test domain name for your app. </span><span class="koboSpan" id="kobo.765.5">You probably won’t be using port </span><strong class="source-inline"><span class="koboSpan" id="kobo.766.1">8000</span></strong><span class="koboSpan" id="kobo.767.1"> since that would not be very </span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.768.1">production-like. </span><span class="koboSpan" id="kobo.768.2">Instead, you’ll be using port </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">443</span></strong><span class="koboSpan" id="kobo.770.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">80</span></strong><span class="koboSpan" id="kobo.772.1">, and in that case, you needn’t necessarily fill in the port </span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">at all.</span></span></p>
<p><span class="koboSpan" id="kobo.774.1">The production too will have different </span><span class="No-Break"><span class="koboSpan" id="kobo.775.1">attributes again.</span></span></p>
<p><span class="koboSpan" id="kobo.776.1">In our API tests, we are able to configure a set of variables to be used in our test script, which are assigned to an environment name. </span><span class="koboSpan" id="kobo.776.2">Make sure you have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.777.1">test_main.http</span></strong><span class="koboSpan" id="kobo.778.1"> file, or any </span><strong class="source-inline"><span class="koboSpan" id="kobo.779.1">.http</span></strong><span class="koboSpan" id="kobo.780.1"> file. </span><span class="koboSpan" id="kobo.780.2">Click the environment dropdown shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.781.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.782.1">.21</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.783.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer292">
<span class="koboSpan" id="kobo.784.1"><img alt="Figure 9.21: You can select an environment for running your tests each with it’s own configuration variables" src="image/B19644_09_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.785.1">Figure 9.21: You can select an environment for running your tests each with it’s own configuration variables</span></p>
<p><span class="koboSpan" id="kobo.786.1">I’ll be honest. </span><span class="koboSpan" id="kobo.786.2">I worked ahead and set one up, but we’ll pretend I didn’t. </span><span class="koboSpan" id="kobo.786.3">Right now, your only option is </span><strong class="bold"><span class="koboSpan" id="kobo.787.1">No Environment</span></strong><span class="koboSpan" id="kobo.788.1">. </span><span class="koboSpan" id="kobo.788.2">How boring! </span><span class="koboSpan" id="kobo.788.3">Check out the two options at the bottom and click </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">Add Environment to Public File</span></strong><span class="koboSpan" id="kobo.790.1">. </span><span class="koboSpan" id="kobo.790.2">You’ll find PyCharm adds a new file to your project called </span><strong class="source-inline"><span class="koboSpan" id="kobo.791.1">http-client.env.json</span></strong><span class="koboSpan" id="kobo.792.1">. </span><span class="koboSpan" id="kobo.792.2">You can see mine in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.793.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.794.1">.22</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.795.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer293">
<span class="koboSpan" id="kobo.796.1"><img alt="Figure 9.22: PyCharm created http-client.env.json, which will allow me to set up different environments for testing" src="image/B19644_09_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.797.1">Figure 9.22: PyCharm created http-client.env.json, which will allow me to set up different environments for testing</span></p>
<p><span class="koboSpan" id="kobo.798.1">If you had chosen the </span><strong class="bold"><span class="koboSpan" id="kobo.799.1">Private file</span></strong><span class="koboSpan" id="kobo.800.1"> option, you’d have gotten </span><strong class="source-inline"><span class="koboSpan" id="kobo.801.1">http-client-private.env.json</span></strong><span class="koboSpan" id="kobo.802.1">. </span><span class="koboSpan" id="kobo.802.2">The purpose of and difference between the two files isn’t in the documentation as I write this, so</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.803.1"> we’ll have to use our imaginations. </span><span class="koboSpan" id="kobo.803.2">Personally, I put environments I want to share with my development team in the public file. </span><span class="koboSpan" id="kobo.803.3">If I want to create some sort of private environment, maybe a virtual machine, Windows Subsystem for Linux, custom experiments in Docker, or maybe a Kubernetes cluster in a lab, I can use the private file, which I would likely put in my </span><strong class="source-inline"><span class="koboSpan" id="kobo.804.1">.gitignore</span></strong><span class="koboSpan" id="kobo.805.1"> file. </span><span class="koboSpan" id="kobo.805.2">Since the file contents are the same, I’ll focus on the </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">public file.</span></span></p>
<p><span class="koboSpan" id="kobo.807.1">I’m going to add a definition for my local computer. </span><span class="koboSpan" id="kobo.807.2">Change the contents of </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">http-client.env.json</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.809.1">to this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.810.1">
{
 "dev": {
  "protocol": "http://",
  "base_url": "localhost",
  "port": 8000,
  "api_version": "v1"
}</span></pre> <p><span class="koboSpan" id="kobo.811.1">We now have a dev environment set up with some environment variables. </span><span class="koboSpan" id="kobo.811.2">Let’s use them in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">test_main.http</span></strong><span class="koboSpan" id="kobo.813.1"> file. </span><span class="koboSpan" id="kobo.813.2">Your first endpoint definition looks </span><span class="No-Break"><span class="koboSpan" id="kobo.814.1">like this:</span></span></p>
<p><span class="koboSpan" id="kobo.815.1">To use the environment variables, replace the parts of your URL with mustache-formatted text. </span><span class="koboSpan" id="kobo.815.2">Mustache format entails </span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.816.1">putting the variables you want to resolve in double curly braces like {{ </span><span class="No-Break"><span class="koboSpan" id="kobo.817.1">this }}:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.818.1">
GET {{protocol}}{{base_url}}:{{port}}</span></pre> <p><span class="koboSpan" id="kobo.819.1">Taken together, the URL will resolve to the original, which is </span><a href="http://localhost:8000"><span class="koboSpan" id="kobo.820.1">http://localhost:8000</span></a><span class="koboSpan" id="kobo.821.1">, or if you prefer, </span><a href="http://127.0.0.1:8000"><span class="koboSpan" id="kobo.822.1">http://127.0.0.1:8000</span></a><span class="koboSpan" id="kobo.823.1">. </span><span class="koboSpan" id="kobo.823.2">To</span><em class="italic"><span class="koboSpan" id="kobo.824.1">may</span></em><span class="koboSpan" id="kobo.825.1">to to</span><em class="italic"><span class="koboSpan" id="kobo.826.1">mah</span></em><span class="koboSpan" id="kobo.827.1">to. </span><span class="koboSpan" id="kobo.827.2">The difference is, now you can create your other environments in the same way. </span><span class="koboSpan" id="kobo.827.3">You can switch the environment and run the tests unchanged, and the environment variables will resolve your URLs </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">for you.</span></span></p>
<p><span class="koboSpan" id="kobo.829.1">If you review my code in this chapter’s sample code, you’ll find I’ve tricked out the whole file </span><span class="No-Break"><span class="koboSpan" id="kobo.830.1">this way.</span></span></p>
<h1 id="_idParaDest-230"><a id="_idTextAnchor234"/><span class="koboSpan" id="kobo.831.1">Let’s get CRUDdier and then get testier!</span></h1>
<p><span class="koboSpan" id="kobo.832.1">Right now, the only thing in our app is two pre-generated endpoints. </span><span class="koboSpan" id="kobo.832.2">Let’s add some more to make this a little more interesting. </span><span class="koboSpan" id="kobo.832.3">We’re going to make a fake list app as we did in </span><a href="B19644_08.xhtml#_idTextAnchor203"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.833.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.834.1">, </span><em class="italic"><span class="koboSpan" id="kobo.835.1">Building a Dynamic Web Application </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.836.1">with Flask</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.837.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.838.1">Open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.839.1">main.py</span></strong><span class="koboSpan" id="kobo.840.1"> and let’s add one endpoint for </span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.841.1">each CRUD operation, and in turn, each of the four main methods used in building RESTful APIs. </span><span class="koboSpan" id="kobo.841.2">We’re going to make some sweeping changes, so I’ll simply present them starting at the top of </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">the file.</span></span></p>
<p><span class="koboSpan" id="kobo.843.1">On the first line, where we have the import, change it </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">to this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.845.1">
from fastapi import FastAPI, status, HTTPException
app = FastAPI()</span></pre> <p><span class="koboSpan" id="kobo.846.1">The app instantiate was unchanged. </span><span class="koboSpan" id="kobo.846.2">Below it, though, add this list of </span><span class="No-Break"><span class="koboSpan" id="kobo.847.1">amazing people:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.848.1">
names = ["Bruce", "Karina", "Kitty", "Phoebe"]</span></pre> <p><span class="koboSpan" id="kobo.849.1">This list will serve as a fake database, saving us the time of setting up servers and the blah blah blah, which would seriously bloat the book and not contribute to our soon-to-be champion-level PyCharm</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.850.1"> prowess. </span><span class="koboSpan" id="kobo.850.2">We’re going to leave the first two generated endpoints alone, so just start your editing below the </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">say_hello</span></strong><span class="koboSpan" id="kobo.852.1"> function’s return. </span><span class="koboSpan" id="kobo.852.2">Our first CRUD endpoint is going to give us a list of names as if from a </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">database query:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.854.1">
@app.get("/api/v1/names")
async def get_names():
  return [{"id": idx, "name": name} for idx, name in enumerate(names)]</span></pre> <p><span class="koboSpan" id="kobo.855.1">It is best practice to start the endpoints in your project, which are expected to return JSON data, rather than markup, with a prefix of </span><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">API</span></strong><span class="koboSpan" id="kobo.857.1"> followed by a version designation. </span><span class="koboSpan" id="kobo.857.2">Trust me when I say that you want to do this. </span><span class="koboSpan" id="kobo.857.3">As your API code matures, you may want to offer updated endpoints that may not necessarily be backward compatible, and this technique allows you to keep your API backward compatible and non-breaking with your older clients while introducing improved functionality for newer clients. </span><span class="koboSpan" id="kobo.857.4">As the code matures further, you can remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">v1</span></strong><span class="koboSpan" id="kobo.859.1"> endpoints at a time of </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1">your choosing:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.861.1">
@app.post("/api/v1/names", status_code=status.HTTP_201_CREATED)
async def create_name(name: dict):
  new_name = name["name"]
  names.append(new_name)
  return {"message": "Name added successfully"}</span></pre> <p><span class="koboSpan" id="kobo.862.1">On the preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.863.1">POST</span></strong><span class="koboSpan" id="kobo.864.1"> endpoint, it is a best practice for the successful call to return an HTTP status code of </span><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">201</span></strong><span class="koboSpan" id="kobo.866.1"> indicating new data was created by the API. </span><span class="koboSpan" id="kobo.866.2">The FastAPI code works very differently from Flask. </span><span class="koboSpan" id="kobo.866.3">Instead </span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.867.1">of discrete request and response objects, everything is implicit. </span><span class="koboSpan" id="kobo.867.2">If you are expecting JSON to be posted as a payload to your API, you need only specify this using an argument type of </span><strong class="source-inline"><span class="koboSpan" id="kobo.868.1">dict</span></strong><span class="koboSpan" id="kobo.869.1">. </span><span class="koboSpan" id="kobo.869.2">In this case, I am expecting data to be posted in </span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">this format:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.871.1">
{"name": "Igor"}</span></pre> <p><span class="koboSpan" id="kobo.872.1">A real app would have a richer structure. </span><span class="koboSpan" id="kobo.872.2">We’re keeping it simple. </span><span class="koboSpan" id="kobo.872.3">When this JSON comes in as the payload for </span><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">POST</span></strong><span class="koboSpan" id="kobo.874.1">, we extract the name and append it to our list. </span><span class="koboSpan" id="kobo.874.2">For the sake of simplicity, I am not doing any validation on this endpoint. </span><span class="koboSpan" id="kobo.874.3">You should always validate your incoming data to protect yourself against toxic data and injection attacks. </span><span class="koboSpan" id="kobo.874.4">That’s the subject of another book. </span><span class="koboSpan" id="kobo.874.5">With that said, I won’t be a total slouch. </span><span class="koboSpan" id="kobo.874.6">I’ll do a little bit of this in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.875.1">PUT</span></strong><span class="koboSpan" id="kobo.876.1"> endpoint, so you can see what some of this would look like. </span><span class="koboSpan" id="kobo.876.2">Remember, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.877.1">PUT</span></strong><span class="koboSpan" id="kobo.878.1"> call is an </span><strong class="source-inline"><span class="koboSpan" id="kobo.879.1">UPDATE</span></strong><span class="koboSpan" id="kobo.880.1"> operation. </span><span class="koboSpan" id="kobo.880.2">We’re taking an </span><strong class="source-inline"><span class="koboSpan" id="kobo.881.1">id</span></strong><span class="koboSpan" id="kobo.882.1"> value and a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">name</span></strong><span class="koboSpan" id="kobo.884.1"> value and we’ll change the existing value accordingly. </span><span class="koboSpan" id="kobo.884.2">Add these lines below your </span><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">create_name</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.886.1">function return:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.887.1">
@app.put("/api/v1/names")
async def update_name(update_data: dict):
  id = update_data["id"]</span></pre> <p><span class="koboSpan" id="kobo.888.1">Now back to the code. </span><span class="koboSpan" id="kobo.888.2">Let’s make sure the ID attribute submitted is a number, specifically </span><span class="No-Break"><span class="koboSpan" id="kobo.889.1">an integer:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.890.1">
  if not isinstance(id, int):
    raise HTTPException(status_code=400, detail="ID must be an integer")</span></pre> <p><span class="koboSpan" id="kobo.891.1">What’s happening here? </span><span class="koboSpan" id="kobo.891.2">If you submit an ID attribute that doesn’t resolve to a number, I’m going to send you back an HTTP error status code of </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">400</span></strong><span class="koboSpan" id="kobo.893.1">, which means your request is malformed. </span><span class="koboSpan" id="kobo.893.2">Just to be nice, I’m going to add a little message telling you what you did wrong. </span><span class="koboSpan" id="kobo.893.3">For example, say you use </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">PUT</span></strong><span class="koboSpan" id="kobo.895.1"> on this data </span><span class="No-Break"><span class="koboSpan" id="kobo.896.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.897.1">
{ "id": "2", "name": "Igor" }</span></pre> <p><span class="koboSpan" id="kobo.898.1">Everything should work. </span><span class="koboSpan" id="kobo.898.2">But say you use </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">PUT</span></strong><span class="koboSpan" id="kobo.900.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.902.1">
{ "id": "this isn't a number", "name": "Igor" }</span></pre> <p><span class="koboSpan" id="kobo.903.1">Your request will fail. </span><span class="koboSpan" id="kobo.903.2">Raising the HTTP extension will cause the response to be sent immediately, and the rest of this code isn’t executed. </span><span class="koboSpan" id="kobo.903.3">So, let’s continue. </span><span class="koboSpan" id="kobo.903.4">If you submitted good data, we can move on and grab the </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">new name:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.905.1">
  name = update_data["name"]</span></pre> <p><span class="koboSpan" id="kobo.906.1">Next, we detect whether the numeric ID you submitted isn’t out of range. </span><span class="koboSpan" id="kobo.906.2">Our list starts off with four names in it. </span><span class="koboSpan" id="kobo.906.3">If you try to send an update to </span><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">id</span></strong><span class="koboSpan" id="kobo.908.1"> 600, that shouldn’t work unless you’ve added at least as</span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.909.1"> many names to the list via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">POST</span></strong><span class="koboSpan" id="kobo.911.1"> endpoint. </span><span class="koboSpan" id="kobo.911.2">In a </span><strong class="source-inline"><span class="koboSpan" id="kobo.912.1">PUT</span></strong><span class="koboSpan" id="kobo.913.1">, if you present an invalid </span><strong class="source-inline"><span class="koboSpan" id="kobo.914.1">id</span></strong><span class="koboSpan" id="kobo.915.1"> value, it is customary to send back a </span><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">404</span></strong><span class="koboSpan" id="kobo.917.1"> error stating you couldn’t find that ID in your database (or list in </span><span class="No-Break"><span class="koboSpan" id="kobo.918.1">our case):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.919.1">
  if id &gt;= len(names):
    raise HTTPException(status_code=404, detail="Name not found")
  names[id] = name
  return {"message": "Name updated successfully"}</span></pre> <p><span class="koboSpan" id="kobo.920.1">That’s three down and only one to go. </span><span class="koboSpan" id="kobo.920.2">For the </span><strong class="source-inline"><span class="koboSpan" id="kobo.921.1">DELETE</span></strong><span class="koboSpan" id="kobo.922.1"> endpoint, all I need is </span><strong class="source-inline"><span class="koboSpan" id="kobo.923.1">id</span></strong><span class="koboSpan" id="kobo.924.1">. </span><span class="koboSpan" id="kobo.924.2">Sending a JSON payload for something this simple would be silly, so I’ll just take the ID as a parameter on the endpoint URL. </span><span class="koboSpan" id="kobo.924.3">I still need to check to make sure it is within range of the length of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.925.1">names</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.926.1"> list:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.927.1">
@app.delete("/api/v1/names/{id}")
async def delete_name(id: int):
  if id &gt;= len(names):
    raise HTTPException(status_code=404, detail="Name not found")</span></pre> <p><span class="koboSpan" id="kobo.928.1">If it is, then I’ll just pop it out of the list and return a </span><span class="No-Break"><span class="koboSpan" id="kobo.929.1">nice message:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.930.1">
  deleted_name = names.pop(id)
  return {"message": f"Deleted name: {deleted_name}"}</span></pre> <p><span class="koboSpan" id="kobo.931.1">Run the app and make sure it starts. </span><span class="koboSpan" id="kobo.931.2">Make</span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.932.1"> any adjustments needed. </span><span class="koboSpan" id="kobo.932.2">Remember, the final working code is in the chapter’s sample code from the repository we checked out in </span><a href="B19644_02.xhtml#_idTextAnchor028"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.933.1">Chapter 2</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.934.1">.</span></span></p>
<h2 id="_idParaDest-231"><a id="_idTextAnchor235"/><span class="koboSpan" id="kobo.935.1">Getting testier</span></h2>
<p><span class="koboSpan" id="kobo.936.1">If I were all cruddy, chances are I’d be pretty testy, right? </span><span class="koboSpan" id="kobo.936.2">Now that we have more varied endpoints, let’s learn more about</span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.937.1"> testing them with HTTP clients. </span><span class="koboSpan" id="kobo.937.2">As it turns out, the tool is extremely rich, as rich as dedicated tools such as Insomnia or Postman, just without all that UI in </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">the way.</span></span></p>
<p><span class="koboSpan" id="kobo.939.1">Open your </span><strong class="source-inline"><span class="koboSpan" id="kobo.940.1">test_main.http</span></strong><span class="koboSpan" id="kobo.941.1"> file and let us add tests. </span><span class="koboSpan" id="kobo.941.2">Not just simple ones, let’s make some real ones and get a feel for how the PyCharm workflow helps you build </span><span class="No-Break"><span class="koboSpan" id="kobo.942.1">RESTful APIs.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.943.1">These testing features of PyCharm work with any framework</span></p>
<p class="callout"><span class="koboSpan" id="kobo.944.1">I should mention that while we’re using FastAPI, these features are not unique or tied to that framework. </span><span class="koboSpan" id="kobo.944.2">These tools would work the same if you developed your API in Flask, or even in some </span><span class="No-Break"><span class="koboSpan" id="kobo.945.1">other framework.</span></span></p>
<p><span class="koboSpan" id="kobo.946.1">So far, you just have two tests, which were generated when you created </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1">your project:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.948.1">
# Test your FastAPI endpoints
GET {{protocol}}{{base_url}}:{{port}}
Accept: application/json
###
GET {{protocol}}{{base_url}}:{{port}}/hello/User
Accept: application/json</span></pre> <p><span class="koboSpan" id="kobo.949.1">I didn’t specifically tell you to modify the second test endpoint with the environment variables we made earlier, but I went ahead and did it since that seems like an obvious improvement. </span><span class="koboSpan" id="kobo.949.2">As you add code to the test file, there are a few things </span><span class="No-Break"><span class="koboSpan" id="kobo.950.1">worth noting:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.951.1">Requests may be stored in files with either </span><strong class="source-inline"><span class="koboSpan" id="kobo.952.1">.http</span></strong><span class="koboSpan" id="kobo.953.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.954.1">.rest</span></strong><span class="koboSpan" id="kobo.955.1"> extensions. </span><span class="koboSpan" id="kobo.955.2">So far, we’ve worked with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.956.1">.http</span></strong><span class="koboSpan" id="kobo.957.1"> file that was generated with the project. </span><span class="koboSpan" id="kobo.957.2">In the wild, you may see either extension and there is no fundamental difference between them</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.958.1"> other than the icons displayed in the IDE. </span><span class="koboSpan" id="kobo.958.2">This is </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">purely cosmetic.</span></span></li>
<li><span class="koboSpan" id="kobo.960.1">Code highlighting and syntax completion are active. </span><span class="koboSpan" id="kobo.960.2">The syntax of these files is specialized, but you can expect the same level of tooling here as you would </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">anywhere else.</span></span></li>
<li><span class="koboSpan" id="kobo.962.1">Inline documentation will also appear for the code in </span><span class="No-Break"><span class="koboSpan" id="kobo.963.1">this file.</span></span></li>
<li><span class="koboSpan" id="kobo.964.1">Requests must be separated by three hashtag/pound signs: </span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">###</span></strong><span class="koboSpan" id="kobo.966.1">. </span><span class="koboSpan" id="kobo.966.2">If you fail to add these, the IDE will let you know with a sea of red </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">squiggly lines.</span></span></li>
<li><span class="koboSpan" id="kobo.968.1">You can paste a command-line cURL command into this file, and it will automatically convert it to the syntax used </span><span class="No-Break"><span class="koboSpan" id="kobo.969.1">by PyCharm.</span></span></li>
<li><span class="koboSpan" id="kobo.970.1">Templating is supported. </span><span class="koboSpan" id="kobo.970.2">We’ve already seen the environment variable substitution at work. </span><span class="koboSpan" id="kobo.970.3">Stay tuned, it’s about to </span><span class="No-Break"><span class="koboSpan" id="kobo.971.1">get amazing!</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.972.1">The test editor has a little bit of UI to it, but to be honest, once you learn the syntax, you probably won’t use it. </span><span class="koboSpan" id="kobo.972.2">Let me show you. </span><span class="koboSpan" id="kobo.972.3">Refer to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.973.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.974.1">.23</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.975.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer294">
<span class="koboSpan" id="kobo.976.1"><img alt="Figure 9.23: The test editor has a minimal UI" src="image/B19644_09_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.977.1">Figure 9.23: The test editor has a minimal UI</span></p>
<p><span class="koboSpan" id="kobo.978.1">Let’s look at </span><span class="No-Break"><span class="koboSpan" id="kobo.979.1">the numbers:</span></span></p>
<p><span class="koboSpan" id="kobo.980.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.981.1">+</span></strong><span class="koboSpan" id="kobo.982.1"> icon at </span><strong class="bold"><span class="koboSpan" id="kobo.983.1">(1)</span></strong><span class="koboSpan" id="kobo.984.1"> allows you to add another test. </span><span class="koboSpan" id="kobo.984.2">To be honest, this is easier to do directly in the editor, but if you like clicking things, here’s </span><span class="No-Break"><span class="koboSpan" id="kobo.985.1">your jam.</span></span></p>
<p><span class="koboSpan" id="kobo.986.1">The clock icon </span><strong class="bold"><span class="koboSpan" id="kobo.987.1">(2)</span></strong><span class="koboSpan" id="kobo.988.1"> is actually very useful. </span><span class="koboSpan" id="kobo.988.2">It opens up the request history log, which contains the last 50 requests you’ve made. </span><span class="koboSpan" id="kobo.988.3">This opens as a normal project file would, and you’ll find the file in the location we visited earlier in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.989.1">httpRequests</span></strong><span class="koboSpan" id="kobo.990.1"> folder inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.991.1">.idea</span></strong><span class="koboSpan" id="kobo.992.1"> project folder. </span><span class="koboSpan" id="kobo.992.2">Since PyCharm automatically reloads files when they change, leaving this file open </span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.993.1">allows you to see everything that is happening without having to look at the individual response files. </span><span class="koboSpan" id="kobo.993.2">Earlier, we added automation to remove many of these response files since there are often so many of them. </span><span class="koboSpan" id="kobo.993.3">This doesn’t affect the log file since the request information is appended from the log window instead of the response file itself. </span><span class="koboSpan" id="kobo.993.4">In fact, the log shows the response </span><span class="No-Break"><span class="koboSpan" id="kobo.994.1">data too.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.995.1">Pro tip – open the log in a split view so you can always see it</span></p>
<p class="callout"><span class="koboSpan" id="kobo.996.1">If you right-click the tab containing the log file and select one of the split options, such as </span><strong class="bold"><span class="koboSpan" id="kobo.997.1">Split Right</span></strong><span class="koboSpan" id="kobo.998.1">, the tab will open in a separate tab group. </span><span class="koboSpan" id="kobo.998.2">If you have a nice wide 4K monitor, you have plenty of room to keep the log open alongside your code and test files so you can see it </span><span class="No-Break"><span class="koboSpan" id="kobo.999.1">all together.</span></span></p>
<p><span class="koboSpan" id="kobo.1000.1">The document icon at </span><strong class="bold"><span class="koboSpan" id="kobo.1001.1">(3)</span></strong><span class="koboSpan" id="kobo.1002.1"> is there to make command-line mavens happy. </span><span class="koboSpan" id="kobo.1002.2">If you select a request and click this button, you are able to generate a cURL command, which can then be pasted into a terminal window. </span><span class="koboSpan" id="kobo.1002.3">The import icon at </span><strong class="bold"><span class="koboSpan" id="kobo.1003.1">(4) </span></strong><span class="koboSpan" id="kobo.1004.1">gives you a UI where you can paste a cURL command whereupon it will be converted to the request format used by PyCharm. </span><span class="koboSpan" id="kobo.1004.2">This isn’t all that useful since you can paste a cURL command directly into the editor itself and the conversion </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">happens automatically.</span></span></p>
<p><span class="koboSpan" id="kobo.1006.1">We’ve already seen the </span><strong class="bold"><span class="koboSpan" id="kobo.1007.1">Run All Tests</span></strong><span class="koboSpan" id="kobo.1008.1"> button at </span><strong class="bold"><span class="koboSpan" id="kobo.1009.1">(5)</span></strong><span class="koboSpan" id="kobo.1010.1">, as well as the environment selection dropdown. </span><span class="koboSpan" id="kobo.1010.2">Probably, the most useful item on this toolbar, apart from the history log, is the link to the examples at </span><strong class="bold"><span class="koboSpan" id="kobo.1011.1">(6)</span></strong><span class="koboSpan" id="kobo.1012.1">. </span><span class="koboSpan" id="kobo.1012.2">This is not fancy, but it is useful. </span><span class="koboSpan" id="kobo.1012.3">Clicking this link will open a file that contains a slew of examples that you can copy, paste, and modify. </span><span class="koboSpan" id="kobo.1012.4">Essentially, this is the same thing that happens when you click the UI button at position </span><strong class="bold"><span class="koboSpan" id="kobo.1013.1">(1)</span></strong><span class="koboSpan" id="kobo.1014.1">. </span><span class="koboSpan" id="kobo.1014.2">To me, opening the samples is faster and easier because you can see them all in one place. </span><span class="koboSpan" id="kobo.1014.3">To use it, just click the </span><strong class="bold"><span class="koboSpan" id="kobo.1015.1">*Examples</span></strong><span class="koboSpan" id="kobo.1016.1"> link as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1017.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1018.1">.24</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer295">
<span class="koboSpan" id="kobo.1020.1"><img alt="Figure 9.24: The test examples are broken out by category" src="image/B19644_09_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1021.1">Figure 9.24: The test examples are broken out by category</span></p>
<p><span class="koboSpan" id="kobo.1022.1">I like to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1023.1">POST</span></strong><span class="koboSpan" id="kobo.1024.1"> requests sample</span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.1025.1"> open to the side, as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1026.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1027.1">.25</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1028.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer296">
<span class="koboSpan" id="kobo.1029.1"><img alt="Figure 9.25: You can open the samples to the side for easy pasting" src="image/B19644_09_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1030.1">Figure 9.25: You can open the samples to the side for easy pasting</span></p>
<p><span class="koboSpan" id="kobo.1031.1">To split the files like this, just</span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.1032.1"> right-click the tab and click </span><strong class="bold"><span class="koboSpan" id="kobo.1033.1">Split Right</span></strong><span class="koboSpan" id="kobo.1034.1">, or left, up, or down according to </span><span class="No-Break"><span class="koboSpan" id="kobo.1035.1">your preferences.</span></span></p>
<h2 id="_idParaDest-232"><a id="_idTextAnchor236"/><span class="koboSpan" id="kobo.1036.1">Creating the tests</span></h2>
<p><span class="koboSpan" id="kobo.1037.1">Let’s create those tests! </span><span class="koboSpan" id="kobo.1037.2">Make </span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.1038.1">sure you are working in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1">test_main.http</span></strong><span class="koboSpan" id="kobo.1040.1">. </span><span class="koboSpan" id="kobo.1040.2">Add these lines below your </span><span class="No-Break"><span class="koboSpan" id="kobo.1041.1">last test:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1042.1">
###
GET {{protocol}}{{base_url}}:{{port}}/api/{{api_version}}/names</span></pre> <p><span class="koboSpan" id="kobo.1043.1">The three hashtags are the separator between tests. </span><span class="koboSpan" id="kobo.1043.2">The rest are variables coming from the environment variables we created earlier. </span><span class="koboSpan" id="kobo.1043.3">This will translate to http://localhost:8000/api/v1/names. </span><span class="koboSpan" id="kobo.1043.4">Make sure your app is running and run the test. </span><span class="koboSpan" id="kobo.1043.5">You should see some results like those in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1044.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1045.1">.26</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1046.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer297">
<span class="koboSpan" id="kobo.1047.1"><img alt="Figure 9.26: When you run the test, you can see the response data in the log view. The left side of my results will normally look different than yours" src="image/B19644_09_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1048.1">Figure 9.26: When you run the test, you can see the response data in the log view. </span><span class="koboSpan" id="kobo.1048.2">The left side of my results will normally look different than yours</span></p>
<p><span class="koboSpan" id="kobo.1049.1">This is nice, right? </span><span class="koboSpan" id="kobo.1049.2">You can see you </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.1050.1">got back a good status code (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1">200</span></strong><span class="koboSpan" id="kobo.1052.1">), and you can see your data. </span><span class="koboSpan" id="kobo.1052.2">What if you could turn this into a proper test? </span><span class="koboSpan" id="kobo.1052.3">You can! </span><span class="koboSpan" id="kobo.1052.4">Go back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1053.1">test_main.http</span></strong><span class="koboSpan" id="kobo.1054.1"> file. </span><span class="koboSpan" id="kobo.1054.2">Every great moment in American, and perhaps world, history was preceded by the phrase I will utter next: </span><em class="italic"><span class="koboSpan" id="kobo.1055.1">Hold my beer and </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1056.1">watch this</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1058.1">Right below your test, add </span><span class="No-Break"><span class="koboSpan" id="kobo.1059.1">this code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1060.1">
&gt; {%
 client.test("Request executed and 200 returned", function() {
   client.assert(response.status === 200, `Response status is ${response.status} but should be 200`);
 });</span></pre> <p><span class="koboSpan" id="kobo.1061.1">The first character is crucial. </span><span class="koboSpan" id="kobo.1061.2">You have to type a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1062.1">&gt;</span></strong><span class="koboSpan" id="kobo.1063.1"> followed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1064.1">{%</span></strong><span class="koboSpan" id="kobo.1065.1">. </span><span class="koboSpan" id="kobo.1065.2">If you don’t, PyCharm will become quite cross! </span><span class="koboSpan" id="kobo.1065.3">Just stare at the majesty for a moment. </span><span class="koboSpan" id="kobo.1065.4">Take it all in. </span><span class="koboSpan" id="kobo.1065.5">What we have here is a test. </span><span class="koboSpan" id="kobo.1065.6">WRITTEN IN JAVASCRIPT! </span><span class="koboSpan" id="kobo.1065.7">I’m sorry. </span><span class="koboSpan" id="kobo.1065.8">I should have warned you to sit down or something. </span><span class="koboSpan" id="kobo.1065.9">I did, however, mention that beer was involved. </span><span class="koboSpan" id="kobo.1065.10">There is some magic here. </span><span class="koboSpan" id="kobo.1065.11">There is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">client</span></strong><span class="koboSpan" id="kobo.1067.1"> object inherent in this test window, not unlike the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1068.1">window</span></strong><span class="koboSpan" id="kobo.1069.1"> object that is ever-present in a browser window. </span><span class="koboSpan" id="kobo.1069.2">We’re invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1">.test</span></strong><span class="koboSpan" id="kobo.1071.1"> method on that client object and we’re passing it two arguments. </span><span class="koboSpan" id="kobo.1071.2">The first is a string that describes the test. </span><span class="koboSpan" id="kobo.1071.3">This can be anything you’d like. </span><span class="koboSpan" id="kobo.1071.4">The contents do not affect the test in any way. </span><span class="koboSpan" id="kobo.1071.5">The second argument is an anonymous function that actually executes the test. </span><span class="koboSpan" id="kobo.1071.6">If you’re not up on JavaScript’s use of lambda-style functions, you’re just going to have to roll with it and copy these tests from examples. </span><span class="koboSpan" id="kobo.1071.7">I suppose you could also go learn JavaScript, but that might take a while. </span><span class="koboSpan" id="kobo.1071.8">Thankfully, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1072.1">client.assert</span></strong><span class="koboSpan" id="kobo.1073.1"> part seems like the tests we wrote in </span><a href="B19644_06.xhtml#_idTextAnchor145"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1074.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.1075.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1076.1">Seamless Testing, Debugging, and Profiling</span></em><span class="koboSpan" id="kobo.1077.1">, so let’s keep going. </span><span class="koboSpan" id="kobo.1077.2">The assert takes an expression that will evaluate to true or false. </span><span class="koboSpan" id="kobo.1077.3">JavaScript uses a triple equals sign for testing equality without coercion. </span><span class="koboSpan" id="kobo.1077.4">If you have not heard of this, for now, just know you should always be using three equals signs because using two means something else and you don’t want that. </span><span class="koboSpan" id="kobo.1077.5">A double equals sign, which is the norm in Python, might yield a false failure in your JavaScript test code because JavaScript will attempt to force any data types it encounters to match. </span><span class="koboSpan" id="kobo.1077.6">The triple equals </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">avoid this.</span></span></p>
<p><span class="koboSpan" id="kobo.1079.1">After the conditional statement, we have</span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.1080.1"> a JavaScript template literal. </span><span class="koboSpan" id="kobo.1080.2">This is the equivalent of a Python </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">f</span></strong><span class="koboSpan" id="kobo.1082.1">-string. </span><span class="koboSpan" id="kobo.1082.2">You use the gravure marks for quotes. </span><span class="koboSpan" id="kobo.1082.3">The gravure mark is the shifted tilde (~) on a US keyboard, and it looks like a heavy single quote: `. </span><span class="koboSpan" id="kobo.1082.4">Enclosing a string within the gravure marks specifies the string to be a template literal. </span><span class="koboSpan" id="kobo.1082.5">You can substitute expressions or variable values using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1083.1">${whever}</span></strong><span class="koboSpan" id="kobo.1084.1"> in the curly braces. </span><span class="koboSpan" id="kobo.1084.2">So, in Python, given the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1085.1">foo = bar variable</span></strong><span class="koboSpan" id="kobo.1086.1">, an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">f</span></strong><span class="koboSpan" id="kobo.1088.1">-string would be </span><span class="No-Break"><span class="koboSpan" id="kobo.1089.1">as follows:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1090.1">f"I'd rather be at </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">the {foo}."</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1092.1">In JavaScript, given </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1">const foo = "bar"</span></strong><span class="koboSpan" id="kobo.1094.1">, it would be </span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1">as follows:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1096.1">`I'd rather be at </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1">the ${foo}`</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1098.1">Here, I’ve used the template literal to give a little more information since this second string literally exposes a message seen when the </span><span class="No-Break"><span class="koboSpan" id="kobo.1099.1">test fails.</span></span></p>
<p><span class="koboSpan" id="kobo.1100.1">This particular test checks to make sure that the HTTP response code for the request was </span><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1">200</span></strong><span class="koboSpan" id="kobo.1102.1">, which indicates it was successful. </span><span class="koboSpan" id="kobo.1102.2">If you don’t include a test like this, then your results will always be green even if your endpoint code melted the server and summoned the great Cthulu from his deep slumber at the heart of the cosmos. </span><span class="koboSpan" id="kobo.1102.3">This is a test that should be included every single time, though the expected code might change depending on what </span><span class="No-Break"><span class="koboSpan" id="kobo.1103.1">you’re doing.</span></span></p>
<h3><span class="koboSpan" id="kobo.1104.1">More tests you should always add</span></h3>
<p><span class="koboSpan" id="kobo.1105.1">Checking your status code is the </span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.1106.1">bare minimum. </span><span class="koboSpan" id="kobo.1106.2">I assert (see what I did there?) that you should check as many things as you can think of. </span><span class="koboSpan" id="kobo.1106.3">Here, I’ll add a test to verify the returned data has a mime type of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">application/json</span></strong><span class="koboSpan" id="kobo.1108.1">, which is important to the way clients will consume this data. </span><span class="koboSpan" id="kobo.1108.2">Add this below our </span><span class="No-Break"><span class="koboSpan" id="kobo.1109.1">earlier test:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1110.1">
 client.test("Response should be json", function() {
   const type = response.contentType.mimeType;
   client.assert(type === "application/json", `Expected application/json
   but got ${type}`);
 });
 %}</span></pre> <p><span class="koboSpan" id="kobo.1111.1">Remember, it’s JavaScript! </span><span class="koboSpan" id="kobo.1111.2">So here, I’ve added a constant called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">type</span></strong><span class="koboSpan" id="kobo.1113.1"> and pulled the value from another magical object available in the test window. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1114.1">response.contentType.mimeType</span></strong><span class="koboSpan" id="kobo.1115.1"> gives you exactly that. </span><span class="koboSpan" id="kobo.1115.2">We test to make sure it is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">"application/json"</span></strong><span class="koboSpan" id="kobo.1117.1">. </span><span class="koboSpan" id="kobo.1117.2">Personally, I think attention to detail is important, and I see APIs created by professionals as being very unprofessional if the content type isn’t set correctly. </span><span class="koboSpan" id="kobo.1117.3">As it happens, FastAPI does this for us, but not every </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">framework will.</span></span></p>
<p><span class="koboSpan" id="kobo.1119.1">Now that you have the basics down, I invite you to explore my finished </span><strong class="source-inline"><span class="koboSpan" id="kobo.1120.1">test_main.http</span></strong><span class="koboSpan" id="kobo.1121.1"> file in the chapter’s sample code. </span><span class="koboSpan" id="kobo.1121.2">There are tests there for all the conditions we put into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1122.1">PUT</span></strong><span class="koboSpan" id="kobo.1123.1"> endpoint allowing you to make sure the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1124.1">400</span></strong><span class="koboSpan" id="kobo.1125.1"> status is returned if your user sends a non-numeric ID. </span><span class="koboSpan" id="kobo.1125.2">There is also a test to make sure you get a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1126.1">404</span></strong><span class="koboSpan" id="kobo.1127.1"> error if your ID is beyond the acceptable range for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1128.1">names</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1129.1"> list.</span></span></p>
<h1 id="_idParaDest-233"><a id="_idTextAnchor237"/><span class="koboSpan" id="kobo.1130.1">Editing and debugging a full stack app by attaching projects</span></h1>
<p><span class="koboSpan" id="kobo.1131.1">PyCharm has the ability to attach multiple projects together allowing you to work on full stack applications in the same instance of the IDE. </span><span class="koboSpan" id="kobo.1131.2">When you are running multiple attached projects in your </span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.1132.1">PyCharm IDE, you can debug them together in a seamless fashion! </span><span class="koboSpan" id="kobo.1132.2">This capability alone is probably reason enough to stop using vim or VS Code and never look back! </span><span class="koboSpan" id="kobo.1132.3">While it is possible to do this in other IDEs or even VS Code, PyCharm makes it so easy you’ll probably not </span><span class="No-Break"><span class="koboSpan" id="kobo.1133.1">want to.</span></span></p>
<h2 id="_idParaDest-234"><a id="_idTextAnchor238"/><span class="koboSpan" id="kobo.1134.1">Creating a React app in a separate project</span></h2>
<p><span class="koboSpan" id="kobo.1135.1">To create a frontend for</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.1136.1"> our FastAPI backend, we’re going to leverage React. </span><span class="koboSpan" id="kobo.1136.2">As usual, I won’t have the space here to teach you a lot about React. </span><span class="koboSpan" id="kobo.1136.3">I’ll make sure there is some reference reading in the </span><em class="italic"><span class="koboSpan" id="kobo.1137.1">Further reading</span></em><span class="koboSpan" id="kobo.1138.1"> section at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.1139.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.1140.1">To create a React app in PyCharm Professional, just use the usual </span><strong class="bold"><span class="koboSpan" id="kobo.1141.1">File | Project</span></strong><span class="koboSpan" id="kobo.1142.1"> operation to which you have hopefully become accustomed. </span><span class="koboSpan" id="kobo.1142.2">There is a project template that leverages an open source</span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.1143.1"> product called </span><strong class="bold"><span class="koboSpan" id="kobo.1144.1">create-react-app </span></strong><span class="koboSpan" id="kobo.1145.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.1146.1">CRA</span></strong><span class="koboSpan" id="kobo.1147.1">). </span><span class="koboSpan" id="kobo.1147.2">This is a tool widely used by React developers because, in truth, setting up a full-on React app from scratch is tedious </span><span class="No-Break"><span class="koboSpan" id="kobo.1148.1">and time-consuming.</span></span></p>
<p><span class="koboSpan" id="kobo.1149.1">In order for this </span><strong class="source-inline"><span class="koboSpan" id="kobo.1150.1">create-react-app</span></strong><span class="koboSpan" id="kobo.1151.1"> script to work, you need to have Node.js installed. </span><span class="koboSpan" id="kobo.1151.2">If you don’t, PyCharm will attempt to install it for you, as you can see in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1152.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1153.1">.27</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1154.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer298">
<span class="koboSpan" id="kobo.1155.1"><img alt="Figure 9.27: When creating a JavaScript project, such as a React project, you’ll need to have Node.js installed, otherwise PyCharm will try to install it for you" src="image/B19644_09_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1156.1">Figure 9.27: When creating a JavaScript project, such as a React project, you’ll need to have Node.js installed, otherwise PyCharm will try to install it for you</span></p>
<p><span class="koboSpan" id="kobo.1157.1">In my experience, this doesn’t always work out.  </span><span class="koboSpan" id="kobo.1157.2">This same feature exists in Visual Studio, and I usually advise my</span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.1158.1"> students to install Node.js manually, rather than have an IDE do it. </span><span class="koboSpan" id="kobo.1158.2">In general, the IDEs often don’t point to the latest release of Node.js. </span><span class="koboSpan" id="kobo.1158.3">I can see in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1159.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1160.1">.27</span></em><span class="koboSpan" id="kobo.1161.1"> that PyCharm intends to install 16.16.0, which isn’t the latest. </span><span class="koboSpan" id="kobo.1161.2">Besides, looking at the right version, I further recommend you</span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.1162.1"> use the latest </span><strong class="bold"><span class="koboSpan" id="kobo.1163.1">long-term support</span></strong><span class="koboSpan" id="kobo.1164.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1165.1">LTS</span></strong><span class="koboSpan" id="kobo.1166.1">) version of Node.js rather than the version with the highest version number. </span><span class="koboSpan" id="kobo.1166.2">The LTS product is guaranteed stable, whereas the absolute newest </span><span class="No-Break"><span class="koboSpan" id="kobo.1167.1">version isn’t.</span></span></p>
<p><span class="koboSpan" id="kobo.1168.1">Another thing I recommend with Node.js, and Python too, for that matter, is to use a package manager </span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.1169.1">such as </span><strong class="bold"><span class="koboSpan" id="kobo.1170.1">Chocolately</span></strong><span class="koboSpan" id="kobo.1171.1"> (</span><a href="https://chocolatey.org/"><span class="koboSpan" id="kobo.1172.1">https://chocolatey.org/</span></a><span class="koboSpan" id="kobo.1173.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.1174.1">Homebrew</span></strong><span class="koboSpan" id="kobo.1175.1"> (</span><a href="https://brew.sh/"><span class="koboSpan" id="kobo.1176.1">https://brew.sh/</span></a><span class="koboSpan" id="kobo.1177.1">). </span><span class="koboSpan" id="kobo.1177.2">Package managers are standard affairs on Linux, and every distribution uses</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.1178.1"> their own, so if you’re using Linux, I’ll assume you know which one you need. </span><span class="koboSpan" id="kobo.1178.2">The reason I advocate using package managers for installing Node.js is that the package manager makes it very easy to update, or even fully remove, your software should you ever need to. </span><span class="koboSpan" id="kobo.1178.3">If you want to try out Homebrew for Mac, there is a short, free course on my website that teaches you to set up an Apple computer for Node.js development. </span><span class="koboSpan" id="kobo.1178.4">You can find it at </span><a href="https://www.maddevskilz.com/courses/setting-up-a-nodejs-development-workstation-in-macos"><span class="koboSpan" id="kobo.1179.1">https://www.maddevskilz.com/courses/setting-up-a-nodejs-development-workstation-in-macos</span></a><span class="koboSpan" id="kobo.1180.1">. </span><span class="koboSpan" id="kobo.1180.2">I’ll look at making more of these after I finish writing this book, so check the site if you want to see the </span><span class="No-Break"><span class="koboSpan" id="kobo.1181.1">Windows version.</span></span></p>
<p><span class="koboSpan" id="kobo.1182.1">Having installed Node.js manually, let’s get back to creating our React project. </span><span class="koboSpan" id="kobo.1182.2">I called my project </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">namelist</span></strong><span class="koboSpan" id="kobo.1184.1">. </span><span class="koboSpan" id="kobo.1184.2">React is picky about names, so I picked one that I know will work. </span><span class="koboSpan" id="kobo.1184.3">I’ll leave fancier names to books about React. </span><span class="koboSpan" id="kobo.1184.4">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.1185.1">Create</span></strong><span class="koboSpan" id="kobo.1186.1"> button. </span><span class="koboSpan" id="kobo.1186.2">CRA takes a while, but once it is finished, </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.1187.1">you should have a project folder ready to go. </span><span class="koboSpan" id="kobo.1187.2">We are now ready to go 100% full stack! </span><span class="koboSpan" id="kobo.1187.3">Next, I’m going to show you my favorite technique in PyCharm to work on both projects as if they were one, while maintaining full separation of the UI code from </span><span class="No-Break"><span class="koboSpan" id="kobo.1188.1">the backend.</span></span></p>
<h2 id="_idParaDest-235"><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.1189.1">Attaching the project to the FastAPI project we created earlier</span></h2>
<p><span class="koboSpan" id="kobo.1190.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1191.1">fastAPIProject</span></strong><span class="koboSpan" id="kobo.1192.1"> folder we created at the beginning of this chapter. </span><span class="koboSpan" id="kobo.1192.2">Now, use the </span><strong class="bold"><span class="koboSpan" id="kobo.1193.1">File</span></strong><span class="koboSpan" id="kobo.1194.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1195.1">Open</span></strong><span class="koboSpan" id="kobo.1196.1"> menu to open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1197.1">namelist</span></strong><span class="koboSpan" id="kobo.1198.1"> folder containing the React project. </span><span class="koboSpan" id="kobo.1198.2">Usually, when we do this, we tell PyCharm to</span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.1199.1"> open the project either in a new window or in the current window. </span><span class="koboSpan" id="kobo.1199.2">This time, I want you to tell it to attach the project to the current one, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1200.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1201.1">.28</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1202.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer299">
<span class="koboSpan" id="kobo.1203.1"><img alt="Figure 9.28: Pick the attach option when you open the React project" src="image/B19644_09_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1204.1">Figure 9.28: Pick the Attach option when you open the React project</span></p>
<p><span class="koboSpan" id="kobo.1205.1">You will find both projects open</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.1206.1"> at the same time in the IDE. </span><span class="koboSpan" id="kobo.1206.2">This is evident in the project window shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1207.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1208.1">.29</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1209.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer300">
<span class="koboSpan" id="kobo.1210.1"><img alt="Figure 9.29: Both halves of a full stack app can be open at the same time, allowing you to run and debug them as if they were one project" src="image/B19644_09_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1211.1">Figure 9.29: Both halves of a full stack app can be open at the same time, allowing you to run and debug them as if they were one project</span></p>
<p><span class="koboSpan" id="kobo.1212.1">Working with attached projects </span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.1213.1">makes for a very enjoyable experience in full stack development. </span><span class="koboSpan" id="kobo.1213.2">Consider </span><span class="No-Break"><span class="koboSpan" id="kobo.1214.1">the benefits:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1215.1">Technically, they are separate projects in </span><span class="No-Break"><span class="koboSpan" id="kobo.1216.1">separate repositories.</span></span></li>
<li><span class="koboSpan" id="kobo.1217.1">PyCharm allows you to create run and debug configurations for all attached projects. </span><span class="koboSpan" id="kobo.1217.2">For example, it is possible to set a breakpoint in your React app to examine some form of data just before it is submitted. </span><span class="koboSpan" id="kobo.1217.3">Then in your FastAPI project, you can set a breakpoint in the endpoint function to inspect the data received, making it easy to find errors in data formatting between the </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1">two projects.</span></span></li>
<li><span class="koboSpan" id="kobo.1219.1">Other people who are not able to work full stack can still work on individual </span><span class="No-Break"><span class="koboSpan" id="kobo.1220.1">projects separately.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1221.1">In </span><a href="B19644_11.xhtml#_idTextAnchor266"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1222.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.1223.1">,</span><em class="italic"><span class="koboSpan" id="kobo.1224.1"> Understanding Database Management with PyCharm</span></em><span class="koboSpan" id="kobo.1225.1">, we’ll learn that you can work with the</span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.1226.1"> frontend, the backend, and databases, all from within one PyCharm window. </span><span class="koboSpan" id="kobo.1226.2">For full stack development, PyCharm is hard to beat! </span><span class="koboSpan" id="kobo.1226.3">But first, in the next chapter, let’s look at a third web development framework supported by </span><span class="No-Break"><span class="koboSpan" id="kobo.1227.1">PyCharm: Pyramid.</span></span></p>
<h1 id="_idParaDest-236"><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.1228.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1229.1">In this chapter, we effectively covered everything you need to know in order to get started creating a RESTful API project using FastAPI </span><span class="No-Break"><span class="koboSpan" id="kobo.1230.1">in PyCharm.</span></span></p>
<p><span class="koboSpan" id="kobo.1231.1">FastAPI is distinct from Flask, and many other template-oriented web development frameworks, in that it is specifically designed to create only RESTful APIs. </span><span class="koboSpan" id="kobo.1231.2">A RESTful API is a backend that is decoupled from any frontend markup, layout, interactivity, or display logic. </span><span class="koboSpan" id="kobo.1231.3">Instead, the API focuses solely on receiving requests bearing user interaction data and returning processed data, such as that retrieved or processed in a </span><span class="No-Break"><span class="koboSpan" id="kobo.1232.1">relational database.</span></span></p>
<p><span class="koboSpan" id="kobo.1233.1">Since these types of applications focus on data, we learned that an SPA is normally used to serve as the frontend presentation layer. </span><span class="koboSpan" id="kobo.1233.2">A number of modern frameworks support this paradigm, including React, Angular, and Vue. </span><span class="koboSpan" id="kobo.1233.3">It is the frontend application’s job to control the application state since HTTP is a stateless protocol, and any backend would be ill suited to </span><span class="No-Break"><span class="koboSpan" id="kobo.1234.1">this responsibility.</span></span></p>
<p><span class="koboSpan" id="kobo.1235.1">Creating the FastAPI project was easy using the template built into PyCharm Professional. </span><span class="koboSpan" id="kobo.1235.2">It generated starting code as well as a special type of test file unique to PyCharm. </span><span class="koboSpan" id="kobo.1235.3">The HTTP file contains a specification for a request, and a testing framework based on JavaScript, which allows us to validate the response with the same kind of assertion logic we saw in our earlier exposure to </span><span class="No-Break"><span class="koboSpan" id="kobo.1236.1">unit testing.</span></span></p>
<p><span class="koboSpan" id="kobo.1237.1">Finally, we created a React frontend in a separate, but connected (attached), project in PyCharm, allowing you to develop a full stack application without mingling the frontend JavaScript code with the backend Python code. </span><span class="koboSpan" id="kobo.1237.2">In the next chapter, we will discuss Django </span><span class="No-Break"><span class="koboSpan" id="kobo.1238.1">and Pyramid.</span></span></p>
<h1 id="_idParaDest-237"><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.1239.1">Questions</span></h1>
<ol>
<li><span class="koboSpan" id="kobo.1240.1">What framework serves as the basis for FastAPI, and what makes it different from Flask </span><span class="No-Break"><span class="koboSpan" id="kobo.1241.1">and Werkzeug?</span></span></li>
<li><span class="koboSpan" id="kobo.1242.1">What is meant by “representational state transfer” and what problem does </span><span class="No-Break"><span class="koboSpan" id="kobo.1243.1">it solve?</span></span></li>
<li><span class="koboSpan" id="kobo.1244.1">Where is the application state stored in a RESTful API project using an SPA as </span><span class="No-Break"><span class="koboSpan" id="kobo.1245.1">its frontend?</span></span></li>
<li><span class="koboSpan" id="kobo.1246.1">What are the four most widely used </span><span class="No-Break"><span class="koboSpan" id="kobo.1247.1">HTTP methods?</span></span></li>
<li><span class="koboSpan" id="kobo.1248.1">What are CRUD methods, and how do the HTTP methods map to </span><span class="No-Break"><span class="koboSpan" id="kobo.1249.1">CRUD methods?</span></span></li>
<li><span class="koboSpan" id="kobo.1250.1">What are the benefits of keeping frontend and backend projects separate, and how does PyCharm make working with such full stack </span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">projects easier?</span></span></li>
</ol>
<h1 id="_idParaDest-238"><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.1252.1">Further reading</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.1253.1">Garret, J. </span><span class="koboSpan" id="kobo.1253.2">J. </span><span class="koboSpan" id="kobo.1253.3">(2005). </span><span class="koboSpan" id="kobo.1253.4">A new approach to web </span><span class="No-Break"><span class="koboSpan" id="kobo.1254.1">applications. </span></span><a href="http://www.adaptivepath.com/publications/essays/archives/000385.php"><span class="No-Break"><span class="koboSpan" id="kobo.1255.1">http://www.adaptivepath.com/publications/essays/archives/000385.php</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1256.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1257.1">Pandey, R. </span><span class="koboSpan" id="kobo.1257.2">(2023) Build Full Stack Projects with FARM Stack [Video]. </span><span class="No-Break"><span class="koboSpan" id="kobo.1258.1">Packtpub.com </span></span><a href="https://www.packtpub.com/product/build-full-stack-projects-with-farm-stack-video/9781803236667"><span class="No-Break"><span class="koboSpan" id="kobo.1259.1">https://www.packtpub.com/product/build-full-stack-projects-with-farm-stack-video/9781803236667</span></span></a></li>
<li><span class="koboSpan" id="kobo.1260.1">Van Horn, B. </span><span class="koboSpan" id="kobo.1260.2">(2021) Setting Up a Python Development Workstation in Windows 10. </span><span class="No-Break"><span class="koboSpan" id="kobo.1261.1">maddevskilz.com </span></span><a href="https://www.maddevskilz.com/courses/setting-up-a-python-development-workstation-in-windows "><span class="No-Break"><span class="koboSpan" id="kobo.1262.1">https://www.maddevskilz.com/courses/setting-up-a-python-development-workstation-in-windows</span></span></a></li>
<li><span class="koboSpan" id="kobo.1263.1">Van Horn, B. </span><span class="koboSpan" id="kobo.1263.2">(2021) Setting Up a NodeJS Development Workstation in MacOS.  </span><span class="No-Break"><span class="koboSpan" id="kobo.1264.1">maddevskilz.com </span></span><a href="https://www.maddevskilz.com/courses/setting-up-a-nodejs-development-workstation-in-macos"><span class="No-Break"><span class="koboSpan" id="kobo.1265.1">https://www.maddevskilz.com/courses/setting-up-a-nodejs-development-workstation-in-macos</span></span></a></li>
<li><span class="koboSpan" id="kobo.1266.1">Be sure to check out the companion website for the book </span><span class="No-Break"><span class="koboSpan" id="kobo.1267.1">at </span></span><a href="https://www.pycharm-book.com"><span class="No-Break"><span class="koboSpan" id="kobo.1268.1">https://www.pycharm-book.com</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1269.1">.</span></span></li>
</ul>
</div>
</body></html>