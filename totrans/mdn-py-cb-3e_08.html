<html><head></head><body>
<section data-number="0.11" id="chapter-8-more-advanced-class-design">
<h2 class="likechapterhead" data-number="0.11"><span><span class="kobospan" id="kobo.1.1">8</span></span><br class="tipbox1"/> <span id="x1-4520008"/><span class="kobospan" id="kobo.2.1">More Advanced Class Design</span></h2>
<p class="normal"><span class="kobospan" id="kobo.3.1">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.4.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.5.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.6.1">7</span></span></a><span class="kobospan" id="kobo.7.1">, we looked at some recipes that covered the basics of class design. </span><span class="kobospan" id="kobo.7.2">In this chapter, we’ll dive more deeply into Python classes and class design.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.8.1">In the </span><a href="ch011_split_000.xhtml#x1-3890003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.9.1">Designing classes with lots of processing</span></span></a><span class="kobospan" id="kobo.10.1"> and </span><a href="ch011_split_001.xhtml#x1-43100010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.11.1">Using properties for lazy</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.12.1">attributes</span></span></a><span class="kobospan" id="kobo.13.1"> recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.14.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.15.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.16.1">7</span></span></a><span class="kobospan" id="kobo.17.1">, we identified a design choice that’s central to object-oriented programming, the ”wrap versus extend” decision. </span><span class="kobospan" id="kobo.17.2">One way to add features is to create a new subclass via an extension. </span><span class="kobospan" id="kobo.17.3">The other technique for adding features is to wrap an existing class, making it part of a new class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.18.1">In addition to direct inheritance, there are some other class extension techniques available in Python. </span><span class="kobospan" id="kobo.18.2">A Python class can inherit features from more than one superclass. </span><span class="kobospan" id="kobo.18.3">We call</span><span id="dx1-452001"/><span class="kobospan" id="kobo.19.1"> this design pattern a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.20.1">mixin</span></span><span class="kobospan" id="kobo.21.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.22.1">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.23.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.24.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.25.1">4</span></span></a><span class="kobospan" id="kobo.26.1"> and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.27.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.28.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.29.1">5</span></span></a><span class="kobospan" id="kobo.30.1">, we looked at the core built-in data structures. </span><span class="kobospan" id="kobo.30.2">We can combine and extend these collection definition features to create more complex data structures or data structures with additional features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.31.1">In this chapter, we’ll look at the following recipes:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><a href="ch012.xhtml#x1-4530001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.32.1">Choosing between inheritance and composition – the ”is-a” question</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch012.xhtml#x1-4610002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.33.1">Separating concerns via multiple inheritance</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch012.xhtml#x1-4670003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.34.1">Leveraging Python’s duck typing</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch012.xhtml#x1-4730004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.35.1">Managing global and singleton objects</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch012.xhtml#x1-4810005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.36.1">Using more complex structures – maps of lists</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch012.xhtml#x1-4870006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.37.1">Creating a class that has orderable objects</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch012.xhtml#x1-4930007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.38.1">Deleting from a list of complicated objects</span></span></a></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.39.1">There are a great many techniques of object-oriented class design available in Python. </span><span class="kobospan" id="kobo.39.2">We’ll start with a foundational design concept: making the design choice between using inheritance from a base class and wrapping a class to extend it. </span><span id="x1-452002r933"/></p>
<section data-number="0.11.1" id="choosing-between-inheritance-and-composition-the-is-a-question">
<h1 class="unnumbered" data-number="0.11.1"><span><span class="kobospan" id="kobo.40.1">8.1 </span></span> <span id="x1-4530001"/><span class="kobospan" id="kobo.41.1">Choosing between inheritance and composition – the ”is-a” question</span></h1>
<p class="normal"><span class="kobospan" id="kobo.42.1">In the </span><a href="ch010.xhtml#x1-3610006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.43.1">Using cmd to create command-line applications</span></span></a><span class="kobospan" id="kobo.44.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.45.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.46.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.47.1">6</span></span></a><span class="kobospan" id="kobo.48.1">, and the </span><a href="ch011_split_001.xhtml#x1-4250009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.49.1">Extending a built-in collection – a list that does statistics</span></span></a><span class="kobospan" id="kobo.50.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.51.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.52.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.53.1">7</span></span></a><span class="kobospan" id="kobo.54.1">, we looked at extending a class. </span><span class="kobospan" id="kobo.54.2">In both cases, the class</span><span id="dx1-453001"/><span class="kobospan" id="kobo.55.1"> implemented in the recipe was a subclass of one of Python’s built-in classes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.56.1">The idea of extension via inheritance</span><span id="dx1-453002"/><span class="kobospan" id="kobo.57.1"> is sometimes called the generalization-specialization relationship. </span><span class="kobospan" id="kobo.57.2">It can</span><span id="dx1-453003"/><span class="kobospan" id="kobo.58.1"> also be called an </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.59.1">is-a</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.60.1">relationship</span></span><span class="kobospan" id="kobo.61.1">. </span><span class="kobospan" id="kobo.61.2">There’s an important semantic issue:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.62.1">Do we mean that instances of the subclass are also instances of the superclass? </span><span class="kobospan" id="kobo.62.2">This is an </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.63.1">is-a </span></span><span class="kobospan" id="kobo.64.1">relationship, an example of </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.65.1">inheritance</span></span><span class="kobospan" id="kobo.66.1">, where we </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.67.1">extend </span></span><span class="kobospan" id="kobo.68.1">a class, changing the implementation details of features.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.69.1">Or do we mean something</span><span id="dx1-453004"/><span class="kobospan" id="kobo.70.1"> else? </span><span class="kobospan" id="kobo.70.2">Perhaps</span><span id="dx1-453005"/><span class="kobospan" id="kobo.71.1"> there’s a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.72.1">composition </span></span><span class="kobospan" id="kobo.73.1">or </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.74.1">association</span></span><span class="kobospan" id="kobo.75.1">, sometimes called</span><span id="dx1-453006"/><span class="kobospan" id="kobo.76.1"> a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.77.1">has-a relationship</span></span><span class="kobospan" id="kobo.78.1">. </span><span class="kobospan" id="kobo.78.2">In this case, we may </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.79.1">wrap </span></span><span class="kobospan" id="kobo.80.1">another class, adding or removing features.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.81.1">One of the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.82.1">SOLID </span></span><span class="kobospan" id="kobo.83.1">design</span><span id="dx1-453007"/><span class="kobospan" id="kobo.84.1"> principles, the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.85.1">Liskov Substitution Principle,</span></span><span class="kobospan" id="kobo.86.1"> requires any subclass to be a proper</span><span id="dx1-453008"/><span class="kobospan" id="kobo.87.1"> replacement for the superclass. </span><span class="kobospan" id="kobo.87.2">We’ll look at both the inheritance and composition techniques for creating new features for existing classes. </span><span id="x1-453009r931"/></p>
<section data-number="0.11.1.1" id="getting-ready-63">
<h2 class="likechapterhead" data-number="0.11.1.1"><span><span class="kobospan" id="kobo.88.1">8.1.1 </span></span> <span id="x1-4540001"/><span class="kobospan" id="kobo.89.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.90.1">For this recipe, we’ll use models</span><span id="dx1-454001"/><span class="kobospan" id="kobo.91.1"> for a deck of playing cards as concrete examples. </span><span class="kobospan" id="kobo.91.2">We’ll look at several ways to design a collection.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.92.1">The core ingredient for both implementations is the underlying </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.93.1">Card</span></span></span></span><span class="kobospan" id="kobo.94.1"> object. </span><span class="kobospan" id="kobo.94.2">We can define this using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.95.1">NamedTuple</span></span></span></span><span class="kobospan" id="kobo.96.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.97.1">
 
 
from typing import NamedTuple 
 
 
 
class Card(NamedTuple): 
 
    rank: int 
 
    suit: str 
 
 
 
Spades, Hearts, Diamonds, Clubs = (’\u2660’, ’\u2661’, ’\u2662’, ’\u2663’)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.98.1">We’ll use this </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.99.1">Card</span></span></span></span><span class="kobospan" id="kobo.100.1"> class in the rest of this recipe. </span><span class="kobospan" id="kobo.100.2">What’s important is the various kinds of collection representing a deck or hand; all have considerable overlaps in the kinds of features they support.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.101.1">We have several common pattern for collections:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.102.1">Aggregation</span></span><span class="kobospan" id="kobo.103.1">: Some objects are bound into</span><span id="dx1-454010"/><span class="kobospan" id="kobo.104.1"> collections, but the objects have a properly independent existence. </span><span class="kobospan" id="kobo.104.2">While </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.105.1">Card</span></span></span></span><span class="kobospan" id="kobo.106.1"> objects can be aggregated into a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.107.1">Hand</span></span></span></span><span class="kobospan" id="kobo.108.1"> collection, when the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.109.1">Hand</span></span></span></span><span class="kobospan" id="kobo.110.1"> object is deleted, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.111.1">Card</span></span></span></span><span class="kobospan" id="kobo.112.1"> objects continue to exist.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.113.1">Composition</span></span><span class="kobospan" id="kobo.114.1">: Some objects in collections</span><span id="dx1-454011"/><span class="kobospan" id="kobo.115.1"> do not have an independent existence. </span><span class="kobospan" id="kobo.115.2">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.116.1">Hand</span></span></span></span><span class="kobospan" id="kobo.117.1"> of cards cannot exist without a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.118.1">Player</span></span></span></span><span class="kobospan" id="kobo.119.1">. </span><span class="kobospan" id="kobo.119.2">When a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.120.1">Player</span></span></span></span><span class="kobospan" id="kobo.121.1"> instance leaves a game, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.122.1">Hand</span></span></span></span><span class="kobospan" id="kobo.123.1"> object must also be removed.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.124.1">Inheritance </span></span><span class="kobospan" id="kobo.125.1">(also called an </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.126.1">is-a </span></span><span class="kobospan" id="kobo.127.1">relationship): This is the idea</span><span id="dx1-454012"/><span class="kobospan" id="kobo.128.1"> that a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.129.1">Deck</span></span></span></span><span class="kobospan" id="kobo.130.1"> is a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.131.1">Hand</span></span></span></span><span id="dx1-454013"/><span class="kobospan" id="kobo.132.1"> with some extra features. </span><span class="kobospan" id="kobo.132.2">We can extend a built-in class like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.133.1">list</span></span></span></span><span class="kobospan" id="kobo.134.1"> to implement this.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.135.1">The distinction between aggregation and composition is very important when designing a database, where persistence of objects is the focus. </span><span class="kobospan" id="kobo.135.2">In Python, the distinction is a minor nuance. </span><span class="kobospan" id="kobo.135.3">The ordinary Python memory management will preserve the objects still referenced by collections or variables. </span><span class="kobospan" id="kobo.135.4">We’ll consider both to be examples of composition.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.136.1">Once the relationships are understood, there are two distinct paths: </span><a href="ch012.xhtml#x1-4560002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.137.1">Composition</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.138.1">or aggregation</span></span></a><span class="kobospan" id="kobo.139.1"> or </span><a href="ch012.xhtml#x1-4570002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.140.1">Inheritance and extension</span></span></a><span class="kobospan" id="kobo.141.1">. </span><span id="x1-454014r937"/></p>
</section>
<section data-number="0.11.1.2" id="how-to-do-it...-64">
<h2 class="likechapterhead" data-number="0.11.1.2"><span><span class="kobospan" id="kobo.142.1">8.1.2 </span></span> <span id="x1-4550002"/><span class="kobospan" id="kobo.143.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.144.1">This recipe has two separate</span><span id="dx1-455001"/><span class="kobospan" id="kobo.145.1"> mini-recipes: aggregation and inheritance.</span></p>
<section data-number="0.11.1.2.1" id="composition-or-aggregation">
<h3 class="likesubsubsectionhead" data-number="0.11.1.2.1"><span id="x1-4560002"/><span class="kobospan" id="kobo.146.1">Composition or aggregation</span></h3>
<p class="normal"><span class="kobospan" id="kobo.147.1">Wrapping a collection</span><span id="dx1-456001"/><span class="kobospan" id="kobo.148.1"> object inside another</span><span id="dx1-456002"/><span class="kobospan" id="kobo.149.1"> class’s instance variables has two common variants, sometimes called composition and aggregation. </span><span class="kobospan" id="kobo.149.2">The nuanced difference doesn’t matter in Python. </span><span class="kobospan" id="kobo.149.3">Here’s how we design a collection using composition:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-456004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.150.1">Define the collection class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.151.1">To distinguish similar examples in this book, the name has a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.152.1">_W</span></span></span></span><span class="kobospan" id="kobo.153.1"> suffix to show it is a wrapper. </span><span class="kobospan" id="kobo.153.2">This is not a generally recommended practice; it’s only used here to emphasize the distinctions between class definitions in this recipe.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.154.1">Here’s the definition of the class:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.155.1">
class Deck_W:</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-456008x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.156.1">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.157.1">__init__()</span></span></span></span><span class="kobospan" id="kobo.158.1"> method of this class as one way to provide the underlying collection object. </span><span class="kobospan" id="kobo.158.2">This will also initialize any stateful variables. </span><span class="kobospan" id="kobo.158.3">We might create an iterator for dealing:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.159.1">
    def __init__(self, cards: list[Card]) -&gt; None: 
 
        self.cards = cards 
 
        self.deal_iter = iter(self.cards)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.160.1">This uses a type hint, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.161.1">list[Card]</span></span></span></span><span class="kobospan" id="kobo.162.1">, to show the source collection that will be wrapped.</span></p>
</div></li>
<li class="calibre7"><div id="x1-456014x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.163.1">Provide the methods appropriate to the aggregate object. </span><span class="kobospan" id="kobo.163.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.164.1">shuffle()</span></span></span></span><span class="kobospan" id="kobo.165.1"> method randomizes the internal list object. </span><span class="kobospan" id="kobo.165.2">It also creates an iterator used to step through the list by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.166.1">deal()</span></span></span></span><span class="kobospan" id="kobo.167.1"> method. </span><span class="kobospan" id="kobo.167.2">We’ve provided a type hint on </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.168.1">deal()</span></span></span></span><span class="kobospan" id="kobo.169.1"> to clarify that it returns </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.170.1">Card</span></span></span></span><span class="kobospan" id="kobo.171.1"> instances:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.172.1">
    def shuffle(self) -&gt; None: 
 
        random.shuffle(self.cards) 
 
        self.deal_iter = iter(self.cards) 
 
 
 
    def deal(self) -&gt; Card: 
 
        return next(self.deal_iter)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.173.1">Here’s how we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.174.1">Deck_W</span></span></span></span><span class="kobospan" id="kobo.175.1"> class. </span><span class="kobospan" id="kobo.175.2">We’ll be working</span><span id="dx1-456022"/><span class="kobospan" id="kobo.176.1"> with a list</span><span id="dx1-456023"/><span class="kobospan" id="kobo.177.1"> of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.178.1">Card</span></span></span></span><span class="kobospan" id="kobo.179.1"> objects. </span><span class="kobospan" id="kobo.179.2">In this case, the domain variable was created from a list comprehension that generated all 52 combinations of 13 ranks and four suits:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.180.1">
 
 
&gt;&gt;&gt; domain = list( 
 
... </span><span class="kobospan" id="kobo.180.2">    Card(r+1,s) 
 
... </span><span class="kobospan" id="kobo.180.3">        for r in range(13) 
 
... </span><span class="kobospan" id="kobo.180.4">            for s in (Spades, Hearts, Diamonds, Clubs) 
 
... </span><span class="kobospan" id="kobo.180.5">) 
 
&gt;&gt;&gt; len(domain) 
 
52</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.181.1">We can use the items</span><span id="dx1-456032"/><span class="kobospan" id="kobo.182.1"> in this collection, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.183.1">domain</span></span></span></span><span class="kobospan" id="kobo.184.1">, to create a second aggregate object that shares the same underlying </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.185.1">Card</span></span></span></span><span class="kobospan" id="kobo.186.1"> objects. </span><span class="kobospan" id="kobo.186.2">We’ll build the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.187.1">Deck_W</span></span></span></span><span class="kobospan" id="kobo.188.1"> object from a list of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.189.1">Card</span></span></span></span><span class="kobospan" id="kobo.190.1"> objects:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.191.1">                                                                     

                                                                     

 
 
&gt;&gt;&gt; d = Deck_W(domain) 
 
 
 
&gt;&gt;&gt; import random 
 
&gt;&gt;&gt; random.seed(1) 
 
&gt;&gt;&gt; d.shuffle() 
 
&gt;&gt;&gt; [d.deal() for _ in range(5)] 
 
[Card(rank=13, suit=’’), Card(rank=3, suit=’’), Card(rank=10, suit=’’), Card(rank=6, suit=’’), Card(rank=1, suit=’’)]</span></code></pre>
</section>
<section data-number="0.11.1.2.2" id="inheritance-and-extension">
<h3 class="likesubsubsectionhead" data-number="0.11.1.2.2"><span id="x1-4570002"/><span class="kobospan" id="kobo.192.1">Inheritance and extension</span></h3>
<p class="normal"><span class="kobospan" id="kobo.193.1">Here’s an approach</span><span id="dx1-457001"/><span class="kobospan" id="kobo.194.1"> to defining a class that extends one of the built-in collections of objects:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-457003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.195.1">Start by defining the extension class as a subclass of a built-in collection. </span><span class="kobospan" id="kobo.195.2">To distinguish similar examples in this book, the name has an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.196.1">_X</span></span></span></span><span class="kobospan" id="kobo.197.1"> suffix. </span><span class="kobospan" id="kobo.197.2">The subclass relationship is a formal statement—a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.198.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.199.1"> instance is also a kind of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.200.1">list</span></span></span></span><span class="kobospan" id="kobo.201.1">. </span><span class="kobospan" id="kobo.201.2">Here’s the class definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.202.1">
class Deck_X(list[Card]):</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-457007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.203.1">No additional code is needed to initialize the instance, as we’ll use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.204.1">__init__()</span></span></span></span><span class="kobospan" id="kobo.205.1"> method inherited from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.206.1">list</span></span></span></span><span class="kobospan" id="kobo.207.1"> class.</span></p>
</div></li>
<li class="calibre7"><div id="x1-457009x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.208.1">No additional code is needed to update the deck, as we’ll use other methods of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.209.1">list</span></span></span></span><span class="kobospan" id="kobo.210.1"> class for adding, changing, or removing items from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.211.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.212.1"> instance.</span></p>
</div></li>
<li class="calibre7"><div id="x1-457011x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.213.1">Provide the appropriate new features to the extended object. </span><span class="kobospan" id="kobo.213.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.214.1">shuffle()</span></span></span></span><span class="kobospan" id="kobo.215.1"> method randomizes the object as a whole. </span><span class="kobospan" id="kobo.215.2">The collection here is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.216.1">self</span></span></span></span><span class="kobospan" id="kobo.217.1">, because this method is an extension of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.218.1">list</span></span></span></span><span class="kobospan" id="kobo.219.1"> class. </span><span class="kobospan" id="kobo.219.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.220.1">deal()</span></span></span></span><span class="kobospan" id="kobo.221.1"> object relies on an iterator created by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.222.1">shuffle()</span></span></span></span><span class="kobospan" id="kobo.223.1"> method to step through the list, returning </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.224.1">Card</span></span></span></span><span class="kobospan" id="kobo.225.1"> instances:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.226.1">
    def shuffle(self) -&gt; None: 
 
        random.shuffle(self) 
 
        self.deal_iter = iter(self) 
 
 
 
    def deal(self) -&gt; Card: 
 
        return next(self.deal_iter)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.227.1">Here’s how we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.228.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.229.1"> class. </span><span class="kobospan" id="kobo.229.2">First, we’ll build a deck of cards:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.230.1">
 
 
&gt;&gt;&gt; dx = Deck_X( 
 
... </span><span class="kobospan" id="kobo.230.2">Card(r+1,s) 
 
... </span><span class="kobospan" id="kobo.230.3">    for r in range(13) 
 
... </span><span class="kobospan" id="kobo.230.4">        for s in (Spades, Hearts, Diamonds, Clubs) 
 
... </span><span class="kobospan" id="kobo.230.5">) 
 
&gt;&gt;&gt; len(dx) 
 
52</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.231.1">Using only the deck-specific features for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.232.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.233.1"> implementation looks exactly like the other implementation, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.234.1">Deck_W</span></span></span></span><span class="kobospan" id="kobo.235.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.236.1">
 
 
&gt;&gt;&gt; import random 
 
&gt;&gt;&gt; random.seed(1) 
 
&gt;&gt;&gt; dx.shuffle() 
 
&gt;&gt;&gt; [dx.deal() for _ in range(5)] 
 
[Card(rank=13, suit=’’), Card(rank=3, suit=’’), Card(rank=10, suit=’’), Card(rank=6, suit=’’), Card(rank=1, suit=’’)]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.237.1">As we’ll see below in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.238.1">There’s more...</span></span><span class="kobospan" id="kobo.239.1">, because </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.240.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.241.1"> is a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.242.1">list</span></span></span></span><span class="kobospan" id="kobo.243.1">, it has all of the methods of a list object. </span><span class="kobospan" id="kobo.243.2">When designing a framework for others to use, this may be a bad idea. </span><span class="kobospan" id="kobo.243.3">When designing</span><span id="dx1-457033"/><span class="kobospan" id="kobo.244.1"> an application, it’s easy to avoid using the extra features. </span><span id="x1-457034r939"/></p>
</section>
</section>
<section data-number="0.11.1.3" id="how-it-works...-64">
<h2 class="likechapterhead" data-number="0.11.1.3"><span><span class="kobospan" id="kobo.245.1">8.1.3 </span></span> <span id="x1-4580003"/><span class="kobospan" id="kobo.246.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.247.1">Python implements the idea of inheritance</span><span id="dx1-458001"/><span class="kobospan" id="kobo.248.1"> via a clever search algorithm for finding methods (and attributes) of an object’s class. </span><span class="kobospan" id="kobo.248.2">The search works like this:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-458003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.249.1">Examine the object’s class for the method or attribute name.</span></p>
</div></li>
<li class="calibre7"><div id="x1-458005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.250.1">If the name is not defined in the immediate class, then search in all of the parent classes for the method or attribute. </span><span class="kobospan" id="kobo.250.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.251.1">Method</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.252.1">Resolution Order </span></span><span class="kobospan" id="kobo.253.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.254.1">MRO</span></span><span class="kobospan" id="kobo.255.1">) defines the order in which these classes</span><span id="dx1-458006"/><span class="kobospan" id="kobo.256.1"> are searched.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.257.1">Searching through the parent classes ensures two things:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.258.1">All methods defined in any superclass are available to subclasses.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.259.1">Any subclass can override a method to replace the superclass method. </span><span class="kobospan" id="kobo.259.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.260.1">super()</span></span></span></span><span class="kobospan" id="kobo.261.1"> function searches parent classes for the definition being overridden.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.262.1">Because of this, a subclass of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.263.1">list</span></span></span></span><span class="kobospan" id="kobo.264.1"> class inherits all the features of the parent class. </span><span class="kobospan" id="kobo.264.2">It is a specialized extension of the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.265.1">list</span></span></span></span><span class="kobospan" id="kobo.266.1"> class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.267.1">This also means that all methods have the potential to be overridden by a subclass. </span><span class="kobospan" id="kobo.267.2">Some languages have ways to lock a method against extension. </span><span class="kobospan" id="kobo.267.3">Because Python doesn’t have this, a subclass can override any method.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.268.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.269.1">super()</span></span></span></span><span class="kobospan" id="kobo.270.1"> function allows a subclass to add features by wrapping the superclass version of a method. </span><span class="kobospan" id="kobo.270.2">One way to use it is like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.271.1">
 
 
class SomeClass(Parent): 
 
    def some_method(self) -&gt; None: 
 
        # do something extra 
 
        super().some_method()</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.272.1">In this case, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.273.1">some_method()</span></span></span></span><span class="kobospan" id="kobo.274.1"> method of a class will do something extra and then use the superclass version of the method. </span><span class="kobospan" id="kobo.274.2">This allows us a handy way to extend selected methods of a class. </span><span class="kobospan" id="kobo.274.3">We can preserve the superclass</span><span id="dx1-458012"/><span class="kobospan" id="kobo.275.1"> features while adding features unique to the subclass. </span><span id="x1-458013r951"/></p>
</section>
<section data-number="0.11.1.4" id="theres-more...-55">
<h2 class="likechapterhead" data-number="0.11.1.4"><span><span class="kobospan" id="kobo.276.1">8.1.4 </span></span> <span id="x1-4590004"/><span class="kobospan" id="kobo.277.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.278.1">There are some huge differences between the two definitions, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.279.1">Deck_W</span></span></span></span><span class="kobospan" id="kobo.280.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.281.1">Deck_X.</span></span></span></span><span class="kobospan" id="kobo.282.1"> When wrapping, we get precisely the methods we defined and no others. </span><span class="kobospan" id="kobo.282.2">When using inheritance, we receive a wealth of method definitions from the superclass. </span><span class="kobospan" id="kobo.282.3">This leads to some additional behaviors in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.283.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.284.1"> class that may not be desirable:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.285.1">We can use a variety of collections as a source to create </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.286.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.287.1"> instances. </span><span class="kobospan" id="kobo.287.2">This works because the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.288.1">list</span></span></span></span><span class="kobospan" id="kobo.289.1"> class has a number of features for converting Python collections to lists. </span><span class="kobospan" id="kobo.289.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.290.1">Deck_W</span></span></span></span><span class="kobospan" id="kobo.291.1"> class will only work for sequences offering the methods implicitly required by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.292.1">shuffle()</span></span></span></span><span class="kobospan" id="kobo.293.1"> method. </span><span class="kobospan" id="kobo.293.2">Further, the type hint of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.294.1">list[Card]</span></span></span></span><span class="kobospan" id="kobo.295.1"> will cause programs like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.296.1">mypy </span></span><span class="kobospan" id="kobo.297.1">to raise errors</span><span id="dx1-459001"/><span class="kobospan" id="kobo.298.1"> for the use of other source collections.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.299.1">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.300.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.301.1"> instance can be sliced and indexed outside the core sequential iteration supported by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.302.1">deal()</span></span></span></span><span class="kobospan" id="kobo.303.1"> method.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.304.1">Because the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.305.1">Deck_X</span></span></span></span><span class="kobospan" id="kobo.306.1"> class is a list, it also works directly with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.307.1">iter()</span></span></span></span><span class="kobospan" id="kobo.308.1"> function; it can be used as an iterable source of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.309.1">Card</span></span></span></span><span class="kobospan" id="kobo.310.1"> objects without the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.311.1">deal()</span></span></span></span><span class="kobospan" id="kobo.312.1"> method.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.313.1">These differences are also important parts of deciding which technique to use. </span><span class="kobospan" id="kobo.313.2">If the additional features are desirable, that suggests inheritance. </span><span class="kobospan" id="kobo.313.3">If the additional features create problems, then composition might be a better choice. </span><span id="x1-459002r953"/></p>
</section>
<section data-number="0.11.1.5" id="see-also-62">
<h2 class="likechapterhead" data-number="0.11.1.5"><span><span class="kobospan" id="kobo.314.1">8.1.5 </span></span> <span id="x1-4600005"/><span class="kobospan" id="kobo.315.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.316.1">We’ve looked at built-in collections in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.317.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.318.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.319.1">4</span></span></a><span class="kobospan" id="kobo.320.1">. </span><span class="kobospan" id="kobo.320.2">Also, in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.321.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.322.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.323.1">7</span></span></a><span class="kobospan" id="kobo.324.1">, we looked at how to define simple collections.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.325.1">In the </span><a href="ch011_split_000.xhtml#x1-3890003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.326.1">Designing classes with lots of processing</span></span></a><span class="kobospan" id="kobo.327.1"> recipe, we looked at wrapping a class with a separate class that handles the processing details. </span><span class="kobospan" id="kobo.327.2">We can contrast this with the </span><a href="ch011_split_001.xhtml#x1-43100010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.328.1">Using properties for lazy</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.329.1">attributes</span></span></a><span class="kobospan" id="kobo.330.1"> recipe of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.331.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.332.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.333.1">7</span></span></a><span class="kobospan" id="kobo.334.1">, where we put the complicated computations into the class as properties; this design relies on extension.</span></p></li>
</ul>
<p class="normal1"><span id="x1-460001r936"/></p>
</section>
</section>
<section data-number="0.11.2" id="separating-concerns-via-multiple-inheritance">
<h1 class="unnumbered" data-number="0.11.2"><span><span class="kobospan" id="kobo.335.1">8.2 </span></span> <span id="x1-4610002"/><span class="kobospan" id="kobo.336.1">Separating concerns via multiple inheritance</span></h1>
<p class="normal"><span class="kobospan" id="kobo.337.1">In the </span><a href="ch012.xhtml#x1-4530001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.338.1">Choosing between inheritance and composition – the ”is-a” question</span></span></a><span class="kobospan" id="kobo.339.1"> recipe earlier in the chapter, we looked at the idea</span><span id="dx1-461001"/><span class="kobospan" id="kobo.340.1"> of defining a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.341.1">Deck</span></span></span></span><span class="kobospan" id="kobo.342.1"> class that was a composition of playing card objects. </span><span class="kobospan" id="kobo.342.2">For the purposes of that example, we treated each </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.343.1">Card</span></span></span></span><span class="kobospan" id="kobo.344.1"> object as simply having rank and suit attributes. </span><span class="kobospan" id="kobo.344.2">This created two small problems:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.345.1">The display for the card always showed a numeric rank. </span><span class="kobospan" id="kobo.345.2">We didn’t see J, Q, or K. </span><span class="kobospan" id="kobo.345.3">Instead we saw 11, 12, and 13. </span><span class="kobospan" id="kobo.345.4">Similarly, an ace was shown as 1 instead of A.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.346.1">Many games like </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.347.1">Cribbage </span></span><span class="kobospan" id="kobo.348.1">assign a point value to each rank. </span><span class="kobospan" id="kobo.348.2">Generally, the face cards have 10 points. </span><span class="kobospan" id="kobo.348.3">The remaining cards have points that match their rank.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.349.1">Python’s multiple inheritance lets us handle variations in card game rules while keeping a single, essential </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.350.1">Card</span></span></span></span><span class="kobospan" id="kobo.351.1"> class. </span><span class="kobospan" id="kobo.351.2">Using multiple inheritance lets us separate rules for specific games from generic properties of playing cards. </span><span class="kobospan" id="kobo.351.3">We can combine a base class definition with a mixin class that provides needed features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.352.1">Python multiple inheritance relies on a clever</span><span id="dx1-461002"/><span class="kobospan" id="kobo.353.1"> algorithm called </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.354.1">C3 </span></span><span class="kobospan" id="kobo.355.1">to resolve various parent classes into a single list, in a useful order. </span><span class="kobospan" id="kobo.355.2">When we combine multiple classes, they will have common parent classes, which now have multiple references. </span><span class="kobospan" id="kobo.355.3">The C3 algorithm creates a linear list that respects all of the parent-child relationships. </span><span id="x1-461003r954"/></p>
<section data-number="0.11.2.1" id="getting-ready-64">
<h2 class="likechapterhead" data-number="0.11.2.1"><span><span class="kobospan" id="kobo.356.1">8.2.1 </span></span> <span id="x1-4620001"/><span class="kobospan" id="kobo.357.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.358.1">A practical extension to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.359.1">Card</span></span></span></span><span class="kobospan" id="kobo.360.1"> class</span><span id="dx1-462001"/><span class="kobospan" id="kobo.361.1"> needs to be a mixture of two feature sets. </span><span class="kobospan" id="kobo.361.2">Python lets us define a class that includes features from multiple parents. </span><span class="kobospan" id="kobo.361.3">The are two parts to this pattern:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-462003x1" class="calibre14">
<p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.362.1">Essential features</span></span><span class="kobospan" id="kobo.363.1">: This are the rank and suit. </span><span class="kobospan" id="kobo.363.2">This also includes</span><span id="dx1-462004"/><span class="kobospan" id="kobo.364.1"> a method to show the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.365.1">Card</span></span></span></span><span class="kobospan" id="kobo.366.1"> object’s value nicely as a string using “J”, “Q”, and “K” for court cards, and “A” for aces.</span></p>
</div></li>
<li class="calibre7"><div id="x1-462006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.367.1">Mixin features: These are all of the less</span><span id="dx1-462007"/><span class="kobospan" id="kobo.368.1"> essential, game-specific features, such as the number of points allotted to each particular card.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.369.1">The working application relies on a combination of features built from the essentials and the mixins. </span><span id="x1-462008r956"/></p>
</section>
<section data-number="0.11.2.2" id="how-to-do-it...-65">
<h2 class="likechapterhead" data-number="0.11.2.2"><span><span class="kobospan" id="kobo.370.1">8.2.2 </span></span> <span id="x1-4630002"/><span class="kobospan" id="kobo.371.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.372.1">This recipe will create two hierarchies of classes, one for the essential </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.373.1">Card</span></span></span></span><span class="kobospan" id="kobo.374.1"> and one for game-specific features including </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.375.1">Cribbage </span></span><span class="kobospan" id="kobo.376.1">point values:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-463002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.377.1">Define the essential class. </span><span class="kobospan" id="kobo.377.2">This is a generic </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.378.1">Card</span></span></span></span><span class="kobospan" id="kobo.379.1"> class, suitable for ranks 2 to 10:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.380.1">
@dataclass(frozen=True) 
 
class Card: 
 
    """Superclass for cards""" 
 
    rank: int 
 
    suit: str 
 
 
 
    def __str__(self) -&gt; str: 
 
        return f"{self.rank:2d} {self.suit}"</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-463013x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.381.1">Define the subclasses to implement specializations. </span><span class="kobospan" id="kobo.381.2">We need two subclasses of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.382.1">Card</span></span></span></span><span class="kobospan" id="kobo.383.1"> class—the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.384.1">AceCard</span></span></span></span><span class="kobospan" id="kobo.385.1"> class and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.386.1">FaceCard</span></span></span></span><span class="kobospan" id="kobo.387.1"> class, as defined in the following code:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.388.1">
class AceCard(Card): 
 
    def __str__(self) -&gt; str: 
 
        return f" A {self.suit}" 
 
 
 
class FaceCard(Card): 
 
    def __str__(self) -&gt; str: 
 
        names = {11: "J", 12: "Q", 13: "K"} 
 
        return f" {names[self.rank]} {self.suit}"</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.389.1">Each of this overrides the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.390.1">__str__()</span></span></span></span><span class="kobospan" id="kobo.391.1"> method to provide distinct behaviors.</span></p>
</div></li>
<li class="calibre7"><div id="x1-463024x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.392.1">Define the core features required</span><span id="dx1-463025"/><span class="kobospan" id="kobo.393.1"> by the mixin classes. </span><span class="kobospan" id="kobo.393.2">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.394.1">typing.Protocol</span></span></span></span><span class="kobospan" id="kobo.395.1"> superclass to be sure the various implementations all provide the required features. </span><span class="kobospan" id="kobo.395.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.396.1">rank</span></span></span></span><span class="kobospan" id="kobo.397.1"> attribute is required by the protocol, and will be defined in the essential class. </span><span class="kobospan" id="kobo.397.2">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.398.1">points()</span></span></span></span><span class="kobospan" id="kobo.399.1"> method will be defined in the mixin classes. </span><span class="kobospan" id="kobo.399.2">Here’s how it looks:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.400.1">                                                                     

                                                                     

from typing import Protocol 
 
 
 
class PointedCard(Protocol): 
 
    rank: int 
 
    def points(self) -&gt; int: 
 
        ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.401.1">When writing type hint classes, the body can be </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.402.1">...</span></span></span></span><span class="kobospan" id="kobo.403.1"> because this will be ignored</span><span id="dx1-463033"/><span class="kobospan" id="kobo.404.1"> by tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.405.1">mypy</span></span><span class="kobospan" id="kobo.406.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-463035x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.407.1">Define a mixin subclasses for additional features that will be added. </span><span class="kobospan" id="kobo.407.2">For the game of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.408.1">Cribbage</span></span><span class="kobospan" id="kobo.409.1">, the points for some cards are equal to the rank of the card, and face cards are 10 points:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.410.1">
class CribbagePoints(PointedCard): 
 
    def points(self) -&gt; int: 
 
        return self.rank</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.411.1">
class CribbageFacePoints(PointedCard): 
 
    def points(self) -&gt; int: 
 
        return 10</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-463045x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.412.1">Create the final concrete class definitions</span><span id="dx1-463046"/><span class="kobospan" id="kobo.413.1"> to combine an essential base class and all of the required mixin classes:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.414.1">                                                                     

                                                                     

class CribbageCard(Card, CribbagePoints): 
 
    pass 
 
 
 
class CribbageAce(AceCard, CribbagePoints): 
 
    pass 
 
 
 
class CribbageFace(FaceCard, CribbageFacePoints): 
 
    pass</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.415.1">Note that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.416.1">CribbagePoints</span></span></span></span><span class="kobospan" id="kobo.417.1"> mixin is used for both </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.418.1">Card</span></span></span></span><span class="kobospan" id="kobo.419.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.420.1">AceCard</span></span></span></span><span class="kobospan" id="kobo.421.1"> classes, allowing us to reuse code.</span></p>
</div></li>
<li class="calibre7"><div id="x1-463057x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.422.1">Define a function (or class) to create the appropriate objects</span><span id="dx1-463058"/><span class="kobospan" id="kobo.423.1"> based on the input parameters. </span><span class="kobospan" id="kobo.423.2">This is often called a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.424.1">factory function </span></span><span class="kobospan" id="kobo.425.1">or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.426.1">factory</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.427.1">class</span></span><span class="kobospan" id="kobo.428.1">. </span><span class="kobospan" id="kobo.428.2">The objects being created will all be considered as subclasses of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.429.1">Card</span></span></span></span><span class="kobospan" id="kobo.430.1"> class because it’s first in the list of base classes:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.431.1">
def make_cribbage_card(rank: int, suit: str) -&gt; Card: 
 
    if rank == 1: 
 
        return CribbageAce(rank, suit) 
 
    elif 2 &lt;= rank &lt; 11: 
 
        return CribbageCard(rank, suit) 
 
    elif 11 &lt;= rank: 
 
        return CribbageFace(rank, suit) 
 
    else: 
 
        raise ValueError(f"invalid rank {rank}")</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.432.1">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.433.1">make_cribbage_card()</span></span></span></span><span class="kobospan" id="kobo.434.1"> function to create a shuffled deck of cards, as shown in this example interactive session:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.435.1">
 
 
&gt;&gt;&gt; import random 
 
&gt;&gt;&gt; random.seed(1) 
 
&gt;&gt;&gt; deck = [make_cribbage_card(rank+1, suit) for rank in range(13) for suit in  SUITS] 
 
&gt;&gt;&gt; random.shuffle(deck) 
 
&gt;&gt;&gt; len(deck) 
 
52 
 
 
 
&gt;&gt;&gt; [str(c) for c in deck[:5]] 
 
[’ K ’, ’ 3 ’, ’10 ’, ’ 6 ’, ’ A ’]
                                                                     

                                                                     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.436.1">We can evaluate the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.437.1">points()</span></span></span></span><span class="kobospan" id="kobo.438.1"> method of each </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.439.1">Card</span></span></span></span><span class="kobospan" id="kobo.440.1"> object:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.441.1">
 
 
&gt;&gt;&gt; sum(c.points() for c in deck[:5]) 
 
30</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.442.1">The hand has two face cards, plus 3, 6, and ace, so the total points are 30. </span><span id="x1-463082r957"/></p>
</section>
<section data-number="0.11.2.3" id="how-it-works...-65">
<h2 class="likechapterhead" data-number="0.11.2.3"><span><span class="kobospan" id="kobo.443.1">8.2.3 </span></span> <span id="x1-4640003"/><span class="kobospan" id="kobo.444.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.445.1">Python’s mechanism</span><span id="dx1-464001"/><span class="kobospan" id="kobo.446.1"> for finding a method (or attribute) of an object works like this:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-464003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.447.1">Search the instance for the attribute.</span></p>
</div></li>
<li class="calibre7"><div id="x1-464005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.448.1">Search in the class for the method or attribute.</span></p>
</div></li>
<li class="calibre7"><div id="x1-464007x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.449.1">If the name is not defined in the immediate class, then search all of the parent classes for the method or attribute. </span><span class="kobospan" id="kobo.449.2">The parent classes are searched</span><span id="dx1-464008"/><span class="kobospan" id="kobo.450.1"> in a sequence called, appropriately, the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.451.1">Method Resolution</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.452.1">Order </span></span><span class="kobospan" id="kobo.453.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.454.1">MRO</span></span><span class="kobospan" id="kobo.455.1">).</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.456.1">We can display the MRO using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.457.1">mro()</span></span></span></span><span class="kobospan" id="kobo.458.1"> method of a class. </span><span class="kobospan" id="kobo.458.2">Here’s an example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.459.1">
 
 
&gt;&gt;&gt; c.__class__.__name__ 
 
’CribbageCard’ 
 
 
 
&gt;&gt;&gt; from pprint import pprint 
 
&gt;&gt;&gt; pprint(c.__class__.mro()) 
 
[&lt;class ’recipe_02.CribbageCard’&gt;, 
 
 &lt;class ’recipe_02.Card’&gt;, 
 
 &lt;class ’recipe_02.CribbagePoints’&gt;, 
 
 &lt;class ’recipe_02.PointedCard’&gt;, 
 
 &lt;class ’typing.Protocol’&gt;, 
 
 &lt;class ’typing.Generic’&gt;, 
 
 &lt;class ’object’&gt;]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.460.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.461.1">mro()</span></span></span></span><span class="kobospan" id="kobo.462.1"> method of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.463.1">CribbageCard</span></span></span></span><span class="kobospan" id="kobo.464.1"> class shows us the order that’s used to resolve names. </span><span class="kobospan" id="kobo.464.2">Because the class object uses an internal </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.465.1">dict</span></span></span></span><span class="kobospan" id="kobo.466.1"> to store method definitions, the search is an extremely</span><span id="dx1-464022"/><span class="kobospan" id="kobo.467.1"> fast hash-based lookup of the attribute name. </span><span id="x1-464023r967"/></p>
</section>
<section data-number="0.11.2.4" id="theres-more...-56">
<h2 class="likechapterhead" data-number="0.11.2.4"><span><span class="kobospan" id="kobo.468.1">8.2.4 </span></span> <span id="x1-4650004"/><span class="kobospan" id="kobo.469.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.470.1">There are several kinds of design concerns we can separate</span><span id="dx1-465001"/><span class="kobospan" id="kobo.471.1"> in the form of mixins:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.472.1">Persistence and representation of state</span></span><span class="kobospan" id="kobo.473.1">: A mixin class could add methods to manage conversion to a consistent external representation like CSV or JSON notation.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.474.1">Security</span></span><span class="kobospan" id="kobo.475.1">: A mixin class could add methods performs a consistent authorization check that applies to a number of base classes.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.476.1">Logging</span></span><span class="kobospan" id="kobo.477.1">: A mixin class could introduce a logger with a definition consistent across a variety of classes.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.478.1">Event signaling and change notification</span></span><span class="kobospan" id="kobo.479.1">: A mixin might report object state changes so one or more GUI widgets can refresh the display.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.480.1">As an example, we’ll create a mixin to introduce logging to cards. </span><span class="kobospan" id="kobo.480.2">We’ll define this class in a way that must be provided first in the list of superclasses. </span><span class="kobospan" id="kobo.480.3">Since it’s early in the MRO list, it uses the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.481.1">super()</span></span></span></span><span class="kobospan" id="kobo.482.1"> function to use methods defined by subsequent classes in the MRO list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.483.1">This class will add the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.484.1">logger</span></span></span></span><span class="kobospan" id="kobo.485.1"> attribute to each object that has the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.486.1">PointedCard</span></span></span></span><span class="kobospan" id="kobo.487.1"> protocol defined:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.488.1">
                                                                     

                                                                     
 
 
import logging 
 
 
 
class Logged(Card, PointedCard): 
 
    def __init__(self, rank: int, suit: str) -&gt; None: 
 
        self.logger = logging.getLogger(self.__class__.__name__) 
 
        super().__init__(rank, suit) 
 
 
 
    def points(self) -&gt; int: 
 
        p = super().points()  # type: ignore [safe-super] 
 
        self.logger.debug("points {0}", p) 
 
        return p</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.489.1">Note that we’ve used </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.490.1">super().__init__()</span></span></span></span><span class="kobospan" id="kobo.491.1"> to perform the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.492.1">__init__()</span></span></span></span><span class="kobospan" id="kobo.493.1"> method of any other classes defined. </span><span class="kobospan" id="kobo.493.2">The order for these initializations comes from the class MRO. </span><span class="kobospan" id="kobo.493.3">The simplest approach to have one class that defines the essential features of an object, and all other mixins add features in the form of additional methods to the essential object.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.494.1">We’ve provided an overriding definition for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.495.1">points()</span></span></span></span><span class="kobospan" id="kobo.496.1">. </span><span class="kobospan" id="kobo.496.2">This will search other classes in the MRO list for an implementation of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.497.1">points()</span></span></span></span><span class="kobospan" id="kobo.498.1"> method. </span><span class="kobospan" id="kobo.498.2">Then it will log the results computed by the method from another mixin class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.499.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.500.1">#</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.501.1"> type:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.502.1"> ignore</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.503.1"> [safe-super]</span></span></span></span><span class="kobospan" id="kobo.504.1"> comment is a note</span><span id="dx1-465014"/><span class="kobospan" id="kobo.505.1"> to tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.506.1">mypy </span></span><span class="kobospan" id="kobo.507.1">that do strict type-checking. </span><span class="kobospan" id="kobo.507.2">When we look at the definitions of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.508.1">PointedCard</span></span></span></span><span class="kobospan" id="kobo.509.1"> protocol, there’s no definition for this method. </span><span class="kobospan" id="kobo.509.2">From the tool’s examination of the class hierarchy, it’s possible that calling </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.510.1">super().points()</span></span></span></span><span class="kobospan" id="kobo.511.1"> is unsafe. </span><span class="kobospan" id="kobo.511.2">We’re sure this won’t happen in practice, because a mixin will always be present to define the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.512.1">points()</span></span></span></span><span class="kobospan" id="kobo.513.1"> method. </span><span class="kobospan" id="kobo.513.2">We’ve flagged the unsafe use of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.514.1">super()</span></span></span></span><span class="kobospan" id="kobo.515.1"> as an error to be ignored.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.516.1">Here are some classes that include the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.517.1">Logged</span></span></span></span><span class="kobospan" id="kobo.518.1"> mixin features:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.519.1">
 
 
class LoggedCribbageAce(Logged, AceCard, CribbagePoints): 
 
    pass 
 
 
 
class LoggedCribbageCard(Logged, Card, CribbagePoints): 
 
    pass 
 
 
 
class LoggedCribbageFace(Logged, FaceCard, CribbageFacePoints): 
 
    pass</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.520.1">Each of these classes are built from three separate class definitions. </span><span class="kobospan" id="kobo.520.2">Since the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.521.1">Logged</span></span></span></span><span class="kobospan" id="kobo.522.1"> class is provided first, we’re assured that all classes have consistent logging. </span><span class="kobospan" id="kobo.522.2">We’re also assured that any method in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.523.1">Logged</span></span></span></span><span class="kobospan" id="kobo.524.1"> can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.525.1">super()</span></span></span></span><span class="kobospan" id="kobo.526.1"> to locate an implementation in the class list that follows it in the sequence of classes in the definition.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.527.1">To make use of these classes, we’d need to define a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.528.1">make_logged_card()</span></span></span></span><span class="kobospan" id="kobo.529.1"> function to use these new classes. </span><span id="x1-465024r969"/></p>
</section>
<section data-number="0.11.2.5" id="see-also-63">
<h2 class="likechapterhead" data-number="0.11.2.5"><span><span class="kobospan" id="kobo.530.1">8.2.5 </span></span> <span id="x1-4660005"/><span class="kobospan" id="kobo.531.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.532.1">The method resolution order is computed when the class is created. </span><span class="kobospan" id="kobo.532.2">The algorithm used is called C3. </span><span class="kobospan" id="kobo.532.3">The process was originally developed for the Dylan language and is now also used by Python. </span><span class="kobospan" id="kobo.532.4">The C3 algorithm</span><span id="dx1-466001"/><span class="kobospan" id="kobo.533.1"> ensures that each parent class is searched exactly once. </span><span class="kobospan" id="kobo.533.2">It also ensures the relative ordering of superclasses is preserved; subclasses will be searched before any of their parent classes are examined. </span><span class="kobospan" id="kobo.533.3">More information</span><span id="dx1-466002"/><span class="kobospan" id="kobo.534.1"> is available at </span><a class="url" href="https://dl.acm.org/doi/10.1145/236337.236343"><span class="url1"><span class="kobospan" id="kobo.535.1">https://dl.acm.org/doi/10.1145/236337.236343</span></span></a><span class="kobospan" id="kobo.536.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.537.1">When considering multiple inheritance, it’s always essential to also consider whether or not a wrapper is a better design than a subclass. </span><span class="kobospan" id="kobo.537.2">See the </span><a href="ch012.xhtml#x1-4530001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.538.1">Choosing between inheritance and composition – the ”is-a”</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.539.1">question</span></span></a><span class="kobospan" id="kobo.540.1"> recipe.</span></p></li>
</ul>
<p class="normal1"><span id="x1-466003r955"/></p>
</section>
</section>
<section data-number="0.11.3" id="leveraging-pythons-duck-typing">
<h1 class="unnumbered" data-number="0.11.3"><span><span class="kobospan" id="kobo.541.1">8.3 </span></span> <span id="x1-4670003"/><span class="kobospan" id="kobo.542.1">Leveraging Python’s duck typing</span></h1>
<p class="normal"><span class="kobospan" id="kobo.543.1">When a design involves</span><span id="dx1-467001"/><span class="kobospan" id="kobo.544.1"> inheritance, there is often a clear relationship from a superclass to one or more subclasses. </span><span class="kobospan" id="kobo.544.2">In the </span><a href="ch012.xhtml#x1-4530001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.545.1">Choosing between inheritance</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.546.1">and composition – the ”is-a” question</span></span></a><span class="kobospan" id="kobo.547.1"> recipe of this chapter, as well as the </span><a href="ch011_split_001.xhtml#x1-4250009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.548.1">Extending a built-in collection – a list that does statistics</span></span></a><span class="kobospan" id="kobo.549.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.550.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.551.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.552.1">7</span></span></a><span class="kobospan" id="kobo.553.1">, we’ve looked at extensions that involve a proper subclass-superclass relationship.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.554.1">In order to have classes that can be used in place of one another (”polymorphic” classes), some languages require a common superclass. </span><span class="kobospan" id="kobo.554.2">In many cases, the common class doesn’t have concrete implementations for all of the methods; it’s called</span><span id="dx1-467002"/><span class="kobospan" id="kobo.555.1"> an abstract superclass.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.556.1">Python doesn’t </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.557.1">require </span></span><span class="kobospan" id="kobo.558.1">common superclasses. </span><span class="kobospan" id="kobo.558.2">The standard library offers the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.559.1">abc</span></span></span></span><span class="kobospan" id="kobo.560.1"> module to support creating abstract classes in cases where it can help to clarify the relationships among classes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.561.1">Instead of defining polymorphic classes with common</span><span id="dx1-467003"/><span class="kobospan" id="kobo.562.1"> superclasses, Python relies on </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.563.1">duck typing </span></span><span class="kobospan" id="kobo.564.1">to establish equivalence. </span><span class="kobospan" id="kobo.564.2">This name comes from the quote:</span></p>
<blockquote class="calibre8">
<p class="normal3"><span class="cmti-10x-x"><span class="kobospan" id="kobo.565.1">When I see a bird that walks like a duck and swims like a duck</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.566.1">and quacks like a duck, I call that bird a duck</span></span><span class="kobospan" id="kobo.567.1">.</span></p>
<p class="normal4"><span class="kobospan" id="kobo.568.1">(James Whitcomb Riley)</span></p>
</blockquote>
<p class="normal1"><span class="kobospan" id="kobo.569.1">In the case of Python class relationships, if two objects have the same methods and the same attributes, these similarities have the same effect as having a common superclass. </span><span class="kobospan" id="kobo.569.2">No formal definition of a common class is required.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.570.1">This recipe will show how to exploit</span><span id="dx1-467004"/><span class="kobospan" id="kobo.571.1"> the concept of duck typing to create polymorphic classes. </span><span class="kobospan" id="kobo.571.2">Instances of these classes can be used in place of each other, giving us more flexible designs. </span><span id="x1-467005r972"/></p>
<section data-number="0.11.3.1" id="getting-ready-65">
<h2 class="likechapterhead" data-number="0.11.3.1"><span><span class="kobospan" id="kobo.572.1">8.3.1 </span></span> <span id="x1-4680001"/><span class="kobospan" id="kobo.573.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.574.1">In some cases, it can be awkward to define a superclass for a number of loosely related implementation choices. </span><span class="kobospan" id="kobo.574.2">For example, if an application is spread across several modules, it might be challenging to factor out a common superclass and put this by itself in a separate module where it can be imported into other modules. </span><span class="kobospan" id="kobo.574.3">Instead of factoring out a common abstraction, it’s sometimes easier to create classes that will pass the ”duck test”: the various classes have the same methods and attributes; therefore, they are effectively interchangeable, polymorphic classes. </span><span id="x1-468001r974"/></p>
</section>
<section data-number="0.11.3.2" id="how-to-do-it...-66">
<h2 class="likechapterhead" data-number="0.11.3.2"><span><span class="kobospan" id="kobo.575.1">8.3.2 </span></span> <span id="x1-4690002"/><span class="kobospan" id="kobo.576.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.577.1">We’ll define a pair of classes to show how this works. </span><span class="kobospan" id="kobo.577.2">These classes will both simulate rolling a pair of dice. </span><span class="kobospan" id="kobo.577.3">We’ll create two distinct implementations that have enough common features that they are interchangeable:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-469002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.578.1">Start with a class, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.579.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.580.1">, with the required methods and attributes. </span><span class="kobospan" id="kobo.580.2">In this example, we’ll have one attribute, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.581.1">dice</span></span></span></span><span class="kobospan" id="kobo.582.1">, that retains the result of the last roll, and one method, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.583.1">roll()</span></span></span></span><span class="kobospan" id="kobo.584.1">, that changes the state of the dice:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.585.1">
import random 
 
 
 
class Dice1: 
 
    def __init__(self, seed: int | None = None) -&gt; None: 
 
        self._rng = random.Random(seed) 
 
        self.roll() 
 
    def roll(self) -&gt; tuple[int, ...]: 
 
        self.dice = ( 
 
            self._rng.randint(1, 6), 
 
            self._rng.randint(1, 6)) 
 
        return self.dice</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-469016x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.586.1">Define another class, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.587.1">Dice2</span></span></span></span><span class="kobospan" id="kobo.588.1">, with the same</span><span id="dx1-469017"/><span class="kobospan" id="kobo.589.1"> methods and attributes. </span><span class="kobospan" id="kobo.589.2">Here’s a somewhat more complex definition that creates a class that has the same signature as the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.590.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.591.1"> class:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.592.1">
import random 
 
 
 
class Die: 
 
    def __init__(self, rng: random.Random) -&gt; None: 
 
        self._rng = rng 
 
    def roll(self) -&gt; int: 
 
        return self._rng.randint(1, 6) 
 
 
 
class Dice2: 
 
    def __init__(self, seed: int | None = None) -&gt; None: 
 
        self._rng = random.Random(seed) 
 
        self._dice = [Die(self._rng) for _ in range(2)] 
 
        self.roll() 
 
    def roll(self) -&gt; tuple[int, ...]: 
 
        self.dice = tuple(d.roll() for d in self._dice) 
 
        return self.dice</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.593.1">At this point, the two classes, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.594.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.595.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.596.1">Dice2</span></span></span></span><span class="kobospan" id="kobo.597.1">, can be interchanged freely. </span><span class="kobospan" id="kobo.597.2">Here’s a function that accepts either class as an argument, creates an instance, and yields several rolls of the dice:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.598.1">                                                                     

                                                                     

 
 
from collections.abc import Iterator 
 
 
 
def roller( 
 
    dice_class: type[Dice1 | Dice2], 
 
    seed: int | None = None, 
 
    *, 
 
    samples: int = 10 
 
) -&gt; Iterator[tuple[int, ...]]: 
 
    dice = dice_class(seed) 
 
    for _ in range(samples): 
 
        yield dice.roll()</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.599.1">We can use this function providing either the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.600.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.601.1"> class or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.602.1">Dice2</span></span></span></span><span class="kobospan" id="kobo.603.1"> class for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.604.1">dice</span></span></span></span><span class="kobospan" id="kobo.605.1"> argument value. </span><span class="kobospan" id="kobo.605.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.606.1">type[Dice1</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.607.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.608.1"> Dice2]</span></span></span></span><span class="kobospan" id="kobo.609.1"> type hint specifies a union of multiple equivalent classes. </span><span class="kobospan" id="kobo.609.2">This function creates an instance of the given class in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.610.1">dice</span></span></span></span><span class="kobospan" id="kobo.611.1"> parameter, and can even provide the seed value. </span><span class="kobospan" id="kobo.611.2">Using a known seed creates reproducible results, often required for unit testing, and also used for reproducing statistical studies that involve randomized selection.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.612.1">The following interactive session</span><span id="dx1-469047"/><span class="kobospan" id="kobo.613.1"> shows the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.614.1">roller()</span></span></span></span><span class="kobospan" id="kobo.615.1"> function being applied to both classes:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.616.1">
 
 
&gt;&gt;&gt; list(roller(Dice1, 1, samples=5)) 
 
[(1, 3), (1, 4), (4, 4), (6, 4), (2, 1)] 
 
 
 
&gt;&gt;&gt; list(roller(Dice2, 1, samples=5)) 
 
[(1, 3), (1, 4), (4, 4), (6, 4), (2, 1)]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.617.1">The objects built from </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.618.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.619.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.620.1">Dice2</span></span></span></span><span class="kobospan" id="kobo.621.1"> have enough similarities that they’re indistinguishable. </span><span id="x1-469054r975"/></p>
</section>
<section data-number="0.11.3.3" id="how-it-works...-66">
<h2 class="likechapterhead" data-number="0.11.3.3"><span><span class="kobospan" id="kobo.622.1">8.3.3 </span></span> <span id="x1-4700003"/><span class="kobospan" id="kobo.623.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.624.1">We’ve created two classes with identical collections of attributes and methods. </span><span class="kobospan" id="kobo.624.2">This is the essence of duck typing. </span><span class="kobospan" id="kobo.624.3">Because of the way Python searches through a sequence of dictionaries for matching names, classes do not need to have a common superclass to be interchangeable.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.625.1">It can be helpful to define a union of related classes. </span><span class="kobospan" id="kobo.625.2">An alternative is to define a common </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.626.1">Protocol</span></span></span></span><span class="kobospan" id="kobo.627.1"> that the classes adhere to. </span><span class="kobospan" id="kobo.627.2">It’s not necessary for each class to explicitly inherit from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.628.1">Protocol</span></span></span></span><span class="kobospan" id="kobo.629.1"> definition, but it can make it more clear to your readers to do this. </span><span class="kobospan" id="kobo.629.2">Tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.630.1">mypy </span></span><span class="kobospan" id="kobo.631.1">can discern whether</span><span id="dx1-470001"/><span class="kobospan" id="kobo.632.1"> or not a class</span><span id="dx1-470002"/><span class="kobospan" id="kobo.633.1"> fits a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.634.1">Protocol</span></span></span></span><span class="kobospan" id="kobo.635.1">, which is how duck typing works. </span><span id="x1-470003r980"/></p>
</section>
<section data-number="0.11.3.4" id="theres-more...-57">
<h2 class="likechapterhead" data-number="0.11.3.4"><span><span class="kobospan" id="kobo.636.1">8.3.4 </span></span> <span id="x1-4710004"/><span class="kobospan" id="kobo.637.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.638.1">In the definition of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.639.1">roller()</span></span></span></span><span class="kobospan" id="kobo.640.1"> function, we used the following type hint: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.641.1">dice:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.642.1"> type[Dice1</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.643.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.644.1"> Dice2]</span></span></span></span><span class="kobospan" id="kobo.645.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.646.1">It’s often helpful to make this explicit with code like this:</span></p>
<pre class="programlisting" id="listing-40"><code class="calibre13"><span class="kobospan" id="kobo.647.1">Dice = Dice1 | Dice2</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.648.1">This can be easily extended as new alternative definitions are added. </span><span class="kobospan" id="kobo.648.2">Client classes can then use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.649.1">type[Dice]</span></span></span></span><span class="kobospan" id="kobo.650.1"> to refer to the union of alternatives.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.651.1">An alternative is to define a protocol. </span><span class="kobospan" id="kobo.651.2">A protocol</span><span id="dx1-471002"/><span class="kobospan" id="kobo.652.1"> defines a generic type with only the common features the various implementations will share:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.653.1">
 
 
class DiceP(Protocol): 
 
    def roll(self) -&gt; tuple[int, ...]: 
 
        ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.654.1">It helps to create type hints later in the development process. </span><span class="kobospan" id="kobo.654.2">After creating alternative implementations, it’s easy to define a type that’s a union of the various choices. </span><span class="kobospan" id="kobo.654.3">If more implementations arise, they can be added to the union.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.655.1">A protocol permits easier expansion of the alternatives. </span><span class="kobospan" id="kobo.655.2">The protocol defines only the relevant features of the implementations. </span><span class="kobospan" id="kobo.655.3">This is often done by refactoring the signatures of client methods and attributes to refer to the protocol class. </span><span id="x1-471007r981"/></p>
</section>
<section data-number="0.11.3.5" id="see-also-64">
<h2 class="likechapterhead" data-number="0.11.3.5"><span><span class="kobospan" id="kobo.656.1">8.3.5 </span></span> <span id="x1-4720005"/><span class="kobospan" id="kobo.657.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.658.1">The duck type question is implicit in the </span><a href="ch012.xhtml#x1-4530001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.659.1">Choosing between inheritance</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.660.1">and composition – the ”is-a” question</span></span></a><span class="kobospan" id="kobo.661.1"> recipe; if we leverage duck typing, we’re also making a claim that two classes are not the same thing. </span><span class="kobospan" id="kobo.661.2">When we bypass inheritance, we are implicitly claiming that the is-a relationship doesn’t hold.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.662.1">When looking at the </span><a href="ch012.xhtml#x1-4610002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.663.1">Separating concerns via multiple inheritance</span></span></a><span class="kobospan" id="kobo.664.1"> recipe, we’re also able to leverage duck typing to create composite classes that may not have a simple inheritance hierarchy.</span></p></li>
</ul>
<p class="normal1"><span id="x1-472001r973"/></p>
</section>
</section>
<section data-number="0.11.4" id="managing-global-and-singleton-objects">
<h1 class="unnumbered" data-number="0.11.4"><span><span class="kobospan" id="kobo.665.1">8.4 </span></span> <span id="x1-4730004"/><span class="kobospan" id="kobo.666.1">Managing global and singleton objects</span></h1>
<p class="normal"><span class="kobospan" id="kobo.667.1">The Python environment</span><span id="dx1-473001"/><span class="kobospan" id="kobo.668.1"> contains a number of implicit</span><span id="dx1-473002"/><span class="kobospan" id="kobo.669.1"> global objects. </span><span class="kobospan" id="kobo.669.2">These objects provide a convenient way to work with a collection of other objects. </span><span class="kobospan" id="kobo.669.3">Because the collection is implicit, we’re saved from the annoyance of explicit initialization code.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.670.1">One example of this is an implicit random number generating object in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.671.1">random</span></span></span></span><span class="kobospan" id="kobo.672.1"> module. </span><span class="kobospan" id="kobo.672.2">When we evaluate </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.673.1">random.random()</span></span></span></span><span class="kobospan" id="kobo.674.1">, we’re actually making use of an instance of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.675.1">random.Random</span></span></span></span><span class="kobospan" id="kobo.676.1"> class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.677.1">Because a module is only imported once, a module</span><span id="dx1-473003"/><span class="kobospan" id="kobo.678.1"> implements the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.679.1">Singleton</span></span><span class="kobospan" id="kobo.680.1"> design pattern. </span><span class="kobospan" id="kobo.680.2">We can rely on this technique to implement these global singletons.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.681.1">Other examples of this include the following:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.682.1">The collection of data encoders and decoders (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.683.1">codecs</span></span><span class="kobospan" id="kobo.684.1">) available. </span><span class="kobospan" id="kobo.684.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.685.1">codecs</span></span></span></span><span class="kobospan" id="kobo.686.1"> module has a registry for encoders and decoders. </span><span class="kobospan" id="kobo.686.2">We can add encodings and decodings to this registry.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.687.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.688.1">webbrowser</span></span></span></span><span class="kobospan" id="kobo.689.1"> module has a registry of known browsers.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.690.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.691.1">numbers</span></span></span></span><span class="kobospan" id="kobo.692.1"> module has a registry of numeric data types. </span><span class="kobospan" id="kobo.692.2">This allows a module to define a new implementation of a numeric type and add it to the mix of known types.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.693.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.694.1">logging</span></span></span></span><span class="kobospan" id="kobo.695.1"> module maintains a collection of named loggers. </span><span class="kobospan" id="kobo.695.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.696.1">getLogger()</span></span></span></span><span class="kobospan" id="kobo.697.1"> function tries to find an existing logger; it creates a new logger if needed.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.698.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.699.1">re</span></span></span></span><span class="kobospan" id="kobo.700.1"> module has a cache of compiled regular expressions. </span><span class="kobospan" id="kobo.700.2">This saves the time to recompile a regular expression that’s defined inside a method or function.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.701.1">This recipe will show how to work with an implicit global object like the registries used for codecs, browsers, and number classes. </span><span id="x1-473004r983"/></p>
<section data-number="0.11.4.1" id="getting-ready-66">
<h2 class="likechapterhead" data-number="0.11.4.1"><span><span class="kobospan" id="kobo.702.1">8.4.1 </span></span> <span id="x1-4740001"/><span class="kobospan" id="kobo.703.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.704.1">A collection of functions</span><span id="dx1-474001"/><span class="kobospan" id="kobo.705.1"> can all work with an implicit</span><span id="dx1-474002"/><span class="kobospan" id="kobo.706.1"> global object, created by a module. </span><span class="kobospan" id="kobo.706.2">The benefit is to allow other modules to share a common object without having to write any code that explicitly coordinates sharing.</span></p>
<div class="tipbox" id="tcolobox-14">
<div class="note">
<p class="normal1"><span class="kobospan" id="kobo.707.1">This is potentially confusing to people reading your code.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.708.1">The idea of shared global state can become a design nightmare. </span><span class="kobospan" id="kobo.708.2">The further step of making a shared object implicit may compound the problem.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.709.1">Looking at the examples from the Python standard library, there are two important patterns. </span><span class="kobospan" id="kobo.709.2">First, there’s a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.710.1">narrow focus</span></span><span class="kobospan" id="kobo.711.1">. </span><span class="kobospan" id="kobo.711.2">Second, the updates to the registry are limited to adding new instances.</span></p>
</div>
</div>
<p class="normal1"><span class="kobospan" id="kobo.712.1">As an example, we’ll define a module with a global singleton object. </span><span class="kobospan" id="kobo.712.2">We’ll look more at modules in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.713.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.714.1"> </span></span><a href="ch017.xhtml#x1-71500013" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.715.1">13</span></span></a><span class="kobospan" id="kobo.716.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.717.1">Our global object will be a counter that we can use to accumulate centralized data from several independent modules or objects. </span><span class="kobospan" id="kobo.717.2">We’ll use this global to count events in the application. </span><span class="kobospan" id="kobo.717.3">The counts provide a summary of the work completed, and a check to confirm that </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.718.1">all </span></span><span class="kobospan" id="kobo.719.1">the work was completed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.720.1">The goal is to be able to write something like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.721.1">
 
 
for row in source: 
 
    count(’input’) 
 
    some_processing() 
 
print(counts())</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.722.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.723.1">some_processing()</span></span></span></span><span class="kobospan" id="kobo.724.1"> function might use something like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.725.1">count(’reject’)</span></span></span></span><span class="kobospan" id="kobo.726.1"> to count rejected input rows. </span><span class="kobospan" id="kobo.726.2">This function may call other functions that also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.727.1">count()</span></span></span></span><span class="kobospan" id="kobo.728.1"> function to record evidence of the processing.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.729.1">These two independent functions both refer to a shared global counter:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.730.1">count(key)</span></span></span></span><span class="kobospan" id="kobo.731.1"> increments a global </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.732.1">Counter</span></span></span></span><span class="kobospan" id="kobo.733.1"> and returns the current value for the given key.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.734.1">counts()</span></span></span></span><span class="kobospan" id="kobo.735.1"> provides all of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.736.1">Counter</span></span></span></span><span class="kobospan" id="kobo.737.1"> values.</span></p></li>
</ul>
<p class="normal1"><span id="x1-474008r985"/></p>
</section>
<section data-number="0.11.4.2" id="how-to-do-it...-67">
<h2 class="likechapterhead" data-number="0.11.4.2"><span><span class="kobospan" id="kobo.738.1">8.4.2 </span></span> <span id="x1-4750002"/><span class="kobospan" id="kobo.739.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.740.1">There are two common ways</span><span id="dx1-475001"/><span class="kobospan" id="kobo.741.1"> to handle global</span><span id="dx1-475002"/><span class="kobospan" id="kobo.742.1"> state information:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.743.1">Use a module global variable because modules are singleton objects.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.744.1">Use a class-level variable (called </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.745.1">static</span></span></span></span><span class="kobospan" id="kobo.746.1"> in some programming languages). </span><span class="kobospan" id="kobo.746.2">In Python, a class definition is also a singleton object that can be shared.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.747.1">We’ll cover these as separate mini-recipes, starting with module globals.</span></p>
<section data-number="0.11.4.2.1" id="module-global-variables">
<h3 class="likesubsubsectionhead" data-number="0.11.4.2.1"><span id="x1-4760002"/><span class="kobospan" id="kobo.748.1">Module global variables</span></h3>
<p class="normal"><span class="kobospan" id="kobo.749.1">We can do the following to create a variable</span><span id="dx1-476001"/><span class="kobospan" id="kobo.750.1"> that is global to a module:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-476003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.751.1">Create a module file. </span><span class="kobospan" id="kobo.751.2">This will be a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.752.1">.py</span></span></span></span><span class="kobospan" id="kobo.753.1"> file with the definitions in it. </span><span class="kobospan" id="kobo.753.2">We’ll call it </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.754.1">counter.py</span></span></span></span><span class="kobospan" id="kobo.755.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-476005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.756.1">If necessary, define a class for the global singleton. </span><span class="kobospan" id="kobo.756.2">In our case, we can use this definition to create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.757.1">collections.Counter</span></span></span></span><span class="kobospan" id="kobo.758.1"> object:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.759.1">                                                                     

                                                                     

from collections import Counter</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-476009x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.760.1">Define the one and only instance of the global singleton object. </span><span class="kobospan" id="kobo.760.2">We’ve used a leading </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.761.1">_</span></span></span></span><span class="kobospan" id="kobo.762.1"> in the name to make it slightly less visible. </span><span class="kobospan" id="kobo.762.2">It’s not — technically — private. </span><span class="kobospan" id="kobo.762.3">It is, however, gracefully ignored by many Python tools and utilities:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.763.1">
_global_counter: Counter[str] = Counter()</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.764.1">A common idiom for marking global variables is to use an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.765.1">ALL_CAPS</span></span></span></span><span class="kobospan" id="kobo.766.1"> name. </span><span class="kobospan" id="kobo.766.2">This seems more important for global variables that are to be considered as constants. </span><span class="kobospan" id="kobo.766.3">In this case, this variable will be updated, and an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.767.1">ALL_CAPS</span></span></span></span><span class="kobospan" id="kobo.768.1"> name seems misleading.</span></p>
</div></li>
<li class="calibre7"><div id="x1-476013x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.769.1">Define the two functions to use the global object, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.770.1">_global_counter</span></span></span></span><span class="kobospan" id="kobo.771.1">. </span><span class="kobospan" id="kobo.771.2">These functions encapsulate the detail of how the counter is implemented:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.772.1">
def count(key: str, increment: int = 1) -&gt; None: 
 
    _global_counter[key] += increment 
 
 
 
def counts() -&gt; list[tuple[str, int]]: 
 
    return _global_counter.most_common()
                                                                     

                                                                     </span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.773.1">Now we can write applications</span><span id="dx1-476020"/><span class="kobospan" id="kobo.774.1"> that use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.775.1">count()</span></span></span></span><span class="kobospan" id="kobo.776.1"> function in a variety of places. </span><span class="kobospan" id="kobo.776.2">The counted events, however, are fully centralized in a single object, defined as part of the module.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.777.1">We might have code that looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.778.1">
 
 
&gt;&gt;&gt; from counter import * 
 
&gt;&gt;&gt; from recipe_03 import Dice1 
 
 
 
&gt;&gt;&gt; d = Dice1(1) 
 
&gt;&gt;&gt; for _ in range(1000): 
 
... </span><span class="kobospan" id="kobo.778.2">    if sum(d.roll()) == 7: 
 
... </span><span class="kobospan" id="kobo.778.3">        count(’seven’) 
 
... </span><span class="kobospan" id="kobo.778.4">    else: 
 
... </span><span class="kobospan" id="kobo.778.5">        count(’other’) 
 
&gt;&gt;&gt; print(counts()) 
 
[(’other’, 833), (’seven’, 167)]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.779.1">We’ve imported the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.780.1">count()</span></span></span></span><span class="kobospan" id="kobo.781.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.782.1">counts()</span></span></span></span><span class="kobospan" id="kobo.783.1"> functions from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.784.1">counter</span></span></span></span><span class="kobospan" id="kobo.785.1"> module. </span><span class="kobospan" id="kobo.785.2">We’ve also imported the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.786.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.787.1"> class as a handy object that creates a sequence of events. </span><span class="kobospan" id="kobo.787.2">When we create an instance of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.788.1">Dice1</span></span></span></span><span class="kobospan" id="kobo.789.1">, we provide an initialization to force a particular random seed. </span><span class="kobospan" id="kobo.789.2">This gives repeatable results.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.790.1">The benefit of this technique is that several modules can all share the global object within the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.791.1">counter</span></span></span></span><span class="kobospan" id="kobo.792.1"> module. </span><span class="kobospan" id="kobo.792.2">All that’s required</span><span id="dx1-476033"/><span class="kobospan" id="kobo.793.1"> is an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.794.1">import</span></span></span></span><span class="kobospan" id="kobo.795.1"> statement. </span><span class="kobospan" id="kobo.795.2">No further coordination or overheads are necessary.</span></p>
</section>
<section data-number="0.11.4.2.2" id="class-level-static-variables">
<h3 class="likesubsubsectionhead" data-number="0.11.4.2.2"><span id="x1-4770002"/><span class="kobospan" id="kobo.796.1">Class-level ”static” variables</span></h3>
<p class="normal"><span class="kobospan" id="kobo.797.1">We can do the following to create</span><span id="dx1-477001"/><span class="kobospan" id="kobo.798.1"> a variable that is global to all instances of a class definition:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-477003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.799.1">Define a class with a variable outside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.800.1">__init__()</span></span></span></span><span class="kobospan" id="kobo.801.1"> method. </span><span class="kobospan" id="kobo.801.2">This variable is part of the class, not part of an instance. </span><span class="kobospan" id="kobo.801.3">To make it clear that the attribute is shared by all instances of the class, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.802.1">ClassVar</span></span></span></span><span class="kobospan" id="kobo.803.1"> type hint is helpful. </span><span class="kobospan" id="kobo.803.2">In this example, we’ve decided to use a leading </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.804.1">_</span></span></span></span><span class="kobospan" id="kobo.805.1"> so the class-level variable is not seen as part of the public interface:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.806.1">
from collections import Counter 
 
from typing import ClassVar 
 
 
 
class EventCounter: 
 
 
 
    _class_counter: ClassVar[Counter[str]] = Counter()</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-477012x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.807.1">Add methods to update and extract data from the class-level </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.808.1">_class_counter</span></span></span></span><span class="kobospan" id="kobo.809.1"> attribute. </span><span class="kobospan" id="kobo.809.2">These will use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.810.1">@classmethod</span></span></span></span><span class="kobospan" id="kobo.811.1"> decorators to show they are used directly by the class, not by an instance. </span><span class="kobospan" id="kobo.811.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.812.1">self</span></span></span></span><span class="kobospan" id="kobo.813.1"> variable is not used; instead, a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.814.1">cls</span></span></span></span><span class="kobospan" id="kobo.815.1"> variable is used as a reminder that the method applies to the class:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.816.1">
    @classmethod 
 
    def count(cls, key: str, increment: int = 1) -&gt; None: 
 
        cls._class_counter[key] += increment 
 
 
 
    @classmethod 
 
    def counts(cls) -&gt; list[tuple[str, int]]: 
 
        return cls._class_counter.most_common()</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.817.1">It’s very important to note that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.818.1">_class_counter</span></span></span></span><span class="kobospan" id="kobo.819.1"> attribute is part of the class, and is referred to as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.820.1">cls._class_counter</span></span></span></span><span class="kobospan" id="kobo.821.1">. </span><span class="kobospan" id="kobo.821.2">We don’t use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.822.1">self</span></span></span></span><span class="kobospan" id="kobo.823.1"> instance variable because we aren’t referring to an instance of the class; we’re referring to a variable that’s part of the overall class definition, provided as the first parameter to a method decorated with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.824.1">@classmethod</span></span></span></span><span class="kobospan" id="kobo.825.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.826.1">Here’s how we can use this class.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.827.1">
 
 
&gt;&gt;&gt; from counter import * 
 
&gt;&gt;&gt; EventCounter.count(’input’) 
 
 
 
&gt;&gt;&gt; EventCounter.count(’input’) 
 
&gt;&gt;&gt; EventCounter.count(’filter’) 
 
 
 
&gt;&gt;&gt; EventCounter.counts() 
 
[(’input’, 2), (’filter’, 1)]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.828.1">Since all these operations update</span><span id="dx1-477030"/><span class="kobospan" id="kobo.829.1"> the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.830.1">EventCounter</span></span></span></span><span class="kobospan" id="kobo.831.1"> class, each increments the shared variable.</span></p>
<div class="tipbox" id="tcolobox-15">
<div class="note">
<p class="normal1"><span class="kobospan" id="kobo.832.1">Shared global state must be used carefully.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.833.1">They may be tangential to the real work of the class. </span><span class="kobospan" id="kobo.833.2">The focus must be narrow and limited to very state changes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.834.1">When in doubt, explicitly shared objects will be a better design strategy, but will involve a bit more code.</span></p>
</div>
</div>
<p class="normal1"><span id="x1-477031r987"/></p>
</section>
</section>
<section data-number="0.11.4.3" id="how-it-works...-67">
<h2 class="likechapterhead" data-number="0.11.4.3"><span><span class="kobospan" id="kobo.835.1">8.4.3 </span></span> <span id="x1-4780003"/><span class="kobospan" id="kobo.836.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.837.1">The Python import mechanism</span><span id="dx1-478001"/><span class="kobospan" id="kobo.838.1"> uses </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.839.1">sys.modules</span></span></span></span><span class="kobospan" id="kobo.840.1"> to track</span><span id="dx1-478002"/><span class="kobospan" id="kobo.841.1"> which modules are loaded. </span><span class="kobospan" id="kobo.841.2">Once a module is in this mapping, it is not loaded again. </span><span class="kobospan" id="kobo.841.3">This means that any variable defined within a module will be a singleton: there will only be one instance.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.842.1">Within a module, a class definition can only be created once. </span><span class="kobospan" id="kobo.842.2">This means the internal state changes of a class also follow the Singleton design pattern.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.843.1">How can we choose between these two mechanisms? </span><span class="kobospan" id="kobo.843.2">The choice is based on the degree of confusion created by having multiple classes sharing a global state. </span><span class="kobospan" id="kobo.843.3">As shown in the previous example in </span><a href="ch012.xhtml#x1-4770002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.844.1">Class-level ”static” variables</span></span></a><span class="kobospan" id="kobo.845.1">, we could have multiple variables sharing a common </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.846.1">Counter</span></span></span></span><span class="kobospan" id="kobo.847.1"> object. </span><span class="kobospan" id="kobo.847.2">If the presence of an implicitly shared global state seems confusing, then a module-level global is a better choice. </span><span class="kobospan" id="kobo.847.3">In the cases where a module-level global is confusing, share state explicitly</span><span id="dx1-478003"/><span class="kobospan" id="kobo.848.1"> with ordinary visible</span><span id="dx1-478004"/><span class="kobospan" id="kobo.849.1"> variables. </span><span id="x1-478005r997"/></p>
</section>
<section data-number="0.11.4.4" id="theres-more...-58">
<h2 class="likechapterhead" data-number="0.11.4.4"><span><span class="kobospan" id="kobo.850.1">8.4.4 </span></span> <span id="x1-4790004"/><span class="kobospan" id="kobo.851.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.852.1">A shared global state</span><span id="dx1-479001"/><span class="kobospan" id="kobo.853.1"> can be called the opposite of object-oriented programming. </span><span class="kobospan" id="kobo.853.2">One ideal of object-oriented programming is to encapsulate state changes in individual objects. </span><span class="kobospan" id="kobo.853.3">Used too broadly, global variables break the idea of encapsulation of state within a single object.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.854.1">In a sense, a module is a kind of class-like structure. </span><span class="kobospan" id="kobo.854.2">A module is a namespace with module-level variables to define state and module functions that are like methods.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.855.1">One example of a need for a common global state often arises when trying to define configuration parameters for an application. </span><span class="kobospan" id="kobo.855.2">It can help to have a single, uniform configuration that’s shared widely throughout multiple modules. </span><span class="kobospan" id="kobo.855.3">When these objects are used for pervasive features such as configuration, audits, logging, and security, globals can be helpful for segregating a single, focused cross-cutting concern into a generic class separate from application-specific classes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.856.1">An alternative is to create a configuration object explicitly. </span><span class="kobospan" id="kobo.856.2">This configuration object can then be provided as a parameter to other objects throughout an application. </span><span id="x1-479002r998"/></p>
</section>
<section data-number="0.11.4.5" id="see-also-65">
<h2 class="likechapterhead" data-number="0.11.4.5"><span><span class="kobospan" id="kobo.857.1">8.4.5 </span></span> <span id="x1-4800005"/><span class="kobospan" id="kobo.858.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="cmti-10x-x"><span class="kobospan" id="kobo.859.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.860.1"> </span></span><a href="ch018.xhtml#x1-75800014" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.861.1">14</span></span></a><span class="kobospan" id="kobo.862.1"> covers additional topics in module and application design.</span></p></li>
</ul>
<p class="normal1"><span id="x1-480001r984"/></p>
</section>
</section>
<section data-number="0.11.5" id="using-more-complex-structures-maps-of-lists">
<h1 class="unnumbered" data-number="0.11.5"><span><span class="kobospan" id="kobo.863.1">8.5 </span></span> <span id="x1-4810005"/><span class="kobospan" id="kobo.864.1">Using more complex structures – maps of lists</span></h1>
<p class="normal"><span class="kobospan" id="kobo.865.1">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.866.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.867.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.868.1">4</span></span></a><span class="kobospan" id="kobo.869.1">, we looked at the basic</span><span id="dx1-481001"/><span class="kobospan" id="kobo.870.1"> data structures available in Python. </span><span class="kobospan" id="kobo.870.2">Those recipes generally looked at the various structures in isolation.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.871.1">We’ll look at a common combination structure—the mapping from a single key to a list of related values. </span><span class="kobospan" id="kobo.871.2">This can be used to accumulate detailed information about database or log records identified by a given key. </span><span class="kobospan" id="kobo.871.3">This recipe will partition a flat list of details into lists organized by shared key values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.872.1">This blurs into class design because we can often leverage Python’s built-in classes for this kind of work. </span><span class="kobospan" id="kobo.872.2">This can reduces the volume of unique, new code we have to write. </span><span id="x1-481002r999"/></p>
<section data-number="0.11.5.1" id="getting-ready-67">
<h2 class="likechapterhead" data-number="0.11.5.1"><span><span class="kobospan" id="kobo.873.1">8.5.1 </span></span> <span id="x1-4820001"/><span class="kobospan" id="kobo.874.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.875.1">We’ll look at a mapping</span><span id="dx1-482001"/><span class="kobospan" id="kobo.876.1"> from a string to a list of instances of a class we’ll design. </span><span class="kobospan" id="kobo.876.2">We’re going to start with some raw log entries from an application, decompose each line into individual fields, and then create individual </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.877.1">Event</span></span></span></span><span class="kobospan" id="kobo.878.1"> objects from the fields of data. </span><span class="kobospan" id="kobo.878.2">Once we have these objects, we can then reorganize and regroup them into lists associated with common attribute values like module name, or message severity.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.879.1">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.880.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.881.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.882.1">5</span></span></a><span class="kobospan" id="kobo.883.1">, we looked at log data in the </span><a href="ch009.xhtml#x1-2900001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.884.1">Creating dictionaries – inserting and</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.885.1">updating</span></span></a><span class="kobospan" id="kobo.886.1"> recipe.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.887.1">The first step will be to transform the log</span><span id="dx1-482002"/><span class="kobospan" id="kobo.888.1"> lines into a more useful </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.889.1">comma-separated value </span></span><span class="kobospan" id="kobo.890.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.891.1">CSV</span></span><span class="kobospan" id="kobo.892.1">) format. </span><span class="kobospan" id="kobo.892.2">A regular expression can pick out the various syntactic groups. </span><span class="kobospan" id="kobo.892.3">See the </span><a href="ch005_split_000.xhtml#x1-350003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.893.1">String parsing with regular expressions</span></span></a><span class="kobospan" id="kobo.894.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.895.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.896.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.897.1">1</span></span></a><span class="kobospan" id="kobo.898.1"> for information on how the parsing works.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.899.1">The raw data looks like the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.900.1">
 
 
[2016-04-24 11:05:01,462] INFO in module1: Sample Message One 
 
[2016-04-24 11:06:02,624] DEBUG in module2: Debugging 
 
[2016-04-24 11:07:03,246] WARNING in module1: Something might have gone wrong</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.901.1">Each row can be parsed into the component fields with a regular expression. </span><span class="kobospan" id="kobo.901.2">We’ll define a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.902.1">NamedTuple</span></span></span></span><span class="kobospan" id="kobo.903.1"> subclass that has a static method, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.904.1">from_line()</span></span></span></span><span class="kobospan" id="kobo.905.1">, to create instances of the class using these four fields. </span><span class="kobospan" id="kobo.905.2">Making sure the attribute names match the regular expression group names, we can build instances of the class using the following definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.906.1">
 
 
import re 
 
from typing import NamedTuple 
 
 
 
class Event(NamedTuple): 
 
    timestamp: str 
 
    level: str 
 
    module: str 
 
    message: str 
 
 
 
    @staticmethod 
 
    def from_line(line: str) -&gt; ’Event | None’: 
 
        pattern = re.compile( 
 
            r"\[(?P&lt;timestamp&gt;.*?)\]\s+" 
 
            r"(?P&lt;level&gt;\w+)\s+" 
 
            r"in\s+(?P&lt;module&gt;\w+)" 
 
            r":\s+(?P&lt;message&gt;.*)" 
 
            ) 
 
        if log_line := pattern.match(line): 
 
            return Event(**log_line.groupdict()) 
 
        else: 
 
            return None
                                                                     

                                                                     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.907.1">Our objective is to group the log messages</span><span id="dx1-482029"/><span class="kobospan" id="kobo.908.1"> by the module name attribute. </span><span class="kobospan" id="kobo.908.2">We want to see something like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.909.1">
 
 
&gt;&gt;&gt; pprint(summary) 
 
{’module1’: [ 
 
   Event(’2016-04-24 11:05:01,462’, ’INFO’, ’module1’, ’Sample Message One’), 
 
   Event(’2016-04-24 11:07:03,246’, ’WARNING’, ’module1’, ’Something might have gone wrong’)], 
 
 ’module2’: [ 
 
   Event(’2016-04-24 11:06:02,624’, ’DEBUG’, ’module2’, ’Debugging’)] 
 
}</span></code></pre>
<p class="normal1"><span id="x1-482038r1001"/></p>
</section>
<section data-number="0.11.5.2" id="how-to-do-it...-68">
<h2 class="likechapterhead" data-number="0.11.5.2"><span><span class="kobospan" id="kobo.910.1">8.5.2 </span></span> <span id="x1-4830002"/><span class="kobospan" id="kobo.911.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.912.1">We can write a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.913.1">summarize()</span></span></span></span><span class="kobospan" id="kobo.914.1"> function to restructure the log data as follows:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-483002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.915.1">Import the required modules and some type hints for various kinds of collections:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.916.1">
from collections import defaultdict 
 
from collections.abc import Iterable</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.917.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.918.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.919.1"> type is a concrete class that extends the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.920.1">MutableMapping</span></span></span></span><span class="kobospan" id="kobo.921.1"> abstract base class. </span><span class="kobospan" id="kobo.921.2">This is in a separate module from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.922.1">Iterable</span></span></span></span><span class="kobospan" id="kobo.923.1"> type hint, which is an abstract base class definition.</span></p>
</div></li>
<li class="calibre7"><div id="x1-483007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.924.1">The source data type, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.925.1">Event</span></span></span></span><span class="kobospan" id="kobo.926.1"> class, was shown in the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.927.1">Getting ready</span></span><span class="kobospan" id="kobo.928.1"> section.</span></p>
</div></li>
<li class="calibre7"><div id="x1-483009x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.929.1">Define an overall type hint for the summary dictionary we’ll be working with:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.930.1">
from typing import TypeAlias 
 
Summary: TypeAlias = defaultdict[str, list[Event]]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-483014x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.931.1">Start the definition of a function to summarize an iterable source of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.932.1">Event</span></span></span></span><span class="kobospan" id="kobo.933.1"> instances, and produce a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.934.1">Summary</span></span></span></span><span class="kobospan" id="kobo.935.1"> object:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.936.1">
def summarize(data: Iterable[Event]) -&gt; Summary:</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-483018x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.937.1">Use the list function as the default</span><span id="dx1-483019"/><span class="kobospan" id="kobo.938.1"> value for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.939.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.940.1">. </span><span class="kobospan" id="kobo.940.2">It’s also helpful to create a type hint for this collection:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.941.1">
    module_details: Summary = defaultdict(list)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.942.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.943.1">list</span></span></span></span><span class="kobospan" id="kobo.944.1"> function is provided as a name only. </span><span class="kobospan" id="kobo.944.2">A common mistake using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.945.1">list()</span></span></span></span><span class="kobospan" id="kobo.946.1"> will evaluate the function and create a list object that is not a function. </span><span class="kobospan" id="kobo.946.2">An error message like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.947.1">TypeError:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.948.1"> first</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.949.1"> argument</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.950.1"> must</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.951.1"> be</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.952.1"> callable</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.953.1"> or</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.954.1"> None</span></span></span></span><span class="kobospan" id="kobo.955.1"> is a reminder that the argument must be the name of a function only.</span></p>
</div></li>
<li class="calibre7"><div id="x1-483023x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.956.1">Iterate through the data, appending to the list associated with each key. </span><span class="kobospan" id="kobo.956.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.957.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.958.1"> object will use the supplied </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.959.1">list()</span></span></span></span><span class="kobospan" id="kobo.960.1"> function to build an empty list as the value corresponding to each new key the first time each key is encountered:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.961.1">
    for event in data: 
 
        module_details[event.module].append(event) 
 
    return module_details</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.962.1">The result of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.963.1">summarize()</span></span></span></span><span class="kobospan" id="kobo.964.1"> function is a dictionary that maps from a module name string to a list of all log rows for that module name. </span><span class="kobospan" id="kobo.964.2">The data will look like the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.965.1">
 
 
&gt;&gt;&gt; pprint(summary) 
 
defaultdict(&lt;class ’list’&gt;, 
 
            {’module1’: [Event(timestamp=’2016-04-24 11:05:01,462’, level=’INFO’, module=’module1’, message=’Sample Message One’), 
 
                         Event(timestamp=’2016-04-24 11:07:03,246’, level=’WARNING’, module=’module1’, message=’Something might have gone wrong’)], 
 
             ’module2’: [Event(timestamp=’2016-04-24 11:06:02,624’, level=’DEBUG’, module=’module2’, message=’Debugging’)]})</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.966.1">The key for this mapping is the module name and the value in the mapping is the list of rows for that module name. </span><span class="kobospan" id="kobo.966.2">We can now focus the analysis on a specific module. </span><span class="kobospan" id="kobo.966.3">This seems to be a close match with the initial expectations</span><span id="dx1-483034"/><span class="kobospan" id="kobo.967.1"> for the summarized results. </span><span id="x1-483035r1005"/></p>
</section>
<section data-number="0.11.5.3" id="how-it-works...-68">
<h2 class="likechapterhead" data-number="0.11.5.3"><span><span class="kobospan" id="kobo.968.1">8.5.3 </span></span> <span id="x1-4840003"/><span class="kobospan" id="kobo.969.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.970.1">There are two choices for how a mapping behaves when a key is not found:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.971.1">The built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.972.1">dict</span></span></span></span><span class="kobospan" id="kobo.973.1"> class raises an exception when a key is missing. </span><span class="kobospan" id="kobo.973.2">This makes it difficult to accumulate values associated with keys that aren’t known in advance.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.974.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.975.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.976.1"> class evaluates a function that creates a default value when a key is missing. </span><span class="kobospan" id="kobo.976.2">In many cases, the function is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.977.1">int</span></span></span></span><span class="kobospan" id="kobo.978.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.979.1">float</span></span></span></span><span class="kobospan" id="kobo.980.1"> to create a default numeric value of 0 or 0.0. </span><span class="kobospan" id="kobo.980.2">In this case, the function is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.981.1">list</span></span></span></span><span class="kobospan" id="kobo.982.1"> to create an empty list.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.983.1">We can imagine using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.984.1">set</span></span></span></span><span class="kobospan" id="kobo.985.1"> function instead of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.986.1">list</span></span></span></span><span class="kobospan" id="kobo.987.1"> to create an empty set object for a missing key. </span><span class="kobospan" id="kobo.987.2">This would be suitable for a mapping from a key to a set of immutable objects that share that key. </span><span id="x1-484001r1012"/></p>
</section>
<section data-number="0.11.5.4" id="theres-more...-59">
<h2 class="likechapterhead" data-number="0.11.5.4"><span><span class="kobospan" id="kobo.988.1">8.5.4 </span></span> <span id="x1-4850004"/><span class="kobospan" id="kobo.989.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.990.1">We can also build a version of this as an extension to the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.991.1">dict</span></span></span></span><span class="kobospan" id="kobo.992.1"> class:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.993.1">
 
 
class ModuleEvents(dict[str, list[Event]]): 
 
    def __missing__(self, key: str) -&gt; list[Event]: 
 
        self[key] = list() 
 
        return self[key]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.994.1">We’ve provided an implementation for the special </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.995.1">__missing__()</span></span></span></span><span class="kobospan" id="kobo.996.1"> method. </span><span class="kobospan" id="kobo.996.2">The default behavior is to raise a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.997.1">KeyError</span></span></span></span><span class="kobospan" id="kobo.998.1"> exception. </span><span class="kobospan" id="kobo.998.2">This will create a new empty list in the mapping.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.999.1">This allows us to use code such as the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1000.1">
 
 
&gt;&gt;&gt; event_iter = (Event.from_line(l) for l in log_data.splitlines()) 
 
&gt;&gt;&gt; module_details = ModuleEvents() 
 
&gt;&gt;&gt; for event in filter(None, event_iter):</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1001.1">The use case is identical to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1002.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.1003.1">, but the definition of the collection class is slightly more complicated. </span><span class="kobospan" id="kobo.1003.2">This permits further extension to add features to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1004.1">ModuleEvents</span></span></span></span><span class="kobospan" id="kobo.1005.1"> class. </span><span id="x1-485010r1013"/></p>
</section>
<section data-number="0.11.5.5" id="see-also-66">
<h2 class="likechapterhead" data-number="0.11.5.5"><span><span class="kobospan" id="kobo.1006.1">8.5.5 </span></span> <span id="x1-4860005"/><span class="kobospan" id="kobo.1007.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1008.1">In the </span><a href="ch009.xhtml#x1-2900001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1009.1">Creating dictionaries – inserting and updating</span></span></a><span class="kobospan" id="kobo.1010.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1011.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1012.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1013.1">4</span></span></a><span class="kobospan" id="kobo.1014.1">, we looked at the basics of using a mapping.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1015.1">In the </span><a href="ch009.xhtml#x1-3210006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1016.1">Avoiding mutable default values for function parameters</span></span></a><span class="kobospan" id="kobo.1017.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1018.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1019.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1020.1">4</span></span></a><span class="kobospan" id="kobo.1021.1">, we looked at other places where default values are used.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1022.1">In the </span><a href="ch011_split_001.xhtml#x1-4190008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1023.1">Using more sophisticated collections</span></span></a><span class="kobospan" id="kobo.1024.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1025.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1026.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1027.1">7</span></span></a><span class="kobospan" id="kobo.1028.1">, we looked at other examples of using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1029.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.1030.1"> class.</span></p></li>
</ul>
<p class="normal1"><span id="x1-486001r1000"/></p>
</section>
</section>
<section data-number="0.11.6" id="creating-a-class-that-has-orderable-objects">
<h1 class="unnumbered" data-number="0.11.6"><span><span class="kobospan" id="kobo.1031.1">8.6 </span></span> <span id="x1-4870006"/><span class="kobospan" id="kobo.1032.1">Creating a class that has orderable objects</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1033.1">We often need objects</span><span id="dx1-487001"/><span class="kobospan" id="kobo.1034.1"> that can be sorted</span><span id="dx1-487002"/><span class="kobospan" id="kobo.1035.1"> into order. </span><span class="kobospan" id="kobo.1035.2">Log records, to give one example, are often ordered by date and time. </span><span class="kobospan" id="kobo.1035.3">Most of our class definitions have not included the features necessary for sorting objects into order. </span><span class="kobospan" id="kobo.1035.4">Many of the recipes have kept objects in mappings or sets based on the internal hash value computed by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1036.1">__hash__()</span></span></span></span><span class="kobospan" id="kobo.1037.1"> method, and an equality test defined by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1038.1">__eq__()</span></span></span></span><span class="kobospan" id="kobo.1039.1"> method.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1040.1">In order to keep items in a sorted collection, we’ll need the comparison methods that implement </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1041.1">&lt;</span></span></span></span><span class="kobospan" id="kobo.1042.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1043.1">&gt;</span></span></span></span><span class="kobospan" id="kobo.1044.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1045.1">&lt;=</span></span></span></span><span class="kobospan" id="kobo.1046.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1047.1">&gt;=</span></span></span></span><span class="kobospan" id="kobo.1048.1">. </span><span class="kobospan" id="kobo.1048.2">These comparisons are all based on the attribute values of each object.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1049.1">When we extend the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1050.1">NamedTuple</span></span></span></span><span class="kobospan" id="kobo.1051.1"> class, the comparison methods that apply to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1052.1">tuple</span></span></span></span><span class="kobospan" id="kobo.1053.1"> class are available. </span><span class="kobospan" id="kobo.1053.2">If we defined class using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1054.1">@dataclass</span></span></span></span><span class="kobospan" id="kobo.1055.1"> decorator, the comparison methods are not provided by default. </span><span class="kobospan" id="kobo.1055.2">We can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1056.1">@dataclass(order=True)</span></span></span></span><span class="kobospan" id="kobo.1057.1"> to have the ordering methods included. </span><span class="kobospan" id="kobo.1057.2">For this recipe, we’ll look at a class that is not based on either of these helpers. </span><span id="x1-487003r1016"/></p>
<section data-number="0.11.6.1" id="getting-ready-68">
<h2 class="likechapterhead" data-number="0.11.6.1"><span><span class="kobospan" id="kobo.1058.1">8.6.1 </span></span> <span id="x1-4880001"/><span class="kobospan" id="kobo.1059.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1060.1">In the </span><a href="ch012.xhtml#x1-4610002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1061.1">Separating concerns via multiple inheritance</span></span></a><span class="kobospan" id="kobo.1062.1"> recipe, we defined</span><span id="dx1-488001"/><span class="kobospan" id="kobo.1063.1"> playing cards</span><span id="dx1-488002"/><span class="kobospan" id="kobo.1064.1"> using two class definitions. </span><span class="kobospan" id="kobo.1064.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1065.1">Card</span></span></span></span><span class="kobospan" id="kobo.1066.1"> class hierarchy defined essential features of each card. </span><span class="kobospan" id="kobo.1066.2">A second set of mixin classes provided game-specific features for each card.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1067.1">The core definition, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1068.1">Card</span></span></span></span><span class="kobospan" id="kobo.1069.1">, was a frozen dataclass. </span><span class="kobospan" id="kobo.1069.2">It did not have the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1070.1">order=True</span></span></span></span><span class="kobospan" id="kobo.1071.1"> parameter, and does not properly put cards into order. </span><span class="kobospan" id="kobo.1071.2">We’ll need to add features to this </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1072.1">Card</span></span></span></span><span class="kobospan" id="kobo.1073.1"> definition to create objects that can be ordered properly.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1074.1">We’ll assume one more class definition, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1075.1">PinochlePoints</span></span></span></span><span class="kobospan" id="kobo.1076.1"> to follow the rules for assigning points to cards for the game of Pinochle. </span><span class="kobospan" id="kobo.1076.2">The details don’t matter; all that matters is that the class implements the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1077.1">points()</span></span></span></span><span class="kobospan" id="kobo.1078.1"> method.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1079.1">In order to create a sortable collection of cards, we need to add yet another feature to the family of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1080.1">Card</span></span></span></span><span class="kobospan" id="kobo.1081.1"> class definitions. </span><span class="kobospan" id="kobo.1081.2">We’ll need to define four special methods used for the comparison operators. </span><span id="x1-488003r1018"/></p>
</section>
<section data-number="0.11.6.2" id="how-to-do-it...-69">
<h2 class="likechapterhead" data-number="0.11.6.2"><span><span class="kobospan" id="kobo.1082.1">8.6.2 </span></span> <span id="x1-4890002"/><span class="kobospan" id="kobo.1083.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1084.1">To create an orderable class definition, we’ll create a comparison protocol, and then define a class that implements the protocol, as follows:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-489002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1085.1">We’re defining a new protocol that tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1086.1">mypy </span></span><span class="kobospan" id="kobo.1087.1">can use when comparing objects. </span><span class="kobospan" id="kobo.1087.2">This will describe what kinds of objects the mixin will apply to. </span><span class="kobospan" id="kobo.1087.3">We’ve called it </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1088.1">CardLike</span></span></span></span><span class="kobospan" id="kobo.1089.1"> because it applies to any class with at least the two attributes of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1090.1">rank</span></span></span></span><span class="kobospan" id="kobo.1091.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1092.1">suit</span></span></span></span><span class="kobospan" id="kobo.1093.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1094.1">
from typing import Protocol, Any 
 
 
 
class CardLike(Protocol): 
 
    rank: int 
 
    suit: str</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1095.1">This use of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1096.1">something</span></span><span class="kobospan" id="kobo.1097.1">-</span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1098.1">Like</span></span></span></span><span class="kobospan" id="kobo.1099.1"> as a protocol name is part of the overall Pythonic approach of duck typing. </span><span class="kobospan" id="kobo.1099.2">Rather than insist on a type hierarchy, we define the fewest features required as a new </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1100.1">Protocol</span></span></span></span><span class="kobospan" id="kobo.1101.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-489010x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1102.1">Extending the protocol, we can create the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1103.1">SortableCard</span></span></span></span><span class="kobospan" id="kobo.1104.1"> subclass for the comparison features. </span><span class="kobospan" id="kobo.1104.2">This subclass can be mixed into any class that fits the protocol definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1105.1">
class SortableCard(CardLike):                                                                

                                                                     
     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-489014x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1106.1">Add the four order</span><span id="dx1-489015"/><span class="kobospan" id="kobo.1107.1"> comparison methods</span><span id="dx1-489016"/><span class="kobospan" id="kobo.1108.1"> to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1109.1">SortableCard</span></span></span></span><span class="kobospan" id="kobo.1110.1"> subclass. </span><span class="kobospan" id="kobo.1110.2">In this case, we’re using the relevant attributes of any class that fits the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1111.1">CardLike</span></span></span></span><span class="kobospan" id="kobo.1112.1"> protocol into a tuple, then using Python’s built-in tuple comparison to handle the details of comparing the items in the tuple. </span><span class="kobospan" id="kobo.1112.2">Here are the methods:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1113.1">
    def __lt__(self: CardLike, other: Any) -&gt; bool: 
 
        return (self.rank, self.suit) &lt; (other.rank, other.suit) 
 
    def __le__(self: CardLike, other: Any) -&gt; bool: 
 
        return (self.rank, self.suit) &lt;= (other.rank, other.suit) 
 
    def __gt__(self: CardLike, other: Any) -&gt; bool: 
 
        return (self.rank, self.suit) &gt; (other.rank, other.suit) 
 
    def __ge__(self: CardLike, other: Any) -&gt; bool: 
 
        return (self.rank, self.suit) &gt;= (other.rank, other.suit)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-489027x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1114.1">Write the composite class definitions, built from an essential </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1115.1">Card</span></span></span></span><span class="kobospan" id="kobo.1116.1"> class and two mixin classes to provide the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1117.1">Pinochle </span></span><span class="kobospan" id="kobo.1118.1">and comparison features:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1119.1">
class PinochleAce(AceCard, SortableCard, PinochlePoints): 
 
    pass 
 
 
 
class PinochleFace(FaceCard, SortableCard, PinochlePoints): 
 
    pass 
 
 
 
class PinochleNumber(Card, SortableCard, PinochlePoints): 
 
    pass</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-489038x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1120.1">There’s no simple superclass for this collection of classes. </span><span class="kobospan" id="kobo.1120.2">We’ll add a type hint to create a common definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1121.1">
from typing import TypeAlias 
 
PinochleCard: TypeAlias = PinochleAce | PinochleFace | PinochleNumber</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-489043x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1122.1">Now we can create a function that will create individual </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1123.1">PinochleCard</span></span></span></span><span class="kobospan" id="kobo.1124.1"> objects from the classes defined previously:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1125.1">
def make_pinochle_card(rank: int, suit: str) -&gt; PinochleCard: 
 
    if rank in (9, 10): 
 
        return PinochleNumber(rank, suit) 
 
    elif rank in (11, 12, 13): 
 
        return PinochleFace(rank, suit) 
 
    else: 
 
        return PinochleAce(rank, suit)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1126.1">The dauntingly complex point rules</span><span id="dx1-489052"/><span class="kobospan" id="kobo.1127.1"> for Pinochle</span><span id="dx1-489053"/><span class="kobospan" id="kobo.1128.1"> are encapsulated in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1129.1">PinochlePoints</span></span></span></span><span class="kobospan" id="kobo.1130.1"> class. </span><span class="kobospan" id="kobo.1130.2">We’ve omitted them because the points don’t parallel the six card ranks at all. </span><span class="kobospan" id="kobo.1130.3">Building composite classes as a base subclass of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1131.1">Card</span></span></span></span><span class="kobospan" id="kobo.1132.1"> plus </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1133.1">PinochlePoints</span></span></span></span><span class="kobospan" id="kobo.1134.1"> leads to an accurate model of the cards without too much overt complexity.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1135.1">We can now make cards that respond to comparison operators, using the following sequence of interactive commands:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1136.1">                                                                     

                                                                     

 
 
&gt;&gt;&gt; c1 = make_pinochle_card(9, ’’) 
 
&gt;&gt;&gt; c2 = make_pinochle_card(10, ’’) 
 
&gt;&gt;&gt; c1 &lt; c2 
 
True 
 
 
 
&gt;&gt;&gt; c1 == c1  # Cards match themselves 
 
True 
 
 
 
&gt;&gt;&gt; c1 == c2 
 
False 
 
 
 
&gt;&gt;&gt; c1 &gt; c2 
 
False</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1137.1">The equality comparisons to implement </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1138.1">==</span></span></span></span><span class="kobospan" id="kobo.1139.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1140.1">!=</span></span></span></span><span class="kobospan" id="kobo.1141.1"> are defined in the base class, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1142.1">Card</span></span></span></span><span class="kobospan" id="kobo.1143.1">. </span><span class="kobospan" id="kobo.1143.2">This is a frozen data class. </span><span class="kobospan" id="kobo.1143.3">By default, data classes contain equality test methods.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1144.1">Here’s a function that builds the special 48-card deck. </span><span class="kobospan" id="kobo.1144.2">It creates two copies of each of the 24 different rank and suit combinations:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1145.1">
 
 
def make_pinochle_deck() -&gt; list[PinochleCard]: 
 
    return [ 
 
        make_pinochle_card(r, s) 
 
            for _ in range(2) 
 
                for r in range(9, 15) 
 
                    for s in SUITS 
 
    ]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1146.1">The value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1147.1">SUITS</span></span></span></span><span class="kobospan" id="kobo.1148.1"> variable is the four Unicode characters for the suits. </span><span class="kobospan" id="kobo.1148.2">The generator expression inside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1149.1">make_deck()</span></span></span></span><span class="kobospan" id="kobo.1150.1"> function builds two copies of each card using the 6 ranks that are part of the Pinochle game. </span><span id="x1-489076r1019"/></p>
</section>
<section data-number="0.11.6.3" id="how-it-works...-69">
<h2 class="likechapterhead" data-number="0.11.6.3"><span><span class="kobospan" id="kobo.1151.1">8.6.3 </span></span> <span id="x1-4900003"/><span class="kobospan" id="kobo.1152.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1153.1">Python uses special methods</span><span id="dx1-490001"/><span class="kobospan" id="kobo.1154.1"> for a vast number</span><span id="dx1-490002"/><span class="kobospan" id="kobo.1155.1"> of things. </span><span class="kobospan" id="kobo.1155.2">Almost every operator in the language is implemented by a special method. </span><span class="kobospan" id="kobo.1155.3">(The few exceptions are the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1156.1">is</span></span></span></span><span class="kobospan" id="kobo.1157.1"> operator and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1158.1">and</span></span></span></span><span class="kobospan" id="kobo.1159.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1160.1">or</span></span></span></span><span class="kobospan" id="kobo.1161.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1162.1">not</span></span></span></span><span class="kobospan" id="kobo.1163.1">.) In this recipe, we’ve leveraged the four ordering operators.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1164.1">The expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1165.1">c1</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1166.1"> &lt;=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1167.1"> c2</span></span></span></span><span class="kobospan" id="kobo.1168.1"> is evaluated as if we’d written </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1169.1">c1.__le__(c2)</span></span></span></span><span class="kobospan" id="kobo.1170.1">. </span><span class="kobospan" id="kobo.1170.2">This kind of transformation happens for almost all Python operators.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1171.1">The </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1172.1">Python Language Reference </span></span><span class="kobospan" id="kobo.1173.1">organizes the special methods into several distinct groups. </span><span class="kobospan" id="kobo.1173.2">In this recipe, we’ve looked at methods used for basic customization of a class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1174.1">Here’s how it looks when we work with instances of this class hierarchy. </span><span class="kobospan" id="kobo.1174.2">The first example will create a 48-card </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1175.1">Pinochle </span></span><span class="kobospan" id="kobo.1176.1">deck:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1177.1">
 
 
&gt;&gt;&gt; deck = make_pinochle_deck() 
 
&gt;&gt;&gt; len(deck) 
 
48</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1178.1">
 
 
&gt;&gt;&gt; import random 
 
&gt;&gt;&gt; random.seed(4) 
 
&gt;&gt;&gt; random.shuffle(deck) 
 
&gt;&gt;&gt; [str(c) for c in sorted(deck[:12])] 
 
[’ 9 ’, ’10 ’, ’ J ’, ’ J ’, ’ J ’, ’ Q ’, ’ Q ’, ’ K ’, ’ K ’, ’ K ’, ’ A ’, ’ A ’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1179.1">The important part of the above example is the use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1180.1">sorted()</span></span></span></span><span class="kobospan" id="kobo.1181.1"> function. </span><span class="kobospan" id="kobo.1181.2">Because we’ve defined proper comparison operators, we can sort the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1182.1">PinochleCard</span></span></span></span><span class="kobospan" id="kobo.1183.1"> instances, and they are presented in the expected</span><span id="dx1-490013"/><span class="kobospan" id="kobo.1184.1"> order from low rank</span><span id="dx1-490014"/><span class="kobospan" id="kobo.1185.1"> to high rank. </span><span id="x1-490015r1028"/></p>
</section>
<section data-number="0.11.6.4" id="theres-more...-60">
<h2 class="likechapterhead" data-number="0.11.6.4"><span><span class="kobospan" id="kobo.1186.1">8.6.4 </span></span> <span id="x1-4910004"/><span class="kobospan" id="kobo.1187.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1188.1">A little formal logic suggests that we really only need to implement two of the comparisons in detail. </span><span class="kobospan" id="kobo.1188.2">From an equality method and one ordering method, all the remaining methods can be built. </span><span class="kobospan" id="kobo.1188.3">For example, if we build the operations for less than (</span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1189.1">__lt__()</span></span></span></span><span class="kobospan" id="kobo.1190.1">) and equal to (</span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1191.1">__eq__()</span></span></span></span><span class="kobospan" id="kobo.1192.1">), we could compute the other three comparisons following these equivalence rules:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1193.1"><img alt="a ≤ b ≡ a &lt; b∨ a = b " class="math" src="../media/file55.png"/></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1194.1"><img alt="a ≥ b ≡ b &lt; a∨ a = b " class="math" src="../media/file56.png"/></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1195.1"><img alt="a ⁄= b ≡ ¬(a = b) " class="math" src="../media/file57.png"/></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1196.1">Python emphatically does not do any of this kind of advanced algebra for us. </span><span class="kobospan" id="kobo.1196.2">We need to do the algebra carefully and implement the necessary comparison methods.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1197.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1198.1">functools</span></span></span></span><span class="kobospan" id="kobo.1199.1"> library includes a decorator, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1200.1">@total_ordering</span></span></span></span><span class="kobospan" id="kobo.1201.1">, that can generate these missing comparison methods. </span><span id="x1-491001r1031"/></p>
</section>
<section data-number="0.11.6.5" id="see-also-67">
<h2 class="likechapterhead" data-number="0.11.6.5"><span><span class="kobospan" id="kobo.1202.1">8.6.5 </span></span> <span id="x1-4920005"/><span class="kobospan" id="kobo.1203.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1204.1">See the </span><a href="ch012.xhtml#x1-4610002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1205.1">Separating concerns via multiple inheritance</span></span></a><span class="kobospan" id="kobo.1206.1"> recipe for the essential definitions of cards and card game rules.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1207.1">See </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1208.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1209.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1210.1">7</span></span></a><span class="kobospan" id="kobo.1211.1"> for more information on dataclasses and named tuple classes.</span></p></li>
</ul>
<p class="normal1"><span id="x1-492001r1017"/></p>
</section>
</section>
<section data-number="0.11.7" id="deleting-from-a-list-of-complicated-objects">
<h1 class="unnumbered" data-number="0.11.7"><span><span class="kobospan" id="kobo.1212.1">8.7 </span></span> <span id="x1-4930007"/><span class="kobospan" id="kobo.1213.1">Deleting from a list of complicated objects</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1214.1">Removing items from a list</span><span id="dx1-493001"/><span class="kobospan" id="kobo.1215.1"> has an interesting consequence. </span><span class="kobospan" id="kobo.1215.2">Specifically, when an item is removed, all the subsequent items move forward. </span><span class="kobospan" id="kobo.1215.3">The rule is this:</span></p>
<blockquote class="calibre8">
<p class="normal2"><span class="kobospan" id="kobo.1216.1">On deleting item </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1217.1">y</span></span></span></span><span class="kobospan" id="kobo.1218.1">, items </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1219.1">list[y+1:]</span></span></span></span><span class="kobospan" id="kobo.1220.1"> take the place of items </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1221.1">list[y:]</span></span></span></span><span class="kobospan" id="kobo.1222.1">.</span></p>
</blockquote>
<p class="normal1"><span class="kobospan" id="kobo.1223.1">This is a side-effect that happens in addition to removing the selected item. </span><span class="kobospan" id="kobo.1223.2">Because things can move around in a list, it makes deleting more than one item at a time potentially challenging.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1224.1">When the list contains items that have a definition for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1225.1">__eq__()</span></span></span></span><span class="kobospan" id="kobo.1226.1"> special method, then the list </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1227.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1228.1"> method can remove each item. </span><span class="kobospan" id="kobo.1228.2">When the list items don’t have a simple </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1229.1">__eq__()</span></span></span></span><span class="kobospan" id="kobo.1230.1"> test, then the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1231.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1232.1"> method doesn’t work, making it more challenging to remove multiple items from the list. </span><span id="x1-493002r1032"/></p>
<section data-number="0.11.7.1" id="getting-ready-69">
<h2 class="likechapterhead" data-number="0.11.7.1"><span><span class="kobospan" id="kobo.1233.1">8.7.1 </span></span> <span id="x1-4940001"/><span class="kobospan" id="kobo.1234.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1235.1">For this example, we’ll work with a list of dictionaries, where a naïve approach to removing items doesn’t work out. </span><span class="kobospan" id="kobo.1235.2">It’s helpful to see what can go wrong with trying repeatedly to search a list for an item to delete.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1236.1">In this case, we’ve got some data that includes a song name, the writers, and a duration. </span><span class="kobospan" id="kobo.1236.2">The dictionary objects are rather long. </span><span class="kobospan" id="kobo.1236.3">The data looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1237.1">
 
 
&gt;&gt;&gt; song_list = [ 
 
... </span><span class="kobospan" id="kobo.1237.2">{’title’: ’Eruption’, ’writer’: [’Emerson’], ’time’: ’2:43’}, 
 
... </span><span class="kobospan" id="kobo.1237.3">{’title’: ’Stones of Years’, ’writer’: [’Emerson’, ’Lake’], ’time’: ’3:43’}, 
 
... </span><span class="kobospan" id="kobo.1237.4">{’title’: ’Iconoclast’, ’writer’: [’Emerson’], ’time’: ’1:16’}, 
 
... </span><span class="kobospan" id="kobo.1237.5">{’title’: ’Mass’, ’writer’: [’Emerson’, ’Lake’], ’time’: ’3:09’}, 
 
... </span><span class="kobospan" id="kobo.1237.6">{’title’: ’Manticore’, ’writer’: [’Emerson’], ’time’: ’1:49’}, 
 
... </span><span class="kobospan" id="kobo.1237.7">{’title’: ’Battlefield’, ’writer’: [’Lake’], ’time’: ’3:57’}, 
 
... </span><span class="kobospan" id="kobo.1237.8">{’title’: ’Aquatarkus’, ’writer’: [’Emerson’], ’time’: ’3:54’} 
 
... </span><span class="kobospan" id="kobo.1237.9">]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1238.1">The type hint for each row of this complex</span><span id="dx1-494011"/><span class="kobospan" id="kobo.1239.1"> structure can be defined with as follows:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1240.1">
 
 
from typing import TypedDict 
 
 
 
class SongType(TypedDict): 
 
    title: str 
 
    writer: list[str] 
 
    time: str</span></code></pre>
<div class="tipbox1" id="tcolobox-16">
<div class="note">
<p class="normal1"><span class="kobospan" id="kobo.1241.1">A better design would use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1242.1">datetime.timedelta</span></span></span></span><span class="kobospan" id="kobo.1243.1"> for the song’s time. </span><span class="kobospan" id="kobo.1243.2">We’ve omitted this complication from the recipe.</span></p>
</div>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1244.1">The list of songs as a whole can be described as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1245.1">list[SongType]</span></span></span></span><span class="kobospan" id="kobo.1246.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1247.1">Here’s a naïve approach that emphatically does not work:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1248.1">
 
 
def naive_delete(data: list[SongType], writer: str) -&gt; None: 
 
    for index in range(len(data)): 
 
        if ’Lake’ in data[index][’writer’]: 
 
            del data[index]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1249.1">Because items are moved, the computed index values will skip over the item just after one that is deleted. </span><span class="kobospan" id="kobo.1249.2">Further, because the list gets shorter, the range is wrong after a deletion. </span><span class="kobospan" id="kobo.1249.3">This fails with an index error, as shown in the following output:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1250.1">
 
 
&gt;&gt;&gt; naive_delete(song_list, ’Lake’) 
 
Traceback (most recent call last): 
 
... 
 
IndexError: list index out of range</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1251.1">Another failing approach looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1252.1">                                                                     

                                                                     

 
 
&gt;&gt;&gt; remove = list(filter(lambda x: ’Lake’ in x[’writer’], song_list)) 
 
&gt;&gt;&gt; for x in remove: 
 
... </span><span class="kobospan" id="kobo.1252.2">    song_list.remove(x)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1253.1">This suffers from the problem that each </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1254.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1255.1"> operation must search the list from the beginning. </span><span class="kobospan" id="kobo.1255.2">This approach will be slow for a very large list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1256.1">We need to combine search and remove operations in a way that avoids multiple passes through the list. </span><span id="x1-494033r1034"/></p>
</section>
<section data-number="0.11.7.2" id="how-to-do-it...-70">
<h2 class="likechapterhead" data-number="0.11.7.2"><span><span class="kobospan" id="kobo.1257.1">8.7.2 </span></span> <span id="x1-4950002"/><span class="kobospan" id="kobo.1258.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1259.1">To efficiently delete multiple</span><span id="dx1-495001"/><span class="kobospan" id="kobo.1260.1"> items from a list, we’ll need to implement our own list index processing function as follows:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-495003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1261.1">Define a function to update a list object by removing selected items:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1262.1">
def incremental_delete( 
 
    data: list[SongType], 
 
    writer: str 
 
) -&gt; None:</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-495010x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1263.1">Initialize an index value, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1264.1">i</span></span></span></span><span class="kobospan" id="kobo.1265.1">, to zero to begin with the first item in the list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1266.1">
    i = 0</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-495014x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1267.1">While the value for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1268.1">i</span></span></span></span><span class="kobospan" id="kobo.1269.1"> variable is not equal to the length of the list, we want to make a state change to either increment the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1270.1">i</span></span></span></span><span class="kobospan" id="kobo.1271.1"> value or shrink the list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1272.1">
    while i != len(data):</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-495018x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1273.1">If the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1274.1">data[i]</span></span></span></span><span class="kobospan" id="kobo.1275.1"> value is the searched-for target, we can remove it, shrinking the list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1276.1">Otherwise, increment the index value, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1277.1">i</span></span></span></span><span class="kobospan" id="kobo.1278.1">, one step closer to the length of the list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1279.1">
        if ’Lake’ in data[i][’writer’]: 
 
            del data[i] 
 
        else: 
 
            i += 1</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1280.1">This leads to the expected behavior of removing the items from the list without suffering from index errors, making multiple passes through the list items, or failing to delete matching items. </span><span id="x1-495024r1040"/></p>
</section>
<section data-number="0.11.7.3" id="how-it-works...-70">
<h2 class="likechapterhead" data-number="0.11.7.3"><span><span class="kobospan" id="kobo.1281.1">8.7.3 </span></span> <span id="x1-4960003"/><span class="kobospan" id="kobo.1282.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1283.1">The goal is to examine each item exactly once and either remove it or step over it, leaving it in place. </span><span class="kobospan" id="kobo.1283.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1284.1">while</span></span></span></span><span class="kobospan" id="kobo.1285.1"> statement design stems from looking at statements that advance toward the goal: increment the index, and delete an item. </span><span class="kobospan" id="kobo.1285.2">Each of these works in a limited set of conditions:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1286.1">Incrementing the index only works if the item should not be removed.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1287.1">Deleting an item only works if the item is a match.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1288.1">What’s important is that the conditions are exclusive. </span><span class="kobospan" id="kobo.1288.2">When we use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1289.1">for</span></span></span></span><span class="kobospan" id="kobo.1290.1"> statement, the increment processing always happens, an undesirable feature. </span><span class="kobospan" id="kobo.1290.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1291.1">while</span></span></span></span><span class="kobospan" id="kobo.1292.1"> statement permits us to increment </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1293.1">only </span></span><span class="kobospan" id="kobo.1294.1">when the item</span><span id="dx1-496001"/><span class="kobospan" id="kobo.1295.1"> should be left in place. </span><span id="x1-496002r1045"/></p>
</section>
<section data-number="0.11.7.4" id="theres-more...-61">
<h2 class="likechapterhead" data-number="0.11.7.4"><span><span class="kobospan" id="kobo.1296.1">8.7.4 </span></span> <span id="x1-4970004"/><span class="kobospan" id="kobo.1297.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1298.1">An alternative to the overhead of removal is to create a new list with some items rejected. </span><span class="kobospan" id="kobo.1298.2">Making a shallow copy of items is much faster than removing items from a list, but uses more storage. </span><span class="kobospan" id="kobo.1298.3">This is a common example of the time versus memory trade-off.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1299.1">We can use a list comprehension like the following one to create a new list of only the desired items:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1300.1">
 
 
&gt;&gt;&gt; [item 
 
... </span><span class="kobospan" id="kobo.1300.2">    for item in song_list 
 
... </span><span class="kobospan" id="kobo.1300.3">        if ’Lake’ not in item[’writer’] 
 
... </span><span class="kobospan" id="kobo.1300.4">]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1301.1">This will create a shallow copy of selected items from the list. </span><span class="kobospan" id="kobo.1301.2">The items we don’t want to keep will be ignored. </span><span class="kobospan" id="kobo.1301.3">For more information on the idea of a shallow copy, see the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1302.1">Making shallow and deep copies of objects </span></span><span class="kobospan" id="kobo.1303.1">recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1304.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1305.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1306.1">4</span></span></a><span class="kobospan" id="kobo.1307.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1308.1">We can also use a higher-order function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1309.1">filter()</span></span></span></span><span class="kobospan" id="kobo.1310.1">, as part of the copy operation. </span><span class="kobospan" id="kobo.1310.2">Consider this example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1311.1">
 
 
&gt;&gt;&gt; list( 
 
... </span><span class="kobospan" id="kobo.1311.2">    filter( 
 
... </span><span class="kobospan" id="kobo.1311.3">        lambda item: ’Lake’ not in item[’writer’], 
 
... </span><span class="kobospan" id="kobo.1311.4">        song_list 
 
... </span><span class="kobospan" id="kobo.1311.5">    ) 
 
... </span><span class="kobospan" id="kobo.1311.6">)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1312.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1313.1">filter()</span></span></span></span><span class="kobospan" id="kobo.1314.1"> function has two arguments: a lambda object</span><span id="dx1-497013"/><span class="kobospan" id="kobo.1315.1"> and the original set of data. </span><span class="kobospan" id="kobo.1315.2">In this case, the lambda expression is used to decide which items to pass. </span><span class="kobospan" id="kobo.1315.3">Items for which the lambda returns </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1316.1">False</span></span></span></span><span class="kobospan" id="kobo.1317.1"> are rejected.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1318.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1319.1">filter()</span></span></span></span><span class="kobospan" id="kobo.1320.1"> function is a generator. </span><span class="kobospan" id="kobo.1320.2">This means that we need to collect all of the items to create a final list object. </span><span class="kobospan" id="kobo.1320.3">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1321.1">list()</span></span></span></span><span class="kobospan" id="kobo.1322.1"> function is one way to consume all items from a generator, stashing them in the collection object they create and return. </span><span id="x1-497014r1046"/></p>
</section>
<section data-number="0.11.7.5" id="see-also-68">
<h2 class="likechapterhead" data-number="0.11.7.5"><span><span class="kobospan" id="kobo.1323.1">8.7.5 </span></span> <span id="x1-4980005"/><span class="kobospan" id="kobo.1324.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1325.1">We’ve leveraged two other recipes: </span><a href="ch009.xhtml#x1-3160005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1326.1">Making shallow and deep copies of</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1327.1">objects</span></span></a><span class="kobospan" id="kobo.1328.1"> and </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1329.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.1330.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1331.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1332.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1333.1">4</span></span></a><span class="kobospan" id="kobo.1334.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1335.1">We’ll look closely at filters and generator expressions in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1336.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1337.1"> </span></span><a href="ch013_split_000.xhtml#x1-5020009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1338.1">9</span></span></a><span class="kobospan" id="kobo.1339.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-498001r1033"/></p>
</section>
</section>
<section data-number="0.11.10" id="join-our-community-discord-space-8">
<h1 class="unnumbered" data-number="0.11.10"><span id="x1-5010009"/><span class="kobospan" id="kobo.1340.1">Join our community Discord space</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1341.1">Join our Python Discord workspace to discuss and find out more about the book: </span><a class="url" href="https://packt.link/dHrHU"><span class="url1"><span class="kobospan" id="kobo.1342.1">https://packt.link/dHrHU</span></span></a></p>
<p class="normal1"><span class="kobospan" id="kobo.1343.1"><img alt="PIC" src="../media/file1.png" class="calibre9"/></span> <span id="x1-501001r935"/></p>
</section>
</section>
</body></html>