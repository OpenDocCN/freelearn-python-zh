<html><head></head><body>
<section data-number="0.15" id="chapter-12-graphics-and-visualization-with-jupyter-lab">
<h2 class="likechapterhead" data-number="0.15"><span><span class="kobospan" id="kobo.1.1">12</span></span><br class="tipbox1"/> <span id="x1-67500012"/><span class="kobospan" id="kobo.2.1">Graphics and Visualization with Jupyter Lab</span></h2>
<p class="normal"><span class="kobospan" id="kobo.3.1">A great many problems are simplified through visualization of the data. </span><span class="kobospan" id="kobo.3.2">The human eye is particularly suited to identifying relationships and trends. </span><span class="kobospan" id="kobo.3.3">Given a display of a potential relationship (or trend), it makes sense to turn to more formal statistical methods to quantify the relationship.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.4.1">Python offers a number of graphical tools. </span><span class="kobospan" id="kobo.4.2">For data analytics purposes, one</span><span id="dx1-675001"/><span class="kobospan" id="kobo.5.1"> of the most popular is </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.6.1">matplotlib</span></span><span class="kobospan" id="kobo.7.1">. </span><span class="kobospan" id="kobo.7.2">This package offers numerous graphic capablities. </span><span class="kobospan" id="kobo.7.3">It integrates</span><span id="dx1-675002"/><span class="kobospan" id="kobo.8.1"> well with </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.9.1">Jupyter Lab</span></span><span class="kobospan" id="kobo.10.1">, providing us an interactive environment to visualize and analyze data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.11.1">It’s possible to do a great deal of Python development in Jupyter Lab. </span><span class="kobospan" id="kobo.11.2">While wonderful, this</span><span id="dx1-675003"/><span class="kobospan" id="kobo.12.1"> is not a perfect </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.13.1">Integrated Development Environment</span></span><span class="kobospan" id="kobo.14.1"> (</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.15.1">IDE</span></span><span class="kobospan" id="kobo.16.1">). </span><span class="kobospan" id="kobo.16.2">The one minor drawback is the interactive notebook relies on global variables, something that isn’t ideal for writing modules or applications. </span><span class="kobospan" id="kobo.16.3">The use of global variables can lead to confusion when transforming a notebook into a module intended for reuse.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.17.1">In addition to running Python code and displaying graphics, a Jupyter Lab notebook can also render cells in Markdown notation. </span><span class="kobospan" id="kobo.17.2">This lets us write very good-looking documentation around the graphical analysis of data. </span><span class="kobospan" id="kobo.17.3">This includes the ability to render mathematical formulae properly. </span><span class="kobospan" id="kobo.17.4">It lets us include a cell with </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.18.1">e</span></span><sup class="calibre15"><span class="cmmi"><span class="kobospan" id="kobo.19.1">πi</span></span></sup><span class="kobospan" id="kobo.20.1"> + 1 = 0 kinds of mathematics close to the relevant code.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.21.1">The two packages we’ll use aren’t part of the standard Python distribution. </span><span class="kobospan" id="kobo.21.2">We’ll need to install them. </span><span class="kobospan" id="kobo.21.3">In some cases, using a tool like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.22.1">Conda </span></span><span class="kobospan" id="kobo.23.1">can help to install these large</span><span id="dx1-675004"/><span class="kobospan" id="kobo.24.1"> and complex packages. </span><span class="kobospan" id="kobo.24.2">In many cases, however, a PIP install will work when our computer is one of the widely supported varieties.</span></p>
<pre class="programlisting" id="listing-69"><code class="calibre13"><span class="kobospan" id="kobo.25.1">python -m pip install matplotlib jupyterlab</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.26.1">Using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.27.1">python</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.28.1"> -m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.29.1"> pip</span></span></span></span><span class="kobospan" id="kobo.30.1"> command ensures that we will use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.31.1">pip</span></span></span></span><span class="kobospan" id="kobo.32.1"> command that is compatible with the currently active virtual environment.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.33.1">This will conclude with a line something like the following:</span></p>
<pre class="programlisting" id="listing-70"><code class="calibre13"><span class="kobospan" id="kobo.34.1">Installing collected packages: pyparsing, pillow, numpy, kiwisolver, fonttools, cycler, contourpy, matplotlib</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.35.1">This line will be followed by a list of new packages added to the current virtual environment.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.36.1">Note that Jupyter Lab will make use of the IPython implementation of Python. </span><span class="kobospan" id="kobo.36.2">This implementation includes some additional features that are very handy for managing the complex client-server connection between a browser and a Jupyter Lab server.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.37.1">The most visible difference from the standard Python implementation is a distinct prompt. </span><span class="kobospan" id="kobo.37.2">IPython uses </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.38.1">In</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.39.1"> [n]:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.40.1"> </span></span></span></span><span class="kobospan" id="kobo.41.1"> as a prompt. </span><span class="kobospan" id="kobo.41.2">The number, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.42.1">n</span></span><span class="kobospan" id="kobo.43.1">, increases during the session. </span><span class="kobospan" id="kobo.43.2">It’s possible to recall specific previous commands and outputs using the numbering of the prompts.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.44.1">In this chapter, we’ll look at the following recipes:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><a href="ch016.xhtml#x1-6760001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.45.1">Starting a Notebook and creating cells with Python code</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.46.1">Ingesting data into a notebook</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch016.xhtml#x1-6880003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.47.1">Using pyplot to create a scatter plot</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch016.xhtml#x1-6940004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.48.1">Using axes directly to create a scatter plot</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch016.xhtml#x1-7000005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.49.1">Adding details to markdown cells</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch016.xhtml#x1-7060006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.50.1">Including Unit Test Cases in a Notebook</span></span></a></p></li>
</ul>
<p class="normal1"><span id="x1-675007r1450"/></p>
<section data-number="0.15.1" id="starting-a-notebook-and-creating-cells-with-python-code">
<div class="calibre10"/><h1 class="unnumbered" data-number="0.15.1"><span><span class="kobospan" id="kobo.51.1">12.1 </span></span> <span id="x1-6760001"/><span class="kobospan" id="kobo.52.1">Starting a Notebook and creating cells with Python code</span></h1>
<p class="normal"><span class="kobospan" id="kobo.53.1">We’ll use a terminal window</span><span id="dx1-676001"/><span class="kobospan" id="kobo.54.1"> to enter a command to start</span><span id="dx1-676002"/><span class="kobospan" id="kobo.55.1"> the lab</span><span id="dx1-676003"/><span class="kobospan" id="kobo.56.1"> server. </span><span class="kobospan" id="kobo.56.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.57.1">jupyter</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.58.1"> lab</span></span></span></span><span class="kobospan" id="kobo.59.1"> command will do two things:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.60.1">It will start the backend, number-crunching server component of Jupyter Lab.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.61.1">It will also try to launch a browser window that’s connected to that server component.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.62.1">The rest of our interaction with the various notebooks in the lab will be through the browser.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.63.1">In the rare case that a browser isn’t launched, the log will provide links that can be used in your browser of choice. </span><span class="kobospan" id="kobo.63.2">The IPython runtime will make use of the various installed packages.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.64.1">For this first recipe, we’ll focus on the administrative aspects of starting and stopping the Jupyter Lab server, and creating notebooks. </span><span id="x1-676004r1448"/></p>
<section data-number="0.15.1.1" id="getting-ready-93">
<h2 class="likechapterhead" data-number="0.15.1.1"><span><span class="kobospan" id="kobo.65.1">12.1.1 </span></span> <span id="x1-6770001"/><span class="kobospan" id="kobo.66.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.67.1">We’re going to start a Jupyter Lab session and create a notebook to make sure that the environment works and all of the needed components are installed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.68.1">The use of a terminal window to start Jupyter Lab is sometimes confusing. </span><span class="kobospan" id="kobo.68.2">Many programmers are used to working inside an IDE to create and test code. </span><span class="kobospan" id="kobo.68.3">Starting Jupyter Lab is generally done from a terminal</span><span id="dx1-677001"/><span class="kobospan" id="kobo.69.1"> window, not a Python editor</span><span id="dx1-677002"/><span class="kobospan" id="kobo.70.1"> or interactive</span><span id="dx1-677003"/><span class="kobospan" id="kobo.71.1"> Python REPL session. </span><span id="x1-677004r1454"/></p>
</section>
<section data-number="0.15.1.2" id="how-to-do-it...-94">
<h2 class="likechapterhead" data-number="0.15.1.2"><span><span class="kobospan" id="kobo.72.1">12.1.2 </span></span> <span id="x1-6780002"/><span class="kobospan" id="kobo.73.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-678002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.74.1">Open a terminal window. </span><span class="kobospan" id="kobo.74.2">Change to a working directory that has access to data and a folder for notebooks. </span><span class="kobospan" id="kobo.74.3">Be sure the proper virtual environment is active. </span><span class="kobospan" id="kobo.74.4">The Jupyter Lab server is limited to working in the directory in which it was started. </span><span class="kobospan" id="kobo.74.5">Enter the following command to start Jupyter Lab:</span></p>
<pre class="programlisting" id="listing-71"><code class="calibre13"><span class="kobospan" id="kobo.75.1">(coobook3) % python -m jupyter lab</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.76.1">This will output a log of actions taken by the server. </span><span class="kobospan" id="kobo.76.2">In the block of lines will be URLs to connect to the server securely. </span><span class="kobospan" id="kobo.76.3">Generally, a browser window will also open.</span></p>
</div></li>
<li class="calibre7"><div id="x1-678005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.77.1">In the browser window, the Jupyter Lab window will show the launcher tab. </span><span class="kobospan" id="kobo.77.2">It looks like the page shown in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.78.1">Figure </span></span><a href="ch016.xhtml#x1-678006r1" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.79.1">12.1</span></span></a><span class="kobospan" id="kobo.80.1">.</span></p>
<div class="center5">
<p class="normal2"><span class="kobospan" id="kobo.81.1"><img alt="PIC" src="../media/file74.png" class="calibre28"/></span> <span id="x1-678006r1"/> <span id="x1-678007"/></p>
<span><span class="kobospan" id="kobo.82.1">Figure 12.1: </span></span><span><span class="kobospan" id="kobo.83.1">Jupyter Lab launcher </span></span>
</div>
</div></li>
<li class="calibre7"><div id="x1-678009x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.84.1">Click the Python</span><span id="dx1-678010"/><span class="kobospan" id="kobo.85.1"> 3 (ipykernel) icon in the</span><span id="dx1-678011"/> <span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.86.1">Notebook</span></span></span></span><span class="kobospan" id="kobo.87.1"> section</span><span id="dx1-678012"/><span class="kobospan" id="kobo.88.1"> of the launcher. </span><span class="kobospan" id="kobo.88.2">This will open a Jupyter Notebook named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.89.1">Untitled.ipynb.</span></span></span></span></p>
<div class="center">
<p class="normal2"><span class="kobospan" id="kobo.90.1"><img alt="PIC" src="../media/file75.png" class="calibre28"/></span> <span id="x1-678013r2"/> <span id="x1-678014"/></p>
<span><span class="kobospan" id="kobo.91.1">Figure 12.2: </span></span><span><span class="kobospan" id="kobo.92.1">Jupyter notebook ready for work </span></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.93.1">The top of this tab has a notebook-level menu bar with a series of icons to save the notebook, add a cell, cut a cell, copy a cell, and paste a cell, among other things.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.94.1">The </span><span class="obeylines-h"><span><span><span class="kobospan" id="kobo.95.1">▸</span></span></span></span><span class="kobospan" id="kobo.96.1"> icon on the notebook’s menu bar will execute the cell’s Python or format the cell’s Markup content. </span><span class="kobospan" id="kobo.96.2">This can also often be done with the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.97.1">Shift</span></span><span class="kobospan" id="kobo.98.1">+</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.99.1">Enter </span></span><span class="kobospan" id="kobo.100.1">keyboard combination.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.101.1">The remaining icons will stop</span><span id="dx1-678015"/><span class="kobospan" id="kobo.102.1"> the running kernel</span><span id="dx1-678016"/><span class="kobospan" id="kobo.103.1"> and restart</span><span id="dx1-678017"/><span class="kobospan" id="kobo.104.1"> it. </span><span class="kobospan" id="kobo.104.2">The </span><span class="obeylines-h"><span><span><span class="kobospan" id="kobo.105.1">▸▸</span></span></span></span><span class="kobospan" id="kobo.106.1"> icon will restart the notebook, running all the cells. </span><span class="kobospan" id="kobo.106.2">A drop-down menu</span><span id="dx1-678018"/><span class="kobospan" id="kobo.107.1"> lets you choose</span><span id="dx1-678019"/><span class="kobospan" id="kobo.108.1"> between</span><span id="dx1-678020"/><span class="kobospan" id="kobo.109.1"> the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.110.1">code</span></span><span class="kobospan" id="kobo.111.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.112.1">markdown</span></span><span class="kobospan" id="kobo.113.1">, and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.114.1">raw</span></span><span class="kobospan" id="kobo.115.1"> cells. </span><span class="kobospan" id="kobo.115.2">We’ll spend most of our time creating code and markdown cells.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.116.1">The initial content has a label, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.117.1">[</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.118.1"> ]:</span></span></span></span><span class="kobospan" id="kobo.119.1">, and a text box into which we can enter code. </span><span class="kobospan" id="kobo.119.2">As we add more commands, this area will be filled with cells of code and their output.</span></p>
</div></li>
<li class="calibre7"><div id="x1-678022x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.120.1">To be sure we have all the required packages, enter the following code into the first cell:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.121.1">from matplotlib import pyplot as plt 
 
from pydantic import BaseModel</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.122.1">Use the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.123.1">Shift</span></span><span class="kobospan" id="kobo.124.1">+</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.125.1">Enter </span></span><span class="kobospan" id="kobo.126.1">keyboard combination or click the </span><span class="obeylines-h"><span><span><span class="kobospan" id="kobo.127.1">▸</span></span></span></span><span class="kobospan" id="kobo.128.1"> icon on the notebook’s menu bar to execute the code in this cell. </span><span class="kobospan" id="kobo.128.2">If it works, that confirms</span><span id="dx1-678026"/><span class="kobospan" id="kobo.129.1"> everything we need</span><span id="dx1-678027"/><span class="kobospan" id="kobo.130.1"> is installed in the current</span><span id="dx1-678028"/><span class="kobospan" id="kobo.131.1"> virtual environment.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-678029r1455"/></p>
</section>
<section data-number="0.15.1.3" id="how-it-works...-94">
<h2 class="likechapterhead" data-number="0.15.1.3"><span><span class="kobospan" id="kobo.132.1">12.1.3 </span></span> <span id="x1-6790003"/><span class="kobospan" id="kobo.133.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.134.1">One of the many features of Jupyter Lab is creating and editing notebooks. </span><span class="kobospan" id="kobo.134.2">We can enter code and execute code directly, saving the results for others to review. </span><span class="kobospan" id="kobo.134.3">This permits a great deal of flexibility in how to acquire, analyze, and share data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.135.1">Because we can also open a Python console and edit Python modules, we can do a tremendous amount of development work using Jupyter Lab as an IDE. </span><span class="kobospan" id="kobo.135.2">It’s possible to export a notebook as a script file. </span><span class="kobospan" id="kobo.135.3">This permits a transition from a sequence of cells representing a number of good ideas into a module or application.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.136.1">When confronted with a new problem or new data, using a notebook as a way to record experiments is often encouraged. </span><span class="kobospan" id="kobo.136.2">Cells that show failures reflect lessons learned and are worth preserving. </span><span class="kobospan" id="kobo.136.3">Cells that show success, of course, serve to guide colleagues through the learning process.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.137.1">The Jupyter Lab environment is designed to be used in a variety of container configurations. </span><span class="kobospan" id="kobo.137.2">Two common container</span><span id="dx1-679001"/><span class="kobospan" id="kobo.138.1"> architectures are:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.139.1">A large analytical host separate from an analyst’s laptop.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.140.1">An individual laptop acting as both the host for the Jupyter Lab server process and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.141.1">also </span></span><span class="kobospan" id="kobo.142.1">the host for the browser session. </span><span class="kobospan" id="kobo.142.2">This is the environment created for this recipe.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.143.1">The idea is to be able to scale up and process a very large dataset on a very expensive, very large host. </span><span class="kobospan" id="kobo.143.2">This number-crunching host runs the Jupter Lab and the kernel for our notebook. </span><span class="kobospan" id="kobo.143.3">Our laptop</span><span id="dx1-679002"/><span class="kobospan" id="kobo.144.1"> only runs a browser</span><span id="dx1-679003"/><span class="kobospan" id="kobo.145.1"> and a terminal window. </span><span id="x1-679004r1459"/></p>
</section>
<section data-number="0.15.1.4" id="theres-more...-85">
<h2 class="likechapterhead" data-number="0.15.1.4"><span><span class="kobospan" id="kobo.146.1">12.1.4 </span></span> <span id="x1-6800004"/><span class="kobospan" id="kobo.147.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.148.1">The working notebook needs to be saved or the current state will be lost. </span><span class="kobospan" id="kobo.148.2">Save early and save often to make sure no precious results are lost. </span><span class="kobospan" id="kobo.148.3">There are two ways to stop the Jupyter Lab server</span><span id="dx1-680001"/><span class="kobospan" id="kobo.149.1"> when we’re finished using it.</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.150.1">From the Jupyter Lab browser window.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.151.1">From the terminal window.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.152.1">To stop processing from the browser window, use the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.153.1">File </span></span><span class="kobospan" id="kobo.154.1">menu. </span><span class="kobospan" id="kobo.154.2">At the bottom of this menu is the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.155.1">Shut Down </span></span><span class="kobospan" id="kobo.156.1">menu item. </span><span class="kobospan" id="kobo.156.2">This stops the server and disconnects the browser session.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.157.1">To stop processing from the terminal window, use </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.158.1">Control</span></span><span class="kobospan" id="kobo.159.1">+</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.160.1">C </span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.161.1">(</span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.162.1">Ĉ</span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.163.1">) </span></span><span class="kobospan" id="kobo.164.1">twice to stop the processing. </span><span class="kobospan" id="kobo.164.2">Entering </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.165.1">Ĉ</span></span><span class="kobospan" id="kobo.166.1"> once will get a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.167.1">Shutdown</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.168.1"> this</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.169.1"> Jupyter</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.170.1"> server</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.171.1"> (y/[n])?</span></span></span></span><span class="kobospan" id="kobo.172.1"> prompt. </span><span class="kobospan" id="kobo.172.2">A second </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.173.1">Ĉ</span></span><span class="kobospan" id="kobo.174.1"> (or a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.175.1">y</span></span></span></span><span class="kobospan" id="kobo.176.1"> answer) is required to stop the process. </span><span id="x1-680002r1460"/></p>
</section>
<section data-number="0.15.1.5" id="see-also-92">
<h2 class="likechapterhead" data-number="0.15.1.5"><span><span class="kobospan" id="kobo.177.1">12.1.5 </span></span> <span id="x1-6810005"/><span class="kobospan" id="kobo.178.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.179.1">In the </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.180.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.181.1"> section, we’ll move beyond the basics and load a notebook with data.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.182.1">See </span><a href="https://www.packtpub.com/product/learning-jupyter/9781785884870" class="url"><span class="kobospan" id="kobo.183.1">Learning Jupyter</span></a><span class="kobospan" id="kobo.184.1"> for an in-depth book on Jupyter Lab.</span></p></li>
</ul>
<p class="normal1"><span id="x1-681001r1453"/></p>
</section>
</section>
<section data-number="0.15.2" id="ingesting-data-into-a-notebook">
<h1 class="unnumbered" data-number="0.15.2"><span><span class="kobospan" id="kobo.185.1">12.2 </span></span> <span id="x1-6820002"/><span class="kobospan" id="kobo.186.1">Ingesting data into a notebook</span></h1>
<p class="normal"><span class="kobospan" id="kobo.187.1">As a sample data analytics</span><span id="dx1-682001"/><span class="kobospan" id="kobo.188.1"> problem, we’ll look at a data collection containing four closely related series of samples. </span><span class="kobospan" id="kobo.188.2">The file is named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.189.1">anscombe.json</span></span></span></span><span class="kobospan" id="kobo.190.1">. </span><span class="kobospan" id="kobo.190.2">Each series of data is a sequence of (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.191.1">x,y</span></span><span class="kobospan" id="kobo.192.1">) data pairs and a name for the series, represented as a Python dictionary. </span><span class="kobospan" id="kobo.192.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.193.1">series</span></span></span></span><span class="kobospan" id="kobo.194.1"> key has the name of the series. </span><span class="kobospan" id="kobo.194.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.195.1">data</span></span></span></span><span class="kobospan" id="kobo.196.1"> key is the list of data pairs. </span><span class="kobospan" id="kobo.196.2">The four series</span><span id="dx1-682002"/><span class="kobospan" id="kobo.197.1"> are sometimes called </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.198.1">Anscombe’s Quartet</span></span><span class="kobospan" id="kobo.199.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.200.1">We’ll create a notebook to ingest the data. </span><span class="kobospan" id="kobo.200.2">To begin the work, this initial recipe will focus on ordinary Python expressions to confirm the data was loaded properly. </span><span class="kobospan" id="kobo.200.3">In later recipes, we’ll use visualization and statistical methods to see if there are correlations between the two variables. </span><span id="x1-682003r1461"/></p>
<section data-number="0.15.2.1" id="getting-ready-94">
<h2 class="likechapterhead" data-number="0.15.2.1"><span><span class="kobospan" id="kobo.201.1">12.2.1 </span></span> <span id="x1-6830001"/><span class="kobospan" id="kobo.202.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.203.1">There are a few preliminary steps:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-683002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.204.1">Make sure the Jupyter Lab server is running. </span><span class="kobospan" id="kobo.204.2">If it isn’t, see the </span><a href="ch016.xhtml#x1-6760001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.205.1">Starting</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.206.1">a Notebook and creating cells with Python code</span></span></a><span class="kobospan" id="kobo.207.1"> recipe to start the server and open a notebook.</span></p>
</div></li>
<li class="calibre7"><div id="x1-683004x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.208.1">Locate the browser window for this server. </span><span class="kobospan" id="kobo.208.2">When starting a server, a browser window is often displayed that connects to the server.</span></p>
</div></li>
<li class="calibre7"><div id="x1-683006x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.209.1">Start a new notebook for this recipe.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.210.1">If we close the browser</span><span id="dx1-683007"/><span class="kobospan" id="kobo.211.1"> application, or if Python</span><span id="dx1-683008"/><span class="kobospan" id="kobo.212.1"> can’t launch our preferred browser, then the Jupyter Lab server will run, but there’s no </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.213.1">obvious </span></span><span class="kobospan" id="kobo.214.1">browser window to connect to the server. </span><span class="kobospan" id="kobo.214.2">We can locate the server by making an inquiry, using this </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.215.1">jupyter</span></span></span></span><span class="kobospan" id="kobo.216.1"> command:</span></p>
<pre class="programlisting" id="listing-72"><code class="calibre13"><span class="kobospan" id="kobo.217.1">(cookbook3) % python -m jupyter server list</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.218.1">This will identify all running servers. </span><span class="kobospan" id="kobo.218.2">It will provide a URL to connect to the server. </span><span class="kobospan" id="kobo.218.3">The output might look something like the following:</span></p>
<pre class="programlisting" id="listing-73"><code class="calibre13"><span class="kobospan" id="kobo.219.1">(cookbook3) % jupyter server list 
 
Currently running servers: 
 
http://localhost:8888/?token=85e8ad8455cd154bd3253ba0339c783ea60c56f836f7b81c :: /Users/slott/Documents/Writing/Python/Python Cookbook 3e</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.220.1">The actual URL shown in the output on your computer can be used to connect to the server. </span><span id="x1-683013r1463"/></p>
</section>
<section data-number="0.15.2.2" id="how-to-do-it...-95">
<h2 class="likechapterhead" data-number="0.15.2.2"><span><span class="kobospan" id="kobo.221.1">12.2.2 </span></span> <span id="x1-6840002"/><span class="kobospan" id="kobo.222.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-684002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.223.1">Since we’re going to read a file in the JSON format, the first cell can be a code cell with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.224.1">import</span></span></span></span><span class="kobospan" id="kobo.225.1"> statements required.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.226.1">import json 
 
from pathlib import Path</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.227.1">Using the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.228.1">Enter </span></span><span class="kobospan" id="kobo.229.1">(or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.230.1">Return</span></span><span class="kobospan" id="kobo.231.1">) key in the cell adds lines of code.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.232.1">Using </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.233.1">Shift</span></span><span class="kobospan" id="kobo.234.1">+</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.235.1">Enter </span></span><span class="kobospan" id="kobo.236.1">(or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.237.1">Shift</span></span><span class="kobospan" id="kobo.238.1">+</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.239.1">Return</span></span><span class="kobospan" id="kobo.240.1">) will execute the cell’s code and open a new cell for more code. </span><span class="kobospan" id="kobo.240.2">This also happens when we click the </span><span class="obeylines-h"><span><span><span class="kobospan" id="kobo.241.1">▸</span></span></span></span><span class="kobospan" id="kobo.242.1"> icon on the menu bar to execute the code, followed by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.243.1">+</span></span></span></span><span class="kobospan" id="kobo.244.1"> icon on the menu bar to add a new, empty cell.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.245.1">After a cell is executed, the number is filled in for the cell label; the first cell shows </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.246.1">[1]:</span></span></span></span><span class="kobospan" id="kobo.247.1"> when the cell has been executed.</span></p>
</div></li>
<li class="calibre7"><div id="x1-684007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.248.1">It makes sense to put the whole ”read and extract data” process into a single cell:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.249.1">source_path = Path.cwd().parent.parent / "data" / "anscombe.json" 
 
with source_path.open() as source_file: 
 
    all_data = json.load(source_file) 
 
[data[’series’] for data in all_data]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.250.1">The path from the current working</span><span id="dx1-684013"/><span class="kobospan" id="kobo.251.1"> directory to data</span><span id="dx1-684014"/><span class="kobospan" id="kobo.252.1"> assumes the notebook is in a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.253.1">src/ch12</span></span></span></span><span class="kobospan" id="kobo.254.1"> folder, and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.255.1">src</span></span></span></span><span class="kobospan" id="kobo.256.1"> folder is a peer of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.257.1">data</span></span></span></span><span class="kobospan" id="kobo.258.1"> folder. </span><span class="kobospan" id="kobo.258.2">If your project isn’t structured like this, then the computation of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.259.1">source_path</span></span></span></span><span class="kobospan" id="kobo.260.1"> will need to change.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.261.1">When we execute this cell, we’ll see the names of the four data series in this collection. </span><span class="kobospan" id="kobo.261.2">They look like this:</span></p>
<div class="center5">
<p class="normal2"><span class="kobospan" id="kobo.262.1"><img alt="PIC" src="../media/file76.png" class="calibre29"/></span> <span id="x1-684015r3"/> <span id="x1-684016"/></p>
<span><span class="kobospan" id="kobo.263.1">Figure 12.3: </span></span><span><span class="kobospan" id="kobo.264.1">Jupyter notebook with two cells of code </span></span>
</div>
</div></li>
<li class="calibre7"><div id="x1-684018x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.265.1">We can look at the (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.266.1">x,y</span></span><span class="kobospan" id="kobo.267.1">) pairs in this source. </span><span class="kobospan" id="kobo.267.2">A cell with an expression is sufficient to show the value of the expression:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.268.1">all_data[0][’data’]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-684022x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.269.1">We can define a class to hold</span><span id="dx1-684023"/><span class="kobospan" id="kobo.270.1"> these data</span><span id="dx1-684024"/><span class="kobospan" id="kobo.271.1"> pairs. </span><span class="kobospan" id="kobo.271.2">Because the data is JSON-formatted, and because the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.272.1">pydantic</span></span></span></span><span class="kobospan" id="kobo.273.1"> package offers really good JSON parsing, we can consider extending the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.274.1">BaseModel</span></span></span></span><span class="kobospan" id="kobo.275.1"> class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.276.1">This requires rewriting cell 1 to extend the sequence of imports to include:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.277.1">import json 
 
from pathlib import Path 
 
from pydantic import BaseModel</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.278.1">We can click the </span><span class="obeylines-h"><span><span><span class="kobospan" id="kobo.279.1">▸▸</span></span></span></span><span class="kobospan" id="kobo.280.1"> icon to restart the notebook, running all the cells. </span><span class="kobospan" id="kobo.280.2">This is essential when we go back toward the top and make a change.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.281.1">At the top of the page, over the tabs for the launcher at the notebooks, there’s a higher-level menu bar with items like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.282.1">File</span></span><span class="kobospan" id="kobo.283.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.284.1">Edit</span></span><span class="kobospan" id="kobo.285.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.286.1">View</span></span><span class="kobospan" id="kobo.287.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.288.1">Run</span></span><span class="kobospan" id="kobo.289.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.290.1">Kernel</span></span><span class="kobospan" id="kobo.291.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.292.1">Tabs</span></span><span class="kobospan" id="kobo.293.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.294.1">Settings</span></span><span class="kobospan" id="kobo.295.1">, and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.296.1">Help</span></span><span class="kobospan" id="kobo.297.1">. </span><span class="kobospan" id="kobo.297.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.298.1">Kernel </span></span><span class="kobospan" id="kobo.299.1">menu has a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.300.1">Restart</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.301.1">Kernel and Run All Cells... </span></span><span class="kobospan" id="kobo.302.1">item that has the same functionality as the </span><span class="obeylines-h"><span><span><span class="kobospan" id="kobo.303.1">▸▸</span></span></span></span><span class="kobospan" id="kobo.304.1"> icon in the notebook menu bar.</span></p>
</div></li>
<li class="calibre7"><div id="x1-684030x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.305.1">Define a class for an X-Y pair. </span><span class="kobospan" id="kobo.305.2">Then, define a class for the series of individual pairs:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.306.1">class Pair(BaseModel): 
 
    x: float 
 
    y: float 
 
 
 
class Series(BaseModel): 
 
    series: str 
 
    data: list[Pair]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-684040x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.307.1">Then, we can populate the class instances from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.308.1">all_data</span></span></span></span><span class="kobospan" id="kobo.309.1"> object:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.310.1">clean_data = [Series.model_validate(d) for d in all_data]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-684044x7" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.311.1">Use an expression like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.312.1">clean_data[0]</span></span></span></span><span class="kobospan" id="kobo.313.1"> to see a specific series.</span></p>
</div></li>
<li class="calibre7"><div id="x1-684046x8" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.314.1">We have an awkward problem where each series has a position in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.315.1">clean_data</span></span></span></span><span class="kobospan" id="kobo.316.1"> sequence, and a name. </span><span class="kobospan" id="kobo.316.2">Using a mapping is better than using a sequence:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.317.1">quartet = {s.series: s for s in clean_data}</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-684050x9" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.318.1">Use an expression</span><span id="dx1-684051"/><span class="kobospan" id="kobo.319.1"> like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.320.1">quartet[’I’]</span></span></span></span><span class="kobospan" id="kobo.321.1"> to see</span><span id="dx1-684052"/><span class="kobospan" id="kobo.322.1"> a specific series.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-684053r1464"/></p>
</section>
<section data-number="0.15.2.3" id="how-it-works...-95">
<h2 class="likechapterhead" data-number="0.15.2.3"><span><span class="kobospan" id="kobo.323.1">12.2.3 </span></span> <span id="x1-6850003"/><span class="kobospan" id="kobo.324.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.325.1">The Python in each cell is not dramatically different from the code used in the </span><a href="ch015_split_001.xhtml#x1-6520006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.326.1">Reading JSON and YAML documents</span></span></a><span class="kobospan" id="kobo.327.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.328.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.329.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.330.1">11</span></span></a><span class="kobospan" id="kobo.331.1">. </span><span class="kobospan" id="kobo.331.2">We’ve used Jupyter Lab to start an IPython kernel that evaluates the code in each cell.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.332.1">When a cell’s code ends with an expression, the Jupyter Notebook will display any non-None output. </span><span class="kobospan" id="kobo.332.2">This is similar to the command-line REPL. </span><span class="kobospan" id="kobo.332.3">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.333.1">print()</span></span></span></span><span class="kobospan" id="kobo.334.1"> function isn’t needed to display the results of the final expression in a cell.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.335.1">The Jupyter notebook interface is a distinct way to access Python and provides a richly interactive environment. </span><span class="kobospan" id="kobo.335.2">Underneath the clever editing and display features, the language and libraries are still Python. </span><span id="x1-685001r1473"/></p>
</section>
<section data-number="0.15.2.4" id="theres-more...-86">
<h2 class="likechapterhead" data-number="0.15.2.4"><span><span class="kobospan" id="kobo.336.1">12.2.4 </span></span> <span id="x1-6860004"/><span class="kobospan" id="kobo.337.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.338.1">After reviewing the notebook, it’s clear we can optimize some of the processing. </span><span class="kobospan" id="kobo.338.2">There’s no real benefit in creating the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.339.1">all_data</span></span></span></span><span class="kobospan" id="kobo.340.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.341.1">clean_data</span></span></span></span><span class="kobospan" id="kobo.342.1"> objects. </span><span class="kobospan" id="kobo.342.2">The real goal is to work with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.343.1">quartet</span></span></span></span><span class="kobospan" id="kobo.344.1"> object.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.345.1">We can use the following cell to parse and load the series:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.346.1">source_path = Path.cwd().parent.parent / "data" / "anscombe.json" 
 
with source_path.open() as source_file: 
 
    json_document = json.load(source_file) 
 
    source_data = (Series.model_validate(s) for s in json_document) 
 
    quartet = {s.series: s for s in source_data}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.347.1">It helps to insert a new cell after the Pydantic class definition with this code. </span><span class="kobospan" id="kobo.347.2">We can then execute the code. </span><span class="kobospan" id="kobo.347.3">A cell with an expression like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.348.1">quartet[’IV’]</span></span></span></span><span class="kobospan" id="kobo.349.1"> can be used to confirm that the data was loaded.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.350.1">A more complete check would be the following cell:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.351.1">for name in quartet: 
 
    print(f"{name:3s} {len(quartet[name].data):d}")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.352.1">This shows each series name and the number of points in the data for the series.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.353.1">Once this works, we can remove prior cells, add Markdown, and rerun the notebook to make sure it works properly and neatly displays the data to be analyzed. </span><span id="x1-686010r1474"/></p>
</section>
<section data-number="0.15.2.5" id="see-also-93">
<h2 class="likechapterhead" data-number="0.15.2.5"><span><span class="kobospan" id="kobo.354.1">12.2.5 </span></span> <span id="x1-6870005"/><span class="kobospan" id="kobo.355.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.356.1">See the </span><a href="ch015_split_001.xhtml#x1-6520006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.357.1">Reading JSON and YAML documents</span></span></a><span class="kobospan" id="kobo.358.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.359.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.360.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.361.1">11</span></span></a><span class="kobospan" id="kobo.362.1"> for more on JSON-format files.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.363.1">The </span><a href="ch014.xhtml#x1-6000005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.364.1">Implementing more strict type checks with Pydantic</span></span></a><span class="kobospan" id="kobo.365.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.366.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.367.1"> </span></span><a href="ch014.xhtml#x1-57300010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.368.1">10</span></span></a><span class="kobospan" id="kobo.369.1"> covers some features of the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.370.1">Pydantic </span></span><span class="kobospan" id="kobo.371.1">package.</span></p></li>
</ul>
<p class="normal1"><span id="x1-687001r1462"/></p>
</section>
</section>
<section data-number="0.15.3" id="using-pyplot-to-create-a-scatter-plot">
<h1 class="unnumbered" data-number="0.15.3"><span><span class="kobospan" id="kobo.372.1">12.3 </span></span> <span id="x1-6880003"/><span class="kobospan" id="kobo.373.1">Using pyplot to create a scatter plot</span></h1>
<p class="normal"><span class="kobospan" id="kobo.374.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.375.1">matplotlib </span></span><span class="kobospan" id="kobo.376.1">project has</span><span id="dx1-688001"/><span class="kobospan" id="kobo.377.1"> an immense variety</span><span id="dx1-688002"/><span class="kobospan" id="kobo.378.1"> of graph and plot</span><span id="dx1-688003"/><span class="kobospan" id="kobo.379.1"> types that it can produce. </span><span class="kobospan" id="kobo.379.2">It is extremely sophisticated, which makes it challenging to use for some kinds of analysis.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.380.1">A particularly useful subset of features</span><span id="dx1-688004"/><span class="kobospan" id="kobo.381.1"> is collected in a sub-package called </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.382.1">pyplot</span></span></span></span><span class="kobospan" id="kobo.383.1">. </span><span class="kobospan" id="kobo.383.2">This group of features reflects some common assumptions and optimizations that work out very nicely when working in Jupyter Lab. </span><span class="kobospan" id="kobo.383.3">In other contexts, these assumptions are often limiting.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.384.1">To make things easier, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.385.1">pyplot</span></span></span></span><span class="kobospan" id="kobo.386.1"> package will automatically manage the figure being created. </span><span class="kobospan" id="kobo.386.2">It will track any sub-plots that fill in the picture. </span><span class="kobospan" id="kobo.386.3">It will track the various axes and artists that comprise those subplots.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.387.1">For more information, see </span><a href="https://matplotlib.org/stable/users/explain/quick_start.html#parts-of-a-figure" class="url"><span class="kobospan" id="kobo.388.1">Parts of a Figure</span></a><span class="kobospan" id="kobo.389.1"> in the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.390.1">matplotlib </span></span><span class="kobospan" id="kobo.391.1">tutorial. </span><span class="kobospan" id="kobo.391.2">This diagram identifies the various elements of a figure and what parts of </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.392.1">matplotlib</span></span><span class="kobospan" id="kobo.393.1"> are used to create or control those elements.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.394.1">In the </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.395.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.396.1"> recipe, we looked at a collection of data that had four data series. </span><span class="kobospan" id="kobo.396.2">The file that contains this data section is named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.397.1">anscombe.json</span></span></span></span><span class="kobospan" id="kobo.398.1">. </span><span class="kobospan" id="kobo.398.2">Each series of data is a sequence of (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.399.1">x,y</span></span><span class="kobospan" id="kobo.400.1">) data pairs, and each series has a name.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.401.1">The general approach will be to define some useful classes that provide helpful definitions of the series and the samples within a series. </span><span class="kobospan" id="kobo.401.2">Given those definitions, we can read the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.402.1">anscombe.json</span></span></span></span><span class="kobospan" id="kobo.403.1"> file to acquire the data. </span><span class="kobospan" id="kobo.403.2">Once it is loaded, we can then create a figure that shows the data pairs. </span><span id="x1-688005r1477"/></p>
<section data-number="0.15.3.1" id="getting-ready-95">
<h2 class="likechapterhead" data-number="0.15.3.1"><span><span class="kobospan" id="kobo.404.1">12.3.1 </span></span> <span id="x1-6890001"/><span class="kobospan" id="kobo.405.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.406.1">There are a few preliminary steps:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-689002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.407.1">Start the Jupyter Lab server and locate the browser window for it. </span><span class="kobospan" id="kobo.407.2">If it isn’t running, see the </span><a href="ch016.xhtml#x1-6760001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.408.1">Starting a Notebook and creating cells with</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.409.1">Python code</span></span></a><span class="kobospan" id="kobo.410.1"> recipe to start a server. </span><span class="kobospan" id="kobo.410.2">See </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.411.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.412.1"> for advice on locating a server that runs in the background.</span></p>
</div></li>
<li class="calibre7"><div id="x1-689004x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.413.1">Start a new notebook for this recipe.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-689005r1479"/></p>
</section>
<section data-number="0.15.3.2" id="how-to-do-it...-96">
<h2 class="likechapterhead" data-number="0.15.3.2"><span><span class="kobospan" id="kobo.414.1">12.3.2 </span></span> <span id="x1-6900002"/><span class="kobospan" id="kobo.415.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-690002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.416.1">Start the notebook with a cell</span><span id="dx1-690003"/><span class="kobospan" id="kobo.417.1"> that describes what the notebook</span><span id="dx1-690004"/><span class="kobospan" id="kobo.418.1"> will have in it. </span><span class="kobospan" id="kobo.418.2">This should be a Markdown cell to record some notes:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.419.1"># Anscombe’s Quartet 
 
 
 
The raw data has four series. </span><span class="kobospan" id="kobo.419.2">The correlation coefficients are high. 
 
Visualization shows that a simple linear regression model is misleading. 
 
 
 
## Raw Data for the Series</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-690013x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.420.1">Create the imports</span><span id="dx1-690014"/><span class="kobospan" id="kobo.421.1"> required to use </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.422.1">Pydantic </span></span><span class="kobospan" id="kobo.423.1">to load JSON-formatted data. </span><span class="kobospan" id="kobo.423.2">This will be a code cell:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.424.1">import json 
 
from pathlib import Path 
 
from pydantic import BaseModel</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-690020x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.425.1">Define two classes that define each series of data. </span><span class="kobospan" id="kobo.425.2">One class has the individual (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.426.1">x,y</span></span><span class="kobospan" id="kobo.427.1">) pair. </span><span class="kobospan" id="kobo.427.2">The other is the series of pairs, along with the series name:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.428.1">class Pair(BaseModel): 
 
    x: float 
 
    y: float 
 
 
 
class Series(BaseModel): 
 
    series: str 
 
    data: list[Pair]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-690030x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.429.1">Write a cell with the code required to read the data, and create a global variable with the cleaned data:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.430.1">source = Path.cwd().parent.parent / "data" / "anscombe.json" 
 
with source.open() as source_file: 
 
    json_document = json.load(source_file) 
 
    source_data = (Series.model_validate(s) for s in json_document) 
 
    quartet = {s.series: s for s in source_data}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.431.1">The value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.432.1">clean_data</span></span></span></span><span class="kobospan" id="kobo.433.1"> contains a list of four individual </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.434.1">Series</span></span></span></span><span class="kobospan" id="kobo.435.1"> objects. </span><span class="kobospan" id="kobo.435.2">An expression like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.436.1">quartet[’I’]</span></span></span></span><span class="kobospan" id="kobo.437.1"> will reveal one of the series.</span></p>
</div></li>
<li class="calibre7"><div id="x1-690038x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.438.1">Add a Markdown cell showing what the next part of this notebook will contain:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.439.1">## Visualization of each series</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-690042x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.440.1">Write the needed import for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.441.1">pyplot</span></span></span></span><span class="kobospan" id="kobo.442.1"> package. </span><span class="kobospan" id="kobo.442.2">This is often renamed </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.443.1">plt</span></span></span></span><span class="kobospan" id="kobo.444.1"> to simplify the code that is written in the Jupyter notebook cells:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.445.1">from matplotlib import pyplot as plt</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-690046x7" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.446.1">For an individual series, we’ll need to extract two parallel sequences of numbers. </span><span class="kobospan" id="kobo.446.2">We’ll use list comprehensions on </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.447.1">clean_data[0].data</span></span></span></span><span class="kobospan" id="kobo.448.1"> to extract the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.449.1">x</span></span></span></span><span class="kobospan" id="kobo.450.1"> values for one sequence and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.451.1">y</span></span></span></span><span class="kobospan" id="kobo.452.1"> values for a second, parallel sequence:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.453.1">x = [p.x for p in quartet[’I’].data] 
 
y = [p.y for p in quartet[’I’].data]
                                                                     

                                                                     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-690051x8" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.454.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.455.1">scatter()</span></span></span></span><span class="kobospan" id="kobo.456.1"> function</span><span id="dx1-690052"/><span class="kobospan" id="kobo.457.1"> creates the essential</span><span id="dx1-690053"/><span class="kobospan" id="kobo.458.1"> scatter plot. </span><span class="kobospan" id="kobo.458.2">We provide two parallel sequences: one has the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.459.1">x </span></span><span class="kobospan" id="kobo.460.1">values and one has the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.461.1">y</span></span><span class="kobospan" id="kobo.462.1"> values. </span><span class="kobospan" id="kobo.462.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.463.1">title()</span></span></span></span><span class="kobospan" id="kobo.464.1"> function will place a label above the plot. </span><span class="kobospan" id="kobo.464.2">We’ve constructed a string from the series name. </span><span class="kobospan" id="kobo.464.3">While not always necessary, a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.465.1">plt.show()</span></span></span></span><span class="kobospan" id="kobo.466.1"> is sometimes needed to display the resulting plot:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.467.1">plt.scatter(x, y) 
 
plt.title(f"Series {quartet[’I’].series}") 
 
plt.show()</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.468.1">The resulting notebook will include cells like this:</span></p>
<div class="center">
<p class="normal1"><span class="kobospan" id="kobo.469.1"><img alt="PIC" src="../media/file77.png" class="calibre30"/></span> <span id="x1-690058r4"/> <span id="x1-690059"/></p>
<span><span class="kobospan" id="kobo.470.1">Figure 12.4: </span></span><span><span class="kobospan" id="kobo.471.1">Jupyter notebook with a figure for Series I </span></span>
</div>
<p class="normal1"><span id="x1-690060r1480"/></p>
</section>
<section data-number="0.15.3.3" id="how-it-works...-96">
<h2 class="likechapterhead" data-number="0.15.3.3"><span><span class="kobospan" id="kobo.472.1">12.3.3 </span></span> <span id="x1-6910003"/><span class="kobospan" id="kobo.473.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.474.1">The underlying </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.475.1">matplotlib</span></span></span></span><span class="kobospan" id="kobo.476.1"> package</span><span id="dx1-691001"/><span class="kobospan" id="kobo.477.1"> has a tall stack</span><span id="dx1-691002"/><span class="kobospan" id="kobo.478.1"> of components to support graphics and visualizations of data. </span><span class="kobospan" id="kobo.478.2">One foundation is the idea of a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.479.1">backend</span></span><span class="kobospan" id="kobo.480.1"> component to integrate with the wide variety of contexts, frameworks, and platforms in which Python is used. </span><span class="kobospan" id="kobo.480.2">This also includes interactive environments like Jupyter Lab. </span><span class="kobospan" id="kobo.480.3">It also includes static, non-interactive backends that can produce a variety of image file formats.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.481.1">Another foundational element of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.482.1">matplotlib</span></span></span></span><span class="kobospan" id="kobo.483.1"> is the API that lets us create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.484.1">Figure</span></span></span></span><span class="kobospan" id="kobo.485.1"> object populated with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.486.1">Artist</span></span></span></span><span class="kobospan" id="kobo.487.1"> objects. </span><span class="kobospan" id="kobo.487.2">The collection of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.488.1">Artist</span></span></span></span><span class="kobospan" id="kobo.489.1"> objects will draw the titles, axes, data points, and lines we expect to see in the figure. </span><span class="kobospan" id="kobo.489.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.490.1">Artist</span></span></span></span><span class="kobospan" id="kobo.491.1"> objects can be interactive, permitting them to refresh a figure when the data changes, or when the display shape changes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.492.1">In this kind of analysis notebook, we’re often more interested in a static figure that’s drawn once. </span><span class="kobospan" id="kobo.492.2">Our objective is to save the notebook for other people to view and understand the data. </span><span class="kobospan" id="kobo.492.3">The ultimate goal is to communicate relationships or trends in the data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.493.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.494.1">pyplot </span></span><span class="kobospan" id="kobo.495.1">package contains a number</span><span id="dx1-691003"/><span class="kobospan" id="kobo.496.1"> of simplifications for the overall</span><span id="dx1-691004"/> <span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.497.1">matplotlib</span></span></span></span><span class="kobospan" id="kobo.498.1"> API. </span><span class="kobospan" id="kobo.498.2">These simplifications save us from some of the tedious details of keeping track of the various axes instances that are used to create a plot displayed in a figure. </span><span id="x1-691005r1490"/></p>
</section>
<section data-number="0.15.3.4" id="theres-more...-87">
<h2 class="likechapterhead" data-number="0.15.3.4"><span><span class="kobospan" id="kobo.499.1">12.3.4 </span></span> <span id="x1-6920004"/><span class="kobospan" id="kobo.500.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.501.1">We’ll often want to see several closely related plots as part of a single figure. </span><span class="kobospan" id="kobo.501.2">In this case, where we have four series of data in a single file, it seems particularly helpful to put all four plots together.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.502.1">This is done using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.503.1">plt.figure()</span></span></span></span><span class="kobospan" id="kobo.504.1"> to create an overall figure. </span><span class="kobospan" id="kobo.504.2">Within this figure, each </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.505.1">plt.subplot()</span></span></span></span><span class="kobospan" id="kobo.506.1"> function can create a distinct subplot. </span><span class="kobospan" id="kobo.506.2">The layout of the figure is provided as part of each subplot request as three numbers: the number of plots arranged vertically within the figure, the number plots horizontally in the figure, and this particular plot’s location within that layout.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.507.1">We might use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.508.1">2,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.509.1"> 2,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.510.1"> n</span></span></span></span><span class="kobospan" id="kobo.511.1"> to state that the figure has a 2 </span><span><span class="kobospan" id="kobo.512.1">× </span></span><span class="kobospan" id="kobo.513.1">2 arrangement, and this specific subplot has position </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.514.1">n</span></span><span class="kobospan" id="kobo.515.1">. </span><span class="kobospan" id="kobo.515.2">The positions are counted across the figure from top left to bottom right. </span><span class="kobospan" id="kobo.515.3">The position can also span more than one section of the figure so that we have one large plot and a number of smaller plots.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.516.1">To make it easier to extract the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.517.1">x</span></span></span></span><span class="kobospan" id="kobo.518.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.519.1">y</span></span></span></span><span class="kobospan" id="kobo.520.1"> attributes of each plot, we’ll modify the definition of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.521.1">Series</span></span></span></span><span class="kobospan" id="kobo.522.1"> class. </span><span class="kobospan" id="kobo.522.2">We’ll add two properties, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.523.1">x</span></span></span></span><span class="kobospan" id="kobo.524.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.525.1">y</span></span></span></span><span class="kobospan" id="kobo.526.1">, that will extract all of the series values. </span><span class="kobospan" id="kobo.526.2">This redefines the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.527.1">Series</span></span></span></span><span class="kobospan" id="kobo.528.1"> class as follows:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.529.1">class Series(BaseModel): 
 
    series: str 
 
    data: list[Pair] 
 
 
 
    @property 
 
    def x(self) -&gt; list[float]: 
 
        return [p.x for p in self.data] 
 
 
 
    @property 
 
    def y(self) -&gt; list[float]: 
 
        return [p.y for p in self.data]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.530.1">Adding these properties permits some slight simplifications in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.531.1">plt.scatter()</span></span></span></span><span class="kobospan" id="kobo.532.1"> function. </span><span class="kobospan" id="kobo.532.2">The overall figure can be created by a cell with the following code:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.533.1">plt.figure(layout=’tight’) 
 
for n, series in enumerate(quartet.values(), start=1): 
 
    title = f"Series {series.series}" 
 
    plt.subplot(2, 2, n) 
 
    plt.scatter(series.x, series.y) 
 
    plt.title(title)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.534.1">After changing the new </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.535.1">Series</span></span></span></span><span class="kobospan" id="kobo.536.1"> class definition, the notebook’s cells must be rerun from the beginning. </span><span class="kobospan" id="kobo.536.2">In the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.537.1">Run </span></span><span class="kobospan" id="kobo.538.1">menu, the item to </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.539.1">Restart the</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.540.1">kernel and run all cells </span></span><span class="kobospan" id="kobo.541.1">will incorporate the revised class and reload the data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.542.1">There are numerous options and parameters for the definition of the figure overall, the scatter plot, and the axes for the scatter plot. </span><span class="kobospan" id="kobo.542.2">Additionally, there are numerous alternative kinds of plots available. </span><span class="kobospan" id="kobo.542.3">The </span><a href="https://matplotlib.org/stable/gallery/index.html" class="url"><span class="kobospan" id="kobo.543.1">Matplotlib Examples Gallery</span></a><span class="kobospan" id="kobo.544.1"> shows dozens</span><span id="dx1-692020"/><span class="kobospan" id="kobo.545.1"> of varieties of plots. </span><span class="kobospan" id="kobo.545.2">For example, in a case where we have an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.546.1">Counter</span></span></span></span><span class="kobospan" id="kobo.547.1"> object, we can create a bar chart using a sequence of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.548.1">x </span></span><span class="kobospan" id="kobo.549.1">values and a sequence of height values, using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.550.1">bar()</span></span></span></span><span class="kobospan" id="kobo.551.1"> function instead of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.552.1">scatter()</span></span></span></span><span class="kobospan" id="kobo.553.1"> function. </span><span class="kobospan" id="kobo.553.2">See the </span><a href="ch009.xhtml#x1-2900001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.554.1">Creating dictionaries – inserting and updating</span></span></a><span class="kobospan" id="kobo.555.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.556.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.557.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.558.1">5</span></span></a><span class="kobospan" id="kobo.559.1"> for examples of creating a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.560.1">Counter</span></span></span></span><span class="kobospan" id="kobo.561.1"> object to summarize frequencies in source data. </span><span id="x1-692021r1491"/></p>
</section>
<section data-number="0.15.3.5" id="see-also-94">
<h2 class="likechapterhead" data-number="0.15.3.5"><span><span class="kobospan" id="kobo.562.1">12.3.5 </span></span> <span id="x1-6930005"/><span class="kobospan" id="kobo.563.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.564.1">See the </span><a href="ch015_split_001.xhtml#x1-6520006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.565.1">Reading JSON and YAML documents</span></span></a><span class="kobospan" id="kobo.566.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.567.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.568.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.569.1">11</span></span></a><span class="kobospan" id="kobo.570.1"> for more on JSON-format files.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.571.1">The </span><a href="ch014.xhtml#x1-6000005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.572.1">Implementing more strict type checks with Pydantic</span></span></a><span class="kobospan" id="kobo.573.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.574.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.575.1"> </span></span><a href="ch014.xhtml#x1-57300010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.576.1">10</span></span></a><span class="kobospan" id="kobo.577.1"> covers some features of using the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.578.1">Pydantic </span></span><span class="kobospan" id="kobo.579.1">package.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.580.1">The </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.581.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.582.1"> recipe earlier in this chapter looks at JSON loading in more depth.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.583.1">See the </span><a href="https://matplotlib.org/stable/gallery/index.html" class="url"><span class="kobospan" id="kobo.584.1">Matplotlib Examples Gallery</span></a><span class="kobospan" id="kobo.585.1"> for dozens of varieties of plots.</span></p></li>
</ul>
<p class="normal1"><span id="x1-693001r1478"/></p>
</section>
</section>
<section data-number="0.15.4" id="using-axes-directly-to-create-a-scatter-plot">
<h1 class="unnumbered" data-number="0.15.4"><span><span class="kobospan" id="kobo.586.1">12.4 </span></span> <span id="x1-6940004"/><span class="kobospan" id="kobo.587.1">Using axes directly to create a scatter plot</span></h1>
<p class="normal"><span class="kobospan" id="kobo.588.1">Many ordinary graphics visualizations</span><span id="dx1-694001"/><span class="kobospan" id="kobo.589.1"> can be done using</span><span id="dx1-694002"/><span class="kobospan" id="kobo.590.1"> the functions available directly in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.591.1">pyplot</span></span></span></span><span class="kobospan" id="kobo.592.1"> module. </span><span class="kobospan" id="kobo.592.2">In the previous recipes, we used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.593.1">scatter()</span></span></span></span><span class="kobospan" id="kobo.594.1"> function to draw a scatter plot showing the relationship between two variables. </span><span class="kobospan" id="kobo.594.2">Other functions like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.595.1">bar()</span></span></span></span><span class="kobospan" id="kobo.596.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.597.1">pie()</span></span></span></span><span class="kobospan" id="kobo.598.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.599.1">hist()</span></span></span></span><span class="kobospan" id="kobo.600.1"> will create other kinds of plots from our raw data. </span><span class="kobospan" id="kobo.600.2">However, there are times when the readily available functions on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.601.1">pyplot</span></span></span></span><span class="kobospan" id="kobo.602.1"> module aren’t completely appropriate, and we’d like to do a few more things in our images.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.603.1">In this recipe, we’ll add a legend box to each of the sub-plots to show the linear regression parameters that fit the scatter-plot data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.604.1">In the </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.605.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.606.1"> recipe, we looked at a collection of data that had four series of data. </span><span class="kobospan" id="kobo.606.2">The file that contained this data is named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.607.1">anscombe.json</span></span></span></span><span class="kobospan" id="kobo.608.1">. </span><span class="kobospan" id="kobo.608.2">Each series of data is a dictionary with a sequence of (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.609.1">x,y</span></span><span class="kobospan" id="kobo.610.1">) data pairs, and a name for the series.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.611.1">The general approach will be to define some classes that provide helpful definitions of the series and the samples within a series. </span><span class="kobospan" id="kobo.611.2">Given those definitions, we can read the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.612.1">anscombe.json</span></span></span></span><span class="kobospan" id="kobo.613.1"> file to acquire the data. </span><span class="kobospan" id="kobo.613.2">Once it is loaded, we can then create a figure that shows the data pairs.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.614.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.615.1">statistics</span></span></span></span><span class="kobospan" id="kobo.616.1"> module in Python provides two handy functions, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.617.1">correlation()</span></span></span></span><span class="kobospan" id="kobo.618.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.619.1">regression()</span></span></span></span><span class="kobospan" id="kobo.620.1">, that help us annotate each plot with some parameters. </span><span id="x1-694003r1494"/></p>
<section data-number="0.15.4.1" id="getting-ready-96">
<h2 class="likechapterhead" data-number="0.15.4.1"><span><span class="kobospan" id="kobo.621.1">12.4.1 </span></span> <span id="x1-6950001"/><span class="kobospan" id="kobo.622.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.623.1">There are a few preliminary steps:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-695002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.624.1">Ensure the Jupyter Lab server</span><span id="dx1-695003"/><span class="kobospan" id="kobo.625.1"> is running, and locate</span><span id="dx1-695004"/><span class="kobospan" id="kobo.626.1"> the browser window for it. </span><span class="kobospan" id="kobo.626.2">The </span><a href="ch016.xhtml#x1-6760001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.627.1">Starting a Notebook and creating cells with Python</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.628.1">code</span></span></a><span class="kobospan" id="kobo.629.1"> recipe shows how to start a server. </span><span class="kobospan" id="kobo.629.2">The </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.630.1">Ingesting data into a</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.631.1">notebook</span></span></a><span class="kobospan" id="kobo.632.1"> has some additional advice on locating a server running in the background.</span></p>
</div></li>
<li class="calibre7"><div id="x1-695006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.633.1">Start a new notebook for this recipe.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-695007r1496"/></p>
</section>
<section data-number="0.15.4.2" id="how-to-do-it...-97">
<h2 class="likechapterhead" data-number="0.15.4.2"><span><span class="kobospan" id="kobo.634.1">12.4.2 </span></span> <span id="x1-6960002"/><span class="kobospan" id="kobo.635.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-696002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.636.1">Start the notebook with a cell that describes what the notebook will have in it. </span><span class="kobospan" id="kobo.636.2">This should be a cell with Markdown content instead of code content:</span></p>
<pre class="programlisting" id="listing-74"><code class="calibre13"><span class="kobospan" id="kobo.637.1"># Anscombe’s Quartet 
 
 
 
Visualization with correlation coefficients and linear regression model. 
 
 
 
## Raw Data for the Series</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-696009x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.638.1">Create the imports</span><span id="dx1-696010"/><span class="kobospan" id="kobo.639.1"> required to use </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.640.1">Pydantic </span></span><span class="kobospan" id="kobo.641.1">to load JSON-formatted data. </span><span class="kobospan" id="kobo.641.2">This will be a code cell:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.642.1">import json 
 
from pathlib import Path 
 
import statistics 
 
 
 
from pydantic import BaseModel</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-696018x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.643.1">Define two classes that define each series of data. </span><span class="kobospan" id="kobo.643.2">One class has the individual (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.644.1">x,y</span></span><span class="kobospan" id="kobo.645.1">) pair:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.646.1">class Pair(BaseModel): 
 
    x: float 
 
    y: float</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.647.1">The second class is series of pairs, along with the series name. </span><span class="kobospan" id="kobo.647.2">This includes two methods to compute the useful statistical summaries like correlation and regression:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.648.1">
        return [p.y for p in self.data] 
 
 
 
    @property 
 
    def correlation(self) -&gt; float: 
 
        return statistics.correlation(self.x, self.y)                                                                

                                                                     
     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-696030x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.649.1">Create a cell to ingest the data, creating a dictionary that maps a series name to the related </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.650.1">Series</span></span></span></span><span class="kobospan" id="kobo.651.1"> instance:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.652.1">source = Path.cwd().parent.parent / "data" / "anscombe.json" 
 
with source.open() as source_file: 
 
    json_document = json.load(source_file) 
 
    source_data = (Series.model_validate(s) for s in json_document) 
 
    quartet = {s.series: s for s in source_data}</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-696038x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.653.1">Confirm that the previous cells all work. </span><span class="kobospan" id="kobo.653.2">Create a cell to evaluate an expression like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.654.1">quartet[’I’].correlation</span></span></span></span><span class="kobospan" id="kobo.655.1">. </span><span class="kobospan" id="kobo.655.2">Rounded, the result will be 0.816. </span><span class="kobospan" id="kobo.655.3">Interestingly, the result is almost the same for all four series.</span></p>
</div></li>
<li class="calibre7"><div id="x1-696040x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.656.1">Start a cell with an expression</span><span id="dx1-696041"/><span class="kobospan" id="kobo.657.1"> to create a figure using</span><span id="dx1-696042"/><span class="kobospan" id="kobo.658.1"> the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.659.1">figure()</span></span></span></span><span class="kobospan" id="kobo.660.1"> function. </span><span class="kobospan" id="kobo.660.2">Providing a value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.661.1">’tight’</span></span></span></span><span class="kobospan" id="kobo.662.1"> for the layout produces a good-looking figure. </span><span class="kobospan" id="kobo.662.2">It’s essential to assign this to a variable so that the object persists until it can be displayed by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.663.1">plt.show()</span></span></span></span><span class="kobospan" id="kobo.664.1"> function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.665.1">fig = plt.figure(layout=’tight’)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.666.1">Add a line to the cell to create a collection of axes for displaying four subplots within the overall figure. </span><span class="kobospan" id="kobo.666.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.667.1">subplot_mosaic()</span></span></span></span><span class="kobospan" id="kobo.668.1"> function provides a great deal of sophisticated layout capabilities. </span><span class="kobospan" id="kobo.668.2">The list-of-lists structure will create a grid that’s square. </span><span class="kobospan" id="kobo.668.3">The axes will be assigned to a dictionary, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.669.1">ax_dict</span></span></span></span><span class="kobospan" id="kobo.670.1"> with four distinct keys. </span><span class="kobospan" id="kobo.670.2">We’ve chosen the keys to match the series names and positioned them in rows and columns of the resulting figure, using lists of lists:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.671.1">ax_dict = fig.subplot_mosaic( 
 
    [ 
 
        ["I", "II"], 
 
        ["III", "IV"], 
 
    ], 
 
)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-696053x7" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.672.1">Add the scatter plot and the text caption. </span><span class="kobospan" id="kobo.672.2">We can also build a string with the correlation coefficient, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.673.1">r</span></span><span class="kobospan" id="kobo.674.1">. </span><span class="kobospan" id="kobo.674.2">This can be placed near the bottom-right corner of the plot using a relative position that is specified as (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.675.1">.</span></span><span class="kobospan" id="kobo.676.1">95</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.677.1">,.</span></span><span class="kobospan" id="kobo.678.1">05); this is transformed by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.679.1">ax.transAxes</span></span></span></span><span class="kobospan" id="kobo.680.1"> transformer into coordinates based on the sizes of axes.</span></p>
<pre class="programlisting" id="listing-75"><code class="calibre13"><span class="kobospan" id="kobo.681.1">for name, ax in ax_dict.items(): 
 
    series = quartet[name] 
 
    ax.scatter(series.x, series.y) 
 
    ax.set_title(f"Series {name}") 
 
    eq1 = rf"$r = {series.correlation:.3f}$" 
 
    ax.text(.95, .05, f"{eq1}", 
 
            fontfamily=’sans-serif’, 
 
            horizontalalignment=’right’, verticalalignment=’bottom’, transform=ax.transAxes) 
 
plt.show()</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.682.1">The use of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.683.1">$</span></span></span></span><span class="kobospan" id="kobo.684.1"> around</span><span id="dx1-696063"/><span class="kobospan" id="kobo.685.1"> the string, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.686.1">rf"$r</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.687.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.688.1"> {...}$"</span></span></span></span><span class="kobospan" id="kobo.689.1">, forces </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.690.1">matplotlib </span></span><span class="kobospan" id="kobo.691.1">to apply TeXformatting rules to the text, creating a properly</span><span id="dx1-696064"/><span class="kobospan" id="kobo.692.1"> formatted mathematical equation.</span></p>
</div></li>
<li class="calibre7"><div id="x1-696066x8" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.693.1">When creating an explicit figure, a final call to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.694.1">show()</span></span></span></span><span class="kobospan" id="kobo.695.1"> function is needed to display the image:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.696.1">plt.show()</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span id="x1-696069r1497"/></p>
</section>
<section data-number="0.15.4.3" id="how-it-works...-97">
<h2 class="likechapterhead" data-number="0.15.4.3"><span><span class="kobospan" id="kobo.697.1">12.4.3 </span></span> <span id="x1-6970003"/><span class="kobospan" id="kobo.698.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.699.1">The graphics technology stack in </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.700.1">matplotlib </span></span><span class="kobospan" id="kobo.701.1">includes an immense variety</span><span id="dx1-697001"/><span class="kobospan" id="kobo.702.1"> of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.703.1">Artist</span></span></span></span><span class="kobospan" id="kobo.704.1"> subclasses. </span><span class="kobospan" id="kobo.704.2">Each of these will create some part of the final image. </span><span class="kobospan" id="kobo.704.3">In this case, we’ve used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.705.1">subplot_mosaic()</span></span></span></span><span class="kobospan" id="kobo.706.1"> function to create four subplot objects, each with a set of axes.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.707.1">We’ve used the axes object to display the data, specifying that a scatter plot organization should be used. </span><span class="kobospan" id="kobo.707.2">The title for the plot and the text block with the correlation coefficient also draw details in the plot.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.708.1">At some point, the display can become cluttered with details. </span><span class="kobospan" id="kobo.708.2">A good presentation of data needs to have a message. </span><span class="kobospan" id="kobo.708.3">There are many</span><span id="dx1-697002"/><span class="kobospan" id="kobo.709.1"> interesting books</span><span id="dx1-697003"/><span class="kobospan" id="kobo.710.1"> and articles written about good (and bad) ways to present data to an audience. </span><span class="kobospan" id="kobo.710.2">Consider </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.711.1">Matplotlib for Python Developers </span></span><span class="kobospan" id="kobo.712.1">from Packt Publishing as a way to learn more about data visualization. </span><span id="x1-697004r1505"/></p>
</section>
<section data-number="0.15.4.4" id="theres-more...-88">
<h2 class="likechapterhead" data-number="0.15.4.4"><span><span class="kobospan" id="kobo.713.1">12.4.4 </span></span> <span id="x1-6980004"/><span class="kobospan" id="kobo.714.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.715.1">The correlation value suggests there’s a relationship between the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.716.1">x </span></span><span class="kobospan" id="kobo.717.1">and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.718.1">y </span></span><span class="kobospan" id="kobo.719.1">variables in the series. </span><span class="kobospan" id="kobo.719.2">We can use linear regression to compute the parameters for a linear model that predicts the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.720.1">y </span></span><span class="kobospan" id="kobo.721.1">value when given an </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.722.1">x</span></span><span class="kobospan" id="kobo.723.1"> value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.724.1">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.725.1">linear_regression()</span></span></span></span><span class="kobospan" id="kobo.726.1"> function is part of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.727.1">statistics</span></span></span></span><span class="kobospan" id="kobo.728.1"> module in the standard library. </span><span class="kobospan" id="kobo.728.2">The result of this function is a tuple with slope and intercept values that describe a linear relationship, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.729.1">y </span></span><span class="kobospan" id="kobo.730.1">= </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.731.1">mx </span></span><span class="kobospan" id="kobo.732.1">+ </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.733.1">b</span></span><span class="kobospan" id="kobo.734.1">, where </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.735.1">m </span></span><span class="kobospan" id="kobo.736.1">is the slope and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.737.1">b</span></span><span class="kobospan" id="kobo.738.1"> is the intercept.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.739.1">We can update the cells of this notebook</span><span id="dx1-698001"/><span class="kobospan" id="kobo.740.1"> to add the linear regression computation. </span><span class="kobospan" id="kobo.740.2">There are several changes:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-698003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.741.1">Change the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.742.1">Series</span></span></span></span><span class="kobospan" id="kobo.743.1"> class to add another property that performs the linear regression computation:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.744.1">
    @property 
 
    def regression(self) -&gt; tuple[float, float]: 
 
        return statistics.linear_regression(self.x, self.y)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-698009x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.745.1">Add a cell to confirm that the regression works. </span><span class="kobospan" id="kobo.745.2">The cell can display the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.746.1">quartet[’I’].regression</span></span></span></span><span class="kobospan" id="kobo.747.1"> The result will have a slope of almost 0.5 and an intercept of almost 3.0. </span><span class="kobospan" id="kobo.747.2">Interestingly, this is almost identical for all four series.</span></p>
</div></li>
<li class="calibre7"><div id="x1-698011x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.748.1">Change the subplot label to include the regression parameters:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.749.1">
    lr = series.regression 
 
    eq1 = rf"$r = {series.correlation:.3f}$" 
 
    eq2 = rf"$Y = {lr.slope:.1f} \times X + {lr.intercept:.2f}$" 
 
    ax.text(.95, .05, f"{eq1}\n{eq2}", 
 
            fontfamily=’sans-serif’, 
 
            horizontalalignment=’right’, verticalalignment=’bottom’, transform=ax.transAxes) 
 
    ax.axline((0, lr.intercept), slope=lr.slope)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.750.1">After these changes, restarting the kernel and running all cells will show that each of the four subplots shows both the correlation coefficient and the equation for a line that predicts </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.751.1">y </span></span><span class="kobospan" id="kobo.752.1">values from given </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.753.1">x </span></span><span class="kobospan" id="kobo.754.1">values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.755.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.756.1">axline()</span></span></span></span><span class="kobospan" id="kobo.757.1"> function can be used to add the regression line to each subplot. </span><span class="kobospan" id="kobo.757.2">We’ve provided a known point, the (0</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.758.1">,b</span></span><span class="kobospan" id="kobo.759.1">) intercept, and the slope, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.760.1">m</span></span><span class="kobospan" id="kobo.761.1">. </span><span class="kobospan" id="kobo.761.2">The line is automatically constrained to fit within the range of the axes. </span><span class="kobospan" id="kobo.761.3">This may be little more than more visual clutter, or it may be helpful for understanding the relationship between the variables:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.762.1">    ax.axline((0, lr.intercept), slope=lr.slope)</span></code></pre>
<p class="normal1"><span id="x1-698022r1506"/></p>
</section>
<section data-number="0.15.4.5" id="see-also-95">
<h2 class="likechapterhead" data-number="0.15.4.5"><span><span class="kobospan" id="kobo.763.1">12.4.5 </span></span> <span id="x1-6990005"/><span class="kobospan" id="kobo.764.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.765.1">The </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.766.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.767.1"> recipe earlier in this chapter has more details on ingesting data.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.768.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.769.1">matplotlib </span></span><span class="kobospan" id="kobo.770.1">examples pages include dozens of plots suitable for statistical analysis. </span><span class="kobospan" id="kobo.770.2">See the </span><a class="url" href="https://matplotlib.org/stable/gallery/statistics/index.html"><span class="url1"><span class="kobospan" id="kobo.771.1">https://matplotlib.org/stable/gallery/statistics/index.html</span></span></a><span class="kobospan" id="kobo.772.1"> Statistics Gallery web page for a large number of examples of data visualizations.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.773.1">See the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.774.1">matplotlib </span></span><a class="url" href="https://matplotlib.org/stable/users/resources/index.html#books-chapters-and-articles"><span class="url1"><span class="kobospan" id="kobo.775.1">https://matplotlib.org/stable/users/resources/index.html#books-chapters-and-articles</span></span></a><span class="kobospan" id="kobo.776.1"> books, chapters and articles web page for books on data visualization.</span></p></li>
</ul>
<p class="normal1"><span id="x1-699001r1495"/></p>
</section>
</section>
<section data-number="0.15.5" id="adding-details-to-markdown-cells">
<h1 class="unnumbered" data-number="0.15.5"><span><span class="kobospan" id="kobo.777.1">12.5 </span></span> <span id="x1-7000005"/><span class="kobospan" id="kobo.778.1">Adding details to markdown cells</span></h1>
<p class="normal"><span class="kobospan" id="kobo.779.1">The point of data analytics</span><span id="dx1-700001"/><span class="kobospan" id="kobo.780.1"> is to offer deeper insights into numeric measures to show trends and relationships. </span><span class="kobospan" id="kobo.780.2">The object, in general, is to help someone make a decision that’s fact-based. </span><span class="kobospan" id="kobo.780.3">The decision can be as simple as deciding to recharge a vehicle before a trip, based on the anticipated distance and time available for charging. </span><span class="kobospan" id="kobo.780.4">Alternatively, it can be as profound as responding to a medical diagnosis with effective therapies.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.781.1">Visualization is one aspect of presenting data for an audience to help their understanding. </span><span class="kobospan" id="kobo.781.2">Adjacent to visualization is organizing the presented material into a coherent story. </span><span class="kobospan" id="kobo.781.3">Further, we also need to provide supplemental details beyond figures and images. </span><span class="kobospan" id="kobo.781.4">See </span><a href="https://www.packtpub.com/product/the-managers-guide-to-presentations/9781783000142" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.782.1">The Manager’s Guide to Presentations</span></span></a><span class="kobospan" id="kobo.783.1"> from Packt Publishing for more on this topic. </span><span id="x1-700002r1510"/></p>
<section data-number="0.15.5.1" id="getting-ready-97">
<h2 class="likechapterhead" data-number="0.15.5.1"><span><span class="kobospan" id="kobo.784.1">12.5.1 </span></span> <span id="x1-7010001"/><span class="kobospan" id="kobo.785.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.786.1">We’ll update a notebook with some cells that contain Markdown formatting. </span><span class="kobospan" id="kobo.786.2">We can start with a notebook created in one of the recipes earlier in this chapter. </span><span class="kobospan" id="kobo.786.3">An alternative is to create a new, empty notebook that contains formatted text.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.787.1">A notebook can be exported as a PDF file directly from Jupyter Lab. </span><span class="kobospan" id="kobo.787.2">This is the quickest and easiest publication route. </span><span class="kobospan" id="kobo.787.3">We may want to hide some code cells from these kind of publications.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.788.1">For more polished results, it helps to use separate formatting tools. </span><span class="kobospan" id="kobo.788.2">A notebook can be exported as a Markdown file (or Restructured Text or LaTeX). </span><span class="kobospan" id="kobo.788.3">Appropriate programs like Pandoc, Docutils, or a a TeXtoolset can then create documents from the exported notebook.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.789.1">Tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.790.1">Quarto </span></span><span class="kobospan" id="kobo.791.1">and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.792.1">Jupyter </span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.793.1">{</span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.794.1">Book</span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.795.1">} </span></span><span class="kobospan" id="kobo.796.1">can also be used</span><span id="dx1-701001"/><span class="kobospan" id="kobo.797.1"> to create</span><span id="dx1-701002"/><span class="kobospan" id="kobo.798.1"> polished output.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.799.1">The essential basics, however, are a sensible organization, clear writing, and Markdown-formatting in the notebook cells. </span><span class="kobospan" id="kobo.799.2">An interesting part of using Markdown is that a cell’s content is essentially static. </span><span class="kobospan" id="kobo.799.3">The notebook’s syntax won’t take computed values and inject them into a Markdown cell.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.800.1">There are two ways to create dynamic</span><span id="dx1-701003"/><span class="kobospan" id="kobo.801.1"> content:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.802.1">Install the </span><a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions/tree/master/src/jupyter_contrib_nbextensions/nbextensions/python-markdown" class="url"><span class="kobospan" id="kobo.803.1">Python Markdown</span></a><span class="kobospan" id="kobo.804.1"> extension. </span><span class="kobospan" id="kobo.804.2">See </span><a href="https://jupyterlab.readthedocs.io/en/stable/user/extensions.html" class="url"><span class="kobospan" id="kobo.805.1">Extensions</span></a><span class="kobospan" id="kobo.806.1"> in the Jupyter Lab documentation. </span><span class="kobospan" id="kobo.806.2">After installing this extension, code can be included in a Markdown cell by surrounding it with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.807.1">{{</span></span></span></span><span class="kobospan" id="kobo.808.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.809.1">}}</span></span></span></span><span class="kobospan" id="kobo.810.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.811.1">Build the Markdown content</span><span id="dx1-701004"/><span class="kobospan" id="kobo.812.1"> in a code cell, and then</span><span id="dx1-701005"/><span class="kobospan" id="kobo.813.1"> render the results as Markdown. </span><span class="kobospan" id="kobo.813.2">We’ll look at this in a little more depth next.</span></p></li>
</ul>
<p class="normal1"><span id="x1-701006r1512"/></p>
</section>
<section data-number="0.15.5.2" id="how-to-do-it...-98">
<h2 class="likechapterhead" data-number="0.15.5.2"><span><span class="kobospan" id="kobo.814.1">12.5.2 </span></span> <span id="x1-7020002"/><span class="kobospan" id="kobo.815.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-702002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.816.1">Import the required function and class from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.817.1">IPython.display</span></span></span></span><span class="kobospan" id="kobo.818.1"> module:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.819.1">from IPython.display import display, Markdown</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-702006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.820.1">Create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.821.1">Markdown</span></span></span></span><span class="kobospan" id="kobo.822.1"> object with the text to render:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.823.1">m = Markdown(rf""" 
 
We can see that $r = {quartet[’I’].correlation:.2f}$; this is a strong correlation. 
 
 
 
This leads to a linear regression result with $y = {r.slope:.1f} \times x + {r.intercept:.1f}$ as the best fit 
 
for this collection of samples. 
 
Interestingly, this is true for all four series in spite of the dramatically distinct scatter plots. 
 
""")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.824.1">The triple-quoted string has two prefix characters, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.825.1">r</span></span></span></span><span class="kobospan" id="kobo.826.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.827.1">f</span></span></span></span><span class="kobospan" id="kobo.828.1">. </span><span class="kobospan" id="kobo.828.2">This is a ”raw” formatted string. </span><span class="kobospan" id="kobo.828.3">The formatted string is essential for injecting Python objects into text. </span><span class="kobospan" id="kobo.828.4">See </span><a href="ch005_split_000.xhtml#x1-410004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.829.1">Building complicated strings</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.830.1">with f-strings</span></span></a><span class="kobospan" id="kobo.831.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.832.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.833.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.834.1">1</span></span></a><span class="kobospan" id="kobo.835.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.836.1">A raw string is required because LaTeX math formatting requires extensive use of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.837.1">\</span></span></span></span><span class="kobospan" id="kobo.838.1"> characters. </span><span class="kobospan" id="kobo.838.2">In this context, we emphatically do not want Python to consider the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.839.1">\</span></span></span></span><span class="kobospan" id="kobo.840.1"> as an escape character; we need to ensure these characters are left alone, untouched, and provided to the Markdown engine without change.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.841.1">Using raw strings means it’s very difficult to include a newline character. </span><span class="kobospan" id="kobo.841.2">Therefore, it’s best to use a triple-quoted string that can span multiple lines.</span></p>
</div></li>
<li class="calibre7"><div id="x1-702016x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.842.1">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.843.1">display()</span></span></span></span><span class="kobospan" id="kobo.844.1"> function to render the cell results as Markdown instead of unformatted text:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.845.1">display(m)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.846.1">This creates output in Markdown that includes the results of a computation.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-702019r1513"/></p>
</section>
<section data-number="0.15.5.3" id="how-it-works...-98">
<h2 class="likechapterhead" data-number="0.15.5.3"><span><span class="kobospan" id="kobo.847.1">12.5.3 </span></span> <span id="x1-7030003"/><span class="kobospan" id="kobo.848.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.849.1">Given a code cells that computes</span><span id="dx1-703001"/><span class="kobospan" id="kobo.850.1"> a result value, a notebook uses an object’s </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.851.1">__repl__()</span></span></span></span><span class="kobospan" id="kobo.852.1"> method to display the object. </span><span class="kobospan" id="kobo.852.2">The object can have additional methods defined that are used by IPython to format the object in distinct ways. </span><span class="kobospan" id="kobo.852.3">In this case, the use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.853.1">Markdown</span></span></span></span><span class="kobospan" id="kobo.854.1"> class creates an object that is rendered as nicely formatted text.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.855.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.856.1">IPython.display</span></span></span></span><span class="kobospan" id="kobo.857.1"> package contains a number of helpful functions. </span><span class="kobospan" id="kobo.857.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.858.1">display()</span></span></span></span><span class="kobospan" id="kobo.859.1"> function allows a Python code cell to interact with the browser-based rendering of the notebook.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.860.1">The creation of the block of text and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.861.1">Markdown</span></span></span></span><span class="kobospan" id="kobo.862.1"> object is part of the back-end number-crunching kernel that’s running the notebook’s code. </span><span class="kobospan" id="kobo.862.2">From this, the rendered text is sent to the browser. </span><span class="kobospan" id="kobo.862.3">This text can also be send to the other external tools for publishing a notebook, giving us nicely formatted cells with content computed by the notebook. </span><span id="x1-703002r1517"/></p>
</section>
<section data-number="0.15.5.4" id="theres-more...-89">
<h2 class="likechapterhead" data-number="0.15.5.4"><span><span class="kobospan" id="kobo.863.1">12.5.4 </span></span> <span id="x1-7040004"/><span class="kobospan" id="kobo.864.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.865.1">When we turn to sharing a notebook, we often have two distinct venues:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.866.1">Presentations, where the notebook has key points to back up a presenter’s remarks to stakeholders.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.867.1">Publications, where the notebook – or a document produced from the notebook – is distributed to stakeholders.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.868.1">In some instances, we’ll need to create both a slide deck and a report. </span><span class="kobospan" id="kobo.868.2">This requires some care to be sure that computed results are consistent among all variants of the notebook. </span><span class="kobospan" id="kobo.868.3">One approach is to have two final report notebooks built around importing a core notebook that has data ingestion and computation features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.869.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.870.1">%run</span></span></span></span><span class="kobospan" id="kobo.871.1"> magic command can be put into a cell to run a notebook and collect the result variables. </span><span class="kobospan" id="kobo.871.2">This will also display the output from </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.872.1">print()</span></span></span></span><span class="kobospan" id="kobo.873.1"> and any plots that are created. </span><span class="kobospan" id="kobo.873.2">Because the output is displayed separately, the core notebook should focus on ingesting and computing results without any display features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.874.1">For presentations, use the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.875.1">Property Inspector </span></span><span class="kobospan" id="kobo.876.1">on the right side</span><span id="dx1-704001"/><span class="kobospan" id="kobo.877.1"> of the Jupyter Lab page. </span><span class="kobospan" id="kobo.877.2">This lets</span><span id="dx1-704002"/><span class="kobospan" id="kobo.878.1"> us set a cell’s </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.879.1">Slide Type </span></span><span class="kobospan" id="kobo.880.1">for a presentation.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.881.1">We can create Markdown content with the key points, the visualizations, and all the necessary supporting information. </span><span class="kobospan" id="kobo.881.2">Once we have the content, we can mark the cells using the Property Inspector. </span><span class="kobospan" id="kobo.881.3">Finally, we need to save the notebook as a presentation. </span><span class="kobospan" id="kobo.881.4">In the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.882.1">File </span></span><span class="kobospan" id="kobo.883.1">menu, the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.884.1">Save and Export Notebook As... </span></span><span class="kobospan" id="kobo.885.1">menu item presents a list of alternatives. </span><span class="kobospan" id="kobo.885.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.886.1">Reveal.js Slides </span></span><span class="kobospan" id="kobo.887.1">will create an HTML file with the slide presentation.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.888.1">The exported HTML document can be opened in a browser to provide the supporting visuals for a presentation. </span><span class="kobospan" id="kobo.888.2">It can be emailed to attendees who only want the presentation materials.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.889.1">To create a final document (often in the PDF format), we have an array of choices:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.890.1">Export as AsciiDoc, Markdown, or Restructured Text. </span><span class="kobospan" id="kobo.890.2">From these</span><span id="dx1-704003"/><span class="kobospan" id="kobo.891.1"> formats, tools</span><span id="dx1-704004"/><span class="kobospan" id="kobo.892.1"> like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.893.1">Pandodc</span></span><span class="kobospan" id="kobo.894.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.895.1">Docutils</span></span><span class="kobospan" id="kobo.896.1">, or </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.897.1">Sphinx </span></span><span class="kobospan" id="kobo.898.1">can be used to create a final</span><span id="dx1-704005"/><span class="kobospan" id="kobo.899.1"> output file.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.900.1">Export as LaTeX. </span><span class="kobospan" id="kobo.900.2">From this format, the TeXtools need to be used to create a final PDF. </span><span class="kobospan" id="kobo.900.3">These tools can be rather complicated to install and maintain, but the results are stellar.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.901.1">Export as a PDF. </span><span class="kobospan" id="kobo.901.2">There may be a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.902.1">webpdf</span></span></span></span><span class="kobospan" id="kobo.903.1"> option, which uses Playwright and the Chromium library to render a PDF. </span><span class="kobospan" id="kobo.903.2">There may also be a Qtpdf option, which uses the Qt library to create a PDF.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.904.1">Tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.905.1">Quarto </span></span><span class="kobospan" id="kobo.906.1">and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.907.1">Jupyter </span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.908.1">{</span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.909.1">Book</span></span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.910.1">} </span></span><span class="kobospan" id="kobo.911.1">can also be used to</span><span id="dx1-704006"/><span class="kobospan" id="kobo.912.1"> create polished</span><span id="dx1-704007"/><span class="kobospan" id="kobo.913.1"> output. </span><span class="kobospan" id="kobo.913.2">These include their own publication tools to create final, outstanding PDF documents from the Markdown in a notebook.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.914.1">An important thing to remember about this publication pipeline is this imperative: don’t copy and paste from a notebook.</span></p>
<div class="tipbox" id="tcolobox-27">
<div class="note">
<p class="normal1"><span class="kobospan" id="kobo.915.1">Copying results from a notebook into a word-processing document is a way to introduce errors and omissions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.916.1">Publishing directly from a notebook eliminates the possible errors caused by having two – potentially conflicting – copies of the computation results.</span></p>
</div>
</div>
<p class="normal1"><span id="x1-704008r1518"/></p>
</section>
<section data-number="0.15.5.5" id="see-also-96">
<h2 class="likechapterhead" data-number="0.15.5.5"><span><span class="kobospan" id="kobo.917.1">12.5.5 </span></span> <span id="x1-7050005"/><span class="kobospan" id="kobo.918.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.919.1">See </span><a href="ch007_split_001.xhtml#x1-2030007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.920.1">Writing clear documentation strings with RST markup</span></span></a><span class="kobospan" id="kobo.921.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.922.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.923.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.924.1">3</span></span></a><span class="kobospan" id="kobo.925.1"> for more on using ReStructured Text to document code.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.926.1">See </span><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.927.1">Including descriptions and documentation</span></span></a><span class="kobospan" id="kobo.928.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.929.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.930.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.931.1">2</span></span></a><span class="kobospan" id="kobo.932.1"> for more on documentation for Python modules.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.933.1">See </span><a href="ch016.xhtml#x1-6880003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.934.1">Using pyplot to create a scatter plot</span></span></a><span class="kobospan" id="kobo.935.1"> in this chapter for data analysis examples that require publication.</span></p></li>
</ul>
<p class="normal1"><span id="x1-705001r1511"/></p>
</section>
</section>
<section data-number="0.15.6" id="including-unit-test-cases-in-a-notebook">
<h1 class="unnumbered" data-number="0.15.6"><span><span class="kobospan" id="kobo.936.1">12.6 </span></span> <span id="x1-7060006"/><span class="kobospan" id="kobo.937.1">Including Unit Test Cases in a Notebook</span></h1>
<p class="normal"><span class="kobospan" id="kobo.938.1">It’s difficult to be sure that any software</span><span id="dx1-706001"/><span class="kobospan" id="kobo.939.1"> is trustworthy</span><span id="dx1-706002"/><span class="kobospan" id="kobo.940.1"> without a test suite. </span><span class="kobospan" id="kobo.940.2">It can be awkward to unit test code in a Jupyter Notebook. </span><span class="kobospan" id="kobo.940.3">One of the primary reasons testing is difficult is that a notebook is often used to ingest a very large volume of data. </span><span class="kobospan" id="kobo.940.4">This means that computations in individual cells can take a very long time to complete. </span><span class="kobospan" id="kobo.940.5">For a sophisticated machine learning model, this kind of time-consuming processing is typical.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.941.1">One approach to creating test cases is to create a ”template” notebook used for unit testing. </span><span class="kobospan" id="kobo.941.2">The template can be cloned and a source </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.942.1">Path</span></span></span></span><span class="kobospan" id="kobo.943.1"> value changed to read the large data that is of real interest.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.944.1">Since notebook </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.945.1">.ipynb</span></span></span></span><span class="kobospan" id="kobo.946.1"> files are in the JSON format, it’s relatively easy to write a program to confirm that the cells of a notebook used to produce the desired results are (nearly) identical to the template notebook used for testing. </span><span class="kobospan" id="kobo.946.2">Cells with specific filenames are expected to change; the rest are expected to remain intact.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.947.1">A good notebook design transforms multi-statement cells into function (and class) definitions. </span><span class="kobospan" id="kobo.947.2">This means the important results are computed by functions that have test cases. </span><span class="kobospan" id="kobo.947.3">These test cases can be included in the function’s docstring. </span><span class="kobospan" id="kobo.947.4">We’ll address doctest in depth in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.948.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.949.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.950.1">15</span></span></a><span class="kobospan" id="kobo.951.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.952.1">In addition to doctest examples for functions and classes, we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.953.1">assert</span></span></span></span><span class="kobospan" id="kobo.954.1"> statement in a cell to confirm that a notebook’s cells work as expected. </span><span class="kobospan" id="kobo.954.2">This statement is a shorthand for an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.955.1">if-raise</span></span></span></span><span class="kobospan" id="kobo.956.1"> statement pair. </span><span class="kobospan" id="kobo.956.2">If the expression in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.957.1">assert</span></span></span></span><span class="kobospan" id="kobo.958.1"> statement is not true, an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.959.1">AssertException</span></span></span></span><span class="kobospan" id="kobo.960.1"> is raised. </span><span class="kobospan" id="kobo.960.2">This will stop the notebook, revealing a problem. </span><span id="x1-706003r1519"/></p>
<section data-number="0.15.6.1" id="getting-ready-98">
<h2 class="likechapterhead" data-number="0.15.6.1"><span><span class="kobospan" id="kobo.961.1">12.6.1 </span></span> <span id="x1-7070001"/><span class="kobospan" id="kobo.962.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.963.1">We’ll start with</span><span id="dx1-707001"/><span class="kobospan" id="kobo.964.1"> the notebook</span><span id="dx1-707002"/><span class="kobospan" id="kobo.965.1"> from </span><a href="ch016.xhtml#x1-6940004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.966.1">Using axes directly to create a scatter plot</span></span></a><span class="kobospan" id="kobo.967.1">, as it has a complicated cell to ingest data that can be converted into a function and some class definitions that can be supplemented with doctest examples. </span><span id="x1-707003r1521"/></p>
</section>
<section data-number="0.15.6.2" id="how-to-do-it...-99">
<h2 class="likechapterhead" data-number="0.15.6.2"><span><span class="kobospan" id="kobo.968.1">12.6.2 </span></span> <span id="x1-7080002"/><span class="kobospan" id="kobo.969.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-708002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.970.1">Refactor the data ingestion cell to be a function with a name like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.971.1">ingest()</span></span></span></span><span class="kobospan" id="kobo.972.1">. </span><span class="kobospan" id="kobo.972.2">The parameter should be the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.973.1">Path</span></span></span></span><span class="kobospan" id="kobo.974.1"> and the return value should be the dictionary with the four Anscombe series. </span><span class="kobospan" id="kobo.974.2">The original side-effect of this cell will be created in a cell below. </span><span class="kobospan" id="kobo.974.3">Here’s the function definition:</span></p>
<pre class="programlisting" id="listing-76"><code class="calibre13"><span class="kobospan" id="kobo.975.1">def ingest(source: Path) -&gt; dict[str, Series]: 
 
    """ 
 
    &gt;&gt;&gt; doctest example 
 
    """ 
 
    with source.open() as source_file: 
 
        json_document = json.load(source_file) 
 
        source_data = (Series.model_validate(s) for s in json_document) 
 
        quartet = {s.series: s for s in source_data} 
 
    return quartet</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.976.1">We haven’t filled in the doctest example; we’ve only left reminder text. </span><span class="kobospan" id="kobo.976.2">These kinds of examples are the subject of recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.977.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.978.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.979.1">15</span></span></a><span class="kobospan" id="kobo.980.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-708013x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.981.1">Add a cell to ingest the test data:</span></p>
<pre class="programlisting" id="listing-77"><code class="calibre13"><span class="kobospan" id="kobo.982.1">source = Path.cwd().parent.parent / "data" / "anscombe.json" 
 
quartet = ingest(source)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-708017x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.983.1">Add some </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.984.1">assert</span></span></span></span><span class="kobospan" id="kobo.985.1"> statements to show the expected properties of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.986.1">quartet</span></span></span></span><span class="kobospan" id="kobo.987.1"> object. </span><span class="kobospan" id="kobo.987.2">These combine an expression and the expected output into a single statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.988.1">
assert len(quartet) == 4, f"read {len(quartet)} series" 
 
assert list(quartet.keys()) == ["I", "II", "III", "IV"], f"keys were {list(quartet.keys())}"</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.989.1">Often, we’ll replace an informal test</span><span id="dx1-708021"/><span class="kobospan" id="kobo.990.1"> cell with a more formal</span><span id="dx1-708022"/><span class="kobospan" id="kobo.991.1"> assertion. </span><span class="kobospan" id="kobo.991.2">It’s common to have a cell with an expression like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.992.1">quartet.keys()</span></span></span></span><span class="kobospan" id="kobo.993.1">. </span><span class="kobospan" id="kobo.993.2">When developing a notebook, we’ll look at the results of this expression to confirm that the data ingestion worked. </span><span class="kobospan" id="kobo.993.3">This manual test case can be upgraded with an automated test in the form of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.994.1">assert</span></span></span></span><span class="kobospan" id="kobo.995.1"> statements.</span></p>
</div></li>
<li class="calibre7"><div id="x1-708024x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.996.1">Be sure to save the notebook. </span><span class="kobospan" id="kobo.996.2">We’ll assume it’s called </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.997.1">recipe_06.ipynb.</span></span></span></span></p>
</div></li>
<li class="calibre7"><div id="x1-708026x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.998.1">Open a new terminal window and enter the following command:</span></p>
<pre class="programlisting" id="listing-78"><code class="calibre13"><span class="kobospan" id="kobo.999.1">(cookbook3) % jupyter execute src/ch12/recipe_06.ipynb</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1000.1">The notebook should execute flawlessly. </span><span class="kobospan" id="kobo.1000.2">There are two important lines in the output:</span></p>
<pre class="programlisting" id="listing-79"><code class="calibre13"><span class="kobospan" id="kobo.1001.1">[NbClientApp] Executing src/ch12/recipe_06.ipynb 
 
[NbClientApp] Executing notebook with kernel: python3</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1002.1">These lines confirm the file and the kernel being used. </span><span class="kobospan" id="kobo.1002.2">The absence of other output tells us no exceptions were raised.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-708030r1522"/></p>
</section>
<section data-number="0.15.6.3" id="how-it-works...-99">
<h2 class="likechapterhead" data-number="0.15.6.3"><span><span class="kobospan" id="kobo.1003.1">12.6.3 </span></span> <span id="x1-7090003"/><span class="kobospan" id="kobo.1004.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1005.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1006.1">jupyter</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1007.1"> execute</span></span></span></span><span class="kobospan" id="kobo.1008.1"> command will start a kernel and run the notebook’s cells to completion. </span><span class="kobospan" id="kobo.1008.2">This is handy for confirming that it works.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1009.1">We have to be sure to reject the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1010.1">false negative </span></span><span class="kobospan" id="kobo.1011.1">of a test procedure that fails to uncover a problem. </span><span class="kobospan" id="kobo.1011.2">To be sure the testing approach is sound, we can inject a failing assertion into the notebook and observe the expected error.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1012.1">Add a cell like the following:</span></p>
<pre class="programlisting" id="listing-80"><code class="calibre13"><span class="kobospan" id="kobo.1013.1">value = 355/113 
 
assert value == 3.14, f"invald {value}"</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1014.1">This will compute a value and then make a demonstrably false assertion about it. </span><span class="kobospan" id="kobo.1014.2">This will lead to a very visible failure when we use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1015.1">jupyter</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1016.1"> execute</span></span></span></span><span class="kobospan" id="kobo.1017.1"> command. </span><span class="kobospan" id="kobo.1017.2">The output will result in the following:</span></p>
<pre class="programlisting" id="listing-81"><code class="calibre13"><span class="kobospan" id="kobo.1018.1">--------------------------------------------------------------------------- 
 
AssertionError                            Traceback (most recent call last) 
 
Cell In[4], line 2 
 
      1 value = 355/113 
 
----&gt; 2 assert value == 3.14, f"invald {value}" 
 
 
 
AssertionError: invald 3.1415929203539825</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1019.1">The OS status code will also be non-zero, indicating a failure to execute properly. </span><span class="kobospan" id="kobo.1019.2">This provides ample confirmation that an error will produce a noisy, explicit failure. </span><span class="kobospan" id="kobo.1019.3">Once we’re sure this works, we can remove</span><span id="dx1-709010"/><span class="kobospan" id="kobo.1020.1"> it from the notebook, confident</span><span id="dx1-709011"/><span class="kobospan" id="kobo.1021.1"> that the other tests really will discover problems. </span><span id="x1-709012r1524"/></p>
</section>
<section data-number="0.15.6.4" id="theres-more...-90">
<h2 class="likechapterhead" data-number="0.15.6.4"><span><span class="kobospan" id="kobo.1022.1">12.6.4 </span></span> <span id="x1-7100004"/><span class="kobospan" id="kobo.1023.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1024.1">For the special case of comparing float values, we shouldn’t use simple </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1025.1">==</span></span></span></span><span class="kobospan" id="kobo.1026.1"> comparison. </span><span class="kobospan" id="kobo.1026.2">As noted in </span><a href="ch005_split_000.xhtml#x1-180001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1027.1">Choosing between float, decimal, and fraction</span></span></a><span class="kobospan" id="kobo.1028.1">, float values are an approximation, and small changes to the order of operations can influence the right-most digits.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1029.1">For float values, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1030.1">math.isclose()</span></span></span></span><span class="kobospan" id="kobo.1031.1"> function is essential. </span><span class="kobospan" id="kobo.1031.2">Look back at the notebook for </span><a href="ch016.xhtml#x1-6940004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1032.1">Using axes directly to create a scatter plot</span></span></a><span class="kobospan" id="kobo.1033.1">. </span><span class="kobospan" id="kobo.1033.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1034.1">Series</span></span></span></span><span class="kobospan" id="kobo.1035.1"> class definition computed a correlation and a linear regression value. </span><span class="kobospan" id="kobo.1035.2">We might create a cell like the following to test this:</span></p>
<pre class="programlisting" id="listing-82"><code class="calibre13"><span class="kobospan" id="kobo.1036.1">from math import isclose 
 
test = Series( 
 
    series="test", 
 
    data=[Pair(x=2, y=4), Pair(x=3, y=6), Pair(x=5, y=10)] 
 
) 
 
assert isclose(test.correlation, 1.0) 
 
assert isclose(test.regression.slope, 2.0) 
 
assert isclose(test.regression.intercept, 0.0)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1037.1">This test case creates a sample </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1038.1">Series</span></span></span></span><span class="kobospan" id="kobo.1039.1"> object. </span><span class="kobospan" id="kobo.1039.2">It then confirms that the results are very close to the target values. </span><span class="kobospan" id="kobo.1039.3">The default settings have a relative tolerance value of 10</span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.1040.1">−</span></span><span class="cmr1"><span class="kobospan" id="kobo.1041.1">9</span></span></sup><span class="kobospan" id="kobo.1042.1">, which will include nine digits. </span><span id="x1-710009r1525"/></p>
</section>
<section data-number="0.15.6.5" id="see-also-97">
<h2 class="likechapterhead" data-number="0.15.6.5"><span><span class="kobospan" id="kobo.1043.1">12.6.5 </span></span> <span id="x1-7110005"/><span class="kobospan" id="kobo.1044.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1045.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1046.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1047.1">15</span></span></a><span class="kobospan" id="kobo.1048.1"> covers testing and unit tests in some depth.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1049.1">In </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1050.1">Writing better docstrings with RST markup</span></span></a><span class="kobospan" id="kobo.1051.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1052.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1053.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1054.1">2</span></span></a><span class="kobospan" id="kobo.1055.1">, the idea of doctest examples is also mentioned.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1056.1">See </span><a href="ch016.xhtml#x1-6820002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1057.1">Ingesting data into a notebook</span></span></a><span class="kobospan" id="kobo.1058.1"> for the seed notebook to which we want to add assertions.</span></p></li>
</ul>
<p class="normal1"><span id="x1-711001r1520"/></p>
</section>
</section>
<section data-number="0.15.9" id="join-our-community-discord-space-12">
<h1 class="unnumbered" data-number="0.15.9"><span id="x1-7140008"/><span class="kobospan" id="kobo.1059.1">Join our community Discord space</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1060.1">Join our Python Discord workspace to discuss and find out more about the book: </span><a class="url" href="https://packt.link/dHrHU"><span class="url1"><span class="kobospan" id="kobo.1061.1">https://packt.link/dHrHU</span></span></a></p>
<p class="normal1"><span class="kobospan" id="kobo.1062.1"><img alt="PIC" src="../media/file1.png" class="calibre9"/></span> <span id="x1-714001r1452"/></p>
</section>
</section>
</body></html>