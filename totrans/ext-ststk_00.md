# 前言

你手中（或你的电子阅读器中）的是第一本专门介绍编写与 SaltStack 工具框架一起使用的代码的书。

# 本书涵盖的内容

第一章, *从基础知识开始*，从讨论本书关注的两个核心原则开始：Salt 如何使用 Python 以及 Loader 系统是如何工作的。这些构成了扩展 Salt 的基础。

第二章, *编写执行模块*，解释了 Salt 中的大部分重工作是由执行模块完成的，这些模块通常被其他模块封装。对执行模块的深入了解也将是理解其他模块类型如何工作的关键。

第三章, *扩展 Salt 配置*，解释了动态管理配置的能力可以使某些模块变得更有用。有些模块甚至没有动态配置就无法工作。在这里，我们探讨提供这种能力的不同方法。

第四章, *将状态封装在模块周围*，支持执行模块使事物工作的事实，但状态模块使这种工作持久。在本章中，你将了解如何使用状态模块来管理执行模块。

第五章, *渲染数据*，展示了渲染系统允许你添加自己的模板系统，从而增强状态的功能。Jinja 和 YAML 都很好，但有时你需要更多。

第六章, *处理返回数据*，回答了当作业完成时数据会发生什么的问题。数据可以前往许多地方，你可以编写模块将其发送到那里。

第七章, *使用 Runners 进行脚本编写*，展示了 SaltStack 知道系统管理员多年来一直在使用脚本语言，他们提供了一个结合 Python 和 Salt 原始力量的脚本环境。

第八章, *添加外部文件服务器*，建议不要仅仅从 Salt Master 提供文件服务。你可以使用自己的外部文件服务器模块从任何你想要的地方提供文件服务。

第九章，*连接到云*，帮助您了解如何更新现有的云模块或添加您自己的模块。现在每个人都使用云，Salt Cloud 将其与 Salt 连接起来。

第十章，*使用信标进行监控*，帮助我们解决 Salt 通常不与监控相关联的问题，这确实是个遗憾。信标是将 Salt 集成到您的监控框架的一种方式。

第十一章，*扩展主节点*，解释了 Salt 提供了一种程序化地满足主节点管理需求的方法。如果您能将您自己的身份验证系统与 Salt 结合起来，那么这将是一个加分项。

附录 A，*连接不同模块*，提供了即使知道 Salt 模块旨在协同工作，如何适配不同组件的解决方案。本附录阐述了不同部分是如何连接在一起的。

附录 B，*向上游贡献代码*，为您提供了一些了解项目哪里出了问题或哪些功能缺失的技巧。在 Salt 中，这不必是这样的，但可以回到社区。

# 您需要这本书的内容

本书假设您对 Salt 和 Python 编程语言有一定的了解。虽然您可能能够在没有太多经验的情况下快速编写代码（实际上，作者就是这样开始使用这两者的），但有了这些工具，您会发现这要容易得多。

虽然本书中的示例经过测试且功能正常，但它们可能不适用于您的需求。它们旨在简单易懂，适合那些对 Python 和 Salt 都很熟悉的读者，同时仍然展示了相当数量的功能。

Salt 目前支持 Python 2.6 的基线，这意味着许多较老的 Linux 发行版仍然得到支持。截至本书的第一版，Salt 目前不支持 Python 3.x 分支。从节点端的示例预期在 Windows 上也能正常工作，除非它们依赖的依赖项不可用。

由于主节点和从节点都可以在同一台机器上运行，您只需要一台计算机来执行本书中的示例。许多示例确实会引用可能未预装在您的操作系统中的软件。在这些情况下，该软件仍然可以下载。

# 这本书面向的对象

这本书适合所有希望构建和编写新 Salt 模块的新手和现有 Salt 开发者。预期您有一定的 Python 开发经验。

# 习惯用法

在本书中，你会发现许多文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义的解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称如下所示：“如果没有`__virtual__()`函数，则该模块将在每个系统上始终可用。”

代码块设置如下：

```py
'''
This module should be saved as salt/modules/mysqltest.py
'''
__virtualname__ = 'mysqltest'

def __virtual__():
    '''
    For now, just return the __virtualname__
    '''
    return __virtualname__

def ping():
    '''
    Returns True

    CLI Example:
        salt '*' mysqltest.ping
    '''
    return True
```

任何命令行输入或输出都按照以下方式编写：

```py
#salt-call mymodule.test

```

**新术语**和**重要词汇**以粗体显示。屏幕上显示的单词，例如在菜单或对话框中，在文本中如下所示：“当你再次访问 GitHub 上的分支时，你会看到一个写着**新拉取请求**的链接。”

### 注意

警告或重要注意事项如下所示。

### 小贴士

小技巧和技巧如下所示。

# 读者反馈

我们的读者反馈总是受欢迎的。告诉我们你对本书的看法——你喜欢或不喜欢什么。读者反馈对我们很重要，因为它帮助我们开发出你真正能从中获得最大价值的标题。

要向我们发送一般反馈，请简单地发送电子邮件至 `<feedback@packtpub.com>`，并在邮件主题中提及本书的标题。

如果你在某个领域有专业知识，并且对撰写或为本书做出贡献感兴趣，请参阅我们的作者指南，网址为 [www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在你已经是 Packt 图书的骄傲拥有者，我们有一些事情可以帮助你从购买中获得最大收益。

## 下载示例代码

你可以从你的账户中下载本书的示例代码文件，网址为 [`www.packtpub.com`](http://www.packtpub.com)。如果你在其他地方购买了本书，你可以访问 [`www.packtpub.com/support`](http://www.packtpub.com/support) 并注册，以便将文件直接通过电子邮件发送给你。

你可以通过以下步骤下载代码文件：

1.  使用您的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的**支持**标签上。

1.  点击**代码下载与勘误**。

1.  在**搜索**框中输入书的名称。

1.  选择你想要下载代码文件的书籍。

1.  从你购买本书的下拉菜单中选择。

1.  点击**代码下载**。

文件下载完成后，请确保使用最新版本的以下软件解压或提取文件夹：

+   WinRAR / 7-Zip for Windows

+   Zipeg / iZip / UnRarX for Mac

+   7-Zip / PeaZip for Linux

## 下载本书的颜色图像

我们还为您提供了一个包含本书中使用的截图/图表彩色图像的 PDF 文件。彩色图像将帮助您更好地理解输出的变化。您可以从[`www.packtpub.com/sites/default/files/downloads/ExtendingSaltStack_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/ExtendingSaltStack_ColorImages.pdf)下载此文件。

## 勘误

尽管我们已经尽最大努力确保内容的准确性，错误仍然可能发生。如果您在我们的某本书中发现错误——可能是文本或代码中的错误——如果您能向我们报告这一点，我们将不胜感激。通过这样做，您可以避免其他读者感到沮丧，并帮助我们改进本书的后续版本。如果您发现任何勘误，请通过访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击**勘误提交表单**链接，并输入您的勘误详情来报告它们。一旦您的勘误得到验证，您的提交将被接受，勘误将被上传到我们的网站或添加到该标题的勘误部分下的现有勘误列表中。

要查看之前提交的勘误，请访问[`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索字段中输入书籍名称。所需信息将出现在**勘误**部分下。

## 盗版

互联网上版权材料的盗版是一个跨所有媒体的持续问题。在 Packt，我们非常重视保护我们的版权和许可证。如果您在互联网上发现任何形式的非法复制我们的作品，请立即提供位置地址或网站名称，以便我们可以寻求补救措施。

请通过`<copyright@packtpub.com>`与我们联系，并提供涉嫌盗版材料的链接。

我们感谢您在保护我们的作者和我们为您提供有价值内容的能力方面的帮助。

## 问答

如果您对本书的任何方面有问题，您可以通过`<questions@packtpub.com>`联系我们，我们将尽力解决问题。
