<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-214"><a id="_idTextAnchor215"/>13</h1>
<h1 id="_idParaDest-215"><a id="_idTextAnchor216"/>To Trade or Not to Trade – Performance Analysis</h1>
<p>In the previous chapter, we developed a simple trend-following strategy, ran a backtest, and generated our first equity curve (a visual representation of the strategy’s profits and losses over time). Intuitively, we already know that equity curves of profitable strategies should grow over time, and the steeper the growth, the better. At first glance, our strategy looks fit to this requirement, but of course, it would be better to be able to base our opinions on facts and not just emotions. So, we would like to have a quantitative metric that could be used as an indicator: if its value is greater than something, then the strategy is good. If it’s less, then the strategy is not good.</p>
<p>As you might have already guessed, such a single, universal metric does not exist. A trading strategy is quite a complex structure, even if its logic seems simplistic, and its performance should be analyzed from different standpoints. We are interested in knowing not only how much money a particular strategy could make but also how much we should put at stake as risk capital in order to achieve such a gain. Similarly, not only the overall net profit but also how profits (and losses!) are distributed over time matters. Ultimately, we want to be sure that the strategy is indeed tradable: that trades placed in the real market will be more or less similar to those emulated during the backtest.</p>
<p>This chapter is very far from an ultimate guide on trading strategy performance analysis: this subject is so vast that it would require a separate book, if not multiple books. Here, we are going to consider the most essential metrics and see how they help assess a strategy’s performance and make our main decision – whether to give this strategy a try or set it aside.</p>
<p>In this chapter, you will learn about the following topics:</p>
<ul>
<li>Trade analysis</li>
<li>Average trade and trading costs</li>
<li>Measuring performance – alpha and beta revisited</li>
<li>Net profit versus buy and hold</li>
<li>Drawdown</li>
<li>The power of leverage – or how much do I need to trade it?</li>
</ul>
<h1 id="_idParaDest-216"><a id="_idTextAnchor217"/>Trade analysis</h1>
<p>As you <a id="_idIndexMarker865"/>remember, the difference between trading and investing is, broadly speaking, the number of trades. If you buy and hold a position in an asset for 1 year or more, then it’s an investment. If you buy, sell, and buy the same asset or different assets again multiple times during the same year, it’s trading.</p>
<p class="callout-heading">Why a year?</p>
<p class="callout">According to most tax laws, holding a position for 1 year and 1 day qualifies it as an investment, and any profit resulting from this activity is taxed at a discounted rate. If you held the position even for 1 day less than 1 year, it will be considered trading and the resulting profit will be taxed at a full income tax rate. This rule is applicable mostly to equities trading, but at least it makes sense to use 1 year as a reference term.</p>
<p>So, the strategy is actively opening and closing positions during a given period. Regardless of the total net profit (or loss) for the entire period, first, and above all, we are interested in how much each trade contributes to the overall result – at least on average.</p>
<h1 id="_idParaDest-217"><a id="_idTextAnchor218"/>Average trade and trading costs</h1>
<p>Average<a id="_idIndexMarker866"/> trade is one <a id="_idIndexMarker867"/>of the most essential yet simplistic metrics: it’s just the ratio of the total net profit achieved by a strategy to the total number of trades:</p>
<div><div><img alt="" src="img/Formula_B19145_13_001.jpg"/>
</div>
</div>
<p>Why do we need this value?</p>
<p>To answer this question, we should recall a few things from theory again.</p>
<p>In <a href="B19145_03.xhtml#_idTextAnchor044"><em class="italic">Chapter 3</em></a>, <em class="italic">FX Market Overview from a Developer’s Standpoint</em>, we considered how markets are organized and learned that there is always a difference between the price at which we can buy and at which we can sell – the spread. Regardless of the type of orders used in the strategy, the market price must move for the distance of the spread <em class="italic">at the very least</em>, only to move the newly opened position from a negative zone to break even.</p>
<p>Besides that, don’t forget the various issues with liquidity and order execution that were considered in <a href="B19145_10.xhtml#_idTextAnchor171"><em class="italic">Chapter 10</em></a>, <em class="italic">Types of Orders and Their Simulation in Python</em>. If the strategy uses market orders, it may encounter slippage, partial fills, or rejects (depending on the TIF specification, see the <em class="italic">Time in force: better control over execution</em> section in the same chapter). In any case, it’s just another cost of trading that should be covered by the strategy.</p>
<p>Finally, don’t forget that the broker and the trading venue will charge commissions, and this cost should also be absorbed by the trading strategy.</p>
<p>So, the average trade value should be greater than the sum of the spread, typical slippage, and broker and/or trading venue commissions. Only in this case can the strategy make money in the real market.</p>
<p>Let’s now look at real figures, based on the performance of the strategy that we developed in the previous chapter. In order to obtain the necessary values, let’s add a few lines to the strategy code. First, we will add a <code>list_of_orders</code> property to the <code>tradingSystemMetadata</code> class – here, we will save all executed orders. Next, in the <code>processOrders()</code> function, we will add the following statement right after the <code>if order['Status'] == '</code><code>Executed':</code> line:</p>
<pre class="console">
System.list_of_orders.append(order)</pre>
<p>And finally, at the very end of the backtester’s code, right after <code>plt.plot(System.equity_timeseries)</code> (see the <em class="italic">Backtesting platform with historical data feed</em> section of <a href="B19145_11.xhtml#_idTextAnchor186"><em class="italic">Chapter 11</em></a>, <em class="italic">Backtesting and </em><em class="italic">Theoretical Performance</em>):</p>
<pre class="source-code">
total_trades = len(System.list_of_orders)
print("Total trades:", total_trades)
print("Average trade:", System.equity / total_trades)</pre>
<p>If you run the backtesting now again with the same data (AUD/USD daily), you should get 37 total trades and an average trade value of about 79.41.</p>
<p>Is that good or bad?</p>
<p>Regarding the number of trades, generally speaking, the greater the number, the better. Why? Because all metrics used to assess the strategy performance are based on statistics, and statistics work best if the size of the dataset is significant. I am not going to go into<a id="_idIndexMarker868"/> details <a id="_idIndexMarker869"/>about the exact meaning of <em class="italic">significant</em> in this sense, as it’s too complex a subject, but for simplicity’s sake, let’s take it for granted that we need at least 20-30 data points so that statistical metrics start making sense. From this standpoint, 37 trades look satisfactory.</p>
<p>Now the average trade itself. Its value is 79.41, but in which units? Dollars? Australian dollars? Maybe something else?</p>
<p>Here, we should recall that spot FX is always traded on margin (see the <em class="italic">Trade mechanics: again some terminology</em> section of <a href="B19145_03.xhtml#_idTextAnchor044"><em class="italic">Chapter 3</em></a>, <em class="italic">FX Market Overview from a Developer’s Standpoint</em>) and that the value of 1 pip in money depends on the trading size. In the <em class="italic">Trading application with live data feed</em> section of <a href="B19145_11.xhtml#_idTextAnchor186"><em class="italic">Chapter 11</em></a>, <em class="italic">Backtesting and Theoretical Performance</em>, we already pointed out that for backtesting, we may want to use a trading size that will make 1 pip equal to $1. This is why we chose a trading size of 10,000 for the backtest and now we can interpret the average trade as <em class="italic">79.41 pips</em>. Then, we can finally decide whether it’s sufficient or not.</p>
<p>Let’s sum up all trading costs that we mentioned here: spread, slippage, and commission.</p>
<h2 id="_idParaDest-218"><a id="_idTextAnchor219"/>Spread</h2>
<p>Spreads depend <a id="_idIndexMarker870"/>on the liquidity provider or the broker (the latter often add their own fees into the spread, such a <a id="_idIndexMarker871"/>practice is called <strong class="bold">markup</strong>), and also on the time of day. An industry average spread for AUD/USD today is between 0.5 and 2 pips with rare increases to 5 and more, typically before economic news. So, it would be safe to suppose that we should subtract 1 pip from the average trade value to account for the market spread during a somewhat less liquid time (remember that our strategy places orders at midnight, when liquidity is thinner than during regular work hours).</p>
<p class="callout-heading">Note</p>
<p class="callout">If you use the unmodified <code>emulateBrokerExecution</code> function in the backtester code, then a spread of 0.5 pips is already included there. You can modify it every time you run a new strategy with a new currency pair, or remove it completely and subtract the spread from the resulting average trade.</p>
<h2 id="_idParaDest-219"><a id="_idTextAnchor220"/>Slippage</h2>
<p>Slippage mostly<a id="_idIndexMarker872"/> depends on the trading size and liquidity in the order book. If the sizes of your orders never exceed top-of-book liquidity, then in the absolute majority of cases, the slippage would be zero. To get a more precise estimate, we need to analyze the top-of-book data at the time of the trade. If you trade with a retail broker, then you may have a hard time getting order book data – normally, brokers do not publish it. If you use a broker as an STP to get access directly to a trading venue, then you will get at least top-of-book data with volumes. Let’s do an estimate using LMAX data.</p>
<p>Our strategy places trades only at end of the day, which is midnight (New York time, EST/EDT). This is not the most liquid time, but on average, we can see 50,000 to 200,000 AUD at the top of the book at that time. So, if your order size doesn’t exceed 50,000 AUD, then you can safely assume that slippage will be negligible. However, if your order size exceeds 50,000 AUD, then most likely you will experience slippage of up to 1 pip – depending on the actual trading volume. If the trading size exceeds 500,000 AUD, then the slippage may increase to 2 pips and even more.</p>
<p>Which estimate should we use? How can you know which trading size you’re going to use?</p>
<p>Let’s again recall that the FX markets are traded on margin. This means that you don’t need to have the entire amount of money in the broker account to open a position: the broker will provide you with a credit line according to the leverage available according to your status: retail or professional. If you’re a retail trader, then most likely you will get a 30:1 leverage. If you’re a professional trader, then higher leverage such as 100:1 is available. However, as you will see later in this chapter (see the <em class="italic">The power of leverage – how much do I need to trade it?</em> section), it is highly unlikely that you’re going to use a leverage greater than 10:1. Most likely, it is going to be somewhere in the vicinity of 2:1-5:1. In our example, in order to open a position of 200,000 AUD/USD with a leverage of 10:1, you will need approximately the following:</p>
<div><div><img alt="" src="img/Formula_B19145_13_002.jpg"/>
</div>
</div>
<p>0.6918 is the average rate of AUD/USD for the last 52 weeks (a work year). In reality, you will need a bit more because the open position should be able to withstand a drawdown (see below in this chapter), but in essence, an estimate of about $15,000 seems adequate. Without <a id="_idIndexMarker873"/>any intention to count money in your pocket, let me suppose that if you’re a retail trader, then you will hardly open positions with a size greater than 200,000 AUD, so it is safe to suppose that a slippage of 1 pip would provide a sufficient overhead for our estimate.</p>
<p class="callout-heading">Note</p>
<p class="callout">The main idea behind all our estimates is to suppose a theoretical worst scenario, something that probably won’t be realized in real trading. If the strategy is still able to make money on paper after we have accounted for all possible negative impacts, then it is probable that it’s going to make money in real life.</p>
<p>However, if you work with a financial institution, then most likely the average order size can be multiplied at least 10 times, so slippage starts to play quite an important role. I’d suggest subtracting at least 1 pip per 100,000 in the order size to account for slippage in case trades are placed during an illiquid time such as at night.</p>
<p class="callout-heading">Trading size, slippage, and execution</p>
<p class="callout">In real life, orders whose size exceeds the top of the book are seldom sent directly to the market as market orders to avoid execution at unwanted prices. If you really need to fill a large order, consider rewriting the <code>processOrders()</code> function, splitting a large order into parts, and<a id="_idIndexMarker874"/> executing them one by one.</p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor221"/>Commission</h2>
<p>The last part of <a id="_idIndexMarker875"/>trading costs seems to be the commission. Typically, a trading venue charges about 25-40 <strong class="bold">dollars per million</strong> (<strong class="bold">DPM</strong>). How<a id="_idIndexMarker876"/> do we recalculate it into dollar value for our trades?</p>
<p>The trading size used in the backtest is 10,000 AUD/USD. This means we buy or sell 10,000 Australian dollars or (using an average rate of AUD/USD of about 0.6920) approximately 7000 US dollars. With a rate of 30 DPM, the broker commission would be around $0.21. Now, if we recall that in our backtest $1 equals 1 pip, we can say that the commission makes about 0.21 pips.</p>
<p>So far, we calculated a realistic estimate for the spread, slippage, and broker commission. Is this all we should account for?</p>
<p>No, there is another cost that is very frequently forgotten by many traders: overnight swaps.</p>
<h2 id="_idParaDest-221"><a id="_idTextAnchor222"/>Overnight swaps</h2>
<p>In the <em class="italic">Economic news</em> section <a id="_idIndexMarker877"/>of <a href="B19145_06.xhtml#_idTextAnchor101"><em class="italic">Chapter 6</em></a>, <em class="italic">Basics of Fundamental Analysis and Its Possible Use in FX Trading</em>, we already mentioned one of the most peculiar features of the FX market: the difference in interest rates between the two currencies in a pair. This difference may be positive and may be negative: for example, if the interest rate of the British pound is 5% per annum and the interest rate of the Japanese yen is 0% per annum, then the difference for GBP/JPY is positive (5%) and the difference for JPY/GBP is negative (-5%).</p>
<p>Once you hold an open position overnight (past the NY bank settlement time), you either receive interest (if the difference is positive) or pay the interest (if the difference is negative). In our example, if you buy GBP/JPY (or sell JPY/GBP, which is the same), then you receive interest, and if you sell GBP/JPY or buy JPY/GBP, then you pay interest.</p>
<p>With our present strategy, we hold AUD/USD for multiple days, sometimes long, sometimes short, so we may receive or pay the interest depending on the side of the position and the current difference in interest rates.</p>
<p>We have to account for these overnight fees, frequently<a id="_idIndexMarker878"/> referred to as <strong class="bold">swaps</strong>.</p>
<p class="callout-heading">Note</p>
<p class="callout">Do not confuse swaps with financial instruments, which we discussed in the <em class="italic">FX instruments</em> section in <a href="B19145_03.xhtml#_idTextAnchor044"><em class="italic">Chapter 3</em></a>, <em class="italic">FX Market Overview from a </em><em class="italic">Developer’s Standpoint</em>.</p>
<p>However, it is surprisingly quite a non-trivial task. There are two problems here:</p>
<ul>
<li>First, these swap rates change over time because they are based on the interest rates set by central banks (usually referred to as the base rate) and these rates also change. So, we need historical data for base rates at the very least.</li>
<li>Second, each broker adds their own premium, or markup, to the base rate, and, in most cases, this premium is publicly unknown. Given that brokers do not store historical data for their overnight swap rates, it becomes problematic to reliably restore the history of interest rates differential in a currency pair.</li>
</ul>
<p>Nevertheless, we<a id="_idIndexMarker879"/> can make an attempt. First, we need historical interest rate data. It’s a bit less widespread than historical market data, but there are a few resources that provide it free of charge – for example, <a href="https://Global-rates.com">Global-rates.com</a>. Go to <a href="https://www.global-rates.com/en/interest-rates/central-banks/central-banks.aspx">https://www.global-rates.com/en/interest-rates/central-banks/central-banks.aspx</a> and there you will find links to the Federal Reserve and the Reserve Bank of Australia interest rate data.</p>
<p>As you can see, the data changes quite infrequently, no more than once a month – because decisions on interest rates are made by a special central bank committee and normally they have monthly meetings. We don’t need to be absolutely precise in our calculations: in the long run, the overnight swap is going to be just a fraction of a pip, so it’s sufficient to sync data for up to a month. I copied the data into an Excel sheet and here’s what I got:</p>
<table class="T---Table" id="table001-3">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p><strong class="bold">RBA</strong></p>
</td>
<td class="T---Table T---Body T---Body"/>
<td class="T---Table T---Body T---Body">
<p><strong class="bold">FED</strong></p>
</td>
<td class="T---Table T---Body T---Body"/>
<td class="T---Table T---Body T---Body">
<p><strong class="bold">Rates difference</strong></p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>12/06/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>3.10%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>12/14/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>4.50%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-1.40%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>11/01/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>2.85%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>11/02/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>4.00%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-1.15%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>10/04/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>2.60%</p>
</td>
<td class="T---Table T---Body T---Body"/>
<td class="T---Table T---Body T---Body">
<p>3.25%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.65%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>09/06/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>2.35%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>09/21/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>3.25%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.90%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>08/02/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>1.85%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>07/28/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>2.50%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.65%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>07/06/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>1.35%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>06/15/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>1.75%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.40%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>06/07/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>0.85%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>05/04/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>1.00%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.15%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>05/03/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>0.35%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>03/16/22</p>
</td>
<td class="T---Table T---Body T---Body">
<p>0.50%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.15%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>11/03/20</p>
</td>
<td class="T---Table T---Body T---Body">
<p>0.10%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>03/15/20</p>
</td>
<td class="T---Table T---Body T---Body">
<p>0.25%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-0.15%</p>
</td>
</tr>
<tr class="T---Table">
<td class="T---Table T---Body T---Body">
<p>03/19/20</p>
</td>
<td class="T---Table T---Body T---Body">
<p>0.25%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>03/03/20</p>
</td>
<td class="T---Table T---Body T---Body">
<p>1.25%</p>
</td>
<td class="T---Table T---Body T---Body">
<p>-1.00%</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 13.1 – Historical central banks’ interest rates for RBA and the Fed</p>
<p>If we subtract the <a id="_idIndexMarker880"/>former from the latter, we will get the difference in interest rates for the AUD/USD currency pair. We can see that it changes from as low as 0.15% to 1.4%. Now, the question is how much it means in money.</p>
<p>To calculate that, we should first recall that a year has 365 days and then we should divide the value in the last column of the table by 365. Let’s do it with the latest value:</p>
<div><div><img alt="" src="img/Formula_B19145_13_003.jpg"/>
</div>
</div>
<p>Next, we should multiply the daily interest by the trading size. In our example, we trade 10,000 AUD, so we multiply the daily interest by 10,000. Finally, if we want to know the swap value in USD, not AUD, we should multiply the result by the actual exchange rate, that is, the market price of AUD/USD.</p>
<p>I think here it’s become obvious that swap rates change not only because central banks change their interest rates but also because the market price of the currency pair changes. For our rough estimate, we may use the 52-week average of the spot price, and thus multiply the final result by 0.68. Thus, in our example, we get:</p>
<div><div><img alt="" src="img/Formula_B19145_13_004.jpg"/>
</div>
</div>
<p>How do we interpret this result?</p>
<p>This result means that if we buy 10,000 AUD/USD and hold this position overnight, then we pay 26 cents. Looks negligible, but only because a trading size of 10,000 is quite small: don’t forget <a id="_idIndexMarker881"/>that the FX market is traded on margin, and even with a retail leverage of 30:1, you need only $300 in the account to be able to open a position of $10,000. Quite often, retail trades are placed with 100,000 of base currency and institutional trades normally <em class="italic">start</em> with 1,000,000. If you hold a position of 100,000 overnight, you pay $2.6 – not much, but if you do it every night, then it gradually grows into a considerable amount. And if you trade as an institutional trader, then you start paying $26 every night, averaging $130 a week, and so on.</p>
<p>Alright, I hear you saying, <em class="italic">“it’s clear that we pay when we are long AUD/USD, but if we’re short, we should receive an equivalent amount every night, </em><em class="italic">shouldn’t we?”</em></p>
<p>Unfortunately, real life is (as always) more complicated than any theory. The issue is that every broker adds their own markup to the overnight rate. There’s no surprise in it: brokers also have to borrow to provide you with a credit line, and they can’t borrow directly from a central bank, so for them, the interest rate will already be higher. This means that the negative values become even more negative, and positive values become... well, in most cases also negative! I encourage you to check the overnight swap rates with any broker, compare them with our calculated <em class="italic">fair values</em>, and see the difference. In reality, as of today (at the beginning of January 2023), the best overnight swap rate I could find was -$5.30 for a long position and -$0.30 for a short one for a trading size of 100,000 AUD/USD.</p>
<p>Also, keep in mind that on Wednesday, you will be charged extra because we trade spot, and the spot is delivered on a T+2 basis (again, see the <em class="italic">FX instruments</em> section of <a href="B19145_03.xhtml#_idTextAnchor044"><em class="italic">Chapter 3</em></a>, <em class="italic">FX Market Overview From a </em><em class="italic">Developer’s Standpoint</em>).</p>
<p>We can use an estimate that in the absolutely worst case, we pay about 0.5 pips for the luxury of holding the position overnight. Pips – because, I hope, you remember that using a trading size of 10,000 AUD/USD allows us to interpret the result both in dollars and pips, which is very convenient for further calculations.</p>
<p>And now! Finally! Let’s sum up all costs we’ve discussed so far.</p>
<p class="callout-heading">Trading Costs Calculation</p>
<p class="callout">Total trading costs per trade = 1 pip spread + 1 pip slippage + 0.21 pips commission + 0.5 pips overnight swap * 20 days in position on average = 2.71 pips.</p>
<p>This is what we must subtract from the average trade, and if the remainder is still positive, then our strategy can make money, at least on paper.</p>
<p>Obviously, now<a id="_idIndexMarker882"/> we can see that an average trade of 79 pips is huge because all the costs, even taken with excess, hardly make 15% of the expected return. This is a truly great result, and it’s achievable only for long-term trading strategies.</p>
<p class="callout-heading">Note</p>
<p class="callout">There is a strong relationship between the strategy’s position in the market, the average trade value for such a strategy, and the volatility of its returns: the longer we stay in a position, the greater the average trade we can expect and, unfortunately, the volatility of returns for such a strategy will also be greater. This fact can even be proven mathematically as a theorem, but it lies way beyond the scope of this book, so I suggest taking it for granted – for now.</p>
<p>All in all, the trading costs analysis shows that our strategy is very robust in this regard (and believe me, most strategies you will develop yourself in the future won’t pass even this first test – but it’s normal for research and development). What’s next?</p>
<p>Next, we have to revisit a couple of concepts that we already mentioned earlier in the book.</p>
<h1 id="_idParaDest-222"><a id="_idTextAnchor223"/>Measuring performance – alpha and beta revisited</h1>
<p>In <a href="B19145_09.xhtml#_idTextAnchor152"><em class="italic">Chapter 9</em></a>, <em class="italic">Trading Strategies and Their Core Elements</em>, we touched on two important concepts <a id="_idIndexMarker883"/>that are mainly used to analyze performance: alpha and beta. Back then, we looked at them from a slightly different angle: we were in search of opportunities to systematically make profits in the market and considered all these metrics only from that standpoint. However, don’t forget that they were originally suggested for evaluating the performance of an investment – if put in simple words, to judge whether the investment outperforms or <em class="italic">beats</em> the market or not.</p>
<p class="callout-heading">Note</p>
<p class="callout">I will intentionally simplify the concepts of both alpha and beta and avoid exact mathematical formulae for their calculation. Using them requires good command of the theory of probabilities, and I know from my past experience that it’s the very domain of mathematics that causes a lot of confusion to many readers. So forgive me, math purists, but I just want these relatively complex subjects to be understood by everyone.</p>
<p>Let’s start with alpha as the more common and simplistic metric.</p>
<h2 id="_idParaDest-223"><a id="_idTextAnchor224"/>Alpha in investment and trading</h2>
<p>Alpha stands for<a id="_idIndexMarker884"/> excess<a id="_idIndexMarker885"/> returns; this is the very metric that ultimately says whether you beat the market within the given time span.</p>
<p>Normally, in capital management, alpha is calculated according to the following formula:</p>
<div><div><img alt="" src="img/Formula_B19145_13_005.jpg"/>
</div>
</div>
<p>Here, R means the return of a portfolio, <img alt="" src="img/Formula_B19145_13_006.png"/> denotes the<a id="_idIndexMarker886"/> so-called <em class="italic">risk-free</em> rate of return, <img alt="" src="img/Formula_B19145_13_007.png"/> represents the return of the benchmark, and <img alt="" src="img/Formula_B19145_13_008.png"/> represents the volatility of returns (see the following).</p>
<p>Sounds complex?</p>
<p>Well, it’s not as complex as it seems at first glance. We only need to understand the meaning of each element of this equation better.</p>
<p>Return, in general, refers to how much money was gained (or lost) per given period of time. Normally, in portfolio investment, returns are estimated by month and by year, in active trading, we also consider daily returns – in some cases, even more granular time frames.</p>
<p>It should be intuitively clear with the return of an investment or a trading strategy, but what is a <em class="italic">risk-free</em> rate of return? How anything in trading or investing can be risk-free?</p>
<p>Usually, a risk-free<a id="_idIndexMarker887"/> return is<a id="_idIndexMarker888"/> understood as the difference between the current respective bond yield and the inflation rate. For investments in the United States and denominated in US dollars, we can use Treasury bonds. For investments in the Eurozone and denominated in the euro, usually, German bonds are considered a <em class="italic">risk-free</em> investment, and so on.</p>
<p>And now we again see a <em class="italic">benchmark</em>. As we discussed in the <em class="italic">Using currency rates as benchmark</em> section of <a href="B19145_09.xhtml#_idTextAnchor152"><em class="italic">Chapter 9</em></a>, <em class="italic">Trading Strategies and Their Core Elements</em>, finding a proper benchmark for FX trading can be quite problematic. Therefore, we normally use the change in the price of the currency pair itself to see whether our strategy could do it any better than the market.</p>
<p>If we want to illustrate all of this as simplistically as possible, we could use a linear model of both the market growth and returns with an assumption that <img alt="" src="img/Formula_B19145_13_009.png"/> = 0 (no free lunch ever, right?) and <img alt="" src="img/Formula_B19145_13_010.png"/> = 1 (the volatility of returns is exactly the same as the volatility of the market itself). If the <em class="italic">x</em>-axis represents time, for example, days, and the <em class="italic">y</em>-axis represents the return, then alpha happens to be the difference between the values of the two functions:</p>
<div><div><img alt="Figure 13.1 – Simplified model of returns and alpha" src="img/B19145_13_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.1 – Simplified model of returns and alpha</p>
<p>To make the story<a id="_idIndexMarker889"/> about <a id="_idIndexMarker890"/>alpha complete, I should note that sometimes, especially analyzing the performance of active trading strategies rather than investment, alpha is supposed to be derived from the classical form of a linear equation:</p>
<div><div><img alt="" src="img/Formula_B19145_13_011.jpg"/>
</div>
</div>
<p>As in our previous example, this is a very, very simplified model that shows how returns grow over time. If we assume that the market itself grows linearly and its growth rate is equal to 1 (y = x), then any <img alt="" src="img/Formula_B19145_13_012.png"/> &gt; 1 would mean that the investment’s returns grow faster than the market and that the investment actually beats the market. Similarly, any <img alt="" src="img/Formula_B19145_13_013.png"/>&lt; 1 would mean that the investment’s returns grow slower than the market itself. In this case, even if this investment brings some money to an account, it does not beat the market: you can potentially make more by simply buying the market itself (stocks, commodities, and even currencies can constitute the respective market benchmark). This simple <a id="_idIndexMarker891"/>assumption<a id="_idIndexMarker892"/> is shown in the following figure:</p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><img alt="" src="img/B19145_13_02.png"/>Figure 13.2 – Linear functions with <img alt="" src="img/Formula_B19145_13_014.png"/> = 1, <img alt="" src="img/Formula_B19145_13_015.png"/> &gt; 1, and <img alt="" src="img/Formula_B19145_13_016.png"/> &lt; 1</p>
<p>The benchmark (the market) is assumed to grow at a rate of <img alt="" src="img/Formula_B19145_13_017.png"/> = 1 (black line). Any function with <img alt="" src="img/Formula_B19145_13_017.png"/> &gt; 1 (in our example <img alt="" src="img/Formula_B19145_13_019.png"/> = 2) will grow faster, and any function with <img alt="" src="img/Formula_B19145_13_020.png"/> &lt; 1 (<img alt="" src="img/Formula_B19145_13_021.png"/> = 0.5 in our example) will grow slower than the benchmark.</p>
<p class="callout-heading">Note</p>
<p class="callout">Such an interpretation of alpha is not common and cannot be used in classical capital management<a id="_idIndexMarker893"/> theory. I provided<a id="_idIndexMarker894"/> this unusual point of view only for your reference.</p>
<p>Now, I hope it’s more or less clear with alpha in all its aspects, but what about beta?</p>
<h2 id="_idParaDest-224"><a id="_idTextAnchor225"/>Beta</h2>
<p>Beta is a<a id="_idIndexMarker895"/> measure of the volatility of returns. Remember <a id="_idIndexMarker896"/>the analogy of a road trip that we discussed in the <em class="italic">Beta – earn on volatility</em> section of <a href="B19145_09.xhtml#_idTextAnchor152"><em class="italic">Chapter 9</em></a>, <em class="italic">Trading Strategies and Their Core Elements</em>? Not only the fact that we were able to get from point A to point B matters but also how we got there, so how straight or winding the path was. If we want to illustrate this comparison, we can again use a linear function as the example of a straight path and the same linear function with a periodical component added to it as the example of a path with extra volatility:</p>
<div><div><img alt="Figure 13.3 – Linear function with and without added volatility" src="img/B19145_13_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.3 – Linear function with and without added volatility</p>
<p>We can see that both functions <em class="italic">get</em> from point <strong class="bold">(0,0)</strong> to <strong class="bold">(2,2)</strong>, but the linear one does it <em class="italic">faster</em>. Now, let’s imagine that both graphs illustrate the return on a certain investment. Then, the <em class="italic">x</em>-axis <a id="_idIndexMarker897"/>means time and the <em class="italic">y</em>-axis means the<a id="_idIndexMarker898"/> amount of money earned or lost during a certain period. Therefore, when we see that the curve is growing, this means that money is accumulating in the account, and when we see it going down, this means that the account is losing money.</p>
<p>Now, let’s take periodical snapshots of the activity in our sample investments and measure two metrics:</p>
<ul>
<li>How much the value changed from the time of the previous snapshot until the time of the current snapshot</li>
<li>How much the value changed during the snapshot inside a given period of time</li>
</ul>
<p>In the following figure, I zoomed in and marked the corresponding values on the graph:</p>
<div><div><img alt="Figure 13.4 – Returns and their volatility in a simplified model" src="img/B19145_13_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.4 – Returns and their volatility in a simplified model</p>
<p>In this example, we <a id="_idIndexMarker899"/>check the return (<strong class="bold">R</strong>) and volatility (<strong class="bold">V</strong>) at <a id="_idIndexMarker900"/>every integer value (1, 2, 3, and so on).</p>
<p>Let the difference between the previous value of the return (measured at 0) and the current value (1) be <strong class="bold">ΔR</strong>. In our example, <img alt="" src="img/Formula_B19145_13_022.png"/>.</p>
<p>Then we notice that the return first grows (from 0 to approximately 1.3) then falls down to about -0.65, then grows again to 1.6, then falls down to -0.15, and, finally, grows back to about 1.4. So, during the snapshot period from 0 to 1, the function already made several extremes, both maximums and minimums. Let <strong class="bold">ΔV</strong> be the difference between a local maximum and the next local minimum, which immediately follows this maximum (not vice versa!) In our example, <img alt="" src="img/Formula_B19145_13_023.png"/>.</p>
<p>The value of <strong class="bold">ΔV</strong> is called <strong class="bold">drawdown</strong> and is one of the key performance metrics of any investment or trading<a id="_idIndexMarker901"/> strategy.</p>
<p>So, how can we now estimate (very roughly, but anyway) the beta of the returns?</p>
<p>We are interested in the ratio of the return to drawdown:</p>
<p><img alt="" src="img/Formula_B19145_13_024.png"/></p>
<p>We want the value of this ratio to be as high as possible. If we have a choice between two or more strategies, then we prefer the one for which the ratio of return to drawdown is greater.</p>
<p>In our example, the obvious choice would be a <em class="italic">linear</em> strategy because it delivers only gains without a single loss down the road. This means that this strategy has a value of ΔV = 0 and thus the ratio in question is infinite. Of course, it never happens in reality, but it gives a clear idea about the utopian goal of any investor.</p>
<p>The second strategy features a ratio of return to a drawdown of about 0.77. This means that although<a id="_idIndexMarker902"/> this strategy makes money, the investor <a id="_idIndexMarker903"/>will have quite a few desperate moments until it gets to the positive zone: the volatility of returns of this strategy is greater than the return itself!</p>
<p>The approach that we have just considered is, of course, a very simplified one. In practical applications, beta is normally calculated as the volatility of returns compared not to returns on the same strategy or investment but to a benchmark, as with alpha and other investment performance metrics. Besides that, it would be more correct to evaluate not only the ratio of return to drawdown for the entire investment or trading period but to also calculate them first for a number of smaller periods, then average them, and finally calculate the dispersion of these values, thus understanding how this ratio changes over time or how consistent the volatility of returns is for this given strategy or investment.</p>
<p>However, I promised to keep things simple in this book and not require specific knowledge from the theory of probabilities, so we won’t go that far during our first acquaintance with performance metrics. If you want to deep-dive into this very interesting and very complex subject, I recommend starting with a framework article at Investopedia (<a href="https://www.investopedia.com/investing/measure-mutual-fund-risk">https://www.investopedia.com/investing/measure-mutual-fund-risk</a>) and following all links provided there: very quickly, you will find yourself in the jungles of means, standard deviations, variance, and covariance, but in the long run, it’s going to be quite a rewarding experience.</p>
<p class="callout-heading">Important note</p>
<p class="callout">The suggested estimate of beta is not the same beta used in the classical capital management formula earlier in this chapter. It is introduced here only to explain the essence of the volatility of returns and better understand the basic performance metrics discussed next.</p>
<p>Alright, we have refreshed our memory about both alpha and beta, but did you notice that so far we have been talking about alpha as a performance metric for investments? Is there any difference between investing and trading, and can we still use alpha to assess the performance of trading strategies?</p>
<p>The main difference between the two is that investing assumes buying an asset and holding it for a long time, while trading means that you actively buy and sell the asset during the same period of time. Therefore, with investment, we can potentially outperform the <a id="_idIndexMarker904"/>market by choosing assets that perform <a id="_idIndexMarker905"/>better than the broad market (by an index or any other benchmark), and in active trading, we try to outperform the asset itself by holding it for shorter periods of time.</p>
<p>The main problem with using both alpha- and beta-related metrics to analyze the performance of trading strategies is the lack of relevant benchmarks suitable for this purpose. We already mentioned this problem in <a href="B19145_09.xhtml#_idTextAnchor152"><em class="italic">Chapter 9</em></a>, <em class="italic">Trading Strategies and Their Core Elements</em>, and pointed out that it would make more sense to use specific FX benchmarks to assess the performance of FX trading strategies.</p>
<p>However, sometimes it is really difficult to find a suitable benchmark to compare apples to apples: for example, if we try to assess the performance of an intraday strategy that opens and closes multiple positions per day ideally, we should compare it to a similar intraday strategy used as a reference, but finding such a reference will be quite a challenge by itself! So, what do we do in order to adequately assess the performance of a trading strategy given that we don’t have a benchmark as such?</p>
<p>Well, this is why most of the performance metrics used to evaluate the trading strategy performance only use that same performance data, sometimes in conjunction with the asset price data. These metrics can be considered <em class="italic">proxies</em> to <em class="italic">true alpha</em> or <em class="italic">true beta</em>, and if put together, they can give quite a comprehensive analysis, which helps answer the main question <a id="_idIndexMarker906"/>of trading: whether to put<a id="_idIndexMarker907"/> money at stake with this strategy or not.</p>
<p>Let’s start with metrics that aim at estimating the alpha of a trading strategy returns.</p>
<h1 id="_idParaDest-225"><a id="_idTextAnchor226"/>Net profit versus buy and hold</h1>
<p>This is the<a id="_idIndexMarker908"/> first thing to check after you have confirmed that the average trade is greater than the required absolute minimum to cover all trading costs. Buy and hold means that we buy the same quantity of the currency that we use in backtest, hold the position for the entire period of the backtest, and then look at the<a id="_idIndexMarker909"/> final <strong class="bold">profit and loss</strong> (<strong class="bold">PnL</strong>), on the last bar of the price time series. In our case, we should <em class="italic">buy</em> 10,000 AUD/USD, hold it for approximately 3 years, and look at the return from this single trade.</p>
<p>I recommend comparing not only the net profits of the strategy and buy and hold but also the equity curves: this will give us an idea about the change in the equity over time in both scenarios.</p>
<p>Let’s quickly create the equity curve of a buy-and-hold strategy. As you remember, we isolated the trade logic into a separate function, <code>tradeLogic()</code>, so we only should rewrite the part between the <code>Trade logic starts here</code> and <code>Trade logic ends here</code> comments while keeping the rest of the code untouched. It’s a good idea to make a copy of the <code>tradeLogic()</code> function first and give it a proper name – for example, <code>buyAndHold()</code>, before making changes to the code:</p>
<pre class="source-code">
        if System.market_position == 0:
            close = bar['Close']
            order = {}
            order['Type'] = 'Market'
            order['Price'] = close
            order['Side'] = 'Buy'
            order['Size'] = 10000
            orders_stream.put(order)</pre>
<p>As you can see, the only difference between <code>buyAndHold()</code> and <code>tradeLogic()</code> is that we removed all trade logic and replaced it with a single trade placed on the very first bar. No other trades are placed for the rest of the backtesting.</p>
<p>If we now run the backtest, we will see the equity curve of our hypothetical buy-and-hold <em class="italic">investment</em>. Note that the <em class="italic">x</em>- and <em class="italic">y</em>-axes mean the same as in the simplified illustrations: the <em class="italic">x</em>-axis represents time – in our backtest, days (because we use daily data in our <a id="_idIndexMarker910"/>backtest) – and the <em class="italic">y</em>-axis represents the returns.</p>
<div><div><img alt="Figure 13.5 – Buy-and-hold returns, AUD/USD" src="img/B19145_13_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.5 – Buy-and-hold returns, AUD/USD</p>
<p>And the output in the console reads as follows:</p>
<pre class="source-code">
Total trades: 1
Average trade: -153.9999999999997</pre>
<p>This means that if we bought 10,000 Australian dollars for US dollars 3 years ago (and the historical price data starts in 2020), then we would have had a generous return of -153 dollars (!), which equals -1.53% (!) in 3 years. And this is even without saying that we had a drawdown of almost 1,500 dollars or 15% before we achieved such an incredible result.</p>
<p>Well, I hope you got my sarcasm: now you can see why I always become very skeptical when I hear anything about <em class="italic">investments</em> in currency markets: even in such a brief timespan of 3 years, it’s very hard to find a currency pair that could deliver returns comparable to the <em class="italic">normal</em> state of a stock market (by <em class="italic">normal</em> here, I mean the bull market, when stock indices grow every year, quarter, and sometimes even every month. Let’s forget about bear markets for now, not to spoil such an idealistic picture). Without actively managing the positions (buying <em class="italic">and</em> selling), it would be impossible to achieve any acceptable returns in the FX markets. Let’s do the switch back – replace the <code>buyAndHold()</code> function<a id="_idIndexMarker911"/> with <code>tradeLogic()</code> and run the backtest again:</p>
<div><div><img alt="Figure 13.6 – Returns of the sample trend-following trading strategy, AUD/USD" src="img/B19145_13_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.6 – Returns of the sample trend-following trading strategy, AUD/USD</p>
<p>And the console output now reads as follows:</p>
<pre class="source-code">
Total trades: 37
Average trade: 79.40540540540536</pre>
<p>This means that for the same test period of 3 years, we made almost $3,000 by trading exactly the same size of 10,000 AUD/USD. Without any comments, it’s evident how this result surpasses the buy-and-hold strategy: it equals 30% in 3 years compared to -1.53% for buy-and-hold.</p>
<p>Let’s calculate an estimate of alpha for our trend-following strategy. The strategy return is 30%, the <em class="italic">risk-free</em> rate of return could be estimated at -2.85% (3 years of treasury bills at 4.25% yield minus inflation at 7.1% in 2022), the benchmark return at -1.53%, and given that the beta, or the volatility of returns, is at least no worse than the benchmark (which is obviously the case just looking at the two figures here), then the alpha for our strategy is about 31.53% in 3 years.</p>
<p>So, we can say that the strategy has passed two checks: it has an average trade value that allows the strategy to actually trade (not only on paper), but it also generates alpha (outperforms the benchmark) and its returns are comparable to those of a conventional investment (for example, investing in the S&amp;P 500 ETF would return about 18% in the same 3 years).</p>
<p>Let’s now move on to assessing the beta, or the volatility of returns. As noted previously, we are not going to provide the classical definition of beta used in capital management<a id="_idIndexMarker912"/> because it requires specific knowledge from the theory of probabilities. Instead, we will consider drawdown, the third most important metric after average trade and overall returns, and show why it can be used as a <em class="italic">proxy</em> to assess the volatility of returns.</p>
<h1 id="_idParaDest-226"><a id="_idTextAnchor227"/>Drawdown</h1>
<p>According to an <a id="_idIndexMarker913"/>article <a id="_idIndexMarker914"/>published on CFI (Maximum Drawdown: <a href="https://corporatefinanceinstitute.com/resources/capital-markets/maximum-drawdown/">https://corporate financeinstitute.com/resources/capital-markets/maximum-drawdown/</a>), “A maximum drawdown (MDD) measures the maximum fall in the value of the investment, as given by the difference between the value of the lowest trough and that of the highest peak before the trough.” We already saw an illustration of the drawdown in <em class="italic">Figure 13</em><em class="italic">.4</em> and it is quite easy to understand. However, real equity curves never look like ideal sine waves used for illustration purposes, so drawdown is not a constant value; it changes over time and these changes also may say a lot about the volatility of returns.</p>
<p>So, we want to calculate a new time series according to the following algorithm:</p>
<ol>
<li>Let the first (leftmost) data point in the equity curve be the current historical high (maximum).</li>
<li>Compare the next value with the current one.</li>
<li>If the next value is greater than the current, let the next value be the new historical high.</li>
<li>If the next value is less than the current, store the difference between this value and the current historical high as the drawdown.</li>
<li>Finish updating the drawdown when the equity curve makes a new historical high and repeat the entire algorithm.</li>
</ol>
<p>As you can see, if we work with time series or any other sequences, iterables, arrays, and so on, we can more efficiently realize the same calculation in just two steps:</p>
<ol>
<li value="1">Form a new sequence in which the next element is either equal to the preceding one or greater.</li>
<li>Subtract<a id="_idIndexMarker915"/> the original sequence from<a id="_idIndexMarker916"/> the resulting sequence.</li>
</ol>
<p>This will give us a sequence of drawdowns.</p>
<p>To better understand what the drawdown is and how it is calculated, let’s consider a simple example.</p>
<p>Let’s create a list containing a sequence of non-negative values:</p>
<pre class="source-code">
a = [1,2,4,3,5,8,7,6,2,9,10]</pre>
<p>Then, prepare an empty list where we’re going to store the result:</p>
<pre class="source-code">
m = [] # m stands for 'maximum'</pre>
<p>And initialize a variable that is supposed to store the current high (maximum) in the initial list:</p>
<pre class="source-code">
x = 0</pre>
<p>Now, we iterate over all elements in the list, <code>a</code>, compare them to the last maximum value, choose the new maximum, update it, and append it to the resulting list, <code>m</code>:</p>
<pre class="source-code">
for el in a:
    if el &gt; x:
        x = el
    m.append(x)</pre>
<p>If you did everything correctly, then <code>m</code> should contain the following sequence: <code>[1, 2, 4, 4, 5, 8, 8, 8, 8, 9, 10]</code>. If we now subtract the original sequence, <code>a</code>, from <code>m</code>, then we get the series of drawdowns:</p>
<pre class="source-code">
[x - y for x, y in zip(a, m)]</pre>
<p>This returns <code>[0, 0, 0, -1, 0, 0, -1, -2, -6, 0, 0]</code>. This is the list of drawdowns calculated at every data point in the original sequence.</p>
<p>We can verify the result by scanning the data in the original sequence from left to right. The second element in <code>a</code> is greater than the first, so the drawdown is 0 and the latest high is 2. The third element is greater than the latest high, so the drawdown is again 0, and the latest high is updated to 4. The fourth element in <code>a</code> is less than the latest high by 1, so the fourth element in <code>m</code> is -1, and the latest high remains 4. You can continue this calculation and make sure that all the drawdown values are calculated correctly – and that you now fully understand the meaning of the drawdown.</p>
<p>There is a faster <a id="_idIndexMarker917"/>way of doing exactly this by <a id="_idIndexMarker918"/>using <code>numpy</code> arrays:</p>
<pre class="source-code">
import numpy as np
a = [1,2,4,3,5,8,7,6,2,9,10]
m = np.maximum.accumulate(a)
dd = a - m</pre>
<p>This simple code will generate the same sequence of drawdowns as before, the only difference now is that it’s going to be a <code>numpy</code> array rather than a native Python list:</p>
<pre class="source-code">
&gt;&gt;&gt; dd
array([ 0,  0,  0, -1,  0,  0, -1, -2, -6,  0,  0])</pre>
<p>Now that we fully understand what drawdown is and how it can be calculated, let’s do it for the equity time series of our trend-following strategy.</p>
<p>Firstly, and above all, we should add <code>import numpy</code> at the very beginning of the code, among other imports.</p>
<p>Next, let’s slightly modify the very end of the backtester code, where <code>matplotlib</code> <code>plot()</code> is called:</p>
<pre class="source-code">
dd = System.equity_timeseries - np.maximum.accumulate(System.equity_timeseries)
plt.subplot(2,1,1)
plt.plot(System.equity_timeseries)
plt.subplot(2,1,2)
plt.plot(dd)
plt.show()</pre>
<p>You can see<a id="_idIndexMarker919"/> a <a id="_idIndexMarker920"/>new command: <code>plt.subplot()</code>. It is used to place multiple charts or graphs on the same canvas (see <a href="B19145_08.xhtml#_idTextAnchor130"><em class="italic">Chapter 8</em></a>, <em class="italic">Data Visualization in FX Trading with Python</em>, to refresh your memory regarding the object model of <code>matplotlib</code> plots). To save time and space here, I recommend you have a glance at a tutorial at <a href="https://www.w3schools.com/python/matplotlib_subplot.asp">https://www.w3schools.com/python/matplotlib_subplot.asp</a> to understand the meaning of <code>subplot()</code> parameters.</p>
<p>Now, if you have done everything correctly and run the backtest again (using, of course, the same source price data!), you will now see the same equity curve as before, but with the drawdown chart beneath it:</p>
<div><div><img alt="Figure 13.7 – Equity curve and drawdown of the sample trend-following strategy" src="img/B19145_13_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.7 – Equity curve and drawdown of the sample trend-following strategy</p>
<p>Now, we know a lot more about our strategy, especially about the risks associated with it. Even without<a id="_idIndexMarker921"/> doing precise calculations (which <a id="_idIndexMarker922"/>can be quite complex) and taking only a surface look at the resulting graphs here, we can make a number of important conclusions, which we are going to consider in the very next section.</p>
<h2 id="_idParaDest-227"><a id="_idTextAnchor228"/>Risk/reward and return on drawdown</h2>
<p>First of all, we <a id="_idIndexMarker923"/>want to <a id="_idIndexMarker924"/>understand whether drawdowns are distributed more or less evenly during the backtest period. This is very important because if there are significant drawdowns that appear at random, then it’s a warning sign: this means that there are some occasional processes in the market that are not accounted for by the model used in the trading strategy, and sooner or later, one of these processes may destroy the strategy completely.</p>
<p>Before we proceed, I recommend you refresh your memory about the mean and standard deviation, which we discussed in the <em class="italic">Volatility indicators</em> section of <a href="B19145_06.xhtml#_idTextAnchor101"><em class="italic">Chapter 6</em></a>, <em class="italic">Basics of Fundamental Analysis and Its Possible Use in </em><em class="italic">FX Trading</em>.</p>
<p>We can quickly analyze the result by running the backtest in an interactive console and entering the following after the initial chart is displayed:</p>
<pre class="source-code">
mean_dd = dd.mean()</pre>
<p>This calculates the mean drawdown. The following command returns the standard deviation of drawdowns:</p>
<pre class="source-code">
std_dd = dd.std()</pre>
<p>Now, add three<a id="_idIndexMarker925"/> lines <a id="_idIndexMarker926"/>to the plot: the mean drawdown, mean minus 1 sigma, and mean minus 2 sigma:</p>
<pre class="source-code">
plt.plot(range(len(dd)), [mean_dd] * len(dd))
plt.plot(range(len(dd)), [mean_dd - std_dd] * len(dd))
plt.plot(range(len(dd)), [mean_dd - 2*std_dd] * len(dd))</pre>
<p>If you have done everything correctly, you should see something like this in the following figure:</p>
<div><div><img alt="Figure 13.8 – Mean minus 1 and 2 sigma of drawdowns" src="img/B19145_13_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.8 – Mean minus 1 and 2 sigma of drawdowns</p>
<p>How do we interpret the result?</p>
<p>Drawdowns that <a id="_idIndexMarker927"/>lie outside <a id="_idIndexMarker928"/>of 2 sigma (the bottom horizontal line in the chart) are so-called outliers. They deserve special attention because usually, they are caused by reasons not accounted for in the strategy logic. In our case, fortunately, they are not numerous and at least the very first one is easily explained by the market volatility at the beginning of the COVID-19 panic.</p>
<p>Drawdowns between mean and 2 sigma are distributed more or less evenly over time. This means that they are just systematic drawdowns caused by the imperfections of the market model used in the strategy.</p>
<p>Most of the drawdowns are above the mean value and again, they are distributed evenly along the time axis – so, this gives us hope that the market model is adequate for the market.</p>
<p>After an initial visual qualitative analysis, let’s go to numbers. The maximum drawdown (which also can be found by typing <code>min(dd)</code> in an interactive console or adding <code>print(min(dd))</code> to the code) of our strategy is 646 pips. Is it large or small? If you invest $10,000 and temporarily lose $646, this means that you risk about 6.5% of your account. This is a moderate-to-low-risk, which is considered acceptable to most investors.</p>
<p>However, a more important metric is the risk-to-reward ratio. The meaning of this metric is quite intuitive: the less the ratio, the less the volatility of returns and thus the less the overall risk of investing.</p>
<p>Let’s do the simple math for our example. The total net profit of our strategy is slightly above 3,000 pips in 3 years. Even if we assume that it generates the same return each year (which is not the case), then on average, it returns about 1,500 pips per annum. This means that by risking $646, we may expect about $1,500, so the risk/reward ratio is about 0.43.</p>
<p>The sacramental question again: is that <em class="italic">good</em> or <em class="italic">bad</em>?</p>
<p>Generally speaking, any risk/reward ratio less than 1 is good because this means that you risk less<a id="_idIndexMarker929"/> than you <a id="_idIndexMarker930"/>may expect to win. There are debates on the <em class="italic">optimal</em> value of the risk/reward ratio (along with <em class="italic">optimal</em> values for all other performance metrics) but most authors agree that any value less than 0.5 gives a potential green light to investing in a financial product.</p>
<p class="callout-heading">Note</p>
<p class="callout">Strictly speaking, the question about the risk/reward ratio is also closely connected to the problem of benchmarking. Unfortunately, this subject is too wide and too complex to be carefully considered in this book, but the provided rough estimates can work quite well as starting points for your research.</p>
<p>Another metric that is essentially the inverted risk/reward ratio is the return on drawdown. The only difference is that the latter is usually calculated as a percentage and not as a fractional value. The meaning of this metric is also very intuitive: it means the expected premium for the risk – the payoff we expect if we risk a certain amount of money.</p>
<p>In our example, the return on drawdown equals 1,500/646*100 = 232.2% in 2 years. In other words, you may expect about twice the amount of risk you can afford to allocate to this strategy.</p>
<p>At this point, you may exclaim, <em class="italic">“why, but earlier in this chapter, we calculated an alpha of only about 30%, how come now we get such a </em><em class="italic">huge return?”</em></p>
<p>This is probably<a id="_idIndexMarker931"/> the most<a id="_idIndexMarker932"/> confusing part of FX trading and we will consider it in detail in the very next section.</p>
<h1 id="_idParaDest-228"><a id="_idTextAnchor229"/>The power of leverage – how much do I need to trade it?</h1>
<p>Finally, we are<a id="_idIndexMarker933"/> about to answer the main question of any investor: how much do I have to have in my trading account and how much can I expect from it?</p>
<p>Before we continue, let me draw your attention to the following important fact about FX trading.</p>
<p class="callout-heading">Note</p>
<p class="callout">Do not confuse the return on investment as a performance metric with the actual return on actual investment!</p>
<p>To understand it, we should again recall the essence of margin trading and how it differs from regular investment and trading without margins.</p>
<p>When you invest or trade without margin, you can buy only that amount of assets (equities, commodities, whatever) that cost the amount of money in your account. For example, if you trade stocks, and a stock’s price is $100, and you have $10,000 in your account, then you can buy no more than 100 shares of the stock (actually a bit less because of trading costs).</p>
<p>However, if you trade on margin, then you are supposed to have only a fraction of the full required amount, and the rest will be provided as a credit line by your broker. In our example with AUD/USD, if you have 10,000 US dollars in your account and your broker provides you with a retail leverage of 30:1, then you potentially can buy as much as <img alt="" src="img/Formula_B19145_13_025.png"/> Australian dollars.</p>
<p>The ability to purchase magnitudes more assets than otherwise possible with the amount in your trading account makes margin trading very attractive to many novice traders. However, leverage is a double-edged sword. Let’s do some simple math and see why it may be quite dangerous.</p>
<p>Do you remember that we consistently calculated everything in pips, and not in money? Now we can benefit from this because we only need to adjust the pip value according to the chosen leverage and scale all the performance metrics.</p>
<p>So, when we traded 10,000 AUD/USD, the net return was about 3,000 pips, and the maximum drawdown was 646 pips. If we had the same $10,000 in our account, that would mean that we traded without leverage, and for unleveraged trading, the return indeed would make about 30% while the drawdown would remain acceptably low, around 6.5%.</p>
<p>Now, we trade with a leverage of 30:1. This means that a pip value now equals $30, not $1. Then, the return would make $30 * 3000 = $90,000 – what a handsome profit! If we present this figure as percent growth over the initial investment, we will have an incredible value of 900% in just 3 years. So, margin trading is a great benefit and the way to go, isn’t it?</p>
<p>But we forgot <a id="_idIndexMarker934"/>about the drawdown. We also have to scale it up, as now 1 pip costs $30. This way, a drawdown of 646 pips translates into $30 * 646 = $19,380.</p>
<p>Oops.</p>
<p>The drawdown now is twice as much as the total initial capital in the account! This means that in reality, we would have never reached the expected return. Moreover, instead of making a profit, we would have lost all money in our account and faced a catastrophe notoriously<a id="_idIndexMarker935"/> known as a <em class="italic">margin call</em>: the situation when the broker calls for adding funds to your account because otherwise, the open position cannot be maintained. Most retail brokers do not wait until clients add funds to their accounts and simply liquidate such a position with a loss. Therefore, if we traded our strategy with a leverage of 30:1, we would have lost all money in the account during the very first drawdown.</p>
<p>So, how do we choose the acceptable leverage?</p>
<p>With margin trading, we normally start from the opposite end. Instead of calculating the projected returns from the strategy metrics, first of all, we try to estimate a leverage that would allow our positions to remain open during the entire trading period.</p>
<p>We know that the maximum drawdown is 646 pips and we have $10,000 in a trading account. Thus, the maximum possible leverage should make the pip value no greater than 10,000/646, which is about $15. Therefore, the absolute maximum possible leverage is 15:1, which is twice as low as the 30:1 offered by the broker.</p>
<p>Now, let’s have a critical look at the result.</p>
<p>Can we trade our strategy with leverage of 15:1? Theoretically yes, practically no because in this case, the drawdown would make up 100% of the trading account. I can’t imagine any trader, not commenting on investors, who would be able to withstand such a drawdown, even just psychologically.</p>
<p>In reality, the calculation of the right leverage is performed in the following sequence:</p>
<ol>
<li value="1">Define the maximum level of losses. This is not the maximum drawdown of a strategy, but the maximum drawdown acceptable by the investor.</li>
<li>Calculate the<a id="_idIndexMarker936"/> pip value so that this acceptable level of losses would equal the strategy drawdown.</li>
<li>Define leverage as the ratio of the projected pip value to the original pip value.</li>
<li>Define the trading size as the original trading size multiplied by the leverage.</li>
</ol>
<p>Let’s calculate the leverage for our strategy with the assumption that an average investor can afford to withstand a drawdown of 10% of the initial investment. Let’s also assume that the initial investment is $10,000. Therefore, the maximum loss in the account should not ever exceed $1,000. With a maximum strategy drawdown of 646 pips, the value of 1 pip can be equal to $1,000/646 = $1.54. So, we use leverage of just 1.5:1 (not 15:1, not 30:1, and of course not 100:1 as offered by many brokers!) Now, we recall that a pip value of $1 is obtained when we trade $10,000 per trade. We multiply the original trading size (10,000) by the leverage (1.5) and we get only 15,000 AUD/USD.</p>
<p>And what about returns? Previously we calculated two metrics – alpha and return on drawdown – and they gave two very different values: about 30% in the former case and over 200% in the latter. With our acceptable level of losses of 10% and leverage of 1.5:1, we expect a return of 3,000 pips * $1.5 = $4,500 in 2 years. This equals 45% of the initial investment of $10,000.</p>
<p>Now, let’s cover<a id="_idIndexMarker937"/> the key takeaways from everything we discussed in this chapter.</p>
<p class="callout-heading">Note</p>
<p class="callout">Alpha is calculated for an unleveraged investment and gives the lowest estimate of possible returns.</p>
<p class="callout">Return on drawdown is calculated for the maximum possible leverage and gives the upper estimate of possible returns (assuming that the drawdown may reach 100% of the initial investment).</p>
<p class="callout">The realistic return is calculated based on the chosen risk level and is always between alpha and the return on the drawdown.</p>
<h1 id="_idParaDest-229"><a id="_idTextAnchor230"/>Summary</h1>
<p>In this chapter, we familiarized ourselves with the most basic yet essential performance metrics. We understand now that there are three main aspects that help assess the strategy performance: trade analysis, alpha-related metrics such as returns, and beta-related metrics such as the volatility of returns and analysis of drawdowns. We learned about the main factors that always have a negative impact on performance, such as spread, slippage, commission, and overnight swaps, and we saw how we can realistically account for them in our assessment.</p>
<p>We have had a surface peek into the basics of capital management and considered alpha and beta, in a simplified form, but at least in a helpful enough way to improve our judgments regarding strategy. Finally, we carefully considered the leverage, saw its double-edged nature, and adopted the correct way of choosing the leverage for markets traded on margin, such as FX.</p>
<p>Of course, this chapter is only an introduction to the vast, complex, but interesting world of capital management and risk assessment, as this entire book is only an introduction to the world of systematic FX trading in general. However, even the basic facts and techniques considered in this book are enough to start your own homework. Hopefully, this homework is going to be perpetual – because any successful trader, in the long run, is a perpetual student of the market.</p>
<p>I encourage you to test any idea you may come across – now that you know how to do it, critically analyze the results – using the approach outlined in this chapter, and continue your studies, using my remarks <em class="italic">“it is unfortunately outside the scope of this book”</em> as invitations to learn more yourself. One day, you may find that you operate a portfolio of various strategies running in a large number of markets, bringing you both mental satisfaction from decent work and quite a significant material reward.</p>
</div>
</body></html>