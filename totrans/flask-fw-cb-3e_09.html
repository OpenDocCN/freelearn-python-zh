<html><head></head><body>
<div id="_idContainer068">
<h1 class="chapter-number" id="_idParaDest-248"><a id="_idTextAnchor469"/><a id="_idTextAnchor470"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-249"><a id="_idTextAnchor471"/><span class="koboSpan" id="kobo.2.1">Internationalization and Localization</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Web applications are usually not limited to one geographical region or only serve people from one linguistic domain. </span><span class="koboSpan" id="kobo.3.2">For example, a web application intended for users in Europe will be expected to support more than one European language, such as German, French, Italian, and Spanish, as well as English. </span><span class="koboSpan" id="kobo.3.3">This chapter will cover the basics of how to enable support for multiple languages in a </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">Flask application.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">Adding support for a second language in any web application is a tricky affair. </span><span class="koboSpan" id="kobo.5.2">It increases the overhead a bit every time some change is made to the application, and this increases with the number of languages. </span><span class="koboSpan" id="kobo.5.3">There can be a number of things that need to be taken care of, apart from just changing the text, depending on the language. </span><span class="koboSpan" id="kobo.5.4">Some of the major things that need changing are currency, number, time, and </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">date formatting.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.7.1">Flask-Babel</span></strong><span class="koboSpan" id="kobo.8.1">, an extension that adds </span><strong class="bold"><span class="koboSpan" id="kobo.9.1">internationalization</span></strong><span class="koboSpan" id="kobo.10.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.11.1">i18n</span></strong><span class="koboSpan" id="kobo.12.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.13.1">localization </span></strong><span class="koboSpan" id="kobo.14.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.15.1">l10n</span></strong><span class="koboSpan" id="kobo.16.1">) support to any Flask application, provides a number of tools and techniques to make this process easy </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">to implement.</span></span></p>
<p><span class="koboSpan" id="kobo.18.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.20.1">Adding a </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">new language</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Implementing lazy evaluation and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.23.1">gettext</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">/</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.25.1">ngettext</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.26.1"> functions</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Implementing the global </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">language-switching action</span></span></li>
</ul>
<h1 id="_idParaDest-250"><a id="_idTextAnchor472"/><span class="koboSpan" id="kobo.29.1">Adding a new language</span></h1>
<p><a id="_idTextAnchor473"/><span class="koboSpan" id="kobo.30.1">By default, English is the language</span><a id="_idIndexMarker374"/><span class="koboSpan" id="kobo.31.1"> for applications built in Flask (and almost all web frameworks). </span><span class="koboSpan" id="kobo.31.2">In this recipe, we will add a second language to our application and add some translations for the display strings used in the application. </span><span class="koboSpan" id="kobo.31.3">The language displayed to the user will vary depending on the language that is currently set in </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">the browser.</span></span><a id="_idTextAnchor474"/></p>
<h2 id="_idParaDest-251"><a id="_idTextAnchor475"/><span class="koboSpan" id="kobo.33.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.34.1">We will start with the installation of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.35.1">Flask-Babel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.36.1"> extension:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.37.1">
$ pip install Flask-Babel</span></pre>
<p><span class="koboSpan" id="kobo.38.1">This extension uses </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">Babel</span></strong><span class="koboSpan" id="kobo.40.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.41.1">pytz</span></strong><span class="koboSpan" id="kobo.42.1"> to add i18n and</span><a id="_idIndexMarker375"/><span class="koboSpan" id="kobo.43.1"> l10n support to </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">the application.</span></span></p>
<p><span class="koboSpan" id="kobo.45.1">We will use our </span><a id="_idIndexMarker376"/><span class="koboSpan" id="kobo.46.1">catalog application from </span><a href="B19111_05.xhtml#_idTextAnchor273"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.47.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.48.1">, </span><em class="italic"><span class="koboSpan" id="kobo.49.1">Web Forms </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.50.1">with WTForm</span><a id="_idTextAnchor476"/><span class="koboSpan" id="kobo.51.1">s</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">.</span></span></p>
<h2 id="_idParaDest-252"><a id="_idTextAnchor477"/><span class="koboSpan" id="kobo.53.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.54.1">We will use French as the</span><a id="_idIndexMarker377"/><span class="koboSpan" id="kobo.55.1"> second language. </span><span class="koboSpan" id="kobo.55.2">Follow these steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">achieve this:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.57.1">Start with the configuration part by creating an instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">Babel</span></strong><span class="koboSpan" id="kobo.59.1"> class, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.60.1">app</span></strong><span class="koboSpan" id="kobo.61.1"> object in </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">my_app/__init__.py</span></strong><span class="koboSpan" id="kobo.63.1">. </span><span class="koboSpan" id="kobo.63.2">We will also specify all the languages that will be </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">available here:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.65.1">
from flask import request</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.66.1">
from flask_babel import Babel</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.67.1">
ALLOWED_LANGUAGES = {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.68.1">
    'en': 'English',</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.69.1">
    'fr': 'French',</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.70.1">
}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.71.1">
babel = Babel(app)</span></pre></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.72.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.73.1">Here, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">en</span></strong><span class="koboSpan" id="kobo.75.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">fr</span></strong><span class="koboSpan" id="kobo.77.1"> as the language codes. </span><span class="koboSpan" id="kobo.77.2">These refer to English (standard) and French (standard), respectively. </span><span class="koboSpan" id="kobo.77.3">If we intend to support multiple languages that are from the same standard language origin, but differ on the basis of region, such as English (US) and English (GB), then we should use codes such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">en-us</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.79.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">en-gb</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.82.1">The locale of the application depends on the output of the method that is provided while initializing the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">babel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.84.1"> object:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.85.1">
def get_locale():</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.86.1">
    return request.accept_languages.best_match</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.87.1">
      (ALLOWED_LANGUAGES.keys())</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.88.1">
babel.init_app(app, locale_selector=get_locale)</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.89.1">The preceding method </span><a id="_idIndexMarker378"/><span class="koboSpan" id="kobo.90.1">gets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">accept_languages</span></strong><span class="koboSpan" id="kobo.92.1"> header from the request and finds the language that best matches the languages we allow.</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.93.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.94.1">You can change the language preferences of your browser to test the application’s behavior in </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">another language.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.96.1">Earlier, it used to be pretty easy to change the language preferences in the browser, but with the locale becoming more ingrained in the OS, it has become difficult to do so without changing the global locale of the OS. </span><span class="koboSpan" id="kobo.96.2">Hence, if you do not want to mess with the language preferences of the browser or your OS, simply return the expected language code from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">get_locale()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.98.1"> method.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.99.1">Next, create a file in the application folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">babel.cfg</span></strong><span class="koboSpan" id="kobo.101.1">. </span><span class="koboSpan" id="kobo.101.2">The path of this file will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">my_app/babel.cfg</span></strong><span class="koboSpan" id="kobo.103.1">, and it will have the </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">following content:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.105.1">
[python: catalog/**.py]</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.106.1">
[jinja2: templates/**.html]</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.107.1">Here, the first two lines tell </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">Babel</span></strong><span class="koboSpan" id="kobo.109.1"> about the filename patterns that are to be searched for marked translatable text.</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.110.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.111.1">In earlier versions of this book, I suggested loading a couple of extensions from Jinja2, namely, </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">jinja2.ext.autoescape</span></strong><span class="koboSpan" id="kobo.113.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">jinja2.ext.with_</span></strong><span class="koboSpan" id="kobo.115.1">. </span><span class="koboSpan" id="kobo.115.2">But as of version 3.1.0 of Jinja, these modules have got built-in support and, hence, there is no need to load them </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">separately now.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.117.1">Next, mark some text that is</span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.118.1"> intended to be translated as per the language. </span><span class="koboSpan" id="kobo.118.2">Let’s start with the first text we see when we start our application, which is </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">home.html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.122.1">
{% block container %}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.123.1">
&lt;h1&gt;{{ _('Welcome to the Catalog Home') }}&lt;/h1&gt;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.124.1">
  &lt;a href="{{ url_for('catalog.products') }}"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.125.1">
    id="catalog_link"&gt;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.126.1">
  {{ _('Click here to see the catalog ') }}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.127.1">
  &lt;/a&gt;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.128.1">
{% endblock %}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.129.1">Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">_</span></strong><span class="koboSpan" id="kobo.131.1"> is a shortcut for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">gettext</span></strong><span class="koboSpan" id="kobo.133.1"> function provided by Babel to translate strings.</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.134.1">After this, run the following commands so that the marked text is actually available as translated text in our template when it is rendered in </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">the browser:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.136.1"> $ pybabel extract -F my_app/babel.cfg -o</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.137.1">   my_app/messages.pot my_app/</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.138.1">The preceding command traverses the content of the files. </span><span class="koboSpan" id="kobo.138.2">This command matches the patterns in </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">babel.cfg</span></strong><span class="koboSpan" id="kobo.140.1"> and picks out the texts that have been marked as translatable. </span><span class="koboSpan" id="kobo.140.2">All these texts are placed in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">my_app/messages.pot</span></strong><span class="koboSpan" id="kobo.142.1"> file. </span><span class="koboSpan" id="kobo.142.2">The following is the output of the preceding command:</span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.143.1">extracting messages from my_app/catalog/__init__.py</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.144.1">extracting messages from my_app/catalog/models.py</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.145.1">extracting messages from my_app/catalog/views.py</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.146.1">extracting messages from my_app/templates/404.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.147.1">extracting messages from my_app/templates/base.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.148.1">extracting messages from</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.149.1">  my_app/templates/categories.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.150.1">extracting messages from my_app/templates/category-</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.151.1">  create.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.152.1">extracting messages from</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.153.1">  my_app/templates/category.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.154.1">extracting messages from my_app/templates/home.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.155.1">extracting messages from my_app/templates/product-</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.156.1">  create.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.157.1">extracting messages from my_app/templates/product.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.158.1">extracting messages from</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.159.1">  my_app/templates/products.html</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.160.1">writing PO template file to my_app/messages.pot</span></strong></pre>
<ol>
<li value="6"><span class="koboSpan" id="kobo.161.1">Run the following </span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.162.1">command to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">.po</span></strong><span class="koboSpan" id="kobo.164.1"> file that will hold the translations for the texts to be </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">translated into:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.166.1">$ pybabel init -i my_app/messages.pot -d</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.167.1">  my_app/translations -l fr</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.168.1">This file is created in the specified folder, </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">my_app/translations</span></strong><span class="koboSpan" id="kobo.170.1">, as </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">fr/LC_MESSAGES/messages.po</span></strong><span class="koboSpan" id="kobo.172.1">. </span><span class="koboSpan" id="kobo.172.2">As we add more languages, more folders will be added.</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.173.1">Now, add translations to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">messages.po</span></strong><span class="koboSpan" id="kobo.175.1"> file. </span><span class="koboSpan" id="kobo.175.2">This can be performed manually, or we can use </span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.176.1">GUI tools such as Poedit (</span><a href="http://poedit.net/"><span class="koboSpan" id="kobo.177.1">http://poedit.net/</span></a><span class="koboSpan" id="kobo.178.1">). </span><span class="koboSpan" id="kobo.178.2">Using this tool, the translations will look as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer063">
<span class="koboSpan" id="kobo.180.1"><img alt="Figure 9.1 – Poedit screen while editing translations" src="image/B19111_09_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.181.1">Figure 9.1 – Poedit screen while editing translations</span></p>
<p><span class="koboSpan" id="kobo.182.1">Manually editing </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">messages.po</span></strong><span class="koboSpan" id="kobo.184.1"> will look as in the following code. </span><span class="koboSpan" id="kobo.184.2">Only one message translation is shown for demonstration purposes:</span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.185.1">#: my_app/catalog/models.py:75</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.186.1">msgid "Not a valid choice"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.187.1">msgstr "Pas un choix valable"</span></strong></pre>
<ol>
<li value="8"><span class="koboSpan" id="kobo.188.1">Save the </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">messages.po</span></strong><span class="koboSpan" id="kobo.190.1"> file after the translations have been incorporated and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.192.1">$ pybabel compile -d my_app/translations</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.193.1">This will create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">messages.mo</span></strong><span class="koboSpan" id="kobo.195.1"> file next to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">message.po</span></strong><span class="koboSpan" id="kobo.197.1"> file, which will be used by the application to</span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.198.1"> render the translated text.</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.199.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.200.1">Sometimes, the messages do not get compiled after running the preceding command. </span><span class="koboSpan" id="kobo.200.2">This is because the messages might be marked as fuzzy (starting with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">#</span></strong><span class="koboSpan" id="kobo.202.1"> symbol). </span><span class="koboSpan" id="kobo.202.2">These need to be looked into by a human, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">#</span></strong><span class="koboSpan" id="kobo.204.1"> sign has to be removed if the message is OK to be updated by the compiler. </span><span class="koboSpan" id="kobo.204.2">To bypass this check, add an </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">-f</span></strong><span class="koboSpan" id="kobo.206.1"> flag to the preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">compile</span></strong><span class="koboSpan" id="kobo.208.1"> command, as it will force everything to </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">be co</span><a id="_idTextAnchor478"/><span class="koboSpan" id="kobo.210.1">mpiled.</span></span></p>
<h2 id="_idParaDest-253"><a id="_idTextAnchor479"/><span class="koboSpan" id="kobo.211.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.212.1">If we run the application with French set as the primary language in the browser (or returned as the language of </span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.213.1">choice from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">get_locale()</span></strong><span class="koboSpan" id="kobo.215.1"> method), the home page will look as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer064">
<span class="koboSpan" id="kobo.217.1"><img alt="Figure 9.2 – Home page in French" src="image/B19111_09_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.218.1">Figure 9.2 – Home page in French</span></p>
<p><span class="koboSpan" id="kobo.219.1">If the primary language is set to a language other than French, then the content will be shown in English, which is the </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">default la</span><a id="_idTextAnchor480"/><span class="koboSpan" id="kobo.221.1">nguage.</span></span></p>
<h2 id="_idParaDest-254"><a id="_idTextAnchor481"/><span class="koboSpan" id="kobo.222.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.223.1">Next time, if there is a need to update the translations in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">messages.po</span></strong><span class="koboSpan" id="kobo.225.1"> file, we do not need to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">init</span></strong><span class="koboSpan" id="kobo.227.1"> command </span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.228.1">again. </span><span class="koboSpan" id="kobo.228.2">Instead, we can run an </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">update</span></strong><span class="koboSpan" id="kobo.230.1"> command, which is </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.232.1">
 $ pybabel update -i my_app/messages.pot -d
   my_app/translations</span></pre>
<p><span class="koboSpan" id="kobo.233.1">After this, run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">compile</span></strong><span class="koboSpan" id="kobo.235.1"> command </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">as usual.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.237.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.238.1">It is often preferable to change the language of a website based on the user IP and location (determined from the IP). </span><span class="koboSpan" id="kobo.238.2">However, this is, in general, less recommended than using the accept-language header as we did in </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">our appl</span><a id="_idTextAnchor482"/><span class="koboSpan" id="kobo.240.1">ication.</span></span></p>
<h2 id="_idParaDest-255"><a id="_idTextAnchor483"/><span class="koboSpan" id="kobo.241.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.242.1">Refer to the </span><em class="italic"><span class="koboSpan" id="kobo.243.1">Implementing the global language-switching action</span></em><span class="koboSpan" id="kobo.244.1"> recipe later in this chapter, which allows the user to change the language directly from the application rather than doing it at the </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">browser level.</span></span></p>
<p><span class="koboSpan" id="kobo.246.1">An important aspect of multiple languages is to be able to format the date, time, and currency accordingly. </span><span class="koboSpan" id="kobo.246.2">Babel also handles this pretty neatly. </span><span class="koboSpan" id="kobo.246.3">I urge you to try your hand at this. </span><span class="koboSpan" id="kobo.246.4">Refer to the Babel </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.247.1">documentation, available at </span><a href="http://babel.pocoo.org/en/latest/"><span class="koboSpan" id="kobo.248.1">http://babel.pocoo.org/en/latest/</span></a><span class="koboSpan" id="kobo.249.1">, </span><a id="_idTextAnchor484"/><span class="No-Break"><span class="koboSpan" id="kobo.250.1">for this.</span></span></p>
<h1 id="_idParaDest-256"><a id="_idTextAnchor485"/><span class="koboSpan" id="kobo.251.1">Implementing lazy evaluation and the gettext/ngettext functions</span></h1>
<p><span class="koboSpan" id="kobo.252.1">Lazy evaluation is an evaluation strategy</span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.253.1"> that delays the evaluation of an expression until its value is needed; that is, it is a call-when-needed mechanism. </span><span class="koboSpan" id="kobo.253.2">In our application, there can be several instances of texts that are evaluated later while rendering the template. </span><span class="koboSpan" id="kobo.253.3">This usually happens when we have texts that are marked as translatable outside the request context, so we defer the evaluation of these until they are </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">actual</span><a id="_idTextAnchor486"/><span class="koboSpan" id="kobo.255.1">ly </span></span><span class="No-Break"><a id="_idIndexMarker387"/></span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">needed.</span></span></p>
<h2 id="_idParaDest-257"><a id="_idTextAnchor487"/><span class="koboSpan" id="kobo.257.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.258.1">Let’s start with the application from the previous recipe. </span><span class="koboSpan" id="kobo.258.2">Now, we want the labels in the product and category creation forms to show the </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">transla</span><a id="_idTextAnchor488"/><span class="koboSpan" id="kobo.260.1">ted values.</span></span></p>
<h2 id="_idParaDest-258"><a id="_idTextAnchor489"/><span class="koboSpan" id="kobo.261.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.262.1">Follow these steps in order to implement the lazy evaluation </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">of translations:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.264.1">To mark all the field labels in the product and category forms as translatable, make the following changes </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">my_app/catalog/models.py</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.268.1">
from flask_babel import _</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.269.1">
class NameForm(FlaskForm):</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.270.1">
    name = StringField(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.271.1">
        _('Name'), validators=[InputRequired()])</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.272.1">
class ProductForm(NameForm):</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.273.1">
    price = DecimalField(_('Price'), validators=[</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.274.1">
        InputRequired(),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.275.1">
          NumberRange(min=Decimal('0.0'))</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.276.1">
    ])</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.277.1">
    category = CategoryField(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.278.1">
        _('Category'), validators=[InputRequired()],</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.279.1">
          coerce=int</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.280.1">
    )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.281.1">
    image = FileField(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.282.1">
        _('Product Image'),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.283.1">
          validators=[FileRequired()])</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.284.1">
class CategoryForm(NameForm):</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.285.1">
    name = StringField(_('Name'), validators=[</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.286.1">
        InputRequired(), check_duplicate_category()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.287.1">
    ])</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.288.1">Notice that all the field labels are enclosed within </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">_()</span></strong><span class="koboSpan" id="kobo.290.1"> to be marked for translation.</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.291.1">Now, run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">extract</span></strong><span class="koboSpan" id="kobo.293.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">update pybabel</span></strong><span class="koboSpan" id="kobo.295.1"> commands to update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">messages.po</span></strong><span class="koboSpan" id="kobo.297.1"> file, and then fill in</span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.298.1"> the relevant translations and run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">compile</span></strong><span class="koboSpan" id="kobo.300.1"> command. </span><span class="koboSpan" id="kobo.300.2">Refer to the previous recipe, </span><em class="italic"><span class="koboSpan" id="kobo.301.1">Adding a new language</span></em><span class="koboSpan" id="kobo.302.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">for details.</span></span></li>
<li><span class="koboSpan" id="kobo.304.1">Now, open the product creation page using the following link: </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">http://127.0.0.1:5000/product-create</span></strong><span class="koboSpan" id="kobo.306.1">. </span><span class="koboSpan" id="kobo.306.2">Does it work as expected? </span><span class="koboSpan" id="kobo.306.3">No! </span><span class="koboSpan" id="kobo.306.4">As most of us would have guessed by now, the reason for this behavior is that this text is marked for translation outside the </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">request context.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.308.1">To make this work, modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">import</span></strong><span class="koboSpan" id="kobo.310.1"> statement to the following:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.311.1">
from flask_babel import lazy_gettext as _</span></pre>
<ol>
<li value="4"><span class="koboSpan" id="kobo.312.1">Now, we have more text to translate. </span><span class="koboSpan" id="kobo.312.2">Let’s say we want to translate the product creation flash message content, which looks </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.314.1">
flash('The product %s has been created' % name)</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.315.1">To mark it as translatable, we cannot simply wrap the whole thing inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">_()</span></strong><span class="koboSpan" id="kobo.317.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.318.1">gettext()</span></strong><span class="koboSpan" id="kobo.319.1">. </span><span class="koboSpan" id="kobo.319.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.320.1">gettext()</span></strong><span class="koboSpan" id="kobo.321.1"> function </span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.322.1">supports placeholders, which can be used as </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">%(name)s</span></strong><span class="koboSpan" id="kobo.324.1">. </span><span class="koboSpan" id="kobo.324.2">Using this, the preceding</span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.325.1"> code will become something like this:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.326.1">
flash(_('The product %(name)s has been created',
  name=name), 'success')</span></pre>
<p><span class="koboSpan" id="kobo.327.1">The resulting translated text for this will be something like </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">La produit %(name)s a </span></strong><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">été créée</span></strong><span class="koboSpan" id="kobo.330.1">.</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.331.1">There may be cases where we need to manage the translations based on the number of items, that is, singular or plural names. </span><span class="koboSpan" id="kobo.331.2">This is handled by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">ngettext()</span></strong><span class="koboSpan" id="kobo.333.1"> method. </span><span class="koboSpan" id="kobo.333.2">Let’s take an </span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.334.1">example where we want to show the number of pages in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">products.html</span></strong><span class="koboSpan" id="kobo.336.1"> template. </span><span class="koboSpan" id="kobo.336.2">For this, add the </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.338.1">
{{ ngettext('%(num)d page', '%(num)d pages',</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.339.1">
  products.pages) }}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.340.1">Here, the template will render </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">page</span></strong><span class="koboSpan" id="kobo.342.1"> if there is only one page, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">pages</span></strong><span class="koboSpan" id="kobo.344.1"> if there is more than one page.</span></p>
<p><span class="koboSpan" id="kobo.345.1">It is interesting to note how this translation appears in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">messages.po</span></strong><span class="koboSpan" id="kobo.347.1"> file:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.348.1">
#: my_app/templates/products.html:20
#, python-format
msgid "%(num)d page"
msgid_plural "%(num)d pages"
msgstr[0] "%(num)d page"
msgstr[1] </span><a id="_idTextAnchor490"/><span class="koboSpan" id="kobo.349.1">"%(num)d pages"</span></pre>
<h2 id="_idParaDest-259"><a id="_idTextAnchor491"/><span class="koboSpan" id="kobo.350.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.351.1">Open the product creation form at </span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">http://127.0.0.1:5000/product-create</span></strong><span class="koboSpan" id="kobo.353.1">. </span><span class="koboSpan" id="kobo.353.2">The following screenshot shows how it would look with translation </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">to French:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer065">
<span class="koboSpan" id="kobo.355.1"><img alt="Figure 9.3 – Form fields translated using l﻿azy evaluation" src="image/B19111_09_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.356.1">Figure 9.3 – Form fields translated using l</span><a id="_idTextAnchor492"/><span class="koboSpan" id="kobo.357.1">azy evaluation</span></p>
<h1 id="_idParaDest-260"><a id="_idTextAnchor493"/><span class="koboSpan" id="kobo.358.1">Implementing the global language-switching action</span></h1>
<p><span class="koboSpan" id="kobo.359.1">In the previous recipes, we </span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.360.1">saw that the language changes based on the current language preferences in the browser. </span><span class="koboSpan" id="kobo.360.2">Now, however, we want a mechanism where we can switch the language being used, irrespective of the language in the browser. </span><span class="koboSpan" id="kobo.360.3">In this recipe, we will understand how to handle changing the language at the </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">app</span><a id="_idTextAnchor494"/><span class="koboSpan" id="kobo.362.1">lication level.</span></span></p>
<h2 id="_idParaDest-261"><a id="_idTextAnchor495"/><span class="koboSpan" id="kobo.363.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.364.1">We start by modifying the application from the last recipe, </span><em class="italic"><span class="koboSpan" id="kobo.365.1">Implementing lazy evaluation and the gettext/ngettext functions</span></em><span class="koboSpan" id="kobo.366.1">, to accommodate the changes to enable language switching. </span><span class="koboSpan" id="kobo.366.2">We will add an extra URL part to all our routes to allow us to add the current language. </span><span class="koboSpan" id="kobo.366.3">We can just change this language part in the URL in order to switch </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">bet</span><a id="_idTextAnchor496"/><span class="koboSpan" id="kobo.368.1">ween languages.</span></span></p>
<h2 id="_idParaDest-262"><a id="_idTextAnchor497"/><span class="koboSpan" id="kobo.369.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.370.1">Observe the following steps to understand how to implement language </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">switching globally:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.372.1">First, modify all the URL rules to </span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.373.1">accommodate an extra URL part. </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">@catalog.route('/')</span></strong><span class="koboSpan" id="kobo.375.1"> will become </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">@catalog.route('/&lt;lang&gt;/')</span></strong><span class="koboSpan" id="kobo.377.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">@catalog.route('/home')</span></strong><span class="koboSpan" id="kobo.379.1"> will become </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">@catalog.route('/&lt;lang&gt;/home')</span></strong><span class="koboSpan" id="kobo.381.1">. </span><span class="koboSpan" id="kobo.381.2">Similarly, </span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">@catalog.route('/product-search/&lt;int:page&gt;')</span></strong><span class="koboSpan" id="kobo.383.1"> will become </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">@catalog.route('/&lt;lang&gt;/product-search/&lt;int:page&gt;')</span></strong><span class="koboSpan" id="kobo.385.1">. </span><span class="koboSpan" id="kobo.385.2">The same needs to be done for all the </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">URL rules.</span></span></li>
<li><span class="koboSpan" id="kobo.387.1">Now, add a function that will add the language passed in the URL to the global proxy </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">object, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">g</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.391.1">
@app.before_request</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.392.1">
def before():</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.393.1">
    if request.view_args and 'lang' in</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.394.1">
      request.view_args:</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.395.1">
        g.current_lang = request.view_args['lang']</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.396.1">
        request.view_args.pop('lang')</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.397.1">This method will run before each request and add the current language to </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">g</span></strong><span class="koboSpan" id="kobo.399.1">.</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.400.1">However, this will mean that all the </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">url_for()</span></strong><span class="koboSpan" id="kobo.402.1"> calls in the application need to be modified so that an extra parameter called </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">lang</span></strong><span class="koboSpan" id="kobo.404.1"> can be passed. </span><span class="koboSpan" id="kobo.404.2">Fortunately, there is an easy way out of this, which is </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.406.1">
from flask import url_for as flask_url_for</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.407.1">
@app.context_processor</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.408.1">
def inject_url_for():</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.409.1">
    return {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.410.1">
        'url_for': lambda endpoint, **kwargs:</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.411.1">
          flask_url_for(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.412.1">
            endpoint, lang=g.get('current_lang',</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.413.1">
              'en'), **kwargs</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.414.1">
        )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.415.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.416.1">
url_for = inject_url_for()['url_for']</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.417.1">In the preceding code, we first imported </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">url_for</span></strong><span class="koboSpan" id="kobo.419.1"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">flask</span></strong><span class="koboSpan" id="kobo.421.1"> as </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">flask_url_for</span></strong><span class="koboSpan" id="kobo.423.1">. </span><span class="koboSpan" id="kobo.423.2">Then, we </span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.424.1">updated the application context processor to have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">url_for()</span></strong><span class="koboSpan" id="kobo.426.1"> function, which is a modified version of </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">url_for()</span></strong><span class="koboSpan" id="kobo.428.1"> provided by Flask in order to have </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">lang</span></strong><span class="koboSpan" id="kobo.430.1"> as an extra parameter. </span><span class="koboSpan" id="kobo.430.2">Also, we used the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">url_for()</span></strong><span class="koboSpan" id="kobo.432.1"> method that we u</span><a id="_idTextAnchor498"/><span class="koboSpan" id="kobo.433.1">sed in our views.</span></p>
<h2 id="_idParaDest-263"><a id="_idTextAnchor499"/><span class="koboSpan" id="kobo.434.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.435.1">Now, run the application as it is, and you will notice that all the URLs have a language part. </span><span class="koboSpan" id="kobo.435.2">The following two screenshots show what the rendered templates will </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">look like.</span></span></p>
<p><span class="koboSpan" id="kobo.437.1">For English, the following screenshot shows what the home page looks like after </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">opening </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">http://127.0.0.1:5000/en/home</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer066">
<span class="koboSpan" id="kobo.441.1"><img alt="Figure 9.4 – Home page in English" src="image/B19111_09_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.442.1">Figure 9.4 – Home page in English</span></p>
<p><span class="koboSpan" id="kobo.443.1">For French, just change</span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.444.1"> the URL to </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">http://127.0.0.1:5000/fr/home</span></strong><span class="koboSpan" id="kobo.446.1">, and the home page will look </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer067">
<span class="koboSpan" id="kobo.448.1"><img alt="Figure 9.5 – Home page in French" src="image/B19111_09_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.449.1">Figure 9.5 – Home page in French</span></p>
<h2 id="_idParaDest-264"><a id="_idTextAnchor500"/><span class="koboSpan" id="kobo.450.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.451.1">There is more to l10n than just translating alphabetical languages. </span><span class="koboSpan" id="kobo.451.2">Different geographies follow different formats for numbers, decimals, currencies, and so on. </span><span class="koboSpan" id="kobo.451.3">For example, 1.5 million USD would be written as 1,5 Mio USD in Dutch, and 123.56 in English would be written as 123,56 </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">in French.</span></span></p>
<p><span class="koboSpan" id="kobo.453.1">Babel makes it very easy to</span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.454.1"> implement this kind of formatting. </span><span class="koboSpan" id="kobo.454.2">There is a whole suite of methods available for this purpose. </span><span class="koboSpan" id="kobo.454.3">Some </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">examples follow:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.456.1">
&gt;&gt;&gt; from babel import numbers
&gt;&gt;&gt; numbers.format_number(12345, 'en_US')
'12,345'
&gt;&gt;&gt; numbers.format_number(12345, 'fr_FR')
'12\u202f345'
&gt;&gt;&gt; numbers.format_number(12345, 'de_DE')
'12.345'
&gt;&gt;&gt; numbers.format_decimal(12.345, locale='de_DE')
'12,345'
&gt;&gt;&gt; numbers.format_decimal(12.345, locale='en_US')
'12.345'
&gt;&gt;&gt; numbers.format_currency(12.345, 'USD', locale='en_US')
'$12.34'
&gt;&gt;&gt; numbers.format_currency(12345789, 'USD', locale='en_US')
'$12,345,789.00'
&gt;&gt;&gt; numbers.format_compact_currency(12345789, 'USD', locale='de_DE')
'12\xa0Mio.\xa0$'
&gt;&gt;&gt; numbers.format_compact_currency(12345789, 'USD', locale='en_US')
'$12M'</span></pre>
<p><span class="koboSpan" id="kobo.457.1">You can read more about </span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.458.1">this </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">at </span></span><a href="https://babel.pocoo.org/en/latest/api/numbers.html#module-babel.numbers"><span class="No-Break"><span class="koboSpan" id="kobo.460.1">https://babel.pocoo.org/en/latest/api/numbers.html#module-babel.numbers</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.461.1">.</span></span></p>
</div>


<div class="Content" id="_idContainer069">
<h1 id="_idParaDest-265"><a id="_idTextAnchor501"/><span class="koboSpan" id="kobo.1.1">Part 3: Advanced Flask</span></h1>
<p><span class="koboSpan" id="kobo.2.1">Once the web applications are built in Flask, the next question concerns how to test applications, followed by deployment, and finally, maintaining them. </span><span class="koboSpan" id="kobo.2.2">This final part of this book covers these important topics. </span><span class="koboSpan" id="kobo.2.3">This is where the book moves from being completely development-oriented to focusing on </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">post-development activities.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">It is very important to test an application by writing unit tests, which allow for the introspection of code that has been written and also preemptively identifies any issues that might creep into further development of features. </span><span class="koboSpan" id="kobo.4.2">Once the application is built, you will want to measure the performance of the application in terms of clear metrics. </span><a href="B19111_10.xhtml#_idTextAnchor502"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.5.1">Chapter 10</span></em></span></a><span class="koboSpan" id="kobo.6.1"> deals with these topics, </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">among others.</span></span></p>
<p><span class="koboSpan" id="kobo.8.1">The next couple of chapters focus on various tools and techniques that can be leveraged to deploy a Flask web application on different platforms, ranging from cloud-native services to bare shell servers. </span><span class="koboSpan" id="kobo.8.2">You will read about how to use state-of-the-art technologies such as Docker and Kubernetes to effectively deploy your </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">web applications.</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">A new chapter on GPT has been added, which talks about how to integrate this cutting-edge technology with Flask for some popular use cases, and how to make your applications future-ready </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">with AI.</span></span></p>
<p><span class="koboSpan" id="kobo.12.1">The final chapter is a collection of additional tips and tricks that can be used anywhere, based on specific use cases. </span><span class="koboSpan" id="kobo.12.2">There are many more such topics, but I have covered the ones that I have dealt with </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">most frequently.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">This part of the book comprises the </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">following chapters:</span></span></p>
<ul>
<li><a href="B19111_10.xhtml#_idTextAnchor502"><em class="italic"><span class="koboSpan" id="kobo.16.1">Chapter 10</span></em></a><em class="italic"><span class="koboSpan" id="kobo.17.1">, Debugging, Error Handling, and Testing</span></em></li>
<li><em class="italic"><span class="koboSpan" id="kobo.18.1">Chapter 11, Deployment and Post-Deployment</span></em></li>
<li><a href="B19111_12.xhtml#_idTextAnchor675"><em class="italic"><span class="koboSpan" id="kobo.19.1">Chapter 12</span></em></a><em class="italic"><span class="koboSpan" id="kobo.20.1">, Microservices and Containers</span></em></li>
<li><a href="B19111_13.xhtml#_idTextAnchor721"><em class="italic"><span class="koboSpan" id="kobo.21.1">Chapter 13</span></em></a><em class="italic"><span class="koboSpan" id="kobo.22.1">, GPT with Flask</span></em></li>
<li><a href="B19111_14.xhtml#_idTextAnchor758"><em class="italic"><span class="koboSpan" id="kobo.23.1">Chapter 14</span></em></a><em class="italic"><span class="koboSpan" id="kobo.24.1">, Additional Tips and Tricks</span></em></li>
</ul>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer070">
</div>
</div>
<div>
<div id="_idContainer071">
</div>
</div>
</body></html>