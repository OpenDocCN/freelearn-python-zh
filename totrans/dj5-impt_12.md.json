["```py\n from django.urls import path\nfrom . import views\nurlpatterns = [\n    path('', views.index, name='cart.index'),\n    path('<int:id>/add/', views.add, name='cart.add'),\n    path('clear/', views.clear, name='cart.clear'), <st c=\"1802\">path('purchase/', views.purchase,</st>\n <st c=\"1835\">name='cart.purchase'),</st> ]\n```", "```py\n …\nfrom movies.models import Movie\nfrom .utils import calculate_cart_total <st c=\"2172\">from .models import Order, Item</st>\n<st c=\"2203\">from django.contrib.auth.decorators import login_required</st> … <st c=\"2263\">@login_required</st>\n<st c=\"2278\">def purchase(request):</st>\n <st c=\"2301\">cart = request.session.get('cart', {})</st>\n <st c=\"2340\">movie_ids = list(cart.keys())</st>\n <st c=\"2370\">if (movie_ids == []):</st>\n <st c=\"2392\">return redirect('cart.index')</st>\n <st c=\"2422\">movies_in_cart = Movie.objects.filter(id__in=movie_ids)</st>\n <st c=\"2478\">cart_total = calculate_cart_total(cart, movies_in_cart)</st>\n <st c=\"2534\">order = Order()</st>\n <st c=\"2550\">order.user = request.user</st>\n <st c=\"2576\">order.total = cart_total</st>\n <st c=\"2601\">order.save()</st>\n <st c=\"2614\">for movie in movies_in_cart:</st>\n <st c=\"2643\">item = Item()</st>\n <st c=\"2657\">item.movie = movie</st>\n <st c=\"2676\">item.price = movie.price</st>\n <st c=\"2701\">item.order = order</st>\n <st c=\"2720\">item.quantity = cart[str(movie.id)]</st>\n**<st c=\"2756\">item.save()</st>**\n **<st c=\"2768\">request.session['cart'] = {}</st>**\n **<st c=\"2797\">template_data = {}</st>**\n **<st c=\"2816\">template_data['title'] = 'Purchase confirmation'</st>**\n **<st c=\"2865\">template_data['order_id'] = order.id</st>**\n **<st c=\"2902\">return render(request, 'cart/purchase.html',</st>**\n **<st c=\"2947\">{'template_data': template_data})</st>**\n```", "```py\n …\n        <a class=\"btn btn-outline-secondary mb-2\">\n          <b>Total to pay:</b> ${{ template_data.cart_total\n        }}</a>\n        {% if template_data.movies_in_cart|length > 0 %} <st c=\"6108\"><a href=\"{% url 'cart.purchase' %}\"</st>\n <st c=\"6143\">class=\"btn bg-dark text-white mb-2\">Purchase</st><st c=\"6188\"></a></st> <a href=\"{% url 'cart.clear' %}\">\n          <button class=\"btn btn-danger mb-2\">\n            Remove all movies from Cart\n          </button>\n        </a>\n        {% endif %}\n        …\n```", "```py\n {% extends 'base.html' %}\n{% block content %}\n<div class=\"p-3\">\n  <div class=\"container\">\n    <div class=\"row mt-3\">\n      <div class=\"col mx-auto mb-3\">\n        <h2>Purchase Completed</h2>\n        <hr />\n        <p>Congratulations, purchase completed. Order\n          number is: <b>#{{ template_data.order_id }}</b>\n        </p>\n      </div>\n    </div>\n  </div>\n</div>\n{% endblock content %}\n```", "```py\n from django.urls import path\nfrom . import views\nurlpatterns = [\n    path('signup', views.signup, name='accounts.signup'),\n    path('login/', views.login, name='accounts.login'),\n    path('logout/', views.logout, name='accounts.logout'), <st c=\"8813\">path('orders/', views.orders, name='accounts.orders'),</st> ]\n```", "```py\n …\nfrom django.shortcuts import redirect\nfrom django.contrib.auth.decorators import login_required <st c=\"9200\">from django.contrib.auth.models import User</st> … <st c=\"9245\">@login_required</st>\n<st c=\"9260\">def orders(request):</st>\n**<st c=\"9281\">template_data = {}</st>**\n **<st c=\"9300\">template_data['title'] = 'Orders'</st>**\n **<st c=\"9334\">template_data['orders'] = request.user.order_set.all()</st>**\n **<st c=\"9389\">return render(request, 'accounts/orders.html',</st>**\n **<st c=\"9436\">{'template_data': template_data})</st>**\n```", "```py\n {% extends 'base.html' %}\n{% block content %}\n<div class=\"p-3\">\n  <div class=\"container\">\n    <div class=\"row mt-3\">\n      <div class=\"col mx-auto mb-3\">\n        <h2>My Orders</h2>\n        <hr />\n        {% for order in template_data.orders %}\n        <div class=\"card mb-4\">\n          <div class=\"card-header\">\n            Order #{{ order.id }}\n          </div>\n          <div class=\"card-body\">\n            <b>Date:</b> {{ order.date }}<br />\n            <b>Total:</b> ${{ order.total }}<br />\n            <table class=\"table table-bordered\n              table-striped text-center mt-3\">\n              <thead>\n                <tr>\n                  <th scope=\"col\">Item ID</th>\n                  <th scope=\"col\">Movie</th>\n                  <th scope=\"col\">Price</th>\n                  <th scope=\"col\">Quantity</th>\n                </tr>\n              </thead>\n              <tbody>\n                {% for item in order.item_set.all %}\n                <tr>\n                  <td>{{ item.movie.id }}</td>\n                  <td>\n                    <a class=\"link-dark\"\n                      href=\"{% url 'movies.show'\n                      id=item.movie.id %}\">\n                      {{ item.movie.name }}\n                    </a>\n                  </td>\n                  <td>${{ item.movie.price }}</td>\n                  <td>{{ item.quantity }}</td>\n                </tr>\n                {% endfor %}\n              </tbody>\n            </table>\n          </div>\n        </div>\n        {% endfor %}\n      </div>\n    </div>\n  </div>\n</div>\n{% endblock content %}\n```", "```py\n …\n            {% if user.is_authenticated %} <st c=\"12031\"><a class=\"nav-link\"</st>\n <st c=\"12050\">href=\"{% url 'accounts.orders' %}\">Orders</st><st c=\"12092\"></a></st> <a class=\"nav-link\"\n              href=\"{% url 'accounts.logout' %}\">Logout\n              ({{ user.username }})\n            </a>\n            {% else %}\n            <a class=\"nav-link\"\n              href=\"{% url 'accounts.login' %}\">Login\n            </a>\n            <a class=\"nav-link\"\n              href=\"{% url 'accounts.signup' %}\">Sign Up\n            </a>\n            {% endif %}\n            …\n```"]