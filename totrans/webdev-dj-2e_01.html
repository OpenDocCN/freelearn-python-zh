<html><head></head><body>
		<div>
			<div id="_idContainer029" class="Content">
			</div>
		</div>
		<div id="_idContainer030" class="Content">
			<h1 id="_idParaDest-25"><a id="_idTextAnchor024"/>1. Introduction to Django</h1>
		</div>
		<div id="_idContainer084" class="Content">
			<p class="callout-heading">Overview</p>
			<p class="callout">This chapter introduces you to Django and its role in web development. You will begin by learning how the <strong class="bold">Model View Template</strong> (<strong class="bold">MVT</strong>) paradigm works and how Django processes HTTP <strong class="bold">requests</strong> and <strong class="bold">responses</strong>. Equipped with the basic concepts, you'll create your first Django project, called <strong class="bold">Bookr</strong>, an application for adding, viewing, and managing book reviews. It's an application you'll keep enhancing and adding features to throughout this book. You will then learn about the <strong class="source-inline">manage.py</strong> command (used to orchestrate Django actions). You will use this command to start the Django development server and test whether the code you've written works as expected. You will also learn how to work with <strong class="bold">PyCharm</strong>, a popular Python IDE that you'll be using throughout this book. You will use it to write code that returns a <strong class="bold">response</strong> to your web browser. Finally, you'll learn how to use PyCharm's debugger to troubleshoot problems with your code. By the end of this chapter, you'll have the necessary skills to start creating projects using Django.</p>
			<h1 id="_idParaDest-26"><a id="_idTextAnchor025"/>Introduction</h1>
			<p><em class="italic">"The web framework for perfectionists with deadlines."</em> It's a tagline that aptly describes Django, a framework that has been around for over 10 years now. It is battle-tested and widely used, with more and more people using it every day. All this might make you think that Django is old and no longer relevant. On the contrary, its longevity has proved that its Application Programming Interface (API) is reliable and consistent, and even those who learned Django v1.0 in 2007 can mostly write the same code for Django 3 today. Django is still in active development, with bugfixes and security patches being released monthly.</p>
			<p>Like Python, the language in which it is written, Django is easy to learn, yet powerful and flexible enough to grow with your needs. It is a "batteries-included" framework, which is to say that you do not have to find and install many other libraries or components to get your application up and running. Other frameworks, such as <strong class="bold">Flask</strong> or <strong class="bold">Pylons</strong>, require manually installing third-party frameworks for database connections or template rendering. Instead, Django has built-in support for database querying, URL mapping, and template rendering (we'll go into detail on what these mean soon). But just because Django is easy to use doesn't mean it is limited. Django is used by many large sites, including Disqus (<a href="https://disqus.com/">https://disqus.com/</a>), Instagram (<a href="https://www.instagram.com/">https://www.instagram.com/</a>), Mozilla (<a href="https://www.mozilla.org/">https://www.mozilla.org/</a>), Pinterest (<a href="https://www.pinterest.com/">https://www.pinterest.com/</a>), Open Stack (<a href="https://www.openstack.org/">https://www.openstack.org/</a>), and National Geographic (<a href="http://www.nationalgeographic.com/">http://www.nationalgeographic.com/</a>). </p>
			<p>Where does Django fit into the web? When talking about web frameworks, you might think of frontend JavaScript frameworks such as ReactJS, Angular, or Vue. These frameworks are used to enhance or add interactivity to already-generated web pages. Django sits in the layer beneath these tools and instead is responsible for routing a URL, fetching data from databases, rendering templates, and handling form input from users. However, this does not mean you must pick one or the other; JavaScript frameworks can be used to enhance the output from Django, or to interact with a REST API generated by Django.</p>
			<p>In this book, we will build a Django project using the methods that professional Django developers use every day. The application is called <strong class="bold">Bookr</strong>, and it allows browsing and adding books and book reviews. This book is divided into four sections. In the first section, we'll start with the basics of scaffolding a Django app and quickly build some pages and serve them with the Django development server. You'll be able to add data to the database using the Django admin site.</p>
			<p>The next section focuses on adding enhancements to Bookr. You'll serve static files to add styles and images to the site. By using Django's <strong class="source-inline">form</strong> library, you'll add interactivity, and by using file uploads, you will be able to upload book covers and other files. You'll then implement user login and learn how to store information about the current user in the session.</p>
			<p>In section three, you'll build on your existing knowledge and move to the next level of development. You'll customize the Django admin site and then learn about advanced templating. Next, you'll learn how to build a <strong class="bold">REST API</strong> and generate non-HTML data (such as CSVs and PDFs), and you'll finish the section by learning about testing Django.</p>
			<p>Many third-party libraries are available to add functionality to Django and to make development easier and thus save time. In the final section, you'll learn about some of the useful ones and how to integrate them into your application. Applying this knowledge, you'll integrate a JavaScript library to communicate with the REST framework you built in the previous section. Finally, you'll learn how to deploy your Django application to a virtual server.</p>
			<p>By the end of the book, you will have enough experience to design and build your own Django project from start to finish.</p>
			<h1 id="_idParaDest-27"><a id="_idTextAnchor026"/>Scaffolding a Django Project and App</h1>
			<p>Before diving deep into the theory behind Django paradigms and HTTP requests, we'll show you how easy it is to get a Django project up and running. After this first section and exercise, you will have created a Django project, made a request to it with your browser, and seen the response.</p>
			<p>A Django project is a directory that contains all the data for your project: code, settings, templates, and assets. It is created and scaffolded by running the <strong class="source-inline">django-admin.py</strong> command on the command line with the <strong class="source-inline">startproject</strong> argument and providing the project name. For example, to create a Django project with the name <strong class="source-inline">myproject</strong>, the command that is run is this:</p>
			<p class="source-code">django-admin.py startproject myproject</p>
			<p>This will create the <strong class="source-inline">myproject</strong> directory, which Django populates with the necessary files to run the project. Inside the <strong class="source-inline">myproject</strong> directory are two files (shown in <em class="italic">Figure 1.1</em>):</p>
			<div>
				<div id="_idContainer031" class="IMG---Figure">
					<img src="image/B15509_01_01.jpg" alt="Figure 1.1: Project directory for myproject&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.1: Project directory for myproject</p>
			<p><strong class="source-inline">manage.py</strong> is a Python script that is executed at the command line to interact with your project. We will use it to start the <strong class="bold">Django dev server</strong>, a development web server you will use to interact with your Django project on your local computer. Like <strong class="source-inline">django-admin.py</strong>, commands are passed in on the command line. Unlike <strong class="source-inline">django-admin.py</strong>, this script is not mapped in your system path, so we must execute it using Python. We will need to use the command line to do that. For example, inside the project directory, run the following command:</p>
			<p class="source-code">python3 manage.py runserver</p>
			<p>This passes the <strong class="source-inline">runserver</strong> command to the <strong class="source-inline">manage.py</strong> script, which starts the Django dev server. We will examine more of the commands that <strong class="source-inline">manage.py</strong> accepts in the <em class="italic">Django Project</em> section. When interacting with <strong class="source-inline">manage.py</strong> in this way, we call these management commands. For example, we might say that we are <em class="italic">"executing the runserver management command."</em></p>
			<p>The <strong class="source-inline">startproject</strong> command also created a directory with the same name as the project, in this case, <strong class="source-inline">myproject</strong> (<em class="italic">Figure 1.1</em>). This is a Python package that contains settings and some other configuration files that your project needs to run. We will examine its contents in the <em class="italic">Django Project</em> section.</p>
			<p>After starting the Django project, the next thing to do is to start a Django app. We should try to segregate our Django project into different apps, grouped by functionality. For example, with Bookr, we will have a <strong class="source-inline">reviews</strong> app. This will hold all the code, HTML, assets, and database classes specific to working with book reviews. If we decided to expand Bookr to sell books as well, we might add a <strong class="source-inline">store</strong> application, containing the files for the bookstore. Apps are created with the <strong class="source-inline">startapp</strong> management command, passing in the application name. For example:</p>
			<p class="source-code">python3 manage.py startapp myapp</p>
			<p>This creates the app directory (<strong class="source-inline">myapp</strong>) inside the project directory. Django automatically populates this with files for the app that are ready to be filled in when you start developing. We'll examine these files and discuss what makes a good app in the <em class="italic">Django Apps</em> section.</p>
			<p>Now that we've introduced the basic commands to scaffold a Django project and application, let's put them into practice by starting the Bookr project in the first exercise of this book.</p>
			<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/>Exercise 1.01: Creating a Project and App, and Starting the Dev Server </h2>
			<p>Throughout this book, we will be building a book review website named Bookr. It will allow you to add fields for publishers, contributors, books, and reviews. A publisher will publish one or more books, and each book will have one or more contributors (author, editor, co-author, and so on). Only admin users will be allowed to modify these fields. Once a user has signed up for an account on the site, they will be able to start adding reviews to a book.</p>
			<p>In this exercise, you will scaffold the <strong class="source-inline">bookr</strong> Django project, test that Django is working by running the dev server, then create the <strong class="source-inline">reviews</strong> Django app.</p>
			<p>You should already have a virtual environment set up with Django installed. To learn how to do that, you can refer to the <em class="italic">Preface</em>. Once you're ready, let's start by creating the Bookr project:</p>
			<ol>
				<li>Open a Terminal and run the following command to create the <strong class="source-inline">bookr</strong> project directory and the default subfolders:<p class="source-code">django-admin startproject bookr</p><p>This command does not generate any output but will create a folder called <strong class="source-inline">bookr</strong> inside the directory in which you ran the command. You can look inside this directory and see the items we described before for the <strong class="source-inline">myproject</strong> example: the <strong class="source-inline">bookr</strong> package directory and <strong class="source-inline">manage.py</strong> file.</p></li>
				<li>We can now test that the project and Django are set up correctly by running the Django dev server. Starting the server is done with the <strong class="source-inline">manage.py</strong> script.<p>In your Terminal (or Command Prompt), change into the <strong class="source-inline">bookr</strong> project directory (using the <strong class="source-inline">cd</strong> command), then run the <strong class="source-inline">manage.py runserver</strong> command.</p><p class="source-code"><strong class="bold">python3</strong> manage.py runserver</p><p class="callout-heading">Note</p><p class="callout">On Windows, you may need to run replace <strong class="source-inline">python3</strong> (highlighted) with just <strong class="source-inline">python</strong> to make the command work every time you run it.</p><p>This command starts the Django dev server. You should get output similar to the following:</p><p class="source-code">Watching for file changes with StatReloader</p><p class="source-code">Performing system checks...</p><p class="source-code">System check identified no issues (0 silenced).</p><p class="source-code">You have 17 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.</p><p class="source-code">Run 'python manage.py migrate' to apply them.</p><p class="source-code">September 14, 2019 - 09:40:45</p><p class="source-code">Django version 3.0a1, using settings 'bookr.settings'</p><p class="source-code">Starting development server at http://127.0.0.1:8000/</p><p class="source-code">Quit the server with CONTROL-C.</p><p>You will probably have some warnings about unapplied migrations, but that's okay for now.</p></li>
				<li>Open up a web browser and go to <strong class="source-inline">http://127.0.0.1:8000/</strong>, which will show you the Django welcome screen (<em class="italic">Figure 1.2</em>). If you see this, you know your Django project was created successfully and it all is working fine for now:<div id="_idContainer032" class="IMG---Figure"><img src="image/B15509_01_02.jpg" alt="Figure 1.2: Django welcome screen&#13;&#10;"/></div><p class="figure-caption">Figure 1.2: Django welcome screen</p></li>
				<li>Go back to your Terminal and stop the development server running using the <em class="italic">Ctrl</em> + <em class="italic">C</em> key combination.</li>
				<li>We'll now create the <strong class="source-inline">reviews</strong> app for the <strong class="source-inline">bookr</strong> project. In your Terminal, make sure you are in the <strong class="source-inline">bookr</strong> project directory, then execute the following command to create the <strong class="source-inline">reviews</strong> app:<p class="source-code">python3 manage.py startapp reviews</p><p class="callout-heading">Note</p><p class="callout">After creating the <strong class="source-inline">reviews</strong> app, the files in your <strong class="source-inline">bookr</strong> project directory would look like this: <a href="http://packt.live/3nZGy5D">http://packt.live/3nZGy5D</a>.</p><p>There is no output if the command was successful, but a <strong class="source-inline">reviews</strong> app directory has been created. You can look inside this directory to see the files that were created: the <strong class="source-inline">migrations</strong> directory, <strong class="source-inline">admin.py</strong>, <strong class="source-inline">models.py</strong>, and so on. We'll examine these in detail in the <em class="italic">Django Apps</em> section. </p></li>
			</ol>
			<p>In this exercise, we created the <strong class="source-inline">bookr</strong> project, tested that the project was working by starting the Django dev server, then created the <strong class="source-inline">reviews</strong> app for the project. Now that we've had some hands-on time with a Django project, we'll return to some of the theory behind Django's design and HTTP requests and responses. </p>
			<h1 id="_idParaDest-29"><a id="_idTextAnchor028"/>Model View Template</h1>
			<p>A common design pattern in application design is <strong class="bold">Model View Controller</strong> (<strong class="bold">MVC</strong>), where the model of the application (its data) is displayed in one or more views and a controller marshals interaction between the model and view. Django follows a somewhat similar paradigm called <strong class="bold">Model View Template</strong> (<strong class="bold">MVT</strong>).</p>
			<p>Like MVC, MVT also uses models for storing data. However, with MVT, a view will query a model and then render it with a template. Usually, with MVC languages, all three components need to be developed with the same language. With MVT, the template can be in a different language. In the case of Django, the models and views are written in Python and the Template in HTML. This means that a Python developer could work on the models and views, while a specialist HTML developer works on the HTML. We'll first explain models, views, and templates in more detail, and then look at some example scenarios where they are used.</p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>Models</h2>
			<p>Django models define the data for your application and provide an abstraction layer to SQL database access through an <strong class="bold">Object Relational Mapper</strong> (<strong class="bold">ORM</strong>). An ORM lets you define your data schema (classes, fields, and their relationships) using Python code, without needing an understanding of the underlying database. This means you can define your database layer in Python code and Django will take care of generating SQL queries for you. ORMs will be discussed in detail in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout"><strong class="bold">SQL</strong> stands for <strong class="bold">Structured Query Language</strong> and is a way of describing a type of database that stores its data in tables, with each table having several rows. Think of each table being like an individual spreadsheet. Unlike a spreadsheet, though, relationships can be defined between the data in each table. You can interact with data by executing SQL queries (often referred to as just queries when talking about databases). Queries allow you to retrieve data (<strong class="source-inline">SELECT</strong>), add or change data (<strong class="source-inline">INSERT</strong> and <strong class="source-inline">UPDATE</strong> respectively), and remove data (<strong class="source-inline">DELETE</strong>). There are many SQL database servers to choose from, such as SQLite, PostgreSQL, MySQL, or Microsoft SQL Server. Much of the SQL syntax is similar between databases, but there can be some differences in dialect. Django's ORM takes care of these differences for you: when we start coding, we will use the SQLite database to store data on disk, but later when we deploy to a server, we will switch to PostgreSQL but won't need to make any code changes.</p>
			<p>Normally, when querying a database, the results come back as primitive Python objects, (for example, lists of strings, integers, floats, or bytes). When using the ORM, results are automatically converted into instances of the model classes you have defined. Using an ORM means that you are automatically protected from a type of vulnerability known as a SQL injection attack.</p>
			<p>If you're more familiar with databases and SQL, you always have the option of writing your own queries too. </p>
			<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/>Views</h2>
			<p>A Django view is where most of the logic for your application is defined. When a user visits your site, their web browser will send a request to retrieve data from your site (in the next section, we will go into more detail on what an HTTP request is and what information it contains). A view is a function that you write that will receive this request in the form of a Python object (specifically, a Django <strong class="source-inline">HttpRequest</strong> object). It is up to your view to decide how it should respond to the request and what it should send back to the user. Your view must return an <strong class="source-inline">HttpResponse</strong> object that encapsulates all the information being provided to the client: content, HTTP status, and other headers.</p>
			<p>The view can also optionally receive information from the URL of the request, for example, an ID number. A common design pattern of a view is to query a database via the Django ORM using an ID that is passed into your view. Then the view can render a template (more on this in a moment) by providing it with data from the model retrieved from the database. The rendered template becomes the content of <strong class="source-inline">HttpResponse</strong> and is returned from the view function. Django takes care of the communication of the data back to the browser.</p>
			<h2 id="_idParaDest-32"><a id="_idTextAnchor031"/>Templates</h2>
			<p>A template is a <strong class="bold">HyperText Markup Language</strong> (<strong class="bold">HTML</strong>) file (usually – any text file can be a template) that contains special placeholders that are replaced by variables your application provides. For example, your application could render a list of items in either a gallery layout or a table layout. Your view would fetch the same models for either one but would be able to render a different HTML file with the same information to present the data differently. Django emphasizes safety, so it will take care of automatically escaping variables for you. For example, the <strong class="source-inline">&lt;</strong> and <strong class="source-inline">&gt;</strong> symbols (among others) are special characters in HTML. If you try to use them in a variable, then Django automatically encodes them so they render correctly in a browser.</p>
			<h3 id="_idParaDest-33"><a id="_idTextAnchor032"/>MVT in Practice</h3>
			<p>We'll now look at some examples to illustrate how MVT works in practice. In the examples, we have a <strong class="source-inline">Book</strong> model that stores information about different books, and a <strong class="source-inline">Review</strong> model that stores information about different reviews of the books.</p>
			<p>In the first example, we want to be able to edit the information about a book or review. Take the first scenario, editing a book's details. We would have a view to fetch the <strong class="source-inline">Book</strong> data from the database and provide the <strong class="source-inline">Book</strong> model. Then, we would pass context information containing the <strong class="source-inline">Book</strong> object (and other data) to a template that would show a form to capture the new information. The second scenario (editing a review) is similar: fetch a <strong class="source-inline">Review</strong> model from the database, then pass the <strong class="source-inline">Review</strong> object and other data to a template to display an edit form. These scenarios might be so similar that we can reuse the same template for both. Refer to <em class="italic">Figure 1.3</em>.</p>
			<div>
				<div id="_idContainer033" class="IMG---Figure">
					<img src="image/B15509_01_03.jpg" alt="Figure 1.3: Editing a single book or review&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.3: Editing a single book or review</p>
			<p>You can see here that we use two models, two views, and one template. Each view fetches a single instance of its associated model, but they can both use the same template, which is a generic HTML page to display a form. The views can provide extra context data to slightly alter the display of the template for each model type. Also illustrated in the diagram are the parts of the code that are written in Python and those that are written in HTML.</p>
			<p>In the second example, we want to be able to show the user a list of the books or reviews that are stored in the application. Furthermore, we want to allow the user to search for books and get a list of all that match their criteria. We will use the same two models as the previous example (<strong class="source-inline">Book</strong> and <strong class="source-inline">Review</strong>), but we will create new views and templates. Since there are three scenarios, we'll use three views this time: the first fetches all books, the second fetches all reviews, and the last searches for books based on some search criteria. Once again, if we write a template well, we might be able to just use a single HTML template again. Refer to <em class="italic">Figure 1.4</em>:</p>
			<div>
				<div id="_idContainer034" class="IMG---Figure">
					<img src="image/B15509_01_04.jpg" alt="Figure 1.4: Viewing multiple books or reviews&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.4: Viewing multiple books or reviews</p>
			<p>The <strong class="source-inline">Book</strong> and <strong class="source-inline">Review</strong> models remain unchanged from the previous example. The three views will fetch many (zero or more) books or reviews. Then, each view can use the same template, which is a generic HTML file that iterates over a list of objects that it is given and renders them. Once again, the views can send extra data in the context to alter how the template behaves, but the majority of the template will be as generic as possible.</p>
			<p>In Django, a model does not always need to be used to render an HTML template. A view can generate the context data itself and render a template with it, without requiring any model data. See <em class="italic">Figure 1.5</em> for a view sending data straight to a template:</p>
			<div>
				<div id="_idContainer035" class="IMG---Figure">
					<img src="image/B15509_01_05.jpg" alt="Figure 1.5: From view to template without a model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.5: From view to template without a model</p>
			<p>In this example, there is a welcome view to welcome a user to the site. It doesn't need any information from the database, so it can just generate the context data itself. The context data depends on the type of information you want to display; for example, you could pass the user information to greet them by name if they are logged in. It is also possible for a view to render a template without any context data. This can be useful if you have static information in an HTML file that you want to serve.</p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/>Introduction to HTTP</h2>
			<p>Now that you have been introduced to MVT in Django, we can look at how Django processes an HTTP request and generates an HTTP response. But first, we need to explain in more detail what HTTP requests and responses are, and what information they contain. </p>
			<p>Let's say someone wants to visit your web page. They type in its URL or click a link to your site from a page they are already on. Their web browser creates an HTTP request, which is sent to the server hosting your website. Once a web server receives the HTTP request from your browser, it can interpret it and then send back a response. The response that the server sends might be simple, such as just reading an HTML or image file from disk and sending it. Or, the response might be more complex, maybe using server-side software (such as Django) to dynamically generate the content before sending it:</p>
			<div>
				<div id="_idContainer036" class="IMG---Figure">
					<img src="image/B15509_01_06.jpg" alt="Figure 1.6: HTTP request and HTTP response&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.6: HTTP request and HTTP response</p>
			<p>The request is made up of four main parts: the method, path, headers, and body. Some types of requests don't have a body. If you just visit a web page, your browser will not send a body, whereas if you are submitting a form (for example, by logging into a site or performing a search), then your request will have a body containing the data you're submitting. We'll look at two example requests now to illustrate this.</p>
			<p>The first request will be to an example page with the URL <strong class="source-inline">https://www.example.com/page</strong>. When your browser visits that page, behind the scenes, this is what it's sending:</p>
			<p class="source-code">GET /page HTTP/1.1</p>
			<p class="source-code">Host: www.example.com</p>
			<p class="source-code">User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:15.0) Firefox/15.0.1</p>
			<p class="source-code">Cookie: sessid=abc123def456</p>
			<p>The first line contains the method (<strong class="source-inline">GET</strong>) and the path (<strong class="source-inline">/page</strong>). It also contains the HTTP version, in this case, <strong class="source-inline">1.1</strong>, although you don't have to worry about this. Many different HTTP methods can be used, depending on how you want to interact with the remote page. Some common ones are <strong class="source-inline">GET</strong> (retrieve the remote page), <strong class="source-inline">POST</strong> (send data to the remote page), <strong class="source-inline">PUT</strong> (create a remote page), and <strong class="source-inline">DELETE</strong> (delete the remote page). Note that the descriptions of the actions are somewhat simplified—the remote server can choose how it responds to different methods, and even experienced developers can disagree on the correct method to implement for a particular action. It's also important to note that even if a server supports a particular method, you will probably need the correct permissions to perform that action—you can't just use <strong class="source-inline">DELETE</strong> on a web page you don't like, for example.</p>
			<p>When writing a web application, the vast majority of the time, you will only deal with <strong class="source-inline">GET</strong> requests. When you start accepting forms, you'll also have to use <strong class="source-inline">POST</strong> requests. It is only when you are working with advanced features such as creating REST APIs that you will have to worry about <strong class="source-inline">PUT</strong>, <strong class="source-inline">DELETE</strong>, and other methods.</p>
			<p>Referring back to the example request again, from line 2 onward are the headers of the request. The headers contain extra metadata about the request. Each header is on its own line, with the header name and its value separated by a colon. Most are optional (except for <strong class="source-inline">Host</strong>—more on that soon). Header names are not case sensitive. For the sake of the example, we're only showing three common headers here. Let's look at the example headers in order:</p>
			<ul>
				<li><strong class="source-inline">Host</strong>: As mentioned, this is the only header that is required (for HTTP 1.1 or later). It is needed for the webserver to know which website or application should respond to the request, in case there are multiple sites hosted on a single server.</li>
				<li><strong class="source-inline">User-Agent</strong>: Your browser usually sends to the server a string identifying its version and operating system. Your server application could use this to serve different pages to different devices (for example, a mobile-specific page for smartphones).</li>
				<li><strong class="source-inline">Cookie</strong>: You have probably seen a message when visiting a web page that lets you know that it is storing a cookie in the browser. These are small pieces of information that a website can store in your browser that can be used to identify you or save settings for when you return to the site. If you were wondering about how your browser sends these cookies back to the server, it is through this header.</li>
			</ul>
			<p>There are many other standard headers defined and it would take up too much space to list them all. They can be used to authenticate to the server (<strong class="source-inline">Authorization</strong>), tell the server what kind of data you can receive (<strong class="source-inline">Accept</strong>), or even state what language you'd like for the page (<strong class="source-inline">Accept-Language</strong>, although this will only work if the page creator has made the content available in the particular language you request). You can even define your own headers that only your application knows how to respond to.</p>
			<p>Now let's look at a slightly more advanced request: one that sends some information to a server, and thus (unlike the previous example) contains a body. In this example, we are logging into a web page by sending a username and password. For example, you visit <strong class="source-inline">https://www.example.com/login</strong> and it displays a form to enter username and password. After you click the <strong class="source-inline">Login</strong> button, this is the request that is sent to the server:</p>
			<p class="source-code">POST /login HTTP/1.1</p>
			<p class="source-code">Host: www.example.com</p>
			<p class="source-code">Content-Type: application/x-www-form-urlencoded</p>
			<p class="source-code">Content-Length: 32</p>
			<p class="source-code">username=user1&amp;password=password1</p>
			<p>As you can see, this looks similar to the first example, but there are a few differences. The method is now <strong class="source-inline">POST</strong>, and two new headers have been introduced (you can assume your browser would still be sending the other headers that were in the previous example too):</p>
			<ul>
				<li><strong class="source-inline">Content-Type </strong>: This tells the server the type of data that is included in the body. In the case of <strong class="source-inline">application/x-www-form-urlencoded</strong>, the body is a set of key-value pairs. An HTTP client could set this header to tell the server if it was sending other types of data, such as JSON or XML, for example.</li>
				<li><strong class="source-inline">Content-Length</strong>: For the server to know how much data to read, the client must tell it how much data is being sent. The <strong class="source-inline">Content-Length</strong> header contains the length of the body. If you count the length of the body in this example, you'll see it's 32 characters.</li>
			</ul>
			<p>The headers are always separated from the body by a blank line. By looking at the example, you should be able to tell how the form data is encoded in the body: <strong class="source-inline">username</strong> has the value <strong class="source-inline">user1</strong> and <strong class="source-inline">password</strong> the value <strong class="source-inline">password1</strong>.</p>
			<p>These requests were quite simple, but most requests don't get much more complicated. They might have different methods and headers but should follow the same format. Now that you've seen requests, we'll take a look at the HTTP responses that come back from the server.</p>
			<p>An HTTP response looks similar to a request and consists of three main parts: a status, headers, and a body. Like a request, though, depending on the type of response, it might not have a body. The first response example is a simple successful response:</p>
			<p class="source-code">HTTP/1.1 200 OK</p>
			<p class="source-code">Server: nginx</p>
			<p class="source-code">Content-Length: 18132</p>
			<p class="source-code">Content-Type: text/html</p>
			<p class="source-code">Set-Cookie: sessid=abc123def46</p>
			<p class="source-code">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;…</p>
			<p>The first line contains the HTTP version, a numeric status code (<strong class="source-inline">200</strong>), and then a text description of what the code means (<strong class="source-inline">OK</strong>—the request was a success). We'll show some more statuses after the next example. Lines 2 to 5 contain headers, similar to a request. Some headers you have seen before; we will explain them all in this context:</p>
			<ul>
				<li><strong class="source-inline">Server</strong>: This is similar to but the opposite of the <strong class="source-inline">User-Agent</strong> header: this is the server telling the client what software it is running.</li>
				<li><strong class="source-inline">Content-Length</strong>: The client uses this value to determine how much data to read from the server to get the body.</li>
				<li><strong class="source-inline">Content-Type</strong>: The server uses this header to indicate to the client what type of data it is sending. The client can then choose how it will display the data—an image must be displayed differently to HTML, for example.</li>
				<li><strong class="source-inline">Set-Cookie</strong>: We saw in the first request example how a client sends a cookie to the server. This is the corresponding header that a server sends to set that cookie in the browser.</li>
			</ul>
			<p>After the headers is a blank line, and then the body of the response. We haven't shown it all here, just the first few characters of the HTML that is being received, out of the 18,132 that the server has sent.</p>
			<p>Next, we'll show an example of a response that is returned if a requested page is not found:</p>
			<p class="source-code">HTTP/1.1 404 Not Found</p>
			<p class="source-code">Server: nginx</p>
			<p class="source-code">Content-Length: 55</p>
			<p class="source-code">Content-Type: text/html</p>
			<p class="source-code">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;Page Not Found&lt;/body&gt;&lt;/html&gt;</p>
			<p>It is similar to the previous example, but the status is now <strong class="source-inline">404 Not Found</strong>. If you've ever been browsing the internet and received a <strong class="source-inline">404</strong> error, this is the type of response your browser received. The various status codes are grouped by the type of success or failure they indicate:</p>
			<ul>
				<li><strong class="bold">100-199</strong>: The server sends codes in this range to indicate protocol changes or that more data is required. You don't have to worry about these.</li>
				<li><strong class="bold">200-299</strong>: A status code in this range indicates the successful handling of a response. The most common one you will deal with is <strong class="source-inline">200 OK</strong>.</li>
				<li><strong class="bold">300-399</strong>: A status code in this range means the page you are requesting has moved to another address. An example of this is a URL shortening service that would redirect you from the short URL to the full one when you visit it. Common responses are <strong class="source-inline">301 Moved Permanently</strong> or <strong class="source-inline">302 Found</strong>. When sending a redirect response, the server will also include a <strong class="source-inline">Location</strong> header that contains the URL that should be redirected to.</li>
				<li><strong class="bold">400-499</strong>: A status code in this range means that the request could not be handled because there was a problem with what the client sent. This is in contrast to a request not being able to be handled due to a problem on the server (we will discuss those soon). We've already seen a <em class="italic">404 Not Found</em> response; this is due to a bad request because the client is requesting a document that does not exist. Some other common responses are <strong class="source-inline">401 Unauthorized</strong> (the client should log in) and <strong class="source-inline">403 Forbidden</strong> (the client is not allowed to access the specific resource). Both problems could be avoided by having the client login, hence them being considered client-side (request) problems.</li>
				<li><strong class="bold">500-599</strong>: Status codes in this range indicate an error on the server's side. The client shouldn't expect to be able to adjust the request to fix the problem. When working with Django, the most common server error status you will see is <strong class="source-inline">500 Internal Server Error</strong>. This will be generated if your code raises an exception. Another common one is <strong class="source-inline">504 Gateway Timeout</strong>, which might occur if your code is taking too long to run. The other variants that are common to see are <strong class="source-inline">502 Bad Gateway</strong> and <strong class="source-inline">503 Service Unavailable</strong>, which generally mean there is a problem with your application's hosting in some way.</li>
			</ul>
			<p>These are only some of the most common HTTP statuses. You can find a more complete list at <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">https://developer.mozilla.org/en-US/docs/Web/HTTP/Status</a>. Like HTTP headers, though, statuses are arbitrary, and an application can return custom statuses. It is up to the server and clients to decide what these custom statuses and codes mean.</p>
			<p>If this is your first time being introduced to the HTTP protocol, there's quite a lot of information to take in. Luckily, Django does all the hard work and encapsulates the incoming data into an <strong class="source-inline">HttpRequest</strong> object. Most of the time, you don't need to know about most of the information coming in, but it's available if you need it. Likewise, when sending a response, Django encapsulates your data in an <strong class="source-inline">HttpResponse</strong> object. Normally you just set the content to return, but you also have the freedom to set HTTP status codes and headers. We will discuss how to access and set the information in <strong class="source-inline">HttpRequest</strong> and <strong class="source-inline">HttpResponse</strong> later in this chapter.</p>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/>Processing a Request</h2>
			<p>This is a basic timeline of the request and response flows, so you can get an idea of what the code you'll be writing does at each stage. In terms of writing code, the first part you will write is your view. The view you create will perform some actions, such as querying the database for data. Then the view will pass this data to another function to render a template, finally returning the <strong class="source-inline">HttpResponse</strong> object encompassing the data you want to send back to the client. </p>
			<p>Next, Django needs to know how to map a specific URL to your view, so that it can load the correct view for the URL it receives as part of a request. You will write this URL mapping in a URL configuration Python file.</p>
			<p>When Django receives a request, it parses the URL config file, then finds the corresponding view. It calls the view, passing in an <strong class="source-inline">HttpRequest</strong> object representing the request. Your view will return its <strong class="source-inline">HttpResponse</strong>, then Django takes over again to send this data to its host web server and back out to the client that requested it:</p>
			<div>
				<div id="_idContainer037" class="IMG---Figure">
					<img src="image/B15509_01_07.jpg" alt="Figure 1.7: Request and response flow&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.7: Request and response flow</p>
			<p>The request-response flow is illustrated in <em class="italic">Figure 1.7</em>; the sections indicated as <em class="italic">Your Code</em> are code that you write—the first and last steps are taken care of by Django. Django does the URL matching for you, calls your view code, then handles passing the response back to the client.</p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/>Django Project</h2>
			<p>We already introduced Django projects in a previous section. To remind ourselves of what happens when we run <strong class="source-inline">startproject</strong> (for a project named <strong class="source-inline">myproject</strong>): the command creates a <strong class="source-inline">myproject</strong> directory with a file called <strong class="source-inline">manage.py</strong>, and a directory called <strong class="source-inline">myproject</strong> (this matches the project name, in <em class="italic">Exercise 1.01</em>, <em class="italic">Creating a Project and App, and Starting the Dev Server</em>; this folder was called <strong class="source-inline">bookr</strong>, the same as the project). The directory layout is shown in <em class="italic">Figure 1.8</em>. We'll now examine the <strong class="source-inline">manage.py</strong> file and the <strong class="source-inline">myproject</strong> package contents in more detail:</p>
			<div>
				<div id="_idContainer038" class="IMG---Figure">
					<img src="image/B15509_01_08.jpg" alt="Figure 1.8: Project directory for myproject&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.8: Project directory for myproject</p>
			<p><strong class="bold">manage.py</strong></p>
			<p>As the name suggests, this is a script that is used to manage your Django project. Most of the commands that are used to interact with your project will be supplied to this script on the command line. The commands are supplied as an argument to this script; for example, if we say to run the <strong class="source-inline">manage.py runserver</strong> command, we would mean running the <strong class="source-inline">manage.py</strong> script like this:</p>
			<p class="source-code">python3 manage.py runserver</p>
			<p>There are a number of useful commands that <strong class="source-inline">manage.py</strong> provides. You will be introduced to them in more detail throughout the book; some of the more common ones are listed here:</p>
			<ul>
				<li><strong class="source-inline">runserver</strong>: Starts the Django development HTTP server, to serve your Django app on your local computer.</li>
				<li><strong class="source-inline">startapp</strong>: Creates a new Django app in your project. We'll talk about what apps are in more depth soon.</li>
				<li><strong class="source-inline">shell</strong>: Starts a Python interpreter with the Django settings pre-loaded. This is useful for interacting with your application without having to manually load in your Django settings.</li>
				<li><strong class="source-inline">dbshell</strong>: Starts an interactive shell connected to your database, using the default parameters from your Django settings. You can run manual SQL queries in this way.</li>
				<li><strong class="source-inline">makemigrations</strong>: Generate database change instructions from your model definitions. You will learn what this means and how to use this command in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>.</li>
				<li><strong class="source-inline">migrate</strong>: Applies migrations generated by the <strong class="source-inline">makemigrations</strong> command. You will use this in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>, as well.</li>
				<li><strong class="source-inline">test</strong>: Run automated tests that you have written. You'll use this command in <em class="italic">Chapter 14</em>, <em class="italic">Testing</em>.</li>
			</ul>
			<p>A full list of all commands is available at <a href="https://docs.djangoproject.com/en/3.0/ref/django-admin/">https://docs.djangoproject.com/en/3.0/ref/django-admin/</a>.</p>
			<h3 id="_idParaDest-37"><a id="_idTextAnchor036"/>The myproject Directory</h3>
			<p>Moving on from the <strong class="source-inline">manage.py</strong> file, the other file item created by <strong class="source-inline">startproject</strong> is the <strong class="source-inline">myproject</strong> directory. This is the actual Python package for your project. It contains settings for the project, some configuration files for your web server, and the global URL maps. Inside the <strong class="source-inline">myproject</strong> directory are five files:</p>
			<ul>
				<li><strong class="source-inline">__init__.py</strong></li>
				<li><strong class="source-inline">asgi.py</strong></li>
				<li><strong class="source-inline">settings.py</strong></li>
				<li><strong class="source-inline">urls.py</strong></li>
				<li><strong class="source-inline">wsgi.py</strong><p> </p><div id="_idContainer039" class="IMG---Figure"><img src="image/B15509_01_09.jpg" alt="Figure 1.9: The myproject package (inside the myproject project directory)&#13;&#10;"/></div></li>
			</ul>
			<p class="figure-caption">Figure 1.9: The myproject package (inside the myproject project directory)</p>
			<p><strong class="source-inline">__init__.py</strong></p>
			<p>An empty file that lets Python know that the <strong class="source-inline">myproject</strong> directory is a Python module. You'll be familiar with these files if you've worked with Python before.</p>
			<p><strong class="source-inline">settings.py</strong></p>
			<p>This contains all the Django settings for your application. We will explain the contents soon.</p>
			<p><strong class="source-inline">urls.py</strong></p>
			<p>This has the global URL mappings that Django will initially use to locate views or other child URL mappings. You will add a URL map to this file soon.</p>
			<p><strong class="source-inline">asgi.py</strong> and <strong class="source-inline">wsgi.py</strong></p>
			<p>These files are what ASGI or WSGI web servers use to communicate with your Django app when you deploy it to a production web server. You normally don't need to edit these at all, and they aren't used in day-to-day development. Their use will be discussed more in <em class="italic">Chapter 17</em>, <em class="italic">Deployment of a Django Application</em>.</p>
			<h3 id="_idParaDest-38"><a id="_idTextAnchor037"/>Django Development Server</h3>
			<p>You have already started the Django dev server in <em class="italic">Exercise 1.01</em>, <em class="italic">Creating a Project and App, and Starting the Dev Server</em>. As we mentioned previously, it is a web server intended to only be run on the developer's machine during development. It is not intended for use in production.</p>
			<p>By default, the server listens on port <strong class="source-inline">8000</strong> on <strong class="source-inline">localhost (127.0.0.1)</strong>, but this can be changed by adding a port number or address and port number after the <strong class="source-inline">runserver</strong> argument:</p>
			<p class="source-code">python3 manage.py runserver 8001</p>
			<p>This will have the server listen on port <strong class="source-inline">8001</strong> on <strong class="source-inline">localhost (127.0.0.1)</strong>.</p>
			<p>You can also have it listen on a specific address if your computer has more than one, or <strong class="source-inline">0.0.0.0</strong> for all addresses:</p>
			<p class="source-code">python3 manage.py runserver 0.0.0.0:8000</p>
			<p>This will have the server listen on all your computer's addresses on port <strong class="source-inline">8000</strong>, which can be useful if you want to test your application from another computer or your smartphone.</p>
			<p>The development server watches your Django project directory and will restart automatically every time you save a file so that any code changes you make are automatically reloaded into the server. You still have to manually refresh your browser to see changes there, though.</p>
			<p>When you want to stop the <strong class="source-inline">runserver</strong> command, it can be done in the usual way for stopping processes in the Terminal: by using the <em class="italic">Ctrl</em> + <em class="italic">C</em> key combination. </p>
			<h2 id="_idParaDest-39"><a id="_idTextAnchor038"/>Django Apps</h2>
			<p>Now that we've covered a bit of theory about apps, we can be more specific about their purpose. An app directory contains all the models, views, and templates (and more) that they need to provide application functionality. A Django project will contain at least one app (unless it has been heavily customized to not rely on a lot of Django functionality). If well designed, an app should be able to be removed from a project and moved to another project without modification. Usually, an app will contain models for a single design domain, and this can be a useful way of determining whether your app should be split into multiple apps.</p>
			<p>Your app can have any name as long as it is a valid Python module name (that is, using only letters, numbers, and underscores) and does not conflict with other files in your project directory. For example, as we have seen, there is already a directory called <strong class="source-inline">myproject</strong> in the project directory (containing the <strong class="source-inline">settings.py</strong> file), so you could not have an app called <strong class="source-inline">myproject</strong>. As we saw in <em class="italic">Exercise 1.01</em>, <em class="italic">Creating a Project and App, and Starting the Dev Server</em>, creating an app uses the <strong class="source-inline">manage.py startapp appname</strong> command. For example:</p>
			<p class="source-code">python3 manage.py startapp myapp</p>
			<p>The <strong class="source-inline">startapp</strong> command creates a directory within your project with the name of the app specified. It also scaffolds files for the app. Inside the <strong class="source-inline">app</strong> directory are several files and a folder, as shown in <em class="italic">Figure 1.10</em>:</p>
			<div>
				<div id="_idContainer040" class="IMG---Figure">
					<img src="image/B15509_01_10.jpg" alt="Figure 1.10: The contents of the myapp app directory&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.10: The contents of the myapp app directory</p>
			<ul>
				<li><strong class="source-inline">__init.py__</strong>: An empty file indicating that this directory is a Python module.</li>
				<li><strong class="source-inline">admin.py</strong>: Django has a built-in admin site for viewing and editing data with a Graphical User Interface (GUI). In this file, you will define how your app's models are exposed in the Django admin site. We'll cover this in more detail in <em class="italic">Chapter 4</em>, <em class="italic">Introduction to Django Admin</em>.</li>
				<li><strong class="source-inline">apps.py</strong>: This contains some configuration for the metadata of your app. You won't need to edit this file.</li>
				<li><strong class="source-inline">models.py</strong>: This is where you will define the models for your application. You'll read about this in more detail in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>.</li>
				<li><strong class="source-inline">migrations</strong>: Django uses migration files to automatically record changes to your underlying database as the models change. They are generated by Django when you run the <strong class="source-inline">manage.py makemigrations</strong> command and are stored in this directory. They do not get applied to the database until you run <strong class="source-inline">manage.py migrate</strong>. They will be also be covered in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>.</li>
				<li><strong class="source-inline">tests.py</strong>: To test that your code is behaving correctly, Django supports writing tests (unit, functional, or integration) and will look for them inside this file. We will write some tests throughout this book and cover testing in detail in <em class="italic">Chapter 14</em>, <em class="italic">Testing</em>.</li>
				<li><strong class="source-inline">views.py</strong>: Your Django views (the code that responds to HTTP requests) will go in here. You will create a basic view soon, and views will be covered in more detail in <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>.</li>
			</ul>
			<p>We will examine the contents of these files more later, but for now, we'll get Django up and running in our second exercise.</p>
			<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/>PyCharm Setup</h2>
			<p>We confirmed in <em class="italic">Exercise 1.01</em>, <em class="italic">Creating a Project and App, and Starting the Dev Server</em>, that the Bookr project has been set up properly (since the dev server runs successfully), so we can now start using <strong class="bold">PyCharm</strong> to run and edit our project. PyCharm is an IDE for Python development, and it includes features such as code completion, automatic style formatting, and a built-in debugger. We will then use PyCharm to start writing our URL maps, views, and templates. It will also be used to start and stop the development server, which will allow the debugging of our code by setting breakpoints.</p>
			<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/>Exercise 1.02: Project Setup in PyCharm</h2>
			<p>In this exercise, we will open the Bookr project in PyCharm and set up the project interpreter so that PyCharm can run and debug the project:</p>
			<ol>
				<li value="1">Open PyCharm. When you first open PyCharm, you will be shown the <strong class="source-inline">Welcome to PyCharm</strong> screen, which asks you what you want to do:<div id="_idContainer041" class="IMG---Figure"><img src="image/B15509_01_11.jpg" alt="Figure 1.11: PyCharm welcome screen&#13;&#10;"/></div><p class="figure-caption">Figure 1.11: PyCharm welcome screen</p></li>
				<li>Click <strong class="source-inline">Open</strong>, then browse to the <strong class="source-inline">bookr</strong> project you just created, then open it. Make sure you are opening the <strong class="source-inline">bookr</strong> project directory and not the <strong class="source-inline">bookr</strong> package directory inside.<p>If you haven't used PyCharm before, it will ask you about what settings and themes you want to use, and once you have answered all those questions, you will see your <strong class="source-inline">bookr</strong> project structure open in the <strong class="source-inline">Project</strong> pane on the left of the window:</p><div id="_idContainer042" class="IMG---Figure"><img src="image/B15509_01_12.jpg" alt="Figure 1.12: PyCharm Project pane&#13;&#10;"/></div><p class="figure-caption">Figure 1.12: PyCharm Project pane</p><p>Your <strong class="source-inline">Project</strong> pane should look like <em class="italic">Figure 1.12</em> and show the <strong class="source-inline">bookr</strong> and <strong class="source-inline">reviews</strong> directories, and the <strong class="source-inline">manage.py</strong> file. If you do not see these and instead see <strong class="source-inline">asgi.py</strong>, <strong class="source-inline">settings.py</strong>, <strong class="source-inline">urls.py</strong>, and <strong class="source-inline">wsgi.py</strong>, then you have opened the <strong class="source-inline">bookr</strong> package directory instead. Select <strong class="source-inline">File</strong> -&gt; <strong class="source-inline">Open</strong>, then browse and open the <strong class="source-inline">bookr</strong> project directory.</p><p>Before PyCharm knows how to execute your project to start the Django dev server, the interpreter must be set to the Python binary inside your virtual environment. This is done first by adding the interpreter to the global interpreter settings.</p></li>
				<li>Open the <strong class="source-inline">Preferences</strong> (macOS) or <strong class="source-inline">Settings</strong> (Windows/Linux) window inside PyCharm.<p>macOS:</p><p><strong class="source-inline">PyCharm Menu</strong> -&gt; <strong class="source-inline">Preferences</strong></p><p>Windows and Linux:</p><p><strong class="source-inline">File</strong> -&gt; <strong class="source-inline">Settings</strong></p></li>
				<li>In the preferences list pane on the left, open the <strong class="source-inline">Project: bookr</strong> item, then click <strong class="source-inline">Project Interpreter</strong>:<div id="_idContainer043" class="IMG---Figure"><img src="image/B15509_01_13.jpg" alt="Figure 1.13: Project interpreter settings &#13;&#10;"/></div><p class="figure-caption">Figure 1.13: Project interpreter settings </p></li>
				<li>Sometimes PyCharm can automatically determine virtual environments, so in this case, <strong class="source-inline">Project Interpreter</strong> may already be populated with the correct interpreter. If it is, and you see Django in the list of packages, you can click <strong class="source-inline">OK</strong> to close the window and complete this exercise.<p>In most cases, though, the Python interpreter must be set manually. Click the cog icon next to the <strong class="source-inline">Project Interpreter</strong> dropdown, then click <strong class="source-inline">Add…</strong>.</p></li>
				<li>The <strong class="source-inline">Add Python Interpreter</strong> window is now displayed. Select the <strong class="source-inline">Existing environment</strong> radio button and then click the ellipses (<strong class="source-inline">…</strong>) next to the <strong class="source-inline">Interpreter</strong> dropdown. You should then browse and select the Python interpreter for your virtual environment:<p> </p><div id="_idContainer044" class="IMG---Figure"><img src="image/B15509_01_14.jpg" alt="Figure 1.14: The Add Python Interpreter window&#13;&#10;"/></div><p class="figure-caption">Figure 1.14: The Add Python Interpreter window</p></li>
				<li>On macOS (assuming you called the virtual environment <strong class="source-inline">bookr</strong>), the path is usually <strong class="source-inline">/Users/&lt;yourusername&gt;/.virtualenvs/bookr/bin/python3</strong>. Similarly, in Linux, it should be <strong class="source-inline">/home/&lt;yourusername&gt;/.virtualenvs/bookr/bin/python3</strong>. <p>If you're unsure, you can run the <strong class="source-inline">which python3</strong> command in the Terminal where you previously ran the <strong class="source-inline">python manage.py</strong> command and it will tell you the path to the Python interpreter:</p><p class="source-code">which python3</p><p class="source-code">/Users/ben/.virtualenvs/bookr/bin/python3</p><p>On Windows, it will be wherever you created your virtual environment with the <strong class="source-inline">virtualenv</strong> command.</p><p>After selecting the interpreter, your <strong class="source-inline">Add Python Interpreter</strong> window should look like <em class="italic">Figure 1.14</em>.</p></li>
				<li>Click <strong class="source-inline">OK</strong> to close the <strong class="source-inline">Add Python interpreter</strong> window.</li>
				<li>You should now see the main preferences window, and Django (and other packages in your virtual environment) will be listed (see <em class="italic">Figure 1.15</em>):<p> </p><div id="_idContainer045" class="IMG---Figure"><img src="image/B15509_01_15.jpg" alt="Figure 1.15: Packages in the virtual environment are listed&#13;&#10;"/></div><p class="figure-caption">Figure 1.15: Packages in the virtual environment are listed</p></li>
				<li>Click <strong class="source-inline">OK</strong> in the main <strong class="source-inline">Preferences</strong> window to close it. PyCharm will now take a few seconds to index your environment and the libraries installed. You can see the process in its bottom-right status bar. Wait for this process to finish and the progress bar will disappear.</li>
				<li>To run the Django dev server, Python needs to be configured with a run configuration. You will set this up now.<p>Click <strong class="source-inline">Add Configuration…</strong> in the top right of the PyCharm project window, to open the <strong class="source-inline">Run/Debug Configuration</strong> window:</p><div id="_idContainer046" class="IMG---Figure"><img src="image/B15509_01_16.jpg" alt="Figure 1.16: The Add Configuration… button in the top right of the PyCharm window&#13;&#10;"/></div><p class="figure-caption">Figure 1.16: The Add Configuration… button in the top right of the PyCharm window</p></li>
				<li>Click the <strong class="source-inline">+</strong> button in the top left of this window and select <strong class="source-inline">Python</strong> from the dropdown menu:<div id="_idContainer047" class="IMG---Figure"><img src="image/B15509_01_17.jpg" alt="Figure 1.17: Adding a new Python configuration in the Run/Debug Configuration window&#13;&#10;"/></div><p class="figure-caption">Figure 1.17: Adding a new Python configuration in the Run/Debug Configuration window</p></li>
				<li>A new configuration panel with fields regarding how to run your project will display on the right of the window. You should fill out the fields as follows.<p>The <strong class="source-inline">Name</strong> field can be anything but should be understandable. Enter <strong class="source-inline">Django Dev Server</strong>.</p><p><strong class="source-inline">Script Path</strong> is the path to your <strong class="source-inline">manage.py</strong> file. If you click the folder icon in this field, you can browse your filesystem to select the <strong class="source-inline">manage.py</strong> file inside the <strong class="source-inline">bookr</strong> project directory.</p><p><strong class="source-inline">Parameters</strong> are the arguments that come after the <strong class="source-inline">manage.py</strong> script, the same as if running it from the command line. We will use the same argument here to start the server, so enter <strong class="source-inline">runserver</strong>.</p><p class="callout-heading">Note</p><p class="callout">As mentioned earlier, the <strong class="source-inline">runserver</strong> command can also accept an argument for the port or address to listen to. If you want to, you can add this argument after <strong class="source-inline">runserver</strong> in the same <strong class="source-inline">Parameters</strong> field.</p><p>The <strong class="source-inline">Python interpreter</strong> setting should have been automatically set to the one that was set in <em class="italic">steps 5 </em>to <em class="italic">8</em>. If not, you can click the arrow dropdown on the right to select it.</p><p><strong class="source-inline">Working directory</strong> should be set to the <strong class="source-inline">bookr</strong> project directory. This has probably already been set correctly.</p><p><strong class="source-inline">Add content roots to PYTHONPATH</strong> and <strong class="source-inline">Add source roots to PYTHONPATH</strong> should both be checked. This will ensure that PyCharm adds your <strong class="source-inline">bookr</strong> project directory to <strong class="source-inline">PYTHONPATH</strong> (the list of paths that the Python interpreter searches when loading a module). Without those checked, the imports from your project will not work correctly:</p><p> </p><div id="_idContainer048" class="IMG---Figure"><img src="image/B15509_01_18.jpg" alt="Figure 1.18: Configuration settings&#13;&#10;"/></div><p class="figure-caption">Figure 1.18: Configuration settings</p><p>Ensure that your <strong class="source-inline">Run/Debug configurations</strong> window looks similar to <em class="italic">Figure 1.18</em>, then click <strong class="source-inline">OK</strong> to save the configuration.</p></li>
				<li>Now, instead of starting the Django dev server in a Terminal, you can click the play icon in the top right of the <strong class="source-inline">Project</strong> window to start it (see <em class="italic">Figure 1.19</em>):<p> </p><div id="_idContainer049" class="IMG---Figure"><img src="image/B15509_01_19.jpg" alt="Figure 1.19: Django dev server configuration with play, debug, and stop buttons&#13;&#10;"/></div><p class="figure-caption">Figure 1.19: Django dev server configuration with play, debug, and stop buttons</p></li>
				<li>Click the play icon to start the Django dev server.<p class="callout-heading">Note</p><p class="callout">Make sure you stop any other instances of the Django dev server that are running (such as in a Terminal) otherwise the one you are starting will not be able to bind to port <strong class="source-inline">8000</strong> and will fail to start.</p></li>
				<li>A console will open at the bottom of the PyCharm window, which will show output indicating that the dev server has started (<em class="italic">Figure 1.20</em>):<div id="_idContainer050" class="IMG---Figure"><img src="image/B15509_01_20.jpg" alt="Figure 1.20: Console with the Django dev server running&#13;&#10;"/></div><p class="figure-caption">Figure 1.20: Console with the Django dev server running</p></li>
				<li>Open a web browser and navigate to <strong class="source-inline">http://127.0.0.1:8000</strong>. You should see the same Django example screen as you did earlier, in <em class="italic">Exercise 1.01</em>, <em class="italic">Creating a Project and App, and Starting the Dev Server</em> (<em class="italic">Figure 1.2</em>), which will confirm that once again everything is set up correctly.</li>
			</ol>
			<p>In this exercise, we opened the Bookr project in PyCharm, then set the Python interpreter for our project. We then added a run configuration in PyCharm, which allows us to start and stop the Django dev server from within PyCharm. We will also be able to debug our project later by running it inside PyCharm's debugger.</p>
			<h2 id="_idParaDest-42"><a id="_idTextAnchor041"/>View Details</h2>
			<p>You now have everything set up to start writing your own Django views and configure the URLs that will map to them. As we saw earlier in this chapter, a view is simply a function that takes an <strong class="source-inline">HttpRequest</strong> instance (built by Django) and (optionally) some parameters from the URL. It will then do some operations, such as fetching data from a database. Finally, it returns <strong class="source-inline">HttpResponse</strong>. </p>
			<p>To use our Bookr app as an example, we might have a view that receives a request for a certain book. It queries the database for this book, then returns a response containing an HTML page showing information about the book. Another view could receive a request to list all the books, then return a response with another HTML page containing this list. Views can also create or modify data: another view could receive a request to create a new book; it would then add the book to the database and return a response with HTML that displays the new book's information.</p>
			<p>In this chapter, we will only be using functions as views, but Django also supports class-based views, which allow you to leverage object-oriented paradigms (such as inheritance). This allows you to simplify code used in multiple views that have the same business logic. For example, you might want to show all books or just books by a certain publisher. Both views need to query a list of books from the database and render them to a book list template. One view class could inherit from the other and just implement the data fetching differently and leave the rest of the functionality (such as rendering) identical. Class-based views can be more powerful but also harder to learn. They will be introduced later, in <em class="italic">Chapter 11</em>, <em class="italic">Advanced Templates and Class-Based Views</em>, when you have more experience with Django.</p>
			<p>The <strong class="source-inline">HttpRequest</strong> instance that is passed to the view contains all the data related to the request, with attributes such as these:</p>
			<ul>
				<li><strong class="source-inline">method</strong>: A string containing the HTTP method the browser used to request the page; usually this is <strong class="source-inline">GET</strong>, but it will be <strong class="source-inline">POST</strong> if the user has submitted a form. You can use this to change the flow of the view, for example, show an empty form on <strong class="source-inline">GET</strong>, or validate and process a form submission on <strong class="source-inline">POST</strong>.</li>
				<li><strong class="source-inline">GET</strong>: A <strong class="source-inline">QueryDict</strong> instance containing the parameters used in the URL query string. This is the part of the URL after the <strong class="source-inline">?</strong>, if it contains one. We go further into <strong class="source-inline">QueryDict</strong> soon. Note that this attribute is always available even if the request was not <strong class="source-inline">GET</strong>.</li>
				<li><strong class="source-inline">POST</strong>: Another <strong class="source-inline">QueryDict</strong> containing the parameters sent to the view in a <strong class="source-inline">POST</strong> request, like from a form submission. Usually, you would use this in conjunction with a Django form, which will be covered in <em class="italic">Chapter 6</em>, <em class="italic">Forms</em>.</li>
				<li><strong class="source-inline">headers</strong>: A case-insensitive key dictionary with the HTTP headers from the request. For example, you could vary the response with different content for different browsers based on the <strong class="source-inline">User-Agent</strong> header. We discussed some HTTP headers that are sent by the client earlier in this chapter.</li>
				<li><strong class="source-inline">path</strong>: This is the path used in the request. Normally, you don't need to examine this because Django will automatically parse the path and pass it to view function as parameters, but it can be useful in some instances.</li>
			</ul>
			<p>We won't be using all these attributes yet, and others will be introduced later, but you can now see what role the <strong class="source-inline">HttpRequest</strong> argument plays in your view.</p>
			<h2 id="_idParaDest-43"><a id="_idTextAnchor042"/>URL Mapping Detail</h2>
			<p>We briefly mentioned URL maps earlier in the <em class="italic">Processing a Request</em> section. Django does not automatically know which view function should be executed when it receives a request for a particular URL. The role of a URL mapping to build this link between a URL and a view. For example, in Bookr, you might want to map the URL <strong class="source-inline">/books/</strong> to a <strong class="source-inline">books_list</strong> view that you have created.</p>
			<p>The URL-to-view mapping is defined in the file that Django automatically created called <strong class="source-inline">urls.py</strong>, inside the <strong class="source-inline">bookr</strong> package directory (although a different file can be set in <strong class="source-inline">settings.py</strong>; more on that later).</p>
			<p>This file contains a variable, <strong class="source-inline">urlpatterns</strong>, which is a list of paths that Django evaluates in turn until it finds a match for the URL being requested. The match will either resolve to a view function, or to another <strong class="source-inline">urls.py</strong> file also containing a <strong class="source-inline">urlpatterns</strong> variable, which will be resolved in the same manner. URL files can be chained in this manner for as long as you want. In this way, you can split URL maps into separate files (such as one or more per app) so that they don't become too large. Once a view has been found, Django calls it with an <strong class="source-inline">HttpRequest</strong> instance and any parameters parsed from the URL.</p>
			<p>Rules are set by calling the <strong class="source-inline">path</strong> function, which takes the path of the URL as the first argument. The path can contain named parameters that will be passed to a view as function parameters. Its second argument is either a view or another file also containing <strong class="source-inline">urlpatterns</strong>.</p>
			<p>There is also the <strong class="source-inline">re_path</strong> function, which is similar to <strong class="source-inline">path</strong> except it takes a regular expression as the first argument for a more advanced configuration. There is much more to URL mapping; however, and it will be covered in <em class="italic">Chapter 3</em>, <em class="italic">URL Mapping, Views, and Templates</em>.</p>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/B15509_01_21.jpg" alt="Figure 1.21: The default urls.py file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.21: The default urls.py file</p>
			<p>To illustrate these concepts, <em class="italic">Figure 1.21</em> shows the default <strong class="source-inline">urls.py</strong> file that Django generates. You can see the <strong class="source-inline">urlpatterns</strong> variable, which lists all the URLs that are set up. Currently, there is only one rule set up, which maps any path starting with <strong class="source-inline">admin/</strong> to the admin URL maps (the <strong class="source-inline">admin.site.urls</strong> module). This is not a mapping to a view; instead, it is an example of chaining URL maps together—the <strong class="source-inline">admin.site.urls</strong> module will define the remainder of the paths (after <strong class="source-inline">admin/</strong>) that map to the admin views. We will cover the Django admin site in <em class="italic">Chapter 4</em>, <em class="italic">Introduction to Django Admin</em>.</p>
			<p>We will now write a view and set up a URL map to it to see these concepts in action.</p>
			<h2 id="_idParaDest-44"><a id="_idTextAnchor043"/>Exercise 1.03: Writing a View and Mapping a URL to It</h2>
			<p>Our first view will be very simple and will just return some static text content. In this exercise, we will see how to write a view, and how to set up a URL map to resolve to a view:</p>
			<p class="callout-heading">Note </p>
			<p class="callout">As you make changes to files in your project and save them, you might see the Django development server automatically restarting in the Terminal or console in which it is running. This is normal; it automatically restarts to load any code changes that you make. Please also note that it won't automatically apply changes to the database if you edit models or migrations—more on this in <em class="italic">Chapter 2</em>, <em class="italic">Models and Migrations</em>.</p>
			<ol>
				<li value="1">In PyCharm, expand the <strong class="source-inline">reviews</strong> folder in the project browser on the left, then double-click the <strong class="source-inline">views.py</strong> file inside to open it. In the right (editor) pane in PyCharm, you should see the Django automatically generated placeholder text:<p class="source-code">from django.shortcuts import render</p><p class="source-code"># Create your views here.</p><p>It should look like this in the editor pane:</p><div id="_idContainer052" class="IMG---Figure"><img src="image/B15509_01_22.jpg" alt="Figure 1.22: views.py default content&#13;&#10;"/></div><p class="figure-caption">Figure 1.22: views.py default content</p></li>
				<li>Remove this placeholder text from <strong class="source-inline">views.py</strong> and instead insert this content:<p class="source-code">from django.http import HttpResponse</p><p class="source-code">def index(request):</p><p class="source-code">    return HttpResponse("Hello, world!")</p><p>First, the <strong class="source-inline">HttpResponse</strong> class needs to be imported from <strong class="source-inline">django.http</strong>. This is what is used to create the response that goes back to the web browser. You can also use it to control things such as the HTTP headers or status code. For now, it will just use the default headers and <strong class="source-inline">200 Success</strong> status code. Its first argument is the string content to send as the body of the response.</p><p>Then, the view function returns an <strong class="source-inline">HttpResponse</strong> instance with the content we defined (<strong class="source-inline">Hello, world!</strong>):</p><div id="_idContainer053" class="IMG---Figure"><img src="image/B15509_01_23.jpg" alt="Figure 1.23: The contents of views.py after editing&#13;&#10;"/></div><p class="figure-caption">Figure 1.23: The contents of views.py after editing</p></li>
				<li>We will now set up a URL map to the <strong class="source-inline">index</strong> view. This will be very simple and won't contain any parameters. Expand the <strong class="source-inline">bookr</strong> directory in the <strong class="source-inline">Project</strong> pane, then open <strong class="source-inline">urls.py</strong>. Django has automatically generated this file.<p>For now, we'll just add a simple URL to replace the default index that Django provides.</p></li>
				<li>Import your views into the <strong class="source-inline">urls.py</strong> file, by adding this line after the other existing imports:<p class="source-code">import reviews.views</p></li>
				<li>Add a map to the index view to the <strong class="source-inline">urlpatterns</strong> list by adding a call to the <strong class="source-inline">path</strong> function with an empty string and a reference to the <strong class="source-inline">index</strong> function:<p class="source-code">urlpatterns = [path('admin/', admin.site.urls),\</p><p class="source-code">               path('', reviews.views.index)]</p><p class="callout-heading">Note</p><p class="callout">The preceding code snippet uses a backslash ( \ ) to split the logic across multiple lines. When the code is executed, Python will ignore the backslash, and treat the code on the next line as a direct continuation of the current line.</p><p>Make sure you don't add brackets after the <strong class="source-inline">index</strong> function (that is, it should be <strong class="source-inline">reviews.views.index</strong> and not <strong class="source-inline">reviews.views.index()</strong>) as we are passing a reference to a function rather than calling it. When you're finished, your <strong class="source-inline">urls.py</strong> file should like <em class="italic">Figure 1.24</em>:</p><div id="_idContainer054" class="IMG---Figure"><img src="image/B15509_01_24.jpg" alt="Figure 1.24: urls.py after editing&#13;&#10;"/></div><p class="figure-caption">Figure 1.24: urls.py after editing</p></li>
				<li>Switch back to your web browser and refresh. The Django default welcome screen should be replaced with the text defined in the view, <strong class="source-inline">Hello, world!</strong>:<div id="_idContainer055" class="IMG---Figure"><img src="image/B15509_01_25.jpg" alt="Figure 1.25: The web browser should now display the Hello, world! message&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.25: The web browser should now display the Hello, world! message</p>
			<p>We just saw how to write a view function and map a URL to it. We then tested the view by loading it in a web browser.</p>
			<h2 id="_idParaDest-45"><a id="_idTextAnchor044"/>GET, POST, and QueryDict Objects</h2>
			<p>Data can come through an HTTP request as parameters on a URL or inside the body of a <strong class="source-inline">POST</strong> request. You might have noticed parameters in a URL when browsing the web—the text after a <strong class="source-inline">?</strong>—for example, <strong class="source-inline">http://www.example.com/?parameter1=value1&amp;parameter2=value2</strong>. We also saw earlier in this chapter an example of form data in a <strong class="source-inline">POST</strong> request, for logging in a user (the request body was <strong class="source-inline">username=user1&amp;password=password1</strong>).</p>
			<p>Django automatically parses these parameter strings into <strong class="source-inline">QueryDict</strong> objects. The data is then available on the <strong class="source-inline">HttpRequest</strong> object that is passed to your view—specifically, in the <strong class="source-inline">HttpRequest</strong>.<strong class="source-inline">GET</strong> and <strong class="source-inline">HttpRequest</strong>.<strong class="source-inline">POST</strong> attributes, for URL parameters and body parameters respectively. <strong class="source-inline">QueryDict</strong> objects are objects that mostly behave like dictionaries, except that they can contain multiple values for a key. </p>
			<p>To show different methods of accessing items, we'll use a simple <strong class="source-inline">QueryDict</strong> named <strong class="source-inline">qd</strong> with only one key (<strong class="source-inline">k</strong>) as an example. The <strong class="source-inline">k</strong> item has three values in a list: the strings <strong class="source-inline">a</strong>, <strong class="source-inline">b</strong>, and <strong class="source-inline">c</strong>. The following code snippets show output from a Python interpreter.</p>
			<p>First, the <strong class="source-inline">QueryDict</strong> <strong class="source-inline">qd</strong> is constructed from a parameter string:</p>
			<p class="source-code">&gt;&gt;&gt; qd = QueryDict("k=a&amp;k=b&amp;k=c")</p>
			<p>When accessing items with square bracket notation or the <strong class="source-inline">get</strong> method, the last value for that key is returned: </p>
			<p class="source-code">&gt;&gt;&gt; qd["k"]</p>
			<p class="source-code">'c'</p>
			<p class="source-code">&gt;&gt;&gt; qd.get("k")</p>
			<p class="source-code">'c'</p>
			<p>To access all the values for a key, the <strong class="source-inline">getlist</strong> method should be used:</p>
			<p class="source-code">&gt;&gt;&gt; qd.getlist("k")</p>
			<p class="source-code">['a', 'b', 'c']</p>
			<p><strong class="source-inline">getlist</strong> will always return a list—it will be empty if the key does not exist:</p>
			<p class="source-code">&gt;&gt;&gt; qd.getlist("bad key")</p>
			<p class="source-code">[]</p>
			<p>While <strong class="source-inline">getlist</strong> does not raise an exception for keys that do not exist, accessing a key that does not exist with square bracket notation will raise <strong class="source-inline">KeyError</strong>, like a normal dictionary. Use the <strong class="source-inline">get</strong> method to avoid this error.</p>
			<p>The <strong class="source-inline">QueryDict</strong> objects for <strong class="source-inline">GET</strong> and <strong class="source-inline">POST</strong> are immutable (they cannot be changed), so the <strong class="source-inline">copy</strong> method should be used to get a mutable copy if you need to change its values:</p>
			<p class="source-code">&gt;&gt;&gt; qd["k"] = "d"</p>
			<p class="source-code">AttributeError: This QueryDict instance is immutable</p>
			<p class="source-code">&gt;&gt;&gt; qd2 = qd.copy()</p>
			<p class="source-code">&gt;&gt;&gt; qd2</p>
			<p class="source-code">&lt;QueryDict: {'k': ['a', 'b', 'c']}&gt;</p>
			<p class="source-code">&gt;&gt;&gt; qd2["k"] = "d"</p>
			<p class="source-code">&gt;&gt;&gt; qd2["k"]</p>
			<p class="source-code">"d"</p>
			<p>To give an example of how <strong class="source-inline">QueryDict</strong> is populated from a URL, imagine an example URL: <strong class="source-inline">http://127.0.0.1:8000?val1=a&amp;val2=b&amp;val2=c&amp;val3</strong>.</p>
			<p>Behind the scenes, Django passes the query from the URL (everything after the <strong class="source-inline">?</strong>) to instantiate a <strong class="source-inline">QueryDict</strong> object and attach it to the <strong class="source-inline">request</strong> instance that is passed to the view function. Something like this:</p>
			<p class="source-code">request.GET = QueryDict("val1=a&amp;val2=b&amp;val2=c&amp;val3")</p>
			<p>Remember, this is done to the <strong class="source-inline">request</strong> instance before you receive it inside your view function; you do not need to do this.</p>
			<p>In the case of our example URL, we could access the parameters inside the view function as follows:</p>
			<p class="source-code">request.GET["val1"]</p>
			<p>Using standard dictionary access, it would return the value <strong class="source-inline">a</strong>:</p>
			<p class="source-code">request.GET["val2"]</p>
			<p>Again, using standard dictionary access, there are two values set for the <strong class="source-inline">val2</strong> key, so it would return the last value, <strong class="source-inline">c</strong>:</p>
			<p class="source-code">request.GET.getlist("val2")</p>
			<p>This would return a list of all the values for <strong class="source-inline">val2</strong>: <strong class="source-inline">["b", "c"]</strong>:</p>
			<p class="source-code">request.GET["val3"]</p>
			<p>This key is in the query string but has no value set, so this returns an empty string:</p>
			<p class="source-code">request.GET["val4"]</p>
			<p>This key is not set, so <strong class="source-inline">KeyError</strong> will be raised. Use <strong class="source-inline">request.GET.get("val4")</strong> instead, which will return <strong class="source-inline">None</strong>:</p>
			<p class="source-code">request.GET.getlist("val4")</p>
			<p>Since this key is not set, an empty list (<strong class="source-inline">[]</strong>) will be returned.</p>
			<p>We will now look at <strong class="source-inline">QueryDict</strong> in action using the <strong class="source-inline">GET</strong> parameters. You will examine <strong class="source-inline">POST</strong> parameters further in <em class="italic">Chapter 6</em>, <em class="italic">Forms</em>.</p>
			<h2 id="_idParaDest-46"><a id="_idTextAnchor045"/>Exercise 1.04: Exploring GET Values and QueryDict</h2>
			<p>We will now make some changes to our <strong class="source-inline">index</strong> view from the previous exercise to read values from the URL in the <strong class="source-inline">GET</strong> attribute, and then we will experiment with passing different parameters to see the result:</p>
			<ol>
				<li value="1">Open the <strong class="source-inline">views.py</strong> file in PyCharm. Add a new variable called <strong class="source-inline">name</strong> that reads the user's name from the <strong class="source-inline">GET</strong> parameters. Add this line after the <strong class="source-inline">index</strong> function definition:<p class="source-code">name = request.GET.get("name") or "world"</p></li>
				<li>Change the return value so the name is used as part of the content that is returned:<p class="source-code">return HttpResponse("Hello, {}!".format(name))</p><p>In PyCharm, the changed code will look like this:</p><div id="_idContainer056" class="IMG---Figure"><img src="image/B15509_01_26.jpg" alt="Figure 1.26: Updated views.py file&#13;&#10;"/></div><p class="figure-caption">Figure 1.26: Updated views.py file</p></li>
				<li>Visit <strong class="source-inline">http://127.0.0.1:8000</strong> in your browser. You should notice that the page still says <strong class="source-inline">Hello, world!</strong> This is because we have not supplied a <strong class="source-inline">name</strong> parameter. You can add your name into the URL, for example, <strong class="source-inline">http://127.0.0.1:8000?name=Ben</strong>:<div id="_idContainer057" class="IMG---Figure"><img src="image/B15509_01_27.jpg" alt="Figure 1.27: Setting the name in the URL&#13;&#10;"/></div><p class="figure-caption">Figure 1.27: Setting the name in the URL</p></li>
				<li>Try adding two names, for example, <strong class="source-inline">http://127.0.0.1:8000?name=Ben&amp;name=John</strong>. As we mentioned, the last value for the parameter is retrieved with the <strong class="source-inline">get</strong> function, so you should see <strong class="source-inline">Hello, John!</strong>:<div id="_idContainer058" class="IMG---Figure"><img src="image/B15509_01_28.jpg" alt="Figure 1.28: Setting multiple names in the URL&#13;&#10;"/></div><p class="figure-caption">Figure 1.28: Setting multiple names in the URL</p></li>
				<li>Try setting no name, like this: <strong class="source-inline">http://127.0.0.1:8000?name=</strong>. The page should go back to displaying <strong class="source-inline">Hello, world!</strong>:<div id="_idContainer059" class="IMG---Figure"><img src="image/B15509_01_29.jpg" alt="Figure 1.29: No name set in the URL&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.29: No name set in the URL</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You might wonder why we set <strong class="source-inline">name</strong> to the default <strong class="source-inline">world</strong> by using <strong class="source-inline">or</strong> instead of passing <strong class="source-inline">'world'</strong> as the default value to <strong class="source-inline">get</strong>. Consider what happened in <em class="italic">step 5</em> when we passed in a blank value for the <strong class="source-inline">name</strong> parameter. If we had passed <strong class="source-inline">'world'</strong> as a default value for <strong class="source-inline">get</strong>, then the <strong class="source-inline">get</strong> function would still have returned an empty string. This is because a value <strong class="bold">is</strong> set for <strong class="source-inline">name</strong>, it's just that it's blank. Keep this in mind when developing your views, as there is a difference between no value being set, and a blank value being set. Depending on your use case, you might choose to pass the default value for <strong class="source-inline">get</strong>.</p>
			<p>In this exercise, we retrieved values from the URL in our view using the <strong class="source-inline">GET</strong> attribute of the incoming request. We saw how to set default values and which value is retrieved if multiple values are set for the same parameter.</p>
			<h2 id="_idParaDest-47"><a id="_idTextAnchor046"/>Exploring Django Settings</h2>
			<p>We haven't yet looked at how Django stores its settings. Now that we've seen the different parts of Django, it is a good time to examine the <strong class="source-inline">settings.py</strong> file. This file contains many settings that can be used to customize Django. A default <strong class="source-inline">settings.py</strong> file was created for you when you started the Bookr project. </p>
			<p>We will discuss some of the more important settings in the file now, and a few others that might be useful as you become more fluent with Django. You should open your <strong class="source-inline">settings.py</strong> file in PyCharm and follow along so you can see where and what the values are for your project.</p>
			<p>Each setting in this file is just a file-global variable. The order in which we will discuss the settings is the same order in which they appear in this file, although we may skip over some—for example, there is the <strong class="source-inline">ALLOWED_HOSTS</strong> setting between <strong class="source-inline">DEBUG</strong> and <strong class="source-inline">INSTALLED_APPS</strong>, which we won't cover in this part of the book (you'll see it in <em class="italic">Chapter 17</em>, <em class="italic">Deployment of a Django Application (Part 1 – Server Setup)</em>):</p>
			<p class="source-code">SECRET_KEY = '…'</p>
			<p>This is an automatically generated value that shouldn't be shared with anyone. It is used for hashing, tokens, and other cryptographic functions. If you had existing sessions in a cookie and changed this value, the sessions would no longer be valid.</p>
			<p class="source-code">DEBUG = True</p>
			<p>With this value set to <strong class="source-inline">True</strong>, Django will automatically display exceptions to the browser to allow you to debug any problems you encounter. It should be set to <strong class="source-inline">False</strong> when deploying your app to production:</p>
			<p class="source-code">INSTALLED_APPS = […]</p>
			<p>As you write your own Django apps (such as the <strong class="source-inline">reviews</strong> app) or install third-party applications (which will be covered in <em class="italic">Chapter 15</em>, <em class="italic">Django Third-Party Libraries</em>), they should be added to this list. As we've seen, it is not strictly necessary to add them here (our <strong class="source-inline">index</strong> view worked without our <strong class="source-inline">reviews</strong> app being in this list). However, for Django to be able to automatically find the app's templates, static files, migrations, and other configuration, it must be listed here:</p>
			<p class="source-code">ROOT_URLCONF = 'bookr.urls'</p>
			<p>This is the Python module that Django will load first to find URLs. Note that it is the file we added our index view URL map to previously:</p>
			<p class="source-code">TEMPLATES = […]</p>
			<p>Right now, it's not too important to understand everything in this setting as you won't be changing it; the important line to point out is this one:</p>
			<p class="source-code">'APP_DIRS': True,</p>
			<p>This tells Django it should look in a <strong class="source-inline">templates</strong> directory inside each <strong class="source-inline">INSTALLED_APP</strong> when loading a template to render. We don't have a <strong class="source-inline">templates</strong> directory for <strong class="source-inline">reviews</strong> yet, but we will add one in the next exercise.</p>
			<p>Django has more settings available that aren't listed in the <strong class="source-inline">settings.py</strong> file, and so it will use its built-in defaults in these cases. You can also use the file to set arbitrary settings that you make up for your application. Third-party applications might want settings to be added here as well. In later chapters, we will add settings here for other applications. You can find a list of all settings, and their defaults, at <a href="https://docs.djangoproject.com/en/3.0/ref/settings/">https://docs.djangoproject.com/en/3.0/ref/settings/</a>.</p>
			<h3 id="_idParaDest-48"><a id="_idTextAnchor047"/>Using Settings in Your Code</h3>
			<p>It can sometimes be useful to refer to settings from <strong class="source-inline">settings.py</strong> in your own code, whether they be Django's built-in settings or ones you have defined yourself. You might be tempted to write code like this to do it:</p>
			<p class="source-code">from bookr import settings</p>
			<p class="source-code">if settings.DEBUG:  # check if running in DEBUG mode</p>
			<p class="source-code">    do_some_logging()</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="source-inline">#</strong> symbol in the preceding code snippet denotes a code comment. Comments are added into code to help explain specific bits of logic. </p>
			<p>This method is incorrect, for a number of reasons: </p>
			<ul>
				<li>It is possible to run Django and specify a different settings file to read from, in which case the previous code would cause an error as it would not be able to find that particular file. Or, if the file exists, the import would succeed but would contain the wrong settings.</li>
				<li>Django has settings that might not be listed in the <strong class="source-inline">settings.py</strong> file, and if they aren't, it will use its own internal defaults. For example, if you removed the <strong class="source-inline">DEBUG = True</strong> line from your <strong class="source-inline">settings.py</strong> file, Django would fall back to using its internal value for <strong class="source-inline">DEBUG</strong> (which is <strong class="source-inline">False</strong>). You would get an error if you tried to access it using <strong class="source-inline">settings.DEBUG</strong> directly, though.</li>
				<li>Third-party libraries can change how your settings are defined, so your <strong class="source-inline">settings.py</strong> file would look completely different. None of the expected variables may exist at all. The behavior of all these applications is beyond the scope of this book, but it is something to be aware of.</li>
			</ul>
			<p>The preferred way is to use <strong class="source-inline">django.conf</strong> module instead, like this:</p>
			<p class="source-code">from django.conf import settings  # import settings from here instead</p>
			<p class="source-code">if settings.DEBUG:</p>
			<p class="source-code">    do_some_logging()</p>
			<p>When importing <strong class="source-inline">settings</strong> from <strong class="source-inline">django.conf</strong>, Django mitigates the three issues we just discussed:</p>
			<ul>
				<li>Settings are read from whatever Django settings file has been specified.</li>
				<li>Any default settings values are interpolated.</li>
				<li>Django takes care of parsing any settings defined by a third-party library.</li>
			</ul>
			<p>In our new short example code snippet, even if <strong class="source-inline">DEBUG</strong> is missing from the <strong class="source-inline">settings.py</strong> file, it will fall back to the default value that Django has internally (which is <strong class="source-inline">False</strong>). The same is true for all other settings that Django defines; however, if you define your own custom settings in this file, Django will not have internal values for them, so in your code, you should have some provision for them not existing—how your code behaves is your choice and beyond the scope of this book.</p>
			<h2 id="_idParaDest-49"><a id="_idTextAnchor048"/>Finding HTML Templates in App Directories</h2>
			<p>Many options are available to tell Django how to find templates, which can be set in the <strong class="source-inline">TEMPLATES</strong> setting of <strong class="source-inline">settings.py</strong>, but the easiest one (for now) is to create a <strong class="source-inline">templates</strong> directory inside the <strong class="source-inline">reviews</strong> directory. Django will look in this (and in other apps' <strong class="source-inline">templates</strong> directories) because of <strong class="source-inline">APP_DIRS</strong> being <strong class="source-inline">True</strong> in the <strong class="source-inline">settings.py</strong> file, as we saw in the previous section.</p>
			<h2 id="_idParaDest-50"><a id="_idTextAnchor049"/>Exercise 1.05: Creating a Templates Directory and a Base Template</h2>
			<p>In this exercise, you will create a <strong class="source-inline">templates</strong> directory for the <strong class="source-inline">reviews</strong> app. Then, you will add an HTML template file that Django will be able to render to an HTTP response:</p>
			<ol>
				<li value="1">We discussed <strong class="source-inline">settings.py</strong> and its <strong class="source-inline">INSTALLED_APPS</strong> setting in the previous section (<em class="italic">Exploring Django Settings</em>). We need to add the <strong class="source-inline">reviews</strong> app to <strong class="source-inline">INSTALLED_APPS</strong> for Django to be able to find templates. Open <strong class="source-inline">settings.py</strong> in PyCharm. Update the <strong class="source-inline">INSTALLED_APPS</strong> setting and add <strong class="source-inline">reviews</strong> to the end. It should look like this:<p class="source-code">INSTALLED_APPS = ['django.contrib.admin',\</p><p class="source-code">                  'django.contrib.auth',\</p><p class="source-code">                  'django.contrib.contenttypes',\</p><p class="source-code">                  'django.contrib.sessions',\</p><p class="source-code">                  'django.contrib.messages',\</p><p class="source-code">                  'django.contrib.staticfiles',\</p><p class="source-code">                  <strong class="bold">'reviews'</strong>]</p><p>In PyCharm, the file should look like this now:</p><div id="_idContainer060" class="IMG---Figure"><img src="image/B15509_01_30.jpg" alt="Figure 1.30: The reviews app added to settings.py&#13;&#10;"/></div><p class="figure-caption">Figure 1.30: The reviews app added to settings.py</p></li>
				<li>Save and close <strong class="source-inline">settings.py</strong>.</li>
				<li>In the PyCharm Project browser, right-click the <strong class="source-inline">reviews</strong> directory and select <strong class="source-inline">New</strong> -&gt; <strong class="source-inline">Directory</strong>:<div id="_idContainer061" class="IMG---Figure"><img src="image/B15509_01_31.jpg" alt="Figure 1.31: Creating a new directory inside the reviews directory&#13;&#10;"/></div><p class="figure-caption">Figure 1.31: Creating a new directory inside the reviews directory</p></li>
				<li>Enter the name <strong class="source-inline">templates</strong> and click <strong class="source-inline">OK</strong> to create it:<div id="_idContainer062" class="IMG---Figure"><img src="image/B15509_01_32.jpg" alt="Figure 1.32: Name the directory templates&#13;&#10;"/></div><p class="figure-caption">Figure 1.32: Name the directory templates</p></li>
				<li>Right-click the newly created <strong class="source-inline">templates</strong> directory and select <strong class="source-inline">New</strong> -&gt; <strong class="source-inline">HTML File</strong>:<div id="_idContainer063" class="IMG---Figure"><img src="image/B15509_01_33.jpg" alt="Figure 1.33: Creating a new HTML file in the templates directory&#13;&#10;"/></div><p class="figure-caption">Figure 1.33: Creating a new HTML file in the templates directory</p></li>
				<li>In the window that appears, enter the name <strong class="source-inline">base.html</strong>, leave <strong class="source-inline">HTML 5 file</strong> selected, and then press <strong class="source-inline">Enter</strong> to create the file:<p> </p><div id="_idContainer064" class="IMG---Figure"><img src="image/B15509_01_34.jpg" alt="Figure 1.34: The New HTML File window&#13;&#10;"/></div><p class="figure-caption">Figure 1.34: The New HTML File window</p></li>
				<li>After PyCharm creates the file, it will automatically open it too. It will have this content:<p class="source-code">&lt;!DOCTYPE html&gt;</p><p class="source-code">&lt;html lang="en"&gt;</p><p class="source-code">&lt;head&gt;</p><p class="source-code">    &lt;meta charset="UTF-8"&gt;</p><p class="source-code">    &lt;title&gt;Title&lt;/title&gt;</p><p class="source-code">&lt;/head&gt;</p><p class="source-code">&lt;body&gt;</p><p class="source-code">&lt;/body&gt;</p><p class="source-code">&lt;/html&gt;</p></li>
				<li>Between the <strong class="source-inline">&lt;body&gt;…&lt;/body&gt;</strong> tags, add a short message to verify that the template is being rendered:<p class="source-code">&lt;body&gt;</p><p class="source-code">    Hello from a template!</p><p class="source-code">&lt;/body&gt;</p><p>Here is how it will look like in PyCharm:</p><div id="_idContainer065" class="IMG---Figure"><img src="image/B15509_01_35.jpg" alt="Figure 1.35: The base.html template with some example text&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.35: The base.html template with some example text</p>
			<p>In this exercise, we created a <strong class="source-inline">templates</strong> directory for the <strong class="source-inline">reviews</strong> app and added an HTML template to it. The HTML template will be rendered once we implement the use of the <strong class="source-inline">render</strong> function on our view.</p>
			<h2 id="_idParaDest-51"><a id="_idTextAnchor050"/>Rendering a Template with the render Function</h2>
			<p>We now have a template to use, but we need to update our <strong class="source-inline">index</strong> view so that it renders the template instead of returning the <strong class="source-inline">Hello (name)!</strong> text that it is currently displaying (refer to <em class="italic">Figure 1.29</em> for how it currently looks). We will do this by using the <strong class="source-inline">render</strong> function and providing the name of the template. <strong class="source-inline">render</strong> is a shortcut function that returns an <strong class="source-inline">HttpResponse</strong> instance. There are other ways to render a template to provide more control over how it is rendered, but for now, this function is fine for our needs. <strong class="source-inline">render</strong> takes at least two arguments: the first is always the request that was passed to the view, and the second is the name/relative path of the template being rendered. We will also call it with a third argument, the render context that contains all the variables that will be available in the template—more on this in <em class="italic">Exercise 1.07</em>, <em class="italic">Using Variables in Templates</em>.</p>
			<h2 id="_idParaDest-52"><a id="_idTextAnchor051"/>Exercise 1.06: Rendering a Template in a View</h2>
			<p>In this exercise, you will update your <strong class="source-inline">index</strong> view function to render the HTML template you created in <em class="italic">Exercise 1.05</em>, <em class="italic">Creating a Templates Directory and a Base Template</em>. You will make use of the <strong class="source-inline">render</strong> function, which loads your template from disk, renders it, and sends it to the browser. This will replace the static text you are currently returning from the <strong class="source-inline">index</strong> view function:</p>
			<ol>
				<li value="1">In PyCharm, open <strong class="source-inline">views.py</strong> in the <strong class="source-inline">reviews</strong> directory.</li>
				<li>We no longer manually create an <strong class="source-inline">HttpResponse</strong> instance, so remove the <strong class="source-inline">HttpResponse</strong> import line:<p class="source-code">from django.http import HttpResponse</p></li>
				<li>Replace it with an import of the <strong class="source-inline">render</strong> function from <strong class="source-inline">django.shortcuts</strong>:<p class="source-code">from django.shortcuts import render</p></li>
				<li>Update the <strong class="source-inline">index</strong> function so that instead of returning <strong class="source-inline">HttpResponse</strong>, it's returning a call to <strong class="source-inline">render</strong>, passing in the <strong class="source-inline">request</strong> instance and template name:<p class="source-code">def index(request):</p><p class="source-code">    return render(request, "base.html")</p><p>Here is how it will look like in PyCharm:</p><div id="_idContainer066" class="IMG---Figure"><img src="image/B15509_01_36.jpg" alt="Figure 1.36: Completed views.py file&#13;&#10;"/></div><p class="figure-caption">Figure 1.36: Completed views.py file</p></li>
				<li>Start the dev server if it's not already running. Then, open your web browser and refresh <strong class="source-inline">http://127.0.0.1:8000</strong>. You should see the <strong class="source-inline">Hello from a template!</strong> message rendered, as in <em class="italic">Figure 1.37</em>:<div id="_idContainer067" class="IMG---Figure"><img src="image/B15509_01_37.jpg" alt="Figure 1.37: Your first rendered HTML template&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.37: Your first rendered HTML template</p>
			<h2 id="_idParaDest-53"><a id="_idTextAnchor052"/>Rendering Variables in Templates</h2>
			<p>Templates aren't just static HTML. Most of the time, they will contain variables that are interpolated as part of the rendering process. These variables are passed from the view to the template using a context: a dictionary (or dictionary-like object) that contains names for all the variables a template can use. We'll take Bookr again as an example. Without variables in your template, you would need a different HTML file for each book you wanted to display. Instead, we use a variable such as <strong class="source-inline">book_name</strong> inside the template, and then the view provides the template with a <strong class="source-inline">book_name</strong> variable set to the title of the book model it has loaded. When displaying a different book, the HTML does not need to change; the view just passes a different book to it. You can see how model, view, and template are all now coming together.</p>
			<p>Unlike some other languages, such as PHP, variables must be explicitly passed to the template, and variables in the view aren't automatically available to the template. This is for security as well as to avoid accidentally polluting the template's namespace (we don't want any unexpected variables in the template).</p>
			<p>Inside a template, variables are denoted by double braces, <strong class="source-inline">{{ }}</strong>. While not strictly a standard, this style is quite common and used in other templating tools such as Vue.js and Mustache. Symfony (a PHP framework) also uses double braces in its Twig templating language, so you might have seen them used similarly there.</p>
			<p>To render a variable in a template, simply wrap it with braces: <strong class="source-inline">{{ book_name }}</strong>. Django will automatically escape HTML in output so that you can include special characters (such as <strong class="source-inline">&lt;</strong> or <strong class="source-inline">&gt;</strong>) in your variable without worrying about it garbling your output. If a variable is not passed to a template, Django will simply render nothing at that location, instead of throwing an exception.</p>
			<p>There are many more ways to render a variable differently using filters, but these will be covered in <em class="italic">Chapter 3, URL Routers, Views, and Templates</em>.</p>
			<h2 id="_idParaDest-54"><a id="_idTextAnchor053"/>Exercise 1.07: Using Variables in Templates</h2>
			<p>We'll put a simple variable inside the <strong class="source-inline">base.html</strong> file to demonstrate how Django's variable interpolation works:</p>
			<ol>
				<li value="1">In PyCharm, open <strong class="source-inline">base.html</strong>.</li>
				<li>Update the <strong class="source-inline">&lt;body&gt;</strong> element so it contains a place to render the <strong class="source-inline">name</strong> variable:<p class="source-code">&lt;body&gt;</p><p class="source-code">Hello, {{ name }}!</p><p class="source-code">&lt;/body&gt;</p></li>
				<li>Go back to your web browser and refresh (you should still be at <strong class="source-inline">http://127.0.0.1:8000</strong>). You will see that the page now displays <strong class="source-inline">Hello, !</strong>. This is because we have not set the <strong class="source-inline">name</strong> variable in the rendering context:<div id="_idContainer068" class="IMG---Figure"><img src="image/B15509_01_38.jpg" alt="Figure 1.38: No value rendered in the template because no context was set&#13;&#10;"/></div><p class="figure-caption">Figure 1.38: No value rendered in the template because no context was set</p></li>
				<li>Open <strong class="source-inline">views.py</strong> and add a variable called <strong class="source-inline">name</strong>, set to the value <strong class="source-inline">"world"</strong>, inside the <strong class="source-inline">index</strong> function:<p class="source-code">def index(request):</p><p class="source-code">    name = "world"</p><p class="source-code">    return render(request, "base.html")</p></li>
				<li>Refresh your browser again. You should notice that nothing has changed: anything we want to render must be explicitly passed to the <strong class="source-inline">render</strong> function as <strong class="source-inline">context</strong>. This is the dictionary of variables that are made available when rendering. </li>
				<li>Add the <strong class="source-inline">context</strong> dictionary as the third argument to the <strong class="source-inline">render</strong> function. Change your <strong class="source-inline">render</strong> line to this:<p class="source-code">return render(request, "base.html", {"name": name})</p><p>In PyCharm, this should appear as follows:</p><div id="_idContainer069" class="IMG---Figure"><img src="image/B15509_01_39.jpg" alt="Figure 1.39: views.py with the name variable sent in the render context&#13;&#10;"/></div><p class="figure-caption">Figure 1.39: views.py with the name variable sent in the render context</p></li>
				<li>Refresh your browser again and you'll see it now says <strong class="source-inline">Hello, world!</strong>:<div id="_idContainer070" class="IMG---Figure"><img src="image/B15509_01_40.jpg" alt="Figure 1.40: A template rendered with a variable&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.40: A template rendered with a variable</p>
			<p>In this exercise, we combined the template we created in the previous exercise with the <strong class="source-inline">render</strong> function, to render an HTML page with the <strong class="source-inline">name</strong> variable that was passed to it inside a <strong class="source-inline">context</strong> dictionary.</p>
			<h2 id="_idParaDest-55"><a id="_idTextAnchor054"/>Debugging and Dealing with Errors</h2>
			<p>When programming, unless you're the perfect programmer who never makes mistakes, you'll probably have to deal with errors or debug your code at some point. When there is an error in your program, there are usually two ways to tell: either your code will raise an exception, or you will get an unexpected output or results when viewing the page. Exceptions you will probably see more often, as there are many accidental ways to cause them. If your code is generating unexpected output, but not raising any exceptions, you will probably want to use the PyCharm debugger to find out why.</p>
			<h2 id="_idParaDest-56"><a id="_idTextAnchor055"/>Exceptions</h2>
			<p>If you have worked with Python or other programming languages before, you have probably come across exceptions. If not, here's a quick introduction. Exceptions are raised (or thrown in other languages) when an error occurs. The execution of the program stops at that point in the code, and the exception travels back up the function call chain until it is caught. If it is not caught, then the program will crash, sometimes with an error message describing the exception and where it occurred. There are exceptions that are raised by Python itself, and your code can raise exceptions to quickly stop execution at any point. Some common exceptions that you might see when programming Python are listed here:</p>
			<ul>
				<li><strong class="source-inline">IndentationError</strong><p>Python will raise this if your code is not correctly indented or has mixed tabs and spaces.</p></li>
				<li><strong class="source-inline">SyntaxError</strong><p>Python raises this error if your code has invalid syntax:</p><p class="source-code">&gt;&gt;&gt; a === 1</p><p class="source-code">  File "&lt;stdin&gt;", line 1</p><p class="source-code">    a === 1</p><p class="source-code">        ^</p><p class="source-code">SyntaxError: invalid syntax</p></li>
				<li><strong class="source-inline">ImportError</strong><p>This is raised when an import fails, for example, if trying to import from a file that does not exist or trying to import a name that is not set in a file:</p><p class="source-code">&gt;&gt;&gt; import missing_file</p><p class="source-code">Traceback (most recent call last):</p><p class="source-code">  File "&lt;stdin&gt;", line 1, in &lt;module&gt;</p><p class="source-code">ImportError: No module named missing_file</p></li>
				<li><strong class="source-inline">NameError</strong><p>This is raised when trying to access a variable that has not yet been set:</p><p class="source-code">&gt;&gt;&gt; a = b + 5</p><p class="source-code">Traceback (most recent call last):</p><p class="source-code">  File "&lt;stdin&gt;", line 1, in &lt;module&gt;</p><p class="source-code">NameError: name 'b' is not defined</p></li>
				<li><strong class="source-inline">KeyError</strong><p>This is raised when accessing a key that is not set in a dictionary (or dictionary-like object):</p><p class="source-code">&gt;&gt;&gt; d = {'a': 1}</p><p class="source-code">&gt;&gt;&gt; d['b']</p><p class="source-code">Traceback (most recent call last):</p><p class="source-code">  File "&lt;stdin&gt;", line 1, in &lt;module&gt;</p><p class="source-code">KeyError: 'b'</p></li>
				<li><strong class="source-inline">IndexError</strong><p>This is raised when accessing an index outside the length of a list:</p><p class="source-code">&gt;&gt;&gt; l = ['a', 'b']</p><p class="source-code">&gt;&gt;&gt; l[3]</p><p class="source-code">Traceback (most recent call last):</p><p class="source-code">  File "&lt;stdin&gt;", line 1, in &lt;module&gt;</p><p class="source-code">IndexError: list index out of range</p></li>
				<li><strong class="source-inline">TypeError</strong><p>This is raised when trying to perform an operation on an object that does not support it, or when using two objects of the wrong type—for example, trying to add a string to an integer:</p><p class="source-code">&gt;&gt;&gt; 1 + '1'</p><p class="source-code">Traceback (most recent call last):</p><p class="source-code"> <a id="_idTextAnchor056"/> File "&lt;stdin&gt;", line 1, in &lt;module&gt;</p><p class="source-code">TypeError: unsupported operand type(s) for +: 'int' and 'str'</p></li>
			</ul>
			<p>Django also raises its own custom exceptions, and you will be introduced to them throughout the book.</p>
			<p>When running the Django development server with <strong class="source-inline">DEBUG = True</strong> in your <strong class="source-inline">settings.py</strong> file, Django will automatically capture exceptions that occur in your code (instead of crashing). It will then generate an HTTP response showing you a stack trace and other information to help you debug the problem. When running in production, <strong class="source-inline">DEBUG</strong> should be set to <strong class="source-inline">False</strong>. Django will then return a standard internal server error page, without any sensitive information. You also have the option to display a custom error page.</p>
			<h2 id="_idParaDest-57"><a id="_idTextAnchor057"/>Exercise 1.08: Generating and Viewing Exceptions</h2>
			<p>Let's create a simple exception in our view so you are familiar with how Django displays them. In this case, we'll try to use a variable that doesn't exist, which will raise <strong class="source-inline">NameError</strong>:</p>
			<ol>
				<li value="1">In PyCharm, open <strong class="source-inline">views.py</strong>. In the <strong class="source-inline">index</strong> view function, change the context being sent to the <strong class="source-inline">render</strong> function so that it's using a variable that doesn't exist. We'll try to send <strong class="source-inline">invalid_name</strong> in the context dictionary, instead of <strong class="source-inline">name</strong>. Don't change the context dictionary key, just its value:<p class="source-code">return render(request, "base.html", {"name": invalid_name})</p></li>
				<li>Go back to your browser and refresh the page. You should see a screen like <em class="italic">Figure 1.41</em>:<div id="_idContainer071" class="IMG---Figure"><img src="image/B15509_01_41.jpg" alt="Figure 1.41: A Django exception screen&#13;&#10;"/></div><p class="figure-caption">Figure 1.41: A Django exception screen</p></li>
				<li>The first couple of header lines on the page tell you the error that occurred:<p class="source-code">NameError at /</p><p class="source-code">name 'invalid_name' is not defined</p></li>
				<li>Below the header is a traceback to where the exception occurred. You can click on the various lines of code to expand them and see the surrounding code or click <strong class="source-inline">Local vars</strong> for each frame to expand them and see what the values of the variables are:<div id="_idContainer072" class="IMG---Figure"><img src="image/B15509_01_42.jpg" alt="Figure 1.42: The line that causes the exception&#13;&#10;"/></div><p class="figure-caption">Figure 1.42: The line that causes the exception</p></li>
				<li>In our case, we can see the exception was raised on <em class="italic">line 6</em> of our <strong class="source-inline">views.py</strong> file and, expanding <strong class="source-inline">Local vars</strong>, we see <strong class="source-inline">name</strong> has the value <strong class="source-inline">world</strong> and the only other variable is the incoming <strong class="source-inline">request</strong> (<em class="italic">Figure 1.42</em>).</li>
				<li>Go back to <strong class="source-inline">views.py</strong> and fix your <strong class="source-inline">NameError</strong> by renaming <strong class="source-inline">invalid_name</strong> back to <strong class="source-inline">name</strong>. </li>
				<li>Save the file and refresh your browser and <strong class="source-inline">Hello World</strong> should be displayed again (as in <em class="italic">Figure 1.40</em>).</li>
			</ol>
			<p>In this exercise, we made our Django code raise an exception (<strong class="source-inline">NameError</strong>) by trying to use a variable that had not been set. We saw that Django automatically sent details of this exception and a stack trace to the browser to help us find the cause of the error. We then reverted our code change to make sure our view worked properly.</p>
			<h2 id="_idParaDest-58"><a id="_idTextAnchor058"/>Debugging</h2>
			<p>When you're trying to find problems in your code, it can help to use a debugger. This is a tool that lets you go through your code line by line, rather than executing it all at once. Each time the debugger is paused on a particular line of code, you can see the values of all the current variables. This is very useful for finding out errors in your code that don't raise exceptions.</p>
			<p>For example, in Bookr, we have talked about having a view that fetches a list of books from the database and renders them in an HTML template. If you view the page in the browser, you might see only one book when you expect several. You could have the execution pause inside your view function and see what values were fetched from the database. If your view is only receiving one book from the database, you know there is a problem with your database querying somewhere. If your view is successfully fetching multiple books but only one is being rendered, then it's probably a problem with the template. Debugging helps you narrow down faults like this.</p>
			<p>PyCharm has a built-in debugger to make it easy to step through your code and see what is happening on each line. To tell the debugger where to stop the execution of the code, you need to set a <em class="italic">breakpoint</em> on one or more lines of code. They are named as such because the execution of the code will <em class="italic">break</em> (stop) at that <em class="italic">point</em>.</p>
			<p>For breakpoints to be activated, PyCharm needs to be set to run your project in its debugger. There is a small performance penalty but it usually is not noticeable, so you might choose to always run your code inside the debugger so that you can quickly set a breakpoint without having to stop and restart the Django dev server.</p>
			<p>Running the Django dev server inside the debugger is as simple as clicking the debug icon instead of the play icon (see <em class="italic">Figure 1.19</em>) to start it.</p>
			<h2 id="_idParaDest-59"><a id="_idTextAnchor059"/>Exercise 1.09: Debugging Your Code</h2>
			<p>In this exercise, you will learn the basics of the PyCharm debugger. You will run the Django dev server in the debugger and then set a breakpoint in your view function to pause execution so you can examine the variables:</p>
			<ol>
				<li value="1">If the Django dev server is running, stop it by clicking the <em class="italic">stop</em> button in the top-right corner of the PyCharm window:<div id="_idContainer073" class="IMG---Figure"><img src="image/B15509_01_43.jpg" alt="Figure 1.43: Stop button in the top-right corner of the PyCharm window&#13;&#10;"/></div><p class="figure-caption">Figure 1.43: Stop button in the top-right corner of the PyCharm window</p></li>
				<li>Start the Django dev server again inside the debugger by clicking the debug icon just to the left of the stop button (<em class="italic">Figure 1.43</em>). </li>
				<li>The server will take a few seconds to start, then you should be able to refresh the page in your browser to make sure it's still loading—you shouldn't notice any changes; all the code is executed the same as before.</li>
				<li>Now we can set a breakpoint that will cause execution to stop so we can see the state of the program. In PyCharm, click just to the right of the line numbers, on line 5, in the gutter on the left of the editor pane. A red circle will appear to indicate the breakpoint is now active:<div id="_idContainer074" class="IMG---Figure"><img src="image/B15509_01_44.jpg" alt="Figure 1.44: A breakpoint on line 5&#13;&#10;"/></div><p class="figure-caption">Figure 1.44: A breakpoint on line 5</p></li>
				<li>Go back to your browser and refresh the page. Your browser will not display any content; instead, it will just continue to try to load the page. Depending on your operating system, PyCharm should become active again; if not, bring it to the foreground. You should see that line 5 is highlighted and at the bottom of the window, the debugger is shown. The stack frames (the chain of functions that were called to get to the current line) are on the left and current variables of the function are on the right:<div id="_idContainer075" class="IMG---Figure"><img src="image/B15509_01_45.jpg" alt="Figure 1.45: The debugger paused with the current line (5) highlighted&#13;&#10;"/></div><p class="figure-caption">Figure 1.45: The debugger paused with the current line (5) highlighted</p></li>
				<li>There is currently one variable in scope, <strong class="source-inline">request</strong>. If you click the toggle triangle to the left of its name, you can show or hide the attributes it has set:<p> </p><div id="_idContainer076" class="IMG---Figure"><img src="image/B15509_01_46.jpg" alt="Figure 1.46: The attributes of the request variable&#13;&#10;"/></div><p class="figure-caption">Figure 1.46: The attributes of the request variable</p><p>For example, if you scroll down through the list of attributes, you can see that the method is <strong class="source-inline">GET</strong> and the path is <strong class="source-inline">/</strong>.</p></li>
				<li>The actions bar, shown in <em class="italic">Figure 1.47</em>, is above the stack frames and variables. Its buttons (from left to right) are as follows:<div id="_idContainer077" class="IMG---Figure"><img src="image/B15509_01_47.jpg" alt="Figure 1.47: The actions bar&#13;&#10;"/></div><p class="figure-caption">Figure 1.47: The actions bar</p><ul><li><em class="italic">Step Over</em><p>Execute the current line of code and continue to the next line.</p></li><li><em class="italic">Step Into</em><p>Step into the current line. For example, if the line contained a function, it would continue with the debugger inside this function.</p></li><li><em class="italic">Step Into My Code</em><p>Step into the line being executed but continue until it finds code you have written. For example, if you're stepping into a third-party library code that later calls your code, it will not show you the third-party code, instead of continuing through until it returns to the code that you have written.</p></li><li><em class="italic">Force Step Into</em><p>Step into code that would normally not be stepped into, such as Python standard library code. This is only available in some rare cases and is normally not used.</p></li><li><em class="italic">Step Out</em><p>Return back out of the current code to the function or method that called it. The opposite of the <em class="italic">Step In</em> action.</p></li><li><em class="italic">Run To Cursor</em><p>If you have a line of code further along from where currently are that you want to execute without having to click <em class="italic">Step Over</em> for all the lines in between, click to put your cursor on that line. Then, click <em class="italic">Run To Cursor</em>, and execution will continue until that line.</p><p>Note that not all buttons are useful all the time. For example, it can be easy to step out of your view and end up confusing Django library code.</p></li></ul></li>
				<li>Click the <em class="italic">Step Over</em> button once to execute line 5. </li>
				<li>You can see the <strong class="source-inline">name</strong> variable has been added to the list of variables in the debugger view, and its value is <strong class="source-inline">world</strong>:<div id="_idContainer078" class="IMG---Figure"><img src="image/B15509_01_48.jpg" alt="Figure 1.48: The new name variable is now in scope, with the value world&#13;&#10;"/></div><p class="figure-caption">Figure 1.48: The new name variable is now in scope, with the value world</p></li>
				<li>We are now at the end of our <strong class="source-inline">index</strong> view function, and if we were to step over this line of code, it would jump to Django library code, which we don't want to see. To continue executing and send the response back to your browser, click the <strong class="source-inline">Resume Program</strong> button on the left of the window (<em class="italic">Figure 1.49</em>). You should see that your browser has now loaded the page again:<p> </p><div id="_idContainer079" class="IMG---Figure"><img src="image/B15509_01_49.jpg" alt="Figure 1.49: Actions to control execution—the green play icon &#13;&#10;is the Resume Program button&#13;&#10;"/></div><p class="figure-caption">Figure 1.49: Actions to control execution—the green play icon is the Resume Program button</p><p>There are more buttons in <em class="italic">Figure 1.49</em>; from the top, they are <strong class="source-inline">Rerun</strong> (stops the program and restarts it), <strong class="source-inline">Resume Program</strong> (continues running until the next breakpoint), <strong class="source-inline">Pause Program</strong> (breaks the program at its current execution point), <strong class="source-inline">Stop</strong> (stops the debugger), <strong class="source-inline">View Breakpoints</strong> (opens a window to see all breakpoints you have set), and <strong class="source-inline">Mute Breakpoints</strong> (which will toggle all breakpoints on or off, but not remove them).</p></li>
				<li>For now, turn off the breakpoint in PyCharm by clicking it (the red circle next to line 5):<div id="_idContainer080" class="IMG---Figure"><img src="image/B15509_01_50.jpg" alt="Figure 1.50: Clicking the breakpoint that was on line 5 disables it&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.50: Clicking the breakpoint that was on line 5 disables it</p>
			<p>This is just a quick introduction to how to set breakpoints in PyCharm. If you have used debugging features in other IDEs, then you should be familiar with the concepts—you can step through code, step in and out of functions, or evaluate expressions. Once you have set a breakpoint, you can right-click on it to change options. For example, you can make the breakpoint conditional so that execution stops only under certain circumstances. All this is beyond the scope of this book but it's useful to know about when trying to solve problems in your code.</p>
			<h2 id="_idParaDest-60"><a id="_idTextAnchor060"/>Activity 1.01: Creating a Site Welcome Screen</h2>
			<p>The <a id="_idTextAnchor061"/>Bookr website that we are building needs to have a splash page that welcomes users and lets them know what site they are on. It will also contain links to other parts of the site, but these will be added in later chapters. For now, you will create a page with a welcome message.</p>
			<p>These steps will help you complete the activity:</p>
			<ol>
				<li value="1">In your <strong class="source-inline">index</strong> view, render the <strong class="source-inline">base.html</strong> template.</li>
				<li>Update the <strong class="source-inline">base.html</strong> template to contain the welcome message. It should be in both the <strong class="source-inline">&lt;title&gt;</strong> tag in <strong class="source-inline">&lt;head&gt;</strong> and in a new <strong class="source-inline">&lt;h1&gt;</strong> tag in the body.<p>After completing the activity, you should be able to see something like this:</p><div id="_idContainer081" class="IMG---Figure"><img src="image/B15509_01_51.jpg" alt="Figure 1.51: Bookr welcome page&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.51: Bookr welcome page</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<h2 id="_idParaDest-61"><a id="_idTextAnchor062"/>Activity 1.02: Book Search Scaffold</h2>
			<p>A useful featur<a id="_idTextAnchor063"/>e for a site like Bookr is the ability to search through the data to find something on the site quickly. Bookr will implement book searching, to allow users to find a particular book by part of its title. While we don't have any books to find yet, we can still implement a page that shows the text the user searched for. The user enters the search string as part of the URL parameters. We will implement the searching and a form for easy text entry in <em class="italic">Chapter 6</em>, <em class="italic">Forms</em>.</p>
			<p>These steps will help you complete the activity:</p>
			<ol>
				<li value="1">Create a search result HTML template. It should include a variable placeholder to show the search word(s) that were passed in through the render context. Show the passed-in variable in the <strong class="source-inline">&lt;title&gt;</strong> and <strong class="source-inline">&lt;h1&gt;</strong> tags. Use an <strong class="source-inline">&lt;em&gt;</strong> tag around the search text in the body to make it italic.</li>
				<li>Add a search view function in <strong class="source-inline">views.py</strong>. The view should read a search string from the URL parameters (in the request's <strong class="source-inline">GET</strong> attribute). It should then render the template you created in the previous step, passing in the search value to be substituted, using the context dictionary.</li>
				<li>Add a URL mapping to your new view to <strong class="source-inline">urls.py</strong>. The URL can be something like <strong class="source-inline">/book-search</strong>.</li>
			</ol>
			<p>After completing this activity, you should be able to pass in a search value through the URL's parameters and see it rendered on the resulting page. It should look like this:</p>
			<p> </p>
			<div>
				<div id="_idContainer082" class="IMG---Figure">
					<img src="image/B15509_01_52.jpg" alt="Figure 1.52: Searching for Web Development with Django&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.52: Searching for Web Development with Django</p>
			<p>You should also be able to pass in special HTML characters such as <strong class="source-inline">&lt;</strong> and <strong class="source-inline">&gt;</strong> to see how Django automatically escapes them in the template:</p>
			<div>
				<div id="_idContainer083" class="IMG---Figure">
					<img src="image/B15509_01_53.jpg" alt="Figure 1.53: Notice how HTML characters are escaped so we are protected from tag injection&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.53: Notice how HTML characters are escaped so we are protected from tag injection</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="http://packt.live/2Nh1NTJ">http://packt.live/2Nh1NTJ</a>.</p>
			<p>You have scaffolded the book search view and can demonstrate how variables are read from the <strong class="source-inline">GET</strong> parameters. You can also use this view to test how Django escapes special HTML characters automatically in a template. The search view does not actually search or show results yet, as there are no books in the database, but this will be added in <em class="italic">Chapter 6</em>, <em class="italic">Forms</em>.</p>
			<h1 id="_idParaDest-62"><a id="_idTextAnchor064"/>Summary</h1>
			<p>This chapter was a quick introduction to Django. You first got up to speed on the HTTP protocol and the structure of HTTP requests and responses. We then saw how Django uses the MVT paradigm, and then how it parses a URL, generates an HTTP request, and sends it to a view to get an HTTP response. We scaffolded the Bookr project and then created the <strong class="source-inline">reviews</strong> app for it. We then built two example views to illustrate how to get data from a request and use it when rendering templates. You should have experimented to see how Django escapes output in HTML when rendering a template.</p>
			<p>You did all this with the PyCharm IDE, and you learned how to set it up to debug your application. The debugger will help you find out why things aren't working as they should. In the next chapter, you will start to learn about Django's database integration and its model system, so you can start storing and retrieving real data for your application.</p>
		</div>
		<div>
			<div id="_idContainer085" class="Content">
			</div>
		</div>
	</body></html>