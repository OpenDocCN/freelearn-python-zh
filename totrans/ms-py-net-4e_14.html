<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer283">
    <h1 class="chapterNumber">14</h1>
    <h1 class="chapterTitle" id="_idParaDest-289">Working with Git</h1>
    <p class="normal">We have worked on various aspects of network automation with Python, Ansible, and many other tools. In the examples you have been following along with in the first 13 chapters of this book, we have used over 150 files containing over 5,300 lines of code. That’s pretty good for network engineers who may have been working primarily with the command-line interface before reading this book! With our new scripts and tools, we are ready to go out and conquer our network tasks, right? Well, not so fast, my fellow network ninjas.</p>
    <p class="normal">There are several things we need to consider before we get into the meat of the tasks. We’ll run through these considerations and talk about how the version-control (or source-control) system Git can help us out.</p>
    <p class="normal">We’ll cover the following topics:</p>
    <ul>
      <li class="bulletList">Content management considerations and Git</li>
      <li class="bulletList">An introduction to Git</li>
      <li class="bulletList">Setting up Git</li>
      <li class="bulletList">Git usage examples</li>
      <li class="bulletList">Git with Python</li>
      <li class="bulletList">Automating configuration backup</li>
      <li class="bulletList">Collaborating with Git</li>
    </ul>
    <p class="normal">First, let’s talk about what exactly are these considerations and the role Git can play in helping us to manage them.</p>
    <h1 class="heading-1" id="_idParaDest-290">Content management considerations and Git</h1>
    <p class="normal">The first thing that we must consider when creating code files is how to keep them in a location where they can be retrieved and used<a id="_idIndexMarker1079"/> by us and others. Ideally, this location would be the only central place where the file is kept but also have backup copies available if needed. After the initial release of the code, we might add features and fix bugs in the future, so we would like a way to track these changes and keep the latest ones available for download. If the new changes do not work, we would like ways to roll back the changes and reflect the differences in the history of the file. This would give us a good idea of the evolution of the code files.</p>
    <p class="normal">The second question is about the collaborative process between our team members. If we work with other network engineers, we will most likely need to work collectively on the files. These can be Python scripts, Ansible Playbooks, Jinja2 templates, INI-style configuration files, and many others. The point is that any kind of text-based file should be tracked with multiple inputs that everybody on the team should be able to see.</p>
    <p class="normal">The third question is accountability. Once we have a system that allows for multiple inputs and changes, we need to mark these changes with an appropriate track record to reflect the owner of the change. The track record should also include a brief reason for the change so that the person reviewing the history can get an understanding of why the change was made.</p>
    <p class="normal">These are some of the main challenges a version-control (or source-control) system, such as Git, tries to solve. To be fair, the process of version control can exist in forms other than a dedicated software system. For example, if I open my Microsoft Word program, the file constantly saves itself, and I can go back in time to revisit the<a id="_idIndexMarker1080"/> changes or roll back to a previous version. That is one form of version control; however, the Word doc is hard to scale beyond my laptop. The version-control system we are focused on in this chapter is a standalone software tool with the primary purpose of tracking software changes.</p>
    <p class="normal">There is no shortage of different source-control tools in software engineering, both proprietary and open-source. Some popular open-source version-control systems are CVS, SVN, Mercurial, and Git. In this chapter, we will focus on the source-control system Git. Many of the software we have used in this book use the same version control system to track changes, collaborate on features, and communicate with its users. We will be taking a more in-depth look at the tool. Git is the de facto version-control system for many large, open-source projects, including Python and the Linux kernel.</p>
    <div class="note">
      <p class="normal">As of February 2017, the CPython development process has moved to GitHub. It has been a work in progress since January 2015. For more information, check out PEP 512 at: <a href="https://www.python.org/dev/peps/pep-0512"><span class="url">https://www.python.org/dev/peps/pep-0512</span></a>.</p>
    </div>
    <p class="normal">Before we dive into the working examples of Git, let’s look at the history and advantages of the Git system.</p>
    <h1 class="heading-1" id="_idParaDest-291">Introduction to Git</h1>
    <p class="normal">Git was created by Linus Torvalds, the creator of the Linux kernel, in April 2005. With his dry wit, he has affectionately called the tool “the information manager from hell.” In an interview with the Linux Foundation, Linus mentioned that he<a id="_idIndexMarker1081"/> felt source-control management was just about the least interesting thing in the computing world (<a href="https://web.archive.org/web/20210419173925/https://www.linuxfoundation.org/blog/2015/04/10-years-of-git-an-interview-with-git-creator-linus-torvalds/"><span class="url">https://www.linuxfoundation.org/blog/2015/04/10-years-of-git-an-interview-with-git-creator-linus-torvalds/</span></a>). Nevertheless, he created the tool after a disagreement between the Linux kernel developer community and BitKeeper, the proprietary system they were using at the time.</p>
    <p class="normal">What does the name Git stand for? In British English slang, a git is an insult denoting an unpleasant, annoying, childish person. With his dry humor, Linus said he is an egotistical bastard and that he named all of his projects after himself. First Linux, now Git. However, some suggested that the name is short for <strong class="keyWord">Global Information Tracker</strong> (<strong class="keyWord">GIT</strong>). You can be the judge of which explanation you like better.</p>
    <p class="normal">The project came together quickly. About 10 days after its creation (yeah, you read that right), Linus felt the basic ideas for Git were right and started to commit the first Linux kernel code with Git. The rest, as they say, is history. More than ten years after its creation, it is still meeting all the expectations of the Linux kernel project. It took over as the version-control system for many other open-source projects despite many developers’ inherent inertia in switching source-control systems. For the Python code base, after many years of hosting the code at Mercurial (<a href="https://hg.python.org/"><span class="url">https://hg.python.org/</span></a>), the project was<a id="_idIndexMarker1082"/> switched to Git on GitHub in February 2017.</p>
    <p class="normal">Now that we’ve been through the history of Git let’s take a look at some of its benefits.</p>
    <h2 class="heading-2" id="_idParaDest-292">Benefits of Git</h2>
    <p class="normal">The success of hosting large and distributed open-source projects, such as the Linux kernel and Python, speaks to the advantages<a id="_idIndexMarker1083"/> of Git. I mean, if this tool is good enough for the software development for the most popular operating system (in my opinion) and the most popular programming language (again, my opinion only) in the world, it is probably good enough for my hobby project. </p>
    <p class="normal">The popularity of Git is especially significant given that it is a relatively new source-control tool, and people do not tend to switch to a new tool unless it offers significant advantages over the old tool. Let’s look at some of the benefits of Git:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Distributed development</strong>: Git supports parallel, independent, and simultaneous development in private repositories offline. Many other version control systems require constant synchronization with a central repository. The distributed and offline nature of Git allows significantly greater flexibility for the developers.</li>
      <li class="bulletList"><strong class="keyWord">Scale to handle thousands of developers</strong>: The number of developers working on different parts of some open-source projects is in the thousands. Git supports the integration of their work reliably.</li>
      <li class="bulletList"><strong class="keyWord">Performance</strong>: Linus was determined to make sure Git was fast and efficient. To save space and transfer time for the sheer volume of updates for the Linux kernel code alone, compression and a delta check were used to make Git fast and efficient.</li>
      <li class="bulletList"><strong class="keyWord">Accountability and immutability</strong>: Git enforces a change log on every commit that changes a file, so there is a trail for all the changes and the reason behind them. The data objects in Git cannot be modified after they are created and placed in the database, making them immutable. This further enforces accountability.</li>
      <li class="bulletList"><strong class="keyWord">Atomic transactions</strong>: The integrity of the repository is ensured as the different but related change is performed either altogether or not at all. This will ensure the repository is not left in a partially changed or corrupted state.</li>
      <li class="bulletList"><strong class="keyWord">Complete repositories</strong>: Each repository has a complete copy of all historical revisions of every file.</li>
      <li class="bulletList"><strong class="keyWord">Free, as in freedom</strong>: The origin of the Git tool was born out of the disagreement between Linux and BitKeeper VCS as to whether software should be free and whether one should reject commercial software on principle, so it makes sense that the tool has a very liberal usage license.</li>
    </ul>
    <p class="normal">Let’s look at some of the terms used in Git before we go deeper into it.</p>
    <h2 class="heading-2" id="_idParaDest-293">Git Terminology</h2>
    <p class="normal">Here are some Git terms we should be familiar with:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Ref</strong>: The name that begins<a id="_idIndexMarker1084"/> with <code class="inlineCode">refs</code> and points to <a id="_idIndexMarker1085"/>an object.</li>
      <li class="bulletList"><strong class="keyWord">Repository</strong>: This is a <a id="_idIndexMarker1086"/>database that contains all of a project’s information, files, metadata, and history. It contains a collection of refs for all the collections of objects.</li>
      <li class="bulletList"><strong class="keyWord">Branch</strong>: This is an<a id="_idIndexMarker1087"/> active line of development. The most recent commit is the <code class="inlineCode">tip</code> or the <code class="inlineCode">HEAD</code> of that branch. A repository can have multiple branches, but your <code class="inlineCode">working tree</code> or <code class="inlineCode">working directory</code> can only be associated with one branch. This is sometimes referred to as the current or <code class="inlineCode">checked out</code> branch.</li>
      <li class="bulletList"><strong class="keyWord">Checkout</strong>: This is the action <a id="_idIndexMarker1088"/>of updating all or part of the working tree to a particular point.</li>
      <li class="bulletList"><strong class="keyWord">Commit</strong>: This is a point in<a id="_idIndexMarker1089"/> time in Git history, or it can mean storing a new snapshot in the repository.</li>
      <li class="bulletList"><strong class="keyWord">Merge</strong>: This is<a id="_idIndexMarker1090"/> the action to bring the content of another branch into the current branch. For example, I am merging the <code class="inlineCode">development</code> branch with the <code class="inlineCode">master</code> branch.</li>
      <li class="bulletList"><strong class="keyWord">Fetch</strong>: This is the <a id="_idIndexMarker1091"/>action of getting the content from a remote repository.</li>
      <li class="bulletList"><strong class="keyWord">Pull</strong>: Fetching and<a id="_idIndexMarker1092"/> merging a repository.</li>
      <li class="bulletList"><strong class="keyWord">Tag</strong>: This is a mark at a <a id="_idIndexMarker1093"/>point in time in a repository that is significant.</li>
    </ul>
    <p class="normal">This is not a complete list; please <a id="_idIndexMarker1094"/>refer to the Git glossary, <a href="https://git-scm.com/docs/gitglossary"><span class="url">https://git-scm.com/docs/gitglossary</span></a>, for more terms and their definitions.</p>
    <p class="normal">Finally, before getting into the actual <a id="_idIndexMarker1095"/>setup and uses of Git, let’s talk about the important distinction between Git and GitHub; one that is easily overlooked by engineers unfamiliar with the two.</p>
    <h2 class="heading-2" id="_idParaDest-294">Git and GitHub</h2>
    <p class="normal">Git and GitHub are not the same<a id="_idIndexMarker1096"/> things. Sometimes, for engineers who are new to version-control systems, this is confusing. Git is a revision-control system, while GitHub, <a href="https://github.com/"><span class="url">https://github.com/</span></a>, is a <a id="_idIndexMarker1097"/>centralized hosting service for Git repositories. The company, GitHub, was launched in 2008 and was acquired by Microsoft in 2018 but continued to operate independently.</p>
    <p class="normal">Because Git is a decentralized system, GitHub stores a copy of our project’s repository, just like any other distributed offline copies. We often designate the GitHub repository as the project’s central repository, and all other developers push and pull their changes to and from that repository.</p>
    <p class="normal">After GitHub was acquired by Microsoft in 2018, <a href="https://blogs.microsoft.com/blog/2018/10/26/microsoft-completes-github-acquisition/"><span class="url">https://blogs.microsoft.com/blog/2018/10/26/microsoft-completes-github-acquisition/</span></a>, many in the developer community worried about the independence of GitHub. As described in the press release, “GitHub will retain its developer-first ethos, operate independently, and remain an open-source platform.” GitHub takes this idea of being the centralized repository in a distributed system further by using the <code class="inlineCode">fork</code> and <code class="inlineCode">pull</code> <code class="inlineCode">requests</code> mechanisms. For projects hosted on GitHub, the project maintainers typically encourage other developers to <code class="inlineCode">fork</code> the repository, or make a copy of the repository, and work on it as their copied repository. </p>
    <p class="normal">After making changes, they can send a <code class="inlineCode">pull</code> <code class="inlineCode">request</code> to the main project, and the project maintainers can review the changes and <code class="inlineCode">commit</code> the changes if they see fit. GitHub also adds the web interface to the repositories beside the command line; this makes Git more user-friendly.</p>
    <p class="normal">Now that we’ve differentiated Git and GitHub, we can start properly! First, let’s talk about setting up Git.</p>
    <h1 class="heading-1" id="_idParaDest-295">Setting up Git</h1>
    <p class="normal">So far, we have been using Git just to<a id="_idIndexMarker1098"/> download files from GitHub. In this section, we will go a bit further by setting up Git locally so we can start committing our files. I will use the same Ubuntu 22.04 LTS management host in the example. If you are using a different version of Linux or other operating systems, a quick search of the installation process should land you in the right set of instructions.</p>
    <p class="normal">If you have not done so already, install Git via the <code class="inlineCode">apt</code> package-management tool:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>sudo apt update
<span class="hljs-con-meta">$ </span>sudo apt install -y git
<span class="hljs-con-meta">$ </span>git --version
git version 2.34.1 
</code></pre>
    <p class="normal">Once <code class="inlineCode">git</code> is installed, we need to configure a few things so that our commit messages can contain the correct information:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git config --global user.name <span class="hljs-con-string">"Your Name"</span>
<span class="hljs-con-meta">$ </span>git config --global user.email <span class="hljs-con-string">"email@domain.com"</span>
<span class="hljs-con-meta">$ </span>git config --list 
user.name=Your Name
user.email=email@domain.com
</code></pre>
    <p class="normal">Alternatively, you can modify the information in the <code class="inlineCode">~/.gitconfig</code> file:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cat</span> ~/.gitconfig 
[user] 
name = Your Name 
email = email@domain.com 
</code></pre>
    <p class="normal">There are many options in Git that we can change, but the name and email are the ones that allow us to commit the change without getting a warning. Personally, I like to use the Vim text editor, instead of the default Emac, for typing commit messages:</p>
    <pre class="programlisting con"><code class="hljs-con">(optional) 
<span class="hljs-con-meta">$ </span>git config --global core.editor <span class="hljs-con-string">"vim"</span> 
<span class="hljs-con-meta">$ </span>git config --list 
user.name=Your Name 
user.email=email@domain.com 
core.editor=vim
</code></pre>
    <p class="normal">Before we move on to using Git, let’s go over the idea of a <code class="inlineCode">gitignore</code> file.</p>
    <h2 class="heading-2" id="_idParaDest-296">Gitignore</h2>
    <p class="normal">There are files you do not want<a id="_idIndexMarker1099"/> Git to check into GitHub or other repositories, such as files with passwords, API keys, or other sensitive information. The easiest way to prevent files from being accidentally checked into a repository is to create a .<code class="inlineCode">gitignore</code> file in the repository’s top-level folder. Git will use the <code class="inlineCode">gitignore</code> file to determine which files and directories should be ignored before committing. The <code class="inlineCode">gitignore</code> file should be committed to the repository as early as possible and be shared with other users.</p>
    <p class="normal">Imagine the panic you would feel if you accidentally checked your group API key into a public Git repository. It is usually helpful to create the <code class="inlineCode">gitignore</code> file when creating a new repository. In fact, GitHub provides an option to do just that when you create a repository on its platform. This file can include language-specific files. For example, let’s exclude the Python <code class="inlineCode">Byte-compiled</code> files:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"># </span>Byte-compiled / optimized / DLL files
  pycache /
*.py[cod]
*$py.class
</code></pre>
    <p class="normal">We can also include files that are specific to your operating system:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"># </span>OSX
<span class="hljs-con-meta"># </span>=========================
.DS_Store
.AppleDouble
.LSOverride
</code></pre>
    <p class="normal">You can learn more about <code class="inlineCode">.gitignore</code> on GitHub’s help page: <a href="https://help.github.com/articles/ignoring-files/"><span class="url">https://help.github.com/articles/ignoring-files/</span></a>. Here are some other references:</p>
    <ul>
      <li class="bulletList">Gitignore<a id="_idIndexMarker1100"/> manual: <a href="https://git-scm.com/docs/gitignore"><span class="url">https://git-scm.com/docs/gitignore</span></a></li>
      <li class="bulletList">GitHub’s <a id="_idIndexMarker1101"/>collection of <code class="inlineCode">.gitignore</code> templates: <a href="https://github.com/github/gitignore"><span class="url">https://github.com/github/gitignore</span></a></li>
      <li class="bulletList">Python language <code class="inlineCode">.gitignore</code> example: <a href="https://github.com/github/gitignore/blob/master/Python.gitignore"><span class="url">https://github.com/github/gitignore/blob/master/Python.gitignore</span></a></li>
      <li class="bulletList">The <code class="inlineCode">.gitignore</code> file for this book’s repository: <a href="https://github.com/PacktPublishing/Mastering-Python-Networking-Fourth-Edition/blob/main/.gitignore"><span class="url">https://github.com/PacktPublishing/Mastering-Python-Networking-Fourth-Edition/blob/main/.gitignore</span></a>. </li>
    </ul>
    <p class="normal">I see the <code class="inlineCode">.gitignore</code> file as a file that should be created simultaneously with any new repository. That is why this concept is introduced as early as possible. We will look at some of the Git usage examples in the next section.</p>
    <h1 class="heading-1" id="_idParaDest-297">Git Usage Examples</h1>
    <p class="normal">In my experience, when we work <a id="_idIndexMarker1102"/>with Git, we will likely use the command line and the various options. The graphical tools are useful when we need to trace back changes, look at logs, and compare commit differences, but we rarely use them for normal branching and commits. We can look at Git’s command-line option by using the <code class="inlineCode">help</code> option:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git --<span class="hljs-con-built_in">help</span>
usage: git [--version] [--help] [-C &lt;path&gt;] [-c &lt;name&gt;=&lt;value&gt;]
           [--exec-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]
           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]
           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]
           &lt;command&gt; [&lt;args&gt;]
</code></pre>
    <p class="normal">We will create a <code class="inlineCode">repository</code> and create a file inside the repository:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">mkdir</span> TestRepo-1
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cd</span> TestRepo-1/
<span class="hljs-con-meta">$ </span>git init
Initialized empty Git repository in /home/echou/Mastering_Python_Networking_third_edition/Chapter13/TestRepo-1/.git/
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">echo</span> <span class="hljs-con-string">"this is my test file"</span> &gt; myFile.txt
</code></pre>
    <p class="normal">When the repository was initialized with Git, a new hidden folder of <code class="inlineCode">.git</code> was added to the directory. It contains all the Git-related files:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span> -a
.  ..  .git  myFile.txt
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span> .git/
branches  config  description  HEAD  hooks  info  objects  refs
</code></pre>
    <p class="normal">There are several locations where Git receives its configurations in a hierarchical format. The files are read from the <code class="inlineCode">system</code>, <code class="inlineCode">global</code>, and <code class="inlineCode">repository</code> by default. The more specific the repository’s location, the higher the override<a id="_idIndexMarker1103"/> preference. For example, the repository configuration will override the global configuration. You can use the <code class="inlineCode">git config -l</code> command to see the aggregated configuration:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span> .git/config
.git/config
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span> ~/.gitconfig
/home/echou/.gitconfig
<span class="hljs-con-meta">$ </span>git config -l 
user.name=Eric Chou 
user.email=&lt;email&gt; 
core.editor=vim
core.repositoryformatversion=0 
core.filemode=true 
core.bare=false 
core.logallrefupdates=true
</code></pre>
    <p class="normal">When we create a file in the repository, it is not tracked. For <code class="inlineCode">git</code> to be aware of the file, we need to add the file:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git status
On branch master
Initial commit
Untracked files: 
     (use "git add &lt;file&gt;..." to include in what will be committed)
myFile.txt 
nothing added to commit but untracked files present (use "git add" to track) 
<span class="hljs-con-meta">$ </span>git add myFile.txt
<span class="hljs-con-meta">$ </span>git status
On branch master 
Initial commit
Changes to be committed:
   (use "git rm --cached &lt;file&gt;..." to unstage) 
new file: myFile.txt
</code></pre>
    <p class="normal">When you add the file, it is in a staged status. To make the changes official, we will need to commit the change:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git commit -m "adding myFile.txt"
[master (root-commit) 5f579ab] adding myFile.txt
 1 file changed, 1 insertion(+)
 create mode 100644 myFile.txt 
<span class="hljs-con-meta">$ </span>git status
On branch master
nothing to commit, working directory clean
</code></pre>
    <p class="normal">In the last example, we provided the <code class="inlineCode">commit</code> message with the <code class="inlineCode">-m</code> option when we issued the <code class="inlineCode">commit</code> statement. If we did not use the option, we would have been taken to a page to provide the commit message. In our scenario, we configured the text editor to be Vim, so we can use it to edit the message.</p>
    <p class="normal">Let’s make some changes to<a id="_idIndexMarker1104"/> the file and <code class="inlineCode">commit</code> it again. Notice that after the file has been changed, Git knows the file has been modified:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>vim myFile.txt
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cat</span> myFile.txt
this is the second iteration of my test file
<span class="hljs-con-meta">$ </span>git status
On branch master
Changes not staged for commit:
(use "git add &lt;file&gt;..." to update what will be committed)
(use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
modified: myFile.txt
<span class="hljs-con-meta">$ </span>git add myFile.txt
<span class="hljs-con-meta">$ </span>git commit -m <span class="hljs-con-string">"made modifications to myFile.txt"</span> 
[master a3dd3ea] made modifications to myFile.txt
1 file changed, 1 insertion(+), 1 deletion(-)
</code></pre>
    <p class="normal">The <code class="inlineCode">git commit</code> number is an <code class="inlineCode">SHA-1 hash</code>, which is an important feature. If we had followed the same step on another computer, our <code class="inlineCode">SHA-1 hash</code> value would be the same. This is how Git knows the two repositories are identical even when they are worked on in parallel.</p>
    <div class="packt_tip">
      <p class="normal">If you have ever wondered about the <code class="inlineCode">SHA-1 hash</code> value being accidentally or purposely modified to overlap, there is an interesting article on the GitHub blog about detecting this <code class="inlineCode">SHA-1 hash</code> collision: <a href="https://github.blog/2017-03-20-sha-1-collision-detection-on-github-com/"><span class="url">https://github.blog/2017-03-20-sha-1-collision-detection-on-github-com/</span></a>. </p>
    </div>
    <p class="normal">We can show the history of the commits with <code class="inlineCode">git log</code>. The entries are shown in reverse chronological order; each commit shows the author’s name and email address, the date, the log message, as well as the internal identification number of the commit:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">log</span>
commit ff7dc1a40e5603fed552a3403be97addefddc4e9 (HEAD -&gt; master)
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 08:49:02 2019 -0800
    made modifications to myFile.txt
commit 5d7c1c8543c8342b689c66f1ac1fa888090ffa34
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 08:46:32 2019 -0800
    adding myFile.txt
</code></pre>
    <p class="normal">We can also show more details about the change using the commit ID:</p>
    <pre class="programlisting con"><code class="hljs-con">(venv) $ git show ff7dc1a40e5603fed552a3403be97addefddc4e9
commit ff7dc1a40e5603fed552a3403be97addefddc4e9 (HEAD -&gt; master)
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 08:49:02 2019 -0800
    made modifications to myFile.txt
diff --git a/myFile.txt b/myFile.txt
index 6ccb42e..69e7d47 100644
--- a/myFile.txt
+++ b/myFile.txt
@@ -1 +1 @@
-this is my test file
+this is the second iteration of my test file
</code></pre>
    <p class="normal">If you need to revert the <a id="_idIndexMarker1105"/>changes you have made, you can choose between <code class="inlineCode">revert</code> and <code class="inlineCode">reset</code>. The former changes all the files for a specific commit back to their state before the commit:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git revert ff7dc1a40e5603fed552a3403be97addefddc4e9
[master 75921be] Revert "made modifications to myFile.txt"
 1 file changed, 1 insertion(+), 1 deletion(-)
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cat</span> myFile.txt
this is my test file
</code></pre>
    <p class="normal">The <code class="inlineCode">revert</code> command will keep the <code class="inlineCode">commit</code> you reverted and make a new <code class="inlineCode">commit</code>. You will be able to see all the changes up to that point, including the revert:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">log</span>
commit 75921bedc83039ebaf70c90a3e8d97d65a2ee21d (HEAD -&gt; master)
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 09:00:23 2019 -0800
    Revert "made modifications to myFile.txt"
    This reverts commit ff7dc1a40e5603fed552a3403be97addefddc4e9.
     On branch master
     Changes to be committed:
            modified:   myFile.txt
</code></pre>
    <p class="normal">The <code class="inlineCode">reset</code> option will reset the status of your repository to an older version and discard all the changes in between:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git reset --hard ff7dc1a40e5603fed552a3403be97addefddc4e9
HEAD is now at ff7dc1a made modifications to myFile.txt
<span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">log</span>
commit ff7dc1a40e5603fed552a3403be97addefddc4e9 (HEAD -&gt; master)
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 08:49:02 2019 -0800
    made modifications to myFile.txt
commit 5d7c1c8543c8342b689c66f1ac1fa888090ffa34
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 08:46:32 2019 -0800
    adding myFile.txt
</code></pre>
    <p class="normal">I like to keep all the history, including any rollbacks I have done. Therefore, when I need to roll back a change, I usually pick <code class="inlineCode">revert</code> instead of <code class="inlineCode">reset</code>. In this section, we have seen how we can work with individual files. In the next section, let’s look at how we can work with a collection of files that is grouped into a particular <code class="inlineCode">bundle</code>, called <code class="inlineCode">branch</code>.</p>
    <h1 class="heading-1" id="_idParaDest-298">Git Branch</h1>
    <p class="normal">A <code class="inlineCode">branch</code> in <code class="inlineCode">git</code> is a line of <a id="_idIndexMarker1106"/>development within a repository. Git allows many branches and thus different lines of development within a repository. By default, we have the master branch. </p>
    <div class="packt_tip">
      <p class="normal">A few years back, the default branch for GitHub was renamed “main”: <a href="https://github.com/github/renaming"><span class="url">https://github.com/github/renaming</span></a>. We will see both in the field.</p>
    </div>
    <p class="normal">There are many reasons for branching; there are no hard-set rules about when to branch or work on the master/main branch directly. Most of the time, we create a branch when there is a bug fix, a customer software release, or a development phase. In our example, let us create a branch that represents development, appropriately named the <code class="inlineCode">dev</code> branch:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git branch dev
<span class="hljs-con-meta">$ </span>git branch
  dev
* master
</code></pre>
    <p class="normal">Notice we need to specifically <a id="_idIndexMarker1107"/>move into the <code class="inlineCode">dev branch</code> after creation. We do that with <code class="inlineCode">checkout</code>:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git checkout dev
Switched to branch 'dev'
<span class="hljs-con-meta">$ </span>git branch
* dev
  master
</code></pre>
    <p class="normal">Let’s add a second file to the <code class="inlineCode">dev</code> branch:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">echo</span> <span class="hljs-con-string">"my second file"</span> &gt; mySecondFile.txt
<span class="hljs-con-meta">$ </span>git add mySecondFile.txt
<span class="hljs-con-meta">$ </span>git commit -m <span class="hljs-con-string">"</span><span class="hljs-con-string">added mySecondFile.txt to dev branch"</span>
[dev a537bdc] added mySecondFile.txt to dev branch
 1 file changed, 1 insertion(+)
 create mode 100644 mySecondFile.txt
</code></pre>
    <p class="normal">We can go back to the <code class="inlineCode">master</code> branch and verify that the two lines of development are separate. Note that when we switch to the master branch, there is only one file in the directory:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git branch
* dev
  master
<span class="hljs-con-meta">$ </span>git checkout master
Switched to branch 'master'
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span>
myFile.txt
<span class="hljs-con-meta">$ </span>git checkout dev
Switched to branch 'dev'
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span>
myFile.txt  mySecondFile.txt
</code></pre>
    <p class="normal">To have the contents in the <code class="inlineCode">dev</code> branch be written into the <code class="inlineCode">master</code> branch, we will need to <code class="inlineCode">merge</code> them:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git branch
* dev
  master
<span class="hljs-con-meta">$ </span>git checkout master
Switched to branch 'master'
<span class="hljs-con-meta">$ </span>git merge dev master
Updating ff7dc1a..a537bdc
Fast-forward
 mySecondFile.txt | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 mySecondFile.txt
<span class="hljs-con-meta">$ </span>git branch
  dev
* master
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span>
myFile.txt  mySecondFile.txt
</code></pre>
    <p class="normal">We can use <code class="inlineCode">git rm</code> to remove a file. To see how it works, let’s create a third file and remove it:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">touch</span> myThirdFile.txt
<span class="hljs-con-meta">$ </span>git add myThirdFile.txt
<span class="hljs-con-meta">$ </span>git commit -m <span class="hljs-con-string">"adding myThirdFile.txt"</span>
[master 169a203] adding myThirdFile.txt
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 myThirdFile.txt
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span>
myFile.txt  mySecondFile.txt  myThirdFile.txt
<span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">rm</span> myThirdFile.txt
rm 'myThirdFile.txt'
<span class="hljs-con-meta">$ </span>git status
On branch master
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)
    deleted:    myThirdFile.txt
<span class="hljs-con-meta">$ </span>git commit -m <span class="hljs-con-string">"deleted myThirdFile.txt"</span>
[master 1b24b4e] deleted myThirdFile.txt
 1 file changed, 0 insertions(+), 0 deletions(-)
 delete mode 100644 myThirdFile.txt
</code></pre>
    <p class="normal">We will be able to see the last two changes in the log:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">log</span>
commit 1b24b4e95eb0c01cc9a7124dc6ac1ea37d44d51a (HEAD -&gt; master)
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 10:02:45 2019 -0800
    deleted myThirdFile.txt
commit 169a2034fb9844889f5130f0e42bf9c9b7c08b05
Author: Eric Chou &lt;echou@yahoo.com&gt;
Date:   Fri Nov 8 10:00:56 2019 -0800
    adding myThirdFile.txt
</code></pre>
    <p class="normal">We have gone through<a id="_idIndexMarker1108"/> most of the basic operations we would use for Git. Let’s look at how to use GitHub to share our repository.</p>
    <h2 class="heading-2" id="_idParaDest-299">GitHub Example</h2>
    <p class="normal">In this example, we will use<a id="_idIndexMarker1109"/> GitHub as the centralized location to synchronize our local repository and share it with other users.</p>
    <p class="normal">We will create a repository on GitHub. GitHub has always been free for creating public open-source repositories. Starting in January 2019, it also offers unlimited free private repositories. In this case, we will create a private repository and add the license and <code class="inlineCode">.gitignore</code> file:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_01.png"/></figure>
    <p class="packt_figref">Figure 14.1: Creating a private repository in GitHub</p>
    <p class="normal">Once the repository is created, we <a id="_idIndexMarker1110"/>can find the URL for it:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_02.png"/></figure>
    <p class="packt_figref">Figure 14.2: GitHub repository URL</p>
    <p class="normal">We will use this URL to create a remote target, which we will use as a “source of truth” for our project. We will name the remote target <code class="inlineCode">gitHubRepo</code>:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git remote add gitHubRepo https://github.com/ericchou1/TestRepo.git
<span class="hljs-con-meta">$ </span>git remote -v
gitHubRepo	https://github.com/ericchou1/TestRepo.git (fetch)
gitHubRepo	https://github.com/ericchou1/TestRepo.git (push)
</code></pre>
    <p class="normal">Since we chose to create <code class="inlineCode">README.md</code> and <code class="inlineCode">LICENSE</code> files during creation, the remote repository and local repository<a id="_idIndexMarker1111"/> are not the same.</p>
    <p class="normal">GitHub switched to a <strong class="keyWord">Personal Access Token</strong> (<strong class="keyWord">PAT</strong>) as the<a id="_idIndexMarker1112"/> term to be entered as a password a few years ago: <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"><span class="url">https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token</span></a>. To generate a token, click on the profile logo <strong class="screenText">-&gt; Settings -&gt; Developer settings -&gt; Personal Access Tokens</strong>. We need to use this token as our password when prompted in the command line. </p>
    <p class="normal">If we were to push local changes to the new GitHub repository, we would receive the following error (remember to change the branch name to main if that is your default branch):</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git push gitHubRepo master
Username for 'https://github.com': &lt;skip&gt;
Password for 'https://echou@yahoo.com@github.com': &lt;remember to use your personal access token&gt;
To https://github.com/ericchou1/TestRepo.git
 ! [rejected]        master -&gt; master (fetch first)
error: failed to push some refs to 'https://github.com/ericchou1/TestRepo.git'
</code></pre>
    <p class="normal">We will go ahead and use <code class="inlineCode">git pull</code> to get the new files from GitHub:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git pull gitHubRepo master
Username for 'https://github.com': &lt;skip&gt; 
Password for 'https://&lt;username&gt;@github.com': &lt;personal access token&gt;
From https://github.com/ericchou1/TestRepo
* branch master -&gt; FETCH_HEAD
Merge made by the 'recursive' strategy.
.gitignore | 104
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ LICENSE | 21 +++++++++++++
README.md | 2 ++
3 files changed, 127 insertions(+)
create mode 100644 .gitignore
create mode 100644 LICENSE
create mode 100644 README.md
</code></pre>
    <p class="normal">Now we will be able to <code class="inlineCode">push</code> the contents over to GitHub:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git push gitHubRepo master
Username for 'https://github.com': &lt;username&gt; 
Password for 'https://&lt;username&gt;@github.com': &lt;personal access token&gt; 
Counting objects: 15, done.
Compressing objects: 100% (9/9), done.
Writing objects: 100% (15/15), 1.51 KiB | 0 bytes/s, done. Total 15 (delta 1), reused 0 (delta 0)
remote: Resolving deltas: 100% (1/1), done.
To https://github.com/ericchou1/TestRepo.git a001b81..0aa362a master -&gt; master
</code></pre>
    <p class="normal">We can verify the content <a id="_idIndexMarker1113"/>of the GitHub repository on the web page:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_03.png"/></figure>
    <p class="packt_figref">Figure 14.3: GitHub repository</p>
    <p class="normal">Now another user can simply make a copy, or <code class="inlineCode">clone</code>, of the repository:</p>
    <pre class="programlisting con"><code class="hljs-con">[This is operated from another host]
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cd</span> /tmp
<span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">clone</span> https://github.com/ericchou1/TestRepo.git 
Cloning into 'TestRepo'...
remote: Counting objects: 20, done.
remote: Compressing objects: 100% (13/13), done.
remote: Total 20 (delta 2), reused 15 (delta 1), pack-reused 0 
Unpacking objects: 100% (20/20), done.
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cd</span> TestRepo/
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span>
LICENSE myFile.txt
README.md mySecondFile.txt
</code></pre>
    <p class="normal">This copied repository will be the exact copy of my original repository, including all the commit history:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">log</span>
commit 0aa362a47782e7714ca946ba852f395083116ce5 (HEAD -&gt; master, origin/master, origin/HEAD)
Merge: bc078a9 a001b81
Author: Eric Chou &lt;skip&gt;
Date: Fri Jul 20 14:18:58 2018 -0700
    Merge branch 'master' of https://github.com/ericchou1/TestRepo
commit a001b816bb75c63237cbc93067dffcc573c05aa2
Author: Eric Chou &lt;skip&gt;
Date: Fri Jul 20 14:16:30 2018 -0700
    Initial commit
...
</code></pre>
    <p class="normal">I can also invite another<a id="_idIndexMarker1114"/> person as a collaborator for the project under the repository settings:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_04.png"/></figure>
    <p class="packt_figref">Figure 14.4: Repository invite</p>
    <p class="normal">In the next example, we will see how we can fork a repository and perform a pull request for a repository we do not maintain.</p>
    <h3 class="heading-3" id="_idParaDest-300">Collaborating with Pull Requests</h3>
    <p class="normal">As mentioned, Git supports<a id="_idIndexMarker1115"/> collaboration between developers for a single project. We will look at how it is done when the code is hosted on GitHub.</p>
    <p class="normal">In this case, we will use the GitHub<a id="_idIndexMarker1116"/> repository for the second edition of this book from Packt’s GitHub public repository. I will use a different GitHub handle, so I appear as a non-administrative user. I will click on the <strong class="keyWord">Fork</strong> button to make a copy of the repository in my account:</p>
    <figure class="mediaobject"><img alt="A screenshot of a computer  Description automatically generated with medium confidence" src="../Images/B18403_14_05.png"/></figure>
    <p class="packt_figref">Figure 14.5: Git Fork button</p>
    <p class="normal">It will take a few seconds to make a copy:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, website  Description automatically generated" src="../Images/B18403_14_06.png"/></figure>
    <p class="packt_figref">Figure 14.6: Git Fork in progress</p>
    <p class="normal">After it is forked, we will <a id="_idIndexMarker1117"/>have a copy of the repository in our<a id="_idIndexMarker1118"/> account:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_07.png"/></figure>
    <p class="packt_figref">Figure 14.7: Git Fork</p>
    <p class="normal">We can follow the same steps we used to modify the files. In this case, I will make some changes to the <code class="inlineCode">README.md</code> file. After the change is<a id="_idIndexMarker1119"/> made, I can click on the <strong class="screenText">New pull request</strong> button to create a pull request:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_08.png"/></figure>
    <p class="packt_figref">Figure 14.8: Pull request</p>
    <p class="normal">When making a pull request, we <a id="_idIndexMarker1120"/>should fill in as much information as possible to provide justifications for making the change:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_09.png"/></figure>
    <p class="packt_figref">Figure 14.9: Pull request details</p>
    <p class="normal">The repository maintainer will receive<a id="_idIndexMarker1121"/> a notification of the pull request; if <a id="_idIndexMarker1122"/>accepted, the change will make its way to the original repository:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_10.png"/></figure>
    <p class="packt_figref">Figure 14.10: Pull request record</p>
    <p class="normal">GitHub provides an excellent platform for collaboration with other developers; this is quickly becoming the de facto development<a id="_idIndexMarker1123"/> choice for many large, open-source projects. Since Git and GitHub are used extensively in<a id="_idIndexMarker1124"/> many projects, a natural next step would be to automate the processes we have seen in this section. In the following section, let’s look at how we can use Git with Python.</p>
    <h1 class="heading-1" id="_idParaDest-301">Git with Python</h1>
    <p class="normal">There are some Python <a id="_idIndexMarker1125"/>packages that we can use with Git and GitHub. In this section, we will look at the GitPython and PyGitHub libraries.</p>
    <h2 class="heading-2" id="_idParaDest-302">GitPython</h2>
    <p class="normal">We can use the GitPython <a id="_idIndexMarker1126"/>package, <a href="https://gitpython.readthedocs.io/en/stable/index.html"><span class="url">https://gitpython.readthedocs.io/en/stable/index.html</span></a>, to work with our Git repository. We will install the package and use<a id="_idIndexMarker1127"/> the Python shell to construct a <code class="inlineCode">Repo</code> object. From there, we can list all the commits in the repository:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>pip install gitpython
<span class="hljs-con-meta">$ </span>python
<span class="hljs-con-meta">&gt;</span>&gt;&gt; from git import Repo
<span class="hljs-con-meta">&gt;</span>&gt;&gt; repo = Repo(<span class="hljs-con-string">'/home/echou/Mastering_Python_Networking_third_edition/Chapter13/TestRepo-1'</span>)
<span class="hljs-con-meta">&gt;</span>&gt;&gt; <span class="hljs-con-keyword">for</span> commits <span class="hljs-con-keyword">in</span> list(repo.iter_commits(<span class="hljs-con-string">'master'</span>)):
... print(commits)
...
1b24b4e95eb0c01cc9a7124dc6ac1ea37d44d51a
169a2034fb9844889f5130f0e42bf9c9b7c08b05
a537bdcc1648458ce88120ae607b4ddea7fa9637
ff7dc1a40e5603fed552a3403be97addefddc4e9
5d7c1c8543c8342b689c66f1ac1fa888090ffa34
</code></pre>
    <p class="normal">We can also look at the index entries in the <code class="inlineCode">repo</code> object:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">for</span> (path, stage), entry <span class="hljs-con-keyword">in</span> repo.index.entries.items():
<span class="hljs-con-meta">...</span> <span class="hljs-con-built_in">print</span>(path, stage, entry)
<span class="hljs-con-meta">...</span>
myFile.txt 0 100644 69e7d4728965c885180315c0d4c206637b3f6bad 0 myFile.txt
mySecondFile.txt 0 100644 75d6370ae31008f683cf18ed086098d05bf0e4dc 0 mySecondFile.txt
</code></pre>
    <p class="normal">GitPython offers good integration with all the Git functions. However, it might not be the easiest library to work with for beginners. We need to understand the terms and structure of Git to take full advantage of GitPython, and it is always good to keep it in mind if we need it for other projects.</p>
    <h2 class="heading-2" id="_idParaDest-303">PyGitHub</h2>
    <p class="normal">Let’s look at using the<a id="_idIndexMarker1128"/> PyGithub library, <a href="http://pygithub.readthedocs.io/en/latest/"><span class="url">http://pygithub.readthedocs.io/en/latest/</span></a>, to interact with <a id="_idIndexMarker1129"/>GitHub reappearing around GitHub API v3, <a href="https://developer.github.com/v3/"><span class="url">https://developer.github.com/v3/</span></a>:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>pip install PyGithub
</code></pre>
    <p class="normal">Let’s use the Python shell to print out the user’s current repository:</p>
    <pre class="programlisting con"><code class="hljs-con">$ python
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span> github <span class="hljs-con-keyword">import</span> Github
<span class="hljs-con-meta">&gt;&gt;&gt;</span> g = Github(<span class="hljs-con-string">"&lt;username&gt;"</span>, <span class="hljs-con-string">"&lt;password&gt;"</span>)
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">for</span> repo <span class="hljs-con-keyword">in</span> g.get_user().get_repos():
<span class="hljs-con-meta">...</span> <span class="hljs-con-built_in">print</span>(repo.name)
<span class="hljs-con-meta">...</span>
Mastering-Python-Networking-Second-Edition
Mastering-Python-Networking-Third-Edition
</code></pre>
    <p class="normal">For more programmatic access, we can also create more granular control using an access token. GitHub allows a token to be associated with the selected rights:</p>
    <figure class="mediaobject"><img alt="A picture containing graphical user interface  Description automatically generated" src="../Images/B18403_14_11.png"/></figure>
    <p class="packt_figref">Figure 14.11: GitHub token generation</p>
    <p class="normal">The output is a bit different if you use the access token as the authentication mechanism:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span> github <span class="hljs-con-keyword">import</span> Github
<span class="hljs-con-meta">&gt;&gt;&gt;</span> g = Github(<span class="hljs-con-string">"&lt;token&gt;"</span>)
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">for</span> repo <span class="hljs-con-keyword">in</span> g.get_user().get_repos():
<span class="hljs-con-meta">...</span> <span class="hljs-con-built_in">print</span>(repo)
<span class="hljs-con-meta">...</span>
Repository(full_name="oreillymedia/distributed_denial_of_service_ddos") 
Repository(full_name="PacktPublishing/-Hands-on-Network-    Programming-with- Python")
Repository(full_name="PacktPublishing/Mastering-Python-Networking") 
Repository(full_name="PacktPublishing/Mastering-Python-Networking-Second- Edition")
<span class="hljs-con-meta">...</span>
</code></pre>
    <p class="normal">Now that we are familiar with<a id="_idIndexMarker1130"/> Git, GitHub, and some Python packages, we can use them to work with the technology. We will look at some practical examples in the upcoming section.</p>
    <h1 class="heading-1" id="_idParaDest-304">Automating Configuration Backup</h1>
    <p class="normal">In this example, we will use PyGithub to back<a id="_idIndexMarker1131"/> up a directory containing our router configurations. We have seen how we can retrieve the information from our devices with Python or Ansible; we can now check them into GitHub.</p>
    <p class="normal">We have a subdirectory, named <code class="inlineCode">config</code>, with our router configs in text format:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span> configs/ 
iosv-1 iosv-2
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">cat</span> configs/iosv-1 
Building configuration...
Current configuration : 4573 bytes
!
! Last configuration change at 02:50:05 UTC Sat Jun 2 2018 by cisco
!
version 15.6
service timestamps debug datetime msec
...
</code></pre>
    <p class="normal">We can use the following script, <code class="inlineCode">Chapter14_1.py</code>, to retrieve the latest index from our GitHub repository, build the content that we need to commit, and automatically commit the configuration:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># reference: https://stackoverflow.com/questions/38594717/how-do-i-push-new-files-to-github</span>
<span class="hljs-keyword">from</span> github <span class="hljs-keyword">import</span> Github, InputGitTreeElement
<span class="hljs-keyword">import</span> os
github_token = <span class="hljs-string">'&lt;token&gt;'</span>
configs_dir = <span class="hljs-string">'configs'</span>
github_repo = <span class="hljs-string">'TestRepo'</span>
<span class="hljs-comment"># Retrieve the list of files in configs directory</span>
file_list = []
<span class="hljs-keyword">for</span> dirpath, dirname, filenames <span class="hljs-keyword">in</span> os.walk(configs_dir):
    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> filenames:
        file_list.append(configs_dir + <span class="hljs-string">"/"</span> + f)
g = Github(github_token)
repo = g.get_user().get_repo(github_repo)
commit_message = <span class="hljs-string">'add configs'</span>
master_ref = repo.get_git_ref(<span class="hljs-string">'heads/master'</span>)
master_sha = master_ref.<span class="hljs-built_in">object</span>.sha
base_tree = repo.get_git_tree(master_sha)
element_list = <span class="hljs-built_in">list</span>()
<span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> file_list: 
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(entry, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> input_file:
        data = input_file.read()
    element = InputGitTreeElement(entry, <span class="hljs-string">'100644'</span>, <span class="hljs-string">'blob'</span>, data)
    element_list.append(element)
<span class="hljs-comment"># Create tree and commit</span>
tree = repo.create_git_tree(element_list, base_tree)
parent = repo.get_git_commit(master_sha)
commit = repo.create_git_commit(commit_message, tree, [parent])
master_ref.edit(commit.sha)
</code></pre>
    <p class="normal">We can see the <code class="inlineCode">configs</code> directory<a id="_idIndexMarker1132"/> in the GitHub repository:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_12.png"/></figure>
    <p class="packt_figref">Figure 14.12: Conﬁgs directory</p>
    <p class="normal">The commit history shows the commit from our script:</p>
    <figure class="mediaobject"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B18403_14_13.png"/></figure>
    <p class="packt_figref">Figure 14.13: Commit history</p>
    <p class="normal">In the GitHub example section, we saw how we could collaborate with other developers by forking the repository and making pull requests. Let’s look at how we can further collaborate with Git.</p>
    <h1 class="heading-1" id="_idParaDest-305">Collaborating with Git</h1>
    <p class="normal">Git is an awesome collaboration technology, and GitHub is an incredibly effective way to develop projects together. GitHub provides a place for anyone in the world with internet access to share their thoughts and code for free. We know how to use Git and some basic collaboration steps using GitHub, but how do we join and contribute to a project?</p>
    <p class="normal">Sure, we would like to give back to these<a id="_idIndexMarker1133"/> open-source projects that have given us so much, but how do we get started?</p>
    <p class="normal">In this section, we’ll look at some of the things to know about software development collaboration using Git and GitHub:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Start small</strong>: One of the most important things to understand is the role we can play within a team. We might be awesome at network engineering, but mediocre at Python development. There are plenty of things we can do that don’t involve being a highly skilled developer. Don’t be afraid to start small; documentation and testing are two good ways to get your foot in the door as a contributor.</li>
      <li class="bulletList"><strong class="keyWord">Learn the ecosystem</strong>: With any project, large or small, there is a set of conventions and a culture that has been established. We are all drawn to Python for its easy-to-read syntax and beginner-friendly culture; it also has a development guide centered around that ideology (<a href="https://devguide.python.org/"><span class="url">https://devguide.python.org/</span></a>). The Ansible project, on the other hand, also has an extensive community guide (<a href="https://docs.ansible.com/ansible/latest/community/index.html"><span class="url">https://docs.ansible.com/ansible/latest/community/index.html</span></a>). It includes the code of conduct, the pull request process, how to report bugs, and the release process. Read these guides and learn the ecosystem for the project of interest.</li>
      <li class="bulletList"><strong class="keyWord">Make a branch</strong>: I made the mistake of forking a project and making a pull request for the main branch. The main branch should be left alone for the core contributors to make changes. We should create a separate branch for our contribution and allow the branch to be merged later.</li>
      <li class="bulletList"><strong class="keyWord">Keep the forked repository synchronized</strong>: Once you have forked a project, no rule forces the cloned repository to sync with the main repository. We should make a point to regularly do <code class="inlineCode">git pull</code> (get the code and merge locally) or <code class="inlineCode">git</code> <code class="inlineCode">fetch</code> (get the code with any change locally) to ensure we have the latest copy of the main repository.</li>
      <li class="bulletList"><strong class="keyWord">Be friendly</strong>: Just as in the real world, the virtual world has no place for hostility. When discussing an issue, be civil and friendly, even in disagreements.</li>
    </ul>
    <p class="normal">Git and GitHub provide a way for any motivated individual to make a difference by making it easy to collaborate on projects. We are all empowered to contribute to any open source or private projects that interest us.</p>
    <h1 class="heading-1" id="_idParaDest-306">Summary</h1>
    <p class="normal">In this chapter, we looked at the version-control system known as Git and its close sibling, GitHub. Git was developed by Linus Torvolds in 2005 to help develop the Linux kernel and was later adopted by other open-source projects as their source-control system. Git is a fast, distributed, and scalable system. GitHub provides a centralized location to host Git repositories on the internet that allows anybody with an internet connection to collaborate.</p>
    <p class="normal">We looked at how to use Git in the command line and its various operations and how they are applied in GitHub. We also studied two popular Python libraries for working with Git: GitPython and PyGithub. We ended this chapter with a configuration backup example and notes about project collaboration.</p>
    <p class="normal">In <em class="chapterRef">Chapter 15</em>,<em class="chapterRef"> </em><em class="italic">Continuous Integration with GitLab</em>, we will look at another popular open-source tool used for continuous integration and deployment: GitLab.</p>
    <h1 class="heading-1">Join our book community</h1>
    <p class="normal">To join our community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/networkautomationcommunity"><span class="url">https://packt.link/networkautomationcommunity</span></a></p>
    <p class="normal"><img alt="" src="../Images/QR_Code2903617220506617062.png"/></p>
  </div>
</body></html>