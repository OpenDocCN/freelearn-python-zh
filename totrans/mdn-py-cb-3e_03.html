<html><head></head><body>
<section data-number="0.6" id="chapter-3-function-definitions">
<h2 class="likechapterhead" data-number="0.6"><span><span class="kobospan" id="kobo.1.1">3</span></span><br class="tipbox1"/> <span id="x1-1610003"/><span class="kobospan" id="kobo.2.1">Function Definitions</span></h2>
<p class="normal"><span class="kobospan" id="kobo.3.1">Function definitions are</span><span id="dx1-161001"/><span class="kobospan" id="kobo.4.1"> a way to decompose a large problem into smaller problems. </span><span class="kobospan" id="kobo.4.2">Mathematicians have been doing this for centuries. </span><span class="kobospan" id="kobo.4.3">It’s a way to package our Python programming into intellectually manageable chunks.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.5.1">We’ll look at a number of function definition techniques in these recipes. </span><span class="kobospan" id="kobo.5.2">This will include ways to handle flexible parameters and ways to organize the parameters based on some higher-level design principles.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.6.1">We’ll also look at the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.7.1">typing</span></span></span></span><span class="kobospan" id="kobo.8.1"> module and how we can create more formal type hints for our functions. </span><span class="kobospan" id="kobo.8.2">Using type hints will prepare our code so we can use</span><span id="dx1-161002"/><span class="kobospan" id="kobo.9.1"> tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.10.1">mypy </span></span><span class="kobospan" id="kobo.11.1">to confirm the data types are used properly throughout a program. </span><span class="kobospan" id="kobo.11.2">Type hints aren’t required, but they often identify potential inconsistencies, allowing us to write code that prevents problems.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.12.1">In this chapter, we’ll look at the following recipes:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><a href="ch007_split_000.xhtml#x1-1620001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.13.1">Function parameters and type hints</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_000.xhtml#x1-1680002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.14.1">Designing functions with optional parameters</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_000.xhtml#x1-1760003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.15.1">Using super flexible keyword parameters</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_000.xhtml#x1-1820004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.16.1">Forcing keyword-only arguments with the * separator</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_000.xhtml#x1-1880005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.17.1">Defining position-only parameters with the / separator</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_001.xhtml#x1-1940006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.18.1">Picking an order for parameters based on partial functions</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_001.xhtml#x1-2030007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.19.1">Writing clear documentation strings with RST markup</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_001.xhtml#x1-2090008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.20.1">Designing recursive functions around Python’s stack limits</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch007_split_001.xhtml#x1-2150009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.21.1">Writing testable scripts with the script-library switch</span></span></a></p></li>
</ul>
<p class="normal1"><span id="x1-161003r281"/></p>
<section data-number="0.6.1" id="function-parameters-and-type-hints">
<h1 class="unnumbered" data-number="0.6.1"><span><span class="kobospan" id="kobo.22.1">3.1 </span></span> <span id="x1-1620001"/><span class="kobospan" id="kobo.23.1">Function parameters and type hints</span></h1>
<p class="normal"><span class="kobospan" id="kobo.24.1">Through a number</span><span id="dx1-162001"/><span class="kobospan" id="kobo.25.1"> of Python Enhancement Proposals, type hints</span><span id="dx1-162002"/><span class="kobospan" id="kobo.26.1"> have grown in sophistication. </span><span class="kobospan" id="kobo.26.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.27.1">mypy </span></span><span class="kobospan" id="kobo.28.1">tool is one way to validate</span><span id="dx1-162003"/><span class="kobospan" id="kobo.29.1"> these type hints to be sure the hints and the code agree. </span><span class="kobospan" id="kobo.29.2">All the examples shown in this book have been checked with the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.30.1">mypy </span></span><span class="kobospan" id="kobo.31.1">tool.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.32.1">This extra syntax for the hints is optional. </span><span class="kobospan" id="kobo.32.2">It has limited use at runtime and has no performance costs. </span><span id="x1-162004r279"/></p>
<section data-number="0.6.1.1" id="getting-ready-21">
<h2 class="likechapterhead" data-number="0.6.1.1"><span><span class="kobospan" id="kobo.33.1">3.1.1 </span></span> <span id="x1-1630001"/><span class="kobospan" id="kobo.34.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.35.1">We’ll need to download and install the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.36.1">mypy </span></span><span class="kobospan" id="kobo.37.1">tool. </span><span class="kobospan" id="kobo.37.2">Generally, this is done with the following terminal command:</span></p>
<pre class="programlisting" id="listing-29"><code class="calibre13"><span class="kobospan" id="kobo.38.1">(cookbook3) % python -m pip install mypy</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.39.1">Using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.40.1">python</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.41.1"> -m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.42.1"> pip</span></span></span></span><span class="kobospan" id="kobo.43.1"> command ensures the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.44.1">pip</span></span></span></span><span class="kobospan" id="kobo.45.1"> command will be associated with the currently active virtual environment. </span><span class="kobospan" id="kobo.45.2">In this example, the prompt shows a virtual environment named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.46.1">cookbook3</span></span></span></span><span class="kobospan" id="kobo.47.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.48.1">We can also use the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.49.1">pyright </span></span><span class="kobospan" id="kobo.50.1">tool to examine</span><span id="dx1-163002"/><span class="kobospan" id="kobo.51.1"> type hints.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.52.1">For an example of type hints, we’ll look at some color computations. </span><span class="kobospan" id="kobo.52.2">The first of these is extracting the Red, Green, and Blue values from the color codes commonly used in the style sheets for HTML pages. </span><span class="kobospan" id="kobo.52.3">There are a variety of ways of encoding the values, including strings, integers, and tuples. </span><span class="kobospan" id="kobo.52.4">Here are some of the varieties of data types:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.53.1">A string of six hexadecimal characters with a leading </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.54.1">#</span></span></span></span><span class="kobospan" id="kobo.55.1"> , for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.56.1">"#C62D42"</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.57.1">A string of six hexadecimal characters, for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.58.1">"C62D42"</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.59.1">A Python numeric value, for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.60.1">0xC62D42</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.61.1">A three-tuple of R, G, and B integers, for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.62.1">(198,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.63.1"> 45,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.64.1"> 66)</span></span></span></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.65.1">For strings and numbers, we use the type name directly, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.66.1">str</span></span></span></span><span class="kobospan" id="kobo.67.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.68.1">int</span></span></span></span><span class="kobospan" id="kobo.69.1">. </span><span class="kobospan" id="kobo.69.2">For tuples, we use a more complicated-looking </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.70.1">tuple[int,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.71.1"> int,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.72.1"> int]</span></span></span></span><span class="kobospan" id="kobo.73.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.74.1">The target is three integer</span><span id="dx1-163003"/><span class="kobospan" id="kobo.75.1"> values. </span><span class="kobospan" id="kobo.75.2">A conversion</span><span id="dx1-163004"/><span class="kobospan" id="kobo.76.1"> from string or integer to three values involves two separate steps:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-163006x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.77.1">If the value is a string, convert to a single integer using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.78.1">int()</span></span></span></span><span class="kobospan" id="kobo.79.1"> function.</span></p>
</div></li>
<li class="calibre7"><div id="x1-163008x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.80.1">For single integer values, split the integer into three separate values using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.81.1">&gt;&gt;</span></span></span></span><span class="kobospan" id="kobo.82.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.83.1">&amp;</span></span></span></span><span class="kobospan" id="kobo.84.1"> operators. </span><span class="kobospan" id="kobo.84.2">This is the core computation for converting a single integer value, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.85.1">hx_int</span></span></span></span><span class="kobospan" id="kobo.86.1">, into three separate </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.87.1">r,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.88.1"> g,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.89.1"> b</span></span></span></span><span class="kobospan" id="kobo.90.1"> values:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.91.1">
r, g, b = (hx_int &gt;&gt; 16) &amp; 0xFF, (hx_int &gt;&gt; 8) &amp; 0xFF, hx_int &amp; 0xFF</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.92.1">A single RGB integer has three separate values that are combined via bit shifting. </span><span class="kobospan" id="kobo.92.2">The red value was shifted left 16 bits. </span><span class="kobospan" id="kobo.92.3">To extract this component, the value is shifted right 16 bits using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.93.1">&gt;&gt;</span></span></span></span><span class="kobospan" id="kobo.94.1"> operator. </span><span class="kobospan" id="kobo.94.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.95.1">&amp;</span></span></span></span><span class="kobospan" id="kobo.96.1"> operator applies </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.97.1">0xff</span></span></span></span><span class="kobospan" id="kobo.98.1"> as a ”mask” to save only 8 bits of a potentially larger number. </span><span class="kobospan" id="kobo.98.2">To extract the green component, shift right 8 bits. </span><span class="kobospan" id="kobo.98.3">The blue value occupies the least-significant 8 bits. </span><span id="x1-163011r285"/></p>
</section>
<section data-number="0.6.1.2" id="how-to-do-it...-21">
<h2 class="likechapterhead" data-number="0.6.1.2"><span><span class="kobospan" id="kobo.99.1">3.1.2 </span></span> <span id="x1-1640002"/><span class="kobospan" id="kobo.100.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.101.1">For some functions, it can be easiest to start with a working implementation and add hints. </span><span class="kobospan" id="kobo.101.2">Here’s how it works:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-164002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.102.1">Write the function without any hints:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.103.1">def hex2rgb_1(hx_int): 
 
    if isinstance(hx_int, str): 
 
        if hx_int[0] == "#": 
 
            hx_int = int(hx_int [1:], 16) 
 
        else: 
 
            hx_int = int(hx_int, 16) 
 
    r, g, b = (hx_int &gt;&gt; 16) &amp; 0xff, (hx_int &gt;&gt; 8) &amp; 0xff, hx_int &amp; 0xff 
 
    return r, g, b</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-164013x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.104.1">Add the result hint. </span><span class="kobospan" id="kobo.104.2">It’s based on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.105.1">return</span></span></span></span><span class="kobospan" id="kobo.106.1"> statement. </span><span class="kobospan" id="kobo.106.2">In this example, the return is a tuple of three integers, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.107.1">tuple[int,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.108.1"> int,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.109.1"> int]</span></span></span></span><span class="kobospan" id="kobo.110.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-164015x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.111.1">Add the parameter hints. </span><span class="kobospan" id="kobo.111.2">In this case, we’ve got two alternative types for the parameter: it can be a string or an integer. </span><span class="kobospan" id="kobo.111.3">In the formal language of the type hints, this is a union of two types. </span><span class="kobospan" id="kobo.111.4">The parameter can be described as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.112.1">Union[str,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.113.1"> int]</span></span></span></span><span class="kobospan" id="kobo.114.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.115.1">str</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.116.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.117.1"> int</span></span></span></span><span class="kobospan" id="kobo.118.1">. </span><span class="kobospan" id="kobo.118.2">If </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.119.1">Union</span></span></span></span><span class="kobospan" id="kobo.120.1"> is used, the definition must be imported from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.121.1">typing</span></span></span></span><span class="kobospan" id="kobo.122.1"> module.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.123.1">Combining the hints into a function</span><span id="dx1-164016"/><span class="kobospan" id="kobo.124.1"> leads to the following</span><span id="dx1-164017"/><span class="kobospan" id="kobo.125.1"> definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.126.1">def hex2rgb(hx_int: int | str) -&gt; tuple[int, int, int]: 
 
    if isinstance(hx_int, str): 
 
        if hx_int[0] == "#": 
 
            hx_int = int(hx_int[1:], 16) 
 
        else: 
 
            hx_int = int(hx_int, 16) 
 
    r, g, b = (hx_int &gt;&gt; 16) &amp; 0xff, (hx_int &gt;&gt; 8) &amp; 0xff, hx_int &amp; 0xff 
 
    return r, g, b</span></code></pre>
<p class="normal1"><span id="x1-164027r287"/></p>
</section>
<section data-number="0.6.1.3" id="how-it-works...-21">
<h2 class="likechapterhead" data-number="0.6.1.3"><span><span class="kobospan" id="kobo.127.1">3.1.3 </span></span> <span id="x1-1650003"/><span class="kobospan" id="kobo.128.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.129.1">These type hints have no impact when the Python code is executed. </span><span class="kobospan" id="kobo.129.2">The hints are designed for people to read</span><span id="dx1-165001"/><span class="kobospan" id="kobo.130.1"> and for external tools, like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.131.1">mypy</span></span><span class="kobospan" id="kobo.132.1">, to verify. </span><span class="kobospan" id="kobo.132.2">A tool can confirm that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.133.1">hx_int</span></span></span></span><span class="kobospan" id="kobo.134.1"> variable is always used as either an integer or a string.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.135.1">In the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.136.1">r,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.137.1"> g,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.138.1"> b</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.139.1"> =</span></span></span></span><span class="kobospan" id="kobo.140.1"> assignment statement, the value for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.141.1">hx_int</span></span></span></span><span class="kobospan" id="kobo.142.1"> is expected to be an integer. </span><span class="kobospan" id="kobo.142.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.143.1">mypy </span></span><span class="kobospan" id="kobo.144.1">tool can confirm the operators are appropriate for integer values, and the return type matches the computed types.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.145.1">We can observe the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.146.1">mypy </span></span><span class="kobospan" id="kobo.147.1">tool’s analysis</span><span id="dx1-165002"/><span class="kobospan" id="kobo.148.1"> of a type by inserting the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.149.1">reveal_type(hx_int)</span></span></span></span><span class="kobospan" id="kobo.150.1"> function into our code. </span><span class="kobospan" id="kobo.150.2">This statement has function-like syntax; it’s only used when running the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.151.1">mypy </span></span><span class="kobospan" id="kobo.152.1">tool. </span><span class="kobospan" id="kobo.152.2">We will only see output from this when we run </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.153.1">mypy</span></span><span class="kobospan" id="kobo.154.1">, and we have to remove this extra line of code before we try to do anything else with the module.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.155.1">The output looks like this when we run </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.156.1">mypy </span></span><span class="kobospan" id="kobo.157.1">at the shell prompt on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.158.1">recipe_01_reveal.py</span></span></span></span><span class="kobospan" id="kobo.159.1"> file:</span></p>
<pre class="programlisting" id="listing-30"><code class="calibre13"><span class="kobospan" id="kobo.160.1">(cookbook3) % mypy src/ch03/recipe_01_reveal.py 
 
src/ch03/recipe_01_reveal.py:15: note: Revealed type is "builtins.int" 
 
Success: no issues found in 1 source file</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.161.1">The output from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.162.1">reveal_type(hx_int)</span></span></span></span><span class="kobospan" id="kobo.163.1"> line tells us </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.164.1">mypy </span></span><span class="kobospan" id="kobo.165.1">is certain the variable will have an integer value after the first </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.166.1">if</span></span></span></span><span class="kobospan" id="kobo.167.1"> statement is complete. </span><span class="kobospan" id="kobo.167.2">Once we’ve seen the revealed type</span><span id="dx1-165006"/><span class="kobospan" id="kobo.168.1"> information, we need to delete</span><span id="dx1-165007"/><span class="kobospan" id="kobo.169.1"> the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.170.1">reveal_type(hx_int)</span></span></span></span><span class="kobospan" id="kobo.171.1"> line from the file. </span><span id="x1-165008r290"/></p>
</section>
<section data-number="0.6.1.4" id="theres-more...-15">
<h2 class="likechapterhead" data-number="0.6.1.4"><span><span class="kobospan" id="kobo.172.1">3.1.4 </span></span> <span id="x1-1660004"/><span class="kobospan" id="kobo.173.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.174.1">Let’s look at a related computation. </span><span class="kobospan" id="kobo.174.2">This converts RGB</span><span id="dx1-166001"/><span class="kobospan" id="kobo.175.1"> numbers into</span><span id="dx1-166002"/> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.176.1">Hue-Saturation-Lightness </span></span><span class="kobospan" id="kobo.177.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.178.1">HSL</span></span><span class="kobospan" id="kobo.179.1">) values. </span><span class="kobospan" id="kobo.179.2">These HSL values can be used to compute complementary colors. </span><span class="kobospan" id="kobo.179.3">An additional algorithm required to convert from HSL back into RGB values can help encode colors for a web page:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.180.1">RGB to HSL: We’ll look at this closely because it has complex type hints.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.181.1">HSL to complement: There are a number of theories on what the ”best” complement might be. </span><span class="kobospan" id="kobo.181.2">We’ll gloss over the details.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.182.1">HSL to RGB: This will be the final step, but we’ll ignore the details of this computation.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.183.1">We won’t look closely at two of the implementations. </span><span class="kobospan" id="kobo.183.2">They are not horribly complicated, but these computation details can be a distraction from understanding</span><span id="dx1-166003"/><span class="kobospan" id="kobo.184.1"> the types and type hints. </span><span class="kobospan" id="kobo.184.2">See </span><a class="url" href="https://www.easyrgb.com/en/math.php"><span class="url1"><span class="kobospan" id="kobo.185.1">https://www.easyrgb.com/en/math.php</span></span></a><span class="kobospan" id="kobo.186.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.187.1">We start by roughing out a definition of the function with a stub definition, like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.188.1">def rgb_to_hsl_t(rgb: tuple[int, int, int]) -&gt; tuple[float, float, float]: 
 
    ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.189.1">This can help us visualize a number of related functions to be sure they all have consistent types. </span><span class="kobospan" id="kobo.189.2">The other two functions have stubs like these:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.190.1">def hsl_comp_t(hsl: tuple[float, float, float]) -&gt; tuple[float, float, float]: 
 
    ...</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.191.1">def hsl_to_rgb_t(hsl: tuple[float, float, float]) -&gt; tuple[int, int, int]: 
 
    ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.192.1">After writing down this initial list</span><span id="dx1-166013"/><span class="kobospan" id="kobo.193.1"> of stub</span><span id="dx1-166014"/><span class="kobospan" id="kobo.194.1"> definitions, we can see some type hints are repeated in slightly different contexts. </span><span class="kobospan" id="kobo.194.2">This suggests we need to create a separate named type to avoid repetition of the details. </span><span class="kobospan" id="kobo.194.3">We’ll provide a name for the repeated type detail:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.195.1">from typing import TypeAlias 
 
 
 
RGB_a: TypeAlias = tuple[int, int, int] 
 
 
 
HSL_a: TypeAlias = tuple[float, float, float]</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.196.1">
 
 
def rgb_to_hsl(color: RGB_a) -&gt; HSL_a: 
 
    ...</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.197.1">
 
 
def hsl_complement(color: HSL_a) -&gt; HSL_a: 
 
    ...</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.198.1">
 
 
def hsl_to_rgb(color: HSL_a) -&gt; RGB_a: 
 
    ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.199.1">This overview of the various functions can be helpful for assuring that each function uses data in a way that’s consistent with other functions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.200.1">The names </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.201.1">RGB_a</span></span></span></span><span class="kobospan" id="kobo.202.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.203.1">HSL_a</span></span></span></span><span class="kobospan" id="kobo.204.1"> include a suffix of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.205.1">_a</span></span></span></span><span class="kobospan" id="kobo.206.1"> to help distinguish these type aliases from other examples in this recipe. </span><span class="kobospan" id="kobo.206.2">In a practical application, the suffix strings like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.207.1">_a</span></span></span></span><span class="kobospan" id="kobo.208.1"> to show the name is an alias are going to become visual clutter and should be avoided.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.209.1">As noted in the </span><a href="ch005_split_001.xhtml#x1-7500010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.210.1">Using NamedTuples to simplify item access in tuples</span></span></a><span class="kobospan" id="kobo.211.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.212.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.213.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.214.1">1</span></span></a><span class="kobospan" id="kobo.215.1">, we can provide a more descriptive</span><span id="dx1-166030"/><span class="kobospan" id="kobo.216.1"> set of names</span><span id="dx1-166031"/><span class="kobospan" id="kobo.217.1"> for these tuple types:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.218.1">from typing import NamedTuple 
 
 
 
class RGB(NamedTuple): 
 
    red: int 
 
    green: int 
 
    blue: int</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.219.1">We’ve defined a unique, new </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.220.1">NamedTuple</span></span></span></span><span class="kobospan" id="kobo.221.1"> subclass, called </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.222.1">RGB</span></span></span></span><span class="kobospan" id="kobo.223.1">. </span><span class="kobospan" id="kobo.223.2">Using names can help clarify the intent behind the code. </span><span id="x1-166039r291"/></p>
</section>
<section data-number="0.6.1.5" id="see-also-21">
<h2 class="likechapterhead" data-number="0.6.1.5"><span><span class="kobospan" id="kobo.224.1">3.1.5 </span></span> <span id="x1-1670005"/><span class="kobospan" id="kobo.225.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.226.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.227.1">mypy </span></span><span class="kobospan" id="kobo.228.1">project contains a wealth of information. </span><span class="kobospan" id="kobo.228.2">See </span><a class="url" href="https://mypy.readthedocs.io"><span class="url1"><span class="kobospan" id="kobo.229.1">https://mypy.readthedocs.io</span></span></a><span class="kobospan" id="kobo.230.1"> for more information on the way type hints work.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.231.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.232.1">pyright </span></span><span class="kobospan" id="kobo.233.1">project is another</span><span id="dx1-167001"/><span class="kobospan" id="kobo.234.1"> helpful type hint tool. </span><span class="kobospan" id="kobo.234.2">See </span><a class="url" href="https://microsoft.github.io/pyright"><span class="url1"><span class="kobospan" id="kobo.235.1">https://microsoft.github.io/pyright</span></span></a><span class="kobospan" id="kobo.236.1"> for more information.</span></p></li>
</ul>
<p class="normal1"><span id="x1-167002r284"/></p>
</section>
</section>
<section data-number="0.6.2" id="designing-functions-with-optional-parameters">
<h1 class="unnumbered" data-number="0.6.2"><span><span class="kobospan" id="kobo.237.1">3.2 </span></span> <span id="x1-1680002"/><span class="kobospan" id="kobo.238.1">Designing functions with optional parameters</span></h1>
<p class="normal"><span class="kobospan" id="kobo.239.1">When we define a function, we often have a need</span><span id="dx1-168001"/><span class="kobospan" id="kobo.240.1"> for optional</span><span id="dx1-168002"/><span class="kobospan" id="kobo.241.1"> parameters. </span><span class="kobospan" id="kobo.241.2">This allows us to write functions that are more flexible and easier to read.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.242.1">We can also think of this as a way to create a family of closely related functions. </span><span class="kobospan" id="kobo.242.2">Each function has a slightly different collection</span><span id="dx1-168003"/><span class="kobospan" id="kobo.243.1"> of parameters – called the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.244.1">signature </span></span><span class="kobospan" id="kobo.245.1">– but all sharing the same simple name. </span><span class="kobospan" id="kobo.245.2">This is sometimes</span><span id="dx1-168004"/><span class="kobospan" id="kobo.246.1"> called an ”overloaded” function. </span><span class="kobospan" id="kobo.246.2">Within the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.247.1">typing</span></span></span></span><span class="kobospan" id="kobo.248.1"> module, an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.249.1">@overload</span></span></span></span><span class="kobospan" id="kobo.250.1"> decorator can help create type hints in the more complicated cases.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.251.1">An example of an optional parameter is the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.252.1">int()</span></span></span></span><span class="kobospan" id="kobo.253.1"> function. </span><span class="kobospan" id="kobo.253.2">This function has two signatures:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.254.1">int(str)</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.255.1"> -&gt;</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.256.1"> int</span></span></span></span><span class="kobospan" id="kobo.257.1">. </span><span class="kobospan" id="kobo.257.2">For example, the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.258.1">int(’355’)</span></span></span></span><span class="kobospan" id="kobo.259.1"> has a value of 355. </span><span class="kobospan" id="kobo.259.2">An optional </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.260.1">base</span></span></span></span><span class="kobospan" id="kobo.261.1"> parameter defaults to a value of 10.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.262.1">int(str,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.263.1"> base)</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.264.1"> -&gt;</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.265.1"> int</span></span></span></span><span class="kobospan" id="kobo.266.1">. </span><span class="kobospan" id="kobo.266.2">For example, the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.267.1">int(’163’,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.268.1"> 16)</span></span></span></span><span class="kobospan" id="kobo.269.1"> is 355. </span><span class="kobospan" id="kobo.269.2">In this case, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.270.1">base</span></span></span></span><span class="kobospan" id="kobo.271.1"> parameter value is 16.</span></p></li>
</ul>
<p class="normal1"><span id="x1-168005r300"/></p>
<section data-number="0.6.2.1" id="getting-ready-22">
<h2 class="likechapterhead" data-number="0.6.2.1"><span><span class="kobospan" id="kobo.272.1">3.2.1 </span></span> <span id="x1-1690001"/><span class="kobospan" id="kobo.273.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.274.1">A great many games rely on collections</span><span id="dx1-169001"/><span class="kobospan" id="kobo.275.1"> of dice. </span><span class="kobospan" id="kobo.275.2">The casino</span><span id="dx1-169002"/><span class="kobospan" id="kobo.276.1"> game of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.277.1">Craps </span></span><span class="kobospan" id="kobo.278.1">uses two dice. </span><span class="kobospan" id="kobo.278.2">A game like </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.279.1">Zonk </span></span><span class="kobospan" id="kobo.280.1">(or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.281.1">Greed </span></span><span class="kobospan" id="kobo.282.1">or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.283.1">Ten Thousand</span></span><span class="kobospan" id="kobo.284.1">) uses six dice. </span><span class="kobospan" id="kobo.284.2">It’s handy to have a dice-rolling function that can handle all of these variations. </span><span id="x1-169003r302"/></p>
</section>
<section data-number="0.6.2.2" id="how-to-do-it...-22">
<h2 class="likechapterhead" data-number="0.6.2.2"><span><span class="kobospan" id="kobo.285.1">3.2.2 </span></span> <span id="x1-1700002"/><span class="kobospan" id="kobo.286.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.287.1">We have two approaches to designing a function with optional parameters:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.288.1">General to particular</span></span><span class="kobospan" id="kobo.289.1">: Start by designing the most general solution and provide defaults for the most common case.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.290.1">Particular to general</span></span><span class="kobospan" id="kobo.291.1">: Start by designing several related functions. </span><span class="kobospan" id="kobo.291.2">We then merge them into one general function that covers all of the cases, singling out one of the original functions to be the default behavior.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.292.1">We’ll look at the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.293.1">particular to general </span></span><span class="kobospan" id="kobo.294.1">approach first, because it’s often easier to start with a number of concrete examples.</span></p>
<section data-number="0.6.2.2.1" id="particular-to-general-design">
<h3 class="likesubsubsectionhead" data-number="0.6.2.2.1"><span id="x1-1710002"/><span class="kobospan" id="kobo.295.1">Particular to general design</span></h3>
<p class="normal"><span class="kobospan" id="kobo.296.1">Throughout this example, we’ll use slightly</span><span id="dx1-171001"/><span class="kobospan" id="kobo.297.1"> different names as the function evolves. </span><span class="kobospan" id="kobo.297.2">This simplifies unit testing the different versions and comparing them. </span><span class="kobospan" id="kobo.297.3">Here’s how we’ll proceed:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-171003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.298.1">Write one game function. </span><span class="kobospan" id="kobo.298.2">We’ll start with the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.299.1">Craps </span></span><span class="kobospan" id="kobo.300.1">game because it seems to be the simplest:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.301.1">import random 
 
 
 
def die() -&gt; int: 
 
    return random.randint(1, 6) 
 
 
 
def craps() -&gt; tuple[int, int]: 
 
    return (die(), die())</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.302.1">We defined a function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.303.1">die()</span></span></span></span><span class="kobospan" id="kobo.304.1">, to encapsulate a basic fact about standard dice. </span><span class="kobospan" id="kobo.304.2">Five platonic solids are often used, yielding four-sided, six-sided, eight-sided, twelve-sided, and twenty-sided dice. </span><span class="kobospan" id="kobo.304.3">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.305.1">randint()</span></span></span></span><span class="kobospan" id="kobo.306.1"> expression assumes a six-sided cube.</span></p>
</div></li>
<li class="calibre7"><div id="x1-171013x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.307.1">Write the next game function. </span><span class="kobospan" id="kobo.307.2">We’ll move on to the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.308.1">Zonk </span></span><span class="kobospan" id="kobo.309.1">game:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.310.1">def zonk() -&gt; tuple[int, ...]: 
 
  return tuple(die() for x in range(6))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.311.1">We’ve used a generator expression to create a tuple object with a collection of six dice. </span><span class="kobospan" id="kobo.311.2">We’ll look at generator expressions in depth in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.312.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.313.1"> </span></span><a href="ch013_split_000.xhtml#x1-5020009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.314.1">9</span></span></a><span class="kobospan" id="kobo.315.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.316.1">The generator expression in the body of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.317.1">zonk()</span></span></span></span><span class="kobospan" id="kobo.318.1"> function has a variable, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.319.1">x</span></span></span></span><span class="kobospan" id="kobo.320.1">, which is required syntax, but the value is ignored. </span><span class="kobospan" id="kobo.320.2">It’s also common to see this written as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.321.1">tuple(die()</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.322.1"> for</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.323.1"> _</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.324.1"> in</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.325.1"> range(6))</span></span></span></span><span class="kobospan" id="kobo.326.1">. </span><span class="kobospan" id="kobo.326.2">The variable </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.327.1">_</span></span></span></span><span class="kobospan" id="kobo.328.1"> is a valid Python variable name, often used when a variable name is required, but is never used.</span></p>
</div></li>
<li class="calibre7"><div id="x1-171018x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.329.1">Locate the common features</span><span id="dx1-171019"/><span class="kobospan" id="kobo.330.1"> in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.331.1">craps()</span></span></span></span><span class="kobospan" id="kobo.332.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.333.1">zonk()</span></span></span></span><span class="kobospan" id="kobo.334.1"> functions. </span><span class="kobospan" id="kobo.334.2">In this case, we can refactor the design of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.335.1">craps()</span></span></span></span><span class="kobospan" id="kobo.336.1"> function to follow the pattern set by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.337.1">zonk()</span></span></span></span><span class="kobospan" id="kobo.338.1"> function. </span><span class="kobospan" id="kobo.338.2">Rather than building exactly two evaluations of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.339.1">die()</span></span></span></span><span class="kobospan" id="kobo.340.1"> function, we can introduce a generator expression based on </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.341.1">range(2)</span></span></span></span><span class="kobospan" id="kobo.342.1"> that will evaluate the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.343.1">die()</span></span></span></span><span class="kobospan" id="kobo.344.1"> function twice:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.345.1">def craps_v2() -&gt; tuple[int, ...]: 
 
    return tuple(die() for x in range(2))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.346.1">Merge the two functions. </span><span class="kobospan" id="kobo.346.2">This will often involve exposing a variable that had previously been a literal value:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.347.1">def dice_v2(n: int) -&gt; tuple[int, ...]: 
 
    return tuple(die() for x in range(n))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.348.1">This provides a general function that covers the needs of both the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.349.1">Craps </span></span><span class="kobospan" id="kobo.350.1">and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.351.1">Zonk </span></span><span class="kobospan" id="kobo.352.1">games.</span></p>
</div></li>
<li class="calibre7"><div id="x1-171027x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.353.1">Identify the most common use case and make this the default value for any parameters that were introduced. </span><span class="kobospan" id="kobo.353.2">If our most common simulation was </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.354.1">Craps</span></span><span class="kobospan" id="kobo.355.1">, we might do this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.356.1">def dice_v3(n: int = 2) -&gt; tuple[int, ...]: 
 
    return tuple(die() for x in range(n))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.357.1">Now, we can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.358.1">dice_v3()</span></span></span></span><span class="kobospan" id="kobo.359.1"> for the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.360.1">Craps </span></span><span class="kobospan" id="kobo.361.1">game. </span><span class="kobospan" id="kobo.361.2">We’ll need to use the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.362.1">dice_v3(6)</span></span></span></span><span class="kobospan" id="kobo.363.1"> for the first roll of a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.364.1">Zonk </span></span><span class="kobospan" id="kobo.365.1">game.</span></p>
</div></li>
<li class="calibre7"><div id="x1-171032x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.366.1">Check the type hints to be sure they describe the parameters and the return values. </span><span class="kobospan" id="kobo.366.2">In this case, we have one parameter with an integer value, and the return is a tuple of integers, described by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.367.1">tuple[int,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.368.1"> ...]</span></span></span></span><span class="kobospan" id="kobo.369.1">.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.370.1">Throughout this example, the name evolved from </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.371.1">dice()</span></span></span></span><span class="kobospan" id="kobo.372.1"> to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.373.1">dice_v2()</span></span></span></span><span class="kobospan" id="kobo.374.1"> and then to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.375.1">dice_v3()</span></span></span></span><span class="kobospan" id="kobo.376.1">. </span><span class="kobospan" id="kobo.376.2">This can make it easier to see the differences here in the recipe. </span><span class="kobospan" id="kobo.376.3">Once a final version is written, it makes sense to delete the others and rename the final versions of these functions to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.377.1">dice()</span></span></span></span><span class="kobospan" id="kobo.378.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.379.1">craps()</span></span></span></span><span class="kobospan" id="kobo.380.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.381.1">zonk()</span></span></span></span><span class="kobospan" id="kobo.382.1">. </span><span class="kobospan" id="kobo.382.2">The story of their evolution may become a blog post, but it doesn’t need to be preserved</span><span id="dx1-171033"/><span class="kobospan" id="kobo.383.1"> in the code.</span></p>
</section>
<section data-number="0.6.2.2.2" id="general-to-particular-design">
<h3 class="likesubsubsectionhead" data-number="0.6.2.2.2"><span id="x1-1720002"/><span class="kobospan" id="kobo.384.1">General to particular design</span></h3>
<p class="normal"><span class="kobospan" id="kobo.385.1">When following the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.386.1">general to particular </span></span><span class="kobospan" id="kobo.387.1">strategy, we’ll identify</span><span id="dx1-172001"/><span class="kobospan" id="kobo.388.1"> all of the needs first. </span><span class="kobospan" id="kobo.388.2">It can be difficult to foresee all the alternatives, making this more challenging. </span><span class="kobospan" id="kobo.388.3">We’ll often do this by introducing variables to the requirements:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-172003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.389.1">Summarize the requirements for dice-rolling. </span><span class="kobospan" id="kobo.389.2">We might start with a list like this:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="cmti-10x-x"><span class="kobospan" id="kobo.390.1">Craps</span></span><span class="kobospan" id="kobo.391.1">: Two dice</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.392.1">First roll in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.393.1">Zonk</span></span><span class="kobospan" id="kobo.394.1">: Six dice</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.395.1">Subsequent rolls in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.396.1">Zonk</span></span><span class="kobospan" id="kobo.397.1">: One to six dice</span></p></li>
</ul>
</div></li>
<li class="calibre7"><div id="x1-172005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.398.1">Rewrite the requirements with an explicit parameter in place of any literal value. </span><span class="kobospan" id="kobo.398.2">We’ll replace all of our numbers with a parameter, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.399.1">n</span></span><span class="kobospan" id="kobo.400.1">. </span><span class="kobospan" id="kobo.400.2">This will take on values of 2, 6, or a value in the range 1 </span><span><span class="kobospan" id="kobo.401.1">≤ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.402.1">n </span></span><span><span class="kobospan" id="kobo.403.1">≤ </span></span><span class="kobospan" id="kobo.404.1">6. </span><span class="kobospan" id="kobo.404.2">We want to be sure we’ve properly parameterized each of the various functions.</span></p>
</div></li>
<li class="calibre7"><div id="x1-172007x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.405.1">Write the function that fits the general pattern:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.406.1">def dice_d1(n): 
 
    return tuple(die() for x in range(n))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.407.1">In the third case – subsequent rolls in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.408.1">Zonk </span></span><span class="kobospan" id="kobo.409.1">– we identified a constraint of 1 </span><span><span class="kobospan" id="kobo.410.1">≤ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.411.1">n </span></span><span><span class="kobospan" id="kobo.412.1">≤ </span></span><span class="kobospan" id="kobo.413.1">6, imposed by the application program to play </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.414.1">Zonk</span></span><span class="kobospan" id="kobo.415.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-172012x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.416.1">Provide a default value for the most common</span><span id="dx1-172013"/><span class="kobospan" id="kobo.417.1"> use case. </span><span class="kobospan" id="kobo.417.2">If our most common simulation was </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.418.1">Craps</span></span><span class="kobospan" id="kobo.419.1">, we might do this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.420.1">def dice_d2(n=2): 
 
    return tuple(die() for x in range(n))</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-172018x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.421.1">Add type hints. </span><span class="kobospan" id="kobo.421.2">These will describe the parameters and the return values. </span><span class="kobospan" id="kobo.421.3">In this case, we have one parameter with an integer value, and the return is a tuple of integers, described by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.422.1">tuple[int,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.423.1"> ...]</span></span></span></span><span class="kobospan" id="kobo.424.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.425.1">def dice(n: int=2) -&gt; tuple[int, ...]: 
 
    return tuple(die() for x in range(n))</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.426.1">Now, we can use this </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.427.1">dice()</span></span></span></span><span class="kobospan" id="kobo.428.1"> function for </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.429.1">Craps</span></span><span class="kobospan" id="kobo.430.1">. </span><span class="kobospan" id="kobo.430.2">We’ll need to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.431.1">dice(6)</span></span></span></span><span class="kobospan" id="kobo.432.1"> for the first roll in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.433.1">Zonk</span></span><span class="kobospan" id="kobo.434.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.435.1">In this recipe, the name didn’t need to evolve through multiple versions. </span><span class="kobospan" id="kobo.435.2">The name evolution is only useful in a book for unit testing each example.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.436.1">This version looks precisely like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.437.1">dice_v2()</span></span></span></span><span class="kobospan" id="kobo.438.1"> from the previous recipe. </span><span class="kobospan" id="kobo.438.2">This isn’t an accident – the two design strategies</span><span id="dx1-172022"/><span class="kobospan" id="kobo.439.1"> often converge on a common solution. </span><span id="x1-172023r303"/></p>
</section>
</section>
<section data-number="0.6.2.3" id="how-it-works...-22">
<h2 class="likechapterhead" data-number="0.6.2.3"><span><span class="kobospan" id="kobo.440.1">3.2.3 </span></span> <span id="x1-1730003"/><span class="kobospan" id="kobo.441.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.442.1">Python’s rules for providing</span><span id="dx1-173001"/><span class="kobospan" id="kobo.443.1"> parameter values enable</span><span id="dx1-173002"/><span class="kobospan" id="kobo.444.1"> several ways to ensure that each parameter is given an argument value. </span><span class="kobospan" id="kobo.444.2">We can think of the process like this:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-173004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.445.1">Where there are default values, set those parameters. </span><span class="kobospan" id="kobo.445.2">Default values make these optional.</span></p>
</div></li>
<li class="calibre7"><div id="x1-173006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.446.1">For arguments without names – for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.447.1">dice(2)</span></span></span></span><span class="kobospan" id="kobo.448.1"> – the argument values are assigned to the parameters by position.</span></p>
</div></li>
<li class="calibre7"><div id="x1-173008x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.449.1">For arguments with names – for example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.450.1">dice(n=2)</span></span></span></span><span class="kobospan" id="kobo.451.1"> – the argument values are assigned to parameters by name.</span></p>
</div></li>
<li class="calibre7"><div id="x1-173010x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.452.1">If any parameter still lacks a value, raise a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.453.1">TypeError</span></span></span></span><span class="kobospan" id="kobo.454.1"> exception.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.455.1">The rules also allow us to mix positional values with named values. </span><span class="kobospan" id="kobo.455.2">This make some parameters optional by providing a default value. </span><span id="x1-173011r314"/></p>
</section>
<section data-number="0.6.2.4" id="theres-more...-16">
<h2 class="likechapterhead" data-number="0.6.2.4"><span><span class="kobospan" id="kobo.456.1">3.2.4 </span></span> <span id="x1-1740004"/><span class="kobospan" id="kobo.457.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.458.1">It helps to write functions that are specialized versions of our more generalized function. </span><span class="kobospan" id="kobo.458.2">These functions can simplify an application:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.459.1">def craps_v3(): 
 
    return dice(2) 
 
 
 
def zonk_v3(): 
 
    return dice(6)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.460.1">Our application features – </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.461.1">craps_v3()</span></span></span></span><span class="kobospan" id="kobo.462.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.463.1">zonk_v3()</span></span></span></span><span class="kobospan" id="kobo.464.1"> – depend on a general function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.465.1">dice()</span></span></span></span><span class="kobospan" id="kobo.466.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.467.1">These form layers of dependencies, saving us from having to understand too many details. </span><span class="kobospan" id="kobo.467.2">This idea of layered</span><span id="dx1-174007"/><span class="kobospan" id="kobo.468.1"> abstractions is sometimes called </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.469.1">chunking</span></span><span class="kobospan" id="kobo.470.1">, a way of managing complexity by isolating the details. </span><span id="x1-174008r315"/></p>
</section>
<section data-number="0.6.2.5" id="see-also-22">
<h2 class="likechapterhead" data-number="0.6.2.5"><span><span class="kobospan" id="kobo.471.1">3.2.5 </span></span> <span id="x1-1750005"/><span class="kobospan" id="kobo.472.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.473.1">We’ll extend on some of these ideas in the </span><a href="ch007_split_001.xhtml#x1-1940006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.474.1">Picking an order for</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.475.1">parameters based on partial functions</span></span></a><span class="kobospan" id="kobo.476.1"> recipe, later in this chapter.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.477.1">We’ve made use of optional parameters that involve immutable objects. </span><span class="kobospan" id="kobo.477.2">In this recipe, we focused on numbers. </span><span class="kobospan" id="kobo.477.3">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.478.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.479.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.480.1">4</span></span></a><span class="kobospan" id="kobo.481.1">, we’ll look at mutable objects, which have an internal state that can be changed. </span><span class="kobospan" id="kobo.481.2">In the </span><a href="ch009.xhtml#x1-3210006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.482.1">Avoiding mutable default values for function parameters</span></span></a><span class="kobospan" id="kobo.483.1"> recipe, we’ll look at some additional considerations for optional values.</span></p></li>
</ul>
<p class="normal1"><span id="x1-175001r301"/></p>
</section>
</section>
<section data-number="0.6.3" id="using-super-flexible-keyword-parameters">
<h1 class="unnumbered" data-number="0.6.3"><span><span class="kobospan" id="kobo.484.1">3.3 </span></span> <span id="x1-1760003"/><span class="kobospan" id="kobo.485.1">Using super flexible keyword parameters</span></h1>
<p class="normal"><span class="kobospan" id="kobo.486.1">Some design problems involve</span><span id="dx1-176001"/><span class="kobospan" id="kobo.487.1"> solving a simple equation for one unknown when given enough known values. </span><span class="kobospan" id="kobo.487.2">For example, rate, time, and distance have a simple linear relationship. </span><span class="kobospan" id="kobo.487.3">We can solve for any one when given the other two.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.488.1">There are three related solutions to </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.489.1">r </span></span><span><span class="kobospan" id="kobo.490.1">× </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.491.1">t </span></span><span class="kobospan" id="kobo.492.1">= </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.493.1">d</span></span><span class="kobospan" id="kobo.494.1">:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.495.1"><img alt="d = r × t " class="math" src="../media/file14.png"/></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.496.1"><img alt="r = dt " class="math" src="../media/file15.png"/></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.497.1"><img alt=" d t = r " class="math" src="../media/file16.png"/></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.498.1">When designing electrical circuits, for example, a similar set of equations is used based on Ohm’s law. </span><span class="kobospan" id="kobo.498.2">In that case, the equations tie together resistance, current, and voltage.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.499.1">In some cases, we want an implementation that can perform any of the three different calculations based on what’s known and what’s unknown. </span><span id="x1-176002r317"/></p>
<section data-number="0.6.3.1" id="getting-ready-23">
<h2 class="likechapterhead" data-number="0.6.3.1"><span><span class="kobospan" id="kobo.500.1">3.3.1 </span></span> <span id="x1-1770001"/><span class="kobospan" id="kobo.501.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.502.1">We’ll build a single</span><span id="dx1-177001"/><span class="kobospan" id="kobo.503.1"> function that can solve a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.504.1">Rate-Time-Distance </span></span><span class="kobospan" id="kobo.505.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.506.1">RTD</span></span><span class="kobospan" id="kobo.507.1">) calculation by embodying all three solutions, given any two known values. </span><span class="kobospan" id="kobo.507.2">With minor variable name changes, this applies to a surprising number of real-world problems.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.508.1">We don’t necessarily want a single value as an answer. </span><span class="kobospan" id="kobo.508.2">We can slightly generalize this by creating a small Python dictionary with the three values in it; two are given, one is computed. </span><span class="kobospan" id="kobo.508.3">We’ll look at dictionaries in more detail in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.509.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.510.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.511.1">5</span></span></a><span class="kobospan" id="kobo.512.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.513.1">We’ll use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.514.1">warnings</span></span></span></span><span class="kobospan" id="kobo.515.1"> module instead of raising an exception when there’s a problem:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.516.1">                                                                     import warnings</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.517.1">Sometimes, it is more helpful to produce a result that is doubtful than to stop processing. </span><span id="x1-177004r319"/></p>
</section>
<section data-number="0.6.3.2" id="how-to-do-it...-23">
<h2 class="likechapterhead" data-number="0.6.3.2"><span><span class="kobospan" id="kobo.518.1">3.3.2 </span></span> <span id="x1-1780002"/><span class="kobospan" id="kobo.519.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-178002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.520.1">Solve the equation</span><span id="dx1-178003"/><span class="kobospan" id="kobo.521.1"> for each of the unknowns. </span><span class="kobospan" id="kobo.521.2">There are three separate expressions:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.522.1">distance</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.523.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.524.1"> rate</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.525.1"> *</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.526.1"> time</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.527.1">rate</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.528.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.529.1"> distance</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.530.1"> /</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.531.1"> time</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.532.1">time</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.533.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.534.1"> distance</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.535.1"> /</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.536.1"> rate</span></span></span></span></p></li>
</ul>
</div></li>
<li class="calibre7"><div id="x1-178005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.537.1">Wrap each expression in an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.538.1">if</span></span></span></span><span class="kobospan" id="kobo.539.1"> statement based on one of the values being </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.540.1">None</span></span></span></span><span class="kobospan" id="kobo.541.1"> when it’s unknown:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.542.1">
    if distance is None: 
 
        distance = rate * time 
 
 
 
    elif rate is None: 
 
        rate = distance / time 
 
 
 
    elif time is None: 
 
        time = distance / rate</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-178016x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.543.1">Refer to the </span><a href="ch006_split_000.xhtml#x1-1170005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.544.1">Designing complex if...elif chains</span></span></a><span class="kobospan" id="kobo.545.1"> recipe from </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.546.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.547.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.548.1">2</span></span></a><span class="kobospan" id="kobo.549.1">, for guidance on designing these complex </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.550.1">if...elif</span></span></span></span><span class="kobospan" id="kobo.551.1"> chains. </span><span class="kobospan" id="kobo.551.2">Include a variation</span><span id="dx1-178017"/><span class="kobospan" id="kobo.552.1"> of the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.553.1">Else-Raise </span></span><span class="kobospan" id="kobo.554.1">option:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.555.1">    else: 
 
        warnings.warning("Nothing to solve for")</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-178022x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.556.1">Build the resulting dictionary object:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.557.1">    return dict(distance=distance, rate=rate, time=time)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-178026x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.558.1">Wrap all of this as a function using keyword parameters with default values of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.559.1">None</span></span></span></span><span class="kobospan" id="kobo.560.1">. </span><span class="kobospan" id="kobo.560.2">This leads to parameter types of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.561.1">Optional[float]</span></span></span></span><span class="kobospan" id="kobo.562.1">, often stated as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.563.1">float</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.564.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.565.1"> None</span></span></span></span><span class="kobospan" id="kobo.566.1">. </span><span class="kobospan" id="kobo.566.2">The return type is a dictionary with string keys, summarized as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.567.1">dict[str,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.568.1"> float</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.569.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.570.1"> None]</span></span></span></span><span class="kobospan" id="kobo.571.1">. </span><span class="kobospan" id="kobo.571.2">It looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.572.1">def rtd( 
 
    distance: float | None = None, 
 
    rate: float | None = None, 
 
    time: float | None = None, 
 
) -&gt; dict[str, float | None]: 
 
 
 
    if distance is None and rate is not None and time is not None: 
 
        distance = rate * time 
 
    elif rate is None and distance is not None and time is not None: 
 
        rate = distance / time 
 
    elif time is None and distance is not None and rate is not None: 
 
        time = distance / rate 
 
    else: 
 
        warnings.warn("Nothing to solve for") 
 
 
 
    return dict(distance=distance, rate=rate, time=time)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.573.1">The type hints tend to make the function</span><span id="dx1-178044"/><span class="kobospan" id="kobo.574.1"> definition so long it has to be spread across five physical lines of code. </span><span class="kobospan" id="kobo.574.2">The presence of so many optional values is difficult to summarize!</span></p>
<p class="normal1"><span class="kobospan" id="kobo.575.1">We can use the resulting function like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.576.1">&gt;&gt;&gt; rtd(distance=31.2, rate=6) 
 
{’distance’: 31.2, ’rate’: 6, ’time’: 5.2}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.577.1">This shows us that going 31.2 nautical miles at a rate of 6 knots will take 5.2 hours.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.578.1">For a nicely formatted output, we might do this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.579.1">&gt;&gt;&gt; result = rtd(distance=31.2, rate=6) 
 
 
 
&gt;&gt;&gt; (’At {rate}kt, it takes ’ 
 
... </span><span class="kobospan" id="kobo.579.2">’{time}hrs to cover {distance}nm’).format_map(result) 
 
’At 6kt, it takes 5.2hrs to cover 31.2nm’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.580.1">To break up the long string, we used our knowledge from the </span><a href="ch006_split_000.xhtml#x1-1170005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.581.1">Designing complex</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.582.1">if...elif chains</span></span></a><span class="kobospan" id="kobo.583.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.584.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.585.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.586.1">2</span></span></a><span class="kobospan" id="kobo.587.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.588.1">To make the warning more visible, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.589.1">warnings</span></span></span></span><span class="kobospan" id="kobo.590.1"> module can be used to set a filter that elevates the warning to an error. </span><span class="kobospan" id="kobo.590.2">Use the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.591.1">warnings.simplefilter(’error’)</span></span></span></span><span class="kobospan" id="kobo.592.1"> to transform warnings into visible exceptions. </span><span id="x1-178054r321"/></p>
</section>
<section data-number="0.6.3.3" id="how-it-works...-23">
<h2 class="likechapterhead" data-number="0.6.3.3"><span><span class="kobospan" id="kobo.593.1">3.3.3 </span></span> <span id="x1-1790003"/><span class="kobospan" id="kobo.594.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.595.1">Because we’ve provided default values for all of the parameters, we can provide argument values for any two of the three parameters, and the function can then solve for the third parameter. </span><span class="kobospan" id="kobo.595.2">This saves us from having to write three separate functions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.596.1">Returning a dictionary as the final result isn’t essential to this. </span><span class="kobospan" id="kobo.596.2">It’s a handy way to show inputs and outputs. </span><span class="kobospan" id="kobo.596.3">It allows the function</span><span id="dx1-179001"/><span class="kobospan" id="kobo.597.1"> to return a uniform result, no matter which parameter values were provided. </span><span id="x1-179002r328"/></p>
</section>
<section data-number="0.6.3.4" id="theres-more...-17">
<h2 class="likechapterhead" data-number="0.6.3.4"><span><span class="kobospan" id="kobo.598.1">3.3.4 </span></span> <span id="x1-1800004"/><span class="kobospan" id="kobo.599.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.600.1">We have an alternative formulation for this, one that involves more flexibility. </span><span class="kobospan" id="kobo.600.2">Python functions have an </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.601.1">all other keywords </span></span><span class="kobospan" id="kobo.602.1">parameter, prefixed with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.603.1">**</span></span></span></span><span class="kobospan" id="kobo.604.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.605.1">We can leverage the flexible </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.606.1">keywords</span></span></span></span><span class="kobospan" id="kobo.607.1"> parameter and insist that all arguments be provided as keywords:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.608.1">def rtd2(**keywords: float) -&gt; dict[str, float | None]: 
 
 
 
    rate = keywords.get(’rate’) 
 
    time = keywords.get(’time’) 
 
    distance = keywords.get(’distance’) 
 
 
 
    # etc.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.609.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.610.1">keywords</span></span></span></span><span class="kobospan" id="kobo.611.1"> type hint</span><span id="dx1-180009"/><span class="kobospan" id="kobo.612.1"> states that all of the values for these parameters will be </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.613.1">float</span></span></span></span><span class="kobospan" id="kobo.614.1"> objects. </span><span class="kobospan" id="kobo.614.2">In some rare case, not all of the keyword parameters are the same type; in this case, some redesign may be helpful to make the types clearer.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.615.1">This version uses the dictionary </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.616.1">get()</span></span></span></span><span class="kobospan" id="kobo.617.1"> method to find a given key in the dictionary. </span><span class="kobospan" id="kobo.617.2">If the key is not present, a default value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.618.1">None</span></span></span></span><span class="kobospan" id="kobo.619.1"> is provided.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.620.1">The dictionary’s </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.621.1">get()</span></span></span></span><span class="kobospan" id="kobo.622.1"> method permits a second parameter, the default, which can be provided instead of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.623.1">None</span></span></span></span><span class="kobospan" id="kobo.624.1"> if the key is not present.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.625.1">This kind of open-ended design has the potential advantage of being much more flexible. </span><span class="kobospan" id="kobo.625.2">One potential disadvantage is that the actual parameter names are hard to discern, since they’re not part of the function definition, but instead part of the function’s body. </span><span class="kobospan" id="kobo.625.3">We can follow the </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.626.1">Writing better docstrings with RST</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.627.1">markup</span></span></a><span class="kobospan" id="kobo.628.1"> recipe and provide a good docstring. </span><span class="kobospan" id="kobo.628.2">It seems much better, though, to provide the parameter names explicitly as part of the Python code rather than implicitly through documentation.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.629.1">This has another, and more profound, disadvantage. </span><span class="kobospan" id="kobo.629.2">The problem is revealed in the following bad example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.630.1">&gt;&gt;&gt; rtd2(distnace=31.2, rate=6) 
 
{’distance’: None, ’rate’: 6, ’time’: None}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.631.1">This isn’t the behavior we want. </span><span class="kobospan" id="kobo.631.2">The misspelling of ”distance” is not reported as a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.632.1">TypeError</span></span></span></span><span class="kobospan" id="kobo.633.1"> exception. </span><span class="kobospan" id="kobo.633.2">The misspelled parameter name is not reported anywhere. </span><span class="kobospan" id="kobo.633.3">To uncover these errors, we’d need to add some programming to pop items from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.634.1">keywords</span></span></span></span><span class="kobospan" id="kobo.635.1"> dictionary and report errors on names that remain after the expected names were removed:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.636.1">def rtd3(**keywords: float) -&gt; dict[str, float | None]: 
 
 
 
    rate = keywords.pop("rate", None) 
 
    time = keywords.pop("time", None) 
 
    distance = keywords.pop("distance", None) 
 
    if keywords: 
 
        raise TypeError( 
 
           f"Invalid keyword parameter: {’’.join(keywords.keys())}")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.637.1">This design will spot spelling errors. </span><span class="kobospan" id="kobo.637.2">The extra processing suggests explicit parameter names might be better than the flexibility</span><span id="dx1-180022"/><span class="kobospan" id="kobo.638.1"> of an unbounded collection of names. </span><span id="x1-180023r329"/></p>
</section>
<section data-number="0.6.3.5" id="see-also-23">
<h2 class="likechapterhead" data-number="0.6.3.5"><span><span class="kobospan" id="kobo.639.1">3.3.5 </span></span> <span id="x1-1810005"/><span class="kobospan" id="kobo.640.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.641.1">We look at the documentation of functions in the </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.642.1">Writing better</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.643.1">docstrings with RST markup</span></span></a><span class="kobospan" id="kobo.644.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.645.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.646.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.647.1">2</span></span></a><span class="kobospan" id="kobo.648.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-181001r318"/></p>
</section>
</section>
<section data-number="0.6.4" id="forcing-keyword-only-arguments-with-the-separator">
<h1 class="unnumbered" data-number="0.6.4"><span><span class="kobospan" id="kobo.649.1">3.4 </span></span> <span id="x1-1820004"/><span class="kobospan" id="kobo.650.1">Forcing keyword-only arguments with the * separator</span></h1>
<p class="normal"><span class="kobospan" id="kobo.651.1">There are some situations</span><span id="dx1-182001"/><span class="kobospan" id="kobo.652.1"> where we have a large number</span><span id="dx1-182002"/><span class="kobospan" id="kobo.653.1"> of positional parameters for a function. </span><span class="kobospan" id="kobo.653.2">Pragmatically, a function with more than about three parameters can be confusing. </span><span class="kobospan" id="kobo.653.3">A great deal of conventional mathematics seems to focus on one- and two-parameter functions. </span><span class="kobospan" id="kobo.653.4">There don’t seem to be too many common mathematical operators that involve three or more operands.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.654.1">When it gets difficult to remember the required order for the parameters, this suggests there are too many parameters. </span><span id="x1-182003r333"/></p>
<section data-number="0.6.4.1" id="getting-ready-24">
<h2 class="likechapterhead" data-number="0.6.4.1"><span><span class="kobospan" id="kobo.655.1">3.4.1 </span></span> <span id="x1-1830001"/><span class="kobospan" id="kobo.656.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.657.1">We’ll look at a function to prepare a wind-chill table and write the data to a CSV format output file. </span><span class="kobospan" id="kobo.657.2">We need to provide a range of temperatures, a range of wind speeds, and information on the file we’d like to create. </span><span class="kobospan" id="kobo.657.3">This is a lot of parameters.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.658.1">One formula for the apparent temperature, the wind chill, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.659.1">T</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.660.1">wc</span></span></sub><span class="kobospan" id="kobo.661.1">, is this:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.662.1"><img alt="Twc(Ta,V ) = 13.2 + 0.6215Ta − 11.37V 0.16 + 0.3965TaV 0.16 " class="calibre9" src="../media/file17.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.663.1">The wind chill temperature, </span><span class="kobospan" id="kobo.664.1"><img alt="Twc " class="math" src="../media/file18.png"/></span><span class="kobospan" id="kobo.665.1">, is based on the air temperature, </span><span class="kobospan" id="kobo.666.1"><img alt="Ta " class="math" src="../media/file19.png"/></span><span class="kobospan" id="kobo.667.1">, in degrees C, and the wind speed, </span><span class="kobospan" id="kobo.668.1"><img alt="V " class="math" src="../media/file20.png"/></span><span class="kobospan" id="kobo.669.1">, in KPH.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.670.1">For Americans, this requires some conversions:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.671.1">Convert the temperature, </span><span class="kobospan" id="kobo.672.1"><img alt="Ta " class="math" src="../media/file21.png"/></span><span class="kobospan" id="kobo.673.1">, from Farenheit, </span><span class="kobospan" id="kobo.674.1"><img alt="∘F " class="math" src="../media/file22.png"/></span><span class="kobospan" id="kobo.675.1">, into Celsius, </span><span class="kobospan" id="kobo.676.1"><img alt="∘C " class="math" src="../media/file23.png"/></span><span class="kobospan" id="kobo.677.1">: </span><span class="kobospan" id="kobo.678.1"><img alt="T = 5(F−-32)- a 9 " class="math" src="../media/file24.png"/></span><span class="kobospan" id="kobo.679.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.680.1">Convert windspeed, </span><span class="kobospan" id="kobo.681.1"><img alt="V " class="math" src="../media/file25.png"/></span><span class="kobospan" id="kobo.682.1">, from MPH, </span><span class="kobospan" id="kobo.683.1"><img alt="Vmph " class="math" src="../media/file26.png"/></span><span class="kobospan" id="kobo.684.1">, into KPH: </span><span class="kobospan" id="kobo.685.1"><img alt="V = 1.609344Vmph " class="math" src="../media/file27.png"/></span><span class="kobospan" id="kobo.686.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.687.1">The result, </span><span class="kobospan" id="kobo.688.1"><img alt="Twc " class="math" src="../media/file28.png"/></span><span class="kobospan" id="kobo.689.1">, needs to be converted from </span><span class="kobospan" id="kobo.690.1"><img alt="∘C " class="math" src="../media/file29.png"/></span><span class="kobospan" id="kobo.691.1"> back to </span><span class="kobospan" id="kobo.692.1"><img alt="∘F " class="math" src="../media/file30.png"/></span><span class="kobospan" id="kobo.693.1">: </span><span class="kobospan" id="kobo.694.1"><img alt=" 9Twc- F = 32+ 5 " class="math" src="../media/file31.png"/></span><span class="kobospan" id="kobo.695.1">.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.696.1">We won’t fold these American conversions into the solution. </span><span class="kobospan" id="kobo.696.2">We’ll leave this as an exercise for you.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.697.1">The function</span><span id="dx1-183001"/><span class="kobospan" id="kobo.698.1"> to compute</span><span id="dx1-183002"/><span class="kobospan" id="kobo.699.1"> the wind-chill temperature, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.700.1">T_wc()</span></span></span></span><span class="kobospan" id="kobo.701.1"> looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.702.1">def T_wc(T: float, V: float) -&gt; float: 
 
    return 13.12 + 0.6215*T - 11.37*V**0.16 + 0.3965*T*V**0.16</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.703.1">This function has an unusual name, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.704.1">T_wc()</span></span></span></span><span class="kobospan" id="kobo.705.1">. </span><span class="kobospan" id="kobo.705.2">We’ve matched the formal definition of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.706.1">T</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.707.1">wc</span></span></sub><span class="kobospan" id="kobo.708.1">, rather than enforcing the PEP-8 rule of beginning function names with a lowercase letter. </span><span class="kobospan" id="kobo.708.2">In this case, it seems better to stick with names used in the literature, rather than imposing a name based on language conventions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.709.1">One approach to creating a wind-chill table is to create something like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.710.1">import csv 
 
from typing import TextIO 
 
 
 
def wind_chill( 
 
    start_T: int, stop_T: int, step_T: int, 
 
    start_V: int, stop_V: int, step_V: int, 
 
    target: TextIO 
 
) -&gt; None: 
 
    """Wind Chill Table.""" 
 
    writer= csv.writer(target) 
 
    heading = [’’]+[str(t) for t in range(start_T, stop_T, step_T)] 
 
    writer.writerow(heading) 
 
    for V in range(start_V, stop_V, step_V): 
 
        row = [float(V)] + [ 
 
            T_wc(T, V) 
 
            for T in range(start_T, stop_T, step_T) 
 
        ] 
 
        writer.writerow(row)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.711.1">Before we get to the design problem, let’s look at the essential processing. </span><span class="kobospan" id="kobo.711.2">We expect the function using this will have opened an output file using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.712.1">with</span></span></span></span><span class="kobospan" id="kobo.713.1"> context. </span><span class="kobospan" id="kobo.713.2">This follows the </span><a href="ch006_split_001.xhtml#x1-15200011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.714.1">Managing a context using the with statement</span></span></a><span class="kobospan" id="kobo.715.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.716.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.717.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.718.1">2</span></span></a><span class="kobospan" id="kobo.719.1">. </span><span class="kobospan" id="kobo.719.2">Within this context, we’ve created a write for the CSV output file. </span><span class="kobospan" id="kobo.719.3">We look at this in more depth in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.720.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.721.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.722.1">11</span></span></a><span class="kobospan" id="kobo.723.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.724.1">The value for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.725.1">heading</span></span></span></span><span class="kobospan" id="kobo.726.1"> variable includes a list literal and a comprehension that builds a list. </span><span class="kobospan" id="kobo.726.2">We look at lists in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.727.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.728.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.729.1">4</span></span></a><span class="kobospan" id="kobo.730.1">. </span><span class="kobospan" id="kobo.730.2">We look at comprehensions and generator expressions in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.731.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.732.1"> </span></span><a href="ch013_split_000.xhtml#x1-5020009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.733.1">9</span></span></a><span class="kobospan" id="kobo.734.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.735.1">Similarly, each row of the table is built by an expression that combines a single float value with a list comprehension. </span><span class="kobospan" id="kobo.735.2">The list consists of values computed by the wind-chill function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.736.1">T_wc()</span></span></span></span><span class="kobospan" id="kobo.737.1">. </span><span class="kobospan" id="kobo.737.2">We provide the wind velocity, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.738.1">V</span></span></span></span><span class="kobospan" id="kobo.739.1">, based on the row in the table. </span><span class="kobospan" id="kobo.739.2">We also provide a temperature, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.740.1">T</span></span></span></span><span class="kobospan" id="kobo.741.1">, based on the column in the table.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.742.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.743.1">wind_chill()</span></span></span></span><span class="kobospan" id="kobo.744.1"> function’s overall definition</span><span id="dx1-183025"/><span class="kobospan" id="kobo.745.1"> presents a problem: the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.746.1">wind_chill()</span></span></span></span><span class="kobospan" id="kobo.747.1"> function has seven distinct positional</span><span id="dx1-183026"/><span class="kobospan" id="kobo.748.1"> parameters. </span><span class="kobospan" id="kobo.748.2">When we try to use this function, we wind up with code like the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.749.1">&gt;&gt;&gt; from pathlib import Path 
 
&gt;&gt;&gt; p = Path(’data/wc1.csv’) 
 
&gt;&gt;&gt; with p.open(’w’,newline=’’) as target: 
 
... </span><span class="kobospan" id="kobo.749.2">    wind_chill(0, -45, -5, 0, 20, 2, target)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.750.1">What are all those numbers? </span><span class="kobospan" id="kobo.750.2">Is there something we can do to help explain the purposes behind all those numbers? </span><span id="x1-183032r335"/></p>
</section>
<section data-number="0.6.4.2" id="how-to-do-it...-24">
<h2 class="likechapterhead" data-number="0.6.4.2"><span><span class="kobospan" id="kobo.751.1">3.4.2 </span></span> <span id="x1-1840002"/><span class="kobospan" id="kobo.752.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.753.1">When we have a large number</span><span id="dx1-184001"/><span class="kobospan" id="kobo.754.1"> of parameters, it helps</span><span id="dx1-184002"/><span class="kobospan" id="kobo.755.1"> to require the use of keyword arguments instead of positional arguments. </span><span class="kobospan" id="kobo.755.2">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.756.1">*</span></span></span></span><span class="kobospan" id="kobo.757.1"> as a separator between two groups of parameters.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.758.1">For our example, the resulting function definition has the following stub definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.759.1">def wind_chill_k( 
 
    *, 
 
    start_T: int, stop_T: int, step_T: int, 
 
    start_V: int, stop_V: int, step_V: int, 
 
    target: Path 
 
) -&gt; None:</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.760.1">Let’s see how it works in practice with different kinds of parameters:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-184011x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.761.1">When we try to use the confusing positional parameters, we’ll see this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.762.1">
&gt;&gt;&gt; wind_chill_k(0, -45, -5, 0, 20, 2, target) 
 
Traceback (most recent call last): 
 
... 
 
TypeError: wind_chill_k() takes 0 positional arguments but 7 were given</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-184018x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.763.1">We must use the function with explicit parameter names, as follows:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.764.1">
&gt;&gt;&gt; p = Path(’data/wc2.csv’) 
 
&gt;&gt;&gt; with p.open(’w’, newline=’’) as output_file: 
 
... </span><span class="kobospan" id="kobo.764.2">    wind_chill_k(start_T=0, stop_T=-45, step_T=-5, 
 
... </span><span class="kobospan" id="kobo.764.3">    start_V=0, stop_V=20, step_V=2, 
 
... </span><span class="kobospan" id="kobo.764.4">    target=output_file)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.765.1">This use of mandatory keyword parameters forces us to write a longer, but clearer, statement each time we use this complicated-seeming function. </span><span id="x1-184025r339"/></p>
</section>
<section data-number="0.6.4.3" id="how-it-works...-24">
<h2 class="likechapterhead" data-number="0.6.4.3"><span><span class="kobospan" id="kobo.766.1">3.4.3 </span></span> <span id="x1-1850003"/><span class="kobospan" id="kobo.767.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.768.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.769.1">*</span></span></span></span><span class="kobospan" id="kobo.770.1"> character, when used as a parameter definition, separates two collections of parameters:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.771.1">Before </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.772.1">*</span></span></span></span><span class="kobospan" id="kobo.773.1">, we list the argument values that can be </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.774.1">either </span></span><span class="kobospan" id="kobo.775.1">positional or named by keyword. </span><span class="kobospan" id="kobo.775.2">In this example, we don’t have any of these parameters.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.776.1">After </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.777.1">*</span></span></span></span><span class="kobospan" id="kobo.778.1">, we list the argument values that must be given with a keyword. </span><span class="kobospan" id="kobo.778.2">For our example, this is all of the parameters.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.779.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.780.1">print()</span></span></span></span><span class="kobospan" id="kobo.781.1"> function exemplifies this. </span><span class="kobospan" id="kobo.781.2">It has three keyword-only parameters for the output file, the field separator</span><span id="dx1-185001"/><span class="kobospan" id="kobo.782.1"> string, and the line</span><span id="dx1-185002"/><span class="kobospan" id="kobo.783.1"> end string. </span><span id="x1-185003r343"/></p>
</section>
<section data-number="0.6.4.4" id="theres-more...-18">
<h2 class="likechapterhead" data-number="0.6.4.4"><span><span class="kobospan" id="kobo.784.1">3.4.4 </span></span> <span id="x1-1860004"/><span class="kobospan" id="kobo.785.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.786.1">We can, of course, combine this technique with default values for the various parameters. </span><span class="kobospan" id="kobo.786.2">We might, for example, make a change to this, thus introducing a single default value:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.787.1">import sys 
 
from typing import TextIO 
 
 
 
def wind_chill_k2( 
 
    *, 
 
    start_T: int, stop_T: int, step_T: int, 
 
    start_V: int, stop_V: int, step_V: int, 
 
    target: TextIO = sys.stdout 
 
) -&gt; None: 
 
    ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.788.1">We can now use this function in two ways:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.789.1">Here’s a way to print the table on the console, using the default target:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.790.1">&gt;&gt;&gt; wind_chill_k2( 
 
... </span><span class="kobospan" id="kobo.790.2">    start_T=0, stop_T=-45, step_T=-5, 
 
... </span><span class="kobospan" id="kobo.790.3">    start_V=0, stop_V=20, step_V=2)</span></code></pre></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.791.1">Here’s a way to write to a file using an explicit target:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.792.1">&gt;&gt;&gt; import pathlib 
 
&gt;&gt;&gt; path = pathlib.Path("data/wc3.csv") 
 
&gt;&gt;&gt; with path.open(’w’, newline=’’) as output_file: 
 
... </span><span class="kobospan" id="kobo.792.2">    wind_chill_k2(target=output_file, 
 
... </span><span class="kobospan" id="kobo.792.3">    start_T=0, stop_T=-45, step_T=-5, 
 
... </span><span class="kobospan" id="kobo.792.4">    start_V=0, stop_V=20, step_V=2)</span></code></pre></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.793.1">We can be more confident in these changes because the parameters must be provided by name. </span><span class="kobospan" id="kobo.793.2">We don’t have to check carefully to be sure about the order of the parameters.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.794.1">As a general pattern, we suggest doing this when there are more than three parameters for a function. </span><span class="kobospan" id="kobo.794.2">It’s easy to remember one or two. </span><span class="kobospan" id="kobo.794.3">Most mathematical operators are unary or binary. </span><span class="kobospan" id="kobo.794.4">While a third parameter may still be easy to remember, the fourth (and subsequent) parameter will become very difficult to recall. </span><span id="x1-186023r344"/></p>
</section>
<section data-number="0.6.4.5" id="see-also-24">
<h2 class="likechapterhead" data-number="0.6.4.5"><span><span class="kobospan" id="kobo.795.1">3.4.5 </span></span> <span id="x1-1870005"/><span class="kobospan" id="kobo.796.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.797.1">See the </span><a href="ch007_split_001.xhtml#x1-1940006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.798.1">Picking an order for parameters based on partial functions</span></span></a><span class="kobospan" id="kobo.799.1"> recipe for another application of this technique.</span></p></li>
</ul>
<p class="normal1"><span id="x1-187001r334"/></p>
</section>
</section>
<section data-number="0.6.5" id="defining-position-only-parameters-with-the-separator">
<h1 class="unnumbered" data-number="0.6.5"><span><span class="kobospan" id="kobo.800.1">3.5 </span></span> <span id="x1-1880005"/><span class="kobospan" id="kobo.801.1">Defining position-only parameters with the / separator</span></h1>
<p class="normal"><span class="kobospan" id="kobo.802.1">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.803.1">/</span></span></span></span><span class="kobospan" id="kobo.804.1"> character in the parameter</span><span id="dx1-188001"/><span class="kobospan" id="kobo.805.1"> list to separate the parameters</span><span id="dx1-188002"/><span class="kobospan" id="kobo.806.1"> into two groups. </span><span class="kobospan" id="kobo.806.2">Before </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.807.1">/</span></span></span></span><span class="kobospan" id="kobo.808.1">, all argument values work positionally. </span><span class="kobospan" id="kobo.808.2">After the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.809.1">/</span></span></span></span><span class="kobospan" id="kobo.810.1"> parameter, argument values may be given positionally, or names may be used.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.811.1">This should be used for functions where the following conditions are all true:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.812.1">A few positional parameters are used (no more than three).</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.813.1">And they are all required.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.814.1">And the order is so obvious that any change might be confusing.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.815.1">This has always been a feature of the standard library. </span><span class="kobospan" id="kobo.815.2">As an example, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.816.1">math.sin()</span></span></span></span><span class="kobospan" id="kobo.817.1"> function can only use positional parameters. </span><span class="kobospan" id="kobo.817.2">The formal definition is as follows:</span></p>
<div class="tipbox" id="tcolobox-8">
<span id="x1-188008x5"/>
<div class="note">
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.818.1">&gt;&gt;&gt; help(math.sin) 
 
Help on built-in function sin in module math: 
 
 
 
sin(x, /) 
 
    Return the sine of x (measured in radians).</span></code></pre>
</div>
</div>
<p class="normal1"><span class="kobospan" id="kobo.819.1">Even though there’s an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.820.1">x</span></span></span></span><span class="kobospan" id="kobo.821.1"> parameter name, we can’t use this name. </span><span class="kobospan" id="kobo.821.2">If we try to, we’ll see the following exception:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.822.1">&gt;&gt;&gt; import math 
 
&gt;&gt;&gt; math.sin(x=0.5) 
 
Traceback (most recent call last): 
 
... 
 
TypeError: math.sin() takes no keyword arguments</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.823.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.824.1">x</span></span></span></span><span class="kobospan" id="kobo.825.1"> parameter can only be provided</span><span id="dx1-188015"/><span class="kobospan" id="kobo.826.1"> positionally. </span><span class="kobospan" id="kobo.826.2">The output</span><span id="dx1-188016"/><span class="kobospan" id="kobo.827.1"> from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.828.1">help()</span></span></span></span><span class="kobospan" id="kobo.829.1"> function provides a suggestion of how the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.830.1">/</span></span></span></span><span class="kobospan" id="kobo.831.1"> separator can be used to make this happen. </span><span id="x1-188017r348"/></p>
<section data-number="0.6.5.1" id="getting-ready-25">
<h2 class="likechapterhead" data-number="0.6.5.1"><span><span class="kobospan" id="kobo.832.1">3.5.1 </span></span> <span id="x1-1890001"/><span class="kobospan" id="kobo.833.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.834.1">Position-only parameters are used by some of the internal built-ins; the design pattern can also be helpful, though, in our functions. </span><span class="kobospan" id="kobo.834.2">To be useful, there must be very few position-only parameters. </span><span class="kobospan" id="kobo.834.3">Since most mathematical operators have one or two operands, this suggests one or two position-only parameters can be useful.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.835.1">We’ll consider two functions for conversion of units from the Fahrenheit system used in the US and the Centigrade system used almost everywhere else in the world:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.836.1">Convert from </span><span class="kobospan" id="kobo.837.1"><img alt="∘ F " class="math" src="../media/file32.png"/></span><span class="kobospan" id="kobo.838.1"> into </span><span class="kobospan" id="kobo.839.1"><img alt="∘ C " class="math" src="../media/file33.png"/></span><span class="kobospan" id="kobo.840.1">: </span><span class="kobospan" id="kobo.841.1"><img alt=" 5(F−32) C = ---9--- " class="math" src="../media/file34.png"/></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.842.1">Convert from </span><span class="kobospan" id="kobo.843.1"><img alt="∘C " class="math" src="../media/file35.png"/></span><span class="kobospan" id="kobo.844.1"> into </span><span class="kobospan" id="kobo.845.1"><img alt="∘F " class="math" src="../media/file36.png"/></span><span class="kobospan" id="kobo.846.1">: </span><span class="kobospan" id="kobo.847.1"><img alt="F = 32 + 9C- 5 " class="math" src="../media/file37.png"/></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.848.1">Each of these functions has a single argument, making it a reasonable example for a position-only parameter. </span><span id="x1-189001r351"/></p>
</section>
<section data-number="0.6.5.2" id="how-to-do-it...-25">
<h2 class="likechapterhead" data-number="0.6.5.2"><span><span class="kobospan" id="kobo.849.1">3.5.2 </span></span> <span id="x1-1900002"/><span class="kobospan" id="kobo.850.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-190002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.851.1">Define the function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.852.1">def F_1(c: float) -&gt; float: 
 
    return 32 + 9 * c / 5</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-190007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.853.1">Add the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.854.1">/</span></span></span></span><span class="kobospan" id="kobo.855.1"> parameter separator after the position-only parameters:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.856.1">def F_2(c: float, /) -&gt; float: 
 
    return 32 + 9 * c / 5</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.857.1">For these examples, we put a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.858.1">_1</span></span></span></span><span class="kobospan" id="kobo.859.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.860.1">_2</span></span></span></span><span class="kobospan" id="kobo.861.1"> suffixes on the function names to make it clear which definition goes with each step of the recipe. </span><span class="kobospan" id="kobo.861.2">These are two versions of the same function, and they should have the same name. </span><span class="kobospan" id="kobo.861.3">They’re separated to show the history of writing the functions; this is not a practical naming convention except when writing a book where some partially complete functions have their own unit tests. </span><span id="x1-190011r352"/></p>
</section>
</section>
</section>


<section data-number="0.6" id="chapter-3-function-definitions">
<section data-number="0.6.5" id="defining-position-only-parameters-with-the-separator">
<section data-number="0.6.5.3" id="how-it-works...-25">
<h2 class="likechapterhead" data-number="0.6.5.3"><span><span class="kobospan" id="kobo.862.1">3.5.3 </span></span> <span id="x1-1910003"/><span class="kobospan" id="kobo.863.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.864.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.865.1">/</span></span></span></span><span class="kobospan" id="kobo.866.1"> separator divides the parameter</span><span id="dx1-191001"/><span class="kobospan" id="kobo.867.1"> names into two</span><span id="dx1-191002"/><span class="kobospan" id="kobo.868.1"> groups. </span><span class="kobospan" id="kobo.868.2">In front of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.869.1">/</span></span></span></span><span class="kobospan" id="kobo.870.1"> are parameters where the argument values must be provided positionally: named argument values cannot be used. </span><span class="kobospan" id="kobo.870.2">After the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.871.1">/</span></span></span></span><span class="kobospan" id="kobo.872.1"> are parameters where names are permitted.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.873.1">Let’s look at a slightly more complex version of our temperature conversions:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.874.1">def C(f: float, /, truncate: bool=False) -&gt; float: 
 
    c = 5 * (f - 32) / 9 
 
    if truncate: 
 
        return round(c, 0) 
 
    return c</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.875.1">This function has a position-only parameter named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.876.1">f</span></span></span></span><span class="kobospan" id="kobo.877.1">. </span><span class="kobospan" id="kobo.877.2">It also has the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.878.1">truncate</span></span></span></span><span class="kobospan" id="kobo.879.1"> parameter, which can be provided by name. </span><span class="kobospan" id="kobo.879.2">This leads to three separate ways to use this function, as shown in the following examples:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.880.1">&gt;&gt;&gt; C(72) 
 
22.22222222222222 
 
 
 
&gt;&gt;&gt; C(72, truncate=True) 
 
22.0 
 
 
 
&gt;&gt;&gt; C(72, True) 
 
22.0</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.881.1">The first example shows the position-only parameter and the output without any rounding. </span><span class="kobospan" id="kobo.881.2">This is an awkwardly complex-looking value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.882.1">The second example uses the named parameter style to set the non-positional parameter, truncate, to True. </span><span class="kobospan" id="kobo.882.2">The third example</span><span id="dx1-191018"/><span class="kobospan" id="kobo.883.1"> provides both argument</span><span id="dx1-191019"/><span class="kobospan" id="kobo.884.1"> values positionally. </span><span id="x1-191020r355"/></p>
</section>
<section data-number="0.6.5.4" id="theres-more...-19">
<h2 class="likechapterhead" data-number="0.6.5.4"><span><span class="kobospan" id="kobo.885.1">3.5.4 </span></span> <span id="x1-1920004"/><span class="kobospan" id="kobo.886.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.887.1">This can be combined with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.888.1">*</span></span></span></span><span class="kobospan" id="kobo.889.1"> separator to create very sophisticated function signatures. </span><span class="kobospan" id="kobo.889.2">The parameters can be decomposed into three groups:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.890.1">Parameters before the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.891.1">/</span></span></span></span><span class="kobospan" id="kobo.892.1"> separator must be given by position. </span><span class="kobospan" id="kobo.892.2">These must be first.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.893.1">Parameters after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.894.1">/</span></span></span></span><span class="kobospan" id="kobo.895.1"> separator can be given by position or name.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.896.1">Parameters after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.897.1">*</span></span></span></span><span class="kobospan" id="kobo.898.1"> separator must be given by name only. </span><span class="kobospan" id="kobo.898.2">These names are provided last, since they can never be matched by position.</span></p></li>
</ul>
<p class="normal1"><span id="x1-192001r358"/></p>
</section>
<section data-number="0.6.5.5" id="see-also-25">
<h2 class="likechapterhead" data-number="0.6.5.5"><span><span class="kobospan" id="kobo.899.1">3.5.5 </span></span> <span id="x1-1930005"/><span class="kobospan" id="kobo.900.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.901.1">See the </span><a href="ch007_split_000.xhtml#x1-1820004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.902.1">Forcing keyword-only arguments with the * separator</span></span></a><span class="kobospan" id="kobo.903.1"> recipe for details on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.904.1">*</span></span></span></span><span class="kobospan" id="kobo.905.1"> separator.</span></p></li>
</ul>
<p class="normal1"><span id="x1-193001r349"/></p>
</section>
</section>
<section data-number="0.6.6" id="picking-an-order-for-parameters-based-on-partial-functions">
<h1 class="unnumbered" data-number="0.6.6"><span><span class="kobospan" id="kobo.906.1">3.6 </span></span> <span id="x1-1940006"/><span class="kobospan" id="kobo.907.1">Picking an order for parameters based on partial functions</span></h1>
<p class="normal"><span class="kobospan" id="kobo.908.1">The term </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.909.1">partial function </span></span><span class="kobospan" id="kobo.910.1">is widely used to describe</span><span id="dx1-194001"/><span class="kobospan" id="kobo.911.1"> the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.912.1">partial application </span></span><span class="kobospan" id="kobo.913.1">of a function. </span><span class="kobospan" id="kobo.913.2">Some of the argument values are fixed, while others vary. </span><span class="kobospan" id="kobo.913.3">We might have a function, </span><span class="kobospan" id="kobo.914.1"><img alt="f (a,b,c) " class="math" src="../media/file38.png"/></span><span class="kobospan" id="kobo.915.1">, where there are fixed values for </span><span class="kobospan" id="kobo.916.1"><img alt="a " class="math" src="../media/file39.png"/></span><span class="kobospan" id="kobo.917.1"> and </span><span class="kobospan" id="kobo.918.1"><img alt="b " class="math" src="../media/file40.png"/></span><span class="kobospan" id="kobo.919.1">. </span><span class="kobospan" id="kobo.919.2">With fixed values, we have a new version of the function, </span><span class="kobospan" id="kobo.920.1"><img alt="fp(c) " class="math" src="../media/file41.png"/></span><span class="kobospan" id="kobo.921.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.922.1">When we look at complex functions, we’ll sometimes see a pattern in the ways we use the function. </span><span class="kobospan" id="kobo.922.2">We might, for example, evaluate a function many times with some argument values that are fixed by context, and other argument values that are changing with the details of the processing. </span><span class="kobospan" id="kobo.922.3">Having some fixed argument values suggests a partial function.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.923.1">Creating a partial function can simplify our programming by avoiding code to repeat the argument values that are fixed by a specific context. </span><span id="x1-194002r359"/></p>
<section data-number="0.6.6.1" id="getting-ready-26">
<h2 class="likechapterhead" data-number="0.6.6.1"><span><span class="kobospan" id="kobo.924.1">3.6.1 </span></span> <span id="x1-1950001"/><span class="kobospan" id="kobo.925.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.926.1">We’ll look at a version of the haversine formula. </span><span class="kobospan" id="kobo.926.2">This computes distances between two points, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.927.1">p</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.928.1">1</span></span></sub><span class="kobospan" id="kobo.929.1"> = (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.930.1">lon</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.931.1">1</span></span></sub><span class="cmti-10x-x"><span class="kobospan" id="kobo.932.1">,lat</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.933.1">1</span></span></sub><span class="kobospan" id="kobo.934.1">) and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.935.1">p</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.936.1">2</span></span></sub><span class="kobospan" id="kobo.937.1"> = (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.938.1">lon</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.939.1">2</span></span></sub><span class="cmti-10x-x"><span class="kobospan" id="kobo.940.1">,lat</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.941.1">2</span></span></sub><span class="kobospan" id="kobo.942.1">), on the surface of the Earth:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.943.1"><img alt=" ∘ ------------------------------------------------- a = sin2(lat2 −-lat1)+ cos(lat1)cos(lat2) sin2(lat2 −-lat1) 2 2 " class="calibre9" src="../media/file42.png"/></span>
</div>
<div class="math-display1">
<span class="kobospan" id="kobo.944.1"><img alt="c = 2arcsin a " class="calibre9" src="../media/file43.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.945.1">The essential calculation yields the central angle, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.946.1">c</span></span><span class="kobospan" id="kobo.947.1">, between two points. </span><span class="kobospan" id="kobo.947.2">The angle is measured in radians. </span><span class="kobospan" id="kobo.947.3">We must convert this angle into distance by multiplying by the Earth’s mean radius in some given units. </span><span class="kobospan" id="kobo.947.4">If we multiply the angle </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.948.1">c </span></span><span class="kobospan" id="kobo.949.1">by a radius of 3,959 miles, we’ll convert the angle into miles.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.950.1">Here’s an implementation of this function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.951.1">from math import radians, sin, cos, sqrt, asin 
 
 
 
MI = 3959 
 
NM = 3440 
 
KM = 6372 
 
 
 
def haversine( 
 
    lat_1: float, lon_1: float, 
 
    lat_2: float, lon_2: float, R: float 
 
) -&gt; float: 
 
    """Distance between points. 
 
    R is Earth’s radius. 
 
    R=MI computes in miles. </span><span class="kobospan" id="kobo.951.2">Default is nautical miles. 
 
 
 
    &gt;&gt;&gt; round(haversine(36.12, -86.67, 33.94, -118.40, R=6372.8), 5) 
 
    2887.25995 
 
    """ 
 
 
 
    _lat = radians(lat_2) - radians(lat_1) 
 
    _lon = radians(lon_2) - radians(lon_1) 
 
    lat_1 = radians(lat_1) 
 
    lat_2 = radians(lat_2) 
 
    a = sqrt( 
 
        sin(_lat / 2) ** 2 + 
 
        cos(lat_1) * cos(lat_2) * sin(_lon / 2) ** 2 
 
    ) 
 
    return R * 2 * asin(a)
                                                                     

                                                                     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.952.1">The doctest example uses an Earth radius with an extra decimal point that’s not used elsewhere. </span><span class="kobospan" id="kobo.952.2">This example’s output will match other examples found online.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.953.1">The problem we often have is the value for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.954.1">R</span></span></span></span><span class="kobospan" id="kobo.955.1"> rarely changes for a specific context. </span><span class="kobospan" id="kobo.955.2">One context may use kilometers throughout the application, while another uses nautical miles. </span><span class="kobospan" id="kobo.955.3">We’d like to impose</span><span id="dx1-195031"/><span class="kobospan" id="kobo.956.1"> a context-specific default value like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.957.1">R</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.958.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.959.1"> NM</span></span></span></span><span class="kobospan" id="kobo.960.1"> to get nautical miles in a given context without having to edit the module.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.961.1">We’ll look at several common approaches to providing a consistent value for an argument. </span><span id="x1-195032r361"/></p>
</section>
<section data-number="0.6.6.2" id="how-to-do-it...-26">
<h2 class="likechapterhead" data-number="0.6.6.2"><span><span class="kobospan" id="kobo.962.1">3.6.2 </span></span> <span id="x1-1960002"/><span class="kobospan" id="kobo.963.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.964.1">In some cases, an overall context will establish a single value for a parameter. </span><span class="kobospan" id="kobo.964.2">The value will rarely change. </span><span class="kobospan" id="kobo.964.3">The following are three common approaches to providing a consistent value for an argument:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.965.1">Wrap the function in a new function that provides the default value.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.966.1">Create a partial function with the default value. </span><span class="kobospan" id="kobo.966.2">This has two further refinements:</span></p>
<ul class="calibre25">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.967.1">We can provide defaults as a keyword parameters.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.968.1">We can provide defaults as positional</span><span id="dx1-196001"/><span class="kobospan" id="kobo.969.1"> parameters.</span></p></li>
</ul></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.970.1">We’ll look at each of these in separate variations in this recipe.</span></p>
<section data-number="0.6.6.2.1" id="wrapping-a-function">
<h3 class="likesubsubsectionhead" data-number="0.6.6.2.1"><span id="x1-1970002"/><span class="kobospan" id="kobo.971.1">Wrapping a function</span></h3>
<p class="normal"><span class="kobospan" id="kobo.972.1">Here’s how we can revise</span><span id="dx1-197001"/><span class="kobospan" id="kobo.973.1"> the function, slightly, and create a wrapper:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-197003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.974.1">Make some parameters positional and some parameters keywords. </span><span class="kobospan" id="kobo.974.2">We want the contextual features – the ones that rarely change – to be keywords. </span><span class="kobospan" id="kobo.974.3">The parameters that change more frequently should be left as positional:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.975.1">def haversine_k( 
 
    lat_1: float, lon_1: float, 
 
    lat_2: float, lon_2: float, *, R: float 
 
) -&gt; float: 
 
    ... </span><span class="kobospan" id="kobo.975.2"># etc.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.976.1">We can follow the </span><a href="ch007_split_000.xhtml#x1-1820004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.977.1">Forcing keyword-only arguments with the * separator</span></span></a><span class="kobospan" id="kobo.978.1"> recipe.</span></p>
</div></li>
<li class="calibre7"><div id="x1-197011x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.979.1">We can then write a wrapper function that will apply all of the positional arguments, unmodified. </span><span class="kobospan" id="kobo.979.2">It will supply the additional keyword argument as part of the long-running context:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.980.1">def nm_haversine_1(*args): 
 
    return haversine_k(*args, R=NM)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.981.1">We have the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.982.1">*args</span></span></span></span><span class="kobospan" id="kobo.983.1"> construct in the function declaration to accept all positional argument values in a single tuple, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.984.1">args</span></span></span></span><span class="kobospan" id="kobo.985.1">. </span><span class="kobospan" id="kobo.985.2">We use a similar-looking </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.986.1">*args</span></span></span></span><span class="kobospan" id="kobo.987.1"> when evaluating the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.988.1">haversine()</span></span></span></span><span class="kobospan" id="kobo.989.1"> function to expand the tuple into all of the positional argument values to this function.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.990.1">In this case, all the types are </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.991.1">float</span></span></span></span><span class="kobospan" id="kobo.992.1">. </span><span class="kobospan" id="kobo.992.2">We can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.993.1">*args:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.994.1"> float</span></span></span></span><span class="kobospan" id="kobo.995.1"> to provide a suitable hint. </span><span class="kobospan" id="kobo.995.2">This doesn’t always work out, and this style of handling arguments – while simple-looking – can hide problems.</span></p>
</section>
<section data-number="0.6.6.2.2" id="creating-a-partial-function-with-keyword-parameters">
<h3 class="likesubsubsectionhead" data-number="0.6.6.2.2"><span id="x1-1980002"/><span class="kobospan" id="kobo.996.1">Creating a partial function with keyword parameters</span></h3>
<p class="normal"><span class="kobospan" id="kobo.997.1">One approach to defining functions</span><span id="dx1-198001"/><span class="kobospan" id="kobo.998.1"> that work well as partial function</span><span id="dx1-198002"/><span class="kobospan" id="kobo.999.1"> is to use keyword parameters:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-198004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1000.1">We can follow the </span><a href="ch007_split_000.xhtml#x1-1820004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1001.1">Forcing keyword-only arguments with the * separator</span></span></a><span class="kobospan" id="kobo.1002.1"> recipe to do this. </span><span class="kobospan" id="kobo.1002.2">We might change the basic haversine function so that it looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1003.1">def haversine_k( 
 
    lat_1: float, lon_1: float, 
 
    lat_2: float, lon_2: float, *, R: float 
 
) -&gt; float: 
 
    ... </span><span class="kobospan" id="kobo.1003.2"># etc.</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-198012x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1004.1">Create a partial function using the keyword parameter:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1005.1">from functools import partial 
 
nm_haversine_3 = partial(haversine, R=NM)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1006.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1007.1">partial()</span></span></span></span><span class="kobospan" id="kobo.1008.1"> function builds a new function from an existing function and a concrete set of argument values. </span><span class="kobospan" id="kobo.1008.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1009.1">nm_haversine_3()</span></span></span></span><span class="kobospan" id="kobo.1010.1"> function has a specific value for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1011.1">R</span></span></span></span><span class="kobospan" id="kobo.1012.1"> provided when the partial was built.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1013.1">We can use this like we’d use any other function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1014.1">&gt;&gt;&gt; round(nm_haversine_3(36.12, -86.67, 33.94, -118.40), 2) 
 
1558.53</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1015.1">We get an answer in nautical miles, allowing us to do boating-related calculations. </span><span class="kobospan" id="kobo.1015.2">Having a fixed value for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1016.1">R=NM</span></span></span></span><span class="kobospan" id="kobo.1017.1"> leaves the code slightly simpler-looking, and much more trust-worthy. </span><span class="kobospan" id="kobo.1017.2">The possibility of one computation having an incorrect value for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1018.1">R</span></span></span></span><span class="kobospan" id="kobo.1019.1"> is eliminated.</span></p>
</section>
<section data-number="0.6.6.2.3" id="creating-a-partial-function-with-positional-parameters">
<h3 class="likesubsubsectionhead" data-number="0.6.6.2.3"><span id="x1-1990002"/><span class="kobospan" id="kobo.1020.1">Creating a partial function with positional parameters</span></h3>
<p class="normal"><span class="kobospan" id="kobo.1021.1">If we try to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1022.1">partial()</span></span></span></span><span class="kobospan" id="kobo.1023.1"> with positional</span><span id="dx1-199001"/><span class="kobospan" id="kobo.1024.1"> arguments, we’re constrained to providing the leftmost parameter values in the partial definition. </span><span class="kobospan" id="kobo.1024.2">This leads us to think of the first few arguments to a function as candidates for being hidden by a partial function or a wrapper:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-199003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1025.1">We need to change the basic haversine function to put the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1026.1">R</span></span></span></span><span class="kobospan" id="kobo.1027.1"> parameter first. </span><span class="kobospan" id="kobo.1027.2">This makes it slightly easier to define a partial function. </span><span class="kobospan" id="kobo.1027.3">Here’s the changed definition:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1028.1">def p_haversine( 
 
    R: float, 
 
    lat_1: float, lon_1: float, lat_2: float, lon_2: float 
 
) -&gt; float: 
 
    # etc.</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-199011x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1029.1">Create a partial function using the positional parameter:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1030.1">from functools import partial 
 
nm_haversine_4 = partial(p_haversine, NM)                                                                

                                                                     
     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1031.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1032.1">partial()</span></span></span></span><span class="kobospan" id="kobo.1033.1"> function builds a new function from an existing function and a concrete set of argument values. </span><span class="kobospan" id="kobo.1033.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1034.1">nm_haversine_4()</span></span></span></span><span class="kobospan" id="kobo.1035.1"> function has a specific value for the first parameter, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1036.1">R</span></span></span></span><span class="kobospan" id="kobo.1037.1">, that’s provided when the partial was built.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1038.1">We can use this like we’d use any other function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1039.1">&gt;&gt;&gt; round(nm_haversine_4(36.12, -86.67, 33.94, -118.40), 2) 
 
1558.53</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1040.1">We get an answer in nautical miles, allowing us to do boating-related calculations easily, The code can use a version</span><span id="dx1-199018"/><span class="kobospan" id="kobo.1041.1"> of the the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1042.1">haversine()</span></span></span></span><span class="kobospan" id="kobo.1043.1"> function without the annoying detail of repeating the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1044.1">R=NM</span></span></span></span><span class="kobospan" id="kobo.1045.1"> argument value. </span><span id="x1-199019r363"/></p>
</section>
</section>
<section data-number="0.6.6.3" id="how-it-works...-26">
<h2 class="likechapterhead" data-number="0.6.6.3"><span><span class="kobospan" id="kobo.1046.1">3.6.3 </span></span> <span id="x1-2000003"/><span class="kobospan" id="kobo.1047.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1048.1">A partial function is, essentially, identical to a wrapper function. </span><span class="kobospan" id="kobo.1048.2">We can build partials freely in the middle of other, more complex, pieces of a program. </span><span class="kobospan" id="kobo.1048.3">Note that creating partial functions leads to a few additional considerations when looking at the order for positional parameters:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1049.1">If we try to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1050.1">*args</span></span></span></span><span class="kobospan" id="kobo.1051.1"> in the wrapper, these must be defined last. </span><span class="kobospan" id="kobo.1051.2">All of these parameters become anonymous. </span><span class="kobospan" id="kobo.1051.3">This anonymity means tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1052.1">mypy </span></span><span class="kobospan" id="kobo.1053.1">may have problems confirming the parameters are being used correctly. </span><span class="kobospan" id="kobo.1053.2">The documentation will not show the necessary details, either.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1054.1">The leftmost positional parameters are easiest to provide a value for when creating a partial function.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1055.1">Any keyword-only parameters, defined after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1056.1">*</span></span></span></span><span class="kobospan" id="kobo.1057.1"> separator, are also a good choice to provide as part of a partial definition.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1058.1">These considerations can lead us to look at the leftmost argument as being a kind of context: these parameters are expected to change rarely and can be provided more easily by partial function definitions. </span><span id="x1-200001r375"/></p>
</section>
<section data-number="0.6.6.4" id="theres-more...-20">
<h2 class="likechapterhead" data-number="0.6.6.4"><span><span class="kobospan" id="kobo.1059.1">3.6.4 </span></span> <span id="x1-2010004"/><span class="kobospan" id="kobo.1060.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1061.1">There’s yet another way to wrap a function – we can also build</span><span id="dx1-201001"/><span class="kobospan" id="kobo.1062.1"> a lambda object. </span><span class="kobospan" id="kobo.1062.2">The following example will also work:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1063.1">nm_haversine_L = lambda *args: haversine_k(*args, R=NM)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1064.1">This relies on the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1065.1">haversine_k()</span></span></span></span><span class="kobospan" id="kobo.1066.1"> function definition, where the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1067.1">R</span></span></span></span><span class="kobospan" id="kobo.1068.1"> parameter is marked as keyword-only. </span><span class="kobospan" id="kobo.1068.2">Without this clear separation between positional and keyword argument values, this lambda definition</span><span id="dx1-201004"/><span class="kobospan" id="kobo.1069.1"> will result in a warning from </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1070.1">mypy</span></span><span class="kobospan" id="kobo.1071.1">. </span><span class="kobospan" id="kobo.1071.2">If we use the original </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1072.1">haversine()</span></span></span></span><span class="kobospan" id="kobo.1073.1"> function, the warning tells us that it’s possible for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1074.1">R</span></span></span></span><span class="kobospan" id="kobo.1075.1"> to get multiple values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1076.1">A lambda object is a function that’s been stripped of its name and body. </span><span class="kobospan" id="kobo.1076.2">The function definition is reduced to just two essentials:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1077.1">The parameter list, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1078.1">*args</span></span></span></span><span class="kobospan" id="kobo.1079.1">, in this example.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1080.1">A single expression, which is the result, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1081.1">haversine_k(*args,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1082.1"> R=NM)</span></span></span></span><span class="kobospan" id="kobo.1083.1">. </span><span class="kobospan" id="kobo.1083.2">A lambda cannot have any statements.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1084.1">The lambda approach makes it difficult to create type hints. </span><span class="kobospan" id="kobo.1084.2">This limits its utility. </span><span class="kobospan" id="kobo.1084.3">Further, the </span><a href="https://peps.python.org/pep-0008/" class="url"><span class="kobospan" id="kobo.1085.1">PEP-8</span></a><span class="kobospan" id="kobo.1086.1"> recommendations suggest assigning a lambda to a variable should never be done. </span><span id="x1-201005r376"/></p>
</section>
<section data-number="0.6.6.5" id="see-also-26">
<h2 class="likechapterhead" data-number="0.6.6.5"><span><span class="kobospan" id="kobo.1087.1">3.6.5 </span></span> <span id="x1-2020005"/><span class="kobospan" id="kobo.1088.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1089.1">We’ll also look at extending this design further in the </span><a href="ch007_split_001.xhtml#x1-2150009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1090.1">Writing testable</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1091.1">scripts with the script-library switch</span></span></a><span class="kobospan" id="kobo.1092.1"> recipe.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1093.1">For more functional programming techniques, see </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1094.1">Functional Python</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1095.1">Programming</span></span><span class="kobospan" id="kobo.1096.1">: </span><a class="url" href="https://www.packtpub.com/product/functional-python-programming-3rd-edition-third-edition/9781803232577"><span class="url1"><span class="kobospan" id="kobo.1097.1">https://www.packtpub.com/product/functional-python-programming-3rd-edition-third-edition/9781803232577</span></span></a><span class="kobospan" id="kobo.1098.1">. </span><span class="kobospan" id="kobo.1098.2">This has numerous examples of using lambdas and partial functions.</span></p></li>
</ul>
<p class="normal1"><span id="x1-202001r360"/></p>
</section>
</section>
<section data-number="0.6.7" id="writing-clear-documentation-strings-with-rst-markup">
<h1 class="unnumbered" data-number="0.6.7"><span><span class="kobospan" id="kobo.1099.1">3.7 </span></span> <span id="x1-2030007"/><span class="kobospan" id="kobo.1100.1">Writing clear documentation strings with RST markup</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1101.1">How can we clearly document</span><span id="dx1-203001"/><span class="kobospan" id="kobo.1102.1"> what a function does? </span><span class="kobospan" id="kobo.1102.2">Can we provide</span><span id="dx1-203002"/><span class="kobospan" id="kobo.1103.1"> examples? </span><span class="kobospan" id="kobo.1103.2">Of course we can, and we really should. </span><span class="kobospan" id="kobo.1103.3">In the </span><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1104.1">Including descriptions and</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1105.1">documentation</span></span></a><span class="kobospan" id="kobo.1106.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1107.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1108.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1109.1">2</span></span></a><span class="kobospan" id="kobo.1110.1">, and in the </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1111.1">Writing better docstrings</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1112.1">with RST markup</span></span></a><span class="kobospan" id="kobo.1113.1"> recipe, we looked at some essential documentation techniques. </span><span class="kobospan" id="kobo.1113.2">Those recipes introduced </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1114.1">ReStructuredText </span></span><span class="kobospan" id="kobo.1115.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1116.1">RST</span></span><span class="kobospan" id="kobo.1117.1">) for module docstrings.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1118.1">We’ll extend those techniques to write RST for function docstrings. </span><span class="kobospan" id="kobo.1118.2">When we use a tool such as Sphinx, the docstrings from our function will become elegant-looking documentation that describes what our function does. </span><span id="x1-203003r378"/></p>
<section data-number="0.6.7.1" id="getting-ready-27">
<h2 class="likechapterhead" data-number="0.6.7.1"><span><span class="kobospan" id="kobo.1119.1">3.7.1 </span></span> <span id="x1-2040001"/><span class="kobospan" id="kobo.1120.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1121.1">In the </span><a href="ch007_split_000.xhtml#x1-1820004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1122.1">Forcing keyword-only arguments with the * separator</span></span></a><span class="kobospan" id="kobo.1123.1"> recipe, we looked at a function to compute wind-chill, given the temperature and wind-speed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1124.1">In the recipe, we’ll show several versions of the function with trailing </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1125.1">_0</span></span></span></span><span class="kobospan" id="kobo.1126.1"> in the name. </span><span class="kobospan" id="kobo.1126.2">Pragmatically, this name change is not a good idea. </span><span class="kobospan" id="kobo.1126.3">For the purposes of making the evolution of this function clear in this book, however, it seems helpful to give each new variant a distinct name.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1127.1">We need to annotate this function with some more complete documentation. </span><span id="x1-204001r380"/></p>
</section>
<section data-number="0.6.7.2" id="how-to-do-it...-27">
<h2 class="likechapterhead" data-number="0.6.7.2"><span><span class="kobospan" id="kobo.1128.1">3.7.2 </span></span> <span id="x1-2050002"/><span class="kobospan" id="kobo.1129.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1130.1">We’ll generally write the following things for a function description:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1131.1">Synopsis</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1132.1">Description</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1133.1">Parameters</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1134.1">Returns</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1135.1">Exceptions</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1136.1">Test cases</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1137.1">Anything else that seems meaningful</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1138.1">Here’s how we’ll create documentation</span><span id="dx1-205001"/><span class="kobospan" id="kobo.1139.1"> for a function. </span><span class="kobospan" id="kobo.1139.2">We can apply</span><span id="dx1-205002"/><span class="kobospan" id="kobo.1140.1"> a similar method to a method of a class, or even a module.</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-205004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1141.1">Write the synopsis. </span><span class="kobospan" id="kobo.1141.2">A proper subject isn’t required. </span><span class="kobospan" id="kobo.1141.3">Don’t write </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1142.1">This</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1143.1">function computes...</span></span><span class="kobospan" id="kobo.1144.1">; we can start with </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1145.1">Computes...</span></span><span class="kobospan" id="kobo.1146.1">. </span><span class="kobospan" id="kobo.1146.2">There’s no reason to overstate the context:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1147.1">def T_wc_1(T, V): 
 
    """Computes the wind chill temperature."""</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1148.1">To help clarify the evolution of this function’s docstring in this book, we’ve appended a suffix of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1149.1">_1</span></span></span></span><span class="kobospan" id="kobo.1150.1"> to the name.</span></p>
</div></li>
<li class="calibre7"><div id="x1-205009x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1151.1">Write the description and provide details:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1152.1">def T_wc_2(T, V): 
 
    """Computes the wind chill temperature. 
 
    The wind-chill, :math:‘T_{wc}‘, 
 
    is based on air temperature, T, and wind speed, V. 
 
    """</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1153.1">In this case, we used a little block of typeset math in our description. </span><span class="kobospan" id="kobo.1153.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1154.1">:math:</span></span></span></span><span class="kobospan" id="kobo.1155.1"> interpreted text role uses LaTeXmath typesetting. </span><span class="kobospan" id="kobo.1155.2">Tools like Sphinx can use MathJax or jsMath to do handle math typesetting.</span></p>
</div></li>
<li class="calibre7"><div id="x1-205017x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1156.1">Describe the parameters. </span><span class="kobospan" id="kobo.1156.2">For positional parameters, it’s common to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1157.1">:param</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1158.1"> name:</span></span></span></span><span class="kobospan" id="kobo.1159.1"> description. </span><span class="kobospan" id="kobo.1159.2">Sphinx will tolerate a number of variations, but this is common. </span><span class="kobospan" id="kobo.1159.3">For parameters that must be keywords, it’s common to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1160.1">:key</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1161.1"> name:</span></span></span></span><span class="kobospan" id="kobo.1162.1"> as the prefix to the description.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1163.1">def T_wc_3(T: float, V: float): 
 
    """Computes the wind chill temperature 
 
    The wind-chill, :math:‘T_{wc}‘, 
 
    is based on air temperature, T, and wind speed, V. 
 
 
 
    :param T: Temperature in C 
 
    :param V: Wind Speed in kph 
 
    """</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-205028x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1164.1">Describe the return value using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1165.1">:returns:</span></span></span></span><span class="kobospan" id="kobo.1166.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1167.1">def T_wc_4(T: float, V: float) -&gt; float: 
 
    """Computes the wind chill temperature 
 
    The wind-chill, :math:‘T_{wc}‘, 
 
    is based on air temperature, T, and wind speed, V. 
 
 
 
    :param T: Temperature in C 
 
    :param V: Wind Speed in kph 
 
 
 
    :returns: Wind-Chill temperature in C 
 
    """</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-205041x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1168.1">Identify the important exceptions</span><span id="dx1-205042"/><span class="kobospan" id="kobo.1169.1"> that might</span><span id="dx1-205043"/><span class="kobospan" id="kobo.1170.1"> be raised. </span><span class="kobospan" id="kobo.1170.2">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1171.1">:raises</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1172.1"> exception:</span></span></span></span><span class="kobospan" id="kobo.1173.1"> markup to define the reasons for the exception. </span><span class="kobospan" id="kobo.1173.2">There are several possible variations, but </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1174.1">:raises</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1175.1"> exception:</span></span></span></span><span class="kobospan" id="kobo.1176.1"> seems to be popular:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1177.1">def T_wc_5(T: float, V: float) -&gt; float: 
 
    """Computes the wind chill temperature 
 
    The wind-chill, :math:‘T_{wc}‘, 
 
    is based on air temperature, T, and wind speed, V. 
 
 
 
    :param T: Temperature in C 
 
    :param V: Wind Speed in kph 
 
 
 
    :returns: Wind-Chill temperature in C 
 
 
 
    :raises ValueError: for wind speeds under 4.8 kph or T above 10C 
 
    """</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-205058x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1178.1">Include a doctest test case, if possible:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1179.1">def T_wc(T: float, V: float) -&gt; float: 
 
    """Computes the wind chill temperature 
 
    The wind-chill, :math:‘T_{wc}‘, 
 
    is based on air temperature, T, and wind speed, V. 
 
 
 
    :param T: Temperature in C 
 
    :param V: Wind Speed in kph 
 
 
 
    :returns: Wind-Chill temperature in C 
 
 
 
    :raises ValueError: for wind speeds under 4.8 kph or T above 10C 
 
 
 
    &gt;&gt;&gt; round(T_wc(-10, 25), 1) 
 
    -18.8</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-205076x7" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1180.1">Write any additional notes</span><span id="dx1-205077"/><span class="kobospan" id="kobo.1181.1"> and helpful</span><span id="dx1-205078"/><span class="kobospan" id="kobo.1182.1"> information. </span><span class="kobospan" id="kobo.1182.2">We could add the following to the docstring:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1183.1">
    See https://en.wikipedia.org/wiki/Wind_chill 
 
    .. </span><span class="kobospan" id="kobo.1183.2">math:: 
 
 
 
        T_{wc}(T_a, V) = 13.2 + 0.6215 T_a - 11.37 V ^ {0.16} + 0.3965 T_a V ^ {0.16}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1184.1">We’ve included a reference to a Wikipedia page that summarizes wind-chill calculations and has links to more detailed information.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1185.1">We’ve also included a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1186.1">..</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1187.1"> </span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1188.1"> math::</span></span></span></span><span class="kobospan" id="kobo.1189.1"> directive with the LaTeX formula that’s used in the function. </span><span class="kobospan" id="kobo.1189.2">This will often typeset nicely, providing a very readable version of the code.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-205084r381"/></p>
</section>
<section data-number="0.6.7.3" id="how-it-works...-27">
<h2 class="likechapterhead" data-number="0.6.7.3"><span><span class="kobospan" id="kobo.1190.1">3.7.3 </span></span> <span id="x1-2060003"/><span class="kobospan" id="kobo.1191.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1192.1">For more information</span><span id="dx1-206001"/><span class="kobospan" id="kobo.1193.1"> on docstrings, see the </span><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1194.1">Including descriptions and</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1195.1">documentation</span></span></a><span class="kobospan" id="kobo.1196.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1197.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1198.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1199.1">2</span></span></a><span class="kobospan" id="kobo.1200.1">. </span><span class="kobospan" id="kobo.1200.2">While </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1201.1">Sphinx </span></span><span class="kobospan" id="kobo.1202.1">is popular, it isn’t the only tool</span><span id="dx1-206002"/><span class="kobospan" id="kobo.1203.1"> that can create</span><span id="dx1-206003"/><span class="kobospan" id="kobo.1204.1"> documentation from the docstring comments. </span><span class="kobospan" id="kobo.1204.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1205.1">pydoc</span></span><span class="kobospan" id="kobo.1206.1"> utility that’s part of the Python</span><span id="dx1-206004"/><span class="kobospan" id="kobo.1207.1"> Standard Library can also produce good-looking documentation from the docstring comments.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1208.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1209.1">Sphinx </span></span><span class="kobospan" id="kobo.1210.1">tool relies on the core features</span><span id="dx1-206005"/><span class="kobospan" id="kobo.1211.1"> of RST processing</span><span id="dx1-206006"/><span class="kobospan" id="kobo.1212.1"> in the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1213.1">Docutils</span></span><span class="kobospan" id="kobo.1214.1"> package. </span><span class="kobospan" id="kobo.1214.2">See </span><a class="url" href="https://pypi.python.org/pypi/docutils"><span class="url1"><span class="kobospan" id="kobo.1215.1">https://pypi.python.org/pypi/docutils</span></span></a><span class="kobospan" id="kobo.1216.1"> for more information.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1217.1">The RST rules are relatively simple. </span><span class="kobospan" id="kobo.1217.2">Most of the additional features in this recipe leverage the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1218.1">interpreted text roles </span></span><span class="kobospan" id="kobo.1219.1">of RST. </span><span class="kobospan" id="kobo.1219.2">Each of our </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1220.1">:param</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1221.1"> T:</span></span></span></span><span class="kobospan" id="kobo.1222.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1223.1">:returns:</span></span></span></span><span class="kobospan" id="kobo.1224.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1225.1">:raises</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1226.1"> ValueError:</span></span></span></span><span class="kobospan" id="kobo.1227.1"> constructs is a text role. </span><span class="kobospan" id="kobo.1227.2">The RST processor can use this information to decide on a style and structure for the content. </span><span class="kobospan" id="kobo.1227.3">The style usually includes a distinctive font. </span><span class="kobospan" id="kobo.1227.4">The context</span><span id="dx1-206007"/><span class="kobospan" id="kobo.1228.1"> might be an HTML </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1229.1">definition</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.1230.1">list </span></span><span class="kobospan" id="kobo.1231.1">format. </span><span id="x1-206008r389"/></p>
</section>
<section data-number="0.6.7.4" id="theres-more...-21">
<h2 class="likechapterhead" data-number="0.6.7.4"><span><span class="kobospan" id="kobo.1232.1">3.7.4 </span></span> <span id="x1-2070004"/><span class="kobospan" id="kobo.1233.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1234.1">In many cases, we’ll also need to include cross-references among functions and classes. </span><span class="kobospan" id="kobo.1234.2">For example, we might have a function that prepares a wind-chill table. </span><span class="kobospan" id="kobo.1234.3">This function might have documentation that includes a reference to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1235.1">T_wc()</span></span></span></span><span class="kobospan" id="kobo.1236.1"> function.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1237.1">Sphinx will generate these cross-references using a special </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1238.1">:func:</span></span></span></span><span class="kobospan" id="kobo.1239.1"> text role:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1240.1">def wind_chill_table() -&gt; None: 
 
    """Uses :func:‘T_wc‘ to produce a wind-chill 
 
    table for temperatures from -30C to 10C and 
 
    wind speeds from 5kph to 50kph. 
 
    """ 
 
    ... </span><span class="kobospan" id="kobo.1240.2"># etc.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1241.1">We’ve used </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1242.1">:func:‘Twc‘</span></span></span></span><span class="kobospan" id="kobo.1243.1"> to create a reference from one function in the RST documentation to another function. </span><span class="kobospan" id="kobo.1243.2">Sphinx will turn these into proper hyperlinks. </span><span id="x1-207008r390"/></p>
</section>
<section data-number="0.6.7.5" id="see-also-27">
<h2 class="likechapterhead" data-number="0.6.7.5"><span><span class="kobospan" id="kobo.1244.1">3.7.5 </span></span> <span id="x1-2080005"/><span class="kobospan" id="kobo.1245.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1246.1">See the </span><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1247.1">Including descriptions and documentation</span></span></a><span class="kobospan" id="kobo.1248.1"> and </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1249.1">Writing better</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1250.1">docstrings with RST markup</span></span></a><span class="kobospan" id="kobo.1251.1"> recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1252.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1253.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1254.1">2</span></span></a><span class="kobospan" id="kobo.1255.1">, for other recipes that show how RST works.</span></p></li>
</ul>
<p class="normal1"><span id="x1-208001r379"/></p>
</section>
</section>
<section data-number="0.6.8" id="designing-recursive-functions-around-pythons-stack-limits">
<h1 class="unnumbered" data-number="0.6.8"><span><span class="kobospan" id="kobo.1256.1">3.8 </span></span> <span id="x1-2090008"/><span class="kobospan" id="kobo.1257.1">Designing recursive functions around Python’s stack limits</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1258.1">Some functions can be defined</span><span id="dx1-209001"/><span class="kobospan" id="kobo.1259.1"> clearly and succinctly</span><span id="dx1-209002"/><span class="kobospan" id="kobo.1260.1"> using a recursive formula. </span><span class="kobospan" id="kobo.1260.2">There are two common examples of this.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1261.1">The factorial function has the following recursive definition:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1262.1"><img alt=" ( |{ n! = 1 if n = 0, |( n × (n− 1)! if n &gt; 0. " class="calibre9" src="../media/file44.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1263.1">The recursive rule for computing a Fibonacci number, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1264.1">F</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.1265.1">n</span></span></sub><span class="kobospan" id="kobo.1266.1">, has the following definition:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1267.1"><img alt=" ( |{ F = 1 if n = 0∨ n = 1, n |( Fn −1 + Fn −2 if n &gt; 1. " class="calibre9" src="../media/file45.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1268.1">Each of these involves a case that has a simple defined value and a case that involves computing the function’s value, based on other values of the same function.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1269.1">The problem we have is that Python imposes an upper limit for these kinds of recursive function evaluations. </span><span class="kobospan" id="kobo.1269.2">While Python’s integers can easily compute the value of 1000!, the stack limit prevents us from computing this casually.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1270.1">Pragmatically, the filesystem is an example of a recursive data structure. </span><span class="kobospan" id="kobo.1270.2">Each directory contains subdirectories. </span><span class="kobospan" id="kobo.1270.3">Recursive function definitions can be used on directory trees. </span><span class="kobospan" id="kobo.1270.4">The cases with defined values come from processing the non-directory files.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1271.1">We can often refactor a recursive design to eliminate the recursion and replace it with iteration. </span><span class="kobospan" id="kobo.1271.2">While doing recursion elimination, we’d like to preserve as much of the original mathematical clarity as possible. </span><span id="x1-209003r392"/></p>
<section data-number="0.6.8.1" id="getting-ready-28">
<h2 class="likechapterhead" data-number="0.6.8.1"><span><span class="kobospan" id="kobo.1272.1">3.8.1 </span></span> <span id="x1-2100001"/><span class="kobospan" id="kobo.1273.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1274.1">Many recursive function definitions</span><span id="dx1-210001"/><span class="kobospan" id="kobo.1275.1"> follow the pattern set by the factorial</span><span id="dx1-210002"/><span class="kobospan" id="kobo.1276.1"> function. </span><span class="kobospan" id="kobo.1276.2">This is sometimes called </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1277.1">tail recursion </span></span><span class="kobospan" id="kobo.1278.1">because the recursive</span><span id="dx1-210003"/><span class="kobospan" id="kobo.1279.1"> case can be written at the tail of the function body:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1280.1">def fact_r(n: int) -&gt; int: 
 
    if n == 0: 
 
        return 1 
 
    return n * fact_r(n - 1)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1281.1">The last expression in the function refers to the same function, but uses a different argument value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1282.1">We can restate this, avoiding the recursion limits in Python. </span><span id="x1-210009r394"/></p>
</section>
<section data-number="0.6.8.2" id="how-to-do-it...-28">
<h2 class="likechapterhead" data-number="0.6.8.2"><span><span class="kobospan" id="kobo.1283.1">3.8.2 </span></span> <span id="x1-2110002"/><span class="kobospan" id="kobo.1284.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1285.1">A tail recursion can also</span><span id="dx1-211001"/><span class="kobospan" id="kobo.1286.1"> be described as a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1287.1">reduction</span></span><span class="kobospan" id="kobo.1288.1">. </span><span class="kobospan" id="kobo.1288.2">We’re going to start with a collection of values, and then reduce them to a single value:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-211003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1289.1">Expand the rule to show all of the details: </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1290.1">n</span></span><span class="kobospan" id="kobo.1291.1">! </span><span class="kobospan" id="kobo.1291.2">= </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1292.1">n</span></span><span><span class="kobospan" id="kobo.1293.1">×</span></span><span class="kobospan" id="kobo.1294.1">(</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1295.1">n</span></span><span><span class="kobospan" id="kobo.1296.1">−</span></span><span class="kobospan" id="kobo.1297.1">1)</span><span><span class="kobospan" id="kobo.1298.1">×</span></span><span class="kobospan" id="kobo.1299.1">(</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1300.1">n</span></span><span><span class="kobospan" id="kobo.1301.1">−</span></span><span class="kobospan" id="kobo.1302.1">2)</span><span><span class="kobospan" id="kobo.1303.1">×</span></span><span class="kobospan" id="kobo.1304.1"> (</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1305.1">n </span></span><span><span class="kobospan" id="kobo.1306.1">− </span></span><span class="kobospan" id="kobo.1307.1">3) </span><span><span class="kobospan" id="kobo.1308.1">×</span></span><span class="kobospan" id="kobo.1309.1"><img alt="⋅⋅⋅" class="calibre9" src="../media/file46.png"/></span><span><span class="kobospan" id="kobo.1310.1">× </span></span><span class="kobospan" id="kobo.1311.1">1. </span><span class="kobospan" id="kobo.1311.2">This helps ensure we understand the recursive rule.</span></p>
</div></li>
<li class="calibre7"><div id="x1-211005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1312.1">Write a loop or generator to create all the values: </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1313.1">N </span></span><span class="kobospan" id="kobo.1314.1">= </span><span><span class="kobospan" id="kobo.1315.1">{</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1316.1">n,n </span></span><span><span class="kobospan" id="kobo.1317.1">− </span></span><span class="kobospan" id="kobo.1318.1">1</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1319.1">,n </span></span><span><span class="kobospan" id="kobo.1320.1">−</span></span><span class="kobospan" id="kobo.1321.1"> 2</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1322.1">,n </span></span><span><span class="kobospan" id="kobo.1323.1">− </span></span><span class="kobospan" id="kobo.1324.1">3</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1325.1">,</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1326.1">…</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1327.1">,</span></span><span class="kobospan" id="kobo.1328.1">1</span><span><span class="kobospan" id="kobo.1329.1">}</span></span><span class="kobospan" id="kobo.1330.1">. </span><span class="kobospan" id="kobo.1330.2">In Python, this can be as simple as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1331.1">range(1,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1332.1"> n+1)</span></span></span></span><span class="kobospan" id="kobo.1333.1">. </span><span class="kobospan" id="kobo.1333.2">In some cases, though, we might have to apply some transformation function to the base values: </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1334.1">N </span></span><span class="kobospan" id="kobo.1335.1">= </span><span><span class="kobospan" id="kobo.1336.1">{</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1337.1">f</span></span><span class="kobospan" id="kobo.1338.1">(</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1339.1">i</span></span><span class="kobospan" id="kobo.1340.1">)</span><span><span class="kobospan" id="kobo.1341.1">∣</span></span><span class="kobospan" id="kobo.1342.1">1 </span><span><span class="kobospan" id="kobo.1343.1">≤ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1344.1">i &lt; n </span></span><span class="kobospan" id="kobo.1345.1">+ 1</span><span><span class="kobospan" id="kobo.1346.1">}</span></span><span class="kobospan" id="kobo.1347.1">. </span><span class="kobospan" id="kobo.1347.2">This is a list comprehension; see </span><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1348.1">Building lists – literals, appending, and</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1349.1">comprehensions</span></span></a><span class="kobospan" id="kobo.1350.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1351.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1352.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1353.1">4</span></span></a><span class="kobospan" id="kobo.1354.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-211007x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1355.1">Incorporate the reduction function. </span><span class="kobospan" id="kobo.1355.2">In this case, we’re computing a large product, using multiplication. </span><span class="kobospan" id="kobo.1355.3">We can summarize this as </span><span><span class="kobospan" id="kobo.1356.1">∏</span></span> <sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1357.1">1</span></span><span class="cmr1"><span class="kobospan" id="kobo.1358.1">≤</span></span><span class="cmmi"><span class="kobospan" id="kobo.1359.1">x&lt;n</span></span><span class="cmr1"><span class="kobospan" id="kobo.1360.1">+1</span></span></sub><span class="cmti-10x-x"><span class="kobospan" id="kobo.1361.1">x</span></span><span class="kobospan" id="kobo.1362.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1363.1">Here’s an implementation in Python:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1364.1">def prod_i(int_iter: Iterable[int]) -&gt; int: 
 
    p = 1 
 
    for x in int_iter: 
 
        p *= x 
 
    return p</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1365.1">An equivalent function is available in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1366.1">math</span></span></span></span><span class="kobospan" id="kobo.1367.1"> module. </span><span class="kobospan" id="kobo.1367.2">Rather than write it out as shown above, we can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1368.1">from</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1369.1"> math</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1370.1"> import</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1371.1"> prod</span></span></span></span><span class="kobospan" id="kobo.1372.1">.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1373.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1374.1">prod_i()</span></span></span></span><span class="kobospan" id="kobo.1375.1"> function can be used as follows to compute a factorial value:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1376.1">&gt;&gt;&gt; prod_i(range(1, 6)) 
 
120 
 
&gt;&gt;&gt; fact(5) 
 
120</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1377.1">This works nicely. </span><span class="kobospan" id="kobo.1377.2">We’ve optimized the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1378.1">prod_i()</span></span></span></span><span class="kobospan" id="kobo.1379.1"> function into an iterative function. </span><span class="kobospan" id="kobo.1379.2">This revision avoids the potential stack overflow problems the recursive version suffers from.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1380.1">Note that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1381.1">range</span></span></span></span><span class="kobospan" id="kobo.1382.1"> object is lazy; it doesn’t create a big list object, avoiding the allocation of a great deal of memory. </span><span class="kobospan" id="kobo.1382.2">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1383.1">range</span></span></span></span><span class="kobospan" id="kobo.1384.1"> object returns</span><span id="dx1-211019"/><span class="kobospan" id="kobo.1385.1"> individual values</span><span id="dx1-211020"/><span class="kobospan" id="kobo.1386.1"> as they are consumed by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1387.1">prod_i()</span></span></span></span><span class="kobospan" id="kobo.1388.1"> function. </span><span id="x1-211021r396"/></p>
</section>
<section data-number="0.6.8.3" id="how-it-works...-28">
<h2 class="likechapterhead" data-number="0.6.8.3"><span><span class="kobospan" id="kobo.1389.1">3.8.3 </span></span> <span id="x1-2120003"/><span class="kobospan" id="kobo.1390.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1391.1">A tail recursion definition is handy because it’s short and easy to remember. </span><span class="kobospan" id="kobo.1391.2">Mathematicians like this because it can help clarify what a function means.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1392.1">Many static, compiled languages create optimized code in a manner similar to the technique we’ve shown here. </span><span class="kobospan" id="kobo.1392.2">This works by injecting a special instruction into the virtual machine’s byte code – or the actual machine code – to re-evaluate the function without creating a new stack frame. </span><span class="kobospan" id="kobo.1392.3">Python doesn’t have this feature. </span><span class="kobospan" id="kobo.1392.4">In effect, this optimization transforms a recursion into a kind of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1393.1">while</span></span></span></span><span class="kobospan" id="kobo.1394.1"> statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1395.1">def loop_fact(n: int) -&gt; int: 
 
    p = n 
 
    while n != 1: 
 
        n = n-1 
 
        p *= n 
 
    return p</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1396.1">The injection of the special byte code instruction will lead to code that runs quickly, without revealing the intermediate revisions. </span><span class="kobospan" id="kobo.1396.2">The resulting instructions will not be a perfect match for the source</span><span id="dx1-212008"/><span class="kobospan" id="kobo.1397.1"> text, however, leading to potential</span><span id="dx1-212009"/><span class="kobospan" id="kobo.1398.1"> difficulties in locating bugs. </span><span id="x1-212010r399"/></p>
</section>
<section data-number="0.6.8.4" id="theres-more...-22">
<h2 class="likechapterhead" data-number="0.6.8.4"><span><span class="kobospan" id="kobo.1399.1">3.8.4 </span></span> <span id="x1-2130004"/><span class="kobospan" id="kobo.1400.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1401.1">Computing the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1402.1">F</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.1403.1">n</span></span></sub><span class="kobospan" id="kobo.1404.1"> Fibonacci number</span><span id="dx1-213001"/><span class="kobospan" id="kobo.1405.1"> involves an additional problem. </span><span class="kobospan" id="kobo.1405.2">If we’re not careful, we’ll compute a lot of values more than once:</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1406.1">To compute </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1407.1">F</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1408.1">5</span></span></sub><span class="kobospan" id="kobo.1409.1"> = </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1410.1">F</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1411.1">4</span></span></sub><span class="kobospan" id="kobo.1412.1"> + </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1413.1">F</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1414.1">3</span></span></sub><span class="kobospan" id="kobo.1415.1">, for example, we’ll evaluate this:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1416.1"><img alt="F5 = (F3 + F2 )+ (F2 + F1) " class="calibre9" src="../media/file47.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1417.1">Expanding the definition of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1418.1">F</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1419.1">3</span></span></sub><span class="kobospan" id="kobo.1420.1"> and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1421.1">F</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1422.1">2</span></span></sub><span class="kobospan" id="kobo.1423.1"> shows a number of redundant computations.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1424.1">The Fibonacci problem involves two recursions. </span><span class="kobospan" id="kobo.1424.2">If we write it naively, it might look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1425.1">def fibo(n: int) -&gt; int: 
 
    if n &lt;= 1: 
 
        return 1 
 
    else: 
 
        return fibo(n-1) + fibo(n-2)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1426.1">It’s difficult to do a simple mechanical transformation to turn something like this example into a tail recursion. </span><span class="kobospan" id="kobo.1426.2">We have two ways to reduce the computation complexity of this:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1427.1">Use memoization</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1428.1">Restate the problem</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1429.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1430.1">memoization </span></span><span class="kobospan" id="kobo.1431.1">technique is easy to apply</span><span id="dx1-213008"/><span class="kobospan" id="kobo.1432.1"> in Python. </span><span class="kobospan" id="kobo.1432.2">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1433.1">@functools.cache</span></span></span></span><span class="kobospan" id="kobo.1434.1"> as a decorator. </span><span class="kobospan" id="kobo.1434.2">It looks</span><span id="dx1-213009"/><span class="kobospan" id="kobo.1435.1"> like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1436.1">from functools import cache 
 
 
 
@cache 
 
def fibo_r(n: int) -&gt; int: 
 
    if n &lt; 2: 
 
        return 1 
 
    else: 
 
        return fibo_r(n - 1) + fibo_r(n - 2)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1437.1">Adding this decorator will optimize a more complex recursion.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1438.1">Restating the problem means looking at it from a new perspective. </span><span class="kobospan" id="kobo.1438.2">In this case, we can think of computing all Fibonacci numbers up to and including the desired </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1439.1">F</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.1440.1">n</span></span></sub><span class="kobospan" id="kobo.1441.1">. </span><span class="kobospan" id="kobo.1441.2">We only want the last value in this sequence. </span><span class="kobospan" id="kobo.1441.3">Computing a number of intermediate values can be reasonably efficient.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1442.1">Here’s a generator function that does this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1443.1">from collections.abc import Iterator 
 
 
 
def fibo_iter() -&gt; Iterator[int]: 
 
    a = 1 
 
    b = 1 
 
    yield a 
 
    while True: 
 
        yield b 
 
        a, b = b, a + b</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1444.1">This function is an infinite iteration of Fibonacci numbers. </span><span class="kobospan" id="kobo.1444.2">It uses Python’s </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1445.1">yield</span></span></span></span><span class="kobospan" id="kobo.1446.1"> so that it emits values in a lazy fashion. </span><span class="kobospan" id="kobo.1446.2">When a client function uses this iterator, the next number in the sequence is computed as each number is consumed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1447.1">Here’s a function that consumes the values and also imposes an upper limit on the otherwise infinite iterator:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1448.1">def fibo_i(n: int) -&gt; int: 
 
    for i, f_i in enumerate(fibo_iter()): 
 
        if i == n: 
 
            break 
 
    return f_i</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1449.1">This function consumes a sequence</span><span id="dx1-213035"/><span class="kobospan" id="kobo.1450.1"> of values from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1451.1">fibo_iter()</span></span></span></span><span class="kobospan" id="kobo.1452.1"> iterator. </span><span class="kobospan" id="kobo.1452.2">When the desired number has been reached, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1453.1">break</span></span></span></span><span class="kobospan" id="kobo.1454.1"> statement ends the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1455.1">for</span></span></span></span><span class="kobospan" id="kobo.1456.1"> statement.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1457.1">We’ve optimized the recursive solution and turned it into an iteration that avoids the potential for stack overflow. </span><span id="x1-213036r401"/></p>
</section>
<section data-number="0.6.8.5" id="see-also-28">
<h2 class="likechapterhead" data-number="0.6.8.5"><span><span class="kobospan" id="kobo.1458.1">3.8.5 </span></span> <span id="x1-2140005"/><span class="kobospan" id="kobo.1459.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1460.1">See the </span><a href="ch006_split_001.xhtml#x1-1290007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1461.1">Avoiding a potential problem with break statements</span></span></a><span class="kobospan" id="kobo.1462.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1463.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1464.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1465.1">2</span></span></a><span class="kobospan" id="kobo.1466.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-214001r393"/></p>
</section>
</section>
<section data-number="0.6.9" id="writing-testable-scripts-with-the-script-library-switch">
<h1 class="unnumbered" data-number="0.6.9"><span><span class="kobospan" id="kobo.1467.1">3.9 </span></span> <span id="x1-2150009"/><span class="kobospan" id="kobo.1468.1">Writing testable scripts with the script-library switch</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1469.1">It’s often very easy to create</span><span id="dx1-215001"/><span class="kobospan" id="kobo.1470.1"> a Python script file. </span><span class="kobospan" id="kobo.1470.2">When we provide</span><span id="dx1-215002"/><span class="kobospan" id="kobo.1471.1"> a script file to Python, it runs immediately. </span><span class="kobospan" id="kobo.1471.2">In some cases, there are no function or class definitions; the script file is the sequence of Python statements.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1472.1">These script files are very difficult to test. </span><span class="kobospan" id="kobo.1472.2">Additionally, they’re also difficult to reuse. </span><span class="kobospan" id="kobo.1472.3">When we want to build larger and more sophisticated applications from a collection of script files, we’re often forced to re-engineer a script into one or more functions. </span><span id="x1-215003r406"/></p>
<section data-number="0.6.9.1" id="getting-ready-29">
<h2 class="likechapterhead" data-number="0.6.9.1"><span><span class="kobospan" id="kobo.1473.1">3.9.1 </span></span> <span id="x1-2160001"/><span class="kobospan" id="kobo.1474.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1475.1">Let’s say that we have a handy implementation of the haversine distance function called </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1476.1">haversine()</span></span></span></span><span class="kobospan" id="kobo.1477.1">, and it’s in a file named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1478.1">recipe_11.py</span></span></span></span><span class="kobospan" id="kobo.1479.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1480.1">The file contains the functions and definitions shown in the </span><a href="ch007_split_001.xhtml#x1-1940006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1481.1">Picking an order for</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1482.1">parameters based on partial functions</span></span></a><span class="kobospan" id="kobo.1483.1"> in this chapter. </span><span class="kobospan" id="kobo.1483.2">This includes a partial function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1484.1">nm_haversine()</span></span></span></span><span class="kobospan" id="kobo.1485.1">, to compute distances in nautical miles. </span><span class="kobospan" id="kobo.1485.2">The script also contains the following top-level code:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1486.1">source_path = Path("data/waypoints.csv") 
 
with source_path.open() as source_file: 
 
    reader = csv.DictReader(source_file) 
 
    start = next(reader) 
 
    for point in reader: 
 
        d = nm_haversine( 
 
            float(start[’lat’]), 
 
            float(start[’lon’]), 
 
            float(point[’lat’]), 
 
            float(point[’lon’]) 
 
        ) 
 
        print(start, point, d) 
 
        start = point</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1487.1">This Python script opens a file, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1488.1">data/wapypoints.csv</span></span></span></span><span class="kobospan" id="kobo.1489.1">, and does some processing on that file. </span><span class="kobospan" id="kobo.1489.2">While this is handy to use, we can’t easily test it.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1490.1">If we try to import</span><span id="dx1-216015"/><span class="kobospan" id="kobo.1491.1"> the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1492.1">haversine()</span></span></span></span><span class="kobospan" id="kobo.1493.1"> function for a unit</span><span id="dx1-216016"/><span class="kobospan" id="kobo.1494.1"> test, we’ll execute the other parts of the script. </span><span class="kobospan" id="kobo.1494.2">How can we refactor this module so we can import the useful functions without it printing a display of distances between waypoints in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1495.1">wapypoints.csv</span></span></span></span><span class="kobospan" id="kobo.1496.1"> file? </span><span id="x1-216017r408"/></p>
</section>
<section data-number="0.6.9.2" id="how-to-do-it...-29">
<h2 class="likechapterhead" data-number="0.6.9.2"><span><span class="kobospan" id="kobo.1497.1">3.9.2 </span></span> <span id="x1-2170002"/><span class="kobospan" id="kobo.1498.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1499.1">Writing a Python script can be called an </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1500.1">attractive nuisance</span></span><span class="kobospan" id="kobo.1501.1">; it’s attractively simple, but it’s difficult to test effectively. </span><span class="kobospan" id="kobo.1501.2">Here’s how we can transform a script into a testable and reusable library:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-217002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1502.1">Identify the statements that do the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1503.1">work </span></span><span class="kobospan" id="kobo.1504.1">of the script. </span><span class="kobospan" id="kobo.1504.2">This means distinguishing between </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1505.1">definitions </span></span><span class="kobospan" id="kobo.1506.1">and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1507.1">actions</span></span><span class="kobospan" id="kobo.1508.1">. </span><span class="kobospan" id="kobo.1508.2">Statements such as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1509.1">import</span></span></span></span><span class="kobospan" id="kobo.1510.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1511.1">def</span></span></span></span><span class="kobospan" id="kobo.1512.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1513.1">class</span></span></span></span><span class="kobospan" id="kobo.1514.1"> are definitional – they create objects but don’t take a direct action to compute or produce the output. </span><span class="kobospan" id="kobo.1514.2">Almost all other statements take some action. </span><span class="kobospan" id="kobo.1514.3">Because some assignment statements might be part of type hint definition, or might create useful constants, the distinction is entirely one of intent.</span></p>
</div></li>
<li class="calibre7"><div id="x1-217004x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1515.1">In our example, we have some assignment statements that are more definition than action. </span><span class="kobospan" id="kobo.1515.2">These assignments are analogous to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1516.1">def</span></span></span></span><span class="kobospan" id="kobo.1517.1"> statements; they only set variables that are used later. </span><span class="kobospan" id="kobo.1517.2">Here are the generally definitional statements:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1518.1">from math import radians, sin, cos, sqrt, asin 
 
from functools import partial 
 
 
 
MI = 3959 
 
NM = 3440 
 
KM = 6373 
 
 
 
def haversine( 
 
    lat_1: float, lon_1: float, 
 
    lat_2: float, lon_2: float, *, R: float) -&gt; float: 
 
 
 
    ... </span><span class="kobospan" id="kobo.1518.2"> # etc.</span></code></pre>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1519.1">
nm_haversine = partial(haversine, R=NM)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1520.1">The rest of the statements in the module are designed to take an action toward producing the printed results.</span></p>
</div></li>
<li class="calibre7"><div id="x1-217021x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1521.1">Wrap the actions</span><span id="dx1-217022"/><span class="kobospan" id="kobo.1522.1"> into a function. </span><span class="kobospan" id="kobo.1522.2">Try to pick a descriptive</span><span id="dx1-217023"/><span class="kobospan" id="kobo.1523.1"> name. </span><span class="kobospan" id="kobo.1523.2">If there’s no better name, use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1524.1">main()</span></span></span></span><span class="kobospan" id="kobo.1525.1">. </span><span class="kobospan" id="kobo.1525.2">In this example the action computes distances, so we’ll call the function </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1526.1">distances()</span></span></span></span><span class="kobospan" id="kobo.1527.1">.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1528.1">def distances_draft(): 
 
    source_path = Path("data/waypoints.csv") 
 
    with source_path.open() as source_file: 
 
        reader = csv.DictReader(source_file) 
 
        start = next(reader) 
 
        for point in reader: 
 
            d = nm_haversine( 
 
                float(start[’lat’]), 
 
                float(start[’lon’]), 
 
                float(point[’lat’]), 
 
                float(point[’lon’]) 
 
            ) 
 
            print(start, point, d) 
 
            start = point</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1529.1">In the above example, we named the function </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1530.1">distances_draft()</span></span></span></span><span class="kobospan" id="kobo.1531.1"> to assure that it’s clearly distinct from a more final version. </span><span class="kobospan" id="kobo.1531.2">Practically, using distinct names like this as code evolves toward completion isn’t necessary, unless writing a book where it’s essential to unit test intermediate steps.</span></p>
</div></li>
<li class="calibre7"><div id="x1-217040x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1532.1">Where possible, extract literals and turn them into parameters. </span><span class="kobospan" id="kobo.1532.2">This is often a simple movement of the literal to a parameter with a default value.</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1533.1">def distances( 
 
    source_path: Path = Path("data/waypoints.csv") 
 
) -&gt; None: 
 
    ... </span><span class="kobospan" id="kobo.1533.2"> # etc.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1534.1">This makes the script reusable because the path is now a parameter instead of an assumption.</span></p>
</div></li>
<li class="calibre7"><div id="x1-217047x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1535.1">Include the following </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1536.1">if</span></span></span></span><span class="kobospan" id="kobo.1537.1"> statement as the only high-level action statements in the script file:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1538.1">if __name__ == "__main__": 
 
    distances()</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1539.1">We’ve packaged the action</span><span id="dx1-217051"/><span class="kobospan" id="kobo.1540.1"> of the script</span><span id="dx1-217052"/><span class="kobospan" id="kobo.1541.1"> as a function. </span><span class="kobospan" id="kobo.1541.2">The top-level action script is now wrapped in an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1542.1">if</span></span></span></span><span class="kobospan" id="kobo.1543.1"> statement so that it isn’t executed during </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1544.1">import</span></span></span></span><span class="kobospan" id="kobo.1545.1"> but is executed when the script is run directly. </span><span id="x1-217053r410"/></p>
</section>
<section data-number="0.6.9.3" id="how-it-works...-29">
<h2 class="likechapterhead" data-number="0.6.9.3"><span><span class="kobospan" id="kobo.1546.1">3.9.3 </span></span> <span id="x1-2180003"/><span class="kobospan" id="kobo.1547.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1548.1">An important rule for Python is that an import of a module is essentially the same as running the module as a script. </span><span class="kobospan" id="kobo.1548.2">The statements in the file are executed, in order, from top to bottom.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1549.1">When we import a file, we’re generally interested in executing the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1550.1">def</span></span></span></span><span class="kobospan" id="kobo.1551.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1552.1">class</span></span></span></span><span class="kobospan" id="kobo.1553.1"> statements. </span><span class="kobospan" id="kobo.1553.2">We might be interested in some assignment statements that define useful globals. </span><span class="kobospan" id="kobo.1553.3">Sometimes, we’re not interested in executing the main program.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1554.1">When Python runs a script, it sets a number of built-in special variables. </span><span class="kobospan" id="kobo.1554.2">One of these is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1555.1">__name__</span></span></span></span><span class="kobospan" id="kobo.1556.1">. </span><span class="kobospan" id="kobo.1556.2">This variable has two different values, depending on the context in which the file is being executed:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1557.1">The top-level script, executed from the command line: In this case, the value of the built-in special name of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1558.1">__name__</span></span></span></span><span class="kobospan" id="kobo.1559.1"> is set to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1560.1">"__main__"</span></span></span></span><span class="kobospan" id="kobo.1561.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1562.1">A file being executed because of an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1563.1">import</span></span></span></span><span class="kobospan" id="kobo.1564.1"> statement: In this case, the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1565.1">__name__</span></span></span></span><span class="kobospan" id="kobo.1566.1"> is the name of the module being created from reading the file and executing the Python statements.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1567.1">The standard name of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1568.1">"__main__"</span></span></span></span><span class="kobospan" id="kobo.1569.1"> may seem a little odd at first. </span><span class="kobospan" id="kobo.1569.2">Why not use the filename in all cases? </span><span class="kobospan" id="kobo.1569.3">This special name is assigned because a Python script can be read from one of many sources. </span><span class="kobospan" id="kobo.1569.4">It can be a file. </span><span class="kobospan" id="kobo.1569.5">Python can also be read from the stdin pipeline, or it can be provided</span><span id="dx1-218001"/><span class="kobospan" id="kobo.1570.1"> on the Python command</span><span id="dx1-218002"/><span class="kobospan" id="kobo.1571.1"> line using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1572.1">-c</span></span></span></span><span class="kobospan" id="kobo.1573.1"> option. </span><span id="x1-218003r416"/></p>
</section>
<section data-number="0.6.9.4" id="theres-more...-23">
<h2 class="likechapterhead" data-number="0.6.9.4"><span><span class="kobospan" id="kobo.1574.1">3.9.4 </span></span> <span id="x1-2190004"/><span class="kobospan" id="kobo.1575.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1576.1">We can now build useful work around a reusable library. </span><span class="kobospan" id="kobo.1576.2">We might make an application script file that look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1577.1">from pathlib import Path 
 
from ch03.recipe_11 import distances 
 
 
 
if __name__ == "__main__": 
 
    for trip in ’trip_1.csv’, ’trip_2.csv’: 
 
        distances(Path(’data’) / trip)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1578.1">The goal is to decompose a practical solution into two collections of features:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1579.1">The definition of classes and functions</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1580.1">A very small action-oriented script that uses the definitions to do useful work</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1581.1">We often start with a script that conflates both sets of features. </span><span class="kobospan" id="kobo.1581.2">This kind</span><span id="dx1-219008"/><span class="kobospan" id="kobo.1582.1"> of script can be viewed as a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1583.1">spike solution</span></span><span class="kobospan" id="kobo.1584.1">. </span><span class="kobospan" id="kobo.1584.2">Our spike solution can evolve toward a more refined solution as soon as we’re sure that it works. </span><span class="kobospan" id="kobo.1584.3">A </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1585.1">spike </span></span><span class="kobospan" id="kobo.1586.1">or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1587.1">piton </span></span><span class="kobospan" id="kobo.1588.1">is a piece of removable mountain-climbing gear that enables us to climb safely.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1589.1">After starting with a spike, we can elevate our design and refactor the code into definitions and actions. </span><span class="kobospan" id="kobo.1589.2">Tests can then import the module to test the various definitions without taking actions that might overwrite important files. </span><span id="x1-219009r417"/></p>
</section>
<section data-number="0.6.9.5" id="see-also-29">
<h2 class="likechapterhead" data-number="0.6.9.5"><span><span class="kobospan" id="kobo.1590.1">3.9.5 </span></span> <span id="x1-2200005"/><span class="kobospan" id="kobo.1591.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1592.1">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1593.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1594.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1595.1">7</span></span></a><span class="kobospan" id="kobo.1596.1">, we look at class definitions. </span><span class="kobospan" id="kobo.1596.2">These are another kind of widely used definitional statement, in addition to function definitions.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1597.1">The </span><a href="ch015_split_000.xhtml#x1-6320003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1598.1">Reading delimited files with the CSV module</span></span></a><span class="kobospan" id="kobo.1599.1"> recipe that we look at in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1600.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1601.1"> </span></span><a href="ch015_split_000.xhtml#x1-61500011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1602.1">11</span></span></a><span class="kobospan" id="kobo.1603.1"> also addresses CSV file reading.</span></p></li>
</ul>
<p class="normal1"><span id="x1-220001r407"/></p>
</section>
</section>
<section data-number="0.6.12" id="join-our-community-discord-space-3">
<h1 class="unnumbered" data-number="0.6.12"><span id="x1-22300011"/><span class="kobospan" id="kobo.1604.1">Join our community Discord space</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1605.1">Join our Python Discord workspace to discuss and find out more about the book: </span><a href="https://packt.link/dHrHU" class="url"><span class="url1"><span class="kobospan" id="kobo.1606.1">https://packt.link/dHrHU</span></span></a></p>
<p class="normal1"><span class="kobospan" id="kobo.1607.1"><img alt="PIC" src="../media/file1.png" class="calibre9"/></span></p>
<p class="normal1"><span id="x1-223001r283"/></p>
</section>
</section>
</body></html>