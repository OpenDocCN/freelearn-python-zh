<html><head></head><body>
  <div><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Integration with Other Tools and Frameworks</h1></div></div></div><p>Selenium WebDriver Python API is very powerful and flexible. So far we have learned how Selenium WebDriver integrates with the <code class="literal">unittest</code> library and creates a simple testing framework. However, this does not limit us to just using the <code class="literal">unittest</code> library. We can integrate Selenium WebDriver with lots of other tools and frameworks. There are a number of ready-to-use frameworks available along with Selenium WebDriver.</p><p>We can use Selenium WebDriver for applying <strong>Behavior-Driven Development</strong> (<strong>BDD</strong>) in your projects with various frameworks that support BDD.</p><p>We can also integrate Selenium Python API with <strong>Continuous Integration</strong> (<strong>CI</strong>) and build tools that allow us to run the test immediately after the application is built. This provides an early feedback to developers about quality and stability of the application.</p><p>In this chapter, you will learn some of the major integration examples including:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading and installing Behave for BDD</li><li class="listitem" style="list-style-type: disc">Writing features with Behave</li><li class="listitem" style="list-style-type: disc">Automating features with Behave and Selenium WebDriver</li><li class="listitem" style="list-style-type: disc">Downloading and installing Jenkins</li><li class="listitem" style="list-style-type: disc">Setting up Jenkins to run Selenium tests</li><li class="listitem" style="list-style-type: disc">Configuring Jenkins to capture results from test runs</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec55"/>Behavior-Driven Development</h1></div></div></div><p>BDD is an agile software development <a id="id631" class="indexterm"/>method introduced by Dan North in his famous paper <em>Introducing </em>
<a id="id632" class="indexterm"/>
<em>BDD</em> (<a class="ulink" href="http://dannorth.net/introducing-bdd/">http://dannorth.net/introducing-bdd/</a>).</p><p>BDD is also known as <strong>Acceptance Test Driven Development</strong> (<strong>ATDD</strong>), story testing, or specification by example. BDD encourages collaboration between developers, QAs, and nontechnical or business <a id="id633" class="indexterm"/>users in a software project to define specifications and decide acceptance criteria by writing test cases in a natural language that nonprogrammers can read.</p><div><div><h3 class="title"><a id="note20"/>Note</h3><p>There are a number of tools available in Python to implement BDD; the two major tools are <a id="id634" class="indexterm"/>
<strong>Behave</strong> (<a class="ulink" href="https://pythonhosted.org/behave/">https://pythonhosted.org/behave/</a>) <a id="id635" class="indexterm"/>and <strong>Lettuce</strong> (<a class="ulink" href="http://lettuce.it/">http://lettuce.it/</a>), which is inspired by the very famous BDD tool called <a id="id636" class="indexterm"/>
<strong>Cucumber</strong> (<a class="ulink" href="http://cukes.info/">http://cukes.info/</a>) available in Ruby.</p></div></div><p>You will learn how to use Behave to implement BDD for the sample application in the upcoming sections.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec61"/>Installing Behave</h2></div></div></div><p>Installing <a id="id637" class="indexterm"/>Behave is a simple process. We can download and install Behave with the following command line:</p><div><pre class="programlisting">
<strong>pip install behave</strong>
</pre></div><p>This will download <a id="id638" class="indexterm"/>and install Behave along with its dependencies. There are additional installation options available for Behave at <a class="ulink" href="https://pythonhosted.org/behave/install.html">https://pythonhosted.org/behave/install.html</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec62"/>Writing the first feature in Behave</h2></div></div></div><p>The process <a id="id639" class="indexterm"/>starts with discussing and listing the features and user stories for these features for the application that is being developed. Various <a id="id640" class="indexterm"/>stakeholders meet together and create a list of features, user stories, and acceptance criteria in a ubiquitous language, which is understood by all the parties, including developers, testers, business analysts, and customers. Behave <a id="id641" class="indexterm"/>supports creating feature files in the Gherkin <a id="id642" class="indexterm"/>language in the <strong>Given</strong>, <strong>When</strong>, <strong>Then</strong> (<strong>GWT</strong>) format. Refer to <a class="ulink" href="https://github.com/cucumber/cucumber/wiki/Gherkin">https://github.com/cucumber/cucumber/wiki/Gherkin</a> for more information on the Gherkin language.</p><p>Let's begin with a feature for the search functionality in the sample application. The search feature should enable users to search for products from the home page. The feature file provides a simple <a id="id643" class="indexterm"/>description for the user story and acceptance criteria as a scenario outline in the GWT format. These are also known as scenario steps, explained as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Given</strong>: This sets a <a id="id644" class="indexterm"/>precondition to execute the scenario; navigate to the home page in this scenario</li><li class="listitem" style="list-style-type: disc"><strong>When</strong>: This contains <a id="id645" class="indexterm"/>the actions for the scenario; search for a term in this example</li><li class="listitem" style="list-style-type: disc"><strong>Then</strong>: This contains <a id="id646" class="indexterm"/>the outcome of the scenario; check whether the list of matching products is displayed in this example</li></ul></div><p>We can have <a id="id647" class="indexterm"/>multiple <code class="literal">When</code> and <code class="literal">Then</code> steps in a scenario:</p><div><pre class="programlisting">Feature: I want to search for products

 Scenario Outline: Search
   Given I am on home page
    when I search for "phone"
    then I should see list of matching products in search results</pre></div><p>To use this feature with Behave, we need to store this in a plain text file with a <code class="literal">.feature</code> extension. Let's <a id="id648" class="indexterm"/>create a folder named <code class="literal">bdd</code>/<code class="literal">feature</code> and save this file as <code class="literal">search.feature</code> in the folder.</p><div><div><div><div><h3 class="title"><a id="ch10lvl3sec25"/>Implementing a step definition file for the feature</h3></div></div></div><p>Once we <a id="id649" class="indexterm"/>write the feature files, we need to create step definitions for the steps written in scenario outline. Step definitions are<a id="id650" class="indexterm"/>
<a id="id651" class="indexterm"/> Python code blocks that understand the steps written in plain text format and contain the code to either call the API or Selenium WebDriver commands to execute the steps. The step definition files should be stored in a <code class="literal">steps</code> subfolder where feature files are stored. Let's create a <code class="literal">search_steps.py</code> file with the following step definitions:</p><div><pre class="programlisting">from behave import *


@given('I am on home page')
def step_i_am_on_home_page(context):
    context.driver.get("http://demo.magentocommerce.com/")


@when('I search for {text}')
def step_i_search_for(context, text):
    search_field = context.driver.find_element_by_name("q")
    search_field.clear()

    # enter search keyword and submit
    search_field.send_keys(text)
    search_field.submit()


@then('I should see list of matching products in search results')
def step_i_should_see_list(context):
    products = context.driver.\
        find_elements_by_xpath("//h2[@class='product-name']/a")
    # check count of products shown in results
    assert len(products) &gt; 0</pre></div><p>For each GWT, we need to create a matching step definition. For example, for the given <code class="literal">I am on home page</code> step, we created the following step definition. Steps are identified using decorators that match the predicate from the feature file: <code class="literal">@given</code>, <code class="literal">@when</code>, and <code class="literal">@then</code>. The <a id="id652" class="indexterm"/>decorator accepts a string <a id="id653" class="indexterm"/>containing the rest of the phrase used in the scenario step it belongs to, in this case, <code class="literal">I am on home page</code>.</p><div><pre class="programlisting">@given('I am on home page')
def step_i_am_on_home_page(context):
    context.driver.get("http://demo.magentocommerce.com/")</pre></div><p>We can also pass parameters that are embedded in steps to the step definition. For example, for <code class="literal">@when</code> we are passing the search phrase as <code class="literal">when I search for "phone"</code>.</p><p>We can read the value using <code class="literal">{text}</code> as shown in the following code sample:</p><div><pre class="programlisting">@when('I search for {text}')
def step_i_search_for(context, text):
    search_field = context.driver.find_element_by_name("q")
    search_field.clear()

    # enter search keyword and submit
    search_field.send_keys(text)
    search_field.submit()</pre></div><p>You can see the context variable passed to the step definitions. The context variable is used by <a id="id654" class="indexterm"/>Behave to store information to <a id="id655" class="indexterm"/>share around. It runs at three levels, automatically managed by Behave. We can also use the context variable to store and share information between the steps.</p></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec26"/>Creating environment configurations</h3></div></div></div><p>Before we <a id="id656" class="indexterm"/>can run the feature, we need to create an environment file that is used to set up common Behave settings and any code that <a id="id657" class="indexterm"/>will be shared between steps or step definition files. This is a great place to initialize the WebDriver to start Firefox, which will be used to run the steps using the Selenium WebDriver. Create an <code class="literal">environment.py</code> file by the side of the feature files and add the <code class="literal">before_all()</code> and <code class="literal">after_all()</code> methods, which will be executed before and after the features are executed, as shown in the following code:</p><div><pre class="programlisting">from selenium import webdriver

def before_all(context):
    context.driver = webdriver.Chrome()

def after_all(context):
    context.driver.quit()</pre></div></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec27"/>Running features</h3></div></div></div><p>Now, it's <a id="id658" class="indexterm"/>time to run the features with Behave. This is really simple. Navigate to the <code class="literal">bdd</code> folder that we created in the earlier steps and execute the <code class="literal">behave</code> <a id="id659" class="indexterm"/>command:</p><div><pre class="programlisting">
<strong>behave</strong>
</pre></div><p>Behave will execute all the features that are written in the <code class="literal">bdd</code> folder. It will use the step definition and environment settings that we made to run the scenarios. At the end of execution, you will see a summary of the execution, as shown in the following screenshot:</p><div><img src="img/3506OS_10_01.jpg" alt="Running features"/></div><p>Behave generates <a id="id660" class="indexterm"/>a summary at three levels, namely features, scenarios, and <a id="id661" class="indexterm"/>steps for pass and failure.</p></div><div><div><div><div><h3 class="title"><a id="ch10lvl3sec28"/>Using a scenario outline</h3></div></div></div><p>Sometimes we <a id="id662" class="indexterm"/>might want to run scenario(s) with a number of <a id="id663" class="indexterm"/>variables giving a set of known states, actions to take, and expected outcomes, all using the same steps, something similar to data-driven tests. We can use a scenario outline for this.</p><p>Let's rewrite the <code class="literal">search.feature</code> file with a scenario outline and examples as given in the following steps. The scenario outline works like a template, for example, given in the <code class="literal">Example</code> section.</p><div><ol class="orderedlist arabic"><li class="listitem">In this example, we create two examples to check the search functionality on the categories or for a specific product. The <code class="literal">Example</code> sections contain the search term and the expected results in a tabular format:<div><pre class="programlisting">Feature: I want to search for products

 Scenario Outline: Search
   Given I am on home page
    when I search for &lt;term&gt;
    then I should see results &lt;search_count&gt; in search results

 Examples: By category
   | term    | search_count |
   | Phones  | 2            |
   | Bags    | 7            |

 Examples: By product name
   | term      | search_count |
   | Madison earbuds  | 3            |</pre></div></li><li class="listitem">Also, modify <a id="id664" class="indexterm"/>the <code class="literal">search_steps.py</code> file to match the text used in steps:<div><pre class="programlisting">from behave import *


@given('I am on home page')
def step_i_am_on_home_page(context):
    context.driver.get("http://demo.magentocommerce.com/")


@when('I search for {text}')
def step_i_search_for(context, text):
    search_field = context.driver.find_element_by_name("q")
    search_field.clear()

    # enter search keyword and submit
    search_field.send_keys(text)
    search_field.submit()


@then('I should see results {text} in search results')
def step_i_should_see_results(context, text):
    products = context.driver.\
        find_elements_by_xpath("//h2[@class='product-name']/a")
    # check count of products shown in results
    assert len(products) &gt;= int(text)</pre></div></li></ol></div><p>When we execute this feature, Behave will automatically repeat the scenario outline for the number of rows it finds in the <code class="literal">Example</code> section that are written in the <code class="literal">search.feature</code> file. It passes the data from the <a id="id665" class="indexterm"/>example data to the scenario steps and executes the definition. You can see the outcome after Behave is run on the modified feature. Behave prints all the combinations it ran on the feature as shown in following screenshot:</p><div><img src="img/3506OS_10_02.jpg" alt="Using a scenario outline"/></div><div><div><h3 class="title"><a id="tip14"/>Tip</h3><p>Behave also supports report generation in JUnit format using the <code class="literal">–junit</code> switch.</p></div></div></div></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec56"/>CI with Jenkins</h1></div></div></div><p>Jenkins is a popular CI <a id="id666" class="indexterm"/>server written in Java. It is derived from the Hudson project. Both Jenkins and Hudson provide similar features.</p><p>Jenkins supports <a id="id667" class="indexterm"/>various version control tools such as CVS, SVN, Git, Mercurial, Perforce, and ClearCase, and can execute projects built with Apache Ant or Maven for Java. However, it can also build projects for other platforms using plugins, arbitrary shell scripts, and Windows' <code class="literal">batch</code> commands.</p><p>Apart from building the software, Jenkins can be deployed to set up an automated testing environment where Selenium WebDriver tests can be run unattended based on a defined schedule, or every time changes are submitted to the version control system.</p><p>In the upcoming sections, you will learn how to set up Jenkins to run tests using a free-style project template.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec63"/>Preparing for Jenkins</h2></div></div></div><p>Before we start <a id="id668" class="indexterm"/>using Jenkins to run our tests, we need to make few changes so that we can take advantage of Jenkins's capabilities. We will use Jenkins to run our tests on a pre-defined schedule and collect results from tests so that Jenkins can show them on a dashboard. We will reuse smoke tests that we created in <a class="link" href="ch02.html" title="Chapter 2. Writing Tests Using unittest">Chapter 2</a>, <em>Writing Tests Using unittest</em>.</p><p>We used the <code class="literal">TestSuite</code> runner of <code class="literal">unittest</code> to execute the bunch of tests together. We will now output the results of these tests in the JUnit report format. For this, we need a Python library <a id="id669" class="indexterm"/>called <code class="literal">xmlrunner</code> from <a class="ulink" href="https://pypi.python.org/pypi/xmlrunner/1.7.4">https://pypi.python.org/pypi/xmlrunner/1.7.4</a>.</p><p>Download and install <code class="literal">xmlrunner</code> with the following command line:</p><div><pre class="programlisting">
<strong>pip install xmlrunner</strong>
</pre></div><p>We will use <code class="literal">smoketests.py</code>, which uses the <code class="literal">TestSuite</code> runner to run the tests from <code class="literal">homepagetests.py</code> and <code class="literal">searchtest.py</code>. We will use the <code class="literal">xmlrunner.XML TestRunner</code> to run these tests and generate a test report in JUnit format. This report will be generated in XML format and kept in the <code class="literal">test-reports</code> subfolder. To use <code class="literal">xmlrunner</code>, please make the highlighted changes in <code class="literal">smoketest.py</code>, as shown in the following code example:</p><div><pre class="programlisting">import unittest
<strong>from xmlrunner import xmlrunner</strong>
from searchtest import SearchProductTest
from homepagetests import HomePageTest

# get all tests from SearchProductTest and HomePageTest class
search_tests = unittest.TestLoader().loadTestsFromTestCase(SearchProductTest)
home_page_tests = unittest.TestLoader().loadTestsFromTestCase(HomePageTest)

# create a test suite combining search_test and home_page_test
smoke_tests = unittest.TestSuite([home_page_tests, search_tests])

# run the suite
<strong>xmlrunner.XMLTestRunner(verbosity=2, output='test-reports').run(smoke_tests)</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec64"/>Setting up Jenkins</h2></div></div></div><p>Setting up Jenkins is <a id="id670" class="indexterm"/>fairly straightforward. You can download and install Jenkins using the installers available for various platforms. In following example, we will set up Jenkins and create a new build job to run the smoke tests on the sample application:</p><div><ol class="orderedlist arabic"><li class="listitem">Download <a id="id671" class="indexterm"/>and install the Jenkins CI server from <a class="ulink" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a>. For this recipe, the Jenkins Windows installer is used to set up Jenkins on a Windows 7 machine.</li><li class="listitem">Navigate to <strong>Jenkins Dashboard</strong> (<code class="literal">http://localhost:8080</code> by default) in the browser window.</li><li class="listitem">On <strong>Jenkins Dashboard</strong>, click on <strong>New Item</strong> or <strong>create new jobs</strong> link to create a new Jenkins job as shown in the following screenshot:<div><img src="img/3506OS_10_03.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">Enter <code class="literal">Demo_App_Smoke_Test</code> in the <strong>Item name</strong> textbox and select the <strong>Build a free-style software project</strong> <a id="id672" class="indexterm"/>radio button as shown in the following screenshot:<div><img src="img/3506OS_10_04.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">Click on the <strong>OK</strong> button. A new job will be created with the specified name.<div><div><h3 class="title"><a id="note21"/>Note</h3><p>We can connect to various version control or <strong>Source Control Management</strong> (<strong>SCM</strong>) tools such as SVN, GIT, Perforce, and so on to store the source <a id="id673" class="indexterm"/>and test code. We can then get the latest version of the code to build and test the software in the Jenkins workspace as part of building the steps. However, to keep things simple, in this example, we will copy the test scripts from a folder to the Jenkins workspace using the <strong>Execute Windows batch command</strong> build step as described in following set of steps.</p></div></div></li><li class="listitem">In the <strong>Build</strong> section, click <a id="id674" class="indexterm"/>on <strong>Add build step</strong> and select the <strong>Execute Windows batch command</strong> option from the dropdown.<div><img src="img/3506OS_10_05.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">Enter the following command in the <strong>Command</strong> textbox as shown in the following screenshot. Paths will be different in your case. This command will copy the Python <a id="id675" class="indexterm"/>files containing smoke tests to the Jenkins workspace and run <code class="literal">smoketest.py</code> as shown:<div><pre class="programlisting">
<strong>copy c:\setests\chapter10\smoketests\*.py</strong>
<strong>python smoketest.py</strong>
</pre></div><div><img src="img/3506OS_10_06.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">We configured <code class="literal">smoketest.py</code> to generate test results in JUnit format so that Jenkins can display the <a id="id676" class="indexterm"/>test results on its dashboard. To integrate these reports with Jenkins, click on <strong>Add post-build action</strong> and select the <strong>Publish JUnit test result report</strong> option from the dropdown as shown in the following screenshot:<div><img src="img/3506OS_10_07.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">In the <strong>Post-build Actions</strong> section, add <code class="literal">test-reports/*.xml</code> in the <strong>Test report XMLs</strong> textbox as shown in the following screenshot. Every time Jenkins runs the tests, it will read test results from the <code class="literal">test-report</code> subfolder.<div><img src="img/3506OS_10_08.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">To schedule tests for automatic execution in the <strong>Build Triggers</strong> section, select <strong>Build periodically</strong> and enter the data as shown in the following screenshot in the <strong>Schedule</strong> textbox<a id="id677" class="indexterm"/>. This will trigger the build process every day at 10 p.m. and Jenkins will run the tests as part of the build process unattended so you can see the results next morning when you arrive at the office.<div><img src="img/3506OS_10_09.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">Click on the <strong>Save</strong> button to save the job configuration. Jenkins will display the project page for the newly created job.</li><li class="listitem">We can check if everything is set to see if tests are executed. Click on the <strong>Build Now</strong> link to run the job manually as shown in the following screenshot:<div><img src="img/3506OS_10_10.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">You can see the <a id="id678" class="indexterm"/>running status for the build in the <strong>Build History</strong> section as shown in the following screenshot:<div><img src="img/3506OS_10_11.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem"> Click on the running item in the <strong>Build History</strong> section, which will open the following page:<div><img src="img/3506OS_10_12.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">Apart from the status on Jenkins and the progress bar, we can also see what's happening behind the <a id="id679" class="indexterm"/>scenes by opening the <strong>Console Output</strong> link. This will open the <strong>Console Output</strong> page with the command-line output as shown in the following screenshot:<div><img src="img/3506OS_10_13.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">Once the build process is completed by Jenkins, we can see a build page similar to the one shown in the next screenshot.</li><li class="listitem">Jenkins displays test results and various other metrics by reading the result files generated by the <code class="literal">unittest</code> frameworks. Jenkins also archives test results. To view the test results, click on the <strong>Test Results</strong> link on the build page.</li><li class="listitem">We configured our tests to generate the test results in the JUnit format and when we click on <strong>Test </strong><a id="id680" class="indexterm"/><strong>Results</strong>, Jenkins will display the JUnit test results as shown in the following screenshot. It highlights the tests that are failed and a summary for the tests.<div><img src="img/3506OS_10_14.jpg" alt="Setting up Jenkins"/></div></li><li class="listitem">We can drill down by clicking on the package names and see the results for individual tests as shown in the following screenshot:<div><img src="img/3506OS_10_15.jpg" alt="Setting up Jenkins"/></div></li></ol></div><p>Jenkins also shows a status on the <a id="id681" class="indexterm"/>Dashboard for the job with the status of the last build in the following format:</p><div><img src="img/3506OS_10_16.jpg" alt="Setting up Jenkins"/></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec57"/>Summary</h1></div></div></div><p>In this chapter, you learned how to integrate Selenium with Behave for BDD and Jenkins for CI. You saw how to integrate Selenium WebDriver API with Behave to run automated acceptance tests by writing features and step definition files.</p><p>You set up Jenkins to run Selenium WebDriver tests so that you can run these tests while building the software or scheduling tests so they can be run nightly. Jenkins provides an easy-to-set-up model to run the build and test jobs for various application development platforms and environments.</p><p>This completes your learning journey using Selenium WebDriver with Python. You learned some basic lessons on using Selenium WebDriver to automate browser interaction to create automated tests for web applications. You can use this knowledge and build your own testing framework.</p></div></div>
</body></html>