<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 6. Working with Pictures"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Working with Pictures</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Picture formats in native Python</li><li class="listitem" style="list-style-type: disc">Opening an image and discovering its attributes</li><li class="listitem" style="list-style-type: disc">The Python image Library format conversions:<code class="literal"> .jpg, .png, .tiff, .gif</code>, and,<code class="literal"> .bmp</code></li><li class="listitem" style="list-style-type: disc">Image rotation in the plane</li><li class="listitem" style="list-style-type: disc">Re-sizing images</li><li class="listitem" style="list-style-type: disc">Re-sizing with correct aspect ratio</li><li class="listitem" style="list-style-type: disc">Rotating images</li><li class="listitem" style="list-style-type: disc">Separating color bands</li><li class="listitem" style="list-style-type: disc">Red, green, and blue color re-mixing</li><li class="listitem" style="list-style-type: disc">Combining images by blending</li><li class="listitem" style="list-style-type: disc">Blending images by varying percentages</li><li class="listitem" style="list-style-type: disc">Making composites with image masks</li><li class="listitem" style="list-style-type: disc">Offset (roll) an image horizontally and vertically</li><li class="listitem" style="list-style-type: disc">Geometric transformations: horizontal and vertical flipping and rotation</li><li class="listitem" style="list-style-type: disc">Filters: sharpen, blur, edge enhance, emboss, smooth, contour, and detail</li><li class="listitem" style="list-style-type: disc">Apparent rotation by re-sizing</li></ul></div><p>Now we will work with raster images. These are things like photographs, bitmap images, and digital paintings all the image types that are NOT the vector graphic drawings we have been using until now. Raster images are made up of pixels, which is short for picture elements. Vector images are defined and processed as mathematical shape and color expressions that can be altered by algebra and arithmetic directly under your control. These vector graphics are only one part of the computer graphics world.<a id="id132" class="indexterm"/>
</p><p>The other part is concerned with the representation and manipulation of photographic images and painted bitmap images, generally referred to as raster images. The only raster image type that Python recognizes are<span class="strong"><strong> GIF</strong></span> (<span class="strong"><strong>Graphics Interchange Format</strong></span>) images which have a limited range of color capability<code class="literal"> GIF</code> can work with 256 different colors as opposed to 16.7 million with<code class="literal"> .png</code> or<code class="literal"> .jpg</code>. The advantage is that<code class="literal"> GIF</code> image control in Python allows you to animate them, but basic Tkinter provides no library of functions that can manipulate and alter raster images.<a id="id133" class="indexterm"/>
</p><p>However, there is a very useful bundle of Python modules, the<span class="strong"><strong> Python Imaging Library</strong></span> (<span class="strong"><strong>PIL</strong></span>), which is designed just for raster image manipulation. It has most of the basic functions that good photo editing tools have. Modules in the PIL easily convert from one format to another including<code class="literal"> GIF, PNG, TIFF, JPEG, BMP</code>. and<code class="literal"> PIL</code> will work with many others, but the ones mentioned previously are probably the most common ones. The Python Image Library is an important part of your general graphics tool kit and skills repertoire.<a id="id134" class="indexterm"/>
</p><p>To reduce confusion, we shall use the file extension abbreviations, like<code class="literal"> .gif, .png, .jpg</code> and so on as the name of file formats like<code class="literal"> GIF, PNG</code>, and<code class="literal"> JPEG</code>.</p><div class="section" title="Opening an image file and discovering its attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec01"/>Opening an image file and discovering its attributes</h1></div></div></div><p>First we need to test if the PIL is loaded into the library where the rest of our Python modules are. The simplest way to test this is to try and open a file using the<code class="literal"> image_open()</code> function of the<span class="strong"><strong> Image</strong></span> module.<a id="id135" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec01"/>Getting ready</h2></div></div></div><p>If the Python Imaging Library (PIL) is not already installed on our file system, and is ready and accessible to Python, we will need to find and install it. Tkinter is not needed for raster image processing. You will note that there are no from Tkinter import * and no root = tK() or root.mainloop() statements.</p><p>You can download PIL from<a class="ulink" href="http://www.pythonware.com/products/pil/"> http://www.pythonware.com/products/pil/</a>
<a id="id136" class="indexterm"/>
</p><p>This site contains source code, MS Windows installation executables, and handbooks in either HTML or<code class="literal"> PDF</code> formats.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note03"/>Note</h3><p>One of the best explanatory documents on PIL is a<code class="literal"> PDF</code> file at New Mexico Tech Computer Center <a class="ulink" href="http://%20infohost.nmt.edu/tcc/help/pubs/pil.pdf">http:// infohost.nmt.edu/tcc/help/pubs/pil.pdf</a>. It is clear and concise.</p></div><p>In all the examples that follow in this chapter, all images that get saved to our hard drive are placed into a folder called<code class="literal"> picsx</code> inside the folder<code class="literal"> constr</code>. This is to keep the results separate from the<code class="literal"> pics1</code> folder which contains all the input images that will be used. This saves us from the dilemma of deciding what to keep and what to throw away. You should keep everything in<code class="literal"> pics1</code> and can discard anything in<code class="literal"> picsx</code> as it should be simple to re-run the programs that created those files.<a id="id137" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec02"/>How to do it...</h2></div></div></div><p>Copy the following code into an editor and save it as<code class="literal"> image_getattributes_1.py</code> and then execute as with all previous programs. In this program, we are going to use the PIL to discover the attributes of a<code class="literal"> JPG</code> format image. Remember that although Python on its own only recognizes<code class="literal"> GIF</code> images, the PIL module can work with many image formats. Until we can get this tiny program to work we can go no further using PIL.<a id="id138" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"># image_getattributes_1.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
imageFile = "/constr/pics1/canary_a.jpg"
im_1 = Image.open(imageFile)
im_width = im_1.size[0]
im_height = im_1.size[1]
im_mode = im_1.mode
im_format = im_1.format
print "Size: ",im_width, im_height
print "Mode: ",im_mode
print "Format: ",im_format
im_1.show()
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec03"/>How it works...</h2></div></div></div><p>The<span class="strong"><strong> Image</strong></span> module, which is part of the PIL library, has a method<code class="literal"> Image_open()</code> which opens files that are recognizable as image files. It does not display the images. This may be confusing. Opening a file means that our application program has found where the file is located and has dealt with all the permissions and administration required for loading the file. When you open a file, the file header is read to determine the file format and extract things like mode, size, and, other properties required to decode the file, but the rest of the file is not processed until later. Mode is a term used to refer to the way the data bytes containing the image are to be interpreted whether a particular byte refers to the red channel or the transparency channel and so on. Only when the<span class="strong"><strong> Image</strong></span> module gets commands to view the file, change its size, view one of the color channels, rotate it, or any of the dozens of things that the modules in PIL can do to image files, will it actually be loaded from the hard drive and into memory.<a id="id139" class="indexterm"/>
</p><p>If we want to view the image, then we use the<code class="literal"> im_1. show()</code> method. Just add the line<code class="literal"> im.show()</code> at the end.</p><p>Why do we need to get image attributes? When we are going to change and manipulate images, we need to make changes to the attributes and therefore we often need to be able to find out what they are originally.<a id="id140" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec04"/>There's more...</h2></div></div></div><p>The<span class="strong"><strong> Image</strong></span> module of PIL (the Python Imaging Library) can read and write (open and save) the common image formats. The following formats can be both read and written:<code class="literal"> BMP, GIF, IM, JPG, JPEG, JPE, PCX, PNG, PBM, PPN, TIF, TIFF, XBM, XPM</code>.<a id="id141" class="indexterm"/>
</p><p>The following file formats can only be read:<code class="literal"> PCD, DCX, PSD</code>. If we needed to store image files which were<code class="literal"> PCD, DCX</code>, or<code class="literal"> PSD</code>, then we would first convert them into one of the file formats that did work like<code class="literal"> PNG, TIFF, JPEG</code>, or<code class="literal"> BMP</code>. Python on its own, without the PIL module, only deals with<code class="literal"> GIF</code> files so these would be preferred file formats for self-contained applications.<code class="literal"> JPG</code> files are ubiquitous and therefore we need to prove that the code we write can use<code class="literal"> JPG, GIF, PNG</code>, and,<code class="literal"> BMP</code> formats.</p><div class="section" title="Things we need to know about image formats"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec01"/>Things we need to know about image formats</h3></div></div></div><p>It is useful to know the following about file image formats:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">GIF</code> image files are the smallest and fastest to use and transport down a wire. They are probably the best balance of image quality and file size. On the downside, they have a limited range of colors and are not good for high quality pictures.<a id="id142" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">JPEG</code> images are the most common ones on the web. The quality can vary from high to low depending on what degree of compression you specify. A large image can be compressed substantially, but you will lose image quality.<a id="id143" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">TIFF</code> images are large and high quality/resolution. Detailed engineering drawings are often archived as<code class="literal"> TIFF</code> files.<a id="id144" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">PNG</code> images are a modern high quality replacement for<code class="literal"> GIF</code> files. But Tkinter will not recognize them.<a id="id145" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">BMP</code> images are uncompressed and a bit old fashioned but there are still many around. Not recommended.<a id="id146" class="indexterm"/><p>When working with images in PIL, PNG images are a convenient form to use. However, if you are preparing images for display inside Python programs on the widest variety of platforms, then you need to convert them into GIF format before saving them.
</p></li></ul></div></div><div class="section" title="Images and the numbers game"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec02"/>Images and the numbers game</h3></div></div></div><p>Image formats are like studying ancient languages the more you learn, the more complicated things get. But here are the basic numbers governing them that give you some insight.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">GIF</code> has a maximum of 256 colors, but can use a lot less.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PNG</code> has a maximum of about 14000, different colors.</li><li class="listitem" style="list-style-type: disc"><code class="literal">JPEG</code> can handle 16 million the same number of colors as the<code class="literal"> #rrggbb</code> numbers used in the previous chapter.<p>Most images from digital cameras are compressed into JPG images and this reduces the range of colors. Therefore, in most cases, we can convert them to PNG images without apparent loss of quality.
</p></li></ul></div></div></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Open, view, and save an image in a different file format"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec02"/>Open, view, and save an image in a different file format</h1></div></div></div><p>Quite often, there is some image we want to work with but it is in the wrong format. Most web images are<code class="literal"> JPEG</code> (<code class="literal">.jpg</code>) files. Native Python will only recognize<code class="literal"> GIF</code> (<code class="literal">.gif</code>) formats.<a id="id147" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec05"/>Getting ready</h2></div></div></div><p>Get hold of a<code class="literal"> .jpg</code> image file and save or copy it into a directory you have created for this imaging work. For the purpose of these exercises we are going to assume there is a directory named<code class="literal"> constr</code> (abbreviation for "construction site"). In the code, you will see images addressed in the form<code class="literal"> /constr/pics1/images-name.ext. image-name.ext</code> is the actual image you have selected to work with. This means that the Python program expects to find the file you are asking it to open, inside a system directory called<code class="literal"> constr</code>. You can change this to wherever you decide is the best place for you to make a mess in like an artist's studio. The path to retrieve your image file can even be a web address.</p><p>So for this example, there is an image named<code class="literal"> duzi_leo_1.jpg</code>, a<code class="literal"> JPEG</code> image stored inside a folder (directory) called<code class="literal"> pics1</code> which in turn is inside<code class="literal"> constr</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec06"/>How to do it...</h2></div></div></div><p>Execute the program shown as follows in the usual fashion.</p><div class="informalexample"><pre class="programlisting"># images_jpg2png_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/duzi_leo_1.jpg")
im_1.show()
im_1.save('/constr/picsx/duzi_leo_2.png', 'PNG')
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec07"/>How it works...</h2></div></div></div><p>In the typical Python fashion the designers of Python have made things as simple as they possibly could for the coder. What happens here is that we create an instance<code class="literal"> im_1</code> of an image object which is in<code class="literal"> JPEG</code> format (extension<code class="literal"> .jpg)</code> and we command that it be saved as<code class="literal"> PNG</code> (extension<code class="literal"> .png)</code>. The complex conversion takes place out of sight. We display the image to reassure ourselves that it has been found.<a id="id148" class="indexterm"/>
</p><p>Finally we convert it to<code class="literal"> PNG</code> format and save it as<code class="literal"> duzi_leo_2.png</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec08"/>There's more...</h2></div></div></div><p>We would like to know that we can convert any image format to any other format. Unfortunately image formats are something of a tower of Babel phenomenon. For reasons of history, technology evolution, patent restrictions, and proprietary commercial hegemony many image formats were not intended to be openly readable. For instance up until 2004,<code class="literal"> GIF</code> was proprietary.<code class="literal"> PNG</code> was developed as an alternative. The next example presents code for discovering which conversions will work on your platform.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Image format conversion for JPEG, PNG, TIFF, GIF, BMP"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec03"/>Image format conversion for JPEG, PNG, TIFF, GIF, BMP</h1></div></div></div><p>We start with a<code class="literal"> PNG</code> format image then save it in each of the following formats:<code class="literal"> JPG, PNG, GIF, TIFF</code>, and<code class="literal"> BMP</code> and save them on the local hard drive. Then we take the saved image formats and convert each in turn into the other formats. Thus we test all the likely conversion combinations.<a id="id149" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec09"/>Getting ready</h2></div></div></div><p>We need to place a<code class="literal"> JPG</code> image into the folder<code class="literal"> /constr/pics1</code>. A specific<code class="literal"> PNG</code> image design to emphasize flaws in the different formats is provided with the name<code class="literal"> test_pattern_a.png</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec10"/>How to do it...</h2></div></div></div><p>Execute the program shown as before. Read their describing 'metadata' on the command terminal<a id="id150" class="indexterm"/>
</p><div class="mediaobject"><img src="images/3845_06_01.jpg" height="205" alt="How to do it..."/></div><div class="informalexample"><pre class="programlisting"># images_one2another_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
# Convert a jpg image to OTHER formats
im_1 = Image.open("/constr/pics1/test_pattern_1.jpg")
im_1.save('/constr/picsx/test_pattern_2.png', 'PNG')
im_1.save('/constr/picsx/test_pattern_3.gif', 'GIF')
im_1.save('/constr/picsx/test_pattern_4.tif', 'TIFF')
im_1.save('/constr/picsx/test_pattern_5.bmp', 'BMP')
# Convert a png image to OTHER formats
im_2 = Image.open("/constr/picsx/test_pattern_2.png")
im_2.save('/constr/picsx/test_pattern_6.jpg', 'JPEG')
im_2.save('/constr/picsx/test_pattern_7.gif', 'GIF')
im_2.save('/constr/picsx/test_pattern_8.tif', 'TIFF')
im_2.save('/constr/picsx/test_pattern_9.bmp', 'BMP')
# Convert a gif image to OTHER formats
# It seems that gif-&gt;jpg does not work
im_3 = Image.open("/constr/pics1/test_pattern_3.gif")
#im_3.save('/constr/pics1/test_pattern_10.jpg', 'JPEG')
# "IOError "cannot write mode P as JPEG"
im_3.save('/constr/picsx/test_pattern_11.png', 'PNG')
im_3.save('/constr/picsx/test_pattern_12.tif', 'TIFF')
im_3.save('/constr/picsx/test_pattern_13.bmp', 'BMP')
# Convert a tif image to OTHER formats
im_4 = Image.open("/constr/picsx/test_pattern_4.tif")
im_4.save('/constr/picsx/test_pattern_14.png', 'PNG')
im_4.save('/constr/picsx/test_pattern_15.gif', 'GIF')
im_4.save('/constr/picsx/test_pattern_16.tif', 'TIFF')
im_4.save('/constr/picsx/test_pattern_17.bmp', 'BMP')
# Convert a bmp image to OTHER formats
im_5 = Image.open("/constr/picsx/test_pattern_5.bmp")
im_5.save('/constr/picsx/test_pattern_18.png', 'PNG')
im_5.save('/constr/picsx/test_pattern_19.gif', 'GIF')
im_5.save('/constr/picsx/test_pattern_20.tif', 'TIFF')
im_5.save('/constr/picsx/test_pattern_21.jpg', 'JPEG')
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec11"/>How it works...</h2></div></div></div><p>This conversion just works if PIL is installed. One exception is that conversions from<code class="literal"> GIF</code> to<code class="literal"> JPG</code> will not work. It is interesting to have the contents of the folder<code class="literal"> /constr/pics1</code> already open prior to executing the program and watch the images successively appear as the execution takes pace.<a id="id151" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec12"/>There's more...</h2></div></div></div><p>Note that it is difficult to notice loss of image quality for any of the image qualities except for<code class="literal"> GIF</code> images. The problems are most noticeable when the<code class="literal"> GIF</code> conversion algorithm has to make a choice between two similar colors as shown in the figure.</p><div class="section" title="Does size count?"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec03"/>Does size count?</h3></div></div></div><p>The original<code class="literal"> test_pattern_1.jpg</code> was 77 kilobytes. All the images derived from it were four to ten times larger, even the low quality<code class="literal"> GIF</code> images. The reason is that only the<code class="literal"> JPG</code> and<code class="literal"> GIF</code> images are lossy, meaning that some image information is discarded in the conversion and it can't be recovered.</p></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Image rotation in the plane of the image"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec04"/>Image rotation in the plane of the image</h1></div></div></div><p>We have an image lying on its side and we need to fix it up by rotating it clockwise by 90 degrees. We want a stored copy of the corrected image.<a id="id152" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec13"/>Getting ready</h2></div></div></div><p>We need to place a<code class="literal"> PNG</code> image into the folder<code class="literal"> /constr/pics1</code>. In the following code, we have used the image<code class="literal"> dusi_leo.png</code>. This image has prominent red and yellow components.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec14"/>How to do it...</h2></div></div></div><p>Execute the program shown as before.</p><div class="informalexample"><pre class="programlisting"># image_rotate_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/dusi_leo.png")
im_2= im_1.rotate(-90)
im_2.show()
im_2.save("/constr/picsx/dusi_leo_rightway.png")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec15"/>How it works...</h2></div></div></div><p>The displayed image will be correctly oriented. Note that we can rotate the image by amounts as small as one degree, but no smaller than that. There are other transformations that can rotate an image to integer multiples of 90 degrees. These are demonstrated under the title Multiple Transformations.<a id="id153" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec16"/>There's more...</h2></div></div></div><p>How would we create the effect of a smoothly rotating image? Attempting it with PIL on its own does not work. PIL is designed to do the calculation intensive operations for manipulating and transforming images. It is not possible to display one image after another in a time-controlled sequence. For this, you would need Tkinter and Tkinter will only work with<code class="literal"> GIF</code> images.</p><p>What we would do would be to first create a series of images, each slightly more rotated than the previous one and store each image. Later, we would run a Python Tkinter program that displayed the series of images in a time-controlled sequence. This would animate the rotation. There are difficulties related to the fact that the rotated images must be placed in a frame that has the same size and orientation as the original image. These kinds of problems are tackled in the next chapter. Some surprisingly effective results can be achieved.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Image size alteration"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec05"/>Image size alteration</h1></div></div></div><p>We reduce the size of a large image file (1.8 megabytes) down to 24.7 kilobytes. But the image gets distorted because the height-to-width ratio is not taken into account.<a id="id154" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec17"/>Getting ready</h2></div></div></div><p>As we did for the previous recipe, we need to place the<code class="literal"> dusi_leo.png</code> image into the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec18"/>How to do it...</h2></div></div></div><p>To change the size of an image we need to specify the final dimensions as well as specify a filter type that provides rules for filling in any pixel gaps that result from the re-sizing process. Execute the program shown as before. The following image shows the result.</p><div class="mediaobject"><img src="images/3845_06_02.jpg" height="326" alt="How to do it..."/></div><div class="informalexample"><pre class="programlisting"># image_resize_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/dusi_leo_1.jpg")
# adjust width and height to desired size
width = 300
height = 300
# NEAREST Filter is compulsory to resize the image
im_2 = im_1.resize((width, height), Image.NEAREST)
im_2.save("/constr/picsx/dusi_leo_2.jpg")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec19"/>How it works...</h2></div></div></div><p>Here we changed the size of a picture to fit a 300x300 pixel rectangle. If the image is increased in size, extra pixels need to be added. If the image is reduced, then pixels have to be discarded. Which particular pixels are added, what color they will be has to be decided automatically by an algorithm in the re-sizing method. There are several ways provided in PIL to do this. These pixel-adding algorithms are made available as<span class="strong"><strong> filters</strong></span>.<a id="id155" class="indexterm"/>
</p><p>This is what filters are designed for and in the preceding example we have chosen to use the nearest filter. This is documented as using the value of the NEAREST neighboring pixel. The documentation is a bit ambiguous because it does not explain which nearest pixel will be selected. In a rectangular grid, the pixels to the north, south, east, and west are equally close. Other possible filters to use are BILINEAR (linear interpolation in a 2x2 environment), BICUBIC (cubic spline interpolation in a 4x4 environment), or ANTIALIAS (a high-quality down-sampling filter).<a id="id156" class="indexterm"/>
</p><p>Reducing images also presents dilemmas. Picture elements (pixels) need to be discarded. What happens if there is a sharp edge in the image going from black to white? Do we throw away the last black pixel and replace it with a white one? Or replace it with one that is somewhere in between?</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec20"/>There's more...</h2></div></div></div><p>The issue of which filters are best will vary from one type of image to another. Experience and experimentation are needed in this changing branch of image processing.</p><div class="section" title="How do we preserve the correct height-to-width ratio of an image?"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec04"/>How do we preserve the correct height-to-width ratio of an image?</h3></div></div></div><p>As shown in this example, unless we take steps to select the right target image size proportions, that photo of skinny aunt Milly will end up as wide Winifred and some members of the family will never be on good terms anymore if the pictures get shown around. Therefore, we demonstrate how to preserve proportion and decorum in the next recipe.</p></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Correct proportion image resizing"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec06"/>Correct proportion image resizing</h1></div></div></div><p>We make a reduced size image taking precautions to preserve the correct height-to-width, aspect ratio of the original image. The secret is to use the<code class="literal"> Image.size()</code> function to get the exact image size beforehand and then make sure we maintain the same height-to-width ratio.<a id="id157" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec21"/>Getting ready</h2></div></div></div><p>As we did for the previous recipe, we need to place the<code class="literal"> dusi_leo.png</code> image into the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec22"/>How to do it...</h2></div></div></div><p>Execute the program shown as before.</p><div class="informalexample"><pre class="programlisting"># image_preserved_aspect_resize_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/dusi_leo_1.jpg")
im_width = im_1.size[0]
im_height = im_1.size[1]
print im_width, im_height
new_size = 0.2 # New image to be reduced to one fifth of original.
# adjust width and height to desired size
width = int(im_width * new_size)
height = int(im_height * new_size)
# Filter is compulsory to resize the image
im_2 = im_1.resize((width, height), Image.NEAREST)
im_2.save("/constr/picsx/dusi_leo_3.jpg")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec23"/>How it works...</h2></div></div></div><p>The<code class="literal"> Image.size()</code> function returns two integers, - the width, size[0], and height, size[1] of the opened image. We use the scaling multiplier<code class="literal"> new_size</code> to scale both the width and the height by the same proportion.<a id="id158" class="indexterm"/>
</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Separating one color band in an image"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec07"/>Separating one color band in an image</h1></div></div></div><p>We isolate just the green portion or band of an image.<a id="id159" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec24"/>Getting ready</h2></div></div></div><p>As we did for the previous recipe, we need to place the<code class="literal"> dusi_leo.png</code> image into the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec25"/>How to do it...</h2></div></div></div><p>Execute the program shown as before.</p><div class="informalexample"><pre class="programlisting">#image_get_green_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import ImageEnhance
import Image
red_frac = 1.0
green_frac = 1.0
blue_frac = 1.0
im_1 = Image.open("/a_constr/pics1/dusi_leo_1.jpg")
# split the image into individual bands
source = im_1.split()
R, G, B = 0, 1, 2
# Assign color intensity bands, zero for red and blue.
red_band = source[R].point(lambda i: i * 0.0)
green_band = source[G]
blue_band = source[B].point(lambda i: i * 0.0)
new_source = [red_band, green_band, blue_band]
# Merge (add) the three color bands
im_2 = Image.merge(im_1.mode, new_source)
im_2.show()
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec26"/>How it works...</h2></div></div></div><p>The<code class="literal"> Image.split()</code> function separates the three color bands of red, green, and blue in the original<code class="literal"> JPG</code> image. The red band is<code class="literal"> source[0]</code>, the green band is<code class="literal"> source[1]</code>, and the blue band is<code class="literal"> [2]. JPG</code> images do not have a transparency (alpha) band.<code class="literal"> PNG</code> images can have an alpha band. If such a<code class="literal"> PNG</code> image is<code class="literal"> split()</code>, its transparency band would have been<code class="literal"> source[3]</code>. The amount of color of a specific pixel in the image is recorded as a byte of data. You can alter this amount by a similar proportion for each pixel in the split band in the line<code class="literal"> red_band = source[R].point(lambda i: i * proportion)</code>, where proportion is a number between<code class="literal"> 0.0</code> and<code class="literal"> 1.0</code>.<a id="id160" class="indexterm"/>
</p><p>In this recipe, we eliminate all red and blue by using the value<code class="literal"> 0.0</code> for the proportion amount.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec27"/>There's more...</h2></div></div></div><p>In the next recipe, we mix the three colors in non-zero proportions.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Red, green, and blue color alteration in images"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec08"/>Red, green, and blue color alteration in images</h1></div></div></div><p>We go further in this example to make an image that re-mixes the colors of the original in different proportions. The same code layout is used as in the previous example.<a id="id161" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec28"/>Getting ready</h2></div></div></div><p>As before place the<code class="literal"> dusi_leo.png</code> image into the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec29"/>How to do it...</h2></div></div></div><p>Execute the following code.</p><div class="informalexample"><pre class="programlisting">#image_color_manip_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import ImageEnhance, Image
im_1 = Image.open("/constr/pics1/dusi_leo_smlr_1.jpg")
# Split the image into individual bands
source = im_1.split()
R, G, B = 0, 1, 2
# Select regions where red is less than 100
red_band = source[R]
green_band = source[G]
blue_band = source[B]
# Process the red band: intensify red x 2
out_red = source[R].point(lambda i: i * 2.0)
# Process the green band: weaken by 20%
out_green = source[G].point(lambda i: i * 0.8)
# process the blue band: Eliminate all blue
out_blue = source[B].point(lambda i: i * 0.0)
# Make a new source of color band values
new_source = [out_red, out_green, out_blue]
# Add the three altered bands back together
im_2 = Image.merge(im_1.mode, new_source)
im_2.show()
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec30"/>How it works...</h2></div></div></div><p>As before, the<code class="literal"> Image.split()</code> function separates the three color bands of red, green, and blue from the original<code class="literal"> JPG</code> image. In this case, the amounts of each red, green, and blue are 200%, 20%, and 0% of blue respectively.<a id="id162" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec31"/>There's more...</h2></div></div></div><p>Altering the proportion of colors in existing pictures is a complex and subtle art and as we did in the previous chapters, in the next example we provide a recipe that uses slide controls to allow the user to use trial and error to achieve a desirable color mix on a band-separated image.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Slider controlled color manipulation"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec09"/>Slider controlled color manipulation</h1></div></div></div><p>We construct a tool for the purpose of obtaining a desirable color mix on a band-separated image. The slide control, which we have used previously, is a convenient device for consciously adjusting the relative proportions of color in each primary color band.<a id="id163" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec32"/>Getting ready</h2></div></div></div><p>Use the<code class="literal"> dusi_leo.png</code> image from the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec33"/>How to do it...</h2></div></div></div><p>Execute the following program.</p><div class="informalexample"><pre class="programlisting">#image_color_adjuster_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import ImageEnhance
import Image
import Tkinter
root =Tkinter.Tk()
root.title("Photo Image Color Adjuster")
red_frac = 1.0
green_frac = 1.0
blue_frac = 1.0
slide_value_red = Tkinter.IntVar()
slide_value_green = Tkinter.IntVar()
slide_value_blue = Tkinter.IntVar()
im_1 = Image.open("/constr/pics1/dusi_leo_smlr_1.jpg")
im_1.show()
source = im_1.split() # split the image into individual bands
R, G, B = 0, 1, 2
# Assign color intensity bands
red_band = source[R]
green_band = source[G]
blue_band = source[B]
#===============================================
# Slider and Button event service functions (callbacks)
def callback_button_1():
toolconstructing, for desirable color mix# Adjust red intensity by slider value.
out_red = source[R].point(lambda i: i * red_frac)
out_green = source[G].point(lambda i: i * green_frac) # Adjust # green
out_blue = source[B].point(lambda i: i * blue_frac) # Adjust # blue
new_source = [out_red, out_green, out_blue]
im_2 = Image.merge(im_1.mode, new_source) # Re-combine bands
im_2.show()
button_1= Tkinter.Button(root,bg= "sky blue", text= "Display adjusted image \
(delete previous one)", command=callback_ \button_1)
button_1.grid(row=1, column=2, columnspan=3)
def callback_red(*args):
global red_frac
red_frac = slide_value_red.get()/100.0
def callback_green(*args):
global green_frac
green_frac = slide_value_green.get()/100.0
def callback_blue(*args):
global blue_frac
blue_frac = slide_value_blue.get()/100.0
slide_value_red.trace_variable("w", callback_red)
slide_value_green.trace_variable("w", callback_green)
slide_value_blue.trace_variable("w", callback_blue)
slider_red = Tkinter.Scale(root,
length = 400,
fg = 'red',
activebackground = "tomato",
background = "grey",
troughcolor = "red",
label = "RED",
from_ = 0,
to = 200,
resolution = 1,
variable = slide_value_red,
orient = 'vertical')
slider_red.grid(row=0, column=2)
slider_green = Tkinter.Scale(root,
length = 400,
fg = 'dark green',
activebackground = "green yellow",
background = "grey",
troughcolor = "green",
label = "GREEN",
from_ = 0,
to = 200,
toolconstructing, for desirable color mixresolution = 1,
variable = slide_value_green,
orient = 'vertical')
slider_green.grid(row=0, column=3)
slider_blue = Tkinter.Scale(root,
length = 400,
fg = 'blue',
activebackground = "turquoise",
background = "grey",
troughcolor = "blue",
label = "BLUE",
from_ = 0,
to = 200,
resolution = 1,
variable = slide_value_blue,
orient = 'vertical')
slider_blue.grid(row=0, column=4)
root.mainloop()
#===============================================
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec34"/>How it works...</h2></div></div></div><p>Using mouse-controlled slider positions, we adjust the amount of color intensity in each of the red, green, and blue channels. The scale of adjustment goes from zero to 200, but is scaled to a percentage value in the callback functions.<a id="id166" class="indexterm"/>
</p><p>In<code class="literal"> source = im_1.split()</code>, the<code class="literal"> split()</code> method separates the image into red, green, and blue bands. The<code class="literal"> point(lambda i: i * intensity)</code> method multiplies the color value for each pixel in a band by an 'intensity' value and the<code class="literal"> merge(im_1.mode, new_source)</code> method re-combines the resultant bands into a new image.</p><p>In this example PIL and Tkinter are being used together.</p><p>If you use<code class="literal"> from Tkinter import *</code>, you seem to get namespace confusion:</p><p>The interpreter says:</p><p>
<code class="literal">" im_1 = Image.open("/a_constr/pics1/redcar.jpg")</code>
</p><p>
<code class="literal">AttributeError: class Image has no attribute 'open' "</code>,</p><p>but if you just say<code class="literal"> import Tkinter</code> it seems ok.</p><p>But of course now you have to prefix all Tkinter methods with Tkinter.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Combining images by blending"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec10"/>Combining images by blending</h1></div></div></div><p>The effect of blending two images is like projecting two transparent slide images onto a projector screen from two separate projectors where the amount of light from each projector is controlled by proportion setting. The command is of the form<code class="literal"> Image.blend(image_1, image_2, proportion-of-image_1)</code>.<a id="id167" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec35"/>Getting ready</h2></div></div></div><p>Use the two images<code class="literal"> 100_canary.png</code> and<code class="literal"> 100_cockcrow.png</code> from the folder<code class="literal"> /constr/pics1</code>. The<code class="literal"> 100_</code> in the titles is a reminder that the images are 100 x 100 pixels in size and we will see the format, size, and type of each image printed onto the console.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec36"/>How to do it...</h2></div></div></div><p>With the two identical size and mode images in place, execute the following code.</p><div class="informalexample"><pre class="programlisting"># image_blend_1.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/100_canary.png") # mode is RGBA
im_2 = Image.open("/constr/pics1/100_cockcrow.png") # mode is RGB
# Check on mode, size and format first for compatibility.
print "im_1 format:", im_1.format, ";size:", im_1.size, "; mode:",im_1.mode
print "im_2 format:", im_2.format, ";size:", im_2.size, "; mode:",im_2.mode
im_2 = im_2.convert("RGBA") # Make both modes the same
im_4 = Image.blend(im_1, im_2, 0.5)
im_4.show()
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec37"/>There's more...</h2></div></div></div><p>From format information, we will see that the mode of the first image is<code class="literal"> RGBA</code> while the second is<code class="literal"> RGB</code>. Therefore, it is necessary to first convert the second image to<code class="literal"> RGBA</code>.<a id="id168" class="indexterm"/>
</p><p>In this particular example, the proportion control was set to<code class="literal"> 0.5</code>. That is, the two images were blended together by equal amounts. If the proportion setting had been<code class="literal"> 0.2</code>, then<code class="literal"> 20%</code> of<code class="literal"> im_1</code> would have been combined with<code class="literal"> 80%</code> of<code class="literal"> im_2</code>.</p><div class="section" title="More Info Section 1"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec05"/>More Info Section 1</h3></div></div></div><p>Another way of combining images would be to use a third image as a mask to control the positions where the mask determines both the shape and the proportion of each image in the resulting image.</p></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Blending images by varying percentages"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec11"/>Blending images by varying percentages</h1></div></div></div><p>We blend two images with various amounts of transparency.<a id="id169" class="indexterm"/>
</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec38"/>How to do it...</h2></div></div></div><p>With the two identical size and mode images in place, execute the following code.</p><div class="informalexample"><pre class="programlisting"># image_blend_2.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/lion_ramp_2.png")
im_2 = Image.open("/constr/pics1/fiery_2.png")
# Various degrees of alpha
im_3 = Image.blend(im_1, im_2, 0.05) # 95% im_1, 5% im_2
im_4 = Image.blend(im_1, im_2, 0.2)
im_5 = Image.blend(im_1, im_2, 0.5)
im_6 = Image.blend(im_1, im_2, 0.6)
im_7 = Image.blend(im_1, im_2, 0.8)
im_8 = Image.blend(im_1, im_2, 0.95) # 5% im_1, 95% im_2
im_3.save("/constr/picsx/fiery_lion_1.png")
im_4.save("/constr/picsx/fiery_lion_2.png")
im_5.save("/constr/picsx/fiery_lion_3.png")
im_6.save("/constr/picsx/fiery_lion_4.png")
im_7.save("/constr/picsx/fiery_lion_5.png")
im_8.save("/constr/picsx/fiery_lion_6.png")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec39"/>How it works...</h2></div></div></div><p>By changing the amount of alpha with which the images are blended, we can control the degree to which each image dominates in the result.<a id="id170" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec40"/>There's more...</h2></div></div></div><p>This kind of process performed on each frame of a movie is the kind of effect often used to fade from one scene to another.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Make a composite image using a mask image"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec12"/>Make a composite image using a mask image</h1></div></div></div><p>Here, we control the combination of two images using the function<code class="literal"> Image.composite(image_1, image_2, mask_image)</code>.<a id="id171" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec41"/>Getting ready</h2></div></div></div><p>Use the images<code class="literal"> 100_canary.png, 100_cockcrow.png</code>, and<code class="literal"> 100_sun_1.png</code> from the folder<code class="literal"> /constr/pics1</code>. The<code class="literal"> 100_</code> in the titles is a reminder that the images are 100 x 100 pixels in size and we will see the format, size, and type of each image printed onto the console.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec42"/>How to do it...</h2></div></div></div><p>With the three identical size and mode images in place, execute the following code.</p><div class="informalexample"><pre class="programlisting"># image_composite_1.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/constr/pics1/100_canary.png") # mode is RGBA
im_2 = Image.open("/constr/pics1/100_cockcrow.png") # mode is RGB
im_3 = Image.open("/constr/pics1/100_sun_1.png")
# Check on mode, size and format first for compatibility.
print "im_1 format:", im_1.format, ";size:", im_1.size, "; mode:", \im_1.mode
print "im_2 format:", im_2.format, ";size:", im_2.size, "; mode:", \im_2.mode
print "im_3 format:", im_3.format, ";size:", im_3.size, "; mode:", \im_3.mode
im_2 = im_2.convert("RGBA")
im_3 = im_3.convert("L")
im_4 = Image.composite(im_1, im_2, im_3)
im_4.show()
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec43"/>How it works...</h2></div></div></div><p>From format information, we will see that the mode of the first image is<code class="literal"> RGBA</code> while the second is<code class="literal"> RGB</code>. Therefore, it is necessary to first convert the second image to<code class="literal"> RGBA</code>.<a id="id172" class="indexterm"/>
</p><p>The mask image has to be of the form<code class="literal"> 1, L</code>, or<code class="literal"> RGBA</code> and of the same size. In this recipe, we have converted it to mode<code class="literal"> L</code> which is a 256 value gray-scale image. The value of each pixel in the mask is used to multiply the source images. If the value of a particular pixel in a certain location was<code class="literal"> 56</code>, then<code class="literal"> image_1</code> would be multiplied by<code class="literal"> 256 56 =200</code> and<code class="literal"> image_2</code> would be multiplied by<code class="literal"> 56</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec44"/>There's more...</h2></div></div></div><p>There are other effects like<code class="literal"> Image.eval(function, Image)</code> where each pixel is multiplied by the function and we can convert the function to some complicated algebraic expression. If the image has multiple bands, then the function is applied to each band.</p><p>Another effect is the<code class="literal"> Image.merge(mode, bandList)</code> which creates a multi-band image from multiple single-band images of equal size. We specify the desired mode of the new image. The<span class="strong"><strong> bandList specifier</strong></span> is a sequence of single-band image components to be combined.<a id="id173" class="indexterm"/>
</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec45"/>See also</h2></div></div></div><p>Using the image operations shown previously in combinations, there are an endless number of effects that can be achieved. We would be delving into the world of image and signal processing which can get extremely complex and sophisticated. Certain effects have become fairly standard and can be seen in the list of filtering options available in image-processing applications like<code class="literal"> GIMP</code> and<code class="literal"> Photoshop</code>.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Offset (roll) image horizontally and vertically"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec13"/>Offset (roll) image horizontally and vertically</h1></div></div></div><p>We see here how to roll an image. That is, to shift it to the right or left without losing anything - the image effectively rolls as if the edges were joined. The same process will work in the vertical direction.<a id="id174" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec46"/>Getting ready</h2></div></div></div><p>Use the image<code class="literal"> canary_a.jpg</code> from the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec47"/>How to do it...</h2></div></div></div><p>Execute the following program noting that we need to import a module belonging to PIL called<code class="literal"> ImageChops</code>. The<span class="strong"><strong> Chops</strong></span> stands for<span class="strong"><strong> channel operations</strong></span>.</p><div class="informalexample"><pre class="programlisting"># image_offset_1.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
import ImageChops
im_1 = Image.open("/constr/pics1/canary_a.jpg")
# adjust width and height to desired size
dx = 200
dy = 300
im_2 = ImageChops.offset(im_1, dx, dy)
im_2.save("/constr/picsx/canary_2.jpg")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec48"/>How it works...</h2></div></div></div><p>The excellent guide<span class="emphasis"><em> Python Imaging Library</em></span> by John Shipman written in mid 2009 does not mention ImageChops.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Flip horizontally, vertically, and rotate"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec14"/>Flip horizontally, vertically, and rotate</h1></div></div></div><p>Here we look at a set of quick and easy transformations that are typical of the operations we would need in a photo viewer.<a id="id175" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec49"/>Getting ready</h2></div></div></div><p>Use the<code class="literal"> image dusi_leo_1.jpg</code> from the folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec50"/>How to do it...</h2></div></div></div><p>Execute the following program and see the results in<code class="literal"> /constr/picsx</code>.</p><div class="informalexample"><pre class="programlisting"># image_flips_1.py
#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
im_1 = Image.open("/a_constr/pics1/dusi_leo_1.jpg")
im_out_1 = im_1.transpose(Image.FLIP_LEFT_RIGHT)
im_out_2 = im_1.transpose(Image.FLIP_TOP_BOTTOM)
im_out_3 = im_1.transpose(Image.ROTATE_90)
im_out_4 = im_1.transpose(Image.ROTATE_180)
im_out_5 = im_1.transpose(Image.ROTATE_270)
im_out_1.save("/a_constr/picsx/dusi_leo_horizontal.jpg")
im_out_1.save("/a_constr/picsx/dusi_leo_vertical.jpg")
im_out_1.save("/a_constr/picsx/dusi_leo_90.jpg")
im_out_1.save("/a_constr/picsx/dusi_leo_180.jpg")
im_out_1.save("/a_constr/picsx/duzi_leo_270.jpg")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec51"/>How it works...</h2></div></div></div><p>The preceding commands are self-explanatory.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Filter effects: blur, sharpen, contrast, and so on"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec15"/>Filter effects: blur, sharpen, contrast, and so on</h1></div></div></div><p>PIL has an<span class="strong"><strong> ImageFilter</strong></span> module that has a useful selection of filters for enhancing certain characteristics of images such as sharpening features that were blurred. Ten of these filters are demonstrated in the following recipe.<a id="id176" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec52"/>Getting ready</h2></div></div></div><p>Use the images<code class="literal"> russian_doll.png</code> from the folder<code class="literal"> /constr/pics1</code>. Create a folder<code class="literal"> /constr/picsx</code> for the resulting filtered images. Using a separate folder for the results helps prevent the folder<code class="literal"> pics1</code> from becoming overcrowded with a heap of redundant images and work-in-progress. After each execution, we can delete the contents of<code class="literal"> picsx</code> without the fear of losing source images for the recipes.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec53"/>How to do it...</h2></div></div></div><p>Open the folder<code class="literal"> /constr/picsx</code> on your screen before you execute the following code and watch as the images appear once the execution is complete. The source image was chosen to have a blurred Russian doll on an in-focus background because it allows the effects of the different filters to be readily distinguished.<a id="id177" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"># image_pileof_filters_1.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import ImageFilter
im_1 = Image.open("/constr/pics1/russian_doll.png")
im_2 = im_1.filter(ImageFilter.BLUR)
im_3 = im_1.filter(ImageFilter.CONTOUR)
im_4 = im_1.filter(ImageFilter.DETAIL)
im_5 = im_1.filter(ImageFilter.EDGE_ENHANCE)
im_6 = im_1.filter(ImageFilter.EDGE_ENHANCE_MORE)
im_7 = im_1.filter(ImageFilter.EMBOSS)
im_8 = im_1.filter(ImageFilter.FIND_EDGES)
im_9 = im_1.filter(ImageFilter.SMOOTH)
im_10 = im_1.filter(ImageFilter.SMOOTH_MORE)
im_11 = im_1.filter(ImageFilter.SHARPEN)
im_2.save("/constr/picsx/russian_doll_BLUR.png")
im_3.save("/constr/picsx/ russian_doll_CONTOUR.png")
im_4.save("/constr/picsx/ russian_doll_DETAIL.png")
im_5.save("/constr/picsx/ russian_doll_EDGE_ENHANCE.png")
im_6.save("/constr/picsx/ russian_doll_EDGE_ENHANCE_MORE.png")
im_7.save("/constr/picsx/ russian_doll_EMBOSS.png")
im_8.save("/constr/picsx/ russian_doll_FIND_EDGES.png")
im_9.save("/constr/picsx/ russian_doll_SMOOTH.png")
im_10.save("/constr/picsx/ russian_doll_SMOOTH_MORE.png")
im_11.save("/constr/picsx/ russian_doll_SHARPEN.png")
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec54"/>How it works...</h2></div></div></div><p>This recipe shows that the best filtering results are highly dependent on both the feature of the image we wish to enhance or suppress, as well as some subtle characteristics of the individual image being worked on. In the particular example of the Russian doll used here, the<code class="literal"> EDGE_ENHANCE</code> filter is particularly effective for counteracting the poor focus of the doll. It improves the color contrast in comparison to the<code class="literal"> SHARPEN</code> filter. Re-size and paste for synthetic rotation<a id="id178" class="indexterm"/>
</p><p>We want to create an animation that makes an image apparently rotate around a vertical axis in the middle of the picture. In this recipe, we see how the basic sequences of images for the animation are prepared.<a id="id179" class="indexterm"/>
</p><p>We want to make a sequence of images that are progressively narrower as if they were a poster on a board that was being gradually rotated. Then, we want to paste these narrow images in the middle of a standard-sized black background. If this sequence were displayed as a time-controlled series of frames, we would see the image apparently rotating around a central vertical axis.</p></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec55"/>Getting ready</h2></div></div></div><p>We use the image<code class="literal"> 100_canary.png</code> in a directory<code class="literal"> /constr/pics1</code> and we place the results in<code class="literal"> /constr/picsx</code> to avoid cluttering our source folder<code class="literal"> /constr/pics1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec56"/>How to do it...</h2></div></div></div><p>Again open the folder<code class="literal"> /constr/picsx</code> on your screen before you execute the following code and watch as the images appear once the execution is complete. This is not necessary but it is interesting to watch the results materialize before your eyes.</p><div class="informalexample"><pre class="programlisting"># image_rotate_resize_1.py
# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
import Image
import math
THETADEG = 5.0 # degrees
THETARAD = math.radians(THETADEG)
im_1 = Image.open("/constr/pics1/blank.png")
im_seed = Image.open("/constr/pics1/100_canary.png") # THE SEED IMAGE
im_seq_name = "canary"
#GET IMAGE WIDTH AND HEIGHT - not done here
# For the time being assume the image is 100 x 100
width = 100
height = 100
num_images = int(math.pi/(2*THETARAD))
Q = []
for j in range(0,2*num_images + 1):
Q.append(j)
for i in range(0, num_images):
new_size = width * math.cos(i*THETARAD) # Width for reduced # image
im_temp = im_seed.resize((new_size, height), Image.NEAREST)
im_width = im_temp.size[0] # Get the width of the reduced image
x_start = 50 -im_width/2 # Centralize new image in a 100x100 # square.
im_1.paste(im_temp,( x_start,10)) # Paste: This creates the # annoying ghosting.
stri = str(i)
# Save the reduced image
Q[i] = "/constr/picsx/" + im_seq_name + stri + ".gif"
im_1.save(Q[i])
# Flip horizontally and save the reduced image.
im_transpose = im_temp.transpose(Image.FLIP_LEFT_RIGHT)
im_1.paste(im_transpose,( x_start,10))
strj = str(2 * num_images - i)
Q[ 2 * num_images - i ] = "/constr/picsx/" + im_seq_name + strj \ + ".gif"
im_1.save(Q[ 2 * num_images - i ])
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec57"/>How it works...</h2></div></div></div><p>To mimic the effect of rotation, we reduce the width of each image to<code class="literal"> cosine(new_angle)</code> where<code class="literal"> new_angle</code> is increased by 5 degrees of rotation for each image. Then we take this narrowed image and paste it onto a blank black square. Finally we name each picture in the sequence in a systematic way such as<code class="literal"> canary0.gif, canary1.gif</code>, and so on until the last image is named<code class="literal"> canary36.gif</code>.<a id="id180" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec58"/>There's more...</h2></div></div></div><p>This example demonstrates the kind of task the Python Imaging Library is well-suited to - when you need to repeatedly perform a controlled transformation on an image or collection of images. The images could be the frames of a video film. Effects like fade-in and fade-out, zoom-out, color-shift, sharpen, and blur are the obvious ones that can be used but your programmer's imagination will be able to come up with many others.</p></div></div></div>
</body></html>