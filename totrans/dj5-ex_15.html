<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer408">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">15</span></h1>
<h1 class="chapterTitle" id="_idParaDest-395"><span class="koboSpan" id="kobo.2.1">Building an API</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, you built a system for student registration and enrollment in courses. </span><span class="koboSpan" id="kobo.3.2">You created views to display course contents and learned how to use Django’s cache framework.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will create a RESTful API for your e-learning platform. </span><span class="koboSpan" id="kobo.4.2">An API is a common programmable interface that can be used on multiple platforms like websites, mobile applications, plugins, and so on. </span><span class="koboSpan" id="kobo.4.3">For example, you can create an API to be consumed by a mobile application for your e-learning platform. </span><span class="koboSpan" id="kobo.4.4">If you provide an API to third parties, they will be able to consume information and operate with your application programmatically. </span><span class="koboSpan" id="kobo.4.5">An API allows developers to automate actions on your platform and integrate your service with other applications or online services. </span><span class="koboSpan" id="kobo.4.6">You will build a fully featured API for your e-learning platform.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">In this chapter, you will:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Install Django REST framework</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Create serializers for your models</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Build a RESTful API</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Implement serializer method fields</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Create nested serializers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Implement ViewSet views and routers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Build custom API views</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Handle API authentication</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Add permissions to API views</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1">Create custom permissions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1">Use the Requests library to consume the API</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-396"><span class="koboSpan" id="kobo.17.1">Functional overview</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.18.1">Figure 15.1</span></em><span class="koboSpan" id="kobo.19.1"> shows a representation of the views and API endpoints that will be built in this chapter:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.20.1"><img alt="" role="presentation" src="../Images/B21088_15_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.21.1">Figure 15.1: Diagram of API views and endpoints to be built in Chapter 15</span></p>
<p class="normal"><span class="koboSpan" id="kobo.22.1">In this chapter, you will create two different sets of API views, </span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">SubjectViewSet</span></code><span class="koboSpan" id="kobo.24.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.26.1">. </span><span class="koboSpan" id="kobo.26.2">The former will include the list and detail views for subjects. </span><span class="koboSpan" id="kobo.26.3">The latter will include the list and detail views for courses. </span><span class="koboSpan" id="kobo.26.4">You will also implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.27.1">enroll</span></code><span class="koboSpan" id="kobo.28.1"> action in </span><code class="inlineCode"><span class="koboSpan" id="kobo.29.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.30.1"> to enroll students in courses. </span><span class="koboSpan" id="kobo.30.2">This action will be only available to authenticated users, by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.31.1">IsAuthenticated</span></code><span class="koboSpan" id="kobo.32.1"> permission. </span><span class="koboSpan" id="kobo.32.2">You will create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">contents</span></code><span class="koboSpan" id="kobo.34.1"> action in </span><code class="inlineCode"><span class="koboSpan" id="kobo.35.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.36.1"> to access a course’s content. </span><span class="koboSpan" id="kobo.36.2">To access course contents, users have to be authenticated and enrolled in the given course. </span><span class="koboSpan" id="kobo.36.3">You will implement the custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.37.1">IsEnrolled</span></code><span class="koboSpan" id="kobo.38.1"> permission to limit access to contents to the users enrolled in the course.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.39.1">If you are not familiar with API endpoints, you just need to know that they are the specific locations within an API that accept and respond to requests. </span><span class="koboSpan" id="kobo.39.2">Each endpoint corresponds to a URL that may accept one or more HTTP methods, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.40.1">GET</span></code><span class="koboSpan" id="kobo.41.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.42.1">POST</span></code><span class="koboSpan" id="kobo.43.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.44.1">PUT</span></code><span class="koboSpan" id="kobo.45.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.46.1">DELETE</span></code><span class="koboSpan" id="kobo.47.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.48.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter15"><span class="url"><span class="koboSpan" id="kobo.49.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter15</span></span></a><span class="koboSpan" id="kobo.50.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.51.1">All Python modules used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">requirements.txt</span></code><span class="koboSpan" id="kobo.53.1"> file in the source code that accompanies this chapter. </span><span class="koboSpan" id="kobo.53.2">You can follow the instructions to install each Python module below, or you can install all requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.54.1">python -m pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.55.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-397"><span class="koboSpan" id="kobo.56.1">Building a RESTful API</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.57.1">When building an API, there are several ways you can structure its endpoints and actions, but following REST principles is encouraged.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.58.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.59.1">REST</span></strong><span class="koboSpan" id="kobo.60.1"> architecture </span><a id="_idIndexMarker1344"/><span class="koboSpan" id="kobo.61.1">comes from </span><strong class="keyWord"><span class="koboSpan" id="kobo.62.1">Representational State Transfer</span></strong><span class="koboSpan" id="kobo.63.1">. </span><span class="koboSpan" id="kobo.63.2">RESTful APIs are resource-based; your models </span><a id="_idIndexMarker1345"/><span class="koboSpan" id="kobo.64.1">represent resources, and HTTP methods such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">GET</span></code><span class="koboSpan" id="kobo.66.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.67.1">POST</span></code><span class="koboSpan" id="kobo.68.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.69.1">PUT</span></code><span class="koboSpan" id="kobo.70.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.71.1">DELETE</span></code><span class="koboSpan" id="kobo.72.1"> are used to retrieve, create, update, or delete objects. </span><span class="koboSpan" id="kobo.72.2">HTTP response codes are also used in this context. </span><span class="koboSpan" id="kobo.72.3">Different HTTP response codes are returned to indicate the result of the HTTP request, for example, </span><code class="inlineCode"><span class="koboSpan" id="kobo.73.1">2XX</span></code><span class="koboSpan" id="kobo.74.1"> response codes for success, </span><code class="inlineCode"><span class="koboSpan" id="kobo.75.1">4XX</span></code><span class="koboSpan" id="kobo.76.1"> for errors, and so on.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.77.1">The most common formats to exchange data in RESTful APIs are JSON and XML. </span><span class="koboSpan" id="kobo.77.2">You will build a RESTful API with JSON serialization for your project. </span><span class="koboSpan" id="kobo.77.3">Your API will provide the following functionalities:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.78.1">Retrieving subjects</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.79.1">Retrieving available courses</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.80.1">Retrieving course contents</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.81.1">Enrolling in a course</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.82.1">You can build an API from scratch with Django by creating custom views. </span><span class="koboSpan" id="kobo.82.2">However, there are several third-party modules</span><a id="_idIndexMarker1346"/><span class="koboSpan" id="kobo.83.1"> that simplify creating an API for your project; the most popular among them is </span><strong class="keyWord"><span class="koboSpan" id="kobo.84.1">Django REST framework</span></strong><span class="koboSpan" id="kobo.85.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.86.1">DRF</span></strong><span class="koboSpan" id="kobo.87.1">).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.88.1">DRF provides a comprehensive set of tools to build RESTful APIs for your projects. </span><span class="koboSpan" id="kobo.88.2">The following are some of the most relevant components that we will use to build our API:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.89.1">Serializers</span></strong><span class="koboSpan" id="kobo.90.1">: To transform data into a standardized format that other programs can</span><a id="_idIndexMarker1347"/><span class="koboSpan" id="kobo.91.1"> understand, or to </span><em class="italic"><span class="koboSpan" id="kobo.92.1">deserialize</span></em><span class="koboSpan" id="kobo.93.1"> data, by converting data into a format that your program can process.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.94.1">Parsers and renderers</span></strong><span class="koboSpan" id="kobo.95.1">: To render (or format) serialized data appropriately before it is </span><a id="_idIndexMarker1348"/><span class="koboSpan" id="kobo.96.1">returned in </span><a id="_idIndexMarker1349"/><span class="koboSpan" id="kobo.97.1">an HTTP response. </span><span class="koboSpan" id="kobo.97.2">Similarly, to parse incoming data to ensure that it’s in the</span><a id="_idIndexMarker1350"/><span class="koboSpan" id="kobo.98.1"> correct form.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.99.1">API views</span></strong><span class="koboSpan" id="kobo.100.1">: To implement the</span><a id="_idIndexMarker1351"/><span class="koboSpan" id="kobo.101.1"> application logic.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.102.1">URLs</span></strong><span class="koboSpan" id="kobo.103.1">: To define</span><a id="_idIndexMarker1352"/><span class="koboSpan" id="kobo.104.1"> the API endpoints that will be available.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.105.1">Authentication and permissions</span></strong><span class="koboSpan" id="kobo.106.1">: To define authentication methods for the API and the permissions required for each view.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.107.1">We will start by installing DRF and, after that, we will learn more about these components to build our first API.</span></p>
<h2 class="heading-2" id="_idParaDest-398"><span class="koboSpan" id="kobo.108.1">Installing Django REST framework</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.109.1">You can find all the information</span><a id="_idIndexMarker1353"/><span class="koboSpan" id="kobo.110.1"> about </span><strong class="keyWord"><span class="koboSpan" id="kobo.111.1">DRF</span></strong><span class="koboSpan" id="kobo.112.1"> at </span><a href="https://www.django-rest-framework.org/"><span class="url"><span class="koboSpan" id="kobo.113.1">https://www.django-rest-framework.org/</span></span></a><span class="koboSpan" id="kobo.114.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.115.1">Open the shell and</span><a id="_idIndexMarker1354"/><span class="koboSpan" id="kobo.116.1"> install the framework with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.117.1">python -m pip install djangorestframework==3.15.1
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.118.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.119.1">settings.py</span></code><span class="koboSpan" id="kobo.120.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.121.1">educa</span></code><span class="koboSpan" id="kobo.122.1"> project and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.123.1">rest_framework</span></code><span class="koboSpan" id="kobo.124.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.125.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.126.1"> setting to activate the application, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.127.1">INSTALLED_APPS = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.128.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.129.1">'rest_framework'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.130.1">,</span></strong></span><span class="koboSpan" id="kobo.131.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.132.1">Then, add the following code to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.133.1">settings.py</span></code><span class="koboSpan" id="kobo.134.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.135.1">REST_FRAMEWORK = {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.136.1">'DEFAULT_PERMISSION_CLASSES'</span></span><span class="koboSpan" id="kobo.137.1">: [
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.138.1">'rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly'</span></span><span class="koboSpan" id="kobo.139.1">
    ]
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.140.1">You can provide a specific configuration for your API using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">REST_FRAMEWORK</span></code><span class="koboSpan" id="kobo.142.1"> setting. </span><span class="koboSpan" id="kobo.142.2">DRF offers a wide range of settings to configure default behaviors. </span><span class="koboSpan" id="kobo.142.3">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.143.1">DEFAULT_PERMISSION_CLASSES</span></code><span class="koboSpan" id="kobo.144.1"> setting specifies the default permissions to read, create, update, or delete objects. </span><span class="koboSpan" id="kobo.144.2">You set </span><code class="inlineCode"><span class="koboSpan" id="kobo.145.1">DjangoModelPermissionsOrAnonReadOnly</span></code><span class="koboSpan" id="kobo.146.1"> as the only default permission class. </span><span class="koboSpan" id="kobo.146.2">This class relies on Django’s permissions system to allow users to create, update, or delete </span><a id="_idIndexMarker1355"/><span class="koboSpan" id="kobo.147.1">objects while providing read-only access for anonymous users. </span><span class="koboSpan" id="kobo.147.2">You will learn more about permissions later, in the </span><em class="italic"><span class="koboSpan" id="kobo.148.1">Adding permissions to views</span></em><span class="koboSpan" id="kobo.149.1"> section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.150.1">For a complete list of available settings for DRF, you can visit </span><a href="https://www.django-rest-framework.org/api-guide/settings/"><span class="url"><span class="koboSpan" id="kobo.151.1">https://www.django-rest-framework.org/api-guide/settings/</span></span></a><span class="koboSpan" id="kobo.152.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-399"><span class="koboSpan" id="kobo.153.1">Defining serializers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.154.1">After setting up DRF, you need to specify</span><a id="_idIndexMarker1356"/><span class="koboSpan" id="kobo.155.1"> how your data will be serialized. </span><span class="koboSpan" id="kobo.155.2">Output data has to be serialized in a specific format, and input data will be deserialized for </span><a id="_idIndexMarker1357"/><span class="koboSpan" id="kobo.156.1">processing. </span><span class="koboSpan" id="kobo.156.2">The framework provides the following classes to build serializers for single objects:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.157.1">Serializer</span></code><span class="koboSpan" id="kobo.158.1">: Provides serialization for normal Python class instances</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">ModelSerializer</span></code><span class="koboSpan" id="kobo.160.1">: Provides serialization for model instances</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">HyperlinkedModelSerializer</span></code><span class="koboSpan" id="kobo.162.1">: The same as </span><code class="inlineCode"><span class="koboSpan" id="kobo.163.1">ModelSerializer</span></code><span class="koboSpan" id="kobo.164.1">, but it represents object relationships with links rather than primary keys</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.165.1">Let’s build our first serializer. </span><span class="koboSpan" id="kobo.165.2">Create the following file structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.166.1">courses</span></code><span class="koboSpan" id="kobo.167.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.168.1">api/
    __init__.py
    serializers.py
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.169.1">You will build all the API functionality inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.170.1">api</span></code><span class="koboSpan" id="kobo.171.1"> directory to keep everything well organized. </span><span class="koboSpan" id="kobo.171.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.173.1"> file and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.174.1">from</span></span><span class="koboSpan" id="kobo.175.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.176.1">import</span></span><span class="koboSpan" id="kobo.177.1"> serializers
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.178.1">from</span></span><span class="koboSpan" id="kobo.179.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.180.1">import</span></span><span class="koboSpan" id="kobo.181.1"> Subject
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.182.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.183.1">SubjectSerializer</span></span><span class="koboSpan" id="kobo.184.1">(serializers.ModelSerializer):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.185.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.186.1">Meta</span></span><span class="koboSpan" id="kobo.187.1">:
        model = Subject
        fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.188.1">'id'</span></span><span class="koboSpan" id="kobo.189.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.190.1">'title'</span></span><span class="koboSpan" id="kobo.191.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.192.1">'slug'</span></span><span class="koboSpan" id="kobo.193.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.194.1">This is the serializer for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.195.1">Subject</span></code><span class="koboSpan" id="kobo.196.1"> model. </span><span class="koboSpan" id="kobo.196.2">Serializers</span><a id="_idIndexMarker1358"/><span class="koboSpan" id="kobo.197.1"> are defined in a similar fashion to Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">Form</span></code><span class="koboSpan" id="kobo.199.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.200.1">ModelForm</span></code><span class="koboSpan" id="kobo.201.1"> classes. </span><span class="koboSpan" id="kobo.201.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">Meta</span></code><span class="koboSpan" id="kobo.203.1"> class allows you to specify the model to serialize and the fields to be included for serialization. </span><span class="koboSpan" id="kobo.203.2">All model fields will be included if you don’t set a </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">fields</span></code><span class="koboSpan" id="kobo.205.1"> attribute.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.206.1">Let’s try the serializer. </span><span class="koboSpan" id="kobo.206.2">Open the command line and start the Django shell with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.207.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.208.1">Run the following code:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.209.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.210.1">from</span></span><span class="koboSpan" id="kobo.211.1"> courses.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.212.1">import</span></span><span class="koboSpan" id="kobo.213.1"> Subject
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.214.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.215.1">from</span></span><span class="koboSpan" id="kobo.216.1"> courses.api.serializers </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.217.1">import</span></span><span class="koboSpan" id="kobo.218.1"> SubjectSerializer
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.219.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.220.1"> subject = Subject.objects.latest(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.221.1">'id'</span></span><span class="koboSpan" id="kobo.222.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.223.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.224.1"> serializer = SubjectSerializer(subject)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.225.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.226.1"> serializer.data
{'id': 4, 'title': 'Programming', 'slug': 'programming'}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.227.1">In this example, you get a </span><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">Subject</span></code><span class="koboSpan" id="kobo.229.1"> object, create an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.230.1">SubjectSerializer</span></code><span class="koboSpan" id="kobo.231.1">, and access the serialized data. </span><span class="koboSpan" id="kobo.231.2">You can see that the model data is translated into Python native data types.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.232.1">You can read more about serializers at </span><a href="https://www.django-rest-framework.org/api-guide/serializers/"><span class="url"><span class="koboSpan" id="kobo.233.1">https://www.django-rest-framework.org/api-guide/serializers/</span></span></a><span class="koboSpan" id="kobo.234.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-400"><span class="koboSpan" id="kobo.235.1">Understanding parsers and renderers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.236.1">The serialized</span><a id="_idIndexMarker1359"/><span class="koboSpan" id="kobo.237.1"> data has to be </span><a id="_idIndexMarker1360"/><span class="koboSpan" id="kobo.238.1">rendered in a specific format before</span><a id="_idIndexMarker1361"/><span class="koboSpan" id="kobo.239.1"> you return it in an HTTP </span><a id="_idIndexMarker1362"/><span class="koboSpan" id="kobo.240.1">response. </span><span class="koboSpan" id="kobo.240.2">Likewise, when you get an HTTP request, you have to parse the incoming data and deserialize it before you can operate with it. </span><span class="koboSpan" id="kobo.240.3">DRF includes renderers and parsers to handle that.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.241.1">Let’s see how to parse</span><a id="_idIndexMarker1363"/><span class="koboSpan" id="kobo.242.1"> incoming data. </span><span class="koboSpan" id="kobo.242.2">Execute the following code in the Python shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.243.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.244.1">from</span></span><span class="koboSpan" id="kobo.245.1"> io </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.246.1">import</span></span><span class="koboSpan" id="kobo.247.1"> BytesIO
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.248.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.249.1">from</span></span><span class="koboSpan" id="kobo.250.1"> rest_framework.parsers </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.251.1">import</span></span><span class="koboSpan" id="kobo.252.1"> JSONParser
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.253.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.254.1"> data = </span><span class="hljs-con-string"><span class="koboSpan" id="kobo.255.1">b'{"id":4,"title":"Programming","slug":"programming"}'</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.256.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.257.1"> JSONParser().parse(BytesIO(data))
{'id': 4, 'title': 'Programming', 'slug': 'programming'}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.258.1">Given a JSON string input, you can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.259.1">JSONParser</span></code><span class="koboSpan" id="kobo.260.1"> class provided by DRF to convert it to a Python object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.261.1">DRF also includes </span><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">Renderer</span></code><span class="koboSpan" id="kobo.263.1"> classes that allow you to format API responses. </span><span class="koboSpan" id="kobo.263.2">The framework determines</span><a id="_idIndexMarker1364"/><span class="koboSpan" id="kobo.264.1"> which renderer to use through content negotiation by inspecting </span><a id="_idIndexMarker1365"/><span class="koboSpan" id="kobo.265.1">the request’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.266.1">Accept</span></code><span class="koboSpan" id="kobo.267.1"> header to determine the expected content type for the response. </span><span class="koboSpan" id="kobo.267.2">Optionally, the renderer is determined by the format suffix of the URL. </span><span class="koboSpan" id="kobo.267.3">For example, the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.268.1">http://127.0.0.1:8000/api/data.json</span></code><span class="koboSpan" id="kobo.269.1"> might be an endpoint that triggers the </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1">JSONRenderer</span></code><span class="koboSpan" id="kobo.271.1"> in order to return a JSON response.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.272.1">Go back to the shell and </span><a id="_idIndexMarker1366"/><span class="koboSpan" id="kobo.273.1">execute the following code to render the </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">serializer</span></code><span class="koboSpan" id="kobo.275.1"> object from the previous serializer example:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.276.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.277.1">from</span></span><span class="koboSpan" id="kobo.278.1"> rest_framework.renderers </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.279.1">import</span></span><span class="koboSpan" id="kobo.280.1"> JSONRenderer
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.281.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.282.1"> JSONRenderer().render(serializer.data)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.283.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.284.1">b'{"id":4,"title":"Programming","slug":"programming"}'
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.285.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">JSONRenderer</span></code><span class="koboSpan" id="kobo.287.1"> to render the serialized data into JSON. </span><span class="koboSpan" id="kobo.287.2">By default, DRF uses two different renderers: </span><code class="inlineCode"><span class="koboSpan" id="kobo.288.1">JSONRenderer</span></code><span class="koboSpan" id="kobo.289.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.290.1">BrowsableAPIRenderer</span></code><span class="koboSpan" id="kobo.291.1">. </span><span class="koboSpan" id="kobo.291.2">The latter provides a web interface to easily browse your API. </span><span class="koboSpan" id="kobo.291.3">You can change the default renderer classes with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.292.1">DEFAULT_RENDERER_CLASSES</span></code><span class="koboSpan" id="kobo.293.1"> option of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1">REST_FRAMEWORK</span></code><span class="koboSpan" id="kobo.295.1"> setting.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.296.1">You can find more information about renderers and parsers at </span><a href="https://www.django-rest-framework.org/api-guide/renderers/"><span class="url"><span class="koboSpan" id="kobo.297.1">https://www.django-rest-framework.org/api-guide/renderers/</span></span></a><span class="koboSpan" id="kobo.298.1"> and </span><a href="https://www.django-rest-framework.org/api-guide/parsers/"><span class="url"><span class="koboSpan" id="kobo.299.1">https://www.django-rest-framework.org/api-guide/parsers/</span></span></a><span class="koboSpan" id="kobo.300.1">, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.301.1">Next, you are going to learn </span><a id="_idIndexMarker1367"/><span class="koboSpan" id="kobo.302.1">how to build API views</span><a id="_idIndexMarker1368"/><span class="koboSpan" id="kobo.303.1"> and use serializers in views.</span></p>
<h2 class="heading-2" id="_idParaDest-401"><span class="koboSpan" id="kobo.304.1">Building list and detail views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.305.1">DRF comes with a set of </span><a id="_idIndexMarker1369"/><span class="koboSpan" id="kobo.306.1">generic views and mixins that you can use to build your API views. </span><span class="koboSpan" id="kobo.306.2">You have been using generic views throughout this book since </span><em class="italic"><span class="koboSpan" id="kobo.307.1">Chapter 2</span></em><span class="koboSpan" id="kobo.308.1">, </span><em class="italic"><span class="koboSpan" id="kobo.309.1">Enhancing Your Blog and Adding Social Features</span></em><span class="koboSpan" id="kobo.310.1">,</span><em class="italic"> </em><span class="koboSpan" id="kobo.311.1">and you learned about mixins in </span><em class="italic"><span class="koboSpan" id="kobo.312.1">Chapter 13</span></em><span class="koboSpan" id="kobo.313.1">, </span><em class="italic"><span class="koboSpan" id="kobo.314.1">Creating a Content Management System</span></em><span class="koboSpan" id="kobo.315.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.316.1">The base views and mixins provide the functionality to retrieve, create, update, or delete model objects. </span><span class="koboSpan" id="kobo.316.2">You can see all the generic mixins and views provided by DRF at </span><a href="https://www.django-rest-framework.org/api-guide/generic-views/"><span class="url"><span class="koboSpan" id="kobo.317.1">https://www.django-rest-framework.org/api-guide/generic-views/</span></span></a><span class="koboSpan" id="kobo.318.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.319.1">Let’s create list and detail views to retrieve </span><code class="inlineCode"><span class="koboSpan" id="kobo.320.1">Subject</span></code><span class="koboSpan" id="kobo.321.1"> objects. </span><span class="koboSpan" id="kobo.321.2">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.322.1">courses/api/</span></code><span class="koboSpan" id="kobo.323.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.324.1">views.py</span></code><span class="koboSpan" id="kobo.325.1">. </span><span class="koboSpan" id="kobo.325.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.326.1">from</span></span><span class="koboSpan" id="kobo.327.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.328.1">import</span></span><span class="koboSpan" id="kobo.329.1"> generics
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.330.1">from</span></span><span class="koboSpan" id="kobo.331.1"> courses.api.serializers </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.332.1">import</span></span><span class="koboSpan" id="kobo.333.1"> SubjectSerializer
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.334.1">from</span></span><span class="koboSpan" id="kobo.335.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.336.1">import</span></span><span class="koboSpan" id="kobo.337.1"> Subject
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.338.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.339.1">SubjectListView</span></span><span class="koboSpan" id="kobo.340.1">(generics.ListAPIView):
    queryset = Subject.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.341.1">all</span></span><span class="koboSpan" id="kobo.342.1">()
    serializer_class = SubjectSerializer
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.343.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.344.1">SubjectDetailView</span></span><span class="koboSpan" id="kobo.345.1">(generics.RetrieveAPIView):
    queryset = Subject.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.346.1">all</span></span><span class="koboSpan" id="kobo.347.1">()
    serializer_class = SubjectSerializer
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.348.1">In this code, you use the generic </span><code class="inlineCode"><span class="koboSpan" id="kobo.349.1">ListAPIView</span></code><span class="koboSpan" id="kobo.350.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.351.1">RetrieveAPIView</span></code><span class="koboSpan" id="kobo.352.1"> views of DRF. </span><span class="koboSpan" id="kobo.352.2">Both views have the following attributes:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.353.1">queryset</span></code><span class="koboSpan" id="kobo.354.1">: The base QuerySet to use to retrieve objects</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.355.1">serializer_class</span></code><span class="koboSpan" id="kobo.356.1">: The class to serialize objects</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.357.1">Let’s add URL patterns for your views. </span><span class="koboSpan" id="kobo.357.2">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.358.1">courses/api/</span></code><span class="koboSpan" id="kobo.359.1"> directory, name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.360.1">urls.py</span></code><span class="koboSpan" id="kobo.361.1">, and make it look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.362.1">from</span></span><span class="koboSpan" id="kobo.363.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.364.1">import</span></span><span class="koboSpan" id="kobo.365.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.366.1">from</span></span><span class="koboSpan" id="kobo.367.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.368.1">import</span></span><span class="koboSpan" id="kobo.369.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.370.1">'courses'</span></span><span class="koboSpan" id="kobo.371.1">
urlpatterns = [
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.372.1">'subjects/'</span></span><span class="koboSpan" id="kobo.373.1">,
        views.SubjectListView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.374.1">'subject_list'</span></span><span class="koboSpan" id="kobo.375.1">
    ),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.376.1">'subjects/&lt;pk&gt;/'</span></span><span class="koboSpan" id="kobo.377.1">,
        views.SubjectDetailView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.378.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.379.1">subject_detail'</span></span><span class="koboSpan" id="kobo.380.1">
    ),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.381.1">In the URL pattern for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1">SubjectDetailView</span></code><span class="koboSpan" id="kobo.383.1"> view, you include a </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">pk</span></code><span class="koboSpan" id="kobo.385.1"> URL parameter to retrieve the object with the</span><a id="_idIndexMarker1370"/><span class="koboSpan" id="kobo.386.1"> given primary key of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">Subject</span></code><span class="koboSpan" id="kobo.388.1"> model, which is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">id</span></code><span class="koboSpan" id="kobo.390.1"> field. </span><span class="koboSpan" id="kobo.390.2">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">urls.py</span></code><span class="koboSpan" id="kobo.392.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.393.1">educa</span></code><span class="koboSpan" id="kobo.394.1"> project and include the API patterns, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.395.1">urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.396.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.397.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.398.1">'api/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.399.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.400.1">'courses.api.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.401.1">, namespace=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.402.1">'api'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.403.1">)),</span></strong></span><span class="koboSpan" id="kobo.404.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.405.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.406.1">api</span></code><span class="koboSpan" id="kobo.407.1"> namespace for your API URLs. </span><span class="koboSpan" id="kobo.407.2">Our initial API endpoints are ready to be used.</span></p>
<h1 class="heading-1" id="_idParaDest-402"><span class="koboSpan" id="kobo.408.1">Consuming the API</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.409.1">By making our views </span><a id="_idIndexMarker1371"/><span class="koboSpan" id="kobo.410.1">available via URLs, we have created our first API endpoints. </span><span class="koboSpan" id="kobo.410.2">Let’s now try our own API. </span><span class="koboSpan" id="kobo.410.3">Ensure that your server is running with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.411.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.412.1">We are going to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.413.1">curl</span></code><span class="koboSpan" id="kobo.414.1"> to consume the API. </span><code class="inlineCode"><span class="koboSpan" id="kobo.415.1">curl</span></code><span class="koboSpan" id="kobo.416.1"> is a command-line tool that allows you to transfer data to and from a server. </span><span class="koboSpan" id="kobo.416.2">If you are using Linux, macOS, or Windows 10/11, </span><code class="inlineCode"><span class="koboSpan" id="kobo.417.1">curl</span></code><span class="koboSpan" id="kobo.418.1"> is very likely included in your system. </span><span class="koboSpan" id="kobo.418.2">However, you can download </span><code class="inlineCode"><span class="koboSpan" id="kobo.419.1">curl</span></code><span class="koboSpan" id="kobo.420.1"> from </span><a href="https://curl.se/download.html"><span class="url"><span class="koboSpan" id="kobo.421.1">https://curl.se/download.html</span></span></a><span class="koboSpan" id="kobo.422.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.423.1">Open the shell and retrieve the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">http://127.0.0.1:8000/api/subjects/</span></code><span class="koboSpan" id="kobo.425.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.426.1">curl</span></code><span class="koboSpan" id="kobo.427.1">, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.428.1">curl http://127.0.0.1:8000/api/subjects/
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.429.1">You will get a response similar to the following one:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.430.1">[
    {
        "id":1,
        "title":"Mathematics",
        "slug":"mathematics"
    },
    {
        "id":2,
        "title":"Music",
        "slug":"music"
    },
    {
        "id":3,
        "title":"Physics",
        "slug":"physics"
    },
    {
        "id":4,
        "title":"Programming",
        "slug":"programming"
    }
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.431.1">To obtain a more readable, well-indented JSON response, you can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">curl</span></code><span class="koboSpan" id="kobo.433.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.434.1">json_pp</span></code><span class="koboSpan" id="kobo.435.1"> utility, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.436.1">curl http://127.0.0.1:8000/api/subjects/ | json_pp
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.437.1">The HTTP response contains a</span><a id="_idIndexMarker1372"/><span class="koboSpan" id="kobo.438.1"> list of </span><code class="inlineCode"><span class="koboSpan" id="kobo.439.1">Subject</span></code><span class="koboSpan" id="kobo.440.1"> objects in the JSON format.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.441.1">Instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.442.1">curl</span></code><span class="koboSpan" id="kobo.443.1">, you can also use any other tool to send custom HTTP requests, including a browser extension </span><a id="_idIndexMarker1373"/><span class="koboSpan" id="kobo.444.1">such as Postman, which you can get at </span><a href="https://www.getpostman.com/"><span class="url"><span class="koboSpan" id="kobo.445.1">https://www.getpostman.com/</span></span></a><span class="koboSpan" id="kobo.446.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.447.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.448.1">http://127.0.0.1:8000/api/subjects/</span></code><span class="koboSpan" id="kobo.449.1"> in your browser. </span><span class="koboSpan" id="kobo.449.2">You will see DRF’s browsable API, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.450.1"><img alt="Graphical user interface, text  Description automatically generated" src="../Images/B21088_15_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.451.1">Figure 15.2: The Subject List page in the REST framework browsable API</span></p>
<p class="normal"><span class="koboSpan" id="kobo.452.1">This HTML interface is provided by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.453.1">BrowsableAPIRenderer</span></code><span class="koboSpan" id="kobo.454.1"> renderer. </span><span class="koboSpan" id="kobo.454.2">It displays the result headers and </span><a id="_idIndexMarker1374"/><span class="koboSpan" id="kobo.455.1">content, and it allows you to perform requests. </span><span class="koboSpan" id="kobo.455.2">You can also access the API detail view for a </span><code class="inlineCode"><span class="koboSpan" id="kobo.456.1">Subject</span></code><span class="koboSpan" id="kobo.457.1"> object by including its ID in the URL.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.458.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">http://127.0.0.1:8000/api/subjects/1/</span></code><span class="koboSpan" id="kobo.460.1"> in your browser. </span><span class="koboSpan" id="kobo.460.2">You will see a single </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">Subject</span></code><span class="koboSpan" id="kobo.462.1"> object rendered in the JSON format.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.463.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_15_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.464.1">Figure 15.3: The Subject Detail page in the REST framework browsable API</span></p>
<p class="normal"><span class="koboSpan" id="kobo.465.1">This is the response for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.466.1">SubjectDetailView</span></code><span class="koboSpan" id="kobo.467.1">. </span><span class="koboSpan" id="kobo.467.2">Let’s learn how to enrich the content returned for each subject. </span><span class="koboSpan" id="kobo.467.3">In the </span><a id="_idIndexMarker1375"/><span class="koboSpan" id="kobo.468.1">next section, we are going to dive into extending serializers with additional fields and methods.</span></p>
<h1 class="heading-1" id="_idParaDest-403"><span class="koboSpan" id="kobo.469.1">Extending serializers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.470.1">You have learned how to serialize</span><a id="_idIndexMarker1376"/><span class="koboSpan" id="kobo.471.1"> your model objects; however, often, you may want to enrich the response with additional relevant data or calculated fields. </span><span class="koboSpan" id="kobo.471.2">Let’s take a look at some of the options to extend serializers.</span></p>
<h2 class="heading-2" id="_idParaDest-404"><span class="koboSpan" id="kobo.472.1">Adding additional fields to serializers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.473.1">Let’s edit the subject views to include the</span><a id="_idIndexMarker1377"/><span class="koboSpan" id="kobo.474.1"> number of courses available for each subject. </span><span class="koboSpan" id="kobo.474.2">You will use the Django aggregation functions to annotate the count of related courses for each subject.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.475.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.476.1">api/views.py</span></code><span class="koboSpan" id="kobo.477.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.478.1">courses</span></code><span class="koboSpan" id="kobo.479.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.480.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.481.1"> django.db.models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.482.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.483.1"> Count</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.484.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.485.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.486.1">SubjectListView</span></span><span class="koboSpan" id="kobo.487.1">(generics.ListAPIView):
    queryset = Subject.objects.</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.488.1">annotate(total_courses=Count(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.489.1">'courses'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.490.1">))</span></strong></span><span class="koboSpan" id="kobo.491.1">
    serializer_class = SubjectSerializer
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.492.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.493.1">SubjectDetailView</span></span><span class="koboSpan" id="kobo.494.1">(generics.RetrieveAPIView):
    queryset = Subject.objects.</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.495.1">annotate(total_courses=Count(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.496.1">'courses'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.497.1">))</span></strong></span><span class="koboSpan" id="kobo.498.1">
    serializer_class = SubjectSerializer
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.499.1">You are now using a QuerySet for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.500.1">SubjectListView</span></code><span class="koboSpan" id="kobo.501.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.502.1">SubjectDetailView</span></code><span class="koboSpan" id="kobo.503.1"> that uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.504.1">Count</span></code><span class="koboSpan" id="kobo.505.1"> aggregation</span><a id="_idIndexMarker1378"/><span class="koboSpan" id="kobo.506.1"> function to annotate the related course count.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.507.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.508.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.509.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.510.1">courses</span></code><span class="koboSpan" id="kobo.511.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.512.1">from</span></span><span class="koboSpan" id="kobo.513.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.514.1">import</span></span><span class="koboSpan" id="kobo.515.1"> serializers
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.516.1">from</span></span><span class="koboSpan" id="kobo.517.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.518.1">import</span></span><span class="koboSpan" id="kobo.519.1"> Subject
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.520.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.521.1">SubjectSerializer</span></span><span class="koboSpan" id="kobo.522.1">(serializers.ModelSerializer):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.523.1">    total_courses = seralizers.IntegerField()</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.524.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.525.1">Meta</span></span><span class="koboSpan" id="kobo.526.1">:
        model = Subject
        fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.527.1">'id'</span></span><span class="koboSpan" id="kobo.528.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.529.1">'title'</span></span><span class="koboSpan" id="kobo.530.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.531.1">'slug'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.532.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.533.1">'total_courses'</span></strong></span><span class="koboSpan" id="kobo.534.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.535.1">You have added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.536.1">total_courses</span></code><span class="koboSpan" id="kobo.537.1"> field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.538.1">SubjectSerializer</span></code><span class="koboSpan" id="kobo.539.1"> class. </span><span class="koboSpan" id="kobo.539.2">This field is an </span><code class="inlineCode"><span class="koboSpan" id="kobo.540.1">IntegerField</span></code><span class="koboSpan" id="kobo.541.1"> to represent integers. </span><span class="koboSpan" id="kobo.541.2">This field will automatically get its value from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.542.1">total_courses</span></code><span class="koboSpan" id="kobo.543.1"> attribute of the object being serialized. </span><span class="koboSpan" id="kobo.543.2">By using </span><code class="inlineCode"><span class="koboSpan" id="kobo.544.1">annotate()</span></code><span class="koboSpan" id="kobo.545.1">, we added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.546.1">total_courses</span></code><span class="koboSpan" id="kobo.547.1"> attribute to the resulting objects of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.548.1">QuerySet</span></code><span class="koboSpan" id="kobo.549.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.550.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.551.1">http://127.0.0.1:8000/api/subjects/1/</span></code><span class="koboSpan" id="kobo.552.1"> in your browser. </span><span class="koboSpan" id="kobo.552.2">The serialized JSON object now includes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.553.1">total_courses</span></code><span class="koboSpan" id="kobo.554.1"> attribute, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.555.1">Figure 15.4</span></em><span class="koboSpan" id="kobo.556.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.557.1"><img alt="" role="presentation" src="../Images/B21088_15_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.558.1">Figure 15.4: The Subject Detail page, including the total_courses attribute</span></p>
<p class="normal"><span class="koboSpan" id="kobo.559.1">You have successfully added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.560.1">total_courses</span></code><span class="koboSpan" id="kobo.561.1"> attribute to the subject list and detail views. </span><span class="koboSpan" id="kobo.561.2">Now, let’s look</span><a id="_idIndexMarker1379"/><span class="koboSpan" id="kobo.562.1"> into adding additional attributes using custom serializer methods.</span></p>
<h2 class="heading-2" id="_idParaDest-405"><span class="koboSpan" id="kobo.563.1">Implementing serializer method fields</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.564.1">DRF provides </span><code class="inlineCode"><span class="koboSpan" id="kobo.565.1">SerializerMethodField</span></code><span class="koboSpan" id="kobo.566.1">, which allows you to implement read-only fields that get their value by calling a </span><a id="_idIndexMarker1380"/><span class="koboSpan" id="kobo.567.1">method of the serializer class. </span><span class="koboSpan" id="kobo.567.2">This can be particularly useful when you want to include some custom formatted data in your serialized object or perform complex calculations that are not directly a part of your model instances.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.568.1">We will create a method that serializes the top 3 popular courses for a subject. </span><span class="koboSpan" id="kobo.568.2">We will rank courses by the number of students enrolled in them. </span><span class="koboSpan" id="kobo.568.3">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.569.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.570.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.571.1">courses</span></code><span class="koboSpan" id="kobo.572.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.573.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.574.1"> django.db.models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.575.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.576.1"> Count</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.577.1">from</span></span><span class="koboSpan" id="kobo.578.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.579.1">import</span></span><span class="koboSpan" id="kobo.580.1"> serializers
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.581.1">from</span></span><span class="koboSpan" id="kobo.582.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.583.1">import</span></span><span class="koboSpan" id="kobo.584.1"> Subject
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.585.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.586.1">SubjectSerializer</span></span><span class="koboSpan" id="kobo.587.1">(serializers.ModelSerializer):
    total_courses = serializers.IntegerField()
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.588.1">    popular_courses = seralizers.SerializerMethodField()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.589.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.590.1">get_popular_courses</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.591.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.592.1">self, obj</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.593.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.594.1">        courses = obj.courses.annotate(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.595.1">            total_students=Count(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.596.1">'students'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.597.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.598.1">        ).order_by(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.599.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.600.1">total_students'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.601.1">)[:</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.602.1">3</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.603.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.604.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.605.1"> [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.606.1">f'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.607.1">{c.title}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.608.1"> (</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.609.1">{c.total_students}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.610.1">)'</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.611.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.612.1"> c </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.613.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.614.1"> courses</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.615.1">        ]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.616.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.617.1">Meta</span></span><span class="koboSpan" id="kobo.618.1">:
        model = Subject
        fields = [
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.619.1">'id'</span></span><span class="koboSpan" id="kobo.620.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.621.1">'title'</span></span><span class="koboSpan" id="kobo.622.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.623.1">'slug'</span></span><span class="koboSpan" id="kobo.624.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.625.1">'total_courses'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.626.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.627.1">'popular_courses'</span></strong></span><span class="koboSpan" id="kobo.628.1">
        ]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.629.1">In the new code, you add the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.630.1">popular_courses</span></code><span class="koboSpan" id="kobo.631.1"> serializer method field to </span><code class="inlineCode"><span class="koboSpan" id="kobo.632.1">SubjectSerializer</span></code><span class="koboSpan" id="kobo.633.1">. </span><span class="koboSpan" id="kobo.633.2">The field gets its value from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.634.1">get_popular_courses()</span></code><span class="koboSpan" id="kobo.635.1"> method. </span><span class="koboSpan" id="kobo.635.2">You can provide the name of the </span><a id="_idIndexMarker1381"/><span class="koboSpan" id="kobo.636.1">serializer method to call with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.637.1">method_field</span></code><span class="koboSpan" id="kobo.638.1"> argument of </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1">SerializerMethodField</span></code><span class="koboSpan" id="kobo.640.1">. </span><span class="koboSpan" id="kobo.640.2">If not included, this defaults to </span><code class="inlineCode"><span class="koboSpan" id="kobo.641.1">get_&lt;field_name&gt;</span></code><span class="koboSpan" id="kobo.642.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.643.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.644.1">http://127.0.0.1:8000/api/subjects/1/</span></code><span class="koboSpan" id="kobo.645.1"> in your browser. </span><span class="koboSpan" id="kobo.645.2">The serialized JSON object now includes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.646.1">total_courses</span></code><span class="koboSpan" id="kobo.647.1"> attribute, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.648.1">Figure 15.5</span></em><span class="koboSpan" id="kobo.649.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.650.1"><img alt="" role="presentation" src="../Images/B21088_15_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.651.1">Figure 15.5: The subject detail page, including the popular_courses attribute</span></p>
<p class="normal"><span class="koboSpan" id="kobo.652.1">You have successfully implemented a </span><code class="inlineCode"><span class="koboSpan" id="kobo.653.1">SerializerMethodField</span></code><span class="koboSpan" id="kobo.654.1">. </span><span class="koboSpan" id="kobo.654.2">Note that, now, an additional SQL query is generated for each of the results returned by </span><code class="inlineCode"><span class="koboSpan" id="kobo.655.1">SubjectListView</span></code><span class="koboSpan" id="kobo.656.1">. </span><span class="koboSpan" id="kobo.656.2">Next, you are going to learn how to</span><a id="_idIndexMarker1382"/><span class="koboSpan" id="kobo.657.1"> control the number of results returned by adding pagination to </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">SubjectListView</span></code><span class="koboSpan" id="kobo.659.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-406"><span class="koboSpan" id="kobo.660.1">Adding pagination to views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.661.1">DRF includes built-in pagination</span><a id="_idIndexMarker1383"/><span class="koboSpan" id="kobo.662.1"> capabilities to control how many objects are sent over in your API responses. </span><span class="koboSpan" id="kobo.662.2">When the content of your site starts to grow, you might end up with a large number of subjects and courses. </span><span class="koboSpan" id="kobo.662.3">Pagination can be particularly </span><a id="_idIndexMarker1384"/><span class="koboSpan" id="kobo.663.1">useful to improve performance and the user experience when dealing with large datasets.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.664.1">Let’s update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.665.1">SubjectListView</span></code><span class="koboSpan" id="kobo.666.1"> view to include pagination. </span><span class="koboSpan" id="kobo.666.2">First, we will define a pagination class.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.667.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">courses/api/</span></code><span class="koboSpan" id="kobo.669.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.670.1">pagination.py</span></code><span class="koboSpan" id="kobo.671.1">. </span><span class="koboSpan" id="kobo.671.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.672.1">from</span></span><span class="koboSpan" id="kobo.673.1"> rest_framework.pagination </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.674.1">import</span></span><span class="koboSpan" id="kobo.675.1"> PageNumberPagination
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.676.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.677.1">StandardPagination</span></span><span class="koboSpan" id="kobo.678.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.679.1">PageNumberPagination</span></span><span class="koboSpan" id="kobo.680.1">):
    page_size = </span><span class="hljs-number"><span class="koboSpan" id="kobo.681.1">10</span></span><span class="koboSpan" id="kobo.682.1">
    page_size_query_param = </span><span class="hljs-string"><span class="koboSpan" id="kobo.683.1">'page_size'</span></span><span class="koboSpan" id="kobo.684.1">
    max_page_size = </span><span class="hljs-number"><span class="koboSpan" id="kobo.685.1">50</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.686.1">In this class, we inherit from </span><code class="inlineCode"><span class="koboSpan" id="kobo.687.1">PageNumberPagination</span></code><span class="koboSpan" id="kobo.688.1">. </span><span class="koboSpan" id="kobo.688.2">This class provides support for pagination based on page numbers. </span><span class="koboSpan" id="kobo.688.3">We set the following attributes:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.689.1">page_size</span></code><span class="koboSpan" id="kobo.690.1">: Determines the default page size (the number of items returned per page) when no page size is provided in the request</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.691.1">page_size_query_params</span></code><span class="koboSpan" id="kobo.692.1">: Defines the name for the query parameter to use for the page size</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.693.1">max_page_size</span></code><span class="koboSpan" id="kobo.694.1">: Indicates the maximum requested page size allowed</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.695.1">Now, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.696.1">api/views.py</span></code><span class="koboSpan" id="kobo.697.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.698.1">courses</span></code><span class="koboSpan" id="kobo.699.1"> application and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.700.1">from</span></span><span class="koboSpan" id="kobo.701.1"> django.db.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.702.1">import</span></span><span class="koboSpan" id="kobo.703.1"> Count
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.704.1">from</span></span><span class="koboSpan" id="kobo.705.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.706.1">import</span></span><span class="koboSpan" id="kobo.707.1"> generics
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.708.1">from</span></span><span class="koboSpan" id="kobo.709.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.710.1">import</span></span><span class="koboSpan" id="kobo.711.1"> Subject
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.712.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.713.1"> courses.api.pagination </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.714.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.715.1"> StandardPagination</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">from</span></span><span class="koboSpan" id="kobo.717.1"> courses.api.serializers </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.718.1">import</span></span><span class="koboSpan" id="kobo.719.1"> SubjectSerializer
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.720.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.721.1">SubjectListView</span></span><span class="koboSpan" id="kobo.722.1">(generics.ListAPIView):
    queryset = Subject.objects.annotate(total_courses=Count(</span><span class="hljs-string"><span class="koboSpan" id="kobo.723.1">'courses'</span></span><span class="koboSpan" id="kobo.724.1">))
    serializer_class = SubjectSerializer
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.725.1">    pagination_class = StandardPagination</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.726.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.727.1">You can now paginate the </span><a id="_idIndexMarker1385"/><span class="koboSpan" id="kobo.728.1">objects returned by </span><code class="inlineCode"><span class="koboSpan" id="kobo.729.1">SubjectListView</span></code><span class="koboSpan" id="kobo.730.1">. </span><span class="koboSpan" id="kobo.730.2">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.731.1">http://127.0.0.1:8000/api/subjects/</span></code><span class="koboSpan" id="kobo.732.1"> in your browser. </span><span class="koboSpan" id="kobo.732.2">You can see that the JSON structure </span><a id="_idIndexMarker1386"/><span class="koboSpan" id="kobo.733.1">returned by the view is now different due to the pagination. </span><span class="koboSpan" id="kobo.733.2">You will see the following structure:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.734.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.735.1">"count"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.736.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.737.1">4</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.738.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.739.1">"next"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.740.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.742.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.743.1">"previous"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.744.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.745.1">null</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.746.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.747.1">"results"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.748.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.749.1">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.750.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.751.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.752.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.753.1">1</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.754.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.755.1">"title"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.756.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.757.1">"Mathematics"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.758.1">,</span></span><span class="koboSpan" id="kobo.759.1">
            ...
        </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.760.1">},</span></span><span class="koboSpan" id="kobo.761.1">
        ...
    </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.762.1">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.763.1">}</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.764.1">The following items are now part of the JSON returned:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.765.1">count</span></code><span class="koboSpan" id="kobo.766.1">: The total number of results.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.767.1">next</span></code><span class="koboSpan" id="kobo.768.1">: The URL to retrieve the next page. </span><span class="koboSpan" id="kobo.768.2">The value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.769.1">null</span></code><span class="koboSpan" id="kobo.770.1"> when there are no following pages.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.771.1">previous</span></code><span class="koboSpan" id="kobo.772.1">: The URL to retrieve the previous page. </span><span class="koboSpan" id="kobo.772.2">The value is </span><code class="inlineCode"><span class="koboSpan" id="kobo.773.1">null</span></code><span class="koboSpan" id="kobo.774.1"> when there are no previous pages.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.775.1">results</span></code><span class="koboSpan" id="kobo.776.1">: A list with the serialized objects returned on this page.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.777.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.778.1">http://127.0.0.1:8000/api/subjects/?page_size=2&amp;page=1</span></code><span class="koboSpan" id="kobo.779.1"> in your browser. </span><span class="koboSpan" id="kobo.779.2">This will paginate results by two items</span><a id="_idIndexMarker1387"/><span class="koboSpan" id="kobo.780.1"> per page and retrieve the first page of </span><a id="_idIndexMarker1388"/><span class="koboSpan" id="kobo.781.1">results, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.782.1">Figure 15.6</span></em><span class="koboSpan" id="kobo.783.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.784.1"><img alt="" role="presentation" src="../Images/B21088_15_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.785.1">Figure 15.6: First page of results for the subject list pagination, with a page size of 2</span></p>
<p class="normal"><span class="koboSpan" id="kobo.786.1">We have implemented pagination based on the page number, but DRF also provides a class to implement limit/offset and cursor-based pagination. </span><span class="koboSpan" id="kobo.786.2">You can read more about pagination at </span><a href="https://www.django-rest-framework.org/api-guide/pagination/"><span class="url"><span class="koboSpan" id="kobo.787.1">https://www.django-rest-framework.org/api-guide/pagination/</span></span></a><span class="koboSpan" id="kobo.788.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.789.1">You have created the API endpoints for the subject views. </span><span class="koboSpan" id="kobo.789.2">Next, you will add course endpoints to your API.</span></p>
<h1 class="heading-1" id="_idParaDest-407"><span class="koboSpan" id="kobo.790.1">Building the course serializer</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.791.1">We are going to create a </span><a id="_idIndexMarker1389"/><span class="koboSpan" id="kobo.792.1">serializer for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.793.1">Course</span></code><span class="koboSpan" id="kobo.794.1"> model. </span><span class="koboSpan" id="kobo.794.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.795.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.796.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.797.1">courses</span></code><span class="koboSpan" id="kobo.798.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.799.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.800.1">from</span></span><span class="koboSpan" id="kobo.801.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.802.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.803.1">Course, </span></strong></span><span class="koboSpan" id="kobo.804.1">Subject
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.805.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.806.1">CourseSerializer</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.807.1">(serializers.ModelSerializer):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.808.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.809.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.810.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.811.1">        model = Course</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.812.1">        fields = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.813.1">'id'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.814.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.815.1">'subject'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.816.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.817.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.818.1">title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.819.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.820.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.821.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.822.1">'overview'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.823.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.824.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.825.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.826.1">'owner'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.827.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.828.1">'modules'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.829.1">        ]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.830.1">Let’s take a look at how a </span><code class="inlineCode"><span class="koboSpan" id="kobo.831.1">Course</span></code><span class="koboSpan" id="kobo.832.1"> object is serialized. </span><span class="koboSpan" id="kobo.832.2">Open the shell and execute the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.833.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.834.1">Run the following code:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.835.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.836.1">from</span></span><span class="koboSpan" id="kobo.837.1"> rest_framework.renderers </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.838.1">import</span></span><span class="koboSpan" id="kobo.839.1"> JSONRenderer
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.840.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.841.1">from</span></span><span class="koboSpan" id="kobo.842.1"> courses.models </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.843.1">import</span></span><span class="koboSpan" id="kobo.844.1"> Course
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.845.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.846.1">from</span></span><span class="koboSpan" id="kobo.847.1"> courses.api.serializers </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.848.1">import</span></span><span class="koboSpan" id="kobo.849.1"> CourseSerializer
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.850.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.851.1"> course = Course.objects.latest(</span><span class="hljs-con-string"><span class="koboSpan" id="kobo.852.1">'id'</span></span><span class="koboSpan" id="kobo.853.1">)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.854.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.855.1"> serializer = CourseSerializer(course)
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.856.1">&gt;&gt;&gt;</span></span><span class="koboSpan" id="kobo.857.1"> JSONRenderer().render(serializer.data)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.858.1">You will get a JSON object with the fields that you included in </span><code class="inlineCode"><span class="koboSpan" id="kobo.859.1">CourseSerializer</span></code><span class="koboSpan" id="kobo.860.1">. </span><span class="koboSpan" id="kobo.860.2">You can see that the related objects of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.861.1">modules</span></code><span class="koboSpan" id="kobo.862.1"> manager are serialized as a list of primary keys, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.863.1">"modules"</span></span><span class="koboSpan" id="kobo.864.1">: [</span><span class="hljs-number"><span class="koboSpan" id="kobo.865.1">6</span></span><span class="koboSpan" id="kobo.866.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.867.1">7</span></span><span class="koboSpan" id="kobo.868.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.869.1">9</span></span><span class="koboSpan" id="kobo.870.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.871.1">10</span></span><span class="koboSpan" id="kobo.872.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.873.1">These are the IDs of the </span><a id="_idIndexMarker1390"/><span class="koboSpan" id="kobo.874.1">related </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1">Module</span></code><span class="koboSpan" id="kobo.876.1"> objects. </span><span class="koboSpan" id="kobo.876.2">Next, you are going to learn different methods to serialize related objects.</span></p>
<h2 class="heading-2" id="_idParaDest-408"><span class="koboSpan" id="kobo.877.1">Serializing relations</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.878.1">DRF comes with different types of related</span><a id="_idIndexMarker1391"/><span class="koboSpan" id="kobo.879.1"> fields to represent model relationships. </span><span class="koboSpan" id="kobo.879.2">This works for </span><code class="inlineCode"><span class="koboSpan" id="kobo.880.1">ForeignKey</span></code><span class="koboSpan" id="kobo.881.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">ManyToManyField</span></code><span class="koboSpan" id="kobo.883.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">OneToOneField</span></code><span class="koboSpan" id="kobo.885.1"> relationships, as well as generic model relations.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.886.1">We are going to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.887.1">StringRelatedField</span></code><span class="koboSpan" id="kobo.888.1"> to change how related </span><code class="inlineCode"><span class="koboSpan" id="kobo.889.1">Module</span></code><span class="koboSpan" id="kobo.890.1"> objects are serialized. </span><code class="inlineCode"><span class="koboSpan" id="kobo.891.1">StringRelatedField</span></code><span class="koboSpan" id="kobo.892.1"> represents the related object using its </span><code class="inlineCode"><span class="koboSpan" id="kobo.893.1">__str__()</span></code><span class="koboSpan" id="kobo.894.1"> method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.895.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.896.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.897.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.898.1">courses</span></code><span class="koboSpan" id="kobo.899.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.900.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.901.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.902.1">CourseSerializer</span></span><span class="koboSpan" id="kobo.903.1">(serializers.ModelSerializer):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.904.1">    modules = serializers.StringRelatedField(many=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.905.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.906.1">, read_only=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.907.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.908.1">)</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.909.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.910.1">Meta</span></span><span class="koboSpan" id="kobo.911.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.912.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.913.1">In the new code, you define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.914.1">modules</span></code><span class="koboSpan" id="kobo.915.1"> field that provides serialization for the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.916.1">Module</span></code><span class="koboSpan" id="kobo.917.1"> objects. </span><span class="koboSpan" id="kobo.917.2">You use </span><code class="inlineCode"><span class="koboSpan" id="kobo.918.1">many=True</span></code><span class="koboSpan" id="kobo.919.1"> to indicate that you are serializing multiple related objects. </span><span class="koboSpan" id="kobo.919.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.920.1">read_only</span></code><span class="koboSpan" id="kobo.921.1"> parameter indicates that this field is read-only and should not be included in any input to create or update objects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.922.1">Open the shell and create an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.923.1">CourseSerializer</span></code><span class="koboSpan" id="kobo.924.1"> again. </span><span class="koboSpan" id="kobo.924.2">Render the serializer’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.925.1">data</span></code><span class="koboSpan" id="kobo.926.1"> attribute with </span><code class="inlineCode"><span class="koboSpan" id="kobo.927.1">JSONRenderer</span></code><span class="koboSpan" id="kobo.928.1">. </span><span class="koboSpan" id="kobo.928.2">This time, the listed modules are serialized using their </span><code class="inlineCode"><span class="koboSpan" id="kobo.929.1">__str__()</span></code><span class="koboSpan" id="kobo.930.1"> method, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.931.1">"modules"</span></span><span class="koboSpan" id="kobo.932.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.933.1">"0. </span><span class="koboSpan" id="kobo.933.2">Installing Django"</span></span><span class="koboSpan" id="kobo.934.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.935.1">"1. </span><span class="koboSpan" id="kobo.935.2">Configuring Django"</span></span><span class="koboSpan" id="kobo.936.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.937.1">Note that DRF does not optimize QuerySets. </span><span class="koboSpan" id="kobo.937.2">When serializing a list of courses, a SQL query will be generated for each course result to retrieve the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.938.1">Module</span></code><span class="koboSpan" id="kobo.939.1"> objects. </span><span class="koboSpan" id="kobo.939.2">You can reduce the number of additional SQL requests by using </span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1">prefetch_related()</span></code><span class="koboSpan" id="kobo.941.1"> in your QuerySet, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.942.1">Course.objects.prefetch_related('modules')</span></code><span class="koboSpan" id="kobo.943.1">. </span><span class="koboSpan" id="kobo.943.2">We will cover this later in the section </span><em class="italic"><span class="koboSpan" id="kobo.944.1">Creating ViewSets and routers</span></em><span class="koboSpan" id="kobo.945.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.946.1">You can read more about serializer relations at </span><a href="https://www.django-rest-framework.org/api-guide/relations/"><span class="url"><span class="koboSpan" id="kobo.947.1">https://www.django-rest-framework.org/api-guide/relations/</span></span></a><span class="koboSpan" id="kobo.948.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.949.1">Let’s advance further and </span><a id="_idIndexMarker1392"/><span class="koboSpan" id="kobo.950.1">define the serialization of related objects with a nested serializer.</span></p>
<h1 class="heading-1" id="_idParaDest-409"><span class="koboSpan" id="kobo.951.1">Creating nested serializers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.952.1">If we want to include more </span><a id="_idIndexMarker1393"/><span class="koboSpan" id="kobo.953.1">information about each module, we need to serialize </span><code class="inlineCode"><span class="koboSpan" id="kobo.954.1">Module</span></code><span class="koboSpan" id="kobo.955.1"> objects and nest them. </span><span class="koboSpan" id="kobo.955.2">Modify the previous code of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.956.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.957.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.958.1">courses</span></code><span class="koboSpan" id="kobo.959.1"> application to make it look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.960.1">from</span></span><span class="koboSpan" id="kobo.961.1"> django.db.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.962.1">import</span></span><span class="koboSpan" id="kobo.963.1"> Count
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.964.1">from</span></span><span class="koboSpan" id="kobo.965.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.966.1">import</span></span><span class="koboSpan" id="kobo.967.1"> serializers
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.968.1">from</span></span><span class="koboSpan" id="kobo.969.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.970.1">import</span></span><span class="koboSpan" id="kobo.971.1"> Course, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.972.1">Module, </span></strong></span><span class="koboSpan" id="kobo.973.1">Subject
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.974.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.975.1">ModuleSerializer</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.976.1">(serializers.ModelSerializer):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.977.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.978.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.979.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.980.1">        model = Module</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.981.1">        fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.982.1">'order'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.983.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.984.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.985.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.986.1">'description'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.987.1">]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.988.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.989.1">CourseSerializer</span></span><span class="koboSpan" id="kobo.990.1">(serializers.ModelSerializer):
    modules = </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.991.1">ModuleSerializer</span></strong></span><span class="koboSpan" id="kobo.992.1">(many=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.993.1">True</span></span><span class="koboSpan" id="kobo.994.1">, read_only=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.995.1">True</span></span><span class="koboSpan" id="kobo.996.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.997.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.998.1">Meta</span></span><span class="koboSpan" id="kobo.999.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1000.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1001.1">In the new code, you define </span><code class="inlineCode"><span class="koboSpan" id="kobo.1002.1">ModuleSerializer</span></code><span class="koboSpan" id="kobo.1003.1"> to provide serialization for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1004.1">Module</span></code><span class="koboSpan" id="kobo.1005.1"> model. </span><span class="koboSpan" id="kobo.1005.2">Then, you modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1006.1">modules</span></code><span class="koboSpan" id="kobo.1007.1"> attribute of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1008.1">CourseSerializer</span></code><span class="koboSpan" id="kobo.1009.1"> to nest the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1010.1">ModuleSerializer</span></code><span class="koboSpan" id="kobo.1011.1"> serializer. </span><span class="koboSpan" id="kobo.1011.2">You keep </span><code class="inlineCode"><span class="koboSpan" id="kobo.1012.1">many=True</span></code><span class="koboSpan" id="kobo.1013.1"> to indicate that you are serializing multiple objects and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1014.1">read_only=True</span></code><span class="koboSpan" id="kobo.1015.1"> to keep this field read-only.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1016.1">Open the shell and create an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1017.1">CourseSerializer</span></code><span class="koboSpan" id="kobo.1018.1"> again. </span><span class="koboSpan" id="kobo.1018.2">Render the serializer’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1019.1">data</span></code><span class="koboSpan" id="kobo.1020.1"> attribute</span><a id="_idIndexMarker1394"/><span class="koboSpan" id="kobo.1021.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1022.1">JSONRenderer</span></code><span class="koboSpan" id="kobo.1023.1">. </span><span class="koboSpan" id="kobo.1023.2">This time, the listed modules are serialized with the nested </span><code class="inlineCode"><span class="koboSpan" id="kobo.1024.1">ModuleSerializer</span></code><span class="koboSpan" id="kobo.1025.1"> serializer, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1026.1">"modules"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1027.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1028.1">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1029.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1030.1">"order"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1031.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1032.1">0</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1033.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1034.1">"title"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1035.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1036.1">"Introduction to overview"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1037.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1038.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1039.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1040.1">"A brief overview about the Web Framework."</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1041.1">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1042.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1043.1">"order"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1044.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1045.1">1</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1046.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1047.1">"title"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1048.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1049.1">"Configuring Django"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1050.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1051.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1052.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1053.1">"How to install Django."</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1054.1">},</span></span><span class="koboSpan" id="kobo.1055.1">
    ...
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1056.1">]</span></span>
</code></pre>
<h1 class="heading-1" id="_idParaDest-410"><span class="koboSpan" id="kobo.1057.1">Creating ViewSets and routers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1058.1">ViewSets allow you to define the</span><a id="_idIndexMarker1395"/><span class="koboSpan" id="kobo.1059.1"> interactions of your API and let DRF build URLs dynamically with</span><a id="_idIndexMarker1396"/><span class="koboSpan" id="kobo.1060.1"> a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1061.1">Router</span></code><span class="koboSpan" id="kobo.1062.1"> object. </span><span class="koboSpan" id="kobo.1062.2">By using ViewSets, you can avoid repeating logic for multiple views. </span><span class="koboSpan" id="kobo.1062.3">ViewSets include actions for the following standard operations:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1063.1">Create operation: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1064.1">create()</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1065.1">Retrieve operation: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1066.1">list()</span></code><span class="koboSpan" id="kobo.1067.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1068.1">retrieve()</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1069.1">Update operation: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1070.1">update()</span></code><span class="koboSpan" id="kobo.1071.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1072.1">partial_update()</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1073.1">Delete operation: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1074.1">destroy()</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1075.1">Let’s create a ViewSet for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1076.1">Course</span></code><span class="koboSpan" id="kobo.1077.1"> model. </span><span class="koboSpan" id="kobo.1077.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1">api/views.py</span></code><span class="koboSpan" id="kobo.1079.1"> file and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1080.1">from</span></span><span class="koboSpan" id="kobo.1081.1"> django.db.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1082.1">import</span></span><span class="koboSpan" id="kobo.1083.1"> Count
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1084.1">from</span></span><span class="koboSpan" id="kobo.1085.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1086.1">import</span></span><span class="koboSpan" id="kobo.1087.1"> generics
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1088.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1089.1"> rest_framework </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1090.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1091.1"> viewsets</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1092.1">from</span></span><span class="koboSpan" id="kobo.1093.1"> courses.api.pagination </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1094.1">import</span></span><span class="koboSpan" id="kobo.1095.1"> StandardPagination
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1096.1">from</span></span><span class="koboSpan" id="kobo.1097.1"> courses.api.serializers </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1098.1">import</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1099.1"> CourseSerializer,</span></strong></span><span class="koboSpan" id="kobo.1100.1"> SubjectSerializer
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1101.1">from</span></span><span class="koboSpan" id="kobo.1102.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1103.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1104.1">Course, </span></strong></span><span class="koboSpan" id="kobo.1105.1">Subject
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1106.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1107.1">CourseViewSet</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1108.1">(viewsets.ReadOnlyModelViewSet):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1109.1">    queryset = Course.objects.prefetch_related(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1110.1">'modules'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1111.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1112.1">    serializer_class = CourseSerializer</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1113.1">    pagination_class = StandardPagination</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1114.1">The new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1115.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.1116.1"> class inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1117.1">ReadOnlyModelViewSet</span></code><span class="koboSpan" id="kobo.1118.1">, which provides the read-only actions </span><code class="inlineCode"><span class="koboSpan" id="kobo.1119.1">list()</span></code><span class="koboSpan" id="kobo.1120.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1121.1">retrieve()</span></code><span class="koboSpan" id="kobo.1122.1"> to list objects or retrieve a single object, respectively. </span><span class="koboSpan" id="kobo.1122.2">You specify the base QuerySet to retrieve </span><a id="_idIndexMarker1397"/><span class="koboSpan" id="kobo.1123.1">objects. </span><span class="koboSpan" id="kobo.1123.2">You use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1124.1">prefetch_related('modules')</span></code><span class="koboSpan" id="kobo.1125.1"> to fetch the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.1126.1">Module</span></code><span class="koboSpan" id="kobo.1127.1"> objects in an efficient manner. </span><span class="koboSpan" id="kobo.1127.2">This will avoid additional SQL queries </span><a id="_idIndexMarker1398"/><span class="koboSpan" id="kobo.1128.1">when serializing nested modules for each course. </span><span class="koboSpan" id="kobo.1128.2">In this class, you also define the serializer and pagination classes to use for the ViewSet.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1129.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1130.1">api/urls.py</span></code><span class="koboSpan" id="kobo.1131.1"> file and create a router for your ViewSet, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1132.1">from</span></span><span class="koboSpan" id="kobo.1133.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1134.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1135.1">include, </span></strong></span><span class="koboSpan" id="kobo.1136.1">path
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1137.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1138.1"> rest_framework </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1139.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1140.1"> routers</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1141.1">from</span></span><span class="koboSpan" id="kobo.1142.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1143.1">import</span></span><span class="koboSpan" id="kobo.1144.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1145.1">'courses'</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1146.1">router = routers.DefaultRouter()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1147.1">router.register(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1148.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1149.1">courses'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1150.1">, views.CourseViewSet)</span></strong></span><span class="koboSpan" id="kobo.1151.1">
urlpatterns = [
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1152.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1153.1">path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1154.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1155.1">, include(router.urls)),</span></strong></span><span class="koboSpan" id="kobo.1156.1">
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1157.1">You create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1158.1">DefaultRouter</span></code><span class="koboSpan" id="kobo.1159.1"> object and register </span><code class="inlineCode"><span class="koboSpan" id="kobo.1160.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.1161.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1162.1">courses</span></code><span class="koboSpan" id="kobo.1163.1"> prefix. </span><span class="koboSpan" id="kobo.1163.2">The router takes charge of generating URLs automatically for your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1164.1">ViewSet</span></code><span class="koboSpan" id="kobo.1165.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1166.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1167.1">http://127.0.0.1:8000/api/</span></code><span class="koboSpan" id="kobo.1168.1"> in your browser. </span><span class="koboSpan" id="kobo.1168.2">You will see that the router lists the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">courses</span></code><span class="koboSpan" id="kobo.1170.1"> ViewSet in its base URL, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1171.1">Figure 15.7</span></em><span class="koboSpan" id="kobo.1172.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1173.1"><img alt="Graphical user interface, text, application, email  Description automatically generated" src="../Images/B21088_15_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1174.1">Figure 15.7: The API Root page of the REST framework browsable API</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1175.1">You can access </span><code class="inlineCode"><span class="koboSpan" id="kobo.1176.1">http://127.0.0.1:8000/api/courses/</span></code><span class="koboSpan" id="kobo.1177.1"> to retrieve</span><a id="_idIndexMarker1399"/><span class="koboSpan" id="kobo.1178.1"> the list of courses, as </span><a id="_idIndexMarker1400"/><span class="koboSpan" id="kobo.1179.1">shown in </span><em class="italic"><span class="koboSpan" id="kobo.1180.1">Figure 15.8</span></em><span class="koboSpan" id="kobo.1181.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1182.1"><img alt="" role="presentation" src="../Images/B21088_15_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1183.1">Figure 15.8: The Course List page in the REST framework browsable API</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1184.1">Let’s convert the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1">SubjectListView</span></code><span class="koboSpan" id="kobo.1186.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1187.1">SubjectDetailView</span></code><span class="koboSpan" id="kobo.1188.1"> views into a single ViewSet. </span><span class="koboSpan" id="kobo.1188.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1189.1">api/views.py</span></code><span class="koboSpan" id="kobo.1190.1"> file, and remove </span><a id="_idIndexMarker1401"/><span class="koboSpan" id="kobo.1191.1">or comment out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1192.1">SubjectListView</span></code><span class="koboSpan" id="kobo.1193.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1194.1">SubjectDetailView</span></code><span class="koboSpan" id="kobo.1195.1"> classes. </span><span class="koboSpan" id="kobo.1195.2">Then, add</span><a id="_idIndexMarker1402"/><span class="koboSpan" id="kobo.1196.1"> the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1197.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1198.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1199.1">SubjectViewSet</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1200.1">(viewsets.ReadOnlyModelViewSet):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1201.1">    queryset = Subject.objects.annotate(total_courses=Count(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1202.1">'courses'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1203.1">))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1204.1">    serializer_class = SubjectSerializer</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1205.1">    pagination_class = StandardPagination</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1206.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1207.1">api/urls.py</span></code><span class="koboSpan" id="kobo.1208.1"> file and</span><a id="_idIndexMarker1403"/><span class="koboSpan" id="kobo.1209.1"> remove or comment out the following URLs, since you don’t need </span><a id="_idIndexMarker1404"/><span class="koboSpan" id="kobo.1210.1">them anymore:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1211.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1212.1">path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1213.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1214.1">    subjects/',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1215.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1216.1">    views.SubjectListView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1217.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1218.1">    name=subject_list'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1219.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1220.1">),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1221.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1222.1">path(</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1223.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1224.1">    subjects/&lt;pk&gt;/ ',</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1225.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1226.1">     views.SubjectDetailView.as_view(),</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1227.1"># </span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1228.1">     name='subject_detail'</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1229.1">#</span></strong></span><span class="hljs-comment"><span class="koboSpan" id="kobo.1230.1">),</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1231.1">In the same file, add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1232.1">from</span></span><span class="koboSpan" id="kobo.1233.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1234.1">import</span></span><span class="koboSpan" id="kobo.1235.1"> include, path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1236.1">from</span></span><span class="koboSpan" id="kobo.1237.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1238.1">import</span></span><span class="koboSpan" id="kobo.1239.1"> routers
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1240.1">from</span></span><span class="koboSpan" id="kobo.1241.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1242.1">import</span></span><span class="koboSpan" id="kobo.1243.1"> views
app_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1244.1">'courses'</span></span><span class="koboSpan" id="kobo.1245.1">
router = routers.DefaultRouter()
router.register(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1246.1">'courses'</span></span><span class="koboSpan" id="kobo.1247.1">, views.CourseViewSet)
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1248.1">router.register(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1249.1">'subjects'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1250.1">, views.SubjectViewSet)</span></strong></span><span class="koboSpan" id="kobo.1251.1">
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1252.1">''</span></span><span class="koboSpan" id="kobo.1253.1">, include(router.urls)),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1254.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1255.1">http://127.0.0.1:8000/api/</span></code><span class="koboSpan" id="kobo.1256.1"> in your browser. </span><span class="koboSpan" id="kobo.1256.2">You will see that the router now includes URLs for both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1257.1">courses</span></code><span class="koboSpan" id="kobo.1258.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1259.1">subjects</span></code><span class="koboSpan" id="kobo.1260.1"> ViewSets, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1261.1">Figure 15.9</span></em><span class="koboSpan" id="kobo.1262.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1263.1"><img alt="" role="presentation" src="../Images/B21088_15_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1264.1">Figure 15.9: The API Root page of the REST framework browsable API</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1265.1">You can learn more about ViewSets at </span><a href="https://www.django-rest-framework.org/api-guide/viewsets/"><span class="url"><span class="koboSpan" id="kobo.1266.1">https://www.django-rest-framework.org/api-guide/viewsets/</span></span></a><span class="koboSpan" id="kobo.1267.1">. </span><span class="koboSpan" id="kobo.1267.2">You can also find more information about routers at </span><a href="https://www.django-rest-framework.org/api-guide/routers/"><span class="url"><span class="koboSpan" id="kobo.1268.1">https://www.django-rest-framework.org/api-guide/routers/</span></span></a><span class="koboSpan" id="kobo.1269.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1270.1">Generic API views and ViewSets are</span><a id="_idIndexMarker1405"/><span class="koboSpan" id="kobo.1271.1"> very useful to build REST APIs based on your models and serializers. </span><span class="koboSpan" id="kobo.1271.2">However, you</span><a id="_idIndexMarker1406"/><span class="koboSpan" id="kobo.1272.1"> might also need to implement your own views with custom logic. </span><span class="koboSpan" id="kobo.1272.2">Let’s learn how to create a custom API view.</span></p>
<h1 class="heading-1" id="_idParaDest-411"><span class="koboSpan" id="kobo.1273.1">Building custom API views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1274.1">DRF provides an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1275.1">APIView</span></code><span class="koboSpan" id="kobo.1276.1"> class that</span><a id="_idIndexMarker1407"/><span class="koboSpan" id="kobo.1277.1"> builds API functionality on top of Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1">View</span></code><span class="koboSpan" id="kobo.1279.1"> class. </span><span class="koboSpan" id="kobo.1279.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1280.1">APIView</span></code><span class="koboSpan" id="kobo.1281.1"> class differs from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1282.1">View</span></code><span class="koboSpan" id="kobo.1283.1"> by using DRF’s custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.1284.1">Request</span></code><span class="koboSpan" id="kobo.1285.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1286.1">Response</span></code><span class="koboSpan" id="kobo.1287.1"> objects and handling </span><code class="inlineCode"><span class="koboSpan" id="kobo.1288.1">APIException</span></code><span class="koboSpan" id="kobo.1289.1"> exceptions to return the appropriate HTTP responses. </span><span class="koboSpan" id="kobo.1289.2">It also has a built-in authentication and authorization system to manage access to views.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1290.1">You are going to create a view for users to enroll in courses. </span><span class="koboSpan" id="kobo.1290.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1291.1">api/views.py</span></code><span class="koboSpan" id="kobo.1292.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1293.1">courses</span></code><span class="koboSpan" id="kobo.1294.1"> application and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1295.1">from</span></span><span class="koboSpan" id="kobo.1296.1"> django.db.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1297.1">import</span></span><span class="koboSpan" id="kobo.1298.1"> Count
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1299.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1300.1"> django.shortcuts </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1301.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1302.1"> get_object_or_404</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1303.1">from</span></span><span class="koboSpan" id="kobo.1304.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1305.1">import</span></span><span class="koboSpan" id="kobo.1306.1"> generics
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1307.1">from</span></span><span class="koboSpan" id="kobo.1308.1"> rest_framework </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1309.1">import</span></span><span class="koboSpan" id="kobo.1310.1"> viewsets
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1311.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1312.1"> rest_framework.response </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1313.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1314.1"> Response</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1315.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1316.1"> rest_framework.views </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1317.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1318.1"> APIView</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1319.1">from</span></span><span class="koboSpan" id="kobo.1320.1"> courses.api.pagination </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1321.1">import</span></span><span class="koboSpan" id="kobo.1322.1"> StandardPagination
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1323.1">from</span></span><span class="koboSpan" id="kobo.1324.1"> courses.api.serializers </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1325.1">import</span></span><span class="koboSpan" id="kobo.1326.1"> CourseSerializer, SubjectSerializer
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1327.1">from</span></span><span class="koboSpan" id="kobo.1328.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1329.1">import</span></span><span class="koboSpan" id="kobo.1330.1"> Course, Subject
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1331.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1332.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1333.1">CourseEnrollView</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1334.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1335.1">APIView</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1336.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1337.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1338.1">post</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1339.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1340.1">self, request, pk, </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1341.1">format</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1342.1">=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1343.1">None</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1344.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1345.1">        course = get_object_or_404(Course, pk=pk)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1346.1">        course.students.add(request.user)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1347.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1348.1"> Response({</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1349.1">'enrolled'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1350.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1351.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1352.1">})</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1353.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1354.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.1355.1"> view </span><a id="_idIndexMarker1408"/><span class="koboSpan" id="kobo.1356.1">handles user enrollment in courses. </span><span class="koboSpan" id="kobo.1356.2">The preceding code is as follows:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1357.1">You create a custom view that subclasses </span><code class="inlineCode"><span class="koboSpan" id="kobo.1358.1">APIView</span></code><span class="koboSpan" id="kobo.1359.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1360.1">You define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1361.1">post()</span></code><span class="koboSpan" id="kobo.1362.1"> method for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1363.1">POST</span></code><span class="koboSpan" id="kobo.1364.1"> actions. </span><span class="koboSpan" id="kobo.1364.2">No other HTTP method will be allowed for this view.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1365.1">You expect a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1366.1">pk</span></code><span class="koboSpan" id="kobo.1367.1"> URL parameter containing the ID of a course. </span><span class="koboSpan" id="kobo.1367.2">You retrieve the course by the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.1368.1">pk</span></code><span class="koboSpan" id="kobo.1369.1"> parameter and raise a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1370.1">404</span></code><span class="koboSpan" id="kobo.1371.1"> exception if it’s not found.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1372.1">You add the current user to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1373.1">students</span></code><span class="koboSpan" id="kobo.1374.1"> many-to-many relationship of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1375.1">Course</span></code><span class="koboSpan" id="kobo.1376.1"> object and return a successful response.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1377.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1378.1">api/urls.py</span></code><span class="koboSpan" id="kobo.1379.1"> file and add the following URL pattern to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1380.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.1381.1"> view:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1382.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1383.1">'courses/&lt;pk&gt;/enroll/'</span></span><span class="koboSpan" id="kobo.1384.1">,
    views.CourseEnrollView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1385.1">'course_enroll'</span></span><span class="koboSpan" id="kobo.1386.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1387.1">Theoretically, you could now perform a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1388.1">POST</span></code><span class="koboSpan" id="kobo.1389.1"> request to enroll the current user in a course. </span><span class="koboSpan" id="kobo.1389.2">However, you need to be able to identify the user and prevent unauthenticated users from accessing this view. </span><span class="koboSpan" id="kobo.1389.3">Let’s</span><a id="_idIndexMarker1409"/><span class="koboSpan" id="kobo.1390.1"> see how API authentication and permissions work.</span></p>
<h1 class="heading-1" id="_idParaDest-412"><span class="koboSpan" id="kobo.1391.1">Handling authentication</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1392.1">DRF provides authentication classes to identify the user performing the request. </span><span class="koboSpan" id="kobo.1392.2">If authentication is successful, the framework sets the authenticated </span><code class="inlineCode"><span class="koboSpan" id="kobo.1393.1">User</span></code><span class="koboSpan" id="kobo.1394.1"> object in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1395.1">request.user</span></code><span class="koboSpan" id="kobo.1396.1">. </span><span class="koboSpan" id="kobo.1396.2">If no user is </span><a id="_idIndexMarker1410"/><span class="koboSpan" id="kobo.1397.1">authenticated, an instance of Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1398.1">AnonymousUser</span></code><span class="koboSpan" id="kobo.1399.1"> is set instead.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1400.1">DRF provides the following authentication backends:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1401.1">BasicAuthentication</span></code><span class="koboSpan" id="kobo.1402.1">: This is HTTP basic authentication. </span><span class="koboSpan" id="kobo.1402.2">The user and password are sent by the client in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1403.1">Authorization</span></code><span class="koboSpan" id="kobo.1404.1"> HTTP header, encoded with Base64. </span><span class="koboSpan" id="kobo.1404.2">You can learn more about it at </span><a href="https://en.wikipedia.org/wiki/Basic_access_authentication"><span class="url"><span class="koboSpan" id="kobo.1405.1">https://en.wikipedia.org/wiki/Basic_access_authentication</span></span></a><span class="koboSpan" id="kobo.1406.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1407.1">TokenAuthentication</span></code><span class="koboSpan" id="kobo.1408.1">: This is token-based authentication. </span><span class="koboSpan" id="kobo.1408.2">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1409.1">Token</span></code><span class="koboSpan" id="kobo.1410.1"> model is used to store user tokens. </span><span class="koboSpan" id="kobo.1410.2">Users include the token in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1411.1">Authorization</span></code><span class="koboSpan" id="kobo.1412.1"> HTTP header for authentication.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1413.1">SessionAuthentication</span></code><span class="koboSpan" id="kobo.1414.1">: This uses Django’s session backend for authentication. </span><span class="koboSpan" id="kobo.1414.2">This backend is useful for performing authenticated AJAX requests to the API from your website’s frontend.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1415.1">RemoteUserAuthentication</span></code><span class="koboSpan" id="kobo.1416.1">: This allows you to delegate authentication to your web server, which sets a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1417.1">REMOTE_USER</span></code><span class="koboSpan" id="kobo.1418.1"> environment variable.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1419.1">You can build a custom authentication backend by subclassing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1420.1">BaseAuthentication</span></code><span class="koboSpan" id="kobo.1421.1"> class provided by DRF and overriding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1422.1">authenticate()</span></code><span class="koboSpan" id="kobo.1423.1"> method.</span></p>
<h2 class="heading-2" id="_idParaDest-413"><span class="koboSpan" id="kobo.1424.1">Implementing basic authentication</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1425.1">You can set authentication on a per-view </span><a id="_idIndexMarker1411"/><span class="koboSpan" id="kobo.1426.1">basis or set it globally with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1427.1">DEFAULT_AUTHENTICATION_CLASSES</span></code><span class="koboSpan" id="kobo.1428.1"> setting.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1429.1">Authentication only identifies the user performing the request. </span><span class="koboSpan" id="kobo.1429.2">It won’t allow or deny access to views. </span><span class="koboSpan" id="kobo.1429.3">You have to use permissions to restrict access to views.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1430.1">You can find all the information about authentication at </span><a href="https://www.django-rest-framework.org/api-guide/authentication/"><span class="url"><span class="koboSpan" id="kobo.1431.1">https://www.django-rest-framework.org/api-guide/authentication/</span></span></a><span class="koboSpan" id="kobo.1432.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1433.1">Let’s add </span><code class="inlineCode"><span class="koboSpan" id="kobo.1434.1">BasicAuthentication</span></code><span class="koboSpan" id="kobo.1435.1"> to your view. </span><span class="koboSpan" id="kobo.1435.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1436.1">api/views.py</span></code><span class="koboSpan" id="kobo.1437.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1438.1">courses</span></code><span class="koboSpan" id="kobo.1439.1"> application and add an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1440.1">authentication_classes</span></code><span class="koboSpan" id="kobo.1441.1"> attribute to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1442.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.1443.1">, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1444.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1445.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1446.1"> rest_framework.authentication </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1447.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1448.1"> BasicAuthentication</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1449.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1450.1">CourseEnrollView</span></span><span class="koboSpan" id="kobo.1451.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1452.1">APIView</span></span><span class="koboSpan" id="kobo.1453.1">):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1454.1">    authentication_classes = [BasicAuthentication]</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1455.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1456.1">Users will be identified by</span><a id="_idIndexMarker1412"/><span class="koboSpan" id="kobo.1457.1"> the credentials set in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1458.1">Authorization</span></code><span class="koboSpan" id="kobo.1459.1"> header of the HTTP request.</span></p>
<h1 class="heading-1" id="_idParaDest-414"><span class="koboSpan" id="kobo.1460.1">Adding permissions to views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1461.1">DRF includes a permission </span><a id="_idIndexMarker1413"/><span class="koboSpan" id="kobo.1462.1">system to restrict access to views. </span><span class="koboSpan" id="kobo.1462.2">Some of the built-in permissions of DRF are:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1463.1">AllowAny</span></code><span class="koboSpan" id="kobo.1464.1">: Unrestricted access, regardless of whether a user is authenticated or not.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1465.1">IsAuthenticated</span></code><span class="koboSpan" id="kobo.1466.1">: Allows access to authenticated users only.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1467.1">IsAuthenticatedOrReadOnly</span></code><span class="koboSpan" id="kobo.1468.1">: Complete access to authenticated users. </span><span class="koboSpan" id="kobo.1468.2">Anonymous users are only allowed to execute read methods such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1">GET</span></code><span class="koboSpan" id="kobo.1470.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1471.1">HEAD</span></code><span class="koboSpan" id="kobo.1472.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1473.1">OPTIONS</span></code><span class="koboSpan" id="kobo.1474.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1475.1">DjangoModelPermissions</span></code><span class="koboSpan" id="kobo.1476.1">: Permissions tied to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1477.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.1478.1">. </span><span class="koboSpan" id="kobo.1478.2">The view requires a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1479.1">queryset</span></code><span class="koboSpan" id="kobo.1480.1"> attribute. </span><span class="koboSpan" id="kobo.1480.2">Only authenticated users with model permissions assigned are granted permission.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1481.1">DjangoObjectPermissions</span></code><span class="koboSpan" id="kobo.1482.1">: Django permissions on a per-object basis.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1483.1">If users are denied permission, they will usually get one of the following HTTP error codes:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">HTTP 401</span></code><span class="koboSpan" id="kobo.1485.1">: Unauthorized</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">HTTP 403</span></code><span class="koboSpan" id="kobo.1487.1">: Permission denied</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1488.1">You can read more information about permissions at </span><a href="https://www.django-rest-framework.org/api-guide/permissions/"><span class="url"><span class="koboSpan" id="kobo.1489.1">https://www.django-rest-framework.org/api-guide/permissions/</span></span></a><span class="koboSpan" id="kobo.1490.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1491.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1492.1">api/views.py</span></code><span class="koboSpan" id="kobo.1493.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1494.1">courses</span></code><span class="koboSpan" id="kobo.1495.1"> application and add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1496.1">permission_classes</span></code><span class="koboSpan" id="kobo.1497.1"> attribute to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1498.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.1499.1">, as</span><a id="_idIndexMarker1414"/><span class="koboSpan" id="kobo.1500.1"> follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1501.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1502.1">from</span></span><span class="koboSpan" id="kobo.1503.1"> rest_framework.authentication </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1504.1">import</span></span><span class="koboSpan" id="kobo.1505.1"> BasicAuthentication
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1506.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1507.1"> rest_framework.permissions </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1508.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1509.1"> IsAuthenticated</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1510.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1511.1">CourseEnrollView</span></span><span class="koboSpan" id="kobo.1512.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1513.1">APIView</span></span><span class="koboSpan" id="kobo.1514.1">):
    authentication_classes = [BasicAuthentication]
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1515.1">    permission_classes = [IsAuthenticated]</span></strong></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1516.1"># ...</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1517.1">You include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1518.1">IsAuthenticated</span></code><span class="koboSpan" id="kobo.1519.1"> permission. </span><span class="koboSpan" id="kobo.1519.2">This will prevent anonymous users from accessing the view. </span><span class="koboSpan" id="kobo.1519.3">Now, you can perform a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1520.1">POST</span></code><span class="koboSpan" id="kobo.1521.1"> request to your new API method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1522.1">Make sure the development server is running. </span><span class="koboSpan" id="kobo.1522.2">Open the shell and run the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1523.1">curl -i -X POST http://127.0.0.1:8000/api/courses/1/enroll/
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1524.1">You will get the following response:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1525.1">HTTP/1.1 401 Unauthorized
...
</span><span class="koboSpan" id="kobo.1525.2">{"detail": "Authentication credentials were not provided."}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1526.1">You got a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1527.1">401</span></code><span class="koboSpan" id="kobo.1528.1"> HTTP code as expected, since you are not authenticated. </span><span class="koboSpan" id="kobo.1528.2">Let’s use basic authentication with one of your users. </span><span class="koboSpan" id="kobo.1528.3">Run the following command, replacing </span><code class="inlineCode"><span class="koboSpan" id="kobo.1529.1">student:password</span></code><span class="koboSpan" id="kobo.1530.1"> with the credentials of an existing user:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1531.1">curl -i -X POST -u student:password http://127.0.0.1:8000/api/courses/1/enroll/
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1532.1">You will get the following response:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1533.1">HTTP/1.1 200 OK
...
</span><span class="koboSpan" id="kobo.1533.2">{"enrolled": true}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1534.1">You can access the administration site and check that the user is now enrolled in the course.</span></p>
<h1 class="heading-1" id="_idParaDest-415"><span class="koboSpan" id="kobo.1535.1">Adding additional actions to ViewSets</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1536.1">You can add extra actions to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1537.1">ViewSets</span></code><span class="koboSpan" id="kobo.1538.1">. </span><span class="koboSpan" id="kobo.1538.2">Let’s change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1539.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.1540.1"> view into a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.1541.1">ViewSet</span></code><span class="koboSpan" id="kobo.1542.1"> action. </span><span class="koboSpan" id="kobo.1542.2">Edit</span><a id="_idIndexMarker1415"/><span class="koboSpan" id="kobo.1543.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1544.1">api/views.py</span></code><span class="koboSpan" id="kobo.1545.1"> file and modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1546.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.1547.1"> class to look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1548.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1549.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1550.1"> rest_framework.decorators </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1551.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1552.1"> action</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1553.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1554.1">CourseViewSet</span></span><span class="koboSpan" id="kobo.1555.1">(viewsets.ReadOnlyModelViewSet):
    queryset = Course.objects.prefetch_related(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1556.1">'modules'</span></span><span class="koboSpan" id="kobo.1557.1">)
    serializer_class = CourseSerializer
</span><span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1558.1">    @action(</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1559.1">detail=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1560.1">True</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1561.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1562.1">methods=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1563.1">'post'</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1564.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1565.1">authentication_classes=[BasicAuthentication],</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1566.1">permission_classes=[IsAuthenticated]</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1567.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1568.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1569.1">enroll</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1570.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1571.1">self, request, *args, **kwargs</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1572.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1573.1">        course = self.get_object()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1574.1">        course.students.add(request.user)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1575.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1576.1"> Response({</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1577.1">'enrolled'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1578.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1579.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1580.1">})</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1581.1">In the preceding code, you add a custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.1582.1">enroll()</span></code><span class="koboSpan" id="kobo.1583.1"> method that represents an additional action for this </span><code class="inlineCode"><span class="koboSpan" id="kobo.1584.1">ViewSet</span></code><span class="koboSpan" id="kobo.1585.1">. </span><span class="koboSpan" id="kobo.1585.2">The preceding code is as follows:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1586.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1587.1">action</span></code><span class="koboSpan" id="kobo.1588.1"> decorator of the framework with the parameter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1589.1">detail=True</span></code><span class="koboSpan" id="kobo.1590.1"> to specify that this is an action to be performed on a single object.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1591.1">The decorator allows you to add custom attributes for the action. </span><span class="koboSpan" id="kobo.1591.2">You specify that only the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1592.1">post()</span></code><span class="koboSpan" id="kobo.1593.1"> method is allowed for this view and set the authentication and permission classes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1594.1">You use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1595.1">self.get_object()</span></code><span class="koboSpan" id="kobo.1596.1"> to retrieve the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1597.1">Course</span></code><span class="koboSpan" id="kobo.1598.1"> object.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1599.1">You add the current user to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1600.1">students</span></code><span class="koboSpan" id="kobo.1601.1"> many-to-many relationship and return a custom success response.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1602.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1603.1">api/urls.py</span></code><span class="koboSpan" id="kobo.1604.1"> file and remove or comment out the following URL, since you don’t need it anymore:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1605.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1606.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1607.1">courses/&lt;pk&gt;/enroll/'</span></span><span class="koboSpan" id="kobo.1608.1">,
    views.CourseEnrollView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1609.1">'course_enroll'</span></span><span class="koboSpan" id="kobo.1610.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1611.1">Then, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1612.1">api/views.py</span></code><span class="koboSpan" id="kobo.1613.1"> file and remove or comment out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1614.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.1615.1"> class.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1616.1">The URL to enroll on courses is now automatically generated by the router. </span><span class="koboSpan" id="kobo.1616.2">The URL remains the same, since it’s built dynamically using the action name </span><code class="inlineCode"><span class="koboSpan" id="kobo.1617.1">enroll</span></code><span class="koboSpan" id="kobo.1618.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1619.1">After students are enrolled in a</span><a id="_idIndexMarker1416"/><span class="koboSpan" id="kobo.1620.1"> course, they need to access the course’s content. </span><span class="koboSpan" id="kobo.1620.2">Next, you are going to learn how to ensure only students who have enrolled can access the course.</span></p>
<h1 class="heading-1" id="_idParaDest-416"><span class="koboSpan" id="kobo.1621.1">Creating custom permissions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1622.1">You want students to be able to access the contents of the courses they are enrolled on. </span><span class="koboSpan" id="kobo.1622.2">Only students enrolled on a course </span><a id="_idIndexMarker1417"/><span class="koboSpan" id="kobo.1623.1">should be able to access its contents. </span><span class="koboSpan" id="kobo.1623.2">The best way to do this is with a custom permission class. </span><span class="koboSpan" id="kobo.1623.3">DRF provides a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1624.1">BasePermission</span></code><span class="koboSpan" id="kobo.1625.1"> class that allows you to define the following methods:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1626.1">has_permission()</span></code><span class="koboSpan" id="kobo.1627.1">: A view-level permission check</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1628.1">has_object_permission()</span></code><span class="koboSpan" id="kobo.1629.1">: An instance-level permission check</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1630.1">These methods should return </span><code class="inlineCode"><span class="koboSpan" id="kobo.1631.1">True</span></code><span class="koboSpan" id="kobo.1632.1"> to grant access, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1633.1">False</span></code><span class="koboSpan" id="kobo.1634.1"> otherwise.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1635.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1636.1">courses/api/</span></code><span class="koboSpan" id="kobo.1637.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1638.1">permissions.py</span></code><span class="koboSpan" id="kobo.1639.1">. </span><span class="koboSpan" id="kobo.1639.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1640.1">from</span></span><span class="koboSpan" id="kobo.1641.1"> rest_framework.permissions </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1642.1">import</span></span><span class="koboSpan" id="kobo.1643.1"> BasePermission
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1644.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1645.1">IsEnrolled</span></span><span class="koboSpan" id="kobo.1646.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1647.1">BasePermission</span></span><span class="koboSpan" id="kobo.1648.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1649.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1650.1">has_object_permission</span></span><span class="koboSpan" id="kobo.1651.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1652.1">self, request, view, obj</span></span><span class="koboSpan" id="kobo.1653.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1654.1">return</span></span><span class="koboSpan" id="kobo.1655.1"> obj.students.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1656.1">filter</span></span><span class="koboSpan" id="kobo.1657.1">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1658.1">id</span></span><span class="koboSpan" id="kobo.1659.1">=request.user.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1660.1">id</span></span><span class="koboSpan" id="kobo.1661.1">).exists()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1662.1">You subclass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1663.1">BasePermission</span></code><span class="koboSpan" id="kobo.1664.1"> class and override the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1665.1">has_object_permission()</span></code><span class="koboSpan" id="kobo.1666.1">. </span><span class="koboSpan" id="kobo.1666.2">You check that the user performing the request is present in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1667.1">students</span></code><span class="koboSpan" id="kobo.1668.1"> relationship of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1669.1">Course</span></code><span class="koboSpan" id="kobo.1670.1"> object. </span><span class="koboSpan" id="kobo.1670.2">You are going to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1671.1">IsEnrolled</span></code><span class="koboSpan" id="kobo.1672.1"> permission next.</span></p>
<h1 class="heading-1" id="_idParaDest-417"><span class="koboSpan" id="kobo.1673.1">Serializing course contents</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1674.1">You need to serialize course contents. </span><span class="koboSpan" id="kobo.1674.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1675.1">Content</span></code><span class="koboSpan" id="kobo.1676.1"> model includes a generic foreign key that allows you to associate</span><a id="_idIndexMarker1418"/><span class="koboSpan" id="kobo.1677.1"> objects of different content models. </span><span class="koboSpan" id="kobo.1677.2">Yet, you added a common </span><code class="inlineCode"><span class="koboSpan" id="kobo.1678.1">render()</span></code><span class="koboSpan" id="kobo.1679.1"> method for all content models in the previous chapter. </span><span class="koboSpan" id="kobo.1679.2">You can use this method to provide rendered content to your API.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1680.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1681.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.1682.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1683.1">courses</span></code><span class="koboSpan" id="kobo.1684.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1685.1">from</span></span><span class="koboSpan" id="kobo.1686.1"> courses.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1687.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1688.1">Content, </span></strong></span><span class="koboSpan" id="kobo.1689.1">Course, Module, Subject
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1690.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1691.1">ItemRelatedField</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1692.1">(serializers.RelatedField):</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1693.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1694.1">to_representation</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1695.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1696.1">self, value</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1697.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1698.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1699.1"> value.render()</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1700.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1701.1">ContentSerializer</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1702.1">(serializers.ModelSerializer):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1703.1">item = ItemRelatedField(read_only=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1704.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1705.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1706.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1707.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1708.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1709.1">model = Content</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1710.1">fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1711.1">'order'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1712.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1713.1">'item'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1714.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1715.1">In this code, you define a custom field by subclassing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1716.1">RelatedField</span></code><span class="koboSpan" id="kobo.1717.1"> serializer field provided by DRF and overriding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1718.1">to_representation()</span></code><span class="koboSpan" id="kobo.1719.1"> method. </span><span class="koboSpan" id="kobo.1719.2">You define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1720.1">ContentSerializer</span></code><span class="koboSpan" id="kobo.1721.1"> serializer for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1722.1">Content</span></code><span class="koboSpan" id="kobo.1723.1"> model and use the custom field for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1724.1">item</span></code><span class="koboSpan" id="kobo.1725.1"> generic foreign key.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1726.1">You need an alternative serializer for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1727.1">Module</span></code><span class="koboSpan" id="kobo.1728.1"> model that includes its contents, as well as an extended </span><code class="inlineCode"><span class="koboSpan" id="kobo.1729.1">Course</span></code><span class="koboSpan" id="kobo.1730.1"> serializer. </span><span class="koboSpan" id="kobo.1730.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1731.1">api/serializers.py</span></code><span class="koboSpan" id="kobo.1732.1"> file and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1733.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1734.1">ModuleWithContentsSerializer</span></span><span class="koboSpan" id="kobo.1735.1">(serializers.ModelSerializer):
    contents = ContentSerializer(many=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1736.1">True</span></span><span class="koboSpan" id="kobo.1737.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1738.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1739.1">Meta</span></span><span class="koboSpan" id="kobo.1740.1">:
        model = Module
        fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1741.1">'order'</span></span><span class="koboSpan" id="kobo.1742.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1743.1">'title'</span></span><span class="koboSpan" id="kobo.1744.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1745.1">'description'</span></span><span class="koboSpan" id="kobo.1746.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1747.1">'contents'</span></span><span class="koboSpan" id="kobo.1748.1">]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1749.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1750.1">CourseWithContentsSerializer</span></span><span class="koboSpan" id="kobo.1751.1">(serializers.ModelSerializer):
    modules = ModuleWithContentsSerializer(many=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1752.1">True</span></span><span class="koboSpan" id="kobo.1753.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1754.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1755.1">Meta</span></span><span class="koboSpan" id="kobo.1756.1">:
        model = Course
        fields = [
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1757.1">'id'</span></span><span class="koboSpan" id="kobo.1758.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1759.1">'subject'</span></span><span class="koboSpan" id="kobo.1760.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1761.1">'title'</span></span><span class="koboSpan" id="kobo.1762.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1763.1">'slug'</span></span><span class="koboSpan" id="kobo.1764.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1765.1">'overview'</span></span><span class="koboSpan" id="kobo.1766.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1767.1">'created'</span></span><span class="koboSpan" id="kobo.1768.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1769.1">'owner'</span></span><span class="koboSpan" id="kobo.1770.1">,
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1771.1">'modules'</span></span><span class="koboSpan" id="kobo.1772.1">
        ]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1773.1">Let’s create a view that mimics</span><a id="_idIndexMarker1419"/><span class="koboSpan" id="kobo.1774.1"> the behavior of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1775.1">retrieve()</span></code><span class="koboSpan" id="kobo.1776.1"> action but includes the course contents. </span><span class="koboSpan" id="kobo.1776.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1777.1">api/views.py</span></code><span class="koboSpan" id="kobo.1778.1"> file and add the following method to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1779.1">CourseViewSet</span></code><span class="koboSpan" id="kobo.1780.1"> class:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1781.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1782.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1783.1"> courses.api.permissions </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1784.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1785.1"> IsEnrolled</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1786.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1787.1"> courses.api.serializers </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1788.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1789.1"> CourseWithContentsSerializer</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1790.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1791.1">CourseViewSet</span></span><span class="koboSpan" id="kobo.1792.1">(viewsets.ReadOnlyModelViewSet):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1793.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1794.1">    @action(</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1795.1">detail=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1796.1">True</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1797.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1798.1">methods=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1799.1">'get'</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1800.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1801.1">serializer_class=CourseWithContentsSerializer,</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1802.1">authentication_classes=[BasicAuthentication],</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"> </strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1803.1">permission_classes=[IsAuthenticated, IsEnrolled]</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"> </strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.1804.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1805.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1806.1">contents</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1807.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1808.1">self, request, *args, **kwargs</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1809.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1810.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1811.1"> self.retrieve(request, *args, **kwargs)</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1812.1">The description of this method is as follows:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1813.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1814.1">action</span></code><span class="koboSpan" id="kobo.1815.1"> decorator with the parameter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1816.1">detail=True</span></code><span class="koboSpan" id="kobo.1817.1"> to specify an action that is performed on a single object.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1818.1">You specify that only the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1819.1">GET</span></code><span class="koboSpan" id="kobo.1820.1"> method is allowed for this action.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1821.1">You use the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1822.1">CourseWithContentsSerializer</span></code><span class="koboSpan" id="kobo.1823.1"> serializer class that includes rendered course contents.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1824.1">You use both </span><code class="inlineCode"><span class="koboSpan" id="kobo.1825.1">IsAuthenticated</span></code><span class="koboSpan" id="kobo.1826.1"> and your custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.1827.1">IsEnrolled</span></code><span class="koboSpan" id="kobo.1828.1"> permissions. </span><span class="koboSpan" id="kobo.1828.2">By doing so, you make sure that only users enrolled in the course are able to access its contents.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1829.1">You use the existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.1830.1">retrieve()</span></code><span class="koboSpan" id="kobo.1831.1"> action to return the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1832.1">Course</span></code><span class="koboSpan" id="kobo.1833.1"> object.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1834.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1835.1">http://127.0.0.1:8000/api/courses/1/contents/</span></code><span class="koboSpan" id="kobo.1836.1"> in your browser. </span><span class="koboSpan" id="kobo.1836.2">If you access the view with the right credentials, you will see that each module of the course includes the rendered HTML</span><a id="_idIndexMarker1420"/><span class="koboSpan" id="kobo.1837.1"> for course contents, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1838.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1839.1">"order"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1840.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1841.1">0</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1842.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1843.1">"title"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1844.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1845.1">"Introduction to Django"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1846.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1847.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1848.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1849.1">"Brief introduction to the Django Web Framework."</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1850.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1851.1">"contents"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1852.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1853.1">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1854.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1855.1">"order"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1856.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1857.1">0</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1858.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1859.1">"item"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1860.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1861.1">"&lt;p&gt;Meet Django. </span><span class="koboSpan" id="kobo.1861.2">Django is a high-level</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1862.1">            Python Web framework</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1863.1">            ...&lt;/p&gt;"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1864.1">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1865.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1866.1">"order"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1867.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1868.1">1</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1869.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1870.1">"item"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1871.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1872.1">"\n&lt;iframe width=\"480\" height=\"360\"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1873.1">            src=\"http://www.youtube.com/embed/bgV39DlmZ2U?</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1874.1">            wmode=opaque\"</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1875.1">            frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;\n"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1876.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1877.1">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1878.1">}</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1879.1">You have built a simple API that allows other services to access the course application programmatically. </span><span class="koboSpan" id="kobo.1879.2">DRF also allows you to handle creating and editing objects with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1880.1">ModelViewSet</span></code><span class="koboSpan" id="kobo.1881.1"> class. </span><span class="koboSpan" id="kobo.1881.2">We have covered the main aspects of DRF, but you will find further information about its features in its extensive documentation at </span><a href="https://www.django-rest-framework.org/"><span class="url"><span class="koboSpan" id="kobo.1882.1">https://www.django-rest-framework.org/</span></span></a><span class="koboSpan" id="kobo.1883.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-418"><span class="koboSpan" id="kobo.1884.1">Consuming the RESTful API</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1885.1">Now that you have</span><a id="_idIndexMarker1421"/><span class="koboSpan" id="kobo.1886.1"> implemented an API, you can consume it in a programmatic manner from other applications. </span><span class="koboSpan" id="kobo.1886.2">You can interact with the API using the JavaScript Fetch API in the frontend of your application, in a similar fashion to the functionalities you built in </span><em class="italic"><span class="koboSpan" id="kobo.1887.1">Chapter 6</span></em><span class="koboSpan" id="kobo.1888.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1889.1">Sharing Content on Your Website</span></em><span class="koboSpan" id="kobo.1890.1">. </span><span class="koboSpan" id="kobo.1890.2">You can also consume the API from applications built with Python or any other programming language.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1891.1">You are going to create a simple Python application that uses the RESTful API to retrieve all available courses and then enroll a student in all of them. </span><span class="koboSpan" id="kobo.1891.2">You will learn how to authenticate against the API using HTTP basic authentication and perform </span><code class="inlineCode"><span class="koboSpan" id="kobo.1892.1">GET</span></code><span class="koboSpan" id="kobo.1893.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1894.1">POST</span></code><span class="koboSpan" id="kobo.1895.1"> requests.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1896.1">We will use the Python Requests library to</span><a id="_idIndexMarker1422"/><span class="koboSpan" id="kobo.1897.1"> consume the API. </span><span class="koboSpan" id="kobo.1897.2">We used Requests in </span><em class="italic"><span class="koboSpan" id="kobo.1898.1">Chapter 6</span></em><span class="koboSpan" id="kobo.1899.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1900.1">Sharing Content on Your Website</span></em><span class="koboSpan" id="kobo.1901.1">, to retrieve images by their URL. </span><span class="koboSpan" id="kobo.1901.2">Requests abstracts the complexity of dealing with HTTP requests and provides a very simple interface to consume HTTP services. </span><span class="koboSpan" id="kobo.1901.3">You can find the documentation for the Requests library at </span><a href="https://requests.readthedocs.io/en/master/"><span class="url"><span class="koboSpan" id="kobo.1902.1">https://requests.readthedocs.io/en/master/</span></span></a><span class="koboSpan" id="kobo.1903.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1904.1">Open the shell and install the Requests library with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1905.1">python -m pip install requests==2.31.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1906.1">Create a new directory next to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1907.1">educa</span></code><span class="koboSpan" id="kobo.1908.1"> project directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1909.1">api_examples</span></code><span class="koboSpan" id="kobo.1910.1">. </span><span class="koboSpan" id="kobo.1910.2">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1911.1">api_examples/</span></code><span class="koboSpan" id="kobo.1912.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1913.1">enroll_all.py</span></code><span class="koboSpan" id="kobo.1914.1">. </span><span class="koboSpan" id="kobo.1914.2">The file structure should now look like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1915.1">api_examples/
    enroll_all.py
educa/
    ...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1916.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1917.1">enroll_all.py</span></code><span class="koboSpan" id="kobo.1918.1"> file and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1919.1">import</span></span><span class="koboSpan" id="kobo.1920.1"> requests
base_url = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1921.1">'http://127.0.0.1:8000/api/'</span></span><span class="koboSpan" id="kobo.1922.1">
url = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1923.1">f'</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1924.1">{base_url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1925.1">courses/'</span></span><span class="koboSpan" id="kobo.1926.1">
available_courses = []
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1927.1">while</span></span><span class="koboSpan" id="kobo.1928.1"> url </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1929.1">is</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1930.1">not</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1931.1">None</span></span><span class="koboSpan" id="kobo.1932.1">:
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1933.1">print</span></span><span class="koboSpan" id="kobo.1934.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1935.1">f'Loading courses from </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1936.1">{url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1937.1">'</span></span><span class="koboSpan" id="kobo.1938.1">)
    r = requests.get(url)
    response = r.json()
    url = response[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1939.1">'next'</span></span><span class="koboSpan" id="kobo.1940.1">]
    courses = response[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1941.1">'results'</span></span><span class="koboSpan" id="kobo.1942.1">]
    available_courses += [course[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1943.1">'title'</span></span><span class="koboSpan" id="kobo.1944.1">] </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1945.1">for</span></span><span class="koboSpan" id="kobo.1946.1"> course </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1947.1">in</span></span><span class="koboSpan" id="kobo.1948.1"> courses]
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1949.1">print</span></span><span class="koboSpan" id="kobo.1950.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1951.1">f'Available courses: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1952.1">{</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1953.1">", "</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1954.1">.join(available_courses)}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1955.1">'</span></span><span class="koboSpan" id="kobo.1956.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1957.1">In this code, you perform the following actions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1958.1">You import the Requests library and define the base URL for the API and the URL for the course list API endpoint.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1959.1">You define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1960.1">available_courses</span></code><span class="koboSpan" id="kobo.1961.1"> empty list.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1962.1">You use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1963.1">while</span></code><span class="koboSpan" id="kobo.1964.1"> statement to </span><a id="_idIndexMarker1423"/><span class="koboSpan" id="kobo.1965.1">paginate over all result pages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1966.1">You use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1967.1">requests.get()</span></code><span class="koboSpan" id="kobo.1968.1"> to retrieve data from the API by sending a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1969.1">GET</span></code><span class="koboSpan" id="kobo.1970.1"> request to the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.1971.1">http://127.0.0.1:8000/api/courses/</span></code><span class="koboSpan" id="kobo.1972.1">. </span><span class="koboSpan" id="kobo.1972.2">This API endpoint is publicly accessible, so it does not require any authentication.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1973.1">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1974.1">json()</span></code><span class="koboSpan" id="kobo.1975.1"> method of the response object to decode the JSON data returned by the API.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1976.1">You store the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1977.1">next</span></code><span class="koboSpan" id="kobo.1978.1"> attribute in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1979.1">url</span></code><span class="koboSpan" id="kobo.1980.1"> variable to retrieve the next page of results in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1981.1">while</span></code><span class="koboSpan" id="kobo.1982.1"> statement.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1983.1">You add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1984.1">title</span></code><span class="koboSpan" id="kobo.1985.1"> attribute of each course to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1986.1">available_courses</span></code><span class="koboSpan" id="kobo.1987.1"> list.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1988.1">When the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1989.1">url</span></code><span class="koboSpan" id="kobo.1990.1"> variable is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1991.1">None</span></code><span class="koboSpan" id="kobo.1992.1">, you go to the latest page of results and you don’t retrieve any additional pages.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1993.1">You print the list of available courses.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1994.1">Start the development server from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1995.1">educa</span></code><span class="koboSpan" id="kobo.1996.1"> project directory with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1997.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1998.1">In another shell, run the following command from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1999.1">api_examples/</span></code><span class="koboSpan" id="kobo.2000.1"> directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2001.1">python enroll_all.py
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2002.1">You will see output with a list of all course titles, like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2003.1">Available courses: Introduction to Django, Python for beginners, Algebra basics
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2004.1">This is the first automated call to your API.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2005.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2006.1">enroll_all.py</span></code><span class="koboSpan" id="kobo.2007.1"> file and add the following lines highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2008.1">import</span></span><span class="koboSpan" id="kobo.2009.1"> requests
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2010.1">username = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2011.1">''</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2012.1">password = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2013.1">''</span></strong></span><span class="koboSpan" id="kobo.2014.1">
base_url = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2015.1">'http://127.0.0.1:8000/api/'</span></span><span class="koboSpan" id="kobo.2016.1">
url = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2017.1">f'</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2018.1">{base_url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2019.1">courses/'</span></span><span class="koboSpan" id="kobo.2020.1">
available_courses = []
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2021.1">while</span></span><span class="koboSpan" id="kobo.2022.1"> url </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2023.1">is</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2024.1">not</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2025.1">None</span></span><span class="koboSpan" id="kobo.2026.1">:
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2027.1">print</span></span><span class="koboSpan" id="kobo.2028.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2029.1">f'Loading courses from </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2030.1">{url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2031.1">'</span></span><span class="koboSpan" id="kobo.2032.1">)
    r = requests.get(url)
    response = r.json()
    url = response[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2033.1">'next'</span></span><span class="koboSpan" id="kobo.2034.1">]
    courses = response[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2035.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2036.1">results'</span></span><span class="koboSpan" id="kobo.2037.1">]
    available_courses += [course[</span><span class="hljs-string"><span class="koboSpan" id="kobo.2038.1">'title'</span></span><span class="koboSpan" id="kobo.2039.1">] </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2040.1">for</span></span><span class="koboSpan" id="kobo.2041.1"> course </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2042.1">in</span></span><span class="koboSpan" id="kobo.2043.1"> courses]
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2044.1">print</span></span><span class="koboSpan" id="kobo.2045.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2046.1">f'Available courses: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2047.1">{</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2048.1">", "</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2049.1">.join(available_courses)}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2050.1">'</span></span><span class="koboSpan" id="kobo.2051.1">)
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2052.1">for</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2053.1"> course </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2054.1">in</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2055.1"> courses:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2056.1">    course_id = course[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2057.1">'id'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2058.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2059.1">    course_title = course[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2060.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2061.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2062.1">    r = requests.post(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2063.1">f'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2064.1">{base_url}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2065.1">courses/</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2066.1">{course_id}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2067.1">/enroll/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2068.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2069.1">        auth=(username, password)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2070.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2071.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2072.1"> r.status_code == </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2073.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2074.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2075.1"># successful request</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2076.1">print</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2077.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2078.1">f'Successfully enrolled in </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.2079.1">{course_title}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2080.1">'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2081.1">)</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2082.1">Replace the values for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2083.1">username</span></code><span class="koboSpan" id="kobo.2084.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2085.1">password</span></code><span class="koboSpan" id="kobo.2086.1"> variables with the credentials of an existing user, or load the values </span><a id="_idIndexMarker1424"/><span class="koboSpan" id="kobo.2087.1">from environment variables. </span><span class="koboSpan" id="kobo.2087.2">You can use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2088.1">python-decouple</span></code><span class="koboSpan" id="kobo.2089.1">, as we did in the </span><em class="italic"><span class="koboSpan" id="kobo.2090.1">Working with environment variables</span></em><span class="koboSpan" id="kobo.2091.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.2092.1">Chapter 2</span></em><span class="koboSpan" id="kobo.2093.1">, </span><em class="italic"><span class="koboSpan" id="kobo.2094.1">Enhancing Your Blog and Adding Social Features</span></em><span class="koboSpan" id="kobo.2095.1">, to load credentials from environment variables.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2096.1">With the new code, you perform the following actions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2097.1">You define the username and password of the student you want to enroll in courses.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2098.1">You iterate over the available courses retrieved from the API.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2099.1">You store the course ID attribute in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2100.1">course_id</span></code><span class="koboSpan" id="kobo.2101.1"> variable and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2102.1">title</span></code><span class="koboSpan" id="kobo.2103.1"> attribute in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2104.1">course_title</span></code><span class="koboSpan" id="kobo.2105.1"> variable.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2106.1">You use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2107.1">requests.post()</span></code><span class="koboSpan" id="kobo.2108.1"> to send a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2109.1">POST</span></code><span class="koboSpan" id="kobo.2110.1"> request to the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.2111.1">http://127.0.0.1:8000/api/courses/[id]/enroll/</span></code><span class="koboSpan" id="kobo.2112.1"> for each course. </span><span class="koboSpan" id="kobo.2112.2">This URL corresponds to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2113.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.2114.1"> API view, which allows you to enroll a user in a course. </span><span class="koboSpan" id="kobo.2114.2">You build the URL for each course using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2115.1">course_id</span></code><span class="koboSpan" id="kobo.2116.1"> variable. </span><span class="koboSpan" id="kobo.2116.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2117.1">CourseEnrollView</span></code><span class="koboSpan" id="kobo.2118.1"> view requires authentication. </span><span class="koboSpan" id="kobo.2118.2">It uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2119.1">IsAuthenticated</span></code><span class="koboSpan" id="kobo.2120.1"> permission and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2121.1">BasicAuthentication</span></code><span class="koboSpan" id="kobo.2122.1"> authentication class. </span><span class="koboSpan" id="kobo.2122.2">The Requests library supports HTTP basic authentication out of the box. </span><span class="koboSpan" id="kobo.2122.3">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2123.1">auth</span></code><span class="koboSpan" id="kobo.2124.1"> parameter to pass a tuple with the username and password to authenticate the user, using HTTP basic authentication.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2125.1">If the status code of the response is </span><code class="inlineCode"><span class="koboSpan" id="kobo.2126.1">200 OK</span></code><span class="koboSpan" id="kobo.2127.1">, you print a message to indicate that the user has been successfully enrolled in the course.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2128.1">You can use different kinds </span><a id="_idIndexMarker1425"/><span class="koboSpan" id="kobo.2129.1">of authentication with Requests. </span><span class="koboSpan" id="kobo.2129.2">You can find more information on authentication with Requests at </span><a href="https://requests.readthedocs.io/en/master/user/authentication/"><span class="url"><span class="koboSpan" id="kobo.2130.1">https://requests.readthedocs.io/en/master/user/authentication/</span></span></a><span class="koboSpan" id="kobo.2131.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2132.1">Run the following command from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2133.1">api_examples/</span></code><span class="koboSpan" id="kobo.2134.1"> directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2135.1">python enroll_all.py
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2136.1">You will now see output like this:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2137.1">Available courses: Introduction to Django, Python for beginners, Algebra basics
Successfully enrolled in Introduction to Django
Successfully enrolled in Python for beginners
Successfully enrolled in Algebra basics
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2138.1">Great! </span><span class="koboSpan" id="kobo.2138.2">You have successfully enrolled the user in all available courses using the API. </span><span class="koboSpan" id="kobo.2138.3">You will see a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2139.1">Successfully enrolled</span></code><span class="koboSpan" id="kobo.2140.1"> message for each course on the platform. </span><span class="koboSpan" id="kobo.2140.2">As you can see, it’s very easy to consume the API from any other application.</span></p>
<h1 class="heading-1" id="_idParaDest-419"><span class="koboSpan" id="kobo.2141.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2142.1">In this chapter, you learned how to use DRF to build a RESTful API for your project. </span><span class="koboSpan" id="kobo.2142.2">You created serializers and views for models, and you built custom API views. </span><span class="koboSpan" id="kobo.2142.3">You also added authentication to your API and restricted access to API views using permissions. </span><span class="koboSpan" id="kobo.2142.4">Next, you discovered how to create custom permissions, and you implemented </span><code class="inlineCode"><span class="koboSpan" id="kobo.2143.1">ViewSets</span></code><span class="koboSpan" id="kobo.2144.1"> and routers. </span><span class="koboSpan" id="kobo.2144.2">Finally, you used the Requests library to consume the API from an external Python script.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2145.1">The next chapter will teach you how to build a chat server using Django Channels. </span><span class="koboSpan" id="kobo.2145.2">You will implement asynchronous communication using WebSockets, and you will use Redis to set up a channel layer.</span></p>
<h1 class="heading-1" id="_idParaDest-420"><span class="koboSpan" id="kobo.2146.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2147.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2148.1">Source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter15"><span class="url"><span class="koboSpan" id="kobo.2149.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter15</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2150.1">REST framework website: </span><a href="https://www.django-rest-framework.org/"><span class="url"><span class="koboSpan" id="kobo.2151.1">https://www.django-rest-framework.org/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2152.1">REST framework settings: </span><a href="https://www.django-rest-framework.org/api-guide/settings/"><span class="url"><span class="koboSpan" id="kobo.2153.1">https://www.django-rest-framework.org/api-guide/settings/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2154.1">REST framework serializers: </span><a href="https://www.django-rest-framework.org/api-guide/serializers/"><span class="url"><span class="koboSpan" id="kobo.2155.1">https://www.django-rest-framework.org/api-guide/serializers/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2156.1">REST framework renderers: </span><a href="https://www.django-rest-framework.org/api-guide/renderers/"><span class="url"><span class="koboSpan" id="kobo.2157.1">https://www.django-rest-framework.org/api-guide/renderers/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2158.1">REST framework parsers: </span><a href="https://www.django-rest-framework.org/api-guide/parsers/"><span class="url"><span class="koboSpan" id="kobo.2159.1">https://www.django-rest-framework.org/api-guide/parsers/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2160.1">REST framework generic mixins and views – </span><a href="https://www.django-rest-framework.org/api-guide/generic-views/ "><span class="url"><span class="koboSpan" id="kobo.2161.1">https://www.django-rest-framework.org/api-guide/generic-views/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2162.1">Download </span><code class="inlineCode"><span class="koboSpan" id="kobo.2163.1">curl</span></code><span class="koboSpan" id="kobo.2164.1">: </span><a href="https://curl.se/download.html"><span class="url"><span class="koboSpan" id="kobo.2165.1">https://curl.se/download.html</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2166.1">Postman API platform: </span><a href="https://www.getpostman.com/"><span class="url"><span class="koboSpan" id="kobo.2167.1">https://www.getpostman.com/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2168.1">REST framework pagination: </span><a href="https://www.django-rest-framework.org/api-guide/pagination/ "><span class="url"><span class="koboSpan" id="kobo.2169.1">https://www.django-rest-framework.org/api-guide/pagination/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2170.1">REST framework serializer relations: </span><a href="https://www.django-rest-framework.org/api-guide/relations/"><span class="url"><span class="koboSpan" id="kobo.2171.1">https://www.django-rest-framework.org/api-guide/relations/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2172.1">HTTP basic authentication: </span><a href="https://en.wikipedia.org/wiki/Basic_access_authentication"><span class="url"><span class="koboSpan" id="kobo.2173.1">https://en.wikipedia.org/wiki/Basic_access_authentication</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2174.1">REST framework authentication: </span><a href="https://www.django-rest-framework.org/api-guide/authentication/"><span class="url"><span class="koboSpan" id="kobo.2175.1">https://www.django-rest-framework.org/api-guide/authentication/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2176.1">REST framework permissions: </span><a href="https://www.django-rest-framework.org/api-guide/permissions/"><span class="url"><span class="koboSpan" id="kobo.2177.1">https://www.django-rest-framework.org/api-guide/permissions/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2178.1">REST framework </span><code class="inlineCode"><span class="koboSpan" id="kobo.2179.1">ViewSets</span></code><span class="koboSpan" id="kobo.2180.1">: </span><a href="https://www.django-rest-framework.org/api-guide/viewsets/"><span class="url"><span class="koboSpan" id="kobo.2181.1">https://www.django-rest-framework.org/api-guide/viewsets/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2182.1">REST framework routers: </span><a href="https://www.django-rest-framework.org/api-guide/routers/"><span class="url"><span class="koboSpan" id="kobo.2183.1">https://www.django-rest-framework.org/api-guide/routers/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2184.1">Python Requests library documentation: </span><a href="https://requests.readthedocs.io/en/master/"><span class="url"><span class="koboSpan" id="kobo.2185.1">https://requests.readthedocs.io/en/master/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2186.1">Authentication with the Requests library: </span><a href="https://requests.readthedocs.io/en/master/user/authentication/"><span class="url"><span class="koboSpan" id="kobo.2187.1">https://requests.readthedocs.io/en/master/user/authentication/</span></span></a></li>
</ul>
</div>
</body></html>