<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer108">
<h1 class="chapter-number" id="_idParaDest-42"><a id="_idTextAnchor006"/>4</h1>
<h1 id="_idParaDest-43">Running Python Applications on EC2</h1>
<p>In this chapter, we are going to learn how to run Python applications within the <strong class="bold">Elastic Compute Cloud (EC2)</strong> service. EC2 is an AWS service that allows<a id="_idIndexMarker120"/> you to provision a server in the cloud. You can find different types of server options. You need to carry out some configuration and run the server on the cloud. You might wonder why we need EC2 when we have Lambda. Lambda<a id="_idIndexMarker121"/> is very effective but has a duration limit. If you run your function for more than 15 minutes, it will give a timeout. What happens if your application needs to be run for a couple of hours because of a huge process? Lambda doesn’t work and you need your own server. Another reason to use EC2 would be if you need a very special configuration or installation that needs to be done within a specific server; you would need a server as well. Based on this kind of requirement, you need to have your own server in the cloud. We wil<a id="_idTextAnchor007"/>l provision a server and run a Python application <span class="No-Break">within EC2.</span></p>
<p>The chapter covers the <span class="No-Break">following topics:</span></p>
<ul>
<li>What <span class="No-Break">is EC2?</span></li>
<li>EC2 <span class="No-Break">purchasing options</span></li>
<li>EC2 <span class="No-Break">instance types</span></li>
<li>Provisioning an <span class="No-Break">EC2 server</span></li>
<li>Connecting to an <span class="No-Break">EC2 server</span></li>
<li>Running a simple Python application on an <span class="No-Break">EC2 server</span></li>
<li>Processing a CSV file with a Python application on an <span class="No-Break">EC2 server</span></li>
<li>The <span class="No-Break">AWS CLI</span></li>
</ul>
<h1 id="_idParaDest-44">What is EC2?</h1>
<p>AWS EC2 is <a id="_idIndexMarker122"/>a service that provides a secure and scalable server machine in the cloud. The main advantage of EC2 is that server management is very easy from the AWS Management Console. When y<a id="_idTextAnchor008"/>ou provision an on-premises server, it is not easy to configure security policies, disk management, backup management, and so on. AWS accelerates all this. When you provision EC2, AWS offers different contracts that you need to select and all these types impact <span class="No-Break">the cost.</span></p>
<p>In order to select the right service, you need to understand what services you are going to use, how many resources you need, and what type of storage you really need. These things are going to help you to reduce the cost and use <span class="No-Break">EC2 efficiently.</span></p>
<h1 id="_idParaDest-45">EC2 purchasing options</h1>
<p>We will now look at<a id="_idIndexMarker123"/> the types of <a id="_idIndexMarker124"/><span class="No-Break">EC2 contracts.</span></p>
<h2 id="_idParaDest-46">On-Demand</h2>
<p>In this offer, you don’t need to <a id="_idIndexMarker125"/>contract for a specific time period. AWS charges according to the time you use the server. You can provision a server, shut it down, and release the server whenever you want. It is a <span class="No-Break">pay-as-you-go model.</span></p>
<h2 id="_idParaDest-47">Reserved</h2>
<p>You need to sign a contract <a id="_idIndexMarker126"/>with AWS for 1–3 years. The key thing to note is that AWS offers a discount for a <span class="No-Break">Reserved commitment.</span></p>
<h2 id="_idParaDest-48">Spot</h2>
<p>Let’s imagine you have an application that has <a id="_idIndexMarker127"/> flexible start and end times. You define a bid price for whatever you are willing to pay for the server. Let’s imagine you have a data processing application that runs for five hours and the running time is not important. You are able to run at the beginning or end of the month; it is not a problem. You can provision a Spot instance that significantly reduces <span class="No-Break">your cost.</span></p>
<h2 id="_idParaDest-49">Dedicated</h2>
<p>This is useful when your organization <a id="_idIndexMarker128"/>has a software license and is moving to AWS. These servers are only used for your organization. Hence, you<a id="_idIndexMarker129"/> can keep the license that is served to <span class="No-Break">your company.</span></p>
<h1 id="_idParaDest-50">EC2 instance types</h1>
<p>AWS offers different types of <a id="_idIndexMarker130"/>servers depending on your technical requirement. Server type selection is one of the most important things to manage your budget and use the EC2 server efficiently. If you need to use memory processing applications such as <strong class="bold">Spark</strong>, it<a id="_idIndexMarker131"/> would be better to provision a memory-optimized server. On the other hand, if you need a server that needs more storage, you can use a <span class="No-Break">storage-optimized server.</span></p>
<p>The following screenshot shows that you are able to select more than hundreds of types of servers <span class="No-Break">in AWS:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer061">
<img alt="" height="447" src="image/Figure_4.01_B19195.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.1 – EC2 instance types [Source – <a href="https://aws.amazon.com/">https://aws.amazon.com/</a>]</p>
<h2 id="_idParaDest-51">Auto-scaling</h2>
<p>If you need a<a id="_idIndexMarker132"/> clustered environment, it would be better to define an auto-scaling policy in order to <a id="_idIndexMarker133"/>manage <span class="No-Break">resources efficiently.</span></p>
<p>Let’s think about a batch processing job that runs once a day in order to process massive amounts of data. You provision more than one machine. But when the system is idle, you are going to be charged unnecessarily. However, if you define an auto-scaling policy, the system will close when it is idle. This configuration is going to reduce your costs. The following figure shows the minimum size of the launched instances and the maximum size of the <span class="No-Break">desired capacity:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer062">
<img alt="" height="323" src="image/Figure_4.02_B19195.jpg" width="700"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.2 – Auto-scaling</p>
<p>Auto-scaling<a id="_idIndexMarker134"/> is one of the <a id="_idIndexMarker135"/>most important features of EC2. You need to consider the usage of EC2 and configure an <span class="No-Break">auto-scaling feature.</span></p>
<p>In this section, we took a look at the most important features of EC2. In the next section, we will provision an <span class="No-Break">EC2 server.</span></p>
<h1 id="_idParaDest-52">Provisioning an EC2 server</h1>
<p>We are going to provision an <a id="_idIndexMarker136"/>EC2 server step by step. There are different types of EC2 machines; we will provision a free server. I would recommend terminating the server when you finish your work, as we are just using EC2 for <span class="No-Break">learning purposes.</span></p>
<p>To provision an EC2 server on AWS, carry out the <span class="No-Break">following steps:</span></p>
<ol>
<li>Go to the AWS <span class="No-Break">Management Console.</span></li>
<li>Search for <strong class="bold">EC2</strong> and go to the link <span class="No-Break">titled </span><span class="No-Break"><strong class="bold">EC2</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer063">
<img alt="" height="405" src="image/Figure_4.03_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.3 – AWS Management Console</p>
<ol>
<li value="3">In order to launch an instance, click <strong class="bold">Instances</strong> on the left side, and then click <span class="No-Break"><strong class="bold">Launch instances</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer064">
<img alt="" height="355" src="image/Figure_4.04_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.4 – Create an instance</p>
<ol>
<li value="4">In the new <a id="_idIndexMarker137"/>panel, you can give a name to the EC2 instance. You can see that we titled ours <strong class="bold">Test_Python</strong>. On this launch page, AWS recommends a Linux machine, which is in the free tier. The free tier means that you don’t need to pay money to AWS. We will proceed with <span class="No-Break">that option:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer065">
<img alt="" height="635" src="image/Figure_4.05_B19195.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.5 – Instance features</p>
<ol>
<li value="5">You can now see the <strong class="bold">Key pair (login)</strong> panel. A key pair is used to connect to the server via the SSH key in a secure way. In order to create a new SSH key, click <strong class="bold">Create new </strong><span class="No-Break"><strong class="bold">key pair</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer066">
<img alt="" height="312" src="image/Figure_4.06_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.6 – Creating a new key pair</p>
<ol>
<li value="6">We need to give a <a id="_idIndexMarker138"/>name to the key pair. Apart from that, you can keep the key pair type and private key file format as the defaults. Click <strong class="bold">Create </strong><span class="No-Break"><strong class="bold">key pair</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer067">
<img alt="" height="1100" src="image/Figure_4.07_B19195.jpg" width="865"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.7 – Naming the key pair</p>
<p>Once you click <strong class="bold">Create key pair</strong>, it will download the file. Please keep this file; it will be used to connect to the machine. The <strong class="bold">Key pair name</strong> dropdown will also be selected with your creation. When you create a new key pair in the upper section, the new key pair name will be visible, which you can see in the following screenshot. For this example, our key pair <span class="No-Break">is </span><span class="No-Break"><strong class="bold">key_for_test_python</strong></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer068">
<img alt="" height="278" src="image/Figure_4.08_B19195.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.8 – The key pair is ready</p>
<p>In the next step, we are going to create and assign a <strong class="bold">virtual private cloud (VPC)</strong> <span class="No-Break">and subnet:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer069">
<img alt="" height="253" src="image/Figure_4.09_B19195.jpg" width="1490"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.9 – VPC and subnet</p>
<p>A VPC allows AWS services to run in a logically isolated network. It is one of the key services that keep the service secure. You can easily isolate the servers with VPC configuration. The following figure illustrates a VPC and <span class="No-Break">EC2 setup:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer070">
<img alt="" height="585" src="image/Figure_4.10_B19195.jpg" width="973"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.10 – VPC [Source – https://aws.amazon.com/]</p>
<p>As you see, once you add <a id="_idIndexMarker139"/>one of the servers to the VPC subnet in AZ 2, it means the EC2 instances are logically isolated from others. Hence, you can add access controls to keep the <span class="No-Break">server secure.</span></p>
<p>The subnet<a id="_idIndexMarker140"/> is also one of the important parts of a VPC. Each VPC consists of a subnet that defines an IP range for the VPC. In the following diagram, you can see the IP range for <span class="No-Break">each subnet:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer071">
<img alt="" height="493" src="image/Figure_4.11_B19195.jpg" width="1008"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.11 – Subnet [Source – https://aws.amazon.com/]</p>
<p>We took a look at VPCs and <a id="_idIndexMarker141"/>subnets. Now, we need to define a VPC for the <span class="No-Break">EC2 instance:</span></p>
<ol>
<li>Type <strong class="source-inline">VPC</strong> in the search box of the <strong class="bold">AWS </strong><span class="No-Break"><strong class="bold">Management Console</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer072">
<img alt="" height="350" src="image/Figure_4.12_B19195.jpg" width="1102"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.12 – VPC on the AWS Management Console</p>
<ol>
<li value="2">Click <span class="No-Break"><strong class="bold">Create VPC</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer073">
<img alt="" height="250" src="image/Figure_4.13_B19195.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.13 – Create VPC</p>
<ol>
<li value="3">Once you click the button, under the VPC settings, <strong class="bold">VPC and more</strong> is selected by default. This option allows you to create a VPC with subnets, which you see on the right side of the following screenshot. With this option, you can create a VPC and <span class="No-Break">subnet together:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer074">
<img alt="" height="670" src="image/Figure_4.14_B19195.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.14 – Adding VPC details</p>
<ol>
<li value="4">At the<a id="_idIndexMarker142"/> bottom of this page, click the <strong class="bold">Create </strong><span class="No-Break"><strong class="bold">VPC</strong></span><span class="No-Break"> button:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer075">
<img alt="" height="362" src="image/Figure_4.15_B19195.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.15 – Creating a VPC</p>
<p>When you click <strong class="bold">Create VPC</strong>, the VPC begins creation and you can see the status of the progress:</p>
<div>
<div class="IMG---Figure" id="_idContainer076">
<img alt="" height="838" src="image/Figure_4.16_B19195.jpg" width="949"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.16 – The VPC creation process</p>
<p>After it has been created, you are able to see the VPC and subnet in the VPC console:</p>
<div>
<div class="IMG---Figure" id="_idContainer077">
<img alt="" height="464" src="image/Figure_4.17_B19195.jpg" width="1220"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.17 – The VPC and subnet</p>
<p>So far, we have created a <a id="_idIndexMarker143"/>VPC and a subnet. We can proceed with the <span class="No-Break">EC2 creation:</span></p>
<ol>
<li>Open the <strong class="bold">EC2 </strong>launch page again. In this case, the VPC and subnet are selected by default. <span class="No-Break">Click </span><span class="No-Break"><strong class="bold">Edit</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer078">
<img alt="" height="568" src="image/Figure_4.18_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.18 – Network settings</p>
<ol>
<li value="2">In order to connect to the machine, we need to select a public subnet and enable <strong class="bold">Auto-assign public IP</strong>. You can see the public subnet options in the <strong class="bold">Subnet</strong> dropdown. In <a id="_idIndexMarker144"/>general, it is not recommended to put production applications in a public subnet. As we are implementing a test project, we can proceed in <span class="No-Break">this manner:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer079">
<img alt="" height="452" src="image/Figure_4.19_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.19 – Enabling the public IP</p>
<ol>
<li value="3">At the bottom of the page, click <span class="No-Break"><strong class="bold">Launch instance</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer080">
<img alt="" height="268" src="image/Figure_4.20_B19195.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.20 – Launching an instance</p>
<p>When we click the <strong class="bold">Instances</strong> link on the left side, we are able to see the list of instances that we have created. Congratulations, you have created your <span class="No-Break">first server!</span></p>
<div>
<div class="IMG---Figure" id="_idContainer081">
<img alt="" height="270" src="image/Figure_4.21_B19195.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.21 – Running instances</p>
<p>You have <a id="_idIndexMarker145"/>successfully created a server in an efficient way. We are going to connect to the server in the <span class="No-Break">upcoming section.</span></p>
<h1 id="_idParaDest-53">Connecting to an EC2 server</h1>
<p>In this stage, we are going to<a id="_idIndexMarker146"/> connect to the EC2 server <span class="No-Break">via SSH:</span></p>
<ol>
<li>In the list of instances, there is a <strong class="bold">Connect</strong> button. <span class="No-Break">Click it</span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer082">
<img alt="" height="154" src="image/Figure_4.22_B19195.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.22 – Connecting an instance</p>
<ol>
<li value="2">Under the <strong class="bold">SSH client</strong> tab, you can see the steps to connect to the <span class="No-Break">EC2 machine:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer083">
<img alt="" height="730" src="image/Figure_4.23_B19195.jpg" width="1083"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.23 – Steps to connect</p>
<ol>
<li value="3">In this<a id="_idIndexMarker147"/> example, I will use Mac Terminal in order to connect to the machine via SSH. I am copying the command in the example and pasting it into Terminal. You can also use different SSH applications such as PuTTY and WinSCP. Please make sure the PEM key file is in the same location where you execute the command or that you set the right path for the PEM <span class="No-Break">key file:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer084">
<img alt="" height="118" src="image/Figure_4.24_B19195.jpg" width="1148"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.24 – Connecting via Terminal</p>
<ol>
<li value="4">Type <strong class="source-inline">yes</strong> to confirm the connection with <span class="No-Break">this machine:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer085">
<img alt="" height="198" src="image/Figure_4.25_B19195.jpg" width="1152"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.25 – Confirmation for the machine</p>
<p>Congratulations! You <a id="_idIndexMarker148"/>have connected to <span class="No-Break">the machine.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer086">
<img alt="" height="342" src="image/Figure_4.26_B19195.jpg" width="1144"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.26 – Connected to the machine</p>
<p>You have successfully connected to the server. We are going to install Python in the <span class="No-Break">next section.</span></p>
<h1 id="_idParaDest-54">Running a simple Python application on an EC2 server</h1>
<p>We are <a id="_idIndexMarker149"/>going to run a simple Python application on <a id="_idIndexMarker150"/>EC2. First of all, check the <span class="No-Break">Python version:</span></p>
<ol>
<li>Execute <strong class="source-inline">python --version</strong> from the <span class="No-Break">command line:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer087">
<img alt="" height="90" src="image/Figure_4.27_B19195.jpg" width="623"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.27 – Checking the Python version</p>
<ol>
<li value="2">Run the <strong class="source-inline">python</strong> command on the <span class="No-Break">command line:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer088">
<img alt="" height="146" src="image/Figure_4.28_B19195.jpg" width="984"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.28 – Connecting to the Python compiler</p>
<ol>
<li value="3">Run a <a id="_idIndexMarker151"/>simple code snippet such as <strong class="source-inline">print 'Hello EC2'</strong> and you will see that the compiler executes the <a id="_idIndexMarker152"/>command and <span class="No-Break">prints it:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer089">
<img alt="" height="172" src="image/Figure_4.29_B19195.jpg" width="993"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.29 – Running simple code</p>
<p>We have executed a simple Python application. In the next section, we will run a simple project <span class="No-Break">on EC2.</span></p>
<h1 id="_idParaDest-55">Processing a CSV file with a Python application on an EC2 server</h1>
<p>In the <a id="_idIndexMarker153"/>previous chapter, we processed a CSV<a id="_idIndexMarker154"/> file within Lambda. In this section, we will run the same application within EC2, but there will be <span class="No-Break">some differences:</span></p>
<ol>
<li>Log in to the <span class="No-Break">EC2 machine.</span></li>
<li>Create a folder in which to keep the <strong class="source-inline">csv</strong> file that is to <span class="No-Break">be processed.</span></li>
<li>Run the <strong class="source-inline">mkdir csv</strong> command in order to create a <strong class="source-inline">csv</strong> folder <span class="No-Break">on Ubuntu:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer090">
<img alt="" height="402" src="image/Figure_4.30_B19195.jpg" width="1122"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.30 – Creating a folder</p>
<p>After running the <strong class="source-inline">mkdir</strong> command, you can execute with the <strong class="source-inline">ls</strong> command in order to list your directory. As you see, the <strong class="source-inline">csv</strong> folder is created.</p>
<ol>
<li value="4">Locate the <strong class="source-inline">csv</strong> folder by executing <span class="No-Break"><strong class="source-inline">cd csv</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer091">
<img alt="" height="57" src="image/Figure_4.31_B19195.jpg" width="500"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.31 – Locating the csv folder</p>
<ol>
<li value="5">Create a sample <strong class="source-inline">CSV</strong> file in the <span class="No-Break">EC2 machine.</span></li>
</ol>
<p>I have <a id="_idIndexMarker155"/>uploaded a sample CSV file <a id="_idIndexMarker156"/>for you in the following URL. Run the following code to download the sample CSV. The <strong class="source-inline">wget</strong> command allows you to download the file from the specific link:</p>
<pre class="console">
wget https://raw.githubusercontent.com/PacktPublishing/Python-Essentials-for-AWS-Cloud-Developers/main/sample.csv</pre>
<div>
<div class="IMG---Figure" id="_idContainer092">
<img alt="" height="395" src="image/Figure_4.32_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.32 – Downloading the sample CSV file</p>
<p>Now <a id="_idIndexMarker157"/>that you have<a id="_idIndexMarker158"/> downloaded the file, you are able to create Python code in order to process the CSV file.</p>
<ol>
<li value="6">Run the following code to download the <span class="No-Break">Python code:</span><pre class="console">
wget https://raw.githubusercontent.com/PacktPublishing/Python-Essentials-for-AWS-Cloud-Developers/main/fileprocessor.py</pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer093">
<img alt="" height="282" src="image/Figure_4.33_B19195.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.33 – Downloading the Python code</p>
<p>The following code is very simple; the code imports the <strong class="source-inline">csv</strong> library and prints the first five lines within the CSV:</p>
<div>
<div class="IMG---Figure" id="_idContainer094">
<img alt="" height="435" src="image/Figure_4.34_B19195.jpg" width="833"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.34 – Python code</p>
<ol>
<li value="7">The next<a id="_idIndexMarker159"/> step is to run Python<a id="_idIndexMarker160"/> code to see the results. Execute <strong class="source-inline">python fileprocessor.py</strong> to run the application. After running the application, you will see <span class="No-Break">the results:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer095">
<img alt="" height="233" src="image/Figure_4.35_B19195.jpg" width="766"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.35 – Running Python code</p>
<p>In this section, we saw how to run a simple Python application within an AWS EC2 server. Now, we will touch upon the AWS SDK <span class="No-Break">for Python.</span></p>
<h1 id="_idParaDest-56">The AWS CLI</h1>
<p><strong class="bold">CLI</strong> stands for <strong class="bold">command-line interface</strong>, which <a id="_idIndexMarker161"/>provides some tools and libraries to<a id="_idIndexMarker162"/> facilitate accessing AWS services. As such, the AWS CLI has some APIs to use AWS services. The AWS CLI is one of the most common tools used when working with AWS. It has different methods to access AWS services. We are going to <a id="_idIndexMarker163"/>install <strong class="source-inline">awscli</strong> to access AWS services. In this section, we will install <strong class="source-inline">awscli</strong> and, after that, configure <a id="_idIndexMarker164"/>an EC2 machine to upload a file <span class="No-Break">from EC2:</span></p>
<ol>
<li>In order to access S3<a id="_idIndexMarker165"/> from <strong class="source-inline">awscli</strong>, we need to create an IAM role to be attached to EC2. Connect to the AWS Management Console, type <strong class="source-inline">IAM</strong>, and then <span class="No-Break">click </span><span class="No-Break"><strong class="bold">IAM</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer096">
<img alt="" height="293" src="image/Figure_4.36_B19195.jpg" width="1012"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.36 – IAM in the console</p>
<ol>
<li value="2">Click <strong class="bold">Roles</strong> on the left panel and then click <span class="No-Break"><strong class="bold">Create role</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer097">
<img alt="" height="759" src="image/Figure_4.37_B19195.jpg" width="1650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.37 – Create role</p>
<ol>
<li value="3">Select <strong class="bold">EC2</strong> as a common use case and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer098">
<img alt="" height="742" src="image/Figure_4.38_B19195.jpg" width="1650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.38 – Select a service</p>
<ol>
<li value="4">Now, we need to <a id="_idIndexMarker166"/>give the required permission. Since we will access S3, check the <strong class="bold">AmazonS3FullAccess</strong> checkbox. This policy will allow users to upload and read the object under S3. After selecting the policy, you can click the <span class="No-Break"><strong class="bold">Next </strong></span><span class="No-Break">button:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer099">
<img alt="" height="725" src="image/Figure_4.39_B19195.jpg" width="1650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.39 – Selecting the policy</p>
<ol>
<li value="5">Give a name to the role and click the <strong class="bold">Create role</strong> button to create <span class="No-Break">a role:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer100">
<img alt="" height="462" src="image/Figure_4.40_B19195.jpg" width="912"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">(a)</p>
<div>
<div class="IMG---Figure" id="_idContainer101">
<img alt="" height="269" src="image/Figure_4.41_B19195.jpg" width="870"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">(b)</p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.40 – Naming the role</p>
<ol>
<li value="6">In the final step <a id="_idIndexMarker167"/>to attach the role, click the <strong class="bold">Actions</strong> drop-down button, go to <strong class="bold">Security,</strong> and select <strong class="bold">Modify </strong><span class="No-Break"><strong class="bold">IAM role</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer102">
<img alt="" height="246" src="image/Figure_4.42_B19195.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.41 – Attach role</p>
<ol>
<li value="7">On the next screen, select <strong class="bold">EC2ROLE</strong>, to be attached to EC2, and click <strong class="bold">Update </strong><span class="No-Break"><strong class="bold">IAM role</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer103">
<img alt="" height="667" src="image/Figure_4.43_B19195.jpg" width="1084"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.42 – Update IAM role</p>
<p>We have created and<a id="_idIndexMarker168"/> attached the required role to log in to an <span class="No-Break">EC2 machine:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer104">
<img alt="" height="334" src="image/Figure_4.44_B19195.jpg" width="902"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.43 – Task complete</p>
<p>Now, we will upload a file <span class="No-Break">to S3.</span></p>
<p>Create a file under the EC2 machine. The <strong class="source-inline">touch</strong> command helps you to create an empty file. Optionally, you can also create a file using <span class="No-Break">another application:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer105">
<img alt="" height="84" src="image/Figure_4.45_B19195.jpg" width="612"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.44 – Creating a file</p>
<p>We can upload this file to S3 via the AWS CLI. In the previous chapter, we created an S3 bucket. You can use this bucket or create a new bucket to test the AWS CLI S3 command. Let’s <a id="_idIndexMarker169"/>upload the file to the S3 bucket. The format for uploading a file is <span class="No-Break">as follows:</span></p>
<pre class="console">
Format : aws s3 cp from to
aws s3 cp file.txt s3://inputforlambda123</pre>
<div>
<div class="IMG---Figure" id="_idContainer106">
<img alt="" height="64" src="image/Figure_4.46_B19195.jpg" width="991"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.45 – Uploading the file</p>
<p>We successfully uploaded the file. We are able to check whether the S3 bucket is uploaded from the console. Open the bucket from the S3 console <span class="No-Break">and check:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer107">
<img alt="" height="967" src="image/Figure_4.47_B19195.jpg" width="852"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.46 – Bucket content</p>
<p>As you can see, the<a id="_idIndexMarker170"/> file is uploaded to the <span class="No-Break">S3 bucket.</span></p>
<p>The AWS client is useful when you want to access AWS services and perform some tasks using commands. In this section, we learned how to copy a file to the S3 bucket via the command line, which saves a lot <span class="No-Break">of time.</span></p>
<h1 id="_idParaDest-57">Summary</h1>
<p>In this chapter, we learned about the AWS EC2 service, which is used to create a server on the cloud. You can create your server in an efficient way and use it for different purposes, such as an application server, web server, or database server. We also created an EC2 server as an example and ran our Python application on EC2. In the following chapter, we will take a look at how to debug our Python application <span class="No-Break">via PyCharm.</span></p>
</div>
</div></body></html>