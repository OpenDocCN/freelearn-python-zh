<html><head></head><body>
		<div><h1 id="_idParaDest-964" class="chapter-number"><a id="_idTextAnchor1210"/>23</h1>
			<h1 id="_idParaDest-965"><a id="_idTextAnchor1211"/>Managing Emails in Odoo</h1>
			<p>Email integration is the most prominent feature of Odoo. You can send and receive emails directly from the Odoo user interface. You can even manage email threads on business documents, such as leads, sales orders, and projects. In this chapter, we will explore a few important ways to deal with emails in Odoo.</p>
			<p>Here, we’ll cover the following recipes:</p>
			<ul>
				<li>Configuring incoming and outgoing email servers</li>
				<li>Managing chatter on documents</li>
				<li>Managing activities on documents</li>
				<li>Sending emails using the Jinja template</li>
				<li>Sending emails using the QWeb template</li>
				<li>Managing the email alias</li>
				<li>Logging user changes in a chatter</li>
				<li>Sending periodic digest emails</li>
			</ul>
			<h1 id="_idParaDest-966"><a id="_idTextAnchor1212"/>Technical requirements</h1>
			<p>All the code used in this chapter can be downloaded from <a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter23">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter23</a>.</p>
			<h1 id="_idParaDest-967"><a id="_idTextAnchor1213"/>Configuring incoming and outgoing email servers</h1>
			<p>Before <a id="_idIndexMarker1614"/>you start sending and receiving emails in Odoo, you <a id="_idIndexMarker1615"/>will need to configure the incoming and outgoing email servers. In this recipe, you will learn how to configure email servers in Odoo.</p>
			<h2 id="_idParaDest-968"><a id="_idTextAnchor1214"/>Getting ready</h2>
			<p>There is no development needed for this recipe, but you will require email server information, such as the server URL, port, server type, username, and password. We will use this information to configure the email servers.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you are using <strong class="bold">Odoo Online</strong> or <strong class="bold">Odoo.sh</strong>, you do not need to configure the email servers. You can send and receive emails without any complex configurations on those platforms. This recipe is for on-premises Odoo instances.</p>
			<h2 id="_idParaDest-969"><a id="_idTextAnchor1215"/>How to do it...</h2>
			<p>Configuring incoming and outgoing email servers involves a few steps that are common to the <a id="_idIndexMarker1616"/>processes for incoming and outgoing servers and <a id="_idIndexMarker1617"/>a few steps that are unique to each kind of server. So, first, we will see the common configuration steps, and then we will configure the incoming and outgoing email servers individually. The following are the steps required for both incoming and outgoing email servers:</p>
			<ol>
				<li>Open the <strong class="bold">General Settings</strong> form menu, at <strong class="bold">Settings</strong> | <strong class="bold">General Settings</strong>.</li>
				<li>Go to the <strong class="bold">Discuss</strong> section and inside <strong class="bold">Alias Domain</strong>. This will display the following options:</li>
			</ol>
			<p class="IMG---Figure">               </p>
			<div><div><img src="img/B20997_23_01.jpg" alt="Figure 23.1 – Setting an alias domain"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.1 – Setting an alias domain</p>
			<ol>
				<li value="3">In the <strong class="bold">Alias Domain</strong> field, enter the domain name on which your email server is running. Then, save the configuration.</li>
			</ol>
			<h3>Configuring the incoming email server</h3>
			<p>Perform <a id="_idIndexMarker1618"/>the following steps to configure the incoming email server:</p>
			<ol>
				<li>Open <strong class="bold">General Settings</strong> and click on the <strong class="bold">Incoming Email Servers</strong> link under Technical | Email. This will redirect you to a list view of incoming email servers.</li>
				<li>Click on the <strong class="bold">Create</strong> button, which will open the following form view. Enter the details of your incoming email server (see the <em class="italic">How it works…</em> section for an explanation of each field):</li>
			</ol>
			<div><div><img src="img/B20997_23_02.jpg" alt="Figure 23.2 – Configuring the incoming email server"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.2 – Configuring the incoming email server</p>
			<ol>
				<li value="3">Click on <a id="_idIndexMarker1619"/>the <strong class="bold">Test &amp; Confirm</strong> button to verify your configuration. It will show an error message if you have wrongly configured the incoming email server.</li>
			</ol>
			<h3>Configuring the outgoing email server</h3>
			<p>Follow these <a id="_idIndexMarker1620"/>steps to configure the outgoing email server:</p>
			<ol>
				<li>Open <strong class="bold">General Settings</strong> and enable the <strong class="bold">Custom Email Servers</strong> option, then click on the <strong class="bold">Outgoing Email Servers</strong> link. This will redirect you to the list view of outgoing email servers.</li>
				<li>Click on <strong class="bold">Create</strong>, which will open the following form view. Enter the details of your outgoing email server (see the <em class="italic">How it works…</em> section for an explanation of each field):</li>
			</ol>
			<div><div><img src="img/B20997_23_03.jpg" alt="Figure 23.3 – Configuring the outgoing email server"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.3 – Configuring the outgoing email server</p>
			<ol>
				<li value="3">Click on <strong class="bold">Test Connection</strong> at the bottom of the screen to verify your configuration. It will show an error message if you have wrongly configured the outgoing email server.</li>
			</ol>
			<p>The outgoing email server will display the error dialog even if you have configured it properly. Look for a <strong class="bold">Connection Test Successful!</strong> message in the error dialog body. It means your outgoing server is configured correctly.</p>
			<h2 id="_idParaDest-970"><a id="_idTextAnchor1216"/>How it works...</h2>
			<p>The steps given in this recipe are self-explanatory and do not require further explanation. But the outgoing email and incoming email records have several fields, so let’s see their purpose.</p>
			<p>Here is a <a id="_idIndexMarker1621"/>list of fields used to configure the incoming email server:</p>
			<ul>
				<li><strong class="bold">Name</strong>: The name of the server, which helps you identify a specific incoming email server when you have configured multiple incoming email servers.</li>
				<li><strong class="bold">Server Type</strong>: Here, you need to choose from three options: <strong class="bold">POP Server</strong>, <strong class="bold">IMAP Server</strong>, and <strong class="bold">Local Server</strong>. The value of this field will be based on your email service provider.</li>
				<li><strong class="bold">Server Name</strong>: The domain of the server on which the service is running.</li>
				<li><strong class="bold">Port</strong>: The number of the port on which the server is running.</li>
				<li><strong class="bold">SSL/TLS</strong>: Check this field if you are using SSL/TLS encryption.</li>
				<li><strong class="bold">Username</strong>: The email address for which you are fetching emails.</li>
				<li><strong class="bold">Password</strong>: The password for the email address provided.</li>
				<li><strong class="bold">Active</strong>: This field is used to enable or disable the incoming email server.</li>
				<li><strong class="bold">Keep Attachment</strong>: Turn off this option if you do not want to manage attachments from incoming emails.</li>
				<li><strong class="bold">Keep Original</strong>: Turn on this option if you want to keep the original email along with the preceding one.</li>
			</ul>
			<p>The following is a <a id="_idIndexMarker1622"/>list of fields used for configuring the outgoing email server:</p>
			<ul>
				<li><strong class="bold">Name</strong>: The name of the server, which helps you identify a specific incoming email server when you have configured multiple incoming email servers.</li>
				<li><strong class="bold">Priority</strong>: This field is used to define the priority of the outgoing email server. Lower numbers get higher priority, so email servers with a lower priority number will be used most.</li>
				<li><strong class="bold">SMTP Server</strong>: The domain of the server on which the service is running.</li>
				<li><strong class="bold">SMTP Port</strong>: The number <a id="_idIndexMarker1623"/>of the port on which the server is running.</li>
				<li><strong class="bold">Connection Encryption</strong>: The type of security used to send emails.</li>
				<li><strong class="bold">Username</strong>: The email account used for sending emails.</li>
				<li><strong class="bold">Password</strong>: The password for the email account provided.</li>
				<li><strong class="bold">Active</strong>: This field is used to enable or disable the outgoing email server.</li>
			</ul>
			<h2 id="_idParaDest-971"><a id="_idTextAnchor1217"/>There’s more...</h2>
			<p>By default, incoming emails are fetched every 5 minutes. If you want to change this interval, follow these steps:</p>
			<ol>
				<li>Activate developer mode.</li>
				<li>Open <strong class="bold">Scheduled Actions</strong> at <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Automation</strong> |<strong class="bold"> </strong><strong class="bold">Scheduled Actions</strong>.</li>
				<li>Search for and open the scheduled action named <strong class="bold">Mail: </strong><strong class="bold">Fetchmail Service</strong>.</li>
				<li>Change the interval using the field labeled <strong class="bold">Execute Every</strong>.</li>
			</ol>
			<h1 id="_idParaDest-972"><a id="_idTextAnchor1218"/>Managing chatter on documents</h1>
			<p>In this recipe, you <a id="_idIndexMarker1624"/>will learn how to manage chatter on your documents and add a communication thread to a record.</p>
			<h2 id="_idParaDest-973"><a id="_idTextAnchor1219"/>Getting ready</h2>
			<p>For this recipe, we will reuse the <code>my_hostel</code> module from <a href="B20997_08.xhtml#_idTextAnchor388"><em class="italic">Chapter 8</em></a>, <em class="italic">Advanced Server-Side Development Techniques</em>. You can grab an initial copy of the module from the <code>Chapter23/ 00_initial_module</code> directory of the GitHub repository for this hostel room. In this recipe, we will add chatter to the <code>hostel.student</code> model.</p>
			<h2 id="_idParaDest-974"><a id="_idTextAnchor1220"/>How to do it...</h2>
			<p>Follow these <a id="_idIndexMarker1625"/>steps to add chatter on the records of the <code>hostel.student</code> model:</p>
			<ol>
				<li>Add the <code>mail</code> module dependency in the <code>__manifest__.py</code> file:<pre class="source-code">
...
'depends': ['mail'],
...</pre></li>				<li>Inherit <code>mail.thread</code> in the Python definition of the <code>hostel.student</code> model:<pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _description = "Hostel Student Information"
   _inherit = ['mail.thread']
...</pre></li>				<li>Add chatter widgets on the form view of the <code>hostel.student</code> model:<pre class="source-code">
...
&lt;/sheet&gt;
                   &lt;div class="oe_chatter"&gt;
                       &lt;field name="message_follower_ids" widget="mail_followers"/&gt;
                       &lt;field name="message_ids" widget="mail_thread"/&gt;
                   &lt;/div&gt;
               &lt;/form&gt;
...</pre></li>				<li>Install the <code>my_hostel</code> module to see the changes in action:</li>
			</ol>
			<div><div><img src="img/B20997_23_04.jpg" alt="Figure 23.4 – Chatter on the hostel student form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.4 – Chatter on the hostel student form view</p>
			<p>As shown <a id="_idIndexMarker1626"/>in the preceding screenshot, after installing the module, you will be able to see chatter in the form view.</p>
			<h2 id="_idParaDest-975"><a id="_idTextAnchor1221"/>How it works...</h2>
			<p>In order to enable chatter on any model, you will need to install the <code>mail</code> module first. This is because all the code required to enable chatter or mailing capabilities is part of the <code>mail</code> module. That’s why, in <em class="italic">step 1</em>, we added the <code>mail</code> module dependency in the manifest file of the <code>my_hostel</code> module. This will automatically install the <code>mail</code> module whenever you install the <code>my_hostel</code> module.</p>
			<p>The fields and methods required to operate chatter are part of the <code>mail.thread</code> model. The <code>mail.thread</code> model is an abstract model and is just used for inheritance purposes. In <em class="italic">step 2</em>, we inherited the <code>mail.thread</code> model in the <code>hostel.student</code> model. This will add all the necessary fields and methods required for chatter in the <code>hostel.student</code> model. If you don’t know how model inheritance works, refer to the <em class="italic">Using abstract models for reusable model features</em> recipe in <a href="B20997_04.xhtml#_idTextAnchor118"><em class="italic">Chapter 4</em></a>, <em class="italic">Application Models</em>.</p>
			<p>In <em class="italic">steps 1</em> and <em class="italic">2</em>, we added all the fields and methods required for chatter. The only remaining thing for chatter is adding a user interface in the form view. In <em class="italic">step 3</em>, we added a message thread and follower widget. You might be wondering about the <code>message_follower_ids</code> and <code>message_ids</code> fields. These fields are not added in the <code>hostel.student</code> model definition but they are added from the <code>mail.thread</code> model through inheritance.</p>
			<h2 id="_idParaDest-976"><a id="_idTextAnchor1222"/>There’s more...</h2>
			<p>When you post messages in a chatter, emails will be sent to the followers. If you noticed in the example <a id="_idIndexMarker1627"/>of this recipe, the room of the student is not the follower of the records, so they will not receive the messages. If you want to send an email notification to the student, you will need to add them to the student list. You can add the follower manually from the user interface, but if you want to add them automatically, you can use the <code>message_subscribe()</code> method. Take a look at the following code—when we assign a hostel room, the given code will automatically add the student to the list of followers:</p>
			<pre class="source-code">
   @api.model
   def create(self, values):
       result = super().create(values)
       partner_id = self.env['res.partner'].create({
           'name': result.name,
           'email': result.email
       })
       result.message_subscribe(partner_ids=[partner_id.id])
       return result</pre>			<p>Similarly, if you want to remove followers from the list, you can use the <code>message_unsubscribe()</code> method.</p>
			<h1 id="_idParaDest-977"><a id="_idTextAnchor1223"/>Managing activities on documents</h1>
			<p>When using chatter, you can also add activities. These are used to plan your actions on the record. It is <a id="_idIndexMarker1628"/>kind of a to-do list for each record. In this recipe, you will learn how to enable activities on any model.</p>
			<h2 id="_idParaDest-978"><a id="_idTextAnchor1224"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe, <em class="italic">Managing chatter on documents</em>. We will add activities to the <code>hostel.student</code> model.</p>
			<h2 id="_idParaDest-979"><a id="_idTextAnchor1225"/>How to do it...</h2>
			<p>Follow these steps to add activities to the <code>hostel.student</code> model:</p>
			<ol>
				<li>Inherit <code>mail.activity.mixin</code> in the Python definition of the <code>hostel.student</code> model:<pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _description = "Hostel Student Information"
   _inherit = ['mail.thread', 'mail.activity.mixin']
...</pre></li>				<li>Add the <code>mail_activity</code> widget in the chatter of the <code>hostel.student</code> model:<pre class="source-code">
...
&lt;div class="oe_chatter"&gt;
                       &lt;field name="message_follower_ids" 
                       widget="mail_followers"/&gt;
                       &lt;field name="activity_ids" widget="mail_
                       activity"/&gt;
                       &lt;field name="message_ids" widget="mail_
                       thread"/&gt;
                   &lt;/div&gt;
...</pre></li>				<li>Update the <code>my_hostel</code> module to apply the changes. This will display chatter activities:</li>
			</ol>
			<div><div><img src="img/Image96422.jpg" alt="Figure 23.5 – Activity manager on the hostel student form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.5 – Activity manager on the hostel student form view</p>
			<p>This is how the user <a id="_idIndexMarker1629"/>will be able to manage different chatter activities. Note that an activity scheduled by one user is visible to all other users too.</p>
			<h2 id="_idParaDest-980"><a id="_idTextAnchor1226"/>How it works...</h2>
			<p>Activities are part of the <code>mail</code> module, and you can optionally enable them in chatter. In order to enable activities on records, you need to inherit <code>mail.activity.mixin</code>. Similar to the <code>mail.thread</code> model, <code>mail.activity.mixin</code> is also an abstract model. Inheriting <code>mail.activity.mixin</code> will add all the necessary fields and methods in the module. These methods and fields are used to manage activities on records. In <em class="italic">step 1</em>, we added <code>mail.activity.mixin</code> into the <code>hostel.student</code> model. Because of this, the inheritance of <code>hostel.student</code> will get all the methods and fields required to manage activities.</p>
			<p>In <em class="italic">step 2</em>, we added the <code>mail_activity</code> widget in the form view. This will display the UI for managing activities. The <code>activity_ids</code> field is added in the <code>hostel.student</code> model through inheritance.</p>
			<p>Activities can be <a id="_idIndexMarker1630"/>of different types. By default, you can create activities with types such as <code>Email</code>, <code>Call</code>, <code>Meeting</code>, and <code>To-Do</code>. If you want to add your own activity type, you can do it by going to <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Discuss</strong> | <strong class="bold">Activity Types</strong> in developer mode.</p>
			<h2 id="_idParaDest-981"><a id="_idTextAnchor1227"/>There’s more...</h2>
			<p>If you want to schedule an activity automatically, you can use the <code>activity_schedule()</code> method of the <code>mail.activity.mixin</code> model. This will create an activity on a given discharge date. You can schedule the activity manually with the <code>activity_schedule()</code> method, as follows:</p>
			<pre class="source-code">
@api.model
   def create(self, values):
       result = super(HostelStudent, self).create(values)
       if result.discharge_date:
           result.activity_schedule('mail.mail_activity_data_call',
                               date_deadline=result.discharge_date)
       return result
    return res</pre>			<p>This example will schedule a call activity for the student whenever someone discharges a hostel. The deadline for the activity will be set as the discharge date of the hostel so that the rector can make a call to the student on that date.</p>
			<h1 id="_idParaDest-982"><a id="_idTextAnchor1228"/>Sending emails using the Jinja template</h1>
			<p>Odoo <a id="_idIndexMarker1631"/>supports creating dynamic emails through Jinja <a id="_idIndexMarker1632"/>templates. Jinja is a text-based templating engine used to generate dynamic HTML content. In this recipe, we will create a Jinja email template and then send emails with its help.</p>
			<h2 id="_idParaDest-983"><a id="_idTextAnchor1229"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe, <em class="italic">Managing activities on documents</em>. We will add the Jinja template to send an email to the student to tell them about the admission to the hostel.</p>
			<h2 id="_idParaDest-984"><a id="_idTextAnchor1230"/>How to do it...</h2>
			<p>Follow these <a id="_idIndexMarker1633"/>steps to send a reminder email to the student:</p>
			<ol>
				<li>Create <a id="_idIndexMarker1634"/>a new file called <code>my_hostel/data/mail_template.xml</code> and add the email template:<pre class="source-code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;odoo noupdate="1"&gt;
   &lt;record id="assign_room_to_student" model="mail.template"&gt;
       &lt;field name="name"&gt;Assign Room To Student&lt;/field&gt;
       &lt;field name="model_id" ref="my_hostel.model_hostel_student"/&gt;
       &lt;field name="email_from"&gt;{{ (object.room_id.create_uid.email) }}&lt;/field&gt;
       &lt;field name="email_to"&gt;{{ (object.email) }}&lt;/field&gt;
       &lt;field name="subject"&gt;Assign Room&lt;/field&gt;
       &lt;field name="body_html" type="html"&gt;
           &lt;div style="margin: 0px; padding: 0px;"&gt;
               &lt;p style="margin: 0px; padding: 0px; font-size: 13px;"&gt;
                   Dear &lt;t t-out="object.name"&gt;&lt;/t&gt;,
                   &lt;br/&gt;&lt;br/&gt;
                   &lt;p&gt;You have been assigned hostel
                       &lt;b&gt;&lt;t t-out="object.hostel_id.name"&gt;&lt;/t&gt;&lt;/b&gt; and room no &lt;t t-out="object.room_id.room_no"&gt;&lt;/t&gt;.
                   &lt;br/&gt;
                   Your admission date in a hostel is &lt;b style="color:red;"&gt;&lt;t t-out="format_date(object.admission_date)"&gt;&lt;/t&gt;.&lt;/b&gt;
                   &lt;/p&gt;
                   &lt;br/&gt;
                   &lt;p&gt;Best regards,
                   &lt;br/&gt;&lt;t t-out="object.hostel_id.name"&gt;&lt;/t&gt;&lt;/p&gt;
               &lt;/p&gt;
           &lt;/div&gt;
       &lt;/field&gt;
   &lt;/record&gt;
&lt;/odoo&gt;</pre></li>				<li>Register <a id="_idIndexMarker1635"/>the <a id="_idIndexMarker1636"/>template file in the manifest file:<pre class="source-code">
...
"data": [
       "security/hostel_security.xml",
       "security/ir.model.access.csv",
       "data/categ_data.xml",
       "<strong class="bold">data/mail_template.xml",</strong>
       "views/hostel.xml",
       "views/hostel_room.xml",
       "views/hostel_amenities.xml",
       "views/hostel_student.xml",
       "views/hostel_categ.xml",
       "views/hostel_room_category_view.xml",
   ],
...</pre></li>				<li>Add <a id="_idIndexMarker1637"/>a <code>hostel.student</code> model to send the email:<pre class="source-code">
...
&lt;header&gt;
    &lt;button name="send_mail_assign_room"
            string="Send Email For Assign Room"
            type="object"/&gt;
    &lt;button name="action_assign_room"
            string="Assign Room"
            type="object"
            class="btn-primary"/&gt;
    &lt;field name="status" widget="statusbar" options="{'clickable':           '1'}"/&gt;
&lt;/header&gt;
...</pre></li>				<li>Add the <code>send_mail_assign_room()</code> method to the <code>hostel.student</code> model:<pre class="source-code">
...
def send_mail_assign_room(self):
      self.message_post_with_source('my_hostel.assign_room_to_student')</pre></li>			</ol>
			<p>Update <a id="_idIndexMarker1639"/>the <code>my_hostel</code> module to apply the <a id="_idIndexMarker1640"/>changes. This will add a <code> </code><code>hostel.student</code> model. When they click on the button, followers will get this message:</p>
			<div><div><img src="img/B20997_23_06.jpg" alt="Figure 23.6 – Email sent via a Jinja template"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.6 – Email sent via a Jinja template</p>
			<p>The procedure shown in this recipe is useful when you want to send updates to your customers through emails. Because of the Jinja template, you can send emails dynamically based on individual records.</p>
			<h2 id="_idParaDest-985"><a id="_idTextAnchor1231"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we created an email template using Jinja. Jinja templates help us generate a dynamic email based on record data. The email template is stored in the <code>mail.template</code> model. Let’s see a list of fields you will need to pass in order to create a <a id="_idIndexMarker1641"/>Jinja email template:</p>
			<ul>
				<li><code>name</code>: The name of the template that is used to identify a specific template.</li>
				<li><code>email_from</code>: The value of this field will be the email address from which this email is sent.</li>
				<li><code>email_to</code>: The value of this field will be the email address of the recipient.</li>
				<li><code>email_cc</code>: The value of this field will be used for the email address to send a copy of the email.</li>
				<li><code>subject</code>: This field contains the subject of the email.</li>
				<li><code>model_id</code>: This field contains the reference of the model. The email template will be rendered with the data of this model.</li>
				<li><code>body_html</code>: This field will contain the body of the email template. It is a Jinja template, so you can use variables, loops, conditions, and so on. If you want to learn more about Jinja templates, go to <a href="http://jinja.pocoo.org/docs/2.10/">http://jinja.pocoo.org/docs/2.10/</a>. Usually, we wrap the content in the <code>CDATA</code> tag so that the content in the body is considered as character data and not as markup.</li>
				<li><code>auto_delete</code>: This is a Boolean field that deletes an email once the email is sent. The default value of this field is <code>False</code>.</li>
				<li><code>lang</code>: This field is used to translate the email template into another language.</li>
				<li><code>scheduled_date</code>: This field is used to schedule emails in the future.</li>
			</ul>
			<p class="callout-heading">Information</p>
			<p class="callout">You can use <code>${}</code> in the <code>email_form</code>, <code>email_to</code>, <code>email_cc</code>, <code>subject</code>, <code>scheduled_date</code>, and <code>lang</code> fields. This helps you to set values dynamically. Take a look at <em class="italic">step 1</em> in our recipe—we used <code>{{ (object.email) }}</code> to set the <code>email_to</code> field dynamically.</p>
			<p>If you look closely at the content of the <code>body_html</code> field, you will notice we used <code>&lt;t t-out="object.name"&gt;</code>. Here, the object is the recordset of the <code>hostel.student</code> model. During the rendering,<code>&lt;t t-out="object.hostel_id.name"&gt;&lt;/t&gt;</code> will be replaced with the hostel name. As well as <code>object</code>, some other helper functions and variables are passed in the rendering <a id="_idIndexMarker1642"/>context. Here is a list of helpers passed <a id="_idIndexMarker1643"/>to the renderer context:</p>
			<ul>
				<li><code>object</code>: This variable will contain the recordset of the model, which is set in the template by the <code>model_id</code> field</li>
				<li><code>format_date</code>: This is a reference to the method used to format date-time objects</li>
				<li><code>format_datetime</code>: This is a reference to the method used to convert the UTC date and time into the date and time for another time zone</li>
				<li><code>format_amount</code>: This is a reference to the method used to convert <code>float</code> into <code>string</code> with the currency symbol</li>
				<li><code>format_duration</code>: This method is used to convert <code>float</code> into <code>time</code>—for instance, to convert 1.5 to 01:30</li>
				<li><code>user</code>: This will be the recordset of the current user</li>
				<li><code>ctx</code>: This will contain the dictionary of the environment context</li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">If you want to see the list of templates, activate developer mode, and open the <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Email</strong> | <strong class="bold">Templates</strong> menu. The form view of the template also provides a button to preview the rendered template.</p>
			<p>In <em class="italic">step 2</em>, we registered the template file in the manifest file.</p>
			<p>In <em class="italic">step 3</em>, we added a button in the form view to invoke the <code>send_mail_assign_room()</code> method, which will send the email to the followers.</p>
			<p>In <em class="italic">step 4</em>, we added the <code>send_mail_assign_room()</code> method, which will be invoked by clicking the button. The<code> message_post_with_source()</code> method is used to send the email. The <code>message_post_with_source()</code> method is inherited in the model through <code>mail.thread</code> inheritance. To send the email, you just need to pass the template ID as the parameter.</p>
			<h2 id="_idParaDest-986"><a id="_idTextAnchor1232"/>There’s more...</h2>
			<p>The <code>message_post_with_source()</code> method is used to send emails with the Jinja template. If you just want to send an email with plain text, you can use the <code>message_post()</code> method:</p>
			<pre class="source-code">
self.message_post(body="Your hostel admission process is completed.")</pre>			<p>The preceding <a id="_idIndexMarker1644"/>code will add a <code>subtype_id</code> parameter.</p>
			<h1 id="_idParaDest-987"><a id="_idTextAnchor1233"/>Sending emails using the QWeb template</h1>
			<p>In the previous recipe, we learned how to send emails using the Jinja template. In this recipe, we will <a id="_idIndexMarker1646"/>see another way to send dynamic <a id="_idIndexMarker1647"/>emails. We will send emails with the help of the QWeb template.</p>
			<h2 id="_idParaDest-988"><a id="_idTextAnchor1234"/>Getting ready</h2>
			<p>For this recipe, we will use the <code>my_hostel</code> module from the previous recipe, <em class="italic">Sending emails using the Jinja template</em>. We will use the QWeb template to send an email to the student informing them that their admission was completed in the hostel.</p>
			<h2 id="_idParaDest-989"><a id="_idTextAnchor1235"/>How to do it...</h2>
			<p>Follow these steps to send a reminder email to the student:</p>
			<ol>
				<li>Add <a id="_idIndexMarker1648"/>the QWeb <a id="_idIndexMarker1649"/>template into the <code>my_hostel/data/mail_template.xml</code> file:<pre class="source-code">
   &lt;template id="assign_room_to_student_qweb"&gt;
       &lt;p&gt;Dear &lt;span t-field="object.name"/&gt;,&lt;/p&gt;
       &lt;br/&gt;
       &lt;p&gt;You have been assigned hostel
           &lt;b&gt;
               &lt;span t-field="object.hostel_id.name"/&gt;
           &lt;/b&gt; and room no &lt;span t-field="object.room_id.room_no"/&gt;.
           &lt;br/&gt;
           Your admission date in a hostel is
           &lt;b style="color:red;"&gt;
               &lt;span t-field="object.admission_date"/&gt;.
           &lt;/b&gt;
       &lt;/p&gt;
       &lt;br/&gt;
       &lt;p&gt;Best regards,
           &lt;br/&gt;
           &lt;span t-field="object.hostel_id.name"/&gt;
       &lt;/p&gt;
   &lt;/template&gt;</pre></li>				<li>Add <a id="_idIndexMarker1650"/>a <code>hostel.student</code> model to send the email:<pre class="source-code">
...
&lt;header&gt;
     &lt;button name="send_mail_assign_room"
             string="Send Email For Assign Room"
             type="object"/&gt;
     &lt;button name="send_mail_assign_room_qweb"
             string="Send Email For Assign Room (QWeb)"
             type="object"/&gt;
     &lt;button name="action_assign_room"
             string="Assign Room"
             type="object"
             class="btn-primary"/&gt;
     &lt;field name="status" widget="statusbar" 
     options="{'clickable': '1'}"/&gt;
&lt;/header&gt;
...</pre></li>				<li>Add the <code>send_mail_assign_room_qweb()</code> method in the <code>hostel.student</code> model:<pre class="source-code">
...
def send_mail_assign_room_qweb(self):
  self.message_post_with_source('my_hostel.assign_room_to_student_qweb')</pre></li>				<li>Update the <code>my_hostel</code> module to apply the changes. This will add a <code>hostel.student</code> model. When the button is clicked, followers will get a message like this:</li>
			</ol>
			<div><div><img src="img/B20997_23_07.jpg" alt="Figure 23.7 – Email sent via the QWeb template"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.7 – Email sent via the QWeb template</p>
			<p>The procedure shown in this recipe works exactly like the previous recipe, <em class="italic">Sending emails using the Jinja template</em>. The only difference is the template type, as this recipe uses QWeb templates.</p>
			<h2 id="_idParaDest-990"><a id="_idTextAnchor1236"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we created a QWeb template with the <code>send_mail_assign_room_qweb</code> ID. If you look in the template, you’ll see we are not using the <code>format_date()</code> data field method anymore. This is because the QWeb <a id="_idIndexMarker1652"/>rendering engine handles this automatically <a id="_idIndexMarker1653"/>and displays the date based on the user’s language. For the same reason, you are not required to use the <code>format_amount()</code> method to display currency symbols. The QWeb rendering engine will manage this automatically. If you want to learn more about QWeb templates, refer to the <em class="italic">Creating or modifying templates</em> recipe in <a href="B20997_14.xhtml#_idTextAnchor734"><em class="italic">Chapter 14</em></a>, <em class="italic">CMS </em><em class="italic">Website Development</em>.</p>
			<p>In <em class="italic">step 2</em>, we added a button in the form view to invoke the <code>send_mail_assign_room_qweb()</code> method, which sends the email to the followers.</p>
			<p>In <em class="italic">step 3</em>, we added the <code>send_mail_assign_room_qweb()</code> method, which will be invoked by a button click. The <code>message_post_with_source()</code> method is used to send the email. The <code>message_post_with_source()</code> method is inherited in the model through <code>mail.thread</code> inheritance. To send the email, you just need to pass the web template’s XML ID as the parameter.</p>
			<p>Sending <a id="_idIndexMarker1654"/>emails with the QWeb template works <a id="_idIndexMarker1655"/>exactly the same as in the previous recipe, but there are some subtle differences between the QWeb email template and the Jinja email template. Here is a quick comparison between both templates:</p>
			<ul>
				<li>There is no simple way to send extra parameters in the email templates. You have to use a recordset in the <code>object</code> variable to fetch dynamic data. On the other hand, with QWeb email templates, you can pass extra values in the renderer context through the <code>values</code> parameter:<pre class="source-code">
self.message_post_with_source('my_hostel.assign_room_to_student_qweb',
                                   values={'extra_data': 'test'})</pre></li>				<li>To manage the date format, time zone, and amount with currency symbols, in the Jinja template, you have to use the <code>format_date</code>, <code>format_tz</code>, and <code>format_amount</code> functions, while in QWeb templates, it is managed automatically.</li>
				<li>It is not possible to modify an existing template for other modules in Jinja, whereas in QWeb templates, you can modify the email template through inheritance. If you want to learn more about QWeb inheritance, refer to the <em class="italic">Creating or modifying templates</em> recipe in <a href="B20997_14.xhtml#_idTextAnchor734"><em class="italic">Chapter 14</em></a>, <em class="italic">CMS </em><em class="italic">Website Development</em>.</li>
				<li>You can select and use a Jinja template directly from the message composer. In the following screenshot, the drop-down menu in the bottom-right corner is used to select a Jinja template:</li>
			</ul>
			<div><div><img src="img/B20997_23_08.jpg" alt="Figure 23.8 – Template selection option"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.8 – Template selection option</p>
			<ul>
				<li>Using QWeb, selecting a template directly from the message composer is not an option.</li>
			</ul>
			<h2 id="_idParaDest-991"><a id="_idTextAnchor1237"/>There’s more...</h2>
			<p>All methods (<code>message_post</code> and <code>message_post_with_source</code>) respect the user’s preference. If <a id="_idIndexMarker1656"/>the user changes the notification-management option from the user preferences, the user will not receive emails; instead, they <a id="_idIndexMarker1657"/>will receive notifications in Odoo’s UI. This is the same for customers; if a customer opts out of emails, they will not receive any updates through email.</p>
			<p>Additionally, the Odoo message <a id="_idIndexMarker1658"/>thread follows a concept called <code>subtype_id</code>, in <code>message_post_*</code> methods to send emails based on the subtype. Usually, the user will manage their subtypes from the dropdown of the <strong class="bold">Follow</strong> button. Let’s suppose the user has set their subtypes as follows:</p>
			<p class="IMG---Figure">            </p>
			<div><div><img src="img/B20997_23_09.jpg" alt="Figure 23.9 – Option to edit subtype"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.9 – Option to edit subtype</p>
			<p>Based on the user’s preference, the user will only get emails for <strong class="bold">Discussions</strong> messages.</p>
			<h1 id="_idParaDest-992"><a id="_idTextAnchor1238"/>Managing the email alias</h1>
			<p>Email aliasing is a feature in Odoo that is used to create a record through incoming emails. The <a id="_idIndexMarker1659"/>simplest example of an email alias is sales teams. You just need to send an email to <code>sale@yourdomain.com</code>, and Odoo will create a new record for <code>crm.lead</code> in the sales team. In this recipe, we will create one email alias to create a hostel student record.</p>
			<h2 id="_idParaDest-993"><a id="_idTextAnchor1239"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe, <em class="italic">Sending emails using the QWeb template</em>. We will create our email alias with the <code>hostelstudent@yourdomain.com</code> email address. If you send an email to this email address with the book’s name in the subject, a record is created in the <code>hostel.student</code> model.</p>
			<h2 id="_idParaDest-994"><a id="_idTextAnchor1240"/>How to do it...</h2>
			<p>Follow these steps to add an email alias for the <code>hostel.student</code> model:</p>
			<ol>
				<li>Add the email alias data in the <code>my_hostel/data/mail_template.xml</code> file:<pre class="source-code">
&lt;record id="mail_alias_room_assign" model="mail.alias"&gt;
       &lt;field name="alias_name"&gt;room&lt;/field&gt;
       &lt;field name="alias_model_id" ref="model_hostel_student"/&gt;
       &lt;field name="alias_contact"&gt;partners&lt;/field&gt;
   &lt;/record&gt;</pre></li>				<li>Add the following imports in the <code>my_hostel/models/hostel_student.py</code> file:<pre class="source-code">
import re
from odoo.tools import email_split, email_escape_char</pre></li>				<li>Override <a id="_idIndexMarker1660"/>the <code>message_new()</code> method in the <code>hostel.student</code> model:<pre class="source-code">
   @api.model
   def message_new(self, msg_dict, custom_values=None):
       self = self.with_context(default_user_id=False)
       if custom_values is None:
           custom_values = {}
       custom_values['name'] = re.match(r"(.+?)\s*&lt;(.+?)&gt;", msg_dict.get('from')).group(1)
       custom_values['email'] = email_escape_char(email_split(msg_dict.get('from'))[0])
       return super(HostelStudent, self).message_new(msg_dict, custom_values)</pre></li>			</ol>
			<p>Update the <code>my_hostel</code> module to apply the changes. Then, send an email to <code>hostelstudent@yourdomain.com</code>. This will create a new <code>hostel.student</code> record, and it will be displayed as follows:</p>
			<div><div><img src="img/B20997_23_010.jpg" alt="Figure 23.10 – Record generated via email"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.10 – Record generated via email</p>
			<p>Whenever <a id="_idIndexMarker1661"/>you send an email to <code>hostelstudent@yourdomain.com</code>, Odoo will generate a new student record.</p>
			<h2 id="_idParaDest-995"><a id="_idTextAnchor1241"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we created a <code>mail.alias</code> record. This alias will handle the <code>hostelstudent@yourdomain.com</code> email address. When you send an email to this address, Odoo will create a new record in the <code>hostel.student</code> model. If you want to see the list of active aliases in the system, open <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Email</strong> | <strong class="bold">Aliases</strong>. Here is a list of fields available to configure the alias:</p>
			<ul>
				<li><code>alias_name</code>: This field holds the local part of the email address; for example, the <code>hostelstudent</code> part in <code>hostelstudent@yourdomain.com</code> is the local part of the email address.</li>
				<li><code>alias_model_id</code>: The model reference on which a record should be created for the incoming email.</li>
				<li><code>alias_contact</code>: This field holds the security preferences for the alias. Possible options are <code>everyone</code>, <code>partners</code>, <code>followers</code>, and <code>employees</code>.</li>
				<li><code>alias_defaults</code>: When an incoming email is received, its record is created in the model specified on the alias. If you want to set default values in the record, give the values in the form of a dictionary in this field.</li>
			</ul>
			<p>In <em class="italic">step 2</em>, we added the necessary imports. In <em class="italic">step 3</em>, we overrode the <code>message_new()</code> method. This method is invoked automatically when a new email is received on the alias email address. This method will take two parameters:</p>
			<ul>
				<li><code>msg_dict</code>: This parameter will be the dictionary that contains information about the received email. It contains email information such as the sender’s email address, the receiver’s email address, the email subject, and the email body.</li>
				<li><code>custom_values</code>: This is a custom value used to create a new record. This is the same value you set on the alias record using the <code>alias_defaults</code> field.</li>
			</ul>
			<p>In our recipe, we overrode the <code>message_new()</code> method and fetched the name from the email <a id="_idIndexMarker1662"/>through a regular expression. Then, we fetched the email address of the sender with the help of the tools we imported in <em class="italic">step 2</em>. We used the sender’s email address to create a student record. Then, we updated <code>custom_values</code> with these two values: <code>name</code> and <code>email</code>. We passed this updated <code>custom_values</code> data to the <code>super()</code> method, which created a new <code>hostel.student</code> record with the given <code>name</code> and <code>email</code> values. This is how a record is created when you send an email to the alias.</p>
			<h2 id="_idParaDest-996"><a id="_idTextAnchor1242"/>There’s more...</h2>
			<p>Some business models have a requirement that means you need a separate alias per record. For example, the sales team model has separate aliases for each team, such as <code>sale-in@example.com</code> for Team India and <code>sale-be@example.com</code> for Team Belgium. If you want to manage such aliases in your model, you can use <code>mail.alias.mixin</code>. In order to use it in your model, you will need to inherit the mixin:</p>
			<pre class="source-code">
class Team(models.Model):
    _name = 'crm.team'
    _inherit = ['mail.alias.mixin', 'mail.thread']</pre>			<p>After inheriting the mixin, you will need to add the <code>alias_name</code> field into the form view so that end users can add aliases by themselves.</p>
			<h1 id="_idParaDest-997"><a id="_idTextAnchor1243"/>Logging user changes in a chatter</h1>
			<p>The Odoo framework provides a built-in facility to log field changes in a chatter. In this recipe, we will <a id="_idIndexMarker1663"/>enable logging on some of the fields so that when changes are made in them, Odoo will add logs in the chatter.</p>
			<h2 id="_idParaDest-998"><a id="_idTextAnchor1244"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe, <em class="italic">Managing the email alias</em>. In this recipe, we will log changes from a few fields in the <code>hostel.student</code> model.</p>
			<h2 id="_idParaDest-999"><a id="_idTextAnchor1245"/>How to do it...</h2>
			<p>Modify the definitions of the fields, to enable logs for the fields when you change them. This is shown in the following code snippet:</p>
			<pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _description = "Hostel Student Information"
   _inherit = ['mail.thread', 'mail.activity.mixin']
   name = fields.Char("Student Name")
   email = fields.Char("Student Email")
   gender = fields.Selection([("male", "Male"),
       ("female", "Female"), ("other", "Other")],
       string="Gender", help="Student gender")
   active = fields.Boolean("Active", default=True,
       help="Activate/Deactivate hostel record")
   hostel_id = fields.Many2one("hostel.hostel", "hostel", help="Name of hostel")
   room_id = fields.Many2one("hostel.room", "Room",
       help="Select hostel room")
   status = fields.Selection([("draft", "Draft"),
       ("reservation", "Reservation"), ("pending", "Pending"),
       ("paid", "Done"),("discharge", "Discharge"), ("cancel", "Cancel")],
       string="Status", copy=False, default="draft",
       help="State of the student hostel")
   admission_date = fields.Date("Admission Date",
       help="Date of admission in hostel",
       default=fields.Datetime.today,
       tracking=True)
   discharge_date = fields.Date("Discharge Date",
       help="Date on which student discharge",
       tracking=True)
   duration = fields.Integer("Duration", compute="_compute_check_duration", inverse="_inverse_duration",
                              help="Enter duration of living")</pre>			<p>Update <a id="_idIndexMarker1664"/>the <code>my_hostel</code> module to apply the changes. Create a new record in the <code>hostel.student</code> model, make some changes in the fields, and then admission and discharge the hostel. If you check the chatter, you will see the following logs:</p>
			<div><div><img src="img/B20997_23_011.jpg" alt="Figure 23.11 – Changelogs in the chatter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.11 – Changelogs in the chatter</p>
			<p>Whenever you make changes to <code>state</code>, <code>admission_date</code>, or <code>discharge_date</code>, you will see a new log in the chatter. This will help you to see the full history of the record.</p>
			<h2 id="_idParaDest-1000"><a id="_idTextAnchor1246"/>How it works...</h2>
			<p>By adding the <code>tracking=True</code> attribute on the field, you can enable logging for that field. When you set the <code>tracking=True</code> attribute, Odoo will add a log that changes in the chatter whenever you update the field value. If you enable tracking on multiple records and <a id="_idIndexMarker1665"/>you want to provide a sequence in the tracking values, you can also pass a number in the tracking parameter like this: <code>tracking=20</code>. When you pass <code>tracking=True</code>, then the default sequence is used, which is <code>100</code>.</p>
			<p>In our recipe, we added <code>tracking=True</code> on the <code>state</code>, <code>admission_date</code>, and <code>discharge_date</code> fields. This means Odoo will log changes when you update the values of the  <code>admission_date</code>, <code>discharge_date</code>, or <code>state</code> fields. Take a look at the screenshot in the <em class="italic">How to do it…</em> section; we have only changed the <code>admission_date</code> and <code>discharge_date</code> fields.</p>
			<p>Note that the <code>track_visibility</code> feature only works if your model inherits the <code>mail.thread</code> model because the code-related chatter and logs are part of the <code>mail.thread</code> model.</p>
			<h1 id="_idParaDest-1001"><a id="_idTextAnchor1247"/>Sending periodic digest emails</h1>
			<p>The Odoo <a id="_idIndexMarker1666"/>framework has built-in support for sending out periodic digest emails. With digest emails, you can send an email with information about business KPIs. In this recipe, we will send data about the hostel room to the rector (or any other authorized person).</p>
			<h2 id="_idParaDest-1002"><a id="_idTextAnchor1248"/>Getting ready</h2>
			<p>For this recipe, we will be using the <code>my_hostel</code> module from the previous recipe, <em class="italic">Logging user changes in </em><em class="italic">a chatter</em>.</p>
			<h2 id="_idParaDest-1003"><a id="_idTextAnchor1249"/>How to do it...</h2>
			<p>Follow these steps to generate digest emails for room rent records:</p>
			<ol>
				<li>Inherit the <code>digest.digest</code> model and add fields for the KPIs:<pre class="source-code">
class Digest(models.Model):
   _inherit = 'digest.digest'
   kpi_room_rent = fields.Boolean('Room Rent')
   kpi_room_rent_value = fields.Integer(compute='_compute_kpi_room_rent_value')
   def _compute_kpi_room_rent_value(self):
       for record in self:
           start, end, company = record._get_kpi_compute_parameters()
           record.kpi_room_rent_value = self.env['hostel.room'].search_count([
               ('create_date', '&gt;=', start),
               ('create_date', '&lt;', end)
           ])</pre></li>				<li>Inherit the <code>digest.digest</code> model’s <a id="_idIndexMarker1667"/>form view and add the KPI fields:<pre class="source-code">
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;odoo&gt;
   &lt;record id="digest_digest_view_form" model="ir.ui.view"&gt;
       &lt;field name="name"&gt;digest.digest.view.form.inherit.hostel&lt;/field&gt;
       &lt;field name="model"&gt;digest.digest&lt;/field&gt;
       &lt;field name="inherit_id" ref="digest.digest_digest_view_form"/&gt;
       &lt;field name="arch" type="xml"&gt;
           &lt;xpath expr="//group[@name='kpi_general']" position="after"&gt;
               &lt;group name="kpi_hostel" string="Hostel"&gt;
                   &lt;field name="kpi_room_rent"/&gt;
               &lt;/group&gt;
           &lt;/xpath&gt;
       &lt;/field&gt;
   &lt;/record&gt;
&lt;/odoo&gt;</pre></li>			</ol>
			<p>Update the module to apply the changes. Once you update the module, enable developer mode and open <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Emails</strong> | <strong class="bold">Digest Emails</strong>, as seen in the following screenshot:</p>
			<div><div><img src="img/B20997_23_012.jpg" alt="Figure 23.12 – Enabling the digest email for room rent data"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.12 – Enabling the digest email for room rent data</p>
			<p>Once you enable this and if you have subscribed to digest emails, you will start receiving digest emails.</p>
			<h2 id="_idParaDest-1004"><a id="_idTextAnchor1250"/>How it works...</h2>
			<p>In order to <a id="_idIndexMarker1668"/>build a customized digest email, you need two fields. The first field will be a <code>Boolean</code> field, used to enable and disable the KPI, while the second field will be a <code>compute</code> field and will be called to acquire the KPI value. We created both of the fields in <em class="italic">step 1</em>. If you check the definition of the <code>compute</code> field, it uses the <code>_get_kpi_compute_parameters</code> method. This method returns three parameters: a start date, an end date, and the company record. You can use these parameters to generate a value for your KPI. We have returned the number of rooms rented during a particular period of time. If your KPI is multi-website compatible, then you can use a <code>company</code> parameter.</p>
			<p>In <em class="italic">step 2</em>, we added a field to the digest form view. This field is used to enable/disable digest emails. When you enable it, you will start receiving digest emails:</p>
			<div><div><img src="img/B20997_23_013.jpg" alt="Figure 23.13 – Digest email for room rent records"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 23.13 – Digest email for room rent records</p>
			<p>Enable developer <a id="_idIndexMarker1669"/>mode, then open <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Emails</strong> | <strong class="bold">Digest Emails</strong>. Here, you can configure the recipients of digest emails and set the periodicity for digest emails. You can also enable/disable digest emails from here.</p>
		</div>
	</body></html>