<html><head></head><body>
        

            
                <h1 class="header-title">Requests and Web Frameworks</h1>
            

            
                
<p>The main topics of this chapter are requests and web frameworks in Python. We are going to discuss libraries and frameworks that enable retrieving data from the Web (for example, get weather updates), upload data to a remote server (for example, log sensor data), or control appliances on a local network. We will also discuss topics that will help with learning the core topics of this chapter.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">The try/except keywords</h1>
            

            
                
<p>So far, we have reviewed and tested all our examples assuming the ideal condition, that is, the execution of the program will encounter no errors. On the contrary, applications fail from time to time either due to external factors, such as invalid user input and poor Internet connectivity, or program logic errors caused by the programmer. In such cases, we want the program to report/log the nature of error and either continue its execution or clean up resources before exiting the program. The <kbd>try</kbd>/<kbd>except</kbd> keywords offer a mechanism to trap an error that occurs during a program's execution and take remedial action. Because it is possible to trap and log an error in crucial parts of the code, the <kbd>try</kbd>/<kbd>except</kbd> keywords are especially useful while debugging an application.</p>
<p>Let's understand the <kbd>try</kbd>/<kbd>except</kbd> keywords by comparing two examples. Let's build a simple guessing game where the user is asked to guess a number between 0 and 9:</p>
<ol>
<li>A random number (between 0 and 9) is generated using Python's <kbd>random</kbd> module. If the user's guess of the generated number is right, the Python program declares the user as the winner and exits the game.</li>
<li>If the user input is the letter <kbd>x</kbd>, the program quits the game.</li>
<li>The user input is converted into an integer using the <kbd>int()</kbd> function. A sanity check is performed to determine whether the user input is a number between 0 and 9.</li>
<li>The integer is compared against a random number. If they are the same, the user is declared the winner and the program exits the game.</li>
</ol>
<p>Let's observe what happens when we deliberately provide an erroneous input to this program (the code snippet shown here is available for download along with this chapter as <kbd>guessing_game.py</kbd>):</p>
<pre>
import random<br/><br/>if __name__ == "__main__":<br/>    while True:<br/>        # generate a random number between 0 and 9<br/>        rand_num = random.randrange(0,10)<br/><br/>        # prompt the user for a number<br/>        value = input("Enter a number between 0 and 9: ")<br/><br/>        if value == 'x':<br/>            print("Thanks for playing! Bye!")<br/>            break<br/><br/>        input_value = int(value)<br/><br/>        if input_value &lt; 0 or input_value &gt; 9:<br/>            print("Input invalid. Enter a number between 0 and 9.")<br/><br/><br/>        if input_value == rand_num:<br/>            print("Your guess is correct! You win!")<br/>            break<br/>        else:<br/>            print("Nope! The random value was %s" % rand_num)
</pre>
<p>Let's execute the preceding code snippet and provide the input <kbd>hello</kbd> to the program:</p>
<pre>
    <strong>Enter a number between 0 and 9: hello</strong><br/><strong>    Traceback (most recent call last):</strong><br/><strong>        File "guessing_game.py", line 12, in &lt;module&gt;</strong><br/><strong>            input_value = int(value)</strong><br/><strong>    ValueError: invalid literal for int() with base 10: 'hello'</strong>
</pre>
<p>In the preceding example, the program fails when it is trying to convert the user input <kbd>hello</kbd> to an integer. The program execution ends with an exception. An exception highlights the line where the error has occurred. In this case, it has occurred in line 10:</p>
<pre>
    <strong>File "guessing_game.py", line 12, in &lt;module&gt;</strong><br/><strong>    input_value = int(value)</strong>
</pre>
<p>The nature of the error is also highlighted in the exception. In this example, the last line indicates that the exception thrown is <kbd>ValueError</kbd>:</p>
<pre>
    <strong>ValueError: invalid literal for int() with base 10: 'hello'</strong>
</pre>
<p>Let's discuss the same example (available for download along with this chapter as <kbd>try_and_except.py</kbd>) that makes use of the <kbd>try</kbd>/<kbd>except</kbd> keywords. It is possible to continue playing the game after trapping this exception and printing it to the screen. We have the following code:</p>
<pre>
import random<br/><br/>if __name__ == "__main__":<br/>    while True:<br/>        # generate a random number between 0 and 9<br/>        rand_num = random.randrange(0,10)<br/><br/>        # prompt the user for a number<br/>        value = input("Enter a number between 0 and 9: ")<br/><br/>        if value == 'x':<br/>            print("Thanks for playing! Bye!")<br/><br/>        try:<br/>            input_value = int(value)<br/>        except ValueError as error:<br/>            print("The value is invalid %s" % error)<br/>            continue<br/><br/>        if input_value &lt; 0 or input_value &gt; 9:<br/>            print("Input invalid. Enter a number between 0 and 9.")<br/>            continue<br/><br/>        if input_value == rand_num:<br/>            print("Your guess is correct! You win!")<br/>            break<br/>        else:<br/>            print("Nope! The random value was %s" % rand_num)
</pre>
<p>Let's discuss how the same example works with the <kbd>try</kbd>/<kbd>except</kbd> keywords:</p>
<ol>
<li>From the previous example, we know that when a user provides the wrong input (for example, a letter instead of a number between 0 and 9), the exception occurs at line 10 (where the user input is converted into an integer), and the nature of the error is named <kbd>ValueError</kbd>.</li>
<li>It is possible to avoid interruption of the program's execution by wrapping this in a <kbd>try...except</kbd> block:</li>
</ol>
<pre>
      try: <br/>         input_value = int(value) <br/>      except ValueError as error:<br/>         print("The value is invalid %s" % error)
</pre>
<ol start="3">
<li>On receiving a user input, the program attempts converting the user input into an integer under the <kbd>try</kbd> block.</li>
<li>If <kbd>ValueError</kbd> has occurred, <kbd>error</kbd> is trapped by the <kbd>except</kbd> block, and the following message is printed to the screen along with the actual error message:</li>
</ol>
<pre>
       except ValueError as error:<br/>           print("The value is invalid %s" % error)
</pre>
<ol start="5">
<li>Try executing the code example and try providing an invalid input. You will note that the program prints the error message (along with the nature of the error) and goes back to the top of the game loop and continues seeking valid user input:</li>
</ol>
<pre>
       <strong>Enter a number between 0 and 9: 3</strong><br/><strong>       Nope! The random value was 5</strong><br/><strong>       Enter a number between 0 and 9: hello</strong><br/><strong>       The value is invalid invalid literal for int() with<br/>       base 10: 'hello'</strong><br/><strong>       Enter a number between 0 and 10: 4</strong><br/><strong>       Nope! The random value was 6</strong>
</pre>
<p>The <kbd>try...except</kbd> block comes with a substantial processing power cost. Hence, it is important to keep the <kbd>try...except</kbd> block as short as possible. Because we know that the error occurs on the line where we attempt converting the user input into an integer, we wrap it in a <kbd>try...except</kbd> block to trap an error.</p>
<p>Thus, the <kbd>try</kbd>/<kbd>except</kbd> keywords are used to prevent any abnormal behavior in a program's execution due to an error. It enables logging the error and taking remedial action. Similar to the <kbd>try...except</kbd> block, there are also <kbd>try...except...else</kbd> and <kbd>try...except...else</kbd> code blocks. Let's quickly review those options with a couple of examples.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">try...except...else</h1>
            

            
                
<p>The <kbd>try...except...else</kbd> block is especially useful when we want a certain block of code to be executed only when no exceptions are raised. In order to demonstrate this concept, let's rewrite the guessing game example using this block:</p>
<pre>
try:<br/>    input_value = int(value)<br/>except ValueError as error:<br/>    print("The value is invalid %s" % error)<br/>else:<br/>    if input_value &lt; 0 or input_value &gt; 9:<br/>        print("Input invalid. Enter a number between 0 and 9.")<br/>    elif input_value == rand_num:<br/>        print("Your guess is correct! You win!")<br/>        break<br/>    else:<br/>        print("Nope! The random value was %s" % rand_num)
</pre>
<p>The modified guessing game example that makes use of the <kbd>try...except...else</kbd> block is available for download along with this chapter as <kbd>try_except_else.py</kbd>. In this example, the program compares the user input against the random number only if a valid user input was received. It otherwise skips the <kbd>else</kbd> block and goes back to the top of the loop to accept the next user input. Thus, <kbd>try...except...else</kbd> is used when we want a specific code block to be executed when no exceptions are raised due to the code in the <kbd>try</kbd> block.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">try...except...else...finally</h1>
            

            
                
<p>As the name suggests, the <kbd>finally</kbd> block is used to execute a block of code on leaving the <kbd>try</kbd> block. This block of code is executed even after an exception is raised. This is useful in scenarios where we need to clean up resources and free up memory before moving on to the next stage.</p>
<p>Let's demonstrate the function of the <kbd>finally</kbd> block using our guessing game. To understand how the <kbd>finally</kbd> keyword works, let's make use of a counter variable named <kbd>count</kbd> that is incremented in the <kbd>finally</kbd> block, and another counter variable named <kbd>valid_count</kbd> that is incremented in the <kbd>else</kbd> block. We have the following code:</p>
<pre>
count = 0<br/>valid_count = 0<br/>while True:<br/>  # generate a random number between 0 and 9<br/>  rand_num = random.randrange(0,10)<br/><br/>  # prompt the user for a number<br/>  value = input("Enter a number between 0 and 9: ")<br/><br/>  if value == 'x':<br/>      print("Thanks for playing! Bye!")<br/><br/>  try:<br/>      input_value = int(value)<br/>  except ValueError as error:<br/>      print("The value is invalid %s" % error)<br/>  else:<br/>      if input_value &lt; 0 or input_value &gt; 9:<br/>          print("Input invalid. Enter a number between 0 and 9.")<br/>          continue<br/><br/>      valid_count += 1<br/>      if input_value == rand_num:<br/>          print("Your guess is correct! You win!")<br/>          break<br/>      else:<br/>          print("Nope! The random value was %s" % rand_num)<br/>  finally:<br/>      count += 1<br/><br/>print("You won the game in %d attempts "\<br/>      "and %d inputs were valid" % (count, valid_count))
</pre>
<p>The preceding code snippet is from the <kbd>try_except_else_finally.py</kbd> code sample (available for download along with this chapter). Try executing the code sample and playing the game. You will note the total number of attempts it took to win the game and the number of inputs that were valid:</p>
<pre>
    <strong>Enter a number between 0 and 9: g</strong><br/><strong>    The value is invalid invalid literal for int() with<br/>    base 10: 'g'</strong><br/><strong>    Enter a number between 0 and 9: 3</strong><br/><strong>    Your guess is correct! You win!</strong><br/><strong>    You won the game in 9 attempts and 8 inputs were valid</strong>
</pre>
<p>This demonstrates how the <kbd>try-except-else-finally</kbd> block works. Any code under the <kbd>else</kbd> keyword is executed when the critical code block (under the <kbd>try</kbd> keyword) is executed successfully, whereas the code block under the <kbd>finally</kbd> keyword is executed while exiting the <kbd>try...except</kbd> block (useful for cleaning up resources while exiting a code block).</p>
<p>Try providing invalid inputs while playing the game using the previous code example to understand the code block flow.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Connecting to the Internet - web requests</h1>
            

            
                
<p>Now that we discussed the <kbd>try</kbd>/<kbd>except</kbd> keywords, let's make use of it to build a simple application that connects to the Internet. We will write a simple application that retrieves the current time from the Internet. We will be making use of the <kbd>requests</kbd> library for Python (<a href="http://requests.readthedocs.io/en/master/#">http://requests.readthedocs.io/en/master/#</a>).</p>
<p>The <kbd>requests</kbd> module enables connecting to the Web and retrieving information. In order to do so, we need to make use of the <kbd>get()</kbd> method from the <kbd>requests</kbd> module to make a request:</p>
<pre>
import requests<br/>response = requests.get('http://nist.time.gov/actualtime.cgi')
</pre>
<p>In the preceding code snippet, we are passing a URL as an argument to the <kbd>get()</kbd> method. In this case, it is the URL that returns the current time in the Unix format (<a href="https://en.wikipedia.org/wiki/Unix_time">https://en.wikipedia.org/wiki/Unix_time</a>).</p>
<p>Let's make use of the <kbd>try</kbd>/<kbd>except</kbd> keywords to make a request to get the current time:</p>
<pre>
#!/usr/bin/python3<br/><br/>import requests<br/><br/>if __name__ == "__main__":<br/>  # Source for link: http://stackoverflow.com/a/30635751/822170<br/>  try:<br/>    response = requests.get('http://nist.time.gov/actualtime.cgi')<br/>    print(response.text)<br/>  except requests.exceptions.ConnectionError as error:<br/>    print("Something went wrong. Try again")
</pre>
<p>In the preceding example (available for download along with this chapter as <kbd>internet_access.py</kbd>), the request is made under the <kbd>try</kbd> block, and the response (returned by <kbd>response.text</kbd>) is printed to the screen.</p>
<p>If there is an error while executing the request to retrieve the current time, <kbd>ConnectionError</kbd> is raised (<a href="http://requests.readthedocs.io/en/master/user/quickstart/#errors-and-exceptions">http://requests.readthedocs.io/en/master/user/quickstart/#errors-and-exceptions</a>). This error could either be caused by the lack of an Internet connection or an incorrect URL. This error is caught by the <kbd>except</kbd> block. Try running the example, and it should return the current time from <kbd>time.gov</kbd>:</p>
<pre>
    <strong>&lt;timestamp time="1474421525322329" delay="0"/&gt;</strong>
</pre>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">The application of requests - retrieving weather information</h1>
            

            
                
<p>Let's make use of the <kbd>requests</kbd> module to retrieve the weather information for the city of San Francisco. We will be making use of the <strong>OpenWeatherMap</strong> API (<a href="http://openweathermap.org">openweathermap.org</a>) to retrieve the weather information:</p>
<ol>
<li>In order to make use of the API, sign up for an API account and get an API key (it is free of charge):</li>
</ol>
<div><img class=" image-border" height="206" src="img/image_07_001.png" width="624"/></div>
<p>An API key from openweathermap.org</p>
<ol start="2">
<li>According to the API documentation (<a href="http://openweathermap.org/current">openweathermap.org/current</a>), the weather information for a city can be retrieved using <kbd>http://api.openweathermap.org/data/2.5/weather?zip=SanFrancisco&amp;appid=API_KEY&amp;units=imperial</kbd> as the URL.</li>
</ol>
<ol start="3">
<li>Substitute <kbd>API_KEY</kbd> with the key from your account and use it to retrieve the current weather information in a browser. You should be able to retrieve the weather information in the following format:</li>
</ol>
<pre>
<strong>       {"coord":{"lon":-122.42,"lat":37.77},"weather":[{"id":800, <br/>       "main":"Clear","description":"clear sky","icon":"01n"}],"base": <br/>       "stations","main":{"temp":71.82,"pressure":1011,"humidity":50, <br/>       "temp_min":68,"temp_max":75.99},"wind":<br/>       {"speed":13.04,"deg":291},<br/>       "clouds":{"all":0},"dt":1474505391,"sys":{"type":3,"id":9966, <br/>       "message":0.0143,"country":"US","sunrise":1474552682, <br/>       "sunset":1474596336},"id":5391959,"name":"San <br/>       Francisco","cod":200}</strong>
</pre>
<p>The weather information (shown previously) is returned in the JSON format. <strong>JavaScript Object Notation</strong> (<strong>JSON</strong>) is a data format that is widely used to exchange data over the Web. The main advantage of JSON format is that it is in a readable format and many popular programming languages support encapsulating data in JSON format. As shown in the earlier snippet, JSON format enables exchanging information in readable name/value pairs.</p>
<p>Let's review retrieving the weather using the <kbd>requests</kbd> module and parsing the JSON data:</p>
<ol start="1">
<li>Substitute the URL in the previous example (<kbd>internet_access.py</kbd>) with the one discussed in this example. This should return the weather information in the JSON format.</li>
</ol>
<ol start="2">
<li>The requests module provides a method to parse the JSON data. The response could be parsed as follows:</li>
</ol>
<pre>
       response = requests.get(URL) <br/>       json_data = response.json()
</pre>
<ol start="3">
<li>The <kbd>json()</kbd> function parses the response from the OpenWeatherMap API and returns a dictionary of different weather parameters (<kbd>json_data</kbd>) and their values.</li>
<li>Since we know the response format from the API documentation, the current temperature could be retrieved from the parsed response as follows:</li>
</ol>
<pre>
       print(json_data['main']['temp'])
</pre>
<ol start="5">
<li>Putting it all together, we have this:</li>
</ol>
<pre>
       #!/usr/bin/python3<br/><br/>       import requests<br/><br/>       # generate your own API key<br/>       APP_ID = '5d6f02fd4472611a20f4ce602010ee0c'<br/>       ZIP = 94103<br/>       URL = """http://api.openweathermap.org/data/2.5/weather?zip={}<br/>       &amp;appid={}&amp;units=imperial""".format(ZIP, APP_ID)<br/><br/>       if __name__ == "__main__":<br/>         # API Documentation: http://openweathermap.org/<br/>         current#current_JSON<br/>         try:<br/>           # encode data payload and post it<br/>           response = requests.get(URL)<br/>           json_data = response.json()<br/>           print("Temperature is %s degrees Fahrenheit" %<br/>           json_data['main']['temp'])<br/>         except requests.exceptions.ConnectionError as error:<br/>           print("The error is %s" % error)
</pre>
<p>The preceding example is available for download along with this chapter as <kbd>weather_example.py</kbd>. The example should display the current temperature as follows:</p>
<pre>
    <strong>Temperature is 68.79 degrees Fahrenheit</strong>
</pre>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">The application of requests - publishing events to the Internet</h1>
            

            
                
<p>In the previous example, we retrieved information from the Internet. Let's consider an example where we have to publish a sensor event somewhere on the Internet. This could be either a cat door opening while you are away from home or someone at your doorstep stepping on the doormat. Because we discussed interfacing sensors to the Raspberry Pi Zero in the previous chapter, let's discuss a scenario where we could post these events to <em>Slack</em>—a workplace communication tool, Twitter, or cloud services such as <strong>Phant</strong> (<a href="https://data.sparkfun.com/">https://data.sparkfun.com/</a>).</p>
<p>In this example, we will post these events to Slack using <kbd>requests</kbd>. Let's send a direct message to ourselves on Slack whenever a sensor event such as a cat door opening occurs. We need a URL to post these sensor events to Slack. Let's review generating a URL in order to post sensor events to Slack:</p>
<ol>
<li>The first step in generating a URL is creating an <em>incoming webhook</em>. A webhook is a type request that can post messages that are carried as a payload to applications such as Slack.</li>
</ol>
<ol start="2">
<li>If you are a member of a Slack team named <em>TeamX</em>, launch your team's application directory, namely <kbd>teamx.slack.com/apps</kbd> in a browser:</li>
</ol>
<div><img class=" image-border" height="188" src="img/image_07_002.png" width="495"/></div>
<p>Launch your team's app directory</p>
<ol start="3">
<li>Search for <kbd>incoming webhooks</kbd> in your app directory and select the first option, Incoming WebHooks (as shown in the following screenshot):</li>
</ol>
<div><img class=" image-border" height="309" src="img/image_07_003.png" width="449"/></div>
<p>Select incoming webhooks</p>
<div><ol start="4">
<li>Click on Add Configuration:</li>
</ol>
<div><img class=" image-border" height="197" src="img/image_07_004.png" width="496"/></div>
<p>Add Configuration</p>
<ol start="5">
<li>Let's send a private message to ourselves when an event occurs. Select Privately to           (you) as the option and create a webhook by clicking on Add Incoming WebHooks integration:</li>
</ol>
<div><img class=" image-border" height="173" src="img/image_07_005.png" width="501"/></div>
<p>Select Privately to you</p>
<ol start="6">
<li>We have generated a URL to send direct messages about sensor events (URL partially concealed):</li>
</ol>
<div><img class=" image-border" height="214" src="img/image_07_006.png" width="526"/></div>
<p>Generated URL</p>
<ol start="7">
<li>Now, we can send direct message to ourselves on Slack using the previously-mentioned URL. The sensor event can be published to Slack as a JSON payload. Let's review posting a sensor event to Slack.</li>
<li>For example, let's consider posting a message when a cat door opens. The first step is preparing the JSON payload for the message. According to the Slack API documentation (<a href="https://api.slack.com/custom-integrations)">https://api.slack.com/custom-integrations)</a>, the message payload needs to be in the following format:</li>
</ol>
<pre>
       payload = {"text": "The cat door was just opened!"}
</pre>
<ol start="9">
<li>In order to publish this event, we will make use of the <kbd>post()</kbd> method from the <kbd>requests</kbd> module. The data payload needs to be encoded in JSON format while posting it:</li>
</ol>
<pre>
       response = requests.post(URL, json.dumps(payload))
</pre>
<ol start="10">
<li>Putting it all together, we have this:</li>
</ol>
<pre>
       #!/usr/bin/python3<br/><br/>       import requests<br/>       import json<br/><br/>       # generate your own URL<br/>       URL = 'https://hooks.slack.com/services/'<br/><br/>       if __name__ == "__main__":<br/>         payload = {"text": "The cat door was just opened!"}<br/>         try:<br/>           # encode data payload and post it<br/>           response = requests.post(URL, json.dumps(payload))<br/>           print(response.text)<br/>         except requests.exceptions.ConnectionError as error:<br/>           print("The error is %s" % error)
</pre>
<ol start="11">
<li>On posting the message, the request returns <kbd>ok</kbd> as a response. This indicates that the post was successful.</li>
<li>Generate your own URL and execute the preceding example (available for download along with this chapter as <kbd>slack_post.py</kbd>). You will receive a direct message on Slack:</li>
</ol>
<div><img class=" image-border" height="47" src="img/image_07_007.png" width="230"/></div>
<p>Direct message on Slack</p>
<p>Now, try interfacing a sensor to the Raspberry Pi Zero (discussed in previous chapters) and post the sensor events to Slack.</p>
<p>It is also possible to post sensor events to Twitter and have your Raspberry Pi Zero check for new e-mails and so on. Check this book's website for more examples.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Flask web framework</h1>
            

            
                
<p>In our final section, we will discuss web frameworks in Python. We will discuss the Flask framework (<a href="http://flask.pocoo.org/">http://flask.pocoo.org/</a>). Python-based frameworks enable interfacing sensors to a network using the Raspberry Pi Zero. This enables controlling appliances and reading data from sensors from anywhere within a network. Let's get started!</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Installing Flask</h1>
            

            
                
<p>The first step is installing the Flask framework. It can be done as follows:</p>
<pre>
    <strong>sudo pip3 install flask</strong>
</pre>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Building our first example</h1>
            

            
                
<p>The Flask framework documentation explains building the first example. Modify the example from the documentation as follows:</p>
<pre>
#!/usr/bin/python3<br/><br/>from flask import Flask<br/>app = Flask(__name__)<br/><br/>@app.route("/")<br/>def hello():<br/>    return "Hello World!"<br/><br/>if __name__ == "__main__":<br/>    app.run('0.0.0.0')
</pre>
<p>Launch this example (available for download along with this chapter as <kbd>flask_example.py</kbd>) and it should launch a server on the Raspberry Pi Zero visible to the network. On another computer, launch a browser and enter the IP address of the Raspberry Pi Zero along with port number, <kbd>5000</kbd>, as a suffix (as shown in the following snapshot). It should take you to the index page of the server that displays the message Hello World!:</p>
<div><img class=" image-border" height="243" src="img/image_07_008.png" width="409"/></div>
<p>The Flask framework-based web server on the Raspberry Pi Zero</p>
<p>You can find the IP address of your Raspberry Pi Zero using the <kbd>ifconfig</kbd> command on the command-line terminal.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Controlling appliances using the Flask framework</h1>
            

            
                
<p>Let's try turning on/off appliances at home using the Flask framework. In previous chapters, we made use of <em>PowerSwitch Tail II</em> to control a table lamp using the Raspberry Pi Zero. Let's try to control the same using the Flask framework. Connect PowerSwitch Tail, as shown in the following figure:</p>
<div><img class=" image-border" height="158" src="img/image_07_009.png" width="445"/></div>
<p>Controlling a table lamp using the Flask framework</p>
<p>According to the Flask framework documentation, it is possible to route a URL to a specific function. For example, it is possible to bind <kbd>/lamp/&lt;control&gt;</kbd> using <kbd>route()</kbd> to the <kbd>control()</kbd> function:</p>
<pre>
@app.route("/lamp/&lt;control&gt;") <br/>def control(control): <br/>  if control == "on": <br/>    lights.on() <br/>  elif control == "off": <br/>    lights.off() <br/>  return "Table lamp is now %s" % control
</pre>
<p>In the preceding code snippet, <kbd>&lt;control&gt;</kbd> is a variable that can be passed on as an argument to the binding function. This enables us to turn the lamp on/off. For example, <kbd>&lt;IP address&gt;:5000/lamp/on</kbd> turns on the lamp, and vice versa. Putting it all together, we have this:</p>
<pre>
#!/usr/bin/python3 <br/><br/>from flask import Flask <br/>from gpiozero import OutputDevice <br/><br/>app = Flask(__name__) <br/>lights = OutputDevice(2) <br/><br/>@app.route("/lamp/&lt;control&gt;") <br/>def control(control): <br/>  if control == "on": <br/>    lights.on() <br/>  elif control == "off": <br/>    lights.off() <br/>  return "Table lamp is now %s" % control <br/><br/>if __name__ == "__main__": <br/>    app.run('0.0.0.0')
</pre>
<p>The preceding example is available for download along with this chapter as <kbd>appliance_control.py</kbd>. Launch the Flask-based web server and open a web server on another computer. In order to turn on the lamp, enter <kbd>&lt;IP Address of the Raspberry Pi Zero&gt;:5000/lamp/on</kbd> as URL:</p>
<p>This should turn on the lamp:</p>
<div><img class=" image-border" height="97" src="img/image_07_010.png" width="547"/></div>
<p>Thus, we have built a simple framework that enables controlling appliances within the network. It is possible to include buttons to an HTML page and route them to a specific URL to perform a specific function. There are several other frameworks in Python that enable developing web applications. We have merely introduced you to different applications that are possible with Python. We recommend that you check out this book's website for more examples, such as controlling Halloween decorations and other holiday decorations using the Flask framework.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Summary</h1>
            

            
                
<p>In this chapter, we discussed the <kbd>try</kbd>/<kbd>except</kbd> keywords in Python. We also discussed developing applications that retrieves information from the Internet, as well as publishing sensor events to the Internet. We also discussed the Flask web framework for Python and demonstrated the control of appliances within a network. In the next chapter, we will discuss some advanced topics in Python.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    </body></html>