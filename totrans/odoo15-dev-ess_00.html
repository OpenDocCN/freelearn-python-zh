<html><head></head><body><div><div><h1 id="_idParaDest-73"><a id="_idTextAnchor072"/><a href="B16119_03_Final_PD_ePub.xhtml#_idTextAnchor072"><em class="italic">Chapter 3</em></a>: Your First Odoo Application</h1>
			<p>Developing in Odoo usually means creating our own modules. In this chapter, we will create our first Odoo application, learn the steps needed to make it available to Odoo, and install it.</p>
			<p>We will get started by learning the basics of the development workflow—we'll create and install a new module and update it to apply the changes we make throughout the development iterations.</p>
			<p>Odoo follows a <strong class="bold">Model-View-Controller</strong> (<strong class="bold">MVC</strong>)-like architecture, and we will go through the different layers to implement a library application.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Overview of the library project</li>
				<li>Step 1 – Creating a new <code>addon</code> module</li>
				<li>Step 2 – Creating a new application</li>
				<li>Step 3 – Adding automated tests</li>
				<li>Step 4 – Implementing the model layer</li>
				<li>Step 5 – Setting up access security</li>
				<li>Step 6 – Implementing the backend view layer</li>
				<li>Step 7 – Implementing the business logic layer</li>
				<li>Step 8 – Implementing the website <strong class="bold">user interface</strong> (<strong class="bold">UI</strong>)</li>
			</ul>
			<p>With this approach, you will be able to gradually learn about the basic building blocks that make up an application and experience the iterative process of building an Odoo module from scratch.</p>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor073"/>Technical requirements</h1>
			<p>This chapter requires you to have an Odoo server installed and be able to start it from the command line to perform actions such as installing modules or running tests. If you don't have a working Odoo development environment, make sure you review <a href="B16119_02_Final_PD_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 2</em></a>, <em class="italic">Preparing the Development Environment</em>.</p>
			<p>In this chapter, we will create our first Odoo application from a blank slate, so we won't need any additional code to get started.</p>
			<p>The code for this chapter can be found in the book's GitHub repository at <a href="https://github.com/PacktPublishing/Odoo-15-Development-Essentials">https://github.com/PacktPublishing/Odoo-15-Development-Essentials</a>, in the <code>ch03</code> directory.</p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor074"/>Overview of the library project</h1>
			<p>We will use a learning<a id="_idIndexMarker177"/> project to better explore the topics explained in this chapter, and see them work in practice. We will create a new Odoo app to manage a book library. We will use this project in all the following chapters, where each chapter will be an iteration, adding features to the app. Here, we will create a first iteration of the library app.</p>
			<p>The first feature we will implement will be the<a id="_idIndexMarker178"/> book catalog. The catalog allows us to keep records of the books in our library, with their relevant details. We also want to make this catalog available through a public website, where the available books can be seen.</p>
			<p>Library books should have the following data:</p>
			<ul>
				<li>Title</li>
				<li>Authors</li>
				<li>Publishing company</li>
				<li>Date published</li>
				<li>Cover image</li>
				<li><strong class="bold">International Standard Book Number</strong> (<strong class="bold">ISBN</strong>), with check digit validation</li>
				<li>Active flag, indicating the books that should be publicly available on the website</li>
			</ul>
			<p>As is usual for the Odoo base apps, the Library app will have two user groups, the Library User and the Library Manager. The User level is expected to be able to perform all daily operations, and the Manager level is expected to additionally be able to edit the app's configurations.</p>
			<p>For the book catalog feature, we will keep editing book records as a reserved feature for Managers. The following should apply:</p>
			<ul>
				<li>Library Managers should be able to edit books.</li>
				<li>Library users and Public users using the website should be able to only view books.</li>
			</ul>
			<p>This simple project will allow us to cover all the main components involved in building an Odoo app. The first step is to create a module directory that will host the code and components for our app.</p>
			<h1 id="_idParaDest-76"><a id="_idTextAnchor075"/>Step 1 – Creating a new addon module</h1>
			<p>An addon module<a id="_idIndexMarker179"/> is a directory containing files that implement some Odoo features. It can add new features or modify existing ones. The addon module directory must contain a manifest file—or descriptor file—named <code>__manifest__.py</code>.</p>
			<p>Some module addons are featured as an <strong class="bold">app</strong>. Apps<a id="_idIndexMarker180"/> are the top-level module for a feature area in Odoo, and we expect our module to be featured in the top-level <strong class="bold">Apps</strong> menu. Examples of apps in base Odoo include <strong class="bold">CRM</strong>, <strong class="bold">Project</strong>, and <strong class="bold">HR</strong>. A non-app <strong class="bold">module addon</strong> is<a id="_idIndexMarker181"/> expected to depend on an app, adding or extending features to it.</p>
			<p>If a new module adds new or major functionality to Odoo, it probably should be an app. If the module just makes changes to an existing app, it probably should be a regular addon module.</p>
			<p>To develop a<a id="_idIndexMarker182"/> new module, we will do the following:</p>
			<ol>
				<li>Ensure that the directory where we will work is in the Odoo server addons path.</li>
				<li>Create the module's directory, containing the manifest file.</li>
				<li>Choose a license for the module, if we intend to distribute it.</li>
				<li>Add a module description.</li>
				<li>Optionally, add an icon to represent the module.</li>
			</ol>
			<p>After this, we can install the module to confirm that it is available to the Odoo server and that it installs correctly.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor076"/>Preparing the addons path</h2>
			<p>An <strong class="bold">addon module</strong> is a <a id="_idIndexMarker183"/>directory containing an Odoo <strong class="bold">manifest</strong> file providing<a id="_idIndexMarker184"/> features, such as a new app or additional features for an existing app. An <strong class="bold">addons directory</strong> contains <a id="_idIndexMarker185"/>several addon modules. The <strong class="bold">addons path</strong> is an Odoo<a id="_idIndexMarker186"/> configuration, with a list of directories where the Odoo server will look for available addons.</p>
			<p>By default, the addons <a id="_idIndexMarker187"/>path includes the base apps bundled with Odoo, in the <code>odoo/addons</code> directory, and the base module providing the core features, in the <code>odoo/odoo/addons</code> directory. The addons path is usually modified to add one or more directories for the custom-developed and community modules we want to use.</p>
			<p>The Library project will be composed of several modules. Doing so is a good practice since it promotes smaller more focused modules, helping reduce complexity. We will create an addons directory for the project's modules.</p>
			<p>If the instructions in <a href="B16119_02_Final_PD_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 2</em></a>, <em class="italic">Preparing the Development Environment,</em> were followed, the Odoo server code should be at <code>~/work15/odoo/</code>. Custom addon modules should be kept in their own directory, separate from the Odoo code.</p>
			<p>For the Library, we <a id="_idIndexMarker188"/>will create a <code>~/work15/library</code> directory and include it in the addons path. We can do this by editing the configuration file directly or by using the Odoo <strong class="bold">command-line interface</strong> (<strong class="bold">CLI</strong>). Here is how to do the latter:</p>
			<pre>$ mkdir ~/work15/library
$ source ~/work15/env15/bin/activate
(env15) $ odoo \
--addons-path="~/work15/library,~/work15/odoo/addons" \
-d library -c ~/work15/library.conf --save --stop</pre>
			<p>Right now, the Odoo command will return an error such as this: <code>odoo: error: option --addons-path: no such directory: '/home/daniel/work15/library'</code>. This is because the directory is still empty, and Odoo is not able to find any addon module inside it. We won't have this problem as soon as the skeleton for the first Library app module is created.</p>
			<p>Here's an explanation of the options used in the Odoo command:</p>
			<ul>
				<li>The <code>--addons-path</code> option sets a list of all the directories to use for Odoo modules.</li>
				<li>The <code>--d</code> or <code>--database</code> option sets the database name to use. If the database doesn't exist, it will be created and initialized with Odoo's basic database schema.</li>
				<li>The <code>--c</code> or <code>--config</code> option sets the configuration file to use.</li>
				<li>The <code>--save</code> option used along with <code>-c</code> saves the options used in the configuration file.</li>
				<li>The <code>--stop</code> option, short for <code>--stop-after-init</code>, stops the Odoo server and returns to the command line once all actions are done and the start sequence is done.</li>
			</ul>
			<p>If relative paths are used for the addons path option, Odoo will convert them to absolute paths before storing them in the configuration file.</p>
			<p class="callout-heading">Changes in Odoo 15</p>
			<p class="callout">The configuration file created will use the default configuration as a template. In Linux systems, the default configuration file is the one at <code>~/.odoorc</code>.</p>
			<p>The Odoo <code>scaffold</code> command<a id="_idIndexMarker189"/> provides a quick way to create a new module skeleton. We can use it to populate the <code>library</code> addons directory with a valid module. To scaffold the <code>library_app</code> module directory, execute this code:</p>
			<pre>(env15) $ odoo scaffold library_app ~/work15/library</pre>
			<p>The <code>scaffold</code> command expects two arguments—the module directory name and the path where to create it. For more details on the <code>scaffold</code> command, run <code>odoo scaffold --help</code>.</p>
			<p>Now, we can retry the command to save the configuration file, including the <code>~/work15/library/</code> addons directory, and it should run successfully now.</p>
			<p>The startup sequence's first log messages summarize the settings being used. They include an <code>INFO ? odoo: Using configuration file at...</code> line identifying the configuration file being used and an <code>INFO ? odoo: addons paths: [...]</code> line listing the addons directories being considered. These are the first things to check when troubleshooting why Odoo is not discovering your custom module.</p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor077"/>Creating a module directory</h2>
			<p>Following the <a id="_idIndexMarker190"/>previous section, we should now have the <code>~/work15/library</code> directory for our Odoo modules and have included it in the Odoo addons path so that the Odoo server will be able to find modules in it.</p>
			<p>In the previous section, we also used the Odoo <code>scaffold</code> command to automatically create a skeleton structure for the new <code>library_app</code> module directory, with a basic structure already in place. Remembering the <code>scaffold</code> command, it looks like this: <code>odoo scaffold &lt;module&gt; &lt;addons-directory&gt;</code>. The module directory created looks like this:</p>
			<pre>library_app/
├── __init__.py
├── __manifest__.py
├── controllers
│   ├── __init__.py
│   └── controllers.py
├── demo
│   └── demo.xml
├── models
│   ├── __init__.py
│   └── models.py
├── security
│   └── ir.model.access.csv
└── views
    ├── templates.xml
    └── views.xml</pre>
			<p>The module directory name is its technical name. In this case, we used <code>library_app</code> for it. The technical name must be a valid Python <strong class="bold">identifier</strong> (<strong class="bold">ID</strong>)—it should begin with a letter and can only contain letters, numbers, and the underscore character. </p>
			<p>It contains <a id="_idIndexMarker191"/>several subdirectories for the different components of the module. This subdirectory structure is not required, but it is a widely used convention.</p>
			<p>A valid Odoo <code>addon</code> module directory must contain a <code>__manifest__.py</code> descriptor file. It also needs to be Python-importable, so it must also have an <code>__init__.py</code> file. These are the two first files we see in the directory tree. </p>
			<p class="callout-heading">Tip</p>
			<p class="callout">In older Odoo versions, the module manifest file was named <code>__openerp__.py</code>. This filename is still supported but is deprecated.</p>
			<p>The manifest file contains a Python dictionary, with the attributes describing the module. The scaffold's automatically <a id="_idIndexMarker192"/>generated manifest file should be similar to this:</p>
			<pre>{
    'name': "library_app",
    'summary': """
        Short (1 phrase/line) summary of the module's 
        purpose, used as subtitle on modules listing or 
        apps.openerp.com""",
    'description': """
        Long description of module's purpose
    """,
    'author': "My Company",
    'website': "http://www.yourcompany.com",
    # Categories can be used to filter modules in modules 
    # listing
    # Check https://github.com/odoo/odoo/blob/15.0/
    #   odoo/addons/base/data/ir_module_category_data.xml
    # for the full list
    'category': 'Uncategorized',
    'version': '0.1',
    # any module necessary for this one to work correctly
    'depends': ['base'],
    # always loaded
    'data': [
        # 'security/ir.model.access.csv',
        'views/views.xml',
        'views/templates.xml',
    ],
    # only loaded in demonstration mode
    'demo': [
        'demo/demo.xml',
    ],
}</pre>
			<p>The next section will discuss the manifest file in more detail.</p>
			<p>The <code>__init__.py</code> module <a id="_idIndexMarker193"/>file should trigger the import of all the module's Python files. More specifically, it should import the Python files at the module top level and import the subdirectories also containing Python files. Similarly, each of these subdirectories should also contain an <code>__init__.py</code> file, importing the Python assets in that subdirectory.</p>
			<p>This is the top <code>__init__.py</code> file generated by the <code>scaffold</code> command:</p>
			<pre>from . import controllers
from . import models</pre>
			<p>There are no Python files at the top level, and two subdirectories with Python files, <code>controllers</code>, and <code>models</code>. Reviewing the module tree, we can see that these two directories contain Python files and an <code>__init__.py</code> file each.</p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor078"/>Creating a manifest file</h2>
			<p>The <code>scaffold</code> command prepared a <a id="_idIndexMarker194"/>manifest file that can be used as a guideline, or we can create a manifest file from an empty file.</p>
			<p>The manifest file should be a valid Python file containing a dictionary. None of the possible dictionary keys is required, so an empty dictionary, <code>{}</code>, would be a valid content for the file. In practice, we want to at least provide some basic description of the module, assert authorship, and choose a distribution license.</p>
			<p>The following should be a good starting point:</p>
			<pre>{
    "name": "Library Management",
    "summary": "Manage library catalog and book lending.",
    "author": "Daniel Reis",
    "license": "AGPL-3",
    "website": "https://github.com/PacktPublishing"
               "/Odoo-15-Development-Essentials",
    "version": "15.0.1.0.0",
    "depends": ["base"],
    "application": True,
}</pre>
			<p>The keys used <a id="_idIndexMarker195"/>here provide all the data presented in the main tab of the app form, as illustrated in the following screenshot:</p>
			<div><div><img src="img/Figure_3.1_B16119_B16119.jpg" alt="Figure 3.1 – Library Management module app form&#13;&#10;" width="1035" height="636"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.1 – Library Management module app form</p>
			<p>We used the following keys:</p>
			<ul>
				<li><code>name</code>: For the module title.</li>
				<li><code>summary</code>: For a one-line summary of the purpose of the module.</li>
				<li><code>author</code>: For the name of the copyright author. It is a string but can contain a comma-separated list of names.</li>
				<li><code>license</code>: This identifies the license under which the author allows the module to be distributed. <code>AGPL-3</code> and <code>LGPL-3</code> are popular open source choices. Proprietary modules sold through the Odoo Apps Store usually use the <code>OPL-1</code> Odoo proprietary license. Licenses are discussed in more detail later in this chapter.</li>
				<li><code>website</code>: A <strong class="bold">Uniform Resource Locator</strong> (<strong class="bold">URL</strong>) to get more information about the module. This can help people find <a id="_idIndexMarker196"/>more documentation or the issue tracker to file bugs and suggestions.</li>
				<li><code>version</code>: The version of the module. It should follow semantic versioning rules (see <a href="http://semver.org/">http://semver.org/</a> for details). It is a good practice to use the Odoo version before our module version since it helps identify the Odoo version the module targets. For example, a <code>1.0.0</code> module built for Odoo 15.0 should carry version <code>15.0.1.0.0</code>.</li>
				<li><code>depends</code>: A list of the addon modules it depends on. The installation of this module will trigger the installation of these dependencies. If the module has no particular dependencies, it is a common practice to have it depend on the <code>base</code> module, but this is not required.</li>
				<li><code>application</code>: A flag, declaring whether the module should be featured as an app in the apps list. Most extension modules, adding features to existing apps, will have this set to <code>False</code>. The Library management module is a new app, so we used <code>True</code>.</li>
			</ul>
			<p>The dependencies<a id="_idIndexMarker197"/> list is something to be careful about. We should ensure all dependencies are explicitly set here; otherwise, the module may fail to install in a clean database install due to missing dependencies or have loading errors if, by chance, the other required modules are loaded later than ours, in the Odoo startup sequence. Both these cases can happen when deploying your work on other machines and can be time-consuming to identify and solve.</p>
			<p>The <code>&lt;div class="document"&gt;</code> line seen in <em class="italic">Figure 3.1</em> is for the long module description, now empty. Adding a description is discussed in a later section, <em class="italic">Adding a description</em>.</p>
			<p>These other descriptor keys are also available, and used less often:</p>
			<ul>
				<li><code>installable</code>: Indicates if this module is available for installation. The default value is <code>True</code>, so we don't need to explicitly set it. It can be set to <code>False</code> if for some reason we need to disable it but still keep its files in the addon directory.</li>
				<li><code>auto_install</code>: This can be set to <code>True</code>, and is used for <strong class="bold">glue</strong> modules. A glue module installation is triggered once all the dependencies are installed. For example, this can be used to<a id="_idIndexMarker198"/> automatically provide features that bridge two apps, once they are both installed in the same instance.</li>
			</ul>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor079"/>Setting the module category</h2>
			<p>Modules are grouped into<a id="_idIndexMarker199"/> categories, representing the function areas they relate to. These categories are used to group addon modules, and also the security groups. </p>
			<p>If no category is set on the addon, the <strong class="bold">Uncategorized</strong> value will be assigned. This is right now the category for the Library app.</p>
			<p>We can see several categories on Odoo in the <strong class="bold">Apps</strong> menu, on the left side panel. There, we can see the categories that can be used for our modules, as illustrated in the following screenshot:</p>
			<div><div><img src="img/Figure_3.2_B16119_B16119.jpg" alt="Figure 3.2 – Apps list with the CATEGORIES pane&#13;&#10;" width="1064" height="653"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.2 – Apps list with the CATEGORIES pane</p>
			<p>The categories can have a hierarchy—for example, the <strong class="bold">Project</strong> apps belong to the <strong class="bold">Services/Project</strong> category.</p>
			<p>If a non-existent category is used on an addon module, Odoo will automatically create it and make it available. We will take advantage of this to create a new category for the Library app: <strong class="bold">Services/Library</strong>.</p>
			<p>Edit the <code>__manifest__.py</code> file thus to add a <code>category</code> key:</p>
			<pre>    "category": "Services/Library", </pre>
			<p>Categories are also relevant for organizing <a id="_idIndexMarker200"/>security groups, and to reference them<a id="_idIndexMarker201"/> in <strong class="bold">Extensible Markup Language</strong> (<strong class="bold">XML</strong>) data files, we will need to use the corresponding XML ID. </p>
			<p>The XML ID assigned to a module category is automatically generated from the <code>base.module_category_</code> prefix plus the category name. For example, for <code>base.module_category_services_library</code>.</p>
			<p>We can confirm the XML ID for app categories by navigating to the corresponding form view and then using the <strong class="bold">View Metadata</strong> option in the developer menu.</p>
			<p>There is no menu item for app categories, but the category form can be accessed from the security <strong class="bold">Groups</strong> form, as follows:</p>
			<ol>
				<li value="1">Open the <strong class="bold">Settings</strong> | <strong class="bold">User</strong> | <strong class="bold">Groups</strong> menu option and create a new test record.</li>
				<li>Select an option from the <strong class="bold">Application</strong> field drop-down list, and save. The process is illustrated in the following screenshot:<div><img src="img/Figure_3.3_B16119_B16119.jpg" alt="Figure 3.3 – Application selection list, in the User Group form&#13;&#10;" width="1080" height="535"/></div><p class="figure-caption">Figure 3.3 – Application selection list, in the User Group form</p></li>
				<li>Click on the <strong class="bold">Application</strong> link to open the selected category's corresponding details form.</li>
				<li>On the category form, select the <strong class="bold">View Metadata</strong> option in the developer menu to see the XML ID assigned to it.</li>
				<li>You may want to<a id="_idIndexMarker202"/> delete the test group if it is no longer of use to you.</li>
			</ol>
			<p>Alternatively, the list of built-in categories and their XML IDs can be found in the Odoo source code. The GitHub URL is provided here: <a href="https://github.com/odoo/odoo/blob/15.0/odoo/addons/base/data/ir_module_category_data.xml">https://github.com/odoo/odoo/blob/15.0/odoo/addons/base/data/ir_module_category_data.xml</a>.</p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor080"/>Choosing a license</h2>
			<p>Choosing a license<a id="_idIndexMarker203"/> for your work is important, and you should carefully consider which is the best choice for you, and its implications.</p>
			<p>Software code is covered by copyright law, reserving to the authors the rights to use or modify the work. This will usually mean you individually or the company you are working for. For other parties to safely be allowed to use the work, they must have a license agreement with the code authors.</p>
			<p>If you want to make your code freely available, it needs to carry a license, stating what other people are allowed to do with your code. Different licenses will state different terms.</p>
			<p>The most-used licenses for Odoo modules are<a id="_idIndexMarker204"/> version 3 of the <strong class="bold">GNU's Not Unix</strong> (<strong class="bold">GNU</strong>) <strong class="bold">Lesser General Public License</strong> (<strong class="bold">LGPL-3</strong>) and the <strong class="bold">Affero General Public License</strong> (<strong class="bold">AGPL-3</strong>). Both allow you<a id="_idIndexMarker205"/> to freely distribute and modify the work, as long as the authors are credited and the derived works are distributed under the same license conditions.</p>
			<p>The AGPL is a strong open source license and requires online services using the code to share the source code with their users. This license is popular among the community because it forces derivative works to also be distributed under the AGPL terms. So, the open sourced code can't be incorporated in a closed commercial solution, and the original authors can benefit from the improvements made by other people.</p>
			<p>The LGPL is more permissive than AGPL and also allows commercial modifications, without the need to share the corresponding source code. This license is usually chosen for web and system integration components, where solutions might contain components under private licenses, or under terms incompatible with AGPL.</p>
			<p>You can learn more about the GNU licenses<a id="_idIndexMarker206"/> at <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.</p>
			<p>While you can sell GPL licensed apps, this is not a popular business model since the license allows people to freely copy and distribute the code. For this reason, many modules sold in the Odoo App Store prefer to use a proprietary license. Odoo proposes the Odoo proprietary license, <code>OPL-1</code>, for this.</p>
			<p>More details on Odoo licenses<a id="_idIndexMarker207"/> can be found at <a href="https://www.odoo.com/documentation/user/legal/licenses/licenses.html">https://www.odoo.com/documentation/user/legal/licenses/licenses.html</a>.</p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor081"/>Adding a description</h2>
			<p>A description <a id="_idIndexMarker208"/>is a long text presenting the module features. The description text supports the <strong class="bold">reStructuredText</strong> (<strong class="bold">RST</strong>) format<a id="_idIndexMarker209"/> to produce a rich text document.</p>
			<p>You can learn more about <a id="_idIndexMarker210"/>RST here: <a href="https://docutils.sourceforge.io/rst.html">https://docutils.sourceforge.io/rst.html</a>. The page includes a quick reference link that is worth bookmarking: <a href="https://docutils.sourceforge.io/docs/user/rst/quickstart.html">https://docutils.sourceforge.io/docs/user/rst/quickstart.html</a>.</p>
			<p>Here is a short sample of an RST document:</p>
			<pre>Title
=====
Subtitle
--------
This is *emphasis*, rendered in italics.
This is **strong emphasis**, rendered in bold.
This is a bullet list:
- Item one.
- Item two.</pre>
			<p>One way to add a description is to use the <code>description</code> key in the module manifest. Since chances are the description text will span multiple lines, it is best added inside triple quotes, <code>"""</code>, the Python syntax for multiline strings.</p>
			<p>Source code<a id="_idIndexMarker211"/> published on websites such as GitHub is expected to include a README file, for visitors to easily find an introduction to the module. So, instead of the <code>description</code> manifest key, Odoo modules can have a <code>README.rst</code> or <code>README.md</code> file for the same purpose. This file should be placed at the root of the module directory, alongside the <code>__manifest__.py</code> file.</p>
			<p>Another alternative is to provide<a id="_idIndexMarker212"/> a <code>index.html</code> HTML file should be located in the <code>static/description/</code> module subdirectory. Page assets, such as images <a id="_idIndexMarker213"/>and <strong class="bold">Cascading Style Sheets</strong> (<strong class="bold">CSS</strong>), should also be located in that same directory.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For modules with the <code>application</code> key set to <code>True</code>, only the <code>index.html</code> description will be used, and the description key is ignored.</p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor082"/>Adding an icon</h2>
			<p>Modules can optionally have an<a id="_idIndexMarker214"/> icon representing them. In the case of modules creating a new app, this is particularly important, since the app is expected to have an icon in the <strong class="bold">Apps</strong> menu.</p>
			<p>To add an icon, we need to add a <code>static/description/icon.png</code> file to the module, with the icon to be used.</p>
			<p>For the Library app project, we will reuse an icon from the <code>library_app/static/description</code> directory.</p>
			<p>From the command line, we would run the following:</p>
			<pre>$ cd ~/work15/library/library_app
$ mkdir -p ./static/description
$ cp ~/work15/odoo/addons/note/static/description/\
icon.png ./static/description/</pre>
			<h2 id="_idParaDest-84"><a id="_idTextAnchor083"/>Installing a new module</h2>
			<p>We now have a minimal <code>addon</code> module. It doesn't implement any features yet, but we can install it to confirm that it is working properly so far.</p>
			<p>To install a new module, we<a id="_idIndexMarker215"/> should start the server using both the <code>-d</code> and <code>-i</code> options. The <code>-d</code> or <code>--database</code> option ensures that we are working with the correct Odoo database. The <code>-i</code> or <code>--init</code> option accepts a comma-separated list of modules to install.</p>
			<p class="callout-heading">Changes in Odoo 11</p>
			<p class="callout">When installing a new module, Odoo will automatically update the list of available modules from the currently configured addons paths. This was not so up to Odoo 10, where the module list needed to be manually updated before a new addon module could be installed. The modules list is updated in the web client, from the menu option in the <strong class="bold">Apps</strong> list.</p>
			<p>For the Odoo environment prepared earlier in this chapter and having activated the Python virtual environment, the following command installs the <code>library_app</code> module:</p>
			<pre>(env15)$ odoo -c ~/work15/library.conf -d library -i \
library_app</pre>
			<p>We added the <code>-d</code> library option to make sure that the correct database is selected for the installation. It could be the case that this option was already defined in the configuration file and is thus redundant. Even if that is the case, it is best to play safe and explicitly declare the database to install on in the command.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Pay close attention to the server log messages to confirm that the module was correctly found and installed. You should see an <code>odoo.addons.base.models.ir_module: ALLOW access to module.button_install</code> message and no warnings.</p>
			<p>For the module installation to be possible, the <code>addons</code> directory where the module is in should be known to the Odoo server. This can be confirmed by stopping and starting the Odoo server and looking at the <code>odoo: addons paths:</code> log message printed during the Odoo startup sequence.</p>
			<p>If the module is not found, that is often because the addons path is incorrect. Double-check that by taking a close look at the addons path being used.</p>
			<h2 id="_idParaDest-85"><a id="_idTextAnchor084"/>Upgrading modules</h2>
			<p>Developing a <a id="_idIndexMarker216"/>module is an iterative process, with changes made on source files that are then to be applied to Odoo.</p>
			<p>This can be done from the <strong class="bold">graphical UI</strong> (<strong class="bold">GUI</strong>) by looking up the module in the <strong class="bold">Apps</strong> list and clicking on the <strong class="bold">Upgrade</strong> button. This reloads the data files, applying the changes made, and updates the database schema definitions. However, when the changes are only in Python logic, the upgrade may not be sufficient. An Odoo server restart may be needed to reload the changed Python code. When the module changes are both data files and Python logic, both operations might be needed.</p>
			<p>In summary, the following applies:</p>
			<ul>
				<li>When modifying models or their fields, an upgrade is needed to apply the database schema changes.</li>
				<li>When changing logic Python code, a restart is needed to reload the code files.</li>
				<li>When changing XML or <strong class="bold">comma-separated values</strong> (<strong class="bold">CSV</strong>) files, an upgrade is needed to reapply the data in the files.</li>
			</ul>
			<p>To avoid any confusion or frustration related to having code changes applied to Odoo, the simplest solution is to restart the Odoo service with the module <code>upgrade</code> command after the code changes are made.</p>
			<p>In the terminal where the server instance is running, use <em class="italic">Ctrl</em> + <em class="italic">C</em> to stop it. Then, start the server and upgrade the <code>library_app</code> module using the following command:</p>
			<pre>(env15)$ odoo -c ~/work15/library.conf -d library \
-u library_app</pre>
			<p>The <code>-u</code> option, <code>--update</code> in the long format, requires the <code>-d</code> option and accepts a comma-separated list of modules to update. For example, we could use <code>-u library_app,mail</code>. When a module is updated, all other installed modules depending on it are also updated.</p>
			<p>Pressing the up arrow key brings to you the previous command that was used. So, most of the time, when repeating this action, you will find yourself using the <em class="italic">Ctrl</em> + <em class="italic">C</em>, up arrow, and <em class="italic">Enter</em> key combination.</p>
			<p>In recent Odoo <a id="_idIndexMarker217"/>versions, the <code>--dev=all</code> developer-friendly mode is available, automating this workflow.  When this option is used, changes to data files will instantly be available to the running Odoo service, and Python code changes will trigger an Odoo code reload. For more details on this option, please refer to the <em class="italic">Using the server development options</em> section of <a href="B16119_02_Final_PD_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 2</em></a>, <em class="italic">Preparing the Development Environment</em>.</p>
			<p>We now have a module directory ready to host the components that implement the app. Since this is an app, and not a technical module adding a feature, we will start by adding a few basic components expected for apps.</p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor085"/>Step 2 – Creating a new application</h1>
			<p>Some Odoo modules<a id="_idIndexMarker218"/> create new applications, and others add features or modify existing applications. While the technical components involved are about the same, an app is expected to include a few characteristic elements. Since the Library module is a new app, we should include them in our module.</p>
			<p>An app is expected to have the following:</p>
			<ul>
				<li>An icon, to be presented in the app list</li>
				<li>A top-level menu item, under which all the app's menu items will be placed</li>
				<li>Security groups for the app so that it can be enabled only for users that need it, and where access security will be set</li>
			</ul>
			<p>The app<a id="_idIndexMarker219"/> icon is an <code>icon.png</code> file in the module's <code>static/description/</code> subdirectory. This was done earlier, in the <em class="italic">Adding an icon</em> section.</p>
			<p>Next, we will take care of the app's top-level menu.</p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor086"/>Adding a top menu item</h2>
			<p>Since we <a id="_idIndexMarker220"/>are creating a new app, it should have a<a id="_idIndexMarker221"/> main menu item. On the <strong class="bold">Community Edition</strong> <strong class="bold">(CE)</strong>, this is shown as a new entry in the top-left drop-down menu. On the <strong class="bold">Enterprise Edition</strong> <strong class="bold">(EE)</strong>, it is<a id="_idIndexMarker222"/> shown as an additional icon in the <strong class="bold">App Switcher</strong> main menu.</p>
			<p>Menu items are view components added using XML data files. To define a menu item, create a <code>views/library_menu.xml</code> file with the following content:</p>
			<pre>&lt;odoo&gt; 
  &lt;!-- Library App Menu --&gt;
  &lt;menuitem id="menu_library" name="Library" /&gt; 
&lt;/odoo&gt; </pre>
			<p>The UI, including menu options and actions, has database stored records read and interpreted by the web client in real time.</p>
			<p>The aforementioned file describes records to load into the Odoo database. The <code>&lt;menuitem&gt;</code> element is an instruction to write a record on the <code>ir.ui.menu</code> model, where Odoo menu items are stored.</p>
			<p>The <code>id</code> attribute<a id="_idIndexMarker223"/> is also known <a id="_idIndexMarker224"/>as an <code>menu_library</code> XML ID.</p>
			<p>The menu item added here is very simple and is using only one attribute: <code>name</code>. There are other attributes available that we didn't use here. We will learn more about them later in this chapter, in the <em class="italic">Implementing the backend view layer</em> section.</p>
			<p>The Library module does not know about this new XML data file yet. To be known and loaded into the Odoo instance, it needs to be declared in the <code>data</code> attribute of the manifest file. Edit the <code>__manifest__.py</code> file dictionary to add this key, as follows:</p>
			<pre>    "data": [
        "views/library_menu.xml",
    ],</pre>
			<p>The <code>data</code> manifest key is a list of the data files to be loaded by the module upon installation or upgrade. The file paths are relative to the module's root directory, where the manifest file is.</p>
			<p>To load these menu configurations into our Odoo database, we need to upgrade the module. Doing that at this point won't have any visible effects. This menu item has no actionable submenu yet, and so won't be shown. It will be visible later, once we add submenus and the corresponding access permissions.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Items in the menu tree are only shown if there are any visible submenu items. The lower-level menu items that open views will only be visible if the user has access to the corresponding model.</p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor087"/>Adding security groups</h2>
			<p>Before <a id="_idIndexMarker225"/>features can be used by regular users, access must be granted to them. In Odoo, this is done using security <strong class="bold">groups</strong>. Access privileges are granted to security groups, and users are assigned security groups.</p>
			<p>Odoo apps typically provide two groups for two levels of access, as follows:</p>
			<ul>
				<li>A user access level, for users performing daily operations</li>
				<li>A manager access level, with full access to all features, including configurations</li>
			</ul>
			<p>The Library app will feature these two security groups. We will work on this next.</p>
			<p>Access-security-related files are usually kept in a <code>security/</code> module subdirectory, so we should create a <code>security/library_security.xml</code> file for these definitions.</p>
			<p>Security groups are organized in the same categories used for addon modules. To assign a category to a security group, we should find the corresponding XML ID. The way this XML ID can be found was discussed earlier in this chapter, in the <em class="italic">Setting the module category</em> section. There, we can learn that the XML ID for the <code>base.module_category_services_library</code>.</p>
			<p>Next, we will add the Library User security group. It belongs to the <code>module_library_category</code>, and it will inherit the internal user security permissions, building on top of them. If we open that group's form and use the developer menu <code>base.group_user</code>. </p>
			<p>Now, add to the <code>security/library_security.xml</code> file with the following XML:</p>
			<pre>&lt;odoo&gt;
  &lt;data&gt;
    &lt;!-- Library User Group --&gt;
    &lt;record id="library_group_user" model="res.groups"&gt;
      &lt;field name="name"&gt;User&lt;/field&gt;
      &lt;field name="category_id" 
             ref="base.module_category_services_library "/&gt;
      &lt;field name="implied_ids" 
             eval="[(4, ref('base.group_user'))]"/&gt;
    &lt;/record&gt;
  &lt;/data&gt;
&lt;/odoo&gt;</pre>
			<p>We have a lot going on <a id="_idIndexMarker226"/>here, so let's slowly go through each of the elements here. This XML is adding one record to the groups model, <code>res.groups</code>. This record has values for three fields, as follows:</p>
			<ul>
				<li><code>name</code> is the group title. This is a simple string value.</li>
				<li><code>category_id</code> is the related app. It is a relational field, so the <code>ref</code> attribute is used to link it to the category created before, using its XML ID.</li>
				<li><code>implied_ids</code> is a one-to-many relational field and contains a list of groups that will also apply to users belonging to this group. To-many fields use a special syntax that is detailed in <a href="B16119_05_Final_PD_ePub.xhtml#_idTextAnchor146"><em class="italic">Chapter 5</em></a>, <em class="italic">Importing, Exporting, and Module Data</em>. In this case, we are using code <code>4</code> to add a link to the existing internal user XML ID, <code>base.group_user</code>.<p class="callout-heading">Changes in Odoo 12</p><p class="callout">The <strong class="bold">User</strong> form has a <strong class="bold">User Type</strong> section, only visible when the Developer Mode is enabled. It allows us to select between the mutually exclusive options—<strong class="bold">Internal User</strong>, <strong class="bold">Portal</strong> (external users, such as customers), and <strong class="bold">Public</strong> (website anonymous visitors). This was changed to avoid misconfigurations found in previous Odoo versions, where internal users could accidentally be included in the <strong class="bold">Portal</strong> or <strong class="bold">Public</strong> groups, effectively reducing their access privileges.</p></li>
			</ul>
			<p>Next, we will create a manager group. It should give us all the privileges of the user group, plus some additional access reserved to the manager. So, we want it to inherit from the <code>library_group_user</code> library user.</p>
			<p>Editing the <code>security/library_security.xml</code> file, add the following XML inside the <code>&lt;odoo&gt;</code> element: </p>
			<pre>    &lt;!-- Library Manager Group --&gt;
    &lt;record id="library_group_manager" model="res.groups"&gt;
      &lt;field name="name"&gt;Manager&lt;/field&gt;
      &lt;field name="category_id" 
             ref="base.module_category_services_library "/&gt;
      &lt;field name="implied_ids" 
             eval="[(4, ref('library_group_user'))]"/&gt;
      &lt;field name="users" 
             eval="[(4, ref('base.user_root')),
                    (4, ref('base.user_admin'))]"/&gt;
    &lt;/record&gt;</pre>
			<p>Here, we also see the <code>name</code>, <code>category_id</code>, and <code>implied_ids</code> fields, as before. The <code>implied_ids</code> field is set with a link to the <strong class="bold">Library</strong> user group, to inherit its privileges.</p>
			<p>It is also setting values<a id="_idIndexMarker227"/> on the <code>users</code> field. This has this group assigned to the Administrator (<code>admin</code>) and the Odoobot users.</p>
			<p class="callout-heading">Changes in Odoo 12</p>
			<p class="callout">Since Odoo 12, we have a system root user, which is not shown in the user list and is used internally by the framework when privilege elevation is needed (<code>sudo</code>). The <code>admin</code> user can be used to log in to the server and should have full access to all features but does bypass access security, as the system root does. On Odoo versions up to 11, the <code>admin</code> user was also the internal root superuser.</p>
			<p>We also need to have this additional XML data file in the manifest file:</p>
			<pre>    "data": [
<strong class="bold">        "security/library_security.xml",</strong>
        "views/library_menu.xml",
    ], </pre>
			<p>Notice that the <code>library_security.xml</code> file was added before <code>library_menu.xml</code>. The order used to load data files is important since references can only use IDs that have already been defined. It is common for menu items to reference security groups, and so it is a good practice to add security definitions before menu and view definitions.</p>
			<p>The next step is to add the Python code defining the app models. But before that, we will add some test cases, following a <strong class="bold">test-driven development</strong> (<strong class="bold">TDD</strong>) approach.</p>
			<h1 id="_idParaDest-89"><a id="_idTextAnchor088"/>Step 3 – Adding automated tests</h1>
			<p>Programming best <a id="_idIndexMarker228"/>practices include having automated tests for your code. This is even more important for dynamic languages such as Python—since there is no compilation step, you can't be sure there are no syntactic errors until the interpreter runs the code. A good editor can help us detect some of these problems ahead of time but can't help us ensure the code performs as intended, as automated tests can.</p>
			<p>The TDD method states that we should write tests upfront, check that they fail, then develop code that, in the end, should pass the tests. Inspired by this approach, we will add our module tests now before we add the actual features.</p>
			<p>Odoo supports automated tests, based on Python's built-in <code>unittest</code> library. Here, we will have a quick introduction to automated tests, and a longer explanation is provided in <a href="B16119_08_Final_PD_ePub.xhtml#_idTextAnchor227"><em class="italic">Chapter 8</em></a>, <em class="italic">Business Logic – Supporting Business Processes</em>.</p>
			<p class="callout-heading">Changes in Odoo 12</p>
			<p class="callout">Until Odoo 11, tests could also be <a id="_idIndexMarker229"/>described using <strong class="bold">YAML Ain't Markup Language</strong> (<strong class="bold">YAML</strong>) data files. YAML data-file support was removed in Odoo 12, so this kind of test is not available anymore.</p>
			<p>The tests need to meet a few requirements to be found and executed by the test runner, as follows:</p>
			<ol>
				<li value="1">Tests are placed in the <code>tests/</code> subdirectory. Unlike regular module Python code, this directory does not need to be imported into the top level <code>__init__.py</code> file. The test-running engine will look for these test directories in modules, and then run them.</li>
				<li>The test code files should have a name starting with <code>test_</code> and should be imported from <code>tests/__init__.py</code>. The test code will be in classes derived from one of the several test objects available in the Odoo framework, imported from <code>odoo.tests.common</code>. The most frequently used test class is <code>TransactionCase</code>. The test objects use the <code>setUp()</code> method to initialize the data used by the test cases.</li>
				<li>Each test case is a method with a name starting with <code>test_</code>. For the <code>TrasactionCase</code> test object, each test is an independent transaction, running the setup step before, and<a id="_idIndexMarker230"/> rolling it back at the end. So, the next step won't see the changes made by the previous test.<p class="callout-heading">Tip</p><p class="callout">Tests can use demonstration data for an easier setup phase, but this is not a good practice since test cases can then only run in databases with demo data installed. If all the test data is prepared in the test setup, then the test can run in any database, including empty databases or copies of production databases.</p></li>
			</ol>
			<p>We plan for our app to have a <code>library.book</code> model. Let's add a simple test to confirm that a new book has been created correctly.</p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor089"/>Adding test cases</h2>
			<p>We will add a simple test to <a id="_idIndexMarker231"/>check book creation. For this, we need to add some setup data and add a test case. The test case will just confirm that the <code>active</code> field has the expected default value, <code>True</code>.</p>
			<p>To do this, follow these steps:</p>
			<ol>
				<li value="1">Add a <code>tests/__init__.py</code> file with the following code:<pre>from . import test_book</pre></li>
				<li>Then, add the actual test code, available in the <code>tests/test_book.py</code> file, as follows:<pre>from odoo.tests.common import TransactionCase 
class TestBook(TransactionCase): 
    def setUp(self, *args, **kwargs):
        super().setUp(*args, **kwargs)
        self.Book = self.env["library.book"]
        self.book1 = self.Book.create({
            "name": "Odoo Development Essentials",
            "isbn": "879-1-78439-279-6"})
    def test_book_create(self): 
        "New Books are active by default" 
        self.assertEqual(
            self.book1.active, True
        )</pre><p>The <code>setUp()</code> function <a id="_idIndexMarker232"/>gets a pointer to the <code>Book</code> model object and uses it to create a new book. </p></li>
			</ol>
			<p>The <code>test_book_create</code> test case adds a simple test case, checking that the created book has the expected default value for the <code>active</code> field. It would make sense for the book to be created in the test case, instead of in the setup method. The reason we chose not to do this is that we want to also use this book for other test cases, and having it created in the setup avoids duplicating that code.</p>
			<h2 id="_idParaDest-91"><a id="_idTextAnchor090"/>Running tests</h2>
			<p>Tests are run<a id="_idIndexMarker233"/> starting the server with the <code>--test-enable</code> option while installing or upgrading the module, as follows:</p>
			<pre>(env15) $ odoo -c ~/work15/library.conf -u library_app \
--test-enable</pre>
			<p>The Odoo server will look for a <code>tests/</code> subdirectory in the upgraded modules and will run them. At this point, the tests are expected to throw an error, so you should see <code>ERROR</code> messages related to the tests in the server log. This sh<a id="_idTextAnchor091"/>ould change once we add the book model to the module.</p>
			<p>Now, we should add tests for the business logic. Ideally, we want every line of code to be covered by at least one test case.</p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor092"/>Testing business logic</h2>
			<p>We plan to have logic <a id="_idIndexMarker234"/>checking for a valid ISBN. So, we will add a test case to check that the method correctly validates the ISBN for the <em class="italic">Odoo Development Essentials</em> first edition book. The check will be implemented by a <code>_check_isbn()</code> method, returning <code>True</code> or <code>False</code>.</p>
			<p>In <code>tests/test_book.py</code>, add a few more lines of code after the <code>test_create()</code> method, as follows:</p>
			<pre>    def test_check_isbn(self): 
        "Check valid ISBN" 
        self.assertTrue(self.book1._check_isbn) </pre>
			<p>It is recommended to write a different test case for each action to check. Remember that when using the <code>TransactionCase</code> test, each test will run independently from the others, and the data created or changed during one test case is rolled back when it ends.</p>
			<p>Note that if we run the tests now they should fail, since the tested features have not been implemented yet.</p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor093"/>Testing access security</h2>
			<p>Access security<a id="_idIndexMarker235"/> can also be checked to confirm that users have the correct privileges granted.</p>
			<p>By default, tests are executed with the Odoo internal user, <code>__system__</code>, which bypasses access security. So, we need to change the user running the tests, to check whether the right access security has been given to them. This is done by modifying the execution environment, <code>self.env</code>, setting the <code>user</code> attribute to the user we want to run the tests with.</p>
			<p>We can modify our tests to take this into account. Edit the <code>tests/test_book.py</code> file to add a <code>setUp</code> method, as follows:</p>
			<pre>def setUp(self, *args, **kwargs):
    super().setUp(*args, **kwargs)
<strong class="bold">    user_admin = self.env.ref("base.user_admin")</strong>
<strong class="bold">    self.env = self.env(user=user_admin)</strong>
    self.Book = self.env["library.book"]
    self.book_ode = self.Book.create({
        "name": "Odoo Development Essentials",
        "isbn": "879-1-78439-279-6"})</pre>
			<p>We added two<a id="_idIndexMarker236"/> lines to the <code>setUp</code> method. This first one finds the <code>admin</code> user record, using its XML ID. The second line modifies the environment used to run the tests, <code>self.env</code>, changing the active user to the <code>admin</code> user.</p>
			<p>No further changes are needed for the tests we already wrote. They will run in the same way, but now using the <code>admin</code> user, because of the modified environment.</p>
			<p>The Library app now has a couple of basic tests, but they are failing. Next, we should add the code implementing the features, to make the tests pass.</p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor094"/>Step 4 – Implementing the model layer</h1>
			<p>Models describe and store <a id="_idIndexMarker237"/>business object data, such as a <strong class="bold">customer relationship management</strong> (<strong class="bold">CRM</strong>) opportunity, sales order, or a partner (customer, supplier, and so on). A <strong class="bold">model</strong> describes<a id="_idIndexMarker238"/> a list of <strong class="bold">fields</strong> and can also have specific business logic <a id="_idIndexMarker239"/>attached to it.</p>
			<p>Model data structure and attached business logic are described with Python code, using an object class derived from an Odoo template class. A model maps to a database table, and the Odoo framework takes care of all the database interactions, both in keeping the database structure in sync with the object and in translating all transactions to database instructions. The framework component responsible for this is <a id="_idIndexMarker240"/>the <strong class="bold">object-relational mapping</strong> (<strong class="bold">ORM</strong>) component.</p>
			<p>Our application will be used to manage a library, and we need a model for the book catalog.</p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor095"/>Creating a data model</h2>
			<p>Following the Odoo<a id="_idIndexMarker241"/> development guidelines, the Python files for models should be placed inside a <code>models</code> subdirectory, and there should be one file for each model. So, we will create a <code>models/library_book.py</code> file in the <code>library_app</code> module.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">The Odoo official coding guidelines can be found at <a href="http://www.odoo.com/documentation/15.0/reference/guidelines.html">http://www.odoo.com/documentation/15.0/reference/guidelines.html</a>. Another relevant coding standards document is the <strong class="bold">Odoo Community Association</strong> (<strong class="bold">OCA</strong>) coding <a id="_idIndexMarker242"/>guidelines, which can be found at https://odoo-community.org/page/contributing.</p>
			<p>The first thing is to<a id="_idIndexMarker243"/> have the <code>models/</code> directory used by our module. This means that it should be imported by Python when the module is loaded by Odoo. For this, edit the module's main <code>__init__.py</code> file so that it contains this line:</p>
			<pre>from . import models</pre>
			<p>Similarly, the <code>models/</code> subdirectory should contain an <code>__init__.py</code> file importing the code file to use. Add a <code>models/__init__.py</code> file containing the following code:</p>
			<pre>from . import library_book</pre>
			<p>Next, we can create a <code>models/library_book.py</code> file with the following content:</p>
			<pre>from odoo import fields, models
class Book(models.Model):
    _name = "library.book"
    _description = "Book"
    name = fields.Char("Title", required=True)
    isbn = fields.Char("ISBN")
    active = fields.Boolean("Active?", default=True)
    date_published = fields.Date()
    image = fields.Binary("Cover")
    publisher_id = fields.Many2one("res.partner", 
      string="Publisher")
    author_ids = fields.Many2many("res.partner", 
      string="Authors")</pre>
			<p>The first line is a Python code <code>import</code> statement, to make the <code>models</code> and <code>fields</code> Odoo core objects available.</p>
			<p>The second line declares the new <code>library.book</code> model. This is a Python class derived from <code>models.Model</code>.</p>
			<p>The next lines are <a id="_idIndexMarker244"/>indented. Python code blocks are defined by indentation levels, so this means that these next lines are part of the <code>Book</code> class definition. The class name uses CamelCase, as that is the usual convention for Python. The actual Python class name used is irrelevant for the Odoo framework. The model ID relevant for Odoo is the <code>_name</code> attribute, declared in the next line.</p>
			<p>The two next lines start with an underscore and declare some Odoo class attributes. The <code>_name</code> attribute defines the <code>.</code>) to separate their keywords.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Model IDs use dot-separated words. Everything else uses underscores (<code>_</code>): addon module names, XML IDs, table names, and so on.</p>
			<p>Then, we have the <code>_description</code> model attribute. This is a display name for the model records that can be used in some user messages to refer to a record. It is not mandatory but will display a warning message in the server log if it is missing.</p>
			<p>The last seven lines declare model fields. We can see a sample of the most frequently used field types. For scalar values, we can see the <code>Char</code>, <code>Boolean</code>, <code>Date</code>, and <code>Binary</code> field types being used. For relational fields, we can see <code>Many2one</code> and <code>Many2many</code>.</p>
			<p>The <code>name</code> field is used for the data record title—in this case, the book title.</p>
			<p>The <code>active</code> field is used for active records. By default, only active records are shown, and inactive records are automatically hidden. This is useful on master data models to hide away records that are no longer in use but, for historical reasons, need to be kept in the database.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout"><code>name</code> and <code>active</code> are special field names. By default, the Odoo framework makes special use of them. The <code>name</code> field is used by default for the record display name the text shows when a record is referenced from another model. The <code>active</code> field is used to filter out inactive records from the UI.</p>
			<p><code>publisher_id</code> is a <code>res.partner</code> partner model in this case. It is used to reference the publishing company. The convention is for many-to-one field names to end with <code>_id</code>.</p>
			<p><code>author_ids</code> is a <code>res.partner</code> partner model. At the database level, this data is not actually stored in a table field but in a helper table, automatically created to store the relations between records in the two tables. The convention is for to-many field names to end with <code>_ids</code>.</p>
			<p>These are two different relations, both <a id="_idIndexMarker248"/>between the book and the partner models. The partner model is built into the Odoo framework and is where people, companies, and addresses should be stored. We are using it to store both our publishers and authors.</p>
			<p>Now, we make these changes effective in Odoo by upgrading the Library app module. Again, this is the command we can run to update the <code>library_app</code> module on the <code>library</code> database: </p>
			<pre>(env15)$ odoo -c ~/work15/library.conf -d library \
-u library_app</pre>
			<p>There are no menu items yet to access the book model. These will be added later in the chapter. Still, to inspect the newly created model and confirm it was properly created in the database, we can use the <code>library.book</code> model and click on it to see its definition, as illustrated in the following screenshot:</p>
			<div><div><img src="img/Figure_3.4_B16119_B16119.jpg" alt="Figure 3.4 – The library.book model view in the Technical menu&#13;&#10;" width="1167" height="636"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.4 – The library.book model view in the Technical menu</p>
			<p>We should be able to see the <a id="_idIndexMarker249"/>model listed, and confirm that it contains the fields we defined in the Python file. If you can't see this, try again a server restart with a module upgrade, and pay close attention to the server log, looking for the messages loading the Library app, and for any warnings reporting issues with the Odoo database.</p>
			<p>On the <code>library.book</code> field list, we can see some additional fields that we didn't declare. These are special fields that Odoo automatically adds to every model. They are listed as follows:</p>
			<ul>
				<li><code>id</code> is a unique numeric database ID for each record.</li>
				<li><code>create_date</code> and <code>create_uid</code> are the record creation timestamp and the user who created the record.</li>
				<li><code>display_name</code> provides a textual representation for the record used—for example, when it is referenced in other records. It is a computed field and, by default, just uses the text in the <code>name</code> field, if available.</li>
				<li><code>write_date</code> and <code>write_uid</code> are the record's last modification timestamp and the user who did that update.</li>
				<li><code>__last_update</code> is a <a id="_idIndexMarker250"/>computed field not stored in the database and is used for concurrency checks.</li>
			</ul>
			<p>The book model is now created in the database, but it is not yet available to users. We need a menu item for that, but that won't be enough. For the menu item to be visible, users first need to be granted access to the new model.</p>
			<h1 id="_idParaDest-96"><a id="_idTextAnchor096"/>Step 5 – Setting up access security</h1>
			<p>The <code>library.book</code> model <a id="_idIndexMarker251"/>was created as the database, but you might have noticed that when it is loaded, it prints this warning message to the server log:</p>
			<pre> The model library.book has no access rules, consider adding one. </pre>
			<p>The message is pretty clear—the new model has no access rules, and so it can't be used by anyone yet. Earlier, we created the security groups for this app, and we now need to give them access to the app's models.</p>
			<p class="callout-heading">Changes in Odoo 12</p>
			<p class="callout">The <code>admin</code> user follows access security rules, just as with any other user, except for the root-like internal superuser. We need to grant it access to new models before it can use them. This was not the case up to Odoo 11. In these earlier Odoo versions, the <code>admin</code> user was also the internal superuser and bypassed access security rules. This means that newly created models were automatically available and usable to it.</p>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor097"/>Adding access control security</h2>
			<p>To get a picture<a id="_idIndexMarker252"/> of what information is needed to add access rules to a model, on the web client, navigate to <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Security</strong> | <strong class="bold">Access Rights</strong>, as illustrated in the following screenshot:</p>
			<div><div><img src="img/Figure_3.5_B16119_B16119.jpg" alt="Figure 3.5 – Access Rights list, in the Technical menu&#13;&#10;" width="1166" height="636"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.5 – Access Rights list, in the Technical menu</p>
			<p>These access rights<a id="_idIndexMarker253"/> are also referred to as an <strong class="bold">access control list</strong> or <strong class="bold">ACL</strong>. In the<a id="_idIndexMarker254"/> previous screenshot, we can see the ACL for some models. It indicates, for a security group, what kinds of actions are allowed on records: read, write, create, and delete. </p>
			<p class="callout-heading">Changes in Odoo 14</p>
			<p class="callout">Transient models, used for interactive wizards, now also need to be provided access rights to user groups. In previous Odoo versions, this was not so, and users had access to these models by default. The recommendation is to grant read, write and create rights and not grant delete/unlink rights (<code>1,1,1,0</code> on CSV files).</p>
			<p>For the Library app, we will grant library users access to read, write, and create book records, and grant full access to library managers, including deleting records.</p>
			<p>This data can be provided by a module data file, loading records into the <code>ir.model.access</code> model. The filename for CSV data files must match the model ID we are loading data into.</p>
			<p>So we should add the <code>security/ir.model.access.csv</code> file, with the following content:</p>
			<pre>id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
access_book_user,BookUser,model_library_book,library_group_user,1,1,1,0
access_book_manager,BookManager,model_library_book,library_group_manager,1,1,1,1</pre>
			<p>The first line of the file has the field names. These are the columns provided in our CSV file:</p>
			<ul>
				<li><code>id</code> is the record's external ID (also known as XML ID). It should be unique in our module.</li>
				<li><code>name</code> is a descriptive title. It is informative and it is recommended for it to be unique.</li>
				<li><code>model_id</code> is the <a id="_idIndexMarker255"/>external ID for the model we are giving access to. Models have XML IDs automatically generated by the ORM; for <code>library.book</code>, the ID is <code>model_library_book</code>.</li>
				<li><code>group_id</code> identifies the security group to give permissions to. We grant access to the security groups created before: <code>library_group_user</code> and <code>library_group_manager</code>.</li>
				<li>The <code>perm_...</code> fields grant access to the <code>read</code>, <code>write</code>, <code>create</code>, or <code>unlink</code> (delete) operations. We used <code>1</code> for <code>yes</code>/<code>true</code> and <code>0</code> for <code>no</code>/<code>false</code>.</li>
			</ul>
			<p>We must not forget to reference this new file in the <code>data</code> key in the <code>__manifest__.py</code> file. It should look like this:</p>
			<pre>    "data": [
        "security/library_security.xml",
<strong class="bold">        "security/ir.model.access.csv",</strong>
        "views/library_menu.xml",
    ],</pre>
			<p>As before, upgrade the module to make these changes effective in the Odoo database. The warning message should be gone.</p>
			<p>At this point, the books model is available and should be accessible to the <code>admin</code> user. So, the first of our tests should be passing. Let's run it now, as follows:</p>
			<pre>(env15) $ odoo -c ~/work15/library.conf -u<a id="_idTextAnchor098"/> library_app --test-enable</pre>
			<p>We should see <a id="_idIndexMarker256"/>one test pass and one test fail.</p>
			<p>The ACL <strong class="bold">Access Rights</strong> option grants permissions at the model level, but Odoo also supports row-level access security, through <strong class="bold">Record Rules</strong>. This feature is explained in the following section.</p>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor099"/>Row-level access rules</h2>
			<p>Record rules define filters<a id="_idIndexMarker257"/> limiting the records a security group can access. For example, a salesperson could be limited to seeing only their own quotations, or an accounting user could be limited to seeing only accounting entries for the company they were given access to.</p>
			<p>To showcase this feature, we will limit library users to not be able to see inactive books. It is true that by default these are hidden, but they are still accessible if we filter the records with an <code>active</code> equals <code>True</code> condition. </p>
			<p><code>ir.rule</code> model. </p>
			<p>Record rule definition fields needed are outlined here:</p>
			<ul>
				<li><code>name</code>: A distinctive title, preferably unique.</li>
				<li><code>model_id</code>: A reference to the model that the rule applies to.</li>
				<li><code>groups</code>: A reference to the security group the rule applies to. This field is optional, and if not set it is considered a global rule (the <code>global</code> field is automatically set to <code>True</code>). Global rules behave differently—they impose restrictions that non-global rules can't override. It uses a specific syntax to write on to-many fields.</li>
				<li><code>domain_force</code>: The domain filter to use for the access restriction, using a list of tuples syntax for filter expressions used by Odoo.</li>
			</ul>
			<p>To add a record rule to the Library app, edit the <code>security/library_security.xml</code> file to add a second <code>&lt;data&gt;</code> section, just before the <code>&lt;/odoo&gt;</code> final tag, as follows:</p>
			<pre>  &lt;data noupdate="1"&gt;
    &lt;record id="book_user_rule" model="ir.rule"&gt;
      &lt;field name="name"&gt;Library Book User Access&lt;/field&gt;
      &lt;field name="model_id" ref="model_library_book"/&gt;
      &lt;field name="domain_force"&gt;
        [('active', '=', True)]
      &lt;/field&gt;
      &lt;field name="groups" eval="[(4, 
        ref('library_group_user'))]"/&gt;
    &lt;/record&gt;
  &lt;/data&gt;</pre>
			<p>The record rule is <a id="_idIndexMarker258"/>inside a <code>&lt;data noupdate="1"&gt;</code> element, meaning that those records will be created on module install but won't be rewritten on module updates. The point is to allow these rules to be later customized without the risk of those customizations having a module upgrade.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">While developing, <code>noupdate="1"</code> data sections can be a nuisance since later fixes and changes won't be updated on module upgrade. There are two ways to work around this. One is to temporarily work with <code>noupdate="0"</code> during development, and change it to the final <code>noupdate="1"</code> when you're finished. The second way is to reinstall the module instead of upgrading. This is possible in the command line, using <code>-i</code> instead of <code>-u</code> on an already installed module.</p>
			<p>The <code>groups</code> field is a many-to-many relation and uses a special syntax needed for the to-many fields. It is a list of tuples, where each tuple is a command. In this case, a <code>(4, x)</code> command was used, and the code <code>4</code> means that the record referenced next is to be appended to the values. The referenced record is <code>library_group_user</code>, the Library user group. The to-many field write syntax is discussed in more detail in <a href="B16119_06_Final_PD_ePub.xhtml#_idTextAnchor164"><em class="italic">Chapter 6</em></a>, <em class="italic">Models – Structuring the Application Data</em>.</p>
			<p>The domain expression also uses a special syntax, with a list of triples, each specifying a filter condition. The domain filter syntax is explained in <a href="B16119_07_Final_PD_ePub.xhtml#_idTextAnchor194"><em class="italic">Chapter 7</em></a>, <em class="italic">Recordsets — Working with Model Data</em>.</p>
			<p>Now that users can access the book model, we can go ahead with adding the UI, starting with the menu items.</p>
			<h1 id="_idParaDest-99"><a id="_idTextAnchor100"/>Step 6 – Implementing the backend view layer</h1>
			<p>The view layer describes the UI. Views are defined using XML, which is used by the web client framework to dynamically <a id="_idIndexMarker259"/>generate data-aware HTML views.</p>
			<p><strong class="bold">Menu items</strong> can execute <strong class="bold">window actions</strong> to render <strong class="bold">views</strong>. For example, the <strong class="bold">Users</strong> menu item processes a window action, also called <strong class="bold">Users</strong>, that in turn renders a <strong class="bold">view</strong> composition, with a <strong class="bold">list</strong> and a <strong class="bold">form</strong>.</p>
			<p>Several view types are available. The three most commonly used views are the <strong class="bold">List </strong>(sometimes called <strong class="bold">tree</strong> for historical reasons), the <strong class="bold">Form</strong>, and the <strong class="bold">Search</strong> options available in the top-right search box.</p>
			<p>Throughout the next sections, we will make gradual improvements and will need frequent module upgrades to make them available, or we can use the <code>--dev=all</code> server option, which spares us from module upgrades while developing. Using it, the view definitions are read directly from the XML files, and the changes made are immediately available to Odoo without the need for a module upgrade. In <a href="B16119_02_Final_PD_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 2</em></a>, <em class="italic">Preparing the Development Environment</em>, more details are given on the <code>--dev</code> server option.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">If a module upgrade fails because of an XML error, don't panic! Carefully read the error message in the server log. It should point you to where the problem is. If you feel in trouble, just comment out the last edited XML portions or remove the XML file from <code>__manifest__.py</code> and repeat the upgrade. The server should then start correctly.</p>
			<p>Following the Odoo development guidelines, the XML files for the UI should be inside a <code>views/</code> subdirectory.</p>
			<p>Let's start creating a UI for our to-do application.</p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor101"/>Adding menu items</h2>
			<p>The Library app <a id="_idIndexMarker260"/>now has the model to store book data, and we want to have it available on the UI. The first thing to do is add the corresponding menu options.</p>
			<p>Edit the <code>views/library_menu.xml</code> file and add the records for the window action and the menu item for the books model, as follows:</p>
			<pre>  &lt;!-- Action to open the Book list --&gt; 
  &lt;record id="action_library_book" model=
    "ir.actions.act_window"&gt;
    &lt;field name="name"&gt;Library Books&lt;/field&gt;
    &lt;field name="res_model"&gt;library.book&lt;/field&gt;
    &lt;field name="view_mode"&gt;tree,form&lt;/field&gt;
  &lt;/record&gt;
  &lt;!-- Menu item to open the Book list --&gt;
  &lt;menuitem id="menu_library_book" 
    name="Books" 
    parent="menu_library"
    action="action_library_book"
  /&gt;</pre>
			<p>This data file<a id="_idIndexMarker261"/> describes two records to add to Odoo, as follows:</p>
			<ul>
				<li>The <code>&lt;record&gt;</code> element defines a client-side window action, to open the <code>library.book</code> model with the <code>tree</code> and <code>form</code> views enabled, in that order.</li>
				<li>The <code>&lt;menuitem&gt;</code> for <code>Books</code>, running the <code>action_library_book</code> action, defined before.</li>
			</ul>
			<p>Upgrading the Library app now will make these changes available. A browser page reload might be needed to see the new menu items. Once this is done, the <strong class="bold">Library</strong> top menu should be available in Odoo, having a <strong class="bold">Books</strong> submenu option. </p>
			<p>Even though we haven't defined our UI view, Odoo provides automatically generated views, allowing us to start browsing and editing data right away.</p>
			<p>Clicking on the <strong class="bold">Library</strong> | <strong class="bold">Books</strong> menu item will display a basic list view, and clicking on the <strong class="bold">Create</strong> button will show a form like this:</p>
			<div><div><img src="img/Figure_3.6_B16119_B16119.jpg" alt="Figure 3.6 – Automatically generated form view for Library Books&#13;&#10;" width="1191" height="529"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.6 – Automatically generated form view for Library Books</p>
			<p>Odoo provides <a id="_idIndexMarker262"/>automatically generated views for us, but they're not that great. We might take <a id="_idTextAnchor102"/>this into our own hands and create our views, starting with the book form view. </p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor103"/>Creating a form view</h2>
			<p>Views are data <a id="_idIndexMarker263"/>records stored in the database, in the <code>ir.ui.view</code> model. So, we need to add a data file, with a <code>&lt;record&gt;</code> element describing the view.</p>
			<p>Add this new <code>views/book_view.xml</code> file to define the form view:</p>
			<pre>&lt;odoo&gt; 
  &lt;record id="view_form_book" model="ir.ui.view"&gt; 
    &lt;field name="name"&gt;Book Form&lt;/field&gt; 
    &lt;field name="model"&gt;library.book&lt;/field&gt; 
    &lt;field name="arch" type="xml"&gt; 
      &lt;form string="Book"&gt;
        &lt;group&gt;
          &lt;field name="name" /&gt; 
          &lt;field name="author_ids" 
            widget="many2many_tags" /&gt; 
          &lt;field name="publisher_id" /&gt; 
          &lt;field name="date_published" /&gt; 
          &lt;field name="isbn" /&gt; 
          &lt;field name="active" /&gt; 
          &lt;field name="image" widget="image" /&gt; 
        &lt;/group&gt; 
      &lt;/form&gt; 
    &lt;/field&gt; 
  &lt;/record&gt; 
&lt;/odoo&gt; </pre>
			<p>The <code>ir.ui.view</code> record has a record <code>id</code> field that defines an XML ID that can be used for other records to reference it. The view record sets values for three fields: <code>name</code>, <code>model</code>, and <code>arch</code>.</p>
			<p>The view is <a id="_idIndexMarker264"/>for the <code>library.book</code> model and is named <code>Book Form</code>. The name is just for information purposes. It does not have to be unique, but it should allow you to easily identify which record it refers to. In fact, the name can be entirely omitted; in that case, it will be automatically generated from the model name and the view type.</p>
			<p>The most important field is <code>arch</code> as it contains the actual view definition, and this needs closer examination.</p>
			<p>The first element of the view definition is the <code>&lt;form&gt;</code> tag. It declares the type of view we are defining and the remaining elements that should be contained in it.</p>
			<p>Next, we define sections inside the form, using  <code>&lt;group&gt;</code> elements. These may contain can contain <code>&lt;field&gt;</code> elements or other elements, including nested group elements. A group adds an invisible grid with two columns, perfect for fields because, by default, they occupy two columns, one for the label text, and another for the input field.</p>
			<p>Our simple form contains a single <code>&lt;group&gt;</code> element, and inside it, we added a <code>&lt;field&gt;</code> element for each of the fields to be presented. The fields automatically use an appropriate default widget, such as a date selection widget for date fields. In some cases, we might want to use a specific widget, adding the <code>widget</code> attribute. That was the case for <code>author_ids</code>, using a widget to display the authors as a list of tags, and the <code>image</code> field, using a widget appropriate for handling images. A detailed explanation of view elements is provided in <a href="B16119_10_Final_PD_ePub.xhtml#_idTextAnchor287"><em class="italic">Chapter 10</em></a>, <em class="italic">Backend Views – Designing the User Interface</em>.</p>
			<p>Remember to add this new file to the <code>data</code> key in the manifest file; otherwise, our module won't know about it and it won't be loaded. Here's the code you'll need to do this:</p>
			<pre>    "data": [
        "security/library_security.xml",
        "security/ir.model.access.csv", 
<strong class="bold">        "views/book_view.xml",</strong>
        "views/library_menu.xml",
    ], </pre>
			<p>The views <a id="_idIndexMarker265"/>will usually go after the security files, and before the menu file.</p>
			<p>Remember that for the changes to be loaded to our Odoo database, a module upgrade is needed. To see the changes in the web client, the form needs to be reloaded. Either click again on the menu option that opens it or reload the browser page (<em class="italic">F5</em> in most browsers).</p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor104"/>Business document form views</h2>
			<p>The preceding<a id="_idIndexMarker266"/> section provided a basic form view, but we can make some improvements to it. For document models, Odoo has a presentation style that mimics a paper page. This form contains two top elements: a <code>&lt;header&gt;</code> element, to contain action buttons, and a <code>&lt;sheet&gt;</code> element, to contain data fields.</p>
			<p>We can use this and modify the basic <code>&lt;form&gt;</code> element defined in the previous section with this one:</p>
			<pre>&lt;form&gt; 
  &lt;header&gt; 
    &lt;!-- Buttons will go here --&gt; 
  &lt;/header&gt; 
  &lt;sheet&gt; 
    &lt;!-- Content goes here: --&gt; 
    &lt;group&gt;
      &lt;field name="name" /&gt; 
      &lt;field name="author_ids" widget="many2many_tags" /&gt; 
      &lt;field name="publisher_id" /&gt; 
      &lt;field name="date_published" /&gt; 
      &lt;field name="isbn" /&gt; 
      &lt;field name="active" /&gt; 
      &lt;field name="image" widget="image" /&gt; 
    &lt;/group&gt; 
  &lt;/sheet&gt; 
&lt;/form&gt; </pre>
			<p>Forms can feature<a id="_idIndexMarker267"/> buttons, used to perform actions. These buttons can run a window action, usually opening another form, or run a Python class method. Buttons can be p<a id="_idTextAnchor105"/>laced inside a <code>&lt;header&gt;</code> section at the top, or anywhere inside a form. Let's see how.</p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor106"/>Adding action buttons</h2>
			<p>We will showcase a <a id="_idIndexMarker268"/>button in the header that checks if the book ISBN is valid. The code for this will be in a method of the book model that we will name <code>button_check_isbn()</code>.</p>
			<p>We haven't added the method, but we can already add the corresponding button to the form, as follows:</p>
			<pre>&lt;header&gt; 
  &lt;button name="button_check_isbn" type="object" 
          string="Check ISBN" /&gt; 
&lt;/header&gt; </pre>
			<p>The basic attributes of a button are listed as follows:</p>
			<ul>
				<li><code>string</code>: The UI text to display on the button</li>
				<li><code>type</code>: The type of action it performs, <code>object</code> or <code>action</code>.</li>
				<li><code>name</code>: This is the<a id="_idIndexMarker269"/> ID of the action that is run. For <code>object</code>, <code>type</code> is the method name; for <code>action</code>, this is the action record ID.</li>
				<li><code>class</code>: This is an optional attribute to apply CSS styles, as in regular HTML.</li>
			</ul>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor107"/>Using groups to organize forms</h2>
			<p>The <code>&lt;group&gt;</code> tag allows<a id="_idIndexMarker270"/> us to organize the form content. A <code>&lt;group&gt;</code> element <a id="_idIndexMarker271"/>creates an invisible grid with two columns. Field elements added inside it will be vertically stacked, as each field takes up two cells—one for the label and another for the input box. Adding two <code>&lt;group&gt;</code> elements inside a <code>&lt;group&gt;</code> element creates a layout with two columns of fields.</p>
			<p>We will use this to organize the book form. We will change the <code>&lt;sheet&gt;</code> content to match this:</p>
			<pre>&lt;sheet&gt; 
  &lt;group name="group_top"&gt; 
    &lt;group name="group_left"&gt; 
      &lt;field name="name" /&gt;
      &lt;field name="author_ids" widget="many2many_tags" /&gt;
      &lt;field name="publisher_id" /&gt;
      &lt;field name="date_published" /&gt;
    &lt;/group&gt; 
    &lt;group name="group_right"&gt; 
      &lt;field name="isbn" /&gt; 
      &lt;field name="active" /&gt; 
      &lt;field name="image" widget="image" /&gt;
    &lt;/group&gt; 
  &lt;/group&gt; 
&lt;/sheet&gt;</pre>
			<p>The <code>&lt;group&gt;</code> elements used have a <code>name</code> attribute assigning an ID to them. This is not required but is advised, since it makes it easier for them to be referenced by extension views.</p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor108"/>The complete form view</h2>
			<p>At this point, the XML definition for the book form view<a id="_idIndexMarker272"/> should look like this:</p>
			<pre>&lt;form&gt; 
  &lt;header&gt; 
    &lt;button name="check_isbn" type="object" 
      string="Check ISBN" /&gt; 
  &lt;/header&gt; 
  &lt;sheet&gt; 
    &lt;group name="group_top"&gt; 
      &lt;group name="group_left"&gt; 
        &lt;field name="name" /&gt;
        &lt;field name="author_ids" widget="many2many_tags" /&gt;
        &lt;field name="publisher_id" /&gt;
        &lt;field name="date_published" /&gt;
      &lt;/group&gt; 
      &lt;group name="group_right"&gt; 
        &lt;field name="isbn" /&gt; 
        &lt;field name="active" /&gt; 
        &lt;field name="image" widget="image" /&gt;
      &lt;/group&gt; 
    &lt;/group&gt; 
  &lt;/sheet&gt; 
&lt;/form&gt; </pre>
			<p>The action buttons don't work yet, <a id="_idTextAnchor109"/>since we still need to add their business logic. This will be done later in this chapter.</p>
			<h2 id="_idParaDest-106"><a id="_idTextAnchor110"/>Adding list and search views</h2>
			<p>List views<a id="_idIndexMarker273"/> are defined using a <code>&lt;tree&gt;</code> view type. Their structure is quite straightforward. The <code>&lt;tree&gt;</code> top element should include the fields to present as columns.</p>
			<p>We can add the following <code>&lt;tree&gt;</code> view definition to <code>book_view.xml</code>:</p>
			<pre>&lt;record id="view_tree_book" model="ir.ui.view"&gt; 
  &lt;field name="name"&gt;Book List&lt;/field&gt; 
  &lt;field name="model"&gt;library.book&lt;/field&gt; 
  &lt;field name="arch" type="xml"&gt; 
    &lt;tree&gt; 
      &lt;field name="name"/&gt; 
      &lt;field name="author_ids" widget="many2many_tags" /&gt;
      &lt;field name="publisher_id"/&gt; 
      &lt;field name="date_published"/&gt;
    &lt;/tree&gt; 
  &lt;/field&gt; 
&lt;/record&gt; </pre>
			<p>This defines a list with four columns: <code>name</code>, <code>author_ids</code>, <code>publisher_id</code>, and <code>date_published</code>.</p>
			<p>At the top-right corner of the list, Odoo displays a search box. The fields it searches in and the available filters are defined by a <code>&lt;search&gt;</code> view.</p>
			<p>As before, we will add this to <code>book_view.xml</code>, as follows:</p>
			<pre>&lt;record id="view_search_book" model="ir.ui.view"&gt; 
  &lt;field name="name"&gt;Book Filters&lt;/field&gt; 
  &lt;field name="model"&gt;library.book&lt;/field&gt; 
  &lt;field name="arch" type="xml"&gt; 
    &lt;search&gt; 
      &lt;field name="publisher_id"/&gt; 
      &lt;filter name="filter_inactive"
              string="Inactive" 
              domain="[('active','=',True)]"/&gt;
      &lt;filter name="filter_active"
              string="Active"
              domain="[('active','=',False)]"/&gt; 
    &lt;/search&gt; 
  &lt;/field&gt; 
&lt;/record&gt; </pre>
			<p>This search view<a id="_idIndexMarker274"/> is using two different elements, <code>&lt;field&gt;</code> and <code>&lt;filter&gt;</code>.</p>
			<p>The <code>&lt;field&gt;</code> elements define fields that are automatically searched when the user is typing in the search box. We added <code>publisher_id</code> to automatically show search results for the publisher field. The <code>&lt;filter&gt;</code> elements add predefined filter conditions, which can be toggled with a user click. The filter condition uses the Odoo domain filter syntax. Domain filters are addressed in more detail in <a href="B16119_10_Final_PD_ePub.xhtml#_idTextAnchor287"><em class="italic">Chapter 10</em></a>, <em class="italic">Backend Views — Designing the User Interface.</em></p>
			<p class="callout-heading">Changes in Odoo 12</p>
			<p class="callout"><code>&lt;filter&gt;</code> elements are now required to have a <code>name="..."</code> attribute, uniquely identifying each filter definition. If it's missing, the XML validation will fail and the module will not install or upgrade.</p>
			<p>We now have the Library app's basic components in place—the model and the view layers. Next, we add the business logic layer, adding the code that will make the <strong class="bold">Check ISBN</strong> button work.</p>
			<h1 id="_idParaDest-107"><a id="_idTextAnchor111"/>Step 7 – Implementing the business logic layer</h1>
			<p>The business logic layer <a id="_idIndexMarker275"/>supports the application's business rules, such as validations and automation. We will now add the logic for the <code>library.book</code> model.</p>
			<h2 id="_idParaDest-108"><a id="_idTextAnchor112"/>Adding business logic</h2>
			<p>Modern ISBNs have 13 digits, <a id="_idIndexMarker276"/>the last of which is a check digit computed from the first 12. If <code>digits</code> contains the first 12 digits, this Python code returns the corresponding check digit:</p>
			<pre>ponderations = [1, 3] * 6
terms = [a * b for a, b in zip(digits, ponderations)]
remain = sum(terms) % 10 
check = 10 - remain if remain != 0 else 0
return digits[-1]</pre>
			<p>The preceding code, with some adjustments, will be at the heart of our validation function. It should be a method in the <code>class Book(...)</code> object. We will add a method that checks a record's ISBN and returns <code>True</code> or <code>False</code>, as follows:</p>
			<pre>    def _check_isbn(self):
        self.ensure_one()
        digits = [int(x) for x in self.isbn if x.isdigit()]
        if len(digits) == 13:
            ponderations = [1, 3] * 6
            terms = [a * b for a, b in zip(digits[:12], 
              ponderations)]
            remain = sum(terms) % 10 
            check = 10 - remain if remain != 0 else 0
            return digits[-1] == check</pre>
			<p>Note that this method is not directly usable from the <strong class="bold">Form</strong> button, because it doesn't provide any visual cue of the result. Next, we will add a second method for that.</p>
			<p class="callout-heading">Changes in Odoo 13</p>
			<p class="callout">The <code>@api.multi</code> decorator was removed from the Odoo <strong class="bold">application programming interface</strong> (<strong class="bold">API</strong>) and can't be used. Note that for previous Odoo versions, this decorator was available, but not necessary. Adding it or not would have the exact same effect.</p>
			<p>To report validation<a id="_idIndexMarker277"/> issues to the user, we will use the Odoo <code>ValidationError</code> exception, so the first thing to do is to make it available by importing it. Edit the <code>models/library_book.py</code> Python file to add this at the top of the file, as follows:</p>
			<pre>from odoo.exceptions import ValidationError</pre>
			<p>Next, still in the <code>models/library_book.py</code> file, add the following code to the <code>Book</code> class:</p>
			<pre>def button_check_isbn(self): 
    for book in self:
        if not book.isbn:
            raise ValidationError("Please provide an ISBN 
              for %s" % book.name)
        if book.isbn and not book._check_isbn():
            raise ValidationError("%s ISBN is invalid" % 
              book.isbn) 
    return True </pre>
			<p>Here, <code>self</code> represents a recordset, and we can loop through each record and perform a check on each.</p>
			<p>This method is used in a <code>self</code> to be a single record and have no need to use the <code>for</code> loop. In fact, we did something similar with the <code>_check_isbn()</code> helper method. If you're going this way, it is recommended to add <code>self.ensure_one()</code> at the beginning of the method, to fail early if for some reason <code>self</code> is not a single record.</p>
			<p>But we chose to use a <code>for</code> loop to support multiple records, making our code capable of performing mass validations if we want to have that feature later on. </p>
			<p>The code loops through all the selected book task records and, for each one, if the book ISBN has a value, it checks if it is valid. If not, a warning message is raised for the user.</p>
			<p>The <code>Model</code> method does not need to return anything, but we should have it at least return a <code>True</code> value. The reason is that <a id="_idIndexMarker278"/>not all client implementations of the XML-<strong class="bold">Remote Procedure Call</strong> (<strong class="bold">RPC</strong>) protocol support None/Null values, and may raise errors when such a value is returned by a method.</p>
			<p>This is a good moment to upgrade the module and run the tests again, adding the <code>--test-enable</code> option to confirm that tests are now passing. You can also try it live, going into a book form and trying the button with both correct and incorrect ISBNs.</p>
			<p>The Library app has all the backend features we wanted to add for its first iteration, and we implemented the Odoo components at the several layers: model, view, and business logic. But Odoo also supports creating external-facing web pages. In the next section, we will create our first Odoo website page. </p>
			<h1 id="_idParaDest-109"><a id="_idTextAnchor113"/>Step 8 – Implementing the website UI</h1>
			<p>Odoo also provides a web<a id="_idIndexMarker279"/> development framework, to develop website features closely integrated with the backend apps. We will take our first steps toward this by creating a simple web page to display a list of active books in our library.</p>
			<p>The book catalog page will respond to web requests at the <code>http://my-server/library/books</code> address, so <code>/library/books</code> is the URL endpoint we want to implement.</p>
			<p>Web <code>http.Controller</code> derived class. The method is bound to one or more URL endpoints using the <code>@http.route</code> controller. When any of these URL endpoints are accessed, the controller code executes and returns the HTML to be presented to the user. The HTML rendering will usually be done using the QWeb templating engine.</p>
			<h2 id="_idParaDest-110"><a id="_idTextAnchor114"/>Adding the endpoint controller</h2>
			<p>Code for controllers is <a id="_idIndexMarker281"/>expected to be inside a <code>/controllers</code> subdirectory. To add a controller, first edit the  <code>library_app/__init__.py</code> file to have it also import the <code>controllers</code> subdirectory, as follows:</p>
			<pre>from . import models
from . import controllers</pre>
			<p>Then, add a <code>library_app/controllers/__init__.py</code> file so that this directory can be Python-imported, and add an <code>import</code> statement to it for the <code>main.py</code> Python file we will implement the controller with, as follows:</p>
			<pre>from . import main </pre>
			<p>Now, add the <a id="_idIndexMarker282"/>actual file for the controller, <code>library_app/controllers/main.py</code>, with the following code:</p>
			<pre>from odoo import http
class Books(http.Controller):
    @http.route("/library/books")
    def list(self, **kwargs):
        Book = http.request.env["library.book"]
        books = Book.search([])
        return http.request.render(
            "library_app.book_list_template",
            {"book"': books}
        )</pre>
			<p>The first line imports the <code>odoo.http</code> module, the core framework component providing web-related features. Next, we create a controller object class, derived from <code>http.Controller</code>.</p>
			<p>The particular ID name we choose for the class and for its methods is not relevant. The <code>@http.route</code> decorator is important since it declares the URL endpoint to be bound—<code>/books</code> in this case. For now, the web page is using the default access control and requires a user login.</p>
			<p>Inside the controller method, we can access the run environment using <code>http.request.env</code>. We use it to get a recordset with all active books in the catalog.</p>
			<p>The final step is to use <code>http.request.render()</code> to process the <code>library_app.index_template</code> QWeb template and generate the output HTML. We can make values available to the template through a dictionary, and this was used to pass the <code>books</code> recordset.</p>
			<p>If we now restart the<a id="_idIndexMarker283"/> Odoo server to reload the Python code and try accessing the <code>/library/books</code> URL, we should get an error message in the server log: <code>ValueError: External ID not found in the system: library_app.book_list_template</code>. This is expected since we haven't defined that template yet. That should be our next step.</p>
			<h2 id="_idParaDest-111"><a id="_idTextAnchor115"/>Adding a QWeb template</h2>
			<p>QWeb templates <a id="_idIndexMarker284"/>are also stored along with the other Odoo views, and the corresponding data files are usually stored in the  <code>/views</code> subdirectory. Let's add the <code>views/book_list_template.xml</code> file, as follows:</p>
			<pre>&lt;odoo&gt;
&lt;template id="book_list_template" name="Book List"&gt;
  &lt;div id="wrap" class="container"&gt;
    &lt;h1&gt;Books&lt;/h1&gt;
      &lt;t t-foreach="books" t-as="book"&gt;
        &lt;div class="row"&gt;
          &lt;span t-field="book.name" /&gt;,
          &lt;span t-field="book.date_published" /&gt;,
          &lt;span t-field="book.publisher_id" /&gt;
        &lt;/div&gt;
      &lt;/t&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;/odoo&gt;</pre>
			<p>The <code>&lt;template&gt;</code> element declares a QWeb template. In fact, it is a shortcut for an <code>ir.ui.view</code> record, the base model where templates are stored. The template contains the HTML to use and uses QWeb-specific tags and attributes.</p>
			<p>The <code>t-foreach</code> attribute is used to loop through the items in the <code>books</code> variable that was made available to the template by the controller's <code>http.request.render()</code> call. The <code>t-field</code> attribute takes care of properly rendering the content of an Odoo record field.</p>
			<p>The QWeb template<a id="_idIndexMarker285"/> data file needs to be declared in the module manifest, as with any other XML data file, so that it gets loaded and can be made available. So, the <code>__manifest__.py</code> file should be edited to add it, as shown next:</p>
			<pre>    "data": [
        "security/library_security.xml",
        "security/ir.model.access.csv", 
        "views/book_view.xml",
        "views/library_menu.xml",
<strong class="bold">        "views/book_list_template.xml",</strong>
    ], </pre>
			<p>After declaring the XML file in the manifest and performing a module upgrade, the web page should be working. Opening the <code>http://&lt;my-server&gt;:8069/library/books</code> URL with an active Odoo login should show us a simple list of the available books, as shown in the next screenshot:</p>
			<div><div><img src="img/Figure_3.7_B16119_B16119.jpg" alt="Figure 3.7 – Web page with a book list&#13;&#10;" width="945" height="270"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.7 – Web page with a book list</p>
			<p>This is a short overview of the Odoo web page features. These features are discussed in more depth in <a href="B16119_13_Final_PD_ePub.xhtml#_idTextAnchor379"><em class="italic">Chapter 13</em></a>, <em class="italic">Creating Web and Portal Frontend Features</em>.</p>
			<h1 id="_idParaDest-112"><a id="_idTextAnchor116"/>Quick reference </h1>
			<p>Most of the components are discussed in more detail in other chapters, and quick references are provided there, as follows:</p>
			<ul>
				<li><a href="B16119_02_Final_PD_ePub.xhtml#_idTextAnchor049"><em class="italic">Chapter 2</em></a>, <em class="italic">Preparing the Development Environment</em>, for the CLI <code>install</code> and <code>upgrade</code> modules</li>
				<li><a href="B16119_05_Final_PD_ePub.xhtml#_idTextAnchor146"><em class="italic">Chapter 5</em></a>, <em class="italic">Importing, Exporting, and Module Data</em>, for creating XML and CSV data files</li>
				<li><a href="B16119_06_Final_PD_ePub.xhtml#_idTextAnchor164"><em class="italic">Chapter 6</em></a>, <em class="italic">Models – Structuring the Application Data</em>, for the model layer, defining models and fields</li>
				<li><a href="B16119_07_Final_PD_ePub.xhtml#_idTextAnchor194"><em class="italic">Chapter 7</em></a>, <em class="italic">Recordsets – Working with Model Data</em>, for domain filter syntax and recordset manipulation</li>
				<li><a href="B16119_08_Final_PD_ePub.xhtml#_idTextAnchor227"><em class="italic">Chapter 8</em></a>, <em class="italic">Business Logic – Supporting Business Processes</em>, for Python method business logic</li>
				<li><a href="B16119_10_Final_PD_ePub.xhtml#_idTextAnchor287"><em class="italic">Chapter 10</em></a>, <em class="italic">Backend Views – Designing the User Interface</em>, for views, including window actions, menu items, forms, lists, and searches</li>
				<li><a href="B16119_13_Final_PD_ePub.xhtml#_idTextAnchor379"><em class="italic">Chapter 13</em></a>, <em class="italic">Creating Web and Portal Frontend Features</em>, for web controllers and QWeb syntax</li>
			</ul>
			<p>Not explained further elsewhere is access security, and we provide here a quick reference for those components.</p>
			<h2 id="_idParaDest-113"><a id="_idTextAnchor117"/>Access security</h2>
			<p>Internal system <a id="_idIndexMarker286"/>models are listed here:</p>
			<ul>
				<li><code>res.groups</code>: <code>name</code>, <code>implied_ids</code>, <code>users</code></li>
				<li><code>res.users</code>: <code>name</code>, <code>groups_id</code></li>
				<li><code>ir.model.access</code>: <code>name</code>, <code>model_id</code>, <code>group_id</code>, <code>perm_read</code>, <code>perm_write</code>, <code>perm_create</code>, <code>perm_unlink</code></li>
				<li><code>ir.access.rule</code>: <code>name</code>, <code>model_id</code>, <code>groups</code>, <code>domain_force</code></li>
			</ul>
			<p>XML IDs for the most relevant security groups are listed here:</p>
			<ul>
				<li><code>base.group_user</code>: <strong class="bold">internal user</strong>—any backend user</li>
				<li><code>base.group_system</code>: <strong class="bold">Settings</strong>—the Administrator belongs to this group</li>
				<li><code>base.group_no_one</code>: <strong class="bold">technical feature</strong>, usually used to make features not visible to users</li>
				<li><code>base.group_public</code>: <strong class="bold">Public</strong>, used to make features accessible to web anonymous users</li>
			</ul>
			<p>XML IDs for the default <a id="_idIndexMarker287"/>users provided by Odoo are listed here:</p>
			<ul>
				<li><code>base.user_root</code>: The root system superuser, also known as <code>OdooBot</code>.</li>
				<li><code>base.user_admin</code>: The default user, by default named <code>Administrator</code>.</li>
				<li><code>base.default_user</code>: The template used for new backend users. It is a template and is inactive, but can be duplicated to create new users.</li>
				<li><code>base.default_public user</code>: The template used to create new portal users.</li>
			</ul>
			<h1 id="_idParaDest-114"><a id="_idTextAnchor118"/>Summary</h1>
			<p>We created a new module from scratch, covering the essential components involved in a module—models, access security, menus, the three basic types of views (form, list, and search), and business logic in model methods. We also learned how to create web pages using web controllers and QWeb templates.</p>
			<p>In the process, we got familiar with the module-development process, which involves module upgrades and application-server restarts to make gradual changes effective in Odoo.</p>
			<p>Always remember, when adding model fields, an upgrade is needed. When changing Python code, including the manifest file, a restart is needed. When changing XML or CSV files, an upgrade is needed; also, when in doubt, do both: restart the server and upgrade the modules.</p>
			<p>We've gone through the essential elements and steps to create a new Odoo app. But in most cases, our modules will be extending existing apps to add features. This is what we will learn about in the next chapter.</p>
			<p>Further reading</p>
			<p>All of the Odoo-specific topics presented here will be covered in more depth in the remaining chapters of this book.</p>
			<p>The official documentation offers some relevant resources that make good complementary reading, as listed here:</p>
			<ul>
				<li>The <em class="italic">Building a Module</em> tutorial: <a href="https://www.odoo.com/documentation/15.0/howtos/backend.html">https://www.odoo.com/documentation/15.0/howtos/backend.html</a></li>
				<li>The <em class="italic">Odoo Guidelines</em> provide a list of code conventions and guidelines for module development: <a href="https://www.odoo.com/documentation/15.0/reference/guidelines.html">https://www.odoo.com/documentation/15.0/reference/guidelines.html</a></li>
				<li>The <em class="italic">Odoo Community Association Guidelines</em> provide a good resource for Odoo development best practices: <a href="https://odoo-community.org/page/contributing">https://odoo-community.org/page/contributing</a></li>
			</ul>
			<p>Learning Python is important for Odoo development. There are some good Python books from the <em class="italic">Packt</em> catalog, such as <em class="italic">Learn Python Programming – Second Edition</em>: <a href="https://www.packtpub.com/application-development/learn-python-programming-second-edition">https://www.packtpub.com/application-development/learn-python-programming-second-edition</a>.</p>
		</div>
	</div></body></html>