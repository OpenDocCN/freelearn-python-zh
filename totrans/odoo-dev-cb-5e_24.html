<html><head></head><body>
		<div><h1 id="_idParaDest-1005" class="chapter-number"><a id="_idTextAnchor1251"/>24</h1>
			<h1 id="_idParaDest-1006"><a id="_idTextAnchor1252"/>Managing the IoT Box</h1>
			<p>Odoo provides support for the <strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>). The IoT is a network of devices/sensors <a id="_idIndexMarker1670"/>that exchange data over the internet. By connecting such devices with a system, you can use them. For instance, by connecting a printer with Odoo, you can send PDF reports directly to the printer. Odoo uses a piece of hardware <a id="_idIndexMarker1671"/>called the <strong class="bold">IoT Box</strong>, which is used to connect devices such as printers, calipers, payment devices, footswitches, and more. In this chapter, you will learn how to set up and configure the IoT Box. Here, we’ll cover the following recipes:</p>
			<ul>
				<li>Flashing the IoT Box image for Raspberry Pi</li>
				<li>Connecting the IoT Box with a network</li>
				<li>Adding the IoT Box to Odoo</li>
				<li>Loading drivers and listing connected devices</li>
				<li>Taking input from devices</li>
				<li>Accessing <a id="_idIndexMarker1672"/>the IoT Box through SSH</li>
				<li>Configuring a <strong class="bold">point of </strong><strong class="bold">sale</strong> (<strong class="bold">POS</strong>)</li>
				<li>Sending PDF reports directly to a printer</li>
			</ul>
			<p>Note that the goal of this chapter is to install and configure the IoT Box. Developing hardware drivers is outside the scope of this book. If you want to learn about the IoT Box in more depth, explore the <code>iot</code> module in the Enterprise Edition.</p>
			<h1 id="_idParaDest-1007"><a id="_idTextAnchor1253"/>Technical requirements</h1>
			<p>The IoT Box is a <strong class="bold">Raspberry Pi</strong>-based device. The <a id="_idIndexMarker1673"/>recipes in this chapter are <a id="_idIndexMarker1674"/>based on the <strong class="bold">Raspberry Pi 3 Model B+</strong>, available at <a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/">https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/</a>. The IoT Box is part of the Enterprise Edition, so you will need to use the Enterprise Edition to follow the recipes in this chapter.</p>
			<p>All code used in this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter24">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter24</a>.</p>
			<h1 id="_idParaDest-1008"><a id="_idTextAnchor1254"/>Flashing the IoT Box image for Raspberry Pi</h1>
			<p>In this recipe, you will learn <a id="_idIndexMarker1675"/>how to flash a <strong class="bold">microSD</strong> card with an image of the IoT Box. Note that <a id="_idIndexMarker1676"/>this recipe is only for those <a id="_idIndexMarker1677"/>who have purchased the <strong class="bold">blank Raspberry Pi</strong>. If you <a id="_idIndexMarker1678"/>have purchased the official IoT Box from Odoo, you can skip this recipe as it is preloaded with the IoT Box image.</p>
			<h2 id="_idParaDest-1009"><a id="_idTextAnchor1255"/>Getting ready</h2>
			<p>Raspberry Pi 3 Model B+ uses a microSD card, so we have used a microSD card for this recipe. You will need to connect a microSD card to your computer.</p>
			<h2 id="_idParaDest-1010"><a id="_idTextAnchor1256"/>How to do it…</h2>
			<p>Perform the following steps to install an IoT Box image onto your SD card:</p>
			<ol>
				<li>Insert a microSD card into your computer (use an adapter if your computer doesn’t have a dedicated slot).</li>
				<li>Download <a id="_idIndexMarker1679"/>the IoT Box image from Odoo’s nightly builds. The image is available at <a href="https://nightly.odoo.com/master/iotbox/">https://nightly.odoo.com/master/iotbox/</a>.</li>
				<li>Download <a id="_idIndexMarker1680"/>and install <strong class="bold">balenaEtcher</strong> on your computer. You can download this from <a href="https://www.balena.io/etcher/">https://www.balena.io/etcher/</a>.</li>
				<li>Open balenaEtcher, select the IoT Box image (we are using version 23.09 of the IoT Box image), and choose to flash your microSD card. You’ll see the following screen:</li>
			</ol>
			<div><div><img src="img/B20997_24_01.jpg" alt="Figure 24.1 – Flashing the SD card with the IoT Box image"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.1 – Flashing the SD card with the IoT Box image</p>
			<ol>
				<li value="5">Click on the <strong class="bold">Flash!</strong> button and wait until the process completes.</li>
				<li>Remove the microSD card and place it in the Raspberry Pi.</li>
			</ol>
			<p>After these steps, your microSD card should be loaded with the IoT Box image and ready to be used in the IoT Box.</p>
			<h2 id="_idParaDest-1011"><a id="_idTextAnchor1257"/>How it works…</h2>
			<p>In this recipe, we have installed the IoT Box image on a microSD card. In the second step, we <a id="_idIndexMarker1681"/>downloaded the IoT Box image from the <a id="_idIndexMarker1682"/>Odoo nightly builds. On the nightly page, you can find different images for the IoT Box. You need to choose the latest image from the Odoo nightly builds. When writing this book, we used the latest image, which was <code>iotboxv23_11.zip</code>. The Odoo IoT Box image is based on the Raspbian Stretch Lite OS, and the image is loaded with the libraries and modules required to integrate the IoT Box with the Odoo instance.</p>
			<p>In <em class="italic">step 3</em>, we downloaded the balenaEtcher utility tool to flash the microSD card.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In this recipe, we used balenaEtcher to flash the microSD card, but you can use any other tools to flash the microSD card.</p>
			<p>In <em class="italic">step 4</em>, we flashed the microSD card with the IoT Box image. Note that this process can take several minutes. On completion of the process, the microSD card will be ready to be used.</p>
			<p>Perform the <a id="_idIndexMarker1683"/>following steps if you want to verify <a id="_idIndexMarker1684"/>whether the image was flashed successfully:</p>
			<ol>
				<li>Mount the microSD card into Raspberry Pi.</li>
				<li>Connect it to the power supply and attach the external display through an HDMI cable (in practical usage, an external display is not compulsory; we have used it here just for verification purposes).</li>
				<li>The OS will boot up and show the following page:</li>
			</ol>
			<div><div><img src="img/B20997_24_02.jpg" alt="Figure 24.2 – The IoT Box screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.2 – The IoT Box screen</p>
			<p>If you are not using a display, you can just connect the IoT Box to a power supply, and after some time, you will see the Wi-Fi network of the IoT Box.</p>
			<h2 id="_idParaDest-1012"><a id="_idTextAnchor1258"/>There’s more...</h2>
			<p>In previous versions of Odoo, the PosBox was used in POS applications. The IoT Box supports <a id="_idIndexMarker1685"/>all the features of the PosBox, so if you <a id="_idIndexMarker1686"/>are using the Community Edition of Odoo and you want to integrate devices, you can use the same IoT Box image to connect Odoo instances with different devices. See the <em class="italic">Configuring a POS</em> recipe for more information.</p>
			<h1 id="_idParaDest-1013"><a id="_idTextAnchor1259"/>Connecting the IoT Box with a network</h1>
			<p>The IoT Box communicates with an Odoo instance through the network. Connecting the IoT Box <a id="_idIndexMarker1687"/>is a crucial step, and if you make a mistake here, you might encounter errors when connecting the IoT Box with Odoo.</p>
			<h2 id="_idParaDest-1014"><a id="_idTextAnchor1260"/>Getting ready</h2>
			<p>Mount the microSD card with the IoT Box image into the Raspberry Pi and then connect the Raspberry Pi to the power supply.</p>
			<h2 id="_idParaDest-1015"><a id="_idTextAnchor1261"/>How to do it…</h2>
			<p>Raspberry Pi 3 <a id="_idIndexMarker1688"/>Model B+ supports two types <a id="_idIndexMarker1689"/>of network connection—<strong class="bold">Ethernet </strong><strong class="bold">and Wi-Fi</strong>.</p>
			<p>Connecting the <a id="_idIndexMarker1690"/>IoT Box through Ethernet is simple; you just need to connect your IoT Box with the <strong class="bold">RJ45 Ethernet cable</strong>, and the IoT Box is then ready to be used. Connecting the IoT Box through Wi-Fi is complicated as you might not have a display attached to it. Perform the following steps to connect the IoT Box through Wi-Fi:</p>
			<ol>
				<li>Connect the IoT Box to the power supply (if the Ethernet cable is plugged into the IoT Box, remove it and restart the IoT Box).</li>
				<li>Open your computer and connect to the Wi-Fi network, named <code>IoTBox</code>, as shown in the following screenshot (no password is needed):</li>
			</ol>
			<div><div><img src="img/B20997_24_03.jpg" alt="Figure 24.3 – IoT Box Wi-Fi network"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.3 – IoT Box Wi-Fi network</p>
			<ol>
				<li value="3">After connecting <a id="_idIndexMarker1691"/>to the Wi-Fi network, you’ll see a popup with the IoT Box home page, as shown in the following screenshot (if this does not work, open the IP address of the box in the browser):</li>
			</ol>
			<div><div><img src="img/B20997_24_04.jpg" alt="Figure 24.4 – Connecting to the IoT Box"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.4 – Connecting to the IoT Box</p>
			<ol>
				<li value="4">Set <strong class="bold">IoT Box Name</strong> and <a id="_idIndexMarker1692"/>keep <strong class="bold">Server token</strong> empty, then click on <strong class="bold">Next</strong>. This will redirect you to a page where you can see a list of Wi-Fi networks:</li>
			</ol>
			<div><div><img src="img/B20997_24_05.jpg" alt="Figure 24.5 – Connecting to Wi-Fi"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.5 – Connecting to Wi-Fi</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can <a id="_idIndexMarker1693"/>use a server token if you are using the Enterprise Edition and you want to connect the IoT Box with Odoo right away. You can get a server token from your Odoo instance; refer to the next recipe to learn more about it.</p>
			<ol>
				<li value="5">Select the Wi-Fi network that you want to connect to and fill in the <strong class="bold">Password</strong> field. After doing this, click on the <strong class="bold">Connect</strong> button. If you entered the correct information, you will be redirected to the final page:</li>
			</ol>
			<div><div><img src="img/B20997_24_06.jpg" alt="Figure 24.6 – Confirmation page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.6 – Confirmation page</p>
			<p>After performing these steps, your IoT Box is connected to the network and ready to be integrated with t<a id="_idTextAnchor1262"/>he Odoo instance.</p>
			<h2 id="_idParaDest-1016"><a id="_idTextAnchor1263"/>How it works...</h2>
			<p>Connecting the Odoo instance to the IoT Box through Ethernet is simple; just connect your IoT Box <a id="_idIndexMarker1694"/>with the RJ45 Ethernet cable, and the IoT Box is ready to be used. It’s different when you want to connect the IoT Box with Wi-Fi; this is difficult because the IoT Box doesn’t have a display or GUI. You do not have an interface to enter your Wi-Fi network password. Consequently, the solution to this problem is to disconnect your IoT Box from the Ethernet cable (if it is connected) and restart it. In such cases, the IoT Box will create its own Wi-Fi hotspot, named <code>IoTBox</code> or similar, as shown in <em class="italic">step 2</em>. You need to connect the Wi-Fi with the name <code>IoTBox</code>; luckily, it does not require a password. Once you connect to the <code>IoTBox</code> Wi-Fi, you’ll get a popup, as shown in <em class="italic">step 3</em>. Here, you can name your IoT Box something like <code>Assembly-line IoT Box</code>. Keep the server token empty for now; we will learn more about it in the <em class="italic">Adding the IoT Box to Odoo</em> recipe. Then, click on the <strong class="bold">Next</strong> button.</p>
			<p>Upon clicking the <strong class="bold">Next</strong> button, you will be shown a list of Wi-Fi networks, as shown in <em class="italic">step 4</em>. Here, you can connect the IoT Box to your Wi-Fi network. Make sure you choose the right network. You need to connect the IoT Box with the same Wi-Fi network as the computer on which the Odoo instance is going to be used. The IoT Box and the Odoo instance <a id="_idIndexMarker1695"/>communicate within a <strong class="bold">local area network</strong> (<strong class="bold">LAN</strong>). This means that if both are connected to different networks, they cannot communicate, and so IoT will not work.</p>
			<p>After choosing the <a id="_idIndexMarker1696"/>right Wi-Fi network, click on <strong class="bold">Connect</strong>. Then, the IoT Box will turn off its hotspot and reconnect to your configured Wi-Fi network. That’s it—the IoT Box is ready to be used.</p>
			<h1 id="_idParaDest-1017"><a id="_idTextAnchor1264"/>Adding the IoT Box to Odoo</h1>
			<p>Our IoT Box is connected <a id="_idIndexMarker1697"/>to the local network and ready to be used <a id="_idIndexMarker1698"/>with Odoo. In this recipe, we will connect the IoT Box with the Odoo instance.</p>
			<h2 id="_idParaDest-1018"><a id="_idTextAnchor1265"/>Getting ready</h2>
			<p>Make sure the IoT Box is on and that you have connected the IoT Box to the same Wi-Fi network as the computer with the Odoo instance.</p>
			<p>There are a few things you need to take care of; otherwise, the IoT Box will not be added to Odoo:</p>
			<ul>
				<li>If you are testing the IoT Box in a local instance, you will need to use <code>http://192.168.*.*:8069</code> (your local IP) instead of <code>http://localhost:8069</code>. If you use localhost, the IoT Box will not be added to your Odoo instance.</li>
				<li>You need to connect the IoT Box with the same Wi-Fi/Ethernet network as the computer on which the Odoo instance is being used. Otherwise, the IoT Box will not be added to your Odoo instance.</li>
				<li>If your Odoo instance is running with multiple databases, IoT Box will not auto-connect with the Odoo instance. Use the <code>--db-filter</code> option to avoid this issue.</li>
			</ul>
			<h2 id="_idParaDest-1019"><a id="_idTextAnchor1266"/>How to do it…</h2>
			<p>In order to connect the IoT Box with Odoo, first you will need to install the <code>iot</code> module on your Odoo instance:</p>
			<ol>
				<li>To do so, go to the <strong class="bold">Apps</strong> menu and search for the <strong class="bold">Internet of Things</strong> module. The <a id="_idIndexMarker1699"/>module will look like this. Activate the <a id="_idIndexMarker1700"/>module, and we are good to go:</li>
			</ol>
			<div><div><img src="img/B20997_24_07.jpg" alt="Figure 24.7 – Installing the iot module"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.7 – Installing the iot module</p>
			<ol>
				<li value="2">After installing the <code>iot</code> module, you can connect your instance with the IoT Box. Then, connect your IoT Box manually with the Odoo instance by clicking on the <strong class="bold">IoT</strong> menu.</li>
				<li>Click on the <strong class="bold">Connect</strong> button on the control panel. This will show the following popup. Copy the <strong class="bold">Token</strong> value:</li>
			</ol>
			<div><div><img src="img/B20997_24_08.jpg" alt="Figure 24.8 – Dialog to connect the IoT Box with Odoo"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.8 – Dialog to connect the IoT Box with Odoo</p>
			<ol>
				<li value="4">Open the <a id="_idIndexMarker1701"/>IP of the IoT Box with port <code>8069</code>. This will <a id="_idIndexMarker1702"/>display the home page of the IoT Box. Click on the <strong class="bold">configure</strong> button in the <strong class="bold">Name</strong> section:</li>
			</ol>
			<div><div><img src="img/B20997_24_09.jpg" alt="Figure 24.9 – The IoT Box home page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.9 – The IoT Box home page</p>
			<ol>
				<li value="5">Set the <strong class="bold">IoT Box Name</strong> setting <a id="_idIndexMarker1703"/>and paste in the server <a id="_idIndexMarker1704"/>token. Then, click on the <strong class="bold">Connect</strong> button. This will start configuring the IoT Box. Wait for the process to complete:</li>
			</ol>
			<div><div><img src="img/B20997_24_010.jpg" alt="Figure 24.10 – The IoT Box home page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.10 – The IoT Box home page</p>
			<ol>
				<li value="6">Check the <strong class="bold">IoT</strong> menu in <a id="_idIndexMarker1705"/>your Odoo instance. You will <a id="_idIndexMarker1706"/>find a new IoT Box:</li>
			</ol>
			<div><div><img src="img/B20997_24_011.jpg" alt="Figure 24.11 – Successfully connected IoT Box"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.11 – Successfully connected IoT Box</p>
			<h2 id="_idParaDest-1020"><a id="_idTextAnchor1267"/>How it works…</h2>
			<p>Connecting the IoT Box with Odoo is important. This way, Odoo will know the IP of the IoT Box. The IP will be used by Odoo to communicate with devices connected to that device. This will also make sure, in the case of multiple IoT Boxes, that Odoo communicates with the right one. The rest is straightforward.</p>
			<p>If you want to add an IoT Box to an Odoo instance during Wi-Fi configuration, that can be done. In the <em class="italic">Connecting the IoT Box with a network</em> recipe, we kept the <strong class="bold">Server token</strong> field empty. You just need to add the server token in this step:</p>
			<div><div><img src="img/B20997_24_012.jpg" alt="Figure 24.12 – Adding the server token during Wi-Fi configuration"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.12 – Adding the server token during Wi-Fi configuration</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Avoid using <a id="_idIndexMarker1707"/>the DHCP network when using the IoT Box. This is <a id="_idIndexMarker1708"/>because the IoT Box network configuration is added based on the IP address. If you use the DHCP network, then the IP address is assigned dynamically. So, there is a chance that your IoT Box will stop responding due to the new IP address. To avoid this issue, you can map the MAC address of the IoT Box to the fixed IP address.</p>
			<h3>Connecting an IoT Box with a pairing code</h3>
			<p>There is <a id="_idIndexMarker1709"/>one more alternative way to connect an IoT Box, which is through a <code>&lt;IoTBOX IP&gt;:8069/point_of_sale/display</code>. Once you open the POS client display, you will be able to see the pairing code as follows:</p>
			<div><div><img src="img/B20997_24_013.jpg" alt="Figure 24.13 – The pairing code for the IoT Box"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.13 – The pairing code for the IoT Box</p>
			<p>Then, you just need <a id="_idIndexMarker1712"/>to use the pairing code in <a id="_idIndexMarker1713"/>the IoT Box connection dialog in your Odoo instance.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The pairing code will not be displayed if you are not connected to the internet.</p>
			<p>In the preceding screenshot, we have seen how you can get the pairing code for the POS client display. But if you have an Ethernet connection and a printer, you can get the pairing code without a display. You just need to connect the IoT Box with the Ethernet and the printer. Once the IoT Box is booted, it will print a receipt with the pairing code. Then, you just need to use the pairing code in the IoT Box connection dialog in your Odoo instance.</p>
			<h2 id="_idParaDest-1021"><a id="_idTextAnchor1268"/>There’s more…</h2>
			<p>If you want <a id="_idIndexMarker1714"/>to connect an existing IoT Box with any <a id="_idIndexMarker1715"/>other Odoo instance, you will need to clear the configuration. You can clear the IoT Box configuration with the <strong class="bold">Clear</strong> button on the Odoo server configuration page of the IoT Box:</p>
			<div><div><img src="img/B20997_24_014.jpg" alt="Figure 24.14 – Clearing the IoT Box configuration"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.14 – Clearing the IoT Box configuration</p>
			<h1 id="_idParaDest-1022"><a id="_idTextAnchor1269"/>Loading drivers and listing connected devices</h1>
			<p>The IoT Box is not <a id="_idIndexMarker1716"/>just limited to the Enterprise Edition. You can use <a id="_idIndexMarker1717"/>it like the PosBox in the Community Edition. The device’s integration is part of the Enterprise Edition, so the IoT Box image does not come with device drivers; you need to load them manually. Usually, if you connect the IoT Box with an Enterprise Odoo instance, the IoT Box loads the device driver interfaces automatically. But sometimes, you might have custom drivers or drivers that are not loaded correctly. In that case, you can manually load the drivers. In this recipe, we will see how you can load drivers and get a list of connected devices.</p>
			<h2 id="_idParaDest-1023"><a id="_idTextAnchor1270"/>Getting ready</h2>
			<p>Make sure <a id="_idIndexMarker1718"/>the IoT Box is on and that you have connected it <a id="_idIndexMarker1719"/>to the same Wi-Fi network as the computer with the Odoo instance.</p>
			<h2 id="_idParaDest-1024"><a id="_idTextAnchor1271"/>How to do it…</h2>
			<p>Perform the following steps to load device drivers into the IoT Box:</p>
			<ol>
				<li>Open the IoT Box home page and click on the <strong class="bold">handlers list</strong> button at the bottom:</li>
			</ol>
			<div><div><img src="img/B20997_24_015.jpg" alt="Figure 24.15 – handlers list button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.15 – handlers list button</p>
			<ol>
				<li value="2">The <strong class="bold">handlers list</strong> button <a id="_idIndexMarker1720"/>will redirect you to the <strong class="bold">Handlers list</strong> page, where <a id="_idIndexMarker1721"/>you will find the <strong class="bold">Load handlers</strong> button. Click on the button to load the drivers:</li>
			</ol>
			<div><div><img src="img/B20997_24_016.jpg" alt="Figure 24.16 – Drivers list"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.16 – Drivers list</p>
			<ol>
				<li value="3">Go back to <a id="_idIndexMarker1722"/>the <strong class="bold">IoT Box</strong> home page. Here, you will see <a id="_idIndexMarker1723"/>a list of connected devices:</li>
			</ol>
			<div><div><img src="img/B20997_24_017.jpg" alt="Figure 24.17 – Connected devices"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.17 – Connected devices</p>
			<p>After performing <a id="_idIndexMarker1724"/>these steps, the IoT Box will be ready with the <a id="_idIndexMarker1725"/>devices you specified, and you can start using the devices in your applications.</p>
			<h2 id="_idParaDest-1025"><a id="_idTextAnchor1272"/>How it works…</h2>
			<p>You can load the drivers from the home page of the IoT Box. You can do this using the <strong class="bold">Load handlers</strong> button at the bottom. Note that this will only work if your IoT Box is connected with the Odoo instance using the Enterprise Edition. After loading the drivers, you will be able to see a list of devices on the IoT Box home page. You can also see a list of connected devices in the Odoo instance through the <strong class="bold">IoT</strong> | <strong class="bold">Devices</strong> menu. In this menu, you will see a list of connected devices for each IoT Box:</p>
			<div><div><img src="img/B20997_24_018.jpg" alt="Figure 24.18 – Connected devices list"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.18 – Connected devices list</p>
			<p>Right now, the IoT <a id="_idIndexMarker1726"/>Box supports a few hardware devices, such as <a id="_idIndexMarker1727"/>cameras, footswitches, printers, and calipers. A list of devices that are recommended by Odoo can be found here: <a href="https://www.odoo.com/page/iot-hardware">https://www.odoo.com/page/iot-hardware</a>. If your device is not supported, you can pay for driver development.</p>
			<h1 id="_idParaDest-1026"><a id="_idTextAnchor1273"/>Taking input from devices</h1>
			<p>The IoT Box only supports limited devices. Right now, these hardware devices are integrated <a id="_idIndexMarker1728"/>with the manufacturing application. But if you want, you can integrate supported devices with your module. In this recipe, we will capture a picture from a camera through our IoT Box.</p>
			<h2 id="_idParaDest-1027"><a id="_idTextAnchor1274"/>Getting ready</h2>
			<p>We will be using the <code>my_hostel</code> module from the <em class="italic">Logging user changes in a chatter</em> recipe of <a href="B20997_23.xhtml#_idTextAnchor1210"><em class="italic">Chapter 23</em></a>, <em class="italic">Managing Emails in Odoo</em>. In this recipe, we will add a new field to capture and store images when a borrower returns a book. Make sure the IoT Box is on and that you have connected a supported camera device with it.</p>
			<h2 id="_idParaDest-1028"><a id="_idTextAnchor1275"/>How to do it…</h2>
			<p>Perform the following steps to capture a picture using a camera with the IoT Box:</p>
			<ol>
				<li>Add a dependency in the manifest file:<pre class="source-code">
'depends': ['base', 'quality_iot'],</pre></li>				<li>Add new <a id="_idIndexMarker1729"/>fields in the <code>hostel.student</code> model:<pre class="source-code">
test_type_id = fields.Many2one('quality.point.test_type', 'Test Type',help="Defines the type of the quality control point.",
required=True, default=_get_default_test_type_id)
test_type = fields.Char(related='test_type_id.technical_name', readonly=True)
device_id = fields.Many2one('iot.device', string='IoT Device', domain="[('type', '=', 'camera')]")
ip = fields.Char(related="device_id.iot_id.ip")
identifier = fields.Char(related='device_id.identifier')
picture = fields.Binary()</pre></li>				<li>Add these fields into the form view of the <code>hostel.student</code> model:<pre class="source-code">
&lt;group&gt;
    &lt;field name="test_type_id" invisible="1"/&gt;
    &lt;field name="test_type" invisible="1"/&gt;
    &lt;field name="ip" invisible="0"/&gt;
    &lt;field name="identifier" invisible="0"/&gt;
    &lt;field name="device_id" required="1"/&gt;
    &lt;field name="picture" widget="iot_picture"
          options="{'ip_field': 'ip', 'identifier': 'identifier'}"/&gt;
    &lt;field name="name"/&gt;
    &lt;field name="gender"/&gt;
    &lt;field name="active"/&gt;
&lt;/group&gt;</pre></li>				<li>Update the <code>my_hostel</code> module <a id="_idIndexMarker1730"/>to apply the changes. After the update, you will have a button to capture images:</li>
			</ol>
			<div><div><img src="img/B20997_24_019.jpg" alt="Figure 24.19 – Capturing an image via IoT"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.19 – Capturing an image via IoT</p>
			<p>Note that the button will not capture images if the webcam is not connected to the IoT Box or drivers are not loaded in the IoT Box.</p>
			<h2 id="_idParaDest-1029"><a id="_idTextAnchor1276"/>How it works…</h2>
			<p>In <em class="italic">step 1</em>, we added a dependency to the <code>quality_iot</code> module in the manifest file. The <code>quality_iot</code> module is part of the Enterprise Edition and contains a widget that allows you to request an image from a camera through the IoT Box. This will install <code>stock</code> modules, but for the sake of simplicity, we will use <code>quality_iot</code> as a dependency. If you <a id="_idIndexMarker1731"/>do not want to use this dependency, you can create your own field widget. Refer to the <em class="italic">Creating custom widgets</em> recipe in <a href="B20997_15.xhtml#_idTextAnchor861"><em class="italic">Chapter 15</em></a>, <em class="italic">Web Client Development</em>, to learn more about widgets.</p>
			<p>In <em class="italic">step 2</em>, we added fields required to capture an image from the camera. To capture the image, we need two things: the device identifier and the IP address of the IoT Box. We want to give the user the option to select the camera, so we added a <code>device_id</code> field. The user will choose a camera to capture the image, and based on the selected camera device, we extracted IP and device identifier information from related fields. Based on these fields, Odoo will know where to capture the image, if you have multiple IoT Boxes. We have also added a binary field, <code>picture</code>, to save the image.</p>
			<p>In <em class="italic">step 3</em>, we added fields in the form view. Note that we used the <code>iot_picture</code> widget on the <code>picture</code> field. We added <code>ip</code> and <code>identifier</code> fields as invisible fields because we do not want to show them to the user; rather, we want to use them in the <code>picture</code> field options. This widget will add the button in the form view; upon clicking the button, Odoo will make a request to the IoT Box to capture the image. The IoT Box will return image data as the response. This response will be saved in the <code>picture</code> binary field.</p>
			<h2 id="_idParaDest-1030"><a id="_idTextAnchor1277"/>There’s more…</h2>
			<p>The IoT Box supports Bluetooth calipers. If you want to take measurements in your module, you can use the <code>iot_measure</code> widget to fetch them in Odoo. Note that as with <code>iot_picture</code>, here, you will also need to add <code>ip</code> and <code>identifier</code> invisible fields in the form view:</p>
			<pre class="source-code">
&lt;field name="measure" widget="iot_measure"
           options="{'ip_field': 'ip', 'identifier': 'identifier'}"/&gt;</pre>			<p>This will fill the <code>measure</code> field with the data captured from the IoT caliper.</p>
			<h1 id="_idParaDest-1031"><a id="_idTextAnchor1278"/>Accessing the IoT Box through SSH</h1>
			<p>The IoT Box is running <a id="_idIndexMarker1732"/>on the Raspbian OS, and it is possible to access <a id="_idIndexMarker1733"/>the IoT Box through SSH. In this recipe, we will learn how to access the IoT Box through SSH.</p>
			<h2 id="_idParaDest-1032"><a id="_idTextAnchor1279"/>Getting ready</h2>
			<p>Make sure the IoT Box is on and you have connected the IoT Box to the same Wi-Fi network as the computer with the Odoo instance.</p>
			<h2 id="_idParaDest-1033"><a id="_idTextAnchor1280"/>How to do it…</h2>
			<p>In order to connect the IoT Box through SSH, you will need the IP address of the IoT Box. You can see this IP address in its form view. As an example, in this recipe, we will use <code>192.168.43.6</code> as the IoT Box IP address, so replace this with your IP address. Perform the following steps to access the IoT Box through SSH:</p>
			<ol>
				<li>Open the terminal and execute the following command:<pre class="source-code">
<strong class="bold">$ ssh pi@192.168.43.6</strong>
<code>raspberry</code> as the password.</li>
				<li>If you add the right password, you can access the shell. Execute the following command to see the directory:<pre class="source-code">
<strong class="bold">total 24</strong>
<strong class="bold">-rw-r--r-- 1 root root    6 Oct 26 08:12 iotbox_version</strong>
<strong class="bold">drwxr-xr-x 5 pi   </strong><strong class="bold">pi   4096 Oct 23 09:05 odoo</strong>
<strong class="bold">-rw-r--r-- 1 pi   pi     36 Nov 15 13:10 odoo-db-uuid.conf</strong>
<strong class="bold">-rw-r--r-- 1 pi   pi      0 Nov 15 13:10 odoo-enterprise-code.conf</strong>
<strong class="bold">-rw-r--r-- 1 pi   pi     26 Nov 15 13:10 odoo-remote-server.conf</strong>
<strong class="bold">-rw-r--r-- 1 pi   pi     11 Nov 15 13:10 token</strong>
<strong class="bold">-rw-r--r-- 1 pi   </strong><strong class="bold">pi     26 Aug 20 12:03 wifi_network.txt</strong></pre></li>			</ol>
			<p>As you have SSH access, you can explore the full filesystem of the IoT Box.</p>
			<h2 id="_idParaDest-1034"><a id="_idTextAnchor1281"/>How it works…</h2>
			<p>We used the Pi user with the password <code>raspberry</code> to access the IoT Box through SSH. SSH connection <a id="_idIndexMarker1734"/>is used when you want to debug a problem <a id="_idIndexMarker1735"/>in the IoT Box. SSH doesn’t need any explanation, but let’s see how Odoo works in the IoT Box.</p>
			<p>Here is some information that might help you debug the issue:</p>
			<ul>
				<li>The IoT Box is internally running some Odoo modules. The name of these modules usually starts with <code>hw_</code>, and they are available in the Community Edition. You can find all the modules in the <code>/</code><code>home/pi/odoo/addon</code> directory.</li>
				<li>If you want to see the Odoo server log, you can access it from the <code>/</code><code>var/log/odoo/odoo-server.log</code> file.</li>
				<li>Odoo is running through a service named <code>odoo</code>; you can use the following command to start, stop, or restart the service:<ul><li><code>sudo service </code><code>odoo start/restart/stop</code></li></ul></li>
				<li>Customers mostly turn the IoT Box off by disconnecting the power. This means that the IoT Box OS does not shut down properly in such cases. To avoid corruption of the system, the IoT Box filesystem is read-only.</li>
			</ul>
			<h2 id="_idParaDest-1035"><a id="_idTextAnchor1282"/>There’s more…</h2>
			<p>Note that the IoT Box is only connected to the local machine. Consequently, you cannot access the shell directly from a remote location (through the internet). If you want to access the IoT Box remotely, you can paste the <code>ngrok</code> authentication token key into the IoT Box’s remote debug page, as shown in the following screenshot. This will enable the TCP tunnel <a id="_idIndexMarker1736"/>from the IoT Box so that you can connect the <a id="_idIndexMarker1737"/>IoT Box through SSH from anywhere. Learn <a id="_idIndexMarker1738"/>more about <code>ngrok</code> at <a href="https://ngrok.com/">https://ngrok.com/</a>:</p>
			<div><div><img src="img/B20997_24_020.jpg" alt="Figure 24.20 – Debugging with a ngrok token"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.20 – Debugging with a ngrok token</p>
			<p>Once you add your token, you will be able to access the IoT Box from remote locations.</p>
			<h1 id="_idParaDest-1036"><a id="_idTextAnchor1283"/>Configuring a POS</h1>
			<p>The IoT Box <a id="_idIndexMarker1739"/>works with POS applications. In this recipe, we will learn how to configure the IoT Box for POS applications.</p>
			<h2 id="_idParaDest-1037"><a id="_idTextAnchor1284"/>Getting ready</h2>
			<p>Make sure the IoT Box is on and you have connected the IoT Box to the same Wi-Fi network as the computer with the Odoo instance. Also, install the POS application if it is not already installed.</p>
			<h2 id="_idParaDest-1038"><a id="_idTextAnchor1285"/>How to do it…</h2>
			<p>Perform the following steps to configure the IoT Box for the POS application:</p>
			<ol>
				<li>Open the POS application, and open <strong class="bold">Settings</strong> from the POS session dropdown:</li>
			</ol>
			<div><div><img src="img/B20997_24_021.jpg" alt="Figure 24.21 – POS session settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.21 – POS session settings</p>
			<ol>
				<li value="2">Click on the <strong class="bold">Edit</strong> button <a id="_idIndexMarker1740"/>and click on the <strong class="bold">IoT Box</strong> checkbox. This will enable more options:</li>
			</ol>
			<div><div><img src="img/B20997_24_022.jpg" alt="Figure 24.22 – Selecting IoT devices"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.22 – Selecting IoT devices</p>
			<ol>
				<li value="3">Select the devices that you want to use in a POS session. If you are going to use hardware, such as a barcode scanner, select the relevant devices.</li>
				<li>Save the changes by clicking the <strong class="bold">Save</strong> button in the control panel.</li>
			</ol>
			<p>After the configuration, you will be able to use the IoT Box in the POS application.</p>
			<h2 id="_idParaDest-1039"><a id="_idTextAnchor1286"/>How it works…</h2>
			<p>The IoT Box can be used with POS applications such as the PosBox. In order to use the IoT Box in a POS application, you have to connect the IoT Box to the Odoo instance. If you don’t know how to connect the IoT Box, follow the <em class="italic">Adding the IoT Box to Odoo</em> recipe. Once you <a id="_idIndexMarker1741"/>have connected the IoT Box to Odoo, you will be able to select the IoT Box in the POS application, as shown in <em class="italic">step 2</em>.</p>
			<p>Here, you can select the hardware you want to use in the POS session. After saving the changes, if you open the POS session, you will be able to use the enabled hardware at the POS. If you enabled specific hardware from the settings but the hardware is not connected to the IoT Box, you will see the following warning in the top bar:</p>
			<div><div><img src="img/B20997_24_023.jpg" alt="Figure 24.23 – IoT Box connection issues"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.23 – IoT Box connection issues</p>
			<p>You can click on these warnings to try to connect again.</p>
			<h2 id="_idParaDest-1040"><a id="_idTextAnchor1287"/>There’s more…</h2>
			<p>The POS application is part of the Community Edition. If you are using the Community Edition, instead of the <strong class="bold">IoT Box</strong> selection, you will see the <strong class="bold">IoT Box IP Address</strong> field in the POS settings:</p>
			<div><div><img src="img/B20997_24_024.jpg" alt="Figure 24.24 – IoT Box settings in the Community Edition"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.24 – IoT Box settings in the Community Edition</p>
			<p>If you want to <a id="_idIndexMarker1742"/>integrate hardware in the Community Edition, you will need to use the IP address of the IoT Box in the field.</p>
			<h1 id="_idParaDest-1041"><a id="_idTextAnchor1288"/>Sending PDF reports directly to a printer</h1>
			<p>The IoT Box runs the <strong class="bold">Common UNIX Printing System</strong> (<strong class="bold">CUPS</strong>) server by default. CUPS is a printing <a id="_idIndexMarker1743"/>system that allows a computer to act as a printing server. You can learn more about it at <a href="https://www.cups.org/">https://www.cups.org/</a>. So, as the IoT Box runs CUPS internally, you can connect network printers with the IoT Box. In this recipe, we will see how you can print PDF reports directly from Odoo.</p>
			<h2 id="_idParaDest-1042"><a id="_idTextAnchor1289"/>Getting ready</h2>
			<p>Make sure the IoT Box is on and you have connected the IoT Box with Odoo.</p>
			<h2 id="_idParaDest-1043"><a id="_idTextAnchor1290"/>How to do it…</h2>
			<p>Follow these steps to print reports directly from Odoo:</p>
			<ol>
				<li>Open the IoT Box home page via IP.</li>
				<li>Click on the <strong class="bold">Printer Server</strong> button at the bottom.</li>
				<li>This will open the CUPS configuration home page. Configure your printer here.</li>
				<li>Once you have configured the printer, you will be able to see the printer in the IoT device list. Activate developer mode and open <strong class="bold">Settings</strong>| <strong class="bold">Technical</strong> | <strong class="bold">Actions</strong> | <strong class="bold">Report</strong>.</li>
				<li>Search for the report that you want to print, open the form view, and select the printer in the <strong class="bold">IoT Device</strong> field, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/B20997_24_025.jpg" alt="Figure 24.25 – Options to select an IoT device"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 24.25 – Options to select an IoT device</p>
			<p>Once this configuration is done, report PDFs will be sent directly to the printer.</p>
			<h2 id="_idParaDest-1044"><a id="_idTextAnchor1291"/>How it works…</h2>
			<p>This recipe is <a id="_idIndexMarker1744"/>straightforward in terms of configuration, but there are a few things that you should know. The IoT Box uses the CUPS server to print reports. You can access the CUPS home page at <code>http://&lt;IoT </code><code>Box IP&gt;:631</code>.</p>
			<p>With CUPS, you can add/remove your printer. On the home page of CUPS, you will be able to see all the documentation that you need to help you connect different types of printers. Once you have configured the printer, you will find your printer in the IoT device list. Then, you can select this IoT device (printer) in the report record. Usually, when you print a report in Odoo, it will download a PDF of the report. But when this configuration is done, instead of downloading the report, Odoo will send the PDF report directly to the selected printer. Note that only reports whose record has the printer set in the IoT device field will be sent to the printer.</p>
		</div>
	</body></html>