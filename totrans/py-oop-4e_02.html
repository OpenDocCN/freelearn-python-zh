<html><head></head><body>
  <div id="_idContainer040">
    <h1 class="chapterNumber">2</h1>
    <h1 id="_idParaDest-35" class="chapterTitle">Objects in Python</h1>
    <p class="normal">We have a design in hand and are ready to turn that design into a working program! Of course, it doesn't usually happen this way. We'll be seeing examples and hints for good software design throughout the book, but our focus is object-oriented programming. So, let's have a look at the Python syntax that allows us to create object-oriented software.</p>
    <p class="normal">After completing this chapter, we will understand the following:</p>
    <ul>
      <li class="bullet">Python's type hints</li>
      <li class="bullet">Creating classes and instantiating objects in Python</li>
      <li class="bullet">Organizing classes into packages and modules</li>
      <li class="bullet">How to suggest that people don't clobber an object's data, invalidating the internal state</li>
      <li class="bullet">Working with third-party packages available from the Python Package Index, PyPI</li>
    </ul>
    <p class="normal">This chapter will also continue our case study, moving into the design of some of the classes.</p>
    <h1 id="_idParaDest-36" class="title">Introducing type hints</h1>
    <p class="normal">Before we can look closely at creating classes, we need to talk a little bit about what a class is and <a id="_idIndexMarker086"/>how we're sure we're using it correctly. The central idea here is that everything in Python is an object.</p>
    <p class="normal">When we write literal values like <code class="Code-In-Text--PACKT-">"Hello, world!"</code> or <code class="Code-In-Text--PACKT-">42</code>, we're actually creating instances of built-in classes. We can fire up interactive Python and use the built-in <code class="Code-In-Text--PACKT-">type()</code> function on the class that defines the properties of these objects:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-built_in">type</span><span class="python">(</span><span class="hljs-con-string">"Hello, world!"</span><span class="python">)</span>
&lt;class 'str'&gt;
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-built_in">type</span><span class="python">(</span><span class="hljs-con-number">42</span><span class="python">)</span>
&lt;class 'int'&gt;
</code></pre>
    <p class="normal">The point of <em class="italic">object-oriented</em> programming is to solve a problem via the interactions of objects. When we write <code class="Code-In-Text--PACKT-">6*7</code>, the multiplication of the two objects is handled by a method of the built-in <code class="Code-In-Text--PACKT-">int</code> class. For more complex behaviors, we'll often need to write unique, new classes.</p>
    <p class="normal">Here are the first two core rules of how Python objects<a id="_idIndexMarker087"/> work:</p>
    <ul>
      <li class="bullet">Everything in Python is an object</li>
      <li class="bullet">Every object is defined by being an instance of at least one class</li>
    </ul>
    <p class="normal">These rules have many interesting consequences. A class definition we write, using the <code class="Code-In-Text--PACKT-">class</code> statement, creates a new object of class <code class="Code-In-Text--PACKT-">type</code>. When we create an <strong class="keyword">instance</strong> of a class, the class object will be used to create and initialize the instance object.</p>
    <p class="normal">What's the distinction <a id="_idIndexMarker088"/>between class<a id="_idIndexMarker089"/> and type? The <code class="Code-In-Text--PACKT-">class</code> statement lets us define new types. Because the <code class="Code-In-Text--PACKT-">class</code> statement is what we use, we'll call them classes throughout the text. See <em class="italic">Python objects, types, classes, and instances - a glossary</em> by Eli Bendersky: <a href="https://eli.thegreenplace.net/2012/03/30/python-objects-types-classes-and-instances-a-glossary"><span class="url">https://eli.thegreenplace.net/2012/03/30/python-objects-types-classes-and-instances-a-glossary</span></a> for this useful quote:</p>
    <blockquote class="packt_quote">"The terms "class" and "type" are an example of two names referring to the same concept." </blockquote>
    <p class="normal">We'll follow<a id="_idIndexMarker090"/> common usage and call the annotations <strong class="keyword">type hints</strong>.</p>
    <p class="normal">There's another important rule:</p>
    <ul>
      <li class="bullet">A variable is a reference to an object. Think of a yellow sticky note with a name scrawled on it, slapped on a thing.</li>
    </ul>
    <p class="normal">This doesn't seem too earth-shattering but it's actually pretty cool. It means the type information – what an object is – is defined by the class(es) associated with the object. This type information is not attached to the <em class="italic">variable</em> in any way. This leads to code like the following being valid but very confusing Python:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">a_string_variable = </span><span class="hljs-con-string">"Hello, world!"</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-built_in">type</span><span class="python">(a_string_variable)</span>
&lt;class 'str'&gt;
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">a_string_variable = </span><span class="hljs-con-number">42</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-built_in">type</span><span class="python">(a_string_variable)</span>
&lt;class 'int'&gt;
</code></pre>
    <p class="normal">We created an object using a built-in class, <code class="Code-In-Text--PACKT-">str</code>. We assigned a long name, <code class="Code-In-Text--PACKT-">a_string_variable</code>, to the object. Then, we created an object using a different built-in class, <code class="Code-In-Text--PACKT-">int</code>. We assigned this object the same name. (The previous string object has no more references and ceases to exist.)</p>
    <p class="normal">Here are the<a id="_idIndexMarker091"/> two steps, shown side by side, showing how the variable is moved from object to object: </p>
    <figure class="mediaobject"><img src="../Images/B17070_02_01.png" alt="Diagram  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 2.1: Variable names and objects</p>
    <p class="normal">The various properties are part of the object, not the variable. When we check the type of a variable with <code class="Code-In-Text--PACKT-">type()</code>, we see the type of the object the variable currently references. The variable doesn't have a type of its own; it's nothing more than a name. Similarly, asking for the <code class="Code-In-Text--PACKT-">id()</code> of a variable shows the ID of the object the variable refers to. So obviously, the name <code class="Code-In-Text--PACKT-">a_string_variable</code> is a bit misleading if we assign the name to an integer object.</p>
    <h2 id="_idParaDest-37" class="title">Type checking</h2>
    <p class="normal">Let's push the <a id="_idIndexMarker092"/>relationship between object and type a step further, and look at some more consequences of these rules. Here's a function definition:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">def</span><span class="hljs-con-function"> </span><span class="hljs-con-title">odd</span><span class="hljs-con-function">(</span><span class="hljs-con-params">n</span><span class="hljs-con-function">):</span>
<span class="hljs-con-meta">...</span> <span class="python">    </span><span class="hljs-con-keyword">return</span><span class="python"> n % </span><span class="hljs-con-number">2</span><span class="python"> != </span><span class="hljs-con-number">0</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">odd(</span><span class="hljs-con-number">3</span><span class="python">)</span>
True
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">odd(</span><span class="hljs-con-number">4</span><span class="python">)</span>
False
</code></pre>
    <p class="normal">This function does a little computation on a parameter variable, <code class="Code-In-Text--PACKT-">n</code>. It computes the remainder after division, the modulo. If we divide an odd number by two, we'll have one left over. If we divide an even number by two, we'll have zero left over. This function returns a true value for all odd numbers.</p>
    <p class="normal">What happens when we fail to provide a number? Well, let's just try it and see (a common way to learn Python!). Entering code at the interactive prompt, we'll get something like this:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">odd(</span><span class="hljs-con-string">"Hello, world!"</span><span class="python">)</span>
Traceback (most recent call last):
  File "&lt;doctestexamples.md[9]&gt;", line 1, in &lt;module&gt;
odd("Hello, world!")
  File "&lt;doctestexamples.md[6]&gt;", line 2, in odd
    return n % 2 != 0
TypeError: not all arguments converted during string formatting
</code></pre>
    <p class="normal">This is an important consequence of Python's super-flexible rules: nothing prevents us from doing something silly that may raise an exception. This is an important tip:</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">Python doesn't prevent us from attempting to use non-existent methods of objects.</p>
    </div>
    <p class="normal">In our example, the <code class="Code-In-Text--PACKT-">%</code> operator provided by the <code class="Code-In-Text--PACKT-">str</code> class doesn't work the same way as the <code class="Code-In-Text--PACKT-">%</code> operator provided by the <code class="Code-In-Text--PACKT-">int</code> class, raising an exception. For strings, the <code class="Code-In-Text--PACKT-">%</code> operator isn't used very often, but it does interpolation: <code class="Code-In-Text--PACKT-">"a=%d" % 113</code> computes a string <code class="Code-In-Text--PACKT-">'a=113'</code>; if there's no format specification like <code class="Code-In-Text--PACKT-">%d</code> on the left side, the exception is a <code class="Code-In-Text--PACKT-">TypeError</code>. For integers, it's the remainder in division: <code class="Code-In-Text--PACKT-">355 % 113</code> returns an integer, <code class="Code-In-Text--PACKT-">16</code>.</p>
    <p class="normal">This flexibility reflects an explicit trade-off favoring ease of use over sophisticated prevention of potential problems. This allows a person to use a variable name with little mental overhead.</p>
    <p class="normal">Python's internal operators check that operands meet the requirements of the operator. The function definition we wrote, however, does not include any runtime type checking. Nor do we want to add code for runtime type checking. Instead, we use tools to examine code as part of testing. We can provide annotations, called <strong class="keyword">type hints</strong>, and use tools to examine our code for <a id="_idIndexMarker093"/>consistency among the type hints.</p>
    <p class="normal">First, we'll look <a id="_idIndexMarker094"/>at the annotations. In a few contexts, we can follow a variable name with a colon, <code class="Code-In-Text--PACKT-">:</code>, and a type name. We can do this in the parameters to functions (and methods). We can also do this in assignment statements. Further, we can also add <code class="Code-In-Text--PACKT-">-&gt;</code> syntax to a function (or a class method) definition to explain the expected return type.</p>
    <p class="normal">Here's how type hints look:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">def</span><span class="hljs-con-function"> </span><span class="hljs-con-title">odd</span><span class="hljs-con-function">(</span><span class="hljs-con-params">n: </span><span class="hljs-con-built_in">int</span><span class="hljs-con-function">) -&gt; bool:</span>
<span class="hljs-con-meta">...</span> <span class="python">    </span><span class="hljs-con-keyword">return</span><span class="python"> n % </span><span class="hljs-con-number">2</span><span class="python"> != </span><span class="hljs-con-number">0</span>
</code></pre>
    <p class="normal">We've added two type hints to our <code class="Code-In-Text--PACKT-">odd()</code> little function definition. We've specified that argument values for the <code class="Code-In-Text--PACKT-">n</code> parameter should be integers. We've also specified that the result will be one of the two values of the Boolean type.</p>
    <p class="normal">While the hints consume some storage, they have no runtime impact. Python politely ignores these hints; this means they're optional. People reading your code, however, will be more than delighted to see them. They are a great way to inform the reader of your intent. You can omit them while you're learning, but you'll love them when you go back to expand something you wrote earlier.</p>
    <p class="normal">The <strong class="" style="font-style: italic;">mypy</strong> tool is <a id="_idIndexMarker095"/>commonly used to check the hints for consistency. It's not built into Python, and requires a separate download and install. We'll talk about virtual environments and installation of tools later in this chapter, in the <em class="italic">Third-party libraries</em> section. For now, you <a id="_idIndexMarker096"/>can use <code class="Code-In-Text--PACKT-">python -m pip install mypy</code> or <code class="Code-In-Text--PACKT-">conda install mypy</code> if you're using <strong class="" style="font-style: italic;">the conda tool</strong>.</p>
    <p class="normal">Let's say we had a file, <code class="Code-In-Text--PACKT-">bad_hints.py</code>, in a <code class="Code-In-Text--PACKT-">src</code> directory, with these two functions and a few lines to call the <code class="Code-In-Text--PACKT-">main()</code> function: </p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-title">odd</span><span class="hljs-function">(</span><span class="hljs-params">n:</span> <span class="hljs-built_in">int</span><span class="hljs-function">) -&gt; bool:</span>
    <span class="hljs-keyword">return</span> n % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>
<span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-function">():</span>
    print(odd(<span class="hljs-string">"Hello, world!"</span>))
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
    <p class="normal">When we run the <code class="Code-In-Text--PACKT-">mypy</code> command at the OS's terminal prompt:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">%</span><span class="bash"> mypy –strict src/bad_hints.py</span>
</code></pre>
    <p class="normal">The <strong class="" style="font-style: italic;">mypy</strong> tool is<a id="_idIndexMarker097"/> going to spot a bunch of potential problems, including at<a id="_idIndexMarker098"/> least these:</p>
    <pre class="programlisting con"><code class="hljs-con">src/bad_hints.py:12: error: Function is missing a return type annotation
src/bad_hints.py:12: note: Use "-&gt; None" if function does not return a value
src/bad_hints.py:13: error: Argument 1 to "odd" has incompatible type "str"; expected "int"
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">def main():</code> statement is on <em class="italic">line 12</em> of our example because our file has a pile of comments not shown above. For your version, the error might be on <em class="italic">line 1</em>. Here are the two problems:</p>
    <ul>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">main()</code> function doesn't have a return type; <strong class="" style="font-style: italic;">mypy</strong> suggests including <code class="Code-In-Text--PACKT-">-&gt; None</code> to make the absence of a return value perfectly explicit. </li>
      <li class="bullet">More important is <em class="italic">line 13</em>: the code will try to evaluate the <code class="Code-In-Text--PACKT-">odd()</code> function using a <code class="Code-In-Text--PACKT-">str</code> value. This doesn't match the type hint for <code class="Code-In-Text--PACKT-">odd()</code> and indicates another possible error.</li>
    </ul>
    <p class="normal">Most of the examples in this book will have type hints. We think they're always helpful, especially in a pedagogical context, even though they're optional. Because most of Python is generic with respect to type, there are a few cases where Python behavior is difficult to describe via a succinct, expressive hint. We'll steer clear of these edge cases in this book.</p>
    <p class="normal">Python Enhancement Proposal (PEP) 585 covers some new language features to make type hints a bit simpler. We've used <strong class="" style="font-style: italic;">mypy</strong> version 0.812 to test all of the examples in this book. Any older version will encounter problems with some of the newer syntax and annotation techniques.</p>
    <p class="normal">Now that we've talked about how parameters and attributes are described with type hints, let's actually build some classes.</p>
    <h1 id="_idParaDest-38" class="title">Creating Python classes</h1>
    <p class="normal">We don't have <a id="_idIndexMarker099"/>to write much Python code to realize that Python is a very <em class="italic">clean</em> language. When we want to do something, we can just do it, without having to set up a bunch of prerequisite code. The ubiquitous <em class="italic">hello world</em> in Python, as you've likely seen, is only one line.</p>
    <p class="normal">Similarly, the simplest class in Python 3 looks like this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">MyFirstClass</span><span class="hljs-class">:</span> 
    <span class="hljs-keyword">pass</span> 
</code></pre>
    <p class="normal">There's our first object-oriented program! The class definition starts with the <code class="Code-In-Text--PACKT-">class</code> keyword. This is followed by a name (of our choice) identifying the class and is terminated with a colon.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">The class name must follow standard Python variable naming rules (it must start with a letter or underscore, and can only be comprised of letters, underscores, or numbers). In addition, the Python style guide (search the web for <em class="italic">PEP 8</em>) recommends that <a id="_idIndexMarker100"/>classes should be named using what PEP 8 calls <strong class="keyword">CapWords</strong> notation (start with a capital letter; any subsequent words should also start with a capital).</p>
    </div>
    <p class="normal">The class definition line is followed by the class contents, indented. As with other Python constructs, indentation is used to delimit the classes, rather than braces, keywords, or brackets, as many other languages use. Also, in line with the style guide, use four spaces for indentation unless you have a compelling reason not to (such as fitting in with somebody else's code that uses tabs for indents).</p>
    <p class="normal">Since our first class doesn't actually add any data or behaviors, we simply use the <code class="Code-In-Text--PACKT-">pass</code> keyword on the second line as a placeholder to indicate that no further action needs to be taken.</p>
    <p class="normal">We might think there isn't much we can do with this most basic class, but it does allow us to instantiate objects of that class. We can load the class into the Python 3 interpreter, so we can interactively play with it. To do this, save the class definition mentioned earlier in a file named <code class="Code-In-Text--PACKT-">first_class.py</code> and then run the <code class="Code-In-Text--PACKT-">python -i first_class.py</code> command. The <code class="Code-In-Text--PACKT-">-i</code> argument tells Python to <em class="italic">run the code and then drop to the interactive interpreter</em>. The following interpreter session demonstrates a basic interaction with this class:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">a = MyFirstClass()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">b = MyFirstClass()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(a)</span>
&lt;__main__.MyFirstClass object at 0xb7b7faec&gt;
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(b)</span>
&lt;__main__.MyFirstClass object at 0xb7b7fbac&gt;
</code></pre>
    <p class="normal">This code instantiates two objects from the new class, assigning the object variable names <code class="Code-In-Text--PACKT-">a</code> and <code class="Code-In-Text--PACKT-">b</code>. Creating <a id="_idIndexMarker101"/>an instance of a class is a matter of typing the class name, followed by a pair of parentheses. It looks much like a function call; <strong class="keyword">calling</strong> a class will create a new object. When printed, the two objects tell us which class they are and what memory address they live at. Memory addresses aren't used much in Python code, but here, they demonstrate that there are two distinct objects involved.</p>
    <p class="normal">We can see they're distinct objects by using the <code class="Code-In-Text--PACKT-">is</code> operator:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">a </span><span class="hljs-con-keyword">is</span><span class="python"> b</span>
False
</code></pre>
    <p class="normal">This can help reduce confusion when we've created a bunch of objects and assigned different variable names to the objects.</p>
    <h2 id="_idParaDest-39" class="title">Adding attributes</h2>
    <p class="normal">Now, we have <a id="_idIndexMarker102"/>a basic class, but it's fairly useless. It doesn't contain any data, and it doesn't do anything. What do we have to do to assign an attribute to a given object?</p>
    <p class="normal">In fact, we don't have to do anything special in the class definition to be able to add attributes. We can set arbitrary attributes on an instantiated object using dot notation. Here's an example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span> 
    <span class="hljs-keyword">pass</span> 
p1 = Point() 
p2 = Point() 
p1.x = <span class="hljs-number">5</span> 
p1.y = <span class="hljs-number">4</span> 
p2.x = <span class="hljs-number">3</span> 
p2.y = <span class="hljs-number">6</span> 
print(p1.x, p1.y) 
print(p2.x, p2.y) 
</code></pre>
    <p class="normal">If we run this code, the two <code class="Code-In-Text--PACKT-">print</code> statements at the end tell us the new attribute values on the two objects:</p>
    <pre class="programlisting con"><code class="hljs-con">5 4
3 6
</code></pre>
    <p class="normal">This code creates an empty <code class="Code-In-Text--PACKT-">Point</code> class with no data or behaviors. Then, it creates two instances of that class and assigns each of those instances <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code> coordinates to identify a point in two dimensions. All we need to do to assign a value to an attribute on an object is<a id="_idIndexMarker103"/> use the <code class="Code-In-Text--PACKT-">&lt;object&gt;.&lt;attribute&gt; = &lt;value&gt;</code> syntax. This is sometimes<a id="_idIndexMarker104"/> referred to as <strong class="keyword">dot notation</strong>. The value can be anything: a Python primitive, a built-in data type, or another object. It can even be a function or another class!</p>
    <p class="normal">Creating attributes like this is confusing to the <strong class="" style="font-style: italic;">mypy</strong> tool. There's no easy way to include the hints in the <code class="Code-In-Text--PACKT-">Point</code> class definition. We can include hints on the assignment statements, like this: <code class="Code-In-Text--PACKT-">p1.x: float = 5</code>. In general, there's a much, much better approach to type hints and attributes that we'll examine in the <em class="italic">Initializing the object</em> section, later in this chapter. First, though, we'll add behaviors to our class definition.</p>
    <h2 id="_idParaDest-40" class="title">Making it do something</h2>
    <p class="normal">Now, having objects with attributes is great, but object-oriented programming is really about the interaction between objects. We're interested in invoking actions that cause things to happen to <a id="_idIndexMarker105"/>those attributes. We have data; now it's time to add behaviors to our classes.</p>
    <p class="normal">Let's model a couple of actions on our <code class="Code-In-Text--PACKT-">Point</code> class. We can start with a <strong class="keyword">method</strong> called <code class="Code-In-Text--PACKT-">reset</code>, which moves the point to the origin (the origin is the place where <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code> are both zero). This is a good introductory action because it doesn't require any parameters:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span> 
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">reset</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">):</span> 
        self.x = <span class="hljs-number">0</span> 
        self.y = <span class="hljs-number">0</span> 
p = Point() 
p.reset() 
print(p.x, p.y) 
</code></pre>
    <p class="normal">This <code class="Code-In-Text--PACKT-">print</code> statement shows us the two zeros on the attributes:</p>
    <pre class="programlisting con"><code class="hljs-con">0 0
</code></pre>
    <p class="normal">In Python, a method is <a id="_idIndexMarker106"/>formatted identically to a function. It starts with the <code class="Code-In-Text--PACKT-">def</code> keyword, followed by a space, and the name of the method. This is followed by a set of parentheses containing the parameter list (we'll discuss that <code class="Code-In-Text--PACKT-">self</code> parameter, sometimes called the instance variable, in just a moment), and terminated with a colon. The next line is indented to contain the statements inside the method. These statements can be arbitrary Python code operating on the object itself and any parameters passed in, as the method sees fit.</p>
    <p class="normal">We've omitted type hints in the <code class="Code-In-Text--PACKT-">reset()</code> method because it's not the most widely used place for hints. We'll look at the best place for hints in the <em class="italic">Initializing the object</em> section. We'll look a little more at these instance variables, first, and how the <code class="Code-In-Text--PACKT-">self</code> variable works.</p>
    <h3 id="_idParaDest-41" class="title">Talking to yourself</h3>
    <p class="normal">The one difference, syntactically, between methods of classes and functions outside classes is that methods have one required argument. This argument is conventionally named <code class="Code-In-Text--PACKT-">self</code>; I've never seen a Python programmer use any other name for this variable (convention is a very powerful thing). There's nothing technically stopping you, however, from calling it <code class="Code-In-Text--PACKT-">this</code> or even <code class="Code-In-Text--PACKT-">Martha</code>, but it's best to acknowledge the social pressure of the Python community codified in PEP 8 and stick with <code class="Code-In-Text--PACKT-">self</code>.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">self</code> argument<a id="_idIndexMarker107"/> to a method is a reference to the object that the method is being invoked on. The object is an instance of a class, and this is sometimes called the instance variable. </p>
    <p class="normal">We can access attributes and methods of that object via this variable. This is exactly what we do inside the <code class="Code-In-Text--PACKT-">reset</code> method when we set the <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code> attributes of the <code class="Code-In-Text--PACKT-">self</code> object.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">Pay<a id="_idIndexMarker108"/> attention to the difference between a <strong class="keyword">class</strong> and an <strong class="keyword">object</strong> in this discussion. We can think of the <strong class="keyword">method</strong> as a function attached to a class. The <code class="Code-In-Text--PACKT-">self</code> parameter refers to a <a id="_idIndexMarker109"/>specific instance of the class. When you<a id="_idIndexMarker110"/> call the method on two different objects, you are calling the same method twice, but passing two different <strong class="keyword">objects</strong> as the <code class="Code-In-Text--PACKT-">self</code> parameter.</p>
    </div>
    <p class="normal">Notice that when we call the <code class="Code-In-Text--PACKT-">p.reset()</code> method, we do not explicitly pass the <code class="Code-In-Text--PACKT-">self</code> argument into it. Python automatically takes care of this part for us. It knows we're calling a method on the <code class="Code-In-Text--PACKT-">p</code> object, so it automatically passes that object, <code class="Code-In-Text--PACKT-">p</code>, to the method of the class, <code class="Code-In-Text--PACKT-">Point</code>.</p>
    <p class="normal">For some, it can help to think of a method as a function that happens to be part of a class. Instead of calling the method on the object, we could invoke the function as defined in the class, explicitly passing our object as the <code class="Code-In-Text--PACKT-">self</code> argument:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">p = Point() </span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">Point.reset(p) </span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(p.x, p.y)</span>
</code></pre>
    <p class="normal">The output is the same as in the previous example because, internally, the exact same process has occurred. This is not really a good programming practice, but it can help to cement your understanding of the <code class="Code-In-Text--PACKT-">self</code> argument.</p>
    <p class="normal">What happens if we <a id="_idIndexMarker111"/>forget to include the <code class="Code-In-Text--PACKT-">self</code> argument in our class definition? Python will bail with an error message, as follows:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">class</span><span class="hljs-con-class"> </span><span class="hljs-con-title">Point</span><span class="hljs-con-class">:</span>
<span class="hljs-con-meta">...</span> <span class="python">    </span><span class="hljs-con-keyword">def</span><span class="hljs-con-function"> </span><span class="hljs-con-title">reset</span><span class="hljs-con-function">():</span>
<span class="hljs-con-meta">...</span> <span class="python">        </span><span class="hljs-con-keyword">pass</span>
<span class="hljs-con-meta">...</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">p = Point()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">p.reset()</span>
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: reset() takes 0 positional arguments but 1 was given
</code></pre>
    <p class="normal">The error message is not as clear as it could be ("Hey, silly, you forgot to define the method with a <code class="Code-In-Text--PACKT-">self</code> parameter" could be more informative). Just remember that when you see an error message that indicates missing arguments, the first thing to check is whether you forgot the <code class="Code-In-Text--PACKT-">self</code> parameter in the method definition.</p>
    <h3 id="_idParaDest-42" class="title">More arguments</h3>
    <p class="normal">How do we pass multiple arguments<a id="_idIndexMarker112"/> to a method? Let's add a new method that allows us to move a point to an arbitrary position, not just to the origin. We can also include a method that accepts another <code class="Code-In-Text--PACKT-">Point</code> object as input and returns the distance between them:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">move</span><span class="hljs-function">(</span><span class="hljs-params">self, x: </span><span class="hljs-built_in">float</span><span class="hljs-params">, y: </span><span class="hljs-built_in">float</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.x = x
        self.y = y
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">reset</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.move(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">calculate_distance</span><span class="hljs-function">(</span><span class="hljs-params">self, other: </span><span class="hljs-string">"Point"</span><span class="hljs-function">) -&gt; float:</span>
        <span class="hljs-keyword">return</span> math.hypot(self.x - other.x, self.y - other.y)
</code></pre>
    <p class="normal">We've defined a class with two attributes, <code class="Code-In-Text--PACKT-">x</code>, and <code class="Code-In-Text--PACKT-">y</code>, and three separate methods, <code class="Code-In-Text--PACKT-">move()</code>, <code class="Code-In-Text--PACKT-">reset()</code>, and <code class="Code-In-Text--PACKT-">calculate_distance()</code>.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">move()</code> method<a id="_idIndexMarker113"/> accepts two arguments, <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code>, and sets the values on the <code class="Code-In-Text--PACKT-">self</code> object. The <code class="Code-In-Text--PACKT-">reset()</code> method calls the <code class="Code-In-Text--PACKT-">move()</code> method, since a reset is just a move to a specific known location.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">calculate_distance()</code> method computes the Euclidean distance between two points. (There are a number of other ways to look at distance. In the <em class="chapterRef">Chapter 3</em>, <em class="italic">When Objects Are Alike</em>, case study, we'll look at some alternatives.) For now, we hope you understand the math. The definition is <img src="../Images/B17070_02_001.png" alt="" style="height: 1.5em;"/>, which is the <code class="Code-In-Text--PACKT-">math.hypot()</code> function. In Python we'll use <code class="Code-In-Text--PACKT-">self.x</code>, but mathematicians often prefer to write <img src="../Images/B17070_02_002.png" alt="" style="height: 0.8em;"/>.</p>
    <p class="normal">Here's an example of using this class definition. This shows how to call a method with arguments: include the arguments inside the parentheses and use the same dot notation to access the method name within the instance. We just picked some random positions to test the methods. The test code calls each method and prints the results on the console:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point1 = Point()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point2 = Point()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point1.reset()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point2.move(</span><span class="hljs-con-number">5</span><span class="python">, </span><span class="hljs-con-number">0</span><span class="python">)</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(point2.calculate_distance(point1))</span>
5.0
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">assert</span><span class="python"> point2.calculate_distance(point1) == point1.calculate_distance(</span>
<span class="hljs-con-meta">...</span> <span class="python">   point2</span>
<span class="hljs-con-meta">...</span> <span class="python">)</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point1.move(</span><span class="hljs-con-number">3</span><span class="python">, </span><span class="hljs-con-number">4</span><span class="python">)</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(point1.calculate_distance(point2))</span>
4.47213595499958
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(point1.calculate_distance(point1))</span>
0.0
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">assert</code> statement<a id="_idIndexMarker114"/> is a marvelous test tool; the program will bail if the expression after <code class="Code-In-Text--PACKT-">assert</code> evaluates to <code class="Code-In-Text--PACKT-">False</code> (or zero, empty, or <code class="Code-In-Text--PACKT-">None</code>). In this case, we use it to ensure that the distance is the same regardless of which point called the other point's <code class="Code-In-Text--PACKT-">calculate_distance()</code> method. We'll see a lot more use of <code class="Code-In-Text--PACKT-">assert</code> in <em class="chapterRef">Chapter 13</em>, <em class="italic">Testing Object-Oriented Programs</em>, where we'll write more rigorous tests.</p>
    <h2 id="_idParaDest-43" class="title">Initializing the object</h2>
    <p class="normal">If we don't explicitly<a id="_idIndexMarker115"/> set the <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code> positions on our <code class="Code-In-Text--PACKT-">Point</code> object, either using <code class="Code-In-Text--PACKT-">move</code> or by accessing them directly, we'll have a broken <code class="Code-In-Text--PACKT-">Point</code> object with no real position. What will happen when we try to access it?</p>
    <p class="normal">Well, let's just try it and see. <em class="italic">Try it and see</em> is an extremely useful tool for Python study. Open up your interactive interpreter and type away. (Using the interactive prompt is, after all, one of the tools we used to write this book.)</p>
    <p class="normal">The following interactive session shows what happens if we try to access a missing attribute. If you saved the previous example as a file or are using the examples distributed with the book, you can load it into the Python interpreter with the <code class="Code-In-Text--PACKT-">python -i more_arguments.py</code> command:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point = Point()</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">point.x = </span><span class="hljs-con-number">5</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(point.x)</span>
5
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(point.y)</span>
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
AttributeError: 'Point' object has no attribute 'y'
</code></pre>
    <p class="normal">Well, at least it threw a useful exception. We'll cover exceptions in detail in <em class="chapterRef">Chapter 4</em>, <em class="italic">Expecting the Unexpected</em>. You've probably seen them before (especially the ubiquitous <code class="Code-In-Text--PACKT-">SyntaxError</code>, which means you typed something incorrectly!). At this point, simply be aware that it means something went wrong.</p>
    <p class="normal">The output<a id="_idIndexMarker116"/> is useful for debugging. In the interactive interpreter, it tells us the error occurred at <em class="italic">line 1</em>, which is only partially true (in an interactive session, only one statement is executed at a time). If we were running a script in a file, it would tell us the exact line number, making it easy to find the offending code. In addition, it tells us that the error is an <code class="Code-In-Text--PACKT-">AttributeError</code>, and gives a helpful message telling us what that error means.</p>
    <p class="normal">We can catch and recover from this error, but in this case, it feels like we should have specified some sort of default value. Perhaps every new object should be <code class="Code-In-Text--PACKT-">reset()</code> by default, or maybe it would be nice if we could force the user to tell us what those positions should be when they create the object.</p>
    <p class="normal">Interestingly, <strong class="" style="font-style: italic;">mypy</strong> can't determine whether <code class="Code-In-Text--PACKT-">y</code> is supposed to be an attribute of a <code class="Code-In-Text--PACKT-">Point</code> object. Attributes are – by definition – dynamic, so there's no simple list that's part of a class definition. However, Python has some widely followed conventions that can help name the expected set of attributes.</p>
    <p class="normal">Most object-oriented programming languages <a id="_idIndexMarker117"/>have the concept of a <strong class="keyword">constructor</strong>, a special method that creates and initializes the object when it is created. Python is a little different; it has a constructor and an initializer. The constructor method, <code class="Code-In-Text--PACKT-">__new__()</code>, is rarely used unless you're doing something very exotic. So, we'll start our discussion with the much more common initialization method, <code class="Code-In-Text--PACKT-">__init__()</code>.</p>
    <p class="normal">The Python initialization method is the same as any other method, except it has a special name, <code class="Code-In-Text--PACKT-">__init__</code>. The leading and trailing double underscores mean this is a special method that the Python interpreter will treat as a special case.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">Never name a method of your own with leading and trailing double underscores. It may mean nothing to Python today, but there's always the possibility that the designers of Python will add a function that has a special purpose with that name in the future. When they do, your code will break.</p>
    </div>
    <p class="normal">Let's add an initialization function on our <code class="Code-In-Text--PACKT-">Point</code> class that requires the user to supply <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code> coordinates when the <code class="Code-In-Text--PACKT-">Point</code> object is instantiated:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span><span class="hljs-params">self, x: </span><span class="hljs-built_in">float</span><span class="hljs-params">, y: </span><span class="hljs-built_in">float</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.move(x, y)
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">move</span><span class="hljs-function">(</span><span class="hljs-params">self, x: </span><span class="hljs-built_in">float</span><span class="hljs-params">, y: </span><span class="hljs-built_in">float</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.x = x
        self.y = y
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">reset</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.move(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">calculate_distance</span><span class="hljs-function">(</span><span class="hljs-params">self, other: </span><span class="hljs-string">"Point"</span><span class="hljs-function">) -&gt; float:</span>
        <span class="hljs-keyword">return</span> math.hypot(self.x - other.x, self.y - other.y)
</code></pre>
    <p class="normal">Constructing a <code class="Code-In-Text--PACKT-">Point</code> instance now looks like this:</p>
    <pre class="programlisting code"><code class="hljs-code">point = Point(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>) 
print(point.x, point.y) 
</code></pre>
    <p class="normal">Now, our <code class="Code-In-Text--PACKT-">Point</code> object can never go without both <code class="Code-In-Text--PACKT-">x</code> and <code class="Code-In-Text--PACKT-">y</code> coordinates! If we try to construct a <code class="Code-In-Text--PACKT-">Point</code> instance without including the proper initialization parameters, it will fail with a <code class="Code-In-Text--PACKT-">not enough arguments</code> error similar to the one we received earlier when we forgot the <code class="Code-In-Text--PACKT-">self</code> argument in a method definition.</p>
    <p class="normal">Most of the<a id="_idIndexMarker118"/> time, we put our initialization statements in an <code class="Code-In-Text--PACKT-">__init__()</code> function. It's very important to be sure that all of the attributes are initialized in the <code class="Code-In-Text--PACKT-">__init__() </code>method. Doing this helps the <strong class="" style="font-style: italic;">mypy</strong> tool by providing all of the attributes in one obvious place. It helps people reading your code, also; it saves them from having to read the whole application to find mysterious attributes set outside the class definition.</p>
    <p class="normal">While they're optional, it's generally helpful to include type annotations on the method parameters and result values. After each parameter name, we've included the expected type of each value. At the end of the definition, we've included the two-character <code class="Code-In-Text--PACKT-">-&gt;</code> operator and the type returned by the method.</p>
    <h2 id="_idParaDest-44" class="title">Type hints and defaults</h2>
    <p class="normal">As we've noted a few times now, hints are optional. They don't do anything at runtime. There are tools, however, that can examine the hints to check for consistency. The <strong class="" style="font-style: italic;">mypy</strong> tool is widely used to check <a id="_idIndexMarker119"/>type hints.</p>
    <p class="normal">If we don't want to make the two arguments required, we can use the same syntax Python functions use to provide default arguments. The keyword argument syntax appends an equals sign after each variable name. If the calling object does not provide this argument, then the default argument is used instead. The variables will still be available to the function, but they will have the values specified in the argument list. Here's an example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span><span class="hljs-params">self, x: </span><span class="hljs-built_in">float</span><span class="hljs-params"> = </span><span class="hljs-number">0</span><span class="hljs-params">, y: </span><span class="hljs-built_in">float</span><span class="hljs-params"> = </span><span class="hljs-number">0</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.move(x, y)
</code></pre>
    <p class="normal">The definitions for the individual parameters can get long, leading to very long lines of code. In some examples, you'll see this single logical line of code expanded to multiple physical lines. This relies on the way Python combines physical lines to match <code class="Code-In-Text--PACKT-">()</code>'s. We might write this when the line gets long:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span>
<span class="hljs-params">        self, </span>
<span class="hljs-params">        x: </span><span class="hljs-built_in">float</span><span class="hljs-params"> = </span><span class="hljs-number">0</span><span class="hljs-params">, </span>
<span class="hljs-params">        y: </span><span class="hljs-built_in">float</span><span class="hljs-params"> = </span><span class="hljs-number">0</span>
<span class="hljs-params">    </span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.move(x, y)
</code></pre>
    <p class="normal">This style isn't used very often, but it's valid and keeps the lines shorter and easier to read.</p>
    <p class="normal">The type hints<a id="_idIndexMarker120"/> and defaults<a id="_idIndexMarker121"/> are handy, but there's even more we can do to provide a class that's easy to use and easy to extend when new requirements arise. We'll add documentation in the form of docstrings.</p>
    <h2 id="_idParaDest-45" class="title">Explaining yourself with docstrings</h2>
    <p class="normal">Python can be an extremely easy-to-read programming language; some might say it is self-documenting. However, when carrying out object-oriented programming, it is important to write API documentation that clearly summarizes what each object and method does. Keeping documentation up to date is difficult; the best way to do it is to write it right into our code.</p>
    <p class="normal">Python supports this through <a id="_idIndexMarker122"/>the use of <strong class="keyword">docstrings</strong>. Each class, function, or method header can have a standard Python string as the first indented line inside the definition (the line that ends in a colon).</p>
    <p class="normal">Docstrings are Python strings enclosed within apostrophes (<code class="Code-In-Text--PACKT-">'</code>) or quotation marks (<code class="Code-In-Text--PACKT-">"</code>). Often, docstrings are quite long and span multiple lines (the style guide suggests that the line length should not exceed 80 characters), which can be formatted as multi-line strings, enclosed in matching triple apostrophe (<code class="Code-In-Text--PACKT-">'''</code>) or triple quote (<code class="Code-In-Text--PACKT-">"""</code>) characters.</p>
    <p class="normal">A docstring <a id="_idIndexMarker123"/>should clearly and concisely summarize the purpose of the class or method it is describing. It should explain any parameters whose usage is not immediately obvious, and is also a good place to include short examples of how to use the API. Any caveats or problems an unsuspecting user of the API should be aware of should also be noted.</p>
    <p class="normal">One of the best things to include in a docstring is a concrete example. Tools like <strong class="keyword">doctest</strong> can locate and confirm these<a id="_idIndexMarker124"/> examples are correct. All the examples in this book are checked with the doctest tool.</p>
    <p class="normal">To illustrate the use of docstrings, we will end this section with our completely documented <code class="Code-In-Text--PACKT-">Point</code> class:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span>
    <span class="hljs-string">"""</span>
<span class="hljs-string">    Represents a point in two-dimensional geometric coordinates</span>
<span class="hljs-string">    &gt;&gt;&gt; p_0 = Point()</span>
<span class="hljs-string">    &gt;&gt;&gt; p_1 = Point(3, 4)</span>
<span class="hljs-string">    &gt;&gt;&gt; p_0.calculate_distance(p_1)</span>
<span class="hljs-string">    5.0</span>
<span class="hljs-string">    """</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span><span class="hljs-params">self, x: </span><span class="hljs-built_in">float</span><span class="hljs-params"> = </span><span class="hljs-number">0</span><span class="hljs-params">, y: </span><span class="hljs-built_in">float</span><span class="hljs-params"> = </span><span class="hljs-number">0</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        <span class="hljs-string">"""</span>
<span class="hljs-string">        Initialize the position of a new point. The x and y</span>
<span class="hljs-string">        coordinates can be specified. If they are not, the</span>
<span class="hljs-string">        point defaults to the origin.</span>
<span class="hljs-string">        :param x: float x-coordinate</span>
<span class="hljs-string">        :param y: float x-coordinate</span>
<span class="hljs-string">        """</span>
        self.move(x, y)
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">move</span><span class="hljs-function">(</span><span class="hljs-params">self, x: </span><span class="hljs-built_in">float</span><span class="hljs-params">, y: </span><span class="hljs-built_in">float</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        <span class="hljs-string">"""</span>
<span class="hljs-string">        Move the point to a new location in 2D space.</span>
<span class="hljs-string">        :param x: float x-coordinate</span>
<span class="hljs-string">        :param y: float x-coordinate</span>
<span class="hljs-string">        """</span>
        self.x = x
        self.y = y
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">reset</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        <span class="hljs-string">"""</span>
<span class="hljs-string">        Reset the point back to the geometric origin: 0, 0</span>
<span class="hljs-string">        """</span>
        self.move(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">calculate_distance</span><span class="hljs-function">(</span><span class="hljs-params">self, other: </span><span class="hljs-string">"Point"</span><span class="hljs-function">) -&gt; float:</span>
        <span class="hljs-string">"""</span>
<span class="hljs-string">        Calculate the Euclidean distance from this point </span>
<span class="hljs-string">        to a second point passed as a parameter.</span>
<span class="hljs-string">        :param other: Point instance</span>
<span class="hljs-string">        :return: float distance</span>
<span class="hljs-string">        """</span>
        <span class="hljs-keyword">return</span> math.hypot(self.x - other.x, self.y - other.y)
</code></pre>
    <p class="normal">Try typing or loading (remember, it's <code class="Code-In-Text--PACKT-">python -i point.py</code>) this file into the interactive interpreter. Then, enter <code class="Code-In-Text--PACKT-">help(Point)&lt;enter&gt;</code> at the Python prompt.</p>
    <p class="normal">You should see<a id="_idIndexMarker125"/> nicely formatted documentation for the class, as shown in the following output:</p>
    <pre class="programlisting con"><code class="hljs-con">Help on class Point in module point_2:
class Point(builtins.object)
 |  Point(x: float = 0, y: float = 0) -&gt; None
 |  
 |  Represents a point in two-dimensional geometric coordinates
 |  
 |  &gt;&gt;&gt; p_0 = Point()
 |  &gt;&gt;&gt; p_1 = Point(3, 4)
 |  &gt;&gt;&gt; p_0.calculate_distance(p_1)
 |  5.0
 |  
 |  Methods defined here:
 |  
 |  __init__(self, x: float = 0, y: float = 0) -&gt; None
 |      Initialize the position of a new point. The x and y
 |      coordinates can be specified. If they are not, the
 |      point defaults to the origin.
 |      
 |      :param x: float x-coordinate
 |      :param y: float x-coordinate
 |  
 |  calculate_distance(self, other: 'Point') -&gt; float
 |      Calculate the Euclidean distance from this point
 |      to a second point passed as a parameter.
 |      
 |      :param other: Point instance
 |      :return: float distance
 |  
 |  move(self, x: float, y: float) -&gt; None
 |      Move the point to a new location in 2D space.
 |      
 |      :param x: float x-coordinate
 |      :param y: float x-coordinate
 |  
 |  reset(self) -&gt; None
 |      Reset the point back to the geometric origin: 0, 0
 |  
 |  ----------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
</code></pre>
    <p class="normal">Not only is our documentation every bit as polished as the documentation for built-in functions, but we can run <code class="Code-In-Text--PACKT-">python -m doctest point_2.py</code> to confirm the example shown in the docstring.</p>
    <p class="normal">Further, we can run <strong class="" style="font-style: italic;">mypy</strong> to check the type hints, also. Use <code class="Code-In-Text--PACKT-">mypy –-strict src/*.py</code> to check all of the files in the <code class="Code-In-Text--PACKT-">src</code> folder. If there are no problems, the <strong class="" style="font-style: italic;">mypy</strong> application doesn't produce any output. (Remember, <strong class="" style="font-style: italic;">mypy</strong> is not part of the standard installation, so you'll need to add it. Check the preface for information on extra packages that need to be installed.)</p>
    <h1 id="_idParaDest-46" class="title">Modules and packages</h1>
    <p class="normal">Now we know how to create classes and instantiate objects. You don't need to write too many classes (or non-object-oriented code, for that matter) before you start to lose track of them. For small programs, we generally put all our classes into one file and add a little script at the end of the file to start them interacting. However, as our projects grow, it can become difficult to find the one class that needs to be edited among the many classes we've defined. This is<a id="_idIndexMarker126"/> where <strong class="keyword">modules</strong> come in. Modules are Python files, nothing more. The single file in our small program is a module. Two Python files are two modules. If we have two files in the same folder, we can load a class from one module for use in the other module.</p>
    <p class="normal">The Python module name is the file's <em class="italic">stem</em>; the name without the <code class="Code-In-Text--PACKT-">.py</code> suffix. A file named <code class="Code-In-Text--PACKT-">model.py</code> is a module named <code class="Code-In-Text--PACKT-">model</code>. Module files are found by searching a path that includes the local directory and the installed packages.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">import</code> statement is used for importing modules or specific classes or functions from modules. We've already seen an example of this in our <code class="Code-In-Text--PACKT-">Point</code> class in the previous section. We used the <code class="Code-In-Text--PACKT-">import</code> statement to get Python's built-in <code class="Code-In-Text--PACKT-">math</code> module and use its <code class="Code-In-Text--PACKT-">hypot()</code> function in the <code class="Code-In-Text--PACKT-">distance</code> calculation. Let's start with a fresh example.</p>
    <p class="normal">If we are building an e-commerce system, we will likely be storing a lot of data in a database. We can put all the classes and functions related to database access into a separate file (we'll call it something sensible: <code class="Code-In-Text--PACKT-">database.py</code>). Then, our other modules (for example, customer models, product information, and inventory) can import classes from the <code class="Code-In-Text--PACKT-">database</code> module in order to access the database.</p>
    <p class="normal">Let's start with a module called <code class="Code-In-Text--PACKT-">database</code>. It's a file, <code class="Code-In-Text--PACKT-">database.py</code>, containing a class called <code class="Code-In-Text--PACKT-">Database</code>. A second module called <code class="Code-In-Text--PACKT-">products</code> is responsible for product-related queries. The classes in the <code class="Code-In-Text--PACKT-">products</code> module need to instantiate the <code class="Code-In-Text--PACKT-">Database</code> class from the <code class="Code-In-Text--PACKT-">database</code> module so that they can execute queries on the product table in the database.</p>
    <p class="normal">There are several variations on the <code class="Code-In-Text--PACKT-">import</code> statement syntax that can be used to access the <code class="Code-In-Text--PACKT-">Database</code> class. One variant is to import the module as a whole:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">import</span><span class="python"> database</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">db = database.Database(</span><span class="hljs-con-string">"path/to/data"</span><span class="python">)</span>
</code></pre>
    <p class="normal">This version imports the <code class="Code-In-Text--PACKT-">database</code> module, creating a <code class="Code-In-Text--PACKT-">database</code> namespace. Any class or function in the <code class="Code-In-Text--PACKT-">database</code> module can be accessed using the <code class="Code-In-Text--PACKT-">database.&lt;something&gt;</code> notation. </p>
    <p class="normal">Alternatively, we can import just the one class we need using the <code class="Code-In-Text--PACKT-">from...import</code> syntax:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span><span class="python"> database </span><span class="hljs-con-keyword">import</span><span class="python"> Database</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">db = Database(</span><span class="hljs-con-string">"path/to/data"</span><span class="python">)</span>
</code></pre>
    <p class="normal">This version imported only the <code class="Code-In-Text--PACKT-">Database</code> class from the <code class="Code-In-Text--PACKT-">database</code> module. When we have a few items from a few modules, this can be a helpful simplification to avoid using longer, fully qualified names like <code class="Code-In-Text--PACKT-">database.Database</code>. When we import a number of items from a number of different modules, this can be a potential source of confusion when we omit the qualifiers.</p>
    <p class="normal">If, for some <a id="_idIndexMarker127"/>reason, <code class="Code-In-Text--PACKT-">products</code> already has a class called <code class="Code-In-Text--PACKT-">Database</code>, and we don't want the two names to be confused, we can rename the class when used inside the <code class="Code-In-Text--PACKT-">products</code> module:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span><span class="python"> database </span><span class="hljs-con-keyword">import</span><span class="python"> Database </span><span class="hljs-con-keyword">as</span><span class="python"> DB</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">db = DB(</span><span class="hljs-con-string">"path/to/data"</span><span class="python">)</span>
</code></pre>
    <p class="normal">We can also import multiple items in one statement. If our <code class="Code-In-Text--PACKT-">database</code> module also contains a <code class="Code-In-Text--PACKT-">Query</code> class, we can import both classes using the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> Database, Query
</code></pre>
    <p class="normal">We can import all classes and functions from the <code class="Code-In-Text--PACKT-">database</code> module using this syntax:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> * 
</code></pre>
    <div class="packt_tip">
      <p class="Tip--PACKT-"><strong class="keyword">Don't do this.</strong> Most experienced Python programmers will tell you that you should never use this syntax (a few will tell you there are some very specific situations where it is useful, but we can disagree). One way to learn why to avoid this syntax is to use it and try to understand your code two years later. We can save some time and two years of poorly written code with a quick explanation now! </p>
    </div>
    <p class="normal">We've got several reasons for avoiding this:</p>
    <ul>
      <li class="bullet">When we explicitly import the <code class="Code-In-Text--PACKT-">database</code> class at the top of our file using <code class="Code-In-Text--PACKT-">from database import Database</code>, we can easily see where the <code class="Code-In-Text--PACKT-">Database</code> class comes from. We might use <code class="Code-In-Text--PACKT-">db = Database()</code> 400 lines later in the file, and we can quickly look at the imports to see where that <code class="Code-In-Text--PACKT-">Database</code> class came from. Then, if we need clarification as to how to use the <code class="Code-In-Text--PACKT-">Database</code> class, we can visit the original file (or import the module in the interactive interpreter and use the <code class="Code-In-Text--PACKT-">help(database.Database)</code> command). However, if we use the <code class="Code-In-Text--PACKT-">from database import *</code> syntax, it takes a lot longer to find where that class is located. Code maintenance becomes a nightmare.</li>
      <li class="bullet">If there are conflicting names, we're doomed. Let's say we have two modules, both of which provide a class named <code class="Code-In-Text--PACKT-">Database</code>. Using <code class="Code-In-Text--PACKT-">from module_1 import *</code> and <code class="Code-In-Text--PACKT-">from module_2 import *</code> means the second import statement overwrites the <code class="Code-In-Text--PACKT-">Database</code> name created by the first import. If we used <code class="Code-In-Text--PACKT-">import module_1</code> and <code class="Code-In-Text--PACKT-">import module_2</code>, we'd use the module names as qualifiers to disambiguate <code class="Code-In-Text--PACKT-">module_1.Database</code> from <code class="Code-In-Text--PACKT-">module_2.Database</code>.</li>
      <li class="bullet">In addition, most code editors are able to provide extra functionality, such as reliable code completion, the ability to jump to the definition of a class, or inline documentation, if normal imports are used. The <code class="Code-In-Text--PACKT-">import *</code> syntax can hamper their ability to do this reliably.</li>
      <li class="bullet">Finally, using the <code class="Code-In-Text--PACKT-">import *</code> syntax can bring unexpected objects into our local namespace. Sure, it will import all the classes and functions defined in the module being imported from, but unless a special <code class="Code-In-Text--PACKT-">__all__</code> list is provided in the module, this <code class="Code-In-Text--PACKT-">import</code> will also import any classes or modules that were themselves imported into that file!</li>
    </ul>
    <p class="normal">Every name used in a <a id="_idIndexMarker128"/>module should come from a well-specified place, whether it is defined in that module, or explicitly imported from another module. There should be no magic variables that seem to come out of thin air. We should <em class="italic">always</em> be able to immediately identify where the names in our current namespace originated. We promise that if you use this evil syntax, you will one day have extremely frustrating moments of <em class="italic">where on earth can this class be coming from?</em></p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">For fun, try typing <code class="Code-In-Text--PACKT-">import this</code> into your interactive interpreter. It prints a nice poem (with a couple of inside jokes) summarizing some of the idioms that Pythonistas tend to practice. Specific to this discussion, note the line "Explicit is better than implicit." Explicitly importing names into your namespace makes your code much easier to navigate than the implicit <code class="Code-In-Text--PACKT-">from module import *</code> syntax.</p>
    </div>
    <h2 id="_idParaDest-47" class="title">Organizing modules</h2>
    <p class="normal">As a project<a id="_idIndexMarker129"/> grows into a collection of more and more modules, we may find that we want to add another level of abstraction, some kind of nested hierarchy on our modules' levels. However, we can't put modules inside modules; one file can hold only one file after all, and modules are just files.</p>
    <p class="normal">Files, however, can go in folders, and so can modules. A <strong class="keyword">package</strong> is a collection of modules in a folder. The name of the package is the <a id="_idIndexMarker130"/>name of the folder. We need to tell Python that a folder is a package to distinguish it from other folders in the directory. To do this, place a (normally empty) file in the folder named <code class="Code-In-Text--PACKT-">__init__.py</code>. If we forget this file, we won't be able to import modules from that folder.</p>
    <p class="normal">Let's put our modules inside an <code class="Code-In-Text--PACKT-">ecommerce</code> package in our working folder, which will also contain a <code class="Code-In-Text--PACKT-">main.py</code> file to start the program. Let's additionally add another package inside the <code class="Code-In-Text--PACKT-">ecommerce</code> package for various payment options. </p>
    <p class="normal">We need to exercise some caution in creating deeply nested packages. The general advice in the Python community is "flat is better than nested." In this example, we need to create a nested package because there are some common features to all of the various payment alternatives. </p>
    <p class="normal">The folder hierarchy will look like this, rooted under a directory in the project folder, commonly named <code class="Code-In-Text--PACKT-">src</code>:</p>
    <pre class="programlisting con"><code class="hljs-con">src/
 +-- main.py
 +-- ecommerce/
     +-- __init__.py
     +-- database.py
     +-- products.py
     +-- payments/
     |   +-- __init__.py
     |   +-- common.py
     |   +-- square.py
     |   +-- stripe.py
     +-- contact/
         +-- __init__.py
         +-- email.py
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">src</code> directory will be part of an overall project directory. In addition to <code class="Code-In-Text--PACKT-">src</code>, the project will often have directories with names like <code class="Code-In-Text--PACKT-">docs</code> and <code class="Code-In-Text--PACKT-">tests</code>. It's common for the project parent directory to also have configuration files for tools like <strong class="" style="font-style: italic;">mypy</strong> among others. We'll return to this in <em class="chapterRef">Chapter 13</em>, <em class="italic">Testing Object-Oriented Programs</em>.</p>
    <p class="normal">When importing<a id="_idIndexMarker131"/> modules or classes between packages, we have to be cautious about the structure of our packages. In Python 3, there are two ways of importing modules: absolute imports and relative imports. We'll look at each of them separately.</p>
    <h3 id="_idParaDest-48" class="title">Absolute imports</h3>
    <p class="normal"><strong class="keyword">Absolute imports</strong> specify<a id="_idIndexMarker132"/> the complete path to the module, function, or class we want to import. If we need access to the <code class="Code-In-Text--PACKT-">Product</code> class inside the <code class="Code-In-Text--PACKT-">products</code> module, we could use any of these syntaxes to perform an absolute import:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">import</span><span class="python"> ecommerce.products</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">product = ecommerce.products.Product(</span><span class="hljs-con-string">"name1"</span><span class="python">) </span>
</code></pre>
    <p class="normal">Or, we could specifically import a single class definition from the module within a package:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span><span class="python"> ecommerce.products </span><span class="hljs-con-keyword">import</span><span class="python"> Product </span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">product = Product(</span><span class="hljs-con-string">"name2"</span><span class="python">) </span>
</code></pre>
    <p class="normal">Or, we could import an entire module from the containing package:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span><span class="python"> ecommerce </span><span class="hljs-con-keyword">import</span><span class="python"> products </span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">product = products.Product(</span><span class="hljs-con-string">"name3"</span><span class="python">) </span>
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">import</code> statements use the period operator to separate packages or modules. A package is a namespace that contains module names, much in the way an object is a namespace containing attribute names.</p>
    <p class="normal">These statements will work from any module. We could instantiate a <code class="Code-In-Text--PACKT-">Product</code> class using this syntax in <code class="Code-In-Text--PACKT-">main.py</code>, in the <code class="Code-In-Text--PACKT-">database</code> module, or in either of the two payment modules. Indeed, assuming the packages are available to Python, it will be able to import them. For example, the packages can also be installed in the Python <code class="Code-In-Text--PACKT-">site-packages</code> folder, or the <code class="Code-In-Text--PACKT-">PYTHONPATH</code> environment variable could be set to tell Python which folders to search for packages and modules it is going to import.</p>
    <p class="normal">With these choices, which syntax do we choose? It depends on your audience and the application at hand. If there are dozens of classes and functions inside the <code class="Code-In-Text--PACKT-">products</code> module that we want to use, we'd generally import the module name using the <code class="Code-In-Text--PACKT-">from ecommerce import products</code> syntax, and then access the individual classes using <code class="Code-In-Text--PACKT-">products.Product</code>. If we only need one or two classes from the <code class="Code-In-Text--PACKT-">products</code> module, we can import them directly using the <code class="Code-In-Text--PACKT-">from ecommerce.products import Product</code> syntax. It's important to write whatever makes the code easiest for others to read and extend.</p>
    <h3 id="_idParaDest-49" class="title">Relative imports</h3>
    <p class="normal">When working with related modules inside a deeply nested package, it seems kind of redundant to specify the full path; we know what our parent module is named. This is where <strong class="keyword">relative imports</strong> come in. Relative imports identify a class, function, or module as it is positioned relative to the<a id="_idIndexMarker133"/> current module. They only make sense inside module files, and, further, they only make sense where there's a complex package structure.</p>
    <p class="normal">For example, if we are working in the <code class="Code-In-Text--PACKT-">products</code> module and we want to import the <code class="Code-In-Text--PACKT-">Database</code> class from the <code class="Code-In-Text--PACKT-">database</code> module next to it, we could use a relative import:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> .database <span class="hljs-keyword">import</span> Database 
</code></pre>
    <p class="normal">The period in front of <code class="Code-In-Text--PACKT-">database</code> says <em class="italic">use the database module inside the current package</em>. In this case, the current package is the package containing the <code class="Code-In-Text--PACKT-">products.py</code> file we are currently editing, that is, the <code class="Code-In-Text--PACKT-">ecommerce</code> package.</p>
    <p class="normal">If we were editing the <code class="Code-In-Text--PACKT-">stripe</code> module inside the <code class="Code-In-Text--PACKT-">ecommerce.payments</code> package, we would want, for example, to <em class="italic">use the database package inside the parent package</em> instead. This is easily done with two periods, as shown here:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> ..database <span class="hljs-keyword">import</span> Database 
</code></pre>
    <p class="normal">We can use more periods to go further up the hierarchy, but at some point, we have to acknowledge that we have too many packages. Of course, we can also go down one side and back up the other. The following would be a valid import from the <code class="Code-In-Text--PACKT-">ecommerce.contact</code> package containing an <code class="Code-In-Text--PACKT-">email</code> module if we wanted to import the <code class="Code-In-Text--PACKT-">send_mail</code> function into our <code class="Code-In-Text--PACKT-">payments.stripe</code> module:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> ..contact.email <span class="hljs-keyword">import</span> send_mail
</code></pre>
    <p class="normal">This import uses two periods indicating <em class="italic">the parent of the payments.stripe package</em>, and then uses the normal <code class="Code-In-Text--PACKT-">package.module</code> syntax to go back down into the <code class="Code-In-Text--PACKT-">contact</code> package to name the <code class="Code-In-Text--PACKT-">email</code> module.</p>
    <p class="normal">Relative imports aren't as useful as they might seem. As mentioned earlier, the <em class="italic">Zen of Python</em> (you can read it when you run <code class="Code-In-Text--PACKT-">import this</code>) suggests "flat is better than nested". Python's standard library is relatively flat, with few packages and even fewer nested packages. If you're familiar with Java, the packages are deeply nested, something the Python community likes to avoid. A relative import is needed to solve a specific problem where module names are reused among packages. They can be helpful in a few cases. Needing more than two dots to locate a common parent-of-a-parent package suggests the design should be flattened out.</p>
    <h3 id="_idParaDest-50" class="title">Packages as a whole</h3>
    <p class="normal">We can import code that <a id="_idIndexMarker134"/>appears to come directly from a package, as opposed to a module inside a package. As we'll see, there's a module involved, but it has a special name, so it's hidden. In this example, we have an <code class="Code-In-Text--PACKT-">ecommerce</code> package containing two module files named <code class="Code-In-Text--PACKT-">database.py</code> and <code class="Code-In-Text--PACKT-">products.py</code>. The <code class="Code-In-Text--PACKT-">database</code> module contains a <code class="Code-In-Text--PACKT-">db</code> variable that is accessed from a lot of places. Wouldn't it be convenient if this could be imported as <code class="Code-In-Text--PACKT-">from ecommerce import db</code> instead of <code class="Code-In-Text--PACKT-">from ecommerce.database import db</code><code class="Code-In-Text--PACKT-">?</code></p>
    <p class="normal">Remember the <code class="Code-In-Text--PACKT-">__init__.py</code> file that defines a directory as a package? This file can contain any variable or class declarations we like, and they will be available as part of the package. In our example, if the <code class="Code-In-Text--PACKT-">ecommerce/__init__.py</code> file contained the following line:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> .database <span class="hljs-keyword">import</span> db
</code></pre>
    <p class="normal">We could then access the <code class="Code-In-Text--PACKT-">db</code> attribute from <code class="Code-In-Text--PACKT-">main.py</code> or any other file using the following import:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> ecommerce <span class="hljs-keyword">import</span> db
</code></pre>
    <p class="normal">It might help to think of the <code class="Code-In-Text--PACKT-">ecommerce/__init__.py</code> file as if it were the <code class="Code-In-Text--PACKT-">ecommerce.py</code> file. It lets us view the <code class="Code-In-Text--PACKT-">ecommerce</code> package as having a module protocol as well as a package protocol. This can also be useful if you put all your code in a single module and later decide to break it up into a package of modules. The <code class="Code-In-Text--PACKT-">__init__.py</code> file for the new package can still be the main point of contact for other modules using it, but the code can be internally organized into several different modules or subpackages.</p>
    <p class="normal">We recommend not putting much code in an <code class="Code-In-Text--PACKT-">__init__.py</code> file, though. Programmers do not expect actual logic to happen in this file, and much like with <code class="Code-In-Text--PACKT-">from x import *</code>, it can trip them up if they are looking for the declaration of a particular piece of code and can't find it until they check <code class="Code-In-Text--PACKT-">__init__.py</code>.</p>
    <p class="normal">After looking at modules in general, let's dive into what should be inside a module. The rules are flexible (unlike other languages). If you're familiar with Java, you'll see that Python gives you some freedom to bundle things in a way that's meaningful and informative.</p>
    <h2 id="_idParaDest-51" class="title">Organizing our code in modules</h2>
    <p class="normal">The Python<a id="_idIndexMarker135"/> module is an important focus. Every application or <a id="_idIndexMarker136"/>web service has at least one module. Even a seemingly "simple" Python script is a module. Inside any one module, we can specify variables, classes, or functions. They can be a handy way to store the global state without namespace conflicts. For example, we have been importing the <code class="Code-In-Text--PACKT-">Database</code> class into various modules and then instantiating it, but it might make more sense to have only one <code class="Code-In-Text--PACKT-">database</code> object globally available from the <code class="Code-In-Text--PACKT-">database</code> module. The <code class="Code-In-Text--PACKT-">database</code> module might look like this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Database</span><span class="hljs-class">:</span>
    <span class="hljs-string">"""The Database Implementation"""</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span><span class="hljs-params">self, connection: Optional[</span><span class="hljs-built_in">str</span><span class="hljs-params">] = </span><span class="hljs-literal">None</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        <span class="hljs-string">"""Create a connection to a database."""</span>
        <span class="hljs-keyword">pass</span>
database = Database(<span class="hljs-string">"path/to/data"</span>)
</code></pre>
    <p class="normal">Then we can use any of the import methods we've discussed to access the <code class="Code-In-Text--PACKT-">database</code> object, for example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> ecommerce.database <span class="hljs-keyword">import</span> database 
</code></pre>
    <p class="normal">A problem with the preceding class is that the <code class="Code-In-Text--PACKT-">database</code> object is created immediately when the module is first imported, which is usually when the program starts up. This isn't always ideal, since connecting to a database can take a while, slowing down startup, or the database connection information may not yet be available because we need to read a configuration file. We could delay creating the database until it is actually needed by calling an <code class="Code-In-Text--PACKT-">initialize_database()</code> function to create a module-level variable:</p>
    <pre class="programlisting code"><code class="hljs-code">db: Optional[Database] = <span class="hljs-literal">None</span>
<span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">initialize_database</span><span class="hljs-function">(</span><span class="hljs-params">connection: Optional[</span><span class="hljs-built_in">str</span><span class="hljs-params">] = </span><span class="hljs-literal">None</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
    <span class="hljs-keyword">global</span> db
    db = Database(connection)
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">Optional[Database]</code> type hint signals to the <strong class="" style="font-style: italic;">mypy</strong> tool that this may be <code class="Code-In-Text--PACKT-">None</code> or it may have an instance of the <code class="Code-In-Text--PACKT-">Database</code> class. The <code class="Code-In-Text--PACKT-">Optional</code> hint is defined in the <code class="Code-In-Text--PACKT-">typing</code> module. This hint can be handy elsewhere in our application to make sure we confirm that the value for the <code class="Code-In-Text--PACKT-">database</code> variable is not <code class="Code-In-Text--PACKT-">None</code>. </p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">global</code> keyword tells Python that the database variable inside <code class="Code-In-Text--PACKT-">initialize_database()</code> is the module-level variable, outside the function. If we had not specified the variable as global, Python would have created a new local variable that would be discarded when the function exits, leaving the module-level value unchanged.</p>
    <p class="normal">We need to <a id="_idIndexMarker137"/>make one additional change. We need to import the <code class="Code-In-Text--PACKT-">database</code> module as a whole. We can't import the <code class="Code-In-Text--PACKT-">db</code> object from inside the module; it <a id="_idIndexMarker138"/>might not have been initialized. We need to be sure <code class="Code-In-Text--PACKT-">database.initialize_database()</code> is called before <code class="Code-In-Text--PACKT-">db</code> will have a meaningful value. If we wanted direct access to the database object, we'd use <code class="Code-In-Text--PACKT-">database.db</code>.</p>
    <p class="normal">A common alternative is a function that returns the current database object. We could import this function everywhere we needed access to the database:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">get_database</span><span class="hljs-function">(</span><span class="hljs-params">connection: Optional[</span><span class="hljs-built_in">str</span><span class="hljs-params">] = </span><span class="hljs-literal">None</span><span class="hljs-function">) -&gt; Database:</span>
    <span class="hljs-keyword">global</span> db
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db:
        db = Database(connection) 
    <span class="hljs-keyword">return</span> db
</code></pre>
    <p class="normal">As these examples illustrate, all module-level code is executed immediately at the time it is imported. The <code class="Code-In-Text--PACKT-">class</code> and <code class="Code-In-Text--PACKT-">def</code> statements create code objects to be executed later when the function is called. This can be a tricky thing for scripts that perform execution, such as the main script in our e-commerce example. Sometimes, we write a program that does something useful, and then later find that we want to import a function or class from that module into a different program. However, as soon as we import it, any code at the module level is immediately executed. If we are not careful, we can end up running the first program when we really only meant to access a couple of functions inside that module.</p>
    <p class="normal">To solve this, we should always put our startup code in a function (conventionally, called <code class="Code-In-Text--PACKT-">main()</code>) and only execute that function when we know we are running the module as a script, but not when our code is being imported from a different script. We can do this by <strong class="keyword">guarding</strong> the call to <code class="Code-In-Text--PACKT-">main</code> inside a conditional statement, demonstrated as follows:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Point</span><span class="hljs-class">:</span>
    <span class="hljs-string">"""</span>
<span class="hljs-string">    Represents a point in two-dimensional geometric coordinates.</span>
<span class="hljs-string">    """</span>
    <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">main</span><span class="hljs-function">() -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
    <span class="hljs-string">"""</span>
<span class="hljs-string">    Does the useful work.</span>
<span class="hljs-string">    &gt;&gt;&gt; main()</span>
<span class="hljs-string">    p1.calculate_distance(p2)=5.0</span>
<span class="hljs-string">    """</span>
    p1 = Point()
    p2 = Point(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
    print(<span class="hljs-string">f"</span><span class="hljs-subst">{p1.calculate_distance(p2)=}</span><span class="hljs-string">"</span>)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">Point</code> class (and the <code class="Code-In-Text--PACKT-">main()</code> function) can be reused without worry. We can import the contents of this module without any surprising processing happening. When we run it as a main program, however, it executes the <code class="Code-In-Text--PACKT-">main()</code> function.</p>
    <p class="normal">This works <a id="_idIndexMarker139"/>because every module has a <code class="Code-In-Text--PACKT-">__name__</code> special<a id="_idIndexMarker140"/> variable (remember, Python uses double underscores for special variables, such as a class' <code class="Code-In-Text--PACKT-">__init__</code> method) that specifies the name of the module when it was imported. When the module is executed directly with <code class="Code-In-Text--PACKT-">python module.py</code>, it is never imported, so the <code class="Code-In-Text--PACKT-">__name__</code> is arbitrarily set to the <code class="Code-In-Text--PACKT-">"__main__"</code> string.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">Make it a policy to wrap all your scripts in an <code class="Code-In-Text--PACKT-">if __name__ == "__main__"</code><code class="Code-In-Text--PACKT-">:</code> test, just in case you write a function that you may want to be imported by other code at some point in the future.</p>
    </div>
    <p class="normal">So, methods go in classes, which go in modules, which go in packages. Is that all there is to it?</p>
    <p class="normal">Actually, no. This <a id="_idIndexMarker141"/>is the typical order of things in a Python program, but<a id="_idIndexMarker142"/> it's not the only possible layout. Classes can be defined anywhere. They are typically defined at the module level, but they can also be defined inside a function or method, like this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional
<span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Formatter</span><span class="hljs-class">:</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">format</span><span class="hljs-function">(</span><span class="hljs-params">self, string: </span><span class="hljs-built_in">str</span><span class="hljs-function">) -&gt; str:</span>
        <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">format_string</span><span class="hljs-function">(</span><span class="hljs-params">string: </span><span class="hljs-built_in">str</span><span class="hljs-params">, formatter: Optional[Formatter] = </span><span class="hljs-literal">None</span><span class="hljs-function">) -&gt; str:</span>
    <span class="hljs-string">"""</span>
<span class="hljs-string">    Format a string using the formatter object, which</span>
<span class="hljs-string">    is expected to have a format() method that accepts</span>
<span class="hljs-string">    a string.</span>
<span class="hljs-string">    """</span>
    <span class="code-highlight"><strong class="hljs-slc">class DefaultFormatter(Formatter):</strong></span>
        <span class="code-highlight"><strong class="hljs-slc">"""Format a string in title case."""</strong></span>
        <span class="code-highlight"><strong class="hljs-slc">def format(self, string: str) -&gt; str:</strong></span>
            <span class="code-highlight"><strong class="hljs-slc">return str(string).title()</strong></span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> formatter:
        formatter = DefaultFormatter()
    <span class="hljs-keyword">return</span> formatter.<span class="hljs-built_in">format</span>(string)
</code></pre>
    <p class="normal">We've defined a <code class="Code-In-Text--PACKT-">Formatter</code> class as an abstraction to explain what a formatter class needs to have. We haven't used the abstract base class (abc) definitions (we'll look at these in detail in <em class="chapterRef">Chapter 6</em>, <em class="italic">Abstract Base Classes and Operator Overloading</em>). Instead, we've provided the method with no useful body. It has a full suite of type hints, to make sure <strong class="" style="font-style: italic;">mypy</strong> has a formal definition of our intent.</p>
    <p class="normal">Within the <code class="Code-In-Text--PACKT-">format_string()</code> function, we created an internal class that is an extension of the <code class="Code-In-Text--PACKT-">Formatter</code> class. This formalizes the expectation that our class inside the function has a specific set of methods. This connection between the definition of the <code class="Code-In-Text--PACKT-">Formatter</code> class, the <code class="Code-In-Text--PACKT-">formatter</code> parameter, and the concrete definition of the <code class="Code-In-Text--PACKT-">DefaultFormatter</code> class assures that we haven't accidentally forgotten something or added something.</p>
    <p class="normal">We can execute this function like this:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">hello_string = </span><span class="hljs-con-string">"hello world, how are you today?"</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(</span><span class="hljs-con-string">f" input: </span><span class="hljs-con-subst">{hello_string}</span><span class="hljs-con-string">"</span><span class="python">)</span>
 input: hello world, how are you today?
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">print(</span><span class="hljs-con-string">f"output: </span><span class="hljs-con-subst">{format_string(hello_string)}</span><span class="hljs-con-string">"</span><span class="python">)</span>
output: Hello World, How Are You Today?
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">format_string</code> function accepts a string and optional <code class="Code-In-Text--PACKT-">Formatter</code> object and then applies the<a id="_idIndexMarker143"/> formatter to that string. If no <code class="Code-In-Text--PACKT-">Formatter</code> instance is<a id="_idIndexMarker144"/> supplied, it creates a formatter of its own as a local class and instantiates it. Since it is created inside the scope of the function, this class cannot be accessed from anywhere outside of that function. Similarly, functions can be defined inside other functions as well; in general, any Python statement can be executed at any time.</p>
    <p class="normal">These inner classes and functions are occasionally useful for one-off items that don't require or deserve their own scope at the module level, or only make sense inside a single method. However, it is not common to see Python code that frequently uses this technique.</p>
    <p class="normal">We've seen how to create classes and how to create modules. With these core techniques, we can start thinking about writing useful, helpful software to solve problems. When the application or service gets big, though, we often have boundary issues. We need to be sure that objects respect each other's privacy and avoid confusing entanglements that make complex software into a spaghetti bowl of interrelationships. We'd prefer each class to be a nicely encapsulated ravioli. Let's look at another aspect of organizing our software to create a good design.</p>
    <h1 id="_idParaDest-52" class="title">Who can access my data?</h1>
    <p class="normal">Most object-oriented programming <a id="_idIndexMarker145"/>languages have a concept of <strong class="keyword">access control</strong>. This is related to abstraction. Some attributes and methods on an object are marked private, meaning only that object can access them. Others are marked protected, meaning only that class and any subclasses have access. The rest are public, meaning any other object is allowed to access them.</p>
    <p class="normal">Python doesn't do this. Python doesn't really believe in enforcing laws that might someday get in your way. Instead, it provides unenforced guidelines and best practices. Technically, all methods and attributes on a class are publicly available. If we want to suggest that a method should not be used publicly, we can put a note in docstrings indicating that the method is meant for internal use only (preferably, with an explanation of how the public-facing API works!).</p>
    <p class="normal">We often remind each other of this by saying "We're all adults here." There's no need to declare a variable as private when we can all see the source code.</p>
    <p class="normal">By convention, we generally prefix an internal attribute or method with an underscore character, <code class="Code-In-Text--PACKT-">_</code>. Python programmers will understand a leading underscore name to mean <em class="italic">this is an internal variable, think three times before accessing it directly</em>. But there is nothing inside the interpreter to stop them from accessing it if they think it is in their best interest to do so. Because, if they think so, why should we stop them? We may not have any idea what future uses our classes might be put to, and it may be removed in a future release. It's a pretty clear warning sign to avoid using it.</p>
    <p class="normal">There's another <a id="_idIndexMarker146"/>thing you can do to strongly suggest that outside objects don't access a property or method: prefix it with a double underscore, <code class="Code-In-Text--PACKT-">__</code>. This will perform <strong class="keyword">name mangling</strong> on the <a id="_idIndexMarker147"/>attribute in question. In essence, name mangling means that the method can still be called by outside objects if they really want to do so, but it requires extra work and is a strong indicator that you demand that your attribute remains <strong class="keyword">private</strong>.</p>
    <p class="normal">When we use a double underscore, the property is prefixed with <code class="Code-In-Text--PACKT-">_&lt;classname&gt;</code>. When methods in the class internally access the variable, they are automatically unmangled. When external classes wish to access it, they have to do the name mangling themselves. So, name mangling does not guarantee privacy; it only strongly recommends it. This is very rarely used, and often a source of confusion when it is used.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">Don't create new double-underscore names in your own code, it will only cause grief and heartache. Consider this reserved for Python's internally defined special names.</p>
    </div>
    <p class="normal">What's important is that encapsulation – as a design principle – assures that the methods of a class encapsulate the state changes for the attributes. Whether or not attributes (or methods) are private doesn't change the essential good design that flows from encapsulation. </p>
    <p class="normal">The encapsulation principle applies to individual classes as well as a module with a bunch of classes. It also applies to a package with a bunch of modules. As designers of object-oriented Python, we're isolating responsibilities and clearly encapsulating features. </p>
    <p class="normal">And, of course, we're using Python to solve problems. It turns out there's a huge standard library available to help us create useful software. The vast standard library is why we describe Python as a "batteries included" language. Right out of the box, you have almost everything you need, no running to the store to buy batteries. </p>
    <p class="normal">Outside the standard library, there's an even larger universe of third-party packages. In the next section, we'll look at how we extend our Python installation with even more ready-made goodness.</p>
    <h1 id="_idParaDest-53" class="title">Third-party libraries</h1>
    <p class="normal">Python ships with a lovely<a id="_idIndexMarker148"/> standard library, which is a collection of packages and modules that are available on every machine that runs Python. However, you'll soon find that it doesn't contain everything you need. When this happens, you have two options:</p>
    <ul>
      <li class="bullet">Write a supporting package yourself</li>
      <li class="bullet">Use somebody else's code</li>
    </ul>
    <p class="normal">We won't be covering the details about turning your packages into libraries, but if you have a problem you need to solve and you don't feel like coding it (the best programmers are extremely lazy and prefer to reuse existing, proven code, rather than write their own), you can probably find the<a id="_idIndexMarker149"/> library you want on the <strong class="keyword">Python Package Index</strong> (<strong class="keyword">PyPI</strong>) at <a href="http://pypi.python.org/"><span class="url">http://pypi.python.org/</span></a>. Once you've identified a package that you want to install, you can use a tool called <code class="Code-In-Text--PACKT-">pip</code> to install it. </p>
    <p class="normal">You can install packages using an operating system command such as the following:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">%</span><span class="bash"> python -m pip install mypy</span>
</code></pre>
    <p class="normal">If you try this without making any preparation, you'll either be installing the third-party library directly into your system Python directory, or, more likely, will get an error that you don't have permission to update the system Python. </p>
    <p class="normal">The common consensus in the Python community is that you don't touch any Python that's part of the OS. Older Mac OS X releases had a Python 2.7 installed. This was not really available for end users. It's best to think of it as part of the OS; and ignore it and always install a fresh, new Python.</p>
    <p class="normal">Python ships with a tool called <code class="Code-In-Text--PACKT-">venv</code>, a utility that gives you a Python installation called a <strong class="keyword">virtual environment</strong> in your working directory. When you activate this environment, commands related to Python will work with your virtual environment's Python instead of the system Python. So, when you run <code class="Code-In-Text--PACKT-">pip</code> or <code class="Code-In-Text--PACKT-">python</code>, it won't touch the system Python at all. Here's how to use it:</p>
    <pre class="programlisting con"><code class="hljs-con">cd project_directory
python -m venv env
source env/bin/activate    # on Linux or macOS
env/Scripts/activate.bat   # on Windows
</code></pre>
    <p class="normal">(For other OSes, see <a href="https://docs.python.org/3/library/venv.html"><span class="url">https://docs.python.org/3/library/venv.html</span></a>, which has all the variations required to activate the environment.)</p>
    <p class="normal">Once the virtual <a id="_idIndexMarker150"/>environment is activated, you are assured that <code class="Code-In-Text--PACKT-">python -m pip</code> will install new packages into the virtual environment, leaving any OS Python alone. You can now use the <code class="Code-In-Text--PACKT-">python -m pip install mypy</code> command to add the <strong class="" style="font-style: italic;">mypy</strong> tool to your current virtual environment.</p>
    <p class="normal">On a home computer – where you have access to the privileged files – you can sometimes get away with installing and working with a single, centralized system-wide Python. In an enterprise computing environment, where system-wide directories require special privileges, a virtual environment is required. Because the virtual environment approach always works, and the centralized system-level approach doesn't always work, it's generally a best practice to create and use virtual environments. </p>
    <p class="normal">It's typical to create a different virtual environment for each Python project. You can store your virtual environments anywhere, but a good practice is to keep them in the same directory as the rest of the project files. When working with version control tools like <strong class="keyword">Git</strong>, the <code class="Code-In-Text--PACKT-">.gitignore</code> file can <a id="_idIndexMarker151"/>make sure your virtual environments are not checked into the Git repository.</p>
    <p class="normal">When starting something new, we often create the directory, and then <code class="Code-In-Text--PACKT-">cd</code> into that directory. Then, we'll run the <code class="Code-In-Text--PACKT-">python -m venv env</code> utility to create a virtual environment, usually with a simple name like <code class="Code-In-Text--PACKT-">env</code>, and sometimes with a more complex name like <code class="Code-In-Text--PACKT-">CaseStudy39</code>. </p>
    <p class="normal">Finally, we can use one of the last two lines in the preceding code (depending on the operating system, as indicated in the comments) to activate the environment.</p>
    <p class="normal">Each time we do some work on a project, we can <code class="Code-In-Text--PACKT-">cd</code> to the directory and execute the <code class="Code-In-Text--PACKT-">source</code> (or <code class="Code-In-Text--PACKT-">activate.bat</code>) line to use that particular virtual environment. When switching projects, a <code class="Code-In-Text--PACKT-">deactivate</code> command unwinds the environment setup.</p>
    <p class="normal">Virtual environments are essential for keeping your third-party dependencies separate from Python's standard library. It is common to have different projects that depend on different versions of a particular library (for example, an older website might run on Django 1.8, while newer versions run on Django 2.1). Keeping each project in separate virtual environments makes it easy to work in either version of Django. Furthermore, it prevents conflicts between system-installed packages and <code class="Code-In-Text--PACKT-">pip</code>-installed packages if you try to install the same package using different tools. Finally, it bypasses any OS permission restrictions<a id="_idIndexMarker152"/> surrounding the OS Python.</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-">There are several third-party tools for managing virtual environments effectively. Some of these include <code class="Code-In-Text--PACKT-">virtualenv</code>, <code class="Code-In-Text--PACKT-">pyenv</code>, <code class="Code-In-Text--PACKT-">virtualenvwrapper</code>, and <code class="Code-In-Text--PACKT-">conda</code>. If you're working in a data science environment, you'll probably need to use <code class="Code-In-Text--PACKT-">conda</code> so you can install more complex packages. There are a number of features leading to a lot of different approaches to solving the problem of managing the huge Python ecosystem of third-party packages. </p>
    </div>
    <h1 id="_idParaDest-54" class="title">Case study</h1>
    <p class="normal">This section<a id="_idIndexMarker153"/> expands on the object-oriented design of our realistic example. We'll start with the diagrams created using the <strong class="keyword">Unified Modeling Language</strong> (<strong class="keyword">UML</strong>) to help depict and summarize the software we're going to build.</p>
    <p class="normal">We'll describe the various considerations that are part of the Python implementation of the class definitions. We'll start with a review of the diagrams that describe the classes to be defined.</p>
    <h2 id="_idParaDest-55" class="title">Logical view</h2>
    <p class="normal">Here's the overview of the <a id="_idIndexMarker154"/>classes we need to build. This is (except for one new method) the previous chapter's model:</p>
    <figure class="mediaobject"><img src="../Images/B17070_02_02.png" alt="Diagram  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 2.2: Logical view diagram</p>
    <p class="normal">There are three classes that define our core data model, plus some uses of the generic list class. We've shown it using the type hint of <code class="Code-In-Text--PACKT-">List</code>. Here are the four central classes:</p>
    <ul>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">TrainingData</code> class is a container with two lists of data samples, a list used for training our model and a list used for testing our model. Both lists are composed of <code class="Code-In-Text--PACKT-">KnownSample</code> instances. Additionally, we'll also have a list of alternative <code class="Code-In-Text--PACKT-">Hyperparameter</code> values. In general, these are tuning values that change the behavior of the model. The idea is to test with different hyperparameters to locate the highest-quality model. <p class="bullet">We've also allocated a little bit of metadata to this class: the name of the data we're working with, the datetime of when we uploaded the data the first time, and the datetime of when we ran a test against the model. </p>
      </li>
      <li class="bullet">Each instance of the <code class="Code-In-Text--PACKT-">Sample</code> class is the core piece of working data. In our example, these are measurements of sepal lengths and widths and petal lengths and widths. Steady-handed botany graduate students carefully measured lots and lots of flowers to gather this data. We hope that they had time to stop and smell the roses while they were working.</li>
      <li class="bullet">A <code class="Code-In-Text--PACKT-">KnownSample</code> object<a id="_idIndexMarker155"/> is an extended <code class="Code-In-Text--PACKT-">Sample</code>. This part of the design foreshadows the focus of <em class="chapterRef">Chapter 3</em>, <em class="italic">When Objects Are Alike</em>. A <code class="Code-In-Text--PACKT-">KnownSample</code> is a <code class="Code-In-Text--PACKT-">Sample</code> with one extra attribute, the assigned species. This information comes from skilled botanists who have classified some data we can use for training and testing.</li>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">Hyperparameter</code> class has the <em class="italic">k</em> used to define how many of the nearest neighbors to consider. It also has a summary of testing with this value of <em class="italic">k</em>. The quality tells us how many of the test samples were correctly classified. We expect to see that small values of <em class="italic">k</em> (like 1 or 3) don't classify well. We expect middle values of <em class="italic">k</em> to do better, and very large values of <em class="italic">k</em> to not do as well. </li>
    </ul>
    <p class="normal">The <code class="Code-In-Text--PACKT-">KnownSample</code> class on the diagram may not need to be a separate class definition. As we work through the details, we'll look at some alternative designs for each of these classes.</p>
    <p class="normal">We'll start with the <code class="Code-In-Text--PACKT-">Sample</code> (and <code class="Code-In-Text--PACKT-">KnownSample</code>) classes. Python offers three essential paths for defining a new class:</p>
    <ul>
      <li class="bullet">A <code class="Code-In-Text--PACKT-">class</code> definition; we'll focus on this to start.</li>
      <li class="bullet">A <code class="Code-In-Text--PACKT-">@dataclass</code> definition. This provides a number of built-in features. While it's handy, it's not ideal for programmers who are new to Python, because it can obscure some implementation details. We'll set this aside for <em class="chapterRef">Chapter 7</em>, <em class="italic">Python Data Structures</em>.</li>
      <li class="bullet">An extension to the <code class="Code-In-Text--PACKT-">typing.NamedTuple</code> class. The most notable feature of this definition will be that the state of the object is immutable; the attribute values cannot be changed. Unchanging attributes can be a useful feature for making sure a bug in the application doesn't mess with the training data. We'll set this aside for <em class="chapterRef">Chapter 7</em>, also.</li>
    </ul>
    <p class="normal">Our first design <a id="_idIndexMarker156"/>decision is to use Python's <code class="Code-In-Text--PACKT-">class</code> statement to write a class definition for <code class="Code-In-Text--PACKT-">Sample</code> and its subclass <code class="Code-In-Text--PACKT-">KnownSample</code>. This may be replaced in the future (i.e., <em class="chapterRef">Chapter 7</em>) with alternatives that use data classes as well as <code class="Code-In-Text--PACKT-">NamedTuple</code>.</p>
    <h2 id="_idParaDest-56" class="title">Samples and their states</h2>
    <p class="normal">The diagram in <em class="italic">Figure 2.2</em> shows the <code class="Code-In-Text--PACKT-">Sample</code> class and an extension, the <code class="Code-In-Text--PACKT-">KnownSample</code> class. This <a id="_idIndexMarker157"/>doesn't seem to be a complete decomposition of the various kinds of samples. When we review the user stories and the process views, there seems to be a gap: specifically, the "make classification request" by a User requires an unknown sample. This has the same flower measurements attributes as a <code class="Code-In-Text--PACKT-">Sample</code>, but doesn't have the assigned species attribute of a <code class="Code-In-Text--PACKT-">KnownSample</code>. Further, there's no state change that adds an attribute value. The unknown sample will never be formally classified by a Botanist; it will be classified by our algorithm, but it's only an AI, not a Botanist.</p>
    <p class="normal">We can make a case for two distinct subclasses of <code class="Code-In-Text--PACKT-">Sample</code>:</p>
    <ul>
      <li class="bullet"><code class="Code-In-Text--PACKT-">UnknownSample</code>: This class contains the initial four <code class="Code-In-Text--PACKT-">Sample</code> attributes. A User provides these objects to get them classified. </li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">KnownSample</code>: This class has the <code class="Code-In-Text--PACKT-">Sample</code> attributes plus the classification result, a species name. We use these for training and testing the model.</li>
    </ul>
    <p class="normal">Generally, we consider class definitions as a way to encapsulate state and behavior. An <code class="Code-In-Text--PACKT-">UnknownSample</code> instance provided by a user starts out with no species. Then, after the classifier algorithm computes a species, the <code class="Code-In-Text--PACKT-">Sample</code> changes state to have a species assigned by the algorithm.</p>
    <p class="normal">A question we must <a id="_idIndexMarker158"/>always ask about class definitions is this:</p>
    <p class="normal"><strong class="" style="font-style: italic;">Is there any change in behavior that goes with the change in state?</strong></p>
    <p class="normal">In this case, it doesn't seem like there's anything new or different that can happen. Perhaps this can be implemented as a single class with some optional attributes.</p>
    <p class="normal">We have another possible state change concern. Currently, there's no class that owns the responsibility of partitioning <code class="Code-In-Text--PACKT-">Sample</code> objects into the training or testing subsets. This, too, is a kind of state change.</p>
    <p class="normal">This leads to a second important question: </p>
    <p class="normal"><strong class="" style="font-style: italic;">What class has responsibility for making this state change?</strong></p>
    <p class="normal">In this case, it<a id="_idIndexMarker159"/> seems like the <code class="Code-In-Text--PACKT-">TrainingData</code> class should own the discrimination between testing and training data.</p>
    <p class="normal">One way to help look closely at our class design is to enumerate all of the various states of individual samples. This technique helps uncover a need for attributes in the classes. It also helps to identify the methods to make state changes to objects of a class.</p>
    <h2 id="_idParaDest-57" class="title">Sample state transitions</h2>
    <p class="normal">Let's look <a id="_idIndexMarker160"/>at the life cycles of <code class="Code-In-Text--PACKT-">Sample</code> objects. An object's life cycle starts with object creation, then state changes, and (in some cases) the end of its processing life when there are no more references to it. We have three scenarios:</p>
    <ol>
      <li class="numbered"><strong class="keyword">Initial load</strong>: We'll need a <code class="Code-In-Text--PACKT-">load()</code> method to populate a <code class="Code-In-Text--PACKT-">TrainingData</code> object from some source of raw data. We'll preview some of the material in <em class="chapterRef">Chapter 9</em>, <em class="italic">Strings, Serialization, and File Paths</em>, by saying that reading a CSV file often produces a sequence of dictionaries. We can imagine a <code class="Code-In-Text--PACKT-">load()</code> method using a CSV reader to create <code class="Code-In-Text--PACKT-">Sample</code> objects with a species value, making them <code class="Code-In-Text--PACKT-">KnownSample</code> objects. The <code class="Code-In-Text--PACKT-">load()</code> method splits the <code class="Code-In-Text--PACKT-">KnownSample</code> objects into the training and testing lists, which is an important state change for a <code class="Code-In-Text--PACKT-">TrainingData</code> object.</li>
      <li class="numbered"><strong class="keyword">Hyperparameter testing</strong>: We'll need a <code class="Code-In-Text--PACKT-">test()</code> method in the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class. The body of the <code class="Code-In-Text--PACKT-">test()</code> method works with the test samples in the associated <code class="Code-In-Text--PACKT-">TrainingData</code> object. For each sample, it applies the classifier and counts the matches between Botanist-assigned species and the best guess of our AI algorithm. This points out the need for a <code class="Code-In-Text--PACKT-">classify()</code> method for a single sample that's used by the <code class="Code-In-Text--PACKT-">test()</code> method for a batch of samples. The <code class="Code-In-Text--PACKT-">test()</code> method will update the state of the <code class="Code-In-Text--PACKT-">Hyperparameter</code> object by setting the quality score.</li>
      <li class="numbered"><strong class="keyword">User-initiated classification</strong>: A RESTful web application is often decomposed into separate view functions to handle requests. When handling a request to classify an unknown sample, the view function will have a <code class="Code-In-Text--PACKT-">Hyperparameter</code> object used for classification; this will be chosen by the Botanist to produce the best results. The user input will be an <code class="Code-In-Text--PACKT-">UnknownSample</code> instance. The view function applies the <code class="Code-In-Text--PACKT-">Hyperparameter.classify()</code> method to create a response to the user with the species the iris has been classed as. Does the state change that happens when the AI classifies an <code class="Code-In-Text--PACKT-">UnknownSample</code> really matter? Here are two views:<ul>
          <li class="bullet-l2">Each <code class="Code-In-Text--PACKT-">UnknownSample</code> can have a <code class="Code-In-Text--PACKT-">classified</code> attribute. Setting this is a change in the state of the <code class="Code-In-Text--PACKT-">Sample</code>. It's not clear that there's any behavior change associated with this state change. </li>
          <li class="bullet-l2">The classification result is not part of the <code class="Code-In-Text--PACKT-">Sample</code> at all. It's a local variable in the view function. This state change in the function is used to respond to the user, but has no life within the <code class="Code-In-Text--PACKT-">Sample</code> object.</li>
        </ul>
      </li>
    </ol>
    <p class="normal">There's a key <a id="_idIndexMarker161"/>concept underlying this detailed decomposition of these alternatives:</p>
    <div class="packt_tip">
      <p class="Tip--PACKT-"><strong class="keyword">There's no "right" answer.</strong></p>
    </div>
    <p class="normal">Some design decisions are based on non-functional and non-technical considerations. These might include the longevity of the application, future use cases, additional users who might be enticed, current schedules and budgets, pedagogical value, technical risk, the creation of intellectual property, and how cool the demo will look in a conference call.</p>
    <p class="normal">In <em class="chapterRef">Chapter 1</em>, <em class="italic">Object-Oriented Design</em>, we dropped a hint that this application is the precursor to a consumer product recommender. We noted: "The users eventually want to tackle complex consumer products, but recognize that solving a difficult problem is not a good way to learn how to build this kind of application. It's better to start with something of a manageable level of complexity and then refine and expand it until it does everything they need." </p>
    <p class="normal">Because of that, we'll consider a change in state from <code class="Code-In-Text--PACKT-">UnknownSample</code> to <code class="Code-In-Text--PACKT-">ClassifiedSample</code> to be very important. The <code class="Code-In-Text--PACKT-">Sample</code> objects will live in a database for additional marketing campaigns or possibly reclassification when new products are available and the training data changes.</p>
    <p class="normal">We'll decide to keep the classification and the species data in the <code class="Code-In-Text--PACKT-">UnknownSample</code> class.</p>
    <p class="normal">This analysis suggests we can coalesce all the various <code class="Code-In-Text--PACKT-">Sample</code> details into the following design:</p>
    <figure class="mediaobject"><img src="../Images/B17070_02_03.png" alt="Diagram  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 2.3: The updated UML diagram</p>
    <p class="normal">This view<a id="_idIndexMarker162"/> uses the open arrowhead to show a number of subclasses of <code class="Code-In-Text--PACKT-">Sample</code>. We won't directly implement these as subclasses. We've included the arrows to show that we have some distinct use cases for these objects. Specifically, the box for <code class="Code-In-Text--PACKT-">KnownSample</code> has a condition <strong class="keyword">species is not None</strong> to summarize what's unique about these <code class="Code-In-Text--PACKT-">Sample</code> objects. Similarly, the <code class="Code-In-Text--PACKT-">UnknownSample</code> has a condition, <strong class="keyword">species is None</strong>, to clarify our intent around <code class="Code-In-Text--PACKT-">Sample</code> objects with the species attribute value of <code class="Code-In-Text--PACKT-">None</code>.</p>
    <p class="normal">In these UML diagrams, we have generally avoided showing Python's "special" methods. This helps to minimize visual clutter. In some cases, a special method may be absolutely essential, and worthy of showing in a diagram. An implementation almost always needs to have an <code class="Code-In-Text--PACKT-">__init__()</code> method. </p>
    <p class="normal">There's another special method that can really help: the  <code class="Code-In-Text--PACKT-">__repr__()</code> method is used to create a representation of the object. This representation is a string that generally has the syntax of a Python expression to rebuild the object. For simple numbers, it's the number. For a simple string, it will include the quotes. For more complex objects, it will have all the necessary Python punctuation, including all the details of the class and state of the object. We'll often use an f-string with the class name and the attribute values.</p>
    <p class="normal">Here's the <a id="_idIndexMarker163"/>start of a class, <code class="Code-In-Text--PACKT-">Sample</code>, which seems to capture all the features of a single sample: </p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Sample</span><span class="hljs-class">:</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span>
<span class="hljs-params">        self,</span>
<span class="hljs-params">        sepal_length: </span><span class="hljs-built_in">float</span><span class="hljs-params">,</span>
<span class="hljs-params">        sepal_width: </span><span class="hljs-built_in">float</span><span class="hljs-params">,</span>
<span class="hljs-params">        petal_length: </span><span class="hljs-built_in">float</span><span class="hljs-params">,</span>
<span class="hljs-params">        petal_width: </span><span class="hljs-built_in">float</span><span class="hljs-params">,</span>
<span class="hljs-params">        species: Optional[</span><span class="hljs-built_in">str</span><span class="hljs-params">] = </span><span class="hljs-literal">None</span><span class="hljs-params">,</span>
<span class="hljs-params">    </span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.sepal_length = sepal_length
        self.sepal_width = sepal_width
        self.petal_length = petal_length
        self.petal_width = petal_width
        self.species = species
        self.classification: Optional[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__repr__</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">) -&gt; str:</span>
        <span class="hljs-keyword">if</span> self.species <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            known_unknown = <span class="hljs-string">"UnknownSample"</span>
        <span class="hljs-keyword">else</span>:
            known_unknown = <span class="hljs-string">"KnownSample"</span>
        <span class="hljs-keyword">if</span> self.classification <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            classification = <span class="hljs-string">""</span>
        <span class="hljs-keyword">else</span>:
            classification = <span class="hljs-string">f", </span><span class="hljs-subst">{self.classification}</span><span class="hljs-string">"</span>
        <span class="hljs-keyword">return</span> (
            <span class="hljs-string">f"</span><span class="hljs-subst">{known_unknown}</span><span class="hljs-string">("</span>
            <span class="hljs-string">f"sepal_length=</span><span class="hljs-subst">{self.sepal_length}</span><span class="hljs-string">, "</span>
            <span class="hljs-string">f"sepal_width=</span><span class="hljs-subst">{self.sepal_width}</span><span class="hljs-string">, "</span>
            <span class="hljs-string">f"petal_length=</span><span class="hljs-subst">{self.petal_length}</span><span class="hljs-string">, "</span>
            <span class="hljs-string">f"petal_width=</span><span class="hljs-subst">{self.petal_width}</span><span class="hljs-string">, "</span>
            <span class="hljs-string">f"species=</span><span class="hljs-subst">{self.species!r}</span><span class="hljs-string">"</span>
            <span class="hljs-string">f"</span><span class="hljs-subst">{classification}</span><span class="hljs-string">"</span>
            <span class="hljs-string">f")"</span>
        )
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">__repr__()</code> method reflects the fairly complex internal state of this <code class="Code-In-Text--PACKT-">Sample</code> object. The states implied by the presence (or absence) of a species and the presence (or absence) of a classification lead to small behavior changes. So far, any changes in object behavior are limited to the <code class="Code-In-Text--PACKT-">__repr__()</code> method used to display the current state of the object. </p>
    <p class="normal">What's<a id="_idIndexMarker164"/> important is that the state changes do lead to a (tiny) behavioral change.</p>
    <p class="normal">We have two application-specific methods for the <code class="Code-In-Text--PACKT-">Sample</code> class. These are shown in the next code snippet:</p>
    <pre class="programlisting code"><code class="hljs-code">    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">classify</span><span class="hljs-function">(</span><span class="hljs-params">self, classification: </span><span class="hljs-built_in">str</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.classification = classification
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">matches</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">) -&gt; bool:</span>
        <span class="hljs-keyword">return</span> self.species == self.classification
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">classify()</code> method defines the state change from unclassified to classified. The <code class="Code-In-Text--PACKT-">matches()</code> method compares the results of classification with a Botanist-assigned species. This is used for testing.</p>
    <p class="normal">Here's an example of how these state changes can look:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">from</span><span class="python"> model </span><span class="hljs-con-keyword">import</span><span class="python"> Sample</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">s2 = Sample(</span>
<span class="hljs-con-meta">...</span> <span class="python">    sepal_length=</span><span class="hljs-con-number">5.1</span><span class="python">, sepal_width=</span><span class="hljs-con-number">3.5</span><span class="python">, petal_length=</span><span class="hljs-con-number">1.4</span><span class="python">, petal_width=</span><span class="hljs-con-number">0.2</span><span class="python">, species=</span><span class="hljs-con-string">"Iris-setosa"</span><span class="python">)</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">s2</span>
KnownSample(sepal_length=5.1, sepal_width=3.5, petal_length=1.4, petal_width=0.2, species='Iris-setosa')
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">s2.classification = </span><span class="hljs-con-string">"wrong"</span>
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">s2</span>
KnownSample(sepal_length=5.1, sepal_width=3.5, petal_length=1.4, petal_width=0.2, species='Iris-setosa', classification='wrong')
</code></pre>
    <p class="normal">We have a workable definition of the <code class="Code-In-Text--PACKT-">Sample</code> class. The <code class="Code-In-Text--PACKT-">__repr__()</code> method is quite complex, suggesting there may be some improvements possible.</p>
    <p class="normal">It can help<a id="_idIndexMarker165"/> to define responsibilities for each class. This can be a focused summary of the attributes and methods with a little bit of additional rationale to tie them together. </p>
    <h2 id="_idParaDest-58" class="title">Class responsibilities</h2>
    <p class="normal">Which class is<a id="_idIndexMarker166"/> responsible for actually performing a test? Does the <code class="Code-In-Text--PACKT-">Training</code> class invoke the classifier on each <code class="Code-In-Text--PACKT-">KnownSample</code> in a testing set? Or, perhaps, does it provide the testing set to the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class, delegating the testing to the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class? Since the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class has responsibility for the <em class="italic">k</em> value, and the algorithm for locating the <em class="italic">k</em>-nearest neighbors, it seems sensible for the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class to run the test using its own <em class="italic">k</em> value and a list of <code class="Code-In-Text--PACKT-">KnownSample</code> instances provided to it.</p>
    <p class="normal">It also seems clear the <code class="Code-In-Text--PACKT-">TrainingData</code> class is an acceptable place to record the various <code class="Code-In-Text--PACKT-">Hyperparameter</code> trials. This means the <code class="Code-In-Text--PACKT-">TrainingData</code> class can identify which of the <code class="Code-In-Text--PACKT-">Hyperparameter</code> instances has a value of <em class="italic">k</em> that classifies irises with the highest accuracy.</p>
    <p class="normal">There are multiple, related state changes here. In this case, both the <code class="Code-In-Text--PACKT-">Hyperparameter</code> and <code class="Code-In-Text--PACKT-">TrainingData</code> classes will do part of the work. The system – as a whole – will change state as individual elements change state. This is sometimes described as <strong class="keyword">emergent behavior</strong>. Rather than writing a monster class that does many things, we've written smaller classes that collaborate to achieve the expected goals.</p>
    <p class="normal">This <code class="Code-In-Text--PACKT-">test()</code> method of <code class="Code-In-Text--PACKT-">TrainingData</code> is something that we didn't show in the UML image. We included <code class="Code-In-Text--PACKT-">test()</code> in the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class, but, at the time, it didn't seem necessary to add it to <code class="Code-In-Text--PACKT-">TrainingData</code>. </p>
    <p class="normal">Here's the start of the class definition:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">Hyperparameter</span><span class="hljs-class">:</span>
    <span class="hljs-string">"""A hyperparameter value and the overall quality of the classification."""</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span><span class="hljs-params">self, k: </span><span class="hljs-built_in">int</span><span class="hljs-params">, training: </span><span class="hljs-string">"TrainingData"</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.k = k
        self.data: weakref.ReferenceType[<span class="hljs-string">"TrainingData"</span>] = weakref.ref(training)
        self.quality: <span class="hljs-built_in">float</span>
</code></pre>
    <p class="normal">Note how we write type hints for classes not yet defined. When a class is defined later in the file, any reference to the yet-to-be-defined class is a <em class="italic">forward reference</em>. The forward references to the not-yet-defined <code class="Code-In-Text--PACKT-">TrainingData</code> class are provided as strings, not the simple class name. When <strong class="" style="font-style: italic;">mypy</strong> is analyzing the code, it resolves the strings into proper class names.</p>
    <p class="normal">The testing is <a id="_idIndexMarker167"/>defined by the following method:</p>
    <pre class="programlisting code"><code class="hljs-code">    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">test</span><span class="hljs-function">(</span><span class="hljs-params">self</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        <span class="hljs-string">"""Run the entire test suite."""</span>
        training_data: Optional[<span class="hljs-string">"TrainingData"</span>] = self.data()
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> training_data:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Broken Weak Reference"</span>)
        pass_count, fail_count = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> sample <span class="hljs-keyword">in</span> training_data.testing:
            sample.classification = self.classify(sample)
            <span class="hljs-keyword">if</span> sample.matches():
                pass_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span>:
                fail_count += <span class="hljs-number">1</span>
        self.quality = pass_count / (pass_count + fail_count)
</code></pre>
    <p class="normal">We start by resolving the weak reference to the training data. This will raise an exception if there's a problem. For each testing sample, we classify the sample, setting the sample's <code class="Code-In-Text--PACKT-">classification</code> attribute. The <code class="Code-In-Text--PACKT-">matches</code> method tells us if the model's classification matches the known species. Finally, the overall quality is measured by the fraction of tests that passed. We can use the integer count, or a floating-point ratio of tests passed out of the total number of tests.</p>
    <p class="normal">We won't look at the classification method in this chapter; we'll save that for <em class="chapterRef">Chapter 10</em>, <em class="italic">The Iterator Pattern</em>. Instead, we'll finish this model by looking at the <code class="Code-In-Text--PACKT-">TrainingData</code> class, which combines the elements seen so far.</p>
    <h2 id="_idParaDest-59" class="title">The TrainingData class</h2>
    <p class="normal">The <code class="Code-In-Text--PACKT-">TrainingData</code> class<a id="_idIndexMarker168"/> has lists with two subclasses of <code class="Code-In-Text--PACKT-">Sample</code> objects. The <code class="Code-In-Text--PACKT-">KnownSample</code> and <code class="Code-In-Text--PACKT-">UnknownSample</code> can be implemented as extensions to a common parent class, <code class="Code-In-Text--PACKT-">Sample</code>. </p>
    <p class="normal">We'll look at this from a number of perspectives in <em class="chapterRef">Chapter 7</em>. The <code class="Code-In-Text--PACKT-">TrainingData</code> class also has a list with <code class="Code-In-Text--PACKT-">Hyperparameter</code> instances. This class can have simple, direct references to previously defined classes.</p>
    <p class="normal">This class has the two methods that initiate the processing:</p>
    <ul>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">load()</code> method reads raw data and partitions it into training data and test data. Both of these are essentially <code class="Code-In-Text--PACKT-">KnownSample</code> instances with different purposes. The training subset is for evaluating the <em class="italic">k</em>-NN algorithm; the testing subset is for determining how well the <em class="italic">k</em> hyperparameter is working.</li>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">test()</code> method uses a <code class="Code-In-Text--PACKT-">Hyperparameter</code> object, performs the test, and saves the result.</li>
    </ul>
    <p class="normal">Looking back at <em class="chapterRef">Chapter 1</em>'s context diagram, we see three stories: <em class="italic">Provide Training Data</em>,<em class="italic"> Set Parameters and Test Classifier</em>, and<em class="italic"> Make Classification Request</em>. It seems helpful to add a method to perform a classification using a given <code class="Code-In-Text--PACKT-">Hyperparameter</code> instance. This would add a <code class="Code-In-Text--PACKT-">classify()</code> method to the <code class="Code-In-Text--PACKT-">TrainingData</code> class. Again, this was not clearly <a id="_idIndexMarker169"/>required at the beginning of our design work, but seems like a good idea now.</p>
    <p class="normal">Here's the start of the class definition:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">class</span><span class="hljs-class"> </span><span class="hljs-title">TrainingData</span><span class="hljs-class">:</span>
    <span class="hljs-string">"""A set of training data and testing data with methods to load and test the samples."""</span>
    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">__init__</span><span class="hljs-function">(</span><span class="hljs-params">self, name: </span><span class="hljs-built_in">str</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        self.name = name
        self.uploaded: datetime.datetime
        self.tested: datetime.datetime
        self.training: List[Sample] = []
        self.testing: List[Sample] = []
        self.tuning: List[Hyperparameter] = []
</code></pre>
    <p class="normal">We've defined a number of attributes to track the history of the changes to this class. The uploaded time and the tested time, for example, provide some history. The <code class="Code-In-Text--PACKT-">training</code>, <code class="Code-In-Text--PACKT-">testing</code>, and <code class="Code-In-Text--PACKT-">tuning</code> attributes have <code class="Code-In-Text--PACKT-">Sample</code> objects and <code class="Code-In-Text--PACKT-">Hyperparameter</code> objects.</p>
    <p class="normal">We won't write methods to set all of these. This is Python and direct access to attributes is a huge simplification to complex applications. The responsibilities are encapsulated in this class, but we don't generally write a lot of getter/setter methods. </p>
    <p class="normal">In <em class="chapterRef">Chapter 5</em>, <em class="italic">When to Use Object-Oriented Programming</em>, we'll look at some clever techniques, like Python's property definitions, additional ways to handle these attributes.</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">load()</code> method is designed to process data given by another object. We could have designed the <code class="Code-In-Text--PACKT-">load()</code> method to open and read a file, but then we'd bind the <code class="Code-In-Text--PACKT-">TrainingData</code> to a specific file format and logical layout. It seems better to isolate the details of the file format from the details of managing training data. In <em class="chapterRef">Chapter 5</em>, we'll look closely at reading and validating input. In <em class="chapterRef">Chapter 9</em>, <em class="italic">Strings, Serialization, and File Paths</em>, we'll revisit the file format considerations.</p>
    <p class="normal">For now, we'll <a id="_idIndexMarker170"/>use the following outline for acquiring the training data:</p>
    <pre class="programlisting code"><code class="hljs-code">    <span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">load</span><span class="hljs-function">(</span>
<span class="hljs-params">            self, </span>
<span class="hljs-params">            raw_data_source: Iterable[</span><span class="hljs-built_in">dict</span><span class="hljs-params">[</span><span class="hljs-built_in">str</span><span class="hljs-params">, </span><span class="hljs-built_in">str</span><span class="hljs-params">]]</span>
<span class="hljs-params">    </span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
        <span class="hljs-string">"""Load and partition the raw data"""</span>
        <span class="hljs-keyword">for</span> n, row <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(raw_data_source):
            ... <span class="hljs-built_in">filter</span> <span class="hljs-keyword">and</span> extract subsets (See Chapter <span class="hljs-number">6</span>)
            ... Create self.training <span class="hljs-keyword">and</span> self.testing subsets 
        self.uploaded = datetime.datetime.now(tz=datetime.timezone.utc)
</code></pre>
    <p class="normal">We'll depend on a source of data. We've described the properties of this source with a type hint, <code class="Code-In-Text--PACKT-">Iterable[dict[str, str]]</code>. The <code class="Code-In-Text--PACKT-">Iterable</code> states that the method's results can be used by a <code class="Code-In-Text--PACKT-">for</code> statement or the <code class="Code-In-Text--PACKT-">list</code> function. This is true of collections like lists and files. It's also true of generator functions, the subject of <em class="chapterRef">Chapter 10</em>, <em class="italic">The Iterator Pattern</em>.</p>
    <p class="normal">The results of this iterator need to be dictionaries that map strings to strings. This is a very general structure, and it allows us to require a dictionary that looks like this:</p>
    <pre class="programlisting code"><code class="hljs-code">{
    <span class="hljs-string">"sepal_length"</span>: <span class="hljs-number">5.1</span>, 
    <span class="hljs-string">"sepal_width"</span>: <span class="hljs-number">3.5</span>, 
    <span class="hljs-string">"petal_length"</span>: <span class="hljs-number">1.4</span>, 
    <span class="hljs-string">"petal_width"</span>: <span class="hljs-number">0.2</span>, 
    <span class="hljs-string">"species"</span>: <span class="hljs-string">"Iris-setosa"</span>
}
</code></pre>
    <p class="normal">This required structure seems flexible enough that we can build some object that will produce it. We'll look at the details in <em class="chapterRef">Chapter 9</em>.</p>
    <p class="normal">The remaining methods delegate most of their work to the <code class="Code-In-Text--PACKT-">Hyperparameter</code> class. Rather than do the work of classification, this class relies on another class to do the work:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">test</span><span class="hljs-function">(</span>
<span class="hljs-params">        self, </span>
<span class="hljs-params">        parameter: Hyperparameter</span><span class="hljs-function">) -&gt; </span><span class="hljs-keyword">None</span><span class="hljs-function">:</span>
    <span class="hljs-string">"""Test this Hyperparameter value."""</span>
    parameter.test()
    self.tuning.append(parameter)
    self.tested = datetime.datetime.now(tz=datetime.timezone.utc)
<span class="hljs-keyword">def</span><span class="hljs-function"> </span><span class="hljs-title">classify</span><span class="hljs-function">(</span>
<span class="hljs-params">        self, </span>
<span class="hljs-params">        parameter: Hyperparameter, </span>
<span class="hljs-params">        sample: Sample</span><span class="hljs-function">) -&gt; Sample:</span>
    <span class="hljs-string">"""Classify this Sample."""</span>
    classification = parameter.classify(sample)
    sample.classify(classification)
    <span class="hljs-keyword">return</span> sample
</code></pre>
    <p class="normal">In both cases, a specific <code class="Code-In-Text--PACKT-">Hyperparameter</code> object is provided as a parameter. For testing, this makes sense because each test should have a distinct value. For classification, however, the "best" <code class="Code-In-Text--PACKT-">Hyperparameter</code> object should be used for classification. </p>
    <p class="normal">This part of<a id="_idIndexMarker171"/> the case study has built class definitions for <code class="Code-In-Text--PACKT-">Sample</code>, <code class="Code-In-Text--PACKT-">KnownSample</code>, <code class="Code-In-Text--PACKT-">TrainingData</code>, and <code class="Code-In-Text--PACKT-">Hyperparameter</code>. These classes capture parts of the overall application. This isn't complete, of course; we've omitted some important algorithms. It's good to start with things that are clear, identify behavior and state change, and define the responsibilities. The next pass of design can then fill in details around this existing framework.</p>
    <h1 id="_idParaDest-60" class="title">Recall</h1>
    <p class="normal">Some key points in this chapter:</p>
    <ul>
      <li class="bullet">Python has optional type hints to help describe how data objects are related and what the parameters should be for methods and functions.</li>
      <li class="bullet">We create Python classes with the <code class="Code-In-Text--PACKT-">class</code> statement. We should initialize the attributes in the special <code class="Code-In-Text--PACKT-">__init__()</code> method.</li>
      <li class="bullet">Modules and packages are used as higher-level groupings of classes.</li>
      <li class="bullet">We need to plan out the organization of module content. While the general advice is "flat is better than nested," there are a few cases where it can be helpful to have nested packages.</li>
      <li class="bullet">Python has no notion of "private" data. We often say "we're all adults here"; we can see the source code, and private declarations aren't very helpful. This doesn't change our design; it simply removes the need for a handful of keywords.</li>
      <li class="bullet">We can install third-party packages using PIP tools. We can create a virtual environment, for example, with <code class="Code-In-Text--PACKT-">venv</code>.</li>
    </ul>
    <h1 id="_idParaDest-61" class="title">Exercises</h1>
    <p class="normal">Write some object-oriented code. The goal is to use the principles and syntax you learned in this chapter to ensure you understand the topics we've covered. If you've been working on a Python project, go back over it and see whether there are some objects you can create and add properties or methods to. If it's large, try dividing it into a few modules or even packages and play with the syntax. While a "simple" script may expand when refactored into classes, there's generally a gain in flexibility and extensibility.</p>
    <p class="normal">If you don't have such a project, try starting a new one. It doesn't have to be something you intend to finish; just stub out some basic design parts. You don't need to fully implement everything; often, just a <code class="Code-In-Text--PACKT-">print("this method will do something")</code> is all you need to get the overall design in place. This is called <strong class="keyword">top-down design</strong>, in which you work out the different interactions and describe how they should work before actually implementing what they do. The converse, <strong class="keyword">bottom-up design</strong>, implements details first and then ties them all together. Both patterns are useful at different times, but for understanding object-oriented principles, a top-down workflow is more suitable.</p>
    <p class="normal">If you're having trouble coming up with ideas, try writing a to-do application. It can keep track of things you want to do each day. Items can have a state change from incomplete to completed. You might want to think about items that have an intermediate state of started, but not yet completed.</p>
    <p class="normal">Now try designing a bigger project. A collection of classes to model playing cards can be an interesting challenge. Cards have a few features, but there are many variations on the rules. A class for a hand of cards has interesting state changes as cards are added. Locate a game you like and create classes to model cards, hands, and play. (Don't tackle creating a winning strategy; that can be hard.) </p>
    <p class="normal">A game like Cribbage has an interesting state change where two cards from each player's hand are used to create a kind of third hand, called "the crib." Make sure you experiment with the package and module-importing syntax. Add some functions in various modules and try importing them from other modules and packages. Use relative and absolute imports. See the difference, and try to imagine scenarios where you would want to use each one.</p>
    <h1 id="_idParaDest-62" class="title">Summary</h1>
    <p class="normal">In this chapter, we learned how simple it is to create classes and assign properties and methods in Python. Unlike many languages, Python differentiates between a constructor and an initializer. It has a relaxed attitude toward access control. There are many different levels of scope, including packages, modules, classes, and functions. We understood the difference between relative and absolute imports, and how to manage third-party packages that don't come with Python.</p>
    <p class="normal">In the next chapter, we'll learn more about sharing implementation using inheritance.</p>
  </div>
</body></html>