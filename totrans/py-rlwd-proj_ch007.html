<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<title>ch007.xhtml</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body epub:type="bodymatter">
<section class="level1" data-number="7" id="chapter-3-project-1.1-data-acquisition-base-application">
<h1 data-number="7"><span class="titlemark"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 3</span></span><br/>
<span id="x1-560003"/><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Project 1.1: Data Acquisition Base Application</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">The beginning of the data pipeline is acquiring the raw data from various sources. </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">This chapter has a single </span><span id="dx1-56001"/><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">project to create a </span><strong><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">command-line</span></strong> <strong><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">application </span></strong><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">CLI</span></strong><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">) that extracts relevant data from files in CSV format. </span><span class="koboSpan" id="kobo.9.2" xmlns="http://www.w3.org/1999/xhtml">This initial application will restructure the raw data into a more useful form. </span><span class="koboSpan" id="kobo.9.3" xmlns="http://www.w3.org/1999/xhtml">Later projects (starting in </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml"> 9</span></em></a><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.1: Data Cleaning Base</span></em> <em><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Application</span></em></a><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">) will add features for cleaning and validating the data.</span></p>
<p><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">This chapter’s project covers the following essential skills:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">Application design in general. </span><span class="koboSpan" id="kobo.17.2" xmlns="http://www.w3.org/1999/xhtml">This includes an object-oriented design and the SOLID design principles, as well as functional design.</span></p></li>
<li><p><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">A few CSV file processing techniques. </span><span class="koboSpan" id="kobo.18.2" xmlns="http://www.w3.org/1999/xhtml">This is a large subject area, and the project focuses on restructuring source data into a more usable form.</span></p></li>
<li><p><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">CLI application construction.</span></p></li>
<li><p><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Creating acceptance tests using the Gherkin language and </span><strong><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">behave</span></strong><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml"> step definitions.</span></p></li>
<li><p><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">Creating unit tests with mock objects.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">We’ll start with a description of the application, and then move on to talk about the architecture and construction. </span><span class="koboSpan" id="kobo.24.2" xmlns="http://www.w3.org/1999/xhtml">This will be followed by a detailed list of deliverables. </span><span id="x1-56002r57"/></p>
<section class="level2" data-number="7.1" id="description-1">
<h2 data-number="7.1"><span class="titlemark"><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">3.1 </span></span> <span id="x1-570001"/><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></h2>
<p><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">Analysts and decision-makers need to acquire data for further analysis. </span><span class="koboSpan" id="kobo.27.2" xmlns="http://www.w3.org/1999/xhtml">In many cases, the data is available in CSV-formatted files. </span><span class="koboSpan" id="kobo.27.3" xmlns="http://www.w3.org/1999/xhtml">These files may be extracts from databases or downloads from web services.</span></p>
<p><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">For testing purposes, it’s helpful to </span><span id="dx1-57001"/><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">start with something relatively small. </span><span class="koboSpan" id="kobo.29.2" xmlns="http://www.w3.org/1999/xhtml">Some of the Kaggle data sets are very, very large, and require sophisticated application design. </span><span class="koboSpan" id="kobo.29.3" xmlns="http://www.w3.org/1999/xhtml">One of the most fun small data sets to work with is Anscombe’s Quartet. </span><span class="koboSpan" id="kobo.29.4" xmlns="http://www.w3.org/1999/xhtml">This can serve as a test case to understand the issues and concerns in acquiring raw data.</span></p>
<p><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">We’re interested in a few key </span><span id="dx1-57002"/><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">features of an application to acquire data:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">When gathering data from multiple sources, it’s imperative to convert it to a common format. </span><span class="koboSpan" id="kobo.32.2" xmlns="http://www.w3.org/1999/xhtml">Data sources vary, and will often change with software upgrades. </span><span class="koboSpan" id="kobo.32.3" xmlns="http://www.w3.org/1999/xhtml">The acquisition process needs to be flexible with respect to data sources and avoid assumptions about formats.</span></p></li>
<li><p><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">A CLI application permits a variety of automation possibilities. </span><span class="koboSpan" id="kobo.33.2" xmlns="http://www.w3.org/1999/xhtml">For example, a CLI application can be ”wrapped” to create a web service. </span><span class="koboSpan" id="kobo.33.3" xmlns="http://www.w3.org/1999/xhtml">It can be run from the command line manually, and it can be automated through enterprise job scheduling applications.</span></p></li>
<li><p><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">The application must be extensible to reflect source changes. </span><span class="koboSpan" id="kobo.34.2" xmlns="http://www.w3.org/1999/xhtml">In many cases, enterprise changes are not communicated widely enough, and data analysis applications discover changes ”the hard way” — a source of data suddenly includes unexpected or seemingly invalid values.</span></p></li>
</ul>
<p><span id="x1-57003r47"/></p>
<section class="level3" data-number="7.1.1" id="user-experience">
<h3 data-number="7.1.1"><span class="titlemark"><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">3.1.1 </span></span> <span id="x1-580001"/><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">User experience</span></h3>
<p><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">User Experience </span></strong><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">UX</span></strong><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">) will be a command-line application with options to fine-tune the data being gathered. </span><span class="koboSpan" id="kobo.41.2" xmlns="http://www.w3.org/1999/xhtml">This essential UX </span><span id="dx1-58001"/><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">pattern will be used for many of this book’s projects. </span><span class="koboSpan" id="kobo.42.2" xmlns="http://www.w3.org/1999/xhtml">It’s flexible </span><span id="dx1-58002"/><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">and can be made to run almost anywhere.</span></p>
<p><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">Our expected command line should look something like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-25">
<div class="tcolorbox-content">
<pre class="console"><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">% python src/acquire.py -o quartet Anscombe_quartet_data.csv</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">-o</span></code><code><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml"> quartet</span></code><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml"> argument specifies a directory into which the resulting extracts are written. </span><span class="koboSpan" id="kobo.49.2" xmlns="http://www.w3.org/1999/xhtml">The source file contains four separate series of data. </span><span class="koboSpan" id="kobo.49.3" xmlns="http://www.w3.org/1999/xhtml">Each of the series can be given an unimaginative name like </span><code><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">quartet/series_1.json</span></code><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">The positional argument, </span><code><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml">Anscombe_quartet_data.csv</span></code><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">, is the name of the downloaded source file.</span></p>
<p><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">While there’s only one file – at the present time – a good design will work with multiple input files and multiple source file formats.</span></p>
<p><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">In some cases, a more sophisticated ”dashboard” or ”control panel” application might be desirable as a way to oversee the operation of the data acquisition process. </span><span class="koboSpan" id="kobo.56.2" xmlns="http://www.w3.org/1999/xhtml">The use of a web-based API can provide a very rich interactive experience. </span><span class="koboSpan" id="kobo.56.3" xmlns="http://www.w3.org/1999/xhtml">An alternative is to use tools like </span><strong><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">rich </span></strong><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">or </span><strong><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">Textual </span></strong><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">to build a small text-based display. </span><span class="koboSpan" id="kobo.60.2" xmlns="http://www.w3.org/1999/xhtml">Either of these choices should be built as a wrapper that executes the essential CLI application as a subprocess.</span></p>
<p><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">Now that we’ve seen an overview of the application’s purpose and UX, let’s take a look at the source data. </span><span id="x1-58004r60"/></p>
</section>
<section class="level3" data-number="7.1.2" id="about-the-source-data">
<h3 data-number="7.1.2"><span class="titlemark"><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">3.1.2 </span></span> <span id="x1-590002"/><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">About the source data</span></h3>
<p><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">Here’s </span><span id="dx1-59001"/><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">the link to the </span><span id="dx1-59002"/><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">dataset we’ll be using:</span></p>
<p><a class="url" href="https://www.kaggle.com/datasets/carlmcbrideellis/data-anscombes-quartet"><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">https://www.kaggle.com/datasets/carlmcbrideellis/data-anscombes-quartet</span></a></p>
<p><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">You’ll need to register with Kaggle to download this data.</span></p>
<p><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">The Kaggle URL presents a page with information about the CSV-formatted file. </span><span class="koboSpan" id="kobo.69.2" xmlns="http://www.w3.org/1999/xhtml">Clicking the </span><strong><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">Download </span></strong><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">button will download the small file of data to your local computer.</span></p>
<p><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">The data is available in this book’s GitHub repository’s </span><code><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">data</span></code><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml"> folder, also.</span></p>
<p><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">Once the data is downloaded, you can open the </span><code><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">Anscombe_quartet_data.csv</span></code><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml"> file to inspect the raw data.</span></p>
<p><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">The file contains four series of (</span><em><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">x,y</span></em><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">) pairs in each row. </span><span class="koboSpan" id="kobo.80.2" xmlns="http://www.w3.org/1999/xhtml">We can imagine each row as having [(</span><em><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">x</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span></sub><em><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">,y</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span></sub><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">)</span><em><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">,</span></em><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">x</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span></sub><em><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">,y</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span></sub><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">)</span><em><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">,</span></em><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">x</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span></sub><em><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">,y</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span></sub><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">)</span><em><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">,</span></em><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">x</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">4</span></span></sub><em><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">,y</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">4</span></span></sub><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">)]. </span><span class="koboSpan" id="kobo.106.2" xmlns="http://www.w3.org/1999/xhtml">It is, however, compressed, as we’ll see below.</span></p>
<p><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">We might depict the idea behind </span><span id="dx1-59003"/><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">this data with an entity-relationship diagram as shown in </span><a href="#3.1"><em><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.1</span></em></a><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<figure class="IMG---Figure">
<span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.1: Notional entity-relationship diagram " src="../media/file8.jpg"/></span>
<figcaption class="IMG---Caption"><span class="id" id="3.1"><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.1: </span></span><span class="content"><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">Notional entity-relationship diagram </span></span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">Interestingly, the data is not organized as four separate (</span><em><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">x,y</span></em><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">) pairs. </span><span class="koboSpan" id="kobo.116.2" xmlns="http://www.w3.org/1999/xhtml">The downloaded file is organized as follows:</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="[x1,2,3,y1,y2,y3,x4,y4] " class="math-display" src="../media/file9.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">We can depict the actual source entity type in an ERD, as shown in </span><a href="#3.2"><em><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.2</span></em></a><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<figure class="IMG---Figure">
<span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.2: Source entity-relationship diagram " src="../media/file10.jpg"/></span>
<figcaption class="IMG---Caption"><span class="id" id="3.2"><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.2: </span></span><span class="content"><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">Source entity-relationship diagram </span></span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">One part of this application’s purpose is to disentangle the four series into separate files. </span><span class="koboSpan" id="kobo.124.2" xmlns="http://www.w3.org/1999/xhtml">This forces us to write some transformational processing to rearrange each row’s data elements into four separate data sets.</span></p>
<p><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">The separate series can then be saved into four separate files. </span><span class="koboSpan" id="kobo.125.2" xmlns="http://www.w3.org/1999/xhtml">We’ll look more deeply at the details of creating the separate files for a separate project in </span><a href="ch015.xhtml#x1-26400011"><em><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml"> 11</span></em></a><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch015.xhtml#x1-26400011"><em><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.7: Interim Data Persistence</span></em></a><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.130.2" xmlns="http://www.w3.org/1999/xhtml">For this project, any file format for the four output files will do nicely; ND JSON serialization is often ideal.</span></p>
<p><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">We encourage you to take a </span><span id="dx1-59008"/><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">look at the file before moving on to consider how it needs to be transformed into distinct output files.</span></p>
<p><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">Given this compressed file of source data, the next section will look at the expanded output files. </span><span class="koboSpan" id="kobo.133.2" xmlns="http://www.w3.org/1999/xhtml">These will separate each series to make them easier to work with. </span><span id="x1-59009r61"/></p>
</section>
<section class="level3" data-number="7.1.3" id="about-the-output-data">
<h3 data-number="7.1.3"><span class="titlemark"><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">3.1.3 </span></span> <span id="x1-600003"/><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">About the output data</span></h3>
<p><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">The ND JSON file format is </span><span id="dx1-60001"/><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">described in </span><a class="url" href="http://ndjson.org"><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">http://ndjson.org</span></a><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><a class="url" href="https://jsonlines.org"><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">https://jsonlines.org</span></a><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.141.2" xmlns="http://www.w3.org/1999/xhtml">The idea is to put </span><span id="dx1-60002"/><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">each individual entity into a JSON document written as a single physical line. </span><span class="koboSpan" id="kobo.142.2" xmlns="http://www.w3.org/1999/xhtml">This fits with the way the Python </span><code><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">json.dumps()</span></code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml"> function works: if no value is provided for the </span><code><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">indent</span></code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml"> parameter (or if the value is </span><code><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">indent=None</span></code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">), the text will be as compact as possible.</span></p>
<p><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">series_1.json</span></code><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml"> output file should start like this:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml">{"x": "10.0", "y": "8.04"}
{"x": "8.0", "y": "6.95"}
{"x": "13.0", "y": "7.58"}
...</span></pre>
<p><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">Each row is a distinct, small JSON document. </span><span class="koboSpan" id="kobo.153.2" xmlns="http://www.w3.org/1999/xhtml">The row is built from a subset of fields in the input file. </span><span class="koboSpan" id="kobo.153.3" xmlns="http://www.w3.org/1999/xhtml">The values are strings: we won’t be attempting any conversions until the cleaning and validating projects in </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml"> 9</span></em></a><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.1:</span></em> <em><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">Data Cleaning Base Application</span></em></a><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">We’ll require the user who runs this application to create a directory for the output and provide the name of the directory on the command line. </span><span class="koboSpan" id="kobo.160.2" xmlns="http://www.w3.org/1999/xhtml">This means the application needs to present useful error messages if the directory doesn’t actually exist. </span><span class="koboSpan" id="kobo.160.3" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">pathlib.Path</span></code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml"> class is very helpful for confirming a directory exists.</span></p>
<p><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">Further, the application </span><span id="dx1-60003"/><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml">should be cautious about overwriting any existing files. </span><span class="koboSpan" id="kobo.164.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">pathlib.Path</span></code><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml"> class is very helpful for confirming a file already exists.</span></p>
<p><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">This section has looked at the input, processing, and output of this application. </span><span class="koboSpan" id="kobo.167.2" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at the overall architecture of the software. </span><span id="x1-60004r59"/></p>
</section>
</section>
<section class="level2" data-number="7.2" id="architectural-approach">
<h2 data-number="7.2"><span class="titlemark"><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">3.2 </span></span> <span id="x1-610002"/><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml">Architectural approach</span></h2>
<p><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">We’ll take some </span><span id="dx1-61001"/><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml">guidance from the C4 model ( </span><a class="url" href="https://c4model.com"><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">https://c4model.com</span></a><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">) when looking at our approach.</span></p>
<ul>
<li><p><strong><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">Context</span></strong><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">: For this project, a context diagram </span><span id="dx1-61002"/><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">would show a user extracting data from a source. </span><span class="koboSpan" id="kobo.176.2" xmlns="http://www.w3.org/1999/xhtml">You may find it helpful to draw this diagram.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">Containers</span></strong><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">: This project will run on the user’s personal computer. </span><span class="koboSpan" id="kobo.178.2" xmlns="http://www.w3.org/1999/xhtml">As with the context, the diagram is small, but some readers may find it helpful to take the time to draw it.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">Components</span></strong><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">: We’ll address these below.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">Code</span></strong><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">: We’ll touch on this to provide some suggested directions.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">We can decompose the software architecture into these two important components:</span></p>
<ul>
<li><p><code><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">: This module has definitions of target objects. </span><span class="koboSpan" id="kobo.185.2" xmlns="http://www.w3.org/1999/xhtml">In this project, there’s only a single class here.</span></p></li>
<li><p><code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">extract</span></code><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">: This module will read the source document and creates model objects.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">Additionally, there will need to be these additional functions:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">A function for parsing the command-line options.</span></p></li>
<li><p><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">A </span><code><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml"> function to parse options and do the file processing.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">As suggested in </span><a href="ch005.xhtml#x1-170001"><em><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml"> 1</span></em></a><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch005.xhtml#x1-170001"><em><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">Project Zero: A Template for Other Projects</span></em></a><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml">, the initialization of logging will often look like the following example:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-26">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    main()</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">The idea is to write the </span><code><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml"> function in a way that maximizes reuse. </span><span class="koboSpan" id="kobo.202.2" xmlns="http://www.w3.org/1999/xhtml">Avoiding logging initialization means other applications can more easily import this application’s </span><code><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml"> function to reuse the data acquisition features.</span></p>
<p><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">Initializing logging within the </span><code><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml"> function can undo previous logging initialization. </span><span class="koboSpan" id="kobo.207.2" xmlns="http://www.w3.org/1999/xhtml">While there are ways to have a composite application tolerate each </span><code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml"> function doing yet another initialization of logging, it seems simpler to refactor this functionality outside the important processing.</span></p>
<p><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">For this project, we’ll look at two </span><span id="dx1-61006"/><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">general design approaches for the model and extract components. </span><span class="koboSpan" id="kobo.211.2" xmlns="http://www.w3.org/1999/xhtml">We’ll utilize this opportunity to highlight the importance of adhering to SOLID design principles.</span></p>
<p><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">First, we’ll show an object-oriented design using class definitions. </span><span class="koboSpan" id="kobo.212.2" xmlns="http://www.w3.org/1999/xhtml">After that, we’ll show a functional design, using only functions and stateless objects. </span><span id="x1-61007r64"/></p>
<section class="level3" data-number="7.2.1" id="class-design">
<h3 data-number="7.2.1"><span class="titlemark"><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">3.2.1 </span></span> <span id="x1-620001"/><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">Class design</span></h3>
<p><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">One possible structure for the classes and functions of this application is shown in </span><a href="#3.3"><em><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.3</span></em></a><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<figure class="IMG---Figure">
<span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 3.3: Acquisition Application Model " src="../media/file11.jpg"/></span>
<figcaption class="IMG---Caption"><span class="id" id="3.3"><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">Figure 3.3: </span></span><span class="content"><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">Acquisition Application Model </span></span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml"> module contains a single </span><span id="dx1-62003"/><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">class definition for the raw </span><code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.226.2" xmlns="http://www.w3.org/1999/xhtml">Later, this is likely to expand and change. </span><span class="koboSpan" id="kobo.226.3" xmlns="http://www.w3.org/1999/xhtml">For now, it can seem like over-engineering.</span></p>
<p><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">acquisition</span></code><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml"> module contains a </span><span id="dx1-62004"/><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">number of classes that collaborate to build </span><code><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml"> objects for any of the four series. </span><span class="koboSpan" id="kobo.232.2" xmlns="http://www.w3.org/1999/xhtml">The abstract </span><code><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml"> class defines the general features of creating an </span><code><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml"> object.</span></p>
<p><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml">Each subclass of the </span><code><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml"> class has a slightly different implementation. </span><span class="koboSpan" id="kobo.239.2" xmlns="http://www.w3.org/1999/xhtml">Specifically, the </span><code><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">Series1Pair</span></code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml"> class has a </span><code><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">from_row()</span></code><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml"> method that assembles a pair from the </span><em><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">x</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span><span class="cmmi-8"><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="cmr-8"><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span><span class="cmmi-8"><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">,</span></span><span class="cmr-8"><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">3</span></span></sub><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">y</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span></sub><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml"> values. </span><span class="koboSpan" id="kobo.253.2" xmlns="http://www.w3.org/1999/xhtml">Not shown in the diagram are the three other subclasses that use distinct pairs of columns to create </span><code><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml"> objects from the four </span><span id="dx1-62005"/><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">series.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-27">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">The diagram and most of the examples here use </span><code><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">list[str]</span></code><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml"> as the type for a row from a CSV reader.</span></p>
<p><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">If a </span><code><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">csv.DictReader</span></code><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml"> is used, the source changes from </span><code><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">list[str]</span></code><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml"> to</span></p>
<p><code><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">dict[str,</span></code><code><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml"> str]</span></code><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.267.2" xmlns="http://www.w3.org/1999/xhtml">This small, but important, change will ripple throughout the examples.</span></p>
<p><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">In many cases, it seems like a </span><code><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">csv.DictReader</span></code><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml"> is a better choice. </span><span class="koboSpan" id="kobo.270.2" xmlns="http://www.w3.org/1999/xhtml">Column names can be provided if the CSV file does not have names in the first row.</span></p>
<p><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">We’ve left the revisions needed for this change as part of the design work for you.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">The overall </span><code><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml"> class embodies the </span><span id="dx1-62006"/><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">various algorithms for using an instance of the </span><code><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml"> class and a </span><span id="dx1-62007"/><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">row of source data to build </span><code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml"> instances. </span><span class="koboSpan" id="kobo.280.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">build_pair(list[str])</span></code><code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml"> -&gt;</span></code><code><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml"> XYPair</span></code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml"> method makes a single item from a row parsed from a CSV file.</span></p>
<p><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">The job of the </span><code><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml"> function is to create instances of each of the four </span><code><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses. </span><span class="koboSpan" id="kobo.289.2" xmlns="http://www.w3.org/1999/xhtml">These instances are then used to create four instances of the </span><code><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.291.2" xmlns="http://www.w3.org/1999/xhtml">These four </span><code><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml"> objects can then build four </span><code><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml"> objects from each source row.</span></p>
<p><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">dataclass.asdict()</span></code><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml"> function can be </span><span id="dx1-62008"/><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">used to convert an </span><code><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml"> object into a </span><code><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">dict[str,</span></code><code><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml"> str]</span></code><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml"> object. </span><span class="koboSpan" id="kobo.304.2" xmlns="http://www.w3.org/1999/xhtml">This can be serialized by </span><code><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">json.dumps()</span></code><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml"> and written to an appropriate output file. </span><span class="koboSpan" id="kobo.306.2" xmlns="http://www.w3.org/1999/xhtml">This conversion operation seems like a good choice for a method in the abstract </span><code><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.308.2" xmlns="http://www.w3.org/1999/xhtml">This can be used to write an </span><code><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml"> object to an open file.</span></p>
<p><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">The top-level functions, </span><code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">get_options()</span></code><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml">, can be </span><span id="dx1-62009"/><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">placed in a separate module, named </span><code><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">acquisition</span></code><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.318.2" xmlns="http://www.w3.org/1999/xhtml">This module </span><span id="dx1-62010"/><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">will import the various </span><span id="dx1-62011"/><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">class definitions from the </span><code><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml"> modules.</span></p>
<p><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">It’s often helpful to </span><span id="dx1-62012"/><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">review the SOLID design principles. </span><span class="koboSpan" id="kobo.326.2" xmlns="http://www.w3.org/1999/xhtml">In particular, we’ll look closely at the </span><strong><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">Dependency Inversion principle</span></strong><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span id="x1-62013r66"/></p>
</section>
<section class="level3" data-number="7.2.2" id="design-principles">
<h3 data-number="7.2.2"><span class="titlemark"><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">3.2.2 </span></span> <span id="x1-630002"/><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">Design principles</span></h3>
<p><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml">We can look at the SOLID </span><span id="dx1-63001"/><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">design principles to be </span><span id="dx1-63002"/><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">sure that the object-oriented design follows those principles.</span></p>
<ul>
<li><p><strong><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">Single Responsibility</span></strong><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">: Each of the classes </span><span id="dx1-63003"/><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml">seems to have a single responsibility.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">Open-Closed</span></strong><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml">: Each class seems </span><span id="dx1-63004"/><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">open to extension by adding subclasses.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">Liskov Substitution</span></strong><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml">: The </span><code><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml"> class hierarchy </span><span id="dx1-63005"/><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">follows this principle since each subclass is identical to the parent class.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">Interface Segregation</span></strong><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">: The interfaces for </span><span id="dx1-63006"/><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml">each class are minimized.</span></p></li>
<li><p><strong><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">Dependency Inversion</span></strong><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">: There’s a </span><span id="dx1-63007"/><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">subtle issue regarding dependencies among classes. </span><span class="koboSpan" id="kobo.350.2" xmlns="http://www.w3.org/1999/xhtml">We’ll look at this in some detail.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">One of the SOLID design principles suggests avoiding tight coupling between the </span><code><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses and the </span><code><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.355.2" xmlns="http://www.w3.org/1999/xhtml">The idea would be to provide a protocol (or interface) for the </span><code><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.357.2" xmlns="http://www.w3.org/1999/xhtml">Using the protocol in type annotations would permit any type that implemented the protocol to be provided to the class. </span><span class="koboSpan" id="kobo.357.3" xmlns="http://www.w3.org/1999/xhtml">Using a protocol would break a direct dependency between the </span><code><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses and the </span><code><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<p><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml">This object-oriented design </span><span id="dx1-63008"/><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">issue surfaces often, and generally leads to drawn-out, careful thinking about the relationships among classes and the SOLID design principles.</span></p>
<p><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml">We have the following choices:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">Have a direct reference to the </span><code><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml"> class inside the </span><code><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.369.2" xmlns="http://www.w3.org/1999/xhtml">This would be </span><code><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">def</span></code><code><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml"> from_row(row:</span></code><code><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml"> list[str])</span></code><code><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml"> -&gt;</span></code><code><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml"> XYPair:</span></code><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.375.2" xmlns="http://www.w3.org/1999/xhtml">This breaks the Dependency Inversion principle.</span></p></li>
<li><p><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">Use </span><code><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">Any</span></code><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml"> as the type annotation. </span><span class="koboSpan" id="kobo.378.2" xmlns="http://www.w3.org/1999/xhtml">This would be </span><code><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">def</span></code><code><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml"> from_row(row:</span></code><code><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml"> list[str])</span></code><code><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml"> -&gt;</span></code><code><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml"> Any:</span></code><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.384.2" xmlns="http://www.w3.org/1999/xhtml">This makes the type hints less informative.</span></p></li>
<li><p><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">Attempt to create a protocol for the resulting type, and use this in the type hints.</span></p></li>
<li><p><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml">Introduce a type alias that (for now) only has one value. </span><span class="koboSpan" id="kobo.386.2" xmlns="http://www.w3.org/1999/xhtml">In future expansions of the </span><code><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml"> module, additional types might be introduced.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml">The fourth alternative gives us the flexibility we need for type annotation checking. </span><span class="koboSpan" id="kobo.389.2" xmlns="http://www.w3.org/1999/xhtml">The idea is to include a type alias like the following in the </span><code><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml"> module:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-28">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">from dataclasses import dataclass
from typing import TypeAlias

@dataclass
class XYPair:
    # Definition goes here

RawData: TypeAlias = XYPair</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml">As alternative classes are introduced, the definition of </span><code><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml"> can be expanded to include the alternatives. </span><span class="koboSpan" id="kobo.395.2" xmlns="http://www.w3.org/1999/xhtml">This might evolve to look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-29">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml">from dataclasses import dataclass
from typing import TypeAlias

@dataclass
class XYPair:
    # Definition goes here
    pass

@dataclass
class SomeOtherStructure:
    # Some other definition, here
    pass

RawData: TypeAlias = XYPair | SomeOtherStructure</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">This permits extension to the </span><code><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses as the </span><code><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml"> module evolves. </span><span class="koboSpan" id="kobo.401.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml"> definition needs to be changed as new classes are introduced. </span><span class="koboSpan" id="kobo.403.2" xmlns="http://www.w3.org/1999/xhtml">Annotation-checking tools like </span><strong><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">mypy </span></strong><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">cannot spot the invalid use of any of the classes that comprise the alternative definitions of the </span><code><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml"> type alias.</span></p>
<p><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">Throughout the rest of the application, classes and functions can use </span><code><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml"> as an abstract class definition. </span><span class="koboSpan" id="kobo.410.2" xmlns="http://www.w3.org/1999/xhtml">This name represents a </span><span id="dx1-63031"/><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml">number of alternative definitions, any one of which might be used at run-time.</span></p>
<p><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">With this definition of </span><code><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">, the </span><code><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses can use a definition of the following form:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-30">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">from model import RawData, XYPair
from abc import ABC, abstractmethod

class PairBuilder(ABC):
    target_class: type[RawData]

    @abstractmethod
    def from_row(self, row: list[str]) -&gt; RawData:
        ...

</span><span class="koboSpan" id="kobo.417.2" xmlns="http://www.w3.org/1999/xhtml">class Series1Pair(PairBuilder):
    target_class = XYPair

    def from_row(self, row: list[str]) -&gt; RawData:
        cls = self.target_class
        # the rest of the implementation...
        </span><span class="koboSpan" id="kobo.417.3" xmlns="http://www.w3.org/1999/xhtml"># return cls(arguments based on the value of row)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">A similar analysis holds for the </span><code><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.420.2" xmlns="http://www.w3.org/1999/xhtml">This can be directly tied to the </span><code><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml"> class and the various subclasses of the </span><code><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.424.2" xmlns="http://www.w3.org/1999/xhtml">It’s very important for these classes to be injected at run time, generally based on command-line arguments.</span></p>
<p><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">For now, it’s easiest to provide the </span><span id="dx1-63049"/><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">class names as default values. </span><span class="koboSpan" id="kobo.426.2" xmlns="http://www.w3.org/1999/xhtml">A function like the following might be used to get options and configuration parameters:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-31">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml">def get_options(argv: list[str]) -&gt; argparse.Namespace:
    defaults = argparse.Namespace(
        extract_class=Extract,
        series_classes=[Series1Pair, Series2Pair, Series3Pair, Series4Pair],
    )</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml">defaults</span></code><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml"> namespace is provided as an argument value to the </span><code><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">ArgumentParser.parse_args()</span></code><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.432.2" xmlns="http://www.w3.org/1999/xhtml">This set of defaults serves as a kind of dependency injection throughout the application. </span><span class="koboSpan" id="kobo.432.3" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">main</span></code><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml"> function can use these class names to build an instance of the given extract class, and then process the given source files.</span></p>
<p><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml">A more advanced CLI could provide options and arguments to tailor the class names. </span><span class="koboSpan" id="kobo.435.2" xmlns="http://www.w3.org/1999/xhtml">For more complex applications, these class names would be read from a configuration file.</span></p>
<p><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml">An alternative to the object-oriented design is a functional design. </span><span class="koboSpan" id="kobo.436.2" xmlns="http://www.w3.org/1999/xhtml">We’ll look at that alternative in the next section. </span><span id="x1-63055r68"/></p>
</section>
<section class="level3" data-number="7.2.3" id="functional-design">
<h3 data-number="7.2.3"><span class="titlemark"><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml">3.2.3 </span></span> <span id="x1-640003"/><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">Functional design</span></h3>
<p><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">The general module structure shown in </span><a href="#x1-620001"><em><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">Class design</span></em></a><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml"> applies to a functional design also. </span><span class="koboSpan" id="kobo.441.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml"> module with a </span><span id="dx1-64001"/><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">single class definition is also a part of a functional design; this kind of module with a collection of dataclass definitions is often ideal.</span></p>
<p><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">As noted above in the </span><a href="#x1-630002"><em><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">Design principles</span></em></a><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml"> section, the </span><code><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml"> module is best served by using a type variable, </span><code><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml">, as a placeholder for any additional types that may be developed.</span></p>
<p><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml"> module will use a </span><span id="dx1-64002"/><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">collection of independent functions to build </span><code><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml"> objects. </span><span class="koboSpan" id="kobo.457.2" xmlns="http://www.w3.org/1999/xhtml">Each function will be similar in design.</span></p>
<p><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml">Here are some example functions with type annotations:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-32">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">def series_1_pair(row: list[str]) -&gt; RawData:
    ...

</span><span class="koboSpan" id="kobo.459.2" xmlns="http://www.w3.org/1999/xhtml">def series_2_pair(row: list[str]) -&gt; RawData:
    ...

</span><span class="koboSpan" id="kobo.459.3" xmlns="http://www.w3.org/1999/xhtml">def series_3_pair(row: list[str]) -&gt; RawData:
    ...

</span><span class="koboSpan" id="kobo.459.4" xmlns="http://www.w3.org/1999/xhtml">def series_4_pair(row: list[str]) -&gt; RawData:
    ...</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml">These functions can then be used by an </span><code><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">extract()</span></code><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml"> function to create the </span><code><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml"> objects for each of the four series represented by a single row of the source file.</span></p>
<p><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">One possibility is to use the following kind of definition:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-33">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">SeriesBuilder: TypeVar = Callable[[list[str]], RawData]

def extract(row: list[str], builders: list[SeriesBuilder]) -&gt; list[RawData]:
    ...</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">This </span><code><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">extract()</span></code><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml"> function can then apply all of the given builder functions (</span><code><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">series_1_pair()</span></code><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml"> to </span><code><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">series_4_pair()</span></code><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">) to the given row to create </span><code><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml"> objects for each of the series.</span></p>
<p><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">This design will also require a function to apply </span><code><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">dataclass.asdict()</span></code><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">json.dumps()</span></code><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml"> to convert </span><code><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml"> objects into strings that can be written to an NDJSON file.</span></p>
<p><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml">Because the functions used are provided as argument values, there is little possibility of a dependency issue among the various functions that make up the application. </span><span class="koboSpan" id="kobo.483.2" xmlns="http://www.w3.org/1999/xhtml">The point throughout the design is to </span><span id="dx1-64018"/><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">avoid binding specific functions in arbitrary places. </span><span class="koboSpan" id="kobo.484.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml"> function should provide the row-building functions to the </span><code><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">extract</span></code><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.488.2" xmlns="http://www.w3.org/1999/xhtml">These functions can be provided via command-line arguments, a configuration file, or be default values if no overrides are given.</span></p>
<p><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">We’ve looked at the overall objective of the project, and two suggested architectural approaches. </span><span class="koboSpan" id="kobo.489.2" xmlns="http://www.w3.org/1999/xhtml">We can now turn to the concrete list of deliverables. </span><span id="x1-64019r65"/></p>
</section>
</section>
<section class="level2" data-number="7.3" id="deliverables-1">
<h2 data-number="7.3"><span class="titlemark"><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml">3.3 </span></span> <span id="x1-650003"/><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">Deliverables</span></h2>
<p><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml">This project has the </span><span id="dx1-65001"/><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">following deliverables:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">Documentation in the </span><code><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml">docs</span></code><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance tests in the </span><code><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">tests/features</span></code><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">tests/steps</span></code><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml"> folders.</span></p></li>
<li><p><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for model module classes in the </span><code><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">tests</span></code><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">Mock objects for the </span><code><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml"> module tests will be part of the unit tests.</span></p></li>
<li><p><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for the </span><code><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml"> module components in the </span><code><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">tests</span></code><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">Application to acquire data from a CSV file in the </span><code><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml">src</span></code><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">An easy way to start is by cloning the project zero directory to start this project. </span><span class="koboSpan" id="kobo.516.2" xmlns="http://www.w3.org/1999/xhtml">Be sure to update the </span><code><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">pyproject.toml</span></code><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">README.md</span></code><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml"> when cloning; the author has often been confused by out-of-date copies of old projects’ metadata.</span></p>
<p><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at a few of these deliverables in a little more detail. </span><span class="koboSpan" id="kobo.521.2" xmlns="http://www.w3.org/1999/xhtml">We’ll start with some suggestions for creating the acceptance tests. </span><span id="x1-65002r69"/></p>
<section class="level3" data-number="7.3.1" id="acceptance-tests">
<h3 data-number="7.3.1"><span class="titlemark"><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml">3.3.1 </span></span> <span id="x1-660001"/><span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance tests</span></h3>
<p><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">The acceptance tests need to describe the overall application’s behavior from the user’s point of view. </span><span class="koboSpan" id="kobo.524.2" xmlns="http://www.w3.org/1999/xhtml">The scenarios will </span><span id="dx1-66001"/><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">follow the UX concept of a command-line application that acquires </span><span id="dx1-66002"/><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">data and writes output files. </span><span class="koboSpan" id="kobo.526.2" xmlns="http://www.w3.org/1999/xhtml">This includes success as well as useful output in the event of failure.</span></p>
<p><span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml">The features will </span><span id="dx1-66003"/><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">look something like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-34">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml">Feature: Extract four data series from a file with
the peculiar Anscombe Quartet format.

</span><span class="koboSpan" id="kobo.529.2" xmlns="http://www.w3.org/1999/xhtml">Scenario: When requested, the application extracts all four series.
  </span><span class="koboSpan" id="kobo.529.3" xmlns="http://www.w3.org/1999/xhtml">Given the "Anscombe_quartet_data.csv" source file exists
  And the "quartet" directory exists
  When we run
    command "python src/acquire.py -o quartet Anscombe_quartet_data.csv"
  Then the "quartet/series_1.json" file exists
  And the "quartet/series_2.json" file exists
  And the "quartet/series_3.json" file exists
  And the "quartet/series_3.json" file exists
  And the "quartet/series_1.json" file starts with
    ’{"x": "10.0", "y": "8.04"}’</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml">This more complex feature will require several step definitions. </span><span class="koboSpan" id="kobo.530.2" xmlns="http://www.w3.org/1999/xhtml">These include the following:</span></p>
<ul>
<li><p><code><span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml">@given(’The</span></code><code><span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml"> "{name}"</span></code><code><span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml"> source</span></code><code><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml"> file</span></code><code><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml"> exists’)</span></code><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.536.2" xmlns="http://www.w3.org/1999/xhtml">This function should copy the example file from a source data directory to the temporary directory used to run the test.</span></p></li>
<li><p><code><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">@given(’the</span></code><code><span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml"> "{name}"</span></code><code><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml"> directory</span></code><code><span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml"> exists’)</span></code><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.541.2" xmlns="http://www.w3.org/1999/xhtml">This function can create the named directory under the directory used to run the test.</span></p></li>
<li><p><code><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">@then(’the</span></code><code><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml"> "{name}"</span></code><code><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml"> file</span></code><code><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml"> exists’)</span></code><span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.546.2" xmlns="http://www.w3.org/1999/xhtml">This function can check for the presence of the named file in the output directory.</span></p></li>
<li><p><code><span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml">@then(’the</span></code><code><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml"> "quartet/series_1.json"</span></code><code><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml"> file</span></code><code><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml"> starts</span></code><code><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml"> with</span></code><code><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml"> ...’)</span></code><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.553.2" xmlns="http://www.w3.org/1999/xhtml">This function will examine the first line of the output file. </span><span class="koboSpan" id="kobo.553.3" xmlns="http://www.w3.org/1999/xhtml">In the event the test fails, it will be helpful to display the contents of the file to help debug the problem. </span><span class="koboSpan" id="kobo.553.4" xmlns="http://www.w3.org/1999/xhtml">A simple </span><code><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">assert</span></code><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml"> statement might not be ideal; a more elaborate </span><code><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">if</span></code><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml"> statement is needed to write debugging output and raise an </span><code><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">AssertionError</span></code><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml"> exception.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">Because the application under </span><span id="dx1-66018"/><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">test consumes and produces files, it is best to make use of the </span><strong><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">behave </span></strong><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">tool’s </span><code><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">environment.py</span></code><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml"> module to define </span><span id="dx1-66019"/><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">two functions to create (and destroy) a temporary </span><span id="dx1-66020"/><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">directory used when running the test. </span><span class="koboSpan" id="kobo.567.2" xmlns="http://www.w3.org/1999/xhtml">The following two functions are used by </span><strong><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">behave </span></strong><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">to do this:</span></p>
<ul>
<li><p><code><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">before\_scenario(context,</span></code><code><span class="koboSpan" id="kobo.571.1" xmlns="http://www.w3.org/1999/xhtml"> scenario)</span></code><span class="koboSpan" id="kobo.572.1" xmlns="http://www.w3.org/1999/xhtml">: This function </span><span id="dx1-66021"/><span class="koboSpan" id="kobo.573.1" xmlns="http://www.w3.org/1999/xhtml">can create a directory. </span><span class="koboSpan" id="kobo.573.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.574.1" xmlns="http://www.w3.org/1999/xhtml">tempfile</span></code><span class="koboSpan" id="kobo.575.1" xmlns="http://www.w3.org/1999/xhtml"> module has a </span><code><span class="koboSpan" id="kobo.576.1" xmlns="http://www.w3.org/1999/xhtml">mkdtemp()</span></code><span class="koboSpan" id="kobo.577.1" xmlns="http://www.w3.org/1999/xhtml"> function that handles this. </span><span class="koboSpan" id="kobo.577.2" xmlns="http://www.w3.org/1999/xhtml">The directory needs to be placed into the context so it can be removed.</span></p></li>
<li><p><code><span class="koboSpan" id="kobo.578.1" xmlns="http://www.w3.org/1999/xhtml">after_scenario(context,</span></code><code><span class="koboSpan" id="kobo.579.1" xmlns="http://www.w3.org/1999/xhtml"> scenario)</span></code><span class="koboSpan" id="kobo.580.1" xmlns="http://www.w3.org/1999/xhtml">: This function </span><span id="dx1-66022"/><span class="koboSpan" id="kobo.581.1" xmlns="http://www.w3.org/1999/xhtml">can remove the temporary directory.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.582.1" xmlns="http://www.w3.org/1999/xhtml">The format for one of the </span><code><span class="koboSpan" id="kobo.583.1" xmlns="http://www.w3.org/1999/xhtml">Then</span></code><span class="koboSpan" id="kobo.584.1" xmlns="http://www.w3.org/1999/xhtml"> clauses has a tiny internal inconsistency. </span><span class="koboSpan" id="kobo.584.2" xmlns="http://www.w3.org/1999/xhtml">The following uses a mixture of </span><code><span class="koboSpan" id="kobo.585.1" xmlns="http://www.w3.org/1999/xhtml">"</span></code><span class="koboSpan" id="kobo.586.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.587.1" xmlns="http://www.w3.org/1999/xhtml">’</span></code><span class="koboSpan" id="kobo.588.1" xmlns="http://www.w3.org/1999/xhtml"> to make it clear where values are inserted into the text:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.589.1" xmlns="http://www.w3.org/1999/xhtml">And the "quartet/series_1.json" file starts with’{"x": "10.0", "y": "8.04"}’</span></pre>
<p><span class="koboSpan" id="kobo.590.1" xmlns="http://www.w3.org/1999/xhtml">Some people may be bothered by the inconsistency. </span><span class="koboSpan" id="kobo.590.2" xmlns="http://www.w3.org/1999/xhtml">One choice is to use </span><code><span class="koboSpan" id="kobo.591.1" xmlns="http://www.w3.org/1999/xhtml">’</span></code><span class="koboSpan" id="kobo.592.1" xmlns="http://www.w3.org/1999/xhtml"> consistently. </span><span class="koboSpan" id="kobo.592.2" xmlns="http://www.w3.org/1999/xhtml">When there aren’t too many feature files, this pervasive change is easy to make. </span><span class="koboSpan" id="kobo.592.3" xmlns="http://www.w3.org/1999/xhtml">Throughout the book, we’ll be inconsistent, leaving the decision to make changes for consistency up to you.</span></p>
<p><span class="koboSpan" id="kobo.593.1" xmlns="http://www.w3.org/1999/xhtml">Also, note the </span><code><span class="koboSpan" id="kobo.594.1" xmlns="http://www.w3.org/1999/xhtml">When</span></code><span class="koboSpan" id="kobo.595.1" xmlns="http://www.w3.org/1999/xhtml"> clause command is rather long and complicated. </span><span class="koboSpan" id="kobo.595.2" xmlns="http://www.w3.org/1999/xhtml">The general advice when writing tests like this is to use a summary of the command and push the details into the step implementation function. </span><span class="koboSpan" id="kobo.595.3" xmlns="http://www.w3.org/1999/xhtml">We’ll address this in a later chapter when the command becomes even longer and more complicated.</span></p>
<p><span class="koboSpan" id="kobo.596.1" xmlns="http://www.w3.org/1999/xhtml">In addition to the scenario where the application works correctly, we also need to consider how the application behaves when there are problems. </span><span class="koboSpan" id="kobo.596.2" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll touch on the various ways things might go badly, and how the application should behave. </span><span id="x1-66023r71"/></p>
</section>
<section class="level3" data-number="7.3.2" id="additional-acceptance-scenarios">
<h3 data-number="7.3.2"><span class="titlemark"><span class="koboSpan" id="kobo.597.1" xmlns="http://www.w3.org/1999/xhtml">3.3.2 </span></span> <span id="x1-670002"/><span class="koboSpan" id="kobo.598.1" xmlns="http://www.w3.org/1999/xhtml">Additional acceptance scenarios</span></h3>
<p><span class="koboSpan" id="kobo.599.1" xmlns="http://www.w3.org/1999/xhtml">The suggested acceptance test covers only one scenario. </span><span class="koboSpan" id="kobo.599.2" xmlns="http://www.w3.org/1999/xhtml">This single scenario — where everything works — can be called the ”happy path”. </span><span class="koboSpan" id="kobo.599.3" xmlns="http://www.w3.org/1999/xhtml">It would be wise to include scenarios in which various </span><span id="dx1-67001"/><span class="koboSpan" id="kobo.600.1" xmlns="http://www.w3.org/1999/xhtml">kinds of errors occur, to be sure </span><span id="dx1-67002"/><span class="koboSpan" id="kobo.601.1" xmlns="http://www.w3.org/1999/xhtml">the application is reliable and robust in the face of problems. </span><span class="koboSpan" id="kobo.601.2" xmlns="http://www.w3.org/1999/xhtml">Here are </span><span id="dx1-67003"/><span class="koboSpan" id="kobo.602.1" xmlns="http://www.w3.org/1999/xhtml">some suggested error scenarios:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.603.1" xmlns="http://www.w3.org/1999/xhtml">Given the </span><code><span class="koboSpan" id="kobo.604.1" xmlns="http://www.w3.org/1999/xhtml">Anscombe\_quartet\_data.csv</span></code><span class="koboSpan" id="kobo.605.1" xmlns="http://www.w3.org/1999/xhtml"> source file does not exist.</span></p></li>
<li><p><span class="koboSpan" id="kobo.606.1" xmlns="http://www.w3.org/1999/xhtml">Given the </span><code><span class="koboSpan" id="kobo.607.1" xmlns="http://www.w3.org/1999/xhtml">quartet</span></code><span class="koboSpan" id="kobo.608.1" xmlns="http://www.w3.org/1999/xhtml"> directory does not exist.</span></p></li>
<li><p><span class="koboSpan" id="kobo.609.1" xmlns="http://www.w3.org/1999/xhtml">When we run the command </span><code><span class="koboSpan" id="kobo.610.1" xmlns="http://www.w3.org/1999/xhtml">python</span></code><code><span class="koboSpan" id="kobo.611.1" xmlns="http://www.w3.org/1999/xhtml"> src/acquire.py</span></code><code><span class="koboSpan" id="kobo.612.1" xmlns="http://www.w3.org/1999/xhtml"> --unknown</span></code><code><span class="koboSpan" id="kobo.613.1" xmlns="http://www.w3.org/1999/xhtml"> option</span></code></p></li>
<li><p><span class="koboSpan" id="kobo.614.1" xmlns="http://www.w3.org/1999/xhtml">Given an </span><code><span class="koboSpan" id="kobo.615.1" xmlns="http://www.w3.org/1999/xhtml">Anscombe\_quartet\_data.csv</span></code><span class="koboSpan" id="kobo.616.1" xmlns="http://www.w3.org/1999/xhtml"> source file exists, and the file is in the wrong format. </span><span class="koboSpan" id="kobo.616.2" xmlns="http://www.w3.org/1999/xhtml">There are numerous kinds of formatting problems.</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.617.1" xmlns="http://www.w3.org/1999/xhtml">The file is empty.</span></p></li>
<li><p><span class="koboSpan" id="kobo.618.1" xmlns="http://www.w3.org/1999/xhtml">The file is not a proper CSV file, but is in some other format.</span></p></li>
<li><p><span class="koboSpan" id="kobo.619.1" xmlns="http://www.w3.org/1999/xhtml">The file’s contents are in valid CSV format, but the column names do not match the expected column names.</span></p></li>
</ul></li>
</ul>
<p><span class="koboSpan" id="kobo.620.1" xmlns="http://www.w3.org/1999/xhtml">Each of the unhappy paths will require examining the log file to be sure it has the expected error messages. </span><span class="koboSpan" id="kobo.620.2" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.621.1" xmlns="http://www.w3.org/1999/xhtml">behave </span></strong><span class="koboSpan" id="kobo.622.1" xmlns="http://www.w3.org/1999/xhtml">tool can capture logging information. </span><span class="koboSpan" id="kobo.622.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.623.1" xmlns="http://www.w3.org/1999/xhtml">context</span></code><span class="koboSpan" id="kobo.624.1" xmlns="http://www.w3.org/1999/xhtml"> available in each step function has attributes that include captured logging output. </span><span class="koboSpan" id="kobo.624.2" xmlns="http://www.w3.org/1999/xhtml">Specifically, </span><code><span class="koboSpan" id="kobo.625.1" xmlns="http://www.w3.org/1999/xhtml">context.log_capture</span></code><span class="koboSpan" id="kobo.626.1" xmlns="http://www.w3.org/1999/xhtml"> contains a </span><code><span class="koboSpan" id="kobo.627.1" xmlns="http://www.w3.org/1999/xhtml">LogCapture</span></code><span class="koboSpan" id="kobo.628.1" xmlns="http://www.w3.org/1999/xhtml"> object that can be searched for an error message.</span></p>
<p><span class="koboSpan" id="kobo.629.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://behave.readthedocs.io/en/stable/api.html#behave.runner.Context"><span class="koboSpan" id="kobo.630.1" xmlns="http://www.w3.org/1999/xhtml">https://behave.readthedocs.io/en/stable/api.html#behave.runner.Context</span></a><span class="koboSpan" id="kobo.631.1" xmlns="http://www.w3.org/1999/xhtml"> for the content of the context.</span></p>
<p><span class="koboSpan" id="kobo.632.1" xmlns="http://www.w3.org/1999/xhtml">These unhappy path scenarios will be similar to the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-35">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.633.1" xmlns="http://www.w3.org/1999/xhtml">Scenario: When the file does not exist, the log has the expected
error message.
  </span><span class="koboSpan" id="kobo.633.2" xmlns="http://www.w3.org/1999/xhtml">Given the "Anscombe_quartet_data.csv" source file does not exist
  And the "quartet" directory exists
  When we run command "python src/acquire.py -o quartet
  Anscombe_quartet_data.csv"
  Then the log contains "File not found: Anscombe_quartet_data.csv"</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.634.1" xmlns="http://www.w3.org/1999/xhtml">This will also require some new step definitions to handle the new </span><code><span class="koboSpan" id="kobo.635.1" xmlns="http://www.w3.org/1999/xhtml">Given</span></code><span class="koboSpan" id="kobo.636.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.637.1" xmlns="http://www.w3.org/1999/xhtml">Then</span></code><span class="koboSpan" id="kobo.638.1" xmlns="http://www.w3.org/1999/xhtml"> steps.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-36">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.639.1" xmlns="http://www.w3.org/1999/xhtml">When working with Gherkin, it’s helpful to establish clear language and consistent terminology. </span><span class="koboSpan" id="kobo.639.2" xmlns="http://www.w3.org/1999/xhtml">This can permit a few step definitions to work for a large number of scenarios. </span><span class="koboSpan" id="kobo.639.3" xmlns="http://www.w3.org/1999/xhtml">It’s a common experience to recognize similarities after writing several scenarios, and then choose to alter scenarios to simplify and normalize steps.</span></p>
<p><span class="koboSpan" id="kobo.640.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.641.1" xmlns="http://www.w3.org/1999/xhtml">behave </span></strong><span class="koboSpan" id="kobo.642.1" xmlns="http://www.w3.org/1999/xhtml">tool will extract missing function definitions. </span><span class="koboSpan" id="kobo.642.2" xmlns="http://www.w3.org/1999/xhtml">The code snippets can be copied and pasted into a steps module.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.643.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance tests </span><span id="dx1-67011"/><span class="koboSpan" id="kobo.644.1" xmlns="http://www.w3.org/1999/xhtml">cover the application’s overall behavior. </span><span class="koboSpan" id="kobo.644.2" xmlns="http://www.w3.org/1999/xhtml">We also </span><span id="dx1-67012"/><span class="koboSpan" id="kobo.645.1" xmlns="http://www.w3.org/1999/xhtml">need to test the individual components as separate units of code. </span><span class="koboSpan" id="kobo.645.2" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at unit tests and the mock objects required for those tests. </span><span id="x1-67013r72"/></p>
</section>
<section class="level3" data-number="7.3.3" id="unit-tests">
<h3 data-number="7.3.3"><span class="titlemark"><span class="koboSpan" id="kobo.646.1" xmlns="http://www.w3.org/1999/xhtml">3.3.3 </span></span> <span id="x1-680003"/><span class="koboSpan" id="kobo.647.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests</span></h3>
<p><span class="koboSpan" id="kobo.648.1" xmlns="http://www.w3.org/1999/xhtml">There are two suggested application architectures in </span><a href="#x1-610002"><em><span class="koboSpan" id="kobo.649.1" xmlns="http://www.w3.org/1999/xhtml">Architectural approach</span></em></a><span class="koboSpan" id="kobo.650.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.650.2" xmlns="http://www.w3.org/1999/xhtml">Class-based design includes two functions and a </span><span id="dx1-68001"/><span class="koboSpan" id="kobo.651.1" xmlns="http://www.w3.org/1999/xhtml">number of classes. </span><span class="koboSpan" id="kobo.651.2" xmlns="http://www.w3.org/1999/xhtml">Each of these classes and functions should be tested in isolation.</span></p>
<p><span class="koboSpan" id="kobo.652.1" xmlns="http://www.w3.org/1999/xhtml">Functional design includes a </span><span id="dx1-68002"/><span class="koboSpan" id="kobo.653.1" xmlns="http://www.w3.org/1999/xhtml">number of functions. </span><span class="koboSpan" id="kobo.653.2" xmlns="http://www.w3.org/1999/xhtml">These need to be tested in isolation. </span><span class="koboSpan" id="kobo.653.3" xmlns="http://www.w3.org/1999/xhtml">Some developers find it easier to isolate function definitions for unit testing. </span><span class="koboSpan" id="kobo.653.4" xmlns="http://www.w3.org/1999/xhtml">This often happens because class definitions may have explicit dependencies that are hard to break.</span></p>
<p><span class="koboSpan" id="kobo.654.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at a number of the test modules in detail. </span><span class="koboSpan" id="kobo.654.2" xmlns="http://www.w3.org/1999/xhtml">We’ll start with tests for the </span><code><span class="koboSpan" id="kobo.655.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.656.1" xmlns="http://www.w3.org/1999/xhtml"> module.</span></p>
<section class="level4 likesubsubsectionHead" data-number="7.3.3.1" id="unit-testing-the-model">
<h4 class="likesubsubsectionHead" data-number="7.3.3.1"><span id="x1-690003"/><span class="koboSpan" id="kobo.657.1" xmlns="http://www.w3.org/1999/xhtml">Unit testing the model</span></h4>
<p><span class="koboSpan" id="kobo.658.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.659.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.660.1" xmlns="http://www.w3.org/1999/xhtml"> module only has one class, and </span><span id="dx1-69001"/><span class="koboSpan" id="kobo.661.1" xmlns="http://www.w3.org/1999/xhtml">that class doesn’t really do very much. </span><span class="koboSpan" id="kobo.661.2" xmlns="http://www.w3.org/1999/xhtml">This makes it relatively </span><span id="dx1-69002"/><span class="koboSpan" id="kobo.662.1" xmlns="http://www.w3.org/1999/xhtml">easy to test. </span><span class="koboSpan" id="kobo.662.2" xmlns="http://www.w3.org/1999/xhtml">A test function something like the following should be adequate:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-37">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.663.1" xmlns="http://www.w3.org/1999/xhtml">from unittest.mock import sentinel
from dataclasses import asdict

def test_xypair():
    pair = XYPair(x=sentinel.X, y=sentinel.Y)
    assert pair.x == sentinel.X
    assert pair.y == sentinel.Y
    assert asdict(pair) == {"x": sentinel.X, "y": sentinel.Y}</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.664.1" xmlns="http://www.w3.org/1999/xhtml">This test uses the </span><code><span class="koboSpan" id="kobo.665.1" xmlns="http://www.w3.org/1999/xhtml">sentinel</span></code><span class="koboSpan" id="kobo.666.1" xmlns="http://www.w3.org/1999/xhtml"> object from the </span><code><span class="koboSpan" id="kobo.667.1" xmlns="http://www.w3.org/1999/xhtml">unittest.mock</span></code><span class="koboSpan" id="kobo.668.1" xmlns="http://www.w3.org/1999/xhtml"> module. </span><span class="koboSpan" id="kobo.668.2" xmlns="http://www.w3.org/1999/xhtml">Each </span><code><span class="koboSpan" id="kobo.669.1" xmlns="http://www.w3.org/1999/xhtml">sentinel</span></code><span class="koboSpan" id="kobo.670.1" xmlns="http://www.w3.org/1999/xhtml"> attribute — for example, </span><code><span class="koboSpan" id="kobo.671.1" xmlns="http://www.w3.org/1999/xhtml">sentinel.X</span></code><span class="koboSpan" id="kobo.672.1" xmlns="http://www.w3.org/1999/xhtml"> — is a unique object. </span><span class="koboSpan" id="kobo.672.2" xmlns="http://www.w3.org/1999/xhtml">They’re easy to provide as argument values and easy to spot in results.</span></p>
<p><span class="koboSpan" id="kobo.673.1" xmlns="http://www.w3.org/1999/xhtml">In addition to testing the </span><code><span class="koboSpan" id="kobo.674.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.675.1" xmlns="http://www.w3.org/1999/xhtml"> module, we also need to test the </span><code><span class="koboSpan" id="kobo.676.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.677.1" xmlns="http://www.w3.org/1999/xhtml"> module, and the overall </span><code><span class="koboSpan" id="kobo.678.1" xmlns="http://www.w3.org/1999/xhtml">acquire</span></code><span class="koboSpan" id="kobo.679.1" xmlns="http://www.w3.org/1999/xhtml"> application. </span><span class="koboSpan" id="kobo.679.2" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at the extract unit test cases.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="7.3.3.2" id="unit-testing-the-pairbuilder-class-hierarchy">
<h4 class="likesubsubsectionHead" data-number="7.3.3.2"><span id="x1-700003"/><span class="koboSpan" id="kobo.680.1" xmlns="http://www.w3.org/1999/xhtml">Unit testing the PairBuilder class hierarchy</span></h4>
<p><span class="koboSpan" id="kobo.681.1" xmlns="http://www.w3.org/1999/xhtml">When following an object-oriented design, the suggested approach is to create a </span><code><span class="koboSpan" id="kobo.682.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.683.1" xmlns="http://www.w3.org/1999/xhtml"> class hierarchy. </span><span class="koboSpan" id="kobo.683.2" xmlns="http://www.w3.org/1999/xhtml">Each subclass </span><span id="dx1-70001"/><span class="koboSpan" id="kobo.684.1" xmlns="http://www.w3.org/1999/xhtml">will perform slightly different operations to build an instance of the </span><code><span class="koboSpan" id="kobo.685.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.686.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<p><span class="koboSpan" id="kobo.687.1" xmlns="http://www.w3.org/1999/xhtml">Ideally, the implementation of the </span><code><span class="koboSpan" id="kobo.688.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.689.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses is </span><span id="dx1-70002"/><span class="koboSpan" id="kobo.690.1" xmlns="http://www.w3.org/1999/xhtml">not tightly coupled to the </span><code><span class="koboSpan" id="kobo.691.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.692.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.692.2" xmlns="http://www.w3.org/1999/xhtml">There is some advice in the </span><a href="#x1-630002"><em><span class="koboSpan" id="kobo.693.1" xmlns="http://www.w3.org/1999/xhtml">Design principles</span></em></a><span class="koboSpan" id="kobo.694.1" xmlns="http://www.w3.org/1999/xhtml"> section on how to support dependency injection via type annotations. </span><span class="koboSpan" id="kobo.694.2" xmlns="http://www.w3.org/1999/xhtml">Specifically, the </span><code><span class="koboSpan" id="kobo.695.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.696.1" xmlns="http://www.w3.org/1999/xhtml"> module is best served by using a type variable, </span><code><span class="koboSpan" id="kobo.697.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.698.1" xmlns="http://www.w3.org/1999/xhtml">, as a placeholder for any additional types that may be developed.</span></p>
<p><span class="koboSpan" id="kobo.699.1" xmlns="http://www.w3.org/1999/xhtml">When testing, we want to replace this class with a mock class to assure that the interface for the family of </span><code><span class="koboSpan" id="kobo.700.1" xmlns="http://www.w3.org/1999/xhtml">RawData</span></code><span class="koboSpan" id="kobo.701.1" xmlns="http://www.w3.org/1999/xhtml"> classes — currently only a single class, </span><code><span class="koboSpan" id="kobo.702.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.703.1" xmlns="http://www.w3.org/1999/xhtml"> — is honored.</span></p>
<p><span class="koboSpan" id="kobo.704.1" xmlns="http://www.w3.org/1999/xhtml">A </span><code><span class="koboSpan" id="kobo.705.1" xmlns="http://www.w3.org/1999/xhtml">Mock</span></code><span class="koboSpan" id="kobo.706.1" xmlns="http://www.w3.org/1999/xhtml"> object (built with the </span><code><span class="koboSpan" id="kobo.707.1" xmlns="http://www.w3.org/1999/xhtml">unittest.mock</span></code><span class="koboSpan" id="kobo.708.1" xmlns="http://www.w3.org/1999/xhtml"> module) works out well as a replacement class. </span><span class="koboSpan" id="kobo.708.2" xmlns="http://www.w3.org/1999/xhtml">It can be used for the </span><code><span class="koboSpan" id="kobo.709.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.710.1" xmlns="http://www.w3.org/1999/xhtml"> class in the subclasses of the </span><code><span class="koboSpan" id="kobo.711.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.712.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<p><span class="koboSpan" id="kobo.713.1" xmlns="http://www.w3.org/1999/xhtml">The tests will look like the following example:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-38">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.714.1" xmlns="http://www.w3.org/1999/xhtml">from unittest.mock import Mock, sentinel, call

def test_series1pair():
    mock_raw_class = Mock()
    p1 = Series1Pair()
    p1.target_class = mock_raw_class
    xypair = p1.from_row([sentinel.X, sentinel.Y])
    assert mock_raw_class.mock_calls == [
        call(sentinel.X, sentinel.Y)
    ]</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.715.1" xmlns="http://www.w3.org/1999/xhtml">The idea is to use a </span><code><span class="koboSpan" id="kobo.716.1" xmlns="http://www.w3.org/1999/xhtml">Mock</span></code><span class="koboSpan" id="kobo.717.1" xmlns="http://www.w3.org/1999/xhtml"> object to replace the specific class defined in the </span><code><span class="koboSpan" id="kobo.718.1" xmlns="http://www.w3.org/1999/xhtml">Series1Pair</span></code><span class="koboSpan" id="kobo.719.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.719.2" xmlns="http://www.w3.org/1999/xhtml">After the </span><code><span class="koboSpan" id="kobo.720.1" xmlns="http://www.w3.org/1999/xhtml">from_row()</span></code><span class="koboSpan" id="kobo.721.1" xmlns="http://www.w3.org/1999/xhtml"> method is evaluated, the test case confirms that the mock class was called exactly </span><span id="dx1-70013"/><span class="koboSpan" id="kobo.722.1" xmlns="http://www.w3.org/1999/xhtml">once with the expected two </span><code><span class="koboSpan" id="kobo.723.1" xmlns="http://www.w3.org/1999/xhtml">sentinel</span></code><span class="koboSpan" id="kobo.724.1" xmlns="http://www.w3.org/1999/xhtml"> objects. </span><span class="koboSpan" id="kobo.724.2" xmlns="http://www.w3.org/1999/xhtml">A further check would confirm that the value of </span><code><span class="koboSpan" id="kobo.725.1" xmlns="http://www.w3.org/1999/xhtml">xypair</span></code><span class="koboSpan" id="kobo.726.1" xmlns="http://www.w3.org/1999/xhtml"> was also a mock object.</span></p>
<p><span class="koboSpan" id="kobo.727.1" xmlns="http://www.w3.org/1999/xhtml">This use of </span><code><span class="koboSpan" id="kobo.728.1" xmlns="http://www.w3.org/1999/xhtml">Mock</span></code><span class="koboSpan" id="kobo.729.1" xmlns="http://www.w3.org/1999/xhtml"> objects guarantees </span><span id="dx1-70014"/><span class="koboSpan" id="kobo.730.1" xmlns="http://www.w3.org/1999/xhtml">that no additional, unexpected processing was done on the objects. </span><span class="koboSpan" id="kobo.730.2" xmlns="http://www.w3.org/1999/xhtml">The interface for creating a new </span><code><span class="koboSpan" id="kobo.731.1" xmlns="http://www.w3.org/1999/xhtml">XYPair</span></code><span class="koboSpan" id="kobo.732.1" xmlns="http://www.w3.org/1999/xhtml"> was performed correctly by the </span><code><span class="koboSpan" id="kobo.733.1" xmlns="http://www.w3.org/1999/xhtml">Series1Pair</span></code><span class="koboSpan" id="kobo.734.1" xmlns="http://www.w3.org/1999/xhtml"> class.</span></p>
<p><span class="koboSpan" id="kobo.735.1" xmlns="http://www.w3.org/1999/xhtml">Similar tests are required for the other pair-building classes.</span></p>
<p><span class="koboSpan" id="kobo.736.1" xmlns="http://www.w3.org/1999/xhtml">In addition to testing the </span><code><span class="koboSpan" id="kobo.737.1" xmlns="http://www.w3.org/1999/xhtml">model</span></code><span class="koboSpan" id="kobo.738.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.739.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.740.1" xmlns="http://www.w3.org/1999/xhtml"> modules, we also need to test the overall </span><code><span class="koboSpan" id="kobo.741.1" xmlns="http://www.w3.org/1999/xhtml">acquire</span></code><span class="koboSpan" id="kobo.742.1" xmlns="http://www.w3.org/1999/xhtml"> application. </span><span class="koboSpan" id="kobo.742.2" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll look at the </span><code><span class="koboSpan" id="kobo.743.1" xmlns="http://www.w3.org/1999/xhtml">acquire</span></code><span class="koboSpan" id="kobo.744.1" xmlns="http://www.w3.org/1999/xhtml"> application unit test cases.</span></p>
</section>
<section class="level4 likesubsubsectionHead" data-number="7.3.3.3" id="unit-testing-the-remaining-components">
<h4 class="likesubsubsectionHead" data-number="7.3.3.3"><span id="x1-710003"/><span class="koboSpan" id="kobo.745.1" xmlns="http://www.w3.org/1999/xhtml">Unit testing the remaining components</span></h4>
<p><span class="koboSpan" id="kobo.746.1" xmlns="http://www.w3.org/1999/xhtml">The test cases for the overall </span><code><span class="koboSpan" id="kobo.747.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.748.1" xmlns="http://www.w3.org/1999/xhtml"> class will also need to use </span><code><span class="koboSpan" id="kobo.749.1" xmlns="http://www.w3.org/1999/xhtml">Mock</span></code><span class="koboSpan" id="kobo.750.1" xmlns="http://www.w3.org/1999/xhtml"> objects to replace components like a </span><code><span class="koboSpan" id="kobo.751.1" xmlns="http://www.w3.org/1999/xhtml">csv.reader</span></code><span class="koboSpan" id="kobo.752.1" xmlns="http://www.w3.org/1999/xhtml"> and instances of the </span><code><span class="koboSpan" id="kobo.753.1" xmlns="http://www.w3.org/1999/xhtml">PairBuilder</span></code><span class="koboSpan" id="kobo.754.1" xmlns="http://www.w3.org/1999/xhtml"> subclasses.</span></p>
<p><span class="koboSpan" id="kobo.755.1" xmlns="http://www.w3.org/1999/xhtml">As noted above in the </span><a href="#x1-640003"><em><span class="koboSpan" id="kobo.756.1" xmlns="http://www.w3.org/1999/xhtml">Functional design</span></em></a><span class="koboSpan" id="kobo.757.1" xmlns="http://www.w3.org/1999/xhtml"> section, the </span><code><span class="koboSpan" id="kobo.758.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.759.1" xmlns="http://www.w3.org/1999/xhtml"> function needs to avoid having explicitly named </span><span id="dx1-71001"/><span class="koboSpan" id="kobo.760.1" xmlns="http://www.w3.org/1999/xhtml">classes or functions. </span><span class="koboSpan" id="kobo.760.2" xmlns="http://www.w3.org/1999/xhtml">The names </span><span id="dx1-71002"/><span class="koboSpan" id="kobo.761.1" xmlns="http://www.w3.org/1999/xhtml">need to be provided via command-line arguments, a configuration file, or as default values.</span></p>
<p><span class="koboSpan" id="kobo.762.1" xmlns="http://www.w3.org/1999/xhtml">The unit tests should exercise the </span><code><span class="koboSpan" id="kobo.763.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.764.1" xmlns="http://www.w3.org/1999/xhtml"> function with </span><code><span class="koboSpan" id="kobo.765.1" xmlns="http://www.w3.org/1999/xhtml">Mock</span></code><span class="koboSpan" id="kobo.766.1" xmlns="http://www.w3.org/1999/xhtml"> objects to be sure that it is defined with flexibility and extensions in mind. </span><span id="x1-71003r70"/></p>
</section>
</section>
</section>
<section class="level2" data-number="7.4" id="summary-2">
<h2 data-number="7.4"><span class="titlemark"><span class="koboSpan" id="kobo.767.1" xmlns="http://www.w3.org/1999/xhtml">3.4 </span></span> <span id="x1-720004"/><span class="koboSpan" id="kobo.768.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.769.1" xmlns="http://www.w3.org/1999/xhtml">This chapter introduced the first project, the Data Acquisition Base Application. </span><span class="koboSpan" id="kobo.769.2" xmlns="http://www.w3.org/1999/xhtml">This application extracts data from a CSV file with a complex structure, creating four separate series of data points from a single file.</span></p>
<p><span class="koboSpan" id="kobo.770.1" xmlns="http://www.w3.org/1999/xhtml">To make the application complete, we included a command-line interface and logging. </span><span class="koboSpan" id="kobo.770.2" xmlns="http://www.w3.org/1999/xhtml">This will make sure the application behaves well in a controlled production environment.</span></p>
<p><span class="koboSpan" id="kobo.771.1" xmlns="http://www.w3.org/1999/xhtml">An important part of the process is designing an application that can be extended to handle data from a variety of sources and in a variety of formats. </span><span class="koboSpan" id="kobo.771.2" xmlns="http://www.w3.org/1999/xhtml">The base application contains modules with very small implementations that serve as a foundation for making subsequent extensions.</span></p>
<p><span class="koboSpan" id="kobo.772.1" xmlns="http://www.w3.org/1999/xhtml">Perhaps the most difficult part of this project is creating a suite of acceptance tests to describe the proper behavior. </span><span class="koboSpan" id="kobo.772.2" xmlns="http://www.w3.org/1999/xhtml">It’s common for developers to compare the volume of test code with the application code and claim testing is taking up ”too much” of their time.</span></p>
<p><span class="koboSpan" id="kobo.773.1" xmlns="http://www.w3.org/1999/xhtml">Pragmatically, a program without automated tests cannot be trusted. </span><span class="koboSpan" id="kobo.773.2" xmlns="http://www.w3.org/1999/xhtml">The tests are every bit as important as the code they’re exercising.</span></p>
<p><span class="koboSpan" id="kobo.774.1" xmlns="http://www.w3.org/1999/xhtml">The unit tests are — superficially — simpler. </span><span class="koboSpan" id="kobo.774.2" xmlns="http://www.w3.org/1999/xhtml">The use of mock objects makes sure each class is tested in isolation.</span></p>
<p><span class="koboSpan" id="kobo.775.1" xmlns="http://www.w3.org/1999/xhtml">This base application acts as a foundation for the next few chapters. </span><span class="koboSpan" id="kobo.775.2" xmlns="http://www.w3.org/1999/xhtml">The next chapter will add RESTful API requests. </span><span class="koboSpan" id="kobo.775.3" xmlns="http://www.w3.org/1999/xhtml">After that, we’ll have database access to this foundation. </span><span id="x1-72001r77"/></p>
</section>
<section class="level2" data-number="7.5" id="extras-1">
<h2 data-number="7.5"><span class="titlemark"><span class="koboSpan" id="kobo.776.1" xmlns="http://www.w3.org/1999/xhtml">3.5 </span></span> <span id="x1-730005"/><span class="koboSpan" id="kobo.777.1" xmlns="http://www.w3.org/1999/xhtml">Extras</span></h2>
<p><span class="koboSpan" id="kobo.778.1" xmlns="http://www.w3.org/1999/xhtml">Here are some ideas for you to add to this project. </span><span id="x1-73001r73"/></p>
<section class="level3" data-number="7.5.1" id="logging-enhancements">
<h3 data-number="7.5.1"><span class="titlemark"><span class="koboSpan" id="kobo.779.1" xmlns="http://www.w3.org/1999/xhtml">3.5.1 </span></span> <span id="x1-740001"/><span class="koboSpan" id="kobo.780.1" xmlns="http://www.w3.org/1999/xhtml">Logging enhancements</span></h3>
<p><span class="koboSpan" id="kobo.781.1" xmlns="http://www.w3.org/1999/xhtml">We skimmed over logging, suggesting only that it’s important and that the initialization for logging should be kept separate from the processing within the </span><code><span class="koboSpan" id="kobo.782.1" xmlns="http://www.w3.org/1999/xhtml">main()</span></code><span class="koboSpan" id="kobo.783.1" xmlns="http://www.w3.org/1999/xhtml"> function.</span></p>
<p><span class="koboSpan" id="kobo.784.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.785.1" xmlns="http://www.w3.org/1999/xhtml">logging</span></code><span class="koboSpan" id="kobo.786.1" xmlns="http://www.w3.org/1999/xhtml"> module has a great deal of sophistication, however, and it can help to explore this. </span><span class="koboSpan" id="kobo.786.2" xmlns="http://www.w3.org/1999/xhtml">We’ll start with logging ”levels”.</span></p>
<p><span class="koboSpan" id="kobo.787.1" xmlns="http://www.w3.org/1999/xhtml">Many of our logging messages will be created with the </span><code><span class="koboSpan" id="kobo.788.1" xmlns="http://www.w3.org/1999/xhtml">INFO</span></code><span class="koboSpan" id="kobo.789.1" xmlns="http://www.w3.org/1999/xhtml"> level of logging. </span><span class="koboSpan" id="kobo.789.2" xmlns="http://www.w3.org/1999/xhtml">For example:</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.790.1" xmlns="http://www.w3.org/1999/xhtml">logger.info("%d rows processed", input_count)</span></pre>
<p><span class="koboSpan" id="kobo.791.1" xmlns="http://www.w3.org/1999/xhtml">This application has a number of possible error situations that are best reflected with </span><strong><span class="koboSpan" id="kobo.792.1" xmlns="http://www.w3.org/1999/xhtml">error</span></strong><span class="koboSpan" id="kobo.793.1" xmlns="http://www.w3.org/1999/xhtml">-level logging.</span></p>
<p><span class="koboSpan" id="kobo.794.1" xmlns="http://www.w3.org/1999/xhtml">Additionally, there is a tree of named loggers. </span><span class="koboSpan" id="kobo.794.2" xmlns="http://www.w3.org/1999/xhtml">The root logger, named </span><code><span class="koboSpan" id="kobo.795.1" xmlns="http://www.w3.org/1999/xhtml">""</span></code><span class="koboSpan" id="kobo.796.1" xmlns="http://www.w3.org/1999/xhtml">, has settings that apply to all the lower-level loggers. </span><span class="koboSpan" id="kobo.796.2" xmlns="http://www.w3.org/1999/xhtml">This tree tends to parallel the way object inheritance is often used to create classes and subclasses. </span><span class="koboSpan" id="kobo.796.3" xmlns="http://www.w3.org/1999/xhtml">This can make it advantageous to create loggers for each class. </span><span class="koboSpan" id="kobo.796.4" xmlns="http://www.w3.org/1999/xhtml">This permits setting the logging level to </span><strong><span class="koboSpan" id="kobo.797.1" xmlns="http://www.w3.org/1999/xhtml">debug </span></strong><span class="koboSpan" id="kobo.798.1" xmlns="http://www.w3.org/1999/xhtml">for one of many classes, allowing for more focused messages.</span></p>
<p><span class="koboSpan" id="kobo.799.1" xmlns="http://www.w3.org/1999/xhtml">This is often handled through a logging configuration file. </span><span class="koboSpan" id="kobo.799.2" xmlns="http://www.w3.org/1999/xhtml">This file provides the configuration for logging, and avoids the potential complications of setting logging features through command-line options.</span></p>
<p><span class="koboSpan" id="kobo.800.1" xmlns="http://www.w3.org/1999/xhtml">There are three extras to add to this project:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.801.1" xmlns="http://www.w3.org/1999/xhtml">Create loggers for each individual class.</span></p></li>
<li><p><span class="koboSpan" id="kobo.802.1" xmlns="http://www.w3.org/1999/xhtml">Add debug-level information. </span><span class="koboSpan" id="kobo.802.2" xmlns="http://www.w3.org/1999/xhtml">For example, the </span><code><span class="koboSpan" id="kobo.803.1" xmlns="http://www.w3.org/1999/xhtml">from_row()</span></code><span class="koboSpan" id="kobo.804.1" xmlns="http://www.w3.org/1999/xhtml"> function is a place where debugging might be helpful for understanding why an output file is incorrect.</span></p></li>
<li><p><span class="koboSpan" id="kobo.805.1" xmlns="http://www.w3.org/1999/xhtml">Get the logging configuration from an initialization file. </span><span class="koboSpan" id="kobo.805.2" xmlns="http://www.w3.org/1999/xhtml">Consider using a file in </span><strong><span class="koboSpan" id="kobo.806.1" xmlns="http://www.w3.org/1999/xhtml">TOML </span></strong><span class="koboSpan" id="kobo.807.1" xmlns="http://www.w3.org/1999/xhtml">format as an alternative to the </span><strong><span class="koboSpan" id="kobo.808.1" xmlns="http://www.w3.org/1999/xhtml">INI </span></strong><span class="koboSpan" id="kobo.809.1" xmlns="http://www.w3.org/1999/xhtml">format, which is a first-class part of the </span><code><span class="koboSpan" id="kobo.810.1" xmlns="http://www.w3.org/1999/xhtml">logging</span></code><span class="koboSpan" id="kobo.811.1" xmlns="http://www.w3.org/1999/xhtml"> module.</span></p></li>
</ul>
<p><span id="x1-74001r79"/></p>
</section>
<section class="level3" data-number="7.5.2" id="configuration-extensions">
<h3 data-number="7.5.2"><span class="titlemark"><span class="koboSpan" id="kobo.812.1" xmlns="http://www.w3.org/1999/xhtml">3.5.2 </span></span> <span id="x1-750002"/><span class="koboSpan" id="kobo.813.1" xmlns="http://www.w3.org/1999/xhtml">Configuration extensions</span></h3>
<p><span class="koboSpan" id="kobo.814.1" xmlns="http://www.w3.org/1999/xhtml">We’ve described a little of the CLI for this application. </span><span class="koboSpan" id="kobo.814.2" xmlns="http://www.w3.org/1999/xhtml">This chapter has provided a few examples of the expected behavior. </span><span class="koboSpan" id="kobo.814.3" xmlns="http://www.w3.org/1999/xhtml">In addition to command-line parameters, it can help to have a configuration file that provides the slowly changing details of how the application works.</span></p>
<p><span class="koboSpan" id="kobo.815.1" xmlns="http://www.w3.org/1999/xhtml">In the discussion in the </span><a href="#x1-630002"><em><span class="koboSpan" id="kobo.816.1" xmlns="http://www.w3.org/1999/xhtml">Design principles</span></em></a><span class="koboSpan" id="kobo.817.1" xmlns="http://www.w3.org/1999/xhtml"> section, we looked closely at dependency inversion. </span><span class="koboSpan" id="kobo.817.2" xmlns="http://www.w3.org/1999/xhtml">The intent is to avoid an explicit dependency among classes. </span><span class="koboSpan" id="kobo.817.3" xmlns="http://www.w3.org/1999/xhtml">We want to ”invert” the relationship, making it indirect. </span><span class="koboSpan" id="kobo.817.4" xmlns="http://www.w3.org/1999/xhtml">The idea is to inject the class name at run time, via parameters.</span></p>
<p><span class="koboSpan" id="kobo.818.1" xmlns="http://www.w3.org/1999/xhtml">Initially, we can do something like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-39">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.819.1" xmlns="http://www.w3.org/1999/xhtml">EXTRACT_CLASS: type[Extract] = Extract
BUILDER_CLASSES: list[type[PairBuilder]] = [
    Series1Pair, Series2Pair, Series3Pair, Series4Pair]

def main(argv: list[str]) -&gt; None:
    builders = [cls() for vls in BUILDER_CLASSES]
    extractor = EXTRACT_CLASS(builders)
    # etc.</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.820.1" xmlns="http://www.w3.org/1999/xhtml">This provides a base level of parameterization. </span><span class="koboSpan" id="kobo.820.2" xmlns="http://www.w3.org/1999/xhtml">Some global variables are used to ”inject” the run-time classes. </span><span class="koboSpan" id="kobo.820.3" xmlns="http://www.w3.org/1999/xhtml">These initializations can be moved to the </span><code><span class="koboSpan" id="kobo.821.1" xmlns="http://www.w3.org/1999/xhtml">argparse.Namespace</span></code><span class="koboSpan" id="kobo.822.1" xmlns="http://www.w3.org/1999/xhtml"> initialization value for the </span><code><span class="koboSpan" id="kobo.823.1" xmlns="http://www.w3.org/1999/xhtml">ArgumentParser.parse_args()</span></code><span class="koboSpan" id="kobo.824.1" xmlns="http://www.w3.org/1999/xhtml"> method.</span></p>
<p><span class="koboSpan" id="kobo.825.1" xmlns="http://www.w3.org/1999/xhtml">The initial values for this </span><code><span class="koboSpan" id="kobo.826.1" xmlns="http://www.w3.org/1999/xhtml">argparse.Namespace</span></code><span class="koboSpan" id="kobo.827.1" xmlns="http://www.w3.org/1999/xhtml"> object can be literal values, essentially the same as shown in the global variable parameterization shown in the previous example.</span></p>
<p><span class="koboSpan" id="kobo.828.1" xmlns="http://www.w3.org/1999/xhtml">It is more flexible to have the initial values come from a parameter file that’s separate from the application code. </span><span class="koboSpan" id="kobo.828.2" xmlns="http://www.w3.org/1999/xhtml">This permits changing the configuration without touching the application and introducing bugs through inadvertent typing mistakes.</span></p>
<p><span class="koboSpan" id="kobo.829.1" xmlns="http://www.w3.org/1999/xhtml">There are two popular alternatives for a configuration file that can be used to fine-tune the application. </span><span class="koboSpan" id="kobo.829.2" xmlns="http://www.w3.org/1999/xhtml">These are:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.830.1" xmlns="http://www.w3.org/1999/xhtml">A separate Python module that’s imported by the application. </span><span class="koboSpan" id="kobo.830.2" xmlns="http://www.w3.org/1999/xhtml">A module name like </span><code><span class="koboSpan" id="kobo.831.1" xmlns="http://www.w3.org/1999/xhtml">config.py</span></code><span class="koboSpan" id="kobo.832.1" xmlns="http://www.w3.org/1999/xhtml"> is popular for this.</span></p></li>
<li><p><span class="koboSpan" id="kobo.833.1" xmlns="http://www.w3.org/1999/xhtml">A non-Python text file that’s read by the application. </span><span class="koboSpan" id="kobo.833.2" xmlns="http://www.w3.org/1999/xhtml">The TOML file format, parsed by the </span><code><span class="koboSpan" id="kobo.834.1" xmlns="http://www.w3.org/1999/xhtml">tomllib</span></code><span class="koboSpan" id="kobo.835.1" xmlns="http://www.w3.org/1999/xhtml"> module, is ideal.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.836.1" xmlns="http://www.w3.org/1999/xhtml">Starting with Python 3.11, the </span><code><span class="koboSpan" id="kobo.837.1" xmlns="http://www.w3.org/1999/xhtml">tomllib</span></code><span class="koboSpan" id="kobo.838.1" xmlns="http://www.w3.org/1999/xhtml"> module is directly available as part of the standard library. </span><span class="koboSpan" id="kobo.838.2" xmlns="http://www.w3.org/1999/xhtml">Older versions of Python should be upgraded to 3.11 or later.</span></p>
<p><span class="koboSpan" id="kobo.839.1" xmlns="http://www.w3.org/1999/xhtml">When working with a TOML file, the class name will be a string. </span><span class="koboSpan" id="kobo.839.2" xmlns="http://www.w3.org/1999/xhtml">The simple and reliable way to translate the class name from string to class object is to use the </span><code><span class="koboSpan" id="kobo.840.1" xmlns="http://www.w3.org/1999/xhtml">eval()</span></code><span class="koboSpan" id="kobo.841.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.841.2" xmlns="http://www.w3.org/1999/xhtml">An alternative is to provide a small dictionary with class name strings and class objects. </span><span class="koboSpan" id="kobo.841.3" xmlns="http://www.w3.org/1999/xhtml">Class names can be resolved through this mapping.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-40">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.842.1" xmlns="http://www.w3.org/1999/xhtml">Some developers worry that the </span><code><span class="koboSpan" id="kobo.843.1" xmlns="http://www.w3.org/1999/xhtml">eval()</span></code><span class="koboSpan" id="kobo.844.1" xmlns="http://www.w3.org/1999/xhtml"> function allows a class of Evil Super Geniuses to tweak the configuration file in a way that will crash the application.</span></p>
<p><span class="koboSpan" id="kobo.845.1" xmlns="http://www.w3.org/1999/xhtml">What these developers fail to notice is that the entire Python application is plain text. </span><span class="koboSpan" id="kobo.845.2" xmlns="http://www.w3.org/1999/xhtml">The Evil Super Genius can more easily edit the application and doesn’t need to do complicated, nefarious things to the parameter file.</span></p>
<p><span class="koboSpan" id="kobo.846.1" xmlns="http://www.w3.org/1999/xhtml">Further, ordinary OS-level ownership and permissions can restrict access to the parameter file to a few trustworthy individuals.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.847.1" xmlns="http://www.w3.org/1999/xhtml">Don’t forget to include unit test cases for parsing the parameter file. </span><span class="koboSpan" id="kobo.847.2" xmlns="http://www.w3.org/1999/xhtml">Also, an acceptance test case with an invalid parameter file will be an important part of this project. </span><span id="x1-75009r80"/></p>
</section>
<section class="level3" data-number="7.5.3" id="data-subsets">
<h3 data-number="7.5.3"><span class="titlemark"><span class="koboSpan" id="kobo.848.1" xmlns="http://www.w3.org/1999/xhtml">3.5.3 </span></span> <span id="x1-760003"/><span class="koboSpan" id="kobo.849.1" xmlns="http://www.w3.org/1999/xhtml">Data subsets</span></h3>
<p><span class="koboSpan" id="kobo.850.1" xmlns="http://www.w3.org/1999/xhtml">To work with large files it will be necessary to extract a subset of the data. </span><span class="koboSpan" id="kobo.850.2" xmlns="http://www.w3.org/1999/xhtml">This involves adding features like the following:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.851.1" xmlns="http://www.w3.org/1999/xhtml">Create a subclass of the </span><code><span class="koboSpan" id="kobo.852.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.853.1" xmlns="http://www.w3.org/1999/xhtml"> class that has an upper limit on the number of rows created. </span><span class="koboSpan" id="kobo.853.2" xmlns="http://www.w3.org/1999/xhtml">This involves a number of unit tests.</span></p></li>
<li><p><span class="koboSpan" id="kobo.854.1" xmlns="http://www.w3.org/1999/xhtml">Update the CLI options to include an optional upper limit. </span><span class="koboSpan" id="kobo.854.2" xmlns="http://www.w3.org/1999/xhtml">This, too, will involve some additional unit test cases.</span></p></li>
<li><p><span class="koboSpan" id="kobo.855.1" xmlns="http://www.w3.org/1999/xhtml">Update the acceptance test cases to show operation with the upper limit.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.856.1" xmlns="http://www.w3.org/1999/xhtml">Note that switching from the </span><code><span class="koboSpan" id="kobo.857.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.858.1" xmlns="http://www.w3.org/1999/xhtml"> class to the </span><code><span class="koboSpan" id="kobo.859.1" xmlns="http://www.w3.org/1999/xhtml">SubsetExtract</span></code><span class="koboSpan" id="kobo.860.1" xmlns="http://www.w3.org/1999/xhtml"> class is something that should be based on an optional command-line parameter. </span><span class="koboSpan" id="kobo.860.2" xmlns="http://www.w3.org/1999/xhtml">If the </span><code><span class="koboSpan" id="kobo.861.1" xmlns="http://www.w3.org/1999/xhtml">--limit</span></code><span class="koboSpan" id="kobo.862.1" xmlns="http://www.w3.org/1999/xhtml"> option is not given, then the </span><code><span class="koboSpan" id="kobo.863.1" xmlns="http://www.w3.org/1999/xhtml">Extract</span></code><span class="koboSpan" id="kobo.864.1" xmlns="http://www.w3.org/1999/xhtml"> class is used. </span><span class="koboSpan" id="kobo.864.2" xmlns="http://www.w3.org/1999/xhtml">If the </span><code><span class="koboSpan" id="kobo.865.1" xmlns="http://www.w3.org/1999/xhtml">--limit</span></code><span class="koboSpan" id="kobo.866.1" xmlns="http://www.w3.org/1999/xhtml"> option is given (and is a valid integer), then the </span><code><span class="koboSpan" id="kobo.867.1" xmlns="http://www.w3.org/1999/xhtml">SubsetExtract</span></code><span class="koboSpan" id="kobo.868.1" xmlns="http://www.w3.org/1999/xhtml"> class is used. </span><span class="koboSpan" id="kobo.868.2" xmlns="http://www.w3.org/1999/xhtml">This will lead to an interesting set of unit test cases to make sure the command-line parsing works properly. </span><span id="x1-76001r81"/></p>
</section>
<section class="level3" data-number="7.5.4" id="another-example-data-source">
<h3 data-number="7.5.4"><span class="titlemark"><span class="koboSpan" id="kobo.869.1" xmlns="http://www.w3.org/1999/xhtml">3.5.4 </span></span> <span id="x1-770004"/><span class="koboSpan" id="kobo.870.1" xmlns="http://www.w3.org/1999/xhtml">Another example data source</span></h3>
<p><span class="koboSpan" id="kobo.871.1" xmlns="http://www.w3.org/1999/xhtml">Perhaps the most important extra for this application is to locate another data source that’s of interest to you.</span></p>
<p><span class="koboSpan" id="kobo.872.1" xmlns="http://www.w3.org/1999/xhtml">See the </span><strong><span class="koboSpan" id="kobo.873.1" xmlns="http://www.w3.org/1999/xhtml">CO</span></strong><strong><span class="koboSpan" id="kobo.874.1" xmlns="http://www.w3.org/1999/xhtml">2</span></strong> <strong><span class="koboSpan" id="kobo.875.1" xmlns="http://www.w3.org/1999/xhtml">PPM — Trends in Atmospheric Carbon Dioxide </span></strong><span class="koboSpan" id="kobo.876.1" xmlns="http://www.w3.org/1999/xhtml">data set, available at </span><a class="url" href="https://datahub.io/core/co2-ppm"><span class="koboSpan" id="kobo.877.1" xmlns="http://www.w3.org/1999/xhtml">https://datahub.io/core/co2-ppm</span></a><span class="koboSpan" id="kobo.878.1" xmlns="http://www.w3.org/1999/xhtml">, for some data that’s somewhat larger. </span><span class="koboSpan" id="kobo.878.2" xmlns="http://www.w3.org/1999/xhtml">This has a number of odd special-case values that we’ll explore in </span><a href="ch010.xhtml#x1-1460006"><em><span class="koboSpan" id="kobo.879.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.880.1" xmlns="http://www.w3.org/1999/xhtml"> 6</span></em></a><span class="koboSpan" id="kobo.881.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch010.xhtml#x1-1460006"><em><span class="koboSpan" id="kobo.882.1" xmlns="http://www.w3.org/1999/xhtml">Project 2.1: Data Inspection Notebook</span></em></a><span class="koboSpan" id="kobo.883.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.884.1" xmlns="http://www.w3.org/1999/xhtml">This project will require you to manually download and unzip the file. </span><span class="koboSpan" id="kobo.884.2" xmlns="http://www.w3.org/1999/xhtml">In later chapters, we’ll look at automating these two steps. </span><span class="koboSpan" id="kobo.884.3" xmlns="http://www.w3.org/1999/xhtml">See </span><a href="ch008.xhtml#x1-780004"><em><span class="koboSpan" id="kobo.885.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.886.1" xmlns="http://www.w3.org/1999/xhtml"> 4</span></em></a><span class="koboSpan" id="kobo.887.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch008.xhtml#x1-780004"><em><span class="koboSpan" id="kobo.888.1" xmlns="http://www.w3.org/1999/xhtml">Data</span></em> <em><span class="koboSpan" id="kobo.889.1" xmlns="http://www.w3.org/1999/xhtml">Acquisition Features: Web APIs and Scraping</span></em></a><span class="koboSpan" id="kobo.890.1" xmlns="http://www.w3.org/1999/xhtml"> specifically, for projects that will expand on this base project to properly acquire the raw data from a CSV file.</span></p>
<p><span class="koboSpan" id="kobo.891.1" xmlns="http://www.w3.org/1999/xhtml">What’s important is locating a source of data that’s in CSV format and small enough that it can be processed in a few seconds. </span><span class="koboSpan" id="kobo.891.2" xmlns="http://www.w3.org/1999/xhtml">For large files, it will be necessary to extract a subset of the data. </span><span class="koboSpan" id="kobo.891.3" xmlns="http://www.w3.org/1999/xhtml">See </span><a href="#x1-760003"><em><span class="koboSpan" id="kobo.892.1" xmlns="http://www.w3.org/1999/xhtml">Data subsets</span></em></a><span class="koboSpan" id="kobo.893.1" xmlns="http://www.w3.org/1999/xhtml"> for advice on handling large sets of data.</span></p>
<p><span id="x1-77001r58"/></p>
</section>
</section>
</section>
</body>
</html>
