<html><head></head><body>
        

            
                <h1 class="header-title">Lets Build a Robot!</h1>
            

            
                
<p>In this chapter, we built an indoor robot (using the Raspberry Pi Zero as the controller) and documented our experience in a step-by-step guide. We wanted to demonstrate the awesomeness of the combination of Python programming language and the Raspberry Pi Zero's peripherals. We have also included suggestions to build an outdoor robot as well as suggestions for additional accessories for your robot. At the end of this chapter, we have included additional learning resources to build your own robot. Let's get started!</p>
<p>In this chapter, we are going to access the Raspberry Pi Zero via remote login (SSH) and remotely transferred files from the Raspberry Pi Zero. If you are not familiar with the command-line interface, we recommend proceeding to <a href="83036e86-f65c-46ed-996d-4f1aeeab5022.xhtml">Chapter 11</a>, <em>Tips and Tricks</em>, to set up your local desktop environment.</p>
<div><img class="image-border" height="194" src="img/image_09_001.png" width="286"/></div>
<p>A Raspberry Pi Zero powered robot<br/></p>
<p>Since we will be making use of a camera for our robot, Raspberry Pi Zero v1.3 or higher is needed for this chapter. Your Raspberry Pi Zero's board version is available on the back. Refer to the following picture:</p>
<div><img class=" image-border" height="301" src="img/image_09_002.png" width="309"/></div>
<p>Identifying your Raspberry Pi Zero's version</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Components of the robot</h1>
            

            
                
<p>Let's discuss the components of the robot using the labeled picture as an aid (shown in the following figure):</p>
<div><img class=" image-border" height="287" src="img/image_09_003.png" width="425"/></div>
<p>Components of the robot</p>
<p>The following is an explanation for the components of the robot:</p>
<ul>
<li>The Raspberry Pi Zero controls the movement of the robot using a motor driver circuit (stacked on top of the Raspberry Pi Zero)</li>
<li>The motors of the robot are connected to the motor driver circuit</li>
<li>A USB battery pack is used to power the Raspberry Pi Zero. A separate AA battery pack is used to drive the motors</li>
<li>The robot is also equipped with a camera module that helps with driving the robot</li>
</ul>
<p>We have included a suggested list of components where we chose the cheapest source available for the component. You are welcome to substitute with your own components. For example, you can use a webcam instead of using the Raspberry Pi camera module:</p>
<table class="table">
<tbody>
<tr>
<td><strong>Component</strong></td>
<td><strong>Source</strong></td>
<td><strong>Quantity</strong></td>
<td><strong>Price (in USD)</strong></td>
</tr>
<tr>
<td>Chassis</td>
<td><a href="https://www.adafruit.com/products/2943">https://www.adafruit.com/products/2943</a></td>
<td>1</td>
<td>9.95</td>
</tr>
<tr>
<td>Chassis top plate</td>
<td><a href="https://www.adafruit.com/products/2944">https://www.adafruit.com/products/2944</a></td>
<td>1</td>
<td>4.95</td>
</tr>
<tr>
<td>A set of M2.5 rows, spacers, and nuts</td>
<td>
<p><a href="http://a.co/dpdmb1B">http://a.co/dpdmb1B</a></p>
</td>
<td>1</td>
<td>11.99</td>
</tr>
<tr>
<td>DC motors in servo body</td>
<td><a href="https://www.adafruit.com/products/2941">https://www.adafruit.com/products/2941</a></td>
<td>2</td>
<td>3.50</td>
</tr>
<tr>
<td>Wheel</td>
<td><a href="https://www.adafruit.com/products/2744">https://www.adafruit.com/products/2744</a></td>
<td>2</td>
<td>2.50</td>
</tr>
<tr>
<td>Castor wheel</td>
<td><a href="https://www.adafruit.com/products/2942">https://www.adafruit.com/products/2942</a></td>
<td>1</td>
<td>1.95</td>
</tr>
<tr>
<td>Raspberry Pi Zero</td>
<td><a href="https://www.adafruit.com/products/3400">https://www.adafruit.com/products/3400</a></td>
<td>1</td>
<td>5.00</td>
</tr>
<tr>
<td>A Raspberry Pi Zero camera module</td>
<td>
<p><a href="http://a.co/07iFhxC">http://a.co/07iFhxC</a></p>
</td>
<td>1</td>
<td>24.99</td>
</tr>
<tr>
<td>A Raspberry Pi Zero camera adapter</td>
<td><a href="https://www.adafruit.com/products/3157">https://www.adafruit.com/products/3157</a></td>
<td>1</td>
<td>5.95</td>
</tr>
<tr>
<td>A motor driver circuitry for Raspberry Pi Zero</td>
<td><a href="https://www.adafruit.com/products/2348">https://www.adafruit.com/products/2348</a></td>
<td>1</td>
<td>22.50</td>
</tr>
<tr>
<td>USB battery pack</td>
<td><a href="http://a.co/9vQLx2t">http://a.co/9vQLx2t</a></td>
<td>1</td>
<td>5.09</td>
</tr>
<tr>
<td>AA battery pack (4 batteries)</td>
<td><a href="http://a.co/hVPxfzD">http://a.co/hVPxfzD</a></td>
<td>1</td>
<td>5.18</td>
</tr>
<tr>
<td>AA batteries</td>
<td>NA</td>
<td>4</td>
<td>N.A.</td>
</tr>
<tr>
<td>Raspberry Pi camera module mount</td>
<td><a href="https://www.adafruit.com/products/1434">https://www.adafruit.com/products/1434</a></td>
<td>1</td>
<td>4.95</td>
</tr>
</tbody>
</table>
<p>In the interest of saving time, we chose off-the-shelf accessories to build robot. We specifically chose Adafruit for the ease of purchase and shipping. If you are interested in building a robot that needs to suit outdoor conditions, we recommend a chassis similar to <a href="http://www.robotshop.com/en/iron-man-3-4wd-all-terrain-chassis-arduino.html">http://www.robotshop.com/en/iron-man-3-4wd-all-terrain-chassis-arduino.html</a>.</p>
<p>As makers, we recommend making your own chassis and control circuitry (especially the motor drive). You can make use of software such as Autodesk Fusion (the link is available in the resources section) to design the chassis.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Setting up remote login</h1>
            

            
                
<p>To control the robot remotely, we need to set up remote login access, that is, enable the SSH access. <strong>Secure Shell</strong> (<strong>SSH</strong>), and it is a protocol that enables remote access of a computer. The SSH access is disabled by default on the Raspbian operating system for security reasons. In this section, we will enable the SSH access to the Raspberry Pi Zero and change the Raspberry Pi Zero's default password.</p>
<p>If you are not familiar with the SSH access, we have provided a quick tutorial in <a href="83036e86-f65c-46ed-996d-4f1aeeab5022.xhtml">Chapter 11</a>, <em>Tips and Tricks</em>. We would like to keep the focus on building the robot in this chapter.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Changing the password</h1>
            

            
                
<p>Before we enable the SSH access, we need to change the default password of the Raspberry Pi Zero. This is to avoid any potential threat to your computer and your robot! We have advocated changing default passwords on multiple occasions in this chapter. Default passwords have wreaked havoc across the Internet.</p>
<p>Recommended reading <em>Mirai botnet attack</em>: <a href="http://fortune.com/2016/10/23/internet-attack-perpetrator/">http://fortune.com/2016/10/23/internet-attack-perpetrator/</a>.</p>
<p>On your desktop, go to Menu | Preferences and launch Raspberry Pi Configuration. Under the System tab, there is an option to change the password under the System tab (shown in the following screenshot):</p>
<div><img class=" image-border" height="281" src="img/image_09_004.png" width="640"/></div>
<p>Change your Raspberry Pi Zero's default password</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Enabling SSH access</h1>
            

            
                
<p>Under the Interfaces tab of the Raspberry Pi configuration, select Enable for SSH (as shown in the following screenshot):</p>
<div><img class=" image-border" height="246" src="img/image_09_005.png" width="588"/></div>
<p>Enable SSH under the Interfaces tab</p>
<p>Reboot your Raspberry Pi Zero, and you should be able to access your Raspberry Pi Zero via SSH.</p>
<p>Refer to <a href="83036e86-f65c-46ed-996d-4f1aeeab5022.xhtml">Chapter 11</a>, <em>Tips and Tricks</em>, for the SSH access to your Raspberry Pi Zero from Windows, *nix operating systems (beyond the scope of this chapter).</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Chassis setup</h1>
            

            
                
<p>The robot is going to have a differential steering mechanism. Thus, it is going to be steered by two motors. It is going to be supported by a third castor that acts as a support.</p>
<p>In a differential steering mechanism arrangement, the robot moves in the forward direction or backward direction when both the wheels of the robot are rotating in the same direction. The robot can turn left or right by rotating one wheel faster than the other wheel. For example, in order to rotate left, the right motor needs to rotate faster than the left and vice versa.</p>
<p>In order to reach a better understanding of the differential steering mechanism, we recommend building out the chassis and testing it with the Raspberry Pi Zero (We are going to test our chassis using a simple program in the later part of this chapter).</p>
<p>We have provided additional resources on differential steering at the end of this chapter.</p>
<div><img class="image-border" height="352" src="img/image_09_006.jpg" width="262"/></div>
<p>Chassis prep for the robot<br/></p>
<ol>
<li>The chassis comes with the required provisions along with the screws required to mount the motors. Ensure that the motor's wires are facing the same side (Refer to the picture given later). Similarly, the castor wheel can be assembled at the front, as shown in the picture here:</li>
</ol>
<div><img class=" image-border" height="233" src="img/image_09_007.png" width="174"/></div>
<p>Assemble motors and mount castor wheels</p>
<ol start="2">
<li>The next step is mounting the wheels. The wheels are designed to be press-fitted directly onto the motor shaft.</li>
</ol>
<div><img class=" image-border" height="194" src="img/image_09_008.png" width="192"/></div>
<p>Assembling wheels onto the servo</p>
<ol start="3">
<li>Lock the wheels in place using a screw (comes with the wheels)</li>
</ol>
<div><img class=" image-border" height="256" src="img/image_09_009.png" width="349"/></div>
<p>Lock the wheel onto the shaft</p>
<p>Thus, we are done setting up the chassis for the robot. Let's move on to the next section.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Motor driver and motor selection</h1>
            

            
                
<p>The motor driver circuit (<a href="https://www.adafruit.com/product/2348">https://www.adafruit.com/product/2348</a>) can be used to connect four DC motors or two stepper motors. The motor driver is rated to provide 1.2 A of current per motor under continuous operation. This sufficiently meets the robot's motor power requirement.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Preparing the motor driver circuit</h1>
            

            
                
<p>The motor driver circuit comes as a kit, and it requires some soldering (shown in the figure here).</p>
<div><img class=" image-border" height="255" src="img/image_09_010.png" width="279"/></div>
<p>Adafruit DC and Stepper Motor HAT for Raspberry Pi-Mini Kit (picture source: adafruit.com)</p>
<ol>
<li>The first step in the assembly process is to solder the 40 pin header. Stack the header on top of your Raspberry Pi Zero and as shown in the picture here:</li>
</ol>
<div><img class=" image-border" height="193" src="img/image_09_011.png" width="246"/></div>
<p>Stack the header on top of the Raspberry Pi Zero</p>
<ol start="2">
<li>Position the motor driver (as shown in the picture here) on top of the header. Hold on to the motor driver board so that the board is not tilted while soldering.</li>
</ol>
<div><img class=" image-border" height="244" src="img/image_09_012.png" width="356"/></div>
<p>Stack the motor HAT on top of the Raspberry Pi Zero</p>
<ol start="3">
<li>Solder the corner pins of the motor driver first and proceed to solder the other pins.</li>
</ol>
<div><img class=" image-border" height="179" src="img/image_09_013.png" width="379"/></div>
<p>Note the motor driver board soldered such that the board is parallel to the Raspberry Pi Zero<br/></p>
<ol start="4">
<li class="packt_figure">Now, solder the 3.5 mm terminals (see the blue colored ones in the picture) by flipping the board</li>
</ol>
<div><img class=" image-border" height="158" src="img/image_09_014.png" width="227"/></div>
<p>Solder the 3.5 mm terminals</p>
<ol start="5">
<li>The motor driver board is ready to use!</li>
</ol>
<div><img class=" image-border" height="178" src="img/image_09_015.png" width="294"/></div>
<p>The motor driver is ready to use</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Raspberry Pi Zero and motor driver assembly</h1>
            

            
                
<p>In this section, we are going to test the movements of the robot. This includes testing the motor driver and basic movements of the robot.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Raspberry Pi Zero and motor driver assembly</h1>
            

            
                
<p>In this section, we are going to assemble the Raspberry Pi Zero and the motor driver on to the robot chassis.</p>
<ol>
<li>In order to mount the Raspberry Pi Zero on to the chassis, we need 4 M2.5 screws and nuts (Mounting hole specification available at <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/mechanical/rpi-zero-v1_2_dimensions.pdf">https://www.raspberrypi.org/documentation/hardware/raspberrypi/mechanical/rpi-zero-v1_2_dimensions.pdf</a>).</li>
<li>The chassis we selected comes with slots that enables mounting the Raspberry Pi Zero directly on to the chassis. Based on your chassis design, you may have to drill clearance holes to mount the Raspberry Pi Zero.</li>
</ol>
<div><img class=" image-border" height="289" src="img/image_09_016.png" width="409"/></div>
<p>Mounting the Raspberry Pi Zero onto the chassis</p>
<p>While mounting the Raspberry Pi Zero, we ensured that we are able to plug in the HDMI cable, USB cable, and so on for testing purposes.</p>
<ol start="3">
<li>The chassis we have used is made of anodized aluminum;hence, it is nonconductive. We mounted the Raspberry Pi Zero directly, without any insulation between the chassis and the Raspberry Pi Zero.</li>
</ol>
<p>Ensure that you don't short circuit any component by accidentally exposing them directly to conductive metal surfaces.</p>
<ol start="4">
<li>Stack the motor driver on top of the Raspberry Pi Zero (as shown in the previous section).</li>
<li>The two motors of the robot need to be connected to the Raspberry Pi Zero:</li>
<li>The motor driver comes with motor terminals M1 through M4. Let's connect the left and right DC motors to M1 and M2, respectively.</li>
</ol>
<div><img class=" image-border" height="297" src="img/image_09_017.png" width="366"/></div>
<p>Red and black wires connected from both the motors to the motor driver terminals</p>
<ol start="7">
<li>Each motor comes with two terminals, that is, black wire and a red wire. Connect the black wire to the left-most terminal of the bridge M1 and the red wire to the right-hand side terminal of the bridge M1 (as shown in the picture earlier). Similarly, the right motor is connected to the bridge M2.</li>
</ol>
<p>Now, that we have connected the motors, we need to test the motor function and verify that the motors are rotating in the same direction. In order to do so, we need to set up the robot's power supply.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Robot Power supply setup</h1>
            

            
                
<p>In this section, we will discuss setting up the power supply for the Raspberry Pi Zero. We will discuss powering the Raspberry Pi Zero and the motors of the robot. Let's discuss the major components of our robot and their power consumption:</p>
<ul>
<li>The Raspberry Pi Zero requires a 5V power supply, and it draws about 150 mA of current (Source: <a href="http://raspberrypi.stackexchange.com/a/40393/1470">http://raspberrypi.stackexchange.com/a/40393/1470</a>).</li>
<li>The two DC motors of the robot consume about 150 mA each.</li>
<li>The camera module consumes 250 mA of current (Source: <a href="https://www.raspberrypi.org/help/faqs/#cameraPower">https://www.raspberrypi.org/help/faqs/#cameraPower</a>).</li>
</ul>
<p>The total power consumption estimate is about 550 mA (150 + 150*2 + 250).</p>
<p>In order to calculate the battery capacity, we also need to decide the duration of continuous operation before requiring a recharge. We wanted the robot to operate at least for 2 hours before requiring a recharge. The battery capacity can be calculated using the following formula:</p>
<div><img class=" image-border" src="img/image_09_018.png"/></div>
<p>In our case, this would be:</p>
<div><em>550mA * 2 hours = 1100 mAh</em></div>
<p>We also found a battery life calculator from Digi-Key:<br/>
<a href="http://www.digikey.com/en/resources/conversion-calculators/conversion-calculator-battery-life">http://www.digikey.com/en/resources/conversion-calculators/conversion-calculator-battery-life</a></p>
<p>According to the Digi-Key calculator, we need to account for factors that affect the battery life. Accounting for such factors, the battery capacity would be:</p>
<div><em>1100 mAh /0.7 = 1571.42 mAh</em></div>
<p>We took this number into account while purchasing a battery for the robot. We decided to purchase this <kbd>2200mAh</kbd> USB battery pack that operates at 5V (shown in the picture later and the link for purchase has been shared with the bill of materials discussed earlier in this chapter):</p>
<div><img class=" image-border" height="150" src="img/image_09_019.png" width="183"/></div>
<p>2200 mAh 5V USB battery pack</p>
<p>Ensure that the battery pack is fully charged before assembling it on to the robot:</p>
<ol>
<li>Once the battery pack is fully charged, mount it on to the robot using double-sided tape and plug a micro-USB cable, as shown in the picture:</li>
</ol>
<div><img class=" image-border" height="185" src="img/image_09_020.png" width="240"/></div>
<p>2200 mAh 5V USB battery pack</p>
<ol start="2">
<li>We need to verify that the Raspberry Pi Zero powers up when a battery pack is used.</li>
<li>Plug in the HDMI cable (that is connected to a monitor) and using a very short micro-USB cable, try to power up the Raspberry Pi Zero and make sure that everything powers up correctly.</li>
</ol>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Setting up the motor power supply</h1>
            

            
                
<p>Now that we have set up the power supply for the robot and verified that the Raspberry Pi Zero powers up using the USB battery pack, we will discuss power supply options to drive the motors of the robot. We are discussing this because the type of motor, and its power supply determines the performance of our robot. Let's get started!</p>
<p>Let's revisit the motor driver that we set up in the previous section. The unique feature of this motor driver is that it is equipped with its own voltage regulator and polarity protection. Thus, it enables connecting an external power supply to power the motors (shown in the picture here)</p>
<div><img class=" image-border" height="281" src="img/image_09_021.png" width="342"/></div>
<p>Motor driver power terminals</p>
<p>This motor driver enables driving any motor with a voltage requirement of 5-12V and current rating of 1.2A. There are two options to power the motors of your robot:</p>
<ul>
<li>Using the Raspberry Pi Zero's 5V GPIO power supply</li>
<li>Using an external power supply</li>
</ul>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Using the Raspberry Pi Zero's 5V power supply</h1>
            

            
                
<p>The motor driver is designed such that it can act as a prototyping platform. There is a bank of 5V and 3.3V power supply pins that is connected to the Raspberry Pi Zero's 5V and 3.3V GPIO pins. These GPIO pins are rated to provide a current of 1.5A (Source: <a href="https://pinout.xyz/pinout/pin2_5v_power">https://pinout.xyz/pinout/pin2_5v_power</a>). They are directly connected to the 5V USB input of your Raspberry Pi Zero. (The USB battery pack used in this robot is rated to provide an output of 5V, 1 A).</p>
<ol>
<li>The first step in connecting the Raspberry Pi's 5V GPIO power supply is soldering a red and black piece of wire (of appropriate length) from the 5V and GND pins, respectively (as shown in the figure here):</li>
</ol>
<div><img class=" image-border" height="239" src="img/image_09_022.png" width="436"/></div>
<p>Solder red and black pieces of wires from 5V and GND pins</p>
<ol start="2">
<li>Now, connect the red and black wires to terminal marked 5-12V motor power (Red wire goes to + and Black wire goes to -).</li>
</ol>
<div><img class=" image-border" height="282" src="img/image_09_023.png" width="225"/></div>
<p>Connect 5V and GND to the motor power supply terminals</p>
<ol start="3">
<li>Now, power up your Raspberry Pi Zero and measure the voltage across your motor power supply terminals. It should be receiving 5V, and the power LED of the motor driver should be glowing green (as shown in the next picture). If not, check the solder connections of the motor driver.</li>
</ol>
<div><img class=" image-border" height="224" src="img/image_09_024.png" width="293"/></div>
<p>Green LED lights up when the Raspberry Pi Zero is powered up<br/></p>
<ol start="4">
<li>This method is useful only when low-power motors are used (like the ones used in this chapter). If you have a motor with a higher voltage rating (voltage rating greater than 5V), you need to connect an external power supply. We will review connecting an external power supply in the next section.</li>
</ol>
<p>If you find your Raspberry Pi Zero constantly resetting itself while driving your robot, it is possible that the USB battery pack is not able to drive the robot's motors. It is time to connect an external power supply!</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Using an external power supply</h1>
            

            
                
<p>In this section, we are going to discuss connecting an external power supply to drive the motors. We will discuss connecting a 6V power supply to power the motors.</p>
<ol>
<li>We will make use of a battery pack that consists of 4 AA batteries to drive the motors (battery packs available at <a href="http://a.co/hVPxfzD">http://a.co/hVPxfzD</a>).</li>
<li>We need to install the battery pack such that it leads could be connected to the motor drivers power terminals.</li>
<li>The robot chassis kit came with an additional aluminum plate that could be used to install the battery pack (shown in the figure here):</li>
</ol>
<div><img class=" image-border" height="167" src="img/image_09_025.png" width="228"/></div>
<p>Additional aluminium plate to hold the battery pack<br/></p>
<ol start="4">
<li>We made use of four M2.5 stand-offs (shown in the picture) to hold the aluminum plate:</li>
</ol>
<div><img class=" image-border" height="213" src="img/image_09_026.png" width="215"/></div>
<p>Assemble M2.5 stand-offs to hold the aluminium plate</p>
<ol start="5">
<li>Now, we used M2.5 screws to secure the aluminum plate (as shown in the figure here):</li>
</ol>
<div><img class=" image-border" height="209" src="img/image_09_027.png" width="281"/></div>
<p>Secure the aluminium plate<br/></p>
<ol start="6">
<li>Using double-sided tape, the battery pack was installed (the battery pack contains four AA batteries) on top of the aluminum plate. Then, the red and black wires of the battery pack are connected to the + and - terminals of the motor driver, respectively (as shown in the figure here).</li>
</ol>
<div><img class=" image-border" height="209" src="img/image_09_028.png" width="236"/></div>
<p>Battery installed on the aluminium plate</p>
<ol start="7">
<li>Slide the battery pack switch to ON, and the motor driver should turn on as explained in the previous section.</li>
</ol>
<p>Thus, the power supply setup is complete. In the next section, we will discuss taking the robot on a test drive.</p>
<p>If you are looking for a battery with a higher capacity for your robot, we recommend considering LiPo batteries. This also means that you need motors with a better rating and a chassis that can withstand the battery weight.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Testing the motors</h1>
            

            
                
<p>In this section, we will verify that the motor driver is detected by the Raspberry Pi Zero and test the motor function. In the test, we will verify that the motors are rotating in the same direction.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Motor driver detection</h1>
            

            
                
<p>In this section, we will verify that the motor driver is detected by the Raspberry Pi Zero. The Raspberry Pi Zero <em>talks</em> to the motor driver via the I<sup>2</sup>C interface (Refer to <a href="56d43053-0d4d-47a4-bf28-c36fc00a7da2.xhtml">Chapter 4</a>, <em>Communication Interfaces</em>, if you are not familiar with the I<sup>2</sup>C interface). Hence, we need to enable the I<sup>2</sup>C interface of the Raspberry Pi Zero. There are two ways to enable the I<sup>2</sup>C interface:</p>
<p><strong>Method 1: From the Desktop</strong></p>
<p>Like enabling <kbd>ssh</kbd> by launching the Raspberry Pi Configuration from your Raspberry Pi Zero's desktop, you can enable the I<sup>2</sup>C interface from the interface tab of the configuration (shown in the snapshot here):</p>
<div><img class=" image-border" height="233" src="img/image_09_029.png" width="560"/></div>
<p>Enable I<sup>2</sup>C interface</p>
<p><strong>Method 2: From the command line</strong></p>
<p>We strongly recommend using this method as a practice toward getting comfortable with the command-line interface on the Raspberry Pi and remote login via <kbd>ssh</kbd>.</p>
<ol>
<li>Log in to your Raspberry Pi Zero via <kbd>ssh</kbd> (Refer to <a href="83036e86-f65c-46ed-996d-4f1aeeab5022.xhtml">Chapter 11</a>, <em>Tips and Tricks</em>, for a tutorial on the <kbd>ssh</kbd> access).</li>
<li>Upon login, launch <kbd>raspi-config</kbd> as follows:</li>
</ol>
<pre>
       <strong>sudo raspi-config.</strong>
</pre>
<ol start="3">
<li>It should launch the config options menu (shown in the screenshot here):</li>
</ol>
<div><img class=" image-border" height="165" src="img/image_09_030.png" width="518"/></div>
<p>The raspi-config menu</p>
<ol start="4">
<li>Select Option 7: Advanced Options (using the keyboard) and select A7: I2C</li>
</ol>
<div><img class=" image-border" height="166" src="img/image_09_031.png" width="527"/></div>
<p>Select the I<sup>2</sup>C interface</p>
<ol start="5">
<li>Select Yes to enable the I<sup>2</sup>C interface.</li>
</ol>
<div><img class=" image-border" height="210" src="img/image_09_032.png" width="325"/></div>
<p>Enable the I<sup>2</sup>C interface</p>
<ol start="6">
<li>Now that the I<sup>2</sup>C interface is enabled, let's get started with detecting the motor driver.</li>
</ol>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Detecting motor driver</h1>
            

            
                
<p>The motor driver is connected to I<sup>2</sup>C port-1 (the I<sup>2</sup>C port-0 serves a different purpose. Refer to <a href="83036e86-f65c-46ed-996d-4f1aeeab5022.xhtml">Chapter 11</a>, <em>Tips and Tricks</em>, for more information). We will make use of the <kbd>i2cdetect</kbd> command to scan for devices connected via the I<sup>2</sup>C interface. On your command-line interface, run the following command:</p>
<pre>
    <strong><br/>sudo i2cdetect -y 1<br/></strong>
</pre>
<p>It provides an output that looks like this:</p>
<pre>
    <strong><br/><br/>0<br/><br/>1<br/><br/>2<br/><br/>3<br/><br/>4<br/><br/>5<br/><br/>6<br/><br/>7<br/><br/>8<br/><br/>9<br/><br/>a<br/><br/>b<br/><br/>c<br/><br/>d<br/><br/>e<br/><br/>f<br/></strong><br/><strong><br/>00:<br/><br/>-- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>60: 60 -- -- -- -- -- -- -- -- -- -- -- -- -- -- --<br/></strong><br/><strong><br/>70: 70 -- -- -- -- -- -- --<br/><br/></strong>
</pre>
<p>I<sup>2</sup>C chips come with a 7-bit address that is used to identify the chip and establish communication. In this case, the I<sup>2</sup>C interface address is <kbd>0x60</kbd> (refer to the motor driver documentation at <a href="https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi">https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi</a>). As shown in the output earlier, the Raspberry Pi Zero detects the motor driver. It is time to test if we can control the motors.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Motor test</h1>
            

            
                
<p>In this section, we are going to test the motors; that is, determine if we can drive the motors using the motor driver. In this test, we determined if the Raspberry Pi's supply was sufficient to drive the motors (or whether an external battery pack) was necessary.</p>
<p>In order to get started, we need to install the motor driver libraries (distributed by Adafruit under MIT license) and its dependency packages.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Dependencies</h1>
            

            
                
<p>The dependencies for the motor driver libraries may be installed from the command-line terminal of your Raspberry Pi Zero as follows (you may skip this step if you installed these tools while working on <a href="56d43053-0d4d-47a4-bf28-c36fc00a7da2.xhtml">Chapter 4</a>, <em>Communication Interfaces</em>):</p>
<pre>
    <strong>sudo apt-get update</strong><br/><strong>    sudo apt-get install python3-dev python3-smbus</strong>
</pre>
<p>The next step is cloning the motor driver library:</p>
<pre>
    <strong>git clone https://github.com/sai-y/Adafruit-Motor-HAT-Python-<br/>    Library.git</strong>
</pre>
<p>This library is a fork of the <em>Adafruit Motor HAT library</em>. We fixed some issues to make the library installation compatible with Python 3.x.</p>
<p>The library can be installed as follows:</p>
<pre>
    <strong>cd Adafruit-Motor-HAT-Python-Library</strong><br/><strong>    sudo python3 setup.py install</strong>
</pre>
<p>Now that the libraries are installed, let's write a program that rotates the motors continuously:</p>
<ol>
<li>As always, the first step is importing the <kbd>MotorHAT</kbd> module:</li>
</ol>
<pre>
       from Adafruit_MotorHAT import Adafruit_MotorHAT, <br/>       Adafruit_DCMotor
</pre>
<ol start="2">
<li>The next step is to create an instance of the <kbd>MotorHAT</kbd> class and establish the interface with the motor driver (as discussed in the previous section, the motor driver's 7-bit address is <kbd>0x60</kbd>).</li>
<li>The motors of the robot are connected to channels 1 and 2. Hence, we need to initialize two instances of the <kbd>Adafruit_DCMotor</kbd> class that represent the left and right motors of the robot:</li>
</ol>
<pre>
       left_motor = motor_driver.getMotor(1) <br/>       right_motor = motor_driver.getMotor(2)
</pre>
<ol start="4">
<li>The next step is setting the motor speed and motor direction. The motor speed can be set using an integer between <kbd>0</kbd> and <kbd>255</kbd> (which corresponds to 0% and 100% of the motor's rated rpm). Let's set the motor speed at 100%:</li>
</ol>
<pre>
       left_motor.setSpeed(255) <br/>       right_motor.setSpeed(255)
</pre>
<ol start="5">
<li>Let's rotate the motors in the forward direction:</li>
</ol>
<pre>
       left_motor.run(Adafruit_MotorHAT.FORWARD) <br/>       right_motor.run(Adafruit_MotorHAT.FORWARD)
</pre>
<ol start="6">
<li>Let's rotate both the motors in the forward direction for 5 seconds and then reduce the speed:</li>
</ol>
<pre>
       left_motor.setSpeed(200) <br/>       right_motor.setSpeed(200)
</pre>
<ol start="7">
<li>Now, let's rotate the motors in the reverse direction:</li>
</ol>
<pre>
       left_motor.run(Adafruit_MotorHAT.BACKWARD) <br/>       right_motor.run(Adafruit_MotorHAT.BACKWARD)
</pre>
<ol start="8">
<li>Let's turn off the motors once we are done rotating the motors in the reverse direction for 5 seconds:</li>
</ol>
<pre>
       left_motor.run(Adafruit_MotorHAT.RELEASE) <br/>       right_motor.run(Adafruit_MotorHAT.RELEASE)
</pre>
<p>Putting it altogether:</p>
<pre>
from Adafruit_MotorHAT import Adafruit_MotorHAT, Adafruit_DCMotor <br/>from time import sleep <br/><br/><br/>if __name__ == "__main__": <br/>  motor_driver = Adafruit_MotorHAT(addr=0x60) <br/><br/>  left_motor = motor_driver.getMotor(1) <br/>  right_motor = motor_driver.getMotor(2) <br/><br/>  left_motor.setSpeed(255) <br/>  right_motor.setSpeed(255) <br/><br/>  left_motor.run(Adafruit_MotorHAT.FORWARD) <br/>  right_motor.run(Adafruit_MotorHAT.FORWARD) <br/><br/>  sleep(5) <br/><br/>  left_motor.setSpeed(200) <br/>  right_motor.setSpeed(200) <br/><br/>  left_motor.run(Adafruit_MotorHAT.BACKWARD) <br/>  right_motor.run(Adafruit_MotorHAT.BACKWARD) <br/><br/>  sleep(5) <br/><br/>  left_motor.run(Adafruit_MotorHAT.RELEASE) <br/>  right_motor.run(Adafruit_MotorHAT.RELEASE)
</pre>
<p>The preceding code sample is available for download along with this chapter as <kbd>motor_test.py</kbd>. Recharge the USB battery pack before you test the motors. We picked the test duration long enough to verify the motor direction, performance, and so on.</p>
<p>If your Raspberry Pi Zero seems to be resetting itself while running or the motors aren't running at the rated speed, it is an indicator that the motors are not being driven with the sufficient current. Switch over to a power source that meets the requirement (this may involve switching from the GPIO's power supply to the battery pack or switching to a battery pack of higher capacity).</p>
<p>Now that the motors are tested, let us set up a camera for the robot.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Camera setup</h1>
            

            
                
<p>You will need a Raspberry Pi Zero 1.3 or higher to set up the camera. We discussed identifying your Raspberry Pi Zero's board version at the beginning of this chapter. You may also skip this section if you are familiar with setting up the camera from <a href="1b22cd82-cc62-452e-a69b-a8742a02ecd4.xhtml">Chapter 8</a>, <em>Awesome Things You Could Develop Using Python</em>.</p>
<p>In this section, we will set up the camera for the robot. The Raspberry Pi Zero (v1.3 onward) comes with a camera adapter. This enables adding a camera module to the robot (designed and manufactured by the Raspberry Pi foundation). The camera module was designed to suit different models of the Raspberry Pi.</p>
<p>The Raspberry Pi Zero's camera interface needs an adapter that is different than the ones meant for other models. The sources to purchase the camera and the adapter were shared with the bill of materials of this chapter.</p>
<p>Let's get started:</p>
<ol>
<li>Ensure that your Raspberry Pi Zero is powered down and identify the shorter side of the camera adapter. In the image shown here, the shorter side is to the right.</li>
</ol>
<div><img class=" image-border" height="76" src="img/image_09_033.png" width="607"/></div>
<p>Pi Zero Camera Adapter-Image source: adafruit.com</p>
<ol start="2">
<li>Carefully, slide out the camera interface of the Raspberry Pi zero (as shown in the picture here). Pay attention to avoid breaking your camera interface tab.</li>
</ol>
<div><img class=" image-border" height="257" src="img/image_09_034.png" width="162"/></div>
<p>Slide the tabs of the camera interface carefully</p>
<ol start="3">
<li>Gently slide in the camera module. Latch the camera adapter cable and gently tug on it to make sure that the adapter cable doesn't slide out of its position. The camera adapter should be seated, as shown in the picture here.</li>
</ol>
<div><img class=" image-border" height="283" src="img/image_09_035.png" width="233"/></div>
<p>Camera adapter placement</p>
<ol start="4">
<li>Repeat the exercise for the other end of the camera adapter to interface it with the camera module.</li>
</ol>
<div><img class=" image-border" height="215" src="img/image_09_036.png" width="166"/></div>
<p>Insert adapter on the other side</p>
<ol start="5">
<li>The camera adapter cable can be unwieldy while trying to install the camera on the robot. We recommend installing a mount (source shared in the bill of materials).</li>
</ol>
<div><img class=" image-border" height="214" src="img/image_09_037.png" width="161"/></div>
<p>Raspberry Pi camera module mount</p>
<ol start="6">
<li>Using the double-sided tape, install the camera to the front of your robot.</li>
</ol>
<div><img class=" image-border" height="236" src="img/image_09_038.png" width="172"/></div>
<p>Camera mounted in front of the robot</p>
<ol start="7">
<li>Log in to your Raspberry Pi Zero's desktop via <kbd>ssh</kbd> to enable and test the camera interface.</li>
<li>Enabling the camera interface is similar to enabling the I<sup>2</sup>C interface discussed earlier in this chapter. Launch Raspberry Pi configuration using the <kbd>raspi-config</kbd> command:</li>
</ol>
<pre>
       <strong>sudo raspi-config</strong>
</pre>
<p style="padding-left: 60px">Select Option P1: Enable Camera (found under Interfacing Options of the main configuration menu) and enable the camera:</p>
<div><img class=" image-border" height="159" src="img/image_09_039.png" width="499"/></div>
<p>The screenshot of the Raspberry Configuration screen</p>
<div><ol start="9">
<li>Reboot your Raspberry Pi Zero!</li>
</ol>
</div>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Verification of camera function</h1>
            

            
                
<ol>
<li>Once your reboot is complete, run the following command from the Command Prompt:</li>
</ol>
<pre>
       <strong>raspistill -o test_picture </strong>
</pre>
<ol start="2">
<li>Since your robot is completely assembled, the HDMI port of your Raspberry Pi Zero is probably inaccessible. You should retrieve the file using the <kbd>scp</kbd> command.</li>
</ol>
<p>On a Windows Machine, you can copy files from your Raspberry Pi Zero using a tool such as WinSCP. On a Mac/Linux desktop, you can use the <kbd>scp</kbd> command. Refer to <a href="83036e86-f65c-46ed-996d-4f1aeeab5022.xhtml">Chapter 11</a>, <em>Tips and Tricks</em>, for a detailed tutorial on remote login and copying of files from your Raspberry Pi Zero.</p>
<pre>
       <strong>scp pi@192.168.86.111:/home/pi/test_output.</strong>
</pre>
<ol start="3">
<li>Examine the picture taken using the Raspberry Pi camera module to verify its function</li>
</ol>
<div><img class=" image-border" height="215" src="img/image_09_040.png" width="194"/></div>
<p>Picture of a coffee cup taken using the Raspberry Pi camera module</p>
<p>Now that we have verified the function of the robot's components, we are going to bring everything together in the next section.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">The web interface</h1>
            

            
                
<p>Our objective behind building this robot as one of our final projects is to demonstrate using the topics discussed in this book in application development. To that end, we are going to make use of object-oriented programming and web frameworks to build a web interface to control the robot.</p>
<p>In <a href="2316ddf6-c2d7-4810-a7ab-3600a3e2549d.xhtml">Chapter 7</a>, <em>Requests and Web Frameworks</em>, we discussed the <kbd>flask</kbd> web framework. We are going to make use of <kbd>flask</kbd> to stream a live view of the camera module to a browser. We are also going to add buttons to the web interface that enables steering the robot. Let's get started!</p>
<p>Refer to <a href="2316ddf6-c2d7-4810-a7ab-3600a3e2549d.xhtml">Chapter 7</a>, <em>Requests and Web Frameworks</em>, for installation instructions and a basic tutorial on the <kbd>flask</kbd> framework.</p>
<p>Let's get started by implementing a simple web interface where we add four buttons to control the robot in the forward, reverse, left, and right directions. Let's assume that the robot moves at maximum speed in all directions.</p>
<p>We are going to make use of object-oriented programming to implement the motor control. We are going to demonstrate the use of object-oriented programming to simplify things (this concept of simplification is known as <strong>abstraction</strong>). Let's implement a <kbd>Robot</kbd> class that implements the motor control. This <kbd>Robot</kbd> class would initialize the motor driver and handle all control functions of the robot.</p>
<ol>
<li>Open a file named <kbd>robot.py</kbd> to implement the <kbd>Robot</kbd> class.</li>
<li>In order to control the movement of the robot, the robot needs the motor driver channels that are being used (to drive the motors) as inputs during initialization.</li>
<li>Hence, the <kbd>__init__()</kbd> function of the <kbd>Robot</kbd> class would be something as follows:</li>
</ol>
<pre>
       import time <br/>       from Adafruit_MotorHAT import Adafruit_MotorHAT <br/><br/><br/>       class Robot(object): <br/>         def __init__(self, left_channel, right_channel): <br/>           self.motor = Adafruit_MotorHAT(0x60) <br/>           self.left_motor = self.motor.getMotor(left_channel) <br/>           self.right_motor = self.motor.getMotor(right_channel)
</pre>
<ol start="4">
<li>In the preceding code snippet, the <kbd>__init__()</kbd> function requires the channels being used to connect the left and right motors to the motor driver board as arguments.</li>
<li>When an instance of the <kbd>Robot</kbd> class is created, the motor driver (<kbd>Adafruit_MotorHAT</kbd>) is initialized and the motor channels are initialized.</li>
<li>Let's write methods to move the robot in the forward and reverse directions:</li>
</ol>
<pre>
       def forward(self, duration): <br/>         self.set_speed() <br/>         self.left_motor.run(Adafruit_MotorHAT.FORWARD) <br/>         self.right_motor.run(Adafruit_MotorHAT.FORWARD) <br/>         time.sleep(duration) <br/>         self.stop() <br/><br/>       def reverse(self, duration): <br/>         self.set_speed() <br/>         self.left_motor.run(Adafruit_MotorHAT.BACKWARD) <br/>         self.right_motor.run(Adafruit_MotorHAT.BACKWARD) <br/>         time.sleep(duration) <br/>         self.stop()
</pre>
<ol start="7">
<li>Let's also write methods to move the robot in left- and right-hand side directions. In order to turn the robot left, we need to turn the left motor off and keep the right motor on and vice versa. This creates a turning moment and turns the robot in that direction:</li>
</ol>
<pre>
       def left(self, duration): <br/>         self.set_speed() <br/>         self.right_motor.run(Adafruit_MotorHAT.FORWARD) <br/>         time.sleep(duration) <br/>         self.stop() <br/><br/>       def right(self, duration): <br/>         self.set_speed() <br/>         self.left_motor.run(Adafruit_MotorHAT.FORWARD) <br/>         time.sleep(duration) <br/>         self.stop()
</pre>
<ol start="8">
<li>Thus, we have implemented a <kbd>Robot</kbd> class that drives the robot in the four directions. Let's implement a simple test so that we can test the <kbd>Robot</kbd> class before we use it in our main program:</li>
</ol>
<pre>
       if __name__ == "__main__": <br/>         # create an instance  of the robot class with channels 1 and 2 <br/>         robot = Robot(1,2) <br/>         print("Moving forward...") <br/>         robot.forward(5) <br/>         print("Moving backward...") <br/>         robot.reverse(5) <br/>         robot.stop()
</pre>
<p>The preceding code sample is available for download along with this chapter as <kbd>robot.py</kbd>. Try to run the program with the motor driver. It should run the motor in forward and reverse directions for 5 seconds. Now that we have implemented a stand-alone module for the robot's control, let's move on to the web interface.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Camera setup for the web interface</h1>
            

            
                
<p>You will encounter some issues even after following the instructions to the tee. We have included references that we used to fix the problem at the end of this chapter.</p>
<p>In this section, we will set up the camera to stream to a browser. The first step is installing the <kbd>motion</kbd> package:</p>
<pre>
    <strong>sudo apt-get install motion</strong>
</pre>
<p>Once the package is installed, the following configuration changes need to be applied:</p>
<ol>
<li>Edit the following parameters in <kbd>/etc/motion/motion.conf</kbd>:</li>
</ol>
<pre>
       <strong>daemon on</strong><br/><strong>       threshold 99999</strong><br/><strong>       framerate 90</strong><br/><strong>       stream_maxrate 100</strong><br/><strong>       stream_localhost off</strong>
</pre>
<ol start="2">
<li>Include the following parameter in <kbd>/etc/default/motion</kbd>:</li>
</ol>
<pre>
<strong>       start_motion_daemon=yes<br/></strong>
</pre>
<ol start="3">
<li>Edit <kbd>/etc/init.d/motion</kbd> as follows:</li>
</ol>
<pre>
       start)<br/><br/>       if check_daemon_enabled ; then<br/><br/>       if ! [ -d /var/run/motion ]; then<br/><br/>       mkdir /var/run/motion<br/><br/>       fi<br/><br/>       chown motion:motion /var/run/motion<br/><br/>       sudo modprobe bcm2835-v4l2<br/><br/>       chmod 777 /var/run/motion<br/><br/>       sleep 30<br/><br/>       log_daemon_msg "Starting $DESC" "$NAME"
</pre>
<ol start="4">
<li>Reboot your Raspberry Pi Zero.</li>
<li>The next step assumes that you have installed the flask framework and tried out the basic example from <a href="2316ddf6-c2d7-4810-a7ab-3600a3e2549d.xhtml">Chapter 7</a>, <em>Requests and Web Frameworks</em>.</li>
<li>Create a folder named <kbd>templates</kbd> within the folder where your <kbd>flask</kbd> framework and<br/>
<kbd>Robot</kbd> class files are located) and create a file named <kbd>index.html</kbd> in the folder with the following contents:</li>
</ol>
<pre>
      &lt;!DOCTYPE html&gt;<br/>       &lt;html&gt;<br/>         &lt;head&gt;<br/>           &lt;title&gt;Raspberry Pi Zero Robot&lt;/title&gt;<br/>         &lt;/head&gt;<br/><br/>         &lt;body&gt;<br/>          &lt;iframe id="stream" <br/>          src="img/?action=stream" width="320" height="240"&gt;<br/>          &lt;/iframe&gt;<br/><strong>       </strong>  &lt;/body&gt;<br/>       &lt;/html&gt;
</pre>
<ol start="7">
<li>In the preceding code snippet, include the IP address of your Raspberry Pi Zero and save it as <kbd>index.html</kbd>.</li>
</ol>
<ol start="8">
<li>Create a file named <kbd>web_interface.py</kbd> and serve <kbd>index.html</kbd> saved to the templates folder:</li>
</ol>
<pre>
       from flask import Flask, render_template<br/>       app = Flask(__name__)<br/><br/>       @app.route("/")<br/>       def hello():<br/>           return render_template('index.html')<br/><br/>       if __name__ == "__main__":<br/>           app.run('0.0.0.0')
</pre>
<ol start="9">
<li>Run the flask server using the following command:</li>
</ol>
<pre>
       <strong>python3 web_interface.py</strong>
</pre>
<ol start="10">
<li>Open a browser on your laptop and go to the IP address of your Raspberry Pi Zero (port <kbd>5000</kbd>) to see a live stream of your Raspberry Pi cam module.</li>
</ol>
<div><img class=" image-border" height="234" src="img/image_09_041.png" width="256"/></div>
<p>The snapshot of the live webcam stream (Raspberry Pi Cam module)</p>
<p>Let's move on to the next step to add buttons to the web interface.</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Buttons for robot control</h1>
            

            
                
<p>In this section, we will add implement buttons to the web interface to drive the robot.</p>
<ol>
<li>The first step is adding four buttons to <kbd>index.html</kbd>. We will be making use of HTML Table to add four buttons (Code snippet shortened for brevity and refer to <a href="http://www.w3schools.com/html/html_tables.asp">http://www.w3schools.com/html/html_tables.asp</a> for more information on HTML tables):</li>
</ol>
<pre>
       &lt;table style="width:100%; max-width: 500px; height:300px;"&gt; <br/>         &lt;tr&gt; <br/>           &lt;td&gt; <br/>             &lt;form action="/forward" method="POST"&gt; <br/>               &lt;input type="submit" value="forward" style="float:<br/>               left; width:80% ;"&gt; <br/>               &lt;/br&gt; <br/>             &lt;/form&gt; <br/>           &lt;/td&gt; <br/>       ... <br/>       &lt;/table&gt;
</pre>
<ol start="2">
<li>In <kbd>web_interface.py</kbd>, we need to implement a method that accepts <kbd>POST</kbd> requests from the buttons. For example, the method to accept requests from <kbd>/forward</kbd> can be implemented as follows:</li>
</ol>
<pre>
       @app.route('/forward', methods = ['POST']) <br/>       def forward(): <br/>           my_robot.forward(0.25) <br/>           return redirect('/')
</pre>
<ol start="3">
<li>Putting it altogether, <kbd>web_interface.py</kbd> looks something as follows:</li>
</ol>
<pre>
       from flask import Flask, render_template, request, redirect <br/>       from robot import Robot  <br/><br/>       app = Flask(__name__) <br/>       my_robot = Robot(1,2) <br/><br/>       @app.route("/") <br/>       def hello(): <br/>           return render_template('index.html') <br/><br/>       @app.route('/forward', methods = ['POST']) <br/>       def forward(): <br/>           my_robot.forward(0.25) <br/>           return redirect('/') <br/><br/>       @app.route('/reverse', methods = ['POST']) <br/>       def reverse(): <br/>           my_robot.reverse(0.25) <br/>           return redirect('/') <br/><br/>       @app.route('/left', methods = ['POST']) <br/>       def left(): <br/>           my_robot.left(0.25) <br/>           return redirect('/') <br/><br/>       @app.route('/right', methods = ['POST']) <br/>       def right(): <br/>           my_robot.right(0.25) <br/>           return redirect('/') <br/><br/>       if __name__ == "__main__": <br/>           app.run('0.0.0.0')
</pre>
<p>The preceding code sample is available for download along with this chapter as <kbd>web_interface.py</kbd> (along with <kbd>index.html</kbd>). Add the following line to <kbd>/etc/rc.local</kbd>(before <kbd>exit 0</kbd>):</p>
<pre>
    <strong>python3 /&lt;path_to_webserver_file&gt;/web_interface.py</strong>
</pre>
<p>Reboot your Raspberry Pi Zero, and you should see a live feed of the robot's camera. You should also be able to control the robot from the browser!</p>
<div><img class=" image-border" height="244" src="img/image_09_042.png" width="253"/></div>
<p>Control your robot a browser!</p>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Troubleshooting tips</h1>
            

            
                
<p>Here are some of the problems we encountered while building the robot:</p>
<ul>
<li>We broke our Raspberry Pi Zero's camera interface tab while assembling the camera module. We had to replace the Raspberry Pi Zero.</li>
<li>We encountered some ghost issues with our motor drive circuitry. We were not able to detect the motor driver on certain occasions. We had to replace the power supply for the motor driver. We will keep this book's website updated when we find the root cause of this issue.</li>
<li>We encountered a lot of issues getting the web stream setup for the browser. We had to tweak a lot of settings to get it working. We found some articles to fix the issue. We have shared them in the references section of this book.</li>
</ul>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Project enhancements</h1>
            

            
                
<ul>
<li>Consider making enhancements to the web interface such that you could alter the speed of your robot.</li>
<li>If you are planning to build a robot that operates in outdoor conditions, you potentially add a GPS sensor. Most GPS sensors stream data via the UART interface. We recommend reading <a href="56d43053-0d4d-47a4-bf28-c36fc00a7da2.xhtml">Chapter 4</a><em>, Communication Interfaces</em> for examples.</li>
<li>The distance of obstacles can be measured using this sensor: <a href="https://www.adafruit.com/products/3317">https://www.adafruit.com/products/3317</a>. This can be helpful in telemetry applications.</li>
<li>* In this book, we used a camera to drive the robot. It is possible to take pictures and understand the objects in a scene using this image understanding tool: <a href="https://cloud.google.com/vision/">https://cloud.google.com/vision/</a>.</li>
</ul>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    

        

            
                <h1 class="header-title">Summary</h1>
            

            
                
<p>In this chapter, we built a robot that consists of a pair of motors driven by a Raspberry Pi using a motor driver. The robot is also equipped with a camera module to aid steering the robot. It consists of two battery packs to power the Raspberry Pi Zero and motors, respectively. We will also upload a video of the robot's operation to this book's website.</p>
<div><p><strong>Learning resources</strong></p>
<ul>
<li><em>Differential steering mechanism</em>: https://www.robotix.in/tutorial/mechanical/drivemechtut/<br/></li>
<li><em>Video lecture on differential steering mechanism</em>: https://www.coursera.org/learn/mobile-robot/lecture/GnbnD/differential-drive-robots<br/></li>
<li><em>Make Magazine: Building your own chassis</em>: https://makezine.com/projects/designing-a-robot-chassis/<br/></li>
<li><em>Society of robots: Guide to building your own chassis</em>: http://www.societyofrobots.com/mechanics_chassisconstruction.shtml<br/></li>
<li><em>Adafruit's motor driver documentation</em>: https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi</li>
<li><em>Adafruit motor selection guide</em>: https://learn.adafruit.com/adafruit-motor-selection-guide<br/></li>
<li><em>Adafruit's guide on building a simple Raspberry Pi based robot</em>:https://learn.adafruit.com/simple-raspberry-pi-robot/overview<br/></li>
<li><em>Flask framework and form submission</em>:http://opentechschool.github.io/python-flask/core/form-submission.html<br/></li>
<li><em>Raspberry Pi Camera Setup for web streaming</em>: http://jamespoole.me/2016/04/29/web-controlled-robot-with-video-stream/</li>
</ul>
</div>


            

            <footer style="margin-top: 5em;">
                
            </footer>

        
    </body></html>