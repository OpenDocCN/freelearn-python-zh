<html><head></head><body>
<div id="_idContainer016">
<h1 class="chapter-number" id="_idParaDest-51"><a id="_idTextAnchor083"/><a id="_idTextAnchor084"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-52"><a id="_idTextAnchor085"/><span class="koboSpan" id="kobo.2.1">Templating with Jinja</span></h1>
<p><span class="koboSpan" id="kobo.3.1">This chapter will cover the basics of </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Jinja</span></strong><span class="koboSpan" id="kobo.5.1"> templating from the perspective of Flask. </span><span class="koboSpan" id="kobo.5.2">We will also learn how to design and develop applications with modular and </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">extensible templates.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.7.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.8.1">If you have followed Flask or Jinja or this book’s previous editions, you might have noticed that, previously, this templating library was called </span><em class="italic"><span class="koboSpan" id="kobo.9.1">Jinja2</span></em><span class="koboSpan" id="kobo.10.1">. </span><span class="koboSpan" id="kobo.10.2">The latest version of Jinja at the time of writing is version 3, and the authors/community have decided to call it just </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Jinja</span></em><span class="koboSpan" id="kobo.12.1"> instead of confusingly continuing with Jinja2, Jinja3, and </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">In Flask, we can write a complete web application without the need for a third-party templating engine. </span><span class="koboSpan" id="kobo.14.2">For example, have a look at the following code; this is a standalone, simple Hello World application with a bit of HTML </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">styling included:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.16.1">
from flask import Flask
app = Flask(__name__)
@app.route('/')
@app.route('/hello')
@app.route('/hello/&lt;user&gt;')
def hello_world(user=None):
    user = user or 'Shalabh'
    return '''
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Flask Framework Cookbook&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello %s!&lt;/h1&gt;
        &lt;p&gt;Welcome to the world of Flask!&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;''' % user
if __name__ == '__main__':
    app.run()</span></pre>
<p><span class="koboSpan" id="kobo.17.1">Is the preceding pattern of application writing feasible in the case of large applications that involve thousands of lines of HTML, JS, and CSS code? </span><span class="koboSpan" id="kobo.17.2">In my </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">opinion, no!</span></span></p>
<p><span class="koboSpan" id="kobo.19.1">Fortunately, templating offers a solution because it allows us to structure our views code by keeping our templates extensible and separate. </span><span class="koboSpan" id="kobo.19.2">Flask provides default support for Jinja, although we can use any templating engine that suits us. </span><span class="koboSpan" id="kobo.19.3">Furthermore, Jinja provides many additional features that make templates very powerful </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">and modular.</span></span></p>
<p><span class="koboSpan" id="kobo.21.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.23.1">Bootstrapping the </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">standard layout</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">Implementing block composition and </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">layout inheritance</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Creating a custom </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">context processor</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Creating a custom </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">Jinja filter</span></span></li>
<li><span class="koboSpan" id="kobo.31.1">Creating a custom macro </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">for forms</span></span></li>
<li><span class="koboSpan" id="kobo.33.1">Advanced date and </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">time formatting</span></span></li>
</ul>
<h1 id="_idParaDest-53"><a id="_idTextAnchor086"/><span class="koboSpan" id="kobo.35.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.36.1">Jinja is installed as a part of the standard Flask installation. </span><span class="koboSpan" id="kobo.36.2">There is no need to install it separately. </span><span class="koboSpan" id="kobo.36.3">For more details, refer to the </span><em class="italic"><span class="koboSpan" id="kobo.37.1">Setting up a virtual environment</span></em><span class="koboSpan" id="kobo.38.1"> section in </span><a href="B19111_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.39.1">Chapter 1</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.40.1">.</span></span></p>
<h1 id="_idParaDest-54"><a id="_idTextAnchor087"/><span class="koboSpan" id="kobo.41.1">Bootstrapping the standard layout</span></h1>
<p><span class="koboSpan" id="kobo.42.1">Most of the</span><a id="_idIndexMarker036"/><span class="koboSpan" id="kobo.43.1"> applications in Flask follow a specific pattern of laying out templates. </span><span class="koboSpan" id="kobo.43.2">In this recipe, we will implement the recommended way of structuring the layout of templates in a </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">Flask application.</span></span><a id="_idTextAnchor088"/></p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.45.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.46.1">By default, Flask expects templates to be placed inside a folder named </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">templates</span></strong><span class="koboSpan" id="kobo.48.1"> at the application root level. </span><span class="koboSpan" id="kobo.48.2">If this folder is present, then Flask will automatically read the contents by making the contents of this folder available for use with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">render_template()</span></strong><span class="koboSpan" id="kobo.50.1"> method, which we will use extensively throughout </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">this book.</span></span><a id="_idTextAnchor090"/></p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.52.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.53.1">Let’s demonstrate this with a small application. </span><span class="koboSpan" id="kobo.53.2">This application is very similar to the one we developed in </span><a href="B19111_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.54.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.55.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.56.1">Flask Configurations</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.58.1">The first thing to do is to add a new folder named </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">templates</span></strong><span class="koboSpan" id="kobo.60.1"> under </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">my_app</span></strong><span class="koboSpan" id="kobo.62.1">. </span><span class="koboSpan" id="kobo.62.2">The application structure should look like the following </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">directory structure:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.64.1">
flask_app/
    run.py
    my_app/
        __init__.py
        hello/
            __init__.py
            views.py
        templates</span></pre>
<p><span class="koboSpan" id="kobo.65.1">We now need to make some changes to the application. </span><span class="koboSpan" id="kobo.65.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">hello_world()</span></strong><span class="koboSpan" id="kobo.67.1"> method in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">views</span></strong><span class="koboSpan" id="kobo.69.1"> file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">my_app/hello/views.py</span></strong><span class="koboSpan" id="kobo.71.1">, should look like the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">of code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.73.1">
from flask import render_template, request
@hello.route('/')
@hello.route('/hello')
def hello_world():
    user = request.args.get('user', 'Shalabh')
    return render_template('index.html', user=user)</span></pre>
<p><span class="koboSpan" id="kobo.74.1">In the preceding method, we look for a URL query argument, </span><strong class="source-inline"><span class="koboSpan" id="kobo.75.1">user</span></strong><span class="koboSpan" id="kobo.76.1">. </span><span class="koboSpan" id="kobo.76.2">If it is found, we use it, and if not, we use the default argument, </span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">Shalabh</span></strong><span class="koboSpan" id="kobo.78.1">. </span><span class="koboSpan" id="kobo.78.2">Then, this value is passed to the context of the template to be rendered – that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">index.html</span></strong><span class="koboSpan" id="kobo.80.1"> – and the resulting template </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">is rendered.</span></span></p>
<p><span class="koboSpan" id="kobo.82.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">my_app/templates/index.html</span></strong><span class="koboSpan" id="kobo.84.1"> template </span><a id="_idIndexMarker037"/><span class="koboSpan" id="kobo.85.1">can simply be </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.87.1">
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Flask Framework Cookbook&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello {{ user }}!&lt;/h1&gt;
    &lt;p&gt;Welcome to the world of Flask!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html</span><a id="_idTextAnchor092"/><span class="koboSpan" id="kobo.88.1">&gt;</span></pre>
<h2 id="_idParaDest-57"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.89.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.90.1">Now, if we open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">http://127.0.0.1:5000/hello</span></strong><span class="koboSpan" id="kobo.92.1"> URL in a browser, we should see a response similar to the one shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer009">
<span class="koboSpan" id="kobo.94.1"><img alt="Figure 2.1 – The first rendered template" src="image/B19111_02_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.95.1">Figure 2.1 – The first rendered template</span></p>
<p><span class="koboSpan" id="kobo.96.1">If we pass a URL argument with a value for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">user</span></strong><span class="koboSpan" id="kobo.98.1"> key as </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">http://127.0.0.1:5000/hello?user=John</span></strong><span class="koboSpan" id="kobo.100.1">, we should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">following response:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<span class="koboSpan" id="kobo.102.1"><img alt="Figure 2.2 – Serving custom content in the template" src="image/B19111_02_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.103.1">Figure 2.2 – Serving custom content in the template</span></p>
<p><span class="koboSpan" id="kobo.104.1">As we can see in </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">views.py</span></strong><span class="koboSpan" id="kobo.106.1">, the argument passed in the URL is fetched from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">request</span></strong><span class="koboSpan" id="kobo.108.1"> object using </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">request.args.get('user')</span></strong><span class="koboSpan" id="kobo.110.1"> and then passed to the context of the template being rendered, using </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">render_template</span></strong><span class="koboSpan" id="kobo.112.1">. </span><span class="koboSpan" id="kobo.112.2">The argument is then parsed </span><a id="_idIndexMarker038"/><span class="koboSpan" id="kobo.113.1">using the Jinja placeholder, </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">{{ user }}</span></strong><span class="koboSpan" id="kobo.115.1">, to fetch the contents from the current value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.116.1">user</span></strong><span class="koboSpan" id="kobo.117.1"> variable from the template context. </span><span class="koboSpan" id="kobo.117.2">This placeholder evaluates all of the expressions placed inside it, depending on the </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">template context.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.119.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.120.1">The Jinja documentation can be found at </span><a href="http://jinja.pocoo.org/"><span class="koboSpan" id="kobo.121.1">http://jinja.pocoo.org/</span></a><span class="koboSpan" id="kobo.122.1">. </span><span class="koboSpan" id="kobo.122.2">This will come in handy when </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">writing templates.</span></span></p>
<p><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.124.1">Implementing block composition and </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">layout inheritance</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">Usually, any</span><a id="_idIndexMarker039"/><span class="koboSpan" id="kobo.127.1"> web </span><a id="_idIndexMarker040"/><span class="koboSpan" id="kobo.128.1">application will have a number of web pages that are different from each other. </span><span class="koboSpan" id="kobo.128.2">However, code blocks such as headers and footers will appear the same on almost all pages throughout the site; likewise, the menu will remain the same. </span><span class="koboSpan" id="kobo.128.3">In fact, it is usually just the center container block that changes. </span><span class="koboSpan" id="kobo.128.4">For this, Jinja provides a great way of ensuring inheritance </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">among templates.</span></span></p>
<p><span class="koboSpan" id="kobo.130.1">With this in mind, it’s a good practice to have a base template where the basic layout of the site, along with the header and footer, can </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">be structure</span><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.132.1">d.</span></span></p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.133.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.134.1">In this recipe, we will create a small application that will have a home page and a product page (such as the ones we see on e-commerce stores). </span><span class="koboSpan" id="kobo.134.2">We will use the Bootstrap framework to give a minimalistic design and theme to our template. </span><span class="koboSpan" id="kobo.134.3">Bootstrap v5 can be downloaded </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">from </span></span><a href="http://getbootstrap.com/"><span class="No-Break"><span class="koboSpan" id="kobo.136.1">http://getbootstrap.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.137.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.138.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.139.1">The latest version of Bootstrap at the time of writing is v5. </span><span class="koboSpan" id="kobo.139.2">Different versions of Bootstrap might cause the UI of an application to behave in different ways, but the core essence of Bootstrap remains </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">the same.</span></span></p>
<p><span class="koboSpan" id="kobo.141.1">For the sake of simplicity and focus on the topic at hand, we have created a hardcoded data store of a few products, which can be found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">models.py</span></strong><span class="koboSpan" id="kobo.143.1"> file. </span><span class="koboSpan" id="kobo.143.2">These are imported and read in </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">views.py</span></strong><span class="koboSpan" id="kobo.145.1"> and are sent over to the template as template context variables, via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">render_template()</span></strong><span class="koboSpan" id="kobo.147.1"> method. </span><span class="koboSpan" id="kobo.147.2">The rest of the parsing and display is handled by the templating language, which in our case </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">is Jinj</span><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.149.1">a.</span></span></p>
<h2 id="_idParaDest-59"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.150.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.151.1">Have a look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">following layout:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.153.1">
flask_app/
    - run.py
    - my_app/
        - __init__.py
        - product/
            - __init__.py
            - views.py
            - models.py
        - templates/
            - base.html
            - home.html
            - product.html
        - static/
            - js/
                - bootstrap.bundle.min.js
                - jquery.min.js
            - css/
                - bootstrap.min.css
                - main.css</span></pre>
<p><span class="koboSpan" id="kobo.154.1">In the preceding layout, </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">static/css/bootstrap.min.css</span></strong><span class="koboSpan" id="kobo.156.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">static/js/bootstrap.bundle.min.js</span></strong><span class="koboSpan" id="kobo.158.1"> are standard files that can be downloaded from </span><a id="_idIndexMarker041"/><span class="koboSpan" id="kobo.159.1">the</span><a id="_idIndexMarker042"/><span class="koboSpan" id="kobo.160.1"> Bootstrap website mentioned in the </span><em class="italic"><span class="koboSpan" id="kobo.161.1">Getting ready</span></em><span class="koboSpan" id="kobo.162.1"> section. </span><span class="koboSpan" id="kobo.162.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">run.py</span></strong><span class="koboSpan" id="kobo.164.1"> file remains the same, as always. </span><span class="koboSpan" id="kobo.164.2">The rest of the application-building process is </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">as follows.</span></span></p>
<p><span class="koboSpan" id="kobo.166.1">First, define the models in </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">my_app/product/models.py</span></strong><span class="koboSpan" id="kobo.168.1">. </span><span class="koboSpan" id="kobo.168.2">In this chapter, we will work on a simple, non-persistent key-value store. </span><span class="koboSpan" id="kobo.168.3">We will start with a few hardcoded product records made well in advance, </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.170.1">
PRODUCTS = {
    'iphone': {
        'name': 'iPhone 5S',
        'category': 'Phones',
        'price': 699,
    },
    'galaxy': {
        'name': 'Samsung Galaxy 5',
        'category': 'Phones',
        'price': 649,
    },
    'ipad-air': {
        'name': 'iPad Air',
        'category': 'Tablets',
        'price': 649,
    },
    'ipad-mini': {
        'name': 'iPad Mini',
        'category': 'Tablets',
        'price': 549
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.171.1">Next comes</span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.172.1"> the</span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.173.1"> views – that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">my_app/product/views.py</span></strong><span class="koboSpan" id="kobo.175.1">. </span><span class="koboSpan" id="kobo.175.2">Here, we will follow the blueprint style to write the application, </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.177.1">
from werkzeug.exceptions import abort
from flask import render_template
from flask import Blueprint
from my_app.product.models import PRODUCTS
product_blueprint = Blueprint('product', __name__)
@product_blueprint.route('/')
@product_blueprint.route('/home')
def home():
    return render_template('home.html', products=PRODUCTS)
@product_blueprint.route('/product/&lt;key&gt;')
def product(key):
    product = PRODUCTS.get(key)
    if not product:
        abort(404)
    return render_template('product.html', product=product)</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.178.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.179.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">abort()</span></strong><span class="koboSpan" id="kobo.181.1"> method comes in handy when you want to abort a request with a specific error message. </span><span class="koboSpan" id="kobo.181.2">Flask provides basic error message pages, which can be customized as needed. </span><span class="koboSpan" id="kobo.181.3">We will look at them in the </span><em class="italic"><span class="koboSpan" id="kobo.182.1">Creating custom 404 and 500 handlers</span></em><span class="koboSpan" id="kobo.183.1"> recipe in </span><a href="B19111_04.xhtml#_idTextAnchor184"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.184.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.185.1">, </span><em class="italic"><span class="koboSpan" id="kobo.186.1">Working </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.187.1">with Views</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.189.1">The name of </span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.190.1">the </span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.191.1">blueprint (</span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">product</span></strong><span class="koboSpan" id="kobo.193.1">) that is passed in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">Blueprint</span></strong><span class="koboSpan" id="kobo.195.1"> constructor will be appended to the endpoints defined in this blueprint. </span><span class="koboSpan" id="kobo.195.2">Do have a look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">base.html</span></strong><span class="koboSpan" id="kobo.197.1"> code </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">for clarity.</span></span></p>
<p><span class="koboSpan" id="kobo.199.1">Now, create the application’s configuration file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">my_app/__init__.py</span></strong><span class="koboSpan" id="kobo.201.1">, which should look like the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">of code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.203.1">
from flask import Flask
from my_app.product.views import product_blueprint
app = Flask(__name__)
app.register_blueprint(product_blueprint)</span></pre>
<p><span class="koboSpan" id="kobo.204.1">It is always possible to create your own custom CSS, which can add more flavor to the standard CSS provided by Bootstrap. </span><span class="koboSpan" id="kobo.204.2">To do this, add a bit of custom CSS code in </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">my_app/static/css/main.css</span></strong><span class="koboSpan" id="kobo.206.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.208.1">
body {
  padding-top: 50px;
}
.top-pad {
  padding: 10px 15px;
  text-align: center;
}</span></pre>
<p><span class="koboSpan" id="kobo.209.1">When</span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.210.1"> considering </span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.211.1">templates, it is always a good practice to create a base template to house the common code that can be inherited by all the other templates. </span><span class="koboSpan" id="kobo.211.2">Name this template </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">base.html</span></strong><span class="koboSpan" id="kobo.213.1"> and place it in </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">my_app/templates/base.html</span></strong><span class="koboSpan" id="kobo.215.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.217.1">
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
    &lt;meta name="viewport" content="width=device-width,
      initial-scale=1"&gt;
    &lt;title&gt;Flask Framework Cookbook&lt;/title&gt;
    &lt;link href="{{ url_for('static',
      filename='css/bootstrap.min.css') }}"
      rel="stylesheet"&gt;
    &lt;link href="{{ url_for('static',
      filename='css/main.css') }}" rel="stylesheet"&gt;
    &lt;script src="{{ url_for('static',
      filename='js/moment.min.js') }}"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;nav class="navbar navbar-dark bg-dark fixed-top"
      role="navigation"&gt;
      &lt;div class="container"&gt;
        &lt;div class="navbar-header"&gt;
          &lt;a class="navbar-brand" href="{{
            url_for('product.home') }}"&gt;Flask Cookbook&lt;/a&gt;
        &lt;/div&gt;
      &lt;/nav&gt;
    &lt;/div&gt;
    &lt;div class="container"&gt;
    {% block container %}{% endblock %}
    &lt;/div&gt;
    &lt;script src="{{ url_for('static',
      filename='js/jquery.min.js') }}"&gt;&lt;/script&gt;
    &lt;script src="{{ url_for('static',
      filename='js/bootstrap.bundle.min.js') }}"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</span></pre>
<p><span class="koboSpan" id="kobo.218.1">Most of the preceding code contains normal HTML and Jinja evaluation placeholders, which we introduced in the previous recipe, </span><em class="italic"><span class="koboSpan" id="kobo.219.1">Bootstrapping the recommended layout</span></em><span class="koboSpan" id="kobo.220.1">. </span><span class="koboSpan" id="kobo.220.2">An important point to note, however, is how the </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">url_for()</span></strong><span class="koboSpan" id="kobo.222.1"> method is used for blueprint URLs. </span><span class="koboSpan" id="kobo.222.2">The blueprint name is appended to all endpoints. </span><span class="koboSpan" id="kobo.222.3">This becomes very useful when there are multiple blueprints inside one application, as some of them may have </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">similar-looking URLs.</span></span></p>
<p><span class="koboSpan" id="kobo.224.1">On the </span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.225.1">home </span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.226.1">page, </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">my_app/templates/home.html</span></strong><span class="koboSpan" id="kobo.228.1">, iterate over all the products and display them, </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.230.1">
{% extends 'base.html' %}
{% block container %}
  &lt;div class="top-pad"&gt;
    {% for id, product in products.items() %}
    &lt;div class="top-pad offset-1 col-sm-10"&gt;
      &lt;div class="card text-center"&gt;
        &lt;div class="card-body"&gt;
          &lt;h2&gt;
            &lt;a href="{{ url_for('product.product', key=id)
              }}"&gt;{{ product['name'] }}&lt;/a&gt;
            &lt;small&gt;$ {{ product['price'] }}&lt;/small&gt;
          &lt;/h2&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    {% endfor %}
  &lt;/div&gt;
{% endblock %}</span></pre>
<p><span class="koboSpan" id="kobo.231.1">Then, create the individual product page, </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">my_app/templates/product.html</span></strong><span class="koboSpan" id="kobo.233.1">, which should look like the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">of code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.235.1">
{% extends 'home.html' %}
{% block container %}
  &lt;div class="top-pad"&gt;
    &lt;h1&gt;{{ product['name'] }}&lt;/h1&gt;
    &lt;h3&gt;&lt;small&gt;{{ product['category'] }}&lt;/small&gt;&lt;/h3&gt;
    &lt;h5&gt;$ {{ product['price'] }}&lt;/h5&gt;
  &lt;/div&gt;
{% </span><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.236.1">endblock %}</span></pre>
<h2 id="_idParaDest-60"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.237.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.238.1">In the </span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.239.1">preceding </span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.240.1">template structure, there is an inheritance pattern being followed. </span><span class="koboSpan" id="kobo.240.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">base.html</span></strong><span class="koboSpan" id="kobo.242.1"> file acts as the base template for all other templates. </span><span class="koboSpan" id="kobo.242.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">home.html</span></strong><span class="koboSpan" id="kobo.244.1"> file inherits from </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">base.html</span></strong><span class="koboSpan" id="kobo.246.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">product.html</span></strong><span class="koboSpan" id="kobo.248.1"> inherits from </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">home.html</span></strong><span class="koboSpan" id="kobo.250.1">. </span><span class="koboSpan" id="kobo.250.2">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">product.html</span></strong><span class="koboSpan" id="kobo.252.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">container</span></strong><span class="koboSpan" id="kobo.254.1"> block is overwritten, which was first populated in </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">home.html</span></strong><span class="koboSpan" id="kobo.256.1">. </span><span class="koboSpan" id="kobo.256.2">When this app is run, we should see output similar to that shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<span class="koboSpan" id="kobo.258.1"><img alt="Figure 2.3 – Iterating over blocks to create reusable content" src="image/B19111_02_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.259.1">Figure 2.3 – Iterating over blocks to create reusable content</span></p>
<p><span class="koboSpan" id="kobo.260.1">The preceding screenshot shows how the home page will look. </span><span class="koboSpan" id="kobo.260.2">Note the URL in the browser. </span><span class="koboSpan" id="kobo.260.3">The</span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.261.1"> product </span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.262.1">page should appear </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.264.1"><img alt="Figure 2.4 – Inheriting template blocks to cre﻿ate clean code" src="image/B19111_02_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.265.1">Figure 2.4 – Inheriting template blocks to cre</span><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.266.1">ate clean code</span></p>
<h1 id="_idParaDest-61"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.267.1">Creating a custom context processor</span></h1>
<p><span class="koboSpan" id="kobo.268.1">Sometimes, we </span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.269.1">might want to calculate or process a value directly in templates. </span><span class="koboSpan" id="kobo.269.2">Jinja maintains the notion that the processing of logic should be handled in views and not in templates, thereby keeping templates clean. </span><span class="koboSpan" id="kobo.269.3">A context processor becomes a handy tool in this case. </span><span class="koboSpan" id="kobo.269.4">With a context processor, we can pass our values to a method, which will then be processed in a Python method, and our resultant value will be returned. </span><span class="koboSpan" id="kobo.269.5">This is done by simply adding a function to the template context, thanks to Python allowing its users to pass functions like any other object. </span><span class="koboSpan" id="kobo.269.6">In this recipe, we’ll see how to write a custom </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">con</span><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.271.1">text processor.</span></span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.272.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.273.1">To write a custom context processor, follow the steps described </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">as follows.</span></span></p>
<p><span class="koboSpan" id="kobo.275.1">Let’s first display the descriptive name of the product in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">Category / Product-name</span></strong><span class="koboSpan" id="kobo.277.1"> format. </span><span class="koboSpan" id="kobo.277.2">Afterward, add the method to </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">my_app/product/views.py</span></strong><span class="koboSpan" id="kobo.279.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.281.1">
@product_blueprint.context_processor
def some_processor():
    def full_name(product):
        return '{0} / {1}'.format(product['category'],
          product['name'])
    return {'full_name': full_name}</span></pre>
<p><span class="koboSpan" id="kobo.282.1">A context is </span><a id="_idIndexMarker056"/><span class="koboSpan" id="kobo.283.1">simply a dictionary that can be modified to add or remove values. </span><span class="koboSpan" id="kobo.283.2">Any method decorated with </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">@product_blueprint.context_processor</span></strong><span class="koboSpan" id="kobo.285.1"> should return a dictionary that updates the actual context. </span><span class="koboSpan" id="kobo.285.2">We can use the preceding context processor </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.287.1">
{{ full_name(product) }}</span></pre>
<p><span class="koboSpan" id="kobo.288.1">We can add the preceding code to our app for the product listing (in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">flask_app/my_app/templates/product.html</span></strong><span class="koboSpan" id="kobo.290.1"> file) in the </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">following manner:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.292.1">
{% extends 'home.html' %}
{% block container %}
  &lt;div class="top-pad"&gt;
    &lt;h4&gt;{{ full_name(product) }}&lt;/h4&gt;
    &lt;h1&gt;{{ product['name'] }}&lt;/h1&gt;
    &lt;h3&gt;&lt;small&gt;{{ product['category'] }}&lt;/small&gt;&lt;/h3&gt;
    &lt;h5&gt;$ {{ product['price'] }}&lt;/h5&gt;
  &lt;/div&gt;
{% endblock %}</span></pre>
<p><span class="koboSpan" id="kobo.293.1">The resulting parsed HTML page should look like the </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.295.1"><img alt="Figure 2.5 – A custom context processor for the product name" src="image/B19111_02_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.296.1">Figure 2.5 – A custom context processor for the product name</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.297.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.298.1">Have a look at</span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.299.1"> the </span><em class="italic"><span class="koboSpan" id="kobo.300.1">Implementing block composition and layout inheritance</span></em><span class="koboSpan" id="kobo.301.1"> recipe earlier in this chapter to understand the context of this recipe better regarding the product and</span><a id="_idTextAnchor105"/> <span class="No-Break"><span class="koboSpan" id="kobo.302.1">category logic.</span></span></p>
<h1 id="_idParaDest-63"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.303.1">Creating a custom Jinja filter</span></h1>
<p><span class="koboSpan" id="kobo.304.1">After looking</span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.305.1"> at the previous recipe, experienced developers might wonder why we used a context processor for the purpose of creating a well-formatted product name. </span><span class="koboSpan" id="kobo.305.2">Well, we can also write a filter for the same purpose, which will make things much cleaner. </span><span class="koboSpan" id="kobo.305.3">A filter can be written to display the descriptive name of a product, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.307.1">
@product_blueprint.app_template_filter('full_name')
def full_name_filter(product):
    return '{0} / {1}'.format(product['category'],
      product['name'])</span></pre>
<p><span class="koboSpan" id="kobo.308.1">This can also be used </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.310.1">
{{ product|full_name }}</span></pre>
<p><span class="koboSpan" id="kobo.311.1">The preceding code will yield a similar result as in the previous recipe. </span><span class="koboSpan" id="kobo.311.2">Moving on, let’s now take things to a higher level by using external libraries to</span><a id="_idTextAnchor107"/> <span class="No-Break"><span class="koboSpan" id="kobo.312.1">format currency.</span></span></p>
<h2 id="_idParaDest-64"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.313.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.314.1">First, let’s create a filter to format a currency based on the current local language. </span><span class="koboSpan" id="kobo.314.2">Add the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">my_app/__init__.py</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.318.1">
import ccy
from flask import request
@app.template_filter('format_currency')
def format_currency_filter(amount):
    currency_code =
     ccy.countryccy(request.accept_languages.best[-2:])
    return '{0} {1}'.format(currency_code, amount)</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.319.1">Information</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.320.1">request.accept_languages</span></strong><span class="koboSpan" id="kobo.321.1"> might not work in cases where a request does not have the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">ACCEPT-LANGUAGES</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.323.1"> header.</span></span></p>
<p><span class="koboSpan" id="kobo.324.1">The preceding </span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.325.1">snippet will require the installation of a new package, </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">ccy</span></strong><span class="koboSpan" id="kobo.327.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.329.1">
$ pip install ccy</span></pre>
<p><span class="koboSpan" id="kobo.330.1">The filter created in this example takes the language that best matches the current browser locale (which, in my case, is </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">en-US</span></strong><span class="koboSpan" id="kobo.332.1">), takes the last two characters from the locale string, and then generates the currency as per the ISO country code, which is represented by </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">two characters.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.334.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.335.1">An interesting point to note in this recipe is that the Jinja filter can be created at the blueprint level as well as at the application level. </span><span class="koboSpan" id="kobo.335.2">If the filter is at the blueprint level, the decorator would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">app_template_filter</span></strong><span class="koboSpan" id="kobo.337.1">; otherwise, at the application level, the decorator would </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">b</span><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.339.1">e </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">template_filter</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">.</span></span></p>
<h2 id="_idParaDest-65"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.342.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.343.1">The filter can be used in our template for the product </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.345.1">
&lt;h3&gt;{{ product['price']|format_currency }}&lt;/h3&gt;</span></pre>
<p><span class="koboSpan" id="kobo.346.1">The preceding </span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.347.1">code will yield the result shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.349.1"><img alt="Figure 2.6 – A custom Jinja filter for the d﻿isplay of currency" src="image/B19111_02_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.350.1">Figure 2.6 – A custom Jinja filter for the d</span><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.351.1">isplay of currency</span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.352.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.353.1">The </span><em class="italic"><span class="koboSpan" id="kobo.354.1">Implementing block composition and layout inheritance</span></em><span class="koboSpan" id="kobo.355.1"> recipe earlier in this chapter will aid your understanding of the context of this recipe regarding product a</span><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.356.1">nd </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">category logic.</span></span></p>
<h1 id="_idParaDest-67"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.358.1">Creating a custom macro for forms</span></h1>
<p><span class="koboSpan" id="kobo.359.1">Macros allow</span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.360.1"> us to </span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.361.1">write reusable pieces of HTML blocks. </span><span class="koboSpan" id="kobo.361.2">They are analogous to functions in regular programming languages. </span><span class="koboSpan" id="kobo.361.3">We can pass arguments to macros as we do with functions in Python, and we can then use them to process an HTML block. </span><span class="koboSpan" id="kobo.361.4">Macros can be called any number of times, and the output will vary as per the logic inside them. </span><span class="koboSpan" id="kobo.361.5">In this recipe, let’s understand how to wri</span><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.362.1">te a macro </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">in Jinja.</span></span></p>
<h2 id="_idParaDest-68"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.364.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.365.1">Macros in Jinja are a very common topic and have a lot of use cases. </span><span class="koboSpan" id="kobo.365.2">Here, we will just take a look at how a macro can be created and then used</span><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.366.1"> after </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">importing it.</span></span></p>
<h2 id="_idParaDest-69"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.368.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.369.1">One of the most redundant pieces of code in HTML is that which defines input fields in forms. </span><span class="koboSpan" id="kobo.369.2">This is because most fields have similar code with maybe some </span><span class="No-Break"><span class="koboSpan" id="kobo.370.1">style modifications.</span></span></p>
<p><span class="koboSpan" id="kobo.371.1">The following snippet is a macro that creates input fields when invoked. </span><span class="koboSpan" id="kobo.371.2">The best practice is to create</span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.372.1"> the </span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.373.1">macro in a separate file for better reusability – for </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">_helpers.html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.377.1">
{% macro render_field(name, class='', value='',
  type='text') -%}
&lt;input type="{{ type }}" name="{{ name }}" class="{{ class
  }}" value="{{ value }}"/&gt;
{%- endmacro %}</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.378.1">Information</span></p>
<p class="callout"><span class="koboSpan" id="kobo.379.1">The minus sign (</span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">-</span></strong><span class="koboSpan" id="kobo.381.1">) before and after </span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">%</span></strong><span class="koboSpan" id="kobo.383.1"> will strip the whitespace before and after these blocks, making the HTML code cleaner </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">to read.</span></span></p>
<p><span class="koboSpan" id="kobo.385.1">Now, the macro should be imported into the file to be used, </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.387.1">
{% from '_helpers.html' import render_field %}</span></pre>
<p><span class="koboSpan" id="kobo.388.1">It can now be called using the </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.390.1">
&lt;fieldset&gt;
{{ render_field('username', 'icon-user') }}
{{ render_field('password', 'icon-key', type='password') }}
&lt;/fieldset&gt;</span></pre>
<p><span class="koboSpan" id="kobo.391.1">It is always good practice to define macros in a different file to keep the code clean and increase </span><a id="_idIndexMarker065"/><span class="No-Break"><span class="koboSpan" id="kobo.392.1">code</span></span><span class="No-Break"><a id="_idIndexMarker066"/></span><span class="No-Break"><span class="koboSpan" id="kobo.393.1"> readability.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.394.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.395.1">If you need to write a private macro that cannot be accessed from outside its current file, name the macro with an unders</span><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.396.1">core preceding </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">the name.</span></span></p>
<h1 id="_idParaDest-70"><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.398.1">Advanced date and time formatting</span></h1>
<p><span class="koboSpan" id="kobo.399.1">Date and time </span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.400.1">formatting is a painful thing to handle in web applications. </span><span class="koboSpan" id="kobo.400.2">Such formatting in Python, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">datetime</span></strong><span class="koboSpan" id="kobo.402.1"> library, often increases overhead and is pretty complex when it comes to the correct handling of time zones. </span><span class="koboSpan" id="kobo.402.2">It is a best practice to standardize timestamps to UTC when they are stored in a database, but this means that the timestamp needs to be processed every time it is presented to users around </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">the world.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">Instead, it is smarter to defer this processing to the client side – that is, the browser. </span><span class="koboSpan" id="kobo.404.2">The browser always knows the current time zone of its user and will, therefore, be able to manipulate the date and time information correctly. </span><span class="koboSpan" id="kobo.404.3">This approach also reduces any unnecessary overhead from the application servers. </span><span class="koboSpan" id="kobo.404.4">In this recipe, we will understand how to achieve this. </span><span class="koboSpan" id="kobo.404.5">We will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">Mo</span><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.406.1">ment.js</span></strong><span class="koboSpan" id="kobo.407.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">this purpose.</span></span></p>
<h2 id="_idParaDest-71"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.409.1">Getting ready</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">Moment.js</span></strong><span class="koboSpan" id="kobo.411.1"> can be included in our app just like any JS library. </span><span class="koboSpan" id="kobo.411.2">We just have to download and place the JS file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">moment.min.js</span></strong><span class="koboSpan" id="kobo.413.1">, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">static/js</span></strong><span class="koboSpan" id="kobo.415.1"> folder. </span><span class="koboSpan" id="kobo.415.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">Moment.js</span></strong><span class="koboSpan" id="kobo.417.1"> file can be downloaded from </span><a href="http://momentjs.com/"><span class="koboSpan" id="kobo.418.1">http://momentjs.com/</span></a><span class="koboSpan" id="kobo.419.1">. </span><span class="koboSpan" id="kobo.419.2">This file can then be used in an HTML file by adding the following statement along with other </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">JavaScript libraries:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.421.1">
&lt;script src="{{ url_for('static',
  filename='js/moment.min.js') }}"&gt;&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.422.1">The basic usage of </span><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">Moment.js</span></strong><span class="koboSpan" id="kobo.424.1"> is shown in the following code. </span><span class="koboSpan" id="kobo.424.2">This can be done in the browser console </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">for JavaScript:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.426.1">
&gt;&gt;&gt; moment().calendar(); "Today at 11:09 AM"
&gt;&gt;&gt; moment().endOf('day').fromNow(); "in 13 hours"
&gt;&gt;&gt; moment().format('LLLL'); "Sunday, J</span><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.427.1">uly 24, 2022 11:10
  AM"</span></pre>
<h2 id="_idParaDest-72"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.428.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.429.1">To use </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">Moment.js</span></strong><span class="koboSpan" id="kobo.431.1"> in an application, please follow the </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">required steps.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1">First, write a</span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.434.1"> wrapper in Python and use it via the Jinja environment variables, </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.436.1">
from markupsafe import Markup
class momentjs(object):
    def __init__(self, timestamp):
        self.timestamp = timestamp
    # Wrapper to call moment.js method
    def render(self, format):
        return Markup(
            "&lt;script&gt;\ndocument
              .write(moment(\"%s\").%s);\n&lt;/script&gt;" % (
              self.timestamp.strftime("%Y-%m-%dT%H:%M:%S"),
              format
            )
        )
    # Format time
    def format(self, fmt):
        return self.render("format(\"%s\")" % fmt)
    def calendar(self):
        return self.render("calendar()")
    def fromNow(self):
        return self.render("fromNow()")</span></pre>
<p><span class="koboSpan" id="kobo.437.1">You can add as</span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.438.1"> many </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">Moment.js</span></strong><span class="koboSpan" id="kobo.440.1"> methods as you want to parse to the preceding class, as and when they’re needed. </span><span class="koboSpan" id="kobo.440.2">Now, in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">app.py</span></strong><span class="koboSpan" id="kobo.442.1"> file, set the following created class to the Jinja </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">environment variables:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.444.1">
# Set jinja template global
app.jinja_env.globals['momentjs'] = momentjs</span></pre>
<p><span class="koboSpan" id="kobo.445.1">You can now use the class in templates, as shown in the following example. </span><span class="koboSpan" id="kobo.445.2">Make sure that </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">timestamp</span></strong><span class="koboSpan" id="kobo.447.1"> is an instance of a JavaScript </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">date</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.449.1"> object:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.450.1">
&lt;p&gt;Current time: {{ momentjs(timestamp).calendar() }}&lt;/p&gt;
&lt;br/&gt;
&lt;p&gt;Time: {{momentjs(timestamp).format('YYYY-MM-DD
  HH:mm:ss')}}&lt;/p&gt;
&lt;br/&gt;
&lt;p&gt;From now: {{momentjs</span><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.451.1">(timestamp).fromNow()}}&lt;/p&gt;</span></pre>
<h2 id="_idParaDest-73"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.452.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.453.1">The output of the preceding HTML is shown in the following screenshot. </span><span class="koboSpan" id="kobo.453.2">Note how the formatting </span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.454.1">varies for </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">each statement.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.456.1"><img alt="Figure 2.7 – Datetim﻿e formatting using momentjs" src="image/B19111_02_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.457.1">Figure 2.7 – Datetim</span><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.458.1">e formatting using momentjs</span></p>
<h2 id="_idParaDest-74"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.459.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.460.1">You can read more about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">Moment.js</span></strong><span class="koboSpan" id="kobo.462.1"> library </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">at </span></span><a href="http://momentjs.com/"><span class="No-Break"><span class="koboSpan" id="kobo.464.1">http://momentjs.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.465.1">.</span></span></p>
</div>
</body></html>