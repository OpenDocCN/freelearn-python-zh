<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<title>ch020.xhtml</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body epub:type="bodymatter">
<section class="level1" data-number="20" id="chapter-16-project-5.2-simple-multivariate-statistics">
<h1 data-number="20"><span class="titlemark"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 16</span></span><br/>
<span id="x1-34200016"/><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Project 5.2: Simple Multivariate Statistics</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">Are variables related? </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">If so what’s the relationship? </span><span class="koboSpan" id="kobo.3.3" xmlns="http://www.w3.org/1999/xhtml">An analyst tries to answer these two questions. </span><span class="koboSpan" id="kobo.3.4" xmlns="http://www.w3.org/1999/xhtml">A negative answer — the null hypothesis — doesn’t require too many supporting details. </span><span class="koboSpan" id="kobo.3.5" xmlns="http://www.w3.org/1999/xhtml">A positive answer, on the other hand, suggests that a model can be defined to describe the relationship. </span><span class="koboSpan" id="kobo.3.6" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we’ll look at simple correlation and linear regression as two elements of modeling a relationship between variables.</span></p>
<p><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we’ll expand on some skills of data analysis:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">Use of the built-in </span><code><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml"> library to compute correlation measures and linear regression coefficients.</span></p></li>
<li><p><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Use of the </span><strong><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">matplotlib </span></strong><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">library to </span><span id="dx1-342001"/><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">create images. </span><span class="koboSpan" id="kobo.11.2" xmlns="http://www.w3.org/1999/xhtml">This means creating plot images outside a Jupyter Lab environment.</span></p></li>
<li><p><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml">Expanding on the base modeling application to add features.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">This chapter’s project will expand on earlier projects. </span><span class="koboSpan" id="kobo.13.2" xmlns="http://www.w3.org/1999/xhtml">Look back at </span><a href="ch017.xhtml#x1-29700013"><em><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml"> 13</span></em></a><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch017.xhtml#x1-29700013"><em><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">Project 4.1: Visual Analysis Techniques</span></em></a><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml"> for some of the graphical techniques used in a Jupyter Lab context. </span><span class="koboSpan" id="kobo.18.2" xmlns="http://www.w3.org/1999/xhtml">These need to be more fully automated. </span><span class="koboSpan" id="kobo.18.3" xmlns="http://www.w3.org/1999/xhtml">The project will add multivariate statistics and graphs to illustrate relationships among variables. </span><span id="x1-342002r363"/></p>
<section class="level2" data-number="20.1" id="description-22">
<h2 data-number="20.1"><span class="titlemark"><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">16.1 </span></span> <span id="x1-3430001"/><span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></h2>
<p><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">In </span><a href="ch019.xhtml#x1-32500015"><em><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml"> 15</span></em></a><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch019.xhtml#x1-32500015"><em><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">Project 5.1: Modeling Base Application</span></em></a><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml"> we created an application to create a summary document with some core statistics. </span><span class="koboSpan" id="kobo.26.2" xmlns="http://www.w3.org/1999/xhtml">In that application, we looked at univariate statistics to characterize the data distributions. </span><span class="koboSpan" id="kobo.26.3" xmlns="http://www.w3.org/1999/xhtml">These statistics </span><span id="dx1-343001"/><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">included measurements of the location, spread, and shape of a distribution. </span><span class="koboSpan" id="kobo.27.2" xmlns="http://www.w3.org/1999/xhtml">Functions like mean, median, mode, variance, and standard deviation were emphasized as ways to understand location and spread. </span><span class="koboSpan" id="kobo.27.3" xmlns="http://www.w3.org/1999/xhtml">The characterization of shape via skewness and kurtosis was left as an extra exercise for you.</span></p>
<p><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">The base application from the previous chapter needs to be expanded to include the multivariate statistics and diagrams that are essential for clarifying the relationships among variables. </span><span class="koboSpan" id="kobo.28.2" xmlns="http://www.w3.org/1999/xhtml">There are a vast number of possible functions to describe the relationships among two variables. </span><span class="koboSpan" id="kobo.28.3" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://www.itl.nist.gov/div898/handbook/pmd/section8/pmd8.htm"><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">https://www.itl.nist.gov/div898/handbook/pmd/section8/pmd8.htm</span></a><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml"> for some insight into the number of choices available.</span></p>
<p><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">We’ll limit ourselves to linear functions. </span><span class="koboSpan" id="kobo.31.2" xmlns="http://www.w3.org/1999/xhtml">In the simplest cases, there are two steps to creating a linear model: identifying a correlation and creating the coefficients for a line that fits the data. </span><span class="koboSpan" id="kobo.31.3" xmlns="http://www.w3.org/1999/xhtml">We’ll look at each of these steps in the next two sections. </span><span id="x1-343002r366"/></p>
<section class="level3" data-number="20.1.1" id="correlation-coefficient">
<h3 data-number="20.1.1"><span class="titlemark"><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">16.1.1 </span></span> <span id="x1-3440001"/><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">Correlation coefficient</span></h3>
<p><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">The coefficient of correlation measures how well the </span><span id="dx1-344001"/><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">values of two variables correlate with each other. </span><span class="koboSpan" id="kobo.35.2" xmlns="http://www.w3.org/1999/xhtml">A value of 1 indicates </span><span id="dx1-344002"/><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">perfect correlation; a value of zero indicates no discernable correlation. </span><span class="koboSpan" id="kobo.36.2" xmlns="http://www.w3.org/1999/xhtml">A value of -1 indicates an “anti-correlation”: when one variable is at its maximum value, the other variable is at its minimum.</span></p>
<p><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a href="#16.1"><em><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">Figure 16.1</span></em></a><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml"> to see how the correlation coefficient describes the distribution of the two variables.</span></p>
<figure class="IMG---Figure">
<span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 16.1: Correlation Coefficients " src="../media/file64.jpg"/></span>
<figcaption class="IMG---Caption"><span class="id" id="16.1"><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">Figure 16.1: </span></span><span class="content"><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">Correlation Coefficients </span></span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">The computation of the </span><span id="dx1-344005"/><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">coefficient compares individual </span><span id="dx1-344006"/><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">values of variables, </span><em><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">X</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">Y</span></em> <sub><span class="cmmi-8"><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml">, to the mean values for those variables, </span><em><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">X</span></em><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">Ȳ</span></em><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.55.2" xmlns="http://www.w3.org/1999/xhtml">Here’s a formula:</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml"><img alt=" ∑ r = ∘-∑---(Xi-−-¯X∘)(Y∑i-−-¯Y)----- (Xi − ¯X )2 (Yi − ¯Y )2 " class="math-display" src="../media/file65.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">The computations of the mean values, </span><em><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">X</span></em><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">Ȳ</span></em><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml">, can be factored into this, creating a somewhat more complicated version that’s often used to create the coefficient in a single pass through the data.</span></p>
<p><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">This function is available as </span><code><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">statistics.correlation()</span></code><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml"> in the </span><code><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">standard</span></code><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml"> library.</span></p>
<p><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">If two variables correlate with each other, then a linear function will map one variable to a value near the other variable. </span><span class="koboSpan" id="kobo.67.2" xmlns="http://www.w3.org/1999/xhtml">If the correlation is 1.0 or -1.0, the mapping will be exact. </span><span class="koboSpan" id="kobo.67.3" xmlns="http://www.w3.org/1999/xhtml">For other correlation values, the mapping will be close, but not exact. </span><span class="koboSpan" id="kobo.67.4" xmlns="http://www.w3.org/1999/xhtml">In the next section, we’ll show how to transform the correlation coefficient into the parameters for a line. </span><span id="x1-344007r369"/></p>
</section>
<section class="level3" data-number="20.1.2" id="linear-regression">
<h3 data-number="20.1.2"><span class="titlemark"><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">16.1.2 </span></span> <span id="x1-3450002"/><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">Linear regression</span></h3>
<p><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">One equation for a line is </span><em><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">y </span></em><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">= </span><em><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">mx </span></em><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml">+ </span><em><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">b</span></em><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.76.2" xmlns="http://www.w3.org/1999/xhtml">The values of </span><em><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">m </span></em><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">and </span><em><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">b </span></em><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">are parameters that describe the specific </span><span id="dx1-345001"/><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">linear relationship between the </span><em><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">x </span></em><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">and </span><em><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">y </span></em><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">variables.</span></p>
<p><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">When fitting a line to data, we’re estimating </span><span id="dx1-345002"/><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml">the parameters for a line. </span><span class="koboSpan" id="kobo.87.2" xmlns="http://www.w3.org/1999/xhtml">The goal is to minimize the error between the line and the actual data. </span><span class="koboSpan" id="kobo.87.3" xmlns="http://www.w3.org/1999/xhtml">The “least squares” technique is often used.</span></p>
<p><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">The two coefficients, </span><em><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">b </span></em><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">and </span><em><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">, can be computed as follows:</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml"><img alt=" ∑ ∑ ∑ ∑ X2i Y 2i − Xi XiYi b = ----n-∑--X2-−-(∑-X--)2---- i i " class="math-display" src="../media/file66.jpg"/></span>
</div>
<div class="math-display">
<span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml"><img alt=" ∑ ∑ ∑ m = n---X∑iYi-−--∑-Xi---Yi n X2i − ( Xi)2 " class="math-display" src="../media/file67.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">This is available as </span><code><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">statistics.linear_regression()</span></code><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml"> in the standard library. </span><span class="koboSpan" id="kobo.97.2" xmlns="http://www.w3.org/1999/xhtml">This saves us from having to write these two functions.</span></p>
<p><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">The various sums and </span><span id="dx1-345003"/><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">sums of squares are not </span><span id="dx1-345004"/><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">terribly difficult values to compute. </span><span class="koboSpan" id="kobo.100.2" xmlns="http://www.w3.org/1999/xhtml">The built-in </span><code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">sum()</span></code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml"> function is the basis for most of this. </span><span class="koboSpan" id="kobo.102.2" xmlns="http://www.w3.org/1999/xhtml">We can use </span><code><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">sum(map(lambda</span></code><code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml"> x:</span></code><code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml"> x^2,</span></code><code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml"> x_values))</span></code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml"> to compute </span><span class="cmex-10x-x-109"><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">∑</span></span> <em><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">X</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><sup><span class="cmr-8"><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span></sup><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">To clarify these multivariate relationships, diagrams can be very helpful. </span><span class="koboSpan" id="kobo.113.2" xmlns="http://www.w3.org/1999/xhtml">In the next sections, we’ll look at the most important type of diagram that needs to be part of the overall application. </span><span id="x1-345005r371"/></p>
</section>
<section class="level3" data-number="20.1.3" id="diagrams">
<h3 data-number="20.1.3"><span class="titlemark"><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">16.1.3 </span></span> <span id="x1-3460003"/><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">Diagrams</span></h3>
<p><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">One essential diagram for showing multivariate data is the X-Y “scatter” plot. </span><span class="koboSpan" id="kobo.116.2" xmlns="http://www.w3.org/1999/xhtml">In </span><a href="ch017.xhtml#x1-29700013"><em><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml"> 13</span></em></a><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch017.xhtml#x1-29700013"><em><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">Project 4.1: Visual Analysis Techniques</span></em></a><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml"> we looked at ways to </span><span id="dx1-346001"/><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml">create these. </span><span class="koboSpan" id="kobo.122.2" xmlns="http://www.w3.org/1999/xhtml">In that chapter, we relied on Jupyter Lab to present the diagram as part of the overall web page. </span><span class="koboSpan" id="kobo.122.3" xmlns="http://www.w3.org/1999/xhtml">For this application, we’ll need to embed the diagram into a document.</span></p>
<p><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">This generally means </span><span id="dx1-346002"/><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml">there will be a markup document that includes a reference to a diagram file. </span><span class="koboSpan" id="kobo.124.2" xmlns="http://www.w3.org/1999/xhtml">The format of the diagram file can be SVG, PNG, or even JPEG. </span><span class="koboSpan" id="kobo.124.3" xmlns="http://www.w3.org/1999/xhtml">For technical graphics, the SVG files are often the smallest and scale extremely well.</span></p>
<p><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">Each markup language, including Markdown, RST, HTML, and LaTeX, have unique ways to identify the place where an image needs to be inserted. </span><span class="koboSpan" id="kobo.125.2" xmlns="http://www.w3.org/1999/xhtml">In the case of Markdown, it’s often necessary to use HTML syntax to properly include frames and captions.</span></p>
<p><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">Now that we’ve seen what the application needs to do, we can look at an approach to create the software. </span><span id="x1-346003r368"/></p>
</section>
</section>
<section class="level2" data-number="20.2" id="approach-17">
<h2 data-number="20.2"><span class="titlemark"><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">16.2 </span></span> <span id="x1-3470002"/><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">Approach</span></h2>
<p><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">As with the previous project, this application </span><span id="dx1-347001"/><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">works in these two distinct parts:</span></p>
<ol>
<li><div id="x1-347003x1">
<p><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml">Compute the statistics and create the diagram files.</span></p>
</div></li>
<li><div id="x1-347005x2">
<p><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">Create a report file in a simplified markup language from a template with the details interpolated. </span><span class="koboSpan" id="kobo.132.2" xmlns="http://www.w3.org/1999/xhtml">A tool like </span><strong><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">Jinja </span></strong><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">is very helpful for this.</span></p>
</div></li>
</ol>
<p><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">Once the report file in a markup language — like Markdown or RST — is available, then a tool like </span><strong><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">Pandoc </span></strong><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">can be used to create an HTML page or a PDF document from the markup file. </span><span class="koboSpan" id="kobo.137.2" xmlns="http://www.w3.org/1999/xhtml">Using a tool like </span><strong><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">Pandoc </span></strong><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">permits quite a bit of flexibility in choosing the final format. </span><span class="koboSpan" id="kobo.139.2" xmlns="http://www.w3.org/1999/xhtml">It also allows the insertion of style sheets and page templates in a tidy, uniform way.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-238">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml">The LaTeX language as markup provides the most comprehensive capabilities. </span><span class="koboSpan" id="kobo.140.2" xmlns="http://www.w3.org/1999/xhtml">It is challenging to work with, however. </span><span class="koboSpan" id="kobo.140.3" xmlns="http://www.w3.org/1999/xhtml">Languages like Markdown and RST are designed to offer fewer, easier-to-use capabilities.</span></p>
<p><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">This book is written with LaTeX.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at three aspects of this application: the statistical computations, creating the diagrams, and finally, creating the final markup file to include the diagrams. </span><span class="koboSpan" id="kobo.142.2" xmlns="http://www.w3.org/1999/xhtml">We’ll start with a quick review of the statistical computations. </span><span id="x1-347006r372"/></p>
<section class="level3" data-number="20.2.1" id="statistical-computations">
<h3 data-number="20.2.1"><span class="titlemark"><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">16.2.1 </span></span> <span id="x1-3480001"/><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml">Statistical computations</span></h3>
<p><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">The statistical summary output file, in TOML notation, has a </span><span id="dx1-348001"/><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml">section for each variable and the univariate </span><span id="dx1-348002"/><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">statistics about those variables.</span></p>
<p><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml">This section of the file looked like the following snippet of TOML:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-239">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">[x.location]
    mean = 9.0
[x.spread]
    variance = 11.0
[y.location]
    mean = 7.5
[y.spread]
    variance = 4.125</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml">When parsed, the TOML syntax of </span><code><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">x.location</span></code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">x.spread</span></code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml"> creates a </span><span id="dx1-348011"/><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">dictionary that looks like the </span><span id="dx1-348012"/><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml">following fragment of a Python object:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-240">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">{
    some metadata here...

    </span><span class="koboSpan" id="kobo.157.2" xmlns="http://www.w3.org/1999/xhtml">’x’: {
        ’location’: {
            ’mean’: 9.0
        },
        ’spread’: {
            ’variance’: 11.0
        }
    },
    ’y’: {
        etc.
    </span><span class="koboSpan" id="kobo.157.3" xmlns="http://www.w3.org/1999/xhtml">}
}</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">This structure can be expanded to include additional locations and spread statistical measures. </span><span class="koboSpan" id="kobo.158.2" xmlns="http://www.w3.org/1999/xhtml">It can also be expanded to include multivariate statistics. </span><span class="koboSpan" id="kobo.158.3" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml"> module has </span><code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">correlation()</span></code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">covariance()</span></code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml"> functions, making it easy to include these measures.</span></p>
<p><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">For datasets with few variables, it’s common to consider a matrix that includes all the combinations of covariance between variables. </span><span class="koboSpan" id="kobo.165.2" xmlns="http://www.w3.org/1999/xhtml">This leads to two alternative representations of these additional statistics:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml">A separate section for a covariance matrix. </span><span class="koboSpan" id="kobo.166.2" xmlns="http://www.w3.org/1999/xhtml">A section label of </span><code><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">[covariance]</span></code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml"> can be followed by nested dictionaries that include all combinations of variables. </span><span class="koboSpan" id="kobo.168.2" xmlns="http://www.w3.org/1999/xhtml">Since the covariance matrix is symmetric, all </span><em><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml">n</span></em><sup><span class="cmr-8"><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">2</span></span></sup><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml"> combinations aren’t needed; only </span><em><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">n</span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml">× </span></span><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">n</span></em><span class="cmsy-10x-x-109"><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">− </span></span><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">1) values are unique.</span></p></li>
<li><p><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">Multivariate sub-sections within each variable’s section. </span><span class="koboSpan" id="kobo.178.2" xmlns="http://www.w3.org/1999/xhtml">This means we’d have </span><code><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">x.location</span></code><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">x.spread</span></code><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">x.covariance.y</span></code><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">x.correlation.y</span></code><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml"> sub-sections for the </span><code><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">x</span></code><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml"> variable.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">For a dataset with fewer variables, it seems sensible to bundle covariance and correlation into the details for a given variable. </span><span class="koboSpan" id="kobo.189.2" xmlns="http://www.w3.org/1999/xhtml">In the case of Anscombe’s Quartet, with only two variables, the covariance and correlation </span><span id="dx1-348028"/><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">seem like they belong with the other statistics.</span></p>
<p><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">For a dataset with a larger </span><span id="dx1-348029"/><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">number of variables, the covariance among all the variables can become bewildering. </span><span class="koboSpan" id="kobo.192.2" xmlns="http://www.w3.org/1999/xhtml">In these cases, a technique like finding principal components might be needed to reduce the number of variables to a more manageable population. </span><span class="koboSpan" id="kobo.192.3" xmlns="http://www.w3.org/1999/xhtml">In this case, separate sections with covariance and auto-correlation might be more useful.</span></p>
<p><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">The resulting model is often the result of some careful thought, based on the covariance matrix. </span><span class="koboSpan" id="kobo.193.2" xmlns="http://www.w3.org/1999/xhtml">For this reason, a separate </span><code><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">[model]</span></code><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml"> section should be provided with some details about the model’s structure and the coefficients. </span><span class="koboSpan" id="kobo.195.2" xmlns="http://www.w3.org/1999/xhtml">In the case of a linear model, there are two coefficients, sometimes called </span><em><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">β</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml">0</span></span></sub><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><em><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml">β</span></em><sub><span class="cmr-8"><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml">1</span></span></sub><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.201.2" xmlns="http://www.w3.org/1999/xhtml">We’ve called them </span><em><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml">b </span></em><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">and </span><em><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml">For Python 3.11, the included </span><code><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml">tomllib</span></code><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml"> module doesn’t create TOML-format files. </span><span class="koboSpan" id="kobo.208.2" xmlns="http://www.w3.org/1999/xhtml">It’s, therefore, necessary to properly format a text file that can be parsed by the </span><code><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">tomllib</span></code><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml"> module. </span><span class="koboSpan" id="kobo.210.2" xmlns="http://www.w3.org/1999/xhtml">It’s helpful to use a Jinja template for this. </span><span id="x1-348030r374"/></p>
</section>
<section class="level3" data-number="20.2.2" id="analysis-diagrams">
<h3 data-number="20.2.2"><span class="titlemark"><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">16.2.2 </span></span> <span id="x1-3490002"/><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">Analysis diagrams</span></h3>
<p><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">Diagrams must first be created. </span><span class="koboSpan" id="kobo.213.2" xmlns="http://www.w3.org/1999/xhtml">Once created, they can </span><span id="dx1-349001"/><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">then be included in a document. </span><span class="koboSpan" id="kobo.214.2" xmlns="http://www.w3.org/1999/xhtml">The process of creating a </span><span id="dx1-349002"/><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">diagram is nearly identical to the approach used in Jupyter Lab. </span><span class="koboSpan" id="kobo.215.2" xmlns="http://www.w3.org/1999/xhtml">A few extra steps need to be taken to export the diagram to a file that can be imported into a document.</span></p>
<p><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">When working in Jupyter Lab, some cells to load the data are required to create two variables, </span><code><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">x</span></code><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">y</span></code><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">, with the </span><span id="dx1-349003"/><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">values to be plotted. </span><span class="koboSpan" id="kobo.221.2" xmlns="http://www.w3.org/1999/xhtml">After these cells, a cell like the following example will create and display a scatter plot:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-241">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">import matplotlib.pyplot as plt

fig, ax = plt.subplots()

# Labels and Title
ax.set_xlabel(’X’)
ax.set_ylabel(’Y’)
ax.set_title(’Series I’)

# Draw Scatter
_ = ax.scatter(x, y)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">This presumes previous cells have </span><span id="dx1-349015"/><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">loaded clean data and extracted two list objects, </span><code><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">x</span></code><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">y</span></code><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">, with the values to be plotted.</span></p>
<p><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">The above code sample doesn’t save the resulting PNG or SVG file, however. </span><span class="koboSpan" id="kobo.229.2" xmlns="http://www.w3.org/1999/xhtml">To save the figure, we need to perform two more steps. </span><span class="koboSpan" id="kobo.229.3" xmlns="http://www.w3.org/1999/xhtml">Here are the lines of code required to create a file from the plot:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-242">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">    plt.savefig(’scatter_x_y.png’)
    plt.close(fig)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">It helps to transform this cell’s code into a function. </span><span class="koboSpan" id="kobo.231.2" xmlns="http://www.w3.org/1999/xhtml">This function has proper type annotations so that a </span><span id="dx1-349018"/><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">tool like </span><strong><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml">mypy </span></strong><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">can confirm the types are used properly. </span><span class="koboSpan" id="kobo.234.2" xmlns="http://www.w3.org/1999/xhtml">It can also have unit test cases to be sure it really works.</span></p>
<p><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">savefig()</span></code><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml"> function will write a new file in PNG format with the image. </span><span class="koboSpan" id="kobo.237.2" xmlns="http://www.w3.org/1999/xhtml">If the file path suffix is </span><code><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">’.jpg’</span></code><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml"> then an SVG format file will be created.</span></p>
<p><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">The size of the figure is defined by the </span><code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml">figure()</span></code><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.242.2" xmlns="http://www.w3.org/1999/xhtml">There are often design and page layout considerations that suggest an appropriate size for a figure. </span><span class="koboSpan" id="kobo.242.3" xmlns="http://www.w3.org/1999/xhtml">This decision can be deferred, and the size can be </span><span id="dx1-349019"/><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml">provided by the markup </span><span id="dx1-349020"/><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">used to create a final PDF file or HTML page. </span><span class="koboSpan" id="kobo.244.2" xmlns="http://www.w3.org/1999/xhtml">It’s often best, however, to create the figure in the required size and resolution to avoid any unexpected alterations as part of the final publication.</span></p>
<p><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Once the diagram has been created, the Markdown needs to refer to the diagram’s PNG or SVG file so it can be included in a document. </span><span class="koboSpan" id="kobo.245.2" xmlns="http://www.w3.org/1999/xhtml">We’ll look at some examples of this in the next section. </span><span id="x1-349021r375"/></p>
</section>
<section class="level3" data-number="20.2.3" id="including-diagrams-in-the-final-document">
<h3 data-number="20.2.3"><span class="titlemark"><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">16.2.3 </span></span> <span id="x1-3500003"/><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">Including diagrams in the final document</span></h3>
<p><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">Diagrams are included in the final document by using markup commands to show where the diagram should be placed, and providing other information about captions and sizing.</span></p>
<p><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml">The Markdown language has a </span><span id="dx1-350001"/><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">tidy format for the simplest case of including an image in a document:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-243">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">![Alt text to include!](path/to/file.png "Figure caption")</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">Depending on the style sheet, this may be perfectly acceptable. </span><span class="koboSpan" id="kobo.252.2" xmlns="http://www.w3.org/1999/xhtml">In some cases, the image is the wrong size for its role in the document. </span><span class="koboSpan" id="kobo.252.3" xmlns="http://www.w3.org/1999/xhtml">Markdown permits using HTML directly instead of the </span><code><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">![image!](path)</span></code><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml"> construct. </span><span class="koboSpan" id="kobo.254.2" xmlns="http://www.w3.org/1999/xhtml">Including a diagram often looks like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-244">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">&lt;figure&gt;
    &lt;img src="path/to/file.png"
         alt="Alt text to include"
         height="8cm"&gt;
    &lt;figcaption&gt;Figure caption&lt;/figcaption&gt;
&lt;/figure&gt;</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml">Using HTML permits more control over image size and placement via references to CSS.</span></p>
<p><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">When using RST, the syntax offers more options without switching to HTML. </span><span class="koboSpan" id="kobo.257.2" xmlns="http://www.w3.org/1999/xhtml">Including a diagram would be like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-245">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">..  </span><span class="koboSpan" id="kobo.258.2" xmlns="http://www.w3.org/1999/xhtml">figure:: path/to/file.png
   :height: 8cm
   :alt: Alt text to include

   Figure caption</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">Using this kind of markup technique creates considerable freedom. </span><span class="koboSpan" id="kobo.259.2" xmlns="http://www.w3.org/1999/xhtml">The report’s author can include content from a variety of sources. </span><span class="koboSpan" id="kobo.259.3" xmlns="http://www.w3.org/1999/xhtml">This can include boilerplate text that doesn’t change, the results of computations, some text based on the computations, and important diagrams.</span></p>
<p><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">The formatting of the markup </span><span id="dx1-350014"/><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">has little impact on the final document. </span><span class="koboSpan" id="kobo.261.2" xmlns="http://www.w3.org/1999/xhtml">The way a browser renders HTML depends on the markup and the style sheets, not the formatting of the source file. </span><span class="koboSpan" id="kobo.261.3" xmlns="http://www.w3.org/1999/xhtml">Similarly, when creating a PDF document, this is often done by LaTeX tools, which create the final document based on LaTeX settings in the document’s preamble.</span></p>
<p><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">Now that we have an approach, we can look at the deliverable files that must be built. </span><span id="x1-350015r373"/></p>
</section>
</section>
<section class="level2" data-number="20.3" id="deliverables-22">
<h2 data-number="20.3"><span class="titlemark"><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">16.3 </span></span> <span id="x1-3510003"/><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">Deliverables</span></h2>
<p><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">This project </span><span id="dx1-351001"/><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">has the following deliverables:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">Documentation in the </span><code><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">docs</span></code><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance tests in the </span><code><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">tests/features</span></code><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">tests/steps</span></code><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml"> folders.</span></p></li>
<li><p><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for model module classes in the </span><code><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">tests</span></code><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">Mock objects for the </span><code><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml"> module tests that will be part of the unit tests.</span></p></li>
<li><p><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests for the </span><code><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">csv_extract</span></code><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml"> module components that are in the </span><code><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">tests</span></code><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml"> folder.</span></p></li>
<li><p><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">An application to extend the summary written to a TOML file, including figures with diagrams.</span></p></li>
<li><p><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">An application secondary feature to transform the TOML file to an HTML page or PDF file with the summary.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">We’ll look at a few of these deliverables in a little more detail. </span><span class="koboSpan" id="kobo.288.2" xmlns="http://www.w3.org/1999/xhtml">We’ll start with some suggestions for creating the acceptance tests. </span><span id="x1-351002r376"/></p>
<section class="level3" data-number="20.3.1" id="acceptance-tests-4">
<h3 data-number="20.3.1"><span class="titlemark"><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">16.3.1 </span></span> <span id="x1-3520001"/><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance tests</span></h3>
<p><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">As we noted in the previous chapter’s section on acceptance testing, </span><a href="ch019.xhtml#x1-3340001"><em><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance</span></em> <em><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml">testing</span></em></a><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml">, the output TOML document can be parsed and examined by the </span><code><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">Then</span></code><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml"> steps of a scenario. </span><span class="koboSpan" id="kobo.296.2" xmlns="http://www.w3.org/1999/xhtml">Because we’re looking at Anscombe’s Quartet </span><span id="dx1-352001"/><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">data in the examples in this book, a subset of data for testing doesn’t really make much sense. </span><span class="koboSpan" id="kobo.297.2" xmlns="http://www.w3.org/1999/xhtml">For any other dataset, a subset should be extracted and used for acceptance testing.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-246">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">It is often helpful to extract a small subset that’s used for acceptance testing. </span><span class="koboSpan" id="kobo.298.2" xmlns="http://www.w3.org/1999/xhtml">Instead of processing millions of rows, a few dozen rows are adequate to confirm the application read and summarized data. </span><span class="koboSpan" id="kobo.298.3" xmlns="http://www.w3.org/1999/xhtml">The data should be representative of the entire set of samples under consideration.</span></p>
<p><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">This subset is part of the testing suite; as such, it rarely changes. </span><span class="koboSpan" id="kobo.299.2" xmlns="http://www.w3.org/1999/xhtml">This makes the results predictable.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">The secondary feature of this application — expanding on the TOML output to add extensive Markdown — also works with text files. </span><span class="koboSpan" id="kobo.300.2" xmlns="http://www.w3.org/1999/xhtml">This makes it relatively easy to create scenarios to confirm the correct behavior by reading and writing text files. </span><span class="koboSpan" id="kobo.300.3" xmlns="http://www.w3.org/1999/xhtml">In many cases, the </span><code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">Then</span></code><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml"> steps will look for a few key features of the resulting document. </span><span class="koboSpan" id="kobo.302.2" xmlns="http://www.w3.org/1999/xhtml">They may check for specific section titles or a few important keywords included in boilerplate text. </span><span class="koboSpan" id="kobo.302.3" xmlns="http://www.w3.org/1999/xhtml">Of course, the test scenario can check for substitution values that are computed and are part of the TOML summary.</span></p>
<p><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">The automated testing can’t easily confirm that the document makes sense to prospective readers. </span><span class="koboSpan" id="kobo.303.2" xmlns="http://www.w3.org/1999/xhtml">It can’t be sure the colors chosen for the figures make the relationships clear. </span><span class="koboSpan" id="kobo.303.3" xmlns="http://www.w3.org/1999/xhtml">For this kind of usability test, a good copy editor or trusted associate is essential. </span><span id="x1-352002r378"/></p>
</section>
<section class="level3" data-number="20.3.2" id="unit-tests-1">
<h3 data-number="20.3.2"><span class="titlemark"><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">16.3.2 </span></span> <span id="x1-3530002"/><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">Unit tests</span></h3>
<p><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">A unit test for a function to create a figure can’t do very much. </span><span class="koboSpan" id="kobo.306.2" xmlns="http://www.w3.org/1999/xhtml">It’s limited to confirming that a PNG or SVG file was created. </span><span class="koboSpan" id="kobo.306.3" xmlns="http://www.w3.org/1999/xhtml">It’s difficult for an automated test to “look” at the image to be sure it has a title, labels for the axes, and sensible colors.</span></p>
<p><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">It is important not to overlook the </span><span id="dx1-353001"/><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml">unit test cases that confirm output files are created. </span><span class="koboSpan" id="kobo.308.2" xmlns="http://www.w3.org/1999/xhtml">A figure that looks great in a Jupyter notebook will not get written to a file unless the CLI application saves the figure to a file.</span></p>
<p><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">For some applications, it makes sense to mock the </span><code><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">plt</span></code><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml"> package functions to be sure the application calls the right functions with the expected argument values. </span><span class="koboSpan" id="kobo.311.2" xmlns="http://www.w3.org/1999/xhtml">Note that a mocked version of </span><code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml">plt.subplots()</span></code><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml"> may need to return a tuple with several </span><code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml">Mock</span></code><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml"> objects.</span></p>
<p><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">We’ll need to define a complex collection of mock objects to form the fixture for testing. </span><span class="koboSpan" id="kobo.316.2" xmlns="http://www.w3.org/1999/xhtml">The fixture creation can look like the following example:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-247">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">@fixture
def mocked_plt_module(monkeypatch):
    fig_mock = Mock()
    ax_mock = Mock(
        set_xlabel=Mock(),
        set_ylabel=Mock(),
        set_tiutle=Mock(),
        scatter=Mock(),
    )
    plt_mock = Mock(
        subplots=Mock(
            return_value=(fig_mock, ax_mock)
        ),
        savefig=Mock(),
        close=Mock()
    )
    monkeypatch.setattr(summary_app, ’plt’, plt_mock)
    return plt_mock, fig_mock, ax_mock</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml">This fixture creates three mock objects. </span><span class="koboSpan" id="kobo.318.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">plt_mock</span></code><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml"> is a mock of the overall </span><code><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">plt</span></code><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml"> module; it defines three mock functions that will be used by the application. </span><span class="koboSpan" id="kobo.322.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">fig_mock</span></code><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml"> is a mock of the figure object returned by the </span><code><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">subplots()</span></code><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.326.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.327.1" xmlns="http://www.w3.org/1999/xhtml">ax_mock</span></code><span class="koboSpan" id="kobo.328.1" xmlns="http://www.w3.org/1999/xhtml"> is a mock of the axes object, which is </span><span id="dx1-353020"/><span class="koboSpan" id="kobo.329.1" xmlns="http://www.w3.org/1999/xhtml">also returned by the </span><code><span class="koboSpan" id="kobo.330.1" xmlns="http://www.w3.org/1999/xhtml">subplots()</span></code><span class="koboSpan" id="kobo.331.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.331.2" xmlns="http://www.w3.org/1999/xhtml">This mocked axes object is used to provide axis labels, and the title, and perform the scatter plot request.</span></p>
<p><span class="koboSpan" id="kobo.332.1" xmlns="http://www.w3.org/1999/xhtml">This three-tuple of mock objects is then used by a test as follows:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-248">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.333.1" xmlns="http://www.w3.org/1999/xhtml">def test_scatter(mocked_plt_module):
    plt_mock, fig_mock, ax_mock = mocked_plt_module
    summary_app.scatter_figure([sentinel.X], [sentinel.Y])

    assert plt_mock.subplots.mock_calls == [call()]
    assert plt_mock.savefig.mock_calls == [call(’scatter_x_y.png’)]
    assert plt_mock.close.mock_calls == [call(fig_mock)]</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.334.1" xmlns="http://www.w3.org/1999/xhtml">This test function evaluates the application’s </span><code><span class="koboSpan" id="kobo.335.1" xmlns="http://www.w3.org/1999/xhtml">scatter_figure()</span></code><span class="koboSpan" id="kobo.336.1" xmlns="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.336.2" xmlns="http://www.w3.org/1999/xhtml">The test function then confirms that the various functions from the </span><code><span class="koboSpan" id="kobo.337.1" xmlns="http://www.w3.org/1999/xhtml">plt</span></code><span class="koboSpan" id="kobo.338.1" xmlns="http://www.w3.org/1999/xhtml"> module are called with the expected argument values.</span></p>
<p><span class="koboSpan" id="kobo.339.1" xmlns="http://www.w3.org/1999/xhtml">The test can continue by looking at the calls to the </span><code><span class="koboSpan" id="kobo.340.1" xmlns="http://www.w3.org/1999/xhtml">ax_mock</span></code><span class="koboSpan" id="kobo.341.1" xmlns="http://www.w3.org/1999/xhtml"> object to see if the labels and title requests were made as expected. </span><span class="koboSpan" id="kobo.341.2" xmlns="http://www.w3.org/1999/xhtml">This level of detail — looking at the calls to the axes object — may be a bit too fine-grained. </span><span class="koboSpan" id="kobo.341.3" xmlns="http://www.w3.org/1999/xhtml">These tests become very brittle as we explore changing titles or colors to help make a point more clearly.</span></p>
<p><span class="koboSpan" id="kobo.342.1" xmlns="http://www.w3.org/1999/xhtml">The overall use of mock objects, however, helps make sure the application will create the needed file with an image. </span><span id="x1-353028r377"/></p>
</section>
</section>
<section class="level2" data-number="20.4" id="summary-15">
<h2 data-number="20.4"><span class="titlemark"><span class="koboSpan" id="kobo.343.1" xmlns="http://www.w3.org/1999/xhtml">16.4 </span></span> <span id="x1-3540004"/><span class="koboSpan" id="kobo.344.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.345.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we’ve extended the automated analysis and reporting to include more use of the built-in </span><code><span class="koboSpan" id="kobo.346.1" xmlns="http://www.w3.org/1999/xhtml">statistics</span></code><span class="koboSpan" id="kobo.347.1" xmlns="http://www.w3.org/1999/xhtml"> library to compute correlation and linear regression coefficients. </span><span class="koboSpan" id="kobo.347.2" xmlns="http://www.w3.org/1999/xhtml">We’ve also made use of the </span><strong><span class="koboSpan" id="kobo.348.1" xmlns="http://www.w3.org/1999/xhtml">matplotlib </span></strong><span class="koboSpan" id="kobo.349.1" xmlns="http://www.w3.org/1999/xhtml">library to create images that reveal relationships among variables.</span></p>
<p><span class="koboSpan" id="kobo.350.1" xmlns="http://www.w3.org/1999/xhtml">The objective of automated reporting is designed to reduce the number of manual steps and avoid places where omissions or errors can lead to unreliable data analysis. </span><span class="koboSpan" id="kobo.350.2" xmlns="http://www.w3.org/1999/xhtml">Few things are more embarrassing than a presentation that reuses a diagram from the previous period’s data. </span><span class="koboSpan" id="kobo.350.3" xmlns="http://www.w3.org/1999/xhtml">It’s far too easy to fail to rebuild one important notebook in a series of analysis products.</span></p>
<p><span class="koboSpan" id="kobo.351.1" xmlns="http://www.w3.org/1999/xhtml">The level of automation needs to be treated with a great deal of respect. </span><span class="koboSpan" id="kobo.351.2" xmlns="http://www.w3.org/1999/xhtml">Once a reporting application is built and deployed, it must be actively monitored to be sure it’s working and producing useful, informative results. </span><span class="koboSpan" id="kobo.351.3" xmlns="http://www.w3.org/1999/xhtml">The analysis job shifts from developing an understanding to monitoring and maintaining the tools that confirm — or reject — that understanding.</span></p>
<p><span class="koboSpan" id="kobo.352.1" xmlns="http://www.w3.org/1999/xhtml">In the next chapter, we’ll review the journey from raw data to a polished suite of applications that acquires, cleans, and summarizes the data. </span><span id="x1-354001r380"/></p>
</section>
<section class="level2" data-number="20.5" id="extras-14">
<h2 data-number="20.5"><span class="titlemark"><span class="koboSpan" id="kobo.353.1" xmlns="http://www.w3.org/1999/xhtml">16.5 </span></span> <span id="x1-3550005"/><span class="koboSpan" id="kobo.354.1" xmlns="http://www.w3.org/1999/xhtml">Extras</span></h2>
<p><span class="koboSpan" id="kobo.355.1" xmlns="http://www.w3.org/1999/xhtml">Here are some ideas for you to add to this project. </span><span id="x1-355001r379"/></p>
<section class="level3" data-number="20.5.1" id="use-pandas-to-compute-basic-statistics">
<h3 data-number="20.5.1"><span class="titlemark"><span class="koboSpan" id="kobo.356.1" xmlns="http://www.w3.org/1999/xhtml">16.5.1 </span></span> <span id="x1-3560001"/><span class="koboSpan" id="kobo.357.1" xmlns="http://www.w3.org/1999/xhtml">Use pandas to compute basic statistics</span></h3>
<p><span class="koboSpan" id="kobo.358.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.359.1" xmlns="http://www.w3.org/1999/xhtml">pandas </span></strong><span class="koboSpan" id="kobo.360.1" xmlns="http://www.w3.org/1999/xhtml">package offers a robust set of tools for doing data analysis. </span><span class="koboSpan" id="kobo.360.2" xmlns="http://www.w3.org/1999/xhtml">The core concept is to create a </span><code><span class="koboSpan" id="kobo.361.1" xmlns="http://www.w3.org/1999/xhtml">DataFrame</span></code><span class="koboSpan" id="kobo.362.1" xmlns="http://www.w3.org/1999/xhtml"> that contains the relevant samples. </span><span class="koboSpan" id="kobo.362.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.363.1" xmlns="http://www.w3.org/1999/xhtml">pandas</span></code><span class="koboSpan" id="kobo.364.1" xmlns="http://www.w3.org/1999/xhtml"> package needs to be installed and added to the </span><code><span class="koboSpan" id="kobo.365.1" xmlns="http://www.w3.org/1999/xhtml">requirements.txt</span></code><span class="koboSpan" id="kobo.366.1" xmlns="http://www.w3.org/1999/xhtml"> file.</span></p>
<p><span class="koboSpan" id="kobo.367.1" xmlns="http://www.w3.org/1999/xhtml">There are methods for transforming a sequence of </span><code><span class="koboSpan" id="kobo.368.1" xmlns="http://www.w3.org/1999/xhtml">SeriesSample</span></code><span class="koboSpan" id="kobo.369.1" xmlns="http://www.w3.org/1999/xhtml"> objects into a </span><code><span class="koboSpan" id="kobo.370.1" xmlns="http://www.w3.org/1999/xhtml">DataFrame</span></code><span class="koboSpan" id="kobo.371.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.371.2" xmlns="http://www.w3.org/1999/xhtml">The best approach is often to convert each of the </span><strong><span class="koboSpan" id="kobo.372.1" xmlns="http://www.w3.org/1999/xhtml">pydantic </span></strong><span class="koboSpan" id="kobo.373.1" xmlns="http://www.w3.org/1999/xhtml">objects into a dictionary, and build the dataframe from the list of dictionaries.</span></p>
<p><span class="koboSpan" id="kobo.374.1" xmlns="http://www.w3.org/1999/xhtml">The idea is something like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-249">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.375.1" xmlns="http://www.w3.org/1999/xhtml">import pandas as pd

df = pd.DataFrame([dict(s) for s in series_data])</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.376.1" xmlns="http://www.w3.org/1999/xhtml">In this example, the value of </span><code><span class="koboSpan" id="kobo.377.1" xmlns="http://www.w3.org/1999/xhtml">series_data</span></code><span class="koboSpan" id="kobo.378.1" xmlns="http://www.w3.org/1999/xhtml"> is a sequence of </span><code><span class="koboSpan" id="kobo.379.1" xmlns="http://www.w3.org/1999/xhtml">SeriesSample</span></code><span class="koboSpan" id="kobo.380.1" xmlns="http://www.w3.org/1999/xhtml"> instances.</span></p>
<p><span class="koboSpan" id="kobo.381.1" xmlns="http://www.w3.org/1999/xhtml">Each column in the resulting dataframe will be one of the variables of the sample. </span><span class="koboSpan" id="kobo.381.2" xmlns="http://www.w3.org/1999/xhtml">Given this object, methods of the </span><code><span class="koboSpan" id="kobo.382.1" xmlns="http://www.w3.org/1999/xhtml">DataFrame</span></code><span class="koboSpan" id="kobo.383.1" xmlns="http://www.w3.org/1999/xhtml"> object produce useful statistics.</span></p>
<p><span class="koboSpan" id="kobo.384.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.385.1" xmlns="http://www.w3.org/1999/xhtml">corr()</span></code><span class="koboSpan" id="kobo.386.1" xmlns="http://www.w3.org/1999/xhtml"> function, for example, computes the correlation values among all of the columns in the dataframe.</span></p>
<p><span class="koboSpan" id="kobo.387.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.388.1" xmlns="http://www.w3.org/1999/xhtml">cov()</span></code><span class="koboSpan" id="kobo.389.1" xmlns="http://www.w3.org/1999/xhtml"> function computes the pairwise covariance among the columns in the dataframe.</span></p>
<p><span class="koboSpan" id="kobo.390.1" xmlns="http://www.w3.org/1999/xhtml">Pandas doesn’t compute the linear regression parameters, but it can create a wide variety of descriptive statistics.</span></p>
<p><span class="koboSpan" id="kobo.391.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://pandas.pydata.org"><span class="koboSpan" id="kobo.392.1" xmlns="http://www.w3.org/1999/xhtml">https://pandas.pydata.org</span></a><span class="koboSpan" id="kobo.393.1" xmlns="http://www.w3.org/1999/xhtml"> for more information on Pandas.</span></p>
<p><span class="koboSpan" id="kobo.394.1" xmlns="http://www.w3.org/1999/xhtml">In addition to a variety of statistics computations, this package is designed for interactive use. </span><span class="koboSpan" id="kobo.394.2" xmlns="http://www.w3.org/1999/xhtml">It works particularly well with Juypyter Lab. </span><span class="koboSpan" id="kobo.394.3" xmlns="http://www.w3.org/1999/xhtml">The interested reader may want to revisit </span><a href="ch017.xhtml#x1-29700013"><em><span class="koboSpan" id="kobo.395.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.396.1" xmlns="http://www.w3.org/1999/xhtml"> 13</span></em></a><span class="koboSpan" id="kobo.397.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch017.xhtml#x1-29700013"><em><span class="koboSpan" id="kobo.398.1" xmlns="http://www.w3.org/1999/xhtml">Project 4.1: Visual Analysis Techniques</span></em></a><span class="koboSpan" id="kobo.399.1" xmlns="http://www.w3.org/1999/xhtml"> using Pandas instead of native Python. </span><span id="x1-356004r382"/></p>
</section>
<section class="level3" data-number="20.5.2" id="use-the-dask-version-of-pandas">
<h3 data-number="20.5.2"><span class="titlemark"><span class="koboSpan" id="kobo.400.1" xmlns="http://www.w3.org/1999/xhtml">16.5.2 </span></span> <span id="x1-3570002"/><span class="koboSpan" id="kobo.401.1" xmlns="http://www.w3.org/1999/xhtml">Use the dask version of pandas</span></h3>
<p><span class="koboSpan" id="kobo.402.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.403.1" xmlns="http://www.w3.org/1999/xhtml">pandas </span></strong><span class="koboSpan" id="kobo.404.1" xmlns="http://www.w3.org/1999/xhtml">package offers a robust set of tools for doing data analysis. </span><span class="koboSpan" id="kobo.404.2" xmlns="http://www.w3.org/1999/xhtml">When the volume of data is vast, it helps to process parts of the dataset concurrently. </span><span class="koboSpan" id="kobo.404.3" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.405.1" xmlns="http://www.w3.org/1999/xhtml">Dask </span></strong><span class="koboSpan" id="kobo.406.1" xmlns="http://www.w3.org/1999/xhtml">project has an implementation of the </span><strong><span class="koboSpan" id="kobo.407.1" xmlns="http://www.w3.org/1999/xhtml">pandas </span></strong><span class="koboSpan" id="kobo.408.1" xmlns="http://www.w3.org/1999/xhtml">package that maximizes opportunities for concurrent processing.</span></p>
<p><span class="koboSpan" id="kobo.409.1" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.410.1" xmlns="http://www.w3.org/1999/xhtml">dask</span></code><span class="koboSpan" id="kobo.411.1" xmlns="http://www.w3.org/1999/xhtml"> package needs to be installed and added to the </span><code><span class="koboSpan" id="kobo.412.1" xmlns="http://www.w3.org/1999/xhtml">requirements.txt</span></code><span class="koboSpan" id="kobo.413.1" xmlns="http://www.w3.org/1999/xhtml"> file. </span><span class="koboSpan" id="kobo.413.2" xmlns="http://www.w3.org/1999/xhtml">This will include a </span><code><span class="koboSpan" id="kobo.414.1" xmlns="http://www.w3.org/1999/xhtml">pandas</span></code><span class="koboSpan" id="kobo.415.1" xmlns="http://www.w3.org/1999/xhtml"> package that can be used to improve overall application performance. </span><span id="x1-357001r383"/></p>
</section>
<section class="level3" data-number="20.5.3" id="use-numpy-for-statistics">
<h3 data-number="20.5.3"><span class="titlemark"><span class="koboSpan" id="kobo.416.1" xmlns="http://www.w3.org/1999/xhtml">16.5.3 </span></span> <span id="x1-3580003"/><span class="koboSpan" id="kobo.417.1" xmlns="http://www.w3.org/1999/xhtml">Use numpy for statistics</span></h3>
<p><span class="koboSpan" id="kobo.418.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.419.1" xmlns="http://www.w3.org/1999/xhtml">numpy </span></strong><span class="koboSpan" id="kobo.420.1" xmlns="http://www.w3.org/1999/xhtml">package offers a collection of tools for doing high-performance processing on large arrays of data. </span><span class="koboSpan" id="kobo.420.2" xmlns="http://www.w3.org/1999/xhtml">These basic tools are enhanced with libraries for statistics and linear algebra among many, many other features. </span><span class="koboSpan" id="kobo.420.3" xmlns="http://www.w3.org/1999/xhtml">This package needs to be installed and added to the </span><code><span class="koboSpan" id="kobo.421.1" xmlns="http://www.w3.org/1999/xhtml">requirements.txt</span></code><span class="koboSpan" id="kobo.422.1" xmlns="http://www.w3.org/1999/xhtml"> file.</span></p>
<p><span class="koboSpan" id="kobo.423.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.424.1" xmlns="http://www.w3.org/1999/xhtml">numpy </span></strong><span class="koboSpan" id="kobo.425.1" xmlns="http://www.w3.org/1999/xhtml">package works with its own internal array type. </span><span class="koboSpan" id="kobo.425.2" xmlns="http://www.w3.org/1999/xhtml">This means the </span><code><span class="koboSpan" id="kobo.426.1" xmlns="http://www.w3.org/1999/xhtml">SeriesSample</span></code><span class="koboSpan" id="kobo.427.1" xmlns="http://www.w3.org/1999/xhtml"> objects aren’t used directly. </span><span class="koboSpan" id="kobo.427.2" xmlns="http://www.w3.org/1999/xhtml">Instead, a </span><code><span class="koboSpan" id="kobo.428.1" xmlns="http://www.w3.org/1999/xhtml">numpy.array</span></code><span class="koboSpan" id="kobo.429.1" xmlns="http://www.w3.org/1999/xhtml"> object can be created for each of the variables in the source series.</span></p>
<p><span class="koboSpan" id="kobo.430.1" xmlns="http://www.w3.org/1999/xhtml">The conversion might look like the following:</span></p>
<p><span class="koboSpan" id="kobo.431.1" xmlns="http://www.w3.org/1999/xhtml">-</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-250">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.432.1" xmlns="http://www.w3.org/1999/xhtml">import numpy as np

x = np.array(s.x for s in series_data)
y = np.array(s.y for s in series_data)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.433.1" xmlns="http://www.w3.org/1999/xhtml">In this example, the value of </span><code><span class="koboSpan" id="kobo.434.1" xmlns="http://www.w3.org/1999/xhtml">series_data</span></code><span class="koboSpan" id="kobo.435.1" xmlns="http://www.w3.org/1999/xhtml"> is a sequence of </span><code><span class="koboSpan" id="kobo.436.1" xmlns="http://www.w3.org/1999/xhtml">SeriesSample</span></code><span class="koboSpan" id="kobo.437.1" xmlns="http://www.w3.org/1999/xhtml"> instances.</span></p>
<p><span class="koboSpan" id="kobo.438.1" xmlns="http://www.w3.org/1999/xhtml">It’s also sensible to create a single multi-dimensional array. </span><span class="koboSpan" id="kobo.438.2" xmlns="http://www.w3.org/1999/xhtml">In this case, axis 0 (i.e. </span><span class="koboSpan" id="kobo.438.3" xmlns="http://www.w3.org/1999/xhtml">rows) will be the individual samples, and axis 1 (i.e. </span><span class="koboSpan" id="kobo.438.4" xmlns="http://www.w3.org/1999/xhtml">columns) will be the values for each variable of the sample.</span></p>
<p><span class="koboSpan" id="kobo.439.1" xmlns="http://www.w3.org/1999/xhtml">An array has methods like </span><code><span class="koboSpan" id="kobo.440.1" xmlns="http://www.w3.org/1999/xhtml">mean()</span></code><span class="koboSpan" id="kobo.441.1" xmlns="http://www.w3.org/1999/xhtml"> to return the mean of the values. </span><span class="koboSpan" id="kobo.441.2" xmlns="http://www.w3.org/1999/xhtml">When using a multi-dimensional array, it’s essential to provide the </span><code><span class="koboSpan" id="kobo.442.1" xmlns="http://www.w3.org/1999/xhtml">axis=0</span></code><span class="koboSpan" id="kobo.443.1" xmlns="http://www.w3.org/1999/xhtml"> parameter to ensure that the results come from processing the collection of rows:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-251">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.444.1" xmlns="http://www.w3.org/1999/xhtml">import numpy as np

a = np.array([[s.x, s.y] for s in series_data])
print(f"means = {a.mean(axis=0)}")</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.445.1" xmlns="http://www.w3.org/1999/xhtml">See </span><a class="url" href="https://numpy.org/doc/stable/reference/routines.statistics.html#"><span class="koboSpan" id="kobo.446.1" xmlns="http://www.w3.org/1999/xhtml">https://numpy.org/doc/stable/reference/routines.statistics.html#</span></a></p>
<p><span class="koboSpan" id="kobo.447.1" xmlns="http://www.w3.org/1999/xhtml">Using the least squares technique to compute the coefficients for a line can be confusing. </span><span class="koboSpan" id="kobo.447.2" xmlns="http://www.w3.org/1999/xhtml">The least squares solver in </span><strong><span class="koboSpan" id="kobo.448.1" xmlns="http://www.w3.org/1999/xhtml">numpy.linalg </span></strong><span class="koboSpan" id="kobo.449.1" xmlns="http://www.w3.org/1999/xhtml">is a very general algorithm, which can be applied to creating a linear model. </span><span class="koboSpan" id="kobo.449.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.450.1" xmlns="http://www.w3.org/1999/xhtml">numpy.linalg.lstsq()</span></code><span class="koboSpan" id="kobo.451.1" xmlns="http://www.w3.org/1999/xhtml"> function expects a small matrix that contains the ”x” values. </span><span class="koboSpan" id="kobo.451.2" xmlns="http://www.w3.org/1999/xhtml">The result will be a vector with the same length as each of the ”x” matrices. </span><span class="koboSpan" id="kobo.451.3" xmlns="http://www.w3.org/1999/xhtml">The ”y” values will also be a vector.</span></p>
<p><span class="koboSpan" id="kobo.452.1" xmlns="http://www.w3.org/1999/xhtml">The processing winds up looking something like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-252">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.453.1" xmlns="http://www.w3.org/1999/xhtml">import numpy as np

A = np.array([[s.x, 1] for s in series_data])
y = np.array([s.y for s in series_data])
m, b = np.linalg.lstsq(A, y, rcond=None)[0]
print(f"y = {m:.1f}x + {b:.1f}")</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.454.1" xmlns="http://www.w3.org/1999/xhtml">The value of </span><code><span class="koboSpan" id="kobo.455.1" xmlns="http://www.w3.org/1999/xhtml">A</span></code><span class="koboSpan" id="kobo.456.1" xmlns="http://www.w3.org/1999/xhtml"> is a small matrix based on the x values. </span><span class="koboSpan" id="kobo.456.2" xmlns="http://www.w3.org/1999/xhtml">The value of </span><code><span class="koboSpan" id="kobo.457.1" xmlns="http://www.w3.org/1999/xhtml">y</span></code><span class="koboSpan" id="kobo.458.1" xmlns="http://www.w3.org/1999/xhtml"> is a simple array of the y values. </span><span class="koboSpan" id="kobo.458.2" xmlns="http://www.w3.org/1999/xhtml">The least-squares algorithm returns a four-tuple with the coefficients, residuals, the rank of the source matrix, and any singular values. </span><span class="koboSpan" id="kobo.458.3" xmlns="http://www.w3.org/1999/xhtml">In the above example, we only wanted the vector of the coefficients, so we used </span><code><span class="koboSpan" id="kobo.459.1" xmlns="http://www.w3.org/1999/xhtml">[0]</span></code><span class="koboSpan" id="kobo.460.1" xmlns="http://www.w3.org/1999/xhtml"> to extract the coefficient values from the four-tuple with the results.</span></p>
<p><span class="koboSpan" id="kobo.461.1" xmlns="http://www.w3.org/1999/xhtml">This is further decomposed to extract the two coefficients for the line that best fits this set of points. </span><span class="koboSpan" id="kobo.461.2" xmlns="http://www.w3.org/1999/xhtml">See: </span><a class="url" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html"><span class="koboSpan" id="kobo.462.1" xmlns="http://www.w3.org/1999/xhtml">https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html</span></a><span class="koboSpan" id="kobo.463.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<p><span class="koboSpan" id="kobo.464.1" xmlns="http://www.w3.org/1999/xhtml">This approach has a distinct advantage when working with very large sets of data. </span><span class="koboSpan" id="kobo.464.2" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.465.1" xmlns="http://www.w3.org/1999/xhtml">numpy </span></strong><span class="koboSpan" id="kobo.466.1" xmlns="http://www.w3.org/1999/xhtml">libraries are very fast and designed to scale to extremely large data volumes. </span><span id="x1-358015r384"/></p>
</section>
<section class="level3" data-number="20.5.4" id="use-scikit-learn-for-modeling">
<h3 data-number="20.5.4"><span class="titlemark"><span class="koboSpan" id="kobo.467.1" xmlns="http://www.w3.org/1999/xhtml">16.5.4 </span></span> <span id="x1-3590004"/><span class="koboSpan" id="kobo.468.1" xmlns="http://www.w3.org/1999/xhtml">Use scikit-learn for modeling</span></h3>
<p><span class="koboSpan" id="kobo.469.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.470.1" xmlns="http://www.w3.org/1999/xhtml">scikit-learn </span></strong><span class="koboSpan" id="kobo.471.1" xmlns="http://www.w3.org/1999/xhtml">library has a vast number of tools focused on modeling and machine learning. </span><span class="koboSpan" id="kobo.471.2" xmlns="http://www.w3.org/1999/xhtml">This library is built on the foundation of </span><strong><span class="koboSpan" id="kobo.472.1" xmlns="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.473.1" xmlns="http://www.w3.org/1999/xhtml">, so both packages need to be installed.</span></p>
<p><span class="koboSpan" id="kobo.474.1" xmlns="http://www.w3.org/1999/xhtml">The data needs to be converted into </span><strong><span class="koboSpan" id="kobo.475.1" xmlns="http://www.w3.org/1999/xhtml">numpy </span></strong><span class="koboSpan" id="kobo.476.1" xmlns="http://www.w3.org/1999/xhtml">arrays. </span><span class="koboSpan" id="kobo.476.2" xmlns="http://www.w3.org/1999/xhtml">Because the modeling approach is very generalized, the assumption is there may be multiple independent variables that predict the value of a dependent variable.</span></p>
<p><span class="koboSpan" id="kobo.477.1" xmlns="http://www.w3.org/1999/xhtml">The conversion might look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-253">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.478.1" xmlns="http://www.w3.org/1999/xhtml">import numpy as np

x = np.array([[s.x] for s in series_data])
y = np.array([s.y for s in series_data])</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.479.1" xmlns="http://www.w3.org/1999/xhtml">In this example, the value of </span><code><span class="koboSpan" id="kobo.480.1" xmlns="http://www.w3.org/1999/xhtml">series_data</span></code><span class="koboSpan" id="kobo.481.1" xmlns="http://www.w3.org/1999/xhtml"> is a sequence of </span><code><span class="koboSpan" id="kobo.482.1" xmlns="http://www.w3.org/1999/xhtml">SeriesSample</span></code><span class="koboSpan" id="kobo.483.1" xmlns="http://www.w3.org/1999/xhtml"> instances. </span><span class="koboSpan" id="kobo.483.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.484.1" xmlns="http://www.w3.org/1999/xhtml">x</span></code><span class="koboSpan" id="kobo.485.1" xmlns="http://www.w3.org/1999/xhtml"> array uses a very short vector for each sample; in this case, there’s only a single value. </span><span class="koboSpan" id="kobo.485.2" xmlns="http://www.w3.org/1999/xhtml">It needs to be a vector to fit the generalized least-squares regression that </span><strong><span class="koboSpan" id="kobo.486.1" xmlns="http://www.w3.org/1999/xhtml">scikit-learn </span></strong><span class="koboSpan" id="kobo.487.1" xmlns="http://www.w3.org/1999/xhtml">is capable of solving.</span></p>
<p><span class="koboSpan" id="kobo.488.1" xmlns="http://www.w3.org/1999/xhtml">The scikit-learn library is designed to create models in a very generalized way. </span><span class="koboSpan" id="kobo.488.2" xmlns="http://www.w3.org/1999/xhtml">The model isn’t always a simple line with a coefficient and an intercept that define the relationship. </span><span class="koboSpan" id="kobo.488.3" xmlns="http://www.w3.org/1999/xhtml">Because of this very general approach to modeling, we’ll create an instance of the </span><code><span class="koboSpan" id="kobo.489.1" xmlns="http://www.w3.org/1999/xhtml">linear_model.LinearRegression</span></code><span class="koboSpan" id="kobo.490.1" xmlns="http://www.w3.org/1999/xhtml"> class. </span><span class="koboSpan" id="kobo.490.2" xmlns="http://www.w3.org/1999/xhtml">This object has methods to create coefficients that fit a given set of data points. </span><span class="koboSpan" id="kobo.490.3" xmlns="http://www.w3.org/1999/xhtml">We can then examine the coefficients, or use them to interpolate new values.</span></p>
<p><span class="koboSpan" id="kobo.491.1" xmlns="http://www.w3.org/1999/xhtml">The code might look like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-254">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.492.1" xmlns="http://www.w3.org/1999/xhtml">from sklearn import linear_model

reg = linear_model.LinearRegression()
reg.fit(x, y)
print(f"y = {reg.coef_[0]:.1f}x + {reg.intercept_:.1f}")</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.493.1" xmlns="http://www.w3.org/1999/xhtml">The linear model’s </span><code><span class="koboSpan" id="kobo.494.1" xmlns="http://www.w3.org/1999/xhtml">coef_</span></code><span class="koboSpan" id="kobo.495.1" xmlns="http://www.w3.org/1999/xhtml"> attribute is a vector of coefficients, the same length as each row of the </span><code><span class="koboSpan" id="kobo.496.1" xmlns="http://www.w3.org/1999/xhtml">x</span></code><span class="koboSpan" id="kobo.497.1" xmlns="http://www.w3.org/1999/xhtml"> independent variable values. </span><span class="koboSpan" id="kobo.497.2" xmlns="http://www.w3.org/1999/xhtml">Even when the row length is 1, the result is a vector with a length of 1.</span></p>
<p><span class="koboSpan" id="kobo.498.1" xmlns="http://www.w3.org/1999/xhtml">Because this works with </span><strong><span class="koboSpan" id="kobo.499.1" xmlns="http://www.w3.org/1999/xhtml">numpy </span></strong><span class="koboSpan" id="kobo.500.1" xmlns="http://www.w3.org/1999/xhtml">it can work with very large sets of data. </span><span class="koboSpan" id="kobo.500.2" xmlns="http://www.w3.org/1999/xhtml">Further, the scikit-learn approach to creating models to fit data generalizes to a number of machine-learning approaches. </span><span class="koboSpan" id="kobo.500.3" xmlns="http://www.w3.org/1999/xhtml">This is often the next step in creating richer and more useful models. </span><span id="x1-359010r385"/></p>
</section>
<section class="level3" data-number="20.5.5" id="compute-the-correlation-and-regression-using-functional-programming">
<h3 data-number="20.5.5"><span class="titlemark"><span class="koboSpan" id="kobo.501.1" xmlns="http://www.w3.org/1999/xhtml">16.5.5 </span></span> <span id="x1-3600005"/><span class="koboSpan" id="kobo.502.1" xmlns="http://www.w3.org/1999/xhtml">Compute the correlation and regression using functional programming</span></h3>
<p><span class="koboSpan" id="kobo.503.1" xmlns="http://www.w3.org/1999/xhtml">The computations for correlation and the coefficients for a line can be summarized as follows. </span><span class="koboSpan" id="kobo.503.2" xmlns="http://www.w3.org/1999/xhtml">First, we’ll define a function </span><em><span class="koboSpan" id="kobo.504.1" xmlns="http://www.w3.org/1999/xhtml">M</span></em><span class="koboSpan" id="kobo.505.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.506.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><span class="koboSpan" id="kobo.507.1" xmlns="http://www.w3.org/1999/xhtml">;</span><em><span class="koboSpan" id="kobo.508.1" xmlns="http://www.w3.org/1999/xhtml">f</span></em><span class="koboSpan" id="kobo.509.1" xmlns="http://www.w3.org/1999/xhtml">()) that computes the mean of a transformed sequence of values. </span><span class="koboSpan" id="kobo.509.2" xmlns="http://www.w3.org/1999/xhtml">The </span><em><span class="koboSpan" id="kobo.510.1" xmlns="http://www.w3.org/1999/xhtml">f</span></em><span class="koboSpan" id="kobo.511.1" xmlns="http://www.w3.org/1999/xhtml">() function transforms each value, </span><em><span class="koboSpan" id="kobo.512.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.513.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.514.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.514.2" xmlns="http://www.w3.org/1999/xhtml">An identity function, </span><em><span class="koboSpan" id="kobo.515.1" xmlns="http://www.w3.org/1999/xhtml">ϕ</span></em><span class="koboSpan" id="kobo.516.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.517.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.518.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.519.1" xmlns="http://www.w3.org/1999/xhtml">) = </span><em><span class="koboSpan" id="kobo.520.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.521.1" xmlns="http://www.w3.org/1999/xhtml">i</span></span></sub><span class="koboSpan" id="kobo.522.1" xmlns="http://www.w3.org/1999/xhtml">, does no transformation:</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.523.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="M (a;f()) = 1-∑ f(a) N i " class="math-display" src="../media/file68.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.524.1" xmlns="http://www.w3.org/1999/xhtml">We’ll also need a function to compute the standard deviation for a variable, </span><em><span class="koboSpan" id="kobo.525.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><span class="koboSpan" id="kobo.526.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.527.1" xmlns="http://www.w3.org/1999/xhtml"><img alt=" ∘ -∑--------- --(ai −-¯a)2 S (a) = N " class="math-display" src="../media/file69.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.528.1" xmlns="http://www.w3.org/1999/xhtml">This lets us define a number of related values as mean values after some transformation.</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.529.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="¯x = M (x;f(ai) = ai) " class="math-display" src="../media/file70.jpg"/></span>
</div>
<div class="math-display">
<span class="koboSpan" id="kobo.530.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="¯y = M (y;f(ai) = ai) " class="math-display" src="../media/file71.jpg"/></span>
</div>
<div class="math-display">
<span class="koboSpan" id="kobo.531.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="--- x2 = M (x;f(ai) = a2i) " class="math-display" src="../media/file72.jpg"/></span>
</div>
<div class="math-display">
<span class="koboSpan" id="kobo.532.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="--- y2 = M (y;f(ai) = a2i) " class="math-display" src="../media/file73.jpg"/></span>
</div>
<div class="math-display">
<span class="koboSpan" id="kobo.533.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="--- xy = M (x,y;f(ai,bi) = ai × bi) " class="math-display" src="../media/file74.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.534.1" xmlns="http://www.w3.org/1999/xhtml">From these individual values, we can compute the correlation coefficient, </span><em><span class="koboSpan" id="kobo.535.1" xmlns="http://www.w3.org/1999/xhtml">r</span></em><sub><span class="cmmi-8"><span class="koboSpan" id="kobo.536.1" xmlns="http://www.w3.org/1999/xhtml">xy</span></span></sub><span class="koboSpan" id="kobo.537.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.538.1" xmlns="http://www.w3.org/1999/xhtml"><img alt=" --- -----xy-−-¯xy¯------ rxy = ∘ --2---2---2----2- (x − ¯x )(y − y¯) " class="math-display" src="../media/file75.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.539.1" xmlns="http://www.w3.org/1999/xhtml">In addition to the above values, we need two more values for the standard deviations of the two variables.</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.540.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="sx = S(x)sy = S(y) " class="math-display" src="../media/file76.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.541.1" xmlns="http://www.w3.org/1999/xhtml">From the correlation coefficient, and the two standard deviations, we can compute the coefficient of the line, </span><em><span class="koboSpan" id="kobo.542.1" xmlns="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.543.1" xmlns="http://www.w3.org/1999/xhtml">, and the intercept value, </span><em><span class="koboSpan" id="kobo.544.1" xmlns="http://www.w3.org/1999/xhtml">b</span></em><span class="koboSpan" id="kobo.545.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<div class="math-display">
<span class="koboSpan" id="kobo.546.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="m = rxysy sx " class="math-display" src="../media/file77.jpg"/></span>
</div>
<div class="math-display">
<span class="koboSpan" id="kobo.547.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="b = ¯y − m ¯x " class="math-display" src="../media/file78.jpg"/></span>
</div>
<p><span class="koboSpan" id="kobo.548.1" xmlns="http://www.w3.org/1999/xhtml">This yields the coefficient, </span><em><span class="koboSpan" id="kobo.549.1" xmlns="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.550.1" xmlns="http://www.w3.org/1999/xhtml">, and intercept, </span><em><span class="koboSpan" id="kobo.551.1" xmlns="http://www.w3.org/1999/xhtml">b</span></em><span class="koboSpan" id="kobo.552.1" xmlns="http://www.w3.org/1999/xhtml">, for the equation </span><em><span class="koboSpan" id="kobo.553.1" xmlns="http://www.w3.org/1999/xhtml">y </span></em><span class="koboSpan" id="kobo.554.1" xmlns="http://www.w3.org/1999/xhtml">= </span><em><span class="koboSpan" id="kobo.555.1" xmlns="http://www.w3.org/1999/xhtml">mx </span></em><span class="koboSpan" id="kobo.556.1" xmlns="http://www.w3.org/1999/xhtml">+ </span><em><span class="koboSpan" id="kobo.557.1" xmlns="http://www.w3.org/1999/xhtml">b</span></em><span class="koboSpan" id="kobo.558.1" xmlns="http://www.w3.org/1999/xhtml">, which minimizes the error between the given samples and the line. </span><span class="koboSpan" id="kobo.558.2" xmlns="http://www.w3.org/1999/xhtml">This is computed using one higher-order function, </span><em><span class="koboSpan" id="kobo.559.1" xmlns="http://www.w3.org/1999/xhtml">M</span></em><span class="koboSpan" id="kobo.560.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.561.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><span class="koboSpan" id="kobo.562.1" xmlns="http://www.w3.org/1999/xhtml">;</span><em><span class="koboSpan" id="kobo.563.1" xmlns="http://www.w3.org/1999/xhtml">f</span></em><span class="koboSpan" id="kobo.564.1" xmlns="http://www.w3.org/1999/xhtml">()), and one ordinary function, </span><em><span class="koboSpan" id="kobo.565.1" xmlns="http://www.w3.org/1999/xhtml">S</span></em><span class="koboSpan" id="kobo.566.1" xmlns="http://www.w3.org/1999/xhtml">(</span><em><span class="koboSpan" id="kobo.567.1" xmlns="http://www.w3.org/1999/xhtml">a</span></em><span class="koboSpan" id="kobo.568.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.568.2" xmlns="http://www.w3.org/1999/xhtml">This doesn’t seem to be a significant improvement over other methods. </span><span class="koboSpan" id="kobo.568.3" xmlns="http://www.w3.org/1999/xhtml">Because it’s built using standard library functions and functional programming techniques, it can be applied to any Python data structure. </span><span class="koboSpan" id="kobo.568.4" xmlns="http://www.w3.org/1999/xhtml">This can save the step of transforming data into </span><strong><span class="koboSpan" id="kobo.569.1" xmlns="http://www.w3.org/1999/xhtml">numpy </span></strong><span class="koboSpan" id="kobo.570.1" xmlns="http://www.w3.org/1999/xhtml">array objects. </span><span id="x1-360001r367"/></p>
</section>
</section>
</section>
</body>
</html>
