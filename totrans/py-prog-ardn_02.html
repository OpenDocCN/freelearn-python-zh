<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Working with the Firmata Protocol and the pySerial Library"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Working with the Firmata Protocol and the pySerial Library</h1></div></div></div><p>In the previous chapter, you learned the fundamentals of the Python programming language and the Arduino hardware platform so that you could get started. If you are reading this chapter directly without going through the previous chapter, it is assumed that you have some level of expertise or working experience with these technologies. This chapter describes two important components that are required to bridge Arduino with Python:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Arduino Firmata protocol</li><li class="listitem" style="list-style-type: disc">Python's serial library called <code class="literal">pySerial</code></li></ul></div><p>Although the Firmata protocol is useful to interface Arduino with Python, it can also be used as an independent tool to develop a large variety of applications.</p><p>It is time to take your Arduino hardware out and start getting your hands dirty. During the course of this chapter, you will require an LED, a breadboard, and a 1 kilo-ohm resistor as well as the components that you already used in the previous chapter, that is, Arduino Uno and a USB cable.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>If you are <a id="id237" class="indexterm"/>using any other variant of Arduino, you can obtain further information about it from <a class="ulink" href="http://arduino.cc/en/Guide/HomePage">http://arduino.cc/en/Guide/HomePage</a> or the community-supported Arduino forum that is located at <a class="ulink" href="http://forum.arduino.cc/">http://forum.arduino.cc/</a>.</p></div></div><div class="section" title="Connecting the Arduino board"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Connecting the Arduino board</h1></div></div></div><p>As mentioned in the previous chapter, this book supports all major operating systems, and this section will <a id="id238" class="indexterm"/>provide you with steps to connect and configure the Arduino board for these operating systems. In the previous chapter, we utilized example code to get started with the Arduino IDE. If you were unable to successfully communicate with Arduino by following the information given in the previous chapter, follow the instructions provided in this section to establish a connection between your computer and your Arduino. First, connect your Arduino board to your computer's USB port using a<a id="id239" class="indexterm"/> USB cable and follow the steps according to your operating system.</p><div class="section" title="Linux"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Linux</h2></div></div></div><p>If you are<a id="id240" class="indexterm"/> using the latest version of Ubuntu Linux, once you connect the Arduino board and open the Arduino IDE, you <a id="id241" class="indexterm"/>will be asked to add your username to the dailout group, as displayed in the following screenshot. Click on the <span class="strong"><strong>Add</strong></span> button and log out from the system. You don't need to restart the computer for the changes to take effect. Log in with the same username and open the Arduino IDE.</p><div class="mediaobject"><img src="graphics/5938OS_02_02.jpg" alt="Linux"/></div><p>If you don't see this dialog box, check whether you can see the <span class="strong"><strong>Serial Port</strong></span> option in the <span class="strong"><strong>Tools</strong></span> menu of the Arduino IDE. It is possible that the installation of other programs might have added your username to the dailout group already. If you don't get the dialog box and don't have any options to select in <span class="strong"><strong>Serial Port</strong></span>, execute the following script in the terminal, where <code class="literal">&lt;username&gt;</code> is your Linux username:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo usermod -a -G dialout &lt;username&gt;</strong></span>
</pre></div><p>This script will add your username to the dialout group, and it should also work for other Linux versions. In Linux, the Arduino board mostly gets connected as <code class="literal">/dev/ttyACMx</code>, where <code class="literal">x</code> is the integer value and depends on your physical port address. If you are using any other distribution of Linux other than Ubuntu, you might want to <a id="id242" class="indexterm"/>check out the proper groups associated <a id="id243" class="indexterm"/>with the Arduino serial port from the Linux installation page (<a class="ulink" href="http://playground.arduino.cc/Learning/Linux">http://playground.arduino.cc/Learning/Linux</a>) of the Arduino website.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>For the <a id="id244" class="indexterm"/>Fedora Linux distribution, add the <code class="literal">uucp</code> and <code class="literal">lock</code> groups with the <code class="literal">dialout</code> group to control the serial port:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo usermod -a -G uucp,dialout,lock &lt;username&gt;</strong></span>
</pre></div></div></div></div><div class="section" title="Mac OS X"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>Mac OS X</h2></div></div></div><p>In Mac OS X, when <a id="id245" class="indexterm"/>you connect <a id="id246" class="indexterm"/>your Arduino through a serial port, the OS configures it as a network interface. In OS X Mavericks, once the Arduino board is connected, open <span class="strong"><strong>Network</strong></span> from <span class="strong"><strong>System Preferences</strong></span>. A dialog box should appear that states that a new network interface has been detected. Click on <span class="strong"><strong>OK</strong></span> for <span class="strong"><strong>Thunderbolt Bridge</strong></span> and then click on <span class="strong"><strong>Apply</strong></span>. The following screenshot displays the dialog box to add a new network interface:</p><div class="mediaobject"><img src="graphics/5938OS_02_03.jpg" alt="Mac OS X"/></div><p>For OS X Lion or later versions, on connecting the Arduino board, a dialog box will appear<a id="id247" class="indexterm"/> that will ask you to add a <a id="id248" class="indexterm"/>new network interface. In this case, you will not have to navigate to your network preferences. If you see the network interface with the status <span class="strong"><strong>Not connected</strong></span> and highlighted in red, don't worry about it as it should work just fine.</p><p>Open the Arduino IDE and navigate to <span class="strong"><strong>Serial Port</strong></span> from the <span class="strong"><strong>Tools</strong></span> menu. You should be able to see options similar to those displayed in the following screenshot. The serial port on which the Arduino board is connected might vary according to your OS X version and the physical port to which it is connected. Make sure that you select a <code class="literal">tty</code> interface for a USB modem. As displayed in the following screenshot, the Arduino board is connected to the serial port <code class="literal">/dev/tty.usbmodemfd121</code>:</p><div class="mediaobject"><img src="graphics/5938OS_02_04.jpg" alt="Mac OS X"/></div></div><div class="section" title="Windows"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>Windows</h2></div></div></div><p>The <a id="id249" class="indexterm"/>configuration of the Arduino <a id="id250" class="indexterm"/>serial port is very straightforward if you are using Windows. When you connect your Arduino board the very first time, the operating system will automatically install the necessary drivers by itself. Once this process is complete, select an appropriate COM port from the <span class="strong"><strong>Serial Port</strong></span> option in the menu bar. From the main menu, navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Serial Port</strong></span> and select the COM port.</p></div><div class="section" title="Troubleshooting"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Troubleshooting</h2></div></div></div><p>Even after <a id="id251" class="indexterm"/>following the steps mentioned <a id="id252" class="indexterm"/>earlier, if you still don't see the highlighted <span class="strong"><strong>Serial Port</strong></span> option as displayed in the following screenshot, then you have got a problem. There can be two main reasons for this: the serial port is being used by another program or the Arduino USB drivers are not installed properly.</p><p>If any program other than the Arduino IDE is using the specific serial port, terminate that program and restart the Arduino IDE. Sometimes in Linux, the <code class="literal">brltty</code> library conflicts with the Arduino serial interface. Remove this library, log out, and log back in:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get remove brltty</strong></span>
</pre></div><p>In Windows, reinstalling the Arduino IDE also works, as this process installs and configures the Arduino USB driver again.</p><div class="mediaobject"><img src="graphics/5938OS_02_05.jpg" alt="Troubleshooting"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>The Arduino board can be used by only one program at a time. It is very import to make sure that any previously used program or other services are not using the serial port or Arduino when you try to use the Arduino IDE. This check will become very important when we start using multiple programs to control Arduino in the next section.</p></div></div><p>Assuming <a id="id253" class="indexterm"/>that you can now select the serial port<a id="id254" class="indexterm"/> in the Arduino IDE, we can go ahead with compiling and uploading sketches to your Arduino board. The Arduino IDE ships with preinstalled example sketches with which you can play around. However, before we go ahead and start playing with complex examples, let's go through the next section, which explains the Firmata protocol and also guides you through step-by-step instructions to compile and upload a sketch.</p></div></div></div>
<div class="section" title="Introducing the Firmata protocol"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Introducing the Firmata protocol</h1></div></div></div><p>Before Arduino, the domain of microcontroller-based applications was limited to hardware <a id="id255" class="indexterm"/>programmers. Arduino made it simple for developers that came from other software fields and even for the non-coding community to develop microcontroller-based hardware applications. Arduino consists of a simple hardware design with a microcontroller and I/O pins to interface external devices. If one can write an Arduino sketch that can transfer the control of the microcontroller and these pins to an external software mechanism, then it will reduce one's efforts to upload Arduino sketches for every modification. This process can be performed by developing such an Arduino program that can then be controlled using a serial port. There exists a protocol called <span class="strong"><strong>Firmata</strong></span>, which does exactly that.</p><div class="section" title="What is Firmata?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>What is Firmata?</h2></div></div></div><p>Firmata is a generic protocol that allows communication between the microcontroller and the software that is hosted on a computer. Any software from any computer host that is capable of serial communication can communicate with the microcontroller using Firmata. Firmata gives complete access of Arduino directly to the software and eliminates the processes of modifying and uploading Arduino sketches.</p><p>To utilize the Firmata protocol, a developer can upload a sketch that supports the protocol to the Arduino client as a onetime process. Afterwards, the developer can write custom software on the host computer and perform complex tasks. This software will provide commands via a serial port to the Arduino board that is equipped with Firmata. He or she can keep altering the logic on the host computer without interrupting the Arduino hardware.</p><p>The practice of writing custom Arduino sketches is still valid for standalone applications where the Arduino board has to perform a task locally. We will explore both these options in the upcoming chapters.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>You can learn <a id="id256" class="indexterm"/>more about the Firmata protocol and its latest version from the official website at <a class="ulink" href="http://www.firmata.org">http://www.firmata.org</a>.</p></div></div></div><div class="section" title="Uploading a Firmata sketch to the Arduino board"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Uploading a Firmata sketch to the Arduino board</h2></div></div></div><p>The best <a id="id257" class="indexterm"/>way to start testing<a id="id258" class="indexterm"/> the Firmata protocol is to upload a standard Firmata program to the Arduino board and use the testing software from the host. In this section, we are going to demonstrate a method to upload an Arduino sketch, which has this standard Firmata program, to the board. This is going to be the default method to upload any sketch in the future.</p><p>Implementation of the Firmata protocol requires the latest version of the Firmata firmware and you don't have to worry about writing it. The latest Arduino IDE ships with a standard version of the Firmata firmware, and we recommend that you use the latest IDE to avoid any conflict. Now, follow the following steps to upload the program to your Arduino board:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">As<a id="id259" class="indexterm"/> shown <a id="id260" class="indexterm"/>in the following screenshot, open the <span class="strong"><strong>StandardFirmata</strong></span> sketch by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Examples</strong></span> | <span class="strong"><strong>Firmata</strong></span> | <span class="strong"><strong>StandardFirmata</strong></span> in the Arduino IDE:<div class="mediaobject"><img src="graphics/5938OS_02_06.jpg" alt="Uploading a Firmata sketch to the Arduino board"/></div></li><li class="listitem">This action will open another sketchbook in a new window with the <span class="strong"><strong>StandardFirmata</strong></span> sketch loaded in the editor. Do not modify anything in the sketch and go ahead with the compiling process that is described in the next step. It is important not to modify anything in the code as the test software that we are going to use complies with the latest unchanged firmware.</li><li class="listitem">Once the <span class="strong"><strong>StandardFirmata</strong></span> sketch is opened, the next step is to compile it for your Arduino board. In the previous section, we already connected the <a id="id261" class="indexterm"/>Arduino<a id="id262" class="indexterm"/> board to the computer and selected the proper serial port. However, if the new sketchbook has a different configuration than that, follow the steps from the previous section, that is, select the appropriate serial port and the Arduino board type.</li><li class="listitem">To compile the current sketch, click on the <span class="strong"><strong>Verify</strong></span> icon from the toolbar as displayed in the following screenshot. You can also compile it by navigating to <span class="strong"><strong>Sketch</strong></span> | <span class="strong"><strong>Verify / Compile</strong></span> or clicking on <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>R</em></span> (<span class="emphasis"><em>command</em></span> + <span class="emphasis"><em>R</em></span> if you are using Mac OS X):<div class="mediaobject"><img src="graphics/5938OS_02_07.jpg" alt="Uploading a Firmata sketch to the Arduino board"/></div><p>The compilation process should complete without any errors as we are using default example code from the IDE itself. Now it's time to upload the sketch to the board. Make sure that you have connected the board.</p></li><li class="listitem">Press the upload icon in the toolbar as displayed in the following screenshot. This action will upload the compiled code to your Arduino board:<div class="mediaobject"><img src="graphics/5938OS_02_08.jpg" alt="Uploading a Firmata sketch to the Arduino board"/></div></li></ol></div><p>On<a id="id263" class="indexterm"/> completion, you should<a id="id264" class="indexterm"/> see the <span class="strong"><strong>Done uploading.</strong></span> text in the IDE, as displayed in the following screenshot:</p><div class="mediaobject"><img src="graphics/5938OS_02_09.jpg" alt="Uploading a Firmata sketch to the Arduino board"/></div><p>Your Arduino board is now ready with the latest Firmata firmware and is waiting for a request from your computer. Let's move on to the next section and start<a id="id265" class="indexterm"/> testing<a id="id266" class="indexterm"/> the Firmata protocol.</p></div><div class="section" title="Testing the Firmata protocol"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>Testing the Firmata protocol</h2></div></div></div><p>In the previous<a id="id267" class="indexterm"/> chapter, we used an on-board LED at pin 13 to test the <span class="strong"><strong>Blink</strong></span> program. This time, we are going to use an external LED to get you started with the assembly of hardware components using your Arduino board. As all the upcoming exercises and projects will require you to interface hardware components such as sensors and actuators to your Arduino board using a breadboard, we want you to start getting hands-on experience with wiring these components.</p><p>Now is the time to use the LED that we asked you to get at the beginning of the chapter. Before we start wiring the LED, let's first understand the physics of it. The LED that you obtained should have two legs: a short one and a long one. The short leg is connected to the cathode of the LED and it needs to be connected to the ground via a resistor. As you can see in the following figure, we are using a 1 k-ohm resistor to ground the cathode of the LED. The long leg, which is connected to the anode, needs to connect to one of the digital pins of the Arduino board.</p><p>As shown in the following figure, we have connected the anode to the digital pin number 13. Look at the figure and wire the connection as displayed. Make sure that you disconnect the Arduino board from the host computer to avoid any kind of damage from static electricity.</p><div class="mediaobject"><img src="graphics/5938OS_02_10.jpg" alt="Testing the Firmata protocol"/></div><p>In this<a id="id268" class="indexterm"/> example, we are going to use an LED to test some basic functionalities of the Firmata protocol. We have already uploaded the Firmata code to the Arduino board and we are ready to control the LED from the host computer.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>The preceding<a id="id269" class="indexterm"/> wiring figure was created using an open source tool called <span class="strong"><strong>Fritzing</strong></span>. We are going to cover the Fritzing tool comprehensively in the next chapter, as it will be our standard software to create the wiring diagram before we perform the actual physical wiring.</p></div></div><p>There are multiple ways to communicate with the Arduino board from the host computer using Firmata, such as writing your own program in Python using the supported library or using the prebuilt testing software. Starting from the next section, we are going to write our own programs to use Firmata, but at this stage, let's use a freely available tool for testing purposes. The<a id="id270" class="indexterm"/> official Firmata website, <a class="ulink" href="http://www.firmata.org">http://www.firmata.org</a>, also provides test tools that you can download from the <span class="strong"><strong>Firmata Test Program</strong></span> section on the main page. The website includes a different variant of the tool called <code class="literal">firmata_test</code> for different operating systems. Using the following steps, you can test the implementation of the Firmata protocol:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the appropriate version of the <code class="literal">firmata_test</code> program to your computer.</li><li class="listitem">Now, connect your Arduino board with the LED to the host computer using the USB cable and run the downloaded <code class="literal">firmata_test</code> program. You will be able to see an empty window on the successful execution of the program.</li><li class="listitem">As <a id="id271" class="indexterm"/>displayed in the following screenshot, select the appropriate port from the drop-down menu. Make sure to select the same port that you used to upload the Arduino sketch.<div class="mediaobject"><img src="graphics/5938OS_02_11.jpg" alt="Testing the Firmata protocol"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>At this point, make sure that your Arduino IDE is not connected to the board using the same port number. As we mentioned earlier, the serial interface grants exclusive access to only one application at a time.</p></div></div></li><li class="listitem">Once you select the Arduino serial port, the program will load multiple drop-down boxes and buttons with labels that contain the pin number. You can see in the following screenshot that the program is loaded with 12 digital pins (from pin 2 to pin 13) and six analog pins (from pin 14 to pin 19). As we are using the Arduino Uno board for our applications, the test program only loads pins that are part of Arduino Uno. If you are using Arduino Mega or any other board, the number of pins displayed in the program will be according to the pins supported by that particular variant of the Arduino board.<div class="mediaobject"><img src="graphics/5938OS_02_12.jpg" alt="Testing the Firmata protocol"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>
<span class="strong"><strong>Working with the firmata_test program on Linux</strong></span>
</p><p>On a <a id="id272" class="indexterm"/>Linux platform, you might have to modify the property of the downloaded file and make it executable. From the same directory, run the following command in the terminal to make it executable:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ chmod +x firmata_test</strong></span>
</pre></div><p>Once you have changed the permissions, use the following command to run the program from the terminal:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ ./firmata_test</strong></span>
</pre></div></div></div></li><li class="listitem">As you can see in the program window, you have two other columns as well as the column containing the labels. The second column in the program lets you select the role for the appropriate pins. You can specify the role of digital pins (in the case of Arduino Uno, from 2 to 13) as input or output. As displayed in the following screenshot, you will see <span class="strong"><strong>Low</strong></span> in the third column as soon as you select the role of pins 2 and 3 as input pins. This is correct, as we don't<a id="id273" class="indexterm"/> have any input connected to these pins. You can play with the program by changing the roles and values of multiple pins.<div class="mediaobject"><img src="graphics/5938OS_02_13.jpg" alt="Testing the Firmata protocol"/></div><p>As we have connected the LED to digital pin 13, we are not expecting any physical changes on the board while you are playing around with the other pins.</p></li><li class="listitem">Now, select pin 13 as an output pin and press the <span class="strong"><strong>Low</strong></span> button. This will change the button's label to <span class="strong"><strong>High</strong></span> and you will see that the LED is turned on. By performing this action, we have changed the logic of the digital pin 13 to 1, that is, <span class="strong"><strong>High</strong></span>, which translates to +5 volts at the pin. This potential will be sufficient to light the LED. You can change the level of pin 13 back to 0 by clicking on the button again and turning it to <span class="strong"><strong>Low</strong></span>. This will change the potential back to 0 volts.<div class="mediaobject"><img src="graphics/5938OS_02_14.jpg" alt="Testing the Firmata protocol"/></div></li></ol></div><p>The program that we used here is perfect to test the fundamentals, but it cannot be used to write complex applications using the Firmata protocol. In real-world applications, we really need to execute the Firmata methods using custom code, which in addition to switching the LED status also includes the implementation of smart logic and algorithms, interfacing <a id="id274" class="indexterm"/>other components, and so on. We are going to use Python for these applications, starting from the next section.</p></div></div>
<div class="section" title="Getting started with pySerial"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Getting started with pySerial</h1></div></div></div><p>You learned <a id="id275" class="indexterm"/>about the Firmata protocol in the previous section. This is an easy and quick way to start working with Arduino. Although the Firmata protocol helps you to develop complex applications from your computer without modifying the Arduino sketch, we are not ready to start coding these applications.</p><p>The first step towards writing these complex applications is to provide an interface between your programming environment and the Arduino via a serial port. In this book, you will be required to establish a connection between the Python interpreter and Arduino for every project that we develop.</p><p>Writing your own library, which includes implementation of functions and specifications to enable communication on a serial protocol, is an inconvenient and time consuming process. We are going to avoid that by using an open source, well maintained Python library called <code class="literal">pySerial</code>.</p><p>The <code class="literal">pySerial</code> library enables communication with Arduino by encapsulating the access for the serial port. This module provides access to the serial port settings through Python properties and allows you to configure the serial port directly through the interpreter. <code class="literal">pySerial</code> will be the bridge for any future communication between the Python and Arduino. Let's start by installing <code class="literal">pySerial</code>.</p><div class="section" title="Installing pySerial"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Installing pySerial</h2></div></div></div><p>We installed the package manager Setuptools in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with Python and Arduino">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Python and Arduino</em></span>. If <a id="id276" class="indexterm"/>you have skipped that chapter and are not sure about it, then please go through that section. If you already know how to install and configure <a id="id277" class="indexterm"/>Python library packages, skip these installation steps.</p><p>From this stage, we are going to use only pip-based installation commands due to their obvious advantages that were described in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with Python and Arduino">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Python and Arduino</em></span>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal or command prompt and execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; pip install pyserial</strong></span>
</pre></div><p>The Windows operating system does not require administrator-level user access to execute the command, but you should have root privileges to install Python packages in Unix-based operating systems, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo pip install pyserial</strong></span>
</pre></div><p>If you want to install the <code class="literal">pySerial</code> library from source, download the archive <a id="id278" class="indexterm"/>from <a class="ulink" href="http://pypi.python.org/pypi/pyserial">http://pypi.python.org/pypi/pyserial</a>, unpack it, and from the <code class="literal">pySerial</code> directory, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo python setup.py install</strong></span>
</pre></div></li><li class="listitem">If Python and Setuptools are installed properly, you should see the following output at the command line after the installation is complete:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>.</strong></span>
<span class="strong"><strong>.</strong></span>
<span class="strong"><strong>Processing dependencies for pyserial</strong></span>
<span class="strong"><strong>Finished processing dependencies for pyserial</strong></span>
</pre></div><p>This means that you have successfully installed the <code class="literal">pySerial</code> library and you are good to go to the next section.</p></li><li class="listitem">Now, to check whether or not <code class="literal">pySerial</code> is successfully installed, start your Python interpreter and import the <code class="literal">pySerial</code> library using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; import serial</strong></span>
</pre></div></li></ol></div></div><div class="section" title="Playing with a pySerial example"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>Playing with a pySerial example</h2></div></div></div><p>Your Arduino board has the Firmata sketch <span class="strong"><strong>StandardFirmata</strong></span> from the previous example. To play<a id="id279" class="indexterm"/> with <code class="literal">pySerial</code>, we are not going to use the Firmata protocol anymore. Instead, we are going to use another simple Arduino sketch that implements serial communication that can be captured on the Python interpreter.</p><p>Sticking with the promise of not performing any coding for the Arduino sketch, let's select an example sketch from the Arduino IDE:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">As displayed in the following screenshot, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Examples</strong></span> | <span class="strong"><strong>01. Basics</strong></span> | <span class="strong"><strong>DigitalReadSerial</strong></span>.<div class="mediaobject"><img src="graphics/5938OS_02_15.jpg" alt="Playing with a pySerial example"/></div></li><li class="listitem">Compile and upload the program to the Arduino board using the same method that was described earlier. Select the appropriate serial port on which your Arduino is connected and make a note of it. As you can see in the sketch, this simple Arduino code transmits the status of digital pin 2 that is on the serial port with a baud rate of 9600 bps.</li><li class="listitem">Without disconnecting the Arduino board from your computer, open the Python interpreter. Then, execute the following commands on the Python interpreter. Make sure <a id="id280" class="indexterm"/>that you replace <code class="literal">/dev/ttyACM0</code> with the port name that you noted down earlier:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; import serial</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; s = serial.Serial('/dev/ttyACM0',9600)</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; while True:</strong></span>
<span class="strong"><strong>    print s.readline()</strong></span>
</pre></div></li><li class="listitem">On execution, you should get repeated <code class="literal">0</code> values in the Python interpreter. Press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span> to terminate this code. As you can see, the Arduino code will keep sending messages due to the loop function that was used in the sketch. We don't have anything connected to pin 2, and because of this, we are getting the status <code class="literal">0</code>, that is, <code class="literal">Low</code>.</li><li class="listitem">If you know what you are doing, you can connect any digital sensor to pin 2 and run the script again to see the changed status.</li></ol></div><p>In the preceding Python script, the <code class="literal">serial.Serial</code> method interfaces and opens the specified serial port, while the <code class="literal">readline()</code> method reads each line from this interface, terminated with <code class="literal">\n</code>, that is, the newline character.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>The<a id="id281" class="indexterm"/> newline character is a special character that signifies the end of a line of text. It is also known<a id="id282" class="indexterm"/> as <span class="strong"><strong>End of Line</strong></span> (<span class="strong"><strong>EOL</strong></span>) or <a id="id283" class="indexterm"/>
<span class="strong"><strong>Line feed + Carriage Return</strong></span> (<span class="strong"><strong>LF + CR</strong></span>). Learn more about the newline <a id="id284" class="indexterm"/>character at <a class="ulink" href="http://en.wikipedia.org/wiki/Newline">http://en.wikipedia.org/wiki/Newline</a>.</p></div></div></div></div>
<div class="section" title="Bridging pySerial and Firmata"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Bridging pySerial and Firmata</h1></div></div></div><p>In the Firmata section, we already learned how useful it is to use the Firmata protocol instead of <a id="id285" class="indexterm"/>constantly modifying the Arduino <a id="id286" class="indexterm"/>sketch and uploading it for simple programs. <code class="literal">pySerial</code> is a simple library that provides a bridge between Arduino and Python via a serial port, but it lacks any support for the Firmata protocol. As mentioned earlier, the biggest benefit of Python can be described in one sentence, "There is a library for that." So, there exists a Python library called <code class="literal">pyFirmata</code> that is built on <code class="literal">pySerial</code> to support the Firmata protocol. There are a few other Python libraries that also support Firmata, but we will only be focusing on <code class="literal">pyFirmata</code> in this chapter. We will be extensively using this library for various upcoming projects as well:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's start by installing <code class="literal">pyFirmata</code> just like any other Python package by using Setuptools:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo pin install pyfirmata</strong></span>
</pre></div><p>In the previous section, while testing <code class="literal">pySerial</code>, we uploaded the <code class="literal">DigitalSerialRead</code> sketch to the Arduino board.</p></li><li class="listitem">To communicate using the Firmata protocol, you need to upload the <span class="strong"><strong>StandardFirmata</strong></span> sketch again, just as we did in the <span class="emphasis"><em>Uploading a Firmata sketch to the Arduino board</em></span> section.</li><li class="listitem">Once you have uploaded this sketch, open the Python interpreter and execute the following script. This script imports the <code class="literal">pyfirmata</code> library to the interpreter. It also defines the pin number and the port.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; import pyfirmata</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; pin= 13</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; port = '/dev/ttyACM0'</strong></span>
</pre></div></li><li class="listitem">After this, we need to associate the port with the microcontroller board type:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; board = pyfirmata.Arduino(port)</strong></span>
</pre></div><p>While executing the previous script, two LEDs on the Arduino will flicker as the communication link between the Python interpreter and the board gets established. In the <span class="emphasis"><em>Testing the Firmata protocol</em></span> section, we used a prebuilt program to turn an LED on and off. Once the Arduino board is associated to the Python interpreter, these functions can be performed directly from the prompt.</p></li><li class="listitem">You can now start playing with Arduino pins. Turn on the LED by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; board.digital[pin].write(1)</strong></span>
</pre></div></li><li class="listitem">You can turn off the LED by executing the following command. Here, in both commands, we set the state of digital pin 13 by passing values <code class="literal">1</code> (<span class="strong"><strong>High</strong></span>) or <code class="literal">0</code> (<span class="strong"><strong>Low</strong></span>):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; board.digital[pin].write(0)</strong></span>
</pre></div></li><li class="listitem">Similarly, you can also read the status of a pin from the prompt:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; board.digital[pin].read()</strong></span>
</pre></div></li></ol></div><p>If we combined this script in an executable file with a <code class="literal">.py</code> extension, we can have a Python<a id="id287" class="indexterm"/> program that can be run directly to control<a id="id288" class="indexterm"/> the LED rather than running these individual scripts on a terminal. Later, this program can be extended to perform complex functions without writing or changing the Arduino sketch.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>Although we are running individual scripts at the Python prompt, we will be going through the process of creating Python executable files in the next chapter.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Summary</h1></div></div></div><p>By introducing the Firmata library, we avoided writing any custom Arduino sketches in this chapter. We will continue this practice during the remaining part of this book and will only use or make custom sketches when required. In this chapter, you interacted with the Arduino board by making the LED blink, which is the easiest way to get started on a hardware project. Now it's time for your first project, where we are also going to make some more LEDs blink. One might ask the question that if we have already done it, then why do we need another project to make LEDs blink? Let's find out.</p></div></body></html>