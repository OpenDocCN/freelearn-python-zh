<html><head></head><body>
		<div><h1 id="_idParaDest-289" class="chapter-number"><a id="_idTextAnchor363"/>7</h1>
			<h1 id="_idParaDest-290"><a id="_idTextAnchor364"/>Debugging Modules</h1>
			<p>In <a href="B20997_05.xhtml#_idTextAnchor238"><em class="italic">Chapter 5</em></a>, <em class="italic">Basic Server-Side Development</em>, we saw how to write model methods to implement the logic of our module. However, we may get stuck when we encounter errors or logical issues. In order to resolve these errors, we need to perform a detailed inspection and this may take time. Luckily, Odoo provides you with some debugging tools that can help you find the root cause of various issues. In this chapter, we will look at various debugging tools and techniques in detail.</p>
			<p>In this chapter, we will cover the following recipes:</p>
			<ul>
				<li>The auto-reload and <code>--</code><code>dev</code> options</li>
				<li>Producing server logs to help debug methods</li>
				<li>Using the Odoo shell to interactively call methods</li>
				<li>Using the Python debugger to trace method execution</li>
				<li>Understanding the debug mode options</li>
			</ul>
			<h1 id="_idParaDest-291"><a id="_idTextAnchor365"/>The auto-reload and --dev options</h1>
			<p>In the previous chapters, we saw how to add a model, fields, and views. Whenever we make changes to Python files, we need to restart the server to apply those changes. If we make changes <a id="_idIndexMarker404"/>in XML files, we need to restart the server and update the module to reflect those changes in the user interface. If you are developing a large application, this can be <a id="_idIndexMarker405"/>time-consuming and frustrating. Odoo provides a command-line option, <code>--dev</code>, to overcome these issues. The <code>--dev</code> option has several possible values, and, in this recipe, we will see each of them.</p>
			<h2 id="_idParaDest-292"><a id="_idTextAnchor366"/>Getting ready</h2>
			<p>Install <code>inotify or watchdog</code> in your developer environment with the following command in the shell. Without <code>inotify or watchdog</code>, the auto-reload feature will not work:</p>
			<pre class="console">
$ pip3 install inotify
$ pip3 install watchdog</pre>			<h2 id="_idParaDest-293"><a id="_idTextAnchor367"/>How to do it...</h2>
			<p>To enable the <code>dev</code> option, you <a id="_idIndexMarker406"/>need to use <code>--dev=value</code> from the command line. Possible values for this option are <code>all</code>, <code>reload</code>, <code>pudb|wdb|ipdb|pdb</code>, <code>qweb</code>, <code>werkzeug</code>, and <code>xml</code>. Take a look at the following recipe for more information.</p>
			<h2 id="_idParaDest-294"><a id="_idTextAnchor368"/>How it works...</h2>
			<p>Check the following list for all <code>--dev</code> options and their purposes:</p>
			<ul>
				<li><code>reload</code>: Whenever you make changes in Python, you need to restart the server to <a id="_idIndexMarker407"/>reflect those changes in Odoo. The <code>--dev=reload</code> option will reload the Odoo server automatically when you make changes in any Python file. This feature will not work if you have not installed the Python <code>inotify</code> package. When you run an Odoo server with this option, you will see a log like this: <code>AutoReload watcher running </code><code>with inotify</code>.</li>
				<li><code>qweb</code>: You can create <a id="_idIndexMarker408"/>dynamic website pages in Odoo using QWeb templates. In <a href="B20997_14.xhtml#_idTextAnchor734"><em class="italic">Chapter 14</em></a>, <em class="italic">CMS Website Development</em>, we will see how to develop a web page with the QWeb template. You can debug issues in the QWeb template with the <code>t-debug</code> attribute. The <code>t-debug</code> options will only work if you enable the <code>dev</code> mode with <code>--dev=qweb</code>.</li>
				<li><code>werkzeug</code>: Odoo uses <code>werkzeug</code> to handle HTTP requests. Internally, Odoo will catch and <a id="_idIndexMarker409"/>suppress all exceptions generated by <code>werkzeug</code>. If you use <code>--dev=werkzeug</code>, werkzeug’s interactive debugger will be displayed on the web page when an exception is generated.</li>
				<li><code>xml</code>: Whenever <a id="_idIndexMarker410"/>you make changes in the view structure, you need to reload the server and update the module to apply those changes. With the <code>--dev=xml</code> option, you just need to reload Odoo from the browser. There is no need to restart the server or update the module.</li>
				<li><code>pudb|wdb|ipdb|pdb</code>: You <a id="_idIndexMarker411"/>can use the <code>--dev=pdb</code> option, it will activate the <a id="_idIndexMarker414"/>PDB whenever an exception is <a id="_idIndexMarker415"/>generated in Odoo. Odoo supports four Python debuggers: <code>pudb</code>, <code>wdb</code>, <code>ipdb</code>, and <code>pdb</code>.</li>
				<li><code>all</code>: If you use <code>--dev=all</code>, all of the <a id="_idIndexMarker416"/>preceding options will be enabled.</li>
			</ul>
			<pre class="console">
$ odoo/odoo-bin -c ~/odoo-dev/my-instance.cfg --dev=all</pre>			<p>If you want to <a id="_idIndexMarker417"/>enable only a few options, you can use comma-separated values, as follows:</p>
			<pre class="console">
$ odoo/odoo-bin -c ~/odoo-dev/my-instance.cfg --dev=reload,qweb</pre>			<p class="callout-heading">Important note</p>
			<p class="callout">If you have made changes to the database structure, such as if you have added new fields, the <code>--dev=reload</code> option will not reflect these in the database schema. You need to update the module manually; it only works for Python business logic. If you add a new view or menu, the <code>--dev=xml</code> option will not reflect this in the user interface. You need to update the module manually. This is very helpful when you are designing the structure of the view or the website page. If users have made changes in the view from the GUI, then <code>--dev=xml</code> will not load the XML from the file. Odoo will use the view structure, which the user changes.</p>
			<h1 id="_idParaDest-295"><a id="_idTextAnchor369"/>Producing server logs to help debug methods</h1>
			<p><strong class="bold">Server logs</strong> are useful when trying <a id="_idIndexMarker418"/>to figure out what has been happening at <a id="_idIndexMarker419"/>runtime before a crash. They can <a id="_idIndexMarker420"/>also be added to provide additional information when debugging is an issue. This recipe shows you how to add logging to an existing method.</p>
			<h2 id="_idParaDest-296"><a id="_idTextAnchor370"/>Getting ready</h2>
			<p>We will <a id="_idIndexMarker421"/>add some logging statements to the following <a id="_idIndexMarker422"/>method, which saves the stock levels of products to a file (you will also need to add the dependencies of the <code>product</code> and <code>stock</code> modules to the manifest):</p>
			<pre class="source-code">
from os.path import join as opj
from odoo import models, api, exceptions
EXPORTS_DIR = '/srv/exports'
class ProductProduct(models.Model):
    _inherit = 'product.product'
    @api.model
    def export_stock_level(self, stock_location):
        products = self.with_context(
            location=stock_location.id
        ).search([])
        products = products.filtered('qty_available')
        fname = opj(EXPORTS_DIR, 'stock_level.txt')
        try:
            with open(fname, 'w') as fobj:
                for prod in products:
                    fobj.write('%s\t%f\n' % (prod.name,
                                             prod.qty_available))
        except IOError:
            raise exceptions.UserError('unable to save file')</pre>			<h2 id="_idParaDest-297"><a id="_idTextAnchor371"/>How to do it...</h2>
			<p>In order to get some logs when this method is being executed, perform the following steps:</p>
			<ol>
				<li>At the beginning of the code, import the <code>logging</code> module:<pre class="source-code">
import logging</pre></li>				<li>Before <a id="_idIndexMarker423"/>the definition of the model <a id="_idIndexMarker424"/>class, get a logger for the module:<pre class="source-code">
_logger = logging.getLogger(__name__)</pre></li>				<li>Modify the code of the <code>export_stock_level()</code> method, as follows:<pre class="source-code">
@api.model
def export_stock_level(self, stock_location):
        _logger.info('export stock level for %s', stock_location.name)
        products = self.with_context(
             location=stock_location.id).search([])
        products = products.filtered('qty_available')
        _logger.debug('%d products in the location', len(products))
        fname = join(EXPORTS_DIR, 'stock_level.txt')
        try:
            with open(fname, 'w') as fobj:
                for prod in products:
                    fobj.write('%s\t%f\n' % (
                        prod.name, prod.qty_available))
        except IOError:
            _logger.exception(
                'Error while writing to %s in %s',
                'stock_level.txt', EXPORTS_DIR)
            raise exceptions.UserError('unable to save file')</pre></li>			</ol>
			<h2 id="_idParaDest-298"><a id="_idTextAnchor372"/>How it works...</h2>
			<p><em class="italic">Step 1</em> imports the <strong class="bold">logging</strong> module from <a id="_idIndexMarker425"/>the Python standard library. Odoo uses this module to manage its logs.</p>
			<p><em class="italic">Step 2</em> sets up a logger for the Python module. We use the common idiom <code>__name__ </code>in Odoo as an automatic variable for the name of the logger and to call the logger by <code>_logger</code>.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">The <code>__name__</code><em class="italic"> </em>variable is set <a id="_idIndexMarker426"/>automatically by the Python interpreter at module-import time, and its value is the full name of the module. Since Odoo does a little trick with the imports, the add-on modules are seen by Python as belonging to the <code>odoo.addons</code> Python package. So, if the code of the recipe is in <code>my_hostel/models/hostel.py</code>, <code>__name__</code> will be <code>odoo.addons.my_hostel.models.hostel</code>.</p>
			<p>By doing this, we get two benefits:</p>
			<ul>
				<li>The global <a id="_idIndexMarker427"/>logging configuration set <a id="_idIndexMarker428"/>on the <strong class="bold">odoo</strong> logger is applied to our logger because of the hierarchical structure of loggers in the <strong class="bold">logging</strong> module</li>
				<li>The logs will be prefixed with the full module path, which is a great help when trying to find where a given log line is produced</li>
			</ul>
			<p><em class="italic">Step 3</em> uses the logger to produce log messages. The available methods for this are (by increasing log level) <code>%</code> substitutions and additional arguments to be inserted into the message. You do not need to handle the <code>%</code> substitution yourself; the logging module is smart enough to perform this operation if the log has to be produced. If you are running with a log level of <strong class="bold">INFO</strong>, then <strong class="bold">DEBUG</strong> logs will avoid substitutions that will consume CPU resources in the long run.</p>
			<p>Another <a id="_idIndexMarker429"/>useful method shown in this recipe is <code>_logger.exception()</code>, which can be used in an exception handler. The message will <a id="_idIndexMarker430"/>be logged with a level of <code>ERROR</code>, and the stack trace is also printed in the application log.</p>
			<h2 id="_idParaDest-299"><a id="_idTextAnchor373"/>There’s more...</h2>
			<p>You can <a id="_idIndexMarker431"/>control the <strong class="bold">logging level</strong> of the application from the command line or from the configuration file. There are two main ways of doing this:</p>
			<p>The first way is to use the <code>--log-handler</code> option. Its basic syntax is like this: <code>--log-handler=prefix:level</code>. In this case, the prefix is a piece of the path of the logger name, and the level is <code>my_hostel</code> loggers to <strong class="bold">DEBUG</strong> and keep the default log level for the other add-ons, you can start Odoo as follows:</p>
			<pre class="console">
$ python odoo.py --log-handler=odoo.addons.my_hostel:DEBUG</pre>			<p>It is possible to specify <code>--log-handler</code> multiple times on the command line. You can also configure the <code>odoo.service.server</code>, for which we keep info-level messages, including server startup notifications:</p>
			<pre class="console">
log_handler = :ERROR,werkzeug:CRITICAL,odoo.service.server:INFO</pre>			<p>The second way is to use the <code>--log-level</code> option. To control the log level globally, you can use <code>--log-level</code> as the command-line option. Possible values for this option are <code>critical</code>, <code>error</code>, <code>warn</code>, <code>debug</code>, <code>debug_rpc</code>, <code>debug_rpc_answer</code>, <code>debug_sql</code>, and <code>test</code>.</p>
			<p>There are <a id="_idIndexMarker432"/>some shortcuts for setting logging <a id="_idIndexMarker433"/>levels. Here is a list of them:</p>
			<ul>
				<li><code>--log-request</code> is a shortcut for <code>--log-handler=odoo.http.rpc.request:DEBUG</code></li>
				<li><code>--log-response</code> is a shortcut for <code>--log-handler=odoo.http.rpc.response:DEBUG</code></li>
				<li><code>--log-web</code> is a shortcut for <code>--log-handler=odoo.http:DEBUG</code></li>
				<li><code>--log-sql</code> is a shortcut for <code>--log-handler=odoo.sql_db:DEBUG</code></li>
			</ul>
			<h1 id="_idParaDest-300"><a id="_idTextAnchor374"/>Using the Odoo shell to interactively call methods</h1>
			<p>The Odoo web interface is meant for end users, although the developer mode unlocks a number of <a id="_idIndexMarker434"/>powerful features. However, testing and debugging through the web interface is not the easiest way to do things, as you <a id="_idIndexMarker435"/>need to manually prepare the data, navigate in the menus to perform actions, and so on. The Odoo shell is a <strong class="bold">command-line interface</strong>, which <a id="_idIndexMarker436"/>you can use to issue calls. This recipe shows how to start the Odoo shell and perform actions such as calling a method inside the shell.</p>
			<h2 id="_idParaDest-301"><a id="_idTextAnchor375"/>Getting ready</h2>
			<p>We will reuse the same code as in the previous recipe to produce server logs to help debug methods. This allows the <code>product.product</code> model to add a new method. We will assume that you have an instance with the add-on installed and available. In this recipe, we expect that you have an Odoo configuration file for this instance called <code>project.conf</code>.</p>
			<h2 id="_idParaDest-302"><a id="_idTextAnchor376"/>How to do it...</h2>
			<p>In order to call the <code>export_stock_level()</code> method from the Odoo shell, perform the following steps:</p>
			<ol>
				<li>Start the Odoo shell and specify your project configuration file:<pre class="source-code">
<strong class="bold">    $ ./odoo-bin shell -c project.conf --log-level=error</strong></pre></li>				<li>Check for <a id="_idIndexMarker437"/>error messages and <a id="_idIndexMarker438"/>read the information text that’s displayed before the usual Python command-line prompt:<pre class="source-code">
<strong class="bold">env: &lt;odoo.api.Environment object at 0x7f48cc0868c0&gt;</strong>
<strong class="bold">odoo: &lt;module 'odoo' from '/home/serpentcs/workspace/17.0/odoo/__init__.py'&gt;</strong>
<strong class="bold">openerp: &lt;module 'odoo' from '/home/serpentcs/workspace/17.0/odoo/__init__.py'&gt;</strong>
<strong class="bold">self: res.users(1,)</strong>
<strong class="bold">Python 3.10.13 (main, Aug 25 2023, 13:20:03) [GCC 9.4.0]</strong>
<strong class="bold">Type 'copyright', 'credits' or 'license' for more information</strong>
<code>product.product</code>:<pre class="source-code">
    &gt;&gt;&gt; product = env['product.product']</pre></li>				<li>Get the main stock location record:<pre class="source-code">
    &gt;&gt;&gt; location_stock = env.ref('stock.stock_location_stock')</pre></li>				<li>Call the <code>export_stock_level()</code> method:<pre class="source-code">
    &gt;&gt;&gt; product.export_stock_level(location_stock)</pre></li>				<li>Commit the transaction before exiting:<pre class="source-code">
    &gt;&gt;&gt; env.cr.commit()</pre></li>				<li>Exit the shell by pressing <em class="italic">Ctrl + </em><em class="italic">D</em>.</li>
			</ol>
			<h2 id="_idParaDest-303"><a id="_idTextAnchor377"/>How it works...</h2>
			<p><em class="italic">Step 1</em> uses <code>odoo-bin shell</code> to start the Odoo shell. All the usual command-line arguments are available. We use <code>-c</code> to specify a project configuration file and <code>--log-level</code> to reduce the verbosity of the logs. When debugging, you may want to have a logging level of <code>DEBUG</code> for some specific add-ons.</p>
			<p>Before <a id="_idIndexMarker439"/>providing you with a Python <a id="_idIndexMarker440"/>command-line prompt, <code>odoo-bin shell</code> starts an Odoo instance that does not listen on the network and initializes some global variables, which are mentioned in the output:</p>
			<ul>
				<li><code>env</code> is an environment that’s connected to the database and specified on the command line or in the configuration file.</li>
				<li><code>odoo</code> is the <code>odoo</code> package that’s imported for you. You get access to all the Python modules within that package to do what you want.</li>
				<li><code>openerp</code> is an alias for the <code>odoo</code> package for backward compatibility.</li>
				<li><code>self</code> is a record set of <code>res.users</code> that contains a single record for the Odoo superuser (administrator), which is linked to the <code>env</code> environment.</li>
			</ul>
			<p><em class="italic">Steps 3</em> and <em class="italic">4</em> use <code>env</code> to get an empty record set and find a record according to the XML ID. <em class="italic">Step 5</em> calls the method on the <code>product.product</code> record set. These operations are identical to what you would use inside a method, with a minor difference being that we use <code>env</code> and not <code>self.env</code> (although we can have both, as they are identical). Take a look at <a href="B20997_05.xhtml#_idTextAnchor238"><em class="italic">Chapter 5</em></a>, <em class="italic">Basic Server-Side Development</em>, for more information on what is available.</p>
			<p><em class="italic">Step 6</em> commits the database transaction. This is not strictly necessary here because we did not modify any record in the database, but if we had done so and wanted these changes to persist, this is necessary; when you use Odoo through the web interface, each RPC call runs in its own database transaction, and Odoo manages these for you. When running in shell mode, this no longer happens and you have to call <code>env.cr.commit()</code> or <code>env.cr.rollback()</code> yourself. Otherwise, when you exit the shell, any transaction in progress is automatically rolled back. When testing, this is fine, but if you use the shell, for example, to script the configuration of an instance, don’t forget to commit your work!</p>
			<h2 id="_idParaDest-304"><a id="_idTextAnchor378"/>There’s more...</h2>
			<p>In shell mode, by <a id="_idIndexMarker441"/>default, Odoo opens <a id="_idIndexMarker442"/>Python’s REPL shell interface. You can use the REPL of your choice using the <code>--shell-interface</code> option. The supported REPLs are <code>ipython</code>, <code>ptpython</code>, <code>bpython</code>, and <code>python</code>:</p>
			<pre class="console">
$ ./odoo-bin shell -c project.conf  --shell-interface=ptpython</pre>			<h1 id="_idParaDest-305"><a id="_idTextAnchor379"/>Using the Python debugger to trace method execution</h1>
			<p>Sometimes, application logs are not enough to figure out what is going wrong. Fortunately, we <a id="_idIndexMarker443"/>also have the Python <a id="_idIndexMarker444"/>debugger. This recipe shows us how to insert a breakpoint in a method and trace the execution by hand.</p>
			<h2 id="_idParaDest-306"><a id="_idTextAnchor380"/>Getting ready</h2>
			<p>We will reuse the <code>export_stock_level()</code> method that was shown in the <em class="italic">Using the Odoo shell to interactively call methods</em> recipe of this chapter. Ensure that you have a copy to hand.</p>
			<h2 id="_idParaDest-307"><a id="_idTextAnchor381"/>How to do it...</h2>
			<p>To trace the execution of <code>export_stock_level()</code> with <code>pdb</code>, perform the following steps:</p>
			<ol>
				<li>Edit the code of the method, and insert the line highlighted here:<pre class="source-code">
def export_stock_level(self, stock_location):
    import pdb; pdb.set_trace()
    products = self.with_context( location=stock_location.id ).search([])
    fname = join(EXPORTS_DIR, 'stock_level.txt')
    try:
        with open(fname, 'w') as fobj:
            for prod in products.filtered('qty_available'):
                fobj.write('%s\t%f\n' % (prod.name, prod.qty_available))
    except IOError:
         raise exceptions.UserError('unable to save file')</pre></li>				<li>Run the <a id="_idIndexMarker445"/>method. We will use <a id="_idIndexMarker446"/>the Odoo shell, as explained in the <em class="italic">Using the Odoo shell to interactively call </em><em class="italic">methods</em> recipe:<pre class="source-code">
$ ./odoo-bin shell -c project.cfg --log-level=error
    [...]
    &gt;&gt;&gt; product = env['product.product']
    &gt;&gt;&gt; location_stock = env.ref('stock.stock_location_stock')
    &gt;&gt;&gt; product.export_stock_level(location_stock)
    &gt; /home/cookbook/stock_level/models.py(18)export_stock_level()
    -&gt; products = self.with_context(
    (Pdb)</pre></li>				<li>At the <code>(Pdb)</code> prompt, issue the <code>args</code> command (the shortcut for which is <code>a</code>) to get the values of the arguments that were passed to the method:<pre class="source-code">
(Pdb) a
self = product.product()
stock_location = stock.location(14,)</pre></li>				<li>Enter the <code>list</code> command <a id="_idIndexMarker447"/>to check where in the code you are standing:<pre class="source-code">
(Pdb) list
13       @api.model
14       def export_stock_level(self, stock_location):
15       _logger.info('export stock level for %s',
16                    stock_location.name)
17       import pdb; pdb.set_trace()
18 -&gt;    products = self.with_context(
19       location=stock_location.id).search([])
20       products = products.filtered('qty_available')
21       _logger.debug('%d products in the location',
22                     len(products))
23       fname = join(EXPORTS_DIR, 'stock_level.txt')
(Pdb)</pre></li>				<li>Enter the <code>next</code> command three times to walk through the first lines of the method. You <a id="_idIndexMarker448"/>may also use <code>n</code>, which is a shortcut:<pre class="source-code">
(Pdb) next
&gt; /home/cookbook/stock_level/models.py(19)export_stock_level()
-&gt; location=stock_location.id).search([])
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(20)export_stock_level()
-&gt; products = products.filtered('qty_available')
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(21)export_stock_level()
-&gt; _logger.debug('%d products in the location',
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(22)export_stock_level()
-&gt; len(products))
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(23)export_stock_level()
-&gt; fname = join(EXPORTS_DIR, 'stock_level.txt')
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(24)export_stock_level()
-&gt; try:</pre></li>				<li>Use the <code>p</code> command <a id="_idIndexMarker449"/>to display the <a id="_idIndexMarker450"/>values of the <code>products</code> and <code>fname</code> variables:<pre class="source-code">
(Pdb) p products
product.product(32, 14, 17, 19, 21, 22, 23, 29, 34, 33, 26, 27, 42)
(Pdb) p fname
'/srv/exports/stock_level.txt'</pre></li>				<li>Change the value of <code>fname</code> to point to the <code>/</code><code>tmp</code> directory:<pre class="source-code">
(Pdb) !fname = '/tmp/stock_level.txt'</pre></li>				<li>Use the <code>return</code> (shortcut: <code>r</code>) command to execute the current function:<pre class="source-code">
(Pdb) return
--Return--
&gt; /home/cookbook/stock_level/models.py(26)export_stock_level()-&gt;None
-&gt; for product in products:</pre></li>				<li>Use the <code>cont</code> (shortcut: <code>c</code>) command to resume the execution of the program:<pre class="source-code">
(Pdb) c
&gt;&gt;&gt;</pre></li>			</ol>
			<h2 id="_idParaDest-308"><a id="_idTextAnchor382"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we hardcoded a breakpoint in the source code of the method by calling the <code>set_trace()</code> method of the <code>pdb</code> module from the Python standard library. When this <a id="_idIndexMarker451"/>method is executed, the <a id="_idIndexMarker452"/>normal flow of the program stops, and you get a <code>(Pdb)</code> prompt into which you can enter <code>pdb</code> commands.</p>
			<p><em class="italic">Step 2</em> calls the <code>stock_level_export()</code> method using shell mode. It is also possible to restart the server normally and use the web interface to generate a call to the method you need to trace by clicking on the appropriate elements of the user interface.</p>
			<p>When you need to manually step through some code using the Python debugger, here are a few tips that will make your life easier:</p>
			<ul>
				<li>Reduce the logging level to avoid having too many log lines, which pollutes the output of the debugger. Starting at the <code>ERROR</code> level is generally fine. You may want to enable some specific loggers with a higher verbosity, which you can do using the <code>--log-handler</code> command-line option (refer to the <em class="italic">Producing server logs to help debug </em><em class="italic">methods</em> recipe).</li>
				<li>Run the server with <code>--workers=0</code> to avoid any multiprocessing issues that can cause the same breakpoint to be reached twice in two different processes.</li>
				<li>Run the server with <code>--max-cron-threads=0</code> to disable the processing of the <code>ir.cron</code> periodic tasks, which may otherwise trigger while you are stepping through the method, which produces unwanted logs and side effects.</li>
			</ul>
			<p><em class="italic">Steps 3</em> to <em class="italic">8</em> use several <code>pdb</code> commands to step through the execution of the method. Here’s a summary <a id="_idIndexMarker453"/>of the main <a id="_idIndexMarker454"/>commands of <code>pdb</code>. Most of these are also available using the first letter as a shortcut. We indicate this in the following list by having the optional letters between parentheses:</p>
			<ul>
				<li><code>h(elp)</code>: This displays help with the <code>pdb</code> commands.</li>
				<li><code>a(rgs)</code>: This shows the value of the arguments of the current function/methods.</li>
				<li><code>l(ist)</code>: This displays the source code being executed in chunks of 11 lines, initially centered on the current line. Successive calls will move further in the source code file. Optionally, you can pass two integers at the start and end, which specify the region to display.</li>
				<li><code>p</code>: This prints a variable.</li>
				<li><code>pp</code>: This pretty-prints a variable (useful with lists and dictionaries).</li>
				<li><code>w(here)</code>: This shows the call stack, with the current line at the bottom and the Python interpreter at the top.</li>
				<li><code>u(p)</code>: This moves up one level in the call stack.</li>
				<li><code>d(own)</code>: This moves down one level in the call stack.</li>
				<li><code>n(ext)</code>: This executes the current line of code and then stops.</li>
				<li><code>s(tep)</code>: This is to step inside the execution of a method call.</li>
				<li><code>r(eturn)</code>: This resumes the execution of the current method until it returns.</li>
				<li><code>c(ont(inue))</code>: This resumes the execution of the program until the next breakpoint is hit.</li>
				<li><code>b(reak) &lt;args&gt;</code>: This <a id="_idIndexMarker455"/>creates a new breakpoint and displays its identifier; <code>args</code> can be one of the following:<ul><li><code>&lt;empty&gt;</code>: This lists all breakpoints.</li><li><code>line_number</code>: This <a id="_idIndexMarker456"/>breaks at the specified line in the current file.</li><li><code>filename:line_number</code>: This breaks at the specified line of the specified file (which is searched for in the directories of <code>sys.path</code>).</li><li><code>function_name</code>: This breaks at the first line of the specified function.</li><li><code>tbreak &lt;args&gt;</code>: This is similar to break, but the breakpoint will be canceled after it has been reached, so successive execution of the line won’t trigger it twice.</li><li><code>disable bp_id</code>: This disables a breakpoint by ID.</li><li><code>enable bl_id</code>: This enables a disabled breakpoint by ID.</li></ul></li>
				<li><code>j(ump) lineno</code>: The next line to execute will be the one specified. This can be used to rerun or skip some lines.</li>
				<li><code>(!) statement</code>: This executes a Python statement. The <code>!</code> character can be omitted if the command does not look like a <code>pdb</code> command. For instance, you need it if you want to set the value of a variable named <code>a</code>, because <code>a</code> is the shortcut for the <code>args</code> command.</li>
			</ul>
			<h2 id="_idParaDest-309"><a id="_idTextAnchor383"/>There’s more...</h2>
			<p>In the recipe, we <a id="_idIndexMarker457"/>inserted a <code>pdb.set_trace()</code> statement to break into <code>pdb</code> for debugging. We can also start <code>pdb</code> directly from within the Odoo shell, which is very useful when you cannot easily modify the code of the project using <code>pdb.runcall()</code>. This function takes a method as the first argument and the arguments to pass to the function as the next argument. So, inside the Odoo shell, you do the following:</p>
			<pre class="console">
&gt;&gt;&gt; import pdb
&gt;&gt;&gt; product = env['product.product']
&gt;&gt;&gt; location_stock = env.ref('stock.stock_location_stock')
&gt;&gt;&gt; pdb.runcall(product.export_stock_level, location_stock)
&gt; /home/cookbook/stock_level/models.py(16)export_stock_level()
-&gt; products = self.with_context((Pdb)</pre>			<p>In this recipe, we focused on the Python debugger from the Python standard library, <code>pdb</code>. It is very useful to know about this tool because it is guaranteed to be available on any Python distribution. There are other Python debuggers available, such as <code>ipdb</code> (<a href="https://pypi.python.org/pypi/ipdb">https://pypi.python.org/pypi/ipdb</a>) and <code>pudb</code> (<a href="https://pypi.python.org/pypi/pudb">https://pypi.python.org/pypi/pudb</a>), which can be used as drop-in replacements for <code>pdb</code>. They share the same API, and most of the commands that you saw in this recipe were unchanged. Also, of course, if you develop for Odoo using a Python IDE, you will have access to a debugger that was integrated with it.</p>
			<h2 id="_idParaDest-310"><a id="_idTextAnchor384"/>See also</h2>
			<p>If you want to learn more about the <code>pdb</code> debugger, refer to the full documentation of <code>pdb</code> at <a href="https://docs.python.org/3.9/library/pdb.html">https://docs.python.org/3.9/library/pdb.html</a>.</p>
			<h1 id="_idParaDest-311"><a id="_idTextAnchor385"/>Understanding the debug mode options</h1>
			<p>In <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, we saw how to enable debug/developer options in Odoo. These options are very helpful in debugging and reveal some <a id="_idIndexMarker458"/>further technical information. In this recipe, we will look at these options in detail.</p>
			<h2 id="_idParaDest-312"><a id="_idTextAnchor386"/>How to do it...</h2>
			<p>Check the <em class="italic">Activating the Odoo developer tools</em> recipe of <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, and activate developer mode. After activating developer mode, you will see a drop-down menu with a bug icon in the top bar, as shown here:</p>
			<div><div><img src="img/B20997_07_1.jpg" alt="Figure 7.1 – Available options after activating debug mode"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Available options after activating debug mode</p>
			<p>In this menu, you will <a id="_idIndexMarker459"/>see various options. Give them a go to see them in action. The next section will explain these options in more detail.</p>
			<h2 id="_idParaDest-313"><a id="_idTextAnchor387"/>How it works...</h2>
			<p>Let’s learn more about the options in the following points:</p>
			<ul>
				<li><strong class="bold">Run JS Tests</strong>: This <a id="_idIndexMarker460"/>option will redirect you to the JavaScript QUnit test case page, as shown in the following screenshot. It will start running all test cases one by one. Here, you can see the progress and the status of the test cases. In <a href="B20997_18.xhtml#_idTextAnchor990"><em class="italic">Chapter 18</em></a>, <em class="italic">Automated Test Cases</em>, we will see <a id="_idIndexMarker461"/>how can we create our own QUnit JavaScript test cases:</li>
			</ul>
			<div><div><img src="img/B20997_07_2.jpg" alt="Figure 7.2 – QUnit test case result screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – QUnit test case result screen</p>
			<ul>
				<li><strong class="bold">Run JS Mobile Tests</strong>: Similar to the preceding option, but this one runs a QUnit <a id="_idIndexMarker462"/>test case for a mobile environment.</li>
				<li><strong class="bold">Run Click Anywhere Tests</strong>: This option will start clicking on all menus one by one. It will <a id="_idIndexMarker463"/>click in all the views and search filters. If something is broken or there is any regression, it will show the tracebacks. To stop this test, you will need to reload the page.</li>
				<li><strong class="bold">Open View</strong>: This option <a id="_idIndexMarker464"/>will open a list of all available views. By selecting any of them, you can open that view without defining any menus or actions.</li>
				<li><strong class="bold">Disable Tours</strong>: Odoo uses <a id="_idIndexMarker465"/>tours to improve the onboarding of new users. If you want to disable it, you can do it by using this option.</li>
				<li><strong class="bold">Start Tour</strong>: Odoo also <a id="_idIndexMarker466"/>uses tours for automated testing. We will create a custom onboarding tour in <a href="B20997_15.xhtml#_idTextAnchor861"><em class="italic">Chapter 15</em></a>, <em class="italic">Web Client Development</em>. This option will open a dialog box with a list of all tours, as shown in the following screenshot. By clicking on the play button next to a tour, Odoo will automatically perform all the steps of the tour:</li>
			</ul>
			<div><div><img src="img/B20997_07_3.jpg" alt="Figure 7.3 – Dialog to manually launch tours"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Dialog to manually launch tours</p>
			<ul>
				<li><strong class="bold">Edit Action</strong>: In the <em class="italic">Adding menu items and views</em> recipe of <a href="B20997_03.xhtml#_idTextAnchor083"><em class="italic">Chapter 3</em></a>, <em class="italic">Creating Odoo Add-On Modules</em>, we added a menu item and an action to open views <a id="_idIndexMarker467"/>in Odoo. Details of these actions are also stored in the database as a record. This option will open the record details of the action we open to display the current view.</li>
				<li><code>hostel.hostel</code> model, this option will show a list of fields for the <code>hostel.hostel</code> model.</li>
				<li><strong class="bold">Manage Filters</strong>: In Odoo, users can create custom filters from the search view. This option will <a id="_idIndexMarker469"/>open a list of custom filters for the current model. Here, you can modify the custom filters.</li>
				<li><strong class="bold">Technical Translations</strong>: This option will open a list of translated terms for the current <a id="_idIndexMarker470"/>model. You can modify the technical translation terms for your model from here. You can refer to <a href="B20997_11.xhtml#_idTextAnchor595"><em class="italic">Chapter 11</em></a>, <em class="italic">Internationalization,</em> to learn more about translations.</li>
				<li><strong class="bold">View Access Rights</strong>: This <a id="_idIndexMarker471"/>option will show a list of security access rights for the current model.</li>
				<li><strong class="bold">View Record Rules</strong>: This <a id="_idIndexMarker472"/>option will show a list of security record rules for the current model.</li>
				<li><code>fields_view_get()</code> method.</li>
				<li><code>ir.ui.view</code> record of the current view. This option is dynamic and it will show an <a id="_idIndexMarker474"/>option based on the view that is currently open. This means that if you open <strong class="bold">Kanban View</strong>, you will get an <strong class="bold">Edit View: Kanban</strong> option, and if you open <strong class="bold">Form View</strong>, you will get an <strong class="bold">Edit View: </strong><strong class="bold">Form</strong> option.</li>
			</ul>
			<p class="callout-heading">Important tip</p>
			<p class="callout">You can modify the view definition from the <strong class="bold">Edit View</strong> option. This updated definition will be applicable on the current database and these changes will be removed when you update the module. It’s therefore better to modify views from modules.</p>
			<ul>
				<li><code>ir.ui.view</code> record of the current model’s search view.</li>
				<li><strong class="bold">Activate Assets Debugging</strong>: Odoo provides two types of developer mode: <em class="italic">Developer mode</em> and <em class="italic">Developer mode with assets</em>. With this option, you can <a id="_idIndexMarker476"/>switch from <em class="italic">Developer</em> mode to <em class="italic">Developer mode with assets</em> mode. Check the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment,</em> for more details.</li>
				<li><strong class="bold">Activate Test Assets Debugging</strong>: As we know, Odoo uses tours for testing. Enabling <a id="_idIndexMarker477"/>this mode will load test assets in Odoo. This option will show some more tours in the <strong class="bold">Start </strong><strong class="bold">tour</strong> dialog.</li>
				<li><strong class="bold">Regenerate Assets Bundles</strong>: Odoo manages all CSS and JavaScript through asset <a id="_idIndexMarker478"/>bundles. This option deletes the old JavaScript and CSS assets and generates new ones. This option is helpful when you are getting issues because of asset caching. We will learn more about asset bundles in <a href="B20997_14.xhtml#_idTextAnchor734"><em class="italic">Chapter 14</em></a>, <em class="italic">CMS </em><em class="italic">Website Development.</em></li>
				<li><strong class="bold">Become Super User</strong>: This is a new option added from version 12. By activating this <a id="_idIndexMarker479"/>option, you switch to a super user. You can access the records even if you don’t have access rights. This option is not available for all users; it is only available for users who have <strong class="bold">Administration: settings</strong> access rights. After activating this mode, you will see a striped top menu, as shown here:</li>
			</ul>
			<div><div><img src="img/B20997_07_4.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<div><div><img src="img/B20997_07_5.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Menu after activating a super user</p>
			<ul>
				<li><strong class="bold">Leave Developer Tools</strong>: This <a id="_idIndexMarker480"/>option allows you to leave developer mode.</li>
			</ul>
			<p>We have seen all of the options that are available under the debug menu. These options can be used in several ways, such as debugging, testing, and fixing issues. They can also be used to explore the source code for views.</p>
		</div>
	</body></html>