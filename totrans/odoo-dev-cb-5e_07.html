<html><head></head><body>
		<div id="_idContainer054">
			<h1 id="_idParaDest-289" class="chapter-number"><a id="_idTextAnchor363"/>7</h1>
			<h1 id="_idParaDest-290"><a id="_idTextAnchor364"/>Debugging Modules</h1>
			<p>In <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, we saw how to write model methods to implement the logic of our module. However, we may get stuck when we encounter errors or logical issues. In order to resolve these errors, we need to perform a detailed inspection and this may take time. Luckily, Odoo provides you with some debugging tools that can help you find the root cause of various issues. In this chapter, we will look at various debugging tools and techniques <span class="No-Break">in detail.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>The auto-reload and <strong class="source-inline">--</strong><span class="No-Break"><strong class="source-inline">dev</strong></span><span class="No-Break"> options</span></li>
				<li>Producing server logs to help <span class="No-Break">debug methods</span></li>
				<li>Using the Odoo shell to interactively <span class="No-Break">call methods</span></li>
				<li>Using the Python debugger to trace <span class="No-Break">method execution</span></li>
				<li>Understanding the debug <span class="No-Break">mode options</span></li>
			</ul>
			<h1 id="_idParaDest-291"><a id="_idTextAnchor365"/>The auto-reload and --dev options</h1>
			<p>In the previous chapters, we saw how to add a model, fields, and views. Whenever we make changes to Python files, we need to restart the server to apply those changes. If we make changes <a id="_idIndexMarker404"/>in XML files, we need to restart the server and update the module to reflect those changes in the user interface. If you are developing a large application, this can be <a id="_idIndexMarker405"/>time-consuming and frustrating. Odoo provides a command-line option, <strong class="source-inline">--dev</strong>, to overcome these issues. The <strong class="source-inline">--dev</strong> option has several possible values, and, in this recipe, we will see each <span class="No-Break">of them.</span></p>
			<h2 id="_idParaDest-292"><a id="_idTextAnchor366"/>Getting ready</h2>
			<p>Install <strong class="source-inline">inotify or watchdog</strong> in your developer environment with the following command in the shell. Without <strong class="source-inline">inotify or watchdog</strong>, the auto-reload feature will <span class="No-Break">not work:</span></p>
			<pre class="console">
$ pip3 install inotify
$ pip3 install watchdog</pre>			<h2 id="_idParaDest-293"><a id="_idTextAnchor367"/>How to do it...</h2>
			<p>To enable the <strong class="source-inline">dev</strong> option, you <a id="_idIndexMarker406"/>need to use <strong class="source-inline">--dev=value</strong> from the command line. Possible values for this option are <strong class="source-inline">all</strong>, <strong class="source-inline">reload</strong>, <strong class="source-inline">pudb|wdb|ipdb|pdb</strong>, <strong class="source-inline">qweb</strong>, <strong class="source-inline">werkzeug</strong>, and <strong class="source-inline">xml</strong>. Take a look at the following recipe for <span class="No-Break">more information.</span></p>
			<h2 id="_idParaDest-294"><a id="_idTextAnchor368"/>How it works...</h2>
			<p>Check the following list for all <strong class="source-inline">--dev</strong> options and <span class="No-Break">their purposes:</span></p>
			<ul>
				<li><strong class="source-inline">reload</strong>: Whenever you make changes in Python, you need to restart the server to <a id="_idIndexMarker407"/>reflect those changes in Odoo. The <strong class="source-inline">--dev=reload</strong> option will reload the Odoo server automatically when you make changes in any Python file. This feature will not work if you have not installed the Python <strong class="source-inline">inotify</strong> package. When you run an Odoo server with this option, you will see a log like this: <strong class="source-inline">AutoReload watcher running </strong><span class="No-Break"><strong class="source-inline">with inotify</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">qweb</strong>: You can create <a id="_idIndexMarker408"/>dynamic website pages in Odoo using QWeb templates. In <a href="B20997_14.xhtml#_idTextAnchor734"><span class="No-Break"><em class="italic">Chapter 14</em></span></a>, <em class="italic">CMS Website Development</em>, we will see how to develop a web page with the QWeb template. You can debug issues in the QWeb template with the <strong class="source-inline">t-debug</strong> attribute. The <strong class="source-inline">t-debug</strong> options will only work if you enable the <strong class="source-inline">dev</strong> mode <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">--dev=qweb</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">werkzeug</strong>: Odoo uses <strong class="source-inline">werkzeug</strong> to handle HTTP requests. Internally, Odoo will catch and <a id="_idIndexMarker409"/>suppress all exceptions generated by <strong class="source-inline">werkzeug</strong>. If you use <strong class="source-inline">--dev=werkzeug</strong>, werkzeug’s interactive debugger will be displayed on the web page when an exception <span class="No-Break">is generated.</span></li>
				<li><strong class="source-inline">xml</strong>: Whenever <a id="_idIndexMarker410"/>you make changes in the view structure, you need to reload the server and update the module to apply those changes. With the <strong class="source-inline">--dev=xml</strong> option, you just need to reload Odoo from the browser. There is no need to restart the server or update <span class="No-Break">the module.</span></li>
				<li><strong class="source-inline">pudb|wdb|ipdb|pdb</strong>: You <a id="_idIndexMarker411"/>can use the <strong class="bold">Python debugger</strong> (<strong class="bold">PDB</strong>) to <a id="_idIndexMarker412"/>get more information about the <a id="_idIndexMarker413"/>errors. When you use the <strong class="source-inline">--dev=pdb</strong> option, it will activate the <a id="_idIndexMarker414"/>PDB whenever an exception is <a id="_idIndexMarker415"/>generated in Odoo. Odoo supports four Python debuggers: <strong class="source-inline">pudb</strong>, <strong class="source-inline">wdb</strong>, <strong class="source-inline">ipdb</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">pdb</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">all</strong>: If you use <strong class="source-inline">--dev=all</strong>, all of the <a id="_idIndexMarker416"/>preceding options will <span class="No-Break">be enabled.</span></li>
			</ul>
			<pre class="console">
$ odoo/odoo-bin -c ~/odoo-dev/my-instance.cfg --dev=all</pre>			<p>If you want to <a id="_idIndexMarker417"/>enable only a few options, you can use comma-separated values, <span class="No-Break">as follows:</span></p>
			<pre class="console">
$ odoo/odoo-bin -c ~/odoo-dev/my-instance.cfg --dev=reload,qweb</pre>			<p class="callout-heading">Important note</p>
			<p class="callout">If you have made changes to the database structure, such as if you have added new fields, the <strong class="source-inline">--dev=reload</strong> option will not reflect these in the database schema. You need to update the module manually; it only works for Python business logic. If you add a new view or menu, the <strong class="source-inline">--dev=xml</strong> option will not reflect this in the user interface. You need to update the module manually. This is very helpful when you are designing the structure of the view or the website page. If users have made changes in the view from the GUI, then <strong class="source-inline">--dev=xml</strong> will not load the XML from the file. Odoo will use the view structure, which the <span class="No-Break">user changes.</span></p>
			<h1 id="_idParaDest-295"><a id="_idTextAnchor369"/>Producing server logs to help debug methods</h1>
			<p><strong class="bold">Server logs</strong> are useful when trying <a id="_idIndexMarker418"/>to figure out what has been happening at <a id="_idIndexMarker419"/>runtime before a crash. They can <a id="_idIndexMarker420"/>also be added to provide additional information when debugging is an issue. This recipe shows you how to add logging to an <span class="No-Break">existing method.</span></p>
			<h2 id="_idParaDest-296"><a id="_idTextAnchor370"/>Getting ready</h2>
			<p>We will <a id="_idIndexMarker421"/>add some logging statements to the following <a id="_idIndexMarker422"/>method, which saves the stock levels of products to a file (you will also need to add the dependencies of the <strong class="source-inline">product</strong> and <strong class="source-inline">stock</strong> modules to <span class="No-Break">the manifest):</span></p>
			<pre class="source-code">
from os.path import join as opj
from odoo import models, api, exceptions
EXPORTS_DIR = '/srv/exports'
class ProductProduct(models.Model):
    _inherit = 'product.product'
    @api.model
    def export_stock_level(self, stock_location):
        products = self.with_context(
            location=stock_location.id
        ).search([])
        products = products.filtered('qty_available')
        fname = opj(EXPORTS_DIR, 'stock_level.txt')
        try:
            with open(fname, 'w') as fobj:
                for prod in products:
                    fobj.write('%s\t%f\n' % (prod.name,
                                             prod.qty_available))
        except IOError:
            raise exceptions.UserError('unable to save file')</pre>			<h2 id="_idParaDest-297"><a id="_idTextAnchor371"/>How to do it...</h2>
			<p>In order to get some logs when this method is being executed, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>At the beginning of the code, import the <span class="No-Break"><strong class="source-inline">logging</strong></span><span class="No-Break"> module:</span><pre class="source-code">
import logging</pre></li>				<li>Before <a id="_idIndexMarker423"/>the definition of the model <a id="_idIndexMarker424"/>class, get a logger for <span class="No-Break">the module:</span><pre class="source-code">
_logger = logging.getLogger(__name__)</pre></li>				<li>Modify the code of the <strong class="source-inline">export_stock_level()</strong> method, <span class="No-Break">as follows:</span><pre class="source-code">
@api.model
def export_stock_level(self, stock_location):
        _logger.info('export stock level for %s', stock_location.name)
        products = self.with_context(
             location=stock_location.id).search([])
        products = products.filtered('qty_available')
        _logger.debug('%d products in the location', len(products))
        fname = join(EXPORTS_DIR, 'stock_level.txt')
        try:
            with open(fname, 'w') as fobj:
                for prod in products:
                    fobj.write('%s\t%f\n' % (
                        prod.name, prod.qty_available))
        except IOError:
            _logger.exception(
                'Error while writing to %s in %s',
                'stock_level.txt', EXPORTS_DIR)
            raise exceptions.UserError('unable to save file')</pre></li>			</ol>
			<h2 id="_idParaDest-298"><a id="_idTextAnchor372"/>How it works...</h2>
			<p><em class="italic">Step 1</em> imports the <strong class="bold">logging</strong> module from <a id="_idIndexMarker425"/>the Python standard library. Odoo uses this module to manage <span class="No-Break">its logs.</span></p>
			<p><em class="italic">Step 2</em> sets up a logger for the Python module. We use the common idiom <strong class="source-inline">__name__ </strong>in Odoo as an automatic variable for the name of the logger and to call the logger <span class="No-Break">by </span><span class="No-Break"><strong class="source-inline">_logger</strong></span><span class="No-Break">.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">The <strong class="source-inline">__name__</strong><em class="italic"> </em>variable is set <a id="_idIndexMarker426"/>automatically by the Python interpreter at module-import time, and its value is the full name of the module. Since Odoo does a little trick with the imports, the add-on modules are seen by Python as belonging to the <strong class="source-inline">odoo.addons</strong> Python package. So, if the code of the recipe is in <strong class="source-inline">my_hostel/models/hostel.py</strong>, <strong class="source-inline">__name__</strong> will <span class="No-Break">be </span><span class="No-Break"><strong class="source-inline">odoo.addons.my_hostel.models.hostel</strong></span><span class="No-Break">.</span></p>
			<p>By doing this, we get <span class="No-Break">two benefits:</span></p>
			<ul>
				<li>The global <a id="_idIndexMarker427"/>logging configuration set <a id="_idIndexMarker428"/>on the <strong class="bold">odoo</strong> logger is applied to our logger because of the hierarchical structure of loggers in the <span class="No-Break"><strong class="bold">logging</strong></span><span class="No-Break"> module</span></li>
				<li>The logs will be prefixed with the full module path, which is a great help when trying to find where a given log line <span class="No-Break">is produced</span></li>
			</ul>
			<p><em class="italic">Step 3</em> uses the logger to produce log messages. The available methods for this are (by increasing log level) <strong class="bold">debug</strong>, <strong class="bold">info</strong>, <strong class="bold">warning</strong>, <strong class="bold">error</strong>, and <strong class="bold">critical</strong>. All these methods accept a message in which you can have <strong class="source-inline">%</strong> substitutions and additional arguments to be inserted into the message. You do not need to handle the <strong class="source-inline">%</strong> substitution yourself; the logging module is smart enough to perform this operation if the log has to be produced. If you are running with a log level of <strong class="bold">INFO</strong>, then <strong class="bold">DEBUG</strong> logs will avoid substitutions that will consume CPU resources in the <span class="No-Break">long run.</span></p>
			<p>Another <a id="_idIndexMarker429"/>useful method shown in this recipe is <strong class="source-inline">_logger.exception()</strong>, which can be used in an exception handler. The message will <a id="_idIndexMarker430"/>be logged with a level of <strong class="source-inline">ERROR</strong>, and the stack trace is also printed in the <span class="No-Break">application log.</span></p>
			<h2 id="_idParaDest-299"><a id="_idTextAnchor373"/>There’s more...</h2>
			<p>You can <a id="_idIndexMarker431"/>control the <strong class="bold">logging level</strong> of the application from the command line or from the configuration file. There are two main ways of <span class="No-Break">doing this:</span></p>
			<p>The first way is to use the <strong class="source-inline">--log-handler</strong> option. Its basic syntax is like this: <strong class="source-inline">--log-handler=prefix:level</strong>. In this case, the prefix is a piece of the path of the logger name, and the level is <strong class="bold">DEBUG</strong>, <strong class="bold">INFO</strong>, <strong class="bold">WARNING</strong>, <strong class="bold">ERROR</strong>, or <strong class="bold">CRITICAL</strong>. If you omit the prefix, you set the default level for all loggers. For instance, to set the logging level of <strong class="source-inline">my_hostel</strong> loggers to <strong class="bold">DEBUG</strong> and keep the default log level for the other add-ons, you can start Odoo <span class="No-Break">as follows:</span></p>
			<pre class="console">
$ python odoo.py --log-handler=odoo.addons.my_hostel:DEBUG</pre>			<p>It is possible to specify <strong class="source-inline">--log-handler</strong> multiple times on the command line. You can also configure the <strong class="bold">log handler</strong> in the configuration file of your Odoo instance. In that case, you can use a comma-separated list of <strong class="bold">prefix:level</strong> pairs. For example, the following line is the same configuration for a minimal logging output as before. We maintain the most important messages and the error messages by default, except for messages produced by <strong class="bold">werkzeug</strong>, for which we only want critical messages, and <strong class="source-inline">odoo.service.server</strong>, for which we keep info-level messages, including server <span class="No-Break">startup notifications:</span></p>
			<pre class="console">
log_handler = :ERROR,werkzeug:CRITICAL,odoo.service.server:INFO</pre>			<p>The second way is to use the <strong class="source-inline">--log-level</strong> option. To control the log level globally, you can use <strong class="source-inline">--log-level</strong> as the command-line option. Possible values for this option are <strong class="source-inline">critical</strong>, <strong class="source-inline">error</strong>, <strong class="source-inline">warn</strong>, <strong class="source-inline">debug</strong>, <strong class="source-inline">debug_rpc</strong>, <strong class="source-inline">debug_rpc_answer</strong>, <strong class="source-inline">debug_sql</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">test</strong></span><span class="No-Break">.</span></p>
			<p>There are <a id="_idIndexMarker432"/>some shortcuts for setting logging <a id="_idIndexMarker433"/>levels. Here is a list <span class="No-Break">of them:</span></p>
			<ul>
				<li><strong class="source-inline">--log-request</strong> is a shortcut <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">--log-handler=odoo.http.rpc.request:DEBUG</strong></span></li>
				<li><strong class="source-inline">--log-response</strong> is a shortcut <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">--log-handler=odoo.http.rpc.response:DEBUG</strong></span></li>
				<li><strong class="source-inline">--log-web</strong> is a shortcut <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">--log-handler=odoo.http:DEBUG</strong></span></li>
				<li><strong class="source-inline">--log-sql</strong> is a shortcut <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">--log-handler=odoo.sql_db:DEBUG</strong></span></li>
			</ul>
			<h1 id="_idParaDest-300"><a id="_idTextAnchor374"/>Using the Odoo shell to interactively call methods</h1>
			<p>The Odoo web interface is meant for end users, although the developer mode unlocks a number of <a id="_idIndexMarker434"/>powerful features. However, testing and debugging through the web interface is not the easiest way to do things, as you <a id="_idIndexMarker435"/>need to manually prepare the data, navigate in the menus to perform actions, and so on. The Odoo shell is a <strong class="bold">command-line interface</strong>, which <a id="_idIndexMarker436"/>you can use to issue calls. This recipe shows how to start the Odoo shell and perform actions such as calling a method inside <span class="No-Break">the shell.</span></p>
			<h2 id="_idParaDest-301"><a id="_idTextAnchor375"/>Getting ready</h2>
			<p>We will reuse the same code as in the previous recipe to produce server logs to help debug methods. This allows the <strong class="source-inline">product.product</strong> model to add a new method. We will assume that you have an instance with the add-on installed and available. In this recipe, we expect that you have an Odoo configuration file for this instance <span class="No-Break">called </span><span class="No-Break"><strong class="source-inline">project.conf</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-302"><a id="_idTextAnchor376"/>How to do it...</h2>
			<p>In order to call the <strong class="source-inline">export_stock_level()</strong> method from the Odoo shell, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Start the Odoo shell and specify your project <span class="No-Break">configuration file:</span><pre class="source-code">
<strong class="bold">    $ ./odoo-bin shell -c project.conf --log-level=error</strong></pre></li>				<li>Check for <a id="_idIndexMarker437"/>error messages and <a id="_idIndexMarker438"/>read the information text that’s displayed before the usual Python <span class="No-Break">command-line prompt:</span><pre class="source-code">
<strong class="bold">env: &lt;odoo.api.Environment object at 0x7f48cc0868c0&gt;</strong>
<strong class="bold">odoo: &lt;module 'odoo' from '/home/serpentcs/workspace/17.0/odoo/__init__.py'&gt;</strong>
<strong class="bold">openerp: &lt;module 'odoo' from '/home/serpentcs/workspace/17.0/odoo/__init__.py'&gt;</strong>
<strong class="bold">self: res.users(1,)</strong>
<strong class="bold">Python 3.10.13 (main, Aug 25 2023, 13:20:03) [GCC 9.4.0]</strong>
<strong class="bold">Type 'copyright', 'credits' or 'license' for more information</strong>
<strong class="bold">IPython 7.13.0 -- An enhanced Interactive Python. Type '?' for help.</strong></pre></li>				<li>Get a record set <span class="No-Break">for </span><span class="No-Break"><strong class="source-inline">product.product</strong></span><span class="No-Break">:</span><pre class="source-code">
    &gt;&gt;&gt; product = env['product.product']</pre></li>				<li>Get the main stock <span class="No-Break">location record:</span><pre class="source-code">
    &gt;&gt;&gt; location_stock = env.ref('stock.stock_location_stock')</pre></li>				<li>Call the <span class="No-Break"><strong class="source-inline">export_stock_level()</strong></span><span class="No-Break"> method:</span><pre class="source-code">
    &gt;&gt;&gt; product.export_stock_level(location_stock)</pre></li>				<li>Commit the transaction <span class="No-Break">before exiting:</span><pre class="source-code">
    &gt;&gt;&gt; env.cr.commit()</pre></li>				<li>Exit the shell by pressing <em class="italic">Ctrl + </em><span class="No-Break"><em class="italic">D</em></span><span class="No-Break">.</span></li>
			</ol>
			<h2 id="_idParaDest-303"><a id="_idTextAnchor377"/>How it works...</h2>
			<p><em class="italic">Step 1</em> uses <strong class="source-inline">odoo-bin shell</strong> to start the Odoo shell. All the usual command-line arguments are available. We use <strong class="source-inline">-c</strong> to specify a project configuration file and <strong class="source-inline">--log-level</strong> to reduce the verbosity of the logs. When debugging, you may want to have a logging level of <strong class="source-inline">DEBUG</strong> for some <span class="No-Break">specific add-ons.</span></p>
			<p>Before <a id="_idIndexMarker439"/>providing you with a Python <a id="_idIndexMarker440"/>command-line prompt, <strong class="source-inline">odoo-bin shell</strong> starts an Odoo instance that does not listen on the network and initializes some global variables, which are mentioned in <span class="No-Break">the output:</span></p>
			<ul>
				<li><strong class="source-inline">env</strong> is an environment that’s connected to the database and specified on the command line or in the <span class="No-Break">configuration file.</span></li>
				<li><strong class="source-inline">odoo</strong> is the <strong class="source-inline">odoo</strong> package that’s imported for you. You get access to all the Python modules within that package to do what <span class="No-Break">you want.</span></li>
				<li><strong class="source-inline">openerp</strong> is an alias for the <strong class="source-inline">odoo</strong> package for <span class="No-Break">backward compatibility.</span></li>
				<li><strong class="source-inline">self</strong> is a record set of <strong class="source-inline">res.users</strong> that contains a single record for the Odoo superuser (administrator), which is linked to the <span class="No-Break"><strong class="source-inline">env</strong></span><span class="No-Break"> environment.</span></li>
			</ul>
			<p><em class="italic">Steps 3</em> and <em class="italic">4</em> use <strong class="source-inline">env</strong> to get an empty record set and find a record according to the XML ID. <em class="italic">Step 5</em> calls the method on the <strong class="source-inline">product.product</strong> record set. These operations are identical to what you would use inside a method, with a minor difference being that we use <strong class="source-inline">env</strong> and not <strong class="source-inline">self.env</strong> (although we can have both, as they are identical). Take a look at <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, for more information on what <span class="No-Break">is available.</span></p>
			<p><em class="italic">Step 6</em> commits the database transaction. This is not strictly necessary here because we did not modify any record in the database, but if we had done so and wanted these changes to persist, this is necessary; when you use Odoo through the web interface, each RPC call runs in its own database transaction, and Odoo manages these for you. When running in shell mode, this no longer happens and you have to call <strong class="source-inline">env.cr.commit()</strong> or <strong class="source-inline">env.cr.rollback()</strong> yourself. Otherwise, when you exit the shell, any transaction in progress is automatically rolled back. When testing, this is fine, but if you use the shell, for example, to script the configuration of an instance, don’t forget to commit <span class="No-Break">your work!</span></p>
			<h2 id="_idParaDest-304"><a id="_idTextAnchor378"/>There’s more...</h2>
			<p>In shell mode, by <a id="_idIndexMarker441"/>default, Odoo opens <a id="_idIndexMarker442"/>Python’s REPL shell interface. You can use the REPL of your choice using the <strong class="source-inline">--shell-interface</strong> option. The supported REPLs are <strong class="source-inline">ipython</strong>, <strong class="source-inline">ptpython</strong>, <strong class="source-inline">bpython</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">python</strong></span><span class="No-Break">:</span></p>
			<pre class="console">
$ ./odoo-bin shell -c project.conf  --shell-interface=ptpython</pre>			<h1 id="_idParaDest-305"><a id="_idTextAnchor379"/>Using the Python debugger to trace method execution</h1>
			<p>Sometimes, application logs are not enough to figure out what is going wrong. Fortunately, we <a id="_idIndexMarker443"/>also have the Python <a id="_idIndexMarker444"/>debugger. This recipe shows us how to insert a breakpoint in a method and trace the execution <span class="No-Break">by hand.</span></p>
			<h2 id="_idParaDest-306"><a id="_idTextAnchor380"/>Getting ready</h2>
			<p>We will reuse the <strong class="source-inline">export_stock_level()</strong> method that was shown in the <em class="italic">Using the Odoo shell to interactively call methods</em> recipe of this chapter. Ensure that you have a copy <span class="No-Break">to hand.</span></p>
			<h2 id="_idParaDest-307"><a id="_idTextAnchor381"/>How to do it...</h2>
			<p>To trace the execution of <strong class="source-inline">export_stock_level()</strong> with <strong class="source-inline">pdb</strong>, perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Edit the code of the method, and insert the line <span class="No-Break">highlighted here:</span><pre class="source-code">
def export_stock_level(self, stock_location):
    import pdb; pdb.set_trace()
    products = self.with_context( location=stock_location.id ).search([])
    fname = join(EXPORTS_DIR, 'stock_level.txt')
    try:
        with open(fname, 'w') as fobj:
            for prod in products.filtered('qty_available'):
                fobj.write('%s\t%f\n' % (prod.name, prod.qty_available))
    except IOError:
         raise exceptions.UserError('unable to save file')</pre></li>				<li>Run the <a id="_idIndexMarker445"/>method. We will use <a id="_idIndexMarker446"/>the Odoo shell, as explained in the <em class="italic">Using the Odoo shell to interactively call </em><span class="No-Break"><em class="italic">methods</em></span><span class="No-Break"> recipe:</span><pre class="source-code">
$ ./odoo-bin shell -c project.cfg --log-level=error
    [...]
    &gt;&gt;&gt; product = env['product.product']
    &gt;&gt;&gt; location_stock = env.ref('stock.stock_location_stock')
    &gt;&gt;&gt; product.export_stock_level(location_stock)
    &gt; /home/cookbook/stock_level/models.py(18)export_stock_level()
    -&gt; products = self.with_context(
    (Pdb)</pre></li>				<li>At the <strong class="source-inline">(Pdb)</strong> prompt, issue the <strong class="source-inline">args</strong> command (the shortcut for which is <strong class="source-inline">a</strong>) to get the values of the arguments that were passed to <span class="No-Break">the method:</span><pre class="source-code">
(Pdb) a
self = product.product()
stock_location = stock.location(14,)</pre></li>				<li>Enter the <strong class="source-inline">list</strong> command <a id="_idIndexMarker447"/>to check where in the code you <span class="No-Break">are standing:</span><pre class="source-code">
(Pdb) list
13       @api.model
14       def export_stock_level(self, stock_location):
15       _logger.info('export stock level for %s',
16                    stock_location.name)
17       import pdb; pdb.set_trace()
18 -&gt;    products = self.with_context(
19       location=stock_location.id).search([])
20       products = products.filtered('qty_available')
21       _logger.debug('%d products in the location',
22                     len(products))
23       fname = join(EXPORTS_DIR, 'stock_level.txt')
(Pdb)</pre></li>				<li>Enter the <strong class="source-inline">next</strong> command three times to walk through the first lines of the method. You <a id="_idIndexMarker448"/>may also use <strong class="source-inline">n</strong>, which is <span class="No-Break">a shortcut:</span><pre class="source-code">
(Pdb) next
&gt; /home/cookbook/stock_level/models.py(19)export_stock_level()
-&gt; location=stock_location.id).search([])
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(20)export_stock_level()
-&gt; products = products.filtered('qty_available')
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(21)export_stock_level()
-&gt; _logger.debug('%d products in the location',
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(22)export_stock_level()
-&gt; len(products))
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(23)export_stock_level()
-&gt; fname = join(EXPORTS_DIR, 'stock_level.txt')
(Pdb) n
&gt; /home/cookbook/stock_level/models.py(24)export_stock_level()
-&gt; try:</pre></li>				<li>Use the <strong class="source-inline">p</strong> command <a id="_idIndexMarker449"/>to display the <a id="_idIndexMarker450"/>values of the <strong class="source-inline">products</strong> and <span class="No-Break"><strong class="source-inline">fname</strong></span><span class="No-Break"> variables:</span><pre class="source-code">
(Pdb) p products
product.product(32, 14, 17, 19, 21, 22, 23, 29, 34, 33, 26, 27, 42)
(Pdb) p fname
'/srv/exports/stock_level.txt'</pre></li>				<li>Change the value of <strong class="source-inline">fname</strong> to point to the <strong class="source-inline">/</strong><span class="No-Break"><strong class="source-inline">tmp</strong></span><span class="No-Break"> directory:</span><pre class="source-code">
(Pdb) !fname = '/tmp/stock_level.txt'</pre></li>				<li>Use the <strong class="source-inline">return</strong> (shortcut: <strong class="source-inline">r</strong>) command to execute the <span class="No-Break">current function:</span><pre class="source-code">
(Pdb) return
--Return--
&gt; /home/cookbook/stock_level/models.py(26)export_stock_level()-&gt;None
-&gt; for product in products:</pre></li>				<li>Use the <strong class="source-inline">cont</strong> (shortcut: <strong class="source-inline">c</strong>) command to resume the execution of <span class="No-Break">the program:</span><pre class="source-code">
(Pdb) c
&gt;&gt;&gt;</pre></li>			</ol>
			<h2 id="_idParaDest-308"><a id="_idTextAnchor382"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we hardcoded a breakpoint in the source code of the method by calling the <strong class="source-inline">set_trace()</strong> method of the <strong class="source-inline">pdb</strong> module from the Python standard library. When this <a id="_idIndexMarker451"/>method is executed, the <a id="_idIndexMarker452"/>normal flow of the program stops, and you get a <strong class="source-inline">(Pdb)</strong> prompt into which you can enter <span class="No-Break"><strong class="source-inline">pdb</strong></span><span class="No-Break"> commands.</span></p>
			<p><em class="italic">Step 2</em> calls the <strong class="source-inline">stock_level_export()</strong> method using shell mode. It is also possible to restart the server normally and use the web interface to generate a call to the method you need to trace by clicking on the appropriate elements of the <span class="No-Break">user interface.</span></p>
			<p>When you need to manually step through some code using the Python debugger, here are a few tips that will make your <span class="No-Break">life easier:</span></p>
			<ul>
				<li>Reduce the logging level to avoid having too many log lines, which pollutes the output of the debugger. Starting at the <strong class="source-inline">ERROR</strong> level is generally fine. You may want to enable some specific loggers with a higher verbosity, which you can do using the <strong class="source-inline">--log-handler</strong> command-line option (refer to the <em class="italic">Producing server logs to help debug </em><span class="No-Break"><em class="italic">methods</em></span><span class="No-Break"> recipe).</span></li>
				<li>Run the server with <strong class="source-inline">--workers=0</strong> to avoid any multiprocessing issues that can cause the same breakpoint to be reached twice in two <span class="No-Break">different processes.</span></li>
				<li>Run the server with <strong class="source-inline">--max-cron-threads=0</strong> to disable the processing of the <strong class="source-inline">ir.cron</strong> periodic tasks, which may otherwise trigger while you are stepping through the method, which produces unwanted logs and <span class="No-Break">side effects.</span></li>
			</ul>
			<p><em class="italic">Steps 3</em> to <em class="italic">8</em> use several <strong class="source-inline">pdb</strong> commands to step through the execution of the method. Here’s a summary <a id="_idIndexMarker453"/>of the main <a id="_idIndexMarker454"/>commands of <strong class="source-inline">pdb</strong>. Most of these are also available using the first letter as a shortcut. We indicate this in the following list by having the optional letters <span class="No-Break">between parentheses:</span></p>
			<ul>
				<li><strong class="source-inline">h(elp)</strong>: This displays help with the <span class="No-Break"><strong class="source-inline">pdb</strong></span><span class="No-Break"> commands.</span></li>
				<li><strong class="source-inline">a(rgs)</strong>: This shows the value of the arguments of the <span class="No-Break">current function/methods.</span></li>
				<li><strong class="source-inline">l(ist)</strong>: This displays the source code being executed in chunks of 11 lines, initially centered on the current line. Successive calls will move further in the source code file. Optionally, you can pass two integers at the start and end, which specify the region <span class="No-Break">to display.</span></li>
				<li><strong class="source-inline">p</strong>: This prints <span class="No-Break">a variable.</span></li>
				<li><strong class="source-inline">pp</strong>: This pretty-prints a variable (useful with lists <span class="No-Break">and dictionaries).</span></li>
				<li><strong class="source-inline">w(here)</strong>: This shows the call stack, with the current line at the bottom and the Python interpreter at <span class="No-Break">the top.</span></li>
				<li><strong class="source-inline">u(p)</strong>: This moves up one level in the <span class="No-Break">call stack.</span></li>
				<li><strong class="source-inline">d(own)</strong>: This moves down one level in the <span class="No-Break">call stack.</span></li>
				<li><strong class="source-inline">n(ext)</strong>: This executes the current line of code and <span class="No-Break">then stops.</span></li>
				<li><strong class="source-inline">s(tep)</strong>: This is to step inside the execution of a <span class="No-Break">method call.</span></li>
				<li><strong class="source-inline">r(eturn)</strong>: This resumes the execution of the current method until <span class="No-Break">it returns.</span></li>
				<li><strong class="source-inline">c(ont(inue))</strong>: This resumes the execution of the program until the next breakpoint <span class="No-Break">is hit.</span></li>
				<li><strong class="source-inline">b(reak) &lt;args&gt;</strong>: This <a id="_idIndexMarker455"/>creates a new breakpoint and displays its identifier; <strong class="source-inline">args</strong> can be one of <span class="No-Break">the following:</span><ul><li><strong class="source-inline">&lt;empty&gt;</strong>: This lists <span class="No-Break">all breakpoints.</span></li><li><strong class="source-inline">line_number</strong>: This <a id="_idIndexMarker456"/>breaks at the specified line in the <span class="No-Break">current file.</span></li><li><strong class="source-inline">filename:line_number</strong>: This breaks at the specified line of the specified file (which is searched for in the directories <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">sys.path</strong></span><span class="No-Break">).</span></li><li><strong class="source-inline">function_name</strong>: This breaks at the first line of the <span class="No-Break">specified function.</span></li><li><strong class="source-inline">tbreak &lt;args&gt;</strong>: This is similar to break, but the breakpoint will be canceled after it has been reached, so successive execution of the line won’t trigger <span class="No-Break">it twice.</span></li><li><strong class="source-inline">disable bp_id</strong>: This disables a breakpoint <span class="No-Break">by ID.</span></li><li><strong class="source-inline">enable bl_id</strong>: This enables a disabled breakpoint <span class="No-Break">by ID.</span></li></ul></li>
				<li><strong class="source-inline">j(ump) lineno</strong>: The next line to execute will be the one specified. This can be used to rerun or skip <span class="No-Break">some lines.</span></li>
				<li><strong class="source-inline">(!) statement</strong>: This executes a Python statement. The <strong class="source-inline">!</strong> character can be omitted if the command does not look like a <strong class="source-inline">pdb</strong> command. For instance, you need it if you want to set the value of a variable named <strong class="source-inline">a</strong>, because <strong class="source-inline">a</strong> is the shortcut for the <span class="No-Break"><strong class="source-inline">args</strong></span><span class="No-Break"> command.</span></li>
			</ul>
			<h2 id="_idParaDest-309"><a id="_idTextAnchor383"/>There’s more...</h2>
			<p>In the recipe, we <a id="_idIndexMarker457"/>inserted a <strong class="source-inline">pdb.set_trace()</strong> statement to break into <strong class="source-inline">pdb</strong> for debugging. We can also start <strong class="source-inline">pdb</strong> directly from within the Odoo shell, which is very useful when you cannot easily modify the code of the project using <strong class="source-inline">pdb.runcall()</strong>. This function takes a method as the first argument and the arguments to pass to the function as the next argument. So, inside the Odoo shell, you do <span class="No-Break">the following:</span></p>
			<pre class="console">
&gt;&gt;&gt; import pdb
&gt;&gt;&gt; product = env['product.product']
&gt;&gt;&gt; location_stock = env.ref('stock.stock_location_stock')
&gt;&gt;&gt; pdb.runcall(product.export_stock_level, location_stock)
&gt; /home/cookbook/stock_level/models.py(16)export_stock_level()
-&gt; products = self.with_context((Pdb)</pre>			<p>In this recipe, we focused on the Python debugger from the Python standard library, <strong class="source-inline">pdb</strong>. It is very useful to know about this tool because it is guaranteed to be available on any Python distribution. There are other Python debuggers available, such as <strong class="source-inline">ipdb</strong> (<a href="https://pypi.python.org/pypi/ipdb">https://pypi.python.org/pypi/ipdb</a>) and <strong class="source-inline">pudb</strong> (<a href="https://pypi.python.org/pypi/pudb">https://pypi.python.org/pypi/pudb</a>), which can be used as drop-in replacements for <strong class="source-inline">pdb</strong>. They share the same API, and most of the commands that you saw in this recipe were unchanged. Also, of course, if you develop for Odoo using a Python IDE, you will have access to a debugger that was integrated <span class="No-Break">with it.</span></p>
			<h2 id="_idParaDest-310"><a id="_idTextAnchor384"/>See also</h2>
			<p>If you want to learn more about the <strong class="source-inline">pdb</strong> debugger, refer to the full documentation of <strong class="source-inline">pdb</strong> <span class="No-Break">at </span><a href="https://docs.python.org/3.9/library/pdb.html"><span class="No-Break">https://docs.python.org/3.9/library/pdb.html</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-311"><a id="_idTextAnchor385"/>Understanding the debug mode options</h1>
			<p>In <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment</em>, we saw how to enable debug/developer options in Odoo. These options are very helpful in debugging and reveal some <a id="_idIndexMarker458"/>further technical information. In this recipe, we will look at these options <span class="No-Break">in detail.</span></p>
			<h2 id="_idParaDest-312"><a id="_idTextAnchor386"/>How to do it...</h2>
			<p>Check the <em class="italic">Activating the Odoo developer tools</em> recipe of <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment</em>, and activate developer mode. After activating developer mode, you will see a drop-down menu with a bug icon in the top bar, as <span class="No-Break">shown here:</span></p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="image/B20997_07_1.jpg" alt="Figure 7.1 – Available options after activating debug mode"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Available options after activating debug mode</p>
			<p>In this menu, you will <a id="_idIndexMarker459"/>see various options. Give them a go to see them in action. The next section will explain these options in <span class="No-Break">more detail.</span></p>
			<h2 id="_idParaDest-313"><a id="_idTextAnchor387"/>How it works...</h2>
			<p>Let’s learn more about the options in the <span class="No-Break">following points:</span></p>
			<ul>
				<li><strong class="bold">Run JS Tests</strong>: This <a id="_idIndexMarker460"/>option will redirect you to the JavaScript QUnit test case page, as shown in the following screenshot. It will start running all test cases one by one. Here, you can see the progress and the status of the test cases. In <a href="B20997_18.xhtml#_idTextAnchor990"><span class="No-Break"><em class="italic">Chapter 18</em></span></a>, <em class="italic">Automated Test Cases</em>, we will see <a id="_idIndexMarker461"/>how can we create our own QUnit JavaScript <span class="No-Break">test cases:</span></li>
			</ul>
			<div>
				<div id="_idContainer050" class="IMG---Figure">
					<img src="image/B20997_07_2.jpg" alt="Figure 7.2 – QUnit test case result screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – QUnit test case result screen</p>
			<ul>
				<li><strong class="bold">Run JS Mobile Tests</strong>: Similar to the preceding option, but this one runs a QUnit <a id="_idIndexMarker462"/>test case for a <span class="No-Break">mobile environment.</span></li>
				<li><strong class="bold">Run Click Anywhere Tests</strong>: This option will start clicking on all menus one by one. It will <a id="_idIndexMarker463"/>click in all the views and search filters. If something is broken or there is any regression, it will show the tracebacks. To stop this test, you will need to reload <span class="No-Break">the page.</span></li>
				<li><strong class="bold">Open View</strong>: This option <a id="_idIndexMarker464"/>will open a list of all available views. By selecting any of them, you can open that view without defining any menus <span class="No-Break">or actions.</span></li>
				<li><strong class="bold">Disable Tours</strong>: Odoo uses <a id="_idIndexMarker465"/>tours to improve the onboarding of new users. If you want to disable it, you can do it by using <span class="No-Break">this option.</span></li>
				<li><strong class="bold">Start Tour</strong>: Odoo also <a id="_idIndexMarker466"/>uses tours for automated testing. We will create a custom onboarding tour in <a href="B20997_15.xhtml#_idTextAnchor861"><span class="No-Break"><em class="italic">Chapter 15</em></span></a>, <em class="italic">Web Client Development</em>. This option will open a dialog box with a list of all tours, as shown in the following screenshot. By clicking on the play button next to a tour, Odoo will automatically perform all the steps of <span class="No-Break">the tour:</span></li>
			</ul>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/B20997_07_3.jpg" alt="Figure 7.3 – Dialog to manually launch tours"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Dialog to manually launch tours</p>
			<ul>
				<li><strong class="bold">Edit Action</strong>: In the <em class="italic">Adding menu items and views</em> recipe of <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>, we added a menu item and an action to open views <a id="_idIndexMarker467"/>in Odoo. Details of these actions are also stored in the database as a record. This option will open the record details of the action we open to display the <span class="No-Break">current view.</span></li>
				<li><strong class="bold">View Fields</strong>: This option is used when you want to see the details of fields from the user <a id="_idIndexMarker468"/>interface. It will show a list of fields for the current model. For example, if you open a tree or form view for a <strong class="source-inline">hostel.hostel</strong> model, this option will show a list of fields for the <span class="No-Break"><strong class="source-inline">hostel.hostel</strong></span><span class="No-Break"> model.</span></li>
				<li><strong class="bold">Manage Filters</strong>: In Odoo, users can create custom filters from the search view. This option will <a id="_idIndexMarker469"/>open a list of custom filters for the current model. Here, you can modify the <span class="No-Break">custom filters.</span></li>
				<li><strong class="bold">Technical Translations</strong>: This option will open a list of translated terms for the current <a id="_idIndexMarker470"/>model. You can modify the technical translation terms for your model from here. You can refer to <a href="B20997_11.xhtml#_idTextAnchor595"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, <em class="italic">Internationalization,</em> to learn more <span class="No-Break">about translations.</span></li>
				<li><strong class="bold">View Access Rights</strong>: This <a id="_idIndexMarker471"/>option will show a list of security access rights for the <span class="No-Break">current model.</span></li>
				<li><strong class="bold">View Record Rules</strong>: This <a id="_idIndexMarker472"/>option will show a list of security record rules for the <span class="No-Break">current model.</span></li>
				<li><strong class="bold">Fields View Get</strong>: You can extend and modify an existing view from other add-on modules. In some <a id="_idIndexMarker473"/>applications, these views are inherited by several add-on modules. Because of this, it is very difficult to get a clear idea of the whole view definition. With this option, you will get the final view definition after applying all view inheritances. Internally, it uses the <span class="No-Break"><strong class="source-inline">fields_view_get()</strong></span><span class="No-Break"> method.</span></li>
				<li><strong class="bold">Edit View: &lt;view type&gt;</strong>: This option will open the dialog with the <strong class="source-inline">ir.ui.view</strong> record of the current view. This option is dynamic and it will show an <a id="_idIndexMarker474"/>option based on the view that is currently open. This means that if you open <strong class="bold">Kanban View</strong>, you will get an <strong class="bold">Edit View: Kanban</strong> option, and if you open <strong class="bold">Form View</strong>, you will get an <strong class="bold">Edit View: </strong><span class="No-Break"><strong class="bold">Form</strong></span><span class="No-Break"> option.</span></li>
			</ul>
			<p class="callout-heading">Important tip</p>
			<p class="callout">You can modify the view definition from the <strong class="bold">Edit View</strong> option. This updated definition will be applicable on the current database and these changes will be removed when you update the module. It’s therefore better to modify views <span class="No-Break">from modules.</span></p>
			<ul>
				<li><strong class="bold">Edit ControlPanelView</strong>: This <a id="_idIndexMarker475"/>option is the same as the preceding one, but it will open the <strong class="source-inline">ir.ui.view</strong> record of the current model’s <span class="No-Break">search view.</span></li>
				<li><strong class="bold">Activate Assets Debugging</strong>: Odoo provides two types of developer mode: <em class="italic">Developer mode</em> and <em class="italic">Developer mode with assets</em>. With this option, you can <a id="_idIndexMarker476"/>switch from <em class="italic">Developer</em> mode to <em class="italic">Developer mode with assets</em> mode. Check the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment,</em> for <span class="No-Break">more details.</span></li>
				<li><strong class="bold">Activate Test Assets Debugging</strong>: As we know, Odoo uses tours for testing. Enabling <a id="_idIndexMarker477"/>this mode will load test assets in Odoo. This option will show some more tours in the <strong class="bold">Start </strong><span class="No-Break"><strong class="bold">tour</strong></span><span class="No-Break"> dialog.</span></li>
				<li><strong class="bold">Regenerate Assets Bundles</strong>: Odoo manages all CSS and JavaScript through asset <a id="_idIndexMarker478"/>bundles. This option deletes the old JavaScript and CSS assets and generates new ones. This option is helpful when you are getting issues because of asset caching. We will learn more about asset bundles in <a href="B20997_14.xhtml#_idTextAnchor734"><span class="No-Break"><em class="italic">Chapter 14</em></span></a>, <em class="italic">CMS </em><span class="No-Break"><em class="italic">Website Development.</em></span></li>
				<li><strong class="bold">Become Super User</strong>: This is a new option added from version 12. By activating this <a id="_idIndexMarker479"/>option, you switch to a super user. You can access the records even if you don’t have access rights. This option is not available for all users; it is only available for users who have <strong class="bold">Administration: settings</strong> access rights. After activating this mode, you will see a striped top menu, as <span class="No-Break">shown here:</span></li>
			</ul>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="image/B20997_07_4.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<div>
				<div id="_idContainer053" class="IMG---Figure">
					<img src="image/B20997_07_5.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Menu after activating a super user</p>
			<ul>
				<li><strong class="bold">Leave Developer Tools</strong>: This <a id="_idIndexMarker480"/>option allows you to leave <span class="No-Break">developer mode.</span></li>
			</ul>
			<p>We have seen all of the options that are available under the debug menu. These options can be used in several ways, such as debugging, testing, and fixing issues. They can also be used to explore the source code <span class="No-Break">for views.</span></p>
		</div>
	</body></html>