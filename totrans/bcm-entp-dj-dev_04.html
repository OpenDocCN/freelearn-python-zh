<html><head></head><body>
		<div id="_idContainer048">
			<h1 id="_idParaDest-68"><em class="italic"><a id="_idTextAnchor077"/>Chapter 3</em>: Models, Relations, and Inheritance</h1>
			<p><strong class="bold">Models</strong> represent tables, also known<a id="_idIndexMarker338"/> as objects, within a database. Django<a id="_idIndexMarker339"/> provides a simple way to map objects to a project's underlying database(s). We will use this mapping system to work with other components of Django in later chapters of this book, such as a template, view, or form, to name a few. Anything that relies on accessing data from within a database will rely on the models that we create. If a project connects to an external database system or the project uses an API to interact with data, then there is no need to create any models in that situation.</p>
			<p>In this chapter, we will cover the following:</p>
			<ul>
				<li>Writing model classes to create database tables</li>
				<li>Using standard field types and third-party field types</li>
				<li>Configuring field validators</li>
				<li>Linking tables through field relationships</li>
				<li>Working with model meta classes and options</li>
				<li>Using model methods and method decorators</li>
				<li>Practicing extending models</li>
				<li>Introducing using the Django shell as a tool to perform queries and add data</li>
				<li>Creating a model manager to format and control data</li>
			</ul>
			<h1 id="_idParaDest-69"><a id="_idTextAnchor078"/>Technical requirements</h1>
			<p>To work with the code in this chapter, the following tools will need to be installed on your local machine: </p>
			<ul>
				<li>Python version 3.9 – used as the underlying programming language for the project</li>
				<li>Django version 4.0 – used as the backend framework of the project</li>
				<li>pip package manager – used to manage third-party Python/Django packages</li>
			</ul>
			<p>We will continue to work with the solution created in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>. However, it is not necessary to use the Visual Studio IDE. The main project itself can be run using another IDE or independently using a terminal or command-line window from within the project root folder. This is where the <strong class="source-inline">manage.py</strong> file resides. Whatever editor or IDE you are using, a virtual environment will also be needed to work with the Django project. Instructions for how to create a project and virtual environment can be found in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>. You will need a database to store the data contained in your project. PostgreSQL was chosen for the examples in the previous chapter; however, any database type that you choose for your project can be used to work with the examples in this chapter.</p>
			<p>All of the code created in this chapter can be found in the GitHub repository for this book: <a href="https://github.com/PacktPublishing/Becoming-an-Enterprise-Django-Developer">https://github.com/PacktPublishing/Becoming-an-Enterprise-Django-Developer</a>. The bulk of the code depicted in this chapter can be found in the <strong class="source-inline">/becoming_a_django_entdev/becoming_a_django_entdev/chapter_3/</strong> directory.</p>
			<p>Check out the following video to see the <em class="italic">Code in Action</em>: <a href="https://bit.ly/3zZ68RS">https://bit.ly/3zZ68RS</a></p>
			<h1 id="_idParaDest-70"><a id="_idTextAnchor079"/>Preparing for this chapter</h1>
			<p>Start by creating a new app in your project called <strong class="source-inline">chapter_3</strong> by following the steps discussed in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>, under the subsection titled <em class="italic">Creating a Django app</em>. As discussed in that section, don't forget to change the value of the <strong class="source-inline">name =</strong> variable for your app class found in the <strong class="source-inline">/becoming_a_django_entdev/becoming_a_django_entdev/chapter_3/apps.py</strong> file to now point to the path where you installed your app. Be sure to also include this app in your <strong class="source-inline">INSTALLED_APPS</strong> variable found in the <strong class="source-inline">settings.py</strong> file as well.</p>
			<h1 id="_idParaDest-71"><a id="_idTextAnchor080"/>Writing model classes</h1>
			<p>Each model in your project represents<a id="_idIndexMarker340"/> a table within your database. The fields that are created in those models all relate<a id="_idIndexMarker341"/> to columns within that table. Django provides a technique called <strong class="bold">Object-Relational Mapping</strong> (<strong class="bold">ORM</strong>) to map models to the underlying database(s) that are configured in the <strong class="source-inline">settings.py</strong> file of a project. The ORM technique is a process used to convert data between two systems of incompatible data types. This means that Django<a id="_idIndexMarker342"/> takes the headache out of working directly with <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>) to perform queries. The Django ORM irons out odd differences between the various database types when interpreting SQL, making it a universal tool for working with all data structures. Now, you and your developers can focus more on developing and less on the headaches involved. Django does not require the use of SQL as a standard writing practice. However, if you want or need to, Django does provide a way to use basic SQL when performing query operations.</p>
			<p>Next, imagine we are building a site that allows a user to view a page providing details about a specific car, commonly<a id="_idIndexMarker343"/> referred to as a detail page/view. Let's say we are building a basic site just to store and look up details about cars that are listed for sale. A user could do this for a number of reasons; perhaps they are renting, buying, leasing, or selling a car. In any scenario, we would need a table that represents a vehicle object, another table for the model of the vehicle (not to be confused with a Django model), and another table for the engine type. In a real-world scenario, your project may consist of many other tables and the structure of these tables may also differ in many ways. In this particular exercise, we won't create a model for the manufacturer, also known as the make of a vehicle. The manufacturer will be created as a set in order to demonstrate certain concepts for educational purposes:</p>
			<ol>
				<li>Inside the <strong class="source-inline">models.py</strong> file of the <strong class="source-inline">chapter_3</strong> directory that was just created, write three empty classes, one for each of the tables related to our vehicle exercise, following this example:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong></p><p class="source-code">from django.db import <strong class="bold">models</strong></p><p class="source-code"><strong class="bold">class Vehicle(models.Model):</strong></p><p class="source-code">    <strong class="bold">pass</strong></p></li>
				<li>Create one class each for <strong class="source-inline">Vehicle</strong>, <strong class="source-inline">VehicleModel</strong>, and <strong class="source-inline">Engine</strong>. We will name the class<a id="_idIndexMarker344"/> pertaining to a model of a vehicle as <strong class="source-inline">VehicleModel</strong> instead of <strong class="source-inline">Model</strong> in order to prevent confusion as we work through each exercise.<p class="callout-heading">Tip</p><p class="callout">In the preceding example, three classes were created that do absolutely nothing at this time by writing the <strong class="source-inline">pass</strong> statement directly in them. This is a tool to add to your toolbox for writing skeleton code and allowing other components to continue to function while you write. Python will give you errors if nothing is placed in a class and when you are ready to write code for that class, remove the <strong class="source-inline">pass</strong> statement and replace it with your actual code.</p></li>
			</ol>
			<p>The names given to model classes can be almost anything you would like, but they cannot be any of the reserved Python keywords, such as <strong class="source-inline">True</strong>, <strong class="source-inline">False</strong>, <strong class="source-inline">class</strong>, <strong class="source-inline">pass</strong>, and <strong class="source-inline">import</strong>. Name your classes anything that makes sense when you are using them elsewhere in your code. You can use uppercase or lowercase letters, but when Django creates your tables, the names will always be lowercase. This is why it is unacceptable to name two different classes the same name with different letter casings. For example, if we named two classes <strong class="source-inline">class Vehicle</strong> and <strong class="source-inline">class vehicle</strong>, Django would then tell us we have the following <strong class="source-inline">RuntimeError</strong> when attempting to make migrations:</p>
			<p class="source-code">RuntimeError: Conflicting 'vehicle' models in application 'chapter_3':</p>
			<p>This is why it is better to adopt a writing style that uses one or the other letter casing and stick with that pattern throughout your project.</p>
			<p>Let's discuss the various field types that exist and see which ones we can use for our vehicle exercises.</p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor081"/>Standard field types</h2>
			<p>Right out of the<a id="_idIndexMarker345"/> box, Django offers numerous <strong class="bold">Standard Field Types</strong> to choose from. The following tables<a id="_idIndexMarker346"/> can be used as cheat sheets when writing your models:</p>
			<div>
				<div id="_idContainer039" class="IMG---Figure">
					<img src="image/B17243_03_Table1.jpg" alt=""/>
				</div>
			</div>
			<p class="figure-caption"><img src="image/B17243_03_Table2.png" alt=""/></p>
			<p>For a complete breakdown<a id="_idIndexMarker347"/> of all of the field types<a id="_idIndexMarker348"/> to choose from, you can<a id="_idIndexMarker349"/> visit the official Django documentation on field types here: <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/">https://docs.djangoproject.com/en/4.0/ref/models/fields/</a>.</p>
			<h3>Field arguments</h3>
			<p>Every field class will accept <strong class="bold">arguments</strong>, also known as <strong class="bold">field options</strong>. They customize the<a id="_idIndexMarker350"/> behavior, or rather<a id="_idIndexMarker351"/> the field <a id="_idIndexMarker352"/>constraints, that are being created. <strong class="bold">Field constraints</strong> are the rules enforced<a id="_idIndexMarker353"/> on the data within your<a id="_idIndexMarker354"/> tables. In the code we will soon write, we will be using the <strong class="source-inline">verbose_name</strong>, <strong class="source-inline">blank</strong>, and <strong class="source-inline">null</strong> arguments on our fields quite often. <strong class="source-inline">verbose_name</strong> will specify the human-readable name for a field. We should specify a <strong class="source-inline">max_length</strong> argument for any <strong class="source-inline">CharField</strong> instances that we use, to limit the character length of that field. Without setting a <strong class="source-inline">max_length</strong> argument, the character length limit is theoretically unlimited. However, you are limited by the physical restrictions of the database that you are using; the limit would then be several thousand or hundreds of thousands of characters instead of the literal infinite limit. The <strong class="source-inline">null</strong> and <strong class="source-inline">blank</strong> arguments are almost considered the same thing, except that the <strong class="source-inline">null</strong> argument says that the database can store a null value for any empty records. The <strong class="source-inline">blank</strong> argument is related to validation performed on that field, at the database level, to check whether a user attempted to enter a null value when saving or creating that record in the database. </p>
			<p>A <strong class="source-inline">default</strong> argument will be used to assign a value to a field by default, should a value not be provided at the time an object is created or updated. Default values are used in circumstances where, say, data is being migrated into your database from an outside source, with data that isn't in synchronization with the constraints set on your tables. For example, if you had a field argument set to <strong class="source-inline">null=False</strong> and you imported data that contained a null value, errors would likely result. Say you had a <strong class="source-inline">BooleanField</strong> with the <strong class="source-inline">default=True</strong>/<strong class="source-inline">False</strong> argument, and then performed the same data import; then, all those null values would be converted to <strong class="source-inline">True</strong>/<strong class="source-inline">False</strong> automatically during your import. A <strong class="source-inline">default</strong> argument can be applied to virtually every field type. </p>
			<p>The <strong class="source-inline">choices</strong> argument allows us to pass in a predefined set of choices that contain a value and a human-readable interpretation<a id="_idIndexMarker355"/> of that value. Choices<a id="_idIndexMarker356"/> can be used on <strong class="source-inline">CharField</strong> and <strong class="source-inline">BooleanField</strong> instances, as well as a handful of other field types. They can be made into a drop-down select box or be used in a collection of checkboxes or radio buttons. The <strong class="source-inline">choices</strong> argument accepts a list of tuples, where each tuple consists of the first element being the value of the field and the second element being the human-readable string representation of that value. For this exercise, we will be converting the human-interpreted <em class="italic">yes/no</em> choices into a computer-interpreted <em class="italic">true/false</em> value on a <strong class="source-inline">BooleanField</strong>. We will also apply this technique to the manufacturer/make field later in this chapter, in order to store an integer value.</p>
			<p>Another argument that can be useful is the <strong class="source-inline">editable=False</strong> attribute. This attribute would render a field hidden in any form object within a template. This field would not be visible or editable by the user in any way. The <strong class="source-inline">unique=True</strong> argument can also be useful. This argument states that two rows/records in your table cannot have the same value for that particular field. This would be useful if, say, an email field is used as a unique identifier for a model, preventing duplicates from existing. We would get conflicting results with errors telling us that the email address already exists when saving or creating a new record.</p>
			<p>Model field arguments differ from form field arguments in that the model arguments will apply rules to your columns on the database level. Your form field arguments, which we will cover in <a href="B17243_05_ePub.xhtml#_idTextAnchor152"><em class="italic">Chapter 5</em></a>, <em class="italic">Django Forms</em>, are rules that only apply to a field as it is used within a particular form. This means you can set <strong class="source-inline">blank=True</strong> on a model field, making it not required on the database level but in a <strong class="source-inline">required=True</strong> form field set, making it required for that particular form. Alternatively, we could make that field required in all forms by setting the constraint at the database level using <strong class="source-inline">blank=False</strong>. Keep that in mind when writing your model classes.</p>
			<p>Next, let's begin writing the different fields that are needed for our vehicle scenario.</p>
			<h3>Adding a standard field type</h3>
			<p>From the Django fields list provided<a id="_idIndexMarker357"/> earlier, we will use <strong class="source-inline">CharField</strong> for each of the models. <strong class="source-inline">CharField</strong> will be used to provide a name for each item as we add them to the database, except for the <strong class="source-inline">Vehicle</strong> model class. For the <strong class="source-inline">Vehicle</strong> model, we<a id="_idIndexMarker358"/> will use <strong class="source-inline">CharField</strong> as the <strong class="bold">Vehicle Identification Number</strong> (<strong class="bold">VIN</strong>), because a VIN accepts a combination of both letters and numbers. We also need a <strong class="source-inline">BooleanField</strong> on the <strong class="source-inline">Vehicle</strong> model, to store a value indicating whether or not this vehicle has been sold. This is the field where we will create a list of <em class="italic">yes/no</em> choices to use instead of the <em class="italic">true/false</em> values.</p>
			<p>Follow these steps to create the fields<a id="_idIndexMarker359"/> for each of your model classes. Remember to remove the <strong class="source-inline">pass</strong> statement:</p>
			<ol>
				<li value="1">In your <strong class="source-inline">/chapter_3/models.py</strong> file, create the set of <em class="italic">yes/no</em> choices above your model classes and below your <strong class="source-inline">import</strong> statements, as depicted:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">from django.db import models</p><p class="source-code"><strong class="bold">YESNO_CHOICES</strong> = (</p><p class="source-code">    (True, 'Yes'),</p><p class="source-code">    (False, 'No')</p><p class="source-code">)</p><p class="source-code">...</p></li>
				<li>Add the following field to your <strong class="source-inline">VehicleModel</strong> class:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">VehicleModel</strong>(models.Model):</p><p class="source-code">    name = models.CharField(</p><p class="source-code">        verbose_name = 'Model',</p><p class="source-code">        max_length = 75,</p><p class="source-code">        unique = True,</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
				<li>Add the following field to your <strong class="source-inline">Engine</strong> class:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Engine</strong>(models.Model):</p><p class="source-code">    name = models.CharField(</p><p class="source-code">        verbose_name = 'Engine',</p><p class="source-code">        max_length = 75,</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
				<li>Add the following<a id="_idIndexMarker360"/> fields to your <strong class="source-inline">Vehicle</strong> class:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</p><p class="source-code">    vin = <strong class="bold">models.CharField</strong>(</p><p class="source-code">        <strong class="bold">verbose_name = 'VIN'</strong>,</p><p class="source-code">        <strong class="bold">max_length = 17</strong>,</p><p class="source-code">        <strong class="bold">unique = True,</strong></p><p class="source-code">        <strong class="bold">blank = True</strong>,</p><p class="source-code">        <strong class="bold">null = True</strong>,</p><p class="source-code">    )</p><p class="source-code">    sold = <strong class="bold">models.BooleanField</strong>(</p><p class="source-code">        verbose_name = 'Sold?',</p><p class="source-code">        <strong class="bold">choices = YESNO_CHOICES</strong>,</p><p class="source-code">        <strong class="bold">default = False</strong>,</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
			</ol>
			<p>The <strong class="source-inline">name</strong> field on the <strong class="source-inline">VehicleModel</strong> class shown previously will use the <strong class="source-inline">unique</strong> argument, allowing only names<a id="_idIndexMarker361"/> that do not already exist in that table. The <strong class="source-inline">name</strong> field on the <strong class="source-inline">Engine</strong> class will not use the <strong class="source-inline">unique</strong> argument, so we can allow engines of the same name but assign them to different vehicle models. The <strong class="source-inline">YESNO_CHOICES</strong> variable is used as a global variable placed outside of any model class so that it can be used in many fields if needed. If a variable or set of choices is extremely unique, then it is best practice to place it above your field declarations, within the model class that is it being used in. You could also store these variables in an entirely separate file as well, as long as the code remains clean and simple.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The preceding code is a relaxed style of the PEP-8 style guide where we are placing each argument on its own line, separated by a comma while also following basic Python indentation rules. Most of the code throughout this book will be written in this way.</p>
			<ol>
				<li value="5">Run the Django <strong class="source-inline">makemigration</strong> and <strong class="source-inline">migrate</strong> commands, as shown:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py makemigrations</strong></p><p class="source-code"><strong class="bold">Migrations for 'chapter_3':</strong></p><p class="source-code"><strong class="bold">  becoming_a_django_entdev\chapter_3\migrations\0001_initial.py</strong></p><p class="source-code"><strong class="bold">    - Create model Engine </strong></p><p class="source-code"><strong class="bold">    - Create model Vehicle</strong></p><p class="source-code"><strong class="bold">    - Create model VehicleModel</strong></p><p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py migrate</strong></p><p class="source-code"><strong class="bold">Operations to perform:</strong></p><p class="source-code"><strong class="bold">  Apply all migrations: admin, auth, chapter_1, chapter_3, contenttypes, sessions</strong></p><p class="source-code"><strong class="bold">Running migrations:</strong></p><p class="source-code"><strong class="bold">  Applying chapter_3.0001_initial... OK</strong></p></li>
			</ol>
			<p>Every time a model is changed, created, or deleted, these Django migration commands will need<a id="_idIndexMarker362"/> to be executed in order to prevent runtime errors. They can be executed from either your IDE or within a command line or terminal window, executed from within your project's root directory, where your <strong class="source-inline">manage.py</strong> file lives. Refer to <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>, in the subsection titled <em class="italic">Building initial table structures</em> to learn more about the different ways to execute these commands.</p>
			<p>If those two Django migration commands were successful, three more tables will have been created in your database. When viewed from within your PgAdmin tool or any other database management tool that you decided to use, those tables will look similar to as in the following screenshot:</p>
			<div>
				<div id="_idContainer041" class="IMG---Figure">
					<img src="image/Figure_3.1_B17243.jpg" alt="Figure 3.1 – PgAdmin – created vehicle, model, and engine tables&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.1 – PgAdmin – created vehicle, model, and engine tables</p>
			<p>If we needed to use fields that don't come standard in Django, such as <strong class="source-inline">AddressField</strong>, <strong class="source-inline">MoneyField</strong>, or <strong class="source-inline">PhoneField</strong>, we would have<a id="_idIndexMarker363"/> to install packages and also configure settings before we can use them. Let's prepare our project next to let us do just that, by integrating <strong class="source-inline">MoneyField</strong> into these examples.</p>
			<h2 id="_idParaDest-73"><a id="_idTextAnchor082"/>Third-party field types</h2>
			<p>A <strong class="bold">third-party field type</strong> is a custom field created by a third-party<a id="_idIndexMarker364"/> provider. There are many other<a id="_idIndexMarker365"/> PyPI packages that can add field types to your arsenal: dozens and dozens more. For example, some of my favorite and most used include an address field, phone field, rich text field, money field, and even an image cropping tool. The <strong class="source-inline">django-address</strong> package uses the Google Maps API to suggest addresses related to what the user has typed as the user is typing into a single text field. This means that the package provides the model class as well as the form field class it creates and any other related tools. Related tools such as, all of the JavaScript and CSS libraries that help a form work. The <strong class="source-inline">django-image-cropping</strong> tool is also very powerful: it allows a user to upload an image and let the user crop the image however they desire. </p>
			<p>There is a package specifically made to handle currency called <strong class="source-inline">django-money</strong>. This package takes <strong class="source-inline">DecimalField</strong> from the list of standard field types and provides many different actions that involve working with money in a financial industry-accepted way. The <strong class="source-inline">django-money</strong> package provides definitions for all currencies that exist today and includes their corresponding currency sign. In addition to performing arithmetic operations, such as addition and subtraction, currencies can also be converted from one sign to another using current exchange rates. This means that this package will communicate with an API to retrieve that information. </p>
			<p>The <strong class="source-inline">django-phone-field</strong> package will accept a phone number that is rather versatile. The phone field allows for country codes and accepts special characters so that it can be masked to any format you need. The <strong class="source-inline">django-ckeditor</strong> package is a tool used for adding rich text editors to your pages, allowing users to enter HTML into one of your form fields. If you're using django CMS, they also make a version of the django-ckeditor package specifically for use with the django CMS package. </p>
			<p>Here is<a id="_idIndexMarker366"/> a short list<a id="_idIndexMarker367"/> of third-party<a id="_idIndexMarker368"/> field types<a id="_idIndexMarker369"/> to add to your<a id="_idIndexMarker370"/> field type<a id="_idIndexMarker371"/> cheat sheet from before:</p>
			<ul>
				<li><strong class="source-inline">AddressField</strong> – <a href="https://pypi.org/project/django-address/">https://pypi.org/project/django-address/</a> </li>
				<li><strong class="source-inline">ImageCropField</strong> – <a href="https://pypi.org/project/django-image-cropping/">https://pypi.org/project/django-image-cropping/</a> </li>
				<li><strong class="source-inline">MoneyField</strong> – <a href="https://pypi.org/project/django-money/">https://pypi.org/project/django-money/</a> </li>
				<li><strong class="source-inline">PhoneField</strong> – <a href="https://pypi.org/project/django-phone-field/">https://pypi.org/project/django-phone-field/</a> </li>
				<li><strong class="source-inline">RichTextField</strong> – <a href="https://pypi.org/project/django-ckeditor/">https://pypi.org/project/django-ckeditor/</a> </li>
				<li>(<em class="italic">django CMS</em>) <strong class="source-inline">RichTextField</strong> – <a href="https://pypi.org/project/djangocms-text-ckeditor/">https://pypi.org/project/djangocms-text-ckeditor/</a> </li>
			</ul>
			<p>Next, we will<a id="_idIndexMarker372"/> add <strong class="source-inline">MoneyField</strong> to our <strong class="source-inline">Vehicle</strong> model <a id="_idIndexMarker373"/>class.</p>
			<h3>Adding a third-party field type</h3>
			<p>Since some of the fields, such as <strong class="source-inline">AddressField</strong>, require obtaining<a id="_idIndexMarker374"/> a personal Google API key directly from Google, we will not be using that field type. We will only demonstrate using one of these third-party field types and then move on to the next topic. </p>
			<p>To include <strong class="source-inline">MoneyField</strong> in a project, follow these steps:</p>
			<ol>
				<li value="1">Add <strong class="source-inline">django-money</strong> to your <strong class="source-inline">requirements.txt</strong> file and install it in your virtual environment or run the following command to manually install this package. Make sure your virtual environment is already activated:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; pip install django-money</strong></p></li>
				<li>In your <strong class="source-inline">settings.py</strong> file, add the following app to your <strong class="source-inline">INSTALLED_APPS</strong> list:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/settings.py</strong></p><p class="source-code">...</p><p class="source-code">INSTALLED_APPS = [</p><p class="source-code">    ...,</p><p class="source-code">    <strong class="bold">'djmoney',</strong></p><p class="source-code">    'becoming_a_django_entdev.chapter_3',</p><p class="source-code">]</p></li>
			</ol>
			<p>Make sure it is located above your local apps<a id="_idIndexMarker375"/> and below all of your <strong class="source-inline">django.contrib</strong> apps, as shown previously, where it is placed before the <strong class="source-inline">chapter_3</strong> app.</p>
			<ol>
				<li value="3">Using <strong class="source-inline">MoneyField</strong>, you can specify the different currencies available in your project within the <strong class="source-inline">settings.py</strong> file. In the following example, we specify the US dollar and European euro as the two currencies available in this project:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/settings.py</strong></p><p class="source-code">...</p><p class="source-code"><strong class="bold">CURRENCIES</strong> = ('USD', 'EUR')</p><p class="source-code"><strong class="bold">CURRENCY_CHOICES</strong> = [</p><p class="source-code">    (<strong class="bold">'USD'</strong>, 'USD $'), </p><p class="source-code">    (<strong class="bold">'EUR'</strong>, 'EUR €')</p><p class="source-code">]</p></li>
				<li>Add the following highlighted <strong class="source-inline">import</strong> statement to the top of your <strong class="source-inline">/chapter_3/models.py</strong> file: <p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">from django.db import models</p><p class="source-code"><strong class="bold">from djmoney.models.fields import MoneyField</strong></p></li>
				<li>In your <strong class="source-inline">Vehicle</strong> class, add the price field shown here:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    price = <strong class="bold">MoneyField</strong>(</p><p class="source-code">        max_digits = 19,</p><p class="source-code">        decimal_places = 2,</p><p class="source-code">        default_currency = 'USD',</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
			</ol>
			<p>You will also need to use the field arguments<a id="_idIndexMarker376"/> depicted in the preceding example (adjust the values as needed).</p>
			<p>Let's explore what validation we can apply to the field types that we are using.</p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor083"/>Model field validators</h2>
			<p>Field validators<a id="_idIndexMarker377"/> are database-level rules that can be set on model fields. They are useful in situations<a id="_idIndexMarker378"/> where instead of <strong class="source-inline">DecimalField</strong>, using a <strong class="source-inline">max_length</strong> argument to control the character length, we are defining a minimum or maximum numeric value. A Django <strong class="bold">model field validator</strong> is a callable that allows us to take in a value and then perform an operation to see whether it meets certain criteria, raising <strong class="source-inline">ValidationError</strong> if that criterion is not met. Since this is a callable, you can write your own function to suit your needs or use one of the many different callable functions that come included with Django. For instance, we could use the <strong class="source-inline">MinValueValidator</strong> and <strong class="source-inline">MaxValueValidator</strong> functions when specifying a constraint for a minimum or maximum numeric value. You can view a complete<a id="_idIndexMarker379"/> list of validator functions provided by Django here: <a href="https://docs.djangoproject.com/en/4.0/ref/validators/">https://docs.djangoproject.com/en/4.0/ref/validators/</a>. </p>
			<h3>Setting a field validator</h3>
			<p><strong class="source-inline">MoneyField</strong> offers a few of its own field<a id="_idIndexMarker380"/> validators that add constraints on currency values of whatever type is defined in your project. The money validators take the leg work out of using a Django <strong class="source-inline">DecimalValidator</strong> or writing your own callable method. </p>
			<p>Follow these steps to set your validator on the existing <strong class="source-inline">Vehicle</strong> model:</p>
			<ol>
				<li value="1">At the top of your <strong class="source-inline">/chapter_3/models.py</strong> file, and just below your existing <strong class="source-inline">import</strong> statements, add the following <strong class="source-inline">import</strong> statement:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code"><strong class="bold">from djmoney.models.validators import MaxMoneyValidator, MinMoneyValidator</strong></p></li>
				<li>Whether it is a standard Django field validator or another one provided by a third-party package, it will go in the validator argument of a field, as shown on the <strong class="source-inline">price</strong> field of the <strong class="source-inline">Vehicle</strong> model here:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    <strong class="bold">price</strong> = MoneyField(</p><p class="source-code">        max_digits = 19,</p><p class="source-code">        decimal_places = 2,</p><p class="source-code">        default_currency = 'USD',</p><p class="source-code">        null = True,</p><p class="source-code">        <strong class="bold">validators</strong> = [</p><p class="source-code">            <strong class="bold">MinMoneyValidator(</strong></p><p class="source-code">                <strong class="bold">{'EUR': 500, 'USD': 400}</strong></p><p class="source-code">            <strong class="bold">)</strong>,</p><p class="source-code">            <strong class="bold">MaxMoneyValidator(</strong></p><p class="source-code">                <strong class="bold">{'EUR': 500000, 'USD': 400000}</strong></p><p class="source-code">            <strong class="bold">)</strong>,</p><p class="source-code">        ])</p></li>
			</ol>
			<p>These functions usually take in one or more arguments<a id="_idIndexMarker381"/> themselves. In this example, we are specifying the parameters for the minimum and maximum currency values. The preceding example states that all Euro (<strong class="source-inline">EUR</strong>) values should be between 500 and 500,000 Euros and the American dollar values (<strong class="source-inline">USD)</strong> should be between 400 and 400,000 dollars. These are rough estimates used for demonstration only and are not exact conversion rates.</p>
			<p>Currently, our three model classes exist independently from one another. This means they are not linked to each other in any way just yet. We will need them to be related to one another before we are done. Next, we will be linking those tables by working with model field relationships.</p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor084"/>Working with model field relationships</h1>
			<p>Django provides three relationship<a id="_idIndexMarker382"/> types for linking tables: </p>
			<ul>
				<li><strong class="bold">Many</strong><strong class="bold">–</strong><strong class="bold">to</strong><strong class="bold">–</strong><strong class="bold">one</strong></li>
				<li><strong class="bold">Many</strong><strong class="bold">–</strong><strong class="bold">to</strong><strong class="bold">–</strong><strong class="bold">many </strong></li>
				<li><strong class="bold">One</strong><strong class="bold">–</strong><strong class="bold">to</strong><strong class="bold">–</strong><strong class="bold">one</strong></li>
			</ul>
			<p>A <em class="italic">many-to-one</em> relationship is<a id="_idIndexMarker383"/> defined by using a <strong class="source-inline">ForeignKey</strong> field, and the other two relationship types are defined using the self-explanatory <strong class="source-inline">ManyToManyField</strong> and <strong class="source-inline">OneToOneField</strong>. These fields are named appropriately after the relationship type that they represent. </p>
			<p>Next, we will discuss the key components of working with model field relationships.</p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor085"/>Field arguments</h2>
			<p>The three field types, <strong class="source-inline">ForeignKey</strong>, <strong class="source-inline">ManyToManyField</strong>, and <strong class="source-inline">OneToOneField</strong>, all accept<a id="_idIndexMarker384"/> the standard <strong class="source-inline">default</strong>, <strong class="source-inline">blank</strong>, and <strong class="source-inline">verbose_name</strong> field arguments that other field types accept. The <strong class="source-inline">null</strong> argument will have no effect on a <strong class="source-inline">ManyToManyField</strong> and will only apply to the <strong class="source-inline">ForeignKey</strong> and <strong class="source-inline">OneToOneField</strong> types. Two of these field types—<strong class="source-inline">ForeignKey</strong> and <strong class="source-inline">OneToOneField</strong>—require at least two positional arguments, the first being the model class that the field relates to and the second being the <strong class="source-inline">on_delete</strong> argument. Positional means they need to be in that order and required means they must be specified. The <strong class="source-inline">on_delete</strong> argument specifies what the database will do with records from related tables if a parent or child object is deleted. </p>
			<p>The <strong class="source-inline">on_delete</strong> choices include the following:</p>
			<ul>
				<li><strong class="source-inline">models.CASCADE</strong> – used to automatically delete any related objects when an object is deleted from that table.</li>
				<li><strong class="source-inline">models.PROTECT</strong> – used to prevent deletion of any of the objects.</li>
				<li><strong class="source-inline">models.RESTRICT</strong> – used to prevent deletion in certain scenarios.</li>
				<li><strong class="source-inline">models.SET_DEFAULT</strong> – used to set the field of related objects to a default value.</li>
				<li><strong class="source-inline">models.SET_NULL</strong> – used to set the field of related objects to a null value.</li>
				<li><strong class="source-inline">models.SET()</strong> – accepts a callable to write your own function for setting a value.</li>
				<li><strong class="source-inline">models.DO_NOTHING</strong> – will take no action; using this option could cause <strong class="bold">IntegrityError</strong> and should be used with caution.</li>
			</ul>
			<p>We will set the value for the <strong class="source-inline">on_delete</strong> argument to <strong class="source-inline">models.CASCADE</strong>, ensuring that if a <strong class="source-inline">Vehicle</strong> is deleted from the database, nothing will happen to the related <strong class="source-inline">VehicleModel</strong> and <strong class="source-inline">Engine</strong> objects. But if we deleted a <strong class="source-inline">VehicleModel</strong> or <strong class="source-inline">Engine</strong> object from<a id="_idIndexMarker385"/> the database, the related <strong class="source-inline">Vehicle</strong> that depends on that soon-to-be-deleted object will also be deleted. If we want to preserve <strong class="source-inline">Vehicle</strong> in the scenario of when either of those two is deleted, we should use the <strong class="source-inline">models.SET_DEFAULT</strong> value instead.</p>
			<p>The three field types—<strong class="source-inline">ForeignKey</strong>, <strong class="source-inline">ManyToManyField</strong>, and <strong class="source-inline">OneToOneField</strong>—all allow for us to follow relationships forward and backward when performing queries, which means if you query a parent object, you can follow that lookup forward to get all of its child objects. A reverse lookup would mean you query a child object and follow its lookup backward to get its parent object. These forward and reverse relationships are defined on fields by using the <strong class="source-inline">related_name</strong> and <strong class="source-inline">related_query_name</strong> arguments, which will soon be demonstrated.</p>
			<p>A <strong class="source-inline">ForeignKey</strong> field and <strong class="source-inline">ManyToManyField</strong> can accept a <strong class="source-inline">limit_choices_to</strong> argument, which applies a filter to the related queries. The <strong class="source-inline">limit_choices_to</strong> argument will accept a dictionary or Q object. It will also accept a callable function that returns either a dictionary or Q object. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">A <strong class="bold">Q object</strong> will encapsulate a SQL expression<a id="_idIndexMarker386"/> in a Python object used in database-related operations. Q objects add advanced-level query operations that sometimes a <strong class="source-inline">filter()</strong>, <strong class="source-inline">all()</strong>, or <strong class="source-inline">order_by()</strong> statement cannot provide. To learn more about complex lookups with Q objects, visit the official Django documentation here: <a href="https://docs.djangoproject.com/en/4.0/topics/db/queries/#complex-lookups-with-q-objects">https://docs.djangoproject.com/en/4.0/topics/db/queries/#complex-lookups-with-q-objects</a>. To learn more about performing<a id="_idIndexMarker387"/> queries in general, jump ahead to the section titled <em class="italic">Performing queries</em> later in this chapter.</p>
			<p>Continuing on with our vehicle<a id="_idIndexMarker388"/> classes, we can apply some of these model relations and arguments to the classes we already wrote. They will help us link a hypothetical <strong class="source-inline">Seller</strong> to a <strong class="source-inline">Vehicle</strong>, a <strong class="source-inline">Vehicle</strong> to a <strong class="source-inline">VehicleModel</strong>, and that <strong class="source-inline">VehicleModel</strong> to an <strong class="source-inline">Engine</strong>.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor086"/>Field type – ForeignKey</h2>
			<p>We will be using a <strong class="source-inline">ForeignKey</strong> field to<a id="_idIndexMarker389"/> represent a <em class="italic">many-to-one</em> relationship<a id="_idIndexMarker390"/> between the <strong class="source-inline">Vehicle</strong> class and the <strong class="source-inline">VehicleModel</strong> and <strong class="source-inline">Engine</strong> classes. </p>
			<p>Follow these steps to create your <strong class="source-inline">ForeignKey</strong> field:</p>
			<ol>
				<li value="1">In your <strong class="source-inline">/chapter_3/models.py</strong> file, add the following two fields to your existing <strong class="source-inline">Vehicle</strong> model class, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    <strong class="bold">vehicle_model = models.ForeignKey(</strong></p><p class="source-code">        <strong class="bold">VehicleModel</strong>,</p><p class="source-code">        <strong class="bold">on_delete = models.CASCADE,</strong></p><p class="source-code">        verbose_name = 'Model',</p><p class="source-code">        <strong class="bold">related_name = 'model_vehicle',</strong></p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p><p class="source-code">    <strong class="bold">engine = models.ForeignKey(</strong></p><p class="source-code">        <strong class="bold">Engine</strong>,</p><p class="source-code">        <strong class="bold">on_delete = models.CASCADE,</strong></p><p class="source-code">        verbose_name = 'Engine',</p><p class="source-code">        <strong class="bold">related_name = 'engine_vehicle',</strong></p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
				<li>In your <strong class="source-inline">/chapter_3/models.py</strong> file, add<a id="_idIndexMarker391"/> the following field<a id="_idIndexMarker392"/> to your existing <strong class="source-inline">Engine</strong> model class, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Engine</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    <strong class="bold">vehicle_model = models.ForeignKey(</strong></p><p class="source-code">        <strong class="bold">VehicleModel,</strong></p><p class="source-code">        <strong class="bold">on_delete = models.CASCADE,</strong></p><p class="source-code">        verbose_name = 'Model',</p><p class="source-code">        <strong class="bold">related_name = 'model_engine',</strong></p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
				<li>Now, run your Django migration commands one more time, as discussed in the subsection titled <em class="italic">Building initial table structures</em> in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>. You can see the two fields that we created, <strong class="source-inline">vehicle_model</strong> and <strong class="source-inline">engine</strong>, are now in the list of columns shown in our database management tool:</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer042" class="IMG---Figure">
					<img src="image/Figure_3.2_B17243.jpg" alt="Figure 3.2 – PgAdmin – ForeignKey field&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.2 – PgAdmin – ForeignKey field</p>
			<p>In the preceding<a id="_idIndexMarker393"/> screenshot, these fields <a id="_idIndexMarker394"/>are shown as <strong class="source-inline">vehicle_model_id</strong> and <strong class="source-inline">engine_id</strong>. The <strong class="source-inline">_id</strong> suffix automatically gets added to the column name in your database.</p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor087"/>Field type – ManyToManyField</h2>
			<p>Here, we will<a id="_idIndexMarker395"/> represent a <em class="italic">many-to-many</em> field relationship<a id="_idIndexMarker396"/> between a seller and the vehicles they are selling with a <strong class="source-inline">ManyToManyField</strong> type. <strong class="source-inline">ManyToManyField</strong> will not accept the <strong class="source-inline">on_delete</strong> argument. Instead, when a child or parent is deleted, the other will always remain in your database since many other objects could relate to it as well. </p>
			<p>Follow these steps to create <strong class="source-inline">ManyToManyField</strong>:</p>
			<ol>
				<li value="1">In your <strong class="source-inline">/chapter_3/models.py</strong> file, create a new <strong class="source-inline">Seller</strong> model class with a <strong class="source-inline">name</strong> field and a <strong class="source-inline">vehicle</strong> field to use as your <em class="italic">many-to-many</em> relationship. Your code should now resemble the following example:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Seller</strong>(models.Model):</p><p class="source-code">    <strong class="bold">name = models.CharField(</strong></p><p class="source-code">        verbose_name = 'Seller Name',</p><p class="source-code">        max_length = 150,</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p><p class="source-code">    <strong class="bold">vehicle = models.ManyToManyField(</strong></p><p class="source-code">        <strong class="bold">Vehicle,</strong></p><p class="source-code">        verbose_name = 'Vehicles',</p><p class="source-code">        <strong class="bold">related_name = 'vehicle_sellers',</strong></p><p class="source-code">        <strong class="bold">related_query_name = 'vehicle_seller',</strong></p><p class="source-code">        blank = True,</p><p class="source-code">    )</p></li>
			</ol>
			<p>We will link <strong class="source-inline">ManyToManyField</strong> to the <strong class="source-inline">Vehicle</strong> model class in the first positional argument. It's given a <strong class="source-inline">related_name</strong> argument<a id="_idIndexMarker397"/> with a value of <strong class="source-inline">vehicle_sellers</strong> and a <strong class="source-inline">related_query_name</strong> argument with a value of <strong class="source-inline">vehicle_seller</strong>. These two arguments<a id="_idIndexMarker398"/> are used for linking and mapping to this field later on in <a href="B17243_10_ePub.xhtml#_idTextAnchor293"><em class="italic">Chapter 10</em></a>, <em class="italic">Database Management</em>.</p>
			<ol>
				<li value="2">Go ahead and run your Django migration commands one more time. You should see the columns that were created for this table in your database management tool, similar to the following screenshot: </li>
			</ol>
			<div>
				<div id="_idContainer043" class="IMG---Figure">
					<img src="image/Figure_3.3_B17243.jpg" alt="Figure 3.3 – pgAdmin – ManyToManyField&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.3 – pgAdmin – ManyToManyField</p>
			<p>We should also see any additional<a id="_idIndexMarker399"/> tables that automatically get created, which<a id="_idIndexMarker400"/> are used to manage the relationships between <strong class="source-inline">Seller</strong> and <strong class="source-inline">Vehicle</strong>. That table is shown in the preceding screenshot as <strong class="bold">chapter_3_seller_vehicle</strong>. </p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor088"/>Mutable versus immutable objects</h2>
			<p><strong class="bold">Mutability</strong> is a fundamental concept of the Python<a id="_idIndexMarker401"/> language and is broken down<a id="_idIndexMarker402"/> into mutable and immutable<a id="_idIndexMarker403"/> objects. An object is said to be <strong class="bold">mutable</strong> if its values can change over time. If an object's value will not change, then that object is said to be <strong class="bold">immutable</strong>. In Python, an object's mutability is also defined by the data type that it is. For example, mutable objects are represented using a <em class="italic">list</em>, <em class="italic">dictionary</em>, <em class="italic">set</em>, or <em class="italic">QuerySet</em>. Immutable objects are defined by using the <em class="italic">bool</em>, <em class="italic">decimal</em>, <em class="italic">float</em>, <em class="italic">int</em>, <em class="italic">range</em>, <em class="italic">string</em>, and <em class="italic">tuple</em> data types. Queries will perform better if the object being searched is immutable rather than mutable. Most of the time, the difference is miniscule, literally in nano-or milliseconds. When your project goes live and your database starts to collect thousands, if not millions, of records, the time it takes to query something will then be noticed when it takes seconds, if not minutes or tens of minutes, to complete a single query.</p>
			<p>For example, we could represent<a id="_idIndexMarker404"/> a set of choices as a <strong class="source-inline">PositiveIntegerField</strong> using a tuple object to associate<a id="_idIndexMarker405"/> a human-readable string representation<a id="_idIndexMarker406"/> to a numeric integer value. Take the make/manufacturer of a vehicle that was mentioned earlier in this chapter. We don't really need a table to store this information unless we have other related information that needs to be stored or have a project requirement stating that the user should have the ability to add/edit these choices.</p>
			<p>Hardcoding these values as an immutable data type can be done by following these steps: </p>
			<ol>
				<li value="1">In the <strong class="source-inline">/chapter_3/models.py</strong> file, add the following set above your model classes and below your <strong class="source-inline">import</strong> statements:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code"><strong class="bold">MAKE_CHOICES</strong> = (</p><p class="source-code">    (1, 'Buick'),</p><p class="source-code">    (2, 'Cadillac'),</p><p class="source-code">    (3, 'Chevrolet'),</p><p class="source-code">    ...</p><p class="source-code">)</p></li>
				<li>Use that set as the value of the <strong class="source-inline">choices</strong> argument of your <strong class="source-inline">make</strong> field within your <strong class="source-inline">Vehicle</strong> class, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    <strong class="bold">make = models.PositiveIntegerField(</strong></p><p class="source-code">        <strong class="bold">choices = MAKE_CHOICES,</strong></p><p class="source-code">        verbose_name = 'Vehicle Make/Brand',</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
			</ol>
			<p>Next, let's discuss what the <strong class="source-inline">Meta</strong> subclass<a id="_idIndexMarker407"/> is and how it is used<a id="_idIndexMarker408"/> to control the behavior of models<a id="_idIndexMarker409"/> even more than what we have already done.</p>
			<h1 id="_idParaDest-80"><a id="_idTextAnchor089"/>Using the Meta subclass</h1>
			<p><strong class="bold">Model metadata</strong> is an inner class of a model<a id="_idIndexMarker410"/> called <strong class="source-inline">Meta</strong>. It is not required and <a id="_idIndexMarker411"/>completely optional but it does make using Django much more useful when it is included in your models. Metadata provides all of the "other" information that is not defined in model field arguments. The settings<a id="_idIndexMarker412"/> that are defined inside this class are called <strong class="bold">meta options,</strong> and there are quite a lot to choose from. We will go over only some of the most commonly used options in the following sections and how they can be helpful. A complete breakdown of all of the options<a id="_idIndexMarker413"/> is available here: <a href="https://docs.djangoproject.com/en/4.0/ref/models/options/">https://docs.djangoproject.com/en/4.0/ref/models/options/</a>. </p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor090"/>Meta options – verbose_name and verbose_name_plural</h2>
			<p>We can use the <strong class="source-inline">verbose_name</strong> and <strong class="source-inline">verbose_name_plural</strong> options to specify what human-readable<a id="_idIndexMarker414"/> text is used in areas<a id="_idIndexMarker415"/> of the Django admin site or if we look it up later in the code that we write. We will introduce<a id="_idIndexMarker416"/> the Django admin<a id="_idIndexMarker417"/> site in <a href="B17243_06_ePub.xhtml#_idTextAnchor190"><em class="italic">Chapter 6</em></a>, <em class="italic">Exploring the Django Admin Site</em>. </p>
			<p>To add these options to your model classes, using the class named <strong class="source-inline">VehicleModel</strong>, set these two verbose options to read as <strong class="source-inline">Vehicle Model</strong> and <strong class="source-inline">Vehicle Models</strong>, as depicted:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">class <strong class="bold">VehicleModel</strong>(models.Model):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    class <strong class="bold">Meta</strong>:</pre>
			<pre class="source-code">        <strong class="bold">verbose_name</strong> = 'Vehicle Model'</pre>
			<pre class="source-code">        <strong class="bold">verbose_name_plural</strong> = 'Vehicle Models'</pre>
			<p>Now, throughout your code and the Django admin site, these values will be used as the singular and plural representations of your object(s).</p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor091"/>Meta option – ordering</h2>
			<p>The <strong class="source-inline">ordering</strong> option is used when obtaining<a id="_idIndexMarker418"/> a list of objects. This setting will accept<a id="_idIndexMarker419"/> one or many fields as a parameter to order by default if no other ordering rules have been specified when the query is performed. It will order in ascending order unless a dash (<strong class="source-inline">–</strong>) character has been placed before the value; if a dash is used, then the results will appear in descending order instead. </p>
			<p>To add this option to your model classes, we can order the <strong class="source-inline">VehicleModel</strong> class by <strong class="source-inline">name</strong> in ascending order, and then again in descending order, as shown in the following code:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">class <strong class="bold">VehicleModel</strong>(models.Model):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    class <strong class="bold">Meta</strong>:</pre>
			<pre class="source-code">        ...</pre>
			<pre class="source-code">        #<strong class="bold">ordering</strong> = ['<strong class="bold">name</strong>', '<strong class="bold">secondary_field</strong>',]</pre>
			<pre class="source-code">        <strong class="bold">ordering</strong> = ['<strong class="bold">-</strong>name']</pre>
			<p>The first example, commented<a id="_idIndexMarker420"/> out in the previous code block, shows us that we can order by additional<a id="_idIndexMarker421"/> fields, separated by a comma as well as in ascending order. The last example in the preceding code block depicts ordering the results in descending order alphabetically, from Z to A.</p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor092"/>Meta option – indexes</h2>
			<p>The <strong class="source-inline">indexes</strong> option relates<a id="_idIndexMarker422"/> to a standard data<a id="_idIndexMarker423"/> architecture concept called <strong class="bold">database indexing</strong>, which helps to improve the time<a id="_idIndexMarker424"/> it takes to perform database queries. Indexes look up data without having to search through every record or row that exists in your tables. They essentially do the work to search tables prior to actually being searched by a user. Django makes it really easy to implement database indexing on tables by using the <strong class="source-inline">indexes</strong> meta option. </p>
			<p>Follow these steps to add this option to your model classes:</p>
			<ol>
				<li value="1">To index the name field on the <strong class="source-inline">VehicleModel</strong> class, it would be written as shown here:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code"><strong class="bold">from django.db.models.functions import Lower</strong></p><p class="source-code">...</p><p class="source-code">class <strong class="bold">VehicleModel</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    class <strong class="bold">Meta</strong>:</p><p class="source-code">        ...</p><p class="source-code">        <strong class="bold">indexes</strong> = [</p><p class="source-code">            <strong class="bold">models.Index(fields=['name']),</strong></p><p class="source-code">            models.Index(</p><p class="source-code">                fields = ['<strong class="bold">-name</strong>'], </p><p class="source-code">                name = 'desc_name_idx'</p><p class="source-code">            ),</p><p class="source-code">            models.Index(</p><p class="source-code">                Lower('name').desc(), </p><p class="source-code">                <strong class="bold">name = 'lower_name_idx'</strong></p><p class="source-code">            )</p><p class="source-code">        ]</p></li>
			</ol>
			<p>The preceding example creates<a id="_idIndexMarker425"/> three separate indexes, one for the name<a id="_idIndexMarker426"/> in ascending order, one in descending order, and another for lowercase-only names in ascending order. </p>
			<ol>
				<li value="2">Next, run your Django migration commands one more time. In your command-line or terminal window, the following messages should appear:<p class="source-code"><strong class="bold">    - Create index chapter_3_v_name_055414_idx on field(s) name of model vehiclemodel</strong></p><p class="source-code"><strong class="bold">    - Create index desc_name_idx on field(s) -name of model vehiclemodel</strong></p><p class="source-code"><strong class="bold">    - Create index lower_name_idx on OrderBy(Lower(F(name)), descending=True) on model vehiclemodel</strong></p></li>
			</ol>
			<p>If we don't specify a <strong class="source-inline">name=</strong> attribute, as was not done in the first index of the preceding example, Django will name it using its default naming convention instead. This is what resulted in the name <strong class="source-inline">chapter_3_v_name_055414_idx</strong> for the first index message in the preceding example. The preceding example imports a class from the <strong class="source-inline">django.db.models.functions</strong> library, called <strong class="source-inline">Lower</strong>. The <strong class="source-inline">Lower</strong> class allows us to create an index on all of the lowercase character representations for the <strong class="source-inline">name</strong> field in the last index in the previous code block. There are<a id="_idIndexMarker427"/> numerous database functions that Django provides, and a complete breakdown<a id="_idIndexMarker428"/> of these functions can be found in the official Django documentation here: <a href="https://docs.djangoproject.com/en/4.0/ref/models/database-functions/">https://docs.djangoproject.com/en/4.0/ref/models/database-functions/</a>.</p>
			<p>The indexes for each table<a id="_idIndexMarker429"/> are usually shown within a database management tool. For example, in PgAdmin, navigate the data tree from within the <strong class="bold">Browser</strong> tab to find the <strong class="bold">chapter_3_vehiclemodel</strong> indexes. It is a very deep navigation: go to <strong class="bold">PostgreSQL 13</strong> | <strong class="bold">Databases</strong> | <strong class="bold">local_postgresql</strong> | <strong class="bold">Schemas</strong> | <strong class="bold">public</strong> | <strong class="bold">Tables</strong> | <strong class="bold">chapter_3_vehiclemodel</strong> | <strong class="bold">Indexes</strong> and you should see your indexes, as shown in the following screenshot:</p>
			<p class="figure-caption">  </p>
			<div>
				<div id="_idContainer044" class="IMG---Figure">
					<img src="image/Figure_3.4_B17243.jpg" alt="Figure 3.4 – PgAdmin – model indexes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.4 – PgAdmin – model indexes</p>
			<h2 id="_idParaDest-84"><a id="_idTextAnchor093"/>Meta option – db_table</h2>
			<p>Sometimes, a project might<a id="_idIndexMarker430"/> have so many models that they start to conflict with each other or it just becomes<a id="_idIndexMarker431"/> too confusing to manage. The <strong class="source-inline">db_table</strong> option is used to specify the name of the table in a database. If this option is not set, by default Django will name your tables using the <strong class="source-inline">{{ app_name }}_{{ model_name }}</strong> naming convention. We can use this option to specify a unique table name on a case-by-case basis that differs from the default naming convention.</p>
			<p>For example, let's create a new class named <strong class="source-inline">engine2</strong>, in lowercase this time. This way, we know that the lowercase classes are meant for side practice, separate from the main classes, which will be named with the first letter capitalized. Here, we will add the number <strong class="bold">2</strong> to avoid <strong class="source-inline">RuntimeError</strong>, which was mentioned earlier in this chapter, in the <em class="italic">Writing model classes</em> section.</p>
			<p>Follow these steps<a id="_idIndexMarker432"/> to add this option to your model classes:</p>
			<ol>
				<li value="1">In the <strong class="source-inline">/chapter_3/models.py</strong> file, create the <strong class="source-inline">engine2</strong> class and copy the name field from the <strong class="source-inline">Engine</strong> class into it, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">engine2</strong>(models.Model):</p><p class="source-code">    <strong class="bold">name</strong> = models.CharField(</p><p class="source-code">        verbose_name = 'Engine',</p><p class="source-code">        max_length = 75,</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
				<li>Create the <strong class="source-inline">Meta</strong> subclass and set the <strong class="source-inline">db_table</strong> option as depicted here. Do not use this option on the <strong class="source-inline">Engine</strong> class:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chap<a id="_idTextAnchor094"/>ter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">engine2</strong>(models.Model):</p><p class="source-code">    ...</p><p class="source-code">    class <strong class="bold">Meta</strong>:</p><p class="source-code">        db_table = '<strong class="bold">chapter_3_practice_engine</strong>'</p></li>
			</ol>
			<p>Set the value of <strong class="source-inline">db_table</strong> to <strong class="source-inline">'chapter_3_practice_engine'</strong>, as shown.</p>
			<ol>
				<li value="3">Next, run your Django migration<a id="_idIndexMarker433"/> commands one more time. In your database management tool, such as PgAdmin, the <strong class="source-inline">chapter_3</strong> tables should look similar to the following: </li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer045" class="IMG---Figure">
					<img src="image/Figure_3.5_B17243.jpg" alt="Figure 3.5 – PgAdmin – db_table option&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.5 – PgAdmin – db_table option</p>
			<p>We can see the <strong class="bold">chapter_3_engine</strong> and <strong class="bold">chapter_3_practice_engine</strong> tables in the preceding screenshot. The <strong class="bold">chapter_3_practice_engine</strong> table is used instead of what would have been named <strong class="bold">chapter_3_engine2</strong> for the <strong class="source-inline">engine2</strong> model class. Another valuable meta <a id="_idIndexMarker434"/>option that you may find yourself using a lot is the abstract option. This is primarily used for extending model classes and is best explained later in the section titled <em class="italic">Extending models</em> of this chapter.</p>
			<p>Before we extend model classes, let's explore using model methods and method decorators.</p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor095"/>Customizing models</h1>
			<p>Model methods are custom functions<a id="_idIndexMarker435"/> written within a model class that provide added<a id="_idIndexMarker436"/> functionality related to a single record within a table. They let us create<a id="_idIndexMarker437"/> our own business logic and format field data<a id="_idIndexMarker438"/> as we need to. Django provides us with several default methods and we can also write our own custom methods. Custom methods can combine fields and return data derived from those two or more fields. Decorators are sometimes used in combination with model methods to provide even more functionality.</p>
			<p>Some methods can let us perform special operations when an object is saved and/or deleted at the database level. Other methods are used when queries are performed or when rendering an object within a template. We will discuss some of the methods that Django provides and then demonstrate<a id="_idIndexMarker439"/> their uses. For a complete breakdown of the full capabilities<a id="_idIndexMarker440"/> of using Django's model methods, visit their<a id="_idIndexMarker441"/> documentation, found here: <a href="https://docs.djangoproject.com/en/4.0/topics/db/models/#model-methods">https://docs.djangoproject.com/en/4.0/topics/db/models/#model-methods</a>. </p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor096"/>Writing methods</h2>
			<p>Writing a model method<a id="_idIndexMarker442"/> is similar to writing a <strong class="source-inline">Meta</strong> subclass, except instead of writing a class, we are now writing a function inside that class using the <strong class="source-inline">def</strong> keyword.</p>
			<p>The four most helpful and most used methods are defined here:</p>
			<ul>
				<li><strong class="source-inline">def save(self, *args, **kwargs)</strong> – used to override the save action of this model at the database level. You can inject your own logic either before or after the save has occurred by tapping into this method.</li>
				<li><strong class="source-inline">def delete(self, *args, **kwargs)</strong> – this is similar to the <strong class="source-inline">save</strong> method, except that you can add your own logic before or after an object has been deleted at the database level.</li>
				<li><strong class="source-inline">def get_absolute_url(self)</strong> – used by Django to formulate a canonical URL for that object. This is used to redefine the default behavior of how Django creates a URL structure for these objects. This is also the URL used within the Django admin site to access this object.</li>
				<li><strong class="source-inline">def __str__(self)</strong> – used to redefine the default manner that Django will use to create a string representation of a single record within that table.</li>
			</ul>
			<p>We will use the <strong class="source-inline">__str__()</strong> method to demonstrate how to override a Django-provided method and access methods throughout the code of your project.</p>
			<h3>Model method – __str__</h3>
			<p>Using the same <strong class="source-inline">MAKE_CHOICES</strong> tuple that was created<a id="_idIndexMarker443"/> earlier, we will override the <strong class="source-inline">__str__()</strong> method to formulate a custom name for all <strong class="source-inline">Vehicle</strong> objects. The default string representation of a <strong class="source-inline">Vehicle</strong> object that we will define will use the following naming convention, <strong class="source-inline">{{ vehicle make }} {{ vehicle model }}</strong>, with a space in between. </p>
			<p>To configure this method in your <strong class="source-inline">Vehicle</strong> class, in your <strong class="source-inline">/chapter_3/models.py</strong> file, write the <strong class="source-inline">__str__()</strong> method, as depicted<a id="_idIndexMarker444"/> in the following code block, in your existing <strong class="source-inline">Vehicle</strong> model class:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    <strong class="bold">def __str__(self):</strong></pre>
			<pre class="source-code">        MAKE_CHOICES_DICT = dict(MAKE_CHOICES)</pre>
			<pre class="source-code">        return MAKE_CHOICES_DICT[self.make] + ' ' + self.model.name</pre>
			<p>It's easy to see that model methods are just functions that take in an instance of itself, perform an operation of some kind on itself, and then return the transformed value. The value in the preceding example is a string, and for the <strong class="source-inline">__str__()</strong> method, it should always return a string, whereas other methods, including custom methods that you create, can return any other data type, such as an <em class="italic">integer</em>, <em class="italic">dictionary</em>, <em class="italic">QuerySet</em>, or <em class="italic">date/time</em> object, to name a few.</p>
			<p>Next, <a id="_idTextAnchor097"/>let's discuss writing our own custom model methods, one that Django does not provide for us.</p>
			<h3>Custom model method</h3>
			<p>A custom method would come<a id="_idIndexMarker445"/> in handy if say we want to display a more in-depth name than what the <strong class="source-inline">__str__()</strong> method already does for a model class. For example, let's include the engine type in addition to the information returned from the <strong class="source-inline">__str__()</strong> method. The naming convention will be <strong class="source-inline">{{ vehicle make }} {{ vehicle model }} – {{ vehicle engine }}</strong>, with the space and dash in between.</p>
			<p>To create your own model method on the <strong class="source-inline">Vehicle</strong> class, in your <strong class="source-inline">/chapter_3/models.py</strong> file, create a new method within your <strong class="source-inline">Vehicle</strong> model and call it <strong class="source-inline">full_vehicle_name()</strong>, as shown:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    <strong class="bold">def full_vehicle_name(self):</strong></pre>
			<pre class="source-code">        <strong class="bold">return self.__str__() + ' - ' + self.engine.name</strong></pre>
			<p>The preceding example uses the same logic found in the <strong class="source-inline">__str__()</strong> method. We are just calling that method<a id="_idIndexMarker446"/> from within the custom method using the <strong class="source-inline">self.__str__()</strong> expression, instead of writing the same code in two different places. </p>
			<p>Next, we will apply a decorator around the newly created custom method, changing how we interact with this data.</p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor098"/>Decorators</h2>
			<p>A decorator is a standard Python<a id="_idIndexMarker447"/> design pattern that allows developers to extend the functionality of an object without permanently changing the behavior of that object. The concept of decorators can be applied to virtually any class or method that exists in a project. We will be applying this concept to the <strong class="source-inline">full_vehicle_name()</strong> method that we just created, to change it from a callable to now a meta property of that model.</p>
			<h3>Decorator – @property</h3>
			<p>A <strong class="source-inline">@property</strong> decorator <a id="_idIndexMarker448"/>allows us to write a method<a id="_idIndexMarker449"/> to act as a regular property of a model instance, rather than act as a function. Using this decorator, we can access <strong class="source-inline">full_vehicle_name</strong> just like we would any other field found in that table. The only thing we cannot do is save data as we would for any other field, because that property is not technically its own column in that table to store data in.</p>
			<p>With no <strong class="source-inline">@property</strong> decorator present, data would be accessed similar to the following demonstration:</p>
			<p class="source-code">&gt;&gt;&gt; print(my_object.my_custom_method())</p>
			<p>With the <strong class="source-inline">@property</strong> decorator present, the <strong class="source-inline">print</strong> statement would be written similar to the following<a id="_idIndexMarker450"/> demonstration:</p>
			<p class="source-code">&gt;&gt;&gt; print(my_object.my_custom_method)</p>
			<p>To wrap your method in a <strong class="source-inline">@property</strong> decorator, in your <strong class="source-inline">/chapter_3/models.py</strong> file, within the <strong class="source-inline">Vehicle</strong> model class, create a new method called <strong class="source-inline">fullname()</strong>, as depicted here:</p>
			<pre class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </pre>
			<pre class="source-code">...</pre>
			<pre class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</pre>
			<pre class="source-code">    ...</pre>
			<pre class="source-code">    <strong class="bold">@property</strong></pre>
			<pre class="source-code">    <strong class="bold">def fullname(self):</strong></pre>
			<pre class="source-code">        return self.__str__() + ' - ' + self.engine.name</pre>
			<p>The preceding example will perform the same task as the <strong class="source-inline">full_vehicle_name()</strong> method except with the <strong class="source-inline">@property</strong> decorator applied. When we perform query operations later, in the section titled <em class="italic">Performing queries</em>, we will compare the difference between the two methods to see how that data is returned and used. </p>
			<p>Now that we have discussed most of the core concepts of what makes up a Django model, let's practice extending<a id="_idIndexMarker451"/> these models in an effort to keep to a <strong class="bold">Don't Repeat Yourself</strong> (<strong class="bold">DRY</strong>) style of writing.</p>
			<h1 id="_idParaDest-88"><a id="_idTextAnchor099"/>Extending models</h1>
			<p><strong class="bold">Extending</strong> a model is a way to write a set of fields and methods<a id="_idIndexMarker452"/> that can be shared in many different classes. This is also known as <strong class="bold">inheritance</strong>, which is a fundamental principle<a id="_idIndexMarker453"/> of the Python language, letting us write code once and reuse it over and over again. It is also a way to reuse or modify a class provided by Django itself, such as the built-in <strong class="source-inline">User</strong> model, which is a very common model to extend. </p>
			<p>Next, we will practice extending our practice model called <strong class="source-inline">engine2</strong> and then extend the Django <strong class="source-inline">User</strong> model, turning it into the <strong class="source-inline">Seller</strong> model. This would make the <strong class="source-inline">Seller</strong> object related to a <strong class="source-inline">Vehicle</strong> and also act as a <strong class="source-inline">User</strong>, provided with permission-based roles<a id="_idIndexMarker454"/> and permission group capabilities.</p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor100"/>Extending basic model classes</h2>
			<p>Extending regular model classes<a id="_idIndexMarker455"/> is pretty easy to do. Follow these steps to extend the <strong class="source-inline">engine2</strong> practice class:</p>
			<ol>
				<li value="1">In your <strong class="source-inline">/chapter_3/models.py</strong> file, in the class named <strong class="source-inline">engine2</strong>, keep the name field as is and then add a new field called <strong class="source-inline">vehicle_model</strong>, with the <strong class="source-inline">related_name</strong> attribute value that is depicted in the following code block: <p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">engine2</strong>(models.Model):</p><p class="source-code">    name = models.CharField(...)</p><p class="source-code">    <strong class="bold">vehicle_model = models.ForeignKey(</strong></p><p class="source-code">        VehicleModel,</p><p class="source-code">        on_delete = models.CASCADE,</p><p class="source-code">        verbose_name = 'Model',</p><p class="source-code">        <strong class="bold">related_name = 'model_engine2',</strong></p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
				<li>Make sure your <strong class="source-inline">engine2</strong> class has the following <strong class="source-inline">Meta</strong> class options:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">engine2</strong>(models.Model):</p><p class="source-code">    class <strong class="bold">Meta</strong>:</p><p class="source-code">        <strong class="bold">abstract = True</strong></p><p class="source-code">        db_table = '<strong class="bold">chapter_3_practice_engine</strong>'</p><p class="source-code">        ordering = ['name',]</p><p class="source-code">        verbose_name = 'Practice Engine'</p><p class="source-code">        verbose_name_plural = 'Practice Engines'</p></li>
			</ol>
			<p>We basically want <strong class="source-inline">engine2</strong> to resemble the <strong class="source-inline">Engine</strong> class exactly, except that we want to keep the original class<a id="_idIndexMarker456"/> untouched and write a new class called <strong class="source-inline">engine3</strong> constructed from <strong class="source-inline">engine2</strong>. We also have to give the <strong class="source-inline">vehicle_model</strong> field in the <strong class="source-inline">engine2</strong> class a new and unique value for the <strong class="source-inline">related_name</strong> argument. Otherwise, when we run the Django migration commands, we will experience conflicting errors with the <strong class="source-inline">Engine</strong> class. In the <strong class="source-inline">engine2</strong> class, specify the <strong class="source-inline">abstract = True</strong> option as we did in the preceding example. That option allows us to use that class as a parent class.</p>
			<ol>
				<li value="3">Now, create a new class called <strong class="source-inline">engine3</strong> below your <strong class="source-inline">engine2</strong> class, as depicted in the following code block:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">engine3</strong>(<strong class="bold">engine2</strong>):</p><p class="source-code">    <strong class="bold">other_name = models.CharField(</strong></p><p class="source-code">        verbose_name = 'Other Engine Name',</p><p class="source-code">        max_length = 75,</p><p class="source-code">        blank = True,</p><p class="source-code">        null = True,</p><p class="source-code">    )</p></li>
			</ol>
			<p>In the <strong class="source-inline">engine3</strong> class shown here, we are not creating a <strong class="source-inline">Meta</strong> subclass and we will only give it one field. We also replaced <strong class="source-inline">models.Model</strong> with <strong class="source-inline">engine2</strong>. That is where we pass in the name of the class that we want to construct the new class from, otherwise known as extending or inheriting from that parent class.</p>
			<p>Running your Django migration<a id="_idIndexMarker457"/> commands now will result in an error, telling us that the <strong class="source-inline">chapter_3_practice_engine</strong> table already exists. To prevent this, we can do one of two things. We could rename the <strong class="source-inline">Meta</strong> class option <strong class="source-inline">db_table</strong> of the <strong class="source-inline">engine2</strong> class or we can drop all of the tables in the database and start fresh. </p>
			<h3>Dropping database tables</h3>
			<p>Since, currently, we do not have any real data<a id="_idIndexMarker458"/> to worry about and because we are so early in the development life cycle, it's okay to drop our tables. It is acceptable because we are still getting started with building the skeleton code of our project. We are also working with a local database, meaning we won't disrupt other developers' workflows by performing this task. Dropping your tables can be done using any database management tool. </p>
			<p>Follow these steps to drop your tables using PgAdmin:</p>
			<ol>
				<li value="1">In PgAdmin, navigate to <strong class="bold">Tools</strong> | <strong class="bold">Query Tool</strong>. </li>
				<li>In the tab that opens, enter the following two commands:<p class="source-code"><strong class="bold"># In the Query Tool of the PgAdmin App</strong></p><p class="source-code">DROP SCHEMA public CASCADE;</p><p class="source-code">CREATE SCHEMA public;</p></li>
				<li>Execute these commands by hitting the <strong class="bold">Execute/Refresh</strong> button or pressing <em class="italic">F5</em> on your keyboard.</li>
				<li>You will also need to delete all migration files found in any migrations folder, such as the <strong class="source-inline">/chapter_3/migrations/</strong> and <strong class="source-inline">/chapter_3/migrations/__pycache__/</strong> folders. <p class="callout-heading">Note</p><p class="callout">Every time tables are dropped, data is lost. The next time the Django migration commands are executed, the <strong class="source-inline">createsuperuser</strong> command should be executed and/or data fixtures loaded.</p></li>
				<li>Execute your Django<a id="_idIndexMarker459"/> migration commands one more time. The following screenshot shows that all of the fields and <strong class="source-inline">Meta</strong> class options that existed before in the <strong class="source-inline">engine2</strong> class now exist in the <strong class="source-inline">engine3</strong> class even though we did not write them for the <strong class="source-inline">engine3</strong> class:</li>
			</ol>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer046" class="IMG---Figure">
					<img src="image/Figure_3.6_B17243.jpg" alt="Figure 3.6 – PgAdmin – extended engine&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.6 – PgAdmin – extended engine</p>
			<p>We can see this because the <strong class="source-inline">Meta</strong> class <strong class="source-inline">db_table = 'chapter_3_practice_engine'</strong> option is placed in the <strong class="source-inline">engine2</strong> class and is what the <strong class="source-inline">engine3</strong> table is named. No table was created for the <strong class="source-inline">engine2</strong> class because it is configured as an abstract class. We also see that the two fields, <strong class="source-inline">name</strong> and <strong class="source-inline">vehicle_model</strong>, from the <strong class="source-inline">engine2</strong> class also get applied to the <strong class="source-inline">engine3</strong> class.</p>
			<p>Let's extend the built-in Django <strong class="source-inline">User</strong> class next.</p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor101"/>Extending the Django User model</h2>
			<p>Extending the Django <strong class="source-inline">User</strong> model <a id="_idIndexMarker460"/>will transform the <strong class="source-inline">Seller</strong> model, making it act as a <strong class="source-inline">User</strong> in the system. This means you can create a user profile that will have fields that do not come standard with Django; it will have fields that we create. This is done by constructing the <strong class="source-inline">Seller</strong> class using the <strong class="source-inline">AbstractUser</strong> or <strong class="source-inline">AbstractBaseUser</strong> class as the parent class. </p>
			<p>Follow these steps to extend your <strong class="source-inline">User</strong> class:</p>
			<ol>
				<li value="1">In your <strong class="source-inline">/chapter_3/models.py</strong> file, in the <strong class="source-inline">Seller</strong> class, replace <strong class="source-inline">models.Model</strong> with the <strong class="source-inline">AbstractUser</strong> parent class and include the <strong class="source-inline">import</strong> statement shown here:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code"><strong class="bold">from django.contrib.auth.models import AbstractUser</strong></p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Seller</strong>(<strong class="bold">AbstractUser</strong>):</p><p class="source-code">    ...</p></li>
			</ol>
			<p>An <strong class="source-inline">AbstractUser</strong> class will allow us to keep all of the original fields that exist in the <strong class="source-inline">User</strong> model. If we want to create a brand-new <strong class="source-inline">User</strong> model from scratch, use the <strong class="source-inline">AbstractBaseUser</strong> parent class instead. </p>
			<ol>
				<li value="2">We also need to adjust the value of the <strong class="source-inline">AUTH_USER_MODEL</strong> variable in the <strong class="source-inline">settings.py</strong> file, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/settings.py</strong></p><p class="source-code">...</p><p class="source-code">AUTH_USER_MODEL = '<strong class="bold">chapter_3.Seller</strong>'</p></li>
			</ol>
			<p>Use the <strong class="source-inline">app_name.model_name</strong> naming convention, paying attention to model class letter casing. Without adjusting this value, we will get a <strong class="bold">Reverse accessor error for 'auth.User.groups'</strong> error when we try to run the Django migration commands. This also means that Django will not use the standard <strong class="source-inline">User</strong> model for this project; instead, the <strong class="source-inline">Seller</strong> model will be used.</p>
			<ol>
				<li value="3">If we try to run the Django migration commands now, Django will ask us to assign a default value to the username and password fields. Since a username field needs to be unique, we can't just set a default value for this object easily because that will result in duplicate usernames. The reason this will happen is that we destroyed the previous <strong class="source-inline">auth_user</strong> tables in the database and created an entirely new set of relations for a <strong class="source-inline">User</strong>. Go ahead and drop your tables just like you did<a id="_idIndexMarker461"/> in the previous subsection, titled <em class="italic">Dropping database tables</em>. Now run the Django migrations commands. The following screenshot shows the <strong class="source-inline">chapter_3_seller</strong> table now has many other fields that we did not write: </li>
			</ol>
			<div>
				<div id="_idContainer047" class="IMG---Figure">
					<img src="image/Figure_3.7_B17243.jpg" alt="Figure 3.7 – PgAdmin – user model extension&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.7 – PgAdmin – user model extension</p>
			<p>Now that we have covered the basics of writing and extending models, let's use the Django shell to perform queries. We can use the Django shell to see the results of queries without having to learn about rendering templates first, which<a id="_idIndexMarker462"/> is what all of <a href="B17243_04_ePub.xhtml#_idTextAnchor116"><em class="italic">Chapter 4</em></a>, <em class="italic">URLs, Views, and Templates</em>, will cover.</p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor102"/>Using the Django shell</h1>
			<p>The <strong class="bold">Django shell</strong> is a powerful tool to add to any toolbox. It will activate<a id="_idIndexMarker463"/> the Python interactive interpreter and uses the Django database abstraction API to let us connect directly to the database(s) configured in a project. With this, we can write Python and perform queries directly from a terminal or command-line window.</p>
			<p>To activate the Django shell, follow these steps:</p>
			<ol>
				<li value="1">Open your terminal or command-line window and navigate to the root of your project. Make sure your virtual environment has been activated and then execute the following command:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p></li>
				<li>You should see it print out the following information about the <strong class="source-inline">InteractiveConsole</strong> that was launched:<p class="source-code"><strong class="bold">Python 3.7.8 (tags/v3.7.8:4b47a5b6ba, Jun 28 2020, 08:53:46) [MSC v.1916 64 bit (AMD64)] on win32</strong></p><p class="source-code"><strong class="bold">Type "help", "copyright", "credits" or "license" for more information.</strong></p><p class="source-code"><strong class="bold">(InteractiveConsole)</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt;</strong></p></li>
				<li>Your console will now display three right-angle brackets, where you can begin writing and executing Python code one line at a time. Theoretically, you could input an entire script this way, but it will not be saved anywhere, and your code will be lost when the window is closed or the <strong class="source-inline">InteractiveConsole</strong> is terminated. </li>
			</ol>
			<p>Now that this shell is activated, let's add sample data and perform a few queries to observe how it behaves.</p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor103"/>Running basic Python scripts</h2>
			<p>Earlier in this chapter, in the subsection<a id="_idIndexMarker464"/> titled <em class="italic">Mutable versus immutable objects</em>, it was mentioned<a id="_idIndexMarker465"/> that a Python string is one of the immutable data types that exist. An immutable string is one that cannot be reassigned a character at a particular index of that string after it has been created. This means that what is allowed is reassigning the value to that string altogether, and what is not allowed is changing the value of a character at a particular index. This is a basic fundamental of Python, and those who are new to Python can find this to be confusing. In this next example, we will demonstrate how to use the Django shell and at the same time demonstrate what makes a string immutable:</p>
			<ol>
				<li value="1">Launch the Python interactive interpreter by running the following Django shell command:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell </strong></p></li>
				<li>Assign a new variable called <strong class="source-inline">myvar</strong> and give it an initial value of <strong class="source-inline">my_string</strong>, as shown:<p class="source-code"><strong class="bold">&gt;&gt;&gt; myvar = 'my_string'</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; myvar[2] = ''</strong></p><p class="source-code"><strong class="bold">Traceback (most recent call last):</strong></p><p class="source-code"><strong class="bold">  File "&lt;console&gt;", line 1, in &lt;module&gt;</strong></p><p class="source-code"><strong class="bold">TypeError: 'str' object does not support item assignment</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt;</strong></p></li>
			</ol>
			<p>By executing the second statement shown in the previous code block, where we try to remove the underscore from the string at index <strong class="source-inline">2</strong>, we are receiving an error stating <strong class="source-inline">TypeError: 'str' object does not support item assignment</strong>. </p>
			<ol>
				<li value="3">If we just reassign the value of the <strong class="source-inline">myvar</strong> variable, as is done in the following code block, we will be able to remove the underscore this way:<p class="source-code"><strong class="bold">&gt;&gt;&gt; myvar = 'my_string'</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(myvar)</strong></p><p class="source-code"><strong class="bold">my_string</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; myvar = 'mystring'</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(myvar)</strong></p><p class="source-code"><strong class="bold">mystring</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; </strong></p></li>
			</ol>
			<p>In the preceding example, the first <strong class="source-inline">print</strong> statement returns <strong class="source-inline">my_string</strong> and then, after we change the value of <strong class="source-inline">myvar</strong>, the next <strong class="source-inline">print</strong> statement returns <strong class="source-inline">mystring</strong>. </p>
			<ol>
				<li value="4">We could use string<a id="_idIndexMarker466"/> indexes to look up characters<a id="_idIndexMarker467"/> and combine them but we cannot reassign a character at an index. The following example would remove the underscore by looking up characters at specified index ranges:<p class="source-code"><strong class="bold">&gt;&gt;&gt; myvar = 'my_string'</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(myvar[0:2] + myvar[3:9])</strong></p><p class="source-code"><strong class="bold">mystring</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; </strong></p></li>
				<li>Type <strong class="source-inline">exit()</strong> to quit using the interactive interpreter and return to using your <strong class="source-inline">manage.py</strong> commands:<p class="source-code"><strong class="bold">&gt;&gt;&gt; exit()</strong></p></li>
			</ol>
			<p>Now that we know how to execute basic Python scripts in the interactive interpreter, let's use this tool to generate a custom <strong class="source-inline">SECRET_KEY</strong> and set a project's <strong class="source-inline">.env</strong> file.</p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor104"/>Generating a SECRET_KEY variable</h2>
			<p>A <strong class="source-inline">SECRET_KEY</strong> variable<a id="_idIndexMarker468"/> in Django is used as a hash<a id="_idIndexMarker469"/> to secure things, such as your sessions, cookie storage, password tokenization, and all other methods of cryptographic signing that act to secure your site. Instead of using an online tool to generate this key, where the transmission either to or from that source could be compromised, you could generate your own using the Django shell. All we are doing is generating a random string. There is nothing special about this operation; you could technically use any combination of letters and numbers that you enter on a keyboard too. While this is not necessary since Django already generates a unique key for us when we create a new Django project, it is a useful step to allow us<a id="_idIndexMarker470"/> to create different keys to use on each of our Heroku<a id="_idIndexMarker471"/> environments. This way, we don't share the same <strong class="source-inline">SECRET_KEY</strong>.</p>
			<p>To generate your own <strong class="source-inline">SECRET_KEY</strong>, follow these steps:</p>
			<ol>
				<li value="1">Activate the Django shell in your terminal or command-line window and then import the method shown in the following code block:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from secret_key_generator import secret_key_generator</strong></p></li>
			</ol>
			<p>The method shown here comes from the package called <strong class="source-inline">secret_key_generator</strong>, which we installed in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>.</p>
			<ol>
				<li value="2">Next, execute the following <strong class="source-inline">print</strong> statement:<p class="source-code"><strong class="bold">&gt;&gt;&gt; print(secret_key_generator.generate())</strong></p><p class="source-code"><strong class="bold">your_randomly_generated_key_printed_here</strong></p></li>
				<li>Take the key that gets printed onscreen and use it to set or reset your environment variables. To reset your variables, just follow the same steps as were discussed in <a href="B17243_02_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Configuration</em>, under the subsection titled <em class="italic">Remote variables</em> and it will update your value with the new value.</li>
			</ol>
			<p>The preceding shell command also created for us a text file called <strong class="source-inline">.secret.txt</strong>, found in the root of your project, where your <strong class="source-inline">manage.py</strong> file is located. You can delete the <strong class="source-inline">.sectret.txt</strong> file as it is not needed.</p>
			<p>Now, let's use the Django <a id="_idIndexMarker472"/>shell to add data to our tables next, allowing us to use the Django<a id="_idIndexMarker473"/> shell to perform queries after that.</p>
			<h2 id="_idParaDest-94"><a id="_idTextAnchor105"/>Saving data</h2>
			<p>Creating and saving objects<a id="_idIndexMarker474"/> to your database using the Django shell is easy. After we have activated the Django shell, we need to import the models that we want to work with into memory just like when we import something at the top of any <strong class="source-inline">.py</strong> file. </p>
			<p>Follow these steps to create<a id="_idIndexMarker475"/> and save data using the Django shell:</p>
			<ol>
				<li value="1">Import your vehicle class objects using the <strong class="source-inline">InteractiveConsole</strong> window by executing the following commands:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from becoming_a_django_entdev.chapter_3.models import Engine, Seller, Vehicle, VehicleModel </strong></p></li>
			</ol>
			<p>These objects will be available for you to use until that window is closed or the <strong class="source-inline">exit()</strong> command is executed. </p>
			<ol>
				<li value="2">While these objects are loaded, it only takes the two lines of code shown in the following code block to create a new object and then save it:<p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle_model = VehicleModel(name = 'Enclave Avenir', make = 1)</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle_model.save()</strong></p></li>
			</ol>
			<p>The preceding lines will create and then save a <strong class="source-inline">VehicleModel</strong> object with the name of <strong class="source-inline">Enclave Avenir</strong> into the <strong class="source-inline">chapter_3_vehiclemodel</strong> table. In the creation of the <strong class="source-inline">vehicle_model</strong> object previously, we provided values to all of the fields that exist for that class. The value of the <strong class="source-inline">make</strong> field uses the numeric value of the tuple that we created earlier, called <strong class="source-inline">MAKE_CHOICES</strong>. </p>
			<ol>
				<li value="3">However, if we try to create an <strong class="source-inline">Engine</strong> object using a numeric value for the <strong class="source-inline">vehicle_model</strong> field, then we will be given a <strong class="source-inline">ValueError</strong>, as shown:<p class="source-code"><strong class="bold">&gt;&gt;&gt; engine = Engine(name = '3.6L DI DOHC 6cyl', vehicle_model = 1)</strong></p><p class="source-code"><strong class="bold">Traceback (most recent call last):</strong></p><p class="source-code"><strong class="bold">  ...</strong></p><p class="source-code"><strong class="bold">ValueError: Cannot assign "1": "Engine.model" must be a "VehicleModel" instance.</strong></p></li>
				<li>In order to successfully<a id="_idIndexMarker476"/> create an <strong class="source-inline">Engine</strong> object, we first have<a id="_idIndexMarker477"/> to create a <strong class="source-inline">VehicleModel</strong> object as we did for the <strong class="source-inline">vehicle_model</strong> temporary object in <em class="italic">step 2</em>. Then, use that variable to set as the value of the <strong class="source-inline">model</strong> field instead of using a numeric integer, as shown: <p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle_model = VehicleModel(name = 'Enclave Avenir', make = 1)</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle_model.save()</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; engine = Engine(name = '3.6L DI DOHC 6cyl', vehicle_model = vehicle_model)</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; engine.save()</strong></p></li>
			</ol>
			<p><em class="italic">Step 4</em> of the preceding example will likely result in an error due to us adding the <strong class="source-inline">unique = True</strong> argument to the <strong class="source-inline">name</strong> field of the <strong class="source-inline">VehicleModel</strong> class. This is also because we just created an object using the same name in <em class="italic">step 2</em>. You can get around that by providing a unique name or disregarding it and moving forward. This error was made intentionally for learning purposes. The error you receive should look like the one shown in the following code block, indicating that you have duplicate entries:</p>
			<p class="source-code">Traceback (most recent call last):</p>
			<p class="source-code">  File "C:\Projects\Packt_Publishing\Repo\becoming_a_django_entdev\virtual_env\lib\site-packages\django\db\backends\utils.py", line 84, in _execute</p>
			<p class="source-code">    return self.cursor.execute(sql, params)</p>
			<p class="source-code">psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "chapter_3_vehiclemodel_name_a94a4619_uniq"</p>
			<p class="source-code">DETAIL:  Key (name)=(Enclave Avenir) already exists.</p>
			<p class="source-code">...</p>
			<p class="source-code">The above exception was the direct cause of the following exception:</p>
			<p class="source-code">django.db.utils.IntegrityError: duplicate key value violates unique constraint "chapter_3_vehiclemodel_name_a94a4619_uniq"</p>
			<p class="source-code">DETAIL:  Key (name)=(Enclave Avenir) already exists.</p>
			<p>To get around this, we need to use the <strong class="source-inline">update_or_create()</strong> method instead of the <strong class="source-inline">save()</strong> method.</p>
			<p>If we try to create and then save<a id="_idIndexMarker478"/> an engine with a <strong class="source-inline">vehicle_model</strong> field<a id="_idIndexMarker479"/> that has not been already saved to the database, we will get a <strong class="source-inline">ValueError</strong> informing us that there is an unsaved related object present. If you wish to see this, create the <strong class="source-inline">vehicle_model</strong> object using the following values. Then, use that object to assign as the value of the <strong class="source-inline">vehicle_model</strong> field on the <strong class="source-inline">engine</strong> object and try to save:</p>
			<p class="source-code">&gt;&gt;&gt; vehicle_model = VehicleModel(name = 'Blazer LT', make = 3)</p>
			<p class="source-code">&gt;&gt;&gt; engine = Engine(name = '4 Cylinders 4 2.0L DI Turbo DOHC 122 CID', vehicle_model = vehicle_model)</p>
			<p class="source-code">&gt;&gt;&gt; engine.save()</p>
			<p class="source-code">Traceback (most recent call last):</p>
			<p class="source-code">  ...</p>
			<p class="source-code">ValueError: save() prohibited to prevent data loss due to unsaved related object 'model'.</p>
			<p>Once you try to save that <strong class="source-inline">engine</strong>, the error shown in the preceding code block would print to your screen, which is the reason why we need<a id="_idIndexMarker480"/> to save each related object before creating<a id="_idIndexMarker481"/> an object that they rely on.</p>
			<p>Let's discuss using the <strong class="source-inline">update_or_create()</strong> method next.</p>
			<h3>Model method – update_or_create()</h3>
			<p>We use the <strong class="source-inline">update_or_create()</strong> method instead<a id="_idIndexMarker482"/> of the <strong class="source-inline">save()</strong> method to create or modify an existing object. </p>
			<p>Follow these steps to use this method:</p>
			<ol>
				<li value="1">Make sure the Django shell is activated and then execute the following command:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle_model, created = VehicleModel.objects.update_or_create(name = 'Enclave Avenir', make = 1, defaults={'name': 'Enclave Avenir', 'make': 1},)</strong></p></li>
			</ol>
			<p>The preceding example should have been successful. If it was, then you received no errors, and you'll see the three right-angle brackets waiting for your next input command. </p>
			<ol>
				<li value="2">Using a database management tool such as PgAdmin, check to see that you have a <strong class="source-inline">VehicleModel</strong> record in your table with the name <strong class="source-inline">Enclave Avenir</strong>. The <strong class="source-inline">defaults</strong> argument in the preceding example is an optional argument that defines the values that you want to set if this operation creates a new record. Without it, the system will default to values set on your model fields instead.</li>
				<li>In this step, we will add a <strong class="source-inline">Vehicle</strong> to the database. It requires the use of a <strong class="source-inline">Money</strong> class to create a <strong class="source-inline">Money</strong> object. To use<a id="_idIndexMarker483"/> the <strong class="source-inline">Money</strong> class, execute the following <strong class="source-inline">import</strong> statement:<p class="source-code"><strong class="bold">&gt;&gt;&gt; from djmoney.money import Money</strong></p></li>
				<li>Now, execute the following three <strong class="source-inline">update_or_create()</strong> commands:<p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle_model, model_created = VehicleModel.objects.update_or_create(name = 'Blazer LT', make = 3,)</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; engine, engine_created = Engine.objects.update_or_create(name = '3.9L DI DOHC 6cyl', vehicle_model = vehicle_model,)</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle, vehicle_created = Vehicle.objects.update_or_create(vin = 'aa123456789012345', sold = True, price = Money(10000, 'USD'), make = 3, vehicle_model = vehicle_model, engine = engine,)</strong></p></li>
			</ol>
			<p>The commands in this subsection should have all resulted in success without errors.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If a vehicle with the same VIN as the one shown previously is already created for you by importing the data found in the <strong class="source-inline">chapter_3</strong> data fixture, then you can just change the <strong class="source-inline">vin</strong> value in the preceding example to a new and unique <strong class="source-inline">vin</strong> value. This allows you to witness a new record being added to your table when viewed in a database management tool such as PgAdmin.</p>
			<p>Let's discuss loading the <strong class="source-inline">chapter_3</strong> data fixture next.</p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor106"/>Loading the chapter_3 data fixture</h2>
			<p>Instead of providing<a id="_idIndexMarker484"/> steps on how to create all of the data<a id="_idIndexMarker485"/> that will be needed to demonstrate the exercises throughout the rest of this chapter and this book, we will be adding data from a data fixture. Adding data can be done in a much simpler way than how it was done from within the Django shell. We will discuss this concept in more depth and create our own fixtures later in <a href="B17243_10_ePub.xhtml#_idTextAnchor293"><em class="italic">Chapter 10</em></a>, <em class="italic">Database Management</em>. For now, make sure the <strong class="source-inline">/becoming_a_django_entdev/becoming_a_django_entdev/chapter_3/fixtures/</strong> folder and all of the files found in this folder from the code of this book are copied into your <strong class="source-inline">/chapter_3/</strong> app folder. The <strong class="source-inline">chapter_3</strong> fixture will provide enough data for us to work with the remaining examples of this chapter. </p>
			<p>To load your data fixture make sure you have exited your Django shell and that your virtual environment is active and then execute the following command:</p>
			<p class="source-code">(virtual_env) PS &gt; python3 manage.py loaddata chapter_3</p>
			<p>If you have issues with importing this fixture, double-check that your table structures match the structures of the models provided with the code of this book in the <strong class="source-inline">chapter_3</strong> app.</p>
			<p>The alternative would be to follow the steps in the <em class="italic">Saving data</em> subsection of this chapter to add your own sample data one painstaking item at a time. Create and save as many objects<a id="_idIndexMarker486"/> as you would like using those examples. If you were<a id="_idIndexMarker487"/> to create a <strong class="source-inline">Vehicle</strong> object, it would be done in the same way as creating an <strong class="source-inline">Engine</strong> object, except now you are defining the values of two related objects instead of one in order to save successfully. We just need to have a few objects to play around with in the next exercises of this chapter. </p>
			<h1 id="_idParaDest-96"><a id="_idTextAnchor107"/>Performing queries</h1>
			<p>Performing queries<a id="_idIndexMarker488"/> using the Django shell will give us some insight into how queries work. In the following subsections, we will discuss some common methods that a<a id="_idTextAnchor108"/>re used.</p>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor109"/>Model method – all()</h2>
			<p>The <strong class="source-inline">all()</strong> method returns<a id="_idIndexMarker489"/> all records found in the table for that model <a id="_idIndexMarker490"/>object. This method will return a QuerySet in the following format, representing all entries that it finds:</p>
			<p class="source-code">(virtual_env) PS &gt; python3 manage.py shell</p>
			<p class="source-code">&gt;&gt;&gt; from becoming_a_django_entdev.chapter_3.models import Engine, Seller, Vehicle, VehicleModel </p>
			<p class="source-code">&gt;&gt;&gt; VehicleModel.objects.all()</p>
			<p class="source-code">&lt;QuerySet [&lt;VehicleModel: Blazer LT&gt;, &lt;VehicleModel: Enclave Avenir&gt;, &lt;VehicleModel: Envision Avenir&gt;]&gt; </p>
			<p>The <strong class="source-inline">chapter_3</strong> data fixture only provides three VehicleModel and that is why a collection of only three objects is returned to us. Your results may vary. One of the reasons why we created a <strong class="source-inline">__str__()</strong> method, as was done earlier in this chapter, in the subsection titled <em class="italic">Model method – __str__</em>, is so that it could be represented in a logical way in code usage such as this, where the object name that gets printed out is a name that makes sense to us and not something that won't make sense. Without the <strong class="source-inline">__str__()</strong> method defined in the <strong class="source-inline">VehicleModel</strong> class, the QuerySet would have been returned to us in a manner that looks like the following example:</p>
			<p class="source-code">&lt;QuerySet [&lt;VehicleModel: VehicleModel object (3)&gt;, &lt;VehicleModel: VehicleModel object (2)&gt;, &lt;VehicleModel: VehicleModel object (1)&gt;]&gt;</p>
			<p>We would have no way to distinguish<a id="_idIndexMarker491"/> which object is which and what order they are in just<a id="_idIndexMarker492"/> by looking at the collection printed in this code block.</p>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor110"/>Model method – get()</h2>
			<p>The <strong class="source-inline">get()</strong> method is used<a id="_idIndexMarker493"/> to target a specific<a id="_idIndexMarker494"/> database record. </p>
			<p>Follow these steps to see this method in action:</p>
			<ol>
				<li value="1">Use <strong class="source-inline">get()</strong> to target the <strong class="source-inline">vin</strong> value of a vehicle when performing a query, as is done here:<p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicle = Vehicle.objects.get(vin = 'aa123456789012345')</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(vehicle)</strong></p><p class="source-code"><strong class="bold">Chevrolet Blazer LT</strong></p></li>
				<li>Using the single object that was returned to us, run the <strong class="source-inline">print</strong> statement again using the <strong class="source-inline">full_vehicle_name()</strong> method that we created earlier, to see the difference in the results that are generated:<p class="source-code"><strong class="bold">&gt;&gt;&gt; print(vehicle.full_vehicle_name())</strong></p><p class="source-code"><strong class="bold">Chevrolet Blazer LT - 3.6L DI DOHC 6cyl</strong></p></li>
				<li>Next, use the other <strong class="source-inline">fullname</strong> method with the <strong class="source-inline">@property</strong> decorator to return the exact same results:<p class="source-code"><strong class="bold">&gt;&gt;&gt; print(vehicle.fullname)</strong></p><p class="source-code"><strong class="bold">Chevrolet Blazer LT - 3.6L DI DOHC 6cyl</strong></p></li>
			</ol>
			<p>Django is using the format that we defined earlier in the <strong class="source-inline">__str__</strong> method to generate a string that gets printed to the screen in <em class="italic">step 1</em>. We already know that the <strong class="source-inline">vin</strong> field is set to <strong class="source-inline">unique = True</strong>, meaning there will never be two objects with the same <strong class="source-inline">vin</strong> value in the database, so we know that it is safe to use the <strong class="source-inline">get()</strong> method in all the preceding steps. If there<a id="_idIndexMarker495"/> are numerous items with the same value and a <strong class="source-inline">get()</strong> method<a id="_idIndexMarker496"/> is used, then you will need to use a <strong class="source-inline">filter()</strong> method instead.</p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor111"/>Model method – filter()</h2>
			<p>The <strong class="source-inline">filter()</strong> method is used to look up records<a id="_idIndexMarker497"/> in a database<a id="_idIndexMarker498"/> that may have the same field values. This method will return a collection of results instead of a single result. The collection will be returned to us as a <strong class="source-inline">QuerySet</strong>. For example, we can filter the <strong class="source-inline">VehicleModel</strong> table, which we already know contains three rows. </p>
			<p>The following example will filter the <strong class="source-inline">make</strong> field by the value of <strong class="source-inline">Buick</strong>, to return a collection of only two objects instead of three:</p>
			<p class="source-code"> &gt;&gt;&gt; print(VehicleModel.objects.filter(make = 1))</p>
			<p class="source-code">&lt;QuerySet [&lt;VehicleModel: Enclave Avenir&gt;, &lt;VehicleModel: Envision Avenir&gt;]&gt;</p>
			<p>Queries can get much more complex than using a simple <strong class="source-inline">all()</strong>, <strong class="source-inline">get()</strong>, or <strong class="source-inline">filter()</strong> method. Q objects provide more complicated queries as well. For a complete breakdown of how to use Q objects<a id="_idIndexMarker499"/> in Django, visit the documentation here: https://docs.djangoproject.com/en/4.0/ref/models/querysets/#q-objects. </p>
			<p>We can even obtain a summary of objects using arithmetic functions, which brings us to our nex<a id="_idIndexMarker500"/>t subsection, discussing<a id="_idIndexMarker501"/> aggregates.</p>
			<h2 id="_idParaDest-100"><a id="_idTextAnchor112"/>Aggregates</h2>
			<p>Django provides an easy way to generate<a id="_idIndexMarker502"/> a summary of a collection of objects, known as <strong class="bold">aggregates</strong>. What this means is that<a id="_idIndexMarker503"/> we can perform a query and use any one of the many <strong class="bold">aggregation functions</strong> that Django provides. This can be used to generate<a id="_idIndexMarker504"/> an average price for all the vehicles, generate an average price of just the sold vehicles, or generate a total count of vehicles for a particular seller. While there is a lot of information regarding the topic of aggregates and annotates, we will discuss some basic usages. A complete guide<a id="_idIndexMarker505"/> to generating aggregates in Django can be found here: <a href="https://docs.djangoproject.com/en/4.0/ref/models/querysets/#aggregation-functions">https://docs.djangoproject.com/en/4.0/ref/models/querysets/#aggregation-functions</a>.</p>
			<h3>Model method – aggregate()</h3>
			<p>Aggregates are used to generate a summary<a id="_idIndexMarker506"/> of every object in a QuerySet. To get an average<a id="_idIndexMarker507"/> price of every vehicle that exists in that table, we can use the <strong class="source-inline">Avg</strong> aggregate function. The argument that we pass into the <strong class="source-inline">Avg</strong> function is the field that we want to perform this operation on. </p>
			<p>Follow these steps to practice using aggregates:</p>
			<ol>
				<li value="1">Import your <strong class="source-inline">Vehicle</strong> model and the <strong class="source-inline">Avg</strong> class objects, as shown:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from becoming_a_django_entdev.chapter_3.models import Vehicle</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from django.db.models import Avg</strong></p></li>
				<li>Perform a query lookup using the <strong class="source-inline">all()</strong> method combined with the <strong class="source-inline">aggregate()</strong> method, as shown:<p class="source-code"><strong class="bold">&gt;&gt;&gt; vehicles = Vehicle.objects.all().aggregate(Avg('price'))</strong></p></li>
				<li>Print your <strong class="source-inline">vehicles</strong> object:<p class="source-code"><strong class="bold">&gt;&gt;&gt; print(vehicles)</strong></p><p class="source-code"><strong class="bold">{'price__avg': Decimal('16335.428571428571')}</strong></p></li>
			</ol>
			<p>The summary is returned as a dictionary object. </p>
			<ol>
				<li value="4">You can get the value of the <strong class="source-inline">price__avg</strong> key by executing the following <strong class="source-inline">print</strong> statement:<p class="source-code"><strong class="bold">&gt;&gt;&gt; print(vehicles['price__avg'])</strong></p><p class="source-code"><strong class="bold">16335.428571428571</strong></p></li>
			</ol>
			<p>The result of the average is, of course, not actually formatted in any particular currency type yet. </p>
			<ol>
				<li value="5">We can format<a id="_idIndexMarker508"/> it in US dollars by applying the same <strong class="source-inline">Money()</strong> conversion<a id="_idIndexMarker509"/> that we did before when we created and then saved our first vehicle in the database, by executing the following commands: <p class="source-code"><strong class="bold">&gt;&gt;&gt; from djmoney.money import Money</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(Money(vehicles['price__avg'], 'USD'))</strong></p><p class="source-code"><strong class="bold">$16,335.43</strong></p></li>
			</ol>
			<p>Where we wrote <strong class="source-inline">Vehicle.objects.all().aggregate()</strong> in <em class="italic">step 2</em> previously, the <strong class="source-inline">all()</strong> method is redundant. The <strong class="source-inline">aggregate()</strong> method basically does the same thing as the <strong class="source-inline">all()</strong> method, meaning we could write our statement as follows and produce the same results:</p>
			<p class="source-code"> &gt;&gt;&gt; vehicles = Vehicle.objects.aggregate(Avg('price'))</p>
			<p>We can also replace the <strong class="source-inline">all()</strong> method with any of the standard query methods, such as <strong class="source-inline">get()</strong> or <strong class="source-inline">filter()</strong>, as depicted in the following example:</p>
			<p class="source-code">&gt;&gt;&gt; vehicles = Vehicle.objects.filter(sold=False).aggregate(Avg('price'))</p>
			<p class="source-code">&gt;&gt;&gt; print(Money(vehicles['price__avg'], 'USD'))</p>
			<p class="source-code">$18,419.60</p>
			<p>Let's discuss<a id="_idIndexMarker510"/> annotations<a id="_idIndexMarker511"/> next.</p>
			<h3>Model method – annotate()</h3>
			<p>Annotations<a id="_idIndexMarker512"/> are used when we have<a id="_idIndexMarker513"/> objects that relate to other objects in a QuerySet and we want to generate a summary of every related object in that QuerySet. </p>
			<p>Follow these steps to practice using annotations:</p>
			<ol>
				<li value="1">Execute the following commands to provide a query of all sellers that exist in a table and then generate a count of only the sold vehicles that it finds:<p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from becoming_a_django_entdev.chapter_3.models import Seller, Vehicle</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from django.db.models import Avg, Count</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; sellers = Seller.objects.filter(vehicles__sold=True).annotate(Count('vehicles'))</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(sellers[0].vehicles__count)</strong></p><p class="source-code"><strong class="bold">2</strong></p></li>
				<li>Alter the preceding <strong class="source-inline">filter</strong> statement to count only the unsold vehicles, as shown:<p class="source-code"><strong class="bold">&gt;&gt;&gt; sellers = Seller.objects.filter(vehicles__sold=False).annotate(Count('vehicles'))</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; print(sellers[0].vehicles__count)</strong></p><p class="source-code"><strong class="bold">5</strong></p></li>
			</ol>
			<p>We need to specify the index at <strong class="source-inline">sellers[0]</strong> because a <strong class="source-inline">filter()</strong> method will always return a collection of objects, even if the query only results in one object. </p>
			<ol>
				<li value="3">Print the <strong class="source-inline">sellers</strong> collection to the screen, as shown:<p class="source-code"><strong class="bold">&gt;&gt;&gt; print(sellers)</strong></p><p class="source-code"><strong class="bold">&lt;QuerySet [&lt;Seller: admin&gt;]&gt;</strong></p></li>
			</ol>
			<p>We can see that there is only one <strong class="source-inline">Seller</strong> in the database at this time. We got the numbers <strong class="source-inline">2</strong> and then <strong class="source-inline">5</strong> as the results, for a total of seven vehicles that relate to that seller.</p>
			<p>Next, we will discuss<a id="_idIndexMarker514"/> model managers<a id="_idIndexMarker515"/> and how they can be used to perform advanced queries.</p>
			<h1 id="_idParaDest-101"><a id="_idTextAnchor113"/>Writing model managers</h1>
			<p>We now know that when we want<a id="_idIndexMarker516"/> to apply logic that pertains to a single object within a table, we will look into writing a model method. An advanced Django concept can allow us to add logic that would relate to the entire table of objects instead. That would be written using a <strong class="bold">model manager</strong> instead of a model method. By default, Django automatically creates a model manager for every model that you write. That manager is called the <strong class="source-inline">objects</strong> manager, as in when we write a query statement such as <strong class="source-inline">MyModel.objects.all()</strong>. Since the <strong class="source-inline">objects</strong> manager is already created for us, there is technically no need for us to create a model manager at all. However, custom model managers can be used in a project to provide additional methods that the entire table uses. We will discuss a simple use of this concept that adds filters to a table. To learn more about how model managers can be used in more depth, visit<a id="_idIndexMarker517"/> the official Django documentation, found here: <a href="https://docs.djangoproject.com/en/4.0/topics/db/managers/">https://docs.djangoproject.com/en/4.0/topics/db/managers/</a>. </p>
			<p>Take the following steps to apply a filter, separating the vehicle objects by make/manufacturer. Here, we will write a manager for the <strong class="source-inline">Buick</strong> vehicles and another manager for the <strong class="source-inline">Chevy</strong> vehicles. In a large project, it would also be wise to place your managers in a separate <strong class="source-inline">managers.py</strong> file and import them into <strong class="source-inline">models.py</strong> before using them. Let's just add them all to the <strong class="source-inline">models.py</strong> file for now:</p>
			<ol>
				<li value="1">In the <strong class="source-inline">/chapter_3/models.py</strong> file, add the following two model manager classes above your model classes and below any existing <strong class="source-inline">import</strong> statements, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">BuickVehicleManager</strong>(models.Manager):</p><p class="source-code">    def get_queryset(self):</p><p class="source-code">        return super().get_queryset()<strong class="bold">.filter(make=1)</strong></p><p class="source-code">class <strong class="bold">ChevyVehicleManager</strong>(models.Manager):</p><p class="source-code">    def get_queryset(self):</p><p class="source-code">        return super().get_queryset()<strong class="bold">.filter(make=3)</strong></p><p class="source-code">...</p></li>
				<li>In the <strong class="source-inline">/chapter_3/models.py</strong> file, add the following three model manager statements<a id="_idIndexMarker518"/> to your existing <strong class="source-inline">Vehicle</strong> class, below the model fields found in that class and above the <strong class="source-inline">Meta</strong> subclass, as shown:<p class="source-code"><strong class="bold"># /becoming_a_django_entdev/chapter_3/models.py</strong> </p><p class="source-code">...</p><p class="source-code">class <strong class="bold">Vehicle</strong>(models.Model):</p><p class="source-code">    # Place Model Fields Here</p><p class="source-code">    # The Default Model Manager</p><p class="source-code">    <strong class="bold">objects</strong> = <strong class="bold">models.Manager()</strong></p><p class="source-code">    # The Buick Specific Manager</p><p class="source-code">    <strong class="bold">buick_objects</strong> = <strong class="bold">BuickVehicleManager()</strong></p><p class="source-code">    # The Chevy Specific Manager</p><p class="source-code">    <strong class="bold">chevy_objects</strong> = <strong class="bold">ChevyVehicleManager()</strong></p><p class="source-code">    # Place Meta Class and Model Methods Here</p></li>
				<li>Next, open your terminal or command-line window and activate your virtual environment and the Django shell. Then, import the <strong class="source-inline">Vehicle</strong> model into <strong class="source-inline">InteractiveConsole</strong>, as is done here: <p class="source-code"><strong class="bold">(virtual_env) PS &gt; python3 manage.py shell</strong></p><p class="source-code"><strong class="bold">&gt;&gt;&gt; from becoming_a_django_entdev.chapter_3.models import Vehicle </strong></p></li>
				<li>Execute the following <strong class="source-inline">objects</strong> manager <strong class="source-inline">count()</strong> method:<p class="source-code"><strong class="bold">&gt;&gt;&gt; Vehicle.objects.all().count()</strong></p><p class="source-code"><strong class="bold">7</strong></p></li>
				<li>Execute the following <strong class="source-inline">buick_objects</strong> manager <strong class="source-inline">count()</strong> method:<p class="source-code"><strong class="bold">&gt;&gt;&gt; Vehicle.buick_objects.all().count()</strong></p><p class="source-code"><strong class="bold">2</strong></p></li>
				<li>Execute the following <strong class="source-inline">chevy_objects</strong> manager <strong class="source-inline">count()</strong> method:<p class="source-code"><strong class="bold">&gt;&gt;&gt; Vehicle.chevy_objects.all().count()</strong></p><p class="source-code"><strong class="bold">5</strong></p></li>
			</ol>
			<p>What we get in return<a id="_idIndexMarker519"/> are the vehicles that relate to each manager that we created, starting with the <strong class="source-inline">objects</strong> manager, then <strong class="source-inline">buick_objects</strong> and <strong class="source-inline">chevy_objects</strong>. This counts the filtered objects instead of providing us with a total count of all objects in that table. Even though we are still using the <strong class="source-inline">all()</strong> method, we only get all of the objects related to that filter. We also apply the <strong class="source-inline">count()</strong> method to print a numeric count of what gets returned in a QuerySet versus printing the names of each object, as was depicted in previous query examples.</p>
			<h1 id="_idParaDest-102"><a id="_idTextAnchor114"/>Summary</h1>
			<p>In this chapter, we learned that models are building blocks of everything else we build that accesses data in a database. They provide the containers where all of a project's data will exist as a data storage device for this application. We now have a toolbox with tools related to the structure of the tables, such as the columns that exist or rules/constraints that we apply to them. Other tools help us to link these tables together that build the relationships between those tables. We also know how to transform the data that we have to provide other data not kept in those tables, but rather derived from it. Some of the concepts add performance power by doing work in the background, indexing data, and reducing the time that it takes to look up information. Querying objects is also a complex subject and there is a lot of material regarding it; use the concepts in this chapter to help guide you through researching more advanced ways of querying data, to help with complex real-world scenarios. Later, in <a href="B17243_10_ePub.xhtml#_idTextAnchor293"><em class="italic">Chapter 10</em></a>, <em class="italic">Database Management</em>, we will discuss other tricks that help to enhance database performance when performing database queries. </p>
			<p>Next, let's take the models that we created in this chapter and render that data onto an actual web page, finally viewing something within a browser. These will be the URLs, views, and templates that we create in the next chapter.</p>
		</div>
	</body></html>