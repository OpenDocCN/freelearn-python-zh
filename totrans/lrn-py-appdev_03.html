<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Modularize, Package, Deploy!"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Modularize, Package, Deploy!</h1></div></div></div><p>In the past few chapters, you wrote a simple application, added new features to it, and made sure that some commonly encountered bugs were fixed. Now, it is time to make it available to a broader audience. In this chapter, you will learn the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Modularizing and packaging the code written in earlier chapters</li><li class="listitem" style="list-style-type: disc">Preparing and deploying a source distribution</li><li class="listitem" style="list-style-type: disc">Setting up a private Python package repository</li><li class="listitem" style="list-style-type: disc">Making incremental releases</li><li class="listitem" style="list-style-type: disc">Bringing your code under version control</li></ul></div><p>Thanks to word of mouth publicity, the high fantasy game application is gaining further attention. More and more people are requesting access to the code, either to use the functionality in their own application or to simply play the game. So far, you have sent the complete source code to the users requesting it. But, it is silly to continue doing that because you have made quite a few frequent upgrades.</p><p>There are several ways to handle this. The most basic option is to host the code on some server and ask the users to download it from that location. Another option is to use a version control system such as <span class="strong"><strong>Git</strong></span>
<a id="id144" class="indexterm"/> to manage the code and let others clone it. Yet another option, which we will see next, is to deploy this as a Python package.</p><div class="mediaobject"><img src="graphics/B05034_03_01.jpg" alt="Modularize, Package, Deploy!"/></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="emphasis"><em>Not so fast, Sir Foo! We have to do some preparatory work first. Hold on to your enthusiasm for now. By the way, your army is still far away. You will be reunited with your comrades in arms in </em></span>
<a class="link" href="ch06.html" title="Chapter 6. Design Patterns">Chapter 6</a>, <span class="emphasis"><em>Design Patterns</em></span>.</p>
</td></tr></tbody></table></div><div class="section" title="Selecting a versioning convention"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Selecting a versioning convention</h1></div></div></div><p>How do we name new <a id="id145" class="indexterm"/>versions of the code? There are several versioning schemes in use. Let's quickly review a few popular ones.</p><div class="section" title="Serial increments"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Serial increments</h2></div></div></div><p>In this scheme, you <a id="id146" class="indexterm"/>just increment the version number in a serial manner for each upgrade, for example, v1, v2, v3, and so on. However, this does not give any information on what a particular release is about. Just by looking at the version number, it is tough to tell whether a particular version introduces a revolutionary feature or just fixes a minor bug. It does not give any information on API compatibility. You can choose this simple versioning scheme if it is a small application with <a id="id147" class="indexterm"/>a small user base and a very limited scope.</p><div class="mediaobject"><img src="graphics/B05034_03_12.jpg" alt="Serial increments"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>
<span class="strong"><strong>API compatibility</strong></span>
</p><p>An <span class="strong"><strong>Application Programming Interface</strong></span> (<span class="strong"><strong>API</strong></span>), <a id="id148" class="indexterm"/>in simple terms, enables a piece of a program, say a library or an application, to talk to another one using a standard set of functions, methods, or objects.</p><p>Imagine a software<a id="id149" class="indexterm"/> library <code class="literal">car</code> that stores some data on a fancy car. You have an application that wishes to get some information on the car color. The library says, "just call my <code class="literal">color()</code> method to get what you need." Here, the <code class="literal">color()</code> method is an API method of the <code class="literal">car</code> library. With this information, you have started using <code class="literal">car.color()</code> within your application.</p><p>In the latest version of the <code class="literal">car</code> library, <code class="literal">color()</code> has been renamed to <code class="literal">get_color()</code>. If you switch to this new version, it will break your application code as you are still using <code class="literal">car.color()</code> to retrieve the color information from the library. In this case, the new API is said to be incompatible with the older releases of the library. Conversely, a <span class="strong"><strong>backward compatible</strong></span> API<a id="id150" class="indexterm"/> is where applications using the older version of the library will continue to run smoothly even with the newer one. This is just one way to look at API compatibility.</p></div></div></div><div class="section" title="Using a date format"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Using a date format</h2></div></div></div><p>In this convention, the <a id="id151" class="indexterm"/>release name is tagged by embedding information on when it was released. For example, it may follow the YYYY-MM convention to include the year and month of release. Such a convention helps determine how old a particular release is. However, as before, the release name itself does not give any information about API compatibility unless you follow some hybrid naming convention. This scheme is typically useful if you are following a regular release schedule or have some time sensitive features in the release.</p></div><div class="section" title="Semantic versioning scheme"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Semantic versioning scheme</h2></div></div></div><p>This is a recommended <a id="id152" class="indexterm"/>versioning convention. In the application we have developed so far, we loosely followed the semantic versioning scheme. In this scheme, the release is represented by three numbers (<span class="strong"><strong>MAJOR.MINOR.PATCH</strong></span>). For example, when we say version 1.2.4, it implies that the major version number is 1, minor version is 2, and patch or maintenance version number is 4. The major version number is incremented when you introduce incompatible changes to the API that access functionality from your package. The minor version is incremented when some new minor functionality is added to the package while keeping the code backward compatible. For example, you add a new internal feature to the next version, but that does not break any code from the previous version. The API to access functionality from the package remains the same as before. The last number represents the patch. It is incremented when some bugs are fixed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip18"/>Tip</h3><p>Python <span class="emphasis"><em>PEP 440</em></span> specification<a id="id153" class="indexterm"/> talks in depth about the semantic versioning scheme for Python distributions. This is what the Python community recommends. You can find this specification at <a class="ulink" href="https://www.python.org/dev/peps/pep-0440/">https://www.python.org/dev/peps/pep-0440/</a>. Choose the versioning convention that best suits your application.</p><p>The versioning scheme illustrated in this book only loosely follows semantic versioning. For instance, in earlier illustrations, after fixing some important bugs, we updated the minor version number instead of the patch version number.</p></div></div><p>With this understanding of various versioning conventions, let's go back to the <span class="emphasis"><em>Attack of the Orcs</em></span> code and split it into independent modules. This would be our first step toward creating a<a id="id154" class="indexterm"/> package.</p></div></div></div>
<div class="section" title="Modularizing the code"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Modularizing the code</h1></div></div></div><p>We have been referring to<a id="id155" class="indexterm"/> modules in the earlier chapters. An explanation is in order. A single Python file with a <code class="literal">.py</code> extension is a <a id="id156" class="indexterm"/>
<span class="strong"><strong>module</strong></span>. You can use this module in some other source code using an <code class="literal">import</code> statement. The module name is the same as the file name, except the <code class="literal">.py</code> extension. For example, if the file name is <code class="literal">knight.py</code>, then <code class="literal">import knight</code> will import the module into your source file.</p><p>In this section, we will split the code in the <code class="literal">attackoftheorcs_v1_1.py</code> file into individual modules. You can find this file in the supporting code bundle for the previous chapter.</p><div class="section" title="Attack of the Orcs v2.0.0"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec47"/>Attack of the Orcs v2.0.0</h2></div></div></div><p>We will name<a id="id157" class="indexterm"/> this version 2.0.0. The major version is incremented to 2 as we are about to make some API level changes. The way we access functionality from the code will change after introduction of the new modules. Let's review the source file, <code class="literal">attackoftheorcs_v1_1.py</code>, from <a class="link" href="ch02.html" title="Chapter 2. Dealing with Exceptions">Chapter 2</a>, <span class="emphasis"><em>Dealing with Exceptions</em></span>. The first step is to create a module (a new file) for each of the classes. The module name should preferably be all lowercase.</p><div class="mediaobject"><img src="graphics/B05034_03_02.jpg" alt="Attack of the Orcs v2.0.0"/></div><p>Let's take a look at the <a id="id158" class="indexterm"/>code in the preceding screenshot:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a new module called <code class="literal">gameutils.py</code> and copy the utility functions <code class="literal">weighted_random_selection</code> and <code class="literal">print_bold</code> into this module.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">attackoftheorcs.py</code> file holds the <code class="literal">AttackOfTheOrcs</code> class. In the same file, copy the main execution code that runs the game. Optionally, create a new module for the main code.</li><li class="listitem" style="list-style-type: disc">Refer to the code from the previous screenshot and put the other classes in their own modules.</li></ul></div><p>We are not done yet. Splitting the code into a bunch of modules gives rise to unresolved references. We need to fix these new errors now. This was not a problem earlier as the entire code was in a single file. For example, while creating <code class="literal">Hut</code> instances in the <code class="literal">AttackOfTheOrcs</code> class, Python could find the <code class="literal">Hut</code> class definition right in the same file. Now, we need to import these classes from their respective modules.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip19"/>Tip</h3><p>If you are using an IDE such as<a id="id159" class="indexterm"/> PyCharm, it is very easy to detect such unresolved references using the <a id="id160" class="indexterm"/>
<span class="strong"><strong>code inspection</strong></span> feature. The IDE will show a visual indication (for example, a red underline) for all problematic references. Additionally, the Inspect Code feature lets you find all the problem code in one go.</p></div></div><p>Add the following<a id="id161" class="indexterm"/> <code class="literal">import</code> statements at the beginning of the <code class="literal">attackoftheorcs.py</code> file:</p><div class="mediaobject"><img src="graphics/B05034_03_13.jpg" alt="Attack of the Orcs v2.0.0"/></div><p>Here, we import the <code class="literal">Hut</code> class from the new module called <code class="literal">hut</code>, and so on. The following code screenshot shows the <code class="literal">import</code> statements in the <code class="literal">knight.py</code> file:</p><div class="mediaobject"><img src="graphics/B05034_03_14.jpg" alt="Attack of the Orcs v2.0.0"/></div><p>The following code screenshot shows the <code class="literal">import</code> statements in the <code class="literal">abstractgameunit.py</code> file:</p><div class="mediaobject"><img src="graphics/B05034_03_15.jpg" alt="Attack of the Orcs v2.0.0"/></div><p>Likewise, you have to update all the remaining files and include the necessary <code class="literal">import</code> statements. Those changes are not discussed here. For further details, you can refer to the corresponding files in this chapter's supporting code bundle.</p><p>Put all the new modules in a directory, call it <code class="literal">wargame</code> or give it any name you like. Recall that in <a class="link" href="ch02.html" title="Chapter 2. Dealing with Exceptions">Chapter 2</a>, <span class="emphasis"><em>Dealing with Exceptions</em></span>, we had created a class called <code class="literal">GameUnitError</code> in a <code class="literal">gameuniterror.py</code> file. Make sure to copy this file into the new directory. The directory structure after copying <code class="literal">gameuniterror.py</code> is shown in the next screenshot:</p><div class="mediaobject"><img src="graphics/B05034_03_16_wargame_dir.jpg" alt="Attack of the Orcs v2.0.0"/></div><p>As the last step, let's<a id="id162" class="indexterm"/> verify that the application runs smoothly by executing the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python attackoftheorcs.py</strong></span>
</pre></div><p>Where <code class="literal">python</code> is either version 3.5 or 2.7.9 (or higher), depending on your environment.</p></div></div>
<div class="section" title="Creating a package"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Creating a package</h1></div></div></div><p>Now that we have <a id="id163" class="indexterm"/>modularized the code, let's create a Python package. What is a package? It is a kind of fancy name for a directory where Python modules are located. However, there is more to it than that. For such a directory to be called a package, it must also contain an <code class="literal">__init__.py</code> file. This file can be kept empty or you can put some initialization code in this file. To transform the <code class="literal">wargame</code> directory as a Python package, we will create an empty <code class="literal">__init__ .py</code> file in this directory. The new directory structure is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B05034_03_17_new_wargamedir.jpg" alt="Creating a package"/></div><div class="section" title="Importing from the package"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec48"/>Importing from the package</h2></div></div></div><p>Let's see how to use the <a id="id164" class="indexterm"/>functionality from this newly created package. To test this out, create a new file, <code class="literal">run_game.py</code>, at the same directory level as the <code class="literal">wargame</code> package. The directory structure will appear as follows. Here, <code class="literal">mydir</code> is the top-level directory (it can be any name):</p><div class="mediaobject"><img src="graphics/B05034_03_18_rungame_wargame_dir.jpg" alt="Importing from the package"/></div><p>Add the following code to the <code class="literal">run_game.py</code> file:</p><div class="mediaobject"><img src="graphics/B05034_03_19.jpg" alt="Importing from the package"/></div><p>The first line is the new <code class="literal">import</code> statement. Here, we are importing the <code class="literal">AttackOfTheOrcs</code> class from the <code class="literal">attackoftheorcs.py</code> file. If you execute this file in a terminal window, the program might abruptly end with the error traceback shown in the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python run_game.py</strong></span>
<span class="strong"><strong>Traceback (most recent call last): </strong></span>
<span class="strong"><strong>  File "run_game.py", line 2, in &lt;module&gt; </strong></span>
<span class="strong"><strong>    from wargame.attackoftheorcs import AttackOfTheOrcs </strong></span>
<span class="strong"><strong>  File "/mydir/wargame/attackoftheorcs.py", line 29, in &lt;module&gt; </strong></span>
<span class="strong"><strong>    from hut import Hut </strong></span>
<span class="strong"><strong>ImportError: No module named 'hut'</strong></span>
</pre></div><p>Such an error will occur if the <code class="literal">wargame</code> directory path is not included in the Python environment. In the error traceback, it is unable to find the <code class="literal">hut.py</code> file. The file is located at <code class="literal">/mydir/wargame/hut.py</code>. However, the location <code class="literal">/mydir/wargame</code> is not in Python's search path. As a result, it cannot find the modules in this directory. There are several ways to fix this. The simplest option is to specify a <code class="literal">PYTHONPATH</code> environment variable in the terminal. In the Bash shell of Linux OS, this can be specified as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ export PYTHONPATH=$PYTHONPATH:/mydir/wargame</strong></span>
</pre></div><p>On Windows OS, you can set it from the command prompt, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; set PYTHONPATH=%PYTHONPATH%;C:\mydir\wargame</strong></span>
</pre></div><p>Just replace <code class="literal">/mydir/wargame</code> with the appropriate path on your system. Another way to fix the problem is to add a <code class="literal">sys.path.append</code> <code class="literal">("/mydir/wargame")</code> statement at the beginning of the code in <code class="literal">run_game.py</code> before the <code class="literal">import</code> statement, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">import sys 
sys.path.append("/mydir/wargame") 
from wargame.attackoftheorcs import AttackOfTheOrcs</pre></div><p>With both these options, however, you have to specify the full path. Yet another way to handle the problem is to add the following code in the <code class="literal">wargame/__init__.py</code> file:</p><div class="informalexample"><pre class="programlisting">import sys 
import os 
current_path = os.path.dirname(os.path.abspath(__file__)) 
sys.path.append(current_path) 
# optionally print the sys.path for debugging)
#print("in __init__.py sys.path:\n ",sys.path)</pre></div><p>The current path gives the absolute path to the directory where the <code class="literal">__init__.py</code> file is located. With this update, you should be all set to run the game.</p></div></div>
<div class="section" title="Releasing the package on PyPI"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Releasing the package on PyPI</h1></div></div></div><p>The <span class="strong"><strong>Python Package Index</strong></span> (<span class="strong"><strong>PyPI</strong></span>) ( <a class="ulink" href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a>) is<a id="id165" class="indexterm"/> a package distribution mechanism for the Python community. It is the official repository for the third-party packages. By default, the <a id="id166" class="indexterm"/>Python package manager, pip, searches this<a id="id167" class="indexterm"/> repository to install the packages.</p><p>This is the place where we will upload our source distribution and make it generally available to the Python community. The PyPI repository has a devoted <span class="strong"><strong>test server</strong></span>
<a id="id168" class="indexterm"/> (<a class="ulink" href="https://testpypi.python.org/pypi">https://testpypi.python.org/pypi</a>) for developers who are just learning to package their code. As this is a learning activity, we will first deploy our package on the test server.</p><div class="section" title="Prepare the distribution"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec49"/>Prepare the distribution</h2></div></div></div><p>Let's start by laying out<a id="id169" class="indexterm"/> the ground work for the release. We first need to prepare the distribution to be released. The following steps provide a minimal set of instructions to prepare the distribution.</p><div class="section" title="Step 1 – Setting up the package directory"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec10"/>Step 1 – Setting up the package directory</h3></div></div></div><p>Make a new <a id="id170" class="indexterm"/>directory, and call it <code class="literal">testgamepkg</code> or give it any name you like. In this directory, copy the <code class="literal">wargame</code> package we created earlier. Now, create the following four empty files in this directory, <code class="literal">README</code>, <code class="literal">LICENSE.txt</code>, <code class="literal">MANIFEST.in</code>, and a <code class="literal">setup.py</code> file. The directory tree is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B05034_03_20_testgamepkg_dir.jpg" alt="Step 1 – Setting up the package directory"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>It is not required to create a new directory, <code class="literal">testgamepkg</code>. Instead, you can create these four files in the same directory where the <code class="literal">wargame</code> package is present. All these files can also be found in the supporting material for this chapter.</p></div></div><p>Next, we will add contents to each of these new files.</p></div><div class="section" title="Step 2 – Writing the setup.py file"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Step 2 – Writing the setup.py file</h3></div></div></div><p>The <code class="literal">setup.py</code> file is a<a id="id171" class="indexterm"/> required file that contains the metadata for the package you want to release. Let's write the following code in this file:</p><div class="mediaobject"><img src="graphics/B05034_03_05.jpg" alt="Step 2 – Writing the setup.py file"/></div><p>The <code class="literal">import</code> statement on the first line imports the built-in <code class="literal">setup</code> function. On the next few lines, the contents of the <code class="literal">README</code> file are stored in a string called <code class="literal">readme</code>. Finally, we call the <code class="literal">setup</code> function with various arguments, as shown in the preceding code snippet.</p><p>Out of these arguments, only <code class="literal">name</code>, <code class="literal">version</code>, and <code class="literal">packages</code> are required fields. You can add several other optional metadata arguments to the <code class="literal">setup</code> function. In the preceding code, we have specified the most common ones.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip21"/>Tip</h3><p>The <code class="literal">setup</code> function takes several optional arguments. See the API reference (<a class="ulink" href="https://docs.python.org/3/distutils/apiref.html">https://docs.python.org/3/distutils/apiref.html</a>) for details.</p></div></div><p>In the code, update the <code class="literal">name</code> field with a unique string. Make sure that the name is not already taken as a PyPI package. The <code class="literal">version</code> field represents the current version of the package. Earlier in the chapter, we gave the version number 2.0.0 to the modularized code. You can either go with this scheme or use your own versioning convention. The third required field, <code class="literal">packages</code>, is a list of source packages to be included in the distribution. In this case, it is just the <code class="literal">wargame</code> package that contains all the code. The string stored in the <code class="literal">long_description</code> field is used to display the home page for the package on the PyPI website. In the code, we will put the contents of the <code class="literal">README</code> file as <code class="literal">long_description</code>.</p></div><div class="section" title="Step 3 – Updating the README and LICENSE.txt files"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec12"/>Step 3 – Updating the README and LICENSE.txt files</h3></div></div></div><p>In the <code class="literal">LICENSE.txt</code> file, simply<a id="id172" class="indexterm"/> copy the license description under <a id="id173" class="indexterm"/>which you want to release the package. For example, if you are distributing this package under the <span class="strong"><strong>MIT License</strong></span>
<a id="id174" class="indexterm"/> (<a class="ulink" href="https://opensource.org/licenses/MIT">https://opensource.org/licenses/MIT</a>), copy and paste the MIT License description in this file.</p><p>The <code class="literal">README</code> file is the file where you can add a detailed description of your project. PyPI expects this file to be in the <span class="strong"><strong>reStructuredText</strong></span> (<span class="strong"><strong>RST)</strong></span>
<a id="id175" class="indexterm"/> or <code class="literal">.rst</code> format. More information on this format is available at <a class="ulink" href="http://docutils.sourceforge.net/rst.html">http://docutils.sourceforge.net/rst.html</a>. Here is an example of the <code class="literal">README</code> file. Note that the new lines before each heading and the one after the keyword <code class="literal">.. code:: python</code> are important:</p><div class="informalexample"><pre class="programlisting">Attack of the Orcs 
================== 

Introduction 
------------- 
This is a command line fantasy war game! 

Documentation 
-------------- 
Documentation can be found at... 

Example Usage 
------------- 
Here is an example to import the modules from this package. 

.. code:: python 

    from wargame.attackoftheorcs import AttackOfTheOrcs 
    game = AttackOfTheOrcs() 
    game.play() 
   
LICENSE 
------- 
See LICENSE.txt file.</pre></div></div><div class="section" title="Step 4 – Updating the MANIFEST.in file"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec13"/>Step 4 – Updating the MANIFEST.in file</h3></div></div></div><p>By default, <code class="literal">distutils</code> includes<a id="id176" class="indexterm"/> the following files while creating the distribution:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">README</code>, <code class="literal">README.txt</code>, <code class="literal">setup.py</code>, or <code class="literal">setup.cfg</code> files are present in the top-level distribution directory</li><li class="listitem" style="list-style-type: disc">All the <code class="literal">*.py</code> files implied by the packages list in <code class="literal">setup.py</code></li><li class="listitem" style="list-style-type: disc">All the <code class="literal">test/test*.py</code> files</li><li class="listitem" style="list-style-type: disc">The <code class="literal">C</code> source files indicated by <code class="literal">libraries</code> or <code class="literal">ext_modules</code> in <code class="literal">setup.py</code></li></ul></div><p>But what if you want to include some additional files in your project? For example, we wish to ship <code class="literal">LICENSE.txt</code> along with the distribution. It won't get included as there is no provision to add<a id="id177" class="indexterm"/> it by default. For this, <code class="literal">distutils</code> looks for a template file called <code class="literal">MANIFEST.in</code>, where custom rules can be specified for the inclusion of additional files.</p><p>Let's edit the <code class="literal">MANIFEST.in</code> file and make a rule for the inclusion of <code class="literal">LICENSE.txt</code>. Add the following line to this file and save it:</p><div class="informalexample"><pre class="programlisting">include *.txt </pre></div><p>Each line in this template represents a command. The preceding line tells Python to include all the <code class="literal">.txt</code> files in the top-level distribution directory. Thus, <code class="literal">LICENSE.txt</code> will now get included in the distribution.</p><p>All the files are now updated. It is time to build the distribution now!</p></div><div class="section" title="Step 5 – Build a deployment-ready distribution"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec14"/>Step 5 – Build a deployment-ready distribution</h3></div></div></div><p>Let's create a source <a id="id178" class="indexterm"/>distribution. In a terminal window, run the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd testgamepkg</strong></span>
<span class="strong"><strong>$ python setup.py sdist </strong></span>
</pre></div><p>The <code class="literal">sdist</code> command creates a distribution with the source files included. Running the second command creates a new <code class="literal">dist</code> directory containing an archive file. For example, in <code class="literal">setup.py</code>, if the <code class="literal">name</code> field is <code class="literal">testgamepkg</code> and the <code class="literal">version</code> is <code class="literal">2.0.0</code>, the archive will be <code class="literal">testgamepkg-2.0.0.tar.gz</code> on Linux and <code class="literal">testgamepkg-2.0.0.zip</code> on Windows OS. </p><p>Additionally, it creates a <code class="literal">MANIFEST</code> file with a list of all the included files in the package. The following screenshot shows the command-line output after running the <code class="literal">python setup.py sdist</code> command:</p><div class="mediaobject"><img src="graphics/B05034_03_06.jpg" alt="Step 5 – Build a deployment-ready distribution"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>
<span class="strong"><strong>Creating a bdist</strong></span>
</p><p>The <code class="literal">sdist</code> command creates <a id="id179" class="indexterm"/>a source distribution. The examples in this chapter will only use <code class="literal">sdist</code> . However, you can also create a built distribution. The simplest way to create a built distribution is <code class="literal">$ python setup.py bdist</code>. This creates a default built distribution for your platform, such as <code class="literal">dist/testgamepkg-2.0.0.linux-x86_64.tar.gz</code> on Linux OS. As an exercise, create this distribution and see the contents of the archive. Another way to create a <code class="literal">bdist</code> is with a<a id="id180" class="indexterm"/> Python package called <code class="literal">wheel</code> (<a class="ulink" href="https://pypi.python.org/pypi/wheel">https://pypi.python.org/pypi/wheel</a>). It is a built package format, although there is some work involved to use <code class="literal">wheel</code>. You can try this as yet another exercise. You may need to do the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pip install pip --upgrade </strong></span>
<span class="strong"><strong>$ pip install wheel </strong></span>
<span class="strong"><strong>$ pip install setuptools –upgrade</strong></span>
</pre></div><p>Then, add the following <code class="literal">import</code> statement to <code class="literal">setup.py</code> file: <code class="literal">import setuptools</code>. Finally, run the command <code class="literal">$ python setup.py bdist_wheel</code>. This will create a distribution archive in the <code class="literal">dist</code> directory with a <code class="literal">.whl</code> extension.</p></div></div></div></div><div class="section" title="Uploading the distribution"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec50"/>Uploading the distribution</h2></div></div></div><p>The <a id="id181" class="indexterm"/>distribution is ready for deployment. Let's deploy it now!</p><div class="section" title="Step 1 – Creating an account on PyPI test website"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec15"/>Step 1 – Creating an account on PyPI test website</h3></div></div></div><p>If you do not have an <a id="id182" class="indexterm"/>account on the PyPI testing site<a id="id183" class="indexterm"/>, create one at <a class="ulink" href="https://testpypi.python.org/pypi?:action=register_form">https://testpypi.python.org/pypi?:action=register_form</a>. Follow the steps on this website to create a new account.</p></div><div class="section" title="Step 2 – Creating a .pypirc file"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec16"/>Step 2 – Creating a .pypirc file</h3></div></div></div><p>This is an<a id="id184" class="indexterm"/> important step. Python assumes the default repository for uploading distributions is <a class="ulink" href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a>. However, the PyPI test server has a different address that needs to be specified in a <code class="literal">.pypirc</code> file (notice the dot at the beginning of the name). This file has a special format. Add the following contents to the <code class="literal">.pypirc</code> file:</p><div class="informalexample"><pre class="programlisting">[distutils] 
index-servers= 
pypitest 

[pypitest] 
repository = https://testpypi.python.org/pypi 
username=&lt;add username&gt;
password=&lt;add password&gt;</pre></div><p>The file has details of the PyPI test repository under the header <code class="literal">[pypitest]</code>. In this file, you can store different profiles. Here, <code class="literal">[pypitest]</code> is a profile that stores the repository URL and your user credentials for the PyPI test repository. This provides a convenient way to specify the account credentials and repository URL while registering or uploading the distribution. The name of the profile can be changed to any other string, as long as the corresponding entry in the <code class="literal">index-servers</code> variable is updated. For example, you can name it <code class="literal">[test]</code>. You can also create multiple such profiles if you have multiple accounts on the PyPI or PyPI test websites.</p><p>In this file, update the <code class="literal">username</code> and <code class="literal">password</code> fields with your actual credentials and save the file. On Linux OS, put this file in the user home directory: <code class="literal">~/.pypirc</code>. On Windows OS, create<a id="id185" class="indexterm"/> it at <code class="literal">C:\Users\user_name\.pypirc</code>. Replace <code class="literal">user_name</code> with the actual username.</p></div><div class="section" title="Step 3 – Register your project"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec17"/>Step 3 – Register your project</h3></div></div></div><p>A simple way to register your <a id="id186" class="indexterm"/>project is to log in to the test PyPI website and then use the package submission form: <a class="ulink" href="https://testpypi.python.org/pypi?:action=register_form">https://testpypi.python.org/pypi?:action=register_form</a>
</p><p>Alternatively, the project registration can also be done using the command line. Open a terminal window and type the following commands. Replace the <code class="literal">/path/to/testgamepkg</code> with the actual path to the directory containing <code class="literal">setup.py</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd /path/to/testgamepkg</strong></span>
<span class="strong"><strong>$ python setup.py register -r pypitest</strong></span>
</pre></div><p>The <code class="literal">-r</code> option for the <code class="literal">register</code> command is used to specify the URL of the PyPI test repository. Notice that, instead of the URL, we have simply written the profile name, <code class="literal">pypitest</code>. Alternatively, you can also specify the full URL, as shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python setup.py register -r  https://testpypi.python.org/pypi</strong></span>
</pre></div><p>The following screenshot shows the output after command execution:</p><div class="mediaobject"><img src="graphics/B05034_03_07.jpg" alt="Step 3 – Register your project"/></div><p>If you log in to the test PyPI website, a new project with the unique name you have chosen (in this example, it is <code class="literal">testgamepkg</code>) will show up.</p></div><div class="section" title="Step 4 – Uploading the package"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec18"/>Step 4 – Uploading the package</h3></div></div></div><p>Finally, it is time to<a id="id187" class="indexterm"/> upload the package. This can be accomplished with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python setup.py sdist upload -r pypitest</strong></span>
</pre></div><p>This command does two things. First, it creates the source distribution using the <code class="literal">sdist</code> command and then the source distribution is uploaded to the PyPI test repository with the <code class="literal">upload</code> command.</p><div class="mediaobject"><img src="graphics/B05034_03_08.jpg" alt="Step 4 – Uploading the package"/></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="emphasis"><em>That's a good point, Sir Foo! In the Prepare the distribution section (see <span class="strong"><strong>Step 4 – Updating the MANIFEST.in</strong></span> file</em></span>)<span class="emphasis"><em>, we indeed created the distribution using the </em></span>
<code class="literal">python setup.py sdist</code> <span class="emphasis"><em>command</em></span>.</p>
</td></tr></tbody></table></div><p>At the time this book was written, <code class="literal">setuptools</code> did not have a provision to upload an existing distribution—the distribution creation and upload need to happen in a single command. The good news is that there is a third-party Python package called <code class="literal">twine</code> that enables uploading an already created distribution.</p><p>This package can be installed using pip:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pip install twine</strong></span>
</pre></div><p>This will install <code class="literal">twine</code> at the same location as your Python executable. For example, if Python 3 is accessed as <code class="literal">/usr/bin/python</code>, then <code class="literal">twine</code> can be accessed as <code class="literal">/usr/bin/twine</code>. Now, upload the existing source distribution as:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ twine upload -r pypitest dist/* </strong></span>
<span class="strong"><strong>Uploading distributions to https://testpypi.python.org/pypi </strong></span>
<span class="strong"><strong>Uploading testgamepkg-2.0.0.tar.gz </strong></span>
</pre></div><p>The distribution is now<a id="id188" class="indexterm"/> available for anyone to download and install on the PyPI test repository! To verify this, visit the package home page on the PyPI test site, <code class="literal">https://testpypi.python.org/pypi/your_package_name</code>. The home page of <code class="literal">testgamepkg</code> with a <span class="strong"><strong>2.0.2</strong></span> version is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B05034_03_09.jpg" alt="Step 4 – Uploading the package"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip22"/>Tip</h3><p>
<span class="strong"><strong>Security note</strong></span>
</p><p>For older versions of Python (before v2.7.9 or v3.2), when you use <code class="literal">python seup.py sdist upload</code>, a HTTP connection is used to upload the files. What it means is that your user name and password are a security risk if there is a cyber attack! In this case, it is highly recommended to use the <code class="literal">twine</code> package. It securely uploads the distribution over HTTPS using a verified connection.</p><p>For Python 2.7.9+ and 3.2+, HTTPS is the default choice to upload the distribution. But you can still use <code class="literal">twine</code> for <a id="id189" class="indexterm"/>the other advantages as discussed. Visit <a class="ulink" href="https://pypi.python.org/pypi/twine">https://pypi.python.org/pypi/twine</a> for more information.</p></div></div></div></div><div class="section" title="A single command to do it all"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec51"/>A single command to do it all</h2></div></div></div><p>Now that we know all the steps, let's combine these three steps, namely registering the project, creating a distribution, and uploading the distribution into a single command.</p><p>For this to work, we will make two small changes in <code class="literal">setup.py</code>, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change the <code class="literal">name</code> field to another unique name. This should be different from what you chose while following the earlier steps.</li><li class="listitem">Update the <code class="literal">url</code> field to reflect this new name.</li></ol></div><p>After these changes, run the following command in a terminal window:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python setup.py register -r pypitest sdist upload -r pypitest</strong></span>
</pre></div><p>This is a combination of three commands executed in a serial manner. The first one, <code class="literal">register -r pypitest</code>, registers a new project; the second command, <code class="literal">sdist</code>, creates a source distribution; and finally, the third command, <code class="literal">upload -r pypitest</code>, submits the distribution to the PyPI test repository!</p></div><div class="section" title="Installing your own distribution"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec52"/>Installing your own distribution</h2></div></div></div><p>The distribution is now <a id="id190" class="indexterm"/>available for installation using pip. Let's install it ourselves to make sure there are no problems. Run the <code class="literal">pip</code> command shown in the following code snippet. Replace <code class="literal">testgamepkg</code> with the distribution name you have uploaded:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pip install -i https://testpypi.python.org/pypi testgamepkg</strong></span>
</pre></div><p>The <code class="literal">-i</code> (alternatively, <code class="literal">--index-url</code>) option specifies the base URL of PyPI. If you don't specify this option, it will default to <a class="ulink" href="https://pypi.python.org/simple">https://pypi.python.org/simple</a>. Here is a sample response when the <code class="literal">install</code> command is executed:</p><div class="informalexample"><pre class="programlisting">Collecting testgamepkg 
Downloading https://testpypi.python.org/packages/source/t/testgamepkg/testgame pkg-2.0.0.tar.gz 
Installing collected packages: testgamepkg 
  Running setup.py install for testgamepkg 
Successfully installed testgamepkg-2.0.0</pre></div><p>Once the package is successfully installed, test it by calling the functionality from that package. For example, start your Python interpreter and write the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;&gt; from wargame.attackoftheorcs import AttackOfTheOrcs </strong></span>
<span class="strong"><strong>&gt;&gt;&gt; game = AttackOfTheOrcs() </strong></span>
<span class="strong"><strong>&gt;&gt;&gt; game.play()</strong></span>
</pre></div><p>If you do not see any <a id="id191" class="indexterm"/>errors, everything is working as expected! The distribution is now generally available to our users on the PyPI test website.</p><div class="mediaobject"><img src="graphics/B05034_03_10.jpg" alt="Installing your own distribution"/></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="emphasis"><em>You are right. We only talked about the open distributions using the Python community repositories! If you want to create a private distribution, you should set up and maintain your own PyPI repository. Let's talk about that next.</em></span>
</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Using a private PyPI repository"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Using a private PyPI repository</h1></div></div></div><p>This section will <a id="id192" class="indexterm"/>briefly cover how to setup a private PyPI repository. The discussion will be limited to creating a simple HTTP-based local server. There are several packages that can help you do this. Let's use a popular package<a id="id193" class="indexterm"/> called <code class="literal">pypiserver</code> (<a class="ulink" href="https://pypi.python.org/pypi/pypiserver">https://pypi.python.org/pypi/pypiserver</a>). Let's open a terminal window and get ready for action.</p><div class="section" title="Step 1 – Installing pypiserver"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec53"/>Step 1 – Installing pypiserver</h2></div></div></div><p>First, install the <a id="id194" class="indexterm"/>required package:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pip install pypiserver </strong></span>
</pre></div><p>The <code class="literal">pypi-server</code> executable sits at the same location that you have the Python executable. For example, if you have <code class="literal">/usr/bin/python</code>, <code class="literal">pypi-server</code> will be available as <code class="literal">/usr/bin/pypi-server</code>.</p></div><div class="section" title="Step 2 – Building a new source distribution"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec54"/>Step 2 – Building a new source distribution</h2></div></div></div><p>Go to the directory<a id="id195" class="indexterm"/> where you have <code class="literal">setup.py</code> and all other files. In the discussion earlier, we named it <code class="literal">testgamepkg</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd /path/to/testgamepkg</strong></span>
</pre></div><p>We have already installed <code class="literal">testgamepkg</code> in an earlier section. To simplify things, in <code class="literal">setup.py</code> let's change the <code class="literal">name</code> field to something else. While you are at it, also change the <code class="literal">url</code> and <code class="literal">version</code> field. The <code class="literal">setup.py</code> with these changes is shown in the following screenshot. The changes are highlighted:</p><div class="mediaobject"><img src="graphics/B05034_03_21.jpg" alt="Step 2 – Building a new source distribution"/></div><p>Now, let's create a new<a id="id196" class="indexterm"/> source distribution by the name of <code class="literal">testpkg_private</code>. As before, the archive will be created in the <code class="literal">dist</code> directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python setup.py sdist </strong></span>
</pre></div></div><div class="section" title="Step 3 – Starting a local server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec55"/>Step 3 – Starting a local server</h2></div></div></div><p>Next, let's start a local <a id="id197" class="indexterm"/>server on your computer:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pypi-server -p 8081 ./dist</strong></span>
</pre></div><p>The <code class="literal">-p</code> option is used to specify a port number. You can choose a number other than <code class="literal">8081</code>. The command also takes a directory as an argument. We have specified it as the <code class="literal">dist</code> directory. This is where it will search for your private distribution packages.</p><div class="mediaobject"><img src="graphics/B05034_03_11.jpg" alt="Step 3 – Starting a local server"/></div><p>The server will start listening<a id="id198" class="indexterm"/> on <code class="literal">http://localhost:8081</code>. That's it! Open this URL in a browser. It will display a simple web page with instructions, as shown in the preceding screenshot:</p></div><div class="section" title="Step 4 – Installing the private distribution"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec56"/>Step 4 – Installing the private distribution</h2></div></div></div><p>The installation instructions <a id="id199" class="indexterm"/>at <code class="literal">http://localhost:8081</code> are self explanatory. You can click on the <span class="strong"><strong>simple</strong></span> link to view all the available packages. It essentially shows the contents of the <code class="literal">dist</code> directory specified when we started the server. If you want to include any additional packages, you can simply copy those to this directory. The following command installs this private distribution:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pip install -i http://localhost:8081 testpkg_private</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip23"/>Tip</h3><p>This was a quick introduction to setting up a private PyPI repository. For illustration, we just created a local server based on HTTP. In practice, you should set up a secure server with the HTTPS protocol and authenticate users, similar to what the PyPI website does. Also, we had a basic mechanism where the package was copied over to the repository directory. In a real-world situation, you will need to support remote uploads. For further reading, visit the GitHub page of <code class="literal">pypiserver</code>, <a class="ulink" href="https://github.com/pypiserver/pypiserver">https://github.com/pypiserver/pypiserver</a>. Some <a id="id200" class="indexterm"/>other packages that help set up a private repository include <code class="literal">pyshop</code> <a id="id201" class="indexterm"/>at <a class="ulink" href="https://pypi.python.org/pypi/pyshop">https://pypi.python.org/pypi/pyshop</a> and <code class="literal">djangopypi</code> <a id="id202" class="indexterm"/>at <a class="ulink" href="https://pypi.python.org/pypi/djangopypi">https://pypi.python.org/pypi/djangopypi</a>.</p></div></div></div></div>
<div class="section" title="Making an incremental release"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Making an incremental release</h1></div></div></div><p>The <a id="id203" class="indexterm"/>package is released but that is not the end of the story. Very soon, you will need to make changes to the code and make the newer version available again. In this section, we will learn how to submit incremental patches to an already deployed distribution.</p><div class="section" title="Packaging and uploading the new version"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec57"/>Packaging and uploading the new version</h2></div></div></div><p>Preparing for the<a id="id204" class="indexterm"/> new release is pretty <a id="id205" class="indexterm"/>simple. Just update the version number to, for instance, <code class="literal">2.0.1</code> in the <code class="literal">setup.py</code> file. After making this change, run the earlier command that creates a source distribution and uploads the package in one go:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python setup.py sdist upload -r pypitest</strong></span>
</pre></div><p>The incremental release of v2.0.1 will now be available on the PyPI test repository.</p></div><div class="section" title="Upgrading the installed version"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec58"/>Upgrading the installed version</h2></div></div></div><p>If the previous version of<a id="id206" class="indexterm"/> the package is already installed on your computer, use the <code class="literal">--upgrade</code> option to update to the latest release version. This step is optional, but it is always good practice to verify the released version is working as expected:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ pip install -i https://testpypi.python.org/pypi testgamepkg --upgrade</strong></span>
</pre></div><p>As we did before, replace the name <code class="literal">testgamepkg</code> with the package name you have chosen.</p></div></div>
<div class="section" title="Version controlling the code"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Version controlling the code</h1></div></div></div><p>Let's recap what we <a id="id207" class="indexterm"/>have done so far. We started application development with a simple script. Gradually, we redesigned the application, added new features and fixed bugs to transform it into its current state. What if you want to go back to an earlier state of the code, say the code you wrote two days ago? You may want to do this for various reasons. For instance, the latest code might have some bugs that you didn't see two days ago. Imagine another scenario where you are collaborating with your colleagues on a project and you all need to work on the same set of files. How do we accomplish that?</p><p>In such<a id="id208" class="indexterm"/> situations, a <span class="strong"><strong>version control system</strong></span> (<span class="strong"><strong>VCS</strong></span>)<a id="id209" class="indexterm"/> comes to our rescue. It maintains a record of changes you make to the code. The files and directories now have a version associated with them. The VCS enables you to pull a specific version of any file.</p><p>There are several version control systems in use. Git, SVN, CVS, and Mercurial are some of the most popular open source VCS. In this book, we will cover some preliminary operational instructions on using Git, a distributed revision control system.</p><div class="section" title="Git resources"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec59"/>Git resources</h2></div></div></div><p>Git<a id="id210" class="indexterm"/> is a very powerful tool for collaborative development. It is a pretty big topic. This chapter just gives a brief overview of some common use cases. The goal here is to provide a minimal set of instructions to bring our Python application code under version control.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>The following are a few links to the resources that cover Git<a id="id211" class="indexterm"/> in a depth well beyond our scope:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://git-scm.com/documentation">https://git-scm.com/documentation</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://gitref.org">http://gitref.org</a></li></ul></div></div></div><p>If you are already familiar with Git, or have used another version control such as SVN, jump directly to the final topic to solve an exercise. Also, the upcoming discussion will primarily focus on using Git from the command line. If you prefer a GUI client, the section <span class="emphasis"><em>Using</em></span> <span class="emphasis"><em>GUI</em></span> <span class="emphasis"><em>clients</em></span> <span class="emphasis"><em>for</em></span> <span class="emphasis"><em>Git</em></span> will provide some pointers.</p></div><div class="section" title="Installing Git"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec60"/>Installing Git</h2></div></div></div><p>Git <a id="id212" class="indexterm"/>software can be <a id="id213" class="indexterm"/>downloaded from <a class="ulink" href="https://git-scm.com/downloads">https://git-scm.com/downloads</a>. The website provides detailed installation instructions for various operating systems.</p><p>With most Linux flavors, it can be simply installed using the package manager of the OS. For example, on Ubuntu, it can be installed from a terminal like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get install git</strong></span>
</pre></div><p>For Windows OS, install using the installer available on the Git website. After the installation, you should be able to access the Git executable from the command line. If it is not available, add the <code class="literal">PATH</code> to its executable in your environment variables.</p></div><div class="section" title="Configuring your identity"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec61"/>Configuring your identity</h2></div></div></div><p>Before creating a <a id="id214" class="indexterm"/>Git repository and committing any code, you should tell Git who you are:</p><div class="informalexample"><pre class="programlisting">$ git config --global user.name  "YOUR NAME HERE" 
$ git config --global user.email YOUR_EMAIL_HERE</pre></div><p>With this command, any commits you make will automatically be associated with your username and e-mail address.</p></div><div class="section" title="Basic Git terminology"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec62"/>Basic Git terminology</h2></div></div></div><p>Let's understand a few frequently used commands in Git. This list is far from being comprehensive. The intention is to just learn the most common Git commands:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">add</code>: This is a <a id="id215" class="indexterm"/>keyword used to bring any file or directory under the version control. With the <code class="literal">add</code> command, the Git index is updated and the new files are staged for the next commit, along with other changes in the directory.</li><li class="listitem" style="list-style-type: disc"><code class="literal">commit</code>: This<a id="id216" class="indexterm"/> keyword, after making changes to any of the files under version control, can be used to commit the files to the repository to register that change. In other words, Git records a new revision for the file, which also has information on who made those changes. While committing files, you can also add an informative message on what changes were made.</li><li class="listitem" style="list-style-type: disc"><code class="literal">clone</code>: This <a id="id217" class="indexterm"/>keyword, in Git terminology, means copying an original repository into a new one. This cloned repository on your computer can be used as a local or a working repository for your source code. Such a repository keeps a track of all the local changes you make to the contained code.</li><li class="listitem" style="list-style-type: disc"><code class="literal">push</code>: Suppose <a id="id218" class="indexterm"/>you have a central repository that you have shared with your team. It could be located on a remote server. You have cloned this repository on your computer and have made several changes within this repository. Now you want to make these changes available to others. The <code class="literal">push</code> command is used to send these changes to the central repository.</li><li class="listitem" style="list-style-type: disc"><code class="literal">pull</code>: You have <a id="id219" class="indexterm"/>updated the central repository with the <code class="literal">push</code> command. Now, if others want to use this code, their cloned repository needs to be synchronized with the central one. The <code class="literal">pull</code> command can be used to update the cloned repository with the new changes available in the central repository. If any of the files being updated with this command have local modifications, Git will try to merge the changes from the central repository into the local one.</li></ul></div></div><div class="section" title="Creating and using a Git repository"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec63"/>Creating and using a Git repository</h2></div></div></div><p>Let's set up a <a id="id220" class="indexterm"/>Git repository for our application. The steps we are about to follow are<a id="id221" class="indexterm"/> represented in the following simplified schematic.</p><div class="mediaobject"><img src="graphics/B05034_03_03.jpg" alt="Creating and using a Git repository"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip24"/>Tip</h3><p>There are many alternatives to bring the code under version control. What is illustrated here is just one such option. For example, you can directly start with <code class="literal">git init</code> in the existing <code class="literal">wargame</code> package directory instead of creating a bare repository and then cloning it.</p></div></div><div class="section" title="Creating a bare remote repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec19"/>Creating a bare remote repository</h3></div></div></div><p>First, we will create <a id="id222" class="indexterm"/>a <span class="strong"><strong>bare</strong></span> Git repository. It is just a directory that stores the revision history of your project. Note that it does not have any commits or branches. We will use this bare repository as our central or remote repository.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip25"/>Tip</h3><p>Git uses the concept of remote repository. In this book, we won't really set up a truly remote repository. The remote repository will be just another local directory on your computer. To avoid confusion, we will refer to the remote repository as the central repository in the upcoming discussion. The details of the remote repository and Git branches are stored in the <code class="literal">.git/config</code> file.</p></div></div><p>The convention is to add a <code class="literal">.git</code> extension to the name. On the command line, execute the following commands to initialize a bare repository:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mkdir wargameRepo.git</strong></span>
<span class="strong"><strong>$ cd wargameRepo.git</strong></span>
<span class="strong"><strong>$ git --bare init</strong></span>
</pre></div><p>First, a directory by the<a id="id223" class="indexterm"/> name <code class="literal">wargameRepo.git</code> is created. Inside this directory, the <code class="literal">git --bare init</code> command initializes a new repository. This command creates a <code class="literal">.git</code> directory for your project. The dot prefix indicates that it is a hidden directory. The <code class="literal">--bare</code> option indicates that this is a bare repository.</p></div><div class="section" title="Clone the repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec20"/>Clone the repository</h3></div></div></div><p>As seen<a id="id224" class="indexterm"/> earlier, the <code class="literal">clone</code> command can be used to create a copy of the central repository. Here is the command to do this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git clone ~/wargameRepo.git wargameRepo</strong></span>
<span class="strong"><strong>Cloning into 'wargameRepo'... </strong></span>
<span class="strong"><strong>warning: You appear to have cloned an empty repository. </strong></span>
<span class="strong"><strong>done.</strong></span>
</pre></div><p>Here, it clones <code class="literal">wargameRepo.git</code> as <code class="literal">wargameRepo</code> (a new directory). This assumes that you do not have any directory by this name. You can now use the cloned repository, <code class="literal">wargameRepo</code>, as your working copy. This repository has the full working tree. In this case, however, there is nothing in there except the <code class="literal">.git</code> folder. Next, we will add files and directories to this working tree.</p></div><div class="section" title="Copying the code to the cloned repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec21"/>Copying the code to the cloned repository</h3></div></div></div><p>After cloning, copy <a id="id225" class="indexterm"/>the <code class="literal">wargame</code> package created earlier into the cloned repository. The directory structure after this operation is shown here:</p><div class="mediaobject"><img src="graphics/B05034_03_22_wargameRepo_dir.jpg" alt="Copying the code to the cloned repository"/></div></div><div class="section" title="Staging the code and committing"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec22"/>Staging the code and committing</h3></div></div></div><p>Just copying the code<a id="id226" class="indexterm"/> into the repository doesn't mean it is version controlled. To do this, open the command prompt and go to the <code class="literal">wargameRepo</code> directory using the <code class="literal">cd</code> command.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd wargameRepo</strong></span>
</pre></div><p>Now, run the following command. Notice the dot in the command. This assumes that <code class="literal">git</code> is recognized as a command in your terminal window. If it isn't, you need to update the <code class="literal">PATH</code> environment variable or just specify the full path to this executable.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git add  .</strong></span>
</pre></div><p>This tells Git to stage everything in the current directory for a commit. In this case, it will add the <code class="literal">wargame</code> directory and all files inside it. If you run the <code class="literal">git status</code> command, it will show all the new files prepared for the initial commit (whenever that happens). The next step is to actually commit the files within our working repository:</p><div class="mediaobject"><img src="graphics/B05034_03_04.jpg" alt="Staging the code and committing"/></div><p>The <code class="literal">-m</code> argument in <a id="id227" class="indexterm"/>the <code class="literal">git commit</code> command is used to specify an informative message on what the commit is all about. The messages after this command are shown in the response received from Git after this command.</p></div><div class="section" title="Pushing the changes to the central repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec23"/>Pushing the changes to the central repository</h3></div></div></div><p>This step is useful, especially when <a id="id228" class="indexterm"/>you are co-developing the code with other developers. In such a scenario, there will be a central repository, which we created earlier with the <code class="literal">--bare</code> option. To make your changes available to others, you need to push those to the central repository. As mentioned in a side note earlier, the central repository in this case is just another Git directory on your computer.</p><p>We started with an empty repository. For the initial push into the central repository, execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git push origin master</strong></span>
</pre></div><p>What is <code class="literal">origin </code>here? Recall that our cloned repository, <code class="literal">wargameRepo</code>, originated from the central repository, <code class="literal">wargameRepo.git</code>. The <code class="literal">origin</code> is simply the URL pointing to your central repository. The second argument, <code class="literal">master</code>, is the Git branch name where the changes will be pushed. The default branch is called master. You can create different branches as well. We will limit this discussion to the default branch. The <code class="literal">.git/config</code> file stores details about the origin and branches in your local repository.</p><p>To summarize, the command mentioned earlier pushes the master branch in your working repository to the new master branch in your central repository (<code class="literal">origin/master</code>).</p><p>After the initial push, if <a id="id229" class="indexterm"/>you make any changes to the code, you first need to commit those in the working repository:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git commit -m "some changes to files" foo.py</strong></span>
</pre></div><p>Assuming that you continue to work on the same branch (master), for any subsequent push to the central repository, simply execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git push</strong></span>
</pre></div><p>This will update the master branch of the central repository with your changes. With this, you are all set to share your code with other developers using the central repository. If you want to get changes made by other developers, you can use <code class="literal">$ git pull</code> to fetch those changes and merge them with your working copy. We did not discuss the other Git features, such as tagging your code, creating branches, resolving conflicts, and so on. It is recommended you read the Git<a id="id230" class="indexterm"/> documentation, <a class="ulink" href="https://git-scm.com/doc">https://git-scm.com/doc</a>, to better understand these concepts.</p></div></div></div>
<div class="section" title="Using GUI clients for Git"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Using GUI clients for Git</h1></div></div></div><p>The earlier <a id="id231" class="indexterm"/>section exclusively discussed how to use Git from the command line. These <a id="id232" class="indexterm"/>commands can also be accessed through a<a id="id233" class="indexterm"/> <span class="strong"><strong>graphical user interface</strong></span> (<span class="strong"><strong>GUI</strong></span>). There are many GUI clients available for Git, for instance, <span class="strong"><strong>gitk</strong></span>
<a id="id234" class="indexterm"/> on Linux (<a class="ulink" href="http://gitk.sourceforge.net/">http://gitk.sourceforge.net/</a>) or <span class="strong"><strong>Github Desktop</strong></span>, <a id="id235" class="indexterm"/>available for Mac and Windows 7 or later (<a class="ulink" href="https://desktop.github.com/">https://desktop.github.com/</a>). The free Python IDEs, such as the community edition of PyCharm, provide an easy-to-use GUI integration for Git and other version control systems. PyCharm provides a context menu integration for Git commands. For example, right-clicking on a file in the IDE will give you a context menu option to add or commit the file to a repository.</p></div>
<div class="section" title="Exercise"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Exercise</h1></div></div></div><p>We released the distribution to the PyPI test repository as it was just a toy problem. For more serious stuff, you should deploy the package to the PyPI main repository, <a class="ulink" href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a>. As an exercise, deploy a package on the main PyPI server. The process is similar to what we discussed earlier.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a new account on the PyPI website. Note that you need to create a separate account; the test PyPI account won't work here.</li><li class="listitem" style="list-style-type: disc">In the <code class="literal">.pypirc</code> file, create a new profile to store credentials for the main server. See the following illustration for an inspiration:<div class="informalexample"><pre class="programlisting">[distutils] 
index-servers= 
pypitest 
pypimain

[pypimain]
repository = https://pypi.python.org/pypi
username=&lt;add PyPI main username&gt;
password=&lt;add PyPI main password&gt;

[pypitest] 
repository = https://testpypi.python.org/pypi 
username=&lt;add username&gt;
password=&lt;add password&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Appropriately, update the <code class="literal">url</code> field in <code class="literal">setup.py</code>.</li><li class="listitem" style="list-style-type: disc">Follow the other steps in package creation and release. Remember to specify the main repository everywhere, instead of the test repository. For example:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ python setup.py register -r pypimain</strong></span>
<span class="strong"><strong>$ python setup.py sdist upload -r pypimain</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">See what happens if you do not specify the <code class="literal">-r</code> option Which repository would it default to?</li></ul></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Summary</h1></div></div></div><p>This chapter introduced you to some key aspects of application development in general and Python application development in particular. The chapter started with an introduction to different versioning conventions. It demonstrated how to create Python modules and packages.</p><p>With step-by-step instructions, the chapter demonstrated how to prepare a distribution (also called a package), deploy it on the PyPI test server, and install this deployed package using pip. Additionally, it also showed you how to make incremental releases and set up a private Python distribution. Finally, the chapter provided an overview of version control using Git.</p><p>Coding standards are a set of guidelines that you should follow while developing the code. Complying with these standards can have a significant impact on the code readability and the life of the code. In the next chapter, you will learn another important aspect of software development, code documentation, and best practices.</p></div></body></html>