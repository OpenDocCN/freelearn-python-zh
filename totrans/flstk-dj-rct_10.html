<html><head></head><body>
		<div id="_idContainer120">
			<p><a id="_idTextAnchor203"/><a id="_idTextAnchor204"/></p>
			<h1 id="_idParaDest-191" class="chapter-number"><a id="_idTextAnchor205"/>10</h1>
			<h1 id="_idParaDest-192"><a id="_idTextAnchor206"/>User Profiles</h1>
			<p>A social media application should allow users to consult other user profiles. From another view, it should also allow an authenticated user to edit their information, such as their last name, first name, <span class="No-Break">and avatar.</span></p>
			<p>In this chapter, we will focus on adding CRUD features on the user side. We’ll build a page to visualize a user profile and a page that allows a user to edit their information. This chapter will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Listing profiles on the <span class="No-Break">home page</span></li>
				<li>Displaying user information on their <span class="No-Break">profile page</span></li>
				<li>Editing <span class="No-Break">user information</span></li>
			</ul>
			<h1 id="_idParaDest-193"><a id="_idTextAnchor207"/>Technical requirements</h1>
			<p>Make sure to have VS Code and an updated browser installed and configured on your machine. You can find all the code files used in this chapter <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap10"><span class="No-Break">https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap10</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-194"><a id="_idTextAnchor208"/>Listing profiles on the home page</h1>
			<p>Before <a id="_idIndexMarker597"/>building the pages and components to display user information and allow user information modification, we need to add a component to list some profiles on the home page <span class="No-Break">like so:</span></p>
			<div>
				<div id="_idContainer112" class="IMG---Figure">
					<img src="image/Figure_10.01_B18221.jpg" alt="Figure 10.1 – Listing profiles"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.1 – Listing profiles</p>
			<p>Follow these <a id="_idIndexMarker598"/>steps to add the component for listing profiles on the <span class="No-Break">home page:</span></p>
			<ol>
				<li>In the <strong class="source-inline">src/components</strong> file, create a new directory called <strong class="source-inline">profile</strong>. This directory will contain the code for all components related to users <span class="No-Break">or profiles.</span></li>
				<li>In the newly created directory, create a file called <strong class="source-inline">ProfileCard.jsx</strong> and add the <span class="No-Break">following content:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileCard.jsx</p>
			<pre class="source-code">
import React from "react";
import { Card, Button, Image } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
function ProfileCard(props) {
 return (
    // JSX code here
 );
}
export default ProfileCard;</pre>
			<p>The <strong class="source-inline">ProfileCard</strong> component will be used to display information about a profile and redirect the user to the <span class="No-Break">profile page.</span></p>
			<ol>
				<li value="3">Next, we will <a id="_idIndexMarker599"/>add the code logic concerning the navigation to the profile page and the props <span class="No-Break">object destructuration:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileCard.jsx</p>
			<pre class="source-code">
...
function ProfileCard(props) {
 const navigate = useNavigate();
 const { user } = props;
 const handleNavigateToProfile = () =&gt; {
   navigate(`/profile/${user.id}/`)
 };
 return (
    // JSX Code
 );
}
export default ProfileCard;</pre>
			<p>In the preceding code, we retrieved the user object from the props and we also added a function to handle the navigation to the <span class="No-Break">user profile.</span></p>
			<ol>
				<li value="4">Next, let’s write <a id="_idIndexMarker600"/>the JSX that will display information to <span class="No-Break">the user:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileCard.jsx</p>
			<pre class="source-code">
...
 return (
   &lt;Card className="border-0 p-2"&gt;
     &lt;div className="d-flex "&gt;
       &lt;Image
         src={user.avatar}
         roundedCircle
         width={48}
         height={48}
         className=
           "my-3 border border-primary border-2"
       /&gt;
       &lt;Card.Body&gt;
         &lt;Card.Title
           className="fs-6"&gt;{user.name}&lt;/Card.Title&gt;
         &lt;Button variant="primary"
           onClick={handleNavigateToProfile}&gt;
           See profile
         &lt;/Button&gt;
       &lt;/Card.Body&gt;
     &lt;/div&gt;
   &lt;/Card&gt;
 );
}
export default ProfileCard;</pre>
			<p>The <strong class="source-inline">ProfileCard</strong> component is written. We can now import it into the <strong class="source-inline">Home.jsx</strong> page and use it. But before that, we need to retrieve five profiles from the API <a id="_idIndexMarker601"/>and loop through the results to have the <span class="No-Break">wanted display:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
...
import CreatePost from "../components/posts/CreatePost";
import ProfileCard from "../components/profile/ProfileCard";
function Home() {
...
 const profiles = useSWR("/user/?limit=5", fetcher);
...
 return (
   &lt;Layout&gt;
     &lt;Row className="justify-content-evenly"&gt;
       ...
       &lt;Col sm={3} className="border rounded py-4
           h-50"&gt;
         &lt;h4 className="font-weight-bold text-center"&gt;
           Suggested people&lt;/h4&gt;
         &lt;div className="d-flex flex-column"&gt;
           {profiles.data &amp;&amp;
             profiles.data.results.map((profile,
                                        index) =&gt; (
               &lt;ProfileCard key={index} user={profile}
               /&gt;
             ))}
         &lt;/div&gt;
       &lt;/Col&gt;
     &lt;/Row&gt;
   &lt;/Layout&gt;
 );
}
export default Home;</pre>
			<p>In the <a id="_idIndexMarker602"/>preceding code, the profiles are only shown if the <strong class="source-inline">profiles.data</strong> object is not null or undefined. This is why we are writing the <strong class="source-inline">profiles.data  &amp;&amp; profiles.data.results.map()</strong> inline <span class="No-Break">JSX condition.</span></p>
			<ol>
				<li value="5">Once it’s done, reload the home page and you’ll have a new component available, listing a maximum of <span class="No-Break">five profiles.</span></li>
			</ol>
			<p>Try to click on the <strong class="bold">See Profile</strong> button. You will be redirected to a white page. This is normal because we haven’t written routing for the <strong class="bold">Profile</strong> <span class="No-Break">page yet.</span></p>
			<p>In the next section, we will <a id="_idIndexMarker603"/>be creating components to display information about a profile, <span class="No-Break">like so:</span></p>
			<div>
				<div id="_idContainer113" class="IMG---Figure">
					<img src="image/Figure_10.02_B18221.jpg" alt="Figure 10.2 – The user profile page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.2 – The user profile page</p>
			<p>We will also allow the user to edit their information, <span class="No-Break">like so:</span></p>
			<div>
				<div id="_idContainer114" class="IMG---Figure">
					<img src="image/Figure_10.03_B18221.jpg" alt="Figure 10.3 – The user edit form and page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.3 – The user edit form and page</p>
			<h1 id="_idParaDest-195"><a id="_idTextAnchor209"/>Displaying user information on their profile page</h1>
			<p>In this section, we will create a profile page to display user information. We will build a component <a id="_idIndexMarker604"/>to display user details and the posts concerning this user, but also we will create a page displaying a form for editing <span class="No-Break">user information.</span></p>
			<p>Before starting to build the user profile page, we have to create some components. On the profile page, we are not only displaying information but also the list of posts created by the user. Let’s start by writing the <strong class="source-inline">ProfileDetails.jsx</strong> component (<span class="No-Break"><em class="italic">Figure 10</em></span><span class="No-Break"><em class="italic">.4</em></span><span class="No-Break">):</span></p>
			<div>
				<div id="_idContainer115" class="IMG---Figure">
					<img src="image/Figure_10.04_B18221.jpg" alt="Figure 10.4 – The ProfileDetails component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.4 – The ProfileDetails component</p>
			<p>Here’s the wireframe to help you with the structure of <span class="No-Break">the component:</span></p>
			<div>
				<div id="_idContainer116" class="IMG---Figure">
					<img src="image/Figure_10.05_B18221.jpg" alt="Figure 10.5 – The wireframe of the ProfileDetails component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.5 – The wireframe of the ProfileDetails component</p>
			<p>In the <strong class="source-inline">ProfileDetails</strong> component, we are displaying some avatars. At this point of the project, it’s time to get rid of the <strong class="source-inline">randomAvatar</strong> function. It has been useful up until this point of the project, but we are making a lot of requests and some state change within the application just calls the function again that returns another random image, which is not something a user of the application might want <span class="No-Break">to see.</span></p>
			<p>Let’s start using the value of the avatar field on the user object but before that, we have to configure Django to deal with media upload and the avatar field on the <span class="No-Break">user object.</span></p>
			<p>The social <a id="_idIndexMarker605"/>media application uses the <strong class="source-inline">avatar</strong> field, which represents a link to a file that the browser can make a request on and receive the image. Django supports file uploading; we just need to add some configuration to make <span class="No-Break">it effective.</span></p>
			<p>Inside the <strong class="source-inline">settings.py</strong> file of the project, add the following lines at the end of <span class="No-Break">the project:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
…
<strong class="bold">MEDIA_URL'= '/med'a/'</strong>
<strong class="bold">MEDIA_ROOT = BASE_DIR'/ 'uplo'ds'</strong></pre>
			<p>The <strong class="source-inline">MEDIA_URL</strong> setting allows us to write the URL that will be used to retrieve uploaded files. The <strong class="source-inline">MEDIA_ROOT</strong> setting tells Django where to stock the files and also checks the upload files when returning the URL of a file. In the case of this project, an avatar field will have this URL, for <span class="No-Break">example: </span><span class="No-Break"><strong class="source-inline">http://localhost:8000/media/user_8380ca50-ad0f-4141-88ef-69dc9b0707ad/avatar-rogemon.png</strong></span><span class="No-Break">.</span></p>
			<p>For this configuration to work, you will need to create a directory called <strong class="source-inline">uploads</strong> at the root of the Django project. You will also need to install the Pillow library, which contains all the basic tools for image <span class="No-Break">processing functionality:</span></p>
			<pre class="source-code">
pip install pillow</pre>
			<p>After that, let’s slightly modify the avatar field on the user model. Inside the <strong class="source-inline">core/user/models.py</strong>, add a function before the <strong class="source-inline">UserManager</strong> <span class="No-Break">manager class:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">core/user/models.py</p>
			<pre class="source-code">
...
def user_directory_path(instance, filename):
    # file will be uploaded to
       MEDIA_ROOT/user_&lt;id&gt;/&lt;filename&gt;
    return 'user_{0}/{1}'.format(instance.public_id,
                                 filename)
...</pre>
			<p>This function <a id="_idIndexMarker606"/>will help re-write the path for the upload of a file. Instead of going directly into the <strong class="source-inline">uploads</strong> directory, the avatar is stocked according to a user. It can help with the better organization of files in your system. After adding the function, we can tell Django to use it for the default <span class="No-Break">upload path:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">core/user/models.py</p>
			<pre class="source-code">
...
class User(AbstractModel, AbstractBaseUser, PermissionsMixin):
...
    avatar = models.ImageField(
        null=True, blank=True,
             upload_to=user_directory_path)
...</pre>
			<p>In Django, the <strong class="source-inline">ImageField</strong> field is used to store image files in a database. It is a subclass of <strong class="source-inline">FileField</strong>, which is a generic field for storing files, so it has all the attributes of <strong class="source-inline">FileField</strong> as well as some additional attributes specific to images. The <strong class="source-inline">upload_to</strong> attribute specifies the directory where the image files will <span class="No-Break">be stored.</span></p>
			<p>Now, run the <strong class="source-inline">makemigrations</strong> command and make sure to migrate the changes to <span class="No-Break">the database:</span></p>
			<pre class="console">
python manage.py makemigrations
python manage.py migrate</pre>
			<p>With this <a id="_idIndexMarker607"/>configuration done, our API can accept avatar uploading for the user. However, some users won’t have an avatar and we have been handling it pretty badly from the frontend side. Let’s set up a default avatar that will be used for users without <span class="No-Break">an avatar.</span></p>
			<h2 id="_idParaDest-196"><a id="_idTextAnchor210"/>Configuring the default avatar</h2>
			<p>To configure <a id="_idIndexMarker608"/>the default avatar, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li value="1">In the <strong class="source-inline">settings.py</strong> file of the Django project, add the following line at the end of <span class="No-Break">the file:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
...
DEFAULT_AVATAR_URL = "https://avatars.dicebear.com/api/identicon/.svg"</pre>
			<p>The avatar image looks <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer117" class="IMG---Figure">
					<img src="image/Figure_10.06_B18221.jpg" alt=""/>
				</div>
			</div>
			<p class="IMG---Figure">Image 10.6: The default image</p>
			<ol>
				<li value="2">Once you <a id="_idIndexMarker609"/>have added <strong class="source-inline">DEFAULT_AVATAR_URL</strong> to the <strong class="source-inline">settings.py</strong> file, we will slightly modify the <strong class="source-inline">UserSerializer</strong> representation method to return the <strong class="source-inline">DEFAULT_AVATAR_URL</strong> value by default if the avatar field <span class="No-Break">is none:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">Core/user/serializers.py</p>
			<pre class="source-code">
...
from django.conf import settings
class UserSerializer(AbstractSerializer):
...
    def to_representation(self, instance):
        representation =
          super().to_representation(instance)
        if not representation['avatar']:
            representation['avatar'] =
              settings.DEFAULT_AUTO_FIELD
            return representation
        if settings.DEBUG:  # debug enabled for dev
            request = self.context.get('request')
            representation['avatar'] =
              request.build_absolute_uri(
                representation['avatar'])
        return representation</pre>
			<p>Let’s explain what we are doing in the preceding code block. First, we need to check <a id="_idIndexMarker610"/>whether the avatar value exists. If that’s not the case, we will return the default avatar. By default, Django doesn’t return the actual route of the file with the domain. That’s why in this case, if we are in a development environment, we return an absolute URL of the avatar. In the last part of this book, we will deploy the application on a production server, then we will use <strong class="bold">AWS S3</strong> for <span class="No-Break">file storing.</span></p>
			<p>With the fix done on the backend, we can confidently modify the frontend application by now including the avatar field. It’s quite simple and a little bit of refactoring. Remove the <strong class="source-inline">randomAvatar</strong> function code from the React application and replace the values with <strong class="source-inline">user.avatar</strong>,  <strong class="source-inline">post.author.avatar</strong>, or <strong class="source-inline">comment.author.avatar</strong>, depending on the file and <span class="No-Break">the component.</span></p>
			<ol>
				<li value="3">With those small configurations done, check the <strong class="bold">Home</strong> page; you should have a <span class="No-Break">similar result.</span></li>
			</ol>
			<div>
				<div id="_idContainer118" class="IMG---Figure">
					<img src="image/Figure_10.07_B18221.jpg" alt="Figure 10.7 – The Home page with a default avatar"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.7 – The Home page with a default avatar</p>
			<p>Great! Let’s <a id="_idIndexMarker611"/>move to creating the <strong class="bold">Profile</strong> page so that our Django application is ready to accept <span class="No-Break">file uploads.</span></p>
			<h2 id="_idParaDest-197"><a id="_idTextAnchor211"/>Writing the ProfileDetails component</h2>
			<p>To create the <strong class="source-inline">ProfileDetails</strong> component, we have to create the file that will contain <a id="_idIndexMarker612"/>the code for this component, add the logic for the navigation, write the UI (JSX), and import the component on the <span class="No-Break"><strong class="bold">Profile</strong></span><span class="No-Break"> page:</span></p>
			<ol>
				<li value="1">In the <strong class="source-inline">src/components/profile</strong> directory, create a new file called <strong class="source-inline">ProfileDetail.jsx</strong>. This file will contain the code for the <span class="No-Break"><strong class="source-inline">ProfileDetails</strong></span><span class="No-Break"> component:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileDetails.jsx</p>
			<pre class="source-code">
import React from "react";
import { Button, Image } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
function ProfileDetails(props) {
 return (
// JSX code here
 );
}
export default ProfileDetails;</pre>
			<ol>
				<li value="2">Here, we just need to destruct the props object to retrieve the user object, declare <a id="_idIndexMarker613"/>the navigate variable to use the <strong class="source-inline">useNagivate</strong> Hook, and finally handle the case when the user object is undefined <span class="No-Break">or null:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileDetaisl.jsx</p>
			<pre class="source-code">
...
function ProfileDetails(props) {
 const { user } = props;
 const navigate = useNavigate();
 if (!user) {
   return &lt;div&gt;Loading...&lt;/div&gt;;
 }
 return (
   // JSX Code here
 );
}
export default ProfileDetails;</pre>
			<ol>
				<li value="3">We can <a id="_idIndexMarker614"/>confidently write the JSX <span class="No-Break">logic now:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileDetails.jsx</p>
			<pre class="source-code">
...
 return (
   &lt;div&gt;
     &lt;div className="d-flex flex-row border-bottom
       p-5"&gt;
       &lt;Image
         src={user.avatar}
         roundedCircle
         width={120}
         height={120}
         className="me-5 border border-primary
                    border-2"
       /&gt;
       &lt;div className="d-flex flex-column
        justify-content-start align-self-center mt-2"&gt;
         &lt;p className="fs-4 m-0"&gt;{user.name}&lt;/p&gt;
         &lt;p className="fs-5"&gt;{user.bio ? user.bio :
           "(No bio.)"}&lt;/p&gt;
         &lt;p className="fs-6"&gt;
           &lt;small&gt;{user.posts_count} posts&lt;/small&gt;
         &lt;/p&gt;
         &lt;Button
           variant="primary"
           size="sm"
           className="w-25"
           onClick={() =&gt;
             navigate(`/profile/${user.id}/edit/`)}
         &gt;
           Edit
         &lt;/Button&gt;
       &lt;/div&gt;
     &lt;/div&gt;
   &lt;/div&gt;
 );</pre>
			<ol>
				<li value="4">Now that <a id="_idIndexMarker615"/>the component is written, create a new file called <strong class="source-inline">Profile.jsx</strong> in the <strong class="source-inline">src/pages</strong> directory. This file will contain the code and logic for the <span class="No-Break"><strong class="bold">Profile</strong></span><span class="No-Break"> page:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Profile.jsx</p>
			<pre class="source-code">
import React from "react";
import { useParams } from "react-router-dom";
import Layout from "../components/Layout";
import ProfileDetails from "../components/profile/ProfileDetails";
import useSWR from "swr";
import { fetcher } from "../helpers/axios";
import { Post } from "../components/posts";
import { Row, Col } from "react-bootstrap";
function Profile() {
  return (
    // JSX CODE
  );
}
export default Profile;</pre>
			<ol>
				<li value="5">Let’s add <a id="_idIndexMarker616"/>the fetching logic for the user and the user posts. No need to create another <strong class="source-inline">Post</strong> component as the same <strong class="source-inline">Post</strong> component from <strong class="source-inline">src/components/Post.jsx</strong> will be used to list posts created by <span class="No-Break">the profile:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Profile.jsx</p>
			<pre class="source-code">
...
function Profile() {
  const { profileId } = useParams();
  const user = useSWR(`/user/${profileId}/`, fetcher);
  const posts = useSWR(`/post/?author__public_id=${profileId}`, fetcher, {
       refreshInterval: 20000
   });
...</pre>
			<ol>
				<li value="6">Once it’s <a id="_idIndexMarker617"/>done, we can now write the <span class="No-Break">UI logic:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Profile.jsx</p>
			<pre class="source-code">
...
  return (
    &lt;Layout hasNavigationBack&gt;
      &lt;Row className="justify-content-evenly"&gt;
        &lt;Col sm={9}&gt;
          &lt;ProfileDetails user={user.data}/&gt;
          &lt;div&gt;
            &lt;Row className="my-4"&gt;
              {posts.data?.results.map((post, index)
                =&gt; (
                &lt;Post key={index} post={post}
                  refresh={posts.mutate} /&gt;
              ))}
            &lt;/Row&gt;
          &lt;/div&gt;
        &lt;/Col&gt;
      &lt;/Row&gt;
    &lt;/Layout&gt;
  );
}
...</pre>
			<ol>
				<li value="7">Great! Let’s <a id="_idIndexMarker618"/>now register this page in the <span class="No-Break"><strong class="source-inline">App.js</strong></span><span class="No-Break"> file:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.js</p>
			<pre class="source-code">
…
&lt;Route
  path="/profile/:profileId/"
  element={
    &lt;ProtectedRoute&gt;
      &lt;Profile /&gt;
    &lt;/ProtectedRoute&gt;
  }
/&gt;
…</pre>
			<ol>
				<li value="8">Let’s not forget to add <strong class="source-inline">Link</strong> to the profile in the <span class="No-Break"><strong class="source-inline">Navbar.jsx</strong></span><span class="No-Break"> file:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Navbar.jsx</p>
			<pre class="source-code">
...
    &lt;NavDropdown.Item as={Link} to=
      {`/profile/${user.id}/`}&gt;Profile
    &lt;/NavDropdown.Item&gt;
    &lt;NavDropdown.Item onClick={handleLogout}&gt;Logout
    &lt;/NavDropdown.Item&gt;
  &lt;/NavDropdown&gt;
&lt;/Nav&gt;
...</pre>
			<ol>
				<li value="9">Great! You can <a id="_idIndexMarker619"/>now click on the <strong class="bold">See Profile</strong> button or directly on the drop-down menu of the navigation bar to go to the <span class="No-Break">profile page:</span></li>
			</ol>
			<div>
				<div id="_idContainer119" class="IMG---Figure">
					<img src="image/Figure_10.08_B18221.jpg" alt="Figure 10.8 – A random profile page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.8 – A random profile page</p>
			<p>With the profile page ready, we can move on to create the page that will contain the form to edit <span class="No-Break">user information.</span></p>
			<h1 id="_idParaDest-198"><a id="_idTextAnchor212"/>Editing user information</h1>
			<p>The <strong class="bold">Edit</strong> button on the <strong class="bold">Profile</strong> page should redirect the user to a page with a form to update its <a id="_idIndexMarker620"/>information. In the end, you will have a similar result to that shown in <span class="No-Break"><em class="italic">Figure 10</em></span><em class="italic">.2</em>. In this section, we will modify the <strong class="source-inline">useUserActions</strong> Hook by adding a new method to edit user information via the API. Then, we will create the form to edit user information. Lastly, we will integrate the editing form component on the <span class="No-Break"><strong class="source-inline">EditUser</strong></span><span class="No-Break"> page.</span></p>
			<p>Let’s start by adding a new method to the <span class="No-Break"><strong class="source-inline">useUserActions</strong></span><span class="No-Break"> Hook.</span></p>
			<h2 id="_idParaDest-199"><a id="_idTextAnchor213"/>Adding the edit method to useUserActions</h2>
			<p>In the <strong class="source-inline">src/hooks/user.actions.js</strong> file, we will add another method to the <strong class="source-inline">useUserActions</strong> Hook. This function will handle the <strong class="source-inline">patch</strong> request to the API. As we are <a id="_idIndexMarker621"/>saving a user object in <strong class="source-inline">localStorage</strong>, we will update the value of the object if the <span class="No-Break">request succeeds:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
function useUserActions() {
  const navigate = useNavigate();
  const baseURL = "http://localhost:8000/api";
  return {
    login,
    register,
    logout,
    edit
  };
...
  // Edit the user
  function edit(data, userId) {
    return axiosService.patch(`${baseURL}/user/${userId}/`,
                               data).then((res) =&gt; {
      // Registering the account in the store
      localStorage.setItem(
        "auth",
        JSON.stringify({
          access: getAccessToken(),
          refresh: getRefreshToken(),
          user: res.data,
        })
      );
    });
  }
...
}</pre>
			<p>With <a id="_idIndexMarker622"/>the <strong class="source-inline">edit</strong> function written, we can confidently move to create the form used to edit <span class="No-Break">user information.</span></p>
			<h2 id="_idParaDest-200"><a id="_idTextAnchor214"/>The UpdateProfileForm component</h2>
			<p>In the <strong class="source-inline">src/components/UpdateProfileForm.jsx</strong>, create a file called <strong class="source-inline">UpdateProfileForm.jsx</strong>. This <a id="_idIndexMarker623"/>file will contain the code for the component used to edit <span class="No-Break">user information:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
import React, { useState, useContext } from "react";
import { Form, Button, Image } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
import { useUserActions } from "../../hooks/user.actions";
import { Context } from "../Layout";
function UpdateProfileForm(props) {
  return (
    // JSX Code
  );
}
export default UpdateProfileForm;</pre>
			<p>Let’s start <a id="_idIndexMarker624"/>by retrieving the user object from the props and adding the Hooks needed for the <span class="No-Break">form handling:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
function UpdateProfileForm(props) {
  const { profile } = props;
  const navigate = useNavigate();
  const [validated, setValidated] = useState(false);
  const [form, setForm] = useState(profile);
  const [error, setError] = useState(null);
  const userActions = useUserActions();
  const [avatar, setAvatar] = useState();
  const { toaster, setToaster } = useContext(Context);
...</pre>
			<p>The next step is to write the <strong class="source-inline">handleSubmit</strong> method. This method should handle the validity <a id="_idIndexMarker625"/>of the form, the request to update the information, and also what to display according to <span class="No-Break">the result:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
const handleSubmit = (event) =&gt; {
  event.preventDefault();
  const updateProfileForm = event.currentTarget;
  if (updateProfileForm.checkValidity() === false) {
    event.stopPropagation();
  }
  setValidated(true);
  const data = {
    first_name: form.first_name,
    last_name: form.last_name,
    bio: form.bio,
  };
  const formData = new FormData();
}
...</pre>
			<p>As we <a id="_idIndexMarker626"/>are going to include a file in the data sent to the server, we are using a <strong class="source-inline">FormData</strong> object. A <strong class="source-inline">FormData</strong> object is a common way to create a bundle of data that will be sent to a server. It provides <a id="_idIndexMarker627"/>a simple and easy way to construct a set of <strong class="bold">key/value</strong> pairs, representing the name of the form fields and <span class="No-Break">their value.</span></p>
			<p>In the case of our project, we will need to pass the data in the data variable to the <span class="No-Break"><strong class="source-inline">formData</strong></span><span class="No-Break"> object:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
const formData = new FormData();
Object.keys(data).forEach((key) =&gt; {
    if (data[key]) {
      formData.append(key, data[key]);
    }
});
...</pre>
			<p>The <strong class="source-inline">Object</strong> constructor provides a <strong class="source-inline">keys</strong> method that returns the list of keys in a JavaScript object. We then use the <strong class="source-inline">forEach</strong> method to loop through the <strong class="source-inline">keys</strong> array, check if <strong class="source-inline">data[key]</strong> value is not null, and then we append the values from the data object to the <strong class="source-inline">formData</strong> object. We also need to add a case for the <span class="No-Break">avatar field:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
const formData = new FormData();
// Checking for null values in the form and removing them.
Object.keys(data).forEach((key) =&gt; {
    if (data[key]) {
      formData.append(key, data[key]);
    }
});
if (avatar) {
  formData.append("avatar", avatar);
}
...</pre>
			<p>We <a id="_idIndexMarker628"/>can now move to the <span class="No-Break">edit action:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
userActions
  .edit(formData, profile.id)
  .then(() =&gt; {
    setToaster({
      type: "success",
      message: "Profile updated successfully 🚀",
      show: true,
      title: "Profile updated",
    });
    navigate(-1);
  })
  .catch((err) =&gt; {
    if (err.message) {
      setError(err.request.response);
    }
  });
...</pre>
			<p>Nothing complicated here. It’s like what we used to do for other requests on the API. Let’s <a id="_idIndexMarker629"/>move to the form now. The form will contain fields for the avatar such as the first name, the last name, and the bio. These fields are the only information the user will update. Let’s start by writing the avatar <span class="No-Break">field first:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
return (
  &lt;Form
    id="registration-form"
    className="border p-4 rounded"
    noValidate
    validated={validated}
    onSubmit={handleSubmit}
  &gt;
    &lt;Form.Group className="mb-3 d-flex flex-column"&gt;
      &lt;Form.Label className="text-center"&gt;Avatar
      &lt;/Form.Label&gt;
      &lt;Image
        src={form.avatar}
        roundedCircle
        width={120}
        height={120}
        className="m-2 border border-primary border-2
                   align-self-center"
      /&gt;
      &lt;Form.Control
        onChange={(e) =&gt; setAvatar(e.target.files[0])}
        className="w-50 align-self-center"
        type="file"
        size="sm"
      /&gt;
      &lt;Form.Control.Feedback type="invalid"&gt;
        This file is required.
      &lt;/Form.Control.Feedback&gt;
    &lt;/Form.Group&gt;
    ...
  &lt;/Form&gt;
);</pre>
			<p>Great! Let’s <a id="_idIndexMarker630"/>add the fields for the last name and <span class="No-Break">first name:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
&lt;Form.Group className="mb-3"&gt;
  &lt;Form.Label&gt;First Name&lt;/Form.Label&gt;
  &lt;Form.Control
    value={form.first_name}
    onChange={(e) =&gt; setForm({ ...form, first_name:
                              e.target.value })}
    required
    type="text"
    placeholder="Enter first name"
  /&gt;
  &lt;Form.Control.Feedback type="invalid"&gt;
    This file is required.
  &lt;/Form.Control.Feedback&gt;
&lt;/Form.Group&gt;
&lt;Form.Group className="mb-3"&gt;
  &lt;Form.Label&gt;Last name&lt;/Form.Label&gt;
  &lt;Form.Control
    value={form.last_name}
    onChange={(e) =&gt; setForm({ ...form, last_name:
                              e.target.value })}
    required
    type="text"
    placeholder="Enter last name"
  /&gt;
  &lt;Form.Control.Feedback type="invalid"&gt;
    This file is required.
  &lt;/Form.Control.Feedback&gt;
&lt;/Form.Group&gt;
...</pre>
			<p>Finally, let <a id="_idIndexMarker631"/>us add the bio field and the <span class="No-Break">submit button:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
&lt;Form.Group className="mb-3"&gt;
  &lt;Form.Label&gt;Bio&lt;/Form.Label&gt;
  &lt;Form.Control
    value={form.bio}
    onChange={(e) =&gt; setForm({ ...form, bio: e.target.value })}
    as="textarea"
    rows={3}
    placeholder="A simple bio ... (Optional)"
  /&gt;
&lt;/Form.Group&gt;
&lt;div className="text-content text-danger"&gt;{error &amp;&amp; &lt;p&gt;{error}&lt;/p&gt;}&lt;/div&gt;
&lt;Button variant="primary" type="submit"&gt;
  Save changes
&lt;/Button&gt;
...</pre>
			<p>Great! The <strong class="source-inline">UpdateProfileForm</strong> component is <a id="_idIndexMarker632"/>written and we can use it to create the <span class="No-Break"><strong class="source-inline">EditProfile.jsx</strong></span><span class="No-Break"> page.</span></p>
			<h2 id="_idParaDest-201"><a id="_idTextAnchor215"/>Creating the EditProfile page</h2>
			<p>Inside the <strong class="source-inline">src/pages/</strong> directory, create a new file called <strong class="source-inline">EditProfile.jsx</strong>. This file will <a id="_idIndexMarker633"/>contain the code for the page that will display the form to edit information about <span class="No-Break">the user:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/EditProfile.jsx</p>
			<pre class="source-code">
import React from "react";
import { useParams } from "react-router-dom";
import useSWR from "swr";
import Layout from "../components/Layout";
import UpdateProfileForm from "../components/profile/UpdateProfileForm";
import { fetcher } from "../helpers/axios";
import { Row, Col } from "react-bootstrap";
function EditProfile() {
  return (
    //JSX code
  );
}
export default EditProfile;</pre>
			<p>With the <a id="_idIndexMarker634"/>needed imports added, we can now add the fetching logic and <span class="No-Break">the UI:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/EditProfile.jsx</p>
			<pre class="source-code">
...
function EditProfile() {
  const { profileId } = useParams();
  const profile = useSWR(`/user/${profileId}/`, fetcher);
  return (
    &lt;Layout hasNavigationBack&gt;
      {profile.data ? (
        &lt;Row className="justify-content-evenly"&gt;
          &lt;Col sm={9}&gt;
            &lt;UpdateProfileForm profile={profile.data} /&gt;
          &lt;/Col&gt;
        &lt;/Row&gt;
      ) : (
        &lt;div&gt;Loading...&lt;/div&gt;
      )}
    &lt;/Layout&gt;
  );
}
...</pre>
			<p>In the <strong class="source-inline">EditProfile</strong> function, we are planning to retrieve the <strong class="source-inline">profileId</strong> that will be used <a id="_idIndexMarker635"/>to fetch the up-to-date user information and pass the response to the <strong class="source-inline">UpdateProfileForm</strong> component. Naturally, we are returning the <strong class="bold">Loading</strong> text if the data is not pulled from the server yet. Great! Let’s register this page in the <span class="No-Break"><strong class="source-inline">App.js</strong></span><span class="No-Break"> file:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.jsx</p>
			<pre class="source-code">
...
&lt;Route
  path="/profile/:profileId/edit/"
  element={
    &lt;ProtectedRoute&gt;
      &lt;EditProfile /&gt;
    &lt;/ProtectedRoute&gt;
  }
/&gt;
...</pre>
			<p>Now, go to your profile and click on the <strong class="bold">Edit</strong> button. Change the information and add an avatar image to make sure everything <span class="No-Break">is working.</span></p>
			<p>The React application is nearly done. We have CRUD operations for authentication, posts, comments, and new users. Now, it’s time to focus on the quality and maintainability of <span class="No-Break">our components.</span></p>
			<h1 id="_idParaDest-202"><a id="_idTextAnchor216"/>Summary</h1>
			<p>In this chapter, we added CRUD operations for the user in the React application. We explored how powerful and simple it is to handle media uploading in Django and how to create a form that can accept file uploads to a remote server. We have also added new components to the React application for better navigation and exploration of other profiles. We are done implementing most features of <span class="No-Break">our application.</span></p>
			<p>In the next chapter, we will learn how to write tests for a React <span class="No-Break">frontend application.</span></p>
			<h1 id="_idParaDest-203"><a id="_idTextAnchor217"/>Questions</h1>
			<ol>
				<li value="1">What is a <span class="No-Break"><strong class="source-inline">formData</strong></span><span class="No-Break"> object?</span></li>
				<li>What is the <strong class="source-inline">MEDIA_URL</strong> setting usage <span class="No-Break">in Django?</span></li>
				<li>What is the <strong class="source-inline">MEDIA_ROOT</strong> setting usage <span class="No-Break">in Django?</span></li>
			</ol>
		</div>
		<div>
			<div id="_idContainer121" class="IMG---Figure">
			</div>
		</div>
	</body></html>