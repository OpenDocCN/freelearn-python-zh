<html><head></head><body>
		<div><p><a id="_idTextAnchor203"/><a id="_idTextAnchor204"/></p>
			<h1 id="_idParaDest-191" class="chapter-number"><a id="_idTextAnchor205"/>10</h1>
			<h1 id="_idParaDest-192"><a id="_idTextAnchor206"/>User Profiles</h1>
			<p>A social media application should allow users to consult other user profiles. From another view, it should also allow an authenticated user to edit their information, such as their last name, first name, and avatar.</p>
			<p>In this chapter, we will focus on adding CRUD features on the user side. Weâ€™ll build a page to visualize a user profile and a page that allows a user to edit their information. This chapter will cover the following topics:</p>
			<ul>
				<li>Listing profiles on the home page</li>
				<li>Displaying user information on their profile page</li>
				<li>Editing user information</li>
			</ul>
			<h1 id="_idParaDest-193"><a id="_idTextAnchor207"/>Technical requirements</h1>
			<p>Make sure to have VS Code and an updated browser installed and configured on your machine. You can find all the code files used in this chapter at <a href="https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap10">https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap10</a>.</p>
			<h1 id="_idParaDest-194"><a id="_idTextAnchor208"/>Listing profiles on the home page</h1>
			<p>Before <a id="_idIndexMarker597"/>building the pages and components to display user information and allow user information modification, we need to add a component to list some profiles on the home page like so:</p>
			<div><div><img src="img/Figure_10.01_B18221.jpg" alt="Figure 10.1 â€“ Listing profiles"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.1 â€“ Listing profiles</p>
			<p>Follow these <a id="_idIndexMarker598"/>steps to add the component for listing profiles on the home page:</p>
			<ol>
				<li>In the <code>src/components</code> file, create a new directory called <code>profile</code>. This directory will contain the code for all components related to users or profiles.</li>
				<li>In the newly created directory, create a file called <code>ProfileCard.jsx</code> and add the following content:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileCard.jsx</p>
			<pre class="source-code">
import React from "react";
import { Card, Button, Image } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
function ProfileCard(props) {
 return (
Â Â Â Â // JSX code here
 );
}
export default ProfileCard;</pre>
			<p>The <code>ProfileCard</code> component will be used to display information about a profile and redirect the user to the profile page.</p>
			<ol>
				<li value="3">Next, we will <a id="_idIndexMarker599"/>add the code logic concerning the navigation to the profile page and the props object destructuration:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileCard.jsx</p>
			<pre class="source-code">
...
function ProfileCard(props) {
 const navigate = useNavigate();
 const { user } = props;
 const handleNavigateToProfile = () =&gt; {
Â Â Â navigate(`/profile/${user.id}/`)
 };
 return (
Â Â Â Â // JSX Code
 );
}
export default ProfileCard;</pre>
			<p>In the preceding code, we retrieved the user object from the props and we also added a function to handle the navigation to the user profile.</p>
			<ol>
				<li value="4">Next, letâ€™s write <a id="_idIndexMarker600"/>the JSX that will display information to the user:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileCard.jsx</p>
			<pre class="source-code">
...
 return (
Â Â Â &lt;Card className="border-0 p-2"&gt;
Â Â Â Â Â &lt;div className="d-flex "&gt;
Â Â Â Â Â Â Â &lt;Image
Â Â Â Â Â Â Â Â Â src={user.avatar}
Â Â Â Â Â Â Â Â Â roundedCircle
Â Â Â Â Â Â Â Â Â width={48}
Â Â Â Â Â Â Â Â Â height={48}
Â Â Â Â Â Â Â Â Â className=
Â Â Â Â Â Â Â Â Â Â Â "my-3 border border-primary border-2"
Â Â Â Â Â Â Â /&gt;
Â Â Â Â Â Â Â &lt;Card.Body&gt;
Â Â Â Â Â Â Â Â Â &lt;Card.Title
Â Â Â Â Â Â Â Â Â Â Â className="fs-6"&gt;{user.name}&lt;/Card.Title&gt;
Â Â Â Â Â Â Â Â Â &lt;Button variant="primary"
Â Â Â Â Â Â Â Â Â Â Â onClick={handleNavigateToProfile}&gt;
Â Â Â Â Â Â Â Â Â Â Â See profile
Â Â Â Â Â Â Â Â Â &lt;/Button&gt;
Â Â Â Â Â Â Â &lt;/Card.Body&gt;
Â Â Â Â Â &lt;/div&gt;
Â Â Â &lt;/Card&gt;
 );
}
export default ProfileCard;</pre>
			<p>The <code>ProfileCard</code> component is written. We can now import it into the <code>Home.jsx</code> page and use it. But before that, we need to retrieve five profiles from the API <a id="_idIndexMarker601"/>and loop through the results to have the wanted display:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
...
import CreatePost from "../components/posts/CreatePost";
import ProfileCard from "../components/profile/ProfileCard";
function Home() {
...
 const profiles = useSWR("/user/?limit=5", fetcher);
...
 return (
Â Â Â &lt;Layout&gt;
Â Â Â Â Â &lt;Row className="justify-content-evenly"&gt;
Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â &lt;Col sm={3} className="border rounded py-4
Â Â Â Â Â Â Â Â Â Â Â h-50"&gt;
Â Â Â Â Â Â Â Â Â &lt;h4 className="font-weight-bold text-center"&gt;
Â Â Â Â Â Â Â Â Â Â Â Suggested people&lt;/h4&gt;
Â Â Â Â Â Â Â Â Â &lt;div className="d-flex flex-column"&gt;
Â Â Â Â Â Â Â Â Â Â Â {profiles.data &amp;&amp;
Â Â Â Â Â Â Â Â Â Â Â Â Â profiles.data.results.map((profile,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â index) =&gt; (
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;ProfileCard key={index} user={profile}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â /&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â ))}
Â Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â &lt;/Col&gt;
Â Â Â Â Â &lt;/Row&gt;
Â Â Â &lt;/Layout&gt;
 );
}
export default Home;</pre>
			<p>In the <a id="_idIndexMarker602"/>preceding code, the profiles are only shown if the <code>profiles.data</code> object is not null or undefined. This is why we are writing the <code>profiles.data  &amp;&amp; profiles.data.results.map()</code> inline JSX condition.</p>
			<ol>
				<li value="5">Once itâ€™s done, reload the home page and youâ€™ll have a new component available, listing a maximum of five profiles.</li>
			</ol>
			<p>Try to click on the <strong class="bold">See Profile</strong> button. You will be redirected to a white page. This is normal because we havenâ€™t written routing for the <strong class="bold">Profile</strong> page yet.</p>
			<p>In the next section, we will <a id="_idIndexMarker603"/>be creating components to display information about a profile, like so:</p>
			<div><div><img src="img/Figure_10.02_B18221.jpg" alt="Figure 10.2 â€“ The user profile page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.2 â€“ The user profile page</p>
			<p>We will also allow the user to edit their information, like so:</p>
			<div><div><img src="img/Figure_10.03_B18221.jpg" alt="Figure 10.3 â€“ The user edit form and page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.3 â€“ The user edit form and page</p>
			<h1 id="_idParaDest-195"><a id="_idTextAnchor209"/>Displaying user information on their profile page</h1>
			<p>In this section, we will create a profile page to display user information. We will build a component <a id="_idIndexMarker604"/>to display user details and the posts concerning this user, but also we will create a page displaying a form for editing user information.</p>
			<p>Before starting to build the user profile page, we have to create some components. On the profile page, we are not only displaying information but also the list of posts created by the user. Letâ€™s start by writing the <code>ProfileDetails.jsx</code> component (<em class="italic">Figure 10</em><em class="italic">.4</em>):</p>
			<div><div><img src="img/Figure_10.04_B18221.jpg" alt="Figure 10.4 â€“ The ProfileDetails component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.4 â€“ The ProfileDetails component</p>
			<p>Hereâ€™s the wireframe to help you with the structure of the component:</p>
			<div><div><img src="img/Figure_10.05_B18221.jpg" alt="Figure 10.5 â€“ The wireframe of the ProfileDetails component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.5 â€“ The wireframe of the ProfileDetails component</p>
			<p>In the <code>ProfileDetails</code> component, we are displaying some avatars. At this point of the project, itâ€™s time to get rid of the <code>randomAvatar</code> function. It has been useful up until this point of the project, but we are making a lot of requests and some state change within the application just calls the function again that returns another random image, which is not something a user of the application might want to see.</p>
			<p>Letâ€™s start using the value of the avatar field on the user object but before that, we have to configure Django to deal with media upload and the avatar field on the user object.</p>
			<p>The social <a id="_idIndexMarker605"/>media application uses the <code>avatar</code> field, which represents a link to a file that the browser can make a request on and receive the image. Django supports file uploading; we just need to add some configuration to make it effective.</p>
			<p>Inside the <code>settings.py</code> file of the project, add the following lines at the end of the project:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
â€¦
<strong class="bold">MEDIA_URL'= '/med'a/'</strong>
<strong class="bold">MEDIA_ROOT = BASE_DIR'/ 'uplo'ds'</strong></pre>
			<p>The <code>MEDIA_URL</code> setting allows us to write the URL that will be used to retrieve uploaded files. The <code>MEDIA_ROOT</code> setting tells Django where to stock the files and also checks the upload files when returning the URL of a file. In the case of this project, an avatar field will have this URL, for example: <code>http://localhost:8000/media/user_8380ca50-ad0f-4141-88ef-69dc9b0707ad/avatar-rogemon.png</code>.</p>
			<p>For this configuration to work, you will need to create a directory called <code>uploads</code> at the root of the Django project. You will also need to install the Pillow library, which contains all the basic tools for image processing functionality:</p>
			<pre class="source-code">
pip install pillow</pre>
			<p>After that, letâ€™s slightly modify the avatar field on the user model. Inside the <code>core/user/models.py</code>, add a function before the <code>UserManager</code> manager class:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">core/user/models.py</p>
			<pre class="source-code">
...
def user_directory_path(instance, filename):
Â Â Â Â # file will be uploaded to
Â Â Â Â Â Â Â MEDIA_ROOT/user_&lt;id&gt;/&lt;filename&gt;
Â Â Â Â return 'user_{0}/{1}'.format(instance.public_id,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â filename)
...</pre>
			<p>This function <a id="_idIndexMarker606"/>will help re-write the path for the upload of a file. Instead of going directly into the <code>uploads</code> directory, the avatar is stocked according to a user. It can help with the better organization of files in your system. After adding the function, we can tell Django to use it for the default upload path:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">core/user/models.py</p>
			<pre class="source-code">
...
class User(AbstractModel, AbstractBaseUser, PermissionsMixin):
...
Â Â Â Â avatar = models.ImageField(
Â Â Â Â Â Â Â Â null=True, blank=True,
Â Â Â Â Â Â Â Â Â Â Â Â Â upload_to=user_directory_path)
...</pre>
			<p>In Django, the <code>ImageField</code> field is used to store image files in a database. It is a subclass of <code>FileField</code>, which is a generic field for storing files, so it has all the attributes of <code>FileField</code> as well as some additional attributes specific to images. The <code>upload_to</code> attribute specifies the directory where the image files will be stored.</p>
			<p>Now, run the <code>makemigrations</code> command and make sure to migrate the changes to the database:</p>
			<pre class="console">
python manage.py makemigrations
python manage.py migrate</pre>
			<p>With this <a id="_idIndexMarker607"/>configuration done, our API can accept avatar uploading for the user. However, some users wonâ€™t have an avatar and we have been handling it pretty badly from the frontend side. Letâ€™s set up a default avatar that will be used for users without an avatar.</p>
			<h2 id="_idParaDest-196"><a id="_idTextAnchor210"/>Configuring the default avatar</h2>
			<p>To configure <a id="_idIndexMarker608"/>the default avatar, follow these steps:</p>
			<ol>
				<li value="1">In the <code>settings.py</code> file of the Django project, add the following line at the end of the file:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
...
DEFAULT_AVATAR_URL = "https://avatars.dicebear.com/api/identicon/.svg"</pre>
			<p>The avatar image looks as follows:</p>
			<div><div><img src="img/Figure_10.06_B18221.jpg" alt=""/>
				</div>
			</div>
			<p class="IMG---Figure">Image 10.6: The default image</p>
			<ol>
				<li value="2">Once you <a id="_idIndexMarker609"/>have added <code>DEFAULT_AVATAR_URL</code> to the <code>settings.py</code> file, we will slightly modify the <code>UserSerializer</code> representation method to return the <code>DEFAULT_AVATAR_URL</code> value by default if the avatar field is none:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">Core/user/serializers.py</p>
			<pre class="source-code">
...
from django.conf import settings
class UserSerializer(AbstractSerializer):
...
Â Â Â Â def to_representation(self, instance):
Â Â Â Â Â Â Â Â representation =
Â Â Â Â Â Â Â Â Â Â super().to_representation(instance)
Â Â Â Â Â Â Â Â if not representation['avatar']:
Â Â Â Â Â Â Â Â Â Â Â Â representation['avatar'] =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â settings.DEFAULT_AUTO_FIELD
Â Â Â Â Â Â Â Â Â Â Â Â return representation
Â Â Â Â Â Â Â Â if settings.DEBUG:Â Â # debug enabled for dev
Â Â Â Â Â Â Â Â Â Â Â Â request = self.context.get('request')
Â Â Â Â Â Â Â Â Â Â Â Â representation['avatar'] =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â request.build_absolute_uri(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â representation['avatar'])
Â Â Â Â Â Â Â Â return representation</pre>
			<p>Letâ€™s explain what we are doing in the preceding code block. First, we need to check <a id="_idIndexMarker610"/>whether the avatar value exists. If thatâ€™s not the case, we will return the default avatar. By default, Django doesnâ€™t return the actual route of the file with the domain. Thatâ€™s why in this case, if we are in a development environment, we return an absolute URL of the avatar. In the last part of this book, we will deploy the application on a production server, then we will use <strong class="bold">AWS S3</strong> for file storing.</p>
			<p>With the fix done on the backend, we can confidently modify the frontend application by now including the avatar field. Itâ€™s quite simple and a little bit of refactoring. Remove the <code>randomAvatar</code> function code from the React application and replace the values with <code>user.avatar</code>,  <code>post.author.avatar</code>, or <code>comment.author.avatar</code>, depending on the file and the component.</p>
			<ol>
				<li value="3">With those small configurations done, check the <strong class="bold">Home</strong> page; you should have a similar result.</li>
			</ol>
			<div><div><img src="img/Figure_10.07_B18221.jpg" alt="Figure 10.7 â€“ The Home page with a default avatar"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.7 â€“ The Home page with a default avatar</p>
			<p>Great! Letâ€™s <a id="_idIndexMarker611"/>move to creating the <strong class="bold">Profile</strong> page so that our Django application is ready to accept file uploads.</p>
			<h2 id="_idParaDest-197"><a id="_idTextAnchor211"/>Writing the ProfileDetails component</h2>
			<p>To create the <code>ProfileDetails</code> component, we have to create the file that will contain <a id="_idIndexMarker612"/>the code for this component, add the logic for the navigation, write the UI (JSX), and import the component on the <strong class="bold">Profile</strong> page:</p>
			<ol>
				<li value="1">In the <code>src/components/profile</code> directory, create a new file called <code>ProfileDetail.jsx</code>. This file will contain the code for the <code>ProfileDetails</code> component:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileDetails.jsx</p>
			<pre class="source-code">
import React from "react";
import { Button, Image } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
function ProfileDetails(props) {
 return (
// JSX code here
 );
}
export default ProfileDetails;</pre>
			<ol>
				<li value="2">Here, we just need to destruct the props object to retrieve the user object, declare <a id="_idIndexMarker613"/>the navigate variable to use the <code>useNagivate</code> Hook, and finally handle the case when the user object is undefined or null:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileDetaisl.jsx</p>
			<pre class="source-code">
...
function ProfileDetails(props) {
 const { user } = props;
 const navigate = useNavigate();
 if (!user) {
Â Â Â return &lt;div&gt;Loading...&lt;/div&gt;;
 }
 return (
Â Â Â // JSX Code here
 );
}
export default ProfileDetails;</pre>
			<ol>
				<li value="3">We can <a id="_idIndexMarker614"/>confidently write the JSX logic now:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/profile/ProfileDetails.jsx</p>
			<pre class="source-code">
...
 return (
Â Â Â &lt;div&gt;
Â Â Â Â Â &lt;div className="d-flex flex-row border-bottom
Â Â Â Â Â Â Â p-5"&gt;
Â Â Â Â Â Â Â &lt;Image
Â Â Â Â Â Â Â Â Â src={user.avatar}
Â Â Â Â Â Â Â Â Â roundedCircle
Â Â Â Â Â Â Â Â Â width={120}
Â Â Â Â Â Â Â Â Â height={120}
Â Â Â Â Â Â Â Â Â className="me-5 border border-primary
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â border-2"
Â Â Â Â Â Â Â /&gt;
Â Â Â Â Â Â Â &lt;div className="d-flex flex-column
Â Â Â Â Â Â Â Â justify-content-start align-self-center mt-2"&gt;
Â Â Â Â Â Â Â Â Â &lt;p className="fs-4 m-0"&gt;{user.name}&lt;/p&gt;
Â Â Â Â Â Â Â Â Â &lt;p className="fs-5"&gt;{user.bio ? user.bio :
Â Â Â Â Â Â Â Â Â Â Â "(No bio.)"}&lt;/p&gt;
Â Â Â Â Â Â Â Â Â &lt;p className="fs-6"&gt;
Â Â Â Â Â Â Â Â Â Â Â &lt;small&gt;{user.posts_count} posts&lt;/small&gt;
Â Â Â Â Â Â Â Â Â &lt;/p&gt;
Â Â Â Â Â Â Â Â Â &lt;Button
Â Â Â Â Â Â Â Â Â Â Â variant="primary"
Â Â Â Â Â Â Â Â Â Â Â size="sm"
Â Â Â Â Â Â Â Â Â Â Â className="w-25"
Â Â Â Â Â Â Â Â Â Â Â onClick={() =&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â navigate(`/profile/${user.id}/edit/`)}
Â Â Â Â Â Â Â Â Â &gt;
Â Â Â Â Â Â Â Â Â Â Â Edit
Â Â Â Â Â Â Â Â Â &lt;/Button&gt;
Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â &lt;/div&gt;
Â Â Â &lt;/div&gt;
 );</pre>
			<ol>
				<li value="4">Now that <a id="_idIndexMarker615"/>the component is written, create a new file called <code>Profile.jsx</code> in the <code>src/pages</code> directory. This file will contain the code and logic for the <strong class="bold">Profile</strong> page:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Profile.jsx</p>
			<pre class="source-code">
import React from "react";
import { useParams } from "react-router-dom";
import Layout from "../components/Layout";
import ProfileDetails from "../components/profile/ProfileDetails";
import useSWR from "swr";
import { fetcher } from "../helpers/axios";
import { Post } from "../components/posts";
import { Row, Col } from "react-bootstrap";
function Profile() {
Â Â return (
Â Â Â Â // JSX CODE
Â Â );
}
export default Profile;</pre>
			<ol>
				<li value="5">Letâ€™s add <a id="_idIndexMarker616"/>the fetching logic for the user and the user posts. No need to create another <code>Post</code> component as the same <code>Post</code> component from <code>src/components/Post.jsx</code> will be used to list posts created by the profile:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Profile.jsx</p>
			<pre class="source-code">
...
function Profile() {
Â Â const { profileId } = useParams();
Â Â const user = useSWR(`/user/${profileId}/`, fetcher);
Â Â const posts = useSWR(`/post/?author__public_id=${profileId}`, fetcher, {
Â Â Â Â Â Â Â refreshInterval: 20000
Â Â Â });
...</pre>
			<ol>
				<li value="6">Once itâ€™s <a id="_idIndexMarker617"/>done, we can now write the UI logic:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Profile.jsx</p>
			<pre class="source-code">
...
Â Â return (
Â Â Â Â &lt;Layout hasNavigationBack&gt;
Â Â Â Â Â Â &lt;Row className="justify-content-evenly"&gt;
Â Â Â Â Â Â Â Â &lt;Col sm={9}&gt;
Â Â Â Â Â Â Â Â Â Â &lt;ProfileDetails user={user.data}/&gt;
Â Â Â Â Â Â Â Â Â Â &lt;div&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;Row className="my-4"&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â {posts.data?.results.map((post, index)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â =&gt; (
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Post key={index} post={post}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â refresh={posts.mutate} /&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â ))}
Â Â Â Â Â Â Â Â Â Â Â Â &lt;/Row&gt;
Â Â Â Â Â Â Â Â Â Â &lt;/div&gt;
Â Â Â Â Â Â Â Â &lt;/Col&gt;
Â Â Â Â Â Â &lt;/Row&gt;
Â Â Â Â &lt;/Layout&gt;
Â Â );
}
...</pre>
			<ol>
				<li value="7">Great! Letâ€™s <a id="_idIndexMarker618"/>now register this page in the <code>App.js</code> file:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.js</p>
			<pre class="source-code">
â€¦
&lt;Route
Â Â path="/profile/:profileId/"
Â Â element={
Â Â Â Â &lt;ProtectedRoute&gt;
Â Â Â Â Â Â &lt;Profile /&gt;
Â Â Â Â &lt;/ProtectedRoute&gt;
Â Â }
/&gt;
â€¦</pre>
			<ol>
				<li value="8">Letâ€™s not forget to add <code>Link</code> to the profile in the <code>Navbar.jsx</code> file:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Navbar.jsx</p>
			<pre class="source-code">
...
Â Â Â Â &lt;NavDropdown.Item as={Link} to=
Â Â Â Â Â Â {`/profile/${user.id}/`}&gt;Profile
Â Â Â Â &lt;/NavDropdown.Item&gt;
Â Â Â Â &lt;NavDropdown.Item onClick={handleLogout}&gt;Logout
Â Â Â Â &lt;/NavDropdown.Item&gt;
Â Â &lt;/NavDropdown&gt;
&lt;/Nav&gt;
...</pre>
			<ol>
				<li value="9">Great! You can <a id="_idIndexMarker619"/>now click on the <strong class="bold">See Profile</strong> button or directly on the drop-down menu of the navigation bar to go to the profile page:</li>
			</ol>
			<div><div><img src="img/Figure_10.08_B18221.jpg" alt="Figure 10.8 â€“ A random profile page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.8 â€“ A random profile page</p>
			<p>With the profile page ready, we can move on to create the page that will contain the form to edit user information.</p>
			<h1 id="_idParaDest-198"><a id="_idTextAnchor212"/>Editing user information</h1>
			<p>The <code>useUserActions</code> Hook by adding a new method to edit user information via the API. Then, we will create the form to edit user information. Lastly, we will integrate the editing form component on the <code>EditUser</code> page.</p>
			<p>Letâ€™s start by adding a new method to the <code>useUserActions</code> Hook.</p>
			<h2 id="_idParaDest-199"><a id="_idTextAnchor213"/>Adding the edit method to useUserActions</h2>
			<p>In the <code>src/hooks/user.actions.js</code> file, we will add another method to the <code>useUserActions</code> Hook. This function will handle the <code>patch</code> request to the API. As we are <a id="_idIndexMarker621"/>saving a user object in <code>localStorage</code>, we will update the value of the object if the request succeeds:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
function useUserActions() {
Â Â const navigate = useNavigate();
Â Â const baseURL = "http://localhost:8000/api";
Â Â return {
Â Â Â Â login,
Â Â Â Â register,
Â Â Â Â logout,
Â Â Â Â edit
Â Â };
...
Â Â // Edit the user
Â Â function edit(data, userId) {
Â Â Â Â return axiosService.patch(`${baseURL}/user/${userId}/`,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data).then((res) =&gt; {
Â Â Â Â Â Â // Registering the account in the store
Â Â Â Â Â Â localStorage.setItem(
Â Â Â Â Â Â Â Â "auth",
Â Â Â Â Â Â Â Â JSON.stringify({
Â Â Â Â Â Â Â Â Â Â access: getAccessToken(),
Â Â Â Â Â Â Â Â Â Â refresh: getRefreshToken(),
Â Â Â Â Â Â Â Â Â Â user: res.data,
Â Â Â Â Â Â Â Â })
Â Â Â Â Â Â );
Â Â Â Â });
Â Â }
...
}</pre>
			<p>With <a id="_idIndexMarker622"/>the <code>edit</code> function written, we can confidently move to create the form used to edit user information.</p>
			<h2 id="_idParaDest-200"><a id="_idTextAnchor214"/>The UpdateProfileForm component</h2>
			<p>In the <code>src/components/UpdateProfileForm.jsx</code>, create a file called <code>UpdateProfileForm.jsx</code>. This <a id="_idIndexMarker623"/>file will contain the code for the component used to edit user information:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
import React, { useState, useContext } from "react";
import { Form, Button, Image } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
import { useUserActions } from "../../hooks/user.actions";
import { Context } from "../Layout";
function UpdateProfileForm(props) {
Â Â return (
Â Â Â Â // JSX Code
Â Â );
}
export default UpdateProfileForm;</pre>
			<p>Letâ€™s start <a id="_idIndexMarker624"/>by retrieving the user object from the props and adding the Hooks needed for the form handling:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
function UpdateProfileForm(props) {
Â Â const { profile } = props;
Â Â const navigate = useNavigate();
Â Â const [validated, setValidated] = useState(false);
Â Â const [form, setForm] = useState(profile);
Â Â const [error, setError] = useState(null);
Â Â const userActions = useUserActions();
Â Â const [avatar, setAvatar] = useState();
Â Â const { toaster, setToaster } = useContext(Context);
...</pre>
			<p>The next step is to write the <code>handleSubmit</code> method. This method should handle the validity <a id="_idIndexMarker625"/>of the form, the request to update the information, and also what to display according to the result:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
const handleSubmit = (event) =&gt; {
Â Â event.preventDefault();
Â Â const updateProfileForm = event.currentTarget;
Â Â if (updateProfileForm.checkValidity() === false) {
Â Â Â Â event.stopPropagation();
Â Â }
Â Â setValidated(true);
Â Â const data = {
Â Â Â Â first_name: form.first_name,
Â Â Â Â last_name: form.last_name,
Â Â Â Â bio: form.bio,
Â Â };
Â Â const formData = new FormData();
}
...</pre>
			<p>As we <a id="_idIndexMarker626"/>are going to include a file in the data sent to the server, we are using a <code>FormData</code> object. A <code>FormData</code> object is a common way to create a bundle of data that will be sent to a server. It provides <a id="_idIndexMarker627"/>a simple and easy way to construct a set of <strong class="bold">key/value</strong> pairs, representing the name of the form fields and their value.</p>
			<p>In the case of our project, we will need to pass the data in the data variable to the <code>formData</code> object:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
const formData = new FormData();
Object.keys(data).forEach((key) =&gt; {
Â Â Â Â if (data[key]) {
Â Â Â Â Â Â formData.append(key, data[key]);
Â Â Â Â }
});
...</pre>
			<p>The <code>Object</code> constructor provides a <code>keys</code> method that returns the list of keys in a JavaScript object. We then use the <code>forEach</code> method to loop through the <code>keys</code> array, check if <code>data[key]</code> value is not null, and then we append the values from the data object to the <code>formData</code> object. We also need to add a case for the avatar field:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
const formData = new FormData();
// Checking for null values in the form and removing them.
Object.keys(data).forEach((key) =&gt; {
Â Â Â Â if (data[key]) {
Â Â Â Â Â Â formData.append(key, data[key]);
Â Â Â Â }
});
if (avatar) {
Â Â formData.append("avatar", avatar);
}
...</pre>
			<p>We <a id="_idIndexMarker628"/>can now move to the edit action:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
userActions
Â Â .edit(formData, profile.id)
Â Â .then(() =&gt; {
Â Â Â Â setToaster({
Â Â Â Â Â Â type: "success",
Â Â Â Â Â Â message: "Profile updated successfully ðŸš€",
Â Â Â Â Â Â show: true,
Â Â Â Â Â Â title: "Profile updated",
Â Â Â Â });
Â Â Â Â navigate(-1);
Â Â })
Â Â .catch((err) =&gt; {
Â Â Â Â if (err.message) {
Â Â Â Â Â Â setError(err.request.response);
Â Â Â Â }
Â Â });
...</pre>
			<p>Nothing complicated here. Itâ€™s like what we used to do for other requests on the API. Letâ€™s <a id="_idIndexMarker629"/>move to the form now. The form will contain fields for the avatar such as the first name, the last name, and the bio. These fields are the only information the user will update. Letâ€™s start by writing the avatar field first:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
return (
Â Â &lt;Form
Â Â Â Â id="registration-form"
Â Â Â Â className="border p-4 rounded"
Â Â Â Â noValidate
Â Â Â Â validated={validated}
Â Â Â Â onSubmit={handleSubmit}
Â Â &gt;
Â Â Â Â &lt;Form.Group className="mb-3 d-flex flex-column"&gt;
Â Â Â Â Â Â &lt;Form.Label className="text-center"&gt;Avatar
Â Â Â Â Â Â &lt;/Form.Label&gt;
Â Â Â Â Â Â &lt;Image
Â Â Â Â Â Â Â Â src={form.avatar}
Â Â Â Â Â Â Â Â roundedCircle
Â Â Â Â Â Â Â Â width={120}
Â Â Â Â Â Â Â Â height={120}
Â Â Â Â Â Â Â Â className="m-2 border border-primary border-2
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â align-self-center"
Â Â Â Â Â Â /&gt;
Â Â Â Â Â Â &lt;Form.Control
Â Â Â Â Â Â Â Â onChange={(e) =&gt; setAvatar(e.target.files[0])}
Â Â Â Â Â Â Â Â className="w-50 align-self-center"
Â Â Â Â Â Â Â Â type="file"
Â Â Â Â Â Â Â Â size="sm"
Â Â Â Â Â Â /&gt;
Â Â Â Â Â Â &lt;Form.Control.Feedback type="invalid"&gt;
Â Â Â Â Â Â Â Â This file is required.
Â Â Â Â Â Â &lt;/Form.Control.Feedback&gt;
Â Â Â Â &lt;/Form.Group&gt;
Â Â Â Â ...
Â Â &lt;/Form&gt;
);</pre>
			<p>Great! Letâ€™s <a id="_idIndexMarker630"/>add the fields for the last name and first name:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
&lt;Form.Group className="mb-3"&gt;
Â Â &lt;Form.Label&gt;First Name&lt;/Form.Label&gt;
Â Â &lt;Form.Control
Â Â Â Â value={form.first_name}
Â Â Â Â onChange={(e) =&gt; setForm({ ...form, first_name:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.target.value })}
Â Â Â Â required
Â Â Â Â type="text"
Â Â Â Â placeholder="Enter first name"
Â Â /&gt;
Â Â &lt;Form.Control.Feedback type="invalid"&gt;
Â Â Â Â This file is required.
Â Â &lt;/Form.Control.Feedback&gt;
&lt;/Form.Group&gt;
&lt;Form.Group className="mb-3"&gt;
Â Â &lt;Form.Label&gt;Last name&lt;/Form.Label&gt;
Â Â &lt;Form.Control
Â Â Â Â value={form.last_name}
Â Â Â Â onChange={(e) =&gt; setForm({ ...form, last_name:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.target.value })}
Â Â Â Â required
Â Â Â Â type="text"
Â Â Â Â placeholder="Enter last name"
Â Â /&gt;
Â Â &lt;Form.Control.Feedback type="invalid"&gt;
Â Â Â Â This file is required.
Â Â &lt;/Form.Control.Feedback&gt;
&lt;/Form.Group&gt;
...</pre>
			<p>Finally, let <a id="_idIndexMarker631"/>us add the bio field and the submit button:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/UpdateProfileForm.jsx</p>
			<pre class="source-code">
...
&lt;Form.Group className="mb-3"&gt;
Â Â &lt;Form.Label&gt;Bio&lt;/Form.Label&gt;
Â Â &lt;Form.Control
Â Â Â Â value={form.bio}
Â Â Â Â onChange={(e) =&gt; setForm({ ...form, bio: e.target.value })}
Â Â Â Â as="textarea"
Â Â Â Â rows={3}
Â Â Â Â placeholder="A simple bio ... (Optional)"
Â Â /&gt;
&lt;/Form.Group&gt;
&lt;div className="text-content text-danger"&gt;{error &amp;&amp; &lt;p&gt;{error}&lt;/p&gt;}&lt;/div&gt;
&lt;Button variant="primary" type="submit"&gt;
Â Â Save changes
&lt;/Button&gt;
...</pre>
			<p>Great! The <code>UpdateProfileForm</code> component is <a id="_idIndexMarker632"/>written and we can use it to create the <code>EditProfile.jsx</code> page.</p>
			<h2 id="_idParaDest-201"><a id="_idTextAnchor215"/>Creating the EditProfile page</h2>
			<p>Inside the <code>src/pages/</code> directory, create a new file called <code>EditProfile.jsx</code>. This file will <a id="_idIndexMarker633"/>contain the code for the page that will display the form to edit information about the user:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/EditProfile.jsx</p>
			<pre class="source-code">
import React from "react";
import { useParams } from "react-router-dom";
import useSWR from "swr";
import Layout from "../components/Layout";
import UpdateProfileForm from "../components/profile/UpdateProfileForm";
import { fetcher } from "../helpers/axios";
import { Row, Col } from "react-bootstrap";
function EditProfile() {
Â Â return (
Â Â Â Â //JSX code
Â Â );
}
export default EditProfile;</pre>
			<p>With the <a id="_idIndexMarker634"/>needed imports added, we can now add the fetching logic and the UI:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/EditProfile.jsx</p>
			<pre class="source-code">
...
function EditProfile() {
Â Â const { profileId } = useParams();
Â Â const profile = useSWR(`/user/${profileId}/`, fetcher);
Â Â return (
Â Â Â Â &lt;Layout hasNavigationBack&gt;
Â Â Â Â Â Â {profile.data ? (
Â Â Â Â Â Â Â Â &lt;Row className="justify-content-evenly"&gt;
Â Â Â Â Â Â Â Â Â Â &lt;Col sm={9}&gt;
Â Â Â Â Â Â Â Â Â Â Â Â &lt;UpdateProfileForm profile={profile.data} /&gt;
Â Â Â Â Â Â Â Â Â Â &lt;/Col&gt;
Â Â Â Â Â Â Â Â &lt;/Row&gt;
Â Â Â Â Â Â ) : (
Â Â Â Â Â Â Â Â &lt;div&gt;Loading...&lt;/div&gt;
Â Â Â Â Â Â )}
Â Â Â Â &lt;/Layout&gt;
Â Â );
}
...</pre>
			<p>In the <code>EditProfile</code> function, we are planning to retrieve the <code>profileId</code> that will be used <a id="_idIndexMarker635"/>to fetch the up-to-date user information and pass the response to the <code>UpdateProfileForm</code> component. Naturally, we are returning the <code>App.js</code> file:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.jsx</p>
			<pre class="source-code">
...
&lt;Route
Â Â path="/profile/:profileId/edit/"
Â Â element={
Â Â Â Â &lt;ProtectedRoute&gt;
Â Â Â Â Â Â &lt;EditProfile /&gt;
Â Â Â Â &lt;/ProtectedRoute&gt;
Â Â }
/&gt;
...</pre>
			<p>Now, go to your profile and click on the <strong class="bold">Edit</strong> button. Change the information and add an avatar image to make sure everything is working.</p>
			<p>The React application is nearly done. We have CRUD operations for authentication, posts, comments, and new users. Now, itâ€™s time to focus on the quality and maintainability of our components.</p>
			<h1 id="_idParaDest-202"><a id="_idTextAnchor216"/>Summary</h1>
			<p>In this chapter, we added CRUD operations for the user in the React application. We explored how powerful and simple it is to handle media uploading in Django and how to create a form that can accept file uploads to a remote server. We have also added new components to the React application for better navigation and exploration of other profiles. We are done implementing most features of our application.</p>
			<p>In the next chapter, we will learn how to write tests for a React frontend application.</p>
			<h1 id="_idParaDest-203"><a id="_idTextAnchor217"/>Questions</h1>
			<ol>
				<li value="1">What is a <code>formData</code> object?</li>
				<li>What is the <code>MEDIA_URL</code> setting usage in Django?</li>
				<li>What is the <code>MEDIA_ROOT</code> setting usage in Django?</li>
			</ol>
		</div>
		<div><div></div>
		</div>
	</body></html>