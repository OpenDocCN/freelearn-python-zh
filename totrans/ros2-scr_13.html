<html><head></head><body>
		<div id="_idContainer065" class="calibre2">
			<h1 class="chapter-number" id="_idParaDest-234"><a id="_idTextAnchor488" class="pcalibre calibre4 pcalibre1"/>10</h1>
			<h1 id="_idParaDest-235" class="calibre6"><a id="_idTextAnchor489" class="pcalibre calibre4 pcalibre1"/>Discovering TFs with RViz</h1>
			<p class="calibre3">In <em class="italic">Part 3</em> of this book, you will create a robot simulation with ROS 2. However, before you get started, you first <a id="_idIndexMarker666" class="pcalibre calibre4 pcalibre1"/>need to understand what <strong class="bold">TransForms</strong> (<span><strong class="bold">TFs</strong></span><span>) are.</span></p>
			<p class="calibre3">In ROS, a TF is the transformation between two frames in 3D space. TFs will be used to track the different coordinate frames of a ROS robot (or system with multiple robots) over time. They are used everywhere and will be the backbone of any robot <span>you create.</span></p>
			<p class="calibre3">To understand TFs, we will first look at an existing robot model. As we did back in <a href="B22403_03.xhtml#_idTextAnchor092" class="pcalibre calibre4 pcalibre1"><span><em class="italic">Chapter 3</em></span></a>, here, we will discover the concepts by experimenting, and you will build an intuition of how things work. During this phase, you will discover a few new ROS tools, including <strong class="bold">RViz</strong>, a 3D <a id="_idIndexMarker667" class="pcalibre calibre4 pcalibre1"/><span>visualization package.</span></p>
			<p class="calibre3">You will see for yourself how TFs work, how they are related to each other, and how to visualize the TF tree for any robot. By the end of this chapter, you will understand what TFs are, what problems they solve, and how they are used in a ROS <span>2 application.</span></p>
			<p class="calibre3">Good news: once you understand TFs, well, it’s the same principle for any ROS robot, so you can directly apply what you learn here to your <span>future projects.</span></p>
			<p class="calibre3">This chapter will be quite small and quick to finish. We won’t write any code here, and there is no GitHub repository. All you have to do is follow the experiments. Not everything has to make sense right now; the goal is to get enough context to understand what we will be doing later. Don’t hesitate to come back to this chapter once you’ve finished <span><em class="italic">Part 3</em></span><span>.</span></p>
			<p class="calibre3">In this chapter, we will cover the <span>following subjects:</span></p>
			<ul class="calibre9">
				<li class="calibre10">Visualizing a robot model <span>in RViz</span></li>
				<li class="calibre10">What <span>are TFs?</span></li>
				<li class="calibre10">Relationship <span>between TFs</span></li>
				<li class="calibre10">What problem are we trying to solve <span>with TFs?</span></li>
			</ul>
			<h1 id="_idParaDest-236" class="calibre6"><a id="_idTextAnchor490" class="pcalibre calibre4 pcalibre1"/>Technical requirements</h1>
			<p class="calibre3">At the beginning of the book, I gave you two options: either installing Ubuntu with a dual boot or in a <span>virtual machine.</span></p>
			<p class="calibre3">If you chose the VM path, you should have been fine for all chapters in <em class="italic">Part 1</em> and <em class="italic">Part 2</em>. For this chapter and the next two, we will use a 3D visualization tool (RViz) that might not work if your computer is not <span>powerful enough.</span></p>
			<p class="calibre3">I would suggest first trying to run the commands from this chapter. If it doesn’t work well (it’s too slow, for example), then I strongly recommend you set up a dual boot with Ubuntu and ROS 2 (see the instructions in <a href="B22403_02.xhtml#_idTextAnchor048" class="pcalibre calibre4 pcalibre1"><span><em class="italic">Chapter 2</em></span></a>). If RViz works fine, then continue like this for now. The dual boot will be required for <a href="B22403_13.xhtml#_idTextAnchor614" class="pcalibre calibre4 pcalibre1"><span><em class="italic">Chapter 13</em></span></a><span><em class="italic"><a id="_idTextAnchor491" class="pcalibre calibre4 pcalibre1"/></em></span><span>.</span></p>
			<h1 id="_idParaDest-237" class="calibre6"><a id="_idTextAnchor492" class="pcalibre calibre4 pcalibre1"/>Visualizing a robot model in RViz</h1>
			<p class="calibre3">In this section, you will discover RViz. RViz allows you to visualize a robot model in 3D and contains <a id="_idIndexMarker668" class="pcalibre calibre4 pcalibre1"/>many plugins and functionalities that will help you develop your robotics applications. With RViz, you will be able <a id="_idIndexMarker669" class="pcalibre calibre4 pcalibre1"/>to visualize the TFs for a robot, so we can start to understand what <span>they are.</span></p>
			<p class="calibre3">As we haven’t created a robot model yet, we will use one from an existing ROS 2 package named <strong class="source-inline1">urdf_tutorial</strong>. We will load a robot model in RViz and learn how to navigate <span>the software.</span></p>
			<p class="calibre3">Let’s start by setting up everything we need for <span>this chapt<a id="_idTextAnchor493" class="pcalibre calibre4 pcalibre1"/>er.</span></p>
			<h2 id="_idParaDest-238" class="calibre6"><a id="_idTextAnchor494" class="pcalibre calibre4 pcalibre1"/>Installation and setup</h2>
			<p class="calibre3">First of all, there is <a id="_idIndexMarker670" class="pcalibre calibre4 pcalibre1"/>no need to install RViz. It was already included when you installed ROS 2 at the beginning of the book (with the <strong class="source-inline1">sudo apt install </strong><span><strong class="source-inline1">ros-&lt;distro&gt;-desktop</strong></span><span> command).</span></p>
			<p class="calibre3">To visualize TFs for a <a id="_idIndexMarker671" class="pcalibre calibre4 pcalibre1"/>robot model on RViz, we will install a new ROS package named <strong class="source-inline1">urdf_tutorial</strong>. This package contains some existing launch files and robot model files (how to create a robot model will be the focus of the <span>next chapter).</span></p>
			<p class="calibre3">If you remember, to install a ROS 2 package with <strong class="source-inline1">apt</strong>, you have to start with <strong class="source-inline1">ros</strong>, then write the name of the distribution you are using, and finally, add the package name. All words are separated with dashes (<span>not underscores).</span></p>
			<p class="calibre3">Open a terminal and install <span>this package:</span></p>
			<pre class="console">
$ sudo apt install ros-&lt;distro&gt;-urdf-tutorial</pre>			<p class="calibre3">Then, so that <a id="_idIndexMarker672" class="pcalibre calibre4 pcalibre1"/>you can use the package, make sure you source the environment <a id="_idIndexMarker673" class="pcalibre calibre4 pcalibre1"/>or simply open a <span>new terminal.</span></p>
			<p class="calibre3">Let’s now visualize a <span>robot<a id="_idTextAnchor495" class="pcalibre calibre4 pcalibre1"/> model.</span></p>
			<h2 id="_idParaDest-239" class="calibre6"><a id="_idTextAnchor496" class="pcalibre calibre4 pcalibre1"/>Starting RViz with a robot model</h2>
			<p class="calibre3">The <strong class="source-inline1">urdf_tutorial</strong> package contains <a id="_idIndexMarker674" class="pcalibre calibre4 pcalibre1"/>a launch file, named <strong class="source-inline1">display.launch.py</strong>, that will start RViz and load a robot model into it. For now, we will <a id="_idIndexMarker675" class="pcalibre calibre4 pcalibre1"/>just use it, and in the following chapters, we will understand how this process works so we can <span>replicate it.</span></p>
			<p class="calibre3">So, we need to start this launch file and also load a robot model. Where will we get one? There are some existing models in the <strong class="source-inline1">urdf_tutorial</strong> package. To find them, navigate to the <strong class="source-inline1">share</strong> directory where the package was installed, and you will find a <strong class="source-inline1">urdf</strong> folder under the <span>package name:</span></p>
			<pre class="console">
$ cd /opt/ros/&lt;distro&gt;/share/urdf_tutorial/urdf/</pre>			<p class="calibre3">A <strong class="bold">Unified Robot Description Format</strong> (<strong class="bold">URDF</strong>) file is basically the description of a robot <a id="_idIndexMarker676" class="pcalibre calibre4 pcalibre1"/>model. We will come back to this in the next chapter. For now, all we want to do is to visualize one. In the <strong class="source-inline1">urdf</strong> folder, you can find several robot <span>model files:</span></p>
			<pre class="console">
$ ls
01-myfirst.urdf            04-materials.urdf    07-physics.urdf
02-multipleshapes.urdf     05-visual.urdf        08-macroed.urdf.xacro
03-origins.urdf            06-flexible.urdf</pre>			<p class="calibre3">You can now start a robot model in RViz by launching the <strong class="source-inline1">display.launch.py</strong> file and add the path to the robot model with an additional <strong class="source-inline1">model</strong> argument after the <span>launch file:</span></p>
			<pre class="console">
$ ros2 launch urdf_tutorial display.launch.py model:=/opt/ros/&lt;distro&gt;/share/urdf_tutorial/urdf/07-physics.urdf</pre>			<p class="callout-heading">Note</p>
			<p class="callout">To avoid errors, it’s better to provide the absolute path to the .<strong class="source-inline">urdf</strong> file, even if you run the command from the <span>same folder.</span></p>
			<p class="calibre3">After <a id="_idIndexMarker677" class="pcalibre calibre4 pcalibre1"/>running the command, you should see something <span>like this:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer058">
					<img alt="Figure 10.1 – A robot mod﻿el on RViz" src="image/B22403_10_1.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.1 – A robot mod<a id="_idTextAnchor497" class="pcalibre calibre4 pcalibre1"/>el on RViz</p>
			<p class="calibre3">You will get two windows: the main one (<strong class="bold">RViz</strong>) with the robot model, and a <strong class="bold">Joint State Publisher</strong> window with some cursors. The robot model we have here is a replica of a famous science-fiction movie robot. It has some wheels, a torso, a head, and <span>a gripper.</span></p>
			<p class="calibre3">Let’s focus on the main window (<strong class="bold">RViz</strong>) for now. Take some time to learn how to navigate in the 3D space and move around the robot. You can use the left click, right click, and mouse wheel. For this, it’s best to have a mouse, but you could still manage to navigate with the touchpad of a laptop, although it’s <span>less ergonomic.</span></p>
			<p class="calibre3">You can <a id="_idIndexMarker678" class="pcalibre calibre4 pcalibre1"/>also resize the window and the various sections inside RViz. Pretty much everything you see can be customized. Now that you can load a robot model in RViz, we will start to experiment <span>with TFs.</span></p>
			<h1 id="_idParaDest-240" class="calibre6"><a id="_idTextAnchor498" class="pcalibre calibre4 pcalibre1"/>What are TFs?</h1>
			<p class="calibre3">There <a id="_idIndexMarker679" class="pcalibre calibre4 pcalibre1"/>are two main parts in a robot model: links and TFs. In this section, we will visualize them both and understand how they <span>work together.</span></p>
			<p class="calibre3">Let’s start<a id="_idTextAnchor499" class="pcalibre calibre4 pcalibre1"/> <span>with links.</span></p>
			<h2 id="_idParaDest-241" class="calibre6"><a id="_idTextAnchor500" class="pcalibre calibre4 pcalibre1"/>Links</h2>
			<p class="calibre3">Have a look <a id="_idIndexMarker680" class="pcalibre calibre4 pcalibre1"/>at the menu on the left side of the <strong class="bold">RViz</strong> window. There, you will see, in blue bold letters, <strong class="bold">RobotModel</strong> and <strong class="bold">TF</strong>. This is what we will focus on in this chapter. As you can see, you can enable or disable <span>both menus.</span></p>
			<p class="calibre3">Disable <strong class="bold">TF</strong>, keep <strong class="bold">RobotModel</strong>, and expand the menu. There, you can find a submenu <span>called </span><span><strong class="bold">Links</strong></span><span>.</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer059">
					<img alt="Figure 10.2 – RobotModel with Links menu on RViz" src="image/B22403_10_2.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.2 – RobotModel with Links menu on RViz</p>
			<p class="calibre3">Check and <a id="_idIndexMarker681" class="pcalibre calibre4 pcalibre1"/>uncheck some boxes. As you can see from this menu, a <em class="italic">link</em> is one rigid part (meaning one solid part with no articulation) of the robot. Basically, in ROS, a robot model will consist of a collection of rigid parts <span>put together.</span></p>
			<p class="calibre3">In this example, links are represented by basic shapes: boxes, cylinders, and spheres. Those rigid parts do nothing on their own, so how are they connected, and how do they move between <span>each other?</span></p>
			<p class="calibre3">This is where we <span>i<a id="_idTextAnchor501" class="pcalibre calibre4 pcalibre1"/>ntroduce TFs.</span></p>
			<h2 id="_idParaDest-242" class="calibre6"><a id="_idTextAnchor502" class="pcalibre calibre4 pcalibre1"/>TFs</h2>
			<p class="calibre3">Let’s now <a id="_idIndexMarker682" class="pcalibre calibre4 pcalibre1"/>check the <strong class="bold">TF</strong> box. You can keep <strong class="bold">RobotModel</strong> checked or unchecked. Inside the <strong class="bold">TF</strong> menu, you have a submenu called <strong class="bold">Frames</strong>, and you can also enable or disable each frame for <span>the robot.</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer060">
					<img alt="Figure 10.3 – Frames and TFs on RViz" src="image/B22403_10_3.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.3 – Frames and TFs on RViz</p>
			<p class="calibre3">The axes you see here (red, green, and blue coordinate systems) represent the frames, or basically the origin of each link of <span>the robot.</span></p>
			<p class="calibre3">Coordinate systems follow the right-hand rule in ROS. Following <span><em class="italic">Figure 10</em></span><em class="italic">.4</em>, you have <span>the following:</span></p>
			<ul class="calibre9">
				<li class="calibre10">X axis (red) <span>pointing forward</span></li>
				<li class="calibre10">Y axis (green) pointing 90 degrees to <span>the left</span></li>
				<li class="calibre10">Z axis (blue) <span>pointing up</span></li>
			</ul>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer061">
					<img alt="Figure 10.4 – Convention for coordinate systems in ROS" src="image/B22403_10_4.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.4 – Convention for coordinate systems in ROS</p>
			<p class="calibre3">The arrows <a id="_idIndexMarker683" class="pcalibre calibre4 pcalibre1"/>that you see between each frame in <span><em class="italic">Figure 10</em></span><em class="italic">.3</em> are the relationship between each rigid part (link) of the robot. A TF is represented by <span>an arrow.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">There can be some confusion between the names <strong class="bold">links</strong>, <strong class="bold">frames</strong>, and <strong class="bold">TFs</strong>. Let’s make <span>things clear:</span></p>
			<p class="callout">- Link: one rigid part of <span>a robot</span></p>
			<p class="callout">- Frame: the origin of a link (axis <span>in RViz)</span></p>
			<p class="callout">- TF: the relationship between two frames (arrow <span>in RViz)</span></p>
			<p class="calibre3">So, each rigid part will be linked to another rigid part, thanks to a TF. This transformation defines how those two parts are placed relative to each other. In addition to that, the TF also defines whether the two parts are moving, and if so, how—translation, rotation, and <span>so on.</span></p>
			<p class="calibre3">To make some parts of the robot move, you can move some of the cursors in the <strong class="bold">Joint State Publisher</strong> window. You will see the frames and TFs moving in RViz. If you also check the <strong class="bold">RobotModel</strong> box again, you will see the rigid parts moving <span>as well.</span></p>
			<p class="calibre3">To better understand, here is an analogy with the human arm: we can define the parts of the arm as <em class="italic">arm</em> (shoulder to elbow) and <em class="italic">forearm</em> (after the elbow). Those two are rigid parts (here, links) and do not move on their own. Each link has an origin frame, and there is a TF that defines where the arm and forearm are connected (imagine an axis in the elbow), and how they move (in this case, it’s a rotation with a minimum and <span>maximum angle).</span></p>
			<p class="calibre3">As we will <a id="_idIndexMarker684" class="pcalibre calibre4 pcalibre1"/>see later in this chapter, TFs are tremendously important. If the TFs for a robot are not correctly defined, then nothing <span>will work.</span></p>
			<p class="calibre3">Now you know what TFs are, but how are they all related to each other? As you can see on RViz, it seems that TFs are organized in a certain way. Let’s go one step further and understand what the relationship b<a id="_idTextAnchor503" class="pcalibre calibre4 pcalibre1"/>etween <span>TFs is.</span></p>
			<h1 id="_idParaDest-243" class="calibre6"><a id="_idTextAnchor504" class="pcalibre calibre4 pcalibre1"/>Relationship between TFs</h1>
			<p class="calibre3">In RViz, we have seen the links (rigid parts) and TFs (connections between the links). Links are <a id="_idIndexMarker685" class="pcalibre calibre4 pcalibre1"/>mostly used for visual aspects in simulation and will be useful to define inertial and collision properties (when we work with Gazebo). TFs define how links are connected, and how they move between <span>each other.</span></p>
			<p class="calibre3">In addition to that, all the TFs for a robot are organized in a particular way, inside a tree. Let’s explore the relationship between TFs and visualize the TF tree for the robot we s<a id="_idTextAnchor505" class="pcalibre calibre4 pcalibre1"/>tarted <span>on RViz.</span></p>
			<h2 id="_idParaDest-244" class="calibre6"><a id="_idTextAnchor506" class="pcalibre calibre4 pcalibre1"/>Parent and child</h2>
			<p class="calibre3">Each TF <a id="_idIndexMarker686" class="pcalibre calibre4 pcalibre1"/>will be connected to another TF, with a parent/child relationship. To see one, you can, for example, disable all TFs on RViz, and only check the <strong class="source-inline1">base_link</strong> and <span><strong class="source-inline1">gripper_pole</strong></span><span> frames.</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer062">
					<img alt="Figure 10.5 – The relationship between two frames" src="image/B22403_10_5.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.5 – The relationship between two frames</p>
			<p class="calibre3">As you can <a id="_idIndexMarker687" class="pcalibre calibre4 pcalibre1"/>see in this example, an arrow is going from the <strong class="source-inline1">gripper_pole</strong> frame to the <strong class="source-inline1">base_link</strong> frame. This means that <strong class="source-inline1">gripper_pole</strong> is the child of <strong class="source-inline1">base_link</strong> (or, <strong class="source-inline1">base_link</strong> is the parent <span>of </span><span><strong class="source-inline1">gripper_pole</strong></span><span>).</span></p>
			<p class="calibre3">If you look back at <span><em class="italic">Figure 10</em></span><em class="italic">.3</em>, you can see all the frames for the robot, with all the relationships between <span>them (TFs).</span></p>
			<p class="calibre3">The order of those relationships is very important. If you move <strong class="source-inline1">gripper_pole</strong> relative to <strong class="source-inline1">base_link</strong> (the <strong class="source-inline1">gripper_extension</strong> cursor in the <strong class="bold">Joint State Publisher</strong> window), then anything that’s attached to <strong class="source-inline1">gripper_pole</strong> (meaning children of <strong class="source-inline1">gripper_pole</strong>) will also move <span>with it.</span></p>
			<p class="calibre3">That makes sense: when you rotate your elbow, your forearm is moving, but also your wrist, hand, and fingers. They don’t move relative to the forearm, but as they are attached to it, they move relative to <span>the arm.</span></p>
			<p class="calibre3">Now, you can visualize all the links and TFs on RViz, see the relationship between TFs, and also how they are related to each other. Let’s go further wit<a id="_idTextAnchor507" class="pcalibre calibre4 pcalibre1"/>h the <strong class="source-inline1">/</strong><span><strong class="source-inline1">tf</strong></span><span> topic.</span></p>
			<h2 id="_idParaDest-245" class="calibre6"><a id="_idTextAnchor508" class="pcalibre calibre4 pcalibre1"/>The /tf topic</h2>
			<p class="calibre3">At this point, you might think that what we did in <em class="italic">Part 2</em> of this book has nothing to do with what <a id="_idIndexMarker688" class="pcalibre calibre4 pcalibre1"/>we are doing now. Well, everything we have seen here is still based on nodes, topics, and <span>so on.</span></p>
			<p class="calibre3">Let’s list <span>all nodes:</span></p>
			<pre class="console">
$ ros2 node list
/joint_state_publisher
/robot_state_publisher
/rviz
/transform_listener_impl_5a530d0a8740</pre>			<p class="calibre3">You can see that RViz is actually started as a node (<strong class="source-inline1">rviz</strong>). We also have the <strong class="source-inline1">joint_state_publisher</strong> and <strong class="source-inline1">robot_state_publisher</strong> nodes, which we will come back to in the following chapters of this book. Now, let’s list <span>all topics:</span></p>
			<pre class="console">
$ ros2 topic list
/joint_states
/parameter_events
/robot_description
/rosout
/tf
/tf_static</pre>			<p class="calibre3">You can see that the nodes that were started are using topics to communicate with each other. In this topic list, we find the <strong class="source-inline1">/tf</strong> topic. This topic will be there for any robot you create. The TFs you saw on RViz are actually the 3D visualization of this topic—meaning the <strong class="source-inline1">rviz</strong> node is a subscriber to the <strong class="source-inline1">/</strong><span><strong class="source-inline1">tf</strong></span><span> topic.</span></p>
			<p class="calibre3">You can subscribe to the topic from the terminal with <span>the following:</span></p>
			<pre class="console">
$ ros2 topic echo /tf</pre>			<p class="calibre3">If you do so, you will <a id="_idIndexMarker689" class="pcalibre calibre4 pcalibre1"/>receive lots of messages. Here is <span>an extract:</span></p>
			<pre class="console">
transforms:
- header:
	stamp:
  	sec: 1719581158
  	nanosec: 318170246
	frame_id: base_link
  child_frame_id: gripper_pole
  transform:
	translation:
  	x: 0.19
  	y: 0.0
  	z: 0.2
	rotation:
  	x: 0.0
  	y: 0.0
  	z: 0.0
  	w: 1.0</pre>			<p class="calibre3">This extract matches what we previously saw on RViz. It represents the transformation between <strong class="source-inline1">base_link</strong> and <strong class="source-inline1">gripper_pole</strong>. Here are the important pieces of information we can get from <span>this message:</span></p>
			<ul class="calibre9">
				<li class="calibre10">Timestamp for <span>the TF</span></li>
				<li class="calibre10">Parent and child <span>frame IDs</span></li>
				<li class="calibre10">The actual transformation, with a translation and <span>a rotation</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">The rotation is not represented by Euler angles (<strong class="source-inline">x</strong>, <strong class="source-inline">y</strong>, <strong class="source-inline">z</strong>), but by a quaternion (<strong class="source-inline">x</strong>, <strong class="source-inline">y</strong>, <strong class="source-inline">z</strong>, <strong class="source-inline">w</strong>). Quaternions are usually better suited for computers, but it’s difficult for humans to visualize them. Do not worry about this—we won’t really have to deal with quaternions. If you ever have to do so in the future, you will have access to libraries that can convert angles into something you <span>can understand.</span></p>
			<p class="calibre3">One important <a id="_idIndexMarker690" class="pcalibre calibre4 pcalibre1"/>thing we can get here is that the transformation is for a specific time. It means that with the topic data, you can follow the evolution of all TFs over time. You can know where <strong class="source-inline1">gripper_pole</strong> is relative to <strong class="source-inline1">base_link</strong>, now or in <span>the past.</span></p>
			<p class="calibre3">This <strong class="source-inline1">/tf</strong> topic contains all the information we need, but it’s not really human-readable. That’s why we started with RViz, so we could see a 3D view with all <span>the TFs.</span></p>
			<p class="calibre3">Let’s now finish this section by printing the TF tree, so we can see all the relationships i<a id="_idTextAnchor509" class="pcalibre calibre4 pcalibre1"/>n one <span>single image.</span></p>
			<h2 id="_idParaDest-246" class="calibre6"><a id="_idTextAnchor510" class="pcalibre calibre4 pcalibre1"/>Visualizing the TF tree</h2>
			<p class="calibre3">For each robot, you can visualize the complete TF tree in a simplified way, so that you can see all <a id="_idIndexMarker691" class="pcalibre calibre4 pcalibre1"/>the relationships between all <span>the TFs.</span></p>
			<p class="calibre3">To do that, you will need to use the <strong class="source-inline1">tf2_tools</strong> package. Make sure it <span>is installed:</span></p>
			<pre class="console">
$ sudo apt install ros-&lt;distro&gt;-tf2-tools</pre>			<p class="calibre3">Don’t forget to source the environment after installing the package. Now, keep the robot running on RViz, and execute this command in a <span>second terminal:</span></p>
			<pre class="console">
$ ros2 run tf2_tools view_frames</pre>			<p class="calibre3">As you will see with the logs, it will listen to the <strong class="source-inline1">/tf</strong> topic for five seconds. After this, the command exits with a big log that you <span>can ignore.</span></p>
			<p class="calibre3">You will get two new files, in the same directory as where you ran <span>the command.</span></p>
			<p class="calibre3">Open the PDF file. You will see something like this (I’m just adding the left side of the image, otherwise the text would be too small to read in <span>the book):</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer063">
					<img alt="Figure 10.6 – TF tree for a robot" src="image/B22403_10_6.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.6 – TF tree for a robot</p>
			<p class="calibre3">In this file, you get all the links and TFs at once, and it’s quite clear to see which link is a child of which <a id="_idIndexMarker692" class="pcalibre calibre4 pcalibre1"/>other link. Each arrow on the PDF represents a TF between <span>the links.</span></p>
			<p class="calibre3">As you can see, the root link for that robot is named <strong class="source-inline1">base_link</strong> (the name <strong class="source-inline1">base_link</strong> is used for most robots as the first link). This link has four children: <strong class="source-inline1">gripper_pole</strong>, <strong class="source-inline1">head</strong>, <strong class="source-inline1">left_leg</strong>, and <strong class="source-inline1">right_leg</strong>. Then, those links also get more children. Here, we can clearly see all the children for the <span><strong class="source-inline1">gripper_pole</strong></span><span> link.</span></p>
			<p class="calibre3">We can now understand that when we previously moved <strong class="source-inline1">gripper_pole</strong> relative to <strong class="source-inline1">base_link</strong>, then all children of <strong class="source-inline1">gripper_pole</strong> were also moved relative <span>to </span><span><strong class="source-inline1">base_link</strong></span><span>.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">In ROS, one link can have several children, but only one parent. We will come back to this in the next chapter when we define the links and <span>TFs ourselves.</span></p>
			<p class="calibre3">In this example, we have just one robot. If you were to have several robots in your application, then you would have, for example, a <strong class="source-inline1">world</strong> frame as the root link. Then, this frame would have several children: <strong class="source-inline1">base_link1</strong>, <strong class="source-inline1">base_link2</strong>, and so on. Each robot base link <a id="_idIndexMarker693" class="pcalibre calibre4 pcalibre1"/>would be connected to the <strong class="source-inline1">world</strong> frame. Thus, you can get a complete TF tree, not just for one robot but also for a complete robotics application with <span>several robots.</span></p>
			<p class="calibre3">Now, you have seen pretty much everything about TFs: what they are, how they are related to each other, and how they are organized. Let’s finish this chapter by understanding what problem we are tryi<a id="_idTextAnchor511" class="pcalibre calibre4 pcalibre1"/>ng to solve <span>with TFs.</span></p>
			<h1 id="_idParaDest-247" class="calibre6"><a id="_idTextAnchor512" class="pcalibre calibre4 pcalibre1"/>What problem are we trying to solve with TFs?</h1>
			<p class="calibre3">You have now <a id="_idIndexMarker694" class="pcalibre calibre4 pcalibre1"/>seen what TFs are and how you can visualize them for any ROS robot. This is great, but now we come to the final question for this chapter: why do we need to care about this? What problem a<a id="_idTextAnchor513" class="pcalibre calibre4 pcalibre1"/>re we trying <span>to solve?</span></p>
			<h2 id="_idParaDest-248" class="calibre6"><a id="_idTextAnchor514" class="pcalibre calibre4 pcalibre1"/>What we want to achieve</h2>
			<p class="calibre3">For a robotics application to work, we want to keep track of each 3D coordinate frame over time. We need a structured tree for all the frames of the robot (<span>or robots).</span></p>
			<p class="calibre3">There are <a id="_idIndexMarker695" class="pcalibre calibre4 pcalibre1"/>two components here: we need to know where things are and when the transformations happened. If you remember, when we checked the <strong class="source-inline1">/tf</strong> topic, you could see that for each parent and child frame, we had a transformation (translation and rotation in 3D space), and we also had <span>a timestamp.</span></p>
			<p class="calibre3">Here are some concrete examples of some questions you could need to answer in a <span>robotics application:</span></p>
			<ul class="calibre9">
				<li class="calibre10">For one mobile robot, where is the right wheel relative to the left wheel and to the base of the robot? How does the wheel movement evolve <span>over time?</span></li>
				<li class="calibre10">If you have an application with a robotic arm and a camera, then where is the camera relative to the base of the robot? And to the hand of the robot, so that the arm can correctly pick up and place objects that were detected by <span>the camera?</span></li>
				<li class="calibre10">In another application with several mobile robots, where is each robot relative to the <span>other ones?</span></li>
				<li class="calibre10">If you combine the two previous examples, where is the hand of the robotic arm relative to the base of one of the <span>mobile robots?</span></li>
			</ul>
			<p class="calibre3">So, with TFs, we <a id="_idIndexMarker696" class="pcalibre calibre4 pcalibre1"/>want to know <span>the following:</span></p>
			<ul class="calibre9">
				<li class="calibre10">How frames are placed relative to <span>each other</span></li>
				<li class="calibre10">How they move relative to each other and <span>over time</span></li>
			</ul>
			<p class="calibre3">This is required for a robot to correctly work <span>with ROS.</span></p>
			<p class="calibre3">Now, let’s see how you would compute the TFs by yourself, and how ROS automatically does this for you so you don’t<a id="_idTextAnchor515" class="pcalibre calibre4 pcalibre1"/> need to worry <span>about it.</span></p>
			<h2 id="_idParaDest-249" class="calibre6"><a id="_idTextAnchor516" class="pcalibre calibre4 pcalibre1"/>How to compute TFs</h2>
			<p class="calibre3">What is a transformation exactly? A transformation is the combination of a translation and a rotation <span>in space.</span></p>
			<p class="calibre3">As we are <a id="_idIndexMarker697" class="pcalibre calibre4 pcalibre1"/>working in 3D, we have three components for the translation (<strong class="source-inline1">x</strong>, <strong class="source-inline1">y</strong>, <strong class="source-inline1">z</strong>), and three components for the rotation (<strong class="source-inline1">x</strong>, <strong class="source-inline1">y</strong>, <strong class="source-inline1">z</strong>). To find a transformation between two frames, you will need to compute those six elements, using <span>3x3 matrices.</span></p>
			<p class="calibre3">I won’t go into any mathematical details here, but you can probably guess that it won’t be an easy task. Also, you need to compute this transformation for each frame, relative to the other frame. This increases <span>the complexity.</span></p>
			<p class="calibre3">For example, let’s say you need to know where <strong class="source-inline1">left_front_wheel</strong> is relative to <strong class="source-inline1">base_link</strong>. Following the previous TF tree (open the PDF again), you can see that you need to follow this order: <strong class="source-inline1">base_link</strong>, <strong class="source-inline1">left_leg</strong>, <strong class="source-inline1">left_base</strong>, <span>and </span><span><strong class="source-inline1">left_front_wheel</strong></span><span>.</span></p>
			<p class="calibre3">Let’s visualize that <span>on RViz:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer064">
					<img alt="Figure 10.7 – Three transformations between four frames" src="image/B22403_10_7.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 10.7 – Three transformations between four frames</p>
			<p class="calibre3">You will <a id="_idIndexMarker698" class="pcalibre calibre4 pcalibre1"/>need to compute three transformations in a row so that you can get this <strong class="source-inline1">base_link</strong> to <strong class="source-inline1">left_front_wheel</strong> transformation. You will have to repeat this for each frame relative to all other frames (the complexity then increases a lot as you add more frames), and track these <span>over time.</span></p>
			<p class="calibre3">This sounds like a lot of work. Fortunately, we don’t have to do any of that, thanks to the ROS TF functionality. There is a library called <strong class="source-inline1">tf2</strong>, and it already does that <span>for us.</span></p>
			<p class="calibre3">In the end, the biggest challenge with TFs is to understand how they work. You will mostly not use TFs directly in your application. Several packages will handle that for you. The only thing we need to do is to provide a robot description that specifies all the links and TFs for the robot. Then, using a package named <strong class="source-inline1">robot_state_publisher</strong>, ROS will automatically publish TFs for us. That’s what we will focus on <a id="_idTextAnchor517" class="pcalibre calibre4 pcalibre1"/>in the next <span>two chapters.</span></p>
			<h1 id="_idParaDest-250" class="calibre6"><a id="_idTextAnchor518" class="pcalibre calibre4 pcalibre1"/>Summary</h1>
			<p class="calibre3">In this chapter, we started something a bit different. ROS is not all about programming; there are many additional things that make it a great tool <span>for robotics.</span></p>
			<p class="calibre3">You first discovered a 3D visualization tool used for ROS, named RViz. You will use this tool in most of your ROS applications. With RViz, you can visualize a robot model, which will be helpful when developing the model <span>by yourself.</span></p>
			<p class="calibre3">Then, you discovered what TFs are, and why they are so important in a ROS application. Here’s a <span>quick recap:</span></p>
			<ul class="calibre9">
				<li class="calibre10">We need to keep track of each 3D coordinate frame over time, for the entire robotics application (one or <span>several robots).</span></li>
				<li class="calibre10">Instead of computing the transformations ourselves, we use the ROS TF functionality, with the <strong class="source-inline">tf2</strong> library. TFs are published on the <strong class="source-inline">/</strong><span><strong class="source-inline">tf</strong></span><span> topic.</span></li>
				<li class="calibre10">TFs are organized into a structured tree that you <span>can visualize.</span></li>
				<li class="calibre10">A TF defines how two frames are connected, and how they move relative to each other, <span>over time.</span></li>
			</ul>
			<p class="calibre3">To specify TFs for a robot, we will have to create a robot model, named <em class="italic">URDF</em>. This robot model will then be used by the <strong class="source-inline1">robot_state_publisher</strong> node (we will see this a bit later) to publish the TFs. The published TFs will then be used by other packages in <span>your application.</span></p>
			<p class="calibre3">In the end, we won’t really interact with TFs directly. The most important thing in this chapter is to understand what TFs are, and why we need them. This will help you understand what you're doing in the next chapter, when you create a <span>robot model.</span></p>
			<p class="calibre3">If things are still a bit confusing for now, don’t worry too much. Continue with the next few chapters, and then come back to this TF chapter again and everything will make <span>more sense.</span></p>
			<p class="calibre3">Now, let’s jump to the next chapter and create our first <span>robot model.</span></p>
		</div>
	</body></html>