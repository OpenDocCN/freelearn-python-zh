<html><head></head><body>
<div id="book-content" class="calibre2">
<div id="sbo-rt-content" class="calibre3"><div id="_idContainer024" class="calibre4">
			<h1 id="_idParaDest-22" class="contributor"><a id="_idTextAnchor026" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/><a id="_idTextAnchor027" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>2</h1>
			<h1 id="_idParaDest-23" class="contributor"><a id="_idTextAnchor028" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Setting Up the Database with MongoDB</h1>
			<p class="calibre5">In this chapter, you will explore some of the main features of MongoDB through several simple yet illustrative examples. You will learn about the basic commands of the MongoDB Query API to start interacting with your data stored in a MongoDB database. You will learn the essential commands and methods that will enable you to insert, manage, query, and update <span>your data.</span></p>
			<p class="calibre5">The aim of this chapter is to help you understand how easy it is to set up a MongoDB database on your local machine or in the cloud and perform the operations that might be needed in a fast-paced web <span>development process.</span></p>
			<p class="calibre5">Querying, through MongoDB methods and aggregation, is best learned by experimenting with data. This chapter utilizes real-world sample datasets provided by MongoDB Atlas that are loaded into your cloud database. You will learn to execute CRUD and aggregation queries <span>against them.</span></p>
			<p class="calibre5">This chapter will cover the <span>following topics:</span></p>
			<ul class="calibre14">
				<li class="calibre17">The structure of a <span>MongoDB database</span></li>
				<li class="calibre17">Installing MongoDB Community Server <span>and tools</span></li>
				<li class="calibre17">Creating an <span>Atlas cluster</span></li>
				<li class="calibre17">MongoDB querying and <span>CRUD operations</span></li>
				<li class="calibre17"><span>Aggregation framework</span></li>
			</ul>
			<h1 id="_idParaDest-24" class="contributor"><a id="_idTextAnchor029" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Technical requirements</h1>
			<p class="calibre5">For this chapter, you will require MongoDB version 7.0.7 and Windows 11 (and Ubuntu <span>22.04 LTS).</span></p>
			<p class="calibre5">MongoDB version 7.0 is compatible with <span>the following:</span></p>
			<ul class="calibre14">
				<li class="calibre17">Windows 11, Windows Server 2019, or Windows Server 2022 (<span>64-bit versions)</span></li>
				<li class="calibre17">Ubuntu 20.04 LTS (Focal) and Ubuntu 22.04 LTS (Jammy) for Linux (<span>64-bit releases)</span></li>
			</ul>
			<p class="calibre5">The following are recommended <span>system configurations:</span></p>
			<ul class="calibre14">
				<li class="calibre17">A desktop or laptop with at least 8 GB <span>of RAM.</span></li>
				<li class="calibre17">There are no CPU requirements specified as such but make sure it’s modern (a multi-core processor) to ensure <span>efficient performance.</span></li>
			</ul>
			<h1 id="_idParaDest-25" class="contributor"><a id="_idTextAnchor030" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>The structure of a MongoDB database</h1>
			<p class="calibre5">MongoDB is widely regarded as the leading NoSQL database in terms of popularity and usage—its power, ease of use, and versatility make it an excellent choice for large- and small-scale projects. Its scalability and performance enable the data layer of your app to have a very <span>solid foundation.</span></p>
			<p class="calibre5">In the following sections, you will take a deeper look into the basic concepts and building blocks of MongoDB: the document, the collection, and the database. Since this book takes a bottom-up approach, you will start from the very bottom and see an overview of the simplest data structures available in MongoDB and then take it up from there into documents, collections, and <span>so on.</span></p>
			<h2 id="_idParaDest-26" class="about-the-author"><a id="_idTextAnchor031" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Documents</h2>
			<p class="calibre5">MongoDB is a document-oriented database. But what does that <span>actually mean?</span></p>
			<p class="calibre5">In MongoDB, documents serve a similar purpose to rows in a traditional relational database. Each document in MongoDB is a data structure that consists of key-value pairs, representing a single record. Data stored in MongoDB offers great flexibility to application developers to model their data as per their needs and allows them to easily evolve the schema as their application requirements change in the future. MongoDB has a flexible schema model, which essentially means that you can have different fields in different documents within a collection. You can also have different data types for fields across documents based on <span>your needs.</span></p>
			<p class="calibre5">However, if your application requires a more consistent structure of the data throughout the documents in a collection, you can use schema validation rules in MongoDB to enforce consistency. MongoDB empowers you to store data in a way that makes the most sense for your <span>application needs.</span></p>
			<p class="calibre5">Documents in MongoDB are just an ordered set of key-value pairs. In this book, the terms <strong class="bold">key</strong> and <strong class="bold">field</strong> are used interchangeably as they represent the same thing. This structure, as you will explore later, corresponds with data structures in every programming language; in Python, you will see that this structure is a dictionary and lends itself perfectly to the flow of data of a web app or a <span>desktop application.</span></p>
			<p class="calibre5">The rules for creating documents are pretty simple: the key/field name must be a string, with a few exception that you can read more about in the docs, and a document cannot contain duplicate key names. Remember that MongoDB is <span>case sensitive.</span></p>
			<p class="calibre5">In this chapter, you will load a sample dataset into your MongoDB Atlas cluster called <strong class="source-inline">sample_mflix</strong>. The dataset has many collections, but one that is of interest to us in this chapter is the <strong class="source-inline">movies</strong> collection, which contains documents that describe movies. The following document could be in <span>this collection:</span></p>
			<pre class="source-code">
{
  _id: ObjectId("573a1390f29313caabcd42e8"),
  plot: 'A group of bandits stage a brazen train hold-up, only to find a determined posse hot on their heels.',
  genres: [ 'Short', 'Western' ],
  runtime: 11,
  cast: [
    'A.C. Abadie',
    "Gilbert M. 'Broncho Billy' Anderson",
    'George Barnes',
    'Justus D. Barnes'
  ],
  poster: 'https://m.media-amazon.com/images/M/MV5BMTU3NjE5NzYtYTYyNS00MDVmL WIwYjgtMmYwYWIxZDYyNzU2XkEyXkFqcGdeQXVyNzQzNzQxNzI@._V1_SY1000_SX677_AL_.jpg',
  title: 'The Great Train Robbery',
  fullplot: "Among the earliest existing films in American cinema - notable as the first film that presented a narrative story to tell - it depicts a group of cowboy outlaws who hold up a train and rob the passengers. They are then pursued by a Sheriff's posse. Several scenes have color included - all hand tinted.",
  languages: [ 'English' ],
  released: ISODate("1903-12-01T00:00:00.000Z"),
  directors: [ 'Edwin S. Porter' ],
  rated: 'TV-G',
  awards: { wins: 1, nominations: 0, text: '1 win.' },
  lastupdated: '2015-08-13 00:27:59.177000000',
  year: 1903,
  imdb: { rating: 7.4, votes: 9847, id: 439 },
  countries: [ 'USA' ],
  type: 'movie',
  tomatoes: {
    viewer: { rating: 3.7, numReviews: 2559, meter: 75 },
    fresh: 6,
    critic: { rating: 7.6, numReviews: 6, meter: 100 },
    rotten: 0,
    lastUpdated: ISODate("2015-08-08T19:16:10.000Z")
  },
  num_mflix_comments: 0
}</pre>			<p class="callout-heading">Note</p>
			<p class="callout">When it comes to nesting documents within documents, MongoDB supports 100 levels of nesting, which is a limit you probably won’t reach in <span>most applications.</span></p>
			<h2 id="_idParaDest-27" class="about-the-author"><a id="_idTextAnchor032" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Supported data types in MongoDB</h2>
			<p class="calibre5">MongoDB allows you to store any of the BSON data types as field values. BSON is very closely related to JSON and it stands for “Binary JSON.” BSON’s binary structure makes it faster and adds native support for more data types than JSON. One of the first important decisions when designing any type of application is the choice of data types. As a developer, you would never want to use the wrong tools for the job <span>at hand.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The full list of supported data types in MongoDB can be found in the official documentation: <a href="https://www.mongodb.com/docs/mongodb-shell/reference/data-types/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/docs/mongodb-shell/reference/data-types/</span></span></a><span>.</span></p>
			<p class="calibre5">Some of the most important data types supported by <span>MongoDB are:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="bold">Strings</strong>: These are probably the most basic and universal data type in MongoDB, and they are used to represent all text fields in <span>a document.</span></li>
				<li class="calibre17"><strong class="bold">Numbers</strong>: MongoDB supports different types of <span>numbers, including:</span><ul class="calibre19"><li class="calibre17"><strong class="bold">int</strong>: <span>32-bit integer</span></li><li class="calibre17"><strong class="bold">long</strong>: <span>64-bit integer</span></li><li class="calibre17"><strong class="bold">double</strong>: 64-bit <span>floating point</span></li><li class="calibre17"><strong class="bold">decimal</strong>: 128-bit decimal-based <span>floating point</span></li></ul></li>
				<li class="calibre17"><strong class="bold">Booleans</strong>: This is the standard Boolean <strong class="source-inline">true</strong> or <strong class="source-inline">false</strong> value; they are written without quotes since you do not want them to be interpreted <span>as strings.</span></li>
				<li class="calibre17"><strong class="bold">Objects or embedded documents</strong>: In MongoDB, fields within a document can contain embedded documents, allowing for complex data structuring within a single document. This capability supports the deep nesting of JSON-like structures, facilitating flexible and hierarchical <span>data modeling.</span></li>
				<li class="calibre17"><strong class="bold">Arrays</strong>: Arrays can contain zero or more values in a list-like structure. The elements of the array can be any MongoDB data type, including other documents and arrays. They are zero-based and particularly suited for making <strong class="bold">embedded relationships</strong>. For instance, you could store all of the post comments inside the blog post document itself, along with a timestamp and the user that made the comment. Arrays can benefit from the standard JavaScript array methods for fast editing, pushing, and <span>other methods.</span></li>
				<li class="calibre17"><strong class="bold">ObjectId</strong>: Every document in MongoDB has a unique field called <strong class="source-inline">_id</strong> that acts as the primary key. If an inserted document omits the <strong class="source-inline">_id</strong> field, MongoDB automatically generates an ObjectId for the <strong class="source-inline">_id</strong> field that is used to uniquely identify a document in the collection. ObjectId values are 12 bytes in length. They are small, likely unique, fast to generate, and ordered. These ObjectIds are extensively used as keys for traditional relationships – ObjectIds are <span>automatically indexed.</span></li>
				<li class="calibre17"><strong class="bold">Dates</strong>: Though JSON does not support date types and stores them as plain strings, MongoDB’s BSON format supports date types explicitly. They represent the 64-bit number of milliseconds since the Unix epoch (January 1, 1970). All dates are stored in UTC and have no time zone associated. A BSON date type is signed. Negative values represent dates <span>before 1970.</span></li>
				<li class="calibre17"><strong class="bold">Binary data</strong>: Binary data fields can store arbitrary binary data and are the only way to save non-UTF-8 strings to a database. These fields can be used in conjunction with MongoDB’s GridFS filesystem to store images, <span>for example.</span></li>
				<li class="calibre17"><strong class="bold">Null</strong>: This can represent a null value or a nonexistent field, and we can even store JavaScript functions as a different <span>data type.</span></li>
			</ul>
			<p class="calibre5">Now that you have an idea of what types of fields are available in MongoDB and how you can map your business logic to a (flexible) schema, it is time to get introduced to collections—groups of documents and a counterpart to a table in the relational <span>database world.</span></p>
			<h2 id="_idParaDest-28" class="about-the-author"><a id="_idTextAnchor033" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Collections and databases</h2>
			<p class="calibre5">Even though you can store multiple schemas in the same collection, there are many reasons to store your data in multiple databases and <span>multiple collections:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="bold">Data separation</strong>: Collections allow you to logically separate different types of data. For example, you can have a collection for user data, another collection for product data, and yet another collection for order data. This separation makes it easier to manage and query specific types <span>of data.</span></li>
				<li class="calibre17"><strong class="bold">Performance optimization</strong>: By separating data into different collections, you can optimize performance by indexing and querying specific collections more efficiently. This can improve query performance and reduce the amount of data that needs to <span>be scanned.</span></li>
				<li class="calibre17"><strong class="bold">Data locality</strong>: Grouping documents of the same type in a collection will require less disk seek time, and considering that indexing is defined by collection, the querying is much <span>more efficient.</span></li>
			</ul>
			<p class="calibre5">Although a single instance of MongoDB can host several databases at once, it is considered good practice to keep all the document collections used in an application inside a <span>single database.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">When you install MongoDB, there will be three databases created and their names cannot be used for your application database: <strong class="source-inline">admin</strong>, <strong class="source-inline">local</strong>, and <strong class="source-inline">config</strong>. They are built-in databases that shouldn’t be replaced, so avoid accidentally naming your database the same way or making any changes to <span>these databases.</span></p>
			<h2 id="_idParaDest-29" class="about-the-author"><a id="_idTextAnchor034" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Options to install the MongoDB database</h2>
			<p class="calibre5">After reviewing the basic terms, concepts, and structure of the MongoDB database, it is time to learn how to set up a MongoDB database server locally and in <span>the cloud.</span></p>
			<p class="calibre5">The local database setup is convenient for quick prototyping that doesn’t even require an internet connection. However, we recommend that you use a cloud-hosted database in MongoDB Atlas when you’re setting up a database to use as the backend in <span>future chapters.</span></p>
			<p class="calibre5">MongoDB Atlas offers many benefits over the local installation. First, it is easy to set up, and, as you will see, you can get it up and running literally in minutes with a generous free-tier database ready for work. MongoDB handles all the operational aspects of the database, such as provisioning, scaling, backup, <span>and monitoring.</span></p>
			<p class="calibre5">Atlas takes away much of the manual setup and guarantees availability. Other benefits include the involvement of the MongoDB team (which tries to implement best practices), high security by default with access control, firewalls and granular access control, automated backups (depending on the tier), and the possibility to be productive <span>right away.</span></p>
			<h1 id="_idParaDest-30" class="contributor"><a id="_idTextAnchor035" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Installing MongoDB and related tools</h1>
			<p class="calibre5">MongoDB is not just a database service provider, but a full-fledged developer data platform that has a set of technologies built around the core database to meet all your data needs and improve your productivity as a developer. Let’s examine the following components that you will be installing or using in the <span>following sections:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="bold">MongoDB Community Edition</strong>: A free version of MongoDB that runs on all major operating systems. It is what you are going to use to play around with <span>data locally.</span></li>
				<li class="calibre17"><strong class="bold">MongoDB Compass</strong>: A <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>) for managing, querying, aggregating, and analyzing MongoDB data in a visual environment. Compass is a mature and useful tool that you’ll be using throughout your initial querying and <span>aggregation explorations.</span></li>
				<li class="calibre17"><strong class="bold">MongoDB Atlas</strong>: The database-as-a-service solution from MongoDB. This offering is one of the main reasons MongoDB is a central part of the FARM stack. It is relatively easy to set up and it relieves you from manually administering <span>the database.</span></li>
				<li class="calibre17"><strong class="bold">MongoDB Shell</strong> (<strong class="source-inline">mongosh</strong>): A command-line shell that not only performs simple <strong class="bold">create</strong>, <strong class="bold">read</strong>, <strong class="bold">update</strong>, and <strong class="bold">delete</strong> (<strong class="bold">CRUD</strong>) operations on your database but also enables administrative tasks such as creating and deleting databases, starting and stopping services, and <span>similar jobs.</span></li>
				<li class="calibre17"><strong class="bold">MongoDB Database Tools</strong>: Several command-line utilities that allow administrators and developers to export or import data to and from a database, provide diagnostics, or enable manipulation of large files stored in MongoDB’s <span>GridFS system.</span></li>
			</ul>
			<p class="calibre5">This chapter will focus on the procedure to have a fully functional installation. Check the installation instructions that correspond to your operating system. This chapter includes instructions for Windows, Linux, <span>and macOS.</span></p>
			<h1 id="_idParaDest-31" class="contributor"><a id="_idTextAnchor036" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Installing MongoDB and Compass on Windows</h1>
			<p class="calibre5">In this section, you will learn how to install the latest version of MongoDB Community Edition, which at the time of writing is 7.0. MongoDB Community is only supported on 64-bit versions of Windows on x86_64 architecture. Windows versions supported are Windows 11, Windows Server 2019, and Windows Server 2022. To install MongoDB and Compass, you can refer to the following steps. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">We strongly advise you to check the instructions on the MongoDB website (<a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-windows/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-windows/</span></a>) to ensure you have access to the latest information, as they might <span>slightly change.</span></p>
			<ol class="calibre14">
				<li class="calibre15">To download the installer, head over to the MongoDB Download Center at <a href="https://www.mongodb.com/try/download/community" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/try/download/community</span></a>, select the Windows version, and click on <strong class="bold">Download</strong> <span>as follows:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer007" class="img---figure1">
					<img src="image/B22406_02_01.jpg" alt="" role="presentation" class="calibre20"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.1: MongoDB download page</p>
			<ol class="calibre14">
				<li value="2" class="calibre15">Next, execute it. If a security prompt displays <strong class="bold">Open Executable File</strong>, select <strong class="bold">Yes</strong> and proceed to the MongoDB <span>setup wizard.</span></li>
				<li class="calibre15">Read the license agreement, select the checkbox, and then click <span>on </span><span><strong class="bold">Next</strong></span><span>.</span></li>
				<li class="calibre15">This is an important screen. When asked which type of setup to choose, select <strong class="bold">Complete</strong>, <span>as follows:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer008" class="img---figure1">
					<img src="image/B22406_02_02.jpg" alt="" role="presentation" class="calibre21"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.2: Complete installation</p>
			<ol class="calibre14">
				<li value="5" class="calibre15">The next wizard will ask you whether you want MongoDB to run as a Windows network service (that’s what you should prefer) or as a local and domain service. Leave the default values selected and proceed to the next step without making <span>any changes.</span></li>
				<li class="calibre15">Another wizard will appear prompting whether you want to install Compass, MongoDB’s GUI tool for database management. Select the checkbox and proceed to <span>install it:</span><ul class="calibre19"><li class="calibre15"><div id="_idContainer009" class="img---figure1"><img src="image/B22406_02_03.jpg" alt="" role="presentation" class="calibre22"/></div></li></ul></li>
			</ol>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.3: Install Compass</p>
			<ol class="calibre14">
				<li value="7" class="calibre15">Finally, the <strong class="bold">User Account Control</strong> (<strong class="bold">UAC</strong>) Windows warning screen will pop up, and you should <span>select </span><span><strong class="bold">Yes</strong></span><span>.</span></li>
			</ol>
			<p class="calibre5">Now that you have installed MongoDB Community Server on your local machine, the next section will show you how to install other necessary tools that you will be using throughout <span>this book.</span></p>
			<h1 id="_idParaDest-32" class="contributor"><a id="_idTextAnchor037" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Installing the MongoDB Shell (mongosh)</h1>
			<p class="calibre5">After installing MongoDB Community Server and Compass on your computer, you will next install <strong class="source-inline">mongosh</strong>, the <span>MongoDB Shell.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For instructions on other operating systems, please visit the MongoDB documentation: <a href="https://www.mongodb.com/docs/mongodb-shell/install/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/docs/mongodb-shell/install/</span></span></a><span>.</span></p>
			<p class="calibre5">Here’s how you can do it <span>for Windows:</span></p>
			<ol class="calibre14">
				<li class="calibre15">Navigate to the MongoDB Download Center (<a href="https://www.mongodb.com/try/download/shell" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/try/download/shell</span></a>) and, in the <strong class="bold">Tools</strong> section, select <span><strong class="bold">MongoDB Shell</strong></span><span>.</span></li>
				<li class="calibre15">From the dropdowns, select the Windows version and the <strong class="bold">msi</strong> package and click <span>on </span><span><strong class="bold">Download</strong></span><span>.</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer010" class="img---figure1">
					<img src="image/B22406_02_04.jpg" alt="" role="presentation" class="calibre23"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.4: Download the MongoDB Shell</p>
			<ol class="calibre14">
				<li value="3" class="calibre15">Next, locate the <strong class="bold">msi</strong> package on your computer and execute it. If a security prompt asks <strong class="bold">Open Executable File</strong>, select <strong class="bold">Yes</strong> and proceed to the MongoDB setup wizard. The wizard will open the following page. Click <span>on </span><span><strong class="bold">Next</strong></span><span>:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer011" class="img---figure1">
					<img src="image/B22406_02_05.jpg" alt="" role="presentation" class="calibre24"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.5: The MongoDB Shell Setup Wizard</p>
			<ol class="calibre14">
				<li value="4" class="calibre15">In the prompt, select the destination folder for installing <strong class="source-inline">mongosh</strong>, or leave the default option as it is if it looks good to you, and then finish <span>the installation.</span></li>
				<li class="calibre15">At this point, you should be able to test whether MongoDB is running (as a service). Enter the following command in the command prompt of your choice (preferably, use <strong class="bold">cmder</strong>, available <span>at </span><a href="https://cmder.app" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://cmder.app</span></span></a><span>):</span><pre class="source-code">
mongosh</pre></li>				<li class="calibre15">You should see various notifications and a tiny prompt denoted with <strong class="source-inline">&gt;</strong>. Try typing <span>the following:</span><pre class="source-code">
Show dbs</pre><p class="list-inset">If you see the automatically generated <strong class="source-inline">admin</strong>, <strong class="source-inline">config</strong>, and <strong class="source-inline">locals</strong> databases, you should be good <span>to go.</span></p></li>				<li class="calibre15">Now, check the installation of Compass. On Windows, you should be able to find it in your start menu under <strong class="bold">MongoDBCompass</strong> (no spacing). </li>
				<li class="calibre15">If you just click the <strong class="bold">Connect</strong> button, without pasting or typing in any connection string, Compass will connect to the local MongoDB service running on port <strong class="source-inline">27017</strong> and you should be able to see all of the databases that you saw when you used the command line with MongoDB: <strong class="source-inline">admin</strong>, <strong class="source-inline">config</strong>, <span>and </span><span><strong class="source-inline">local</strong></span><span>.</span></li>
			</ol>
			<h1 id="_idParaDest-33" class="contributor"><a id="_idTextAnchor038" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>MongoDB Database Tools</h1>
			<p class="calibre5">The MongoDB Database Tools are a collection of command-line utilities for working with a MongoDB deployment. Some of the common database tools are <span>as follows:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="source-inline">mongoimport</strong>: Imports content from an extended JSON, CSV, or TSV <span>export file</span></li>
				<li class="calibre17"><strong class="source-inline">mongoexport</strong>: Produces a JSON or CSV export of data stored in a <span><strong class="source-inline">mongod</strong></span><span> instance</span></li>
				<li class="calibre17"><strong class="source-inline">mongodump</strong>: Creates a binary export of the contents of a <span><strong class="source-inline">mongod</strong></span><span> database</span></li>
			</ul>
			<p class="calibre5">There are some other tools, such as <strong class="source-inline">mongorestore</strong>, <strong class="source-inline">bsondump</strong>, <strong class="source-inline">mongostat</strong>, <strong class="source-inline">mongotop</strong>, and <strong class="source-inline">mongofiles</strong>. The MongoDB Database Tools can be installed with an MSI installer (or downloaded as a <span>ZIP archive).</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="source-inline">msi</strong> package can be downloaded from the MongoDB Download <span>Center (</span><a href="https://www.mongodb.com/try/download/database-tools" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/try/download/database-tools</span></span></a><span>).</span></p>
			<p class="callout">After downloading, you can follow the installation instructions provided in the MongoDB <span>documentation (</span><a href="https://www.mongodb.com/docs/database-tools/installation/installation-windows/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/docs/database-tools/installation/installation-windows/</span></span></a><span>).</span></p>
			<p class="calibre5">The next section provides a walk-through of the process of installing MongoDB on a standard <span>Linux distribution.</span></p>
			<h1 id="_idParaDest-34" class="contributor"><a id="_idTextAnchor039" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Installing MongoDB and Compass on Linux: Ubuntu</h1>
			<p class="calibre5">Linux offers numerous benefits for the development and management of local servers, but most importantly, should you decide that the database-as-a-service of MongoDB isn’t what you want to use anymore, you will probably want to work on a <span>Linux-based server.</span></p>
			<p class="calibre5">In this book, we will go over the installation process on Ubuntu version 22.04 LTS (Jammy), while the MongoDB version also supports Ubuntu 20.04 LTS (Focal) on x86_64 architecture. The necessary steps to install MongoDB Ubuntu will be listed here, but you should always check the MongoDB Ubuntu installation page (<a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/</span></a>) for recent changes. The process, however, <span>shouldn’t change.</span></p>
			<p class="calibre5">The following actions are to be performed in a Bash shell. Download the public key that will allow you to install MongoDB, then you will create a list file and reload the package manager. Similar steps are required for other Linux distributions, so be sure to check the documentation on the website of your chosen distribution. Finally, you will perform the actual installation of MongoDB through the package manager and start <span>the service.</span></p>
			<p class="calibre5">It is always preferable to skip the packages provided by the Linux distribution as they are often not updated to the latest version. Perform the following steps to install MongoDB <span>on Ubuntu:</span></p>
			<ol class="calibre14">
				<li class="calibre15">Import the public key used by the package management system <span>as follows.</span><p class="list-inset">You need to have <strong class="source-inline">gnupg</strong> and <strong class="source-inline">curl</strong> installed on your system. If you don’t already have them, you can install them by running the <span>following command:</span></p><pre class="source-code">
sudo apt-get install gnupg curl</pre><p class="list-inset">To import the MongoDB public GPG key, run the <span>following command:</span></p><pre class="source-code">curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | \
   sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg \
   --dearmor</pre><p class="list-inset">Create the <strong class="source-inline">/etc/apt/sources.list.d/mongodb-org-7.0.list</strong> file for Ubuntu 22.04 (Jammy) by running the <span>following command:</span></p><pre class="source-code">echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list</pre></li>				<li class="calibre15">Reload the local package <span>database with:</span><pre class="source-code">
sudo apt-get update</pre></li>				<li class="calibre15">Install the MongoDB package. To install the latest stable version, issue the <span>following command:</span><pre class="source-code">
sudo apt-get install -y mongodb-org</pre></li>				<li class="calibre15">Run MongoDB Community Edition. If you follow these instructions and install MongoDB through the package manager, the <strong class="source-inline">/var/lib/mongodb</strong> data directory and the <strong class="source-inline">/var/log/mongodb</strong> log directory will be created during <span>the installation.</span></li>
				<li class="calibre15">You can start the <strong class="source-inline">mongod</strong> <span>process with:</span><pre class="source-code">
sudo systemctl start mongod</pre><p class="list-inset">If you receive an error similar to the following on <span>initiating </span><span><strong class="source-inline">mongod</strong></span><span>:</span></p><pre class="source-code">Failed to start mongod.service: Unit mongod.service not found.</pre><p class="list-inset">Run the following <span>command first:</span></p><pre class="source-code">sudo systemctl daemon-reload</pre><p class="list-inset">Then run the <strong class="source-inline">start</strong> command (shown in <em class="italic">step </em><span><em class="italic">5</em></span><span>) again.</span></p></li>				<li class="calibre15">You should be able to start using the MongoDB Shell (<strong class="source-inline">mongosh</strong>) by <span>simply typing:</span><pre class="source-code">
mongosh</pre></li>			</ol>
			<p class="calibre5">MongoDB isn’t particularly different than any other Linux software when it comes to installation and process management. However, if you have any issues with the installation, the first recommendation would be to visit the MongoDB Linux <span>installation page.</span></p>
			<h1 id="_idParaDest-35" class="contributor"><a id="_idTextAnchor040" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Setting up Atlas</h1>
			<p class="calibre5">MongoDB Atlas—a cloud database service provided by MongoDB—is one of the strongest selling points <span>of MongoDB.</span></p>
			<p class="calibre5">MongoDB Atlas is a fully managed database service, which means that MongoDB handles the infrastructure management, database setup, configuration, and maintenance tasks for you. This allows you to focus on developing your applications instead of managing the <span>underlying infrastructure.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The processes of signing up and setting up a MongoDB Atlas instance are well documented <span>at </span><a href="https://www.mongodb.com/docs/atlas/getting-started/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/docs/atlas/getting-started/</span></span></a><span>.</span></p>
			<p class="calibre5">There are two ways in which you can set up your <span>Atlas account:</span></p>
			<ul class="calibre14">
				<li class="calibre17">Atlas <span>UI (website)</span></li>
				<li class="calibre17">Atlas CLI (<span>command line)</span></li>
			</ul>
			<p class="calibre5">The Atlas CLI provides a dedicated CLI for MongoDB Atlas, allowing you to manage your Atlas database deployments and Atlas Search directly from your terminal. In this book, you will see how to do it from <span>the UI.</span></p>
			<p class="calibre5">Head over to <a href="https://www.mongodb.com/cloud/atlas/register" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/cloud/atlas/register</span></a> to create an Atlas account if you don’t already have it. You can use either your Google account, GitHub account, or email account to sign up for <span>this service.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The Atlas UI and cluster creation steps may change as more features are introduced. It is highly recommended that you refer to the documentation while setting up the cluster for the latest <span>instructions (</span><a href="https://www.mongodb.com/docs/atlas/getting-started/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/docs/atlas/getting-started/</span></span></a><span>).</span></p>
			<p class="calibre5">After setting up the account (here, a Gmail address is used, so you can log in with a Google account for faster access), you will be prompted to create a cluster. You will create an <strong class="source-inline">M0</strong> cluster, which is free, and you should select a <strong class="bold">Cloud Provider &amp; Region</strong> option that is as close to your physical location as possible to <span>minimize latency.</span></p>
			<h2 id="_idParaDest-36" class="about-the-author"><a id="_idTextAnchor041" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Creating an Atlas cluster</h2>
			<p class="calibre5">To set up an Atlas cluster, perform the <span>following steps:</span></p>
			<ol class="calibre14">
				<li class="calibre15">On your Atlas dashboard, you will see the <strong class="bold">Create a deployment</strong> option. Click on <strong class="bold">Create</strong> to start the process of creating your first <span>Atlas cluster.</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer012" class="img---figure1">
					<img src="image/B22406_02_06.jpg" alt="" role="presentation" class="calibre25"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.6: The Atlas dashboard</p>
			<p class="calibre5">In this step, you need to do <span>multiple things:</span></p>
			<ol class="calibre14">
				<li class="calibre15">Select a free <strong class="bold">M0 </strong><span><strong class="bold">sandbox</strong></span><span> option.</span></li>
				<li class="calibre15">Give your cluster a meaningful name, such as <strong class="source-inline">farm-stack</strong>. You can choose any other name of <span>your choice.</span></li>
				<li class="calibre15">Make sure that both the <strong class="bold">Automate security setup</strong> and <strong class="bold">Add sample dataset</strong> options are checked. This will come in very <span>handy later.</span></li>
				<li class="calibre15">Select the cloud service provider of your choice (by default, <span>it’s AWS)</span></li>
				<li class="calibre15">Choose the region that is nearest to your location to minimize latency, and click on <span><strong class="bold">Create Deployment</strong></span><span>.</span></li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">Creating an Atlas user and setting up IP is an important step that you must complete before you start using the <span>Atlas cluster.</span></p>
			<ol class="calibre14">
				<li value="2" class="calibre15">On the next screen, you will be asked to create a database user that will have a username and password. Both the fields are auto-populated for you to simplify the process. Feel free to change the username and password according to your preference. <strong class="bold">Make sure that you save the password somewhere as you will require it later when you connect to </strong><span><strong class="bold">your cluster.</strong></span></li>
				<li class="calibre15">By default, your current IP address is added to enable local connectivity. MongoDB Atlas provides many layers of security and restricted IP address access is one of them. If you are going to use your cluster from any other IP address, you can add that later, or you also have the option to enable access from anywhere (<strong class="source-inline">0.0.0.0/0</strong>), which will allow you to connect from anywhere, but this is not the recommended option for <span>security reasons.</span></li>
			</ol>
			<p class="calibre5">After you complete these steps, you have successfully created your first <span>Atlas cluster!</span></p>
			<h2 id="_idParaDest-37" class="about-the-author"><a id="_idTextAnchor042" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Getting the connection string of your Atlas Cluster</h2>
			<p class="calibre5">Next, you’ll look at the sample dataset that is automatically loaded for you. In this section, you will connect the dataset to your Atlas cluster from Compass and explore the same dataset <span>using it:</span></p>
			<ol class="calibre14">
				<li class="calibre15">On the Atlas dashboard, click on the <strong class="bold">Browse collections</strong> button, as shown in <span><em class="italic">Figure 2</em></span><span><em class="italic">.7</em></span><span>.</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer013" class="img---figure1">
					<img src="image/B22406_02_07.jpg" alt="" role="presentation" class="calibre26"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.7: The Atlas dashboard</p>
			<ol class="calibre14">
				<li value="2" class="calibre15">You can see that the <strong class="source-inline">sample_mflix</strong> dataset has already been loaded in your cluster. You’ll have a database named <strong class="source-inline">sample_mflix</strong> and six collections created under it: <strong class="source-inline">comments</strong>, <strong class="source-inline">embedded_movies</strong>, <strong class="source-inline">movies</strong>, <strong class="source-inline">sessions</strong>, <strong class="source-inline">theatres</strong>, <span>and </span><span><strong class="source-inline">users</strong></span><span>.</span></li>
				<li class="calibre15">Now, go to your Atlas dashboard and get the connection string to connect to your Atlas cluster <span>from Compass.</span></li>
				<li class="calibre15">On the Atlas dashboard, click on the green <span><strong class="bold">Connect</strong></span><span> button.</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer014" class="img---figure1">
					<img src="image/B22406_02_08.jpg" alt="" role="presentation" class="calibre27"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.8: Connect to your cluster</p>
			<ol class="calibre14">
				<li value="5" class="calibre15">Then, <span>select </span><span><strong class="bold">Compass</strong></span><span>:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer015" class="img---figure1">
					<img src="image/B22406_02_09.jpg" alt="" role="presentation" class="calibre28"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.9: Connect to your cluster</p>
			<ol class="calibre14">
				<li value="6" class="calibre15">In the next wizard, copy the connection string shown in <span>the box:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer016" class="img---figure1">
					<img src="image/B22406_02_10.jpg" alt="" role="presentation" class="calibre29"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.10: Get the connection string</p>
			<p class="calibre5">Great! Now, you have the connection string for your Atlas cluster. You can go to Compass and use this connection string to connect to your Atlas cluster from Compass. Don’t forget to replace <strong class="source-inline">&lt;password&gt;</strong> with your Atlas user password before connecting to <span>your cluster.</span></p>
			<h2 id="_idParaDest-38" class="about-the-author"><a id="_idTextAnchor043" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Connecting to the Atlas cluster from Compass</h2>
			<p class="calibre5">Perform the following steps to connect to your Atlas Cluster <span>from Compass:</span></p>
			<ol class="calibre14">
				<li class="calibre15">Launch Compass if it’s not already running on your computer. In the <strong class="bold">URI</strong> box, paste the connection string you copied from the previous step and add your password to it. Next, click <span>on </span><span><strong class="bold">Connect</strong></span><span>:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer017" class="img---figure1">
					<img src="image/B22406_02_11.jpg" alt="" role="presentation" class="calibre30"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.11: MongoDB Compass</p>
			<ol class="calibre14">
				<li value="2" class="calibre15">After successfully connecting to your Atlas cluster, you will see something similar to <span><em class="italic">Figure 2</em></span><span><em class="italic">.12</em></span><span>:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer018" class="img---figure1">
					<img src="image/B22406_02_12.jpg" alt="" role="presentation" class="calibre31"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.12: The My Queries tab in MongoDB Compass</p>
			<ol class="calibre14">
				<li value="3" class="calibre15">You can see the list of databases in your cluster in the left panel. Click on <strong class="bold">sample_mflix</strong> to expand the dropdown and expose the list of collections. Then, click on <strong class="bold">movies</strong> to see the documents stored in <span>that collection:</span></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer019" class="img---figure1">
					<img src="image/B22406_02_13.jpg" alt="" role="presentation" class="calibre32"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.13: List of documents in collections</p>
			<p class="calibre5"><span><em class="italic">Figure 2</em></span><em class="italic">.13</em> shows that you have 21.4k documents in your <span><strong class="source-inline">sample_mflix.movies</strong></span><span> collection.</span></p>
			<p class="calibre5">Now you should have a fully functional instance of the world’s most popular NoSQL database on your machine. You have also created an online account and managed to create your very own cluster, ready to take on most data challenges and power your web app. </p>
			<h1 id="_idParaDest-39" class="contributor"><a id="_idTextAnchor044" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>MongoDB querying and CRUD operations</h1>
			<p class="calibre5">Let’s see MongoDB in action and experience firsthand the power of the most popular NoSQL database. This section will show you the most essential MongoDB commands, through simple examples. These methods will enable you, as a developer, to take control of your data, create new documents, query documents by using different criteria and conditions, perform simple and more complex aggregations, and output data in <span>various forms.</span></p>
			<p class="calibre5">Although you will be talking to MongoDB through the Python drivers (Motor and PyMongo), it is helpful to learn how to write queries directly at first. You’ll begin by querying the <strong class="source-inline">sample_mflix.movies</strong> dataset that was imported into your cluster at the time of cluster creation, then you’ll go through the process of creating new data—inserting, updating, and <span>so on.</span></p>
			<p class="calibre5">Let’s first define the two options for executing MongoDB commands, <span>as follows:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><span>Compass GUI</span></li>
				<li class="calibre17">MongoDB <span>Shell (</span><span><strong class="source-inline">mongosh</strong></span><span>)</span></li>
			</ul>
			<p class="calibre5">Connect to your MongoDB Atlas cluster from <strong class="source-inline">mongosh</strong> and perform CRUD operations on <span>your data:</span></p>
			<ol class="calibre14">
				<li class="calibre15">To connect to your Atlas cluster from <strong class="source-inline">mongosh</strong> (MongoDB Shell), navigate to your Atlas cluster dashboard and fetch the connection string for <strong class="source-inline">mongosh</strong>. The steps will be the same as for Compass, except for the connecting tool. For this, you’ll need the MongoDB Shell and <span>not Compass.</span><p class="list-inset"><span><em class="italic">Figure 2</em></span><em class="italic">.14</em> shows the connection string <span>for </span><span><strong class="source-inline">mongosh</strong></span><span>:</span></p></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer020" class="img---figure1">
					<img src="image/B22406_02_14.jpg" alt="" role="presentation" class="calibre33"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.14: Connect to mongosh (MongoDB Shell)</p>
			<ol class="calibre14">
				<li value="2" class="calibre15">Copy the connection string and navigate to the CLI on <span>your computer.</span></li>
				<li class="calibre15">Now, to set up the options for working with and executing commands in our cloud database in Atlas, perform the <span>following steps:</span><ol class="calibre19"><li class="calibre15">In a shell session (Command Prompt on Windows or Bash on Linux), paste the connection string in the prompt, and hit <em class="italic">Enter</em>. Then, provide the password and <span>hit </span><span><em class="italic">Enter</em></span><span>.</span></li></ol><p class="list-inset">You can also explicitly pass the password in the connection string by using the <strong class="source-inline">--password</strong> option followed by your password. To avoid any typos/errors in typing the password, you can use <span>this option.</span></p><ol class="calibre19"><li class="calibre15" value="2">On successfully connecting to your Atlas cluster, you should see something <span>like this:</span></li></ol></li>
			</ol>
			<div class="_idfootnote">
				<div id="_idContainer021" class="img---figure1">
					<img src="image/B22406_02_15.jpg" alt="" role="presentation" class="calibre34"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.15: Connecting to a MongoDB database successfully</p>
			<ol class="calibre14">
				<li class="calibre15" value="3">Next, use the <strong class="source-inline">show dbs</strong> command to list all the databases present in <span>your cluster:</span></li>
			</ol>
			<pre class="source-code">
show dbs</pre>			<p class="calibre5">This command should lists all of the available databases: <strong class="source-inline">admin</strong>, <strong class="source-inline">local</strong>, and <strong class="source-inline">sample_mflix</strong> (<span>your database).</span></p>
			<ol class="calibre14">
				<li class="calibre15" value="4">In order to use your database, type the <span>following code:</span></li>
			</ol>
			<pre class="source-code">
use sample_mflix</pre>			<p class="calibre5">The console will respond with <strong class="source-inline">switched to db sample_mflix</strong>, which means that now you can query and work on <span>your database.</span></p>
			<ol class="calibre14">
				<li class="calibre15" value="5">To see the available collections inside <strong class="source-inline">sample_mflix</strong>, try the <span>following code:</span></li>
			</ol>
			<pre class="source-code">
show collections</pre>			<p class="calibre5">You should be able to view all six collections that we saw in the Atlas UI and Compass, that is, <strong class="source-inline">comments</strong>, <strong class="source-inline">embedded_movies</strong>, <strong class="source-inline">movies</strong>, <strong class="source-inline">sessions</strong>, <strong class="source-inline">theatres</strong>, and <strong class="source-inline">users</strong>. Now that you have your database and collection available, you can proceed and use some <span>querying options.</span></p>
			<h1 id="_idParaDest-40" class="contributor"><a id="_idTextAnchor045" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Querying in MongoDB</h1>
			<p class="calibre5">This section will show the use of the <strong class="source-inline">sample_mflix.movies</strong> collection as an example for demonstration. Working with real data with some expected query results helps reinforce the acquired notions and makes understanding the underlying processes easier and <span>more thorough.</span></p>
			<p class="calibre5">The most frequent MongoDB query language commands—and the ones that this chapter will be covering—are <span>as follows:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="source-inline">find()</strong>: Finds and selects documents matching simple or <span>complex criteria</span></li>
				<li class="calibre17"><strong class="source-inline">insertOne()</strong>: Inserts a new document into <span>the collection</span></li>
				<li class="calibre17"><strong class="source-inline">insertMany()</strong>: Inserts an array of documents into <span>the collection</span></li>
				<li class="calibre17"><strong class="source-inline">updateOne()</strong> and <strong class="source-inline">updateMany()</strong>: Update one or more documents according to <span>some criteria</span></li>
				<li class="calibre17"><strong class="source-inline">deleteOne()</strong> and <strong class="source-inline">deleteMany()</strong>: Delete one or more documents from <span>the collection</span></li>
			</ul>
			<p class="calibre5">There are 21,349 documents in the <strong class="source-inline">sample_mflix.movies</strong> collection. To query for all the documents, type the following command in the <span>MongoDB Shell:</span></p>
			<pre class="source-code">
db.movies.find()</pre>			<p class="calibre5">The preceding command will print several documents, <span>as follows:</span></p>
			<div class="_idfootnote">
				<div id="_idContainer022" class="img---figure1">
					<img src="image/B22406_02_16.jpg" alt="" role="presentation" class="calibre35"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.16: find() query output</p>
			<p class="calibre5">The console will print the message <strong class="source-inline">Type "it" for more</strong>, as the console prints out only 20 documents at a time. This statement could be interpreted as a classic <strong class="source-inline">SELECT * FROM TABLE</strong> in the <span>SQL world.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="source-inline">find()</strong> method returns a cursor and not the actual results. The cursor enables performing some standard database operations on the returned documents, such as limiting the number of results, ordering by one or more keys (ascending or descending), and <span>skipping records.</span></p>
			<p class="calibre5">You can also apply some filters and only return those documents that satisfy the specified criteria. The <strong class="source-inline">movies</strong> collection has the <strong class="source-inline">years</strong> field, which represents the year in which the movie was released. For instance, you can write a query to only return movies that were released <span>in </span><span><strong class="source-inline">1969</strong></span><span>.</span></p>
			<p class="calibre5">In the command prompt, enter the <span>following command:</span></p>
			<pre class="source-code">
db.movies.find({"year": 1969}).limit(5)</pre>			<p class="calibre5">Here, you used the <strong class="source-inline">limit()</strong> method on the cursor to specify the maximum number of documents the cursor should return, in this <span>case </span><span><strong class="source-inline">5</strong></span><span>.</span></p>
			<p class="calibre5">The preceding command will return the <span>search results:</span></p>
			<div class="_idfootnote">
				<div id="_idContainer023" class="img---figure1">
					<img src="image/B22406_02_17.jpg" alt="" role="presentation" class="calibre36"/>
				</div>
			</div>
			<p class="calibre5" lang="en-US" xml:lang="en-US">Figure 2.17: find() operation with a filter criteria</p>
			<p class="calibre5">The results should now contain only documents that satisfy the condition that the <strong class="source-inline">year</strong> key is equal to <strong class="source-inline">1969</strong>. Looking at the results, it seems like there are many documents. You can also do a count operation on a query by using the <strong class="source-inline">db.collection.countDocuments()</strong> method. <span>For example:</span></p>
			<pre class="source-code">
db.movies.countDocuments({"year": 1969})</pre>			<p class="calibre5">The preceding command returns <strong class="source-inline">107</strong>, which means you have 107 documents in your collection that matched your search criteria; that is, 107 movies were released in the <span>year </span><span><strong class="source-inline">1969</strong></span><span>.</span></p>
			<p class="calibre5">The JSON syntax that you used in the previous query is a <strong class="bold">filter</strong>, and it can have numerous key-value pairs with which you define your query method. MongoDB has many operators that enable you to query fields with more complex conditions than plain equality, and their updated documentation is available on the MongoDB site at <a href="https://docs.mongodb.com/manual/reference/operator/query/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://docs.mongodb.com/manual/reference/operator/query/</span></span></a><span>.</span></p>
			<p class="calibre5">You can visit the page and look around some of the operators as they can give you an idea of how you might be able to structure <span>your queries.</span></p>
			<p class="calibre5">For instance, suppose you want to find all the <strong class="source-inline">Comedy</strong> (genre) movies that were released in <strong class="source-inline">USA</strong> after the year <strong class="source-inline">1945</strong>. The following query will do <span>the job:</span></p>
			<pre class="source-code">
db.movies.find({"year": {$gt: 1945}, "countries": "USA", "genres": "Comedy"})</pre>			<p class="calibre5">After running the query, you should see a bunch of documents returned by <span>the cursor.</span></p>
			<p class="calibre5">You can also use the <strong class="source-inline">countDocuments</strong> method to find out the exact number of documents that match the <span>filter criteria:</span></p>
			<pre class="source-code">
db.movies.countDocuments({"year": {$gt: 1945}, "countries": "USA", "genres": "Comedy"})</pre>			<p class="calibre5">You will find that there are <strong class="source-inline">3521</strong> documents in the collection that match your <span>search criteria.</span></p>
			<p class="calibre5">The <strong class="source-inline">$gt</strong> operator is used to specify that the year should be greater than <strong class="source-inline">1945</strong>, ensuring the movies selected were released after this year. The conditions on country and genre are straightforward, requiring the <strong class="source-inline">countries</strong> array to include <strong class="source-inline">USA</strong> and the <strong class="source-inline">genres</strong> array to <span>contain </span><span><strong class="source-inline">Comedy</strong></span><span>.</span></p>
			<p class="calibre5">Remember that the <strong class="source-inline">find()</strong> method implies an <strong class="bold">AND</strong> operation, so only documents satisfying all three conditions will <span>be returned.</span></p>
			<p class="calibre5">Some of the most widely used query operators are <span>as follows:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="source-inline">$gt</strong>: <span>Greater than</span></li>
				<li class="calibre17"><strong class="source-inline">$lt</strong>: <span>Less than</span></li>
				<li class="calibre17"><strong class="source-inline">$in</strong>: Providing a list <span>of values</span></li>
			</ul>
			<p class="calibre5">However, you can see on the MongoDB documentation (<a href="https://www.mongodb.com/docs/manual/reference/operator/query/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/docs/manual/reference/operator/query/</span></a>) that there are many more—logical <em class="italic">and</em>, <em class="italic">or</em>, and <em class="italic">nor</em>; <em class="italic">geospatial</em> operators for finding the nearest points on a map; and so on. It is time to explore other methods that allow you to perform queries <span>and operations.</span></p>
			<p class="calibre5"><strong class="source-inline">findOne()</strong> is similar to <strong class="source-inline">find()</strong>; it also takes an optional filter parameter but returns only the first document that satisfies <span>the criteria.</span></p>
			<p class="calibre5">Before you dive into the process of creating, deleting, and updating existing documents, it’s important to mention a very useful feature <span>called </span><span><strong class="bold">projection</strong></span><span>.</span></p>
			<h2 id="_idParaDest-41" class="about-the-author"><a id="_idTextAnchor046" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Projection</h2>
			<p class="calibre5">Projection allows you to specify which fields should be included or excluded in the documents returned from query results. This is achieved by providing an additional argument to the <strong class="source-inline">find()</strong> and <strong class="source-inline">findOne()</strong> methods. This argument is an object that specifies which fields to include or exclude, effectively tailoring the query results to only contain the information that <span>is needed.</span></p>
			<p class="calibre5">Building projections is easy; a projection query is just a JSON object in which the keys are the names of the fields, while the values are <strong class="source-inline">0</strong> if you want to exclude a field from the output or <strong class="source-inline">1</strong> if we want to include it. The <strong class="source-inline">ObjectId</strong> type is included by default, so if you want to remove it from the output, you have to set it to <strong class="source-inline">0</strong> explicitly. Also, if you have not included the name of any field in the projection, it is assumed to have a <strong class="source-inline">0</strong> value and is <span>not projected.</span></p>
			<p class="calibre5">Suppose in your previous query you only want to project the movie title, country released, and year. To do that, execute the <span>following command:</span></p>
			<pre class="source-code">
db.movies.find({"year": {$gt: 1945}, "countries": "USA", "genres": "Comedy"}, {"_id":0, "title": 1, "countries": 1, "year": 1}).sort({"year": 1}).limit(5)</pre>			<p class="calibre5">The sort and limit operations first sort the returned documents by the <strong class="source-inline">year</strong> field in ascending order and then restrict the result to five documents, as specified by the <strong class="source-inline">limit</strong> parameter. In the projection part, the <strong class="source-inline">_id</strong> field is suppressed by setting it to <strong class="source-inline">0</strong>, and the <strong class="source-inline">title</strong>, <strong class="source-inline">countries</strong>, and <strong class="source-inline">year</strong> fields are included by setting them to <strong class="source-inline">1</strong>. Since the <strong class="source-inline">genres</strong> field and all other fields in the projection are omitted, they are automatically excluded from the <span>returned documents.</span></p>
			<h2 id="_idParaDest-42" class="about-the-author"><a id="_idTextAnchor047" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Creating new documents</h2>
			<p class="calibre5">The method used to create new documents in MongoDB is <strong class="source-inline">insertOne()</strong>. You can try inserting the following fictitious movie into <span>your database:</span></p>
			<pre class="source-code">
db.movies.insertOne({"title": "Once upon a time on Moon", "genres":["Test"], year: 2024})</pre>			<p class="calibre5">The preceding command will print the <span>following message:</span></p>
			<pre class="source-code">
{
  acknowledged: true,
  insertedId: ObjectId("66b25f48b959c3fb3a4e56ed")
}</pre>			<p class="calibre5">The first part means that MongoDB acknowledged the insertion operation, whereas the second property prints out the <strong class="source-inline">ObjectId</strong> key, which is the primary key that MongoDB uses and assigns automatically to the newly inserted documents if not <span>provided manually.</span></p>
			<p class="calibre5">MongoDB, naturally, also supports inserting many documents at once with the <strong class="source-inline">insertMany()</strong> method. Instead of providing a single document, the method accepts an array of documents. You could, for example, insert another couple of sample movies <span>as follows:</span></p>
			<pre class="source-code">
db.movies.insertMany([{"title": "Once upon a time on Moon", "genres":["Test"], year: 2024}, {"title": "Once upon a time on Mars", "genres":["Test"], year: 2023}, {"title": "Tiger Force in Paradise", "genres":["Test"], year: 2019, rating: "G"}])</pre>			<p class="calibre5">Here, you inserted three fictitious movies and the third one has a new property, rating (which is set to <strong class="source-inline">G</strong>), which does not exist in any other movies, just to highlight MongoDB’s schema flexibility. The shell acknowledges this and prints out the <strong class="source-inline">ObjectId</strong> key of the newly <span>inserted documents.</span></p>
			<h2 id="_idParaDest-43" class="about-the-author"><a id="_idTextAnchor048" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Updating documents</h2>
			<p class="calibre5">Updating documents in MongoDB is possible through several different methods that are suited for different scenarios that might arise in your <span>business logic.</span></p>
			<p class="calibre5">The <strong class="source-inline">updateOne()</strong> method updates the first encountered document with the data provided in the fields. For example, let’s update the first movie whose <strong class="source-inline">genres</strong> field has <strong class="source-inline">Test</strong> in it and set it to <strong class="source-inline">PlaceHolder</strong> <strong class="source-inline">genre</strong>, <span>as follows:</span></p>
			<pre class="source-code">
db.movies.updateOne({genres: "Test"}, {$set: {"genres.$": "PlaceHolder"}})</pre>			<p class="calibre5">You can also update existing properties of the document as long as you use the <strong class="source-inline">$set</strong> operator. Let’s say that you want to make similar updates to all documents in your collection (i.e., set the <strong class="source-inline">genres</strong> field value to the <strong class="source-inline">placeHolder</strong> genre) that match the passed filter criteria and also increase the year value by <strong class="source-inline">1</strong> in all matched documents. You could try it with the <span>following command:</span></p>
			<pre class="source-code">
db.movies.updateMany( { "genres": "Test" }, { $set: { "genres.$": "PlaceHolder" }, $inc: { "year": 1 } } )</pre>			<p class="calibre5">The preceding command updates many documents, namely all movies that satisfy the simple requirement of having <strong class="source-inline">Test</strong> in the <span><strong class="source-inline">genres</strong></span><span> field.</span></p>
			<p class="calibre5">Updating documents is an atomic operation—if two or more updates are issued at the same time, the one that reaches the server first will <span>be applied.</span></p>
			<p class="calibre5"><strong class="source-inline">mongosh</strong> also provides a <strong class="source-inline">replaceOne()</strong> method that takes a filter, like your earlier methods, but also expects an entire document that will take the place of the preceding one. You can get more information on the collection methods in the following <span>documentation: </span><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.updateOne/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span><span>https://www.mongodb.com/docs/manual/reference/method/db.collection.updateOne/</span></span></a><span>.</span></p>
			<h2 id="_idParaDest-44" class="about-the-author"><a id="_idTextAnchor049" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Deleting documents</h2>
			<p class="calibre5">Deleting documents works in a similar way to the <strong class="source-inline">find</strong> methods—you can provide a filter specifying the documents to be deleted and use the <strong class="source-inline">deleteOne</strong> or <strong class="source-inline">deleteMany</strong> method to execute <span>the operation.</span></p>
			<p class="calibre5">Let’s delete all the fake movies that you inserted in your collection by using the <span>following command:</span></p>
			<pre class="source-code">
db.movies.deleteMany({genres: "PlaceHolder"})</pre>			<p class="calibre5">The shell will acknowledge this operation with a <strong class="source-inline">deletedCount</strong> variable equal to <strong class="source-inline">4</strong>—the number of deleted documents. The <strong class="source-inline">deleteOne</strong> method operates in a very similar way by deleting the first document that matches the <span>filter criteria.</span></p>
			<p class="calibre5">To drop an entire collection in MongoDB, you can use the <strong class="source-inline">db.collection.drop()</strong> command. However, it is not recommended to drop an entire collection without careful consideration as it will delete all the data and related indexes. It is advised that you don’t run this command for the movies dataset as we need it for the rest of <span>this chapter.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Make sure to import the data again in Atlas (you should see an option on the Atlas dashboard) if you deleted all <span>the documents.</span></p>
			<h3 class="calibre8">Aggregation framework</h3>
			<p class="calibre5">The MongoDB aggregation framework is an extremely useful tool that enables offloading some (or most) of the computing burden of making calculations and aggregations of varying complexity to the MongoDB server and sparing your client side, as well as the (Python-based) backend, of <span>some workload.</span></p>
			<p class="calibre5">Centered around the concept of a <strong class="bold">pipeline</strong> (something that you might be familiar with if you have done some analytics or you have ever connected a few commands in Linux), the aggregation framework is, at its simplest, an alternative way to retrieve sets of documents from a collection. It is similar to the <strong class="source-inline">find</strong> method that you already used extensively but with the additional benefit of data processing in different stages <span>or steps.</span></p>
			<p class="calibre5">The MongoDB documentation site (<a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.aggregate/" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"><span>https://www.mongodb.com/docs/manual/reference/method/db.collection.aggregate/</span></a>) is the best place to start if you want to get acquainted with all the possibilities. However, we’ll start with a couple of <span>simple examples.</span></p>
			<p class="calibre5">The syntax for the aggregation is similar to other methods that you used earlier, such as <strong class="source-inline">find()</strong> and <strong class="source-inline">findOne()</strong>. We use the <strong class="source-inline">aggregate()</strong> method, which takes a list of stages as <span>a parameter.</span></p>
			<p class="calibre5">Probably the best aggregation, to begin with, would be to mimic the <span><strong class="source-inline">find</strong></span><span> method.</span></p>
			<p class="calibre5">Write an aggregation query to select all movies where the <strong class="source-inline">genres</strong> field <span>includes </span><span><strong class="source-inline">Comedy</strong></span><span>:</span></p>
			<pre class="source-code">
db.movies.aggregate([{$match: {"genres": "Comedy"}}])</pre>			<p class="calibre5">This is probably the simplest possible aggregation, and it consists of just one stage, the <strong class="source-inline">$match</strong> stage, which tells MongoDB that you only want comedy movies, so the output of the first stage is <span>exactly that.</span></p>
			<p class="calibre5">In your collection, you have both <strong class="source-inline">series</strong> and <strong class="source-inline">movies</strong> data. Let’s write an aggregation pipeline to filter out films that are of the movie type and have <strong class="source-inline">Comedy</strong> as the genre. Then, group them together to find out the average runtime of <span>comedy movies:</span></p>
			<pre class="source-code">
db.movies.aggregate([ {$match: {type: "movie", genres: "Comedy" } }, {$group: {_id: null, averageRuntime: { $avg: "$runtime" } } } ])</pre>			<p class="calibre5">The preceding code will return the <span>following output:</span></p>
			<pre class="source-code">
[ { _id: null, averageRuntime: 98.86438291881745 } ]</pre>			<p class="calibre5">Here is a more detailed explanation of the preceding <span>aggregation query:</span></p>
			<ul class="calibre14">
				<li class="calibre17"><strong class="bold">$match stage</strong>: This is an aggregation stage that filters documents to pass only those that match the given criteria to the next stage. Think of it as a filter that screens out documents not meeting specific conditions. The parameters to <strong class="source-inline">$match</strong> define the criteria for filtering documents. In this case, <strong class="source-inline">{type: "movie", genres: "Comedy"}</strong> specifies that documents must have the type equal to <strong class="source-inline">movie</strong> and must include <strong class="source-inline">Comedy</strong> in their <strong class="source-inline">genres</strong> array to <span>pass through.</span></li>
				<li class="calibre17"><strong class="bold">$group stage</strong>: This stage is used to aggregate documents. Documents that meet the criteria from previous stages are grouped based on a specified identifier and can be processed collectively, often to perform operations such as summing or <span>averaging values.</span><p class="list-inset">The <strong class="source-inline">$group</strong> stage takes parameters that define how to group the documents and what calculations to perform on the <span>grouped data.</span></p></li>
				<li class="calibre17"><strong class="bold">_id: null</strong>: In the <strong class="source-inline">$group</strong> stage, <strong class="source-inline">_id</strong> specifies the grouping criteria. Setting <strong class="source-inline">_id</strong> to null means all documents passed from the previous stage will be aggregated into a single group, rather than being divided into multiple groups based on distinct <span>field values.</span></li>
				<li class="calibre17"><strong class="bold">averageRuntime: { $avg: “$runtime” }</strong>: This part calculates the average of the runtime values of all documents in the group. <strong class="source-inline">$avg</strong> is an accumulator operator used here to compute the average. <strong class="source-inline">$runtime</strong> specifies that the runtime field from each document should be used in <span>the calculation.</span></li>
			</ul>
			<p class="calibre5">Once the data is grouped and aggregated the way you want it, you can apply other simpler operations, such as sorting, ordering, <span>and limiting.</span></p>
			<h1 id="_idParaDest-45" class="contributor"><a id="_idTextAnchor050" class="calibre7 pcalibre3 pcalibre pcalibre4 pcalibre1 pcalibre2"/>Summary</h1>
			<p class="calibre5">This chapter detailed the basic building blocks that define MongoDB and its structure. You have seen how to set up a database in the cloud using MongoDB Atlas and explored the basics of creating, updating, and deleting documents. Further, this chapter detailed the aggregation pipeline framework—a strong <span>analytic tool.</span></p>
			<p class="calibre5">The next chapter will show how to create APIs with FastAPI—an exciting and new Python framework. We will provide a minimal yet complete guide of the main concepts and features, which should hopefully convince you that building APIs can be fast, efficient, <span>and fun.</span></p>
		</div>
	</div>
</div>
</body></html>