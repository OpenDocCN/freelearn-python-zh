<html xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<title>ch015.xhtml</title>
<link href="../styles/stylesheet1.css" rel="stylesheet" type="text/css"/>
<!-- kobo-style -->
<style id="koboSpanStyle" type="text/css" xmlns="http://www.w3.org/1999/xhtml">.koboSpan { -webkit-text-combine: inherit; }</style>
</head>
<body epub:type="bodymatter">
<section class="level1" data-number="15" id="chapter-11-project-3.7-interim-data-persistence">
<h1 data-number="15"><span class="titlemark"><span class="koboSpan" id="kobo.1.1" xmlns="http://www.w3.org/1999/xhtml">Chapter 11</span></span><br/>
<span id="x1-26400011"/><span class="koboSpan" id="kobo.2.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.7: Interim Data Persistence</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns="http://www.w3.org/1999/xhtml">Our goal is to create files of clean, converted data we can then use for further analysis. </span><span class="koboSpan" id="kobo.3.2" xmlns="http://www.w3.org/1999/xhtml">To an extent, the goal of </span><span id="dx1-264001"/><span class="koboSpan" id="kobo.4.1" xmlns="http://www.w3.org/1999/xhtml">creating a file of clean data has been a part of all of the previous chapters. </span><span class="koboSpan" id="kobo.4.2" xmlns="http://www.w3.org/1999/xhtml">We’ve avoided looking deeply at the interim results of acquisition and cleaning. </span><span class="koboSpan" id="kobo.4.3" xmlns="http://www.w3.org/1999/xhtml">This chapter formalizes some of the processing that was quietly assumed in those earlier chapters. </span><span class="koboSpan" id="kobo.4.4" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we’ll look more closely at two topics:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.5.1" xmlns="http://www.w3.org/1999/xhtml">File formats and data persistence</span></p></li>
<li><p><span class="koboSpan" id="kobo.6.1" xmlns="http://www.w3.org/1999/xhtml">The architecture of applications</span></p></li>
</ul>
<p><span id="x1-264002r278"/></p>
<section class="level2" data-number="15.1" id="description-17">
<h2 data-number="15.1"><span class="titlemark"><span class="koboSpan" id="kobo.7.1" xmlns="http://www.w3.org/1999/xhtml">11.1 </span></span> <span id="x1-2650001"/><span class="koboSpan" id="kobo.8.1" xmlns="http://www.w3.org/1999/xhtml">Description</span></h2>
<p><span class="koboSpan" id="kobo.9.1" xmlns="http://www.w3.org/1999/xhtml">In the </span><span id="dx1-265001"/><span class="koboSpan" id="kobo.10.1" xmlns="http://www.w3.org/1999/xhtml">previous chapters, particularly those starting with </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.11.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.12.1" xmlns="http://www.w3.org/1999/xhtml"> 9</span></em></a><span class="koboSpan" id="kobo.13.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.14.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.1:</span></em> <em><span class="koboSpan" id="kobo.15.1" xmlns="http://www.w3.org/1999/xhtml">Data Cleaning Base Application</span></em></a><span class="koboSpan" id="kobo.16.1" xmlns="http://www.w3.org/1999/xhtml">, the question of ”persistence” was dealt with casually. </span><span class="koboSpan" id="kobo.16.2" xmlns="http://www.w3.org/1999/xhtml">The previous chapters all wrote the cleaned samples into a file in ND JSON format. </span><span class="koboSpan" id="kobo.16.3" xmlns="http://www.w3.org/1999/xhtml">This saved delving into the alternatives and the various choices available. </span><span class="koboSpan" id="kobo.16.4" xmlns="http://www.w3.org/1999/xhtml">It’s time to review the previous projects and consider the choice of file format for persistence.</span></p>
<p><span class="koboSpan" id="kobo.17.1" xmlns="http://www.w3.org/1999/xhtml">What’s important is the overall flow of data from acquisition to analysis. </span><span class="koboSpan" id="kobo.17.2" xmlns="http://www.w3.org/1999/xhtml">The conceptual flow of data is shown in </span><a href="#11.1"><em><span class="koboSpan" id="kobo.18.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.1</span></em></a><span class="koboSpan" id="kobo.19.1" xmlns="http://www.w3.org/1999/xhtml">.</span></p>
<figure class="IMG---Figure">
<span class="koboSpan" id="kobo.20.1" xmlns="http://www.w3.org/1999/xhtml"><img alt="Figure 11.1: Data Analysis Pipeline " src="../media/file51.jpg"/></span>
<figcaption class="IMG---Caption"><span class="id" id="11.1"><span class="koboSpan" id="kobo.21.1" xmlns="http://www.w3.org/1999/xhtml">Figure 11.1: </span></span><span class="content"><span class="koboSpan" id="kobo.22.1" xmlns="http://www.w3.org/1999/xhtml">Data Analysis Pipeline </span></span></figcaption>
</figure>
<p><span class="koboSpan" id="kobo.23.1" xmlns="http://www.w3.org/1999/xhtml">This differs from the </span><span id="dx1-265004"/><span class="koboSpan" id="kobo.24.1" xmlns="http://www.w3.org/1999/xhtml">diagram shown in </span><a href="ch006.xhtml#x1-470002"><em><span class="koboSpan" id="kobo.25.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.26.1" xmlns="http://www.w3.org/1999/xhtml"> 2</span></em></a><span class="koboSpan" id="kobo.27.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch006.xhtml#x1-470002"><em><span class="koboSpan" id="kobo.28.1" xmlns="http://www.w3.org/1999/xhtml">Overview of the Projects</span></em></a><span class="koboSpan" id="kobo.29.1" xmlns="http://www.w3.org/1999/xhtml">, where the stages were not quite as well defined. </span><span class="koboSpan" id="kobo.29.2" xmlns="http://www.w3.org/1999/xhtml">Some experience with acquiring and cleaning data helps to clarify the considerations around saving and working with data.</span></p>
<p><span class="koboSpan" id="kobo.30.1" xmlns="http://www.w3.org/1999/xhtml">The diagram shows a few of the many choices for persisting interim data. </span><span class="koboSpan" id="kobo.30.2" xmlns="http://www.w3.org/1999/xhtml">A more complete list of format choices includes the following:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.31.1" xmlns="http://www.w3.org/1999/xhtml">CSV</span></p></li>
<li><p><span class="koboSpan" id="kobo.32.1" xmlns="http://www.w3.org/1999/xhtml">TOML</span></p></li>
<li><p><span class="koboSpan" id="kobo.33.1" xmlns="http://www.w3.org/1999/xhtml">JSON</span></p></li>
<li><p><span class="koboSpan" id="kobo.34.1" xmlns="http://www.w3.org/1999/xhtml">Pickle</span></p></li>
<li><p><span class="koboSpan" id="kobo.35.1" xmlns="http://www.w3.org/1999/xhtml">A SQL database</span></p></li>
<li><p><span class="koboSpan" id="kobo.36.1" xmlns="http://www.w3.org/1999/xhtml">YAML</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.37.1" xmlns="http://www.w3.org/1999/xhtml">There are others, but this list contains formats that enjoy a direct implementation in Python. </span><span class="koboSpan" id="kobo.37.2" xmlns="http://www.w3.org/1999/xhtml">Note that YAML is popular but isn’t a built-in feature of the Python standard library. </span><span class="koboSpan" id="kobo.37.3" xmlns="http://www.w3.org/1999/xhtml">Additional formats include protocol buffers ( </span><a class="url" href="https://protobuf.dev"><span class="koboSpan" id="kobo.38.1" xmlns="http://www.w3.org/1999/xhtml">https://protobuf.dev</span></a><span class="koboSpan" id="kobo.39.1" xmlns="http://www.w3.org/1999/xhtml">) and Parquet ( </span><a class="url" href="https://parquet.apache.org"><span class="koboSpan" id="kobo.40.1" xmlns="http://www.w3.org/1999/xhtml">https://parquet.apache.org</span></a><span class="koboSpan" id="kobo.41.1" xmlns="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.41.2" xmlns="http://www.w3.org/1999/xhtml">These two formats require a bit more work to define the structure before serializing and deserializing Python data; we’ll leave them out of this discussion.</span></p>
<p><span class="koboSpan" id="kobo.42.1" xmlns="http://www.w3.org/1999/xhtml">The CSV format has two disadvantages. </span><span class="koboSpan" id="kobo.42.2" xmlns="http://www.w3.org/1999/xhtml">The most notable of these problems is the representation of all data types as simple strings. </span><span class="koboSpan" id="kobo.42.3" xmlns="http://www.w3.org/1999/xhtml">This means any type of conversion information must be offered in metadata outside the CSV file. </span><span class="koboSpan" id="kobo.42.4" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.43.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.44.1" xmlns="http://www.w3.org/1999/xhtml">package </span><span id="dx1-265005"/><span class="koboSpan" id="kobo.45.1" xmlns="http://www.w3.org/1999/xhtml">provides the needed metadata in the </span><span id="dx1-265006"/><span class="koboSpan" id="kobo.46.1" xmlns="http://www.w3.org/1999/xhtml">form of a class definition, making this format tolerable. </span><span class="koboSpan" id="kobo.46.2" xmlns="http://www.w3.org/1999/xhtml">The secondary problem is the lack of a deeper structure to the data. </span><span class="koboSpan" id="kobo.46.3" xmlns="http://www.w3.org/1999/xhtml">This forces the files to have a flat sequence of primitive attributes.</span></p>
<p><span class="koboSpan" id="kobo.47.1" xmlns="http://www.w3.org/1999/xhtml">The JSON format doesn’t—directly—serialize datetime or timedelta objects. </span><span class="koboSpan" id="kobo.47.2" xmlns="http://www.w3.org/1999/xhtml">To make this work reliably, additional metadata is required to deserialize these types from supported JSON values like text or numbers. </span><span class="koboSpan" id="kobo.47.3" xmlns="http://www.w3.org/1999/xhtml">This missing feature is provided by the </span><strong><span class="koboSpan" id="kobo.48.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.49.1" xmlns="http://www.w3.org/1999/xhtml">package and works elegantly. </span><span class="koboSpan" id="kobo.49.2" xmlns="http://www.w3.org/1999/xhtml">A </span><code><span class="koboSpan" id="kobo.50.1" xmlns="http://www.w3.org/1999/xhtml">datetime.datetime</span></code><span class="koboSpan" id="kobo.51.1" xmlns="http://www.w3.org/1999/xhtml"> object will serialize as a string, and the type information in the class definition is used to properly parse the string. </span><span class="koboSpan" id="kobo.51.2" xmlns="http://www.w3.org/1999/xhtml">Similarly, a </span><code><span class="koboSpan" id="kobo.52.1" xmlns="http://www.w3.org/1999/xhtml">datetime.timedelta</span></code><span class="koboSpan" id="kobo.53.1" xmlns="http://www.w3.org/1999/xhtml"> is serialized as a float number but converted — correctly — into a </span><code><span class="koboSpan" id="kobo.54.1" xmlns="http://www.w3.org/1999/xhtml">datetime.timedelta</span></code><span class="koboSpan" id="kobo.55.1" xmlns="http://www.w3.org/1999/xhtml"> based on the type information in the class definition.</span></p>
<p><span class="koboSpan" id="kobo.56.1" xmlns="http://www.w3.org/1999/xhtml">The TOML format has one advantage over the JSON format. </span><span class="koboSpan" id="kobo.56.2" xmlns="http://www.w3.org/1999/xhtml">Specifically, the TOML format has a tidy way to serialize datetime objects, a capability the JSON library lacks. </span><span class="koboSpan" id="kobo.56.3" xmlns="http://www.w3.org/1999/xhtml">The TOML format has the disadvantage of not offering a direct way to put multiple TOML documents into a single file. </span><span class="koboSpan" id="kobo.56.4" xmlns="http://www.w3.org/1999/xhtml">This limits TOML’s ability to handle vast datasets. </span><span class="koboSpan" id="kobo.56.5" xmlns="http://www.w3.org/1999/xhtml">Using a TOML file with a simple array of values limits the application to the amount of data that can fit into memory.</span></p>
<p><span class="koboSpan" id="kobo.57.1" xmlns="http://www.w3.org/1999/xhtml">The pickle format can be used with the </span><strong><span class="koboSpan" id="kobo.58.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.59.1" xmlns="http://www.w3.org/1999/xhtml">package. </span><span class="koboSpan" id="kobo.59.2" xmlns="http://www.w3.org/1999/xhtml">This format has the advantage of preserving all of the Python-type information and is also very compact. </span><span class="koboSpan" id="kobo.59.3" xmlns="http://www.w3.org/1999/xhtml">Unlike JSON, CSV, or TOML, it’s not human-friendly and can be difficult to read. </span><span class="koboSpan" id="kobo.59.4" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.60.1" xmlns="http://www.w3.org/1999/xhtml">shelve</span></code><span class="koboSpan" id="kobo.61.1" xmlns="http://www.w3.org/1999/xhtml"> module permits the building of a handy database file with multiple pickled objects that can be saved and reused. </span><span class="koboSpan" id="kobo.61.2" xmlns="http://www.w3.org/1999/xhtml">While it’s technically possible to execute arbitrary code when reading a pickle file, the pipeline of acquisition and cleansing applications does not involve any unknown agencies providing data of unknown provenance.</span></p>
<p><span class="koboSpan" id="kobo.62.1" xmlns="http://www.w3.org/1999/xhtml">A SQL database is also supported by the </span><strong><span class="koboSpan" id="kobo.63.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.64.1" xmlns="http://www.w3.org/1999/xhtml">package by using an ORM model. </span><span class="koboSpan" id="kobo.64.2" xmlns="http://www.w3.org/1999/xhtml">This means defining two models in parallel. </span><span class="koboSpan" id="kobo.64.3" xmlns="http://www.w3.org/1999/xhtml">One model is for the ORM layer (for example, SQLAlchemy) to create </span><span id="dx1-265007"/><span class="koboSpan" id="kobo.65.1" xmlns="http://www.w3.org/1999/xhtml">table definitions. </span><span class="koboSpan" id="kobo.65.2" xmlns="http://www.w3.org/1999/xhtml">The other model, a subclass of </span><code><span class="koboSpan" id="kobo.66.1" xmlns="http://www.w3.org/1999/xhtml">pydantic.BaseModel</span></code><span class="koboSpan" id="kobo.67.1" xmlns="http://www.w3.org/1999/xhtml">, uses native </span><strong><span class="koboSpan" id="kobo.68.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.69.1" xmlns="http://www.w3.org/1999/xhtml">features. </span><span class="koboSpan" id="kobo.69.2" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.70.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.71.1" xmlns="http://www.w3.org/1999/xhtml">class will </span><span id="dx1-265008"/><span class="koboSpan" id="kobo.72.1" xmlns="http://www.w3.org/1999/xhtml">have a </span><code><span class="koboSpan" id="kobo.73.1" xmlns="http://www.w3.org/1999/xhtml">from_orm()</span></code><span class="koboSpan" id="kobo.74.1" xmlns="http://www.w3.org/1999/xhtml"> method to create native objects from the ORM layer, performing validation and cleaning.</span></p>
<p><span class="koboSpan" id="kobo.75.1" xmlns="http://www.w3.org/1999/xhtml">The YAML format offers the ability to serialize arbitrary Python objects, a capability that makes it easy to persist native Python objects. </span><span class="koboSpan" id="kobo.75.2" xmlns="http://www.w3.org/1999/xhtml">It also raises security questions. </span><span class="koboSpan" id="kobo.75.3" xmlns="http://www.w3.org/1999/xhtml">If care is taken to avoid working with uploaded YAML files from insecure sources, the ability to serialize arbitrary Python code is less of a potential security problem.</span></p>
<p><span class="koboSpan" id="kobo.76.1" xmlns="http://www.w3.org/1999/xhtml">Of these file formats, the richest set of capabilities seems to be available via JSON. </span><span class="koboSpan" id="kobo.76.2" xmlns="http://www.w3.org/1999/xhtml">Since we’ll often want to record many individual samples in a single file, </span><strong><span class="koboSpan" id="kobo.77.1" xmlns="http://www.w3.org/1999/xhtml">newline-delimited </span></strong><span class="koboSpan" id="kobo.78.1" xmlns="http://www.w3.org/1999/xhtml">(</span><strong><span class="koboSpan" id="kobo.79.1" xmlns="http://www.w3.org/1999/xhtml">ND</span></strong><span class="koboSpan" id="kobo.80.1" xmlns="http://www.w3.org/1999/xhtml">) JSON seems to be ideal.</span></p>
<p><span class="koboSpan" id="kobo.81.1" xmlns="http://www.w3.org/1999/xhtml">In some situations — particularly where spreadsheets will be used for analysis purposes — the CSV format offers some value. </span><span class="koboSpan" id="kobo.81.2" xmlns="http://www.w3.org/1999/xhtml">The idea of moving from a sophisticated Jupyter Notebook to a spreadsheet is not </span><span id="dx1-265009"/><span class="koboSpan" id="kobo.82.1" xmlns="http://www.w3.org/1999/xhtml">something we endorse. </span><span class="koboSpan" id="kobo.82.2" xmlns="http://www.w3.org/1999/xhtml">The lack of automated test capabilities for spreadsheets suggests they are not suitable for automated data processing. </span><span id="x1-265010r287"/></p>
</section>
<section class="level2" data-number="15.2" id="overall-approach">
<h2 data-number="15.2"><span class="titlemark"><span class="koboSpan" id="kobo.83.1" xmlns="http://www.w3.org/1999/xhtml">11.2 </span></span> <span id="x1-2660002"/><span class="koboSpan" id="kobo.84.1" xmlns="http://www.w3.org/1999/xhtml">Overall approach</span></h2>
<p><span class="koboSpan" id="kobo.85.1" xmlns="http://www.w3.org/1999/xhtml">For reference see </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.86.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.87.1" xmlns="http://www.w3.org/1999/xhtml"> 9</span></em></a><span class="koboSpan" id="kobo.88.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch013.xhtml#x1-2080009"><em><span class="koboSpan" id="kobo.89.1" xmlns="http://www.w3.org/1999/xhtml">Project 3.1: Data Cleaning Base Application</span></em></a><span class="koboSpan" id="kobo.90.1" xmlns="http://www.w3.org/1999/xhtml">, specifically </span><a href="ch013.xhtml#x1-2150002"><em><span class="koboSpan" id="kobo.91.1" xmlns="http://www.w3.org/1999/xhtml">Approach</span></em></a><span class="koboSpan" id="kobo.92.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.92.2" xmlns="http://www.w3.org/1999/xhtml">This suggests that the </span><code><span class="koboSpan" id="kobo.93.1" xmlns="http://www.w3.org/1999/xhtml">clean</span></code><span class="koboSpan" id="kobo.94.1" xmlns="http://www.w3.org/1999/xhtml"> module should have minimal </span><span id="dx1-266001"/><span class="koboSpan" id="kobo.95.1" xmlns="http://www.w3.org/1999/xhtml">changes from the earlier version.</span></p>
<p><span class="koboSpan" id="kobo.96.1" xmlns="http://www.w3.org/1999/xhtml">A cleaning application will have several separate views of the data. </span><span class="koboSpan" id="kobo.96.2" xmlns="http://www.w3.org/1999/xhtml">There are at least four viewpoints:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.97.1" xmlns="http://www.w3.org/1999/xhtml">The source data. </span><span class="koboSpan" id="kobo.97.2" xmlns="http://www.w3.org/1999/xhtml">This is the original data as managed by the upstream applications. </span><span class="koboSpan" id="kobo.97.3" xmlns="http://www.w3.org/1999/xhtml">In an enterprise context, this may be a transactional database with business records that are precious and part of day-to-day operations. </span><span class="koboSpan" id="kobo.97.4" xmlns="http://www.w3.org/1999/xhtml">The data model reflects considerations of those day-to-day operations.</span></p></li>
<li><p><span class="koboSpan" id="kobo.98.1" xmlns="http://www.w3.org/1999/xhtml">Data acquisition interim data, usually in a text-centric format. </span><span class="koboSpan" id="kobo.98.2" xmlns="http://www.w3.org/1999/xhtml">We’ve suggested using ND JSON for this because it allows a tidy dictionary-like collection of name-value pairs, and supports quite complex Python data structures. </span><span class="koboSpan" id="kobo.98.3" xmlns="http://www.w3.org/1999/xhtml">In some cases, we may perform some summarization of this raw data to standardize scores. </span><span class="koboSpan" id="kobo.98.4" xmlns="http://www.w3.org/1999/xhtml">This data may be used to diagnose and debug problems with upstream sources. </span><span class="koboSpan" id="kobo.98.5" xmlns="http://www.w3.org/1999/xhtml">It’s also possible that this data only exists in a shared buffer as part of a pipeline between an acquire and a cleaning application.</span></p></li>
<li><p><span class="koboSpan" id="kobo.99.1" xmlns="http://www.w3.org/1999/xhtml">Cleaned analysis data, using native Python data types including </span><code><span class="koboSpan" id="kobo.100.1" xmlns="http://www.w3.org/1999/xhtml">datetime</span></code><span class="koboSpan" id="kobo.101.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.102.1" xmlns="http://www.w3.org/1999/xhtml">timedelta</span></code><span class="koboSpan" id="kobo.103.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.104.1" xmlns="http://www.w3.org/1999/xhtml">int</span></code><span class="koboSpan" id="kobo.105.1" xmlns="http://www.w3.org/1999/xhtml">, </span><code><span class="koboSpan" id="kobo.106.1" xmlns="http://www.w3.org/1999/xhtml">float</span></code><span class="koboSpan" id="kobo.107.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.108.1" xmlns="http://www.w3.org/1999/xhtml">boolean</span></code><span class="koboSpan" id="kobo.109.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.109.2" xmlns="http://www.w3.org/1999/xhtml">These are supplemented with </span><strong><span class="koboSpan" id="kobo.110.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic </span></strong><span class="koboSpan" id="kobo.111.1" xmlns="http://www.w3.org/1999/xhtml">class definitions that act as metadata for proper interpretation of the values. </span><span class="koboSpan" id="kobo.111.2" xmlns="http://www.w3.org/1999/xhtml">These will be used by people to support decision-making. </span><span class="koboSpan" id="kobo.111.3" xmlns="http://www.w3.org/1999/xhtml">They may be used to train AI models used to automate some decision-making.</span></p></li>
<li><p><span class="koboSpan" id="kobo.112.1" xmlns="http://www.w3.org/1999/xhtml">The decision-maker’s understanding of the available information. </span><span class="koboSpan" id="kobo.112.2" xmlns="http://www.w3.org/1999/xhtml">This viewpoint tends to dominate discussions with users when trying to gather, organize, and present data. </span><span class="koboSpan" id="kobo.112.3" xmlns="http://www.w3.org/1999/xhtml">In many cases, the user’s understanding grows and adapts quickly as data is presented, leading to a shifting landscape of needs. </span><span class="koboSpan" id="kobo.112.4" xmlns="http://www.w3.org/1999/xhtml">This requires a great deal of flexibility to provide the right data to the right person at the right time.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.113.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.114.1" xmlns="http://www.w3.org/1999/xhtml">acquire </span></strong><span class="koboSpan" id="kobo.115.1" xmlns="http://www.w3.org/1999/xhtml">application overlaps </span><span id="dx1-266002"/><span class="koboSpan" id="kobo.116.1" xmlns="http://www.w3.org/1999/xhtml">with two of these models: it consumes the source data and produces an interim representation. </span><span class="koboSpan" id="kobo.116.2" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.117.1" xmlns="http://www.w3.org/1999/xhtml">clean </span></strong><span class="koboSpan" id="kobo.118.1" xmlns="http://www.w3.org/1999/xhtml">application also </span><span id="dx1-266003"/><span class="koboSpan" id="kobo.119.1" xmlns="http://www.w3.org/1999/xhtml">overlaps two of these models: it consumes the interim representation and produces the analysis model objects. </span><span class="koboSpan" id="kobo.119.2" xmlns="http://www.w3.org/1999/xhtml">It’s essential to distinguish these models and to use explicit, formal mappings between them.</span></p>
<p><span class="koboSpan" id="kobo.120.1" xmlns="http://www.w3.org/1999/xhtml">This need for a clear separation and obvious mappings is the primary reason why we suggest including a “builder” method in a model class. </span><span class="koboSpan" id="kobo.120.2" xmlns="http://www.w3.org/1999/xhtml">Often we’ve called it something like </span><code><span class="koboSpan" id="kobo.121.1" xmlns="http://www.w3.org/1999/xhtml">from_row()</span></code><span class="koboSpan" id="kobo.122.1" xmlns="http://www.w3.org/1999/xhtml"> or </span><code><span class="koboSpan" id="kobo.123.1" xmlns="http://www.w3.org/1999/xhtml">from_dict()</span></code><span class="koboSpan" id="kobo.124.1" xmlns="http://www.w3.org/1999/xhtml"> or something that suggests the model instance is built from some other source of data via explicit assignment of individual attributes.</span></p>
<p><span class="koboSpan" id="kobo.125.1" xmlns="http://www.w3.org/1999/xhtml">Conceptually, each model has a </span><span id="dx1-266004"/><span class="koboSpan" id="kobo.126.1" xmlns="http://www.w3.org/1999/xhtml">pattern similar to the one shown in the following snippet:</span></p>
<p><span class="koboSpan" id="kobo.127.1" xmlns="http://www.w3.org/1999/xhtml">-</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-186">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.128.1" xmlns="http://www.w3.org/1999/xhtml">class Example:
        field_1: SomeElementType
        field_2: AnotherType

        @classmethod
        def from_source(cls, source: SomeRowType) -&gt; "Example":
                return Example(
                        field_1=transform_1(source),
                        field_2=transform_2(source),
                )</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.129.1" xmlns="http://www.w3.org/1999/xhtml">The transformation functions, </span><code><span class="koboSpan" id="kobo.130.1" xmlns="http://www.w3.org/1999/xhtml">transform1()</span></code><span class="koboSpan" id="kobo.131.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.132.1" xmlns="http://www.w3.org/1999/xhtml">transform2()</span></code><span class="koboSpan" id="kobo.133.1" xmlns="http://www.w3.org/1999/xhtml">, are often implicit when using </span><code><span class="koboSpan" id="kobo.134.1" xmlns="http://www.w3.org/1999/xhtml">pydantic.BaseModel</span></code><span class="koboSpan" id="kobo.135.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.135.2" xmlns="http://www.w3.org/1999/xhtml">This is a helpful simplification of this design pattern. </span><span class="koboSpan" id="kobo.135.3" xmlns="http://www.w3.org/1999/xhtml">The essential idea, however, doesn’t change, since we’re often rearranging, combining, and splitting source fields to create useful data.</span></p>
<p><span class="koboSpan" id="kobo.136.1" xmlns="http://www.w3.org/1999/xhtml">When the final output format is either CSV or JSON, there are two helpful methods of </span><code><span class="koboSpan" id="kobo.137.1" xmlns="http://www.w3.org/1999/xhtml">pydantic.BaseModel</span></code><span class="koboSpan" id="kobo.138.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.138.2" xmlns="http://www.w3.org/1999/xhtml">These methods are </span><code><span class="koboSpan" id="kobo.139.1" xmlns="http://www.w3.org/1999/xhtml">dict()</span></code><span class="koboSpan" id="kobo.140.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.141.1" xmlns="http://www.w3.org/1999/xhtml">json()</span></code><span class="koboSpan" id="kobo.142.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.142.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.143.1" xmlns="http://www.w3.org/1999/xhtml">dict()</span></code><span class="koboSpan" id="kobo.144.1" xmlns="http://www.w3.org/1999/xhtml"> method creates a native Python dictionary that can be used by a </span><code><span class="koboSpan" id="kobo.145.1" xmlns="http://www.w3.org/1999/xhtml">csv.DictWriter</span></code><span class="koboSpan" id="kobo.146.1" xmlns="http://www.w3.org/1999/xhtml"> instance to write CSV output. </span><span class="koboSpan" id="kobo.146.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.147.1" xmlns="http://www.w3.org/1999/xhtml">json()</span></code><span class="koboSpan" id="kobo.148.1" xmlns="http://www.w3.org/1999/xhtml"> method can be used directly to write data in ND JSON format. </span><span class="koboSpan" id="kobo.148.2" xmlns="http://www.w3.org/1999/xhtml">It’s imperative for ND JSON to make sure the </span><code><span class="koboSpan" id="kobo.149.1" xmlns="http://www.w3.org/1999/xhtml">indent</span></code><span class="koboSpan" id="kobo.150.1" xmlns="http://www.w3.org/1999/xhtml"> value used by the </span><code><span class="koboSpan" id="kobo.151.1" xmlns="http://www.w3.org/1999/xhtml">json.dump()</span></code><span class="koboSpan" id="kobo.152.1" xmlns="http://www.w3.org/1999/xhtml"> function is </span><code><span class="koboSpan" id="kobo.153.1" xmlns="http://www.w3.org/1999/xhtml">None</span></code><span class="koboSpan" id="kobo.154.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.154.2" xmlns="http://www.w3.org/1999/xhtml">Any other value for the </span><code><span class="koboSpan" id="kobo.155.1" xmlns="http://www.w3.org/1999/xhtml">indent</span></code><span class="koboSpan" id="kobo.156.1" xmlns="http://www.w3.org/1999/xhtml"> parameter will create multi-line JSON objects, breaking the ND JSON file format.</span></p>
<p><span class="koboSpan" id="kobo.157.1" xmlns="http://www.w3.org/1999/xhtml">The </span><strong><span class="koboSpan" id="kobo.158.1" xmlns="http://www.w3.org/1999/xhtml">acquire </span></strong><span class="koboSpan" id="kobo.159.1" xmlns="http://www.w3.org/1999/xhtml">application often has to wrestle with the complication of data sources that are unreliable. </span><span class="koboSpan" id="kobo.159.2" xmlns="http://www.w3.org/1999/xhtml">The application should save some history from each attempt to acquire data and acquire only the ”missing” data, avoiding the overhead of rereading perfectly good data. </span><span class="koboSpan" id="kobo.159.3" xmlns="http://www.w3.org/1999/xhtml">This can become complicated if there’s no easy way to make a request for a subset of data.</span></p>
<p><span class="koboSpan" id="kobo.160.1" xmlns="http://www.w3.org/1999/xhtml">When working with APIs, for example, there’s a </span><code><span class="koboSpan" id="kobo.161.1" xmlns="http://www.w3.org/1999/xhtml">Last-Modified</span></code><span class="koboSpan" id="kobo.162.1" xmlns="http://www.w3.org/1999/xhtml"> header that can help identify new data. </span><span class="koboSpan" id="kobo.162.2" xmlns="http://www.w3.org/1999/xhtml">The </span><code><span class="koboSpan" id="kobo.163.1" xmlns="http://www.w3.org/1999/xhtml">If-Modified-Since</span></code><span class="koboSpan" id="kobo.164.1" xmlns="http://www.w3.org/1999/xhtml"> header on a request can avoid reading data that’s unchanged. </span><span class="koboSpan" id="kobo.164.2" xmlns="http://www.w3.org/1999/xhtml">Similarly, the </span><code><span class="koboSpan" id="kobo.165.1" xmlns="http://www.w3.org/1999/xhtml">Range</span></code><span class="koboSpan" id="kobo.166.1" xmlns="http://www.w3.org/1999/xhtml"> header might be supported by an API to permit retrieving parts of a document after a connection is dropped.</span></p>
<p><span class="koboSpan" id="kobo.167.1" xmlns="http://www.w3.org/1999/xhtml">When working with SQL databases, some variants of the </span><code><span class="koboSpan" id="kobo.168.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.169.1" xmlns="http://www.w3.org/1999/xhtml"> statement permit </span><code><span class="koboSpan" id="kobo.170.1" xmlns="http://www.w3.org/1999/xhtml">LIMIT</span></code><span class="koboSpan" id="kobo.171.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.172.1" xmlns="http://www.w3.org/1999/xhtml">OFFSET</span></code><span class="koboSpan" id="kobo.173.1" xmlns="http://www.w3.org/1999/xhtml"> clauses to retrieve data on separate pages. </span><span class="koboSpan" id="kobo.173.2" xmlns="http://www.w3.org/1999/xhtml">Tracking the pages of data can simplify restarting a long-running query.</span></p>
<p><span class="koboSpan" id="kobo.174.1" xmlns="http://www.w3.org/1999/xhtml">Similarly, the </span><strong><span class="koboSpan" id="kobo.175.1" xmlns="http://www.w3.org/1999/xhtml">clean </span></strong><span class="koboSpan" id="kobo.176.1" xmlns="http://www.w3.org/1999/xhtml">application needs to avoid re-processing data in the unlikely event that it doesn’t finish and </span><span id="dx1-266015"/><span class="koboSpan" id="kobo.177.1" xmlns="http://www.w3.org/1999/xhtml">needs to be restarted. </span><span class="koboSpan" id="kobo.177.2" xmlns="http://www.w3.org/1999/xhtml">For very large datasets, this might mean scanning the previous, incomplete output to determine where to begin cleaning raw data to avoid re-processing rows.</span></p>
<p><span class="koboSpan" id="kobo.178.1" xmlns="http://www.w3.org/1999/xhtml">We can think of these operations as being “idempotent” in the cases when they have run completely and correctly. </span><span class="koboSpan" id="kobo.178.2" xmlns="http://www.w3.org/1999/xhtml">We want to be able to run (and re-run) the </span><strong><span class="koboSpan" id="kobo.179.1" xmlns="http://www.w3.org/1999/xhtml">acquire </span></strong><span class="koboSpan" id="kobo.180.1" xmlns="http://www.w3.org/1999/xhtml">application without damaging intermediate result files. </span><span class="koboSpan" id="kobo.180.2" xmlns="http://www.w3.org/1999/xhtml">We also want an additional feature of adding to the file until it’s correct and complete. </span><span class="koboSpan" id="kobo.180.3" xmlns="http://www.w3.org/1999/xhtml">(This isn’t precisely the definition of “idempotent”; we should limit the term to illustrate that correct and complete files are not damaged by re-running an application.) Similarly, the </span><strong><span class="koboSpan" id="kobo.181.1" xmlns="http://www.w3.org/1999/xhtml">clean </span></strong><span class="koboSpan" id="kobo.182.1" xmlns="http://www.w3.org/1999/xhtml">application should be designed so it can be run — and re-run — until all problems are resolved without overwriting or reprocessing useful results. </span><span id="x1-266016r283"/></p>
<section class="level3" data-number="15.2.1" id="designing-idempotent-operations">
<h3 data-number="15.2.1"><span class="titlemark"><span class="koboSpan" id="kobo.183.1" xmlns="http://www.w3.org/1999/xhtml">11.2.1 </span></span> <span id="x1-2670001"/><span class="koboSpan" id="kobo.184.1" xmlns="http://www.w3.org/1999/xhtml">Designing idempotent operations</span></h3>
<p><span class="koboSpan" id="kobo.185.1" xmlns="http://www.w3.org/1999/xhtml">Ideally, our </span><span id="dx1-267001"/><span class="koboSpan" id="kobo.186.1" xmlns="http://www.w3.org/1999/xhtml">applications present a UX that can be </span><span id="dx1-267002"/><span class="koboSpan" id="kobo.187.1" xmlns="http://www.w3.org/1999/xhtml">summarized as ”pick up where they left off.” </span><span class="koboSpan" id="kobo.187.2" xmlns="http://www.w3.org/1999/xhtml">The application will check for output files, and avoid destroying previously acquired or cleaned data.</span></p>
<p><span class="koboSpan" id="kobo.188.1" xmlns="http://www.w3.org/1999/xhtml">For many of the carefully curated Kaggle data sets, there will be no change to the source data. </span><span class="koboSpan" id="kobo.188.2" xmlns="http://www.w3.org/1999/xhtml">A time-consuming download can be avoided by examining metadata via the Kaggle API to decide if a file previously downloaded is complete and still valid.</span></p>
<p><span class="koboSpan" id="kobo.189.1" xmlns="http://www.w3.org/1999/xhtml">For enterprise data, in a constant state of flux, the processing must have an explicit ”as-of date” or ”operational date” provided as a run-time parameter. </span><span class="koboSpan" id="kobo.189.2" xmlns="http://www.w3.org/1999/xhtml">A common way to make this date (or date-and-time) evident is to make it part of a file’s metadata. </span><span class="koboSpan" id="kobo.189.3" xmlns="http://www.w3.org/1999/xhtml">The most visible location is the file’s name. </span><span class="koboSpan" id="kobo.189.4" xmlns="http://www.w3.org/1999/xhtml">We might have a file named </span><code><span class="koboSpan" id="kobo.190.1" xmlns="http://www.w3.org/1999/xhtml">2023-12-31-manufacturing-orders.ndj</span></code><span class="koboSpan" id="kobo.191.1" xmlns="http://www.w3.org/1999/xhtml">, where the as-of date is clearly part of the file name.</span></p>
<p><span class="koboSpan" id="kobo.192.1" xmlns="http://www.w3.org/1999/xhtml">Idempotency requires programs in the data acquisition and cleaning pipeline to check for existing output files and avoid overwriting them unless an explicit command-line option permits overwriting. </span><span class="koboSpan" id="kobo.192.2" xmlns="http://www.w3.org/1999/xhtml">It also requires an application to read through the output file to find out how many rows it contains. </span><span class="koboSpan" id="kobo.192.3" xmlns="http://www.w3.org/1999/xhtml">This number of existing rows can be used to tailor the processing to avoid re-processing existing rows.</span></p>
<p><span class="koboSpan" id="kobo.193.1" xmlns="http://www.w3.org/1999/xhtml">Consider an application that reads from a database to acquire raw data. </span><span class="koboSpan" id="kobo.193.2" xmlns="http://www.w3.org/1999/xhtml">The ”as-of-date” is 2022-01-18, for example. </span><span class="koboSpan" id="kobo.193.3" xmlns="http://www.w3.org/1999/xhtml">When the application runs and something goes wrong in the network, the database connection could be lost after processing a subset of rows. </span><span class="koboSpan" id="kobo.193.4" xmlns="http://www.w3.org/1999/xhtml">We’ll imagine the output file has 42 rows written before the network failure caused the application to crash.</span></p>
<p><span class="koboSpan" id="kobo.194.1" xmlns="http://www.w3.org/1999/xhtml">When the log is checked and it’s clear the application failed, it can be re-run. </span><span class="koboSpan" id="kobo.194.2" xmlns="http://www.w3.org/1999/xhtml">The program can check the output directory and find the file with 42 rows, meaning the application is being run in recovery mode. </span><span class="koboSpan" id="kobo.194.3" xmlns="http://www.w3.org/1999/xhtml">There should be two important changes to behavior:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.195.1" xmlns="http://www.w3.org/1999/xhtml">Add a </span><code><span class="koboSpan" id="kobo.196.1" xmlns="http://www.w3.org/1999/xhtml">LIMIT</span></code><code><span class="koboSpan" id="kobo.197.1" xmlns="http://www.w3.org/1999/xhtml"> -1</span></code><code><span class="koboSpan" id="kobo.198.1" xmlns="http://www.w3.org/1999/xhtml"> OFFSET</span></code><code><span class="koboSpan" id="kobo.199.1" xmlns="http://www.w3.org/1999/xhtml"> 42</span></code><span class="koboSpan" id="kobo.200.1" xmlns="http://www.w3.org/1999/xhtml"> clause to the </span><code><span class="koboSpan" id="kobo.201.1" xmlns="http://www.w3.org/1999/xhtml">SELECT</span></code><span class="koboSpan" id="kobo.202.1" xmlns="http://www.w3.org/1999/xhtml"> statement to skip the 42 rows already retrieved. </span><span class="koboSpan" id="kobo.202.2" xmlns="http://www.w3.org/1999/xhtml">(For many databases, </span><code><span class="koboSpan" id="kobo.203.1" xmlns="http://www.w3.org/1999/xhtml">LIMIT</span></code><code><span class="koboSpan" id="kobo.204.1" xmlns="http://www.w3.org/1999/xhtml"> -1</span></code><code><span class="koboSpan" id="kobo.205.1" xmlns="http://www.w3.org/1999/xhtml"> OFFSET</span></code><code><span class="koboSpan" id="kobo.206.1" xmlns="http://www.w3.org/1999/xhtml"> 0</span></code><span class="koboSpan" id="kobo.207.1" xmlns="http://www.w3.org/1999/xhtml"> will retrieve all rows; this can be used as a default value.)</span></p></li>
<li><p><span class="koboSpan" id="kobo.208.1" xmlns="http://www.w3.org/1999/xhtml">Open the output file in ”append” mode to add new records to the end of the existing file.</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.209.1" xmlns="http://www.w3.org/1999/xhtml">These two changes permit the application to be restarted as many times as required to query all of the required data.</span></p>
<p><span class="koboSpan" id="kobo.210.1" xmlns="http://www.w3.org/1999/xhtml">For other data sources, there may not be a simple ”limit-offset” parameter in the query. </span><span class="koboSpan" id="kobo.210.2" xmlns="http://www.w3.org/1999/xhtml">This may lead to an application that reads and ignores some number of records before processing the remaining records. </span><span class="koboSpan" id="kobo.210.3" xmlns="http://www.w3.org/1999/xhtml">When the output file doesn’t exist, the offset before processing has a value of zero.</span></p>
<p><span class="koboSpan" id="kobo.211.1" xmlns="http://www.w3.org/1999/xhtml">It’s important to handle date-time ranges correctly.</span></p>
<div class="tcolorbox tipbox" id="tcolobox-187">
<div class="tcolorbox-content">
<p><span class="koboSpan" id="kobo.212.1" xmlns="http://www.w3.org/1999/xhtml">It’s imperative to make sure date and date-time ranges are properly </span><strong><span class="koboSpan" id="kobo.213.1" xmlns="http://www.w3.org/1999/xhtml">half-open intervals</span></strong><span class="koboSpan" id="kobo.214.1" xmlns="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.214.2" xmlns="http://www.w3.org/1999/xhtml">The starting date and time are included. </span><span class="koboSpan" id="kobo.214.3" xmlns="http://www.w3.org/1999/xhtml">The ending date and time are excluded.</span></p>
<p><span class="koboSpan" id="kobo.215.1" xmlns="http://www.w3.org/1999/xhtml">Consider a weekly extract of data.</span></p>
<p><span class="koboSpan" id="kobo.216.1" xmlns="http://www.w3.org/1999/xhtml">One range is 2023-01-14 to 2023-01-21. </span><span class="koboSpan" id="kobo.216.2" xmlns="http://www.w3.org/1999/xhtml">The 14th is included. </span><span class="koboSpan" id="kobo.216.3" xmlns="http://www.w3.org/1999/xhtml">The 21st is not included. </span><span class="koboSpan" id="kobo.216.4" xmlns="http://www.w3.org/1999/xhtml">The next week, the range is 2023-01-21 to 2023-01-28. </span><span class="koboSpan" id="kobo.216.5" xmlns="http://www.w3.org/1999/xhtml">The 21st is included in this extract.</span></p>
<p><span class="koboSpan" id="kobo.217.1" xmlns="http://www.w3.org/1999/xhtml">Using half-open intervals makes it easier to be sure no date is accidentally omitted or duplicated.</span></p>
</div>
</div>
<p><span class="koboSpan" id="kobo.218.1" xmlns="http://www.w3.org/1999/xhtml">Now that we’ve </span><span id="dx1-267003"/><span class="koboSpan" id="kobo.219.1" xmlns="http://www.w3.org/1999/xhtml">considered the approach to </span><span id="dx1-267004"/><span class="koboSpan" id="kobo.220.1" xmlns="http://www.w3.org/1999/xhtml">writing the interim data, we can look at the deliverables for this project. </span><span id="x1-267005r289"/></p>
</section>
</section>
<section class="level2" data-number="15.3" id="deliverables-17">
<h2 data-number="15.3"><span class="titlemark"><span class="koboSpan" id="kobo.221.1" xmlns="http://www.w3.org/1999/xhtml">11.3 </span></span> <span id="x1-2680003"/><span class="koboSpan" id="kobo.222.1" xmlns="http://www.w3.org/1999/xhtml">Deliverables</span></h2>
<p><span class="koboSpan" id="kobo.223.1" xmlns="http://www.w3.org/1999/xhtml">The refactoring of existing </span><span id="dx1-268001"/><span class="koboSpan" id="kobo.224.1" xmlns="http://www.w3.org/1999/xhtml">applications to formalize the interim file formats leads to changes in existing projects. </span><span class="koboSpan" id="kobo.224.2" xmlns="http://www.w3.org/1999/xhtml">These changes will ripple through to unit test changes. </span><span class="koboSpan" id="kobo.224.3" xmlns="http://www.w3.org/1999/xhtml">There should not be any acceptance test changes when refactoring the data model modules.</span></p>
<p><span class="koboSpan" id="kobo.225.1" xmlns="http://www.w3.org/1999/xhtml">Adding a ”pick up where you left off” feature, on the other hand, will lead to changes in the application behavior. </span><span class="koboSpan" id="kobo.225.2" xmlns="http://www.w3.org/1999/xhtml">This will be reflected in the acceptance test suite, as well as unit tests.</span></p>
<p><span class="koboSpan" id="kobo.226.1" xmlns="http://www.w3.org/1999/xhtml">The deliverables </span><span id="dx1-268002"/><span class="koboSpan" id="kobo.227.1" xmlns="http://www.w3.org/1999/xhtml">depend on which projects you’ve completed, and which modules need revision. </span><span class="koboSpan" id="kobo.227.2" xmlns="http://www.w3.org/1999/xhtml">We’ll look at some of the considerations for these deliverables. </span><span id="x1-268003r290"/></p>
<section class="level3" data-number="15.3.1" id="unit-test">
<h3 data-number="15.3.1"><span class="titlemark"><span class="koboSpan" id="kobo.228.1" xmlns="http://www.w3.org/1999/xhtml">11.3.1 </span></span> <span id="x1-2690001"/><span class="koboSpan" id="kobo.229.1" xmlns="http://www.w3.org/1999/xhtml">Unit test</span></h3>
<p><span class="koboSpan" id="kobo.230.1" xmlns="http://www.w3.org/1999/xhtml">A function that creates an </span><span id="dx1-269001"/><span class="koboSpan" id="kobo.231.1" xmlns="http://www.w3.org/1999/xhtml">output file will need to have test cases with two distinct fixtures. </span><span class="koboSpan" id="kobo.231.2" xmlns="http://www.w3.org/1999/xhtml">One fixture will have a version of the output file, and the other fixture will have no output file. </span><span class="koboSpan" id="kobo.231.3" xmlns="http://www.w3.org/1999/xhtml">These fixtures can be built on top of the </span><code><span class="koboSpan" id="kobo.232.1" xmlns="http://www.w3.org/1999/xhtml">pytest.tmp_path</span></code><span class="koboSpan" id="kobo.233.1" xmlns="http://www.w3.org/1999/xhtml"> fixture. </span><span class="koboSpan" id="kobo.233.2" xmlns="http://www.w3.org/1999/xhtml">This fixture provides a unique temporary directory that can be populated with files needed to confirm that existing files are appended to instead of overwritten.</span></p>
<p><span class="koboSpan" id="kobo.234.1" xmlns="http://www.w3.org/1999/xhtml">Some test cases will need to confirm that existing files were properly extended. </span><span class="koboSpan" id="kobo.234.2" xmlns="http://www.w3.org/1999/xhtml">Other test cases will confirm that the file is properly created when it didn’t exist. </span><span class="koboSpan" id="kobo.234.3" xmlns="http://www.w3.org/1999/xhtml">An edge case is the presence of a file of length zero — it was created, but no data was written. </span><span class="koboSpan" id="kobo.234.4" xmlns="http://www.w3.org/1999/xhtml">This can be challenging when there is no previous data to read to discover the previous state.</span></p>
<p><span class="koboSpan" id="kobo.235.1" xmlns="http://www.w3.org/1999/xhtml">Another edge case is the presence of a damaged, incomplete row of data at the end of the file. </span><span class="koboSpan" id="kobo.235.2" xmlns="http://www.w3.org/1999/xhtml">This requires some clever use of the </span><code><span class="koboSpan" id="kobo.236.1" xmlns="http://www.w3.org/1999/xhtml">seek()</span></code><span class="koboSpan" id="kobo.237.1" xmlns="http://www.w3.org/1999/xhtml"> and </span><code><span class="koboSpan" id="kobo.238.1" xmlns="http://www.w3.org/1999/xhtml">tell()</span></code><span class="koboSpan" id="kobo.239.1" xmlns="http://www.w3.org/1999/xhtml"> methods of an open file to selectively overwrite the incomplete final record of the file. </span><span class="koboSpan" id="kobo.239.2" xmlns="http://www.w3.org/1999/xhtml">One approach is to use the </span><code><span class="koboSpan" id="kobo.240.1" xmlns="http://www.w3.org/1999/xhtml">tell()</span></code><span class="koboSpan" id="kobo.241.1" xmlns="http://www.w3.org/1999/xhtml"> method before reading each sample. </span><span class="koboSpan" id="kobo.241.2" xmlns="http://www.w3.org/1999/xhtml">If an exception is raised by the file’s parser, seek to the last reported </span><code><span class="koboSpan" id="kobo.242.1" xmlns="http://www.w3.org/1999/xhtml">tell()</span></code><span class="koboSpan" id="kobo.243.1" xmlns="http://www.w3.org/1999/xhtml"> position, and start writing there. </span><span id="x1-269002r292"/></p>
</section>
<section class="level3" data-number="15.3.2" id="acceptance-test-2">
<h3 data-number="15.3.2"><span class="titlemark"><span class="koboSpan" id="kobo.244.1" xmlns="http://www.w3.org/1999/xhtml">11.3.2 </span></span> <span id="x1-2700002"/><span class="koboSpan" id="kobo.245.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance test</span></h3>
<p><span class="koboSpan" id="kobo.246.1" xmlns="http://www.w3.org/1999/xhtml">The acceptance test </span><span id="dx1-270001"/><span class="koboSpan" id="kobo.247.1" xmlns="http://www.w3.org/1999/xhtml">scenarios will require an unreliable source of data. </span><span class="koboSpan" id="kobo.247.2" xmlns="http://www.w3.org/1999/xhtml">Looking back at </span><a href="ch008.xhtml#x1-780004"><em><span class="koboSpan" id="kobo.248.1" xmlns="http://www.w3.org/1999/xhtml">Chapter</span></em><em><span class="koboSpan" id="kobo.249.1" xmlns="http://www.w3.org/1999/xhtml"> 4</span></em></a><span class="koboSpan" id="kobo.250.1" xmlns="http://www.w3.org/1999/xhtml">, </span><a href="ch008.xhtml#x1-780004"><em><span class="koboSpan" id="kobo.251.1" xmlns="http://www.w3.org/1999/xhtml">Data Acquisition Features: Web APIs and Scraping</span></em></a><span class="koboSpan" id="kobo.252.1" xmlns="http://www.w3.org/1999/xhtml">, specifically </span><a href="ch008.xhtml#x1-910003"><em><span class="koboSpan" id="kobo.253.1" xmlns="http://www.w3.org/1999/xhtml">Acceptance tests</span></em></a><span class="koboSpan" id="kobo.254.1" xmlns="http://www.w3.org/1999/xhtml">, we can see the acceptance test suite involves using the </span><code><span class="koboSpan" id="kobo.255.1" xmlns="http://www.w3.org/1999/xhtml">bottle</span></code><span class="koboSpan" id="kobo.256.1" xmlns="http://www.w3.org/1999/xhtml"> project to create a very small web service.</span></p>
<p><span class="koboSpan" id="kobo.257.1" xmlns="http://www.w3.org/1999/xhtml">There are two aspects to the scenarios, each with different outcomes. </span><span class="koboSpan" id="kobo.257.2" xmlns="http://www.w3.org/1999/xhtml">The two aspects are:</span></p>
<ol>
<li><div id="x1-270003x1">
<p><span class="koboSpan" id="kobo.258.1" xmlns="http://www.w3.org/1999/xhtml">The service or database provides all results or it fails to provide a complete set of results.</span></p>
</div></li>
<li><div id="x1-270005x2">
<p><span class="koboSpan" id="kobo.259.1" xmlns="http://www.w3.org/1999/xhtml">The working files are not present — we could call this the “clean start” mode — or partial files exist and the application is working in recovery mode.</span></p>
</div></li>
</ol>
<p><span class="koboSpan" id="kobo.260.1" xmlns="http://www.w3.org/1999/xhtml">Since each aspect has two alternatives, there are four combinations of scenarios for this feature:</span></p>
<ol>
<li><div id="x1-270007x1">
<p><span class="koboSpan" id="kobo.261.1" xmlns="http://www.w3.org/1999/xhtml">The existing scenario is where the working directory is empty and the API or database works correctly. </span><span class="koboSpan" id="kobo.261.2" xmlns="http://www.w3.org/1999/xhtml">All rows are properly saved.</span></p>
</div></li>
<li><div id="x1-270009x2">
<p><span class="koboSpan" id="kobo.262.1" xmlns="http://www.w3.org/1999/xhtml">A new scenario where the working directory is empty and the service or database returns a partial result. </span><span class="koboSpan" id="kobo.262.2" xmlns="http://www.w3.org/1999/xhtml">The returned rows are saved, but the results are marked as incomplete, perhaps with an error entry in the log.</span></p>
</div></li>
<li><div id="x1-270011x3">
<p><span class="koboSpan" id="kobo.263.1" xmlns="http://www.w3.org/1999/xhtml">A new scenario where the given working directory has partial results and the API or database works correctly. </span><span class="koboSpan" id="kobo.263.2" xmlns="http://www.w3.org/1999/xhtml">The new rows are appended to existing rows, leading to a complete result.</span></p>
</div></li>
<li><div id="x1-270013x4">
<p><span class="koboSpan" id="kobo.264.1" xmlns="http://www.w3.org/1999/xhtml">A new scenario where the given working directory has partial results and the service or database returns a partial result. </span><span class="koboSpan" id="kobo.264.2" xmlns="http://www.w3.org/1999/xhtml">The cumulative collection of rows are usable, but the results are still marked as incomplete.</span></p>
</div></li>
</ol>
<p><span class="koboSpan" id="kobo.265.1" xmlns="http://www.w3.org/1999/xhtml">A version of the mock RESTful process can return some rows and even after that return 502 status codes. </span><span class="koboSpan" id="kobo.265.2" xmlns="http://www.w3.org/1999/xhtml">The database version of the incomplete results scenarios is challenging because SQLite is quite difficult to crash at run-time. </span><span class="koboSpan" id="kobo.265.3" xmlns="http://www.w3.org/1999/xhtml">Rather than try to create a version of SQLite that </span><span id="dx1-270014"/><span class="koboSpan" id="kobo.266.1" xmlns="http://www.w3.org/1999/xhtml">times out or crashes, it’s better to rely on unit testing with a mock database to be sure crashes are handled properly. </span><span class="koboSpan" id="kobo.266.2" xmlns="http://www.w3.org/1999/xhtml">The four acceptance test scenarios will demonstrate that working files are extended without being overwritten. </span><span id="x1-270015r293"/></p>
</section>
<section class="level3" data-number="15.3.3" id="cleaned-up-re-runnable-application-design">
<h3 data-number="15.3.3"><span class="titlemark"><span class="koboSpan" id="kobo.267.1" xmlns="http://www.w3.org/1999/xhtml">11.3.3 </span></span> <span id="x1-2710003"/><span class="koboSpan" id="kobo.268.1" xmlns="http://www.w3.org/1999/xhtml">Cleaned up re-runnable application design</span></h3>
<p><span class="koboSpan" id="kobo.269.1" xmlns="http://www.w3.org/1999/xhtml">The final </span><span id="dx1-271001"/><span class="koboSpan" id="kobo.270.1" xmlns="http://www.w3.org/1999/xhtml">application with the ”pick-up-where-you-left-off” feature can be very handy for creating robust, reliable analytic tools. </span><span class="koboSpan" id="kobo.270.2" xmlns="http://www.w3.org/1999/xhtml">The question of ”what do we do to recover?” </span><span class="koboSpan" id="kobo.270.3" xmlns="http://www.w3.org/1999/xhtml">should involve little (or no) thought.</span></p>
<p><span class="koboSpan" id="kobo.271.1" xmlns="http://www.w3.org/1999/xhtml">Creating “idempotent” applications, in general, permits rugged and reliable processing. </span><span class="koboSpan" id="kobo.271.2" xmlns="http://www.w3.org/1999/xhtml">When an application doesn’t work, the root cause must be found and fixed, and the application can be run again to finish the otherwise unfinished work from the failed attempt. </span><span class="koboSpan" id="kobo.271.3" xmlns="http://www.w3.org/1999/xhtml">This lets </span><span id="dx1-271002"/><span class="koboSpan" id="kobo.272.1" xmlns="http://www.w3.org/1999/xhtml">analysts focus on what went wrong — and fixing that — instead of having to figure out how to finish the processing. </span><span id="x1-271003r291"/></p>
</section>
</section>
<section class="level2" data-number="15.4" id="summary-10">
<h2 data-number="15.4"><span class="titlemark"><span class="koboSpan" id="kobo.273.1" xmlns="http://www.w3.org/1999/xhtml">11.4 </span></span> <span id="x1-2720004"/><span class="koboSpan" id="kobo.274.1" xmlns="http://www.w3.org/1999/xhtml">Summary</span></h2>
<p><span class="koboSpan" id="kobo.275.1" xmlns="http://www.w3.org/1999/xhtml">In this chapter, we looked at two important parts of the data acquisition pipeline:</span></p>
<ul>
<li><p><span class="koboSpan" id="kobo.276.1" xmlns="http://www.w3.org/1999/xhtml">File formats and data persistence</span></p></li>
<li><p><span class="koboSpan" id="kobo.277.1" xmlns="http://www.w3.org/1999/xhtml">The architecture of applications</span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.278.1" xmlns="http://www.w3.org/1999/xhtml">There are many file formats available for Python data. </span><span class="koboSpan" id="kobo.278.2" xmlns="http://www.w3.org/1999/xhtml">It seems like newline delimited (ND) JSON is, perhaps, the best way to handle large files of complex records. </span><span class="koboSpan" id="kobo.278.3" xmlns="http://www.w3.org/1999/xhtml">It fits well with Pydantic’s capabilities, and the data can be processed readily by Jupyter Notebook applications.</span></p>
<p><span class="koboSpan" id="kobo.279.1" xmlns="http://www.w3.org/1999/xhtml">The capability to retry a failed operation without losing existing data can be helpful when working with large data extractions and slow processing. </span><span class="koboSpan" id="kobo.279.2" xmlns="http://www.w3.org/1999/xhtml">It can be very helpful to be able to re-run the data acquisition without having to wait while previously processed data is processed again. </span><span id="x1-272001r295"/></p>
</section>
<section class="level2" data-number="15.5" id="extras-9">
<h2 data-number="15.5"><span class="titlemark"><span class="koboSpan" id="kobo.280.1" xmlns="http://www.w3.org/1999/xhtml">11.5 </span></span> <span id="x1-2730005"/><span class="koboSpan" id="kobo.281.1" xmlns="http://www.w3.org/1999/xhtml">Extras</span></h2>
<p><span class="koboSpan" id="kobo.282.1" xmlns="http://www.w3.org/1999/xhtml">Here are some ideas for you to add to these projects. </span><span id="x1-273001r294"/></p>
<section class="level3" data-number="15.5.1" id="using-a-sql-database">
<h3 data-number="15.5.1"><span class="titlemark"><span class="koboSpan" id="kobo.283.1" xmlns="http://www.w3.org/1999/xhtml">11.5.1 </span></span> <span id="x1-2740001"/><span class="koboSpan" id="kobo.284.1" xmlns="http://www.w3.org/1999/xhtml">Using a SQL database</span></h3>
<p><span class="koboSpan" id="kobo.285.1" xmlns="http://www.w3.org/1999/xhtml">Using a SQL database for cleaned analytical data can be part of a comprehensive database-centric data warehouse. </span><span class="koboSpan" id="kobo.285.2" xmlns="http://www.w3.org/1999/xhtml">The implementation, when based on </span><strong><span class="koboSpan" id="kobo.286.1" xmlns="http://www.w3.org/1999/xhtml">Pydantic</span></strong><span class="koboSpan" id="kobo.287.1" xmlns="http://www.w3.org/1999/xhtml">, requires the native Python classes as well as the ORM classes that map to the database.</span></p>
<p><span class="koboSpan" id="kobo.288.1" xmlns="http://www.w3.org/1999/xhtml">It also requires some care in handling repeated queries for enterprise data. </span><span class="koboSpan" id="kobo.288.2" xmlns="http://www.w3.org/1999/xhtml">In the ordinary file system, file names can have processing dates. </span><span class="koboSpan" id="kobo.288.3" xmlns="http://www.w3.org/1999/xhtml">In the database, this is more commonly assigned to an attribute of the data. </span><span class="koboSpan" id="kobo.288.4" xmlns="http://www.w3.org/1999/xhtml">This means multiple time periods of data occupy a single table, distinguished by the ”as-of” date for the rows.</span></p>
<p><span class="koboSpan" id="kobo.289.1" xmlns="http://www.w3.org/1999/xhtml">A common database optimization is to provide a “time dimension” table. </span><span class="koboSpan" id="kobo.289.2" xmlns="http://www.w3.org/1999/xhtml">For each date, the associated date of the week, fiscal weeks, month, quarter, and year is provided as an attribute. </span><span class="koboSpan" id="kobo.289.3" xmlns="http://www.w3.org/1999/xhtml">Using this table saves computing any attributes of a date. </span><span class="koboSpan" id="kobo.289.4" xmlns="http://www.w3.org/1999/xhtml">It also allows the enterprise fiscal calendar to be used to make sure that 13-week quarters are used properly, instead of the fairly arbitrary calendar month boundaries.</span></p>
<p><span class="koboSpan" id="kobo.290.1" xmlns="http://www.w3.org/1999/xhtml">This kind of additional processing isn’t required but must be considered when thinking about using a relational database for analysis data.</span></p>
<p><span class="koboSpan" id="kobo.291.1" xmlns="http://www.w3.org/1999/xhtml">This extra project can use SQLAlchemy to define an ORM layer for a SQLite database. </span><span class="koboSpan" id="kobo.291.2" xmlns="http://www.w3.org/1999/xhtml">The ORM layer can be used to create tables and write rows of analysis data to those tables. </span><span class="koboSpan" id="kobo.291.3" xmlns="http://www.w3.org/1999/xhtml">This permits using SQL queries to examine the analysis data, and possibly use complex </span><code><span class="koboSpan" id="kobo.292.1" xmlns="http://www.w3.org/1999/xhtml">SELECT-GROUP</span></code><code><span class="koboSpan" id="kobo.293.1" xmlns="http://www.w3.org/1999/xhtml"> BY</span></code><span class="koboSpan" id="kobo.294.1" xmlns="http://www.w3.org/1999/xhtml"> queries to perform some analytic processing. </span><span id="x1-274001r297"/></p>
</section>
<section class="level3" data-number="15.5.2" id="persistence-with-nosql-databases">
<h3 data-number="15.5.2"><span class="titlemark"><span class="koboSpan" id="kobo.295.1" xmlns="http://www.w3.org/1999/xhtml">11.5.2 </span></span> <span id="x1-2750002"/><span class="koboSpan" id="kobo.296.1" xmlns="http://www.w3.org/1999/xhtml">Persistence with NoSQL databases</span></h3>
<p><span class="koboSpan" id="kobo.297.1" xmlns="http://www.w3.org/1999/xhtml">There are many NoSQL databases available. </span><span class="koboSpan" id="kobo.297.2" xmlns="http://www.w3.org/1999/xhtml">A number of products like MongoDB use a JSON-based document store. </span><span class="koboSpan" id="kobo.297.3" xmlns="http://www.w3.org/1999/xhtml">Database engines like PostgreSQL and SQLite3 have the capability of storing JSON text in a column of a database table. </span><span class="koboSpan" id="kobo.297.4" xmlns="http://www.w3.org/1999/xhtml">We’ll narrow our focus onto JSON-based databases as a way to avoid looking at the vast number of databases available.</span></p>
<p><span class="koboSpan" id="kobo.298.1" xmlns="http://www.w3.org/1999/xhtml">We can use SQLite3 BLOB columns to store JSON text, creating a NoSQL database using the SQLite3 storage engine.</span></p>
<p><span class="koboSpan" id="kobo.299.1" xmlns="http://www.w3.org/1999/xhtml">A small table with two columns: </span><code><span class="koboSpan" id="kobo.300.1" xmlns="http://www.w3.org/1999/xhtml">doc_id</span></code><span class="koboSpan" id="kobo.301.1" xmlns="http://www.w3.org/1999/xhtml">, and </span><code><span class="koboSpan" id="kobo.302.1" xmlns="http://www.w3.org/1999/xhtml">doc_text</span></code><span class="koboSpan" id="kobo.303.1" xmlns="http://www.w3.org/1999/xhtml">, can create a NoSQL-like database. </span><span class="koboSpan" id="kobo.303.2" xmlns="http://www.w3.org/1999/xhtml">The SQL definition would look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-188">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.304.1" xmlns="http://www.w3.org/1999/xhtml">CREATE TABLE IF NOT EXISTS document(
        doc_id INTEGER PRIMARY KEY,
        doc_text BLOB
)</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.305.1" xmlns="http://www.w3.org/1999/xhtml">This table will have a primary key column that’s populated automatically with integer values. </span><span class="koboSpan" id="kobo.305.2" xmlns="http://www.w3.org/1999/xhtml">It has a text field that can hold the serialized text of a JSON document.</span></p>
<p><span class="koboSpan" id="kobo.306.1" xmlns="http://www.w3.org/1999/xhtml">The SQLite3 function </span><code><span class="koboSpan" id="kobo.307.1" xmlns="http://www.w3.org/1999/xhtml">json()</span></code><span class="koboSpan" id="kobo.308.1" xmlns="http://www.w3.org/1999/xhtml"> should be used when inserting JSON documents:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-189">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.309.1" xmlns="http://www.w3.org/1999/xhtml">INSERT INTO document(doc_text) VALUES(json(:json_text))</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.310.1" xmlns="http://www.w3.org/1999/xhtml">This will confirm the supplied value of </span><code><span class="koboSpan" id="kobo.311.1" xmlns="http://www.w3.org/1999/xhtml">json_text</span></code><span class="koboSpan" id="kobo.312.1" xmlns="http://www.w3.org/1999/xhtml"> is valid JSON, and will also minimize the storage, removing needless whitespace. </span><span class="koboSpan" id="kobo.312.2" xmlns="http://www.w3.org/1999/xhtml">This statement is generally executed with the parameter </span><code><span class="koboSpan" id="kobo.313.1" xmlns="http://www.w3.org/1999/xhtml">{"json_text":</span></code><code><span class="koboSpan" id="kobo.314.1" xmlns="http://www.w3.org/1999/xhtml"> json.dumps(document)</span></code><span class="koboSpan" id="kobo.315.1" xmlns="http://www.w3.org/1999/xhtml"> to convert a native Python document into JSON text so it can then be persisted into the database.</span></p>
<p><span class="koboSpan" id="kobo.316.1" xmlns="http://www.w3.org/1999/xhtml">The attributes of a JSON object can be interrogated using the SQLite </span><code><span class="koboSpan" id="kobo.317.1" xmlns="http://www.w3.org/1999/xhtml">-&gt;&gt;</span></code><span class="koboSpan" id="kobo.318.1" xmlns="http://www.w3.org/1999/xhtml"> operator to extract a field from a JSON document. </span><span class="koboSpan" id="kobo.318.2" xmlns="http://www.w3.org/1999/xhtml">A query for a document with a named field that has a specific value will look like this:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-190">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.319.1" xmlns="http://www.w3.org/1999/xhtml">SELECT doc_text FROM document WHERE doc_text -&gt;&gt; ’field’ = :value</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.320.1" xmlns="http://www.w3.org/1999/xhtml">In the above SQL, the field’s name, </span><code><span class="koboSpan" id="kobo.321.1" xmlns="http://www.w3.org/1999/xhtml">field</span></code><span class="koboSpan" id="kobo.322.1" xmlns="http://www.w3.org/1999/xhtml">, is fixed as part of the SQL. </span><span class="koboSpan" id="kobo.322.2" xmlns="http://www.w3.org/1999/xhtml">This can be done when the schema is designed to support only a few queries. </span><span class="koboSpan" id="kobo.322.3" xmlns="http://www.w3.org/1999/xhtml">In the more general case, the field name might be provided as a parameter value, leading to a query like the following:</span></p>
<div class="tcolorbox tcolorbox" id="tcolobox-191">
<div class="tcolorbox-content">
<pre class="source-code"><span class="koboSpan" id="kobo.323.1" xmlns="http://www.w3.org/1999/xhtml">SELECT doc_text FROM document WHERE doc_text -&gt;&gt; :name = :value</span></pre>
</div>
</div>
<p><span class="koboSpan" id="kobo.324.1" xmlns="http://www.w3.org/1999/xhtml">This query requires a small dictionary with the keys ”name” and ”value”, which will provide the field name and field value used to locate matching documents.</span></p>
<p><span class="koboSpan" id="kobo.325.1" xmlns="http://www.w3.org/1999/xhtml">This kind of database design lets us write processing that’s similar to some of the capabilities of a document store without the overhead of installing a document store database. </span><span class="koboSpan" id="kobo.325.2" xmlns="http://www.w3.org/1999/xhtml">The JSON documents can be inserted into this document store. </span><span class="koboSpan" id="kobo.325.3" xmlns="http://www.w3.org/1999/xhtml">The query syntax uses a few SQL keywords as overhead, but the bulk of the processing can be JSON-based interrogation of documents to locate the desired subset of available documents.</span></p>
<p><span class="koboSpan" id="kobo.326.1" xmlns="http://www.w3.org/1999/xhtml">The idea here is to use a JSON-based document store instead of a file in ND JSON format. </span><span class="koboSpan" id="kobo.326.2" xmlns="http://www.w3.org/1999/xhtml">The Document Store interface to SQLite3 should be a module that can be reused in a JupyterLab Notebook to acquire and analyze data. </span><span class="koboSpan" id="kobo.326.3" xmlns="http://www.w3.org/1999/xhtml">While unit tests are required for the database interface, there are a few changes to the acceptance test suite required to confirm this changed design. </span><span id="x1-275008r286"/></p>
</section>
</section>
</section>
</body>
</html>
