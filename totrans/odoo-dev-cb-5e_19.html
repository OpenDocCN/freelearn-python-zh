<html><head></head><body>
		<div><h1 id="_idParaDest-819" class="chapter-number"><a id="_idTextAnchor1030"/>19</h1>
			<h1 id="_idParaDest-820"><a id="_idTextAnchor1031"/>Managing, Deploying, and Testing with Odoo.sh</h1>
			<p>In 2017, Odoo released Odoo.sh, a new cloud service. Odoo.sh is a platform that makes the process of testing, deploying, and monitoring Odoo instances as easy as possible. In this chapter, we will look at how Odoo.sh works, when you should use it over other deployment options, and its features.</p>
			<p>In this chapter, we will cover the following recipes:</p>
			<ul>
				<li>Exploring some basic concepts of Odoo.sh</li>
				<li>Creating an Odoo.sh account</li>
				<li>Adding and installing custom modules</li>
				<li>Managing branches</li>
				<li>Accessing debugging options</li>
				<li>Getting a backup of your instance</li>
				<li>Checking the status of your builds</li>
				<li>All Odoo.sh options</li>
			</ul>
			<p class="callout-heading">Important note</p>
			<p class="callout">This chapter is written under the assumption that you have Odoo.sh access. It is a paid service, and you will need a subscription code to access the platform. If you are an Odoo partner, you will get a free Odoo.sh subscription code. Otherwise, you will need to purchase it from <a href="https://www.odoo.sh/pricing">https://www.odoo.sh/pricing</a>. You can still go through this chapter even if you don’t have a subscription code. It contains enough screenshots to help you understand the platform.</p>
			<p class="callout-heading">A note for print readers </p>
			<p class="callout">For the benefit of print readers, there are certain images showing the layout of a window in this chapter that may require zooming to view them clearly. You can access the graphic bundle containing high-quality images at this link: <a href="https://packt.link/gbp/9781805124276">https://packt.link/gbp/9781805124276</a></p>
			<h1 id="_idParaDest-821"><a id="_idTextAnchor1032"/>Exploring some basic concepts of Odoo.sh</h1>
			<p>In this recipe, we will look <a id="_idIndexMarker1284"/>at some of the features of the Odoo.sh platform. We will answer some basic questions, such as when you should use it and why it should be used.</p>
			<h2 id="_idParaDest-822"><a id="_idTextAnchor1033"/>What is Odoo.sh?</h2>
			<p>Odoo.sh is a <a id="_idIndexMarker1285"/>cloud service that provides the platform with the ability to host Odoo instances with custom modules. Putting it simply, it is Odoo’s <strong class="bold">platform as a service</strong> (<strong class="bold">PaaS</strong>) cloud <a id="_idIndexMarker1286"/>solution. It is fully integrated with GitHub. Any GitHub repository with valid Odoo modules can be launched on Odoo.sh within minutes. You can examine the ongoing development by testing multiple branches in parallel. Once you have moved your instance to production, you can test some new features with a copy of the production database; this helps to avoid regression. It also takes daily backups. With Odoo.sh, you can deploy Odoo instances efficiently, even if you don’t have sound knowledge of DevOps. It automatically sets up an Odoo instance with top-notch configurations. Note that Odoo.sh is the Enterprise edition of Odoo. You cannot use the Odoo Community edition because Odoo.sh will only load the Enterprise edition.</p>
			<h2 id="_idParaDest-823"><a id="_idTextAnchor1034"/>Why was Odoo.sh introduced?</h2>
			<p>Before Odoo.sh was <a id="_idIndexMarker1287"/>introduced, there were two ways to host Odoo instances. The first was to use Odoo Online, which is a <strong class="bold">software as a service</strong> (<strong class="bold">SaaS</strong>) cloud <a id="_idIndexMarker1288"/>service. The second method was the on-premises option, in which you needed to host an Odoo instance and configure it on your server yourself. Now, both of these options have pros and cons. In the Odoo online option, you don’t need to configure or deploy it, as it is a SaaS service. However, you cannot use custom modules on this platform. On the other hand, with the on-premises option, you can use custom modules, but you need to do everything yourself. You need to purchase the server, you need to configure the database and NGINX, and you need to set up the mail server, daily backups, and security.</p>
			<p>For this reason, there was a need for a new option that provided the simplicity of Odoo online and the flexibility of the on-premises option. Odoo.sh lets you use custom modules without <a id="_idIndexMarker1289"/>a complex configuration. It also provides additional features, such as testing branches, staging branches, and automated tests.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">It is not completely true that customization is not possible on Odoo online. With Odoo Studio and other techniques, you can carry out customization. The scope of this customization, however, is very narrow.</p>
			<h2 id="_idParaDest-824"><a id="_idTextAnchor1035"/>When should you use Odoo.sh?</h2>
			<p>If you don’t need customization or you only need a small amount of customization that is possible in Odoo online, you should go for Odoo online. This will save both time and money. If you <a id="_idIndexMarker1290"/>want a significant amount of customization and you have teamed up with expert DevOps engineers, you can choose the on-premises option. Odoo.sh is suitable for when you have good knowledge of Odoo customization but do not have any expertise in DevOps. With Odoo.sh, there’s no need to carry out complex configurations; you can start using it straight away, along with your customization. It even configures the mailing server.</p>
			<p>Odoo.sh is very useful when you are developing a large project with agile methodology. This is because on Odoo.sh, you can test multiple development branches in parallel and deploy the stable development in production in minutes. You can even share the test development with the end customer.</p>
			<h2 id="_idParaDest-825"><a id="_idTextAnchor1036"/>What are the features of Odoo.sh?</h2>
			<p>Odoo has invested a lot of time in the development of the Odoo.sh platform, and it is packed with features <a id="_idIndexMarker1291"/>as a result. Let’s have a look at the features of Odoo.sh. Note that Odoo adds new features from time to time. In this section, I have mentioned the features that are available at the time of writing this book, but you might find some further features as well:</p>
			<ul>
				<li><strong class="bold">GitHub integration</strong>: This platform is fully integrated with GitHub. You can test every branch, pull, or commit here. For every new commit, a new branch will be pulled automatically. It will also run an automated test for the new commits. You can even create/merge branches from the Odoo.sh UI itself.</li>
				<li><strong class="bold">Web shell</strong>: Odoo.sh provides the web shell in the browser for the current build (or production server). Here, you can see all the modules and logs.</li>
				<li><strong class="bold">Web code editor</strong>: Just like <a id="_idIndexMarker1292"/>the web shell, Odoo.sh provides the code editor in the browser. Here, you can access all of the source code and also get the Odoo interactive shell for the current build.</li>
				<li><strong class="bold">SSH access</strong>: By registering <a id="_idIndexMarker1293"/>your public keys, you can connect to any container via SSH.</li>
				<li><code>requirement.txt</code> to the root of your GitHub repository. Right now, you can only install Python packages. It is not possible to install system packages (apt packages).</li>
				<li><strong class="bold">Server logs</strong>: You <a id="_idIndexMarker1295"/>can access the server log for each build from this browser. These logs are in real time, and you can also filter them from here.</li>
				<li><strong class="bold">Automated tests</strong>: Odoo.sh <a id="_idIndexMarker1296"/>provides your own runbot, which you can use to perform a series of automated tests for your development. Whenever you add a new commit or a new development branch, Odoo.sh will automatically run all of the test cases and show the status of the tests. You can access the full test log, which will help you find issues if a test case fails.</li>
				<li><strong class="bold">Staging and development branches</strong>: Odoo.sh provides two types of branches: the development <a id="_idIndexMarker1297"/>branch and the staging branch. In the development branch, you can test ongoing development with demonstration data. The staging branch is used when the development is finished, and you want to test the feature before merging it into production. The staging branch does not load the demonstration data; instead, it uses a copy of the production server.</li>
				<li><strong class="bold">Mail server</strong>: Odoo.sh automatically sets up a mail server for the production server. Just <a id="_idIndexMarker1298"/>like Odoo online, Odoo.sh does not need any extra configuration for email, although it is possible to use your own mail server.</li>
				<li><strong class="bold">Mail catcher</strong>: The staging branch uses a copy of your production database, so it has information <a id="_idIndexMarker1299"/>about your real customers. Testing on such a database can make it possible to send emails to real customers. To avoid this issue, the email feature is only activated on production branches. Staging and development branches do not send real emails; instead, they use a mail catcher so that you can test and see emails in the staging and development branches.</li>
				<li><strong class="bold">Share the build</strong>: With Odoo.sh, you can share the development branches with your customers <a id="_idIndexMarker1300"/>so they can test them before merging the feature into production.</li>
				<li><strong class="bold">Faster deployment</strong>: As Odoo.sh is fully integrated with GitHub, you can merge and <a id="_idIndexMarker1301"/>deploy the development branches directly from the browser with a simple drag-and-drop procedure.</li>
				<li><strong class="bold">Backup and recovery</strong>: Odoo.sh keeps full backups for the production instance. You can <a id="_idIndexMarker1302"/>download or restore any of these backups in just a few clicks. Refer to the <em class="italic">Getting a backup of your instance</em> recipe to learn more about backups. Odoo.sh keeps 14 full backups for up to 3 months: 1 per day for 7 days, 1 per week for 4 weeks, 1 per month for 3 months.</li>
				<li><strong class="bold">Community modules</strong>: You <a id="_idIndexMarker1303"/>can test and install any community module in a few simple clicks. You can also test free modules directly from the app store.</li>
			</ul>
			<h1 id="_idParaDest-826"><a id="_idTextAnchor1037"/>Creating an Odoo.sh account</h1>
			<p>In this recipe, we will <a id="_idIndexMarker1304"/>create an Odoo.sh account and an empty repository for the custom add-ons.</p>
			<h2 id="_idParaDest-827"><a id="_idTextAnchor1038"/>Getting ready</h2>
			<p>For this recipe, you will need a GitHub account on which you can add custom modules. You will also need an Odoo.sh subscription code. If you are an Odoo partner, you will get a free Odoo.sh subscription code. Otherwise, you will need to purchase it from <a href="https://www.odoo.sh/pricing">https://www.odoo.sh/pricing</a>.</p>
			<h2 id="_idParaDest-828"><a id="_idTextAnchor1039"/>How to do it...</h2>
			<p>Follow these steps to create an Odoo.sh account:</p>
			<ol>
				<li>Open <a href="https://www.odoo.sh">https://www.odoo.sh</a> and click on <strong class="bold">Sign in</strong> in the top menu. This will redirect you to the GitHub page:</li>
			</ol>
			<div><div><img src="img/B20997_19_01.jpg" alt="Figure 19.1 – GitHub authentication"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.1 – GitHub authentication</p>
			<ol>
				<li value="2">Give authorization to <a id="_idIndexMarker1305"/>your repositories, which will redirect you back to Odoo.sh. Fill in the form to deploy the instance:</li>
			</ol>
			<div><div><img src="img/B20997_19_02.jpg" alt="Figure 19.2 – Create an Odoo.sh instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.2 – Create an Odoo.sh instance</p>
			<ol>
				<li value="3">This will <a id="_idIndexMarker1306"/>deploy the instance, and you will be redirected to the Odoo.sh control panel. Wait for the build status to be successful; then, you can connect to your instance with the <strong class="bold">CONNECT</strong> button displayed in the following screenshot:</li>
			</ol>
			<div><div><img src="img/B20997_19_03.jpg" alt="Figure 19.3 – Connect to the development instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.3 – Connect to the development instance</p>
			<p>Upon clicking <strong class="bold">CONNECT</strong>, you will be automatically logged in to your instance. If you are an admin, by clicking on the arrow button at the side, you can connect as other users as well.</p>
			<h2 id="_idParaDest-829"><a id="_idTextAnchor1040"/>How it works...</h2>
			<p>The Odoo.sh platform is integrated with GitHub. You need to give full authorization to Odoo.sh so <a id="_idIndexMarker1307"/>that it can access your repositories. Odoo.sh will also create the webhooks. GitHub webhooks notify the Odoo.sh platform when a new commit or branch has been added to your repository. When you sign in for the first time, Odoo.sh will redirect you to GitHub. GitHub will show a page similar to the screenshot in <em class="italic">step 1</em>, in which you will need to provide access to all of your private and public repositories. If you are not the owner of the repository, you will see the button to make an access request to the owner for the rights.</p>
			<p>After you grant repository access to Odoo.sh, you will be redirected back to Odoo.sh, where you will see the form to deploy the Odoo instance. To create a new instance, you will need to add the following information:</p>
			<ul>
				<li><strong class="bold">GitHub repository</strong>: Here, you will need to set the GitHub repository with your custom modules. The modules in this repository will be available to the Odoo instance. You will see a list of all your existing repositories. You can select one of them or create a new one.</li>
				<li><strong class="bold">Odoo version</strong>: Choose the Odoo version you want to deploy. You can select from the currently supported Odoo LTS versions. Make sure you select the version that is compatible with the modules in the GitHub repository. For our example, we will select version 14.0.</li>
				<li><strong class="bold">Subscription code</strong>: This is the code to activate the instance. You will receive the code via email after purchasing an Odoo.sh plan; if you are an official Odoo partner, you can ask for this code from Odoo.</li>
				<li><strong class="bold">Hosting location</strong>: Here, you need to choose a server location based on your geographic location. The server that is nearest will give the best performance. The latency displayed under the hosting location is based on your location. So if you are creating an instance for your customer and the customer is in another country, you will need to select a server location that is near the customer’s location with lower latency.</li>
				<li>Once you <a id="_idIndexMarker1308"/>submit this form, your Odoo instances will be deployed, and you will be redirected to the Odoo.sh control panel. Here, you will see your first build. It will take a few minutes, and then you will be able to connect to your Odoo instance. If you check the left panel, you will see that there are no branches in the production and staging sections and that only one branch is in the development section. In the next few recipes, we will see how you can create staging and production branches.</li>
			</ul>
			<h2 id="_idParaDest-830"><a id="_idTextAnchor1041"/>There’s more...</h2>
			<p>Right now, Odoo.sh only works with GitHub. Other version-control systems, such as GitLab and Bitbucket, are not supported right now. If you want to use a system other than GitHub, you can use the intermediate GitHub repository that is linked to your actual repository via the submodule. In the future, Odoo will add support for GitLab and Bitbucket, but this is not the priority at the moment, according to the Odoo officials. The method suggested here is just a workaround if you want to use GitLab or Bitbucket.</p>
			<h1 id="_idParaDest-831"><a id="_idTextAnchor1042"/>Adding and installing custom modules</h1>
			<p>As we described <a id="_idIndexMarker1309"/>earlier, in the <em class="italic">Exploring some basic concepts of Odoo.sh</em> recipe, on the Odoo.sh platform, you can add custom Odoo modules. The <a id="_idIndexMarker1310"/>platform is integrated with GitHub, so adding a new commit in the registered repository will create a new build in the respective branch. In this recipe, we will add a custom module in our repository and access that module in Odoo.sh.</p>
			<h2 id="_idParaDest-832"><a id="_idTextAnchor1043"/>Getting ready</h2>
			<p>For our example, we will choose the <code>my_hostel</code> module from <a href="B20997_18.xhtml#_idTextAnchor990"><em class="italic">Chapter 18</em></a>, <em class="italic">Automated Test Cases</em>. You can add any valid Odoo module in this recipe, but we will use the module with test cases here, as the Odoo.sh platform will perform all the test cases automatically. For simplicity, we have added this module in the GitHub repository of this book, at <code>Chapter20/r0_initial_module/my_hostel</code>.</p>
			<h2 id="_idParaDest-833"><a id="_idTextAnchor1044"/>How to do it...</h2>
			<p>Follow these <a id="_idIndexMarker1311"/>steps to add your custom modules to Odoo.sh:</p>
			<ol>
				<li>Get your <a id="_idIndexMarker1312"/>Git repository on your local machine, add the <code>my_hostel</code> module in it, and then execute the following command to push the module into the GitHub repository:<pre class="source-code">
<strong class="bold">git add .</strong>
<strong class="bold">git commit -am"Added my_hostel module"</strong>
<strong class="bold">git push origin main</strong></pre></li>				<li>Open your project in Odoo.sh. Here, you will find a new build for this commit. It will start running test cases, and you will see the following screen:</li>
			</ol>
			<div><div><img src="img/B20997_19_04.jpg" alt="Figure 19.4 – New build for the hostel module"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.4 – New build for the hostel module</p>
			<ol>
				<li value="3">After a new commit is pulled in your Odoo.sh project, you will see the installation progress on the right side. Wait for the installation to be complete, then access your instance by clicking on the green <code>my_hostel</code> module:</li>
			</ol>
			<div><div><img src="img/B20997_19_05.jpg" alt="Figure 19.5 – Hostel module installed"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.5 – Hostel module installed</p>
			<p>Explore <a id="_idIndexMarker1313"/>and test the <code>my_hostel</code> module. Note that this is not <a id="_idIndexMarker1314"/>a production build, so you can test it however you like.</p>
			<h2 id="_idParaDest-834"><a id="_idTextAnchor1045"/>How it works...</h2>
			<p>In <em class="italic">step 1</em>, we uploaded the <code>my_hostel</code> module to the GitHub repository. Odoo.sh will be notified about these changes instantly through a webhook. Then, Odoo.sh will start building a new instance. It will install all your custom modules and their dependencies. A new build will automatically perform the test cases for the installed modules.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">By default, Odoo.sh will only install your custom modules and their dependencies. If you want to change this behavior, you can do it from the module installation section of the global settings. We will look at these settings in detail in the next few recipes.</p>
			<p>In the <strong class="bold">HISTORY</strong> tab, you will be able to see the full history of the branch. Here, you can find some basic information about the build. It will display the commit message, the author information, and the GitHub link of the commit. On the right side, you will get the live progress of the build. Note that the builds in the development section will install the modules with demonstration data. In the next few recipes, you will see the difference between the production, development, and staging branches in detail.</p>
			<p>After a successful build, you will see a button to connect the instance. By default, you will be connected with the admin user. Using <strong class="bold">CONNECT</strong> as a drop-down menu, you can log in as a demo and portal user instead.</p>
			<h2 id="_idParaDest-835"><a id="_idTextAnchor1046"/>There’s more...</h2>
			<p>Odoo.sh will <a id="_idIndexMarker1315"/>create a new build for every new commit. You <a id="_idIndexMarker1316"/>can change this behavior from the <strong class="bold">SETTINGS</strong> tab of the branch:</p>
			<div><div><img src="img/B20997_19_06.jpg" alt="Figure 19.6 – Development branch options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.6 – Development branch options</p>
			<p>Here, you will find several options. One of them is <strong class="bold">Behavior upon new commits</strong>. It has three possible values:</p>
			<ul>
				<li><strong class="bold">New Build</strong>: This option will create a new build for each commit</li>
				<li><strong class="bold">Do Nothing</strong>: This option will ignore the new commit and do nothing</li>
				<li><strong class="bold">Update Previous Build</strong>: This will use an existing build for the new commit</li>
			</ul>
			<p>The <strong class="bold">Module installation</strong> and <strong class="bold">Test suite</strong> options will help you control the test suites. You can disable testing and you can run specific test cases with these options.</p>
			<h1 id="_idParaDest-836"><a id="_idTextAnchor1047"/>Managing branches</h1>
			<p>In Odoo.sh, you can <a id="_idIndexMarker1317"/>create multiple development and staging branches along with the production branch. In this recipe, we will create different types of branches and see the differences between them. You will see the full workflow of how you can develop, test, and deploy the new features.</p>
			<h2 id="_idParaDest-837"><a id="_idTextAnchor1048"/>Getting ready</h2>
			<p>Visit <a href="https://www.odoo.sh/project">https://www.odoo.sh/project</a> and open the project we created in the <em class="italic">Creating an Odoo.sh account</em> recipe. We will create a development branch for the new feature and then test it in the staging branch. Finally, we will merge the feature in the production branch.</p>
			<h2 id="_idParaDest-838"><a id="_idTextAnchor1049"/>How to do it...</h2>
			<p>In this recipe, we will create all types of branches in Odoo.sh. At the moment, we don’t have any branches in production, so we will start by creating a production branch.</p>
			<h3>Creating the production branch</h3>
			<p>Right now, we only <a id="_idIndexMarker1318"/>have one <strong class="bold">main</strong> branch in the <strong class="bold">Development</strong> section. The last build of the <strong class="bold">main</strong> branch shows a green label that reads <strong class="bold">Test: success</strong>, meaning that all of the automated test cases have run successfully. We can move this branch into the <strong class="bold">Production</strong> branch, as the test case status shows that everything is fine. In order to move your <strong class="bold">main</strong> branch into the <strong class="bold">Production</strong> branch, you just need to drag the <strong class="bold">main</strong> branch from the <strong class="bold">Development</strong> section and drop it in the <strong class="bold">Production</strong> section, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_19_07.jpg" alt="Figure 19.7 – Move the main branch to Production"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.7 – Move the main branch to Production</p>
			<p>This will create your <strong class="bold">Production</strong> branch. You can access the <strong class="bold">Production</strong> branch with the <strong class="bold">Connect</strong> button on the right side. Once you open the production instance, you will notice that there have been no applications installed in the production database. This is because the <a id="_idIndexMarker1319"/>production instance requires you or your end customer to install and configure the operation according to the requirements. Note that this is a production instance, so in order to keep the instance running, you need to enter your Enterprise subscription code.</p>
			<h3>Creating a development branch</h3>
			<p>You can <a id="_idIndexMarker1320"/>create development branches directly from the browser. Click on the plus (<strong class="bold">+</strong>) button next to the <strong class="bold">Development</strong> section. This will show two types of input. One is the branch to fork, and the other is the name of the development branch. After filling in the input, hit the <em class="italic">Enter</em> key.</p>
			<p>This will create a new branch by forking the given branch, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_19_08.jpg" alt="Figure 19.8 – Create a new development branch"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.8 – Create a new development branch</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If you don’t want to create a development branch from the UI, you can create it directly from GitHub. If you add a new branch in the GitHub repository, Odoo.sh will create a new development branch automatically.</p>
			<p>Branches in <a id="_idIndexMarker1321"/>development are usually new feature branches. As an example, we will add a new field in the <code>hostel.room</code> model. Follow these steps to add a new HTML field in the <code>hostel</code> model:</p>
			<ol>
				<li>Increase the module version in the <code>manifest</code> file:<pre class="source-code">
...
'version': '17.0.1.0.1',
...</pre></li>				<li>Add a new field in the model:<pre class="source-code">
   other_info = fields.Text("Other Information",
                            help="Enter more information")
   description = fields.Html('Description')
   policy = fields.Html('Description')</pre></li>				<li>Add a <strong class="bold">policy</strong> field in the hostel’s form view:<pre class="source-code">
&lt;notebook&gt;
&lt;page string="Policy"&gt;
           &lt;field name="policy"/&gt;
&lt;/page&gt;
&lt;/notebook&gt;</pre></li>				<li>Push the changes in the feature branch by executing the following command in the terminal:<pre class="source-code">
<strong class="bold">git commit -am"Added room policy"</strong>
<strong class="bold">git push origin feature-branch</strong></pre></li>			</ol>
			<p>This will <a id="_idIndexMarker1322"/>create a new build on Odoo.sh. After a successful build, you can test this new feature by accessing the instance. You will be able to see a new HTML field in the book’s form view. Note that this branch is the development branch, so the new feature is only available to this branch. Your production branch has not changed.</p>
			<h3>Creating a staging branch</h3>
			<p>Once you complete the development branch and the test cases are successful, you can move the <a id="_idIndexMarker1323"/>branch to the <strong class="bold">Staging</strong> section. This is the pre-production section. Here, the new feature will be tested with a copy of the production database. This will help us to find any issues that might be generated in the production database. To move from the development branch to the <strong class="bold">Staging</strong> branch, just drag and drop the branch into the <strong class="bold">Staging</strong> section:</p>
			<div><div><img src="img/B20997_19_09.jpg" alt="Figure 19.9 – Move the development branch to Staging"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.9 – Move the development branch to Staging</p>
			<p>Once you move the <strong class="bold">Development</strong> branch to the <strong class="bold">Staging</strong> section, you can test your new development with production data. Just like any other build, you can access the <strong class="bold">Staging</strong> branch with the <strong class="bold">CONNECT</strong> button on the right. The only difference is that you will be able to see the data of the production database in this case. Here, your development <a id="_idIndexMarker1324"/>module is only upgraded automatically if you have increased the module version from the manifest.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">The staging branch will use a copy of the production database, so the staging instance will have real customers and their emails. For this reason, in the staging branch, real emails are disabled so that you don’t send any by accident when testing a new feature in the staging branch.</p>
			<p>If you haven’t changed the module version, you will need to upgrade the modules manually to see the new features in action.</p>
			<h3>Merging new features in the production branch</h3>
			<p>After you test the new development with the production database (in the staging branch), you <a id="_idIndexMarker1325"/>can deploy the new development into the <strong class="bold">Production</strong> branch. Like before, you just need to drag and drop the <strong class="bold">Staging</strong> branch into the <strong class="bold">Production</strong> branch. This will merge the new feature branch into the main branch. Like the <strong class="bold">Staging</strong> branch, your development module is only upgraded automatically if you have increased the module version from <strong class="bold">manifest</strong>. After this, the new module is available for the end customer:</p>
			<div><div><img src="img/B20997_19_010.jpg" alt="Figure 19.10 – Merge changes to production"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.10 – Merge changes to production</p>
			<p>Once you drop <a id="_idIndexMarker1326"/>the staging branch to <strong class="bold">Production</strong>, a popup will be displayed with two options:</p>
			<ul>
				<li><strong class="bold">Rebase and Merge</strong>: This will create a pull request and merge it with the rebase so you will have liner history.</li>
				<li><strong class="bold">Merge</strong>: This will create a merge commit without fast-forwarding:</li>
			</ul>
			<div><div><img src="img/B20997_19_011.jpg" alt="Figure 19.11 – Display popup for Merge and Rebase and Merge button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.11 – Display popup for Merge and Rebase and Merge button</p>
			<h2 id="_idParaDest-839"><a id="_idTextAnchor1050"/>How it works...</h2>
			<p>In the previous example, we performed a full workflow to deploy a new feature into production. The following list explains the purposes of the different types of branches in Odoo.sh:</p>
			<ul>
				<li><strong class="bold">Production branch</strong>: This is <a id="_idIndexMarker1327"/>the actual instance that is used by the end customer. There is only one production branch, and the new features are intended to merge with this branch. In this branch, the mailing service is active, so your end customer can send and receive emails. Daily backup is also active for this branch.</li>
				<li><strong class="bold">Development branches</strong>: This type of branch shows all the active development. You <a id="_idIndexMarker1328"/>can create unlimited development branches, and every new commit in the branch will trigger a new build. The database in this branch is loaded with the demonstration data. After the development is complete, this branch will be moved to the staging branch. The mailing service is not active in these branches.</li>
				<li><strong class="bold">Staging branches</strong>: This is the intermediate stage in the workflow. A stable development <a id="_idIndexMarker1329"/>will be moved to the staging branch to be tested with a copy of the production branch. This is a very important step in the development life cycle; it might happen that a feature that works fine in the development branch does not work as expected with the production database. The staging branches give you an opportunity to test the feature with the production database before deploying it in production. If you find any issues with the development in this branch, you can move the branch back to development. The number of staging branches is based on your Odoo.sh plan. By default, you only have one staging branch, but you can purchase more if you want to.</li>
			</ul>
			<p>This is the complete workflow of how new features should be merged into production. In the next recipe, you will see some other options that we can use with these branches.</p>
			<h1 id="_idParaDest-840"><a id="_idTextAnchor1051"/>Accessing debugging options</h1>
			<p>Odoo.sh <a id="_idIndexMarker1330"/>provides different features for analysis and debugging purposes. In this recipe, we will explore all of these features and options.</p>
			<h2 id="_idParaDest-841"><a id="_idTextAnchor1052"/>How to do it...</h2>
			<p>We will be using the same Odoo.sh project for this recipe. Each option will be shown in a different section with a screenshot.</p>
			<h3>Branch history</h3>
			<p>You have already <a id="_idIndexMarker1331"/>seen this feature in previous recipes. The <strong class="bold">HISTORY</strong> tab shows the full history of the branch. You can connect to the builds from here:</p>
			<div><div><img src="img/B20997_19_012.jpg" alt="Figure 19.12 – The HISTORY tab"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.12 – The HISTORY tab</p>
			<p>In the <strong class="bold">HISTORY</strong> tab, you can see all past actions performed on a selected branch. It will display logs, merges, new commits, and database restores.</p>
			<h3>Mail catcher</h3>
			<p>The staging branch <a id="_idIndexMarker1332"/>uses a copy of your production database, so it has information about your customers. Testing the staging branch can send emails to real customers. This is why emails are only activated on production branches. The staging and development branches do not send real emails. If you want to test the email system before deploying any feature into production, you can use the mail catcher, where you can see the list of all outgoing emails. The mail catcher will be available in the staging and development branches.</p>
			<p>The mail catcher will display an email with the source and any attachments, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_19_013.jpg" alt="Figure 19.13 – Mail catcher"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.13 – Mail catcher</p>
			<p>In the <strong class="bold">MAILS</strong> tab, you can <a id="_idIndexMarker1333"/>see a list of all the captured mail with all attachments. Note that the <strong class="bold">MAILS</strong> tab will only be displayed in the staging and development branches.</p>
			<h3>Web shell</h3>
			<p>From the <code>pip</code> and maintain multiple tabs.</p>
			<p>Take a look at the following screenshot: you can access the web shell by clicking on <strong class="bold">SHELL</strong>:</p>
			<div><div><img src="img/B20997_19_014.jpg" alt="Figure 19.14 – Web shell"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.14 – Web shell</p>
			<p>With shell access, you can traverse between different directories and perform operations. You can <a id="_idIndexMarker1335"/>also use the <code>pip</code> command to install Python packages.</p>
			<p>Here is the directory structure from the root directory:</p>
			<pre class="source-code">
.
├── data
│ ├── addons
│ ├── filestore
│ └── sessions
├── logs
├── Maildir
│ ├── cur
│ ├── new
│ └── tmp
├── repositories
│ └── git_github.com_pga-odoo_odooshdemov17.git
├── src
│ ├── enterprise
│ ├── odoo
│ ├── themes
│ └── user
└── tmp</pre>			<p>These directories can be different based on the type of branch. For example, <strong class="bold">Maildir</strong> will only be available in the staging and development branches as it uses a mail catcher.</p>
			<p>Sometimes, you need <a id="_idIndexMarker1336"/>to restart the server or update the module from the shell. You can use the following command in the shell to restart the server:</p>
			<pre class="console">
odoosh-restart</pre>			<p>To update the module, execute the given command in the shell:</p>
			<pre class="console">
odoo-bin -u my_hostel --stop-after-init
odoo-update my_hostel</pre>			<p>The previous command will update the <strong class="bold">my_hostel</strong> module. If you want to update multiple modules, you can pass module names separated by a comma.</p>
			<h3>Code editor</h3>
			<p>If you are not <a id="_idIndexMarker1337"/>comfortable with shell access, Odoo.sh provides a full-featured editor. Here, you can access the Python shell, the Odoo shell, and the Terminal. You can also edit the source code from here, as you can see in the given screenshot. After modifying the source code, you can restart the server from the <strong class="bold">Odoo</strong> menu at the top:</p>
			<div><div><img src="img/B20997_19_015.jpg" alt="Figure 19.15 – Web code editor"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.15 – Web code editor</p>
			<p>As depicted in the <a id="_idIndexMarker1338"/>preceding screenshot, you will be able to update files from the editor. Odoo will detect the changes automatically and restart the server. Note that if you make changes in data files, you will need to update the module.</p>
			<h3>Logs</h3>
			<p>From the <strong class="bold">LOGS</strong> tab, you can access all of the logs for your instance. You can see the live logs without <a id="_idIndexMarker1339"/>reloading the pages. You can filter the logs from here. This allows you to find issues from the production server. Here is a list of the different log files you can find in the <strong class="bold">LOGS</strong> tab:</p>
			<ul>
				<li><code>install.log</code>: This is for the logs that are generated when installing the modules. The logs of all the automated test cases will be located here.</li>
				<li><code>pip.log</code>: You can add Python packages with the <code>requirement.txt</code> file. In this log file, you will find the installation log of these Python packages.</li>
				<li><code>odoo.log</code>: This is the normal access log of Odoo. You will find the full access log here. You should look in this log to check production errors.</li>
				<li><code>update.log</code>: When you upload a new module with a different manifest version, your module gets updated automatically. This file contains the logs of these automatic updates.</li>
			</ul>
			<p>Take a look at <a id="_idIndexMarker1340"/>the following screenshot. This shows the live logs for the production branch:</p>
			<div><div><img src="img/B20997_19_016.jpg" alt="Figure 19.16 – Server log"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.16 – Server log</p>
			<p>The preceding screenshot shows that the logs are live, so you will be able to see new logs without reloading. Additionally, you can search for a particular log with the textbox in the top-right corner of the UI.</p>
			<h2 id="_idParaDest-842"><a id="_idTextAnchor1053"/>There’s more...</h2>
			<p>Some commonly used <code>git</code> commands are available on top of the module, as shown in the following screenshot. You can run these by using the <strong class="bold">Run</strong> button on the left. These commands can’t be edited, but if you want to run a modified command, you can copy it from here and then run it from the shell:</p>
			<div><div><img src="img/B20997_19_017.jpg" alt="Figure 19.17 – Git commands"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.17 – Git commands</p>
			<p>You can execute these <code>git</code> commands in the shell to perform various operations, as depicted in the preceding screenshot.</p>
			<h1 id="_idParaDest-843"><a id="_idTextAnchor1054"/>Getting a backup of your instance</h1>
			<p>Backups are <a id="_idIndexMarker1341"/>essential for the production server. Odoo.sh provides a built-in backup facility. In this recipe, we will illustrate how you can download and restore backups from Odoo.sh.</p>
			<h2 id="_idParaDest-844"><a id="_idTextAnchor1055"/>How to do it...</h2>
			<p>In the production branch, you can access the full information about the backups from the <strong class="bold">BACKUPS</strong> tab at the top. This will display a list of backups:</p>
			<div><div><img src="img/B20997_19_018.jpg" alt="Figure 19.18 – Backups manager"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.18 – Backups manager</p>
			<p>From the buttons at the top, you can carry out backup operations, such as downloading the dump, performing a manual backup, or restoring from a backup. A database backup can take a long time, so it will be done in the background. You will recieve a notification on the bell icon at the top when it is completed.</p>
			<h2 id="_idParaDest-845"><a id="_idTextAnchor1056"/>How it works...</h2>
			<p>Odoo automatically takes a backup of your production instance daily. Odoo also takes an automatic backup whenever you merge a new development branch and update the module. You can also perform a manual backup using the button at the top.</p>
			<p>Odoo.sh keeps a total of 14 full backups for the Odoo production instance for up to 3 months—1 per day for 7 days, 1 per week for 4 weeks, and 1 per month for 3 months. From the <strong class="bold">BACKUPS</strong> tab, you can access 1 month of backups (all 7 days of the week and 4 weekly backups).</p>
			<p>If you are <a id="_idIndexMarker1342"/>moving to Odoo.sh from the on-premises or online option, you can import your database using the <strong class="bold">Import Database</strong> button. If you import your database directly into production, it might cause issues. To avoid this, you should import the database into the staging branch first.</p>
			<h1 id="_idParaDest-846"><a id="_idTextAnchor1057"/>Checking the status of your builds</h1>
			<p>Whenever you make a new commit, Odoo.sh creates the new commit. It also performs automated <a id="_idIndexMarker1343"/>test cases. To manage all of this, Odoo.sh has its own version of runbot. In this recipe, we will check the statuses of all the builds.</p>
			<h2 id="_idParaDest-847"><a id="_idTextAnchor1058"/>How to do it...</h2>
			<p>Click on the <strong class="bold">Builds</strong> menu at the top to open the list of builds. Here, you can see a full overview of all of the branches and their commits:</p>
			<div><div><img src="img/B20997_19_019.jpg" alt="Figure 19.19 – Build status"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.19 – Build status</p>
			<p>By clicking on the <strong class="bold">Connect</strong> buttons, you can connect to the instances. You can see the status of the build by the background color of the branch.</p>
			<h2 id="_idParaDest-848"><a id="_idTextAnchor1059"/>How it works...</h2>
			<p>On the runbot screen, you will get extra control over the builds. You can connect to the previous builds from here. Different colors show the status of the build. Green means that everything is fine; yellow indicates a warning, which can be ignored, but it is recommended that you fix it; red means there is a critical issue that you have to fix before merging the development branch into production. The red and yellow branches show the exclamation icon, <strong class="bold">(!)</strong>, near the <strong class="bold">Connect</strong> button. When you click on this, you will get a popup with the error and warning log. Usually, you need to search the installation log files to find the error or warning logs, but this popup will filter out the other logs and only display the error and warning logs. This means that whenever a build goes red or yellow, you should come here and fix the errors and warnings before merging them into production.</p>
			<p>Inactive development branches are destroyed after a few minutes. Normally, a new build will be <a id="_idIndexMarker1344"/>created when you add a new <strong class="bold">Commit</strong> button. If you want to reactivate the build without a new commit; however, you can use the <strong class="bold">Rebuild</strong> button on the left side. The builds for the staging branches are also destroyed after a few minutes, apart from the last one, which will remain active.</p>
			<h2 id="_idParaDest-849"><a id="_idTextAnchor1060"/>There’s more...</h2>
			<p>From the <strong class="bold">Status</strong> menu in the bar at the top, you can see the overall statistics of your instance. The platform servers are continuously monitored. On the <strong class="bold">Status</strong> screen, you will see the statistics of the server’s availability, which will be computed automatically from the platform’s monitoring system. It will show data, including the server uptime. The <strong class="bold">Status</strong> page will show the input and output data from the server. The <strong class="bold">Status</strong> page will display the following information:</p>
			<div><div><img src="img/B20997_19_020.jpg" alt="Figure 19.20 – Odoo.sh status"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.20 – Odoo.sh status</p>
			<p>The data displayed in the <strong class="bold">Status</strong> tab is collected from the various monitoring tools used by Odoo.sh.</p>
			<h1 id="_idParaDest-850"><a id="_idTextAnchor1061"/>All Odoo.sh options</h1>
			<p>Odoo.sh provides a few further options under the <strong class="bold">Settings</strong> menu. In this recipe, you will see all of <a id="_idIndexMarker1345"/>the important options used to modify the default behavior of certain things on the platform.</p>
			<h2 id="_idParaDest-851"><a id="_idTextAnchor1062"/>Getting ready</h2>
			<p>We will be using the same Odoo.sh project that we used in previous recipes. You can access all the Odoo.sh settings from the <strong class="bold">Settings</strong> menu in the top bar. If you are not able to see this menu, that means you are accessing a shared project and you don’t have admin access.</p>
			<h2 id="_idParaDest-852"><a id="_idTextAnchor1063"/>How to do it...</h2>
			<p>Open the <strong class="bold">Settings</strong> page from the <strong class="bold">Settings</strong> menu in the top bar. We’ll take a look at the different options in the following sections.</p>
			<h3>Project name</h3>
			<p>You can change the name of the Odoo.sh project from this option. The project name in the input will <a id="_idIndexMarker1346"/>be used to generate your production URL. Development builds also use this project name as a prefix. In this case, the URL of our feature branch will be something like <a href="https://serpentcs-odooshdemov17-feature-branch-260887.dev.odoo.com">https://serpentcs-odooshdemov17-feature-branch-260887.dev.odoo.com</a>:</p>
			<div><div><img src="img/B20997_19_021.jpg" alt="Figure 19.21 – Change the project name"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.21 – Change the project name</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">This option will change the production URL, but you cannot get rid of <code>*.odoo.com</code>. If you want to run a production branch on a custom domain, you can add your custom domain in the <strong class="bold">Settings</strong> tab of the production branch. You will also need to add a CNAME entry in your DNS manager.</p>
			<h3>Collaborators</h3>
			<p>You can share <a id="_idIndexMarker1347"/>the project by adding collaborators. Here, you can search for and add a new collaborator using their GitHub ID. A collaborator can have either <strong class="bold">Admin</strong> or <strong class="bold">User</strong> access rights. A collaborator with admin access rights will have full access (to the settings as well). A collaborator with user access rights, on the other hand, will have restricted access rights. They will be able to see all builds, but they will not be able to access the backups, logs, shells, or emails of the production or staging branches, although they will have full access to the development branches:</p>
			<div><div><img src="img/B20997_19_022.jpg" alt="Figure 19.22 – Add collaborators"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.22 – Add collaborators</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">You will need to give these users access to the GitHub repository, too; otherwise, they won’t be able to create a new repository from the browser.</p>
			<h3>Public Access</h3>
			<p>Using this option, you <a id="_idIndexMarker1348"/>can share builds with your end customer. This can be used for demonstration or testing purposes. To do so, you need to enable the <strong class="bold">Allow public </strong><strong class="bold">access</strong> checkbox:</p>
			<div><div><img src="img/B20997_19_023.jpg" alt="Figure 19.23 – Give public access to builds"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.23 – Give public access to builds</p>
			<p>Note that the staging branch will have the same password as your production branch. However, in the <a id="_idIndexMarker1349"/>development branch, you will have the username and password shown in this table:</p>
			<div><div><img src="img/Table_012.jpg" alt="Table 19.1"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 19.1</p>
			<h3>Module installation</h3>
			<p>In the <strong class="bold">Settings</strong> tab of the development branch, you will see the <strong class="bold">Module installation</strong> option for <a id="_idIndexMarker1350"/>the development branches. It provides three options, as shown in the following screenshot:</p>
			<div><div><img src="img/B20997_19_024.jpg" alt="Figure 19.24 – Module installation options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.24 – Module installation options</p>
			<p>By default, it is set to <strong class="bold">Install only my modules</strong>. This option will install all of your custom modules and their dependent modules in the new development branches. Only automated test cases are performed for these modules. The second option is <strong class="bold">Full installation</strong>. This option will install all of the modules and perform automated test cases for all of those modules. The final option is <strong class="bold">Install a list of modules</strong>. In this option, you will need to pass a list of comma-separated modules, such as <strong class="bold">sales</strong>, <strong class="bold">purchases</strong>, and <strong class="bold">my_hostel</strong>. This option will install the given modules and their dependencies.</p>
			<p>This setting only applies to development builds. Staging builds duplicate the production build, so they will have the same modules installed in the production branch and perform test cases for modules that have an updated version manifest.</p>
			<h3>Submodules</h3>
			<p>The <strong class="bold">Submodules</strong> option is used when you are using private modules as submodules. This setting is only <a id="_idIndexMarker1351"/>needed for private submodules; public submodules will work fine without any issues. It is not possible to download private repositories publicly, so you need to give repository access to Odoo.sh. Follow these steps to add access to the private submodules:</p>
			<ol>
				<li>Copy the SSH URL of your private submodule repository in the input and click on <strong class="bold">Add</strong>.</li>
				<li>Copy the displayed <strong class="bold">public key</strong>.</li>
				<li>Add this <strong class="bold">public key</strong> as a deploy key in your private repository settings in GitHub (similar settings are also available on Bitbucket and GitLab):</li>
			</ol>
			<div><div><img src="img/B20997_19_025.jpg" alt="Figure 19.25 – Set the private submodule"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.25 – Set the private submodule</p>
			<p>You can add multiple submodules, too, and you can remove submodules from here as well.</p>
			<h3>Database Workers</h3>
			<p>You can <a id="_idIndexMarker1352"/>increase the number of workers for the production build. This is useful when you have more users; usually, a single worker can handle 25 backend users or 5,000 daily website visitors. This formula is not perfect; it can vary based on usage. This option is not free, and increasing the number of workers will increase the price of your Odoo.sh subscription:</p>
			<div><div><img src="img/B20997_19_026.jpg" alt="Figure 19.26 – Set Database Workers"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.26 – Set Database Workers</p>
			<p>These <strong class="bold">Database Workers</strong> are multithreaded, and each one is able to handle 15 concurrent requests. It is necessary to have enough workers to serve all incoming requests as <a id="_idIndexMarker1353"/>they arrive, but increasing the number of workers does not increase the speed of the requests’ processing time. It is only used to handle a large number of concurrent users.</p>
			<h3>Staging Branches</h3>
			<p>Staging branches are used to test a new development with the production database. By default, Odoo.sh <a id="_idIndexMarker1354"/>gives you one staging branch. If you are working on large projects with lots of developers, this might be a bottleneck in the development process, so you can increase the number of <strong class="bold">Staging Branches</strong> at an extra cost:</p>
			<div><div><img src="img/B20997_19_027.jpg" alt="Figure 19.27 – Set staging branches"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.27 – Set staging branches</p>
			<h2 id="_idParaDest-853"><a id="_idTextAnchor1064"/>There’s more...</h2>
			<p>Along with the configuration options, the <strong class="bold">Settings</strong> menu will also display some statistics related to the platform.</p>
			<h3>Database size</h3>
			<p>This section will display <a id="_idIndexMarker1355"/>the size of your production database. The Odoo.sh platform charges the database at USD 1/GB/month. This option helps you keep track of your database. The displayed database size is only for the production database; it does not include the databases of the staging and development branches:</p>
			<div><div><img src="img/B20997_19_028.jpg" alt="Figure 19.28 – Database size"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.28 – Database size</p>
			<h3>Odoo source code revisions</h3>
			<p>This section will display the GitHub revision number of Odoo’s project. It will display the revision hash <a id="_idIndexMarker1356"/>for the Community, Enterprise, and theme projects that are currently being used in the platform. This source code will automatically be updated every week. This option will help you get the exact same versions on your local machine. You can also check this from the web shell, through the <code>git</code> command in the repository.</p>
		</div>
	</body></html>