<html><head></head><body>
		<div id="_idContainer147">
			<h1 id="_idParaDest-225" class="chapter-number"><a id="_idTextAnchor239"/>12</h1>
			<h1 id="_idParaDest-226"><a id="_idTextAnchor240"/>Deployment Basics – Git, GitHub, and AWS</h1>
			<p>It’s nice to develop an application with a functioning backend and a nice, flexible frontend on your machine. Still, if you want your application to be used publicly, you need to deploy the application to production. From this chapter to the last one, you will learn how to prepare the application we’ve built for deployment, deploy the backend on <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>) and the frontend on Vercel, and finally, go through some security and <span class="No-Break">performance optimizations.</span></p>
			<p>In this chapter, we will learn deployment basics such as jargon and concepts to understand before going further. We will be learning about the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Basics of <span class="No-Break">software deployment</span></li>
				<li>Tools and methods of web <span class="No-Break">application deployment</span></li>
				<li>Platforms for web <span class="No-Break">application deployment</span></li>
			</ul>
			<h1 id="_idParaDest-227"><a id="_idTextAnchor241"/>Technical requirements</h1>
			<p>For this chapter, you will need to have Git installed on your machine. If you are on Linux or macOS, it will come by default. You can check its existence with the following command in <span class="No-Break">the terminal:</span></p>
			<pre class="console">
git –version</pre>
			<p>Otherwise, feel free to download the right version <span class="No-Break">at </span><a href="https://git-scm.com/downloads"><span class="No-Break">https://git-scm.com/downloads</span></a><span class="No-Break">.</span></p>
			<p>After the installation, let’s configure Git if not done yet. In a terminal, enter the following configuration commands to set the username (usually the username on your GitHub account) and the email address (usually the email address on your <span class="No-Break">GitHub account):</span></p>
			<pre class="console">
git config --global user.name "username"
git config --global user.email "email@address.com"</pre>
			<p>You will also need an active GitHub account. You can register on the official website at <a href="https://github.com/">https://github.com/</a>. As we will also be deploying the application on a remote AWS server, you will need an AWS account that can be created at <a href="https://portal.aws.amazon.com/billing/signup">https://portal.aws.amazon.com/billing/signup</a>. If you don’t have an AWS account, you can still use any <strong class="bold">virtual private server</strong> (<strong class="bold">VPS</strong>) or <strong class="bold">virtual private cloud</strong> (<strong class="bold">VPC</strong>) you have online. However, this chapter will also document how to create a VPC instance using AWS and how to upload the code and serve the <span class="No-Break">Django API.</span></p>
			<h1 id="_idParaDest-228"><a id="_idTextAnchor242"/>Basics of software deployment</h1>
			<p><strong class="bold">Software deployment</strong> concerns <a id="_idIndexMarker682"/>all the activities that make a software system available to consumers. The term <em class="italic">software deployment</em> is also commonly described as application deployment. Following the best software deployment practices will ensure that all applications deployed operate smoothly and work <span class="No-Break">as expected.</span></p>
			<p>There are several <a id="_idIndexMarker683"/>benefits of software deployment, <span class="No-Break">such as:</span></p>
			<ul>
				<li><strong class="bold">Saved time</strong>: A good software deployment process can be configured to only take a few minutes. This saves time for compiling and distribution to <span class="No-Break">the users.</span></li>
				<li><strong class="bold">Increased security</strong>: Deploying your application in a structured manner rather than doing it manually or for individual users means you ensure the security of the application and not only the security of the application on every <span class="No-Break">user’s device.</span></li>
				<li><strong class="bold">Better monitoring</strong>: Deploying an application on production servers helps provide more control and data on what is working from the <span class="No-Break">user’s end.</span></li>
			</ul>
			<p>With software deployment defined, we will dive deeper into the tools and methods used for web <span class="No-Break">application deployment.</span></p>
			<h1 id="_idParaDest-229"><a id="_idTextAnchor243"/>Tools and methods of web application deployment</h1>
			<p>Deploying a <a id="_idIndexMarker684"/>web application for production has drastically evolved over the years. From manual deployment to automated deployment techniques, web application deployment has advanced, making the process more secure, smooth, and as fast as possible. There are many tools for web application deployment, but in <a id="_idIndexMarker685"/>this book, we will focus on the automated tools and configure the Django project and the React project for automated deployments when pushes are made on the remote repository of <span class="No-Break">the code.</span></p>
			<p>But where will the code be pushed first? Let’s start describing and learning how to use the tools for our full stack application deployment, starting with Git <span class="No-Break">and GitHub.</span></p>
			<h2 id="_idParaDest-230"><a id="_idTextAnchor244"/>Using Git and GitHub</h2>
			<p>Git is <a id="_idIndexMarker686"/>a <a id="_idIndexMarker687"/>popular tool used for source code version control and collaboration. It not only helps the user keep track of changes made to the code but also allows developers to work through small or large code bases, with collaboration made easier. In the following subsections, we will initialize a Git repository in the backend project, commit the changes, and then push the changes to a remote repository <span class="No-Break">on GitHub.</span></p>
			<h3>Creating a Git repository</h3>
			<p>Open a <a id="_idIndexMarker688"/>new terminal in the directory where you created the Django project and enter the <span class="No-Break">following command:</span></p>
			<pre class="console">
git init</pre>
			<p>This command will create an empty <strong class="source-inline">.git/</strong> directory in the current directory: this is a Git repository. This repository tracks all changes made to files in the project, helping build a history of changes made, with details on the files changed, the name of the person making the changes, and much <span class="No-Break">more information.</span></p>
			<p>After the initialization, we will need to ignore some files in the project. We are talking about files such as <strong class="source-inline">.pycache</strong>, <strong class="source-inline">.env</strong>, and the virtual environment directories. After all, we don’t want important information such as secret environment variables to be available in the project or useless cache files to be present in <span class="No-Break">the changes.</span></p>
			<p>Inside the directory of the Django API, create a new file called <strong class="source-inline">.gitignore</strong>. This file tells Git which files and directories to ignore when <span class="No-Break">tracking changes:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">.gitignore</p>
			<pre class="source-code">
__pycache__
venv
env
.env</pre>
			<p>These files<a id="_idIndexMarker689"/> and directories in the preceding code will be ignored. Next, we will add the change in the directory to the staging area. The staging area allows you to group related changes before committing them to the project history. As we have successfully added a <strong class="source-inline">.gitignore</strong> file, we can freely run the <strong class="source-inline">git </strong><span class="No-Break"><strong class="source-inline">add</strong></span><span class="No-Break"> command:</span></p>
			<pre class="console">
git add .</pre>
			<p>The dot (<strong class="source-inline">.</strong>) at the end of the command tells Git to only look for changed files in the current directory. To have a look at the changes to be committed to the Git history, run the <span class="No-Break">following command:</span></p>
			<pre class="console">
git status</pre>
			<p>The <strong class="source-inline">git status</strong> command is used to show the state of the working directory and also the staging area. Using the command, you can see changes that are tracked or not. The following figure shows an example of the output you <span class="No-Break">should have:</span></p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="image/Figure_12.1_B18821.jpg" alt="Figure 12.1 – Running the git status command"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.1 – Running the git status command</p>
			<p>We can now run the <strong class="source-inline">git commit</strong> command. A commit is an operation that writes the latest changes of the source code to the version control system history. In our case, with <strong class="source-inline">git commit</strong> command will save the changes to the <span class="No-Break">local repository:</span></p>
			<pre class="console">
git commit</pre>
			<p>The preceding command will prompt you to a text editor in the terminal or an app, depending on your system. Either way, you will need to enter a message. It’s important to enter a <a id="_idIndexMarker690"/>meaningful message because this message will be shown in the history of changes made to the source code. You can enter the following line if <span class="No-Break">you want:</span></p>
			<pre class="source-code">
Initialize git in API project</pre>
			<p>After saving the message, you can check the Git history with the <strong class="source-inline">git </strong><span class="No-Break"><strong class="source-inline">log</strong></span><span class="No-Break"> command:</span></p>
			<pre class="console">
git log</pre>
			<p>You will have something similar to the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer131" class="IMG---Figure">
					<img src="image/Figure_12.2_B18821.jpg" alt="Figure 12.2 – Writing a commit message"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.2 – Writing a commit message</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Writing meaningful commit messages is important, particularly in a team or a collaborative environment. You can read more about commit messages <span class="No-Break">at </span><a href="https://www.conventionalcommits.org/en/v1.0.0/"><span class="No-Break">https://www.conventionalcommits.org/en/v1.0.0/</span></a><span class="No-Break">.</span></p>
			<p>The project <a id="_idIndexMarker691"/>repository has been initialized locally; however, we want the code on GitHub. The next section will show you how to upload your code <span class="No-Break">on GitHub.</span></p>
			<h3>Uploading code on GitHub</h3>
			<p>GitHub<a id="_idIndexMarker692"/> is a <a id="_idIndexMarker693"/>code <a id="_idIndexMarker694"/>hosting platform for collaboration and version control. It helps developers around the world work together on projects and is actually the code hosting platform for the majority of popular open <span class="No-Break">source projects.</span></p>
			<p>On your GitHub account dashboard, on the navigation bar, create a <span class="No-Break">new repository:</span></p>
			<div>
				<div id="_idContainer132" class="IMG---Figure">
					<img src="image/Figure_12.3_B18821.jpg" alt="Figure 12.3 – Creating a repository on GitHub"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.3 – Creating a repository on GitHub</p>
			<p>Once it’s <a id="_idIndexMarker695"/>done, you will be redirected to a new page to enter basic information about the repository, such <a id="_idIndexMarker696"/>as the name of the repository and a description, stating if the repository is public or private, and adding a license or a <strong class="source-inline">.gitignore</strong> file. The repository name is required, and the other pieces of information <span class="No-Break">are optional.</span></p>
			<p>You can now create the repository, and you will have a similar page <span class="No-Break">to this:</span></p>
			<div>
				<div id="_idContainer133" class="IMG---Figure">
					<img src="image/Figure_12.4_B18821.jpg" alt="Figure 12.4 – Repository created"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.4 – Repository created</p>
			<p>We have an existing repository, and we want to push it to the GitHub platform. Let’s follow the steps for <strong class="bold">…or push an existing repository from the command line</strong>. Inside the directory of your backend project, open a new terminal, and let’s enter the <span class="No-Break">shell commands:</span></p>
			<pre class="console">
git remote add origin your_repository_git_url</pre>
			<p>The <strong class="source-inline">git remote</strong> command allows you to create, view, and delete connections to Git repositories hosted on the internet or another network. In the preceding command, we are adding a <a id="_idIndexMarker697"/>remote repository URL of the GitHub repository. Let’s change the name of the branch we are <span class="No-Break">working on:</span></p>
			<pre class="console">
git branch -M main</pre>
			<p>By default, when a repository is created using Git on a local machine, the branch of work is called master. What is a branch <span class="No-Break">in Git?</span></p>
			<p>Well, it is <a id="_idIndexMarker698"/>just a separate version of the main repository. This allows multiple developers to work on the same project. For example, if you are working with a backend developer who wants to add support for file uploading on posts and comments, instead of working directly on the main branch, the developer can create a new branch (<strong class="source-inline">feature/images-post</strong>) from the main branch. After the work is done on this branch, the <strong class="source-inline">feature/images-post</strong> branch can be merged with the <span class="No-Break">main branch.</span></p>
			<p>With the main branch created, we can now push the changes <span class="No-Break">to GitHub:</span></p>
			<pre class="console">
git push -u origin main</pre>
			<p>The <strong class="source-inline">git push</strong> command is used to upload local repository changes on the source code to a remote repository. In your case, the command will push the current code to your GitHub <span class="No-Break">repository URL.</span></p>
			<p>Reload the repository page on GitHub, and you will see something similar <span class="No-Break">to this:</span></p>
			<div>
				<div id="_idContainer134" class="IMG---Figure">
					<img src="image/Figure_12.5_B18821.jpg" alt="Figure 12.5 – Code pushed to the repository"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.5 – Code pushed to the repository</p>
			<p>And voilà! We <a id="_idIndexMarker699"/>have the code <a id="_idIndexMarker700"/>uploaded on GitHub. But this is just the code. What if you can have this running on a remote server that you can access <span class="No-Break">from anywhere?</span></p>
			<p>Let’s talk about platforms for web application deployment and deploy the Django backend <span class="No-Break">on AWS.</span></p>
			<h2 id="_idParaDest-231"><a id="_idTextAnchor245"/>Platforms for web application deployment</h2>
			<p>With<a id="_idIndexMarker701"/> the complexity of software development increasing and more innovative and data-intensive applications evolving or being created every year, there has been an explosion of services to allow teams to deploy their products on the internet and scale them with ease. This has created a new kind of service called cloud computing: the on-demand delivery of IT resources over the internet with pay-as-you-go <span class="No-Break">model pricing.</span></p>
			<p>In this book, we will deploy the <a id="_idIndexMarker702"/>backend on AWS, mostly on an <strong class="bold">Elastic Compute Cloud</strong> (<strong class="bold">EC2</strong>) instance, which is just a fancy name for a VPS. Well, actually, an AWS EC2 instance is a virtual server in Amazon’s EC2 for running web applications. Let’s start by creating the <span class="No-Break">AWS server.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">The following steps can work for any VPS, not just for an AWS VPS. If you can’t create a VPS on AWS, you can see other solutions such as Linode, <strong class="bold">Google Cloud Platform</strong> (<strong class="bold">GCP</strong>), Azure, or IBM. They<a id="_idIndexMarker703"/> provide free credit you can use for learning about <span class="No-Break">their services.</span></p>
			<h2 id="_idParaDest-232"><a id="_idTextAnchor246"/>Creating an EC2 instance</h2>
			<p>Follow<a id="_idIndexMarker704"/> these steps to create an <a id="_idIndexMarker705"/><span class="No-Break">EC2 instance:</span></p>
			<ol>
				<li>Make sure to be logged in to your AWS account. On the dashboard, open the <span class="No-Break">EC2 console:</span></li>
			</ol>
			<div>
				<div id="_idContainer135" class="IMG---Figure">
					<img src="image/Figure_12.6_B18821.jpg" alt="Figure 12.6 – Accessing the EC2 console"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.6 – Accessing the EC2 console</p>
			<ol>
				<li value="2">On the EC2 console, launch a <span class="No-Break">new instance:</span></li>
			</ol>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="image/Figure_12.7_B18821.jpg" alt="Figure 12.7 – Creating an EC2 instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.7 – Creating an EC2 instance</p>
			<p>You will <a id="_idIndexMarker706"/>be shown a<a id="_idIndexMarker707"/> page where you will have to configure <span class="No-Break">the instance.</span></p>
			<ol>
				<li value="3">Enter the name of <span class="No-Break">the instance:</span></li>
			</ol>
			<div>
				<div id="_idContainer137" class="IMG---Figure">
					<img src="image/Figure_12.8_B18821.jpg" alt="Figure 12.8 – Naming the EC2 instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.8 – Naming the EC2 instance</p>
			<ol>
				<li value="4">The next step is to choose an operating system. We will use <strong class="bold">Ubuntu Server 22.04 LTS</strong> for<a id="_idIndexMarker708"/> the <strong class="bold">Amazon Machine </strong><span class="No-Break"><strong class="bold">Image</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">AMI</strong></span><span class="No-Break">):</span></li>
			</ol>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="image/Figure_12.9_B18821.jpg" alt="Figure 12.9 – Choosing an operating system on the EC2 instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.9 – Choosing an operating system on the EC2 instance</p>
			<p>We are using Ubuntu here because of its security, versatility, and the policy of regular updates. However, feel free to use any other Linux distros you are <span class="No-Break">familiar with.</span></p>
			<ol>
				<li value="5">And finally, you <a id="_idIndexMarker709"/>will need <a id="_idIndexMarker710"/>to set the instance <a id="_idIndexMarker711"/>type and create a pair of keys for <strong class="bold">Secure Shell</strong> (<strong class="bold">SSH</strong>) login. After that, you can launch <span class="No-Break">the instance:</span></li>
			</ol>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="image/Figure_12.10_B18821.jpg" alt="Figure 12.10 – Launching the instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.10 – Launching the instance</p>
			<ol>
				<li value="6">Wait a<a id="_idIndexMarker712"/> moment, and<a id="_idIndexMarker713"/> the instance will <span class="No-Break">be created:</span></li>
			</ol>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="image/Figure_12.11_B18821.jpg" alt="Figure 12.11 – Instance created"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.11 – Instance created</p>
			<ol>
				<li value="7">Click on the <strong class="bold">View all instances</strong> button, and you will see the created <span class="No-Break">Postagram instance.</span></li>
				<li>Click on the checkbox next to the name of the instance and click the <span class="No-Break"><strong class="bold">Connect</strong></span><span class="No-Break"> button:</span></li>
			</ol>
			<div>
				<div id="_idContainer141" class="IMG---Figure">
					<img src="image/Figure_12.12_B18821.jpg" alt="Figure 12.12 – Connecting to an EC2 instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.12 – Connecting to an EC2 instance</p>
			<p>This will redirect <a id="_idIndexMarker714"/>you to a page <a id="_idIndexMarker715"/>with the information and steps needed to connect <span class="No-Break">via SSH:</span></p>
			<div>
				<div id="_idContainer142" class="IMG---Figure">
					<img src="image/Figure_12.13_B18821.jpg" alt="Figure 12.13 – Connecting via SSH to an EC2 instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.13 – Connecting via SSH to an EC2 instance</p>
			<ol>
				<li value="9">In your terminal, type the following command to connect <span class="No-Break">via SSH:</span><pre class="source-code">
<strong class="bold">ssh -i path/to/your_keypair.pem ec2-user@ipaddress</strong></pre></li>
				<li>Once you are connected to the server, we will configure it to have a Django backend running on this machine and accessible from <span class="No-Break">the internet:</span><pre class="source-code">
<strong class="bold">sudo apt update</strong></pre><pre class="source-code">
<strong class="bold">sudo apt upgrade</strong></pre></li>
			</ol>
			<p>The preceding <a id="_idIndexMarker716"/>commands update the <strong class="source-inline">apt</strong> packages index of Ubuntu packages and upgrade all packages on <span class="No-Break">the server.</span></p>
			<p>The <a id="_idIndexMarker717"/>Django project will run on port <strong class="source-inline">8000</strong> on the machine, so we have to allow a connection to this port. By default, EC2 instances will only allow connections on ports <strong class="source-inline">80</strong> for HTTP requests, <strong class="source-inline">22</strong> for <a id="_idIndexMarker718"/>SSH connections, and—sometimes—<strong class="source-inline">443</strong> for <strong class="bold">Secure Sockets Layer</strong> (<strong class="bold">SSL</strong>) connections. </p>
			<p>You can allow connections on port <strong class="source-inline">8000</strong> directly on the <strong class="bold">Details</strong> page of the created EC2 instance to access the <strong class="bold">Security</strong> tab on the list of tabs at the bottom of the page and click on the security <span class="No-Break">setting group:</span></p>
			<div>
				<div id="_idContainer143" class="IMG---Figure">
					<img src="image/Figure_12.14_B18821.jpg" alt="Figure 12.14 – Security tab"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.14 – Security tab</p>
			<p>On the security group setting, access the <strong class="bold">Actions</strong> menu and click on <strong class="bold">Edit inbound</strong> <strong class="bold">rules</strong>. You will have access to a page where you can add a new rule, <span class="No-Break">as follows:</span></p>
			<ul>
				<li>The type of connection is set to <span class="No-Break"><strong class="bold">Custom TCP</strong></span></li>
				<li>The port range is set <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">8000</strong></span></li>
				<li>The source is set to <strong class="source-inline">0.0.0.0</strong> to indicate that all requests should be redirected to the machine on <span class="No-Break">port </span><span class="No-Break"><strong class="source-inline">8000</strong></span></li>
				<li>And finally, add a default description to not forget why we have added <span class="No-Break">this rule</span></li>
			</ul>
			<p>Click on <strong class="bold">Save rules</strong> to <a id="_idIndexMarker719"/>save the changes and allow the EC2 instance to accept connections<a id="_idIndexMarker720"/> on <span class="No-Break">port </span><span class="No-Break"><strong class="source-inline">8000</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer144" class="IMG---Figure">
					<img src="image/Figure_12.15_B18821.jpg" alt="Figure 12.15 – Adding a new security rule"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.15 – Adding a new security rule</p>
			<p>The server is now ready for work, and we can now run the Django backend application. Let’s see the next steps in the <span class="No-Break">following sections.</span></p>
			<h2 id="_idParaDest-233"><a id="_idTextAnchor247"/>Configuring the server for the Django project</h2>
			<p>The<a id="_idIndexMarker721"/> source code<a id="_idIndexMarker722"/> for the Django project is hosted on GitHub. It’s definitely possible to directly use <strong class="source-inline">scp</strong> to copy the code from your machine to the remote machine but let’s go with Git, as it will be an important command of our workflow. On the terminal of the remote instance, enter the <span class="No-Break">following command:</span></p>
			<pre class="console">
git clone your_repository_git_url</pre>
			<p>In my case, I am using the following repository for <span class="No-Break">this project:</span></p>
			<pre class="console">
git clone https://github.com/PacktPublishing/Full-stack-Django-and-React.git –branch chap12</pre>
			<p>The <strong class="source-inline">git clone</strong> command is used to get a copy of an existing repository from a remote machine on the internet or another network. The <strong class="source-inline">–branch</strong> flag is used to denote a specific branch you want <span class="No-Break">to clone.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">As I am working using the repository of the project in this book, the current code and actions done are on the <strong class="source-inline">chap12</strong> branch. In your case, if you are using your own repository, you may not have to use the <strong class="source-inline">–branch</strong> flag. Also, depending on if the GitHub repository is private or public, you will only enter your GitHub credentials if the repository <span class="No-Break">is private.</span></p>
			<p>The <strong class="source-inline">git clone</strong> command <a id="_idIndexMarker723"/>will clone the content of the project in a new directory. Enter the newly <a id="_idIndexMarker724"/>created directory and let’s start configuring the project. We will follow most of the steps done in <a href="B18221_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Creating a Django Project</em>, until the creation of the <span class="No-Break">Django project:</span></p>
			<ol>
				<li value="1">First of all, create a virtual environment with the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">python3 -m venv venv</strong></pre></li>
				<li>And activate the virtual environment with the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">source venv/bin/activate</strong></pre></li>
				<li>Let’s install the packages from the <span class="No-Break"><strong class="source-inline">requirements.txt</strong></span><span class="No-Break"> file:</span><pre class="source-code">
pip install -r requirements.txt</pre></li>
			</ol>
			<p>Great! The project is ready, but we need to configure a Postgres server to have the Django <span class="No-Break">project running.</span></p>
			<h2 id="_idParaDest-234"><a id="_idTextAnchor248"/>Postgres configuration and deployment</h2>
			<p>In <a href="B18221_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic">Chapter 1</em></span></a> of the<a id="_idIndexMarker725"/> book, <em class="italic">Creating a Django Project</em>, we configured Postgres by directly<a id="_idIndexMarker726"/> installing an executable or building the source code. On the EC2 instance, we will directly use the <strong class="source-inline">apt</strong> tool to install the <a id="_idIndexMarker727"/>Postgres server. You can follow these steps to install the Postgres server on the <span class="No-Break">EC2 machine:</span></p>
			<ol>
				<li value="1">Enter the following command to install the <span class="No-Break">Postgres server:</span><pre class="source-code">
<strong class="bold">sudo apt install postgresql-14</strong></pre></li>
				<li>Let’s connect to the <strong class="source-inline">psql</strong> console and create <span class="No-Break">a database:</span><pre class="source-code">
<strong class="bold">sudo su postgres </strong></pre><pre class="source-code">
<strong class="bold">psql</strong></pre></li>
				<li>Great! Let’s create <a id="_idIndexMarker728"/>the <a id="_idIndexMarker729"/>database with the same information on the <strong class="source-inline">DATABASES</strong> settings <a id="_idIndexMarker730"/>in the <span class="No-Break"><strong class="source-inline">CoreRoot/settings.py</strong></span><span class="No-Break"> file:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
...
DATABASES = {
    'default': {
        'ENGINE':
          'django.db.backends.postgresql_psycopg2',
        'NAME': coredb,
        'USER': 'core',
        'PASSWORD': 'wCh29&amp;HE&amp;T83',
        'HOST': 'localhost',
        'PORT': '5342',
    }
}
...</pre>
			<ol>
				<li value="4">Enter the following command on the <strong class="source-inline">psql</strong> console to create the <span class="No-Break"><strong class="source-inline">coredb</strong></span><span class="No-Break"> database:</span><pre class="source-code">
<strong class="bold">CREATE DATABASE coredb;</strong></pre></li>
				<li>To connect to the database, we need a user with a password. Execute the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">CREATE USER core WITH PASSWORD 'wCh29&amp;HE&amp;T83';</strong></pre></li>
				<li>And the <a id="_idIndexMarker731"/>next step is to grant access to our database to the <span class="No-Break">new user:</span><pre class="source-code">
<strong class="bold">GRANT ALL PRIVILEGES ON DATABASE coredb TO core;</strong></pre></li>
				<li>And we are <a id="_idIndexMarker732"/>nearly done. We also need to make sure this user can create a database. This will be helpful when we can run tests. To run tests, Django will configure a full environment but will also use <span class="No-Break">a database:</span><pre class="source-code">
<strong class="bold">GRANT CREATE PRIVILEGE TO core;</strong></pre></li>
			</ol>
			<p>And we are done <a id="_idIndexMarker733"/>with the<a id="_idIndexMarker734"/> creation of the database. Next, let’s connect this database to our <span class="No-Break">Django project:</span></p>
			<ol>
				<li value="1">In the project directory, run the <span class="No-Break"><strong class="source-inline">migrate</strong></span><span class="No-Break"> command:</span><pre class="source-code">
<strong class="bold">python manage.py migrate</strong>.</pre></li>
				<li>The <strong class="source-inline">migrate</strong> command should pass, and we can now start the Django server by running the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">python manage.py runserver 0.0.0.0:8000</strong></pre></li>
				<li>With the Django server running, visit <strong class="source-inline">http://public_ip:8000</strong> in your web browser to access your Django project. You will have a page similar to the <span class="No-Break">following figure:</span></li>
			</ol>
			<div>
				<div id="_idContainer145" class="IMG---Figure">
					<img src="image/Figure_12.16_B18821.jpg" alt="Figure 12.16 – DisallowedHost error"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.16 – DisallowedHost error</p>
			<p>This is actually an error. This comes from the <strong class="source-inline">ALLOWED_HOSTS</strong> setting being empty. It is implemented by Django to prevent security vulnerabilities such as HTTP host<a id="_idIndexMarker735"/> header attacks. The <strong class="source-inline">ALLOWED_HOSTS</strong> setting contains a list of hostnames or domain names that Django <span class="No-Break">can serve:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
...
ALLOWED_HOSTS = []
...</pre>
			<ol>
				<li value="4">As we are<a id="_idIndexMarker736"/> running the project from the terminal, let’s modify the settings file directly on <span class="No-Break">the server:</span><pre class="source-code">
vim CoreRoot/settings.py</pre></li>
			</ol>
			<p>Or, you can use the <strong class="source-inline">emacs</strong> or <strong class="source-inline">nano</strong> command. It’s up to you. The following line tells Django to accept requests from whatever is <span class="No-Break">the hostname:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">CoreRoot/settings.py</p>
			<pre class="source-code">
...
<strong class="bold">ALLOWED_HOSTS = ["*"]</strong>
...</pre>
			<ol>
				<li value="5">Save the file and launch the <span class="No-Break">server again:</span><pre class="source-code">
python manage.py runserver 0.0.0.0:8000</pre></li>
				<li>Then, again, visit <strong class="source-inline">http://public_ip:8000</strong> in your web browser. You will see <span class="No-Break">the</span><span class="No-Break"><a id="_idIndexMarker737"/></span><span class="No-Break"> following:</span></li>
			</ol>
			<div>
				<div id="_idContainer146" class="IMG---Figure">
					<img src="image/Figure_12.17_B18821.jpg" alt="Figure 12.17 – Issues with DisallowedHost resolved"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.17 – Issues with DisallowedHost resolved</p>
			<p>Great! The<a id="_idIndexMarker738"/> project is running fine on <a id="_idIndexMarker739"/>the internet, and you can even play with the API using an API client such as Postman or Insomnia. Congratulations! You have successfully deployed your Django application on an AWS <span class="No-Break">EC2 machine.</span></p>
			<p>However, we have a lot of issues (we can access debugging information directly on the internet, as in <span class="No-Break"><em class="italic">Figure 12</em></span><em class="italic">.17</em>), and we made some dangerous decisions such as not serving the API through HTTPS or not correctly setting allowed hosts throughout the deployment. Let’s explore these issues in the <span class="No-Break">next section.</span></p>
			<h2 id="_idParaDest-235"><a id="_idTextAnchor249"/>Errors made when deploying on EC2</h2>
			<p>We have <a id="_idIndexMarker740"/>successfully deployed the<a id="_idIndexMarker741"/> Django backend on AWS. However, I decided to ignore some important and best practices for deployment so that we can have the Django server running ASAP. Let’s correct this. Let’s start with the errors that Django can show us. In the terminal of the project on the remote server, run the <span class="No-Break">following command:</span></p>
			<pre class="console">
python manage.py check –deploy</pre>
			<p>Here’s the<a id="_idIndexMarker742"/> output of the <span class="No-Break">preceding command:</span></p>
			<pre class="console">
System check identified some issues:
WARNINGS:
?: (security.W004) You have not set a value for the SECURE_HSTS_SECONDS setting. If your entire site is served only over SSL, you may want to consider setting a value and enabling HTTP Strict Transport Security. Be sure to read the documentation first; enabling HSTS carelessly can cause serious, irreversible problems.
?: (security.W008) Your SECURE_SSL_REDIRECT setting is not set to True. Unless your site should be available over both SSL and non-SSL connections, you may want to either set this setting True or configure a load balancer or reverse-proxy server to redirect all connections to HTTPS.
?: (security.W009) Your SECRET_KEY has less than 50 characters, less than 5 unique characters, or it's prefixed with 'django-insecure-' indicating that it was generated automatically by Django. Please generate a long and random SECRET_KEY, otherwise many of Django's security-critical features will be vulnerable to attack.
?: (security.W012) SESSION_COOKIE_SECURE is not set to True. Using a secure-only session cookie makes it more difficult for network traffic sniffers to hijack user sessions.
?: (security.W016) You have 'django.middleware.csrf.CsrfViewMiddleware' in your MIDDLEWARE, but you have not set CSRF_COOKIE_SECURE to True. Using a secure-only CSRF cookie makes it more difficult for network traffic sniffers to steal the CSRF token.
?: (security.W018) You should not have DEBUG set to True in deployment.
System check identified 6 issues (0 silenced).</pre>
			<p>That’s a lot of things. As <a id="_idIndexMarker743"/>we are building <a id="_idIndexMarker744"/>an API, let’s focus on the security issues that concern <span class="No-Break">our API:</span></p>
			<ul>
				<li><strong class="source-inline">SECRET_KEY</strong>: This is an important setting in Django. It is used for all sessions, cryptographic signings, and even <strong class="source-inline">PasswordReset</strong> tokens. Having an already set value for <strong class="source-inline">SECRET_KEY</strong> can lead to dangerous security issues such as privilege escalation and remote <span class="No-Break">code execution.</span></li>
				<li><strong class="source-inline">DEBUG</strong>, which is set to <strong class="source-inline">True</strong>. That is basically why we were able to see the <strong class="source-inline">DisallowedHost</strong> error. Imagine an attacker going through your API, causing a <strong class="source-inline">500</strong> error, and then being able to read everything. That would be <span class="No-Break">very bad.</span></li>
			</ul>
			<p>Those are mostly the errors that Django has detected. In the last section, <em class="italic">Postgres configuration and deployment</em>, we resolved the issue of the <strong class="source-inline">DisallowedHost</strong> error by having Django allow whichever hostname comes in a Host header. Well, this is actually bad because<a id="_idIndexMarker745"/> it can lead to an <strong class="bold">HTTP Host header attack</strong>, a <a id="_idIndexMarker746"/>technique used for web cache poisoning, poisoning links in the email, and modification of sensitive operations such as <span class="No-Break">password reset.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">You can read <a id="_idIndexMarker747"/>more about HTTP Host header attacks <span class="No-Break">at </span><a href="https://www.invicti.com/web-vulnerability-scanner/vulnerabilities/http-header-injection/"><span class="No-Break">https://www.invicti.com/web-vulnerability-scanner/vulnerabilities/http-header-injection/</span></a><span class="No-Break">.</span></p>
			<p>There are also some issues concerning the developer experience. It’s true that we have seen how to use Git and GitHub to host source code online, clone it on a remote server, and then configure it for deployment. You can repeat the same process, right? But what happens when you have to update the code for features or fixes multiple times per day? It can quickly become draining, so we need a solution for automated deployment on our <span class="No-Break">EC2 server.</span></p>
			<p>Also, we have Postgres and, finally, the Django project running separately. Sometimes, there might come a time when you will need to add another service to the machine. This can be done manually, but it creates an issue: the production environment starts to become different from the <span class="No-Break">development environment.</span></p>
			<p>It is an<a id="_idIndexMarker748"/> important habit to make sure that the development environment and the production environment are as similar as possible; this can make the reproduction of bugs easier but also the development of <span class="No-Break">features predictable.</span></p>
			<p>All these issues will be addressed in the next chapters. You will be introduced to environment variables, Docker, NGINX, and <strong class="bold">continuous integration/continuous deployment</strong> (<strong class="bold">CI/CD</strong>) concepts <a id="_idIndexMarker749"/>with <span class="No-Break">GitHub Actions.</span></p>
			<h1 id="_idParaDest-236"><a id="_idTextAnchor250"/>Summary</h1>
			<p>In this chapter, we have successfully deployed a Django application on an EC2 instance. Before deploying the Django application, we used Git to create a repository on a local machine, then created a remote repository on GitHub and pushed the <span class="No-Break">changes online.</span></p>
			<p>We have also learned how to configure a server for deployment manually with the installation of essential and interesting tools such as the Postgres server. We also explored the errors made when deploying the application and how we will address these errors in the <span class="No-Break">following chapters.</span></p>
			<p>These errors will be resolved in the next chapters, but first, we’ll learn more about environment variables and Docker in the <span class="No-Break">next chapter.</span></p>
			<h1 id="_idParaDest-237"><a id="_idTextAnchor251"/>Questions</h1>
			<ol>
				<li value="1">What is the usage of a <span class="No-Break">Git branch?</span></li>
				<li>What is the difference between Git <span class="No-Break">and GitHub?</span></li>
				<li>What is an HTTP Host <span class="No-Break">header attack?</span></li>
				<li>What is the use of <strong class="source-inline">SECRET_KEY</strong> <span class="No-Break">in Django?</span></li>
			</ol>
		</div>
		<div>
			<div id="_idContainer148" class="IMG---Figure">
			</div>
		</div>
	</body></html>