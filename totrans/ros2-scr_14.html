<html><head></head><body>
		<div id="_idContainer073" class="calibre2">
			<h1 class="chapter-number" id="_idParaDest-251"><a id="_idTextAnchor519" class="pcalibre calibre4 pcalibre1"/>11</h1>
			<h1 id="_idParaDest-252" class="calibre6"><a id="_idTextAnchor520" class="pcalibre calibre4 pcalibre1"/>Creating a URDF for a Robot</h1>
			<p class="calibre3">In the previous chapter, we started with an intuitive introduction to TFs, or TransForms. You have seen that TFs are very important; they will be the backbone of almost any ROS application. We <a id="_idIndexMarker699" class="pcalibre calibre4 pcalibre1"/>concluded by saying that in order to generate TFs for a robot, you need to create a <strong class="bold">Unified Robot Description Format</strong> (<span><strong class="bold">URDF</strong></span><span>) file.</span></p>
			<p class="calibre3">Basically, a URDF file will contain a description of all the elements of a robot. You will define each <strong class="bold">link</strong> (rigid part) of the robot. Then, to create relationships between the links, you will add some <strong class="bold">joints</strong>, which <a id="_idIndexMarker700" class="pcalibre calibre4 pcalibre1"/>will be used to generate <span>the TFs.</span></p>
			<p class="calibre3">To write the content of a URDF, we will use XML. As you develop the URDF, you will be able to visualize it with RViz. This will be very helpful to see whether the links and joints/TFs are correct. We will also improve the URDF file and make it more dynamic with an <a id="_idIndexMarker701" class="pcalibre calibre4 pcalibre1"/>additional tool <span>named </span><span><strong class="bold">Xacro</strong></span><span>.</span></p>
			<p class="calibre3">So, in this chapter, we are going to start the project for <em class="italic">Part 3</em>, with the URDF for a robot. We will create a mobile base with two wheels. This will be the foundation for the next few chapters. You can find the finalized URDF files inside the <strong class="source-inline1">ch11</strong> folder of the book’s GitHub <span>repository (</span><a href="https://github.com/PacktPublishing/ROS-2-from-Scratch" class="pcalibre calibre4 pcalibre1"><span>https://github.com/PacktPublishing/ROS-2-from-Scratch</span></a><span>).</span></p>
			<p class="calibre3">The hardest part about URDF is understanding how to assemble two links of a robot with a joint. Getting to do this without guidance is quite difficult because there are so many parameters and origins you can modify. I will explain the complete process, step by step, to make sure that you build something that <span>works properly.</span></p>
			<p class="calibre3">By the end of this chapter, you will be able to create your own URDF for almost any robot powered <span>by ROS.</span></p>
			<p class="calibre3">In this chapter, we will cover the <span>following topics:</span></p>
			<ul class="calibre9">
				<li class="calibre10">Creating a URDF with <span>a link</span></li>
				<li class="calibre10">The process of assembling links <span>and joints</span></li>
				<li class="calibre10">Creating a URDF for a <span>mobile robot</span></li>
				<li class="calibre10">Improving the URDF <span>with Xac<a id="_idTextAnchor521" class="pcalibre calibre4 pcalibre1"/>ro</span></li>
			</ul>
			<h1 id="_idParaDest-253" class="calibre6"><a id="_idTextAnchor522" class="pcalibre calibre4 pcalibre1"/>Creating a URDF with a link</h1>
			<p class="calibre3">In this section, you will dive directly in and create your first URDF. We will first create an XML file <a id="_idIndexMarker702" class="pcalibre calibre4 pcalibre1"/>for the URDF. In this file, we will add a link, which will represent one rigid part of a robot, and visualize it in RViz. We will also explore the different types of shapes you can use—boxes, cylinders, and <span>so on.</span></p>
			<p class="calibre3">This will be a good first step, so you can get familiar with URDF and be ready to dive into the process of adding several links and joints together (in the <span>next section).</span></p>
			<p class="calibre3">Let’s get started by setting up our <span>URDF fi<a id="_idTextAnchor523" class="pcalibre calibre4 pcalibre1"/>le.</span></p>
			<h2 id="_idParaDest-254" class="calibre6"><a id="_idTextAnchor524" class="pcalibre calibre4 pcalibre1"/>Setting up a URDF file</h2>
			<p class="calibre3">A URDF file is simply an XML file with the <strong class="source-inline1">.</strong><span><strong class="source-inline1">urdf</strong></span><span> extension.</span></p>
			<p class="calibre3">Now, to keep <a id="_idIndexMarker703" class="pcalibre calibre4 pcalibre1"/>things simple for this chapter, we will create a URDF file inside our home directory. In the next chapter, you will learn how to correctly package the URDF inside a ROS <span>2 application.</span></p>
			<p class="calibre3">How should you name the URDF file? You could choose any name; it doesn’t really matter. Usually, you will give it the name of your robot. If your robot’s name is <strong class="source-inline1">abc</strong>, then you will create an <strong class="source-inline1">abc.urdf</strong> file. Let’s use the name <strong class="source-inline1">my_robot</strong>, as we previously did in <span>this book.</span></p>
			<p class="calibre3">Open a terminal and create a new file in your <span>home directory:</span></p>
			<pre class="console">
$ cd
$ touch my_robot.urdf</pre>			<p class="calibre3">You can then open this file with any text editor or IDE, for example, with <span>VS Code:</span></p>
			<pre class="console">
$ code my_robot.urdf</pre>			<p class="calibre3">Here is the minimum code you have to write inside a <span>URDF file:</span></p>
			<pre class="source-code">
&lt;?xml version="1.0"?&gt;
&lt;robot name="my_robot"&gt;
&lt;/robot&gt;</pre>			<p class="calibre3">We first open the file with the <strong class="source-inline1">&lt;?xml version="1.0"?&gt;</strong> line, to specify that this file is an XML file—we also give the <span>XML version.</span></p>
			<p class="calibre3">Then, you need to open and close a <strong class="source-inline1">&lt;robot&gt;</strong> tag. Everything you write in your URDF will be <a id="_idIndexMarker704" class="pcalibre calibre4 pcalibre1"/>inside this tag. You also have to provide the name of the robot with the <span><strong class="source-inline1">name</strong></span><span> argument.</span></p>
			<p class="calibre3">Now, this is the minimum code for a URDF, but it will be useless if you don’t define at least one element. Let’s add a link inside <span>this <a id="_idTextAnchor525" class="pcalibre calibre4 pcalibre1"/>URDF.</span></p>
			<h2 id="_idParaDest-255" class="calibre6"><a id="_idTextAnchor526" class="pcalibre calibre4 pcalibre1"/>Creating a link</h2>
			<p class="calibre3">You will now write your first link, which corresponds to one rigid part of a robot, and visualize <a id="_idIndexMarker705" class="pcalibre calibre4 pcalibre1"/>it in RViz. With this, you will be able to see whether the link is correctly defined and modify it <span>if necessary.</span></p>
			<p class="calibre3">Let’s start with the XML code to add <span>the<a id="_idTextAnchor527" class="pcalibre calibre4 pcalibre1"/> link.</span></p>
			<h3 class="calibre8">Basic code for a link</h3>
			<p class="calibre3">To create <a id="_idIndexMarker706" class="pcalibre calibre4 pcalibre1"/>a visual element for a link, you can use existing shapes: boxes, cylinders, and spheres (we will also see <a id="_idIndexMarker707" class="pcalibre calibre4 pcalibre1"/>later how to include a custom shape made from <strong class="bold">Computer-Aided Design</strong> (<span><strong class="bold">CAD</strong></span><span>) software).</span></p>
			<p class="calibre3">To get started, let’s imagine the main base of a robot, represented as a box. The box is 60 cm x 40 cm x 20 cm, or <strong class="source-inline1">0.6</strong> m x <strong class="source-inline1">0.4</strong> m x <span><strong class="source-inline1">0.2</strong></span><span> m.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">In ROS, only the metric system is used. Here are a few units that we will use in <span>this chapter:</span></p>
			<p class="callout">- Meters will be used for distances. If you have to specify 70 mm for example, you will <span>write </span><span><strong class="source-inline">0.07</strong></span><span>.</span></p>
			<p class="callout">- Radians will be used for angles. 180 degrees corresponds to pi (about <span><strong class="source-inline">3.14</strong></span><span>) radians.</span></p>
			<p class="callout">- Meters per second will be used for <span>velocity instances.</span></p>
			<p class="calibre3">Here <a id="_idIndexMarker708" class="pcalibre calibre4 pcalibre1"/>is the code for this <span>first link:</span></p>
			<pre class="source-code">
&lt;robot name="my_robot"&gt;
    &lt;link name="base_link"&gt;
        &lt;visual&gt;
            &lt;geometry&gt;
                &lt;box size="0.6 0.4 0.2" /&gt;
            &lt;/geometry&gt;
            &lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;
        &lt;/visual&gt;
    &lt;/link&gt;
&lt;/robot&gt;</pre>			<p class="calibre3">Make sure to define the <strong class="source-inline1">&lt;link&gt;</strong> inside the <strong class="source-inline1">&lt;robot&gt;</strong> tag. Also, although indentation is not a requirement in XML, the best practice is to add some indentation to get a more readable file. Here, I used four spaces for <span>each indentation.</span></p>
			<p class="calibre3">Let’s analyze the elements of this link. The <strong class="source-inline1">&lt;link&gt;</strong> tag defines the link. All the properties for this link must be inside the tag. You also have to provide a <strong class="source-inline1">name</strong> attribute for the link. As a convention, for the first link, we use <strong class="source-inline1">base_link</strong>. </p>
			<p class="calibre3">Then, inside this tag, we have the <strong class="source-inline1">&lt;visual&gt;</strong> tag. If you want to define a visual appearance for the link (rigid part), you can do so with this tag. Inside, you will have <span>the following:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="source-inline">&lt;geometry&gt;</strong>: This will define the shape of the link. Here, we use the <strong class="source-inline">&lt;box&gt;</strong> tag and provide the dimensions with the <span><strong class="source-inline">size</strong></span><span> attribute.</span></li>
				<li class="calibre10"><strong class="source-inline">&lt;origin&gt;</strong>: This tag is quite important, as it defines the origin of the visual relative to the origin of the link. We will come back to this later in this chapter and see how to avoid confusion. The origin contains six elements for translation <span>and rotation.</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">The origin of rotation is written as <strong class="source-inline">rpy</strong>. This means <em class="italic">roll</em>, <em class="italic">pitch</em>, <em class="italic">yaw</em>. It’s the same as <strong class="source-inline">x</strong>, <strong class="source-inline">y</strong>, and <strong class="source-inline">z</strong>, but using different names. Roll, pitch, and yaw are quite frequently used for aviation. You just need to get used to it <span>for URDF.</span></p>
			<p class="calibre3">As you <a id="_idIndexMarker709" class="pcalibre calibre4 pcalibre1"/>can see, we first set all origins to <strong class="source-inline1">0</strong>. For now, the only thing we have specified are the dimensions o<a id="_idTextAnchor528" class="pcalibre calibre4 pcalibre1"/>f <span>the box.</span></p>
			<h3 class="calibre8">Visualizing the URDF in RViz</h3>
			<p class="calibre3">We have enough code to visualize the URDF in RViz. The goal here is to see the box in 3D and <a id="_idIndexMarker710" class="pcalibre calibre4 pcalibre1"/>verify that everything <span>is correct.</span></p>
			<p class="calibre3">Doing this is very important when you develop a URDF. I would recommend always doing <span>the following:</span></p>
			<ol class="calibre11">
				<li class="calibre10">Make the smallest modification (add or <span>modify something)</span></li>
				<li class="calibre10">Visualize the URDF <span>in RViz</span></li>
				<li class="calibre10">If correct, continue with the next feature; if not, go back, fix it, and <span>check again</span></li>
			</ol>
			<p class="calibre3">Now, how can we visualize the URDF <span>in RViz?</span></p>
			<p class="calibre3">Good news: we can reuse the <strong class="source-inline1">urdf_tutorial</strong> package (installed in <a href="B22403_10.xhtml#_idTextAnchor488" class="pcalibre calibre4 pcalibre1"><span><em class="italic">Chapter 10</em></span></a>) and provide our own URDF instead of the example ones. This is great because we can easily test a URDF file outside of a ROS 2 workspace, and we don’t need to create any <span>package yet.</span></p>
			<p class="calibre3">Open a terminal and start the <strong class="source-inline1">display.launch.py</strong> launch file, with the absolute path to your URDF file for the <span><strong class="source-inline1">model</strong></span><span> argument:</span></p>
			<pre class="console">
$ ros2 launch urdf_tutorial display.launch.py \ model:=/home/&lt;user&gt;/my_robot.urdf</pre>			<p class="calibre3">You will then see a box (red color by default) inside <strong class="bold">RViz</strong>. You will also have the <strong class="bold">Joint State Publisher</strong> window, empty, with <span>no cursor.</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer066">
					<img alt="Figure 11.1 – Visualization of your URDF in RViz" src="image/B22403_11_1.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.1 – Visualization of your URDF in RViz</p>
			<p class="calibre3">If you <a id="_idIndexMarker711" class="pcalibre calibre4 pcalibre1"/>go to <strong class="bold">RobotModel</strong> | <strong class="bold">Links</strong>, you will see the <strong class="source-inline1">base_link</strong>. This is the link you have created; you can enable or disable the visual for <span>that link.</span></p>
			<p class="calibre3">Navigate around the box in <strong class="bold">RViz</strong>. You will see that the visual (box) is centered around the link origin. You can leave it like this or decide to offset the visual relative to the frame. Let<a id="_idTextAnchor529" class="pcalibre calibre4 pcalibre1"/>’s <span>do this.</span></p>
			<h3 class="calibre8">Modifying the origin of the visual</h3>
			<p class="calibre3">The link <a id="_idIndexMarker712" class="pcalibre calibre4 pcalibre1"/>we have created is perfectly fine. However, we will offset the visual a bit so that the origin is not centered in the middle of the box, but instead, at the bottom of <span>the box.</span></p>
			<p class="calibre3">You don’t necessarily need to do this. Sometimes, leaving the visual centered on the link origin is what you need. We will see some examples to illustrate this when we create the URDF for the mobile base a bit later in this chapter. For now, let’s just assume we want to offset <span>the visual.</span></p>
			<p class="calibre3">To offset the visual, we will need to modify the <strong class="source-inline1">&lt;origin&gt;</strong> tag inside the <strong class="source-inline1">&lt;visual&gt;</strong> tag. In this <strong class="source-inline1">&lt;origin&gt;</strong> tag, we have six elements for translation and rotation. We just want to move the visual up, so the only component we need to modify is the translation on the <em class="italic">Z</em>-axis (if you remember, with the right-hand rule, Z <span>points up).</span></p>
			<p class="calibre3">How much <a id="_idIndexMarker713" class="pcalibre calibre4 pcalibre1"/>of an offset should we apply? As the box is currently centered on the link origin, we need to lift it up by half of <span>its height.</span></p>
			<p class="calibre3">We have defined the height as <strong class="source-inline1">0.2</strong> m, so we need to offset the visual by <span><strong class="source-inline1">0.1</strong></span><span> m.</span></p>
			<p class="calibre3">Modify this line so that the z offset <span>is </span><span><strong class="source-inline1">0.1</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;origin xyz="0 0 0.1" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">Save the file, and to visualize the change, stop RViz (press <em class="italic">Ctrl</em> + <em class="italic">C</em> on the terminal where you launched it with <strong class="source-inline1">urdf_tutorial</strong>), and start it again. You can do this every time you modify <span>the URDF.</span></p>
			<p class="calibre3">Now, you should see the box sitting on the ground, which means that the offset for the visual was <span>correctly applied.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The link origin is still the same; you only changed the visual relative to the link. This is an important distinction. If you feel confused, continue reading and everything will make sense after you see the full process with links <span>and joints.</span></p>
			<p class="calibre3">You have created your first link. Let’s now see what kind of shapes you can use, and what customization you can add to the links <a id="_idTextAnchor530" class="pcalibre calibre4 pcalibre1"/>in <span>your URDF.</span></p>
			<h2 id="_idParaDest-256" class="calibre6"><a id="_idTextAnchor531" class="pcalibre calibre4 pcalibre1"/>Customizing the link visual</h2>
			<p class="calibre3">A link is <a id="_idIndexMarker714" class="pcalibre calibre4 pcalibre1"/>one rigid part of <a id="_idIndexMarker715" class="pcalibre calibre4 pcalibre1"/>your robot. You could make it look like anything <span>you want.</span></p>
			<p class="calibre3">Let’s explore the different shapes you can give to your links, and how to chan<a id="_idTextAnchor532" class="pcalibre calibre4 pcalibre1"/>ge <span>their color.</span></p>
			<h3 class="calibre8">Different shapes for a link</h3>
			<p class="calibre3">As you saw with the first link you created, you will define the shape of the link inside the <strong class="source-inline1">&lt;geometry&gt;</strong> tag sitting in the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">visual&gt;</strong></span><span> tag.</span></p>
			<p class="calibre3">There are <a id="_idIndexMarker716" class="pcalibre calibre4 pcalibre1"/>three types of basic shapes you can use. For each one you will need to provide the dimensions with <span>different attributes:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="source-inline">&lt;box&gt;</strong>: You need to add a <strong class="source-inline">size</strong> argument with three components: <strong class="source-inline">x</strong>, <strong class="source-inline">y</strong>, <span>and </span><span><strong class="source-inline">z</strong></span></li>
				<li class="calibre10"><strong class="source-inline">&lt;cylinder&gt;</strong>: You need to add two arguments, <strong class="source-inline">radius</strong> <span>and </span><span><strong class="source-inline">length</strong></span></li>
				<li class="calibre10"><strong class="source-inline">&lt;sphere&gt;</strong>: You need only one <span>argument, </span><span><strong class="source-inline">radius</strong></span></li>
			</ul>
			<p class="calibre3">We have just seen how to create a box in the previous code example. Here is an example of a cylinder of radius <strong class="source-inline1">0.2</strong> m and length <span><strong class="source-inline1">0.5</strong></span><span> m:</span></p>
			<pre class="source-code">
&lt;geometry&gt;
    &lt;cylinder radius="0.2" length="0.5"/&gt;
&lt;/geometry&gt;</pre>			<p class="calibre3">And an example for a sphere of radius <span><strong class="source-inline1">0.35</strong></span><span> m:</span></p>
			<pre class="source-code">
&lt;geometry&gt;
    &lt;sphere radius="0.35"/&gt;
&lt;/geometry&gt;</pre>			<p class="calibre3">On top of those basic shapes, you can also use custom meshes that you export from CAD software, such as SolidWorks, Blender, and so on. You can use STL and Collada files, with <strong class="source-inline1">.stl</strong> and <strong class="source-inline1">.dae</strong> extensions, respectively. Setting up those files is not complicated but requires you to properly package your application around the URDF, which is something we will see in <a href="B22403_12.xhtml#_idTextAnchor573" class="pcalibre calibre4 pcalibre1"><span><em class="italic">Chapter 12</em></span></a><span>.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">There are even some tools that allow you to generate the complete URDF (links, joints, meshes, and so on) for a robot, directly from the CAD software. Great, isn’t it? However, those tools are not always up to date or stable, and if you have an error, you could spend lots of time finding and fixing it. I recommend you write the URDF yourself and add the meshes one by one. You will end up with more control over what you’re doing, and fixing errors will take much <span>less time.</span></p>
			<p class="calibre3">With the three basic shapes (box, cylinder, sphere), you can already do quite a lot and design a complete robot. We don’t need more than that to get started, and we’ll use them for <a id="_idIndexMarker717" class="pcalibre calibre4 pcalibre1"/>the mobile robot that we’ll create in this chapter. The link visuals have no effect on the TF generation, so this is not going to be a problem. Even when you start designing your own custom robot, you can start with basic shapes, and everything will <span>work fine.</span></p>
			<p class="calibre3">Here is the complete reference with every tag and attribute you can add in <span>a link:</span></p>
			<p class="calibre3"><a href="https://wiki.ros.org/urdf/XML/link" class="pcalibre calibre4 pcalibre1"><span>https://wiki.ros.org/urdf/XML/link</span></a></p>
			<p class="calibre3">Let’s now finish this section and see how to change the color of<a id="_idTextAnchor533" class="pcalibre calibre4 pcalibre1"/> the <span>link visual.</span></p>
			<h3 class="calibre8">Link color</h3>
			<p class="calibre3">If you look at the first link on RViz, you can see that the visual color is red. This will be the default <a id="_idIndexMarker718" class="pcalibre calibre4 pcalibre1"/>color for any basic shape <span>you create.</span></p>
			<p class="calibre3">As we add more shapes and combine them, it could be nice to modify their color, so that we can have some contrast between the different links. Otherwise, it will be hard to differentiate them on <span>the screen.</span></p>
			<p class="calibre3">To add a color to a link, you first need to create a <strong class="source-inline1">&lt;material&gt;</strong> tag with a name. Then, you can use the color in your <span>link visual.</span></p>
			<p class="calibre3">Here is the complete code to make the <span>link green:</span></p>
			<pre class="source-code">
&lt;?xml version="1.0"?&gt;
&lt;robot name="my_robot"&gt;
<strong class="bold1">    &lt;material name="green"&gt;</strong>
<strong class="bold1">        &lt;color rgba="0 0.6 0 1" /&gt;</strong>
<strong class="bold1">    &lt;/material&gt;</strong>
    &lt;link name="base_link"&gt;
        &lt;visual&gt;
            &lt;geometry&gt;
                &lt;box size="0.6 0.4 0.2" /&gt;
            &lt;/geometry&gt;
            &lt;origin xyz="0 0 0.1" rpy="0 0 0" /&gt;
<strong class="bold1">            &lt;material name="green" /&gt;</strong>
        &lt;/visual&gt;
    &lt;/link&gt;
&lt;/robot&gt;</pre>			<p class="calibre3">Make sure <a id="_idIndexMarker719" class="pcalibre calibre4 pcalibre1"/>the definition of the <strong class="source-inline1">&lt;material&gt;</strong> tag is inside the <strong class="source-inline1">&lt;robot&gt;</strong> tag, but outside of any <strong class="source-inline1">&lt;link&gt;</strong> tag. In this new tag, you need to do <span>the following:</span></p>
			<ul class="calibre9">
				<li class="calibre10">Define a name with the <span><strong class="source-inline">name</strong></span><span> attribute.</span></li>
				<li class="calibre10">Define a color with the <strong class="source-inline">&lt;color&gt;</strong> tag and <strong class="source-inline">rgba</strong> attribute (red, green, blue, alpha). Each of the four values should be between <strong class="source-inline">0</strong> and <strong class="source-inline">1</strong>. To create a basic, not-so-bright green color, we set the red and blue to <strong class="source-inline">0</strong>, and green to <strong class="source-inline">0.6</strong>. You can keep the alpha (transparency) set <span>to </span><span><strong class="source-inline">1</strong></span><span>.</span></li>
			</ul>
			<p class="calibre3">You only need to define this tag once, and then you can use it in any <strong class="source-inline1">&lt;visual&gt;</strong> tag, inside any link. The color will apply to the basic shape. It should also apply to STL files if you have imported custom meshes (Collada files already contain the color, so there’s no need for a <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">material&gt;</strong></span><span> tag).</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">When using the <strong class="source-inline">&lt;material&gt;</strong> tag inside a link, make sure to place it inside the <strong class="source-inline">&lt;visual&gt;</strong> tag, but not inside <strong class="source-inline">&lt;geometry&gt;</strong>. The <strong class="source-inline">&lt;geometry&gt;</strong>, <strong class="source-inline">&lt;origin&gt;</strong>, and <strong class="source-inline">&lt;material&gt;</strong> tags should be direct children of the <strong class="source-inline">&lt;</strong><span><strong class="source-inline">visual&gt;</strong></span><span> tag.</span></p>
			<p class="calibre3">Great, you can now create a link with different kinds of shapes and colors. This is a great start so you can represent any rigid part of your robot <span>in 3D.</span></p>
			<p class="calibre3">Let’s now <a id="_idIndexMarker720" class="pcalibre calibre4 pcalibre1"/>see how to assemble different links together and thus create a c<a id="_idTextAnchor534" class="pcalibre calibre4 pcalibre1"/>omplete <span>robot model.</span></p>
			<h1 id="_idParaDest-257" class="calibre6"><a id="_idTextAnchor535" class="pcalibre calibre4 pcalibre1"/>The process of assembling links and joints</h1>
			<p class="calibre3">Now that you have a URDF file with one link, let’s add another link, and connect them with a joint. This joint will be used to generate <span>a TF.</span></p>
			<p class="calibre3">Properly <a id="_idIndexMarker721" class="pcalibre calibre4 pcalibre1"/>assembling two links with a joint is the main problem anybody faces when learning URDF. There are several origins and axes you can modify, and getting two parts to be correctly placed between each other, with the correct movement, can <span>be challenging.</span></p>
			<p class="calibre3">In this section, we will focus on that process, so it becomes easier for you. I have condensed it into five steps that you can follow in the order every time you add a <span>new link.</span></p>
			<p class="calibre3">After you get confident with the process, you will be able to create a URDF for any kind of robot. A complete robot model is just a sequence of links connected to each other. If you correctly understand how to do it for two links, adding twenty more links won’t be <span>that difficult.</span></p>
			<p class="calibre3">We will also explore the different kinds of joints you can use in a URDF. To verify that everything works fine, we will use RViz, as well as the TF tree generated by the <span><strong class="source-inline1">tf2_tools</strong></span><span> package.</span></p>
			<p class="calibre3">This section is very important, and I recommend that you do not skip it. Also, feel free to come back to it later, whenever you have some doubts about how to connect <span>two links.</span></p>
			<p class="calibre3">Let’s get started with the first step of the process: adding a sec<a id="_idTextAnchor536" class="pcalibre calibre4 pcalibre1"/>ond link to <span>the URDF.</span></p>
			<h2 id="_idParaDest-258" class="calibre6"><a id="_idTextAnchor537" class="pcalibre calibre4 pcalibre1"/>Step 1 – adding a second link</h2>
			<p class="calibre3">For this <a id="_idIndexMarker722" class="pcalibre calibre4 pcalibre1"/>example, we want to add a cylinder (radius: <strong class="source-inline1">0.1</strong> m, length: <strong class="source-inline1">0.3</strong> m) on top of the box. We will make this cylinder gray (to create a contrast with the green box), so, let’s first create another <strong class="source-inline1">&lt;material&gt;</strong> tag with <span>gray color.</span></p>
			<p class="calibre3">You can add this new tag just after the previous <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">material&gt;</strong></span><span> tag:</span></p>
			<pre class="source-code">
&lt;material name="gray"&gt;
    &lt;color rgba="0.7 0.7 0.7 1" /&gt;
&lt;/material&gt;</pre>			<p class="calibre3">Then, let’s <a id="_idIndexMarker723" class="pcalibre calibre4 pcalibre1"/>add the link. Create another <strong class="source-inline1">&lt;link&gt;</strong> tag inside the <strong class="source-inline1">&lt;robot&gt;</strong> tag, with the specifications for the second link. You can place this link just after <span>the </span><span><strong class="source-inline1">base_link</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;link name="shoulder_link"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;cylinder radius="0.1" length="0.3" /&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;
        &lt;material name="gray" /&gt;
    &lt;/visual&gt;
&lt;/link&gt;</pre>			<p class="calibre3">You can give any name for the link. Here, I specify <strong class="source-inline1">shoulder_link</strong> because we will create the beginning of a robotic arm for this example. You could then have several parts: base, shoulder, arm, forearm, hand, and so on. The best practice is to give meaningful names to the links of <span>your robot.</span></p>
			<p class="calibre3">As you can see, we set all the origin elements to <strong class="source-inline1">0</strong>. This is quite important and will be the first step of the process: you add a link, but you don’t modify <span>the origin.</span></p>
			<p class="calibre3">Now, if you try to visualize the URDF in RViz (stop and start from the terminal), you will get an error. Among the logs, you will <span>see this:</span></p>
			<pre class="console">
Error: Failed to find root link: Two root links found: [base_link] and [shoulder_link]</pre>			<p class="calibre3">You get this because all links in a URDF need to be related to each other with a parent/child relationship, as we saw in the previous chapter. Here, there is no explicit relationship, so ROS cannot know which one is the parent, and which one is <span>the child.</span></p>
			<p class="calibre3">We will <a id="_idIndexMarker724" class="pcalibre calibre4 pcalibre1"/>define this relationship with a joint. This will also allow us to generate our<a id="_idTextAnchor538" class="pcalibre calibre4 pcalibre1"/> first TF for <span>the robot.</span></p>
			<h2 id="_idParaDest-259" class="calibre6"><a id="_idTextAnchor539" class="pcalibre calibre4 pcalibre1"/>Step 2 – adding a joint</h2>
			<p class="calibre3">To define <a id="_idIndexMarker725" class="pcalibre calibre4 pcalibre1"/>how two links are connected, you need to add a joint. Here is the code you can write after the two <strong class="source-inline1">&lt;link&gt;</strong> tags (and still inside the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">robot&gt;</strong></span><span> tag):</span></p>
			<pre class="source-code">
&lt;joint name="base_shoulder_joint" type="fixed"&gt;
    &lt;parent link="base_link" /&gt;
    &lt;child link="shoulder_link" /&gt;
    &lt;origin xyz="0 0 <a id="_idTextAnchor540" class="calibre13 pcalibre1 pcalibre"/>0" rpy="0 0 0" /&gt;
&lt;/joint&gt;</pre>			<p class="calibre3">To create a joint, you add a <strong class="source-inline1">&lt;joint&gt;</strong> tag, which contains <span>two attributes:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="source-inline">name</strong>: You can <a id="_idIndexMarker726" class="pcalibre calibre4 pcalibre1"/>choose whatever you want, as long as it makes sense. I usually combine the names of the two links I want to connect: <strong class="source-inline">base_link</strong> and <strong class="source-inline">shoulder_link</strong> <span>become </span><span><strong class="source-inline">base_shoulder_joint</strong></span><span>.</span></li>
				<li class="calibre10"><strong class="source-inline">type</strong>: We will <a id="_idIndexMarker727" class="pcalibre calibre4 pcalibre1"/>come back to the different joint types you can use in <em class="italic">Step 4</em>. For now, we set it as <strong class="source-inline">fixed</strong>, which means that the two links won’t move between <span>each other.</span></li>
			</ul>
			<p class="calibre3">Inside the <strong class="source-inline1">&lt;joint&gt;</strong> tag, you then have three <span>more tags:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="source-inline">&lt;parent&gt;</strong>: This is <a id="_idIndexMarker728" class="pcalibre calibre4 pcalibre1"/>the parent link. You have to write the exact name of the link with the <span><strong class="source-inline">link</strong></span><span> attribute.</span></li>
				<li class="calibre10"><strong class="source-inline">&lt;child&gt;</strong>: You <a id="_idIndexMarker729" class="pcalibre calibre4 pcalibre1"/>will write the exact name of the child link with the <span><strong class="source-inline">link</strong></span><span> attribute.</span></li>
				<li class="calibre10"><strong class="source-inline">&lt;origin&gt;</strong>: This <a id="_idIndexMarker730" class="pcalibre calibre4 pcalibre1"/>will define the origin of the child link relative to the origin of the parent link. Once again, we use <strong class="source-inline">xyz</strong> for translation and <strong class="source-inline">rpy</strong> <span>for rotation.</span></li>
			</ul>
			<p class="calibre3">This is the second step of the process: you add a joint between the two links and define which one is the parent and which one is the child. For now, you leave all origin elements <span>to </span><span><strong class="source-inline1">0</strong></span><span>.</span></p>
			<p class="calibre3">With this <a id="_idIndexMarker731" class="pcalibre calibre4 pcalibre1"/>code, you can start RViz again, and this time, as there is a relationship between the links, the URDF will be displayed. Here is what you <span>will get:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer067">
					<img alt="Figure 11.2 – Two links and one joint, with all origins set to 0" src="image/B22403_11_2.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Two links and one joint, with all origins set to 0</p>
			<p class="calibre3">As you can see, we now have a box (<strong class="source-inline1">base_link</strong>) and a cylinder (<strong class="source-inline1">shoulder_link</strong>). As all origin elements are set to <strong class="source-inline1">0</strong>, both link origins are at the <span>same place.</span></p>
			<p class="calibre3">On top of that, you can also validate that the TF you’ve created with the joint is correctly placed in the TF tree. With the <strong class="source-inline1">ros2 run tf2_tools view_frames</strong> command, you can generate the TF tree. In the newly created PDF file, you will <span>see this:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer068">
					<img alt="Figure 11.3 – TF tree to validate the relationship between the two links" src="image/B22403_11_3.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.3 – TF tree to validate the relationship between the two links</p>
			<p class="calibre3">We can <a id="_idIndexMarker732" class="pcalibre calibre4 pcalibre1"/>validate that the relationship we have defined is correct. We now need to correctly place the <strong class="source-inline1">shoulder_l<a id="_idTextAnchor541" class="pcalibre calibre4 pcalibre1"/>ink</strong> relative to <span>the </span><span><strong class="source-inline1">base_link</strong></span><span>.</span></p>
			<h2 id="_idParaDest-260" class="calibre6"><a id="_idTextAnchor542" class="pcalibre calibre4 pcalibre1"/>Step 3 – fixing the joint origin</h2>
			<p class="calibre3">This is the step where most people get confused. If you look at the current code, we have three <strong class="source-inline1">&lt;origin&gt;</strong> tags: one in each link and one in the joint. So, which origin do we need <span>to modify?</span></p>
			<p class="calibre3">The classic <a id="_idIndexMarker733" class="pcalibre calibre4 pcalibre1"/>error is to start to modify several random origins at once and try to find something that works by tinkering with the values. Even if that seems to work in the end, it will probably create more problems when you add <span>other joints.</span></p>
			<p class="calibre3">So, for this step, I emphasize that you have to follow the <em class="italic">exact</em> process I will describe, <span>every time.</span></p>
			<p class="calibre3">The first thing to do is to modify the <strong class="source-inline1">&lt;origin&gt;</strong> tag of the joint, so you get the frame of the child link correctly placed. This is what matters the most. You will first fix the joint origin, and then, and <em class="italic">only</em> then, fix the <span>visual origin.</span></p>
			<p class="calibre3">For this, expand <strong class="bold">RobotModel</strong> and <strong class="bold">Links</strong>, and uncheck the <strong class="source-inline1">shoulder_link</strong> visual (at this stage, seeing the visual can cause confusion, so we disable it). Then, ask yourself this question: where should be the frame for the <strong class="source-inline1">shoulder_link</strong>, relative to the frame of <span>the </span><span><strong class="source-inline1">base_link</strong></span><span>?</span></p>
			<p class="calibre3">We want the <strong class="source-inline1">shoulder_link</strong> to be on top of the box, so we need to move the frame by the height of the box; here, that’s <strong class="source-inline1">0.2</strong> m. There is no rotation needed for this joint, just <span>a translation.</span></p>
			<p class="calibre3">So, you can now modify the <strong class="source-inline1">&lt;origin&gt;</strong> tag inside the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">joint&gt;</strong></span><span> tag:</span></p>
			<pre class="source-code">
&lt;origin xyz="0 0 0.2" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">Start RViz again, disable the visual for the <strong class="source-inline1">shoulder_link</strong>, and check whether the frame is <span>correctly placed.</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer069">
					<img alt="Figure 11.4 – Setting the joint origin without the visual" src="image/B22403_11_4.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Setting the joint origin without the visual</p>
			<p class="calibre3">Great, it seems that the frame for the <strong class="source-inline1">shoulder_link</strong> is in the right place: on top of <span>the box.</span></p>
			<p class="calibre3">This origin <a id="_idIndexMarker734" class="pcalibre calibre4 pcalibre1"/>is the most important; this is what will define the TF. In the end, TFs will be generated with all the joint origins in your URDF. The visual will not be taken into account (visuals will be used for inertial and collision properties in the <span>Gazebo simulator).</span></p>
			<p class="calibre3">We have our joint origin correctly set up. Now, let’s see how to specify the joint type, so we can define the <a id="_idTextAnchor543" class="pcalibre calibre4 pcalibre1"/>movement between the <span>two links.</span></p>
			<h2 id="_idParaDest-261" class="calibre6"><a id="_idTextAnchor544" class="pcalibre calibre4 pcalibre1"/>Step 4 – setting up the joint type</h2>
			<p class="calibre3">To keep <a id="_idIndexMarker735" class="pcalibre calibre4 pcalibre1"/>things simple for the previous explanation, we have set the joint type as <em class="italic">fixed</em>, which means that the two links are not moving relative to <span>each other.</span></p>
			<p class="calibre3">Lots of joints you will create will be like this. For example, if you place a sensor (camera, lidar) on your robot, the sensor won’t move. You can create a link for the sensor, and then a fixed joint to connect this sensor to <span>your robot.</span></p>
			<p class="calibre3">However, for some rigid parts (an arm in a robotic arm, wheels, torso, and so on), you will need to specify that the child link is moving relative to its parent link. I will not describe all possible joint types, but the most common movements you will find in any robot will be <span>as follows:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="bold">Fixed</strong>: As previously mentioned, this is if you have two parts that are <span>not moving</span></li>
				<li class="calibre10"><strong class="bold">Revolute</strong>: A rotation with a minimum and maximum angle, for example, in <span>robotic arms</span></li>
				<li class="calibre10"><strong class="bold">Continuous</strong>: An infinite rotation, usually used <span>for wheels</span></li>
				<li class="calibre10"><strong class="bold">Prismatic</strong>: If you need to make a part of your robot slide (only translation, <span>no rotation)</span></li>
			</ul>
			<p class="calibre3">You can <a id="_idIndexMarker736" class="pcalibre calibre4 pcalibre1"/>find the comp<a href="http://wiki.ros.org/urdf/XML/joint" class="pcalibre calibre4 pcalibre1">lete reference for all joint types</a> at <a href="http://wiki.ros.org/urdf/XML/joint" class="pcalibre calibre4 pcalibre1">http://wiki.ros.org/urdf/XML/joint</a>. There, you can get all possible elements you can add in a <strong class="source-inline1">&lt;joint&gt;</strong> tag. Most of them <span>are optional.</span></p>
			<p class="calibre3">Coming back to our example, let’s say that the shoulder link is rotating (with a minimum and maximum) on the <em class="italic">Z</em>-axis on top of the box. You can specify this with the <strong class="source-inline1">revolute</strong> joint type. By doing this, you will also need to add an <strong class="source-inline1">&lt;axis&gt;</strong> tag to specify the axis of rotation, and a <strong class="source-inline1">&lt;limit&gt;</strong> tag for the minimum and maximum angle. Let’s modify the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">base_shoulder_joint&gt;</strong></span><span> tag:</span></p>
			<pre class="source-code">
&lt;joint name="base_shoulder_joint" <strong class="bold1">type="revolute"</strong>&gt;
    &lt;parent link="base_link" /&gt;
    &lt;child link="shoulder_link" /&gt;
    &lt;origin xyz="0 0 0.2" rpy="0 0 0" /&gt;
    <strong class="bold1">&lt;axis xyz="0 0 1" /&gt;</strong>
    <strong class="bold1">&lt;limit lower="-3.14" upper="3.14" velocity="100" effort="100"/&gt;</strong>
&lt;/joint&gt;</pre>			<p class="calibre3">When choosing <strong class="source-inline1">revolute</strong>, we first need to define which axis will be rotating. As we chose <strong class="source-inline1">z</strong> (if you look at <span><em class="italic">Figure 11</em></span><em class="italic">.4</em>, we want to rotate around the blue axis), we write <strong class="source-inline1">"0 0 1"</strong>, which means: no rotation on <strong class="source-inline1">x</strong> and <strong class="source-inline1">y</strong>, and a rotation <span>on </span><span><strong class="source-inline1">z</strong></span><span>.</span></p>
			<p class="calibre3">We set the revolution between -180 and +180 degrees (about <strong class="source-inline1">-3.14</strong> and <strong class="source-inline1">3.14</strong> radians). We also have <a id="_idIndexMarker737" class="pcalibre calibre4 pcalibre1"/>to specify a value for the velocity and effort limits. Those two will usually be overridden by other ROS nodes. Set them to <strong class="source-inline1">100</strong> by default; it won’t be <span>important here.</span></p>
			<p class="calibre3">With this joint, you have created a TF that defines the position of the <strong class="source-inline1">shoulder_link</strong> relative to the <strong class="source-inline1">base_link</strong>, and the movement between those <span>two links.</span></p>
			<p class="calibre3">Now, you can start RViz again (disable the visual), and you will find a cursor in the <strong class="bold">Joint State Publisher</strong> window. Move the cursor to make the <strong class="source-inline1">shoulder_link</strong> rotate on top of the <strong class="source-inline1">base_link</strong>. Once again, it’s all about making the frame correctly move. If the visual still doesn’t look right, don’t worry about it; this is what we will fix<a id="_idTextAnchor545" class="pcalibre calibre4 pcalibre1"/> in the last step of <span>this process.</span></p>
			<h2 id="_idParaDest-262" class="calibre6"><a id="_idTextAnchor546" class="pcalibre calibre4 pcalibre1"/>Step 5 – fixing the visual origin</h2>
			<p class="calibre3">We can now fix the origin of the <strong class="source-inline1">shoulder_link</strong> visual. Don’t modify the <strong class="source-inline1">base_link</strong> origin, as it’s already correct. Here, we only modify the visual for the <span>child link.</span></p>
			<p class="calibre3">To do so, you can <a id="_idIndexMarker738" class="pcalibre calibre4 pcalibre1"/>enable the <strong class="source-inline1">shoulder_link</strong> visual again on RViz and see that the frame is at the center of the cylinder. Thus, we need to offset the visual by half of the length of the cylinder, which means <strong class="source-inline1">0.15</strong> m (half of <span><strong class="source-inline1">0.3</strong></span><span> m).</span></p>
			<p class="calibre3">Modify the <strong class="source-inline1">&lt;origin&gt;</strong> tag inside the <strong class="source-inline1">&lt;link&gt;</strong> tag of <span>the </span><span><strong class="source-inline1">shoulder_link</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;origin xyz="0 0 0.15" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">If you start RViz again, you will then see that everything is <span>correctly placed:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer070">
					<img alt="Figure 11.5 – The end of the process for fixing the origins" src="image/B22403_11_5.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.5 – The end of the process for fixing the origins</p>
			<p class="callout-heading">Note</p>
			<p class="callout">In this example, we want the cylinder to be placed on top of the frame. If you wanted the frame to be in the center of the cylinder, you would place the joint origin higher on the <em class="italic">Z</em>-axis, and then leave the visual origin as it is (I talk more about this later in this chapter, when we work on the wheels of the <span>mobile robot).</span></p>
			<p class="calibre3">The process <a id="_idIndexMarker739" class="pcalibre calibre4 pcalibre1"/>is now finished. As it is very imp<a id="_idTextAnchor547" class="pcalibre calibre4 pcalibre1"/>ortant, let’s now do a <span>quick recap.</span></p>
			<h2 id="_idParaDest-263" class="calibre6"><a id="_idTextAnchor548" class="pcalibre calibre4 pcalibre1"/>Recap – the process to follow every time</h2>
			<p class="calibre3">When you <a id="_idIndexMarker740" class="pcalibre calibre4 pcalibre1"/>create a URDF, you will first start with a link, usually named <strong class="source-inline1">base_link</strong>. Then, for each link that you add, you will also add a joint, to connect this new link to an <span>existing one.</span></p>
			<p class="calibre3">Here is the process to add a new link to <span>your URDF:</span></p>
			<ol class="calibre11">
				<li class="calibre10">Add a new <strong class="source-inline">&lt;link&gt;</strong> tag and set all origin elements <span>to </span><span><strong class="source-inline">0</strong></span><span>.</span></li>
				<li class="calibre10">Add a new <strong class="source-inline">&lt;joint&gt;</strong> tag. You have to specify a parent and child link. The parent link will be an existing link you’ve already created, and the child link is the new link you’ve just added. Set all origin elements <span>to </span><span><strong class="source-inline">0</strong></span><span>.</span></li>
				<li class="calibre10">Fix the origin of the joint. Visualize the URDF in RViz, disable the visual for the new link, and figure out where the frame for the new link should be relative to <span>its parent.</span></li>
				<li class="calibre10">If the joint is associated with a movement, set the joint type. Depending on the type, you might have to set the axis of rotation/translation, some limits, and <span>so on.</span></li>
				<li class="calibre10">Once the frame origin is correct, enable the visual in RViz and fix the visual origin for the link (only for the child link, not the <span>parent link).</span></li>
			</ol>
			<p class="calibre3">After this is done, congratulations, you have successfully connected two links, and the joint will be <a id="_idIndexMarker741" class="pcalibre calibre4 pcalibre1"/>used to generate a TF. You can repeat this process for each new link that you add to <span>your URDF.</span></p>
			<p class="calibre3">A few important things to remember are <span>as follows:</span></p>
			<ul class="calibre9">
				<li class="calibre10">Only add one link and one joint at a time. Finish the process, then add <span>another link.</span></li>
				<li class="calibre10">Don’t modify the origin of the parent link or any link you’ve already created before. This is a sure way to start messing up with the URDF and spending hours on debugging. If you need to go back to a previous link, then disable all children, fix the link, and continue <span>from there.</span></li>
				<li class="calibre10">One link can have several children, but only <span>one parent.</span></li>
				<li class="calibre10">After each modification, as small as it can be, always verify in RViz. Don’t try to modify several origin elements at the same time. Change one, validate it, then go to the <span>next one.</span></li>
				<li class="calibre10">You can verify that the relationship between all links is correct by printing the <span>TF tree.</span></li>
			</ul>
			<p class="calibre3">In the end, this process is not that complicated. Following these steps to the letter will ensure that you build your URDF right the first time. Not only will you be sure about what you <a id="_idIndexMarker742" class="pcalibre calibre4 pcalibre1"/>are doing but, it will save you lots of time in the long term, and your URDF will <span>be cleaner.</span></p>
			<p class="calibre3">We now have all the information we need <a id="_idTextAnchor549" class="pcalibre calibre4 pcalibre1"/>to create a complete URDF for <span>a robot.</span></p>
			<h1 id="_idParaDest-264" class="calibre6"><a id="_idTextAnchor550" class="pcalibre calibre4 pcalibre1"/>Writing a URDF for a mobile robot</h1>
			<p class="calibre3">You have seen the complete process of adding links and joints in a URDF file. By repeating this process several times, you can create a complete model for <span>any robot.</span></p>
			<p class="calibre3">We are <a id="_idIndexMarker743" class="pcalibre calibre4 pcalibre1"/>now going <a id="_idIndexMarker744" class="pcalibre calibre4 pcalibre1"/>to use this process to create a mobile robot. We will then use this URDF as a base for the <span>next chapters.</span></p>
			<p class="calibre3">I will first show you the final robot model so you get an idea, and then we will build the URDF, step by step. You will get the specs for the robot as we build it. I encourage you to follow along and even write the code at the same time as you read the section. This is good practice for you to get more comfortable with URDF. As a reminder, y<a id="_idTextAnchor551" class="pcalibre calibre4 pcalibre1"/>ou can find the complete code <span>on GitHub.</span></p>
			<h2 id="_idParaDest-265" class="calibre6"><a id="_idTextAnchor552" class="pcalibre calibre4 pcalibre1"/>What we want to achieve</h2>
			<p class="calibre3">Before writing any code, it’s important to define what we want to achieve. The final result will look like this <span>in RViz:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer071">
					<img alt="Figure 11.6 – Final result for the mobile robot" src="image/B22403_11_6.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Final result for the mobile robot</p>
			<p class="calibre3">We will start the URDF with the robot’s main structure (chassis), represented by a box. This box <a id="_idIndexMarker745" class="pcalibre calibre4 pcalibre1"/>is the same as the one we have created with <span>the </span><span><strong class="source-inline1">base_link</strong></span><span>.</span></p>
			<p class="calibre3">Then, we will add two wheels, on each side of the chassis. Those two wheels will have a continuous rotation. Finally, for stability, we add a caster wheel (sphere) that will help the robot not fall forward when we simulate it in Gazebo. This caster wheel will be a fixed joint, and we won’t add any movement <span>to it.</span></p>
			<p class="calibre3">On top of that, at the end, we will also add another link named <strong class="source-inline1">base_footprint</strong> (with no visual, we can consider it as a virtual link), which is the projection of the <strong class="source-inline1">base_link</strong> on the ground. I will explain this further when we <span>do it.</span></p>
			<p class="calibre3">To get started, go back to the <strong class="source-inline1">my_robot.urdf</strong> file we have written previously, and keep the <strong class="source-inline1">base_link</strong>. Remove the <strong class="source-inline1">shoulder_link</strong> as well as <span>the </span><span><strong class="source-inline1">base_shoulder_joint</strong></span><span>.</span></p>
			<p class="calibre3">Let’s now add <a id="_idTextAnchor553" class="pcalibre calibre4 pcalibre1"/>the two wheels to the side of <span>the robot.</span></p>
			<h2 id="_idParaDest-266" class="calibre6"><a id="_idTextAnchor554" class="pcalibre calibre4 pcalibre1"/>Adding the wheels</h2>
			<p class="calibre3">We will <a id="_idIndexMarker746" class="pcalibre calibre4 pcalibre1"/>add the wheels one by one, starting with the right wheel. Unless you’re an expert already, it’s important that you o<a id="_idTextAnchor555" class="pcalibre calibre4 pcalibre1"/>nly add one link and one joint at <span>a time.</span></p>
			<h3 class="calibre8">Right wheel</h3>
			<p class="calibre3">To add <a id="_idIndexMarker747" class="pcalibre calibre4 pcalibre1"/>the right wheel, we will follow the five-step process we just described. Let’s name this link <strong class="source-inline1">right_wheel_link</strong>. For the visual, we will use a cylinder, with a radius of <strong class="source-inline1">0.1</strong> m and a length of <strong class="source-inline1">0.05</strong> m. Here is the code for the link (<span><em class="italic">Step 1</em></span><span>):</span></p>
			<pre class="source-code">
&lt;link name="right_wheel_link"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;cylinder radius="0.1" length="0.05" /&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;
        &lt;material name="gray" /&gt;
    &lt;/visual&gt;
&lt;/link&gt;</pre>			<p class="calibre3">As the wheel will be attached to the <strong class="source-inline1">base_link</strong> (green color), we choose the gray color to make a contrast. As you can see, we set all origin elements to <strong class="source-inline1">0</strong>. We will only come back to those elements at the end of <span>the process.</span></p>
			<p class="calibre3">Now, let’s add a joint between the base and the right wheel (<span><em class="italic">Step 2</em></span><span>).</span></p>
			<pre class="source-code">
&lt;joint name="base_right_wheel_joint" type="fixed"&gt;
    &lt;parent link="base_link" /&gt;
    &lt;child link="right_wheel_link" /&gt;
    &lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;
&lt;/joint&gt;</pre>			<p class="calibre3">When you get more experienced, you can set the movement type when creating the joint, but let’s go step by step. For now, we set the type to <strong class="source-inline1">fixed</strong>, so we can set the joint origin first, and then specify the type of movement. This will make things simpler and less prone <span>to errors.</span></p>
			<p class="calibre3">With this code, you can already visualize the URDF in RViz. Disable the <strong class="source-inline1">right_wheel_link</strong> visual (<strong class="bold">RobotModel</strong> | <strong class="bold">Links</strong>) as we don’t need this for now, and it <a id="_idIndexMarker748" class="pcalibre calibre4 pcalibre1"/>could make us confused when setting the <span>joint origin.</span></p>
			<p class="calibre3">Then, the question is: where do we place the <strong class="source-inline1">right_wheel_link</strong> frame relative to the <strong class="source-inline1">base_link</strong> frame (<em class="italic">Step 3</em>)? Let’s see for <span>each axis:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="bold">X translation (red axis)</strong>: We want the wheel to be a bit behind, let’s choose a <strong class="source-inline">-0.15</strong> <span>m offset.</span></li>
				<li class="calibre10"><strong class="bold">Y translation (green axis)</strong>: The wheel should be on the side of the robot. Here, you have two choices (to understand this, make sure to have RViz open with <span>the URDF):</span><ul class="calibre12"><li class="calibre10">You can place the wheel origin just on the right side of the box. As the <em class="italic">Y</em>-axis is pointing left, the offset would be <strong class="source-inline">-0.2</strong>m (half of the width of the box). Then, later on, you would need to add an offset in the wheel visual, like we did for the <strong class="source-inline">shoulder_link</strong> in the <span>previous example.</span></li><li class="calibre10">Alternatively, you can add a small additional offset to the joint, so that the wheel would be outside of the box, and the visual would be centered around the frame. This second option is a good idea for wheels and some sensors—for example, when using a lidar, this is required to make the scan work properly. We then need to add <strong class="source-inline">-0.2</strong> m, and an additional <strong class="source-inline">-0.025</strong> m (half of the length of the wheel). The total offset <span>is </span><span><strong class="source-inline">-0.225</strong></span><span>m.</span></li></ul></li>
				<li class="calibre10"><strong class="bold">Z translation (blue axis)</strong>: There is no need for any offset here, as we want the center of the wheel to be at the bottom of <span>the box.</span></li>
			</ul>
			<p class="calibre3">We have our three values for the translation. That’s all we need. You might think that we have to rotate the joint axis because the visual is not correctly orientated. However, this is one of the most common mistakes, and it’s where you could start to modify the wrong values to fix the wrong problem. As we saw in the process, we first fix the joint with the visual disabled, and then, and only then, we fix <span>the visual.</span></p>
			<p class="calibre3">Let’s modify the <strong class="source-inline1">&lt;origin&gt;</strong> tag inside the <strong class="source-inline1">&lt;joint&gt;</strong> tag (again: not in the link, only in <span>the joint):</span></p>
			<pre class="source-code">
&lt;origin xyz="-0.15 -0.225 0" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">Then, start RViz again, disable the visual for the wheel (this visual is still wrong, but not a problem), and you can see that the joint is placed a bit outside <span>the box.</span></p>
			<p class="calibre3">We can <a id="_idIndexMarker749" class="pcalibre calibre4 pcalibre1"/>now easily add the movement (<em class="italic">Step 4</em>). As the wheel will continuously rotate (there is no minimum or maximum position), we choose the <strong class="source-inline1">continuous</strong> type. We also need to specify the rotation axis. By looking at the robot model in RViz, we can see that we have to pick the <em class="italic">Y</em>-axis (the wheel should rotate around the <span>green axis).</span></p>
			<p class="calibre3">Thus, we modify the <strong class="source-inline1">&lt;joint&gt;</strong> <span>tag accordingly:</span></p>
			<pre class="source-code">
&lt;joint name="base_right_wheel_joint" type="continuous"&gt;
    &lt;parent link="base_link" /&gt;
    &lt;child link="right_wheel_link" /&gt;
    &lt;origin xyz="-0.15 -0.225 0" rpy="0 0 0" /&gt;
    &lt;axis xyz="0 1 0" /&gt;
&lt;/joint&gt;</pre>			<p class="calibre3">There is no need to specify a <strong class="source-inline1">&lt;limit&gt;</strong> tag for <strong class="source-inline1">continuous</strong>, as we did with the <strong class="source-inline1">revolute</strong> <span>type previously.</span></p>
			<p class="calibre3">You can now start RViz again, disable the wheel visual, and move the new cursor named <strong class="source-inline1">base_right_wheel_link</strong> on the <strong class="bold">Joint State Publisher</strong> window. You should see the joint correctly rotating around <span>the base.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">With the cursor, you will see a minimum of about <strong class="source-inline">-3.14</strong> and a maximum of about <strong class="source-inline">3.14</strong> (total of 360 degrees). Don’t worry about this, it’s just a graphical element. As the joint type is continuous, there will be no minimum or maximum position when we control it <span>later on.</span></p>
			<p class="calibre3">That’s it for the joint. With this, the TF will be correctly generated. We can now finish the process and fix the visual for the link (<em class="italic">Step 5</em>). If you re-enable the wheel visual, you will see that it’s not correctly orientated. You would need to add a 90-degree rotation on the <em class="italic">X</em>-axis (around the red axis). This corresponds to pi/2, or about <strong class="source-inline1">1.57</strong> radian (we will see later in this chapter how to use a precise value <span>of pi).</span></p>
			<p class="calibre3">Let’s modify the <strong class="source-inline1">&lt;origin&gt;</strong> tag for <span>the </span><span><strong class="source-inline1">right_wheel_link</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;origin xyz="0 0 0" rpy="1.57 0 0" /&gt;</pre>			<p class="calibre3">Start RViz again, and now everything should be fine: the wheel visual will be correctly placed (just outside of the box) and with the right orientation. When you move the cursor for the joint, the wheel will <span>turn correctly.</span></p>
			<p class="calibre3">The right <a id="_idIndexMarker750" class="pcalibre calibre4 pcalibre1"/>wheel was probably the most complicated part of this robot, but as you can see, if you follow the process in the order, there should be no problem. You can be sure that all values are correct, and that there is no error that will propagate onto the next links that <span>you add.</span><a id="_idTextAnchor556" class="pcalibre calibre4 pcalibre1"/></p>
			<p class="calibre3">Let’s now write the code for the <span>left wheel.</span></p>
			<h3 class="calibre8">Left wheel</h3>
			<p class="calibre3">As the left wheel is the same as the right wheel, but on the opposite side of the box, writing <a id="_idIndexMarker751" class="pcalibre calibre4 pcalibre1"/>the code will be fairly straightforward. Here I won’t repeat the full process and will just show you the final <strong class="source-inline1">&lt;link&gt;</strong> and <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">joint&gt;</strong></span><span> tags.</span></p>
			<p class="calibre3">Let’s start with <span>the link:</span></p>
			<pre class="source-code">
&lt;link name="left_wheel_link"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;cylinder radius="0.1" length="0.05" /&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="0 0 0" rpy="1.57 0 0" /&gt;
        &lt;material name="gray" /&gt;
    &lt;/visual&gt;
&lt;/link&gt;</pre>			<p class="calibre3">This is the same code as for <span>the </span><span><strong class="source-inline1">right_wheel_link</strong></span><span>.</span></p>
			<p class="calibre3">Then, the left wheel will be connected to the chassis, so the parent of the <strong class="source-inline1">left_wheel_link</strong> will be <strong class="source-inline1">base_link</strong>. Here is the code for <span>the joint:</span></p>
			<pre class="source-code">
&lt;joint name="base_left_wheel_joint" type="continuous"&gt;
    &lt;parent link="base_link" /&gt;
    &lt;child link="left_wheel_link" /&gt;
    &lt;origin xyz="-0.15 0.225 0" rpy="0 0 0" /&gt;
    &lt;axis xyz="0 1 0" /&gt;
&lt;/joint&gt;</pre>			<p class="calibre3">Everything <a id="_idIndexMarker752" class="pcalibre calibre4 pcalibre1"/>is the same, except for the offset on the <em class="italic">Y</em>-axis. For the right wheel, we had to go on the negative side, but for the left wheel, we went on the <span>positive side.</span></p>
			<p class="calibre3">The important thing to check is that when you move the two cursors on the <strong class="bold">Joint State Publisher</strong> window on the positive side, both wheels are rotating in the same direction. If you have this, then your differential drive system is <span>correctly designed.</span></p>
			<p class="calibre3">We can now add t<a id="_idTextAnchor557" class="pcalibre calibre4 pcalibre1"/>he <strong class="bold">caster wheel</strong> for the stability of <span>the robot.</span></p>
			<h2 id="_idParaDest-267" class="calibre6"><a id="_idTextAnchor558" class="pcalibre calibre4 pcalibre1"/>Adding the caster wheel</h2>
			<p class="calibre3">When we add physics and gravity later on in the Gazebo simulator, you can guess that the robot <a id="_idIndexMarker753" class="pcalibre calibre4 pcalibre1"/>would fall on the front side, because it’s out of balance. To fix this, we will add what’s called a caster wheel. It’s the same principle as the wheels under a <span>desk chair.</span></p>
			<p class="calibre3">To make things simple, the caster wheel will be represented by a sphere (with a radius of <strong class="source-inline1">0.05</strong> m). For the movement, even if the wheel is rotating, this is not a rotation we control with ROS. It is a passive rotation; thus, we will consider the joint <span>as </span><span><strong class="source-inline1">fixed</strong></span><span>.</span></p>
			<p class="calibre3">Let’s create the link first (<span><em class="italic">Step 1</em></span><span>):</span></p>
			<pre class="source-code">
&lt;link name="caster_wheel_link"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;sphere radius="0.05" /&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;
        &lt;material name="gray" /&gt;
    &lt;/visual&gt;
&lt;/link&gt;</pre>			<p class="calibre3">There’s nothing too complicated here. Now, the caster wheel will be connected to the chassis of <a id="_idIndexMarker754" class="pcalibre calibre4 pcalibre1"/>the robot. Let’s add the joint (<em class="italic">Step 2</em>). To follow the process, we first set all origin elements <span>to </span><span><strong class="source-inline1">0</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;joint name="base_caster_wheel_joint" type="fixed"&gt;
    &lt;parent link="base_link" /&gt;
    &lt;child link="caster_wheel_link" /&gt;
    &lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;
&lt;/joint&gt;</pre>			<p class="calibre3">Start RViz and disable the visual. From this, let’s see where to place the origin of the caster wheel relative to the origin of the base (<span><em class="italic">Step 3</em></span><span>):</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="bold">X translation</strong>: As the two wheels are on the back of the robot, the caster wheel should be at the front. We can choose for example <span><strong class="source-inline">0.2</strong></span><span> m.</span></li>
				<li class="calibre10"><strong class="bold">Y translation</strong>: For better stability, we want the caster wheel to be centered, <span>so, </span><span><strong class="source-inline">0</strong></span><span>.</span></li>
				<li class="calibre10"><strong class="bold">Z translation</strong>: I specified <strong class="source-inline">0.05</strong> as the radius so that the diameter of the caster wheel (0.1 m) corresponds to the radius of the wheel. Thus, in order for the wheels and caster wheels to be aligned on the ground, we need to offset the <em class="italic">Z</em>-axis by <strong class="source-inline">-0.05</strong> m. If you are not so sure about this, it’s simple: try some values and see the results <span>in RViz.</span></li>
			</ul>
			<p class="calibre3">There is no need to set any rotation for the joint, as we won’t move the caster wheel, and it’s a sphere. Let’s apply the offset in the <strong class="source-inline1">&lt;origin&gt;</strong> tag of the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">joint&gt;</strong></span><span> tag:</span></p>
			<pre class="source-code">
&lt;origin xyz="0.2 0 -0.05" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">Now the caster wheel will be correctly placed under the chassis, and you can verify that the bottoms <a id="_idIndexMarker755" class="pcalibre calibre4 pcalibre1"/>of both wheels and caster wheel seem to be aligned. Here, there is no need to set a movement type (<em class="italic">Step 4</em>) nor to fix the visual (<span><em class="italic">Step 5</em></span><span>).</span></p>
			<p class="calibre3">The robot model is now finished. There is just one more thing we will<a id="_idTextAnchor559" class="pcalibre calibre4 pcalibre1"/> do to better prepare the robot for <span>the following.</span></p>
			<h2 id="_idParaDest-268" class="calibre6"><a id="_idTextAnchor560" class="pcalibre calibre4 pcalibre1"/>Extra link – base footprint</h2>
			<p class="calibre3">The robot is correctly designed and will work fine when we add control to it. However, there is one improvement we <span>can make.</span></p>
			<p class="calibre3">If you <a id="_idIndexMarker756" class="pcalibre calibre4 pcalibre1"/>look at the robot in RViz, the <strong class="source-inline1">base_link</strong> frame is not at the same altitude (<strong class="source-inline1">z</strong> offset) as the bottom of the three wheels. This is fine, but it would be nice to have the origin of the robot aligned with the ground where the robot <span>will be.</span></p>
			<p class="calibre3">Not only will it make the robot look better in RViz (although it’s not important), but it will also make things easier in the future. An example would be when you want to create a transformation from a docking station to a mobile robot, or from one robot to another one. Another example would be if you want to use the <strong class="bold">Navigation 2</strong> stack. If all robot origins are on the ground, you can then work in 2D, which is easier <span>to handle.</span></p>
			<p class="calibre3">For that reason, it’s quite common to add a virtual link named <strong class="source-inline1">base_footprint</strong>, which will be the projection of the <strong class="source-inline1">base_link</strong> on the ground. We say the link is <em class="italic">virtual</em> because it doesn’t contain any visuals; it’s just an additional frame we define in the space. Here is the code for <span>the link:</span></p>
			<pre class="source-code">
&lt;link name="base_footprint" /&gt;</pre>			<p class="calibre3">As you can see, this link is extremely simple, as we didn’t include any <strong class="source-inline1">&lt;visual&gt;</strong> tag. For a link name, we usually start with the rigid part name and add the <strong class="source-inline1">_link</strong> suffix. Here, we make an exception. You will find this <strong class="source-inline1">base_footprint</strong> name in many URDF files for existing <span>mobile robots.</span></p>
			<p class="calibre3">Now, we can add a new <strong class="source-inline1">fixed</strong> joint, with the <strong class="source-inline1">base_footprint</strong> as the parent, and the <strong class="source-inline1">base_link</strong> as <span>the child:</span></p>
			<pre class="source-code">
&lt;joint name="base_joint" type="fixed"&gt;
    &lt;parent link="base_footprint" /&gt;
    &lt;child link="base_link" /&gt;
    &lt;origin xyz="0 0 0.1" rpy="0 0 0" /&gt;
&lt;/joint&gt;</pre>			<p class="calibre3">We apply a <strong class="source-inline1">0.1</strong> m <a id="_idIndexMarker757" class="pcalibre calibre4 pcalibre1"/>offset on the <em class="italic">Z</em>-axis, which corresponds to the right and left <span>wheels’ radius.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">To organize all links and joints in a URDF, I usually write all the links first, followed by all the joints. You could also decide to alternate between links and joints. There is no right or wrong method; it’s a question <span>of preference.</span></p>
			<p class="calibre3">You can now visualize the final result on RViz. To get the correct view, click on <strong class="bold">Global Options</strong>, and in the <strong class="bold">Fixed Frame</strong> menu, choose <strong class="source-inline1">base_footprint</strong>. You will see that the bottoms of the wheels, and the <strong class="source-inline1">base_footprint</strong>, are aligned on <span>the ground.</span></p>
			<p class="calibre3">While RViz is still running, you can print and visualize the <span>TF tree:</span></p>
			<div class="calibre2">
				<div class="img---figure" id="_idContainer072">
					<img alt="Figure 11.7 – Final TF tree for the mobile robot" src="image/B22403_11_7.jpg" class="calibre5"/>
				</div>
			</div>
			<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Final TF tree for the mobile robot</p>
			<p class="calibre3">We are now done with the URDF. Before we finish this chapter, let’s explore Xacro, which will allow you t<a id="_idTextAnchor561" class="pcalibre calibre4 pcalibre1"/>o improve your URDF file and make it <span>more scalable.</span></p>
			<h1 id="_idParaDest-269" class="calibre6"><a id="_idTextAnchor562" class="pcalibre calibre4 pcalibre1"/>Improving the URDF with Xacro</h1>
			<p class="calibre3">The more complex your robot, the bigger the URDF. As you add more links and joints, you will <a id="_idIndexMarker758" class="pcalibre calibre4 pcalibre1"/>end up having problems scaling your robot model. Also, what we have written so far is not so dynamic: all the values <span>are hardcoded.</span></p>
			<p class="calibre3">Xacro <a id="_idIndexMarker759" class="pcalibre calibre4 pcalibre1"/>is an additional ROS feature you can use to solve all those issues. We will now see how to make a URDF file compatible with Xacro, how to create variables and functions, and how to split your URDF into <span>several files.</span></p>
			<p class="calibre3">With Xacro, your URDF files will become more dynamic and scalable. All serious ROS 2 projects use Xacro, so it’s important to learn h<a id="_idTextAnchor563" class="pcalibre calibre4 pcalibre1"/>ow to work <span>with it.</span></p>
			<p class="calibre3">Let’s get started with <span>the setup.</span></p>
			<h2 id="_idParaDest-270" class="calibre6"><a id="_idTextAnchor564" class="pcalibre calibre4 pcalibre1"/>Making a URDF file compatible with Xacro</h2>
			<p class="calibre3">We will start by making sure our URDF file can use Xacro features. Before doing anything, let’s <a id="_idIndexMarker760" class="pcalibre calibre4 pcalibre1"/>make sure that Xacro is installed (it should already be there with all the previous packages <span>we installed):</span></p>
			<pre class="console">
$ sudo apt install ros-&lt;distro&gt;-xacro</pre>			<p class="calibre3">Now, to use Xacro in your URDF file, you need to make <span>two changes.</span></p>
			<p class="calibre3">First, change the file extension. The file is currently named <strong class="source-inline1">my_robot.urdf</strong>. For Xacro, you will use the <strong class="source-inline1">.xacro</strong> extension. A common practice is to use the <strong class="source-inline1">.urdf.xacro</strong> extension for the main URDF file of your robot, so the file would be named <strong class="source-inline1">my_robot.urdf.xacro</strong> (the important thing is to have <strong class="source-inline1">.xacro</strong> at <span>the end).</span></p>
			<p class="calibre3">Once you’ve changed the extension, open the file and modify the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">robot&gt;</strong></span><span> tag:</span></p>
			<pre class="source-code">
&lt;robot name="my_robot" <strong class="bold1"/>&gt;</pre>			<p class="calibre3">Every time you want to use Xacro in a URDF file, you will have to add this <span><strong class="source-inline1">xmlns:xacro</strong></span><span> argument.</span></p>
			<p class="calibre3">That’s <a id="_idIndexMarker761" class="pcalibre calibre4 pcalibre1"/>it for the setup. Now, to visualize the URDF in RViz, you will run the same command as before, with the new <span>file name:</span></p>
			<pre class="console">
$ ros2 launch urdf_tutorial display.launch.py model:=/home/&lt;user&gt;/my_robot.urdf.xa<a id="_idTextAnchor565" class="calibre13 pcalibre1 pcalibre"/>cro</pre>			<p class="calibre3">Let’s now discover how to use variables <span>with Xacro.</span></p>
			<h2 id="_idParaDest-271" class="calibre6"><a id="_idTextAnchor566" class="pcalibre calibre4 pcalibre1"/>Xacro properties</h2>
			<p class="calibre3">In programming, one of the first and most important things you learn is how to use variables. Variables do not exist in URDF, but you can use them with Xacro. Here, a variable is <a id="_idIndexMarker762" class="pcalibre calibre4 pcalibre1"/>called <span>a </span><span><strong class="bold">property</strong></span><span>.</span></p>
			<p class="calibre3">With Xacro properties, we will be able to specify values such as dimensions at the beginning <a id="_idIndexMarker763" class="pcalibre calibre4 pcalibre1"/>of the file and use those properties inside the <strong class="source-inline1">&lt;link&gt;</strong> and <strong class="source-inline1">&lt;joint&gt;</strong> tags. This way, values and computations are not hardcoded. It will make things less confusing and more readable. Plus, if we ever need to modify a dimension of the robot, we just need to modify one value at the beginning of <span>the file.</span></p>
			<p class="calibre3">Also, it’s important to note that Xacro properties are considered constant variables. After you set their value, you won’t modify <span>them anymore.</span></p>
			<p class="calibre3">To declare and define a Xacro property, you will use the <strong class="source-inline1">&lt;xacro:property&gt;</strong> tag and provide two arguments: <strong class="source-inline1">name</strong> <span>and </span><span><strong class="source-inline1">value</strong></span><span>.</span></p>
			<p class="calibre3">Let’s declare a few properties at the beginning of the file (inside the <strong class="source-inline1">&lt;</strong><span><strong class="source-inline1">robot&gt;</strong></span><span> tag):</span></p>
			<pre class="source-code">
&lt;xacro:property name="base_length" value="0.6" /&gt;
&lt;xacro:property name="base_width" value="0.4" /&gt;
&lt;xacro:property name="base_height" value="0.2" /&gt;
&lt;xacro:property name="wheel_radius" value="0.1" /&gt;
&lt;xacro:property name="wheel_length" value="0.05" /&gt;</pre>			<p class="calibre3">Those are all the values we need for computing everything else in <span>the URDF.</span></p>
			<p class="calibre3">Then, to use a Xacro property, you simply have to write <strong class="source-inline1">${property_name}</strong>. You can also do computations. For example, to multiply a value by 2.5, you will write <strong class="source-inline1">${property_name * 2.5}</strong>. With this information, let’s modify the content inside the <strong class="source-inline1">base_link</strong> to remove any <span>hardcoded value:</span></p>
			<pre class="source-code">
&lt;geometry&gt;
    &lt;box size="${base_length} ${base_width} ${base_height}" /&gt;
&lt;/geometry&gt;
&lt;origin xyz="0 0 ${base_height / 2.0}" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">As you can see, we specify the box size with only properties. The most interesting part is how we <a id="_idIndexMarker764" class="pcalibre calibre4 pcalibre1"/>compute the visual offset on the <em class="italic">Z</em>-axis. Writing <strong class="source-inline1">${base_height / 2.0}</strong> is much more explicit than just writing <strong class="source-inline1">0.1</strong>. Not only is it more dynamic, but we also have a better idea of what this computation is about. Imagine coming back to this URDF in six months and trying to figure out why the offset value is <strong class="source-inline1">0.1</strong>, without any context. With this property, there is no <span>possible doubt.</span></p>
			<p class="calibre3">Let’s now modify the visual for the links of the right wheel and <span>left wheel:</span></p>
			<pre class="source-code">
&lt;geometry&gt;
    &lt;cylinder
        radius="${wheel_radius}" length="${wheel_length}"
    /&gt;
&lt;/geometry&gt;
&lt;origin xyz="0 0 0" rpy="${pi / 2.0} 0 0" /&gt;</pre>			<p class="callout-heading">Note</p>
			<p class="callout">The Xacro property, or constant pi, is already defined. Instead of hardcoding an approximation of pi, you can just use it <span>with </span><span><strong class="source-inline">${pi}</strong></span><span>.</span></p>
			<p class="calibre3">Finally, here is the code for the <span>caster wheel:</span></p>
			<pre class="source-code">
&lt;geometry&gt;
    &lt;sphere radius="${wheel_radius / 2.0}" /&gt;
&lt;/geometry&gt;
&lt;origin xyz="0 0 0" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">As you can see, we didn’t define a <strong class="source-inline1">caster_wheel_radius</strong> property. This is because the caster wheel radius needs to be proportional to the right and left wheel radius. It needs to be half of the value so that both wheels and caster wheels can touch the ground while <a id="_idIndexMarker765" class="pcalibre calibre4 pcalibre1"/>making the robot stable. By using a Xacro property here, if we were to modify the wheel radius, then the caster wheel would automatically resize to make the <span>robot stable.</span></p>
			<p class="calibre3">We have now modified all the links; let’s change the values in the joint origins. For the <strong class="source-inline1">base_joint</strong>, we have <span>the following:</span></p>
			<pre class="source-code">
&lt;origin xyz="0 0 ${wheel_radius}" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">The <strong class="source-inline1">base_right_wheel_joint</strong> is a bit more complex. However, once again, by writing this, we will make the computation more readable and less prone to errors in <span>the future:</span></p>
			<pre class="source-code">
&lt;origin xyz="${-base_length / 4.0} ${-(base_width + wheel_length) / 2.0} 0" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">The <strong class="source-inline1">base_left_wheel_joint</strong> will be the same, except that the sign on the <em class="italic">Y</em>-axis is positive. We finish with <span>the </span><span><strong class="source-inline1">base_caster_wheel_joint</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;origin xyz="${base_length / 3.0} 0 ${-wheel_radius / 2.0}" rpy="0 0 0" /&gt;</pre>			<p class="calibre3">All those changes in the code didn’t modify the robot model. When visualizing it in Rviz, it should look <span>the same.</span></p>
			<p class="calibre3">To test that everything worked, try modifying the values for some Xacro properties at the beginning of the file. The robot model in RViz will have different dimensions, but it should still <span>make sense.</span></p>
			<p class="calibre3">That’s it for Xacro properties. This concept is not that hard to understand and apply, especially if you’re already familiar with variabl<a id="_idTextAnchor567" class="pcalibre calibre4 pcalibre1"/>es and constants. Let’s now switch to functions, <span>or macros.</span></p>
			<h2 id="_idParaDest-272" class="calibre6"><a id="_idTextAnchor568" class="pcalibre calibre4 pcalibre1"/>Xacro macros</h2>
			<p class="calibre3">A Xacro macro is the equivalent of a function in programming. With Xacro, a macro works like a template: it’s a piece of XML code that you can reuse with different values (parameters). A macro doesn’t <span>return anything.</span></p>
			<p class="calibre3">Macros are <a id="_idIndexMarker766" class="pcalibre calibre4 pcalibre1"/>quite useful when you have to duplicate a link or a joint several times. Imagine a robot with four cameras. You can create a macro for the camera link, and then call the macro instead of re-writing the same code <span>four times.</span></p>
			<p class="calibre3">With our robot model, we have almost the same code for the <strong class="source-inline1">right_wheel_link</strong> and the <strong class="source-inline1">left_wheel_link</strong>. The only difference is the name of the link. Let’s create a macro for <span>those links.</span></p>
			<p class="calibre3">To create a macro, you will use the <strong class="source-inline1">&lt;xacro:macro&gt;</strong> tag and give a name as well as a list of <strong class="source-inline1">params</strong>. You can specify zero, or as many parameters as you want—just separate them with a space. Here is <span>an example:</span></p>
			<pre class="source-code">
&lt;xacro:macro name="wheel_link" params="prefix"&gt;
    &lt;link name="${prefix}_wheel_link"&gt;
        &lt;visual&gt;
            &lt;geometry&gt;
                &lt;cylinder radius="${wheel_radius}"
                          length="${wheel_length}" /&gt;
            &lt;/geometry&gt;
            &lt;origin xyz="0 0 0" rpy="${pi / 2.0} 0 0" /&gt;
            &lt;material name="gray" /&gt;
        &lt;/visual&gt;
    &lt;/link&gt;
&lt;/xacro:macro&gt;</pre>			<p class="calibre3">This piece of code won’t do anything by itself. We need to call it, just like you would call a function. To call a macro, you will write <span>the following:</span></p>
			<pre class="source-code">
&lt;xacro:name param1="value" param2="value" /&gt;.</pre>			<p class="calibre3">Remove the <strong class="source-inline1">right_wheel_link</strong> and the <strong class="source-inline1">left_wheel_link</strong>, and write <span>this instead:</span></p>
			<pre class="source-code">
&lt;xacro:wheel_link prefix="right" /&gt;
&lt;xacro:wheel_link prefix="left" /&gt;</pre>			<p class="calibre3">The <strong class="source-inline1">"right"</strong> value in the prefix parameter will be applied to the link name inside the macro, making the name <strong class="source-inline1">right_wheel_link</strong>. The same thing applies for the <span>left wheel.</span></p>
			<p class="calibre3">As you can see, macros can help you reduce code duplication. In this example, the benefit is not as big, but if you need to duplicate some links or joints more than three times, then macros can be extremely useful. Also, if you are creating part of a URDF that will be <a id="_idIndexMarker767" class="pcalibre calibre4 pcalibre1"/>used by other people, writing a macro can help them to easily integrate your code into theirs, and customize it with the different parameters they can give <span>as input.</span></p>
			<p class="calibre3">Xacro properties and macros will allow you to make one URDF file more dynamic. Let’s finish <a id="_idTextAnchor569" class="pcalibre calibre4 pcalibre1"/>this section by seeing how to make a URDF even <span>more scalable.</span></p>
			<h2 id="_idParaDest-273" class="calibre6"><a id="_idTextAnchor570" class="pcalibre calibre4 pcalibre1"/>Including a Xacro file in another file</h2>
			<p class="calibre3">Thanks to Xacro, you can split your URDF into <span>several files.</span></p>
			<p class="calibre3">This is <a id="_idIndexMarker768" class="pcalibre calibre4 pcalibre1"/>useful to separate different parts of your robot, for example, the main core base, and extra sensors that you add on top. If you combine two robots, for example, a robotic arm on top of a mobile robot, you can create one URDF for each robot and combine them into a third one. Another benefit is collaboration. Creating a macro inside one file that other developers can include will make it easier for them to work with <span>your code.</span></p>
			<p class="calibre3">Coming back to our URDF, let’s split the file <span>into three:</span></p>
			<ul class="calibre9">
				<li class="calibre10"><strong class="source-inline">common_properties.xacro</strong>: This <a id="_idIndexMarker769" class="pcalibre calibre4 pcalibre1"/>will contain the material tags and other properties that could apply to any part of our <span>robotics application</span></li>
				<li class="calibre10"><strong class="source-inline">mobile_base.xacro</strong>: This <a id="_idIndexMarker770" class="pcalibre calibre4 pcalibre1"/>file will contain the properties, macros, links, and joints that are specific to the <span>mobile base</span></li>
				<li class="calibre10"><strong class="source-inline">my_robot.urdf.xacro</strong>: In this main file, we include the two <span>previous files</span></li>
			</ul>
			<p class="calibre3">By doing this, we will make the URDF more dynamic and easier to modify in the future. If you <a id="_idIndexMarker771" class="pcalibre calibre4 pcalibre1"/>want to combine several mobile bases or add other robots or sensors, you can create more Xacro files that you include into the main <span>one (</span><span><strong class="source-inline1">my_robot.urdf.xacro</strong></span><span>).</span></p>
			<p class="calibre3">Now, create the two additional files, and let’s see how to organize the code. Make sure to put all three files in the same directory. In the next chapter, we will install them properly inside a ROS 2 package, but for now, keep them all in the same place (it will make it easier to include the first two files into the third one, using the <span>relative path).</span></p>
			<p class="calibre3">Let’s start with <strong class="source-inline1">common_properties.xacro</strong>. Here is the first thing to write inside <span>this file:</span></p>
			<pre class="source-code">
&lt;?xml version="1.0"?&gt;
&lt;robot &gt;
&lt;/robot&gt;</pre>			<p class="calibre3">All Xacro <a id="_idIndexMarker772" class="pcalibre calibre4 pcalibre1"/>files must have this code, with a <strong class="source-inline1">&lt;robot&gt;</strong> tag containing the <span><strong class="source-inline1">xmlns:xacro</strong></span><span> attribute.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Don’t add the <strong class="source-inline">name</strong> attribute in the <strong class="source-inline">&lt;robot&gt;</strong> tag. This attribute will only be added once in the main <span>Xacro file.</span></p>
			<p class="calibre3">Then, inside the <strong class="source-inline1">&lt;robot&gt;</strong> tag, you can copy and paste the two <strong class="source-inline1">&lt;material&gt;</strong> tags we have previously written. You can then remove those tags <span>from </span><span><strong class="source-inline1">my_robot.urdf.xacro.</strong></span></p>
			<p class="calibre3">In <strong class="source-inline1">mobile_base.xacro</strong>, you will also start the file with the <strong class="source-inline1">&lt;?xml&gt;</strong> and <strong class="source-inline1">&lt;robot&gt;</strong> tags, like we did <span>in </span><span><strong class="source-inline1">common_properties.xacro</strong></span><span>.</span></p>
			<p class="calibre3">Then, you can copy and paste all the <strong class="source-inline1">&lt;xacro:property&gt;</strong>, <strong class="source-inline1">&lt;xacro:macro&gt;</strong>, <strong class="source-inline1">&lt;link&gt;</strong>, and <strong class="source-inline1">&lt;joint&gt;</strong> tags that are related to the mobile base, which are basically all the <span>tags left.</span></p>
			<p class="calibre3">In <strong class="source-inline1">my_robot.urdf.xacro</strong>, we have nothing left, only the <strong class="source-inline1">&lt;?xml&gt;</strong> tag and the <strong class="source-inline1">&lt;robot&gt;</strong> tag that contains the <strong class="source-inline1">name</strong> and <span><strong class="source-inline1">xmlns:xacro</strong></span><span> attributes.</span></p>
			<p class="calibre3">To include a Xacro file inside another file, you will write a <strong class="source-inline1">&lt;xacro:include&gt;</strong> tag and provide the path to the file with the <strong class="source-inline1">filename</strong> attribute. Here is the final content <span>for </span><span><strong class="source-inline1">my_robot.urdf.xacro</strong></span><span>:</span></p>
			<pre class="source-code">
&lt;?xml version="1.0"?&gt;
&lt;robot name="my_robot" &gt;
    &lt;xacro:include filename="common_properties.xacro" /&gt;
    &lt;xacro:include filename="mobile_base.xacro" /&gt;
&lt;/robot&gt;</pre>			<p class="calibre3">Our URDF <a id="_idIndexMarker773" class="pcalibre calibre4 pcalibre1"/>is now split into several files and uses Xacro properties and macros. With those modifications, we didn’t change anything about the robot model, but we made the URDF more dynamic and scalable, as well as easier <span>to read.</span></p>
			<p class="calibre3">As a reminder, you can find the complete code—all URDF and Xacro files—for th<a id="_idTextAnchor571" class="pcalibre calibre4 pcalibre1"/>is chapter inside the <strong class="source-inline1">ch11</strong> folder of the book’s <span>GitHub repository.</span></p>
			<h1 id="_idParaDest-274" class="calibre6"><a id="_idTextAnchor572" class="pcalibre calibre4 pcalibre1"/>Summary</h1>
			<p class="calibre3">In this chapter, you discovered the full process of writing a URDF for <span>a robot.</span></p>
			<p class="calibre3">A URDF defines a robot model and contains two main things: links and joints. A link is a rigid part of a robot that does nothing on its own. A link can have a visual (simple shapes such as boxes, cylinders, spheres, or meshes exported from CAD software). You can see a robot as a collection of links put together. A joint defines the connection between two links. It specifies which link is the parent and which one is the child, as well as where the two links are connected, and how they move relative to <span>each other.</span></p>
			<p class="calibre3">You learned that what you write inside a joint will define a TF for the robot. In the end, with all the joints inside a URDF, you are creating a <span>TF tree.</span></p>
			<p class="calibre3">You also saw the complete process for adding a new link and joint on top of the previous ones. Make sure to follow this process every time. To help you develop and verify each step of the process, you learned that it’s a good idea to use tools such as RViz to visualize the robot model, and <strong class="source-inline1">tf2_tools</strong> to see the <span>TF tree.</span></p>
			<p class="calibre3">Then, you learned that you can also improve your URDF with Xacro. You can define some properties and macros, and even split a URDF into several files. This will be useful as your application scales and will make collaboration easier. </p>
			<p class="calibre3">Creating a URDF for a robot is the first step, as mentioned in this chapter. This will allow you to generate the TFs, which are the backbone of any robot <span>using ROS.</span></p>
			<p class="calibre3">Now that you can create the URDF, let’s see how to start packaging our application, and discover what to start so we can properly generate the TFs (without using the <strong class="source-inline1">urdf_tutorial</strong> package). This will be the focus of the <span>next chapter.</span></p>
		</div>
	</body></html>