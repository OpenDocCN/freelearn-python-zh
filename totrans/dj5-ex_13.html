<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer380">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">13</span></h1>
<h1 class="chapterTitle" id="_idParaDest-353"><span class="koboSpan" id="kobo.2.1">Creating a Content Management System</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, you created the application models for the e-learning platform and learned how to create and apply data fixtures for models. </span><span class="koboSpan" id="kobo.3.2">You created a custom model field to order objects and implemented user authentication.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will learn how to build the functionality for instructors to create courses and manage the contents of those courses in a versatile and efficient manner.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">You will be introduced to class-based views, which offer a new perspective to build your application compared to the function-based views you have built in previous examples. </span><span class="koboSpan" id="kobo.5.2">You will also explore code reusability and modularity through the use of mixins, which are techniques that you can apply in future projects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1">In this chapter, you will learn how to:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Create a </span><strong class="keyWord"><span class="koboSpan" id="kobo.8.1">content management system</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.10.1">CMS</span></strong><span class="koboSpan" id="kobo.11.1">) using class-based views and mixins</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Build formsets and model formsets to edit course modules and module contents</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Manage groups and permissions</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Implement a drag-and-drop functionality to reorder modules and content</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-354"><span class="koboSpan" id="kobo.15.1">Functional overview</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.16.1">Figure 13.1</span></em><span class="koboSpan" id="kobo.17.1"> shows a representation of the views, templates, and functionalities that will be built in this chapter:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.18.1"><img alt="" role="presentation" src="../Images/B21088_13_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.19.1">Figure 13.1: Diagram of functionalities built in Chapter 13</span></p>
<p class="normal"><span class="koboSpan" id="kobo.20.1">In this chapter, you will implement different class-based views. </span><span class="koboSpan" id="kobo.20.2">You will create the mixin classes </span><code class="inlineCode"><span class="koboSpan" id="kobo.21.1">OwnerMixin</span></code><span class="koboSpan" id="kobo.22.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">OwnerEditMixin</span></code><span class="koboSpan" id="kobo.24.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.26.1">, which will contain common functionality that you will reuse in other classes. </span><span class="koboSpan" id="kobo.26.2">You will create </span><strong class="keyWord"><span class="koboSpan" id="kobo.27.1">CRUD</span></strong><span class="koboSpan" id="kobo.28.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.29.1">Create</span></strong><span class="koboSpan" id="kobo.30.1">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.31.1">Read</span></strong><span class="koboSpan" id="kobo.32.1">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.33.1">Update</span></strong><span class="koboSpan" id="kobo.34.1">, </span><strong class="keyWord"><span class="koboSpan" id="kobo.35.1">Delete</span></strong><span class="koboSpan" id="kobo.36.1">) views for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.37.1">Course</span></code><span class="koboSpan" id="kobo.38.1"> model by implementing </span><code class="inlineCode"><span class="koboSpan" id="kobo.39.1">ManageCourseListView</span></code><span class="koboSpan" id="kobo.40.1"> to list courses, </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">CourseCreateView</span></code><span class="koboSpan" id="kobo.42.1"> to create courses, </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">CourseUpdateView</span></code><span class="koboSpan" id="kobo.44.1"> to update courses, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.45.1">CourseDeleteView</span></code><span class="koboSpan" id="kobo.46.1"> to delete courses. </span><span class="koboSpan" id="kobo.46.2">You will build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">CourseModuleUpdateView</span></code><span class="koboSpan" id="kobo.48.1"> view to add/edit/delete course modules and </span><code class="inlineCode"><span class="koboSpan" id="kobo.49.1">ModuleContentListView</span></code><span class="koboSpan" id="kobo.50.1"> to list the module’s contents. </span><span class="koboSpan" id="kobo.50.2">You will also implement </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">ContentCreateUpdateView</span></code><span class="koboSpan" id="kobo.52.1"> to create and update course contents and </span><code class="inlineCode"><span class="koboSpan" id="kobo.53.1">ContentDeleteView</span></code><span class="koboSpan" id="kobo.54.1"> to delete contents. </span><span class="koboSpan" id="kobo.54.2">You will finally implement a drag-and-drop functionality to reorder course modules and contents using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.55.1">ModuleOrderView</span></code><span class="koboSpan" id="kobo.56.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">ContentOrderView</span></code><span class="koboSpan" id="kobo.58.1"> views, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.59.1">Note that all views that inherit the mixin </span><code class="inlineCode"><span class="koboSpan" id="kobo.60.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.61.1"> redirect the user back to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.62.1">ManageCourseListView</span></code><span class="koboSpan" id="kobo.63.1"> view after a successful action. </span><span class="koboSpan" id="kobo.63.2">These redirects have not been added to the diagram for simplicity.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.64.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter13"><span class="url"><span class="koboSpan" id="kobo.65.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter13</span></span></a><span class="koboSpan" id="kobo.66.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.67.1">All Python modules used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">requirements.txt</span></code><span class="koboSpan" id="kobo.69.1"> file in the source code that comes along with this chapter. </span><span class="koboSpan" id="kobo.69.2">You can follow the instructions to install each Python module below or you can install all the requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.70.1">python -m pip install -r requirements.txt</span></code><span class="koboSpan" id="kobo.71.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-355"><span class="koboSpan" id="kobo.72.1">Creating a CMS</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.73.1">Now that you have</span><a id="_idIndexMarker1164"/><span class="koboSpan" id="kobo.74.1"> created a versatile data model, you are going to build the CMS. </span><span class="koboSpan" id="kobo.74.2">The CMS will allow instructors to create courses and manage their content. </span><span class="koboSpan" id="kobo.74.3">You </span><a id="_idIndexMarker1165"/><span class="koboSpan" id="kobo.75.1">need to provide the following functionality:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.76.1">List the courses created by the instructor</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.77.1">Create, edit, and delete courses</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.78.1">Add modules to a course and reorder them</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.79.1">Add different types of content to each module</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.80.1">Reorder course modules and content</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.81.1">Let’s start with the basic CRUD views.</span></p>
<h2 class="heading-2" id="_idParaDest-356"><span class="koboSpan" id="kobo.82.1">Creating class-based views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.83.1">You are going</span><a id="_idIndexMarker1166"/><span class="koboSpan" id="kobo.84.1"> to build views to</span><a id="_idIndexMarker1167"/><span class="koboSpan" id="kobo.85.1"> create, edit, and delete courses. </span><span class="koboSpan" id="kobo.85.2">You will use class-based views for this. </span><span class="koboSpan" id="kobo.85.3">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">views.py</span></code><span class="koboSpan" id="kobo.87.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">courses</span></code><span class="koboSpan" id="kobo.89.1"> application and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.90.1">from</span></span><span class="koboSpan" id="kobo.91.1"> django.views.generic.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.92.1">list</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.93.1">import</span></span><span class="koboSpan" id="kobo.94.1"> ListView
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.95.1">from</span></span><span class="koboSpan" id="kobo.96.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.97.1">import</span></span><span class="koboSpan" id="kobo.98.1"> Course
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.99.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.100.1">ManageCourseListView</span></span><span class="koboSpan" id="kobo.101.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.102.1">ListView</span></span><span class="koboSpan" id="kobo.103.1">):
    model = Course
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.104.1">'courses/manage/course/list.html'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.105.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.106.1">get_queryset</span></span><span class="koboSpan" id="kobo.107.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.108.1">self</span></span><span class="koboSpan" id="kobo.109.1">):
        qs = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.110.1">super</span></span><span class="koboSpan" id="kobo.111.1">().get_queryset()
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.112.1">return</span></span><span class="koboSpan" id="kobo.113.1"> qs.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.114.1">filter</span></span><span class="koboSpan" id="kobo.115.1">(owner=self.request.user)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.116.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.117.1">ManageCourseListView</span></code><span class="koboSpan" id="kobo.118.1"> view. </span><span class="koboSpan" id="kobo.118.2">It inherits from Django’s generic </span><code class="inlineCode"><span class="koboSpan" id="kobo.119.1">ListView</span></code><span class="koboSpan" id="kobo.120.1">. </span><span class="koboSpan" id="kobo.120.2">You override the </span><code class="inlineCode"><span class="koboSpan" id="kobo.121.1">get_queryset()</span></code><span class="koboSpan" id="kobo.122.1"> method of the view to retrieve only courses created by the current user. </span><span class="koboSpan" id="kobo.122.2">To prevent users from editing, updating, or deleting courses they didn’t create, you will also need to override the </span><code class="inlineCode"><span class="koboSpan" id="kobo.123.1">get_queryset()</span></code><span class="koboSpan" id="kobo.124.1"> method in the create, update, and delete views. </span><span class="koboSpan" id="kobo.124.2">When you need to provide a specific behavior for several class-based views, it is recommended that you use </span><em class="italic"><span class="koboSpan" id="kobo.125.1">mixins</span></em><span class="koboSpan" id="kobo.126.1">.</span></p>
<h2 class="heading-2" id="_idParaDest-357"><span class="koboSpan" id="kobo.127.1">Using mixins for class-based views</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.128.1">Mixins are </span><a id="_idIndexMarker1168"/><span class="koboSpan" id="kobo.129.1">a special </span><a id="_idIndexMarker1169"/><span class="koboSpan" id="kobo.130.1">kind of multiple inheritance for a class. </span><span class="koboSpan" id="kobo.130.2">If you</span><a id="_idIndexMarker1170"/><span class="koboSpan" id="kobo.131.1"> are new to mixins in Python, all you need to understand is that they are a type of class designed to supply methods to other classes but aren’t intended to be used independently. </span><span class="koboSpan" id="kobo.131.2">This allows you to develop shared functionalities that can be incorporated into various classes in a modular manner, simply by having those classes inherit from mixins. </span><span class="koboSpan" id="kobo.131.3">The concept is similar to a base class but you can use multiple mixins to extend the functionality of a given class.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.132.1">There are two main situations for using mixins:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.133.1">You want to provide multiple optional features for a class</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.134.1">You want to use a particular feature in several classes</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.135.1">Django comes with several mixins that provide additional functionality to your class-based views. </span><span class="koboSpan" id="kobo.135.2">You can learn more about mixins at </span><a href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/mixins/"><span class="url"><span class="koboSpan" id="kobo.136.1">https://docs.djangoproject.com/en/5.0/topics/class-based-views/mixins/</span></span></a><span class="koboSpan" id="kobo.137.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.138.1">You are going to implement a common behavior for multiple views in mixin classes and use it for the </span><a id="_idIndexMarker1171"/><span class="koboSpan" id="kobo.139.1">course </span><a id="_idIndexMarker1172"/><span class="koboSpan" id="kobo.140.1">views. </span><span class="koboSpan" id="kobo.140.2">Edit </span><a id="_idIndexMarker1173"/><span class="koboSpan" id="kobo.141.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.142.1">views.py</span></code><span class="koboSpan" id="kobo.143.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.144.1">courses</span></code><span class="koboSpan" id="kobo.145.1"> application and modify it as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.146.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.147.1"> django.urls </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.148.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.149.1"> reverse_lazy</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.150.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.151.1"> django.views.generic.edit </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.152.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.153.1"> CreateView, DeleteView, UpdateView</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.154.1">from</span></span><span class="koboSpan" id="kobo.155.1"> django.views.generic.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.156.1">list</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.157.1">import</span></span><span class="koboSpan" id="kobo.158.1"> ListView
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.159.1">from</span></span><span class="koboSpan" id="kobo.160.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.161.1">import</span></span><span class="koboSpan" id="kobo.162.1"> Course
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.163.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.164.1">OwnerMixin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.165.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.166.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.167.1">get_queryset</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.168.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.169.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.170.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.171.1">        qs = </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.172.1">super</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.173.1">().get_queryset()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.174.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.175.1"> qs.</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.176.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.177.1">(owner=self.request.user)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.178.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.179.1">OwnerEditMixin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.180.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.181.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.182.1">form_valid</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.183.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.184.1">self, form</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.185.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.186.1">        form.instance.owner = self.request.user</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.187.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.188.1">super</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.189.1">().form_valid(form)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.190.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.191.1">OwnerCourseMixin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.192.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.193.1">OwnerMixin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.194.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.195.1">    model = Course</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.196.1">    fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.197.1">'subject'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.198.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.199.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.200.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.201.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.202.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.203.1">'overview'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.204.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.205.1">    success_url = reverse_lazy(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.206.1">'manage_course_list'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.207.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.208.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.209.1">OwnerCourseEditMixin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.210.1">(OwnerCourseMixin, OwnerEditMixin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.211.1">    template_name = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.212.1">'courses/manage/course/form.html'</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.213.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.214.1">ManageCourseListView</span></span><span class="koboSpan" id="kobo.215.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.216.1">OwnerCourseMixin,</span></strong></span><span class="koboSpan" id="kobo.217.1"> ListView):
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.218.1">'courses/manage/course/list.html'</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.219.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.220.1">CourseCreateView</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.221.1">(OwnerCourseEditMixin, CreateView):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.222.1">pass</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.223.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.224.1">CourseUpdateView</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.225.1">(OwnerCourseEditMixin, UpdateView):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.226.1">pass</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.227.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.228.1">CourseDeleteView</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.229.1">(OwnerCourseMixin, DeleteView):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.230.1">    template_name = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.231.1">'courses/manage/course/delete.html'</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.232.1">In this code, you create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">OwnerMixin</span></code><span class="koboSpan" id="kobo.234.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.235.1">OwnerEditMixin</span></code><span class="koboSpan" id="kobo.236.1"> mixins. </span><span class="koboSpan" id="kobo.236.2">You will use these mixins together with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.237.1">ListView</span></code><span class="koboSpan" id="kobo.238.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">CreateView</span></code><span class="koboSpan" id="kobo.240.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.241.1">UpdateView</span></code><span class="koboSpan" id="kobo.242.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">DeleteView</span></code><span class="koboSpan" id="kobo.244.1"> views provided by Django. </span><code class="inlineCode"><span class="koboSpan" id="kobo.245.1">OwnerMixin</span></code><span class="koboSpan" id="kobo.246.1"> implements the </span><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">get_queryset()</span></code><span class="koboSpan" id="kobo.248.1"> method, which is used by the views to get the base QuerySet. </span><span class="koboSpan" id="kobo.248.2">Your mixin will override this method to filter objects by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.249.1">owner</span></code><span class="koboSpan" id="kobo.250.1"> attribute to retrieve objects that belong to the current user (</span><code class="inlineCode"><span class="koboSpan" id="kobo.251.1">request.user</span></code><span class="koboSpan" id="kobo.252.1">).</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.253.1">OwnerEditMixin</span></code><span class="koboSpan" id="kobo.254.1"> implements the </span><code class="inlineCode"><span class="koboSpan" id="kobo.255.1">form_valid()</span></code><span class="koboSpan" id="kobo.256.1"> method, which is used by views that use Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.257.1">ModelFormMixin</span></code><span class="koboSpan" id="kobo.258.1"> mixin – that is, views with forms or model forms such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.259.1">CreateView</span></code><span class="koboSpan" id="kobo.260.1"> – and </span><code class="inlineCode"><span class="koboSpan" id="kobo.261.1">UpdateView</span></code><span class="koboSpan" id="kobo.262.1">. </span><code class="inlineCode"><span class="koboSpan" id="kobo.263.1">form_valid()</span></code><span class="koboSpan" id="kobo.264.1"> is executed when the submitted form is valid.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.265.1">The default behavior for this method is saving the instance (for model forms) and redirecting the user to </span><code class="inlineCode"><span class="koboSpan" id="kobo.266.1">success_url</span></code><span class="koboSpan" id="kobo.267.1">. </span><span class="koboSpan" id="kobo.267.2">You override this method to automatically set the current user in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.268.1">owner</span></code><span class="koboSpan" id="kobo.269.1"> attribute of the object being saved. </span><span class="koboSpan" id="kobo.269.2">By doing so, you set the owner for an object automatically when it is saved.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.270.1">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.271.1">OwnerMixin</span></code><span class="koboSpan" id="kobo.272.1"> class </span><a id="_idIndexMarker1174"/><span class="koboSpan" id="kobo.273.1">can</span><a id="_idIndexMarker1175"/><span class="koboSpan" id="kobo.274.1"> be </span><a id="_idIndexMarker1176"/><span class="koboSpan" id="kobo.275.1">used for views that interact with any model that contains an </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">owner</span></code><span class="koboSpan" id="kobo.277.1"> attribute.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.278.1">You also define an </span><code class="inlineCode"><span class="koboSpan" id="kobo.279.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.280.1"> class that inherits </span><code class="inlineCode"><span class="koboSpan" id="kobo.281.1">OwnerMixin</span></code><span class="koboSpan" id="kobo.282.1"> and provides the following attributes for child views:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.283.1">model</span></code><span class="koboSpan" id="kobo.284.1">: The model used for QuerySets; it is used by all views.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.285.1">fields</span></code><span class="koboSpan" id="kobo.286.1">: The fields of the model to build the model form of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.287.1">CreateView</span></code><span class="koboSpan" id="kobo.288.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.289.1">UpdateView</span></code><span class="koboSpan" id="kobo.290.1"> views.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.291.1">success_url</span></code><span class="koboSpan" id="kobo.292.1">: Used by </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">CreateView</span></code><span class="koboSpan" id="kobo.294.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.295.1">UpdateView</span></code><span class="koboSpan" id="kobo.296.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.297.1">DeleteView</span></code><span class="koboSpan" id="kobo.298.1"> to redirect the user after the form is successfully submitted or the object is deleted. </span><span class="koboSpan" id="kobo.298.2">You use a URL with the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.299.1">manage_course_list</span></code><span class="koboSpan" id="kobo.300.1">, which you are going to create later.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.301.1">You define an </span><code class="inlineCode"><span class="koboSpan" id="kobo.302.1">OwnerCourseEditMixin</span></code><span class="koboSpan" id="kobo.303.1"> mixin with the following attribute:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.304.1">template_name</span></code><span class="koboSpan" id="kobo.305.1">: The template you will use for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.306.1">CreateView</span></code><span class="koboSpan" id="kobo.307.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.308.1">UpdateView</span></code><span class="koboSpan" id="kobo.309.1"> views.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.310.1">Finally, you create the following views that subclass </span><code class="inlineCode"><span class="koboSpan" id="kobo.311.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.312.1">:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.313.1">ManageCourseListView</span></code><span class="koboSpan" id="kobo.314.1">: Lists the courses created by the user. </span><span class="koboSpan" id="kobo.314.2">It inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.316.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">ListView</span></code><span class="koboSpan" id="kobo.318.1">. </span><span class="koboSpan" id="kobo.318.2">It defines a specific </span><code class="inlineCode"><span class="koboSpan" id="kobo.319.1">template_name</span></code><span class="koboSpan" id="kobo.320.1"> attribute for a template to list courses.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">CourseCreateView</span></code><span class="koboSpan" id="kobo.322.1">: Uses a model form to create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">Course</span></code><span class="koboSpan" id="kobo.324.1"> object. </span><span class="koboSpan" id="kobo.324.2">It uses the fields defined in </span><code class="inlineCode"><span class="koboSpan" id="kobo.325.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.326.1"> to build a model form and also subclasses </span><code class="inlineCode"><span class="koboSpan" id="kobo.327.1">CreateView</span></code><span class="koboSpan" id="kobo.328.1">. </span><span class="koboSpan" id="kobo.328.2">It uses the template defined in </span><code class="inlineCode"><span class="koboSpan" id="kobo.329.1">OwnerCourseEditMixin</span></code><span class="koboSpan" id="kobo.330.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.331.1">CourseUpdateView</span></code><span class="koboSpan" id="kobo.332.1">: Allows the editing of an existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.333.1">Course</span></code><span class="koboSpan" id="kobo.334.1"> object. </span><span class="koboSpan" id="kobo.334.2">It uses the fields defined in </span><code class="inlineCode"><span class="koboSpan" id="kobo.335.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.336.1"> to build a model form and also subclasses </span><code class="inlineCode"><span class="koboSpan" id="kobo.337.1">UpdateView</span></code><span class="koboSpan" id="kobo.338.1">. </span><span class="koboSpan" id="kobo.338.2">It uses the template defined in </span><code class="inlineCode"><span class="koboSpan" id="kobo.339.1">OwnerCourseEditMixin</span></code><span class="koboSpan" id="kobo.340.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.341.1">CourseDeleteView</span></code><span class="koboSpan" id="kobo.342.1">: Inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.343.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.344.1"> and the generic </span><code class="inlineCode"><span class="koboSpan" id="kobo.345.1">DeleteView</span></code><span class="koboSpan" id="kobo.346.1">. </span><span class="koboSpan" id="kobo.346.2">It defines a specific </span><code class="inlineCode"><span class="koboSpan" id="kobo.347.1">template_name</span></code><span class="koboSpan" id="kobo.348.1"> attribute for a template to confirm the course deletion.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.349.1">You have created the basic views to manage courses. </span><span class="koboSpan" id="kobo.349.2">While you have implemented CRUD views on your own, the third-party application Neapolitan allows you to implement the standard list, detail, create, and delete views within a single view. </span><span class="koboSpan" id="kobo.349.3">You can learn </span><a id="_idIndexMarker1177"/><span class="koboSpan" id="kobo.350.1">more</span><a id="_idIndexMarker1178"/><span class="koboSpan" id="kobo.351.1"> about </span><a id="_idIndexMarker1179"/><span class="koboSpan" id="kobo.352.1">Neapolitan at </span><a href="https://github.com/carltongibson/neapolitan"><span class="url"><span class="koboSpan" id="kobo.353.1">https://github.com/carltongibson/neapolitan</span></span></a><span class="koboSpan" id="kobo.354.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.355.1">Next, you are going to use Django authentication groups and permissions to limit access to these views.</span></p>
<h2 class="heading-2" id="_idParaDest-358"><span class="koboSpan" id="kobo.356.1">Working with groups and permissions</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.357.1">Currently, any</span><a id="_idIndexMarker1180"/><span class="koboSpan" id="kobo.358.1"> user can access the views to manage courses. </span><span class="koboSpan" id="kobo.358.2">You want to restrict these views so that only instructors have permission to create and manage courses.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.359.1">Django’s authentication framework includes a permission system. </span><span class="koboSpan" id="kobo.359.2">By default, Django generates four permissions for each model in the installed applications: </span><code class="inlineCode"><span class="koboSpan" id="kobo.360.1">add</span></code><span class="koboSpan" id="kobo.361.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.362.1">view</span></code><span class="koboSpan" id="kobo.363.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.364.1">change</span></code><span class="koboSpan" id="kobo.365.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.366.1">delete</span></code><span class="koboSpan" id="kobo.367.1">. </span><span class="koboSpan" id="kobo.367.2">These permissions correspond to the actions of creating new instances, viewing existing ones, editing, and deleting instances of a model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.368.1">Permissions can be assigned directly to individual users or groups of users. </span><span class="koboSpan" id="kobo.368.2">This approach simplifies user management by grouping permissions and enhances the security of your application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.369.1">You are going to create a group for instructor users and assign permissions to create, update, and delete courses.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.370.1">Run the development server using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.371.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.372.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">http://127.0.0.1:8000/admin/auth/group/add/</span></code><span class="koboSpan" id="kobo.374.1"> in your browser to create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.375.1">Group</span></code><span class="koboSpan" id="kobo.376.1"> object. </span><span class="koboSpan" id="kobo.376.2">Add the name </span><code class="inlineCode"><span class="koboSpan" id="kobo.377.1">Instructors</span></code><span class="koboSpan" id="kobo.378.1"> and choose all permissions of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">courses</span></code><span class="koboSpan" id="kobo.380.1"> application, except </span><a id="_idIndexMarker1181"/><span class="koboSpan" id="kobo.381.1">those of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1">Subject</span></code><span class="koboSpan" id="kobo.383.1"> model, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.384.1"><img alt="" role="presentation" src="../Images/B21088_13_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.385.1">Figure 13.2: The Instructors group permissions</span></p>
<p class="normal"><span class="koboSpan" id="kobo.386.1">As you can see, there are four different permissions for each model: </span><em class="italic"><span class="koboSpan" id="kobo.387.1">can view</span></em><span class="koboSpan" id="kobo.388.1">, </span><em class="italic"><span class="koboSpan" id="kobo.389.1">can add</span></em><span class="koboSpan" id="kobo.390.1">, </span><em class="italic"><span class="koboSpan" id="kobo.391.1">can change</span></em><span class="koboSpan" id="kobo.392.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.393.1">can delete</span></em><span class="koboSpan" id="kobo.394.1">. </span><span class="koboSpan" id="kobo.394.2">After choosing permissions for this group, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.395.1">SAVE</span></strong><span class="koboSpan" id="kobo.396.1"> button.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.397.1">Django creates permissions for models automatically but you can also create custom permissions. </span><span class="koboSpan" id="kobo.397.2">You will learn how to create custom permissions in </span><em class="italic"><span class="koboSpan" id="kobo.398.1">Chapter 15,</span></em> <em class="italic"><span class="koboSpan" id="kobo.399.1">Building an API</span></em><span class="koboSpan" id="kobo.400.1">. </span><span class="koboSpan" id="kobo.400.2">You can read more about adding custom permissions at </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#custom-permissions"><span class="url"><span class="koboSpan" id="kobo.401.1">https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#custom-permissions</span></span></a><span class="koboSpan" id="kobo.402.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.403.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.404.1">http://127.0.0.1:8000/admin/auth/user/add/</span></code><span class="koboSpan" id="kobo.405.1"> and create a new user. </span><span class="koboSpan" id="kobo.405.2">Edit the user and add it to the </span><strong class="screenText"><span class="koboSpan" id="kobo.406.1">Instructors</span></strong><span class="koboSpan" id="kobo.407.1"> group, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.408.1"><img alt="" role="presentation" src="../Images/B21088_13_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.409.1">Figure 13.3: User group selection</span></p>
<p class="normal"><span class="koboSpan" id="kobo.410.1">Users inherit the permissions of the groups they belong to, but you can also add individual permissions </span><a id="_idIndexMarker1182"/><span class="koboSpan" id="kobo.411.1">to a single user using the administration site. </span><span class="koboSpan" id="kobo.411.2">Users that have </span><code class="inlineCode"><span class="koboSpan" id="kobo.412.1">is_superuser</span></code><span class="koboSpan" id="kobo.413.1"> set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1">True</span></code><span class="koboSpan" id="kobo.415.1"> have all permissions automatically.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.416.1">Next, you will apply permissions in practice by incorporating them into our views.</span></p>
<h3 class="heading-3" id="_idParaDest-359"><span class="koboSpan" id="kobo.417.1">Restricting access to class-based views</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.418.1">You are </span><a id="_idIndexMarker1183"/><span class="koboSpan" id="kobo.419.1">going to</span><a id="_idIndexMarker1184"/><span class="koboSpan" id="kobo.420.1"> restrict access to the views so that only users with the appropriate permissions can add, change, or delete </span><code class="inlineCode"><span class="koboSpan" id="kobo.421.1">Course</span></code><span class="koboSpan" id="kobo.422.1"> objects. </span><span class="koboSpan" id="kobo.422.2">You are going to use the following two mixins provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.423.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.424.1"> to limit access to views:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.425.1">LoginRequiredMixin</span></code><span class="koboSpan" id="kobo.426.1">: Replicates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">login_required</span></code><span class="koboSpan" id="kobo.428.1"> decorator’s functionality.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.429.1">PermissionRequiredMixin</span></code><span class="koboSpan" id="kobo.430.1">: Grants access to the view to users with a specific permission. </span><span class="koboSpan" id="kobo.430.2">Remember that superusers automatically have all permissions.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.431.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">views.py</span></code><span class="koboSpan" id="kobo.433.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.434.1">courses</span></code><span class="koboSpan" id="kobo.435.1"> application and add the following import:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.436.1">from</span></span><span class="koboSpan" id="kobo.437.1"> django.contrib.auth.mixins </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.438.1">import</span></span><span class="koboSpan" id="kobo.439.1"> (
    LoginRequiredMixin,
    PermissionRequiredMixin
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.440.1">Make </span><code class="inlineCode"><span class="koboSpan" id="kobo.441.1">OwnerCourseMixin</span></code><span class="koboSpan" id="kobo.442.1"> inherit </span><code class="inlineCode"><span class="koboSpan" id="kobo.443.1">LoginRequiredMixin</span></code><span class="koboSpan" id="kobo.444.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.445.1">PermissionRequiredMixin</span></code><span class="koboSpan" id="kobo.446.1">, like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.447.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.448.1">OwnerCourseMixin</span></span><span class="koboSpan" id="kobo.449.1">(
    OwnerMixin</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.450.1">, LoginRequiredMixin, PermissionRequiredMixin</span></strong></span><span class="koboSpan" id="kobo.451.1">
):
    model = Course
    fields = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.452.1">'subject'</span></span><span class="koboSpan" id="kobo.453.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.454.1">'title'</span></span><span class="koboSpan" id="kobo.455.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.456.1">'slug'</span></span><span class="koboSpan" id="kobo.457.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.458.1">'overview'</span></span><span class="koboSpan" id="kobo.459.1">]
    success_url = reverse_lazy(</span><span class="hljs-string"><span class="koboSpan" id="kobo.460.1">'manage_course_list'</span></span><span class="koboSpan" id="kobo.461.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.462.1">Then, add </span><a id="_idIndexMarker1185"/><span class="koboSpan" id="kobo.463.1">a </span><code class="inlineCode"><span class="koboSpan" id="kobo.464.1">permission_required</span></code><span class="koboSpan" id="kobo.465.1"> attribute</span><a id="_idIndexMarker1186"/><span class="koboSpan" id="kobo.466.1"> to the course views, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.467.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.468.1">ManageCourseListView</span></span><span class="koboSpan" id="kobo.469.1">(OwnerCourseMixin, ListView):
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.470.1">'courses/manage/course/list.html'</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.471.1">    permission_required = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.472.1">'courses.view_course'</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.473.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.474.1">CourseCreateView</span></span><span class="koboSpan" id="kobo.475.1">(OwnerCourseEditMixin, CreateView):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.476.1">    permission_required = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.477.1">'courses.add_course'</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.478.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.479.1">CourseUpdateView</span></span><span class="koboSpan" id="kobo.480.1">(OwnerCourseEditMixin, UpdateView):
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.481.1">    permission_required = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.482.1">'courses.change_course'</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.483.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.484.1">CourseDeleteView</span></span><span class="koboSpan" id="kobo.485.1">(OwnerCourseMixin, DeleteView):
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.486.1">'courses/manage/course/delete.html'</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.487.1">    permission_required = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.488.1">'courses.delete_course'</span></strong></span>
</code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">PermissionRequiredMixin</span></code><span class="koboSpan" id="kobo.490.1"> checks that the user accessing the view has the permission specified in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">permission_required</span></code><span class="koboSpan" id="kobo.492.1"> attribute. </span><span class="koboSpan" id="kobo.492.2">Your views are now only accessible to users with the proper permissions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.493.1">Let’s create URLs for these views. </span><span class="koboSpan" id="kobo.493.2">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.494.1">courses</span></code><span class="koboSpan" id="kobo.495.1"> application directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.496.1">urls.py</span></code><span class="koboSpan" id="kobo.497.1">. </span><span class="koboSpan" id="kobo.497.2">Add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.498.1">from</span></span><span class="koboSpan" id="kobo.499.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.500.1">import</span></span><span class="koboSpan" id="kobo.501.1"> path
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">from</span></span><span class="koboSpan" id="kobo.503.1"> . </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.504.1">import</span></span><span class="koboSpan" id="kobo.505.1"> views
urlpatterns = [
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.506.1">'mine/'</span></span><span class="koboSpan" id="kobo.507.1">,
        views.ManageCourseListView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.508.1">'manage_course_list'</span></span><span class="koboSpan" id="kobo.509.1">
    ),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.510.1">'create/'</span></span><span class="koboSpan" id="kobo.511.1">,
        views.CourseCreateView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.512.1">'course_create'</span></span><span class="koboSpan" id="kobo.513.1">
    ),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.514.1">'&lt;pk&gt;/edit/'</span></span><span class="koboSpan" id="kobo.515.1">,
        views.CourseUpdateView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.516.1">'course_edit'</span></span><span class="koboSpan" id="kobo.517.1">
    ),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.518.1">'&lt;pk&gt;/delete/'</span></span><span class="koboSpan" id="kobo.519.1">,
        views.CourseDeleteView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.520.1">'course_delete'</span></span><span class="koboSpan" id="kobo.521.1">
    ),
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.522.1">These are the URL patterns for the list, create, edit, and delete course views. </span><span class="koboSpan" id="kobo.522.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.523.1">pk</span></code><span class="koboSpan" id="kobo.524.1"> parameter refers to the primary key field. </span><span class="koboSpan" id="kobo.524.2">Remember that </span><strong class="keyWord"><span class="koboSpan" id="kobo.525.1">pk is short for primary key</span></strong><span class="koboSpan" id="kobo.526.1">. </span><span class="koboSpan" id="kobo.526.2">Every Django </span><a id="_idIndexMarker1187"/><span class="koboSpan" id="kobo.527.1">model </span><a id="_idIndexMarker1188"/><span class="koboSpan" id="kobo.528.1">has a field that serves as its primary key. </span><span class="koboSpan" id="kobo.528.2">By default, the primary key is the automatically generated </span><code class="inlineCode"><span class="koboSpan" id="kobo.529.1">id</span></code><span class="koboSpan" id="kobo.530.1"> field. </span><span class="koboSpan" id="kobo.530.2">The Django generic views for single objects retrieve an object by its </span><code class="inlineCode"><span class="koboSpan" id="kobo.531.1">pk</span></code><span class="koboSpan" id="kobo.532.1"> field. </span><span class="koboSpan" id="kobo.532.2">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.533.1">urls.py</span></code><span class="koboSpan" id="kobo.534.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.535.1">educa</span></code><span class="koboSpan" id="kobo.536.1"> project and include the URL patterns of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.537.1">courses</span></code><span class="koboSpan" id="kobo.538.1"> application, as follows.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.539.1">New code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.540.1">from</span></span><span class="koboSpan" id="kobo.541.1"> django.conf </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.542.1">import</span></span><span class="koboSpan" id="kobo.543.1"> settings
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.544.1">from</span></span><span class="koboSpan" id="kobo.545.1"> django.conf.urls.static </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.546.1">import</span></span><span class="koboSpan" id="kobo.547.1"> static
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.548.1">from</span></span><span class="koboSpan" id="kobo.549.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.550.1">import</span></span><span class="koboSpan" id="kobo.551.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.552.1">from</span></span><span class="koboSpan" id="kobo.553.1"> django.contrib.auth </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.554.1">import</span></span><span class="koboSpan" id="kobo.555.1"> views </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1">as</span></span><span class="koboSpan" id="kobo.557.1"> auth_views
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.558.1">from</span></span><span class="koboSpan" id="kobo.559.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.560.1">import</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.561.1">include, </span></strong></span><span class="koboSpan" id="kobo.562.1">path
urlpatterns = [
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.563.1">'accounts/login/'</span></span><span class="koboSpan" id="kobo.564.1">, auth_views.LoginView.as_view(), name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.565.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.566.1">login'</span></span><span class="koboSpan" id="kobo.567.1">
    ),
    path(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.568.1">'accounts/logout/'</span></span><span class="koboSpan" id="kobo.569.1">,
        auth_views.LogoutView.as_view(),
        name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.570.1">'logout'</span></span><span class="koboSpan" id="kobo.571.1">
    ),
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.572.1">'admin/'</span></span><span class="koboSpan" id="kobo.573.1">, admin.site.urls),
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.574.1">    path(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.575.1">'course/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.576.1">, include(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.577.1">'courses.urls'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.578.1">)),</span></strong></span><span class="koboSpan" id="kobo.579.1">
]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.580.1">if</span></span><span class="koboSpan" id="kobo.581.1"> settings.DEBUG:
    urlpatterns += static(
        settings.MEDIA_URL, document_root=settings.MEDIA_ROOT
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.582.1">You need to</span><a id="_idIndexMarker1189"/><span class="koboSpan" id="kobo.583.1"> create </span><a id="_idIndexMarker1190"/><span class="koboSpan" id="kobo.584.1">the templates for these views. </span><span class="koboSpan" id="kobo.584.2">Create the following directories and files inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1">templates/</span></code><span class="koboSpan" id="kobo.586.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">courses</span></code><span class="koboSpan" id="kobo.588.1"> application:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.589.1">courses/
    manage/
        course/
            list.html
            form.html
            delete.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.590.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">courses/manage/course/list.html</span></code><span class="koboSpan" id="kobo.592.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.593.1">{% extends "base.html" %}
{% block title %}My courses{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.594.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.595.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.596.1">&gt;</span></span><span class="koboSpan" id="kobo.597.1">My courses</span><span class="hljs-tag"><span class="koboSpan" id="kobo.598.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.599.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.600.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.601.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.602.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.603.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.604.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.605.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.606.1">&gt;</span></span><span class="koboSpan" id="kobo.607.1">
    {% for course in object_list %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.608.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.609.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.610.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.611.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.612.1">"course-info"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.613.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.614.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.615.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.616.1">&gt;</span></span><span class="koboSpan" id="kobo.617.1">{{ course.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.618.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.619.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.620.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.621.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.622.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.623.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.624.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.625.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.626.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.627.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.628.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.629.1">course_edit</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.630.1">" course.id %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.631.1">&gt;</span></span><span class="koboSpan" id="kobo.632.1">Edit</span><span class="hljs-tag"><span class="koboSpan" id="kobo.633.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.634.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.635.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.636.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.637.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.638.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.639.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.640.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.641.1">course_delete</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.642.1">" course.id %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.643.1">&gt;</span></span><span class="koboSpan" id="kobo.644.1">Delete</span><span class="hljs-tag"><span class="koboSpan" id="kobo.645.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.646.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.647.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.648.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.649.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.650.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.651.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.652.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.653.1">&gt;</span></span><span class="koboSpan" id="kobo.654.1">
    {% empty %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.655.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.656.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.657.1">&gt;</span></span><span class="koboSpan" id="kobo.658.1">You haven't created any courses yet.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.659.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.660.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.661.1">&gt;</span></span><span class="koboSpan" id="kobo.662.1">
    {% endfor %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.663.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.664.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.665.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.666.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.667.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.668.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.669.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.670.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.671.1">course_create</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.672.1">" %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.673.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.674.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.675.1">"button"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.676.1">&gt;</span></span><span class="koboSpan" id="kobo.677.1">Create new course</span><span class="hljs-tag"><span class="koboSpan" id="kobo.678.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.679.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.680.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.681.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.682.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.683.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.684.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.685.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.686.1">&gt;</span></span><span class="koboSpan" id="kobo.687.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.688.1">This is the </span><a id="_idIndexMarker1191"/><span class="koboSpan" id="kobo.689.1">template</span><a id="_idIndexMarker1192"/><span class="koboSpan" id="kobo.690.1"> for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.691.1">ManageCourseListView</span></code><span class="koboSpan" id="kobo.692.1"> view. </span><span class="koboSpan" id="kobo.692.2">In this template, you list the courses created by the current user. </span><span class="koboSpan" id="kobo.692.3">You include links to edit or delete each course and a link to create new courses.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.693.1">Run the development server using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.694.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.695.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.696.1">http://127.0.0.1:8000/accounts/login/?next=/course/mine/</span></code><span class="koboSpan" id="kobo.697.1"> in your browser and log in with a user belonging to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.698.1">Instructors</span></code><span class="koboSpan" id="kobo.699.1"> group. </span><span class="koboSpan" id="kobo.699.2">After logging in, you will be redirected to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.700.1">http://127.0.0.1:8000/course/mine/</span></code><span class="koboSpan" id="kobo.701.1"> URL and you should see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.702.1"><img alt="Graphical user interface, text, application, chat or text message  Description automatically generated" src="../Images/B21088_13_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.703.1">Figure 13.4: The instructor courses page with no courses</span></p>
<p class="normal"><span class="koboSpan" id="kobo.704.1">This page will </span><a id="_idIndexMarker1193"/><span class="koboSpan" id="kobo.705.1">display</span><a id="_idIndexMarker1194"/><span class="koboSpan" id="kobo.706.1"> all courses created by the current user.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.707.1">Let’s create the template that displays the form for the create and update course views. </span><span class="koboSpan" id="kobo.707.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.708.1">courses/manage/course/form.html</span></code><span class="koboSpan" id="kobo.709.1"> template and write the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.710.1">{% extends "base.html" %}
{% block title %}
  {% if object %}
    Edit course "{{ object.title }}"
  {% else %}
    Create a new course
  {% endif %}
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.711.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.712.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.713.1">&gt;</span></span><span class="koboSpan" id="kobo.714.1">
    {% if object %}
      Edit course "{{ object.title }}"
    {% else %}
      Create a new course
    {% endif %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.715.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.716.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.717.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.718.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.719.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.720.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.721.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.722.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.723.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.724.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.725.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.726.1">&gt;</span></span><span class="koboSpan" id="kobo.727.1">Course info</span><span class="hljs-tag"><span class="koboSpan" id="kobo.728.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.729.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.730.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.731.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.732.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.733.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.734.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.735.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.736.1">&gt;</span></span><span class="koboSpan" id="kobo.737.1">
      {{ form.as_p }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.738.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.739.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.740.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.741.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.742.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.743.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.744.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.745.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.746.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.747.1">"Save course"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.748.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.749.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.750.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.751.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.752.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.753.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.754.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.755.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.756.1">&gt;</span></span><span class="koboSpan" id="kobo.757.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.758.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.759.1">form.html</span></code><span class="koboSpan" id="kobo.760.1"> template</span><a id="_idIndexMarker1195"/><span class="koboSpan" id="kobo.761.1"> is </span><a id="_idIndexMarker1196"/><span class="koboSpan" id="kobo.762.1">used for both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.763.1">CourseCreateView</span></code><span class="koboSpan" id="kobo.764.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.765.1">CourseUpdateView</span></code><span class="koboSpan" id="kobo.766.1"> views. </span><span class="koboSpan" id="kobo.766.2">In this template, you check whether an </span><code class="inlineCode"><span class="koboSpan" id="kobo.767.1">object</span></code><span class="koboSpan" id="kobo.768.1"> variable is in the context. </span><span class="koboSpan" id="kobo.768.2">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.769.1">object</span></code><span class="koboSpan" id="kobo.770.1"> exists in the context, you know that you are updating an existing course and you use it in the page title. </span><span class="koboSpan" id="kobo.770.2">Otherwise, you are creating a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.771.1">Course</span></code><span class="koboSpan" id="kobo.772.1"> object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.773.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.774.1">http://127.0.0.1:8000/course/mine/</span></code><span class="koboSpan" id="kobo.775.1"> in your browser and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.776.1">CREATE NEW COURSE</span></strong><span class="koboSpan" id="kobo.777.1"> button. </span><span class="koboSpan" id="kobo.777.2">You will see the following page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.778.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_13_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.779.1">Figure 13.5: The form to create a new course</span></p>
<p class="normal"><span class="koboSpan" id="kobo.780.1">Fill in the </span><a id="_idIndexMarker1197"/><span class="koboSpan" id="kobo.781.1">form and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.782.1">SAVE COURSE</span></strong><span class="koboSpan" id="kobo.783.1"> button. </span><span class="koboSpan" id="kobo.783.2">The course will be saved and you will be redirected to the course list page. </span><span class="koboSpan" id="kobo.783.3">It should look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.784.1"><img alt="Graphical user interface, text, application, chat or text message  Description automatically generated" src="../Images/B21088_13_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.785.1">Figure 13.6: The instructor courses page with one course</span></p>
<p class="normal"><span class="koboSpan" id="kobo.786.1">Then, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.787.1">Edit</span></strong><span class="koboSpan" id="kobo.788.1"> link for</span><a id="_idIndexMarker1198"/><span class="koboSpan" id="kobo.789.1"> the course you have just created. </span><span class="koboSpan" id="kobo.789.2">You will see the form again but, this time, you are editing an existing </span><code class="inlineCode"><span class="koboSpan" id="kobo.790.1">Course</span></code><span class="koboSpan" id="kobo.791.1"> object instead of creating one.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.792.1">Finally, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.793.1">courses/manage/course/delete.html</span></code><span class="koboSpan" id="kobo.794.1"> template and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.795.1">{% extends "base.html" %}
{% block title %}Delete course{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.796.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.797.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.798.1">&gt;</span></span><span class="koboSpan" id="kobo.799.1">Delete course "{{ object.title }}"</span><span class="hljs-tag"><span class="koboSpan" id="kobo.800.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.801.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.802.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.803.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.804.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.805.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.806.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.807.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.808.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.809.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.810.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.811.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.812.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.813.1">""</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.814.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.815.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.816.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.817.1">&gt;</span></span><span class="koboSpan" id="kobo.818.1">
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.819.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.820.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.821.1">&gt;</span></span><span class="koboSpan" id="kobo.822.1">Are you sure you want to delete "{{ object }}"?</span><span class="hljs-tag"><span class="koboSpan" id="kobo.823.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.824.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.825.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.826.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.827.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.828.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.829.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.830.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.831.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.832.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.833.1">"Confirm"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.834.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.835.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.836.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.837.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.838.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.839.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.840.1">&gt;</span></span><span class="koboSpan" id="kobo.841.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.842.1">This is the template for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.843.1">CourseDeleteView</span></code><span class="koboSpan" id="kobo.844.1"> view. </span><span class="koboSpan" id="kobo.844.2">This view inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.845.1">DeleteView</span></code><span class="koboSpan" id="kobo.846.1">, provided by Django, which expects user confirmation to delete an object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.847.1">Open the course list in the browser and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.848.1">Delete</span></strong><span class="koboSpan" id="kobo.849.1"> link of your course. </span><span class="koboSpan" id="kobo.849.2">You should see the following confirmation page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.850.1"><img alt="Graphical user interface, text, application, chat or text message  Description automatically generated" src="../Images/B21088_13_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.851.1">Figure 13.7: The Delete course confirmation page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.852.1">Click the </span><strong class="screenText"><span class="koboSpan" id="kobo.853.1">CONFIRM</span></strong><span class="koboSpan" id="kobo.854.1"> button. </span><span class="koboSpan" id="kobo.854.2">The course will be deleted and you will be redirected to the course list page again.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.855.1">Instructors can </span><a id="_idIndexMarker1199"/><span class="koboSpan" id="kobo.856.1">now</span><a id="_idIndexMarker1200"/><span class="koboSpan" id="kobo.857.1"> create, edit, and delete courses. </span><span class="koboSpan" id="kobo.857.2">Next, you need to provide them with a CMS to add course modules and their contents. </span><span class="koboSpan" id="kobo.857.3">You will start by managing course modules.</span></p>
<h1 class="heading-1" id="_idParaDest-360"><span class="koboSpan" id="kobo.858.1">Managing course modules and their contents</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.859.1">You are going to</span><a id="_idIndexMarker1201"/><span class="koboSpan" id="kobo.860.1"> build a system to manage course modules</span><a id="_idIndexMarker1202"/><span class="koboSpan" id="kobo.861.1"> and their contents. </span><span class="koboSpan" id="kobo.861.2">You will need to build forms that can be used for managing multiple modules per course and different types of content for each module. </span><span class="koboSpan" id="kobo.861.3">Both modules and their contents will have to follow a specific order and you</span><a id="_idIndexMarker1203"/><span class="koboSpan" id="kobo.862.1"> should be able to reorder them </span><a id="_idIndexMarker1204"/><span class="koboSpan" id="kobo.863.1">using the CMS.</span></p>
<h2 class="heading-2" id="_idParaDest-361"><span class="koboSpan" id="kobo.864.1">Using formsets for course modules</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.865.1">Django comes with </span><a id="_idIndexMarker1205"/><span class="koboSpan" id="kobo.866.1">an abstraction layer to work with multiple forms on the same page. </span><span class="koboSpan" id="kobo.866.2">These groups of forms are known as </span><em class="italic"><span class="koboSpan" id="kobo.867.1">formsets</span></em><span class="koboSpan" id="kobo.868.1">. </span><span class="koboSpan" id="kobo.868.2">Formsets manage multiple instances of a certain </span><code class="inlineCode"><span class="koboSpan" id="kobo.869.1">Form</span></code><span class="koboSpan" id="kobo.870.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.871.1">ModelForm</span></code><span class="koboSpan" id="kobo.872.1">. </span><span class="koboSpan" id="kobo.872.2">All forms are submitted at once and the formset takes care of the initial number of forms to display, limiting the maximum number of forms that can be submitted and validating all the forms.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.873.1">Formsets include an </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">is_valid()</span></code><span class="koboSpan" id="kobo.875.1"> method to validate all forms at once. </span><span class="koboSpan" id="kobo.875.2">You can also provide initial data for the forms and specify how many additional empty forms to display. </span><span class="koboSpan" id="kobo.875.3">You can learn more about formsets at </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/formsets/"><span class="url"><span class="koboSpan" id="kobo.876.1">https://docs.djangoproject.com/en/5.0/topics/forms/formsets/</span></span></a><span class="koboSpan" id="kobo.877.1"> and about model formsets at </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/#model-formsets"><span class="url"><span class="koboSpan" id="kobo.878.1">https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/#model-formsets</span></span></a><span class="koboSpan" id="kobo.879.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.880.1">Since a course is divided into a variable number of modules, it makes sense to use formsets to manage them. </span><span class="koboSpan" id="kobo.880.2">Create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.881.1">forms.py</span></code><span class="koboSpan" id="kobo.882.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.883.1">courses</span></code><span class="koboSpan" id="kobo.884.1"> application directory and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.885.1">from</span></span><span class="koboSpan" id="kobo.886.1"> django.forms.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.887.1">import</span></span><span class="koboSpan" id="kobo.888.1"> inlineformset_factory
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.889.1">from</span></span><span class="koboSpan" id="kobo.890.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.891.1">import</span></span><span class="koboSpan" id="kobo.892.1"> Course, Module
ModuleFormSet = inlineformset_factory(
    Course,
    Module,
    fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.893.1">'title'</span></span><span class="koboSpan" id="kobo.894.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.895.1">'description'</span></span><span class="koboSpan" id="kobo.896.1">],
    extra=</span><span class="hljs-number"><span class="koboSpan" id="kobo.897.1">2</span></span><span class="koboSpan" id="kobo.898.1">,
    can_delete=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.899.1">True</span></span><span class="koboSpan" id="kobo.900.1">
)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.901.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.902.1">ModuleFormSet</span></code><span class="koboSpan" id="kobo.903.1"> formset. </span><span class="koboSpan" id="kobo.903.2">You build it using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.904.1">inlineformset_factory()</span></code><span class="koboSpan" id="kobo.905.1"> function provided by Django. </span><span class="koboSpan" id="kobo.905.2">Inline formsets are a small abstraction on top of formsets that simplify working with related objects. </span><span class="koboSpan" id="kobo.905.3">This function allows you to build a model formset dynamically for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.906.1">Module</span></code><span class="koboSpan" id="kobo.907.1"> objects related to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.908.1">Course</span></code><span class="koboSpan" id="kobo.909.1"> object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.910.1">You use the following parameters to build the formset:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.911.1">fields</span></code><span class="koboSpan" id="kobo.912.1">: The fields that will be included in each form of the formset.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.913.1">extra</span></code><span class="koboSpan" id="kobo.914.1">: Allows you to set the number of empty extra forms to display in the formset.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.915.1">can_delete</span></code><span class="koboSpan" id="kobo.916.1">: If you set this to </span><code class="inlineCode"><span class="koboSpan" id="kobo.917.1">True</span></code><span class="koboSpan" id="kobo.918.1">, Django will include a Boolean field for each form that will be rendered as a checkbox input. </span><span class="koboSpan" id="kobo.918.2">It allows you to mark the objects that you want to delete.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.919.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.920.1">views.py</span></code><span class="koboSpan" id="kobo.921.1"> file </span><a id="_idIndexMarker1206"/><span class="koboSpan" id="kobo.922.1">of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.923.1">courses</span></code><span class="koboSpan" id="kobo.924.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.925.1">from</span></span><span class="koboSpan" id="kobo.926.1"> django.shortcuts </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.927.1">import</span></span><span class="koboSpan" id="kobo.928.1"> get_object_or_404, redirect
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.929.1">from</span></span><span class="koboSpan" id="kobo.930.1"> django.views.generic.base </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.931.1">import</span></span><span class="koboSpan" id="kobo.932.1"> TemplateResponseMixin, View
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.933.1">from</span></span><span class="koboSpan" id="kobo.934.1"> .forms </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.935.1">import</span></span><span class="koboSpan" id="kobo.936.1"> ModuleFormSet
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.937.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.938.1">CourseModuleUpdateView</span></span><span class="koboSpan" id="kobo.939.1">(TemplateResponseMixin, View):
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.940.1">'courses/manage/module/formset.html'</span></span><span class="koboSpan" id="kobo.941.1">
    course = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.942.1">None</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.943.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.944.1">get_formset</span></span><span class="koboSpan" id="kobo.945.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.946.1">self, data=</span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.947.1">None</span></span><span class="koboSpan" id="kobo.948.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.949.1">return</span></span><span class="koboSpan" id="kobo.950.1"> ModuleFormSet(instance=self.course, data=data)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.951.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.952.1">dispatch</span></span><span class="koboSpan" id="kobo.953.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.954.1">self, request, pk</span></span><span class="koboSpan" id="kobo.955.1">):
        self.course = get_object_or_404(
            Course, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.956.1">id</span></span><span class="koboSpan" id="kobo.957.1">=pk, owner=request.user
        )
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.958.1">return</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.959.1">super</span></span><span class="koboSpan" id="kobo.960.1">().dispatch(request, pk)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.961.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.962.1">get</span></span><span class="koboSpan" id="kobo.963.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.964.1">self, request, *args, **kwargs</span></span><span class="koboSpan" id="kobo.965.1">):
        formset = self.get_formset()
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.966.1">return</span></span><span class="koboSpan" id="kobo.967.1"> self.render_to_response(
            {</span><span class="hljs-string"><span class="koboSpan" id="kobo.968.1">'course'</span></span><span class="koboSpan" id="kobo.969.1">: self.course, </span><span class="hljs-string"><span class="koboSpan" id="kobo.970.1">'formset'</span></span><span class="koboSpan" id="kobo.971.1">: formset}
        )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.972.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.973.1">post</span></span><span class="koboSpan" id="kobo.974.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.975.1">self, request, *args, **kwargs</span></span><span class="koboSpan" id="kobo.976.1">):
        formset = self.get_formset(data=request.POST)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.977.1">if</span></span><span class="koboSpan" id="kobo.978.1"> formset.is_valid():
            formset.save()
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.979.1">return</span></span><span class="koboSpan" id="kobo.980.1"> redirect(</span><span class="hljs-string"><span class="koboSpan" id="kobo.981.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.982.1">manage_course_list'</span></span><span class="koboSpan" id="kobo.983.1">)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.984.1">return</span></span><span class="koboSpan" id="kobo.985.1"> self.render_to_response(
            {</span><span class="hljs-string"><span class="koboSpan" id="kobo.986.1">'course'</span></span><span class="koboSpan" id="kobo.987.1">: self.course, </span><span class="hljs-string"><span class="koboSpan" id="kobo.988.1">'formset'</span></span><span class="koboSpan" id="kobo.989.1">: formset}
        )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.990.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.991.1">CourseModuleUpdateView</span></code><span class="koboSpan" id="kobo.992.1"> view handles the formset to add, update, and delete modules for a specific course. </span><span class="koboSpan" id="kobo.992.2">This view inherits from the following mixins and views:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.993.1">TemplateResponseMixin</span></code><span class="koboSpan" id="kobo.994.1">: This mixin takes charge of rendering templates and returning an HTTP response. </span><span class="koboSpan" id="kobo.994.2">It requires a </span><code class="inlineCode"><span class="koboSpan" id="kobo.995.1">template_name</span></code><span class="koboSpan" id="kobo.996.1"> attribute that indicates the template to be rendered and provides the </span><code class="inlineCode"><span class="koboSpan" id="kobo.997.1">render_to_response()</span></code><span class="koboSpan" id="kobo.998.1"> method to pass it a context and render the template.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.999.1">View</span></code><span class="koboSpan" id="kobo.1000.1">: The basic class-based view provided by Django.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1001.1">In this view, you</span><a id="_idIndexMarker1207"/><span class="koboSpan" id="kobo.1002.1"> implement the following methods:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1003.1">get_formset()</span></code><span class="koboSpan" id="kobo.1004.1">: You define this method to avoid repeating the code to build the formset. </span><span class="koboSpan" id="kobo.1004.2">You create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1">ModuleFormSet</span></code><span class="koboSpan" id="kobo.1006.1"> object for the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.1007.1">Course</span></code><span class="koboSpan" id="kobo.1008.1"> object with optional data.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1009.1">dispatch()</span></code><span class="koboSpan" id="kobo.1010.1">: This method is provided by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1011.1">View</span></code><span class="koboSpan" id="kobo.1012.1"> class. </span><span class="koboSpan" id="kobo.1012.2">It takes an HTTP request and its parameters and attempts to delegate to a lowercase method that matches the HTTP method used. </span><span class="koboSpan" id="kobo.1012.3">A </span><code class="inlineCode"><span class="koboSpan" id="kobo.1013.1">GET</span></code><span class="koboSpan" id="kobo.1014.1"> request is delegated to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1015.1">get()</span></code><span class="koboSpan" id="kobo.1016.1"> method and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1017.1">POST</span></code><span class="koboSpan" id="kobo.1018.1"> request to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1019.1">post()</span></code><span class="koboSpan" id="kobo.1020.1">, respectively. </span><span class="koboSpan" id="kobo.1020.2">In this method, you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1021.1">get_object_or_404()</span></code><span class="koboSpan" id="kobo.1022.1"> shortcut function to get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1023.1">Course</span></code><span class="koboSpan" id="kobo.1024.1"> object for the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.1025.1">id</span></code><span class="koboSpan" id="kobo.1026.1"> parameter that belongs to the current user. </span><span class="koboSpan" id="kobo.1026.2">You include this code in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1027.1">dispatch()</span></code><span class="koboSpan" id="kobo.1028.1"> method because you need to retrieve the course for both </span><code class="inlineCode"><span class="koboSpan" id="kobo.1029.1">GET</span></code><span class="koboSpan" id="kobo.1030.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1031.1">POST</span></code><span class="koboSpan" id="kobo.1032.1"> requests. </span><span class="koboSpan" id="kobo.1032.2">You save it into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1033.1">course</span></code><span class="koboSpan" id="kobo.1034.1"> attribute of the view to make it accessible to other methods.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1035.1">get()</span></code><span class="koboSpan" id="kobo.1036.1">: Executed for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1">GET</span></code><span class="koboSpan" id="kobo.1038.1"> requests. </span><span class="koboSpan" id="kobo.1038.2">You build an empty </span><code class="inlineCode"><span class="koboSpan" id="kobo.1039.1">ModuleFormSet</span></code><span class="koboSpan" id="kobo.1040.1"> formset and render it to the template together with the current </span><code class="inlineCode"><span class="koboSpan" id="kobo.1041.1">Course</span></code><span class="koboSpan" id="kobo.1042.1"> object, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1043.1">render_to_response()</span></code><span class="koboSpan" id="kobo.1044.1"> method provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.1045.1">TemplateResponseMixin</span></code><span class="koboSpan" id="kobo.1046.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1047.1">post()</span></code><span class="koboSpan" id="kobo.1048.1">: Executed for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1049.1">POST</span></code><span class="koboSpan" id="kobo.1050.1"> requests. </span><span class="koboSpan" id="kobo.1050.2">In this method, you perform the following actions:</span><ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1051.1">You build a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1052.1">ModuleFormSet</span></code><span class="koboSpan" id="kobo.1053.1"> instance using the submitted data.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1054.1">You execute the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1055.1">is_valid()</span></code><span class="koboSpan" id="kobo.1056.1"> method of the formset to validate all of its forms.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1057.1">If the formset is valid, you save it by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1058.1">save()</span></code><span class="koboSpan" id="kobo.1059.1"> method. </span><span class="koboSpan" id="kobo.1059.2">At this point, any changes made, such as adding, updating, or marking modules for deletion, are applied to the database. </span><span class="koboSpan" id="kobo.1059.3">Then, you redirect users to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1060.1">manage_course_list</span></code><span class="koboSpan" id="kobo.1061.1"> URL. </span><span class="koboSpan" id="kobo.1061.2">If the formset is not valid, you render the template to display any errors instead.</span></li>
</ol>
</li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1062.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1063.1">urls.py</span></code><span class="koboSpan" id="kobo.1064.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1065.1">courses</span></code><span class="koboSpan" id="kobo.1066.1"> application and add the following URL pattern to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1067.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1068.1">'&lt;pk&gt;/module/'</span></span><span class="koboSpan" id="kobo.1069.1">,
    views.CourseModuleUpdateView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1070.1">'course_module_update'</span></span><span class="koboSpan" id="kobo.1071.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1072.1">Create a new directory inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1073.1">courses/manage/</span></code><span class="koboSpan" id="kobo.1074.1"> template directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1075.1">module</span></code><span class="koboSpan" id="kobo.1076.1">. </span><span class="koboSpan" id="kobo.1076.2">Create </span><a id="_idIndexMarker1208"/><span class="koboSpan" id="kobo.1077.1">a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1">courses/manage/module/formset.html</span></code><span class="koboSpan" id="kobo.1079.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1080.1">{% extends "base.html" %}
{% block title %}
  Edit "{{ course.title }}"
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1081.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1082.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1083.1">&gt;</span></span><span class="koboSpan" id="kobo.1084.1">Edit "{{ course.title }}"</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1085.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1086.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1087.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1088.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1089.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1090.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1091.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1092.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1093.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1094.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1095.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1096.1">&gt;</span></span><span class="koboSpan" id="kobo.1097.1">Course modules</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1098.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1099.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1100.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1101.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1102.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1103.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1104.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1105.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1106.1">&gt;</span></span><span class="koboSpan" id="kobo.1107.1">
      {{ formset }}
      {{ formset.management_form }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1108.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1109.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1110.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1111.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1112.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1113.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1114.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1115.1">"Save modules"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1116.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1117.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1118.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1119.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1120.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1121.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1122.1">&gt;</span></span><span class="koboSpan" id="kobo.1123.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1124.1">In this template, you create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1125.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.1126.1"> HTML element in which you include </span><code class="inlineCode"><span class="koboSpan" id="kobo.1127.1">formset</span></code><span class="koboSpan" id="kobo.1128.1">. </span><span class="koboSpan" id="kobo.1128.2">You also include the management form for the formset with the variable </span><code class="inlineCode"><span class="koboSpan" id="kobo.1129.1">{{ formset.management_form }}</span></code><span class="koboSpan" id="kobo.1130.1">. </span><span class="koboSpan" id="kobo.1130.2">The management form includes hidden fields to control the initial, total, minimum, and maximum number of forms.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1131.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1132.1">courses/manage/course/list.html</span></code><span class="koboSpan" id="kobo.1133.1"> template and add the following link for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1134.1">course_module_update</span></code><span class="koboSpan" id="kobo.1135.1"> URL below the course </span><strong class="screenText"><span class="koboSpan" id="kobo.1136.1">Edit</span></strong><span class="koboSpan" id="kobo.1137.1"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.1138.1">Delete</span></strong><span class="koboSpan" id="kobo.1139.1"> links:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1140.1">&lt;a href=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1141.1">"{% url "</span></span><span class="koboSpan" id="kobo.1142.1">course_edit</span><span class="hljs-string"><span class="koboSpan" id="kobo.1143.1">" course.id %}"</span></span><span class="koboSpan" id="kobo.1144.1">&gt;Edit&lt;/a&gt;
&lt;a href=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1145.1">"{% url "</span></span><span class="koboSpan" id="kobo.1146.1">course_delete</span><span class="hljs-string"><span class="koboSpan" id="kobo.1147.1">" course.id %}"</span></span><span class="koboSpan" id="kobo.1148.1">&gt;Delete&lt;/a&gt;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1149.1">&lt;a href=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1150.1">"{% url "</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1151.1">course_module_update</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1152.1">" course.id %}"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1153.1">&gt;Edit modules&lt;/a&gt;</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1154.1">You have included the link to edit the course modules.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1155.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1156.1">http://127.0.0.1:8000/course/mine/</span></code><span class="koboSpan" id="kobo.1157.1"> in your browser. </span><span class="koboSpan" id="kobo.1157.2">Create a course and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.1158.1">Edit modules</span></strong><span class="koboSpan" id="kobo.1159.1"> link </span><a id="_idIndexMarker1209"/><span class="koboSpan" id="kobo.1160.1">for it. </span><span class="koboSpan" id="kobo.1160.2">You should see a formset, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1161.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_13_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1162.1">Figure 13.8: The course edit page, including the formset for course modules</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1163.1">The formset </span><a id="_idIndexMarker1210"/><span class="koboSpan" id="kobo.1164.1">includes a form for each </span><code class="inlineCode"><span class="koboSpan" id="kobo.1165.1">Module</span></code><span class="koboSpan" id="kobo.1166.1"> object contained in the course. </span><span class="koboSpan" id="kobo.1166.2">After these, two empty extra forms are displayed because you set </span><code class="inlineCode"><span class="koboSpan" id="kobo.1167.1">extra=2</span></code><span class="koboSpan" id="kobo.1168.1"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">ModuleFormSet</span></code><span class="koboSpan" id="kobo.1170.1">. </span><span class="koboSpan" id="kobo.1170.2">When you save the formset, Django will include another two extra fields to add new modules.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1171.1">You can see that formsets are incredibly useful for managing multiple instances of forms on a single page. </span><span class="koboSpan" id="kobo.1171.2">Formsets simplify the process of collecting and validating data from sets of similar forms efficiently.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1172.1">After understanding</span><a id="_idIndexMarker1211"/><span class="koboSpan" id="kobo.1173.1"> how formsets work, you will explore advanced form capabilities by creating forms dynamically that adapt to the various types of content that will be added to course modules.</span></p>
<h2 class="heading-2" id="_idParaDest-362"><span class="koboSpan" id="kobo.1174.1">Adding content to course modules</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1175.1">Now, you need a</span><a id="_idIndexMarker1212"/><span class="koboSpan" id="kobo.1176.1"> way to add content to course modules. </span><span class="koboSpan" id="kobo.1176.2">You have four different types of content: text, video, image, and file. </span><span class="koboSpan" id="kobo.1176.3">You could consider creating four different views to create content, with one form for each model. </span><span class="koboSpan" id="kobo.1176.4">However, you are going to take a more versatile approach and create a view that handles creating or updating the objects of any content model. </span><span class="koboSpan" id="kobo.1176.5">You will build the form for this view dynamically, according to the type of content the instructor wants to add to the course: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1177.1">Text</span></code><span class="koboSpan" id="kobo.1178.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1179.1">Video</span></code><span class="koboSpan" id="kobo.1180.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1181.1">Image</span></code><span class="koboSpan" id="kobo.1182.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1183.1">File</span></code><span class="koboSpan" id="kobo.1184.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1185.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1186.1">views.py</span></code><span class="koboSpan" id="kobo.1187.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1188.1">courses</span></code><span class="koboSpan" id="kobo.1189.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1190.1">from</span></span><span class="koboSpan" id="kobo.1191.1"> django.apps </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1192.1">import</span></span><span class="koboSpan" id="kobo.1193.1"> apps
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1194.1">from</span></span><span class="koboSpan" id="kobo.1195.1"> django.forms.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1196.1">import</span></span><span class="koboSpan" id="kobo.1197.1"> modelform_factory
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1198.1">from</span></span><span class="koboSpan" id="kobo.1199.1"> .models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1200.1">import</span></span><span class="koboSpan" id="kobo.1201.1"> Module, Content
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1202.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1203.1">ContentCreateUpdateView</span></span><span class="koboSpan" id="kobo.1204.1">(TemplateResponseMixin, View):
    module = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1205.1">None</span></span><span class="koboSpan" id="kobo.1206.1">
    model = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1207.1">None</span></span><span class="koboSpan" id="kobo.1208.1">
    obj = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1209.1">None</span></span><span class="koboSpan" id="kobo.1210.1">
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1211.1">'courses/manage/content/form.html'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1212.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1213.1">get_model</span></span><span class="koboSpan" id="kobo.1214.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1215.1">self, model_name</span></span><span class="koboSpan" id="kobo.1216.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1217.1">if</span></span><span class="koboSpan" id="kobo.1218.1"> model_name </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1219.1">in</span></span><span class="koboSpan" id="kobo.1220.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1221.1">'text'</span></span><span class="koboSpan" id="kobo.1222.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1223.1">'video'</span></span><span class="koboSpan" id="kobo.1224.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1225.1">'image'</span></span><span class="koboSpan" id="kobo.1226.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1227.1">'file'</span></span><span class="koboSpan" id="kobo.1228.1">]:
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1229.1">return</span></span><span class="koboSpan" id="kobo.1230.1"> apps.get_model(
                app_label=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1231.1">'courses'</span></span><span class="koboSpan" id="kobo.1232.1">, model_name=model_name
            )
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1233.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1234.1">None</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1235.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1236.1">get_form</span></span><span class="koboSpan" id="kobo.1237.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1238.1">self, model, *args, **kwargs</span></span><span class="koboSpan" id="kobo.1239.1">):
        Form = modelform_factory(
            model, exclude=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1240.1">'owner'</span></span><span class="koboSpan" id="kobo.1241.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1242.1">'order'</span></span><span class="koboSpan" id="kobo.1243.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1244.1">'created'</span></span><span class="koboSpan" id="kobo.1245.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1246.1">'updated'</span></span><span class="koboSpan" id="kobo.1247.1">]
        )
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1248.1">return</span></span><span class="koboSpan" id="kobo.1249.1"> Form(*args, **kwargs)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1250.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1251.1">dispatch</span></span><span class="koboSpan" id="kobo.1252.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1253.1">self, request, module_id, model_name, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1254.1">id</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1255.1">=</span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1256.1">None</span></span><span class="koboSpan" id="kobo.1257.1">):
        self.module = get_object_or_404(
            Module, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1258.1">id</span></span><span class="koboSpan" id="kobo.1259.1">=module_id, course__owner=request.user
        )
        self.model = self.get_model(model_name)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1260.1">if</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1261.1">id</span></span><span class="koboSpan" id="kobo.1262.1">:
            self.obj = get_object_or_404(
                self.model, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1263.1">id</span></span><span class="koboSpan" id="kobo.1264.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1265.1">id</span></span><span class="koboSpan" id="kobo.1266.1">, owner=request.user
            )
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1267.1">return</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1268.1">super</span></span><span class="koboSpan" id="kobo.1269.1">().dispatch(request, module_id, model_name, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1270.1">id</span></span><span class="koboSpan" id="kobo.1271.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1272.1">This is the first part of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1273.1">ContentCreateUpdateView</span></code><span class="koboSpan" id="kobo.1274.1">. </span><span class="koboSpan" id="kobo.1274.2">It will allow you to create and update different models’ contents. </span><span class="koboSpan" id="kobo.1274.3">This </span><a id="_idIndexMarker1213"/><span class="koboSpan" id="kobo.1275.1">view defines the following methods:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1276.1">get_model()</span></code><span class="koboSpan" id="kobo.1277.1">: Here, you check that the given model name is one of the four content models: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1">Text</span></code><span class="koboSpan" id="kobo.1279.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1280.1">Video</span></code><span class="koboSpan" id="kobo.1281.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1282.1">Image</span></code><span class="koboSpan" id="kobo.1283.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1284.1">File</span></code><span class="koboSpan" id="kobo.1285.1">. </span><span class="koboSpan" id="kobo.1285.2">Then, you use Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1286.1">apps</span></code><span class="koboSpan" id="kobo.1287.1"> module to obtain the actual class for the given model name. </span><span class="koboSpan" id="kobo.1287.2">If the given model name is not one of the valid ones, you return </span><code class="inlineCode"><span class="koboSpan" id="kobo.1288.1">None</span></code><span class="koboSpan" id="kobo.1289.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1290.1">get_form()</span></code><span class="koboSpan" id="kobo.1291.1">: You build a dynamic form using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1292.1">modelform_factory()</span></code><span class="koboSpan" id="kobo.1293.1"> function of the form’s framework. </span><span class="koboSpan" id="kobo.1293.2">Since you are going to build a form for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">Text</span></code><span class="koboSpan" id="kobo.1295.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1">Video</span></code><span class="koboSpan" id="kobo.1297.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">Image</span></code><span class="koboSpan" id="kobo.1299.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1">File</span></code><span class="koboSpan" id="kobo.1301.1"> models, you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1302.1">exclude</span></code><span class="koboSpan" id="kobo.1303.1"> parameter to specify the common fields to exclude from the form and let all other attributes be included automatically. </span><span class="koboSpan" id="kobo.1303.2">By doing so, you don’t have to know which fields to include depending on the model.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1304.1">dispatch()</span></code><span class="koboSpan" id="kobo.1305.1">: This receives the following URL parameters and stores the corresponding module, model, and content object as class attributes:</span><ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1306.1">module_id</span></code><span class="koboSpan" id="kobo.1307.1">: The ID for the module that the content is/will be associated with.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1308.1">model_name</span></code><span class="koboSpan" id="kobo.1309.1">: The model name of the content to create/update.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1310.1">id</span></code><span class="koboSpan" id="kobo.1311.1">: The ID of the object that is being updated. </span><span class="koboSpan" id="kobo.1311.2">It’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1312.1">None</span></code><span class="koboSpan" id="kobo.1313.1"> to create new objects.</span></li>
</ul>
</li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1314.1">Add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1315.1">get()</span></code><span class="koboSpan" id="kobo.1316.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1317.1">post()</span></code><span class="koboSpan" id="kobo.1318.1"> methods to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1319.1">ContentCreateUpdateView</span></code><span class="koboSpan" id="kobo.1320.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1321.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1322.1">get</span></span><span class="koboSpan" id="kobo.1323.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1324.1">self, request, module_id, model_name, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1325.1">id</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1326.1">=</span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1327.1">None</span></span><span class="koboSpan" id="kobo.1328.1">):
    form = self.get_form(self.model, instance=self.obj)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1329.1">return</span></span><span class="koboSpan" id="kobo.1330.1"> self.render_to_response(
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.1331.1">'form'</span></span><span class="koboSpan" id="kobo.1332.1">: form, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1333.1">'object'</span></span><span class="koboSpan" id="kobo.1334.1">: self.obj}
    )
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1335.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1336.1">post</span></span><span class="koboSpan" id="kobo.1337.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1338.1">self, request, module_id, model_name, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1339.1">id</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1340.1">=</span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1341.1">None</span></span><span class="koboSpan" id="kobo.1342.1">):
    form = self.get_form(
        self.model,
        instance=self.obj,
        data=request.POST,
        files=request.FILES
    )
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1343.1">if</span></span><span class="koboSpan" id="kobo.1344.1"> form.is_valid():
        obj = form.save(commit=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1345.1">False</span></span><span class="koboSpan" id="kobo.1346.1">)
        obj.owner = request.user
        obj.save()
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1347.1">if</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1348.1">not</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1349.1">id</span></span><span class="koboSpan" id="kobo.1350.1">:
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1351.1"># new content</span></span><span class="koboSpan" id="kobo.1352.1">
            Content.objects.create(module=self.module, item=obj)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1353.1">return</span></span><span class="koboSpan" id="kobo.1354.1"> redirect(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1355.1">'module_content_list'</span></span><span class="koboSpan" id="kobo.1356.1">, self.module.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1357.1">id</span></span><span class="koboSpan" id="kobo.1358.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1359.1">return</span></span><span class="koboSpan" id="kobo.1360.1"> self.render_to_response(
        {</span><span class="hljs-string"><span class="koboSpan" id="kobo.1361.1">'form'</span></span><span class="koboSpan" id="kobo.1362.1">: form, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1363.1">'object'</span></span><span class="koboSpan" id="kobo.1364.1">: self.obj}
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1365.1">These methods</span><a id="_idIndexMarker1214"/><span class="koboSpan" id="kobo.1366.1"> are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1367.1">get()</span></code><span class="koboSpan" id="kobo.1368.1">: Executed when a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1369.1">GET</span></code><span class="koboSpan" id="kobo.1370.1"> request is received. </span><span class="koboSpan" id="kobo.1370.2">You build the model form for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1371.1">Text</span></code><span class="koboSpan" id="kobo.1372.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1373.1">Video</span></code><span class="koboSpan" id="kobo.1374.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1375.1">Image</span></code><span class="koboSpan" id="kobo.1376.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1377.1">File</span></code><span class="koboSpan" id="kobo.1378.1"> instance that is being updated. </span><span class="koboSpan" id="kobo.1378.2">Otherwise, you pass no instance to create a new object since </span><code class="inlineCode"><span class="koboSpan" id="kobo.1379.1">self.obj</span></code><span class="koboSpan" id="kobo.1380.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1">None</span></code><span class="koboSpan" id="kobo.1382.1"> if no ID is provided.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1383.1">post()</span></code><span class="koboSpan" id="kobo.1384.1">: Executed when a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1385.1">POST</span></code><span class="koboSpan" id="kobo.1386.1"> request is received. </span><span class="koboSpan" id="kobo.1386.2">You build the model form, passing any submitted data and files to it. </span><span class="koboSpan" id="kobo.1386.3">Then, you validate it. </span><span class="koboSpan" id="kobo.1386.4">If the form is valid, you create a new object and assign </span><code class="inlineCode"><span class="koboSpan" id="kobo.1387.1">request.user</span></code><span class="koboSpan" id="kobo.1388.1"> as its owner before saving it to the database. </span><span class="koboSpan" id="kobo.1388.2">You check for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1389.1">id</span></code><span class="koboSpan" id="kobo.1390.1"> parameter. </span><span class="koboSpan" id="kobo.1390.2">If no ID is provided, you know the user is creating a new object instead of updating an existing one. </span><span class="koboSpan" id="kobo.1390.3">If this is a new object, you create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1391.1">content</span></code><span class="koboSpan" id="kobo.1392.1"> object for the given module and associate the new content with it.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1393.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1394.1">urls.py</span></code><span class="koboSpan" id="kobo.1395.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1396.1">courses</span></code><span class="koboSpan" id="kobo.1397.1"> application and add the following URL patterns to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1398.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1399.1">'module/&lt;int:module_id&gt;/content/&lt;model_name&gt;/create/'</span></span><span class="koboSpan" id="kobo.1400.1">,
    views.ContentCreateUpdateView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1401.1">'module_content_create'</span></span><span class="koboSpan" id="kobo.1402.1">
),
path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1403.1">'module/&lt;int:module_id&gt;/content/&lt;model_name&gt;/&lt;id&gt;/'</span></span><span class="koboSpan" id="kobo.1404.1">,
    views.ContentCreateUpdateView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1405.1">'module_content_update'</span></span><span class="koboSpan" id="kobo.1406.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1407.1">The new URL patterns are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1408.1">module_content_create</span></code><span class="koboSpan" id="kobo.1409.1">: To create new text, video, image, or file objects and add them to a module. </span><span class="koboSpan" id="kobo.1409.2">It includes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1410.1">module_id</span></code><span class="koboSpan" id="kobo.1411.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1412.1">model_name</span></code><span class="koboSpan" id="kobo.1413.1"> parameters. </span><span class="koboSpan" id="kobo.1413.2">The first one allows you to link the new content object to the given module. </span><span class="koboSpan" id="kobo.1413.3">The latter specifies the content model for which to build the form.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1414.1">module_content_update</span></code><span class="koboSpan" id="kobo.1415.1">: To update an existing text, video, image, or file object. </span><span class="koboSpan" id="kobo.1415.2">It includes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1416.1">module_id</span></code><span class="koboSpan" id="kobo.1417.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1418.1">model_name</span></code><span class="koboSpan" id="kobo.1419.1"> parameters and an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1420.1">id</span></code><span class="koboSpan" id="kobo.1421.1"> parameter to identify the content that is being updated.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1422.1">Create a new directory inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1423.1">courses/manage/</span></code><span class="koboSpan" id="kobo.1424.1"> template directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1425.1">content</span></code><span class="koboSpan" id="kobo.1426.1">. </span><span class="koboSpan" id="kobo.1426.2">Create</span><a id="_idIndexMarker1215"/><span class="koboSpan" id="kobo.1427.1"> the template </span><code class="inlineCode"><span class="koboSpan" id="kobo.1428.1">courses/manage/content/form.html</span></code><span class="koboSpan" id="kobo.1429.1"> and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1430.1">{% extends "base.html" %}
{% block title %}
  {% if object %}
    Edit content "{{ object.title }}"
  {% else %}
    Add new content
  {% endif %}
{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1431.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1432.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1433.1">&gt;</span></span><span class="koboSpan" id="kobo.1434.1">
    {% if object %}
      Edit content "{{ object.title }}"
    {% else %}
      Add new content
    {% endif %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1435.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1436.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1437.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1438.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1439.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1440.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1441.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1442.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1443.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1444.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1445.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1446.1">&gt;</span></span><span class="koboSpan" id="kobo.1447.1">Course info</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1448.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1449.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1450.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1451.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1452.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1453.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1454.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1455.1">""</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1456.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1457.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1458.1">"post"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1459.1">enctype</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1460.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1461.1">"multipart/form-data"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1462.1">&gt;</span></span><span class="koboSpan" id="kobo.1463.1">
      {{ form.as_p }}
      {% csrf_token %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1464.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1465.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1466.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1467.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1468.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1469.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1470.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1471.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1472.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1473.1">"Save content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1474.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1475.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1476.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1477.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1478.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1479.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1480.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1481.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1482.1">&gt;</span></span><span class="koboSpan" id="kobo.1483.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1484.1">This is the template for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1485.1">ContentCreateUpdateView</span></code><span class="koboSpan" id="kobo.1486.1"> view. </span><span class="koboSpan" id="kobo.1486.2">In this template, you check whether an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1487.1">object</span></code><span class="koboSpan" id="kobo.1488.1"> variable is in the context. </span><span class="koboSpan" id="kobo.1488.2">If </span><code class="inlineCode"><span class="koboSpan" id="kobo.1489.1">object</span></code><span class="koboSpan" id="kobo.1490.1"> exists in the context, you are updating an existing object. </span><span class="koboSpan" id="kobo.1490.2">Otherwise, you are creating a new object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1491.1">You include </span><code class="inlineCode"><span class="koboSpan" id="kobo.1492.1">enctype="multipart/form-data"</span></code><span class="koboSpan" id="kobo.1493.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1494.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.1495.1"> HTML element because the form contains a file upload for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1496.1">File</span></code><span class="koboSpan" id="kobo.1497.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1498.1">Image</span></code><span class="koboSpan" id="kobo.1499.1"> content models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1500.1">Run the </span><a id="_idIndexMarker1216"/><span class="koboSpan" id="kobo.1501.1">development server, open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1502.1">http://127.0.0.1:8000/course/mine/</span></code><span class="koboSpan" id="kobo.1503.1">, click </span><strong class="screenText"><span class="koboSpan" id="kobo.1504.1">Edit modules</span></strong><span class="koboSpan" id="kobo.1505.1"> for an existing course, and create a module.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1506.1">Then, open the Python shell with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1507.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1508.1">Obtain the ID of the most recently created module, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1509.1">&gt;&gt;&gt;</span></span><span class="language-bash"> </span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1510.1">from</span></span><span class="language-bash"><span class="koboSpan" id="kobo.1511.1"> courses.models </span></span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1512.1">import</span></span><span class="language-bash"><span class="koboSpan" id="kobo.1513.1"> Module</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1514.1">&gt;&gt;&gt;</span></span><span class="language-bash"><span class="koboSpan" id="kobo.1515.1"> Module.objects.latest(</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1516.1">'id'</span></span><span class="language-bash"><span class="koboSpan" id="kobo.1517.1">).</span></span><span class="hljs-con-built_in"><span class="koboSpan" id="kobo.1518.1">id</span></span><span class="koboSpan" id="kobo.1519.1">
6
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1520.1">Run the development server and open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1521.1">http://127.0.0.1:8000/course/module/6/content/image/create/</span></code><span class="koboSpan" id="kobo.1522.1"> in your browser, replacing the module ID with the one you obtained before. </span><span class="koboSpan" id="kobo.1522.2">You will see the form to create an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1523.1">Image</span></code><span class="koboSpan" id="kobo.1524.1"> object, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1525.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_13_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1526.1">Figure 13.9: The course Add new content form</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1527.1">Don’t submit the</span><a id="_idIndexMarker1217"/><span class="koboSpan" id="kobo.1528.1"> form yet. </span><span class="koboSpan" id="kobo.1528.2">If you try to do so, it will fail because you haven’t defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1529.1">module_content_list</span></code><span class="koboSpan" id="kobo.1530.1"> URL yet. </span><span class="koboSpan" id="kobo.1530.2">You are going to create it in a bit.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1531.1">You also need a view for deleting content. </span><span class="koboSpan" id="kobo.1531.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1532.1">views.py</span></code><span class="koboSpan" id="kobo.1533.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1534.1">courses</span></code><span class="koboSpan" id="kobo.1535.1"> application and add the following code:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1536.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1537.1">ContentDeleteView</span></span><span class="koboSpan" id="kobo.1538.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1539.1">View</span></span><span class="koboSpan" id="kobo.1540.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1541.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1542.1">post</span></span><span class="koboSpan" id="kobo.1543.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1544.1">self, request, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1545.1">id</span></span><span class="koboSpan" id="kobo.1546.1">):
        content = get_object_or_404(
            Content, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1547.1">id</span></span><span class="koboSpan" id="kobo.1548.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1549.1">id</span></span><span class="koboSpan" id="kobo.1550.1">, module__course__owner=request.user
        )
        module = content.module
        content.item.delete()
        content.delete()
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1551.1">return</span></span><span class="koboSpan" id="kobo.1552.1"> redirect(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1553.1">'module_content_list'</span></span><span class="koboSpan" id="kobo.1554.1">, module.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1555.1">id</span></span><span class="koboSpan" id="kobo.1556.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1557.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1558.1">ContentDeleteView</span></code><span class="koboSpan" id="kobo.1559.1"> class retrieves the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1560.1">content</span></code><span class="koboSpan" id="kobo.1561.1"> object with the given ID. </span><span class="koboSpan" id="kobo.1561.2">It deletes the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.1562.1">Text</span></code><span class="koboSpan" id="kobo.1563.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1564.1">Video</span></code><span class="koboSpan" id="kobo.1565.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1566.1">Image</span></code><span class="koboSpan" id="kobo.1567.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1568.1">File</span></code><span class="koboSpan" id="kobo.1569.1"> object. </span><span class="koboSpan" id="kobo.1569.2">Finally, it deletes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1570.1">content</span></code><span class="koboSpan" id="kobo.1571.1"> object and redirects the user to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1572.1">module_content_list</span></code><span class="koboSpan" id="kobo.1573.1"> URL to list the other contents of the module.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1574.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1575.1">urls.py</span></code><span class="koboSpan" id="kobo.1576.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1577.1">courses</span></code><span class="koboSpan" id="kobo.1578.1"> application and add the following URL pattern to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1579.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1580.1">'content/&lt;int:id&gt;/delete/'</span></span><span class="koboSpan" id="kobo.1581.1">,
    views.ContentDeleteView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1582.1">'module_content_delete'</span></span><span class="koboSpan" id="kobo.1583.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1584.1">Now, instructors can create, update, and delete content easily. </span><span class="koboSpan" id="kobo.1584.2">The approach you have learned in this section is very useful for managing forms with diverse data in a generic manner. </span><span class="koboSpan" id="kobo.1584.3">This</span><a id="_idIndexMarker1218"/><span class="koboSpan" id="kobo.1585.1"> method can be applied in other situations where a flexible solution is needed to handle data inputs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1586.1">In the next section, we are going to create the views and templates to display course modules and contents.</span></p>
<h2 class="heading-2" id="_idParaDest-363"><span class="koboSpan" id="kobo.1587.1">Managing modules and their contents</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1588.1">You have built </span><a id="_idIndexMarker1219"/><span class="koboSpan" id="kobo.1589.1">views to create, edit, and delete course modules and their contents. </span><span class="koboSpan" id="kobo.1589.2">Next, you need a view to display all modules for a course and list the contents of a specific module.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1590.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1591.1">views.py</span></code><span class="koboSpan" id="kobo.1592.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1593.1">courses</span></code><span class="koboSpan" id="kobo.1594.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1595.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1596.1">ModuleContentListView</span></span><span class="koboSpan" id="kobo.1597.1">(TemplateResponseMixin, View):
    template_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1598.1">'courses/manage/module/content_list.html'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1599.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1600.1">get</span></span><span class="koboSpan" id="kobo.1601.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1602.1">self, request, module_id</span></span><span class="koboSpan" id="kobo.1603.1">):
        module = get_object_or_404(
            Module, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1604.1">id</span></span><span class="koboSpan" id="kobo.1605.1">=module_id, course__owner=request.user
        )
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1606.1">return</span></span><span class="koboSpan" id="kobo.1607.1"> self.render_to_response({</span><span class="hljs-string"><span class="koboSpan" id="kobo.1608.1">'module'</span></span><span class="koboSpan" id="kobo.1609.1">: module})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1610.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1611.1">ModuleContentListView</span></code><span class="koboSpan" id="kobo.1612.1"> view. </span><span class="koboSpan" id="kobo.1612.2">This view gets the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1613.1">Module</span></code><span class="koboSpan" id="kobo.1614.1"> object with the given ID that belongs to the current user and renders a template with the given module.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1615.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1616.1">urls.py</span></code><span class="koboSpan" id="kobo.1617.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1618.1">courses</span></code><span class="koboSpan" id="kobo.1619.1"> application and add the following URL pattern to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1620.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1621.1">'module/&lt;int:module_id&gt;/'</span></span><span class="koboSpan" id="kobo.1622.1">,
    views.ModuleContentListView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1623.1">'module_content_list'</span></span><span class="koboSpan" id="kobo.1624.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1625.1">Create a new template inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1626.1">templates/courses/manage/module/</span></code><span class="koboSpan" id="kobo.1627.1"> directory and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1628.1">content_list.html</span></code><span class="koboSpan" id="kobo.1629.1">. </span><span class="koboSpan" id="kobo.1629.2">Add</span><a id="_idIndexMarker1220"/><span class="koboSpan" id="kobo.1630.1"> the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1631.1">{% extends "base.html" %}
{% block title %}
  Module {{ module.order|add:1 }}: {{ module.title }}
{% endblock %}
{% block content %}
{% with course=module.course %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1632.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1633.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1634.1">&gt;</span></span><span class="koboSpan" id="kobo.1635.1">Course "{{ course.title }}"</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1636.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1637.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1638.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1639.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1640.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1641.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1642.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1643.1">"contents"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1644.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1645.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1646.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1647.1">&gt;</span></span><span class="koboSpan" id="kobo.1648.1">Modules</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1649.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1650.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1651.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1652.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1653.1">ul</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1654.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1655.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1656.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1657.1">modules"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1658.1">&gt;</span></span><span class="koboSpan" id="kobo.1659.1">
      {% for m in course.modules.all %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1660.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1661.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1662.1">data-id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1663.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1664.1">"{{ m.id }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1665.1"> {% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1666.1">if</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1667.1">m</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1668.1"> == </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1669.1">module</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1670.1"> %}</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1671.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1672.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1673.1">"selected"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1674.1">{% </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1675.1">endif</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1676.1"> %}&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1677.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1678.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1679.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1680.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1681.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1682.1">module_content_list</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1683.1">" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1684.1">m.id</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1685.1"> %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1686.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1687.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1688.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1689.1">&gt;</span></span><span class="koboSpan" id="kobo.1690.1">
              Module </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1691.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1692.1">span</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1693.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1694.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1695.1">"order"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1696.1">&gt;</span></span><span class="koboSpan" id="kobo.1697.1">{{ m.order|add:1 }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1698.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1699.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1700.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1701.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1702.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1703.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1704.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1705.1">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1706.1">&gt;</span></span><span class="koboSpan" id="kobo.1707.1">
            {{ m.title }}
          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1708.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1709.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1710.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1711.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1712.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1713.1">&gt;</span></span><span class="koboSpan" id="kobo.1714.1">
      {% empty %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1715.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1716.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1717.1">&gt;</span></span><span class="koboSpan" id="kobo.1718.1">No modules yet.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1719.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1720.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1721.1">&gt;</span></span><span class="koboSpan" id="kobo.1722.1">
      {% endfor %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1723.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1724.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1725.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1726.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1727.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1728.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1729.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1730.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1731.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1732.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1733.1">course_module_update</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1734.1">" course.id %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1735.1">&gt;</span></span><span class="koboSpan" id="kobo.1736.1">
    Edit modules</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1737.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1738.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1739.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1740.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1741.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1742.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1743.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1744.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1745.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1746.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1747.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1748.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1749.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1750.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1751.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1752.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1753.1">&gt;</span></span><span class="koboSpan" id="kobo.1754.1">Module {{ module.order|add:1 }}: {{ module.title }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1755.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1756.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1757.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1758.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1759.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1760.1">&gt;</span></span><span class="koboSpan" id="kobo.1761.1">Module contents:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1762.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1763.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1764.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1765.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1766.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1767.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1768.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1769.1">"module-contents"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1770.1">&gt;</span></span><span class="koboSpan" id="kobo.1771.1">
      {% for content in module.contents.all %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1772.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1773.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1774.1">data-id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1775.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1776.1">"{{ content.id }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1777.1">&gt;</span></span><span class="koboSpan" id="kobo.1778.1">
          {% with item=content.item %}
            </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1779.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1780.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1781.1">&gt;</span></span><span class="koboSpan" id="kobo.1782.1">{{ item }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1783.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1784.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1785.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1786.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1787.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1788.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1789.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1790.1">"#"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1791.1">&gt;</span></span><span class="koboSpan" id="kobo.1792.1">Edit</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1793.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1794.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1795.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1796.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1797.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1798.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1799.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1800.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1801.1">module_content_delete</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1802.1">" content.id %}"</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1803.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1804.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1805.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1806.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1807.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1808.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1809.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1810.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1811.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1812.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1813.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1814.1">"Delete"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1815.1">&gt;</span></span><span class="koboSpan" id="kobo.1816.1">
              {% csrf_token %}
            </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1817.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1818.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1819.1">&gt;</span></span><span class="koboSpan" id="kobo.1820.1">
          {% endwith %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1821.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1822.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1823.1">&gt;</span></span><span class="koboSpan" id="kobo.1824.1">
      {% empty %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1825.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1826.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1827.1">&gt;</span></span><span class="koboSpan" id="kobo.1828.1">This module has no contents yet.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1829.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1830.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1831.1">&gt;</span></span><span class="koboSpan" id="kobo.1832.1">
      {% endfor %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1833.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1834.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1835.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1836.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1837.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1838.1">&gt;</span></span><span class="koboSpan" id="kobo.1839.1">Add new content:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1840.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1841.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1842.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1843.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1844.1">ul</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1845.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1846.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1847.1">"content-types"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1848.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1849.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1850.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1851.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1852.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1853.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1854.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1855.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1856.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1857.1">module_content_create</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1858.1">" module.id "text" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1859.1">&gt;</span></span><span class="koboSpan" id="kobo.1860.1">
          Text
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1861.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1862.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1863.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1864.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1865.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1866.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1867.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1868.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1869.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1870.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1871.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1872.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1873.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1874.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1875.1">module_content_create</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1876.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1877.1"> module.id "image" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1878.1">&gt;</span></span><span class="koboSpan" id="kobo.1879.1">
          Image
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1880.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1881.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1882.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1883.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1884.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1885.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1886.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1887.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1888.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1889.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1890.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1891.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1892.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1893.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1894.1">module_content_create</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1895.1">" module.id "video" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1896.1">&gt;</span></span><span class="koboSpan" id="kobo.1897.1">
          Video
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1898.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1899.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1900.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1901.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1902.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1903.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1904.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1905.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1906.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1907.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1908.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1909.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1910.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1911.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1912.1">module_content_create</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1913.1">" module.id "file" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1914.1">&gt;</span></span><span class="koboSpan" id="kobo.1915.1">
          File
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1916.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1917.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1918.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1919.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1920.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1921.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1922.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1923.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1924.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1925.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1926.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1927.1">&gt;</span></span><span class="koboSpan" id="kobo.1928.1">
{% endwith %}
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1929.1">Make sure that no template tag is split over multiple lines; the Django template engine expects the tags to be clearly defined and uninterrupted.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1930.1">This is the template that displays all modules for a course and the contents of the selected module. </span><span class="koboSpan" id="kobo.1930.2">You iterate over the course modules to display them in a sidebar. </span><span class="koboSpan" id="kobo.1930.3">You iterate over a module’s contents and access </span><code class="inlineCode"><span class="koboSpan" id="kobo.1931.1">content.item</span></code><span class="koboSpan" id="kobo.1932.1"> to get the related </span><code class="inlineCode"><span class="koboSpan" id="kobo.1933.1">Text</span></code><span class="koboSpan" id="kobo.1934.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1935.1">Video</span></code><span class="koboSpan" id="kobo.1936.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1937.1">Image</span></code><span class="koboSpan" id="kobo.1938.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1939.1">File</span></code><span class="koboSpan" id="kobo.1940.1"> object. </span><span class="koboSpan" id="kobo.1940.2">You also include links to create new text, video, image, or file content.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1941.1">You want to know which type of object each of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1942.1">item</span></code><span class="koboSpan" id="kobo.1943.1"> objects is: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1944.1">Text</span></code><span class="koboSpan" id="kobo.1945.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1946.1">Video</span></code><span class="koboSpan" id="kobo.1947.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1948.1">Image</span></code><span class="koboSpan" id="kobo.1949.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1950.1">File</span></code><span class="koboSpan" id="kobo.1951.1">. </span><span class="koboSpan" id="kobo.1951.2">You need the model name to build the URL to edit the object. </span><span class="koboSpan" id="kobo.1951.3">Besides this, you could display each item in the template differently based on the type of content it is. </span><span class="koboSpan" id="kobo.1951.4">You can get the model name for an object from the model’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1952.1">Meta</span></code><span class="koboSpan" id="kobo.1953.1"> class by accessing the object’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1954.1">_meta</span></code><span class="koboSpan" id="kobo.1955.1"> attribute. </span><span class="koboSpan" id="kobo.1955.2">However, Django doesn’t allow you to access variables or attributes starting with an</span><a id="_idIndexMarker1221"/><span class="koboSpan" id="kobo.1956.1"> underscore in templates to prevent retrieving private attributes or calling private methods. </span><span class="koboSpan" id="kobo.1956.2">You can solve this by writing a custom template filter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1957.1">Create the following file structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1958.1">courses</span></code><span class="koboSpan" id="kobo.1959.1"> application directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1960.1">templatetags/
    __init__.py
    course.py
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1961.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1962.1">course.py</span></code><span class="koboSpan" id="kobo.1963.1"> module and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1964.1">from</span></span><span class="koboSpan" id="kobo.1965.1"> django </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1966.1">import</span></span><span class="koboSpan" id="kobo.1967.1"> template
register = template.Library()
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1968.1">@register.filter</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1969.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1970.1">model_name</span></span><span class="koboSpan" id="kobo.1971.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1972.1">obj</span></span><span class="koboSpan" id="kobo.1973.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1974.1">try</span></span><span class="koboSpan" id="kobo.1975.1">:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1976.1">return</span></span><span class="koboSpan" id="kobo.1977.1"> obj._meta.model_name
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1978.1">except</span></span><span class="koboSpan" id="kobo.1979.1"> AttributeError:
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1980.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1981.1">None</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1982.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1983.1">model_name</span></code><span class="koboSpan" id="kobo.1984.1"> template filter. </span><span class="koboSpan" id="kobo.1984.2">You can apply it in templates as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1985.1">object|model_name</span></code><span class="koboSpan" id="kobo.1986.1"> to get the model name for an object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1987.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1988.1">templates/courses/manage/module/content_list.html</span></code><span class="koboSpan" id="kobo.1989.1"> template and add the following line below the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1990.1">{% extends %}</span></code><span class="koboSpan" id="kobo.1991.1"> template tag:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1992.1">{% load course %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1993.1">This will load the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1994.1">course</span></code><span class="koboSpan" id="kobo.1995.1"> template tags. </span><span class="koboSpan" id="kobo.1995.2">Then, find the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1996.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1997.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1998.1">&gt;</span></span><span class="koboSpan" id="kobo.1999.1">{{ item }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2000.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2001.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2002.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2003.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2004.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2005.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2006.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2007.1">"#"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2008.1">&gt;</span></span><span class="koboSpan" id="kobo.2009.1">Edit</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2010.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2011.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2012.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2013.1">Replace them with the following ones:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2014.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2015.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2016.1">&gt;</span></span><span class="koboSpan" id="kobo.2017.1">{{ item }}</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2018.1"> ({{ item|model_name }})</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2019.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2020.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2021.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2022.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2023.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2024.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2025.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2026.1">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2027.1">{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2028.1">module_content_update</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2029.1">" module.id item</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2030.1">|model_name item.id %}</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.2031.1">"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2032.1">&gt;</span></span><span class="koboSpan" id="kobo.2033.1">
  Edit
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2034.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2035.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2036.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2037.1">In the preceding </span><a id="_idIndexMarker1222"/><span class="koboSpan" id="kobo.2038.1">code, you display the item model name in the template and also use the model name to build the link to edit the object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2039.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2040.1">courses/manage/course/list.html</span></code><span class="koboSpan" id="kobo.2041.1"> template and add a link to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2042.1">module_content_list</span></code><span class="koboSpan" id="kobo.2043.1"> URL, like this:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2044.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2045.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2046.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2047.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2048.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.2049.1">course_module_update</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2050.1">" course.id %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2051.1">&gt;</span></span><span class="koboSpan" id="kobo.2052.1">Edit modules</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2053.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2054.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2055.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2056.1">{% if course.modules.count &gt; 0 %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2057.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2058.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2059.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2060.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2061.1">"{% url "</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2062.1">module_content_list</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2063.1">" </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2064.1">course.modules.first.id %}"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2065.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2066.1">    Manage contents</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2067.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2068.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2069.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2070.1">{% endif %}</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2071.1">The new link allows users to access the contents of the first module of the course if there are any.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2072.1">Stop the development server and run it again using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2073.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2074.1">By stopping and running the development server, you make sure that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2075.1">course</span></code><span class="koboSpan" id="kobo.2076.1"> template tags file gets loaded.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2077.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2078.1">http://127.0.0.1:8000/course/mine/</span></code><span class="koboSpan" id="kobo.2079.1"> and click the </span><strong class="screenText"><span class="koboSpan" id="kobo.2080.1">Manage contents</span></strong><span class="koboSpan" id="kobo.2081.1"> link for a course that contains at least one module. </span><span class="koboSpan" id="kobo.2081.2">You will see a page like the following one:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2082.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_13_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2083.1">Figure 13.10: The page to manage course module contents</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2084.1">When you click</span><a id="_idIndexMarker1223"/><span class="koboSpan" id="kobo.2085.1"> on a module in the left sidebar, its contents are displayed in the main area. </span><span class="koboSpan" id="kobo.2085.2">The template also includes links to add new text, video, image, or file content for the module being displayed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2086.1">Add a couple of different types of content to the module and look at the result. </span><span class="koboSpan" id="kobo.2086.2">Module contents will appear below </span><strong class="screenText"><span class="koboSpan" id="kobo.2087.1">Module contents</span></strong><span class="koboSpan" id="kobo.2088.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2089.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_13_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2090.1">Figure 13.11: Managing different module contents</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2091.1">Next, we will </span><a id="_idIndexMarker1224"/><span class="koboSpan" id="kobo.2092.1">allow course instructors to reorder modules and module contents with a simple drag-and-drop functionality.</span></p>
<h1 class="heading-1" id="_idParaDest-364"><span class="koboSpan" id="kobo.2093.1">Reordering modules and their contents</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2094.1">We will implement a</span><a id="_idIndexMarker1225"/><span class="koboSpan" id="kobo.2095.1"> JavaScript drag-and-drop functionality to let course instructors reorder the modules of a course by dragging them. </span><span class="koboSpan" id="kobo.2095.2">Drag-and-drop enhances the user interface, offering a natural way to reorder elements that is more intuitive than using numbers or clicking buttons. </span><span class="koboSpan" id="kobo.2095.3">It is also a time-saver for course instructors, who will be able to reorganize course modules and their contents easily.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2096.1">To implement this feature, we will use the HTML5 Sortable library, which simplifies the process of creating sortable lists using the native HTML5 Drag and Drop API.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2097.1">When users finish dragging a module, you will use the JavaScript Fetch API to send an asynchronous HTTP request to the server that stores the new module order.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2098.1">You can read more information about the HTML5 Drag and Drop API at </span><a href="https://www.w3schools.com/html/html5_draganddrop.asp"><span class="url"><span class="koboSpan" id="kobo.2099.1">https://www.w3schools.com/html/html5_draganddrop.asp</span></span></a><span class="koboSpan" id="kobo.2100.1">. </span><span class="koboSpan" id="kobo.2100.2">You can find examples built with </span><a id="_idIndexMarker1226"/><span class="koboSpan" id="kobo.2101.1">the HTML5 Sortable </span><a id="_idIndexMarker1227"/><span class="koboSpan" id="kobo.2102.1">library at </span><a href="https://lukasoppermann.github.io/html5sortable/"><span class="url"><span class="koboSpan" id="kobo.2103.1">https://lukasoppermann.github.io/html5sortable/</span></span></a><span class="koboSpan" id="kobo.2104.1">. </span><span class="koboSpan" id="kobo.2104.2">Documentation</span><a id="_idIndexMarker1228"/><span class="koboSpan" id="kobo.2105.1"> for the HTML5 Sortable library </span><a id="_idIndexMarker1229"/><span class="koboSpan" id="kobo.2106.1">is available at </span><a href="https://github.com/lukasoppermann/html5sortable"><span class="url"><span class="koboSpan" id="kobo.2107.1">https://github.com/lukasoppermann/html5sortable</span></span></a><span class="koboSpan" id="kobo.2108.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2109.1">Let’s implement the views to update the order of course modules and module contents.</span></p>
<h2 class="heading-2" id="_idParaDest-365"><span class="koboSpan" id="kobo.2110.1">Using mixins from django-braces</span></h2>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2111.1">django-braces</span></code><span class="koboSpan" id="kobo.2112.1"> is a </span><a id="_idIndexMarker1230"/><span class="koboSpan" id="kobo.2113.1">third-party module</span><a id="_idIndexMarker1231"/><span class="koboSpan" id="kobo.2114.1"> that </span><a id="_idIndexMarker1232"/><span class="koboSpan" id="kobo.2115.1">contains a collection of generic mixins for Django. </span><span class="koboSpan" id="kobo.2115.2">These mixins provide additional features for class-based views that are useful for various common scenarios. </span><span class="koboSpan" id="kobo.2115.3">You can see a list of all mixins provided by </span><code class="inlineCode"><span class="koboSpan" id="kobo.2116.1">django-braces</span></code><span class="koboSpan" id="kobo.2117.1"> at </span><a href="https://django-braces.readthedocs.io/"><span class="url"><span class="koboSpan" id="kobo.2118.1">https://django-braces.readthedocs.io/</span></span></a><span class="koboSpan" id="kobo.2119.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2120.1">You will use the following mixins of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2121.1">django-braces</span></code><span class="koboSpan" id="kobo.2122.1">:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2123.1">CsrfExemptMixin</span></code><span class="koboSpan" id="kobo.2124.1">: Used to avoid checking the </span><strong class="keyWord"><span class="koboSpan" id="kobo.2125.1">cross-site request forgery</span></strong><span class="koboSpan" id="kobo.2126.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2127.1">CSRF</span></strong><span class="koboSpan" id="kobo.2128.1">) token </span><a id="_idIndexMarker1233"/><span class="koboSpan" id="kobo.2129.1">in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2130.1">POST</span></code><span class="koboSpan" id="kobo.2131.1"> requests. </span><span class="koboSpan" id="kobo.2131.2">You need this to perform AJAX </span><code class="inlineCode"><span class="koboSpan" id="kobo.2132.1">POST</span></code><span class="koboSpan" id="kobo.2133.1"> requests without the need to pass a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2134.1">csrf_token</span></code><span class="koboSpan" id="kobo.2135.1">.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2136.1">JsonRequestResponseMixin</span></code><span class="koboSpan" id="kobo.2137.1">: Parses the request data as JSON and also serializes the response as JSON and returns an HTTP response with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2138.1">application/json</span></code><span class="koboSpan" id="kobo.2139.1"> content type.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2140.1">Install </span><code class="inlineCode"><span class="koboSpan" id="kobo.2141.1">django-braces</span></code><span class="koboSpan" id="kobo.2142.1"> via </span><code class="inlineCode"><span class="koboSpan" id="kobo.2143.1">pip</span></code><span class="koboSpan" id="kobo.2144.1"> using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2145.1">python -m pip install django-braces==1.15.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2146.1">You need a view that receives the new order of module IDs encoded in JSON and updates the order accordingly. </span><span class="koboSpan" id="kobo.2146.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2147.1">views.py</span></code><span class="koboSpan" id="kobo.2148.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2149.1">courses</span></code><span class="koboSpan" id="kobo.2150.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2151.1">from</span></span><span class="koboSpan" id="kobo.2152.1"> braces.views </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2153.1">import</span></span><span class="koboSpan" id="kobo.2154.1"> CsrfExemptMixin, JsonRequestResponseMixin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2155.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2156.1">ModuleOrderView</span></span><span class="koboSpan" id="kobo.2157.1">(CsrfExemptMixin, JsonRequestResponseMixin, View):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2158.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2159.1">post</span></span><span class="koboSpan" id="kobo.2160.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2161.1">self, request</span></span><span class="koboSpan" id="kobo.2162.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2163.1">for</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2164.1">id</span></span><span class="koboSpan" id="kobo.2165.1">, order </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2166.1">in</span></span><span class="koboSpan" id="kobo.2167.1"> self.request_json.items():
            Module.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2168.1">filter</span></span><span class="koboSpan" id="kobo.2169.1">(
                </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2170.1">id</span></span><span class="koboSpan" id="kobo.2171.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2172.1">id</span></span><span class="koboSpan" id="kobo.2173.1">, course__owner=request.user
            ).update(order=order)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2174.1">return</span></span><span class="koboSpan" id="kobo.2175.1"> self.render_json_response({</span><span class="hljs-string"><span class="koboSpan" id="kobo.2176.1">'saved'</span></span><span class="koboSpan" id="kobo.2177.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2178.1">'OK'</span></span><span class="koboSpan" id="kobo.2179.1">})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2180.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2181.1">ModuleOrderView</span></code><span class="koboSpan" id="kobo.2182.1"> view, which allows you to update the order of course modules.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2183.1">You can build a</span><a id="_idIndexMarker1234"/><span class="koboSpan" id="kobo.2184.1"> similar view to order</span><a id="_idIndexMarker1235"/><span class="koboSpan" id="kobo.2185.1"> a </span><a id="_idIndexMarker1236"/><span class="koboSpan" id="kobo.2186.1">module’s contents. </span><span class="koboSpan" id="kobo.2186.2">Add the following code to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2187.1">views.py</span></code><span class="koboSpan" id="kobo.2188.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2189.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2190.1">ContentOrderView</span></span><span class="koboSpan" id="kobo.2191.1">(CsrfExemptMixin, JsonRequestResponseMixin, View):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2192.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2193.1">post</span></span><span class="koboSpan" id="kobo.2194.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2195.1">self, request</span></span><span class="koboSpan" id="kobo.2196.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2197.1">for</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.2198.1">id</span></span><span class="koboSpan" id="kobo.2199.1">, order </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2200.1">in</span></span><span class="koboSpan" id="kobo.2201.1"> self.request_json.items():
            Content.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2202.1">filter</span></span><span class="koboSpan" id="kobo.2203.1">(
                </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2204.1">id</span></span><span class="koboSpan" id="kobo.2205.1">=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2206.1">id</span></span><span class="koboSpan" id="kobo.2207.1">, module__course__owner=request.user
            ).update(order=order)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2208.1">return</span></span><span class="koboSpan" id="kobo.2209.1"> self.render_json_response({</span><span class="hljs-string"><span class="koboSpan" id="kobo.2210.1">'saved'</span></span><span class="koboSpan" id="kobo.2211.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2212.1">'OK'</span></span><span class="koboSpan" id="kobo.2213.1">})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2214.1">Now, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2215.1">urls.py</span></code><span class="koboSpan" id="kobo.2216.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2217.1">courses</span></code><span class="koboSpan" id="kobo.2218.1"> application and add the following URL patterns to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2219.1">path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2220.1">'module/order/'</span></span><span class="koboSpan" id="kobo.2221.1">,
    views.ModuleOrderView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2222.1">'module_order'</span></span><span class="koboSpan" id="kobo.2223.1">
),
path(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2224.1">'content/order/'</span></span><span class="koboSpan" id="kobo.2225.1">,
    views.ContentOrderView.as_view(),
    name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.2226.1">'content_order'</span></span><span class="koboSpan" id="kobo.2227.1">
),
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2228.1">Finally, you need to implement the drag-and-drop functionality in the template. </span><span class="koboSpan" id="kobo.2228.2">We will use the HTML5 Sortable library, which simplifies the creation of sortable elements using the standard HTML Drag and Drop API. </span><span class="koboSpan" id="kobo.2228.3">There are other JavaScript libraries that will allow you to achieve the same, but we chose HTML5 Sortable because it is lightweight and leverages the native HTML5 Drag and Drop API.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2229.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2230.1">base.html</span></code><span class="koboSpan" id="kobo.2231.1"> template located in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2232.1">templates/</span></code><span class="koboSpan" id="kobo.2233.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2234.1">courses</span></code><span class="koboSpan" id="kobo.2235.1"> application and </span><a id="_idIndexMarker1237"/><span class="koboSpan" id="kobo.2236.1">add the following</span><a id="_idIndexMarker1238"/><span class="koboSpan" id="kobo.2237.1"> block </span><a id="_idIndexMarker1239"/><span class="koboSpan" id="kobo.2238.1">highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2239.1">{% load static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2240.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2241.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.2242.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2243.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2244.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2245.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2246.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2247.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2248.1">&gt;</span></span><span class="koboSpan" id="kobo.2249.1">
    # ...
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2250.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2251.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2252.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2253.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2254.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2255.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2256.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2257.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2258.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2259.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2260.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2261.1">&gt;</span></span><span class="koboSpan" id="kobo.2262.1">
      # ...
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2263.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2264.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2265.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2266.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2267.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2268.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2269.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2270.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2271.1">&gt;</span></span><span class="koboSpan" id="kobo.2272.1">
      {% block content %}
      {% endblock %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2273.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2274.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2275.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2276.1">    {% block include_js %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2277.1">    {% endblock %}</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2278.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2279.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2280.1">&gt;</span></span>
<span class="language-javascript"> </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2281.1">document</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.2282.1">.</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2283.1">addEventListener</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.2284.1">(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2285.1">'DOMContentLoaded'</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.2286.1">, </span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2287.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2288.1">event</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2289.1">) =&gt;</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.2290.1"> {</span></span>
<span class="language-javascript"> </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2291.1">// DOM loaded</span></span>
<span class="language-javascript"><span class="koboSpan" id="kobo.2292.1">        {% block domready %}</span></span>
<span class="language-javascript"><span class="koboSpan" id="kobo.2293.1">        {% endblock %}</span></span>
<span class="language-javascript"><span class="koboSpan" id="kobo.2294.1">      })</span></span>
<span class="language-javascript"> </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2295.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2296.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2297.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2298.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2299.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2300.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2301.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2302.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2303.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2304.1">This new block named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2305.1">include_js</span></code><span class="koboSpan" id="kobo.2306.1"> will allow you to insert JavaScript files into any template that extends the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2307.1">base.html</span></code><span class="koboSpan" id="kobo.2308.1"> template.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2309.1">Next, edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2310.1">courses/manage/module/content_list.html</span></code><span class="koboSpan" id="kobo.2311.1"> template and add the following code highlighted in bold to the bottom of the template:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2312.1"># ...
</span><span class="koboSpan" id="kobo.2312.2">{% block content %}
  # ...
</span><span class="koboSpan" id="kobo.2312.3">{% endblock %}
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2313.1">{% block include_js %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2314.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2315.1">script</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2316.1">src</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2317.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2318.1">"https://cdnjs.cloudflare.com/ajax/libs/html5sortable/0.13.3/html5sortable.min.js"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2319.1">&gt;&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2320.1">script</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2321.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2322.1">{% endblock %}</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2323.1">In this code, you load the HTML5 Sortable library from a public </span><strong class="keyWord"><span class="koboSpan" id="kobo.2324.1">content delivery network</span></strong><span class="koboSpan" id="kobo.2325.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2326.1">CDN</span></strong><span class="koboSpan" id="kobo.2327.1">). </span><span class="koboSpan" id="kobo.2327.2">Remember</span><a id="_idIndexMarker1240"/><span class="koboSpan" id="kobo.2328.1"> you loaded a</span><a id="_idIndexMarker1241"/><span class="koboSpan" id="kobo.2329.1"> JavaScript</span><a id="_idIndexMarker1242"/><span class="koboSpan" id="kobo.2330.1"> library from a CDN before in </span><em class="italic"><span class="koboSpan" id="kobo.2331.1">Chapter 6,</span></em> <em class="italic"><span class="koboSpan" id="kobo.2332.1">Sharing Content on Your Website</span></em><span class="koboSpan" id="kobo.2333.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2334.1">Now add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.2335.1">domready</span></code><span class="koboSpan" id="kobo.2336.1"> block highlighted in bold to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2337.1">courses/manage/module/content_list.html</span></code><span class="koboSpan" id="kobo.2338.1"> template:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2339.1"># ...
</span><span class="koboSpan" id="kobo.2339.2">{% block content %}
  # ...
</span><span class="koboSpan" id="kobo.2339.3">{% endblock %}
{% block include_js %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2340.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2341.1">script</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2342.1">src</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2343.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2344.1">"https://cdnjs.cloudflare.com/ajax/libs/html5sortable/0.13.3/html5sortable.min.js"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2345.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2346.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2347.1">&gt;</span></span><span class="koboSpan" id="kobo.2348.1">
{% endblock %}
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2349.1">{% block domready %}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2350.1">  var options = {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2351.1">      method: 'POST',</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2352.1">      mode: 'same-origin'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2353.1">  }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2354.1">  const moduleOrderUrl = '{% url "module_order" %}';</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2355.1">{% endblock %}</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2356.1">In these new lines, you add JavaScript code to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2357.1">{% block domready %}</span></code><span class="koboSpan" id="kobo.2358.1"> block that was defined in the event listener for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2359.1">DOMContentLoaded</span></code><span class="koboSpan" id="kobo.2360.1"> event in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2361.1">base.html</span></code><span class="koboSpan" id="kobo.2362.1"> template. </span><span class="koboSpan" id="kobo.2362.2">This guarantees that your JavaScript code will be executed once the page has been loaded. </span><span class="koboSpan" id="kobo.2362.3">With this code, you define the options for the HTTP request to reorder modules that you will implement next. </span><span class="koboSpan" id="kobo.2362.4">You will send a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2363.1">POST</span></code><span class="koboSpan" id="kobo.2364.1"> request using the Fetch API to update the module order. </span><span class="koboSpan" id="kobo.2364.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2365.1">module_order</span></code><span class="koboSpan" id="kobo.2366.1"> URL path is built and stored in the JavaScript constant </span><code class="inlineCode"><span class="koboSpan" id="kobo.2367.1">moduleOrderUrl</span></code><span class="koboSpan" id="kobo.2368.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2369.1">Add the following code highlighted in bold to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2370.1">domready</span></code><span class="koboSpan" id="kobo.2371.1"> block:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2372.1">{% block domready %}
  var options = {
      method: 'POST',
      mode: 'same-origin'
  }
  const moduleOrderUrl = '{% url "module_order" %}';
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2373.1">  sortable('#modules', {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2374.1">    forcePlaceholderSize: true,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2375.1">    placeholderClass: 'placeholder'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2376.1">  });</span></strong></span><span class="koboSpan" id="kobo.2377.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2378.1">In the new code, you define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2379.1">sortable</span></code><span class="koboSpan" id="kobo.2380.1"> element for the HTML element with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2381.1">id="modules"</span></code><span class="koboSpan" id="kobo.2382.1">, which</span><a id="_idIndexMarker1243"/><span class="koboSpan" id="kobo.2383.1"> is the module list in</span><a id="_idIndexMarker1244"/><span class="koboSpan" id="kobo.2384.1"> the </span><a id="_idIndexMarker1245"/><span class="koboSpan" id="kobo.2385.1">sidebar. </span><span class="koboSpan" id="kobo.2385.2">Remember that you use a CSS selector </span><code class="inlineCode"><span class="koboSpan" id="kobo.2386.1">#</span></code><span class="koboSpan" id="kobo.2387.1"> to select the element with the given </span><code class="inlineCode"><span class="koboSpan" id="kobo.2388.1">id</span></code><span class="koboSpan" id="kobo.2389.1">. </span><span class="koboSpan" id="kobo.2389.2">When you start dragging an item, the HTML5 Sortable library creates a placeholder item so that you can easily see where the element will be placed.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2390.1">You set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2391.1">forcePlacehoderSize</span></code><span class="koboSpan" id="kobo.2392.1"> option to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2393.1">true</span></code><span class="koboSpan" id="kobo.2394.1">, to force the placeholder element to have a height, and you use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2395.1">placeholderClass</span></code><span class="koboSpan" id="kobo.2396.1"> to define the CSS class for the placeholder element. </span><span class="koboSpan" id="kobo.2396.2">You use the class named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2397.1">placeholder</span></code><span class="koboSpan" id="kobo.2398.1"> that is defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2399.1">css/base.css</span></code><span class="koboSpan" id="kobo.2400.1"> static file loaded in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2401.1">base.html</span></code><span class="koboSpan" id="kobo.2402.1"> template.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2403.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.2404.1">http://127.0.0.1:8000/course/mine/</span></code><span class="koboSpan" id="kobo.2405.1"> in your browser and click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2406.1">Manage contents</span></strong><span class="koboSpan" id="kobo.2407.1"> for any course. </span><span class="koboSpan" id="kobo.2407.2">Now, you can drag and drop the course modules in the left sidebar, as in </span><em class="italic"><span class="koboSpan" id="kobo.2408.1">Figure 13.12</span></em><span class="koboSpan" id="kobo.2409.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2410.1"><img alt="Graphical user interface, text, application  Description automatically generated" src="../Images/B21088_13_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2411.1">Figure 13.12: Reordering modules with the drag-and-drop functionality</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2412.1">While you drag </span><a id="_idIndexMarker1246"/><span class="koboSpan" id="kobo.2413.1">the element, you will</span><a id="_idIndexMarker1247"/><span class="koboSpan" id="kobo.2414.1"> see </span><a id="_idIndexMarker1248"/><span class="koboSpan" id="kobo.2415.1">the placeholder item created by the Sortable library, which has a dashed-line border. </span><span class="koboSpan" id="kobo.2415.2">The placeholder element allows you to identify the position in which the dragged element will be dropped.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2416.1">When you drag a module to a different position, you need to send an HTTP request to the server to store the new order. </span><span class="koboSpan" id="kobo.2416.2">This can be done by attaching an event handler to the sortable element and sending a request to the server using the JavaScript Fetch API.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2417.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2418.1">domready</span></code><span class="koboSpan" id="kobo.2419.1"> block of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2420.1">courses/manage/module/content_list.html</span></code><span class="koboSpan" id="kobo.2421.1"> template and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2422.1">{% block domready %}
  var options = {
      method: 'POST',
      mode: 'same-origin'
  }
  const moduleOrderUrl = '{% url "module_order" %}';
  sortable('#modules', {
    forcePlaceholderSize: true,
    placeholderClass: 'placeholder'
  })</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2423.1">[0].addEventListener('sortupdate', function(e) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2424.1">    modulesOrder = {};</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2425.1">    var modules = document.querySelectorAll('#modules li');</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2426.1">    modules.forEach(function (module, index) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2427.1">      // update module index</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2428.1">      modulesOrder[module.dataset.id] = index;</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2429.1">      // update index in HTML element</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2430.1">      module.querySelector('.order').innerHTML = index + 1;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2431.1">    });</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2432.1">    // add new order to the HTTP request options</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2433.1">    options['body'] = JSON.stringify(modulesOrder);</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2434.1">    // send HTTP request</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2435.1">    fetch(moduleOrderUrl, options)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2436.1">  });</span></strong></span><span class="koboSpan" id="kobo.2437.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2438.1">In the new code, an</span><a id="_idIndexMarker1249"/><span class="koboSpan" id="kobo.2439.1"> event listener</span><a id="_idIndexMarker1250"/><span class="koboSpan" id="kobo.2440.1"> is </span><a id="_idIndexMarker1251"/><span class="koboSpan" id="kobo.2441.1">created for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2442.1">sortupdate</span></code><span class="koboSpan" id="kobo.2443.1"> event of the sortable element. </span><span class="koboSpan" id="kobo.2443.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2444.1">sortupdate</span></code><span class="koboSpan" id="kobo.2445.1"> event is triggered when an element is dropped in a different position. </span><span class="koboSpan" id="kobo.2445.2">The following tasks are performed in the event function:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2446.1">An empty </span><code class="inlineCode"><span class="koboSpan" id="kobo.2447.1">modulesOrder</span></code><span class="koboSpan" id="kobo.2448.1"> dictionary is created. </span><span class="koboSpan" id="kobo.2448.2">The keys for this dictionary will be the module IDs, and the values will contain the index of each module.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2449.1">The list elements of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2450.1">#modules</span></code><span class="koboSpan" id="kobo.2451.1"> HTML element are selected with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2452.1">document.querySelectorAll()</span></code><span class="koboSpan" id="kobo.2453.1">, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2454.1">#modules li</span></code><span class="koboSpan" id="kobo.2455.1"> CSS selector.</span></li>
<li class="numberedList"><code class="inlineCode"><span class="koboSpan" id="kobo.2456.1">forEach()</span></code><span class="koboSpan" id="kobo.2457.1"> is used to iterate over each list element.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2458.1">The new index for each module is stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2459.1">modulesOrder</span></code><span class="koboSpan" id="kobo.2460.1"> dictionary. </span><span class="koboSpan" id="kobo.2460.2">The ID of each module is retrieved from the HTML </span><code class="inlineCode"><span class="koboSpan" id="kobo.2461.1">data-id</span></code><span class="koboSpan" id="kobo.2462.1"> attribute by accessing </span><code class="inlineCode"><span class="koboSpan" id="kobo.2463.1">module.dataset.id</span></code><span class="koboSpan" id="kobo.2464.1">. </span><span class="koboSpan" id="kobo.2464.2">You use the ID as the key of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2465.1">modulesOrder</span></code><span class="koboSpan" id="kobo.2466.1"> dictionary and the new index of the module as the value.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2467.1">The order displayed for each module is updated by selecting the element with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2468.1">order</span></code><span class="koboSpan" id="kobo.2469.1"> CSS class. </span><span class="koboSpan" id="kobo.2469.2">Since the index is zero-based and we want to display a one-based index, we add </span><code class="inlineCode"><span class="koboSpan" id="kobo.2470.1">1</span></code><span class="koboSpan" id="kobo.2471.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2472.1">index</span></code><span class="koboSpan" id="kobo.2473.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2474.1">A key named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2475.1">body</span></code><span class="koboSpan" id="kobo.2476.1"> is added to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2477.1">options</span></code><span class="koboSpan" id="kobo.2478.1"> dictionary with the new order contained in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2479.1">modulesOrder</span></code><span class="koboSpan" id="kobo.2480.1">. </span><span class="koboSpan" id="kobo.2480.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2481.1">JSON.stringify()</span></code><span class="koboSpan" id="kobo.2482.1"> method converts the JavaScript object into a JSON string. </span><span class="koboSpan" id="kobo.2482.2">This is the body for the HTTP request to update the module order.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2483.1">The Fetch API is used by creating a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2484.1">fetch()</span></code><span class="koboSpan" id="kobo.2485.1"> HTTP request to update the module order. </span><span class="koboSpan" id="kobo.2485.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2486.1">ModuleOrderView</span></code><span class="koboSpan" id="kobo.2487.1"> view that corresponds to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2488.1">module_order</span></code><span class="koboSpan" id="kobo.2489.1"> URL takes care of updating the order of the modules.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2490.1">You can now drag and drop modules. </span><span class="koboSpan" id="kobo.2490.2">When you finish dragging a module, an HTTP request is sent to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2491.1">module_order</span></code><span class="koboSpan" id="kobo.2492.1"> URL to update the order of the modules. </span><span class="koboSpan" id="kobo.2492.2">If you refresh</span><a id="_idIndexMarker1252"/><span class="koboSpan" id="kobo.2493.1"> the</span><a id="_idIndexMarker1253"/><span class="koboSpan" id="kobo.2494.1"> page, the</span><a id="_idIndexMarker1254"/><span class="koboSpan" id="kobo.2495.1"> latest module order will be kept because it was updated in the database. </span><em class="italic"><span class="koboSpan" id="kobo.2496.1">Figure 13.13</span></em><span class="koboSpan" id="kobo.2497.1"> shows a different order for the modules in the sidebar after sorting them using drag and drop:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2498.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_13_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2499.1">Figure 13.13: New order for modules after reordering them with drag and drop</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2500.1">If you run into any issues, remember to use your browser’s developer tools to debug JavaScript and </span><a id="_idIndexMarker1255"/><span class="koboSpan" id="kobo.2501.1">HTTP requests. </span><span class="koboSpan" id="kobo.2501.2">Usually, you</span><a id="_idIndexMarker1256"/><span class="koboSpan" id="kobo.2502.1"> can right-click anywhere on the website</span><a id="_idIndexMarker1257"/><span class="koboSpan" id="kobo.2503.1"> to open the contextual menu and click on </span><strong class="screenText"><span class="koboSpan" id="kobo.2504.1">Inspect</span></strong><span class="koboSpan" id="kobo.2505.1"> or </span><strong class="screenText"><span class="koboSpan" id="kobo.2506.1">Inspect Element</span></strong><span class="koboSpan" id="kobo.2507.1"> to access the web developer tools of your browser.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2508.1">Let’s add the same drag-and-drop functionality to allow course instructors to sort module contents as well.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2509.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2510.1">domready</span></code><span class="koboSpan" id="kobo.2511.1"> block of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2512.1">courses/manage/module/content_list.html</span></code><span class="koboSpan" id="kobo.2513.1"> template and add the following code highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2514.1">{% block domready %}
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.2515.1">  // ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2516.1">  const contentOrderUrl = '{% url "content_order" %}';</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2517.1">  sortable('#module-contents', {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2518.1">    forcePlaceholderSize: true,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2519.1">    placeholderClass: 'placeholder'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2520.1">  })[0].addEventListener('sortupdate', function(e) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2521.1">    contentOrder = {};</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2522.1">    var contents = document.querySelectorAll('#module-contents div');</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2523.1">    contents.forEach(function (content, index) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2524.1">      // update content index</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2525.1">      contentOrder[content.dataset.id] = index;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2526.1">    });</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2527.1">    // add new order to the HTTP request options</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2528.1">    options['body'] = JSON.stringify(contentOrder);</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2529.1">    // send HTTP request</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2530.1">    fetch(contentOrderUrl, options)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2531.1">  });</span></strong></span><span class="koboSpan" id="kobo.2532.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2533.1">In this case, you</span><a id="_idIndexMarker1258"/><span class="koboSpan" id="kobo.2534.1"> use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2535.1">content_order</span></code><span class="koboSpan" id="kobo.2536.1"> URL</span><a id="_idIndexMarker1259"/><span class="koboSpan" id="kobo.2537.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2538.1">module_order</span></code><span class="koboSpan" id="kobo.2539.1"> and build the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2540.1">sortable</span></code><span class="koboSpan" id="kobo.2541.1"> functionality</span><a id="_idIndexMarker1260"/><span class="koboSpan" id="kobo.2542.1"> on the HTML element with the ID </span><code class="inlineCode"><span class="koboSpan" id="kobo.2543.1">module-contents</span></code><span class="koboSpan" id="kobo.2544.1">. </span><span class="koboSpan" id="kobo.2544.2">The functionality is mainly the same as for ordering course modules. </span><span class="koboSpan" id="kobo.2544.3">In this case, you don’t need to update the numbering of the contents because they don’t include any visible index.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2545.1">Now, you can drag and drop both modules and module contents, as in </span><em class="italic"><span class="koboSpan" id="kobo.2546.1">Figure 13.14</span></em><span class="koboSpan" id="kobo.2547.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2548.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_13_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2549.1">Figure 13.14: Reordering module contents with the drag-and-drop functionality</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2550.1">Great! </span><span class="koboSpan" id="kobo.2550.2">You built a</span><a id="_idIndexMarker1261"/><span class="koboSpan" id="kobo.2551.1"> very versatile CMS for the course instructors.</span></p>
<h1 class="heading-1" id="_idParaDest-366"><span class="koboSpan" id="kobo.2552.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2553.1">In this chapter, you learned how to use class-based views and mixins to create a CMS. </span><span class="koboSpan" id="kobo.2553.2">You acquired knowledge about reusability and modularity that you can apply to your future applications. </span><span class="koboSpan" id="kobo.2553.3">You also worked with groups and permissions to restrict access to your views, gaining insights into security and how to control actions on data. </span><span class="koboSpan" id="kobo.2553.4">You learned how to use formsets and model formsets to manage course modules and their content in a flexible manner. </span><span class="koboSpan" id="kobo.2553.5">You also built a drag-and-drop functionality with JavaScript to reorder course modules and their contents with an improved user interface.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2554.1">In the next chapter, you will create a student registration system and manage student enrollment in courses. </span><span class="koboSpan" id="kobo.2554.2">You will also learn how to render different types of content and improve the performance of your application by caching content using Django’s cache framework.</span></p>
<h1 class="heading-1" id="_idParaDest-367"><span class="koboSpan" id="kobo.2555.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2556.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2557.1">Source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter13"><span class="url"><span class="koboSpan" id="kobo.2558.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter13</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2559.1">Django mixins documentation: </span><a href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/mixins/"><span class="url"><span class="koboSpan" id="kobo.2560.1">https://docs.djangoproject.com/en/5.0/topics/class-based-views/mixins/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2561.1">Neapolitan package to create CRUD views: </span><a href="https://github.com/carltongibson/neapolitan"><span class="url"><span class="koboSpan" id="kobo.2562.1">https://github.com/carltongibson/neapolitan</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2563.1">Creating custom permissions: </span><a href="https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#custom-permissions"><span class="url"><span class="koboSpan" id="kobo.2564.1">https://docs.djangoproject.com/en/5.0/topics/auth/customizing/#custom-permissions</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2565.1">Django formsets: </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/formsets/"><span class="url"><span class="koboSpan" id="kobo.2566.1">https://docs.djangoproject.com/en/5.0/topics/forms/formsets/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2567.1">Django model formsets: </span><a href="https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/#model-formsets"><span class="url"><span class="koboSpan" id="kobo.2568.1">https://docs.djangoproject.com/en/5.0/topics/forms/modelforms/#model-formsets</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2569.1">HTML5 Drag and Drop API: </span><a href="https://www.w3schools.com/html/html5_draganddrop.asp"><span class="url"><span class="koboSpan" id="kobo.2570.1">https://www.w3schools.com/html/html5_draganddrop.asp</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2571.1">HTML5 Sortable library documentation: </span><a href="https://github.com/lukasoppermann/html5sortable"><span class="url"><span class="koboSpan" id="kobo.2572.1">https://github.com/lukasoppermann/html5sortable</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2573.1">HTML5 Sortable library examples: </span><a href="https://lukasoppermann.github.io/html5sortable"><span class="url"><span class="koboSpan" id="kobo.2574.1">https://lukasoppermann.github.io/html5sortable</span></span></a><span class="koboSpan" id="kobo.2575.1">/</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2576.1">django-braces</span></code><span class="koboSpan" id="kobo.2577.1"> documentation: </span><a href="https://django-braces.readthedocs.io/"><span class="url"><span class="koboSpan" id="kobo.2578.1">https://django-braces.readthedocs.io/</span></span></a></li>
</ul>
</div>
</body></html>