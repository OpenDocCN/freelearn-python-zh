<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer088">
			<h1 id="_idParaDest-374"><em class="italic"><a id="_idTextAnchor379"/></em><a href="B16119_13_Final_PD_ePub.xhtml#_idTextAnchor379"><em class="italic">Chapter 13</em></a>: Creating Web and Portal Frontend Features</h1>
			<p>Odoo is a business application framework, providing all the tools necessary to quickly build apps. A uniform web client provides the business user interface. But organizations are not isolated from the world. Being able to also interact with external users is needed to support efficient processes. For this, Odoo supports a web interface.</p>
			<p>The internal user web<a id="_idIndexMarker1046"/> client is sometimes referred to as the <strong class="bold">backend</strong>, and the<a id="_idIndexMarker1047"/> external user interface as the <strong class="bold">frontend</strong>. The frontend provides <strong class="bold">portal features</strong>, accessible to portal user<a id="_idIndexMarker1048"/> logins. It also provides public features, accessible without<a id="_idIndexMarker1049"/> the need for a login, referred as <strong class="bold">website features</strong>.</p>
			<p>The portal complements backend apps, providing self-service features to external users, such as viewing and paying for their orders, or submitting a support ticket.</p>
			<p>The website features<a id="_idIndexMarker1050"/> are built on top of the Odoo <strong class="bold">Content Management System</strong> (<strong class="bold">CMS</strong>), which allows you to build web pages, including easy-to-use <em class="italic">drag and drop</em> web page design tools. Additional website features are provided as <strong class="bold">modules</strong>, such as blogs, online jobs, or e-commerce.</p>
			<p>In this chapter, you will learn how to develop frontend add-on modules, leveraging the website features provided by Odoo, while discussing the following topics:</p>
			<ul>
				<li>Introducing the library portal learning project</li>
				<li>Creating a frontend web page</li>
				<li>Learning about web controllers</li>
				<li>Adding portal features</li>
			</ul>
			<p>By the end of this chapter, you will have learned how to use web controllers and QWeb templates to create dynamic web pages, integrated into the Odoo frontend. Additionally, you will learn how to leverage the Odoo portal module, adding your features to it.</p>
			<h1 id="_idParaDest-375"><a id="_idTextAnchor380"/>Technical requirements</h1>
			<p>The work in this chapter requires the <strong class="source-inline">library_checkout</strong> add-on module, last edited in <a href="B16119_11_Final_PD_ePub.xhtml#_idTextAnchor324"><em class="italic">Chapter 11</em></a>, <em class="italic">Kanban Views and Client-Side QWeb</em>. The add-on module and its dependencies code can be found in the Git repository at https://github.com/PacktPublishing/Odoo-15-Development-Essentials. The code in this chapter can be found in the same repository.</p>
			<h1 id="_idParaDest-376"><a id="_idTextAnchor381"/>Introducing the library portal learning project</h1>
			<p>To learn about Odoo web page development, a new project will be used. The library app can use self-service features for library<a id="_idIndexMarker1051"/> members. Members can be assigned a user login to have access to their book checkout requests.</p>
			<p>The <strong class="source-inline">library_portal</strong> add-on module will be created for these portal self-service features.</p>
			<p>The first file to add is the manifest, <strong class="source-inline">library_portal/__manifest__.py</strong>, which you can create with the following code:</p>
			<p class="source-code">{</p>
			<p class="source-code">  "name": "Library Portal",</p>
			<p class="source-code">  "description": "Portal for library members",</p>
			<p class="source-code">  "author": "Daniel Reis",</p>
			<p class="source-code">  "license": "AGPL-3",</p>
			<p class="source-code">  "depends": [</p>
			<p class="source-code">      "library_checkout", "portal"</p>
			<p class="source-code">  ],</p>
			<p class="source-code">  "data": [</p>
			<p class="source-code">    "security/library_security.xml",</p>
			<p class="source-code">    "security/ir.model.access.csv",</p>
			<p class="source-code">    "views/checkout_portal_templates.xml",</p>
			<p class="source-code">  ],</p>
			<p class="source-code">}</p>
			<p>The module depends on <strong class="source-inline">library_checkout</strong> to extend its features. It also depends on the <strong class="source-inline">portal</strong> module, providing the foundation for portal features. The <strong class="source-inline">website</strong> module provides CMS features, and can also be used for web page development. However, the <strong class="source-inline">portal</strong> modules can provide essential frontend features without the need to have the <em class="italic">Website</em> app installed.</p>
			<p>The <strong class="source-inline">data</strong> key lists three XML files to be used. The first two are security related, and give portal users the access needed to be able to view the checkout requests. The last XML file will have the QWeb templates for the portal user interface.</p>
			<p>An empty <strong class="source-inline">library_portal/__init__.py</strong> file is also needed for the module directory to be a valid Python module, as required by the Odoo framework.</p>
			<p>Now that the new module has the essential<a id="_idIndexMarker1052"/> files, the next step is to add the basic components needed to have a functioning web page.</p>
			<h1 id="_idParaDest-377"><a id="_idTextAnchor382"/>Creating a frontend web page</h1>
			<p>To get started with the basics of Odoo<a id="_idIndexMarker1053"/> web development, a simple web page will be created. To do<a id="_idIndexMarker1054"/> this, two components are needed: a <strong class="bold">web controller</strong>, triggered when a particular URL is accessed, and a <strong class="bold">QWeb template</strong>, to generate the HTML to be presented<a id="_idIndexMarker1055"/> by that URL.</p>
			<p>The web page used to showcase this is a book catalog, a simple list of the books in the library. The book catalog page will be accessible at <strong class="source-inline">http://localhost:8069/library/catalog</strong>.</p>
			<p>The following screenshot provides an example of what should be seen:</p>
			<div>
				<div id="_idContainer084" class="IMG---Figure">
					<img src="Images/Figure_13.1_B16119.jpg" alt="Figure 13.1 – Book catalog frontend web page&#13;&#10;" width="972" height="380"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.1 – Book catalog frontend web page</p>
			<p>The first step is to add the web controller, which we will do in the next section.</p>
			<h2 id="_idParaDest-378"><a id="_idTextAnchor383"/>Adding a web controller</h2>
			<p>Web controllers<a id="_idIndexMarker1056"/> are Python objects, used to implement web features. They<a id="_idIndexMarker1057"/> can link URL paths to an object method, so that when that URL is accessed, the method is executed.</p>
			<p>For example, for the <strong class="source-inline">http://localhost:8069/library/catalog</strong> URL, the accessed path is <strong class="source-inline">/library/catalog</strong>.</p>
			<p>A URL path, sometimes<a id="_idIndexMarker1058"/> also called an <strong class="bold">endpoint</strong>, can be assigned to a server function. This is called <strong class="bold">routing</strong>. In Odoo, routes are declared<a id="_idIndexMarker1059"/> with the <strong class="source-inline">@http.route</strong> method decorator in an <strong class="source-inline">http.Controller</strong> object.</p>
			<p>To create<a id="_idIndexMarker1060"/> the route for <strong class="source-inline">/library/catalog</strong>, perform the following steps:</p>
			<ol>
				<li>The controller Python code will be added in the <strong class="source-inline">controllers</strong> subdirectory. In the <strong class="source-inline">library_portal</strong> module directory, edit the <strong class="source-inline">__init__.py</strong> file to import that subdirectory:<p class="source-code">from . import controllers</p></li>
				<li>Add the <strong class="source-inline">controllers/__init__.py</strong> file to import the Python file with the controller code, which will be in a <strong class="source-inline">main.py</strong> file:<p class="source-code">from . import main</p></li>
				<li>Add the actual<a id="_idIndexMarker1061"/> controller file, <strong class="source-inline">controllers/main.py</strong>, with the following<a id="_idIndexMarker1062"/> code:<p class="source-code">from odoo import http</p><p class="source-code">class Main(http.Controller): </p><p class="source-code">    @http.route("/library/catalog", </p><p class="source-code">      auth="public", website=True)</p><p class="source-code">    def catalog(self, **kwargs):</p><p class="source-code">        Book = http.request.env["library.book"]</p><p class="source-code">        books = Book.sudo().search([])</p><p class="source-code">        return http.request.render(</p><p class="source-code">            "library_portal.book_catalog",</p><p class="source-code">              {"books": books},</p><p class="source-code">        )</p></li>
			</ol>
			<p>Having done these steps, the controller component is done, and is able to process requests for the <strong class="source-inline">/library/catalog</strong> route.</p>
			<p>The <strong class="source-inline">odoo.http</strong> module provides the Odoo web-related features. The web controllers, responsible for page rendering, should be objects inheriting from the <strong class="source-inline">odoo.http.Controller</strong> class. The actual name used for the class is not important. In the previous code, the controller class name is <strong class="source-inline">Main()</strong>.</p>
			<p>The <strong class="source-inline">catalog()</strong> method, in the <strong class="source-inline">Main()</strong> class, is decorated with <strong class="source-inline">@http.route</strong>, binding it to one or more URL routes. Here, the <strong class="source-inline">catalog()</strong> method is triggered by the <strong class="source-inline">/library/catalog route</strong>. It also uses the <strong class="source-inline">auth="public"</strong> argument, meaning that this route is accessible without requiring authentication. And the <strong class="source-inline">website=true</strong> argument means that this page will use the web frontend layout, and ensures some needed additional variables are made available.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Using <strong class="source-inline">website=True</strong> does not require the <em class="italic">Website</em> app to be installed. It also works with base Odoo frontend web pages.</p>
			<p>These <strong class="source-inline">catalog()</strong> route method is expected to do some processing and then return the HTML page to the user's web browser.</p>
			<p>The <strong class="source-inline">http.request</strong> object is automatically set with the web request, and has available the <strong class="source-inline">.env</strong> attribute, to access the Odoo environment. This can be used to instantiate Odoo models. The example code does this to access the <strong class="source-inline">library.book</strong> model and then build a record set with all books available.</p>
			<p>The route method runs as the user who is logged in, or as the Public special user if no user is logged in and the route allows public access. Since the Public user has very limited access, <strong class="source-inline">sudo()</strong> might be needed to ensure that the data to be presented can be retrieved.</p>
			<p>The final line returns the result of <strong class="source-inline">http.request.render()</strong>. This prepares a QWeb template to be rendered. The two arguments are the template XML ID, <strong class="source-inline">library_portal.book_catalog</strong> in this case, and a dictionary<a id="_idIndexMarker1063"/> with the variables to make available to the QWeb rendering<a id="_idIndexMarker1064"/> context. In this case, a <strong class="source-inline">books</strong> variable is made available, set with a books record set.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="source-inline">http.request.render()</strong> function returns a Odoo <strong class="source-inline">http.response</strong> object, containing the instructions on what to render. The actual processing of the QWeb template into HTML is delayed until all web controller code is run and the response is ready to be sent to the client. This allows for the route method to be extended and, for example, the <strong class="source-inline">qcontext</strong> attribute, holding the dictionary to be used for the QWeb rendering, to be modified.</p>
			<p>The controller is ready, but the QWeb template used needs to be created before it can work. The next section takes care of that.</p>
			<h2 id="_idParaDest-379"><a id="_idTextAnchor384"/>Adding a QWeb template</h2>
			<p>QWeb templates are XML snippets<a id="_idIndexMarker1065"/> containing HTML code and QWeb directives<a id="_idIndexMarker1066"/> that can dynamically modify the output depending on conditions. The book catalog web page needs a QWeb template to render the HTML to be presented.</p>
			<p>To add the <strong class="source-inline">library_portal.book_catalog</strong> QWeb template, perform<a id="_idIndexMarker1067"/> the following steps:</p>
			<ol>
				<li value="1">A new XML data file, <strong class="source-inline">views/main_templates.xml</strong>, will be used to declare the template. Add that to the <strong class="source-inline">__manifest__.py</strong> module file, in the <strong class="source-inline">data</strong> key:<p class="source-code">  "data": [</p><p class="source-code">    "views/main_templates.xml",</p><p class="source-code">  ]</p></li>
				<li>Add the XML data file with the QWeb template, <strong class="source-inline">views/main_templates.xml</strong>:<p class="source-code">&lt;odoo&gt;</p><p class="source-code"><strong class="bold">&lt;template id="book_catalog" name="Book List"&gt;</strong></p><p class="source-code">  <strong class="bold">&lt;t t-call="web.frontend_layout"&gt;</strong></p><p class="source-code">    <strong class="bold">&lt;t t-set="title"&gt;Book Catalog&lt;/t&gt;</strong></p><p class="source-code">      &lt;div class="oe_structure"&gt;</p><p class="source-code">        &lt;div class="container"&gt;</p><p class="source-code">          &lt;h1 class="h1-book-catalog"&gt;</p><p class="source-code">            Book Catalog&lt;/h1&gt;</p><p class="source-code">          &lt;table class="table"&gt;</p><p class="source-code">            &lt;thead&gt;</p><p class="source-code">              &lt;tr&gt;</p><p class="source-code">                &lt;th scope="col"&gt;Title&lt;/th&gt;</p><p class="source-code">                &lt;th scope="col"&gt;Published&lt;/th&gt;</p><p class="source-code">                &lt;th scope="col"&gt;Publisher&lt;/th&gt;</p><p class="source-code">              &lt;/tr&gt;</p><p class="source-code">            &lt;/thead&gt;</p><p class="source-code">            &lt;tbody&gt;</p><p class="source-code">      &lt;t t-foreach="books" t-as="book"&gt;</p><p class="source-code">        &lt;tr scope="row"&gt;</p><p class="source-code">          &lt;td&gt;&lt;span t-field="book.name" /&gt;&lt;/td&gt;</p><p class="source-code">          &lt;td&gt;&lt;span t-field="book.date_published" </p><p class="source-code">              /&gt;&lt;/td&gt;</p><p class="source-code">          &lt;td&gt;&lt;span t-field="book.publisher_id" </p><p class="source-code">              /&gt;&lt;/td&gt;</p><p class="source-code">        &lt;/tr&gt;</p><p class="source-code">      &lt;/t&gt;</p><p class="source-code">            &lt;/tbody&gt;</p><p class="source-code">          &lt;/table&gt;</p><p class="source-code">      &lt;/div&gt;</p><p class="source-code">    &lt;/div&gt;</p><p class="source-code">  &lt;/t&gt;</p><p class="source-code">&lt;/template&gt;</p><p class="source-code">&lt;/odoo&gt;</p></li>
			</ol>
			<p>This completes the steps needed to get the QWeb template ready.</p>
			<p>The previous code declares the <strong class="source-inline">book_catalog</strong> template. It is a Bootstrap table, with three columns. The <strong class="source-inline">&lt;thead&gt;</strong> section declares<a id="_idIndexMarker1068"/> the columns headers, and the <strong class="source-inline">&lt;t t-foreach&gt;</strong> QWeb directive<a id="_idIndexMarker1069"/> renders a table row for each book in the <strong class="source-inline">books</strong> record set.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">QWeb templates are XML. The XML language has stricter rules than regular HTML, which, for example, tolerates opening tags that are not closed. This is not allowed in XML, and therefore in QWeb templates. To be precise, QWeb templates follow the XHTML requirements.</p>
			<p>Important in this template is the first directive, <strong class="source-inline">&lt;t t-call="web.frontend_layout"&gt;</strong>. This is what makes the template HTML be rendered as an Odoo frontend web page, including page headers and footers. For this layout to be used, the controller route must include the <strong class="source-inline">website=True</strong> argument.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">The website data passed into the QWeb evaluation context is set by the <strong class="source-inline">_prepare_qcontext</strong> method of the <strong class="source-inline">ir.ui.view</strong> model. For example, the <strong class="source-inline">website</strong> module adds variables to it, in the <strong class="source-inline">models/ir_ui_view.py</strong> file.</p>
			<p><strong class="source-inline">&lt;t t-set="title"&gt;</strong> is also noteworthy. It is used by the frontend layout to set the browser tab title.</p>
			<p>When we have both the controller and the QWeb template in place, once the <strong class="source-inline">library_portal</strong> module is installed or upgraded, opening <strong class="source-inline">http://localhost:8069/library/catalog</strong> with a web browser should display a table with the library's books.</p>
			<p>These are the key components used to implement<a id="_idIndexMarker1070"/> frontend web pages. Note that the <em class="italic">Website</em> app can be used to have more<a id="_idIndexMarker1071"/> frontend features available, but is not required.</p>
			<p>Being a web page, it may also need to use additional assets. The next section explains this.</p>
			<h2 id="_idParaDest-380"><a id="_idTextAnchor385"/>Adding CSS and JavaScript assets</h2>
			<p>When designing web pages, the HTML code<a id="_idIndexMarker1072"/> is often complemented with CSS or JavaScript, which are best<a id="_idIndexMarker1073"/> provided as additional assets.</p>
			<p>Assets to load are declared in the head section of the page. Odoo has specific QWeb templates in charge of loading assets. In particular, the <strong class="source-inline">web.assets_backend</strong> and <strong class="source-inline">web.assets_frontend</strong> provide the assets needed specifically for backend web client and frontend web pages. <strong class="source-inline">web.assets_common</strong> provides assets common to both.</p>
			<p>To have additional assets loaded, the appropriate template needs to be extended.</p>
			<p>For example, in the book catalog page, the title could be presented using a larger font size. This can be done by declaring a style in a CSS file, which is then used in the <strong class="source-inline">&lt;h1&gt;</strong> element. In fact, the book catalog QWeb template is already using <strong class="source-inline">&lt;h1 class="h1-book-catalog"&gt;</strong>, applying a custom style.</p>
			<p>To add this custom style, perform the following steps: </p>
			<ol>
				<li value="1">Create the <strong class="source-inline">static/src/css/library.css</strong> file with the following content:<p class="source-code">.h1-book-catalog {</p><p class="source-code">    font-size: 62px;</p><p class="source-code">}</p></li>
				<li>This CSS must be loaded by frontend web pages. For this, the <strong class="source-inline">web.assets_frontend</strong> template should be extended. Add to the <strong class="source-inline">__manifest__.py</strong> file the following code:<p class="source-code">    "assets": {</p><p class="source-code">        "web.assets_backend": {</p><p class="source-code">            "library_portal/static/src/css/</p><p class="source-code">              library.css",</p><p class="source-code">        }</p><p class="source-code">    }</p></li>
			</ol>
			<p>This describes how a module can add web assets. These assets will usually be <strong class="source-inline">.js</strong>, <strong class="source-inline">.css</strong>, or <strong class="source-inline">.scss</strong> files.</p>
			<p class="callout-heading">Changes in Odoo 15</p>
			<p class="callout">Web assets were previously added using an XML file, extending an QWeb template, such as <strong class="source-inline">web.assets_backend</strong> or <strong class="source-inline">web.assets_frontend</strong>. An example for this is provided in <a href="B16119_11_Final_PD_ePub.xhtml#_idTextAnchor324"><em class="italic">Chapter 11</em></a>, <em class="italic">Kanban Views and Client-Side QWeb</em>, in the <em class="italic">Adding CSS and JavaScript assets</em> section.</p>
			<p>The basics for creating<a id="_idIndexMarker1074"/> a frontend web page have been described, and involve<a id="_idIndexMarker1075"/> three key components: web controllers, QWeb templates, and web assets.</p>
			<p>QWeb templates and their syntax have been thoroughly described in <a href="B16119_11_Final_PD_ePub.xhtml#_idTextAnchor324"><em class="italic">Chapter 11</em></a>, <em class="italic">Kanban Views and Client-Side QWeb</em>, and <a href="B16119_12_Final_PD_ePub.xhtml#_idTextAnchor358"><em class="italic">Chapter 12</em></a>, <em class="italic">Creating Printable PDF Reports with Server-Side QWeb</em>.</p>
			<p>But web controllers are worth more attention, and a deeper description of their features. The following section will provide this.</p>
			<h1 id="_idParaDest-381"><a id="_idTextAnchor386"/>Understanding web controllers</h1>
			<p>Web controllers are the server-side components<a id="_idIndexMarker1076"/> responsible for responding when an Odoo web path is accessed, usually triggering the rendering of a web page.</p>
			<p>A web path, such as <strong class="source-inline">/library/catalog</strong>, is assigned<a id="_idIndexMarker1077"/> to a route, triggering a <strong class="bold">controller method</strong>. The method code can access details of the web request through the <strong class="source-inline">request</strong> object, and the result is a <strong class="source-inline">response</strong> object, with the details to return to the client.</p>
			<h2 id="_idParaDest-382"><a id="_idTextAnchor387"/>Declaring routes</h2>
			<p>The <strong class="source-inline">http.route</strong> decorator<a id="_idIndexMarker1078"/> is used to assign a method to a web path. These are the arguments<a id="_idIndexMarker1079"/> available:</p>
			<ul>
				<li><strong class="source-inline">route</strong>, usually provided as a positional argument, is a string, or a list of strings, with the paths to map. Method arguments can be extracted from the path. The syntax to express these arguments is detailed in the next section.</li>
				<li><strong class="source-inline">type</strong>, to specify the type of request. By default, this is <strong class="source-inline">http</strong>, and can also be set to <strong class="source-inline">json</strong>.</li>
				<li><strong class="source-inline">auth</strong> is the authentication type required. It can be one of <strong class="source-inline">user</strong>, <strong class="source-inline">public</strong>, or <strong class="source-inline">none</strong>. The <strong class="source-inline">user</strong> option requires a login to allow access, <strong class="source-inline">public</strong> allows anonymous access, through the public user, and <strong class="source-inline">none</strong> is useful in special cases, where an Odoo database is not needed, such as authentication endpoints.</li>
			</ul>
			<p>These are the arguments that can be used on <strong class="source-inline">route</strong> decorators. The next section explains the syntax to extract values from the main argument, to be passed to the decorated method.</p>
			<h2 id="_idParaDest-383"><a id="_idTextAnchor388"/>Extracting argument values from the route string</h2>
			<p>The <strong class="bold">route strings</strong> can specify arguments to extract, following the format <strong class="source-inline">&lt;type:name&gt;</strong>. For example, <strong class="source-inline">&lt;int:partner_id&gt;</strong> extracts an integer value, and passes it to the<a id="_idIndexMarker1080"/> method as the <strong class="source-inline">partner_id</strong> keyword argument. Record instances are also supported, using the <strong class="source-inline">model(&lt;model name&gt;)</strong> syntax. For example, <strong class="source-inline">&lt;model('res.partner'):partner&gt;</strong> extracts a partner<a id="_idIndexMarker1081"/> record, passed to the method with the <strong class="source-inline">partner</strong> keyword argument.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">More information on route path formatting<a id="_idIndexMarker1082"/> can be found in the official Werkzeug documentation at <a href="https://werkzeug.palletsprojects.com/routing/">https://werkzeug.palletsprojects.com/routing/</a>.</p>
			<p>The URL parameters are passed<a id="_idIndexMarker1083"/> to the decorated method as keyword arguments. These parameters are after the <strong class="source-inline">?</strong> character<a id="_idIndexMarker1084"/> in a <strong class="source-inline">GET</strong> request, or submitted by a <strong class="source-inline">POST</strong> request. For example, the <strong class="source-inline">http://localhost:8069/mypage</strong><strong class="bold">?x=1&amp;y=2</strong> URL has two parameters, <strong class="source-inline">x</strong> set to <strong class="source-inline">1</strong> and <strong class="source-inline">y</strong> set to <strong class="source-inline">2</strong>.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Adding to routed methods the <strong class="source-inline">**kw</strong> generic keyword argument capture prevents it from erroring if an unexpected argument is added to the URL. For example, without it, accessing <strong class="source-inline">http://localhost:8069/library/catalog</strong><strong class="bold">?some_param=1</strong> would return an error page. With <strong class="source-inline">**kw</strong> on the method arguments, it would be captured in the <strong class="source-inline">kw</strong> variable, and could be ignored by the method code.</p>
			<p>The routed method return value can be any of the following:</p>
			<ul>
				<li>A <strong class="bold">falsy</strong> value, resulting in a <em class="italic">204 No Content</em> HTTP code response.</li>
				<li>A text string, used to return a response with that text as the HTML content.</li>
				<li>A <strong class="source-inline">response</strong> object, usually created with the <strong class="source-inline">render()</strong> method.</li>
			</ul>
			<p>Next, let's learn how the <strong class="source-inline">request</strong> object can be used in a routed method.</p>
			<h2 id="_idParaDest-384"><a id="_idTextAnchor389"/>Using the request object</h2>
			<p>A <strong class="source-inline">request</strong> object is automatically instanced when a client web request is <a id="_idIndexMarker1085"/>made to the Odoo server. It is made available by importing <strong class="source-inline">odoo.http.request</strong>.</p>
			<p>The following are the most important<a id="_idIndexMarker1086"/> attributes provided by this object:</p>
			<ul>
				<li><strong class="source-inline">env</strong> is an Odoo <strong class="source-inline">Environment</strong> object, similar to what <strong class="source-inline">self.env</strong> provides in regular model methods.</li>
				<li><strong class="source-inline">context</strong> is a dictionary-like <strong class="source-inline">Mapping</strong> object with the execution context. It is similar to model method context.</li>
				<li><strong class="source-inline">cr</strong> is a PostgreSQL cursor object for the Odoo database.</li>
				<li><strong class="source-inline">db</strong> is the database name.</li>
				<li><strong class="source-inline">session</strong> is an object storing the session details, including authentication.</li>
				<li><strong class="source-inline">params</strong> stores the request<a id="_idIndexMarker1087"/> parameters. It is usually not useful, since the parameters are already provided as arguments to the method.</li>
				<li><strong class="source-inline">csrf_token(time_limit=None)</strong> is a method to generate a CSRF token for the current session. The <strong class="source-inline">time_limit</strong> is the token validity period in seconds. The default, <strong class="source-inline">None</strong>, makes it valid for the whole session duration. This attribute is used, for example, to set a CSRF token for HTML forms.</li>
			</ul>
			<p>For <strong class="source-inline">http</strong> type requests, the following methods are also available:</p>
			<ul>
				<li><strong class="source-inline">make_response(data, headers=None, cookies=None)</strong> can be used to craft non-HTML responses.</li>
				<li><strong class="source-inline">not_found(description=None)</strong> returns a <em class="italic">404 Not Found</em> HTTP code.</li>
				<li><strong class="source-inline">render(template, qcontext=None, lazy=True, **kw)</strong> returns a QWeb template to render. The actual template rendering is delayed until the final dispatch to the client, and so it can be modified by inheriting methods.</li>
			</ul>
			<p>Request objects provide<a id="_idIndexMarker1088"/> a way to access the Odoo environment and all the information about the request made by the client. The next relevant object to understand is the <strong class="source-inline">response</strong>, to be sent back to the client initiating the request.</p>
			<h2 id="_idParaDest-385"><a id="_idTextAnchor390"/>Using the response object</h2>
			<p>The <strong class="source-inline">response</strong> object is used to dispatch the final HTTP message to send to<a id="_idIndexMarker1089"/> the client. When extending routed methods, it might be the case that the <strong class="source-inline">response</strong> returned by the parent <strong class="source-inline">super()</strong> method needs modifications.</p>
			<p>The following is available on the <strong class="source-inline">response</strong> object:</p>
			<ul>
				<li><strong class="source-inline">template</strong> is the name of the template to render.</li>
				<li><strong class="source-inline">qcontext</strong> is a dictionary with the data to make available for the template rendering.</li>
				<li><strong class="source-inline">uid</strong> is an integer with the ID of the user rendering the template. If not set, the current user running the method code is used.</li>
				<li><strong class="source-inline">render()</strong> is the same rendering method also available in the <strong class="source-inline">request</strong> object.</li>
				<li><strong class="source-inline">flatten()</strong> forces the rendering of the template.</li>
			</ul>
			<p>The response object also supports the parameters provided by the parent library, <strong class="source-inline">werkzeug.wrappers.Response</strong>. The corresponding documentation can be found at <a href="https://werkzeug.palletsprojects.com/wrappers/#werkzeug.wrappers.Response">https://werkzeug.palletsprojects.com/wrappers/#werkzeug.wrappers.Response</a>.</p>
			<p>You now have a good idea about the web development components. Odoo also provides a portal useful to interact with external users and the next section explains how to add features to it.</p>
			<h1 id="_idParaDest-386"><a id="_idTextAnchor391"/>Adding portal features</h1>
			<p>The Odoo portal feature<a id="_idIndexMarker1090"/> make information available to interact with external users. Different apps can add features to the portal. For example, the <strong class="bold">Sales</strong> app adds the ability for customers to check their orders, and even pay for them.</p>
			<p>Portal users need to be created, providing access to the portal. This is done on the corresponding contact record in the <strong class="bold">Action</strong> context menu, with the <strong class="bold">Grant portal access</strong> option, as shown in <em class="italic">Figure 13.2</em>:</p>
			<div>
				<div id="_idContainer085" class="IMG---Figure">
					<img src="Images/Figure_13.2_B16119.jpg" alt="Figure 13.2 – The Grant portal access option on a contact record&#13;&#10;" width="1090" height="610"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.2 – The Grant portal access option on a contact record</p>
			<p>Once the user goes through the sign-up process, they can log in to Odoo and see a <strong class="bold">My Account</strong> option when<a id="_idIndexMarker1091"/> clicking on the username in the top right corner. This option opens the portal home page, presenting a summary of all the documents available to the user.</p>
			<p>The documents available depend on the apps installed. <em class="italic">Figure 13.3</em> shows an example of what the portal home page looks like:</p>
			<div>
				<div id="_idContainer086" class="IMG---Figure">
					<img src="Images/Figure_13.3_B16119.jpg" alt="Figure 13.3 – Portal page with book checkouts feature&#13;&#10;" width="979" height="448"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.3 – Portal page with book checkouts feature</p>
			<p>The <strong class="source-inline">library_portal</strong> module adds the <strong class="bold">Book Checkouts</strong> item to the portal <strong class="bold">Documents</strong>, as seen in <em class="italic">Figure 13.3</em>. This is the result<a id="_idIndexMarker1092"/> of what will be implemented in this section.</p>
			<p>The work for this will be split into three parts: access security, controllers, and QWeb templates. Each of the following sections will address one of these steps. You will start by setting the portal access security configuration.</p>
			<h2 id="_idParaDest-387"><a id="_idTextAnchor392"/>Configuring access security for the portal users</h2>
			<p>Before portal users can access<a id="_idIndexMarker1093"/> app data, the necessary access rights need to be given<a id="_idIndexMarker1094"/> to the portal user group, <strong class="source-inline">base.group_portal group</strong>.</p>
			<p>In the case of the library app, portal users should be given read-only access to the book, member, checkout, and stage models. Furthermore, each portal user should only be able to see their own member record and checkouts. For this, both access rights and record rules need to be added.</p>
			<p>To configure the access security for portal users, perform the following steps:</p>
			<ol>
				<li value="1">Create the <strong class="source-inline">security/ir.model.access.csv</strong> file, adding read access to the library models, with the following content:<p class="source-code">id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink</p><p class="source-code">access_book_portal,Book Portal Access,<strong class="bold">library_app.model_library_book</strong>,base.group_portal,1,0,0,0</p><p class="source-code">access_member_portal,Member Portal Access,<strong class="bold">library_member.model_library_member</strong>,base.group_portal,1,0,0,0</p><p class="source-code">access_stage_portal,Checkout Stage Portal Access,<strong class="bold">library_checkout.model_library_checkout_stage</strong>,base.group_portal,1,0,0,0</p><p class="source-code">access_checkout_portal,Checkout Portal Access,<strong class="bold">library_checkout.model_library_checkout</strong>,base.group_portal,1,0,0,0</p><p class="source-code">access_checkout_portal_line,Checkout Portal Line Access,<strong class="bold">library_checkout.model_library_checkout_line</strong>,base.group_portal,1,0,0,0</p></li>
				<li>Create the <strong class="source-inline">security/library_security.xml</strong> file with <strong class="bold">record rules</strong>, limiting the records<a id="_idIndexMarker1095"/> portal that users will be<a id="_idIndexMarker1096"/> able to access:<p class="source-code">&lt;odoo&gt;</p><p class="source-code">  &lt;data noupdate="1"&gt;</p><p class="source-code">    &lt;record id="member_portal_rule" model="ir.rule"&gt;</p><p class="source-code">      &lt;field name="name"&gt;</p><p class="source-code">        Library Member Portal Access&lt;/field&gt;</p><p class="source-code">      &lt;field name="model_id" </p><p class="source-code">             ref=</p><p class="source-code">               "library_member.model_library_member"/&gt;</p><p class="source-code">      &lt;field name="domain_force"</p><p class="source-code">        &gt;[('partner_id', '=', </p><p class="source-code">         user.partner_id.id)]&lt;/field&gt;</p><p class="source-code">      &lt;field name="groups" </p><p class="source-code">        eval="[(4,ref('base.group_portal'))]"/&gt;</p><p class="source-code">    &lt;/record&gt;</p><p class="source-code">    &lt;record id="checkout_portal_rule" model="ir.rule"&gt;</p><p class="source-code">      &lt;field name="name"&gt;</p><p class="source-code">        Library Checkout Portal Access&lt;/field&gt;</p><p class="source-code">      &lt;field name="model_id"</p><p class="source-code">         ref=</p><p class="source-code">           "library_checkout.model_library_checkout"/&gt;</p><p class="source-code">      &lt;field name="domain_force"</p><p class="source-code">        &gt;[('member_id.partner_id', '=', </p><p class="source-code">           user.partner_id.id)]&lt;/field&gt;</p><p class="source-code">      &lt;field name="groups"</p><p class="source-code">             eval="[(4,ref('base.group_portal'))]"/&gt;</p><p class="source-code">    &lt;/record&gt;</p><p class="source-code">  &lt;/data&gt;</p><p class="source-code">&lt;/odoo&gt;</p></li>
				<li>Finally, add these data files<a id="_idIndexMarker1097"/> to the <strong class="source-inline">data</strong> key in the<a id="_idIndexMarker1098"/> module <strong class="source-inline">__manifest__.py</strong> file:<p class="source-code">  "data": [</p><p class="source-code"><strong class="bold">    "security/ir.model.access.csv",</strong></p><p class="source-code"><strong class="bold">    "security/library_security.xml",</strong></p><p class="source-code">    "views/assets.xml",</p><p class="source-code">    "views/main_templates.xml",</p><p class="source-code">  ],</p></li>
			</ol>
			<p>The record rules created apply filters based on the current user partner record, <strong class="source-inline">user.partner_id.id</strong>. The members are filtered using the <strong class="source-inline">partner_id</strong> field, and the checkouts are filtered using the <strong class="source-inline">member_id.partner_id</strong> field.</p>
			<p>After this, and a module upgrade, portal users will have the access rights needed to use the library portal pages.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">It is often the case that web controllers avoid the need to have access rights added, by using <strong class="source-inline">sudo()</strong> to get elevated access, which is sure to have access to the data. While convenient, the usage of <strong class="source-inline">sudo()</strong> should be carefully considered, and avoided if possible. It is more secure to implement access security on the model layer, using ACLs and record rules, instead of relying on the controller logic for that.</p>
			<p>Having the necessary<a id="_idIndexMarker1099"/> access rights<a id="_idIndexMarker1100"/> configured, the next step is to add the checkouts item to the portal main list.</p>
			<h2 id="_idParaDest-388"><a id="_idTextAnchor393"/>Adding a portal document type to the main list</h2>
			<p>Accessing the portal <strong class="bold">My Account</strong> page shows several document types available, such as <strong class="bold">sales orders</strong> and <strong class="bold">invoices</strong>, and the number of <a id="_idIndexMarker1101"/>items for each.</p>
			<p>The <strong class="source-inline">library_portal</strong> module should add the <strong class="bold">Book Checkouts</strong> option to the <strong class="bold">My Account</strong> page. Perform the following steps for that:</p>
			<ol>
				<li value="1">Edit the <strong class="source-inline">controllers/__init__.py</strong> file to import the Python file with the controller code, which will be in the <strong class="source-inline">portal.py</strong> file:<p class="source-code">from . import main</p><p class="source-code"><strong class="bold">from . import portal</strong></p></li>
				<li>Add the controller file, <strong class="source-inline">controllers/portal.py</strong>, with the following code:<p class="source-code">from odoo.http import route, request</p><p class="source-code">from odoo.addons.portal.controllers import portal</p><p class="source-code">class CustomerPortal(portal.CustomerPortal):</p><p class="source-code">    def _prepare_home_portal_values(self, counters):</p><p class="source-code">        values = super()</p><p class="source-code">          ._prepare_home_portal_values(counters)</p><p class="source-code">        if "book_checkout_count" in counters:</p><p class="source-code">            count = </p><p class="source-code">           request.env[</p><p class="source-code">            "library.checkout"].search_count([])</p><p class="source-code">            values["book_checkout_count"] = count</p><p class="source-code">        return values</p><p>This extends the <strong class="source-inline">CustomerPortal</strong> controller, provided by the <strong class="source-inline">portal</strong> Odoo module. The previous code extends the <strong class="source-inline">_prepare_home_portal_values()</strong> method, responsible for calculating the document counters. It adds the <strong class="source-inline">book_checkout_count</strong> key to the result values, set with the checkout count.</p></li>
				<li>Add the QWeb<a id="_idIndexMarker1102"/> template file, <strong class="source-inline">views/portal_templates.py</strong>, with the following code:<p class="source-code">&lt;odoo&gt;</p><p class="source-code">    &lt;template id="portal_my_home" </p><p class="source-code">      inherit_id="portal.portal_my_home"</p><p class="source-code">        name="Show Book Checkouts" priority="100"</p><p class="source-code">        customize_show="True"&gt;</p><p class="source-code">        &lt;xpath expr="//div[hasclass('o_portal_docs')]"</p><p class="source-code">            position="inside"&gt;</p><p class="source-code">            &lt;t t-call="portal.portal_docs_entry"&gt;</p><p class="source-code">                &lt;t t-set="title"&gt;Book Checkouts&lt;/t&gt;</p><p class="source-code">                &lt;t t-set="url" </p><p class="source-code">                  t-value="'/my/book-checkouts'"/&gt;</p><p class="source-code">                &lt;t t-set="placeholder_count"</p><p class="source-code">                   t-value="'book_checkout_count'"/&gt;</p><p class="source-code">            &lt;/t&gt;</p><p class="source-code">        &lt;/xpath&gt;</p><p class="source-code">    &lt;/template&gt;</p><p class="source-code">&lt;/odoo&gt;</p><p>This extends the <strong class="source-inline">portal.portal_my_home</strong> template, responsible for rendering the <strong class="bold">My Account</strong> page. The <strong class="source-inline">portal.portal_docs_entry</strong> template should be used to render each document item. It uses three variables: the <strong class="source-inline">title</strong>, the <strong class="source-inline">url</strong> to navigate to when clicked, and the <strong class="source-inline">placeholder_count</strong>, with the counter identifier<a id="_idIndexMarker1103"/> provided by the <strong class="source-inline">_prepare_home_portal_values</strong> function.</p></li>
				<li>Finally, add the new data file to <strong class="source-inline">__manifest__.py</strong>:<p class="source-code">  "data": [</p><p class="source-code">    "security/library_security.xml",</p><p class="source-code">    "security/ir.model.access.csv",</p><p class="source-code">    "views/assets.xml",</p><p class="source-code">    "views/main_templates.xml",</p><p class="source-code"><strong class="bold">    "views/portal_templates.xml",</strong></p><p class="source-code">  ],</p></li>
			</ol>
			<p>The previous steps add the <strong class="bold">Book Checkouts</strong> option to the document list in the <strong class="bold">My Account</strong> page. Clicking on it will navigate to the <strong class="source-inline">/my/book-checkouts</strong> page, but this hasn't been implemented<a id="_idIndexMarker1104"/> yet. The next section will do this in a portal-friendly way.</p>
			<h2 id="_idParaDest-389"><a id="_idTextAnchor394"/>Adding a portal document list page</h2>
			<p>The <strong class="bold">My Account</strong> home page lists the various <a id="_idIndexMarker1105"/>document types available. Clicking the document type link should open the list of documents available.</p>
			<p><em class="italic">Figure 13.4</em> shows what the document list page should look like:</p>
			<div>
				<div id="_idContainer087" class="IMG---Figure">
					<img src="Images/Figure_13.4_B16119.jpg" alt="Figure 13.4 – Portal document list page for book checkouts&#13;&#10;" width="972" height="389"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.4 – Portal document list page for book checkouts</p>
			<p>The portal provides base features to be used for these document list pages, such as record paging, filters, and sort options.</p>
			<p>The previous example showed how to add a document type to the portal home page. Next, the document list needs to be implemented. Continuing with the code from the previous section, two steps are needed:</p>
			<ol>
				<li value="1">Edit the controller file, <strong class="source-inline">controllers/portal.py</strong>, to add the code for the <strong class="source-inline">/my/book-checkouts</strong> route, which will render the <strong class="source-inline">my_book_checkouts</strong> template.</li>
				<li>Edit the QWeb template file, <strong class="source-inline">views/portal_templates.py</strong>, to add the <strong class="source-inline">my_book_checkouts</strong> template for the book checkout <a id="_idIndexMarker1106"/>list page.</li>
			</ol>
			<p>The code to add to <strong class="source-inline">controllers/portal.py</strong> is the following:</p>
			<p class="source-code">    @route(</p>
			<p class="source-code">      ["/my/book-checkouts", "/my/book-checkouts/</p>
			<p class="source-code">          page/&lt;int:page&gt;"],</p>
			<p class="source-code">      auth="user",</p>
			<p class="source-code">      website=True,</p>
			<p class="source-code">    )</p>
			<p class="source-code">    def my_book_checkouts(self, page=1, **kw):</p>
			<p class="source-code">        Checkout = request.env["library.checkout"]</p>
			<p class="source-code">        domain = []</p>
			<p class="source-code"><strong class="bold">        # Prepare pager data</strong></p>
			<p class="source-code">        checkout_count = Checkout.search_count(domain)</p>
			<p class="source-code">        pager_data = portal.pager(</p>
			<p class="source-code">            url="/my/book_checkouts",</p>
			<p class="source-code">            total=checkout_count,</p>
			<p class="source-code">            page=page,</p>
			<p class="source-code">            step=self._items_per_page,</p>
			<p class="source-code">        )</p>
			<p class="source-code"><strong class="bold">        # Recordset according to pager and domain filter</strong></p>
			<p class="source-code">        checkouts = Checkout.search(</p>
			<p class="source-code">            domain,</p>
			<p class="source-code">            limit=self._items_per_page,</p>
			<p class="source-code">            offset=pager_data["offset"],</p>
			<p class="source-code">        )</p>
			<p class="source-code"><strong class="bold">        # Prepare template values and render</strong></p>
			<p class="source-code">        values = self._prepare_portal_layout_values()</p>
			<p class="source-code">        values.update(</p>
			<p class="source-code">            {</p>
			<p class="source-code">                "checkouts": checkouts,</p>
			<p class="source-code">                "page_name": "book-checkouts",</p>
			<p class="source-code">                "default_url": "/my/book-checkouts",</p>
			<p class="source-code">                "pager": pager_data,</p>
			<p class="source-code">            }</p>
			<p class="source-code">        )</p>
			<p class="source-code">        return request.render(</p>
			<p class="source-code">            "library_portal.my_book_checkouts",</p>
			<p class="source-code">            values</p>
			<p class="source-code">        )</p>
			<p>The previous code adds a route for the <strong class="source-inline">/my/book-checkouts</strong> and <strong class="source-inline">/my/book-checkouts/page/</strong> paths. The first is the one used by default, and the second allows navigating <a id="_idIndexMarker1107"/>through the record pages.</p>
			<p>The method code is organized into three sections:</p>
			<ul>
				<li>The first code section prepares the <strong class="source-inline">pager_data</strong> variable, used by the template to render the page navigation links. It uses a <strong class="source-inline">pager()</strong> function from the portal module, responsible for preparing this data.</li>
				<li>The second code section creates the record set to be used, <strong class="source-inline">checkouts</strong>. It does so using the domain filter and pager data set previously.</li>
				<li>The third and last code section prepares the <strong class="source-inline">values</strong> dictionary and renders the QWeb template. The values are initialized using the portal-provided <strong class="source-inline">_prepare_portal_layout_values()</strong> function, and then additional data keys are set, including the pager data. The record set to use is also set in the values, in this case in the <strong class="source-inline">checkouts</strong> data key.<p class="callout-heading">Tip</p><p class="callout">The portal pages can also have support for user-selected sort<a id="_idIndexMarker1108"/> order and filters. A good example of this is the portal <strong class="bold">Tasks</strong>, implemented by the <em class="italic">Project</em> app. Inspecting the corresponding controllers and QWeb templates can provide further guidance to add this to other portal pages.</p></li>
			</ul>
			<p>You have <a id="_idIndexMarker1109"/>added the controller code, now let's add the QWeb template with the following code:</p>
			<p class="source-code">    &lt;template id="my_book_checkouts" name=</p>
			<p class="source-code">      "My Book Checkouts"&gt;</p>
			<p class="source-code"><strong class="bold">      &lt;t t-call="portal.portal_layout"&gt;</strong></p>
			<p class="source-code"><strong class="bold">        &lt;t t-if="checkouts" t-call="portal.portal_table"&gt;</strong></p>
			<p class="source-code">          &lt;thead&gt;</p>
			<p class="source-code">            &lt;tr&gt;</p>
			<p class="source-code">              &lt;th&gt;Title&lt;/th&gt;</p>
			<p class="source-code">              &lt;th&gt;Request Date&lt;/th&gt;</p>
			<p class="source-code">              &lt;th&gt;Stage&lt;/th&gt;</p>
			<p class="source-code">            &lt;/tr&gt;</p>
			<p class="source-code">          &lt;/thead&gt;</p>
			<p class="source-code">          &lt;tbody&gt;</p>
			<p class="source-code"><strong class="bold">            &lt;tr t-foreach="checkouts" t-as="doc"&gt;</strong></p>
			<p class="source-code">              &lt;td&gt;</p>
			<p class="source-code">                &lt;a t-attf-href=</p>
			<p class="source-code">                  "/my/book-checkout/{{slug(doc)}}"&gt;</p>
			<p class="source-code">                  &lt;span t-field="doc.name"/&gt;</p>
			<p class="source-code">                &lt;/a&gt;</p>
			<p class="source-code">              &lt;/td&gt;</p>
			<p class="source-code">              &lt;td&gt;</p>
			<p class="source-code">                &lt;span t-field="doc.request_date"/&gt;</p>
			<p class="source-code">              &lt;/td&gt;</p>
			<p class="source-code">              &lt;td&gt;</p>
			<p class="source-code">                &lt;span t-field="doc.stage_id.name"</p>
			<p class="source-code">                      class="badge badge-pill badge-info"/&gt;</p>
			<p class="source-code">              &lt;/td&gt;</p>
			<p class="source-code">            &lt;/tr&gt;</p>
			<p class="source-code">          &lt;/tbody&gt;</p>
			<p class="source-code">        &lt;/t&gt;</p>
			<p class="source-code"><strong class="bold">        &lt;t t-else=""&gt;</strong></p>
			<p class="source-code">          &lt;div class="alert alert-warning" role="alert"&gt;</p>
			<p class="source-code">            There are no book checkouts.</p>
			<p class="source-code">          &lt;/div&gt;</p>
			<p class="source-code">        &lt;/t&gt;</p>
			<p class="source-code">      &lt;/t&gt;</p>
			<p class="source-code">    &lt;/template&gt;</p>
			<p>The previous code declares the <strong class="source-inline">my_book_checkouts</strong> QWeb template. It starts by calling the portal<a id="_idIndexMarker1110"/> page template, <strong class="source-inline">portal.portal_layout</strong>.</p>
			<p>Then, if there are records to render, it prepares an HTML table from them, calling the <strong class="source-inline">portal.portal_table</strong> template.</p>
			<p>Next, the template adds the table header and body. The table body uses a for-loop on the <strong class="source-inline">checkouts</strong> record set to render each row.</p>
			<p>Noteworthy is the <strong class="source-inline">&lt;a&gt;</strong> link on each record name. When rendering the checkout title, the <strong class="source-inline">t-attf</strong> directive is used to generate the link to open the corresponding detail. The special <strong class="source-inline">slug()</strong> function is used to generate a human-readable identifier for each record.</p>
			<p>The link won't work for now, since the document detail page has not been implemented yet. The next section will do that.</p>
			<h2 id="_idParaDest-390"><a id="_idTextAnchor395"/>Adding a portal document detail page</h2>
			<p>The portal has a home page, from which the user can navigate to document lists, and then open specific documents. A specific book checkout<a id="_idIndexMarker1111"/> can be accessed with the <strong class="source-inline">/my/book-checkout/&lt;id&gt;</strong> path.</p>
			<p>The previous sections implemented the home page and document list features. To complete the portal, the document detail page should be implemented. Continuing with the code from the previous section, two steps are needed:</p>
			<ol>
				<li value="1">Edit the controller file, <strong class="source-inline">controllers/portal.py</strong>, to add the code for the <strong class="source-inline">/my/book-checkout</strong> route, rendering the <strong class="source-inline">book_checkout</strong> template.</li>
				<li>Edit the QWeb template file, <strong class="source-inline">views/portal_templates.py</strong>, to add the <strong class="source-inline">book_checkout</strong> template for the book checkout list page.</li>
			</ol>
			<p>The code for the book checkout page controller is straightforward and brings nothing new. It is the following:</p>
			<p class="source-code">    @route(</p>
			<p class="source-code">        ["/my/book-checkout/</p>
			<p class="source-code">           &lt;model('library.checkout'):doc&gt;"],</p>
			<p class="source-code">        auth="user",</p>
			<p class="source-code">        website=True,</p>
			<p class="source-code">    )</p>
			<p class="source-code">    def portal_my_project(self, doc=None, **kw):</p>
			<p class="source-code">        return request.render(</p>
			<p class="source-code">            "library_portal.book_checkout",</p>
			<p class="source-code">            {"doc": doc},</p>
			<p class="source-code">        )</p>
			<p>The previous code adds a route for the <strong class="source-inline">/my/book-checkout/&lt;id&gt;</strong> path, which translates the <strong class="source-inline">&lt;id&gt;</strong> into a <strong class="source-inline">library.checkout</strong> record. This record is used as a method argument, captured by the <strong class="source-inline">doc</strong> variable name.</p>
			<p>Since the <strong class="source-inline">doc</strong> variable contains<a id="_idIndexMarker1112"/> the checkout record to use, the method only needs to render the QWeb template for it, <strong class="source-inline">library_portal.book_checkout</strong>.</p>
			<p>The code to use for the QWeb template is the following:</p>
			<p class="source-code">    &lt;template id="book_checkout" name="Checkout Form"&gt;</p>
			<p class="source-code">      <strong class="bold">&lt;t t-call="portal.portal_layout"&gt;</strong></p>
			<p class="source-code">        <strong class="bold">&lt;t t-call="portal.portal_record_layout"&gt;</strong></p>
			<p class="source-code">          <strong class="bold">&lt;t t-set="card_header"&gt;</strong></p>
			<p class="source-code">            &lt;div class="row"&gt;</p>
			<p class="source-code">              &lt;div class="col"&gt;</p>
			<p class="source-code">                &lt;h5 class="text-truncate" </p>
			<p class="source-code">                  t-field="doc.name" /&gt;</p>
			<p class="source-code">              &lt;/div&gt;</p>
			<p class="source-code">              &lt;div class="col text-right"&gt;</p>
			<p class="source-code">                &lt;span t-field="doc.stage_id.name"</p>
			<p class="source-code">                      class="badge badge-pill badge-info"</p>
			<p class="source-code">                      title="Current stage"/&gt;</p>
			<p class="source-code">              &lt;/div&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">          &lt;/t&gt;</p>
			<p class="source-code">          <strong class="bold">&lt;t t-set="card_body"&gt;</strong></p>
			<p class="source-code">            <strong class="bold">&lt;!-- Member details --&gt;</strong></p>
			<p class="source-code">            &lt;div class="row"&gt;</p>
			<p class="source-code">              &lt;strong&gt;Member&lt;/strong&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">            &lt;div class="row"&gt;</p>
			<p class="source-code">              &lt;div t-if="doc.member_id.image_1024"</p>
			<p class="source-code">                   class="col flex-grow-0"&gt;</p>
			<p class="source-code">&lt;img class="rounded-circle mt-1 o_portal_contact_img"</p>
			<p class="source-code">  t-att-src="image_data_uri(doc.member_id.image_1024)"</p>
			<p class="source-code">  alt="Contact"/&gt;</p>
			<p class="source-code">              &lt;/div&gt;</p>
			<p class="source-code">              &lt;div class="col pl-sm-0"&gt;</p>
			<p class="source-code">                &lt;address t-field="doc.member_id"</p>
			<p class="source-code">                         t-options='{</p>
			<p class="source-code">                           "widget": "contact",</p>
			<p class="source-code">                           "fields": ["name", "email", </p>
			<p class="source-code">                             "phone"]</p>
			<p class="source-code">                         }' /&gt;</p>
			<p class="source-code">              &lt;/div&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">            <strong class="bold">&lt;!-- Checkout books --&gt;</strong></p>
			<p class="source-code">            &lt;div class="row"&gt;</p>
			<p class="source-code">              &lt;strong&gt;Borrowed books&lt;/strong&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">            &lt;div class="row"&gt;</p>
			<p class="source-code">              &lt;div class="col"&gt;</p>
			<p class="source-code">                &lt;ul&gt;</p>
			<p class="source-code">                  &lt;li t-foreach="doc.line_ids" t-as="line"&gt;</p>
			<p class="source-code">                    &lt;span t-field=</p>
			<p class="source-code">                      "line.book_id.display_name" /&gt;</p>
			<p class="source-code">                  &lt;/li&gt;</p>
			<p class="source-code">                &lt;/ul&gt;</p>
			<p class="source-code">              &lt;/div&gt;</p>
			<p class="source-code">            &lt;/div&gt;</p>
			<p class="source-code">          &lt;/t&gt;</p>
			<p class="source-code">        &lt;/t&gt;</p>
			<p class="source-code">      &lt;/t&gt;</p>
			<p class="source-code">    &lt;/template&gt;</p>
			<p>The previous code<a id="_idIndexMarker1113"/> created the <strong class="source-inline">book_checkout</strong> QWeb template. Again, it starts by calling the portal page template, <strong class="source-inline">portal.portal_layout</strong>.</p>
			<p>Then, the document details template, <strong class="source-inline">portal.portal_record_layout</strong>, is called to prepare the detail<a id="_idIndexMarker1114"/> content. It uses the following two QWeb variables, which should be set:</p>
			<ul>
				<li><strong class="source-inline">card_header</strong> sets the HTML to use for the header.</li>
				<li><strong class="source-inline">card_body</strong> sets the HTML to use for the document details.</li>
			</ul>
			<p>This HTML adds rows with the content. Two particular elements are noteworthy: </p>
			<ul>
				<li>The <strong class="source-inline">&lt;img&gt;</strong> element, adding an image from a data field</li>
				<li>The <strong class="source-inline">&lt;address&gt;</strong> element, rendering an address for a partner record</li>
			</ul>
			<p>The current implementation is missing a nice usability feature, the <strong class="bold">breadcrumb</strong> allowing users to navigate back through the links to the portal main page. The next section shows how to add this.</p>
			<h2 id="_idParaDest-391"><a id="_idTextAnchor396"/>Adding a portal breadcrumb</h2>
			<p>Portal pages support a breadcrumb, on the top region of the page. By default, a home icon is available, allowing users to quickly navigate back to the <a id="_idIndexMarker1115"/>main page. As the user navigates to the document list, and then to a particular document, these selections can be added to the breadcrumb.</p>
			<p>The Odoo portal breadcrumb is added by the <strong class="source-inline">portal.portal_breadcrumbs </strong>template. It should be extended to add the specific navigation steps for particular document types.</p>
			<p>To have the book checkout breadcrumb, edit the <strong class="source-inline">views/portal_templates.py</strong> file to add the following template:</p>
			<p class="source-code">    &lt;template id="portal_layout"</p>
			<p class="source-code">              name="Portal breadcrumb: book checkout"</p>
			<p class="source-code">              <strong class="bold">inherit_id="portal.portal_breadcrumbs"</strong>&gt;</p>
			<p class="source-code">      <strong class="bold">&lt;xpath expr="//ol[hasclass('o_portal_submenu')]"</strong></p>
			<p class="source-code">             position="inside"&gt;</p>
			<p class="source-code">        <strong class="bold">&lt;li t-if="page_name == 'book-checkouts' or doc"</strong></p>
			<p class="source-code">            class="col-lg-2"</p>
			<p class="source-code">            t-attf-class="breadcrumb-item</p>
			<p class="source-code">                         #{'active ' if not doc else ''}"&gt;</p>
			<p class="source-code">          &lt;a t-if="doc"</p>
			<p class="source-code">             t-attf-href="/my/book-checkouts?{{ </p>
			<p class="source-code">               keep_query() }}"&gt;</p>
			<p class="source-code">             Checkouts</p>
			<p class="source-code">           &lt;/a&gt;</p>
			<p class="source-code">           &lt;t t-else=""&gt;Checkouts&lt;/t&gt;</p>
			<p class="source-code">        &lt;/li&gt;</p>
			<p class="source-code">        <strong class="bold">&lt;li t-if="doc" class="breadcrumb-item</strong> </p>
			<p class="source-code">          active text-truncate</p>
			<p class="source-code">                              col-8 col-lg-10"&gt;</p>
			<p class="source-code">          &lt;t t-esc="doc.name"/&gt;</p>
			<p class="source-code">        &lt;/li&gt;</p>
			<p class="source-code">      &lt;/xpath&gt;</p>
			<p class="source-code">    &lt;/template&gt;</p>
			<p>The template in the previous code extends the <strong class="source-inline">portal.portal_breadcrumbs </strong>template. It extends the <strong class="source-inline">&lt;ol&gt;</strong> element with the <strong class="source-inline">o_portal_submenu</strong> class, adding breadcrumb <strong class="source-inline">&lt;li&gt;</strong> elements to it.</p>
			<p>The extension adds two possible elements: one for the <strong class="bold">Checkouts</strong> document list, and another for a particular book checkout. The breadcrumb is included in all portal pages, and these added elements<a id="_idIndexMarker1116"/> should be conditionally rendered, only if they make sense for the current page.</p>
			<p>The previous sections guided you through the various steps needed to add new features to the Odoo portal, enabling external users to interact with Odoo.</p>
			<h1 id="_idParaDest-392"><a id="_idTextAnchor397"/>Summary</h1>
			<p>Frontend web pages allow Odoo to also provide features to external users. This can be used to display generic information to the public, or give personalized information to portal users. The frontend web features are the foundation of the Odoo CMS, provided by the <em class="italic">Website</em> app, and for frontend features such as e-commerce.</p>
			<p>In this chapter, you understood the technical components that are at the core of frontend web features, web controllers, and QWeb templates. Web controllers implement routes, triggered when accessing certain URL paths called routes, and running any specific business logic needed. QWeb templates receive data prepared by the web controller and render HTML output with the help of the QWeb templating engine.</p>
			<p>You now know how to use these components to implement a public web page integrated with the Odoo frontend, including the usage of your own web assets. You also know how to leverage the essentials of the Odoo portal to provide self-service features to your external users.</p>
			<p>This chapter completes your journey through the various components in the Odoo framework. The models are the central element around which other components are built up. The Odoo base module provides a few essential models developers should be familiar with. The next chapter takes on the task of providing an overview of these.</p>
			<h1 id="_idParaDest-393"><a id="_idTextAnchor398"/>Further reading</h1>
			<p>These are additional reference materials that complement the topics discussed in this chapter, found in the official Odoo documentation:</p>
			<ul>
				<li>Web controllers: <a href="https://www.odoo.com/documentation/15.0/developer/reference/backend/http.html">https://www.odoo.com/documentation/15.0/developer/reference/backend/http.html</a></li>
				<li>QWeb language: <a href="https://www.odoo.com/documentation/15.0/developer/reference/frontend/qweb.html">https://www.odoo.com/documentation/15.0/developer/reference/frontend/qweb.html</a></li>
				<li>JavaScript API reference: <a href="https://www.odoo.com/documentation/15.0/developer/reference/frontend/javascript_reference.html">https://www.odoo.com/documentation/15.0/developer/reference/frontend/javascript_reference.html</a></li>
				<li>Bootstrap documentation: <a href="https://getbootstrap.com/docs/4.1/getting-started/introduction">https://getbootstrap.com/docs/4.1/getting-started/introduction</a></li>
			</ul>
			<p>Additional Bootstrap learning resources can be found on the Packt Publishing technical page: <a href="https://www.packtpub.com/tech/Bootstrap">https://www.packtpub.com/tech/Bootstrap</a>.</p>
		</div>
	</div></body></html>