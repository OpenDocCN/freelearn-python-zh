<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Real-time Physical Computing Systems Using BeagleBone"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Real-time Physical Computing Systems Using BeagleBone</h1></div></div></div><p>In this chapter we will be focusing on<a id="id197" class="indexterm"/> building a real-time physical computing system using BeagleBone board. We will be interfacing an LM35 temperature sensor module with BeagleBone Black in this chapter in order to understand how a sensor can be interfaced with BeagleBone board to make the system interact with the physical world. We will be getting ambient temperature as analog input readings from the physical world around the sensor, and coding the BeagleBone board to make the LEDs connected to the BeagleBone board to light it up in different colors, depending on the temperature levels measured by the sensor. So, by end of this chapter, you will have built an interactive physical computing system using BeagleBone board where it outputs LED indications based on the temperature measured. The contents of the chapter are divided into the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Prerequisites</li><li class="listitem" style="list-style-type: disc">Temperature sensor – LM35</li><li class="listitem" style="list-style-type: disc">Interfacing the temperature sensor to BeagleBone board</li><li class="listitem" style="list-style-type: disc">Simple project: Bicolor LED indicator that changes its color depending on the room temperature measured by temperature sensor</li></ul></div><div class="section" title="Prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Prerequisites</h1></div></div></div><p>This topic <a id="id198" class="indexterm"/>will cover what parts you need to get started with this chapter. These can be purchased from your favorite electrical hobby store, or<a id="id199" class="indexterm"/> can simply be ordered online.</p><div class="section" title="Materials needed"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec09"/>Materials needed</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">1x BeagleBone Black</li><li class="listitem" style="list-style-type: disc">1x microSD card with the latest version of Debian flashed on it to boot the BeagleBone board from the microSD card</li><li class="listitem" style="list-style-type: disc">1x 5V DC, 2A power supply</li><li class="listitem" style="list-style-type: disc">1x Ethernet cable</li><li class="listitem" style="list-style-type: disc">1x LM35 <a id="id200" class="indexterm"/>temperature sensor</li><li class="listitem" style="list-style-type: disc">1x two-legged bicolor LED</li><li class="listitem" style="list-style-type: disc">1x 220 ohm resistor</li><li class="listitem" style="list-style-type: disc">1x BreadBoard</li><li class="listitem" style="list-style-type: disc">A few male-to-male jumper wires</li><li class="listitem" style="list-style-type: disc">1x multi-meter (optional)</li></ul></div></div></div></div>
<div class="section" title="Temperature sensor"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Temperature sensor</h1></div></div></div><p>A<a id="id201" class="indexterm"/> temperature sensor is just an electronic chip that senses the ambient temperature around it and gives out varying voltage across the output terminal of the sensor. By using this, we can calculate the temperature that's being sensed. There are many different types of sensors available in the market, but we will be using the one that is the most easily available, and most commonly used by the hobbyist. This is the LM35 temperature sensor module, which is an analog output sensor, where the voltage can be directly converted to temperature values, based on the formula given by the manufacturer of the sensor, as mentioned in the datasheet of the sensor:</p><div class="mediaobject"><img src="graphics/4602_04_01.jpg" alt="Temperature sensor"/></div><div class="section" title="How do LM35 sensors work?"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec10"/>How do LM35 sensors work?</h2></div></div></div><p>The<a id="id202" class="indexterm"/> basic principle behind the LM35 temperature sensor is that it converts<a id="id203" class="indexterm"/> the ambient temperature around the sensor to analog voltage proportionally.</p><p>In the following picture, you can see the pin terminals of the <span class="strong"><strong>LM35</strong></span> temperature sensor where one terminal is the input, which gets supply input voltage, and the others are the output and the ground.</p><div class="mediaobject"><img src="graphics/4602_04_02.jpg" alt="How do LM35 sensors work?"/></div><p>So, once you connect the power supply input to the temperature sensor with the ground, the analog voltage output that can be measured across the analog voltage out terminal, with respect to the ground, is as shown in the graph above. </p><p>For example, say the voltage measured across the output terminal and ground is 1 Volt, the ambient temperature in degrees Celsius is 100, which we can infer using the curve shown in the graph above.</p><p>And, from the datasheet of the LM35, we can infer that every 10mV is proportional to 1 degree Celsius. So we can use the formula given below to calculate the temperature in degree Celsius, if we know the analog output voltage in mV.</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>Temp in °C = (Vout in mV)°/ 10</em></span>
</p></blockquote></div><p>To validate the temperature sensing and to test whether the sensor is working properly before moving on to the next topic of interfacing the sensor with BeagleBone board, you can use a multi-meter to measure the voltage across the output terminal while providing an external power supply to the LM35 temperature with common ground pin. Depending on the voltage measured, you can calculate the temperature using the previous formula. You <a id="id204" class="indexterm"/>can put hot or cold objects near to the sensor or hold them over it to see the voltage difference.</p></div></div>
<div class="section" title="Temperature sensing using a LM35 sensor"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Temperature sensing using a LM35 sensor</h1></div></div></div><p>Now<a id="id205" class="indexterm"/> that we know how an LM35 temperature sensor works, let's go ahead and look at the topic of measuring temperature with it by hooking it up to the BeagleBone board.</p><p>First of all, take three berg wires and connect the LM35 temperature sensor to the BeagleBone board, as per the circuit diagram shown in the following image:</p><div class="mediaobject"><img src="graphics/4602_04_03.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Then we will turn on the BeagleBone board, and then login into the Linux Shell to start coding it. We will access the <code class="literal">WorkSpace</code> folder where we are saving all the Python scripts that we've already created in the previous chapter. By now you should be familiar with how to<a id="id206" class="indexterm"/> navigate to the <code class="literal">WorkSpace</code> directory.</p><p>To do this, type command <code class="literal">cd WorkSpace</code>:</p><div class="mediaobject"><img src="graphics/4602_04_04.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Once you are in the <code class="literal">WorkSpace</code> directory, and before writing the script to read temperature data, lets test it out via the Python console, which you should also be familiar with by now.</p><p>Type the command to start the Python interactive programming shell, <code class="literal">sudo python</code>:</p><div class="mediaobject"><img src="graphics/4602_04_05.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Once we are inside the Python interactive shell, let us import the Adafruit GPIO library to read ADC inputs on the BeagleBone board, by typing <code class="literal">import Adafruit_BBIO.ADC as ADC</code>:</p><div class="mediaobject"><img src="graphics/4602_04_06.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Next we need to initialize the ADC, by typing the following command: <code class="literal">ADC.setup()</code>
</p><div class="mediaobject"><img src="graphics/4602_04_07.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>To read the ADC reading on port <code class="literal">P9_40</code>, to which we have connected the output of the temperature sensor, use the following command:</p><div class="informalexample"><pre class="programlisting">ADC.read("P9_40")</pre></div><p>The ADC <a id="id207" class="indexterm"/>ports available on the BeagleBone board are 12 bits, which equals <span class="emphasis"><em>2¹² = 4096</em></span> units maximum, and the maximum voltage that can be given to these analog pins is 1.8 V. This means that the voltage input of these pins, varying from 0 to 1.8V, is proportional to 0 to 4096 ADC units, but in Python the Adafruit library gives us a reading between 0 to 1, which is proportional to 0 to 1.8V. The output of the ADC reading of the port <code class="literal">P9_40</code> using ADC read function is shown as follow:</p><div class="mediaobject"><img src="graphics/4602_04_08.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>So you can see that the ADC reading on port <code class="literal">P9_40</code> is <code class="literal">0.19445</code>.</p><p>Now let's go ahead and save it on a variable to calculate how many volts it is. Let's create a variable <code class="literal">reading</code> and store the measured ADC reading as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_04_09.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Then, let's go ahead and convert the ADC reading into millivolts (mV). We know that the ADC is capable of reading 0 to 1.8V which is proportional to 0 to 1 unit of the ADC reading in Python, in other words 1.8 V = 1800 mV.</p><p>
<span class="emphasis"><em>Millivolts measured = (ADC Reading) * 1800</em></span>
</p><p>
<span class="emphasis"><em>Voltage Measured = (ADC Reading) * 1.8 </em></span>
</p><p>That is to say, in our case, on the Python console you can create a variable named <code class="literal">millivolts</code> which will hold the voltage measured across the sensor output pin, with respect to the ground pin, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_04_10.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>As <a id="id208" class="indexterm"/>shown in the preceding screenshot, you will get the value of the voltage across the sensor output voltage pin in millivolts. Now, we can go ahead and convert the millivolts measured to temperature into degrees Celsius using the formula we obtained using the information from the datasheet at the beginning of this topic. This is shown in the following screenshot by creating a variable <code class="literal">temp_c</code> that holds the temperature in degrees Celsius:</p><div class="mediaobject"><img src="graphics/4602_04_11.jpg" alt="Temperature sensing using a LM35 sensor"/></div><div class="mediaobject"><img src="graphics/4602_04_12.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>If we print the <code class="literal">temp_c</code> value we will get the output as shown in the preceding output.</p><p>Now, let's go ahead and write a Python program that will print the temperature sensor values every second.</p><p>Create the Python script file, <code class="literal">sudo nano TestLM35.py</code>:</p><div class="mediaobject"><img src="graphics/4602_04_13.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Type in the code as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_04_14.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Once<a id="id209" class="indexterm"/> you have typed in the code, you can go ahead and save it using the <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span> command.</p><p>When you run the program you should see the output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_04_15.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>So, in the preceding screenshot you can see that the ambient temperature around the sensor in degrees Celsius is printed every second. If you have come this far successfully, then you have successfully interfaced the LM35 temperature sensor with the BeagleBone board and Python. As a further step in this interfacing and testing of the LM35 with BeagleBone board, let's see whether or not the LM35 interfaced with the BeagleBone board is detecting any rise in the temperature by placing a lit matchstick near the sensor.</p><p>Place a lit matchstick near to the sensor as shown in the following picture:</p><div class="mediaobject"><img src="graphics/4602_04_16.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>You can <a id="id210" class="indexterm"/>see that the temperature readings rise up when you bring the lit matchstick near to the temperature sensor, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_04_17.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>When you remove the matchstick from the sensor, it comes back down again as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_04_18.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>So, now<a id="id211" class="indexterm"/> that we know how to interface the LM35 temperature sensor with the BeagleBone board and read the temperature sensor readings, in the next topic of this chapter, which is our main project, let's build a real-time physical computing system using Python programming, by adding a bicolor LED to the BeagleBone board.</p><p>Intermediate project: LED color change based on measured temperature:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect the circuit as shown in the following picture:<div class="mediaobject"><img src="graphics/4602_04_19.jpg" alt="Temperature sensing using a LM35 sensor"/><div class="caption"/></div></li><li class="listitem">Write <a id="id212" class="indexterm"/>down the Python script.<p>As we already know how to interface a temperature sensor with the BeagleBone board and how to switch a GPIO on and off, to light an LED using Python, now we are going to combine both these previous experiments. Let's write a Python script to make the GPIO high or low based on the temperature value measured by the temperature sensor. Write down the code by changing the <code class="literal">TestLM35.py</code> file, as shown in the following screenshot, and save it with the different name <code class="literal">LM35nLED.py</code>:</p><div class="mediaobject"><img src="graphics/4602_04_20.jpg" alt="Temperature sensing using a LM35 sensor"/></div></li><li class="listitem">Now, when<a id="id213" class="indexterm"/> you run the code with the command, <code class="literal">sudo python LM35nLED.py</code> you should see the following:<div class="mediaobject"><img src="graphics/4602_04_21.jpg" alt="Temperature sensing using a LM35 sensor"/></div></li></ol></div><p>Your setup should be like the one shown in the following screenshot in a room with an ambient temperature of less than 50 degrees Celsius:</p><div class="mediaobject"><img src="graphics/4602_04_22.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>The output <a id="id214" class="indexterm"/>for the Python program when you execute it will be as follows:</p><div class="mediaobject"><img src="graphics/4602_04_23.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>When you light a matchstick and hold it in front of the sensor, the output will be as follows:</p><div class="mediaobject"><img src="graphics/4602_04_24.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>And the LED will go to red as shown in the following picture:</p><div class="mediaobject"><img src="graphics/4602_04_25.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>When <a id="id215" class="indexterm"/>you remove the matchstick from the sensor, it will change back to green.</p><div class="mediaobject"><img src="graphics/4602_04_26.jpg" alt="Temperature sensing using a LM35 sensor"/></div><p>Now we have a system that takes input (ambient temperature around the sensor) from the physical world, and based on that input changes something in the environment such as the LED color, with the information of the temperature getting printed out on the Linux shell. This brings us to the end of this chapter where we have built a basic physical computing system using BeagleBone Black.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Summary</h1></div></div></div><p>In this chapter we have learnt about temperature sensors and how they can be interfaced with the BeagleBone board to obtain temperature measurements by connecting the sensor to analog input reading pins on the BeagleBone board. Then we wrote a code to make decisions based on the input obtained from the LM35 temperature sensor where the decision was to turn on a particular GPIO pin that is connected to a bicolor LED in order to change the color of the LED based on the ambient temperature around the sensor. So, in this way we have a real-time physical computing system up and running on BeagleBone Black using Python to get started. But this is just local computing where decisions are made based on the program running on the local system and all the data is in the local system itself.</p><p>Now in the next chapter, we will go ahead and build a more advanced real-time physical computing system, that is connected to the Internet, and on which the sensor data is sent to cloud server from the BeagleBone board that is connected to the Internet.</p></div></body></html>