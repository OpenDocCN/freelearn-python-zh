<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis">
<head>
  <meta charset="UTF-8"/>
  <title>Generators, Coroutines, and Parallel Processing</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css"/>
  <link type="text/css" rel="stylesheet" media="all" href="core.css"/>
</head>
<body>
  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Generators, Coroutines, and Parallel Processing</h1>
                </header>
            
            <article>
                
<p><span>In this chapter, we will take a look at generators, coroutines, and parallel processing. Specifically, we will cover the following topics:</span></p>
<ul>
<li>How iteration works in Python</li>
<li>Using the itertools module</li>
<li>Using generator functions</li>
<li>Simulating multithreading with coroutines</li>
<li>When to use parallel processing</li>
<li>Forking processes</li>
<li>How to implement multithreading</li>
<li>How to implement multiprocessing</li>
</ul>
<p>Although the various topics that will be covered in this chapter may seem to have little to do with each other, they do have an effect on one another. First, iteration is the process of walking through&#160;a sequence; Python provides several ways to iterate over objects. Generators are functions that generate values in a sequential order, implementing iteration functionality under the hood.</p>
<p>This moves into parallelism. Coroutines use generators to effectively create multiple processes to allow multitasking but it is controlled by the programmer. Multithreading switches processing based on when the operating system decides, not the programmer; this allows for concurrency. Multiprocessing utilizes multiple CPUs to allow true parallelism.</p>
<p>Without further ado, let's get started on our journey.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How iteration works in Python</h1>
                </header>
            
            <article>
                
<p>In Python, an iterator is an object that represents a stream of data. While iterators are available for containers, sequences in particular always support iteration.</p>
<p>Iterators have the <kbd>__next__()</kbd> method available (or the built-in <kbd>next()</kbd> function). Calling <kbd>next()</kbd> multiple times returns successive items from the data stream. When no more items are available, a <kbd>StopIteration</kbd> exception is thrown.</p>
<p>Any class can use an iterator by defining a <kbd>container.__iter__()</kbd> method. This method returns an iterator object, typically just <kbd>self</kbd>. This object is necessary to support the iterator protocol. Different types of iteration can be supported, with each one providing a specific iterator request. For example, a tree structure could support both breadth-first and depth-first traversals.</p>
<p>The iterator protocol mentioned previously actually comprises two methods: <kbd>iterator.__next__()</kbd> and <kbd>iterator.__iter__()</kbd>. (Notice that <kbd>__iter__()</kbd> has a different class compared to the one above.)</p>
<p>As we have already talked about <kbd>__next__()</kbd>, a short discussion of <kbd>__iter__()</kbd> is necessary. The <kbd>__iter__()</kbd> method returns the iterator object itself; this allows containers and iterators to be used with <kbd>for</kbd> and <kbd>in</kbd> statements.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>The most common use of an interator is to loop through a sequence, printing out each element:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/3acd45af-2b51-49f1-9627-3dc09db1a463.png" style="width:37.67em;height:33.50em;"/>&#160;</div>
<ul>
<li>
<ul>
<li>In the preceding example, we have simply iterated through a variety of sequence containers, specifically a list (<em>line 1</em>), a tuple (<em>line 2</em>), dictionary keys (<em>line 3</em>), characters in a string (<em>line 4</em>), and lines in a file (<em>line 5</em>).</li>
<li>While a dictionary is not a sequence type but a mapping type, it does support iteration, as it has an <kbd>iter()</kbd> call that is only applicable to a dictionary's keys.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>When a <kbd>for</kbd> statement is used, it calls the built-in <kbd>iter()</kbd> function on the container. The <kbd>iter()</kbd> function returns an iterator object that defines the <kbd>__next__()</kbd> method to access each element within the container, sequentially. When the container is empty, the <kbd>StopIteration</kbd> exception is raised and the iteration process exits.</li>
<li>The <kbd>__next__()</kbd> method can be manually called, if desired, as follows:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/d9e283cd-f976-499b-8486-d7562c8b0b64.png" style="width:38.50em;height:25.08em;"/>&#160;</div>
<ul>
<li>
<ul>
<li>The <em>line 8</em> creates a string of three characters.</li>
<li><span>The&#160;</span><em>line 9</em> manually creates an iterator object of the string.</li>
<li>The <em>line 10</em> shows the iterator object's location in memory. It also shows what type of iterator it is, that is, a string iterator.</li>
<li>The <em>line 11</em>-<em>line 13</em> manually call the <kbd>__next__()</kbd> method, which is available via the iterator object.</li>
<li>The <em>line 14</em> attempts to call the next character in the string, but since the string is empty at this point, an exception is raised, terminating the iteration process.</li>
</ul>
</li>
</ul>
<ol start="4">
<li>Modifying the iteration process is relatively easy:</li>
</ol>
<ul>
<li>
<ul>
<li>Create a class object</li>
<li>Define an <kbd>__iter__()</kbd> method that returns an object that is capable of using the <kbd>__next__()</kbd> method, typically <kbd>self</kbd> if the class defines the <kbd>__next__()</kbd> within itself. <kbd>reverse_seq.py</kbd> shows an example of this:</li>
</ul>
</li>
</ul>
<pre>        class Reverse_Seq:<br/>            def __init__(self, data_in):<br/>                self.data = data_in<br/>                self.index = len(data_in) # Go to last element<br/>            def __iter__(self):<br/>                return self  # Needed to use __next__()<br/>            def __next__(self):<br/>                if self.index == 0: # No more elements<br/>                    raise StopIteration  # Manually stop the iterator<br/>                self.index = self.index - 1  # Go to previous element in sequence<br/>                return self.data[self.index] # Return element at index</pre>
<p style="padding-left: 60px">The following screenshot shows how the preceding code block deals with data input:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/2ad6a306-6cf1-4183-814d-e03421f9649e.png" style="width:24.58em;height:25.92em;"/></div>
<ul>
<li>
<ul>
<li>The example code creates a class designed to reverse-iterate through a supplied sequence. The input data can be any sequence object. The class defines the initial index value as the last item within the supplied sequence.</li>
<li>The <em>line 23</em> creates an instance of the class, with a string sequence argument provided.</li>
<li>The <em>line 24</em> simply shows the instance in memory.</li>
<li>The&#160;l<em>ine 25</em> calls the iteration process, moving backward through the supplied sequence, starting from the end.</li>
<li>The <em>line 26</em> creates another type of sequence, a list.</li>
<li>The list is passed into a new instance in <em>line 27</em>.</li>
<li>Like <em>line 25</em>, we work backward through the list in <em>line 28</em>. This demonstrates that any sequence object can be iterated through in reverse using this class.</li>
</ul>
</li>
</ul>
<ol start="5">
<li>For a more detailed exploration of iterators, we will walk through the iteration process, manually calling <kbd>next()</kbd> for each item in the sequence:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/f497abbe-d901-44e1-8779-ed041f0143cd.png" style="width:31.17em;height:26.00em;"/></div>
<ul>
<li>
<ul>
<li>In <em>line 31</em>, this time we are passing a tuple object directly into the instance argument.</li>
<li>In <em>lines 32</em>-<em>36</em>, we manually pull the next element from the tuple.</li>
<li>The <em>line 37</em> is the error given when there are no more elements to process.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the itertools module</h1>
                </header>
            
            <article>
                
<p>Beyond just the standard iteration protocol, Python also provides the <kbd>itertools</kbd> module. This module provides a number of iterator building blocks that, used singly or in combination, can create specialized iteration tools for efficient looping.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>There are three main categories of <kbd>itertools</kbd>: infinite iterators, combinatoric iterators, and iterators that terminate on the shortest input sequence.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Infinite iterators</h1>
                </header>
            
            <article>
                
<p>Infinite iterators return values repeatedly until a terminating condition is reached:</p>
<ol class="enumerate">
<li>
<p>The&#160;<kbd>count(start=0, step=1)</kbd>&#160;function returns evenly spaced values that start at the <kbd>start</kbd> argument provided. Stepping is provided to allow skipping values. This function is frequently used with <kbd>map()</kbd> to generate consecutive data points. When used with <kbd>zip()</kbd>, it can be used to add sequence numbers:</p>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/391ebcff-8bff-4390-89a1-2b70bdc17138.png" style="width:31.67em;height:17.58em;"/></div>
<ul>
<li>
<ul>
<li>In this example, we import the <kbd>count()</kbd> function from the <kbd>itertools</kbd> module in <em>line 54</em>.</li>
<li>In <em>line 55</em>, we create a counting loop, starting with the integer <kbd>5</kbd> and a stepping value of <kbd>5</kbd>, that is, counting by fives. When the count exceeds <kbd>50</kbd>, the loop quits.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>The&#160;<kbd>cycle(iterable)</kbd>&#160;function&#160;<span>returns elements from an iterable and saves a copy of each one. When the sequence is completed, the saved copies are returned; this repeats forever:</span></li>
</ol>
<div style="color: black" class="CDPAlignCenter CDPAlign"><img src="images/6495f940-bf35-4670-b576-852b1eca884d.png" style="width:38.42em;height:23.83em;"/></div>
<ul>
<li>
<ul>
<li>After importing the <kbd>cycle()</kbd> function, we create a counter variable. This is because <kbd>cycle()</kbd> will continue indefinitely if an outside condition doesn't stop it.</li>
<li>The loop will repeatedly print the string <kbd>123</kbd>&#160;until the break condition is met, in this case, after 10 characters have been printed to the screen.</li>
</ul>
</li>
</ul>
<ol start="3">
<li>The&#160;<kbd>repeat(object, [, times])</kbd>&#160;function returns <kbd>object</kbd> indefinitely unless a value is supplied for <kbd>times</kbd>. While it may not seem to have an obvious use, <kbd>repeat()</kbd> is used with the <kbd>map()</kbd> function to map unchanging parameters to the called function, as well as with <kbd>zip()</kbd> to create a constant part of a tuple record.</li>
</ol>
<p style="color: black;padding-left: 90px" class="standard">One benefit to the <kbd>repeat()</kbd> iterator is that the single object that is repeated is the only memory space allocated. If you want to repeat an object normally, that is,&#160;<em>x * n</em>, multiple copies of <em>x</em> are placed into memory:</p>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/e894eeba-518c-4c59-bce0-a02a9cb112de.png" style="width:37.42em;height:24.92em;"/></div>
<ul>
<li>
<ul>
<li>After we import the <kbd>repeat()</kbd> class, we run the command in <em>line 2</em>.</li>
<li>As the return object is an iterator, calling the <kbd>repeat()</kbd> command directly (<em>lines 2</em> and <em>3</em>) doesn't do anything besides returning the object itself.</li>
<li>We have to make an instance (<em>line 4</em>) before we can do anything with the iterator.</li>
<li>Calling the instance directly (<em>line 5</em>) again only gives us the <kbd>repeat()</kbd> object.</li>
<li>Walking through the instance using iteration (<em>line 6</em>) displays the actual repetition process.</li>
<li>The <em>line 7</em> gives an example of using <kbd>repeat()</kbd> with <kbd>map()</kbd> to provide a steady stream of values to <kbd>map()</kbd>. In this case, the line creates a list of squared values by mapping the <kbd>pow()</kbd> function to a range of 10 repeated integers.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Combinatoric iterators</h1>
                </header>
            
            <article>
                
<p>Combinatoric iterators are concerned with the enumeration, combination, and permutation of element sets:</p>
<ol>
<li>The <kbd>product(*iterables, repeat=1)</kbd> iterator produces a Cartesian product from the inputted iterable objects; it is essentially the same as using nested <kbd>for</kbd> loops in a generator. The nested loops cycle through the input iterables, with the rightmost element incrementing every iteration. The pattern returned is dependent upon the input; that is, if the input iterables are sorted, the output product tuples will be sorted as well.</li>
</ol>
<p style="color: black;padding-left: 60px" class="standard">It is important to point out that Cartesian products are not mathematical products; that is, they aren't the result of multiplication. They are actually part of analytic geometry and are all the possible ordered combinations of numbers from each input set. In other words, if a line is defined by two different points, each with an <em>x, y</em> value, the product set would be all the possible ordered pairs from those two sets, with the first value coming from the first set and the second value coming from the second set. The following example shows the Cartesian products created from a set of three points:</p>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/9288935b-aac0-42dd-a247-7ae92b086c82.png" style="width:37.00em;height:18.83em;"/></div>
<ul>
<li>
<ul>
<li>The&#160; <kbd>product()</kbd>&#160;function is imported into the program in <em>line 18</em>.</li>
<li>The <em>line 19</em> creates a list of three sets, such as representing a line in a three-dimensional box.</li>
<li>In <em>line 20</em>, the iterator from <kbd>product()</kbd> is assigned to a variable. In this case, the final object is a tuple to collect the final sets.</li>
<li>The <em>line 21</em> shows the product sets that were created from the three input sets. All possible combinations of input values have been produced.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>The <kbd>permutations(iterable, r=None)</kbd>&#160;function returns successive <kbd>r</kbd> length permutations of the elements provided in the <kbd>iterable</kbd> argument. If <kbd>r</kbd> is not provided, then the full length of the provided argument is iterated through, with all possible permutations provided. Elements are considered unique to their position, not their value, so there will be no repeated values in the returned permutations if the input elements are unique:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/ac7bd07d-75a3-46db-81a9-de5cd0bda548.png" style="width:37.75em;height:25.08em;"/></div>
<ul>
<li>
<ul>
<li>After importation, a short string is created and passed into the <kbd>permutations()</kbd> function (<em>line 28</em>).</li>
<li>The results of printing the permutations are provided as tuples.</li>
<li>To have the items in the tuples returned in a more normal fashion, the <kbd>join()</kbd> function can be used (<em>line 29</em>).</li>
</ul>
</li>
</ul>
<ol start="3">
<li>The&#160; <kbd>combinations_with_replacement(iterable, r)</kbd>&#160;function&#160;<span>returns</span> <kbd>r</kbd> <span>length subsets of the elements from</span> <kbd>iterable</kbd><span>; this allows the elements to be repeated, unlike the normal</span> <kbd>combinations()</kbd><span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/3b43c128-a4d9-4e83-a569-aee5c63c561b.png" style="width:37.58em;height:14.83em;"/></div>
<ul>
<li>
<ul>
<li>In this example, we have limited the returned values to only two elements of the input string from <em>line 27</em> of the previous example.</li>
<li><span>Because elements can repeat, if we set</span> <kbd>r=3</kbd><span>, we get the results in <em>line 34</em>. When compared to <em>line 28</em>, not only are there more results, but the elements are duplicated; sometimes this is desired, but usually it is not.</span></li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Terminating iterators</h1>
                </header>
            
            <article>
                
<p>Terminating iterators return values until the shortest input sequence has been iterated through, then it terminates:</p>
<ol>
<li>The <kbd>accumulate(iterable[, func])</kbd>&#160;function returns an iterator of accumulated sums, or the results of other binary functions, as determined by the value provided to the <kbd>func</kbd> argument. If <kbd>func</kbd> is provided, it should be a function of two arguments. The <kbd>iterable</kbd> elements can be any type that can be used by <kbd>func</kbd> as arguments. The default function is <kbd>addition</kbd>. The following example shows this default functionality:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/dfe379ed-91f4-4117-b89a-4dba0072c5df.png" style="width:37.00em;height:8.83em;"/></div>
<p style="padding-left: 90px" class="mce-root">As the default function is addition, using <kbd>accumulate</kbd> to add a range of five&#160;numbers returns the sum of each addition process. The sum of the previous addition is one of the input values to the next addition calculation. Thus, in the output of <em>line 37</em>, it is seen that <em>0 + 0 = 0, 0 + 1 = 1, 1 + 2 = 3, 3 + 3 = 6, 6 + 4 = 10</em>.</p>
<p style="padding-left: 90px" class="standard">The <kbd>func</kbd> argument has a variety of uses. It can be set to <kbd>min()</kbd> to track the minimum value during the iteration, <kbd>max()</kbd> to track the maximum value, or <kbd>operator.mul()</kbd> to track the multiplication product, as demonstrated in the following example:</p>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/17e99a24-b650-4363-9242-c333d852554d.png" style="width:36.25em;height:13.42em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 34</em> shows the minimum value that is processed during the iteration process. In this case, since the iterable argument is a <kbd>range()</kbd>, the lowest value will be zero.</li>
<li>If we switch to tracking the maximum running value (<em>line 35</em>), the results show that each addition shows the next value to be added.</li>
<li>The <em>line 36</em> imports <kbd>operator</kbd>, which is then used in <em>line 37</em> to multiply each subsequent value in a given range. Note that the range has to start at one, otherwise all the results will be zero because each value will be multiplied against the initial starting zero value in the range.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>One use of <kbd>accumulate()</kbd> is in debt management; amortization tables can be created by accumulating the interest and accounting for payments:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/80fd4c31-086e-41a6-8e59-b1615896668e.png"/></div>
<ul>
<li>
<ul>
<li>The <em>line 38</em> shows an initial loan of $1,000, then four payments of $120.</li>
<li>The <em>line 39</em> uses a lambda function to return the current balance, with each value in the <kbd>money</kbd> list used as the payment and the previous balance as the input balance value. The value of <kbd>1.05</kbd> equals an interest rate of 5%.</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Another use of <kbd>accumulate()</kbd> is in recurrence relations. A recurrence relation is an equation that recursively defines a sequence or multidimensional array when one or more initial items are given; subsequent items of the sequence are defined as a function of the preceding terms.</li>
</ol>
<p style="padding-left: 60px" class="mce-root">In the following example, a recurrence relation is created after an initial value is supplied for the iterable and the accumulated total is passed into the <kbd>func</kbd> argument. This particular example applies to logistic mapping (this is how chaotic behavior develops from simple, non-linear dynamical equations) and comes from <a href="https://docs.python.org/3.6/library/itertools.html#itertools.accumulate">https://docs.python.org/3.6/library/itertools.html#itertools.accumulate</a>:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/a90eef80-6f70-4c9c-ae53-3a58ae7b1ccd.png" style="width:35.83em;height:41.50em;"/></div>
<ul>
<li>
<ul>
<li>As this book isn't designed to discuss such topics as chaotic recurrence relations, I won't delve into how this code actually works. However, I will note that <em>line 40</em> shows a lambda function that only has a single input argument, <kbd>x</kbd>. The other value is ignored, as <kbd>r</kbd> is taken from the subsequently assigned variable in <em>line 41</em>.</li>
<li>In <em>line 43</em>, only the initial <kbd>x</kbd> value is provided to the <kbd>iterable</kbd> argument. Also note this is an example of the <kbd>repeat()</kbd> itertool in a practical use.</li>
<li>The <em>line 44</em> defines a list comprehension printing the value of <kbd>x</kbd> to two decimal points as the <kbd>log_map</kbd> anonymous function is run through the accumulator.</li>
</ul>
</li>
</ul>
<ol start="4">
<li>The <kbd>chain(*iterables)</kbd>&#160;function returns elements from the first iterable argument until there are no more values. At that point, the next iterable argument is processed until empty. This continues until all iterable arguments are finished. The&#160;<kbd>chain()</kbd>&#160;function essentially turns multiple sequences into a single sequence:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/d2d4b640-1409-408f-bef6-2c79e862fa97.png" style="width:38.08em;height:11.67em;"/></div>
<ul>
<li>
<ul>
<li>After importing the <kbd>chain</kbd> tool, in <em>line 46</em> we create a list object that passes two lists and a tuple to <kbd>chain()</kbd>. These arguments could have also been predefined variables, but are simply the raw data in this case.</li>
<li>When we print out the <kbd>chain</kbd> results in <em>line 47</em>, we see that it has combined all the disparate sequence objects as a single list.</li>
</ul>
</li>
</ul>
<ol start="5">
<li>An alternative way to accomplish the same thing is to simply concatenate objects:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/1ecc3e39-ed59-4190-b365-42c47b306c18.png" style="width:38.33em;height:14.33em;"/></div>
<ul>
<li>
<ul>
<li>The <em>lines 55</em>-<em>57</em> create variables from the raw data used in <em>line 53</em>.</li>
<li>The <em>line 58</em> concatenates all the lists together. Printing the results in <em>line 59</em> shows the same output as achieved in <em>line 54</em>. Either way is correct; which method to use just depends on which makes more sense to the developer.</li>
</ul>
</li>
</ul>
<ol start="6">
<li>There is a modified version of <kbd>chain()</kbd>—<kbd>chain.from_iterable(iterable)</kbd>. This is effectively the same thing as <kbd>chain</kbd>, except it chains inputs from a single iterable argument. The argument is evaluated lazily, meaning it delays evaluation of the expression until its value is needed. For example, in Python 2, the <kbd>range()</kbd> function is immediately evaluated, so all the integers produced by the <kbd>range()</kbd> are stored in memory when the function is examined.</li>
<li style="color: black" class="standard">In contrast, Python 3 has a lazy <kbd>range()</kbd> evaluation. While a variable could be assigned to a <kbd>range()</kbd> call, the call itself would reside in memory while the integers would only be called into existence when needed. Consider the following examples:</li>
</ol>
<ul>
<li>
<ul>
<li>In the following example screenshot, we see that, when printing a range variable in Python 2, all the integers are immediately available; when calling an indexed value, its result is obviously provided:</li>
</ul>
</li>
</ul>
<div style="color: black;font-size: 1em" class="standard CDPAlignCenter CDPAlign"><img src="images/9201badf-62d2-4e5e-a288-c1b295b349b8.png" style="width:41.25em;height:12.58em;"/></div>
<ul>
<li>
<ul>
<li>In the next example screenshot, Python 3 returns only the <kbd>range</kbd>&#160;object, not the entire list of integers. However, when calling an indexed value, it is returned because the <kbd>range</kbd>&#160;object is evaluated at that time to determine the value of the index. However, only that value is determined; attempting to print the variable again still shows the <kbd>range</kbd>&#160;object, rather than the list of integers:</li>
</ul>
</li>
</ul>
<div style="color: black;font-size: 1em" class="standard CDPAlignCenter CDPAlign"><img src="images/d0ded41a-8f4e-4f49-ac02-b6b8090f4e48.png" style="width:37.17em;height:13.00em;"/></div>
<ol start="8">
<li style="color: black" class="standard">Going back to <kbd>chain.from_iterable()</kbd>, the following example shows how it can be used:</li>
</ol>
<div style="color: black;font-size: 1em" class="standard CDPAlignCenter CDPAlign"><img src="images/9deb358c-13ce-4c03-8e6b-84aabe6dec54.png" style="width:38.58em;height:12.75em;"/></div>
<ul>
<li>
<ul>
<li>In this case, <kbd>from_iterable()</kbd> is actually a method of the <kbd>chain</kbd> class, so it is called using dot nomenclature.</li>
<li>Whereas the normal <kbd>chain</kbd> call takes in separate, iterable objects, <kbd>from_iterable</kbd> takes a single object that has multiple elements, for example, a typical list. The elements are combined into a single object in the returned value.</li>
</ul>
</li>
</ul>
<ol start="9">
<li>With <kbd>compress(data, selectors)</kbd>, an iterator is created that filters the elements from the <kbd>data</kbd> argument and returns only those elements that match <kbd>selectors</kbd>. When either <kbd>data</kbd> or <kbd>selectors</kbd> is empty, the process is finished.</li>
</ol>
<p style="padding-left: 60px" class="standard">In reality, the matching occurs when an element in <kbd>selectors</kbd> is evaluated as <kbd>True</kbd>, rather than matching the exact element type. Thus, Boolean-type values are used, that is,&#160;<kbd>True</kbd><em>/</em><kbd>False</kbd> or 1/0:</p>
<div style="color: black;font-size: 1em" class="standard CDPAlignCenter CDPAlign"><img src="images/861dba34-fef2-44d0-8797-760de5feede0.png" style="width:37.92em;height:16.67em;"/></div>
<ul>
<li>
<ul>
<li>The preceding example shows that both Boolean values (<em>line 3</em>) and binary integers (<em>line 4</em>) can be used as comparison values for <kbd>selectors</kbd>.</li>
</ul>
</li>
</ul>
<ol start="10">
<li>The&#160; <kbd>dropwhile(predicate, iterable)</kbd>&#160;function makes an iterator that drops elements from <kbd>iterable</kbd> while the <kbd>predicate</kbd> is <kbd>true</kbd>. When <kbd>predicate</kbd> is <kbd>false</kbd>, every element will be returned. Of note is the fact that the iterator will not show any output until <kbd>predicate</kbd> becomes <kbd>false</kbd>, so there may be some delay before output occurs:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/96d4f29e-4f85-4e13-9e9e-9a6ec43b83cd.png" style="width:38.75em;height:11.00em;"/></div>
<ul>
<li>
<ul>
<li>The preceding example uses an anonymous lambda function to drop all values that are less than 4. The <em>line 8</em> reinforces the fact that iterator objects do not automatically do anything without being processed by something that can deal with iterators.</li>
<li>Thus, <em>line 9</em> passes the <kbd>dropwhile</kbd> object into a list, which runs the lambda function and drops all values within the iterable argument, returning only those values that are greater than or equal to four.</li>
</ul>
</li>
</ul>
<ol start="11">
<li>Similar to <kbd>dropwhile</kbd><em>,</em> <kbd>filterfalse(predicate, iterable)</kbd> filters the elements in <kbd>iterable</kbd> and returns only those where the <kbd>predicate</kbd> is <kbd>False</kbd>. Conversely, if <kbd>predicate</kbd> is <kbd>None</kbd>, then it only returns those elements that are, themselves, <kbd>False</kbd><em>.</em></li>
</ol>
<p style="padding-left: 60px">It should be pointed that, unlike <kbd>dropwhile</kbd>, <kbd>filterfalse</kbd> will evaluate every single element. The&#160;<kbd>dropwhile</kbd>&#160;object functions only until a <kbd>false</kbd> comparison is made; after that, everything is returned. Thus, <kbd>filterfalse</kbd> can be used to ensure every item is evaluated where as&#160;<kbd>dropwhile</kbd> can be used as a one-shot check:</p>
<div class="standard CDPAlignCenter CDPAlign"><em><img src="images/ffd3d75f-0f7b-4612-950f-3fd6863ee860.png" style="width:35.83em;height:10.17em;"/></em></div>
<ul>
<li>
<ul>
<li>In this example, <kbd>filterfalse</kbd> takes a lambda function (<em>line 11</em>) that uses the modulus of a range of numbers to return those values with a remainder of zero. Since zero is considered <kbd>False</kbd>, only those values will be returned.</li>
<li>To make an easier comparison with&#160;<kbd>dropwhile</kbd>, we will used the same input as the <kbd>dropwhile</kbd> example in <em>line 12</em>. This is a good way to show that every element is evaluated separately, since the only output is those values greater than or equal to 4. In the <kbd>dropwhile</kbd> example, even though the numbers returned were the same, the values of <kbd>2</kbd> and <kbd>3</kbd> were returned even though they are less than 4&#160;because <kbd>dropwhile</kbd>&#160;failed to open when the first <kbd>False</kbd> value occurred.</li>
</ul>
</li>
</ul>
<ol start="12">
<li>The <kbd>groupby(iterable, key=None)</kbd> method produces an iterator that returns consecutive keys and groups from the supplied <kbd>iterable</kbd>. The&#160;<kbd>key</kbd>&#160;function is a function that computes a key value for each element; if <kbd>key</kbd> is <kbd>None</kbd>, it defaults to returning the elements unchanged. It is preferable that the <kbd>iterable</kbd> be pre-sorted on the same <kbd>key</kbd> function.</li>
</ol>
<p style="padding-left: 60px" class="standard">This method operates in a similar way to the <kbd>uniq</kbd> filter in Unix, as it creates a new group or a break every time the <kbd>key</kbd> function value changes. However, it differs from SQL's <kbd>group by</kbd> function, as that aggregates common elements regardless of their input order.</p>
<p style="padding-left: 60px" class="standard">To use the following example, ensure that&#160;<kbd>from itertools import groupby</kbd> is used as it is used in <em>line 34</em>:</p>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/ade56270-ba45-469a-a055-aac39e1dd64d.png" style="width:34.83em;height:43.58em;"/></div>
<ul>
<li>
<ul>
<li>For this example, <em>line 31</em> is simply a list of tuples that contain the make and model of cars.</li>
<li>The <em>line 32</em> sorts the list based on the first item in each tuple, as shown in <em>line 33</em>.</li>
<li>The <em>line 34</em> actually implements the <kbd>groupby</kbd> method. The&#160;<kbd>groupby</kbd>&#160;method takes as its arguments the sorted list and an anonymous function that tells <kbd>groupby</kbd> to use the first item in each tuple as the grouping key.</li>
</ul>
</li>
</ul>
<ol start="13">
<li>Then, in an enclosed loop, we look at the second element in the tuple and print out the model (second tuple element) and make (first tuple element, that is, the group key) of the cars list. We finish by adding a separation line to indicate where each group ends.</li>
<li>The following screenshot shows what happens if you forget to sort your input iterable. In this case, <kbd>groupby</kbd> still works by grouping common elements, but only if they are follow one another within the iterable:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/b0745e51-7029-4a04-bdde-ce5048e5422a.png" style="width:31.58em;height:36.67em;"/></div>
<ol start="15">
<li>The&#160; <kbd>isslice(iterable[, start], stop[, step])</kbd>&#160;function returns selected elements from the <kbd>iterable</kbd> argument. If <kbd>start</kbd> is provided and is not zero, elements within <kbd>iterable</kbd> are skipped until the start index is reached. If <kbd>stop</kbd> is <kbd>None</kbd>, then all elements within the <kbd>iterable</kbd> are processed. The&#160;<kbd>isslice()</kbd>&#160;function works differently from regular slices, as it doesn't allow negative numbers for <kbd>start</kbd><em>,</em> <kbd>stop</kbd>, or <kbd>step</kbd>:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/432575ba-630f-4eb1-a09a-011c8f82367c.png" style="width:34.08em;height:15.00em;"/></div>
<ul>
<li>
<ul>
<li>The preceding example shows the different variations that can be used with <kbd>islice</kbd>. The <em>line 38</em> shows the iterator stopping after four element indexes are returned.</li>
<li><em>The line 39</em> shows the iterator starting at element index <kbd>2</kbd> and stopping after index <kbd>4</kbd>.</li>
<li>The <em>line 40</em> starts at index <kbd>2</kbd> and returns all values in <kbd>iterable</kbd>.</li>
<li>The <em>line 41</em> is the same as <em>line 40</em>, except that the returned values have a stepping of <kbd>2</kbd>.</li>
</ul>
</li>
</ul>
<ol start="16">
<li>The&#160; <kbd>starmap(function, iterable)</kbd>&#160;method&#160;computes <kbd>function</kbd> using arguments from <kbd>iterable</kbd><em>.</em> This method is used in lieu of <kbd>map()</kbd> when argument parameters are pre-zipped; that is, they are already combined into tuples in a single iterable. In essence, <kbd>starmap()</kbd> can take any number of arguments (hence the <kbd>star</kbd> part of the name) whereas <kbd>map()</kbd> can only accept two arguments:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/6264d201-cf4d-4813-86d6-583d3e1cf7c6.png" style="width:35.25em;height:10.00em;"/></div>
<ul>
<li>
<ul>
<li>After importation, a <kbd>starmap</kbd> object is created and confirmed in <em>line 43</em></li>
<li>Displaying the results of <kbd>starmap</kbd> in <em>line 44</em>, we can see that an arbitrary number of arguments can be input, so <kbd>starmap(</kbd><em>)</em> acts like <kbd>function(*args)</kbd>, whereas <kbd>map()</kbd> is more like <kbd>function(a, b)</kbd></li>
</ul>
</li>
</ul>
<ol start="17">
<li>The <kbd>takewhile(predicate, iterable)</kbd> method generates an iterator that returns all elements from <kbd>iterable</kbd> as long as <kbd>predicate</kbd> is <kbd>true</kbd>. In practice, <kbd>takewhile()</kbd> is the opposite of <kbd>dropwhile()</kbd>. Once the <kbd>predicate</kbd> becomes <kbd>False</kbd>, no further elements are processed:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/f0090454-495a-4e04-bbb0-4c7e8493ae91.png" style="width:40.50em;height:9.67em;"/></div>
<ul>
<li>
<ul>
<li><em>Line 46</em> shows that elements within the iterable input are processed until the results of the processing are <kbd>false</kbd>; in this case,&#160;<kbd>6</kbd> is not less than <kbd>4</kbd>. At that point, no further processing is performed and the iterator is returned with what was successfully processed upto that point.</li>
</ul>
</li>
</ul>
<ol start="18">
<li>The&#160; <kbd>tee(iterable, n=2)</kbd>&#160;method&#160;<span>returns</span> <kbd>n</kbd> <span>independent iterators from a single iterable argument. In other words, you can create multiple iterators from a single interable input.</span></li>
</ol>
<p style="color: black;font-size: 1em;padding-left: 60px" class="standard">Once <kbd>tee()</kbd> has done its work, <kbd>iterable</kbd> should not be used elsewhere, otherwise it could be modified without the <kbd>tee()</kbd> output iterators being updated. In addition, the resulting iterators may require significant memory allocation; if one iterator uses most or all of the data prior to another iterator starting, it is quicker to use <kbd>list()</kbd> than <kbd>tee()</kbd>:</p>
<div style="color: black;font-size: 1em" class="standard CDPAlignCenter CDPAlign"><img src="images/ca79bb8b-bf28-4482-ac51-3c0806cb5c44.png" style="width:38.67em;height:28.42em;"/></div>
<ul>
<li>
<ul>
<li>In this example, a simple string of characters is created in <em>line 48</em>.</li>
<li>Unpacking is performed in <em>line 49</em>. As we are using the default <kbd>n=2</kbd> for the resulting iterators, only two variables are required.</li>
<li>The <em>lines 50</em> and <em>51</em> show that, after processing <kbd>tee()</kbd><em>,</em> we now have two identical iterator objects.</li>
</ul>
</li>
</ul>
<ol start="19">
<li>The final itertool to cover is <kbd>zip_longest(*iterables, fillvalue=None)</kbd>. This makes an iterator that aggregates elements from each of the iterable input arguments; in short, merging two or more iterables into one. If the arguments are of uneven length, missing elements are filled in with the <kbd>fillvalue</kbd>. Iteration of this method continues until the longest iterable argument is empty. In the event that the longest argument could potentially be infinite, a wrapper should be used to limit the number of calls, such as <kbd>islice()</kbd> or <kbd>takewhile()</kbd>:</li>
</ol>
<div style="color: black;font-size: 1em" class="standard CDPAlignCenter CDPAlign"><img src="images/3a39e8aa-ac05-4b50-a4ba-ea1894317576.png" style="width:40.17em;height:16.83em;"/></div>
<ul>
<li>
<ul>
<li>In this example, we have provided two inline string arguments to <kbd>zip_longest()</kbd>, and the filler is another string. Printing the results shows that argument <kbd>1</kbd> is merged with argument <kbd>2</kbd>, until no more characters are available in argument <kbd>2</kbd>. At that point, the <kbd>fillvalue</kbd> is provided as a substitute until argument <kbd>1</kbd> is empty.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using generator functions</h1>
                </header>
            
            <article>
                
<p>Generators allow you to declare a function that operates like an iterator. This allows you to write a custom function that can be used in a&#160;<kbd>for</kbd> loop or an other iteration capacity. The key feature of a generator is that it yields a value, rather than using <kbd>return</kbd><em>.</em></p>
<p>When a generator function is called, it returns an iterator known as a generator. This generator controls the operation of the generator function. When the generator is called, the function proceeds like normal but, when the logic flow reaches the <kbd>yield</kbd> statement, processing is suspended while returning the first evaluation.</p>
<p>During the suspension, the local state of the function is retained in memory; it's just like a normal function was paused in completing its processing. When the generator is resumed by calling it again, it continues as if nothing happened, returns the next evaluation value, and suspends again. This continues until all the values to be processed are completed, at which point a <kbd>StopIteration</kbd> exception is thrown.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Generators are incredibly simple to create. Define a function, but instead of using <kbd>return</kbd>, use the keyword <kbd>yield</kbd><em>:</em></li>
</ol>
<pre>        def my_generator(x):<br/>            while x:<br/>                x -= 1<br/>                yield x</pre>
<ol start="2">
<li>Create an instance of the function. Don't forget the argument:</li>
</ol>
<pre>        mygen = my_generator(5)</pre>
<ol start="3">
<li>Call the instance as an argument to <kbd>next()</kbd>:</li>
</ol>
<pre>        next(mygen)</pre>
<ol start="4">
<li>Continue until iteration stops.</li>
</ol>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Here is an example of a generator in action:</p>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/83aa60b3-667f-4f60-a219-bcf0b0caba59.png" style="width:38.58em;height:34.75em;"/></div>
<ul>
<li>The <em>line 1</em> simply creates the function as provided previously.</li>
<li>The <em>line 2</em> calls the generator like a normal function, showing that generators can operate exactly like a regular function. You could capture the results in a <kbd>list</kbd> object if you wanted a permanent copy of the results.</li>
<li>The <em>line 3</em> creates an instance of the generator.</li>
</ul>
<ul>
<li>The <em>lines 4</em>-<em>6</em> show how a generator is typically used. By calling the generator instance as the argument for <kbd>next()</kbd>, the generator processing is paused after each evaluation cycle. Rather than receiving all results at once, only one value is provided from the generator when called by <kbd>next()</kbd>. This is due to using <kbd>yield</kbd> rather than <kbd>return</kbd><em>.</em></li>
<li>In&#160;<em>line 7</em>, there are no more values to be evaluated in the generator, so processing is cancelled and the expected <kbd>StopIteration</kbd> exception is returned instead.</li>
</ul>
<p>As shown by this example, generators operate exactly like other iterator functions. They just let you write iterator operations without having to define iterator classes with the&#160;<kbd>__iter__</kbd> and <kbd>__next__</kbd> methods. However, one catch is that generators can only be used once; after a sequence is iterated through, it is no longer in memory. To iterate more than once, you have to call the generator again.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>By default, generators provide lazy evaluation: they don't perform a process action until explicitly called. This is a valuable trait when working with large datasets, such as processing millions of calculations. If you attempted to store all the results in memory at one time, that is, via a normal function call, you could run out of space.</p>
<p>Another option is when you don't know if you actually need to use all the values returned. There is no need to perform a calculation if you won't use it, so you can reduce the memory footprint and improve performance.</p>
<p>Still another option is when you want to call another generator or access some other resource, but you want to control when that access occurs. If you don't need an immediate response, for example, you don't want to store the result in a temporary variable, then being able to run the generator at the desired time can help the design process.</p>
<p>One great place for generators is in replacing callback functions. Callback functions are called by something else, do their processing, and occasionally send a status report back to the caller. This has the inherent problems of full-processing, that is, everything is processed at one time and stored in memory for access.</p>
<p>If a generator is used instead, the same processing occurs but there is no status report to the caller. The generator function simply yields when it wants to report. The caller gets the generator's result and deals with the reporting work as a simple <kbd>for</kbd> loop that wraps the generator call. If, for some reason, you still want to have the generator provide everything at once, you can simply wrap a generator call in <kbd>list</kbd>.</p>
<p>Python uses both of these cases for different versions. In Python 2, <kbd>os.path.walk()</kbd> uses a callback function, whereas Python 3 has <kbd>os.walk()</kbd>, which uses a filesystem-walking generator.</p>
<p>Finally, there is one last trick that can help with Python performance. Normally, list comprehensions are used to quickly iterate through a list, as in the following example:</p>
<div>
<pre>l = [x for x in foo if x % 2 == 0]</pre>
</div>
<p>A simple generator can be created in a similar fashion. Basically, you just replace the square brackets with parentheses:</p>
<div>
<pre>g = (x for x in foo if x % 2 == 0)</pre>
</div>
<p>Once you have that, you can use the generator instance within a simple <kbd>for</kbd> loop:</p>
<div>
<pre>for i in g:</pre>
</div>
<div>Here is the process in use:</div>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/475cddb1-9c6f-4827-937b-df4889e1c091.png" style="width:43.42em;height:20.25em;"/></div>
<p>The benefit of using a generator instead of a list comprehension is that intermediate memory storage is not required. The values are created on demand, as it were, so the entire list is not dumped to memory at one time. This can achieve significant speed increases and reduce memory usage, depending on the program.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Simulating multithreading with coroutines</h1>
                </header>
            
            <article>
                
<p>Where generators can generate data from a function via <kbd>yield</kbd>, they can also be used to accept data if they are used on the right-hand side of the <kbd>=</kbd>&#160;sign in a variable assignment. This creates a coroutine.</p>
<p>A coroutine is a type of function that can suspend and resume execution, via <kbd>yield</kbd><em>,</em> at predefined locations within its code. In addition to <kbd>yield()</kbd>, coroutines also have <kbd>send()</kbd> and <kbd>close()</kbd> functions for processing data. The&#160;<kbd>send()</kbd>&#160;function passes data to a coroutine (the <em>acceptance</em>&#160;part of the function) and <kbd>close()</kbd> terminates the coroutine (as there is no way for garbage collection to inherently close it for us).</p>
<p>Using the <kbd>asyncio</kbd> module allows coroutines to be used to write single-threaded, concurrent programs. As they are single-threaded, they still only perform one job but the concurrency simulates multithreading. More information about concurrency and parallel programming can be found in the next section, <em>When to use parallel processing.</em></p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Define the function:</li>
</ol>
<pre>        def cor():<br/>            hi = yield "Hello"<br/>            yield hi</pre>
<ol start="2">
<li>Create an instance:</li>
</ol>
<pre>        cor = cor()</pre>
<ol start="3">
<li>Use <kbd>next()</kbd> to process the function:</li>
</ol>
<pre>        print(next(cor))</pre>
<ol start="4">
<li>Use <kbd>send()</kbd> to provide an input value to the function:</li>
</ol>
<pre>        print(cor.send("World"))</pre>
<ol start="5">
<li>This is what it looks like put together:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/aa0e8a58-8311-462a-9f86-7051f4161736.png" style="width:37.00em;height:15.67em;"/></div>
<ol start="6">
<li>To make life easier and avoid having to manually call <kbd>next()</kbd> every time, <kbd>coroutine_decorator.py</kbd> shows how a decorator can be made to handle the iteration for us:</li>
</ol>
<pre>        def coroutine(funct):<br/>            def wrapper(*args, **kwargs):<br/>                cor = funct(*args, **kwargs)<br/>                next(cor)<br/>                return cor<br/>            return wrapper</pre>
<p style="padding-left: 60px">According to the official documentation (<a href="https://docs.python.org/3/library/asyncio-task.html#coroutines">https://docs.python.org/3/library/asyncio-task.html#coroutines</a>), it is preferable to use <kbd>@asyncio.coroutine</kbd> to decorate generator-based coroutines. It isn't strictly enforced, but it enables compatibility with <kbd>async def</kbd> coroutines and also serves as documentation.</p>
<ol start="7">
<li><kbd>asyncio_concurrent.py</kbd>, from <a href="https://docs.python.org/3/library/asyncio-task.html#example-chain-coroutines">https://docs.python.org/3/library/asyncio-task.html#example-chain-coroutines</a>, shows how to use <kbd>asyncio</kbd> to perform concurrent processing:</li>
</ol>
<pre>        import asyncio<br/><br/>        async def compute(x, y):<br/>            print("Compute %s + %s ..." % (x, y))<br/>            await asyncio.sleep(1.0)<br/>            return x + y<br/><br/>        async def print_sum(x, y):<br/>            result = await compute(x, y)<br/>            print("%s + %s = %s" % (x, y, result))<br/><br/>        loop = asyncio.get_event_loop()<br/>        loop.run_until_complete(print_sum(1, 2))<br/>        loop.close()</pre>
<ul>
<li>
<ul>
<li>The event loop is started (<kbd>get_event_loop()</kbd>) and calls <kbd>print_sum()</kbd></li>
<li>The&#160; <kbd>print_sum()</kbd>&#160;coroutine&#160;is suspended while it calls <kbd>compute()</kbd></li>
<li>The <kbd>compute()</kbd> coroutine&#160;starts but immediately goes to sleep for 1 second</li>
<li>When <kbd>compute()</kbd> restarts, it finishes its computation and returns the result</li>
<li>The <kbd>print_sum()</kbd>&#160;coroutine&#160;receives the result and prints it</li>
<li>There are no more computations to perform so the <kbd>print_sum()</kbd> coroutine raises the <kbd>StopIteration</kbd> exception</li>
<li>The exception causes the event loop to terminate and the loop is closed</li>
</ul>
</li>
</ul>
<ol start="8">
<li>Here is <kbd>asyncio_multi_jobs.py</kbd> (<a href="https://docs.python.org/3/library/asyncio-task.html#example-parallel-execution-of-tasks">https://docs.python.org/3/library/asyncio-task.html#example-parallel-execution-of-tasks</a>) that shows a better illustration of the concurrent execution of multiple jobs:</li>
</ol>
<pre>        import asyncio<br/><br/>        async def factorial(name, number):<br/>            f = 1<br/>            for i in range(2, number+1):<br/>                print("Task %s: Compute factorial(%s)..." % (name, i))<br/>            await asyncio.sleep(1)<br/>            f *= i<br/>            print("Task %s: factorial(%s) = %s" % (name, number, f))<br/><br/>        loop = asyncio.get_event_loop()<br/>        loop.run_until_complete(asyncio.gather(<br/>            factorial("A", 2),<br/>            factorial("B", 3),<br/>            factorial("C", 4),<br/>        ))<br/>        loop.close()</pre>
<p style="padding-left: 60px">In this example, three factorial coroutines are created. Because of the asynchronous nature of the code, they aren't necessarily started in order, nor are they processed and completed in order.</p>
<ol start="9">
<li>Your results may vary, but here is an example of the output of this code:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/c96c1ee5-def5-47a5-a25b-0d49a8dde3e4.png" style="width:39.33em;height:13.08em;"/></div>
<p style="padding-left: 60px">As can be seen, the jobs were started in reverse order; if you look at the official documentation, they were started in order. Each task was completed at a different time so, while the results are in order, each individual task took a varying amount of time. This can also be seen when compared to the official documentation.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>When working with asynchronous code, a developer has to carefully consider the libraries and modules being used. Any imported modules need to be non-blocking; that is, they can't stop code execution while waiting for something else to finish.</p>
<p>In addition, a coroutine schedule involving an event loop needs to be created to manually handle coroutine scheduling. While operating systems can handle multithreading and multiprocessing internally, coroutine scheduling (by its very nature) must be handled by the developer. Thus, while coroutines and asynchronous operations can be powerful and useful tools, they also take a lot of work to get right.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">When to use parallel processing</h1>
                </header>
            
            <article>
                
<p>Concurrency means stopping one task to work on another. With a coroutine, the function stops execution and waits for more input to continue. In this sense, you can have several operations pending at the same time; the computer simply switches to the next one when it is time.</p>
<p>This is where multitasking in operating systems comes from: a single CPU can handle multiple jobs at the same time by switching between them. In simple terms, concurrency is when multiple threads are being processed during a given time period. In contrast, parallelism means the system runs two or more threads simultaneously; that is, multiple threads are processed at a given point in time. This can only occur when there is more than one CPU core available.</p>
<p>The benefit of parallelizing code comes from doing more with less. In this case, it's doing more work with fewer CPU cycles. Before multi-core systems, the only real way to improve performance was to increase the clock speed on the computer, allowing the system to do more work in a given amount of time. As thermal limitations became a problem with higher CPU frequencies, manufacturers found that adding more cores and reducing the frequency could provide similar benefits without overheating the system and reducing energy usage, something vital in portable devices. Depending on the task, splitting a job into multiple, smaller jobs could actually be quicker on a multi-core device than increasing the clock speed.</p>
<p>The biggest problem with making parallel programs is figuring out when parallelism will help. Not all tasks need the boost, and sometimes you can actually make things slower if you try to use parallel programming. While there are certain types of problems than can be looked at and a determination made, in this author's experience, you sometimes just have to try it out and see what happens.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Rather than a traditional walk-through of how to code, this will be more of a flow-chart to determine which type of parallel processing paradigm to use, if any:</p>
<ul>
<li>How large is your dataset? If your dataset is small (based on your experience), then a single-threaded process may not hurt you too much.</li>
<li>Can your data processing and logic flow be split into simultaneous operations? Frequently, the type of program and the data being worked on simply don't allow for any type of concurrency or parallel programming.</li>
</ul>
<ul>
<li>Is your processing CPU-limited or I/O-limited? CPU-intensive applications are best met with multiprocessing whereas I/O-intensive applications are handled better with multithreading.</li>
<li>Do you need to have a shared memory pool? In a shared memory pool, you have to make sure that each data request doesn't occur at the same time as a data write, that is, a race condition, so locking each data transaction is necessary. Non-shared memory requires the creation of communication calls between threads/processes if data transfer is required.</li>
<li>Have you identified where the bottlenecks are? Before you design a parallel program, you have to find the troublespots within the process. While you can parallelize the whole program, you get a better return if you focus on optimizing the data bottlenecks and functions that do most of the work.</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The previous steps listed aren't all-inclusive. Designing parallel programs takes a lot of practice, and you can find college courses that are nothing but parallel programming, such as <a href="https://ocw.mit.edu/courses/mathematics/18-337j-parallel-computing-fall-2011/">https://ocw.mit.edu/courses/mathematics/18-337j-parallel-computing-fall-2011/</a>.</p>
<p>It also can't be overstated that you should take the time to determine whether the problem you're trying to answer can be parallelized. One example used in computer science is sorting algorithms. For example, if you have a group of numbers that need to be sorted smallest to largest, you could break the entire group into multiples of two, that is, compare two numbers to each other. Each of these subgroups could then be compared simultaneously. Then, you merge some of the groups together and perform another simultaneous comparison. Do this enough times and you eventually come up with the final, sorted answer.</p>
<p>If you think about it, parallel processing is similar to recursive programming, since you have to break down the problem into smaller chunks, or at least identify similar actions. The main goal is to find tasks that can be performed independently of each other, as well as tasks that need to exchange data. Independent tasks allow work to be distributed between independent workers, while data exchange tasks help define which tasks need to be put together in a single worker.</p>
<p>If your program ends up slowing down system response when running, you might want to look at parallelizing it. Spinning off new threads or processes allows the system to remain responsive to user input while still performing your program's work.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Forking processes</h1>
                </header>
            
            <article>
                
<p>Process forking is the traditional method of parallelizing work, especially in *nix operating systems. When a program is forked, the OS simply makes a new copy of the original program, including its memory state, and proceeds to run the two versions of the program simultaneously. Naturally, the copied program can have its own forks, creating a hierarchy of the original, parent process, with numerous children and grandchildren copies. If the parent program is killed, the child processes can still operate normally.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In Python, to fork a process, all you have to do is import the <kbd>os</kbd> module and invoke the <kbd>fork()</kbd> function. The following example creates a simple parent/child process forking program:</p>
<ol>
<li>Import the <kbd>os</kbd> module, necessary to access <kbd>fork()</kbd>:</li>
</ol>
<div style="color: black;font-size: 1em" class="float float-listings">
<pre>        import os</pre>
</div>
<ol start="2">
<li>Define the child process:</li>
</ol>
<div>
<pre>        def child():
            print("Child {} calling".format(os.getpid()))
            os._exit(0)</pre>
</div>
<ol start="3">
<li>Create the parent process:</li>
</ol>
<pre class="mce-root"><span>        def parent():</span><br/><span>            for i in range(10):</span><br/><span>                newchild = os.fork()</span><br/><span>                if newchild == 0:</span><br/><span>                    child()</span><br/><span>                else:</span><br/><span>                    print("Parent {parent} calling. Creating child {child}".format(parent=os.getpid(), child=newchild))</span><br/><span>            i += 1</span></pre>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The child process is very simple. All it does is return the process ID of the child. The <kbd>os._exit()</kbd> call is important as it ensures the child process is killed and is not a zombie when the parent is killed.</p>
<p>As the parent process will be forked to create new children, it is the <kbd>key</kbd> function. Only one parent process is created; all other processes will be children.</p>
<p>The following screenshot demonstrates one possible result; as process IDs are different for every system, your results will be different:</p>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/900c9959-1282-41da-9f40-947462b6ff08.png" style="width:35.83em;height:21.75em;"/></div>
<p>As you can see from the output, the child processes may not be immediately created; the parent may have a chance to spawn several children before the child process is able to actually start functioning. Another point: explicitly killing the child process ensures that the child doesn't return to the parent loop and spawn its own processes, which would generate grandchildren processes.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The problem with using <kbd>os.fork()</kbd> is that it only reliably works on *nix OSes, including Macs. Windows uses a different forking model; unless you happen to run Cygwin (a Windows application that allows for *nix-like functionality), you'll have to rely on threads or the <kbd>multiprocessing</kbd> module.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to implement multithreading</h1>
                </header>
            
            <article>
                
<p>Because forking isn't fully cross-platform compatible, there are two primary workers used in parallel Python programming: threads and processes. Threads are typically the "go-to" parallel tool for many programmers. Simply put, threads are separate workers that function simultaneously to complete the larger job. One job can have multiple threads.</p>
<p>A good example is a web browser: while the browser itself is a single process when viewed in Windows Task Manager or using the <kbd>ps</kbd> command in Linux, the browser can spawn many threads to accomplish tasks, such as going to a URL, rendering HTML, processing JavaScript, and so on. All those threads are working together to accomplish the mission of the browser process.</p>
<p>Threads are sometimes called&#160;<strong>lightweight processes</strong>&#160;because they run in parallel like *nix forked processes, but they are actually generated by a single parent process. Threads are frequently used in graphical interfaces to wait for, and respond to, user interaction. They are also prime candidates for programs that can be designed into multiple, independent tasks; this makes them ideal for networking, where I/O operations are the bottleneck, rather than the CPU.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol class="enumerate">
<li>
<p>First, we will create <kbd>single_thread.py</kbd> to give us a benchmark for comparison. For this example, we will be contacting a number of websites and calculating the time it takes to open a connection to all of them:</p>
</li>
</ol>
<pre>        import urllib.request<br/>        import urllib.error<br/>        import time<br/><br/>        def single_thread_retrieval():<br/>            start_time = time.time()<br/>            urls = ["https://www.python.org", <br/>                    "https://www.google.com", <br/>                    "https://www.techdirt.com",<br/>                    "https://www.facebook.com",<br/>                    "https://www.ibm.com",<br/>                    "https://www.dell.com",<br/>                    "https://www.amd.com",<br/>                    "https://www.yahoo.com",<br/>                    "https://www.microsoft.com",<br/>                    "https://www.apache.org"]<br/>            try:<br/>                for url in urls:<br/>                    urllib.request.urlopen(url)<br/>            except urllib.error.HTTPError:<br/>                pass<br/>            return time.time() - start_time</pre>
<ul>
<li>
<ul>
<li>As we will be contacting websites, we need to import <kbd>urllib.request</kbd> to actually open the connection and <kbd>urllib.error</kbd> in case there is a problem reaching a website.</li>
<li>To make a benchmark, we need to know how long it takes to run the function, so we import <kbd>time</kbd><em>.</em></li>
<li>When we create the function, the first thing we do is figure out the time the function started.</li>
<li>Next, we create a list of URLs to access. Feel free to add to or modify this list.</li>
<li>In case there are any errors when accessing a website, we wrap the actual website request within a <kbd>try...except</kbd> block.</li>
<li>For each website in the list, we open a connection to the site. As we only care how long it takes to connect, we don't do anything with the <kbd>urlopen()</kbd> return object.</li>
<li>If a website errors out, for example, 403 Forbidden, we simply ignore it and move on.</li>
<li>Finally, we calculate the total time it took for the function to run and return that value.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>Because we are accessing websites, and connectivity can fluctuate, we will write <kbd>time_funct.py</kbd> that will calculate the average time to run the preceding function. This works best as a function included with the preceding example, but can be used separately if desired:</li>
</ol>
<pre style="color: black">        import statistics<br/><br/>        times = []<br/><br/>        def avg_time(func, val):<br/>            for num in range(val):<br/>                times.append(func)<br/>        return statistics.mean(times)</pre>
<ul>
<li>
<ul>
<li>We import the <kbd>statistics</kbd> library, as it provides basic math functions, such as calculating the average.</li>
<li>An empty list is created to store the individual time calculations.</li>
<li>The averaging function is created. In this case, to allow it to be used for other situations, it accepts as arguments a function call and an integer.</li>
<li>The integer argument becomes the number of times to run the function argument.</li>
<li>Finally, we calculate the average time and return that value.</li>
</ul>
</li>
</ul>
<ol start="3">
<li>To figure out the average, single-threaded time to access 10 URLs, we simply print the result of the <kbd>avg_time()</kbd> function:</li>
</ol>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/b9bc4839-c176-470e-865e-84b45897d5ad.png" style="width:42.08em;height:8.25em;"/></div>
<ol start="4">
<li>Now, let's compare it to <kbd>multi_thread_retrieval.py</kbd>. This is more complicated to write compared to the single-threaded application, and the example could probably we rewritten in a more concise fashion, but it suffices for our needs. The file itself is broken into three parts, below, to aid in explanation.</li>
</ol>
<pre style="color: black">        import time <br/>        import threading <br/>        import queue <br/>        import urllib.request, urllib.error <br/><br/>        class Receiver(threading.Thread): <br/>            def __init__(self, queue): <br/>                threading.Thread.__init__(self)<br/>                self._queue = queue <br/><br/>            def run(self):<br/>                while True: <br/>                    url = self._queue.get() <br/>                    if isinstance(url, str) and url == 'quit':<br/>                        break<br/>                    try:<br/>                        urllib.request.urlopen(url)<br/>                    except urllib.error.HTTPError:<br/>                        pass</pre>
<ul>
<li>
<ul>
<li>First, we need to import several modules. The two new ones are <kbd>threading</kbd> and <kbd>queue</kbd>, necessary when dealing with multiple threads.</li>
<li>We make a class for the object that will be receiving the URLs and actually performing the URL request. The class itself inherits from the <kbd>Thread</kbd> class, allowing it to inherit threading functionality.</li>
<li>The initialization method creates a new thread and fills a queue variable with input data.</li>
</ul>
</li>
</ul>
<ol start="5">
<li>The <kbd>run</kbd> method looks at the queue variable and pulls the URL from it. As long as the URL is not <kbd>quit</kbd>, the program will attempt to reach the website. If an exception is generated when accessing the site, it is skipped, just like the single-threaded program:</li>
</ol>
<pre>        def Creator():<br/>            urls = ["https://www.python.org", <br/>                    "https://www.google.com", <br/>                    "https://www.techdirt.com",<br/>                    "https://www.facebook.com",<br/>                    "https://www.ibm.com",<br/>                    "https://www.dell.com",<br/>                    "https://www.amd.com",<br/>                    "https://www.yahoo.com",<br/>                    "https://www.microsoft.com",<br/>                    "https://www.apache.org"]<br/>  <br/>            cue = queue.Queue()<br/>            worker_threads = build_worker_pool(cue, 4)<br/>            start_time = time.time()</pre>
<ul>
<li>
<ul>
<li>Next, we define the function that will push the URLs to the receiver. The URL list from the single-threaded program is used again. To keep things unambiguous, the queue is renamed to <kbd>cue</kbd>, otherwise we run into problems with the <kbd>queue</kbd> <span>module.</span></li>
<li>The cue is used to create a worker pool of four threads. This pool is available for job requests; as one worker finishes a task, it returns to the pool and awaits another task.</li>
</ul>
</li>
</ul>
<ol start="6">
<li>We have the start time again, so we can calculate how long the task will take:</li>
</ol>
<pre style="color: black">            for url in urls: <br/>                cue.put(url) <br/><br/>            for worker in worker_threads:<br/>                cue.put('quit')<br/>            for worker in worker_threads:<br/>                worker.join()<br/>  <br/>            print('Done! Time taken: {}'.format(time.time() - start_time))<br/><br/>        def build_worker_pool(cue, size):<br/>            workers = []<br/>            for _ in range(size):<br/>                worker = Receiver(cue)<br/>                worker.start() <br/>                workers.append(worker)<br/>            return workers<br/><br/>        if __name__ == '__main__':<br/>            Creator()</pre>
<ul>
<li>
<ul>
<li>Next, we have three <kbd>for</kbd> <span>loops that take the URLs from the list and populate the cue. When the list is empty, the next URL provided is the word <kbd>quit</kbd>. The final loop joins all the workers together. Basically, the main thread is paused while the subthreads process their data. When they finish, they tell the main thread, which then continues.</span></li>
<li>
<p>The final function creates the worker pool. Depending on the integer provided to the pool manager, a number of threads are spawned and start working on a provided task. The threads are appended to an empty list and the complete list is returned to step <kbd>f</kbd><span>&#160;earlier.</span></p>
</li>
</ul>
</li>
</ul>
<ol start="7">
<li>Here are the results of several different thread counts:</li>
</ol>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/9b65c5a4-91ac-4cee-8b48-5a22d71930f7.png" style="width:39.17em;height:11.25em;"/></div>
<p style="padding-left: 60px">The default number of threads (4) is about 3.5x faster than the average of 10 single-threaded calls:</p>
<ul>
<li>
<ul>
<li>Using 10 threads, the speed increase is nearly 6x faster.</li>
<li>At 20 threads, we are reaching the point of diminished returns. In this case, the speed increase is only 7x faster. This makes sense, as there are only 10 URLs in the list.</li>
<li>Just for fun, we see that using two threads yields a 2x speed increase. This again makes sense, as we have double the number of workers.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>While multithreading has benefits, it's important to recognize when multithreading is advantageous and when it is a burden.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Advantages</h1>
                </header>
            
            <article>
                
<p>A number of advantages come from multithreading, which is why it is a very popular option for a lot of developers:</p>
<ul>
<li>When a process spawns new threads, the heavy lifting has already been done by the process. The new threads don't require copying an entire program like a forked program and the memory requirements are low, so there is little performance overhead. If you look at Task Manager or view threads in Linux, you'll see hundreds or possibly thousands of threads being used, yet your system is still responsive.</li>
</ul>
<ul>
<li>Programming threads is relatively easy compared to dealing with actual processes.</li>
<li>Threads have a shared memory space they can use, controlled by the parent process. This memory space is how threads can communicate with each other and share data. In Python, this means that global namespaces, object passing, and program-wide components such as imported modules are all available to every thread from a given process.</li>
<li>Thread programming is portable between OSes. As mentioned, Windows doesn't directly support process forking, but every OS supports threads. Code it once, and it will run anywhere.</li>
<li>Good choice for I/O-limited applications, as application responsiveness is improved.</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Disadvantages</h1>
                </header>
            
            <article>
                
<p>However, there are some disadvantages with multithreading. Some are inherent in the multithreading paradigm, and others (such as GIL), are particular to Python:</p>
<ul>
<li>Threads cannot directly start another program. They can only call functions or methods in parallel with the rest of the program that spawned them, that is, threads can only utilize and interact with the components of their parent but can't work with other programs.</li>
<li>Threads have to contend with synchronization and queues to ensure operations don't block others. For example, there is only one<span>&#160;</span><kbd>stdin</kbd>,<span>&#160;</span><kbd>stdout</kbd>, and<span>&#160;</span><kbd>stderr</kbd><span>&#160;</span>available per program and all the threads for that program have to share those interfaces, so managing thread conflicts can become a problem.</li>
<li><span><strong>G</strong></span><strong>lobal interpreter lock</strong><span>&#160;</span>(<strong>GIL</strong>) is the bane of many thread programmers. Simply put, GIL prevents multiple threads from operating within the Python interpreter environment simultaneously. While the OS may have dozens or hundreds of threads, Python programs can only utilize the Python environment one at a time. When a Python thread wants to do work, it must lock down the interpreter until the work is over. Then, the next thread in line gains access to the interpreter and locks it in turn. In other words, you can have multithreading but you can't have true, simultaneous operations. Because of this, threads can't be split across multiple CPUs; you can only have multithreading within one CPU.</li>
<li>Shared memory means a crashed/misbehaving thread can trash data and corrupt the parent process.</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to implement multiprocessing</h1>
                </header>
            
            <article>
                
<p>Multiprocessing in Python involves starting separate processes, much like forking. This gets around the GIL and its effect on multiple threads, but you have to deal with the overhead of increased memory usage and the multiple instances of the Python interpreter that are spawned for all the processes. However, in multi-core systems, multiprocessing can take advantage of the different CPUs so you have true parallelism; more cores = more processing power.</p>
<p>As there isn't room to cover everything about parallel Python programming (there are entire books written on the subject), I'm going to finish this chapter by demonstrating how to automate multiprocessing using <kbd>Pool()</kbd>, which controls worker processes automatically. <kbd>Pool()</kbd> accepts a number of input arguments, probably the most important one being the number of processes. By default, <kbd>Pool()</kbd> uses all the available CPUs on your system. This is useful because, if your system is upgraded, your program will automatically use more processing power without having to be rewritten.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Using <kbd>pool()</kbd> is the easiest way to work with multiprocessing, as you don't have to think about manually spawning processes and controlling interaction between them. Obviously, this limits your programs somewhat, as you have to figure out how to write your programs to take advantage of <kbd>pool()</kbd>, whereas manual control gives you a little more leeway. <kbd>multi_process_retrieval.py</kbd> demonstrates how <kbd>pool()</kbd> can be used to allocate work:</li>
</ol>
<pre>        import urllib.request, urllib.error <br/>        from multiprocessing.dummy import Pool <br/>        import time<br/><br/>        start_time = time.time()<br/><br/>        urls = ["https://www.python.org", <br/>                "https://www.google.com", <br/>                "https://www.techdirt.com",<br/>                "https://www.facebook.com",<br/>                "https://www.ibm.com",<br/>                "https://www.dell.com",<br/>                "https://www.amd.com",<br/>                "https://www.yahoo.com",<br/>                "https://www.microsoft.com",<br/>                "https://www.apache.org"]<br/><br/>        # Make the Pool of workers<br/>        pool = Pool(4) <br/><br/>        # Open the urls in their own process<br/>        try:<br/>            pool.map(urllib.request.urlopen, urls)<br/>        except urllib.error.HTTPError:<br/>            pass<br/><br/>        #close the pool and wait for the work to finish <br/>        pool.close() <br/>        pool.join() <br/><br/>        print('Done! Time taken: {}'.format(time.time() - start_time))</pre>
<ul>
<li>
<ul>
<li>As before, we are going to access the same websites, so we need to import the <kbd>urllib</kbd> modules and <kbd>time</kbd>. We also need to import <kbd>Pool()</kbd> from the <kbd>multiprocessing</kbd> module.</li>
<li>Again, we capture the start time so we can calculate how long the retrieval takes.</li>
<li>Like the multithreading example, we create a pool of workers; four in this case. In this instance, <kbd>multiprocessing.pool()</kbd> takes a bit less setup: assign an instance of <kbd>Pool()</kbd> and that's it. No need to bother with a queue, at least with simple programs such as this one.</li>
<li>We use a <kbd>try...except</kbd> block to spawn the pool workers, in case there is a problem accessing a website. In this example, we use <kbd>map()</kbd> to place each URL in the list with the <kbd>urlopen</kbd> process.</li>
<li>Close the pool of workers then join them so the main process is suspended until the rest of the processes are complete.</li>
<li>Finally, print the time taken.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>The following screenshot shows some sample results:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/0e350067-3f7b-4f96-8e35-dba5367125d5.png" style="width:38.58em;height:11.08em;"/></div>
<ul>
<li>
<ul>
<li>Using the default value we gave the pool (four workers), the result is about 1 second. This is comparable to multithreading; while it could be ascribed to the fickleness of network connections, there is some overhead due to launching larger-weight processes rather than lightweight threads.</li>
<li>Dropping the pool to 1 gives us a time of about 3 seconds. Again, this is comparable to the average time of 10 runs for a single-threaded application, which makes sense as this is exactly the same thing.</li>
<li>Bumping the pool to two workers takes about half the time of a single one, as it should be.</li>
<li>Using eight workers yields slightly more than half the time of four workers, showing that processing time decreases linearly the more CPUs you can throw at it.</li>
</ul>
</li>
</ul>
<ol start="3">
<li>As this author's computer has eight cores, eight workers is probably about the best we can expect in terms of performance. To confirm this, the following shows the results of throwing more workers in the pool:</li>
</ol>
<div class="standard CDPAlignCenter CDPAlign"><img src="images/88cadc8e-03cb-4261-b0eb-25613eb90bcd.png" style="width:42.08em;height:8.25em;"/></div>
<ul>
<li>
<ul>
<li>With 10 workers (two more than the number of CPUs available), the speed is actually worse than using eight workers.</li>
<li>However, with 20 workers, the program speed is 16% faster. Realistically, the difference in speed is due to network issues and not the speed of the computer. Again, with only eight cores, putting more workers in the pool doesn't help anything because only eight workers can perform tasks simultaneously.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>One thing to note about <kbd>multiprocessing.pool()</kbd>: if you don't provide an integer argument to specify the number of workers in the pool, the program will default to all the CPUs available in your system. If you have a dual-core system, you'll get two workers. Have a monster of a system with 48 cores, then you get 48 workers.</p>
<p>When it comes to cores, if you have Intel CPUs with hyper-threading, each individual CPU counts as two when it comes to multiprocessing. So, if you plan on writing a lot of parallelized software, it may be better to spend the extra money and maximize the number of hyper-threaded CPUs you can get.</p>
<p>The <kbd>map()</kbd>&#160;function is a function that applies another function over a sequence, typically a list. It takes a little getting used to (at least for me), but once you figure it out, it's a great shortcut too. To use single-threaded web retrieval code as an example, you could rewrite the <kbd>for</kbd> loop as <kbd>map(urllib.request.urlopen, urls)</kbd>. It's important to remember that the items you're passing to the function are in a sequence (list, tuple, dictionary, and so on), otherwise you'll get an error.</p>
<p>Combining <kbd>map()</kbd> with <kbd>Pool()</kbd> eliminates a lot of the manual templating you have to do otherwise. One thing to note, though, is that you'll probably want to adjust the number of processes created. While <kbd>Pool()</kbd> defaults to all the CPUs it finds, you can give it an integer argument, explicitly telling it how many processes to start, that is, more or less than the number of CPUs you actually have. To get maximum performance, you'll have to adjust your program until you get diminishing returns.</p>
<p>This is also important if your program is going to be running for a long time. You don't want to use all your processing power for the program if you're going to be running it on your main computer, otherwise it will make your computer unavailable. When first learning how to write parallel programs, this author's dual-core system was unusable for more than 20 minutes just testing to see what the performance difference was between multi- and single-processing.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with Python's Math Module</h1>
                </header>
            
            <article>
                
<p>In <span>this chapter, we will cover Python's</span> <kbd>math</kbd> <span>module and the various mathematical functions provided in it. We will also talk about math-related modules, including cryptography and statistics. Specifically, we will discuss the following topics:</span></p>
<ul>
<li>Using the math module's functions and constants</li>
<li>Working with complex numbers</li>
<li>Improving decimal numbers</li>
<li>Increasing accuracy with fractions</li>
<li>Working with random numbers</li>
<li>Using the secrets module</li>
<li>Implementing basic statistics</li>
<li>Improving functionality with comath</li>
</ul>
<p>Python uses a hierarchy of abstract base classes to represent number-like classes. While the types defined by the abstract classes cannot be instantiated, they are used to create a numbers tower of subclasses: number -&gt; complex -&gt; real -&gt; rational -&gt; integral.</p>
<p>The reason for this is to allow functions that accept numbers as arguments to determine the properties of the arguments, thus allowing for backend functionality to be applied without user intervention. For example, slicing requires arguments to be integrals, whereas math module functions require real numbers as arguments. By ensuring these number classes are used, Python can provide for inherent functionality, for example, arithmetic operations, concatenation, and so on, as determined by the types used.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the math module's functions and constants</h1>
                </header>
            
            <article>
                
<p>Python's <kbd>math</kbd> module is built in; therefore, it is always available for import. The mathematical functions contained within it are defined by the C standard, so if something doesn't work, blame the C developers.</p>
<p>Complex numbers are handled by a separate module (<kbd>cmath</kbd>), so the math module can only be used with integers and floating point numbers. This was done on purpose, as dealing with complex numbers requires more effort than most people need for general functions. Unless otherwise indicated, all math arguments can be integers or floats.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>The <kbd>ceil(x)</kbd>&#160;function returns the smallest integer <kbd>&gt;= x</kbd>. Normal mathematical rounding is not used, so&#160;<kbd>12.3</kbd> will be rounded up to <kbd>13</kbd>, rather than rounding up starting at <kbd>12.5</kbd>; any value greater than <kbd>x.0</kbd> will be rounded up to the next value, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/efda8ea8-66ce-4652-90a3-3632f87236f1.png" style="width:35.00em;height:13.25em;"/></div>
<ol start="2">
<li>The <kbd>copysign(x, y)</kbd>&#160;function returns a float value with an absolute value of <kbd>x</kbd> but with the sign of&#160;<kbd>y</kbd>. If the OS supports signed zeros, <kbd>copysign(1.0, -0.0)</kbd> gives the value <kbd>-1.0</kbd>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/09b0fe5d-eb44-4565-956c-b0d637858924.png" style="width:37.42em;height:14.17em;"/></div>
<ol start="3">
<li>The&#160; <kbd>fabs(x)</kbd>&#160;function returns the absolute value of an argument, effectively stripping the sign from the argument:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/fea0b7e3-fd77-4e01-81fd-8c97d9cb9a65.png" style="width:35.00em;height:13.25em;"/></div>
<ol start="4">
<li>The&#160; <kbd>factorial(x)</kbd>&#160;function returns the factorial of <kbd>x</kbd>; if the argument is not integral or is negative, an error is generated:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/1361186f-1c8c-4d9a-ae6f-a64822363294.png" style="width:34.17em;height:22.25em;"/></div>
<ol start="5">
<li>The&#160; <kbd>floor(x)</kbd>&#160;function returns the largest integer <kbd>&lt;= x</kbd>. Like <kbd>ceil</kbd>, normal rounding is ignored; in this case, floating point values are truncated, converting them into integers:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/b83a2e32-c096-4afa-b8cb-003863c2813a.png" style="width:33.33em;height:11.08em;"/></div>
<ol start="6">
<li>The&#160;<kbd>fmod(x, y)</kbd>&#160;function returns the modulus of the two arguments. This is defined by the operating system's C library, so results may vary depending on the platform. It differs from the normal <kbd>x % y</kbd> operation in that <kbd>fmod</kbd> returns a result with the same sign as <kbd>x</kbd> and is mathematically precise for float types; the normal modulus returns with the sign from <kbd>y</kbd> and can produce rounding errors. Hence, <kbd>fmod</kbd> should be used for float types while normal modulus should be used for integers:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/5effd3bd-6101-4d50-a5a6-ec4d41bc1ff0.png" style="width:36.50em;height:14.67em;"/></div>
<p style="padding-left: 60px">Here, <em>line 24</em> shows that <kbd>fmod</kbd> can provide the correct value for large exponent values, including the sign. The <em>line 25</em> shows the results of normal modulus operation, which rounds to the incorrect value of zero.</p>
<ol start="7">
<li>The&#160;<kbd>frexp(x)</kbd>&#160;function returns the mantissa (the decimal part of a number) [<kbd>m</kbd>] and exponent [<kbd>e</kbd>] of <kbd>x</kbd>. <kbd>m</kbd> is a float and <kbd>e</kbd> is an integer such that <kbd>m * 2**e = x</kbd>. This function is commonly used to see the internal representation of a float value in a portable manner:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/bbcc3981-4dba-4b33-bc69-4934459402ba.png" style="width:35.00em;height:13.17em;"/></div>
<ol start="8">
<li>The&#160;<kbd>fsum(iterable)</kbd>&#160;function returns a floating point sum of values from an iterable. This avoids precision issues found in the default <kbd>sum()</kbd> function by tracking intermediate partial sums, though the accuracy depends on the operating system, as the backend C library can cause rounding errors:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/896abef1-3823-4bc7-bbb0-d57ced978229.png" style="width:38.67em;height:9.25em;"/></div>
<ol start="9">
<li>The&#160;<kbd>gcd(a, b)</kbd>&#160;function returns the greatest common divisor of two integer arguments:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/01a347de-dd59-4a03-8d64-6c2edc72053a.png" style="width:33.92em;height:12.83em;"/></div>
<ol start="10">
<li>The&#160;<kbd>isclose(a, b, *, rel_tol=1e-09, abs_tol=0.0)</kbd>&#160;function returns <kbd>True</kbd> if <kbd>a</kbd> and <kbd>b</kbd> are close to each other in value and returns <kbd>False</kbd> if not. The determination of <em>close enough</em>&#160;comes from the relative and absolute tolerances.<br/>
Relative tolerance (<kbd>rel_tol</kbd>) is the maximum difference allowed between the arguments, relative to the larger absolute value of <kbd>a</kbd> or <kbd>b</kbd>. The default value ensures that the two argument values are the same to nine decimal places.<br/>
Absolute tolerance (<kbd>abs_tol</kbd>) is the minimum allowed difference; it is particularly useful when comparing values close to zero:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/7a9b55d8-daa5-40e8-bf6b-b1996f44c6c6.png" style="width:35.67em;height:16.75em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 44</em> is just a simple check that compares the exact same values.</li>
<li><span>The</span><span>&#160;</span><em><span>l</span>ine 45</em> rounds the first argument to the eighth decimal place and compares it using default values.</li>
<li><span>The</span><span>&#160;</span><em><span>l</span>ine 46</em> compares values at two decimal places. Using the default values, they are not close in value, even though they differ by only 1/100.</li>
<li><span>The</span><span>&#160;</span><em><span>l</span>ine 47</em> uses the same values as <em>line 46</em>, but changes the relative tolerance to 5%. With this change, they are considered close to each other.</li>
<li><span>The</span><span>&#160;</span><em><span>l</span>ine 48</em> does a similar thing, except it is looking at values close to zero, so absolute tolerance is changed from 0% different to 5%.</li>
</ul>
</li>
</ul>
<ol start="11">
<li>The&#160;<kbd>isfinite(x)</kbd>&#160;function returns <kbd>True</kbd> if <em><kbd>x</kbd></em> is a finite number, that is, not <kbd>inf</kbd>&#160;or <kbd>NaN</kbd>; it returns <kbd>False</kbd> only if the argument is infinite or not a number. The number 0.0 is considered a finite number:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/773785fe-efef-467e-b18d-9d4be913a46b.png" style="width:34.67em;height:18.58em;"/></div>
<ol start="12">
<li>The&#160;<kbd>isinf(x)</kbd>&#160;function returns <kbd>True</kbd> if the argument is&#160;<kbd>±∞</kbd>;&#160; it returns <kbd>False</kbd> for any other value:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/81210a58-75a7-42ba-a355-e65109e60bc2.png" style="width:37.50em;height:15.92em;"/></div>
<ol start="13">
<li>The&#160;<kbd>isnan(x)</kbd>&#160;function returns <kbd>True</kbd> if argument is <kbd>NaN</kbd> (not a number), and&#160;<kbd>False</kbd> otherwise:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/64f507d8-8108-4900-b70c-dd1a4119e67e.png" style="width:38.33em;height:12.75em;"/></div>
<ol start="14">
<li>The&#160;<kbd>ldexp(x, i)</kbd>&#160;function is the inverse of <kbd>frexp()</kbd> and returns <kbd>x * 2<sup>i</sup></kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/e95df07c-bedd-4441-95dd-e59d53bce123.png" style="width:38.33em;height:10.08em;"/></div>
<p style="padding-left: 60px">The preceding screenshot uses the results of the previous&#160;<kbd>frexp()</kbd> screenshot, demonstrating that the process is reversed to find the original floating point value.</p>
<ol start="15">
<li>The&#160; <kbd>modf(x)</kbd>&#160;function returns the integer and fractional parts of the argument; both returned values are floats with the sign of the argument:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/3558cf99-2f71-4b25-8753-71b5f15f3a24.png" style="width:34.67em;height:11.50em;"/></div>
<p style="padding-left: 60px" class="mce-root CDPAlignLeft CDPAlign">Notice that the fractional parts have rounding errors. Limiting the results to the minimum-needed precision may help alleviate this for display, but computations using the raw values may have significant errors propagated through the calculations.</p>
<ol start="16">
<li>The&#160;<kbd>trunc(x)</kbd>&#160;function returns the truncated integral part of a real number, that is, it converts a float to an integer:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/24f44147-f5d7-48f2-bf40-7c90d058e4da.png" style="width:36.00em;height:12.00em;"/></div>
<ol start="17">
<li>The&#160;<kbd>exp(x)</kbd>&#160;function returns <kbd>e<sup>x</sup></kbd>, where <kbd>e</kbd> is the natural log:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/59276551-64fa-4ab1-b8de-c3164bf2a2b1.png" style="width:36.75em;height:12.25em;"/></div>
<ol start="18">
<li>The&#160;<kbd>expm1(x)</kbd>&#160;function returns <kbd>e<sup>x</sup> - 1</kbd>. This is primarily for small values of <kbd>x</kbd>, as manual calculation can cause a loss in precision. Using <kbd>expm1()</kbd> maintains the precision without rounding errors:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/9a5cbd83-440a-4c58-9b61-28cb4953f620.png" style="width:33.92em;height:8.92em;"/></div>
<p style="padding-left: 60px" class="mce-root CDPAlignLeft CDPAlign">When the exponent is <kbd>-9</kbd>, that is, <kbd>0.000000001</kbd>, significant rounding errors occur when manually creating the formula <kbd>e<sup>x</sup> - 1</kbd>. Using <kbd>expm1</kbd>, full precision is maintained.</p>
<ol start="19">
<li>The&#160;<kbd>log(x[, base])</kbd>&#160;function returns the natural log of <kbd>x</kbd> when provided one argument; two arguments provides the log of <kbd>x</kbd> to a given base:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/dfd51747-e673-497b-9979-5ae7e6e16fc1.png" style="width:32.42em;height:10.00em;"/></div>
<ol start="20">
<li>The&#160; <kbd>log1p(x)</kbd>&#160;function returns the base <kbd>-e</kbd> log of <kbd>1 + x</kbd> . The result is calculated to maximize accuracy when <kbd>x</kbd> is near zero:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/63463908-83c1-440d-97a9-1a8c34b96443.png" style="width:33.75em;height:10.42em;"/></div>
<ol start="21">
<li>The&#160;<kbd>log2(x)</kbd>&#160;function returns the base <kbd>-2</kbd> log of <kbd>x</kbd>. This is more accurate than using <kbd>log(x, 2)</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/d9444b88-076d-4ef1-a996-185c096356b1.png" style="width:33.75em;height:25.08em;"/></div>
<p style="padding-left: 60px">As shown in this screenshot, the accuracy of <kbd>log2</kbd> doesn't really become a factor until the number of decimal places for the argument exceeds 30.</p>
<ol start="22">
<li>The&#160;<kbd>log10(x)</kbd>&#160;function returns the base <kbd>-10</kbd> log of <kbd>x</kbd>. Like <kbd>log2</kbd>, it is generally more accurate than <kbd>log(x, 10)</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/2d42957c-de41-4417-989d-e23d7d3ac1de.png" style="width:36.25em;height:14.50em;"/></div>
<p style="padding-left: 60px">In this case, the example shows accuracy differs when arguments are greater than 40 decimal places. Of course, individual results will differ depending on the use case, so it's probably best to use the functions provided by the module.</p>
<ol start="23">
<li>The&#160;<kbd>pow(x, y)</kbd>&#160;function returns <kbd>x<sup>y</sup></kbd>. The <kbd>math.pow()</kbd> function converts arguments to float types; to calculate exact integer values, use the built-in <kbd>pow()</kbd> function or the <kbd>**</kbd> operator:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/3a5d7f98-5e78-4c68-a6ea-0962568d341c.png" style="width:33.08em;height:15.50em;"/></div>
<ul>
<li>
<ul>
<li>The <em>lines 116</em> and<em>&#160;line 117</em> compare the output when using the built-in <kbd>pow</kbd> versus&#160;<kbd>math.pow</kbd>.</li>
<li>The <em>line 119</em> and <em>line&#160;120</em> show a discrepancy in the underlying library. When either argument is zero or <kbd>NaN</kbd>, the result is <kbd>1.0</kbd>, even if an error would be expected. While Python attempts to follow the C99 standards as much as possible, there are limits, and this is one of them.</li>
</ul>
</li>
</ul>
<ol start="24">
<li>The&#160;<kbd>sqrt(x)</kbd>&#160;function returns the <kbd>√x</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/3dab7c7f-1873-40bd-a2c7-63707e09ff2a.png" style="width:32.83em;height:13.92em;"/></div>
<p style="padding-left: 60px">As shown in <em>line 123</em>, taking the root of a negative number yields an error, as expected. To deal with square roots of negative numbers, you have to use the <kbd>cmath</kbd> module.</p>
<ol start="25">
<li>The&#160;<kbd>acos(x)</kbd>&#160;function returns the arc cosine of <kbd>x</kbd>, in radians:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/e986e666-80d6-4aa5-a45a-ecfd68ea2976.png" style="width:37.00em;height:18.17em;"/></div>
<p style="padding-left: 60px">As expected, an argument <kbd>&gt;1</kbd> will return an error, since when converted from radians to decimals, values are always less than one.</p>
<ol start="26">
<li>The&#160;<kbd>asin(x)</kbd>&#160;function returns the arc sign of <kbd>x</kbd>, in radians:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/72d7bc1f-c759-49e0-8e2b-3ab1ac3efff2.png" style="width:35.92em;height:16.00em;"/></div>
<p style="padding-left: 60px" class="mce-root CDPAlignLeft CDPAlign">Again, values <kbd>&gt;1</kbd> result in errors, so ensure you convert your argument to the correct radian value first.</p>
<ol start="27">
<li>The&#160;<kbd>atan(x)</kbd>&#160;function returns the arc tangent of <kbd>x</kbd>, in radians:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/955848b2-f2f4-46b6-9d2a-e8ce9c6ab33a.png" style="width:34.83em;height:11.58em;"/></div>
<ol start="28">
<li>The&#160;<kbd>atan2(y, x)</kbd> returns the result of <kbd>atan(y / x)</kbd>, in radians and between the values of <kbd>-π</kbd>&#160;to&#160; <kbd>π</kbd> . The vector from origin to <kbd>(x,y)</kbd> makes the angle in the first quadrant, that is, the positive <em>X&#160;</em>axis. This means that <kbd>atan2</kbd> can compute the correct quadrant for the angle since the signs for both arguments are known:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/adb2003a-ced1-442a-ae92-3097702f3a37.png" style="width:36.58em;height:12.17em;"/></div>
<ol start="29">
<li>The&#160;<kbd>hypot(x, y)</kbd> returns the hypotenuse of a triangle with sides of length <kbd>x</kbd> and <kbd>y</kbd><em>.</em> Basically, this is a shortcut of the Pythagorean theorem: <em>√(x<sup>2</sup> + y<sup>2</sup>)</em>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/5af23f27-03a8-4a17-8050-aded17d2a9dc.png" style="width:35.83em;height:11.92em;"/></div>
<ol start="30">
<li>The&#160;<kbd>cos(x)</kbd><span>&#160;function&#160;</span>returns the cosine of<span>&#160;</span><kbd>x</kbd>&#160;in radians.</li>
<li>The&#160;<kbd>sin(x)</kbd> <span>function&#160;</span>returns the sine of <kbd>x</kbd> in radians.</li>
<li>The&#160;<kbd>tan(x)</kbd> <span>function&#160;</span>returns the tangent of <kbd>x</kbd> in radians.</li>
<li>The&#160;<kbd>degrees(x)</kbd> function returns the conversion of the argument from radians to degrees:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/5eb5216a-a858-4718-a02b-bdc8f3581e69.png" style="width:36.08em;height:12.00em;"/></div>
<ol start="34">
<li>The&#160;<kbd>radian(x)</kbd> <span>function&#160;</span>returns the conversion of degrees to radians:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/427cea25-acf3-483e-a5f0-65cdab2f0204.png" style="width:35.58em;height:11.83em;"/></div>
<ol start="35">
<li>To save space, I won't provide examples of all the following, but here is a list of the hyperbolic trigonometric functions available in Python: <kbd>acosh(x)</kbd><em>,</em> <kbd>asinh(x)</kbd><em>,</em> <kbd>atanh(x)</kbd><em>,</em> <kbd>cosh(x)</kbd><em>,</em> <kbd>sinh(x)</kbd><em>,</em> and <kbd>tanh(x)</kbd>. These operate in the same way as the normal trigonometric functions, except they are used for hyperbolas instead of circles.</li>
</ol>
<ol start="36">
<li>The&#160;<kbd>erf(x)</kbd> <span>function&#160;</span>returns the error function, that is, the Gauss error function, at <kbd>x</kbd>. This is used to calculate statistical functions such as the cumulative standard normal distribution, as demonstrated at <a href="https://docs.python.org/3/library/math.html">https://docs.python.org/3/library/math.html</a>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><a href="https://docs.python.org/3/library/math.html"><img src="images/d2ef31b2-81d0-4086-8570-cc6481cb1aaf.png" style="width:38.33em;height:21.42em;"/></a></div>
<ol start="37">
<li>The&#160;<kbd>erfc(x)</kbd> <span>function&#160;</span>returns the complementary error function at <kbd>x</kbd><em>,</em> which is defined as <kbd>1.0 - erf(x)</kbd>. This is used for large values of <kbd>x</kbd> where subtraction would cause a loss in significance:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/b54c5f86-dbfd-4e88-b88a-ed188e7e4149.png" style="width:35.25em;height:13.25em;"/></div>
<ol start="38">
<li>The&#160;<kbd>gamma(x)</kbd> <span>function&#160;</span>returns the Gamma function at <kbd>x</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/50e2a711-bbcc-4650-8a67-2fdc36dd5596.png" style="width:35.83em;height:16.83em;"/></div>
<ol start="39">
<li>The&#160;<kbd>lgamma(x)</kbd> <span>function&#160;</span>returns the natural log of the absolute value of the Gamma function at <kbd>x</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="images/2ce28ad0-306b-458e-8cda-56d655d06621.png" style="width:37.08em;height:17.42em;"/></div>
<ol start="40">
<li>The&#160;<kbd>pi</kbd> represents the value of Pi (3.14...) to the operating system's available precision.</li>
<li>The&#160;<kbd>e</kbd> represents the value of Euler's number (2.718...) to the system's available precision.</li>
<li>The&#160;<kbd>tau</kbd> represents the constant <kbd>2pi</kbd> (6.28...) to the system's available precision.</li>
<li>The&#160;<kbd>inf</kbd> represents the float type <kbd>∞</kbd>. <kbd>- ∞</kbd> is represented by <kbd>-inf</kbd>.</li>
<li>The&#160;<kbd>nan</kbd> represents the float type <kbd>not a number</kbd>.</li>
</ol>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with complex numbers</h1>
                </header>
            
            <article>
                
<p>Because complex numbers, that is, numbers that have an imaginary element, cannot be used with the regular math module functions, the <kbd>cmath</kbd> module is available for these special numbers.</p>
<p>As a built-in module, it is always available for import. Of note, the functions accept integers, floats, and complex numbers as arguments. They will also accept any Python object that has a <kbd>__complex__()</kbd> or <kbd>__float__()</kbd> method as part of its class.</p>
<p>On systems that support signed zeros, branch cuts (<a href="https://en.wikipedia.org/wiki/Branch_point#Branch_cuts">https://en.wikipedia.org/wiki/Branch_point#Branch_cuts</a>) are continuous on both sides of the cut, as the sign of the zero designates which side of the cut the branch is on. On systems that do not support signed zeros, continuity is noted for the specific functions in the next section.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>The following functions and constants operate like their normal math cousins, except where noted:</p>
<ul>
<li><kbd>exp(x)</kbd>: Calculate math constant <kbd>e</kbd> to the power of <kbd>x</kbd>.</li>
<li><kbd>log(x[, base])</kbd>: There is one branch cut<span>—</span>from <kbd>0</kbd>, along the negative real axis to&#160;<kbd>-∞</kbd>, and continuous from above.</li>
<li><kbd>log10(x)</kbd>: Same branch cut as <kbd>log</kbd></li>
<li><kbd>sqrt(x)</kbd>: Same branch cut as <kbd>log</kbd></li>
<li><kbd>acos(x)</kbd>: Two branch cuts—one from <kbd>1</kbd> to the right along the real axis to&#160;<kbd>∞</kbd>&#160;and continuous from below. The other extends left from <kbd>-1</kbd> to&#160;<kbd>-∞</kbd>&#160;and is continuous from above.</li>
<li><kbd>asin(x)</kbd>: Same branch cuts as <kbd>acos</kbd></li>
<li><kbd>atan(x)</kbd>: Two branch cuts: one from <kbd>1j</kbd>&#160;along the imaginary axis to&#160;<kbd>∞j</kbd>, continuous from the right. The other extends from <kbd><em>-</em>1j</kbd>&#160;to&#160;<kbd>-∞j</kbd>&#160;and continuous from the left.</li>
<li><kbd>cos(x)</kbd>: Calculate the cosine of <kbd>x</kbd>.</li>
<li><kbd>sin(x)</kbd>: Calculate the sine of <kbd>x</kbd>.</li>
<li><kbd>tan(x)</kbd>: Calculate the tangent of <kbd>x</kbd>.</li>
<li><kbd>acosh(x)</kbd>: One branch cut from <kbd>1</kbd> to the left along the real axis to&#160; <kbd>-∞</kbd>, continuous from above.</li>
</ul>
<ul>
<li><kbd>asinh(x)</kbd>: Two cuts—one from <kbd>1j</kbd> along the imaginary axis to&#160;<kbd>∞j</kbd>&#160;and continuous from the right. The other is from <kbd>-1j</kbd>&#160;along the imaginary axis to&#160;<kbd>-∞j</kbd>&#160;and continuous from the left.</li>
<li><kbd>atanh(x)</kbd>: Two cuts—one from 1 to real&#160;<kbd>∞</kbd>, continuous from above. The other is from <kbd>-1</kbd> to real&#160;<kbd>-∞</kbd>, continuous from above.</li>
<li><kbd>cosh(x)</kbd>: Calculate the hyperbolic cosine of <kbd>x</kbd>.</li>
<li><kbd>sinh(x)</kbd>: Calculate the hyperbolic sine of <kbd>x</kbd>.</li>
<li><kbd>tanh(x)</kbd>: Calculate the hyperbolic tangent of <kbd>x</kbd>.</li>
<li><kbd>pi</kbd>: Return the math constant π as a number.</li>
<li><kbd>e</kbd>: Return the math constant <em>e</em> as a number.</li>
<li><kbd>tau</kbd>: Return the math constant τ as a number.</li>
<li><kbd>inf</kbd>: Represent the floating-point value <kbd>∞</kbd>.</li>
<li><kbd>nan</kbd>: Represent the floating-point value "not a number".</li>
</ul>
<p>New constants in the <kbd>cmath</kbd> module include the following:</p>
<ul>
<li><kbd>infj</kbd>: Constant complex number with 0 real part and&#160;<kbd>∞j</kbd>&#160;imaginary part</li>
<li><kbd>nanj</kbd>: Constant complex number with 0 real part and <kbd>NaN</kbd> imaginary part</li>
</ul>
<p>Polar coordinates are supported within the <kbd>cmath</kbd> module. In Python, <kbd>z</kbd> represents the real part <kbd>z.real</kbd> and the imaginary part <kbd>z.imag</kbd>. Using polar coordinates, <kbd>z</kbd> is defined by the modulus <kbd>r</kbd> and the phase angle <kbd>φ</kbd> (phi):</p>
<ul class="enumerate">
<li>The&#160;<kbd>phase(x)</kbd> <span>function&#160;</span>returns the phase of <kbd>x</kbd> (provided as a complex number); the returned value is a float. The result is within the range of -π&#160;and&#160; π &#160;and the branch cut is along the negative real axis, continuous from above:</li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="color: black;font-size: 1em;width:33.17em;height:15.58em;" src="images/de2234e7-f2a8-408f-a156-d9c957864649.png"/></div>
<ul class="enumerate">
<li>The&#160;<kbd>polar(x)</kbd> <span>function&#160;</span>returns the phase of <kbd>x</kbd> in polar coordinates as a <kbd>(r, φ)</kbd> pair:</li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="color: black;font-size: 1em;width:37.58em;height:11.58em;" src="images/dceef515-6388-469d-a45a-fc74fd55584e.png"/></div>
<ul class="enumerate">
<li>The&#160;<kbd>rect(r, phi)</kbd> <span>function&#160;</span>returns the complex number <kbd>x</kbd> as a (real, imag) pair:</li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="color: black;font-size: 1em;width:38.08em;height:11.75em;" src="images/c6179529-18e2-4fd9-8fa8-102cc44ba119.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Improving decimal numbers</h1>
                </header>
            
            <article>
                
<p>Python's built-in decimal module provides improved support for fast, precise floating point calculations. Normal float types are based on binary objects; decimal floats are completely different. Specifically, it improves on the normal float type by doing the following:</p>
<ul>
<li>Operating like people learned in school, rather than forcing people to conform to a new arithmetic paradigm.</li>
</ul>
<ul>
<li>Representing decimal values exactly, rather than having results such as the following:</li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="font-size: 1em;color: black;width:38.58em;height:7.50em;" src="images/a1e727dc-27d1-4623-98b6-4c4307edf154.png"/></div>
<ul>
<li>
<p>Ensuring the exactness of decimal values is carried through calculations, preventing rounding errors from compounding.</p>
</li>
<li>Accounting for significant digits, for example, 1.20 + 2.10 = 3.20, not 3.2, and 1.20 * 1.30 = 1.5600.</li>
<li>Allowing for user-specified precision, up to 28 places. This is different from float, which is dependent upon the platform.</li>
<li>Normal, binary float types only have a small portion of their capabilities exposed to the user. Decimal floats expose all required parts of the standard, allowing full control of all calculations.</li>
<li>Supporting both exact, fixed-point arithmetic and rounded, floating-point arithmetic.</li>
</ul>
<p>Three main concepts apply to decimal floats: the decimal number itself, arithmetic context, and signal handling. Decimal numbers are immutable, signed, and significant, that is, trailing zeros aren't truncated. Arithmetic context specifies things such as precision, rounding, exponent limits, and so on. Signals are exceptional conditions and are handled depending on the application needs.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Because the official documentation (<a href="https://docs.python.org/3/library/decimal.html">https://docs.python.org/3/library/decimal.html</a>) comprises more than 35 pages, this section will only provide a brief examination of the decimal module:</p>
<ol class="enumerate">
<li>
<p>When using the decimal module, it is a good idea to figure out what the current conditions are and modify them, if needed:</p>
</li>
</ol>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/44dc0684-7f2a-4506-a547-753e9d810fb2.png" style="width:38.33em;height:10.08em;"/></div>
<p style="color: black;padding-left: 90px" class="standard">In this case, <kbd>getcontext</kbd> tells us the following:</p>
<ol>
<li>
<ul>
<li>The system is set for 28 places of precision.</li>
<li>Rounding is to the nearest whole value with ties going to the nearest even integer.</li>
<li>Emin and Emax are the bottom/top limits allowed for exponents.</li>
<li>Capital letters are used for designating exponents, for example, <em>1.2E+12</em>.</li>
<li>Clamping is set to allow exponents to be adjusted to, at most, <kbd>Emax</kbd>.</li>
<li>Flags monitor for exceptional conditions and remain until explicitly cleared. This is one reason why checking the context is one of the first things to do, to ensure no undesired flags are still set.</li>
<li>Traps capture the designated conditions and raise errors when they occur.</li>
</ul>
</li>
<li>Decimals can be created from integers, floats, strings, or tuples:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="font-size: 1em;color: black;width:37.42em;height:20.08em;" src="images/0e3acda8-0984-4677-8253-9ac16655da0f.png"/></div>
<ol class="enumerate" start="3">
<li>One signal worth using is <kbd>FloatOperation</kbd>, as it will warn when mixing decimals and floats in constructors or ordering comparisons:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="font-size: 1em;color: black;width:35.42em;height:23.83em;" src="images/d7310cb7-c73f-438b-8c4f-76569b8d29a9.png"/></div>
<ol class="enumerate" start="4">
<li>Decimal point significance, when declaring a new <kbd>Decimal</kbd>, is determined only by the number of digits provided. Rounding and precision only applies during arithmetic operations:</li>
</ol>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/68f52ad6-e9c2-4d0b-bd08-1db884c16704.png" style="width:36.42em;height:19.58em;"/></div>
<p style="color: black;padding-left: 60px" class="standard">Notice that a precision value of 4 means only four digits will be displayed, regardless of how many values after the decimal point are provided.</p>
<ol start="5">
<li>Here's a brief example of how decimal objects interact with other Python objects:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="font-size: 1em;color: black;width:33.67em;height:48.08em;" src="images/68dc6cb8-3284-46fd-8c3d-4d298595c9df.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Increasing accuracy with fractions</h1>
                </header>
            
            <article>
                
<p>The <kbd>fractions</kbd> module adds support for rational number arithmetic to Python. Rather than using <em>x/y</em> to represent a fraction, true, precise fractions can be written; the former method returns a float type which may or not not be truly accurate.</p>
<p>A constructor is available to create a fraction from integer pairs, from another fraction, a float, a decimal, or a string. If the denominator is 0, a <kbd>ZeroDivisionError</kbd> is generated.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p><span>The following properties and methods are available for the fractions class:</span></p>
<ul class="enumerate">
<li><kbd>numerator</kbd>: This returns the numerator in the lowest term.</li>
<li><kbd>denominator</kbd><span>: This returns the denominator in the lowest term.</span></li>
<li><kbd>from_float(float)</kbd><span>: This is constructor that takes a float type and creates a fraction representing the exact value of the argument. It's generally easier to just make a fraction instance directly from a float.</span></li>
<li><kbd>from_decimal(dec)</kbd><span>: This is a constructor that takes a decimal instance and creates a fraction representing the exact value of the argument. It's generally easier to just make a fraction instance directly from a decimal instance.</span></li>
<li><kbd>limit_denominator(max=1000000)</kbd><span>: This returns the closest fraction to the argument that has a denominator no greater than</span> <kbd>max</kbd><span>. It is useful for approximating floats.</span></li>
<li><kbd>__floor__()</kbd><span>: This returns the greatest integer <kbd>&lt;=</kbd> the fraction. It is also available via</span> <kbd>math.floor()</kbd><span>.</span></li>
<li><kbd>__ceil__()</kbd><span>: This returns the least integer <kbd>&gt;=</kbd> the fraction. It is also available via</span> <kbd>math.ceil()</kbd><span>.</span></li>
<li><kbd>__round__(); __round__(n)</kbd><span>: The first method returns the integer closest to the fraction, rounding half to even. The second method rounds the fraction to the nearest multiple of</span> <kbd>Fraction(1, 10**n)</kbd><span>, rounding half to even. It is also available via</span> <kbd>round()</kbd><span>.</span></li>
<li><kbd>gcd(a, b)</kbd><span>: This returns the greatest common divisor of the two arguments. It has been deprecated since <kbd>v3.5</kbd> in lieu of</span> <kbd>math.gcd()</kbd><span>.</span></li>
</ul>
<p style="color: black">The following screenshot shows some use cases for the fraction module:</p>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/bee692e2-53e5-4bab-ac32-c55a74c0f267.png" style="width:34.67em;height:23.33em;"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working with random numbers</h1>
                </header>
            
            <article>
                
<p>The math-oriented <kbd>random</kbd> module utilizes a <strong>pseudo-random number generator</strong> (<strong>PRNG</strong>) for use in various applications. It is designed for modeling and simulation purposes and should not be used for any security or cryptography programs.</p>
<p>PRNGs use a seed value as an argument to the generator. This allows for re-creation of randomized scenarios or determining what random value will be generated next in a sequence; hence, they are not cryptographically secure. A common application of a PRNG is in security key fobs; the PRNG in the fob is provided with the same seed value as on the server. Thus, the server and the fob will have the same number available at the exact same time, allowing a user to input the number as a second form of authentication.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Note that examples are provided where output is generated for a command. Also note that, as these are randomized values, your results may be different:</p>
<ul>
<li>The <kbd>seed(a=None, version=2)</kbd>&#160;function initializes the PRNG. If <kbd>a</kbd> is <kbd>None</kbd>, any system-based randomness sources that are available will be used to generate the seed; otherwise, the current system time is used for the seed value. If <kbd>a</kbd> is an integer, then it will be used directly as the seed value.<br/>
<kbd>version</kbd> can be 1 or 2. The default is 2, meaning strings, bytes, and bytearrays will be converted to integers and all bits will be used for the seed. If version 1 is used (necessary when working with versions prior to 3.2), the conversion to integer creates a smaller range of seed values.</li>
<li>The <kbd>getstate()</kbd>&#160;function returns an object that captures the internal state of the PRNG.</li>
<li>The <kbd>setstate(state)</kbd>&#160;function restores the internal generator state to the value of <kbd>state</kbd>. Used in conjunction with <kbd>getstate</kbd>, this allows for setting the PRNG to a previous condition.</li>
<li>The <kbd>getrandbits(k)</kbd>&#160;function returns an integer comprised of <kbd>k</kbd> random bits:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="images/d38f8e4a-fb80-4855-a002-72f1e967b049.png" style="width:39.17em;height:14.83em;"/></div>
<ul>
<li>The <kbd>randrange(stop); randrange(start, stop[, step])</kbd>&#160;function returns a randomly selected value from a range of numbers; essentially, it turns the <kbd>range</kbd> function into a random-number picker, limited to the integer range it generates:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="images/3a7a33d2-ea39-489c-9e2f-fd6f585f1bde.png" style="width:36.25em;height:8.75em;"/></div>
<ul>
<li>The <kbd>randint(a, b)</kbd>&#160;function returns a random integer that is between <kbd>a</kbd> and <kbd>b</kbd>, inclusive:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="images/2d5ef35d-8e29-42d7-8e65-304a24ade43a.png" style="width:37.67em;height:7.42em;"/></div>
<ul>
<li>The <kbd>choice(seq)</kbd>&#160;function returns a random element from a pre-made sequence. Whereas <kbd>randrange</kbd> creates a range of numbers; if the sequence argument is empty, an error will be generated.</li>
<li>The <kbd>choices(population, weights=None, *, cum_weights=None, k=1)</kbd>&#160;function returns a <kbd>k</kbd>-sized list of elements, selected from a pre-made <kbd>population</kbd> with replacement.</li>
<li><kbd>weights</kbd> allows selection based on relative weights of a <kbd>weights</kbd> sequence, whereas&#160;<kbd>cum_weights</kbd> makes selections based on the cumulative weights of a sequence. If neither argument is provided, then selections are based using equal probability.</li>
<li><kbd>shuffle(x[, random])</kbd> function shuffles a provided sequence in place. The&#160;<kbd>random</kbd>&#160;function is actually a function that returns a random float; by default it is the function <kbd>random()</kbd>.</li>
<li><kbd>sample(population, k)</kbd> function returns a <kbd>k</kbd>-length list of unique elements from a provided sequence or set; it provides for random sampling without replacement. It returns a new list with elements from the original sequence without affecting the original.</li>
<li><kbd>random()</kbd> function returns a random float in the range from 0.0 (inclusive) to 1.0 (exclusive).</li>
</ul>
<ul>
<li><kbd>uniform(a, b)</kbd> function returns a random float between the values of <kbd>a</kbd> and <kbd>b</kbd>, inclusive.</li>
<li><kbd>triangular(low, high, mode)</kbd> function returns a random float between <kbd>low</kbd> (default = 0) and <kbd>high</kbd> (default = 1), with the specified <kbd>mode</kbd> (default = midpoint).</li>
<li><kbd>betavariate(alpha, beta)</kbd> function creates a beta distribution, based on <kbd>alpha</kbd> and <kbd>beta</kbd> both &gt; 0. Values returned are between 0 and 1.</li>
<li><kbd>expovariate(lambd)</kbd> function creates an exponential distribution. <kbd>lambd</kbd> is 1.0 divided by the desired mean and should be non-zero. Values returned are 0 to ∞&#160;if <kbd>lambd</kbd> is positive and - ∞ &#160;to 0 if negative.</li>
<li><kbd>gammavariate(alpha, beta)</kbd> function creates a Gamma distribution, based on <kbd>alpha</kbd> and <kbd>beta</kbd> both &gt; 0.</li>
<li><kbd>gauss(mu, sigma)</kbd> function creates a Gaussian distribution (bell curve);&#160;<kbd>mu</kbd> is the mean and <kbd>sigma</kbd> the standard deviation. This function is faster than <kbd>normalvariate()</kbd>, but only slightly because it is not thread-safe.</li>
<li><kbd>lognormvariate(mu, sigma)</kbd> function creates a log-normal distribution;&#160;<kbd>mu</kbd> can be any value but <kbd>sigma</kbd> must be &gt; 0.</li>
<li><kbd>normalvariate(mu, sigma)</kbd> function creates a normal distribution;&#160;<kbd>mu</kbd> is the mean and <kbd>sigma</kbd> the standard deviation. This is thread-safe to avoid race conditions.</li>
<li><kbd>vonmisesvariate(mu, kappa)</kbd> function creates a <strong>bivariate von Mises</strong><span>&#160;</span><span>(<strong>BVM</strong>)</span> distribution<span>&#160;</span>to describe values on a torus;&#160;<kbd>mu</kbd> is the mean angle, expressed in radians between 0 and 2*π, and <kbd>kappa</kbd> is the concentration parameter, which is &gt;= 0. If <kbd>kappa</kbd> = 0, this distribution reduces to a uniform random angle over the range 0 to 2* π .</li>
<li><kbd>paretovariate(alpha)</kbd> function creates a Pareto distribution; <kbd>alpha</kbd> is a shape parameter.</li>
<li><kbd>weibullvariate(alpha, beta)</kbd> function creates a Weibull distribution;&#160;<kbd>alpha</kbd> is a scale parameter and <kbd>beta</kbd> is the shape parameter.</li>
<li><kbd>SystemRandom([seed])</kbd> function uses <kbd>os.urandom()</kbd> to create random numbers from OS sources but is not available on all systems. As it is not software based, the results are not reproducible, that is, this is for truly random numbers, such as for cryptography.</li>
</ul>
<p>The following screenshot contains examples of how some of the <kbd>random</kbd> functions operate:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/b5aedf4c-2311-4d53-954e-920637357515.png" style="width:32.75em;height:51.92em;"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the secrets module</h1>
                </header>
            
            <article>
                
<p>This module, while not part of the math set, is important because it makes random numbers that are cryptographically secure. Thus, we will look at how this module differs from the random module.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ul>
<li><kbd>SystemRandom</kbd> class is the same as the <kbd>random.SystemRandom</kbd> class, that is, it provides random numbers and uses the best quality random seeding sources of the system.</li>
<li><kbd>choice(sequence)</kbd> method also works just like the <kbd>random.choice()</kbd> method.</li>
<li><kbd>randbelow(n)</kbd> function returns a random integer in the range <kbd>[0, n)</kbd>.</li>
<li><kbd>randbits(k)</kbd> method returns an integer with <kbd>k</kbd> random bits.</li>
<li><kbd>token_bytes([nbytes=None])</kbd> function returns a random byte string. If <kbd>nbytes</kbd> is not provided, a reasonable default is used; if provided, the returned string contains that many bytes.</li>
<li><kbd>token_hex([nbytes=None])</kbd> function returns a random text string in hex. The bytes used in the string are converted to two hex digits each.</li>
<li><kbd>token_urlsafe([nbytes=None])</kbd> function returns a random, URL-safe text string of random bytes. The string is Base64-encoded, so the average byte returned is roughly 1.3 characters.</li>
<li><kbd>compare_digest(a, b)</kbd> function returns <kbd>True</kbd> if the arguments are equal and <kbd>False</kbd> if not. The functionality is such that the ability to use timing attacks is reduced.</li>
</ul>
<ul>
<li>Here are some examples using parts of the <kbd>secrets</kbd> module:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="images/fc2578ee-cd83-47f7-8503-d52f19441a64.png" style="width:35.00em;height:26.83em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 3</em> creates a string of all the letters in the ASCII alphabet and all digits.</li>
<li>The <em>line 4</em> creates a simple password of 12 characters, using all the available alphanumeric values the previous string.</li>
<li>The <em>line 6</em> creates a more complex password, comprising at least one uppercase letter, a lowercase letter, and at least five digits.</li>
<li>The <em>line 8</em> creates a token that is sufficiently strong to be used for password recovery/reset on a website.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing basic statistics</h1>
                </header>
            
            <article>
                
<p>Starting in version 3.4, basic statistical tools were provided to Python. While nowhere near as comprehensive as NumPy, SciPy, Pandas, or the like, they are useful when having to perform simple calculations and not wanting, or having access to, advanced numeric modules.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Note that the <kbd>import</kbd> statement is omitted in the following screenshots:</p>
<ol>
<li>
<p>The <kbd>mean(data)</kbd>&#160;function returns the normal average of a sequence or iterator:</p>
</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img style="font-size: 1em;color: black;width:34.67em;height:17.00em;" src="images/03717de8-6f3d-41cc-be1d-c3f6fafd50cf.png"/></div>
<ul>
<li>
<ul>
<li>The <em>line 3</em> is the mean of integers.</li>
<li>The <em>line 4</em> is the mean of floats.</li>
<li>The <em>lines 6</em> and <em>line&#160;8</em> show that fractions can be averaged, as well as decimals.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>The <kbd>harmonic_mean(data)</kbd>&#160;function returns the harmonic average of a sequence or iterator. The harmonic mean is the reciprocal of the arithmetic <kbd>mean</kbd> of the reciprocals of the argument and is typically used when the average of rates or rations is needed.</li>
</ol>
<p style="padding-left: 60px">For example, if a car traveled for a given distance at 60 mph, then the same distance back at 50 mph, its average speed would be the harmonic mean of 60 and 50, that is, 2/(1/60 + 1/50) = 54.5 mph:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/a00fd5fd-9ff5-4379-9922-537b11aa24a7.png" style="width:34.42em;height:9.00em;"/></div>
<p style="padding-left: 90px">This is very close to the regular mean of 55 mph, so let's look at a larger difference, say 20 mph and 80 mph:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/16c98b68-3700-4c88-8256-528cc0c06f3b.png" style="width:34.83em;height:9.17em;"/></div>
<p style="padding-left: 90px">The reason the harmonic mean is more appropriate in this example is because the normal, arithmetic mean doesn't account for the time required to complete the same distance, that is, it takes four times longer to travel a given distance at 20 mph compared to 80 mph</p>
<p style="padding-left: 90px">If the distance was 120 miles, then it would take six hours to travel at 20 mph but only one and a half hours at 80 mph. The total distance traveled would be 240 miles and the total time would be 7.5 hours. 240 miles/7.5 hours = 32 miles per hour.</p>
<ol start="3">
<li>The <kbd>median(data)</kbd>&#160;function returns the middle value of a sequence or iterator:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/ea167712-15df-4ba9-a9f7-b6e5eb7f0c5d.png" style="width:36.83em;height:9.75em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 19</em> demonstrates that the average of the two middle values is returned when the number of data points is even.</li>
<li>When the number of data points is odd (<em>line 20</em>), then the middle value is returned.</li>
</ul>
</li>
</ul>
<ol start="4">
<li>The <kbd>median_low(data)</kbd>&#160;function returns the low median of a sequence or iterator. It is used when the dataset contains discrete values and it is desired to have the returned value be part of the dataset:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/5dfbba1c-bb3f-4ff3-98a8-0a1732cd5568.png" style="width:34.83em;height:9.17em;"/></div>
<ul>
<li>
<ul>
<li>If the dataset is an odd count (<em>line 21</em>), the middle value is returned, just like a normal median.</li>
<li>If the dataset is an even count (<em>line 22</em>), then the smaller of two middle values is returned.</li>
</ul>
</li>
</ul>
<ol start="5">
<li>The <kbd>median_high(data)</kbd>&#160;function returns the high median of a sequence or iterator. It is used when the dataset contains discrete values and it is desired to have the returned value be part of the dataset:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/bc1392ef-a449-4b33-be4c-57719548cce1.png" style="width:34.58em;height:9.08em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 23</em> shows the larger of two middle values is returned if the dataset is an even number.</li>
<li>The <em>line 24</em> shows the normal median is returned when there is an odd number of values in the data.</li>
</ul>
</li>
</ul>
<ol start="6">
<li>The <kbd>median_grouped(data, interval=1)</kbd>&#160;function returns the median of a group of continuous data, using interpolation and calculated at the 50th percentile:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/1ff58166-e437-473a-9556-cf947a55bf07.png" style="width:36.42em;height:9.58em;"/></div>
<p style="padding-left: 60px">In this screenshot, the groups are 5–15, 15<span>–</span>25, 25<span>–</span>35, and 35<span>–</span>45, with the values shown being in the middle of those groups. The middle value is in the 15<span>–</span>25 group so it must be interpolated. By adjusting the interval, which adjusts the class interval, the interpolated result changes.</p>
<ol start="7">
<li>The <kbd>mode(data)</kbd>&#160;function returns the most common value from <kbd>data</kbd>, and assumes <kbd>data</kbd> is discrete. It can be used for numeric or non-numeric data:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/222f47ec-3c78-40df-afae-1a46d51d304f.png" style="width:35.08em;height:22.00em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 30</em> shows that if there isn't a single value with the largest count, an error will be generated.</li>
</ul>
</li>
</ul>
<ol start="8">
<li>The <kbd>pstdev(data, mu=None)</kbd>&#160;function returns the population standard deviation. If <kbd>mu</kbd> is not provided, the mean of the dataset will be automatically calculated:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/d3dbf7e6-35fb-49a9-927f-e4b9d498c1ac.png" style="width:36.50em;height:12.08em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 1</em> is a basic standard deviation. However, the mean of a dataset can be passed into the method so a separate calculation isn't required (<em>lines 32</em>-34).</li>
</ul>
</li>
</ul>
<ol start="9">
<li>The <kbd>pvariance(data, mu=None)</kbd>&#160;function returns the variance of a population dataset. The same conditions for arguments as in <kbd>pstdev</kbd> applies. Decimals and fractions are supported:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/91b4ab86-d5f7-433b-9cf8-db178b8e5601.png" style="width:37.00em;height:14.00em;"/></div>
<p style="padding-left: 60px">While <kbd>mu</kbd> should be the calculated average for the dataset, passing in incorrect values may change the results (this also applies to <kbd>pstdev</kbd>).</p>
<ol start="10">
<li>The <kbd>stdev(data, xbar=None)</kbd>&#160;function is the same functionality as <kbd>pstdev</kbd> but is designed for use with population samples, rather than entire populations.</li>
<li>The <kbd>variance(data, xbar=None)</kbd>&#160;function provides the same functionality as <kbd>pvariance</kbd> but should only be used with samples rather than populations.</li>
</ol>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Improving functionality with comath</h1>
                </header>
            
            <article>
                
<p>PyPi provides the <kbd>comath</kbd> module, which adds additional math functionality to Python.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>The module can be installed using or downloading and installing the wheel package or <kbd>.tar.gz</kbd> file from <a href="https://pypi.python.org/pypi/comath/0.0.3">https://pypi.python.org/pypi/comath/0.0.3</a>:</p>
<div>
<pre><strong>pip install comath</strong></pre>
</div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Note that not all functions in <kbd>comath</kbd> are displayed here, as some require additional packages such as NumPy, which are beyond the scope of this book, or are modified versions of existing <kbd>math</kbd> functions:</p>
<ol>
<li><kbd>array.percentile(sorted_list, percent [, key=lambda x: x])</kbd> function returns the desired percentile (as defined by <kbd>percent</kbd>) from a sorted list of numbers:</li>
</ol>
<div style="color: black" class="standard CDPAlignCenter CDPAlign"><img src="images/434ffb47-5360-4032-93ad-e9b0687fb215.png" style="width:37.33em;height:18.33em;"/></div>
<ul>
<li>
<ul>
<li>For the list of numbers, <em>line 4</em> returns the 10<sup>th</sup> percentile.</li>
<li>The <em>line 5</em> returns the 30<sup>th</sup> percentile.</li>
<li>The <em>line 6</em> returns the 50<sup>th</sup> percentile.</li>
<li>The <em>line 7</em> returns the 75<sup>th</sup> percentile.</li>
<li>The <em>line 8</em> returns the 99<sup>th</sup> percentile.</li>
</ul>
</li>
</ul>
<ol start="2">
<li><kbd>func.get_smooth_step_function(min_val, max_val, switch_point, smooth_factor)</kbd> function returns a function that moves smoothly from minimum to maximum values when its value increases from a given switch point to infinity.</li>
</ol>
<p style="padding-left: 60px" class="standard">Graphically, this looks like an S-curve, with the switch point being the middle of the curve. An example of use is taking an audio signal and smoothing it to reduce the jaggedness and show where the significant peaks are:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/b19ee4fd-783e-42e2-9dfe-0e0b98cfd527.png" style="width:36.92em;height:21.50em;"/></div>
<ul>
<li>
<ul>
<li>The function is defined in line 10.</li>
<li>The <em>line 11</em> shows that <kbd>smooth</kbd> is, indeed, a function returned by a function.</li>
<li>The <em>lines 12</em>-<em>16</em> show the values returned for various positions on the graph. Near the center, results center around 1.0, while the results from the ends of the line are near 0 (minimum end) to near 2 (maximum end).</li>
</ul>
</li>
</ul>
<ol start="3">
<li><kbd>func.closest_larger_power_of_2(number)</kbd> function returns the closest power of 2 that is larger than the argument:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/4f6d4a47-3bc6-436e-aa77-d58dc9734709.png" style="width:36.75em;height:13.00em;"/></div>
<ol start="4">
<li>The <kbd>metric</kbd> module has four metric-related classes that all do similar things.</li>
</ol>
<ul>
<li>
<ul>
<li><kbd>MovingMetricTracker</kbd> class creates an object that tracks and computes a moving metric value.</li>
<li><kbd>MovingAverageTracker</kbd> class creates an object to track and compute a moving average.</li>
<li><kbd>MovingVarianceTracker</kbd> class creates an object to track and computer a moving variance.</li>
<li><kbd>MovingPrecisionTracker</kbd> class creates an object to track and computes a moving precision measure.</li>
</ul>
</li>
</ul>
<ol start="5">
<li>While they all measure different things, the usage is the same, so only one will be demonstrated in the following screenshot:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/477b65f1-61a9-427b-9a19-e9941c2dd662.png" style="width:36.58em;height:17.17em;"/></div>
<ul>
<li>
<ul>
<li>Because all the <kbd>Moving*Tracker</kbd> classes are abstract, all that is necessary is to create a new class is simply subclass the desired <kbd>comath</kbd> class (<em>line 35</em>).</li>
<li>Creating an instance (<em>line 36</em>) allows access to the abstract class methods (<em>lines 37</em>-<em>40</em>). In this case, we are simply updating a counter as a value changes through a computation. In the end, we get back the average over the course of the computation.</li>
</ul>
</li>
</ul>
<ol start="6">
<li><kbd>segment.LineSegment</kbd> class is a class that defines a one-dimensional line segment. Methods are provided to allow some useful testing of the segment:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/cf360a69-85a5-4670-bb15-e721320aca69.png" style="width:37.33em;height:15.83em;"/></div>
<ul>
<li>
<ul>
<li>The <em>line 50</em> shows the instance creation of a line segment. Arguments are the endpoints of the segment.</li>
<li>The <em>lines 51</em> and <em>line&#160;52</em> test the <kbd>contains()</kbd> method, which indicates whether a provided argument lies within the boundaries of the segment.</li>
<li>The <em>lines 53</em> and <em>line&#160;54</em> use the <kbd>intersection()</kbd> method to return a set. A sequence is passed in and only those values that are within the boundaries of the segment are returned in the set.</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>
</body>
</html>