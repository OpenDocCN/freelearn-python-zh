<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-239"><a id="_idTextAnchor243"/>10</h1>
<h1 id="_idParaDest-240"><a id="_idTextAnchor244"/>More Full Stack Frameworks – Django and Pyramid</h1>
<p>The web frameworks we’ve covered so far were exemplary in the way they work. Flask is an unopinionated micro-framework. By this we mean Flask only handles endpoint routing and optionally, serving templated page content. FastAPI features a framework specifically for building RESTful APIs rather than serving content beyond data. It also features an asynchronous programming model reminiscent of modern JavaScript frameworks running in NodeJS.</p>
<p>There are two more frameworks you’ll find on the <strong class="bold">New Project</strong> menu in PyCharm Professional, and we’re going to cover them here. <strong class="bold">Django</strong> is a very popular framework that is, philosophically speaking, the diametric opposite of Flask. Django is a highly opinionated framework that attempts to make all your platform and framework choices for you.</p>
<p>The final framework we’ll talk about is <strong class="bold">Pyramid</strong>. Pyramid aims for the middle ground between Flask and Django offering more bundled features than Flask, but more flexibility than Django.</p>
<p>In this chapter, you will learn the following:</p>
<ul>
<li>How to generate a Django project using PyCharm Professional’s new project template</li>
<li>How to identify the major files and folders present in the templated project generated by PyCharm</li>
<li>How to use Django-specific tooling in PyCharm for <code>manage.py</code> tasks</li>
<li>How to create a Pyramid project in PyCharm Professional</li>
</ul>
<p>We’ve already covered a lot of theory on how web applications work in earlier chapters, so let’s get straight into developing these two frameworks using PyCharm. As with other web development frameworks, these features are only available in the Professional edition of PyCharm.</p>
<h1 id="_idParaDest-241"><a id="_idTextAnchor245"/>Technical requirements</h1>
<p>In order to proceed through this chapter, and indeed the rest of the book, you will need the following:</p>
<ul>
<li>An installed and working Python interpreter. I’ll be using the latest from <a href="https://python.org">https://python.org</a>.</li>
<li>Installed copies of <code>pip</code> and <code>virtualenv</code>. You get these automatically when you install Python on Windows, and macOS has them included on every system. If you are using Linux, you need to install the package managers such as <code>pip</code> and virtual environment tools such as <code>virtualenv</code> separately. Our examples will use <code>pip</code> and <code>virtualenv</code>.</li>
<li>An installed and working copy of PyCharm. Installation was covered in <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a><em class="italic">, Installation and Configuration</em>, in case you are jumping into the middle of the book. I am using build PyCharm Professional 2023.1 (build #PY-231.8109.197) with the new UI turned on.</li>
<li>This book’s sample source code from GitHub. We covered cloning the code in <a href="B19644_02.xhtml#_idTextAnchor028"><em class="italic">Chapter 2</em></a><em class="italic">, Installation and Configuration</em>. You’ll find this chapter’s relevant code at <a href="https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-10">https://github.com/PacktPublishing/Hands-On-Application-Development-with-PyCharm---Second-Edition/tree/main/chapter-10</a>.</li>
</ul>
<h1 id="_idParaDest-242"><a id="_idTextAnchor246"/>What’s all this fuss about Django?</h1>
<p>If you ask most Python developers which framework they prefer, I’ll wager it is an even split between Flask and Django. I’ll also <a id="_idIndexMarker827"/>wager that the Django crowd are raving fans of Django while Flask seems more like a thing you use to get stuff done. It’s like getting excited about a screwdriver. Django is a lot more opinionated, and as such, a lot more “in your face." You barely notice Flask because it’s just a piece of the puzzle. Django is all the pieces in one box, plus that glue you use to make puzzles into a picture, plus an expensive frame for the completed glued puzzle, plus a beach house so you have a place to hang your puzzle. There might even be little mints on the pillows in the beach house, but I make no promises.</p>
<p>Django, on the other hand, promises to be a web framework that handles the heavy lifting and repetitive aspects of web application development. Web developers are freed up to focus on the specific logic of their applications. Web frameworks usually implement common design patterns and good practices into their structure, so that a web application developed with a<a id="_idIndexMarker828"/> framework will be up to common standards by default, without its developer having to manually integrate those standards into the application.</p>
<p>Django aims to have everything you need to develop a web application baked into the framework. Since that is true, you shouldn’t have to think about your stack at all. Django becomes more than a framework; it becomes an ethos. You become a fan of Django’s way. You might even say <em class="italic">“This is the way,”</em> and Django might say it back. Here are some things Django is good at:</p>
<ul>
<li><strong class="bold">Speed</strong>: Similar to Python itself, Django emphasizes the ease of developing and translating ideas into actual <a id="_idIndexMarker829"/>code. With straightforward yet extensive APIs, Django aims to accommodate a wide range of web applications and features.</li>
<li><strong class="bold">Security</strong>: Web development is one of the topics in programming in which security is the highest priority. The Django framework offers features that navigate web developers, beginners, and experts alike, away from security flaws in their applications.</li>
<li><strong class="bold">Scalability</strong>: When a website gains more clients, scalability becomes more and more important. Scalability in Django can be achieved in flexible and intuitive ways; in fact, some of the largest sites on the internet (Bitbucket, Instagram, Pinterest, and so on) are built with Django for that reason.</li>
</ul>
<p>None of these are specifically addressed by Flask. In fact, Flask is not normally used for large web applications because it is relatively slow. Personally, I’ve moved all my product backend code away from Flask and into FastAPI because the performance is noticeably better.</p>
<p>So far, Django sounds much better than anything else we’ve talked about so far. Despite being a popular and powerful web framework, Django, like any technology, has its detractors. Some of the common criticisms and concerns raised about Django include the following:</p>
<ul>
<li><strong class="bold">Steep learning curve</strong>: Some developers <a id="_idIndexMarker830"/>find Django’s learning curve to be relatively steep, especially for beginners with limited experience in Python or web development. Its extensive<a id="_idIndexMarker831"/> feature set and comprehensive nature can be overwhelming for newcomers.</li>
<li><strong class="bold">Magic and abstraction</strong>: Django’s emphasis on “batteries included” and abstraction can be a double-edged sword. While it saves development time, some developers argue that it can obscure the underlying mechanisms, making it harder to understand and troubleshoot complex issues.</li>
<li><strong class="bold">Overhead for small projects</strong>: For small projects or simple websites, some developers feel that Django’s feature richness and structure can be overkill, adding unnecessary overhead and complexity.</li>
<li><strong class="bold">Monolithic nature</strong>: Critics argue that Django is a monolithic framework, and it may not be the best fit for microservices architectures or highly specialized applications where a lightweight framework might be more suitable.</li>
<li><strong class="bold">Flexibility versus opinionated</strong>: Django follows a particular design philosophy and enforces certain patterns, which some developers see as overly opinionated. This can lead to debates over the “Django way” of doing things versus alternative approaches.</li>
<li><strong class="bold">Performance</strong>: Although Django is reasonably performant, some developers claim that it may not be as fast as certain micro-frameworks or specialized tools. Performance-critical projects may require additional optimization efforts.</li>
<li><strong class="bold">ORM limitations</strong>: While Django’s ORM is powerful and easy to use, it may not cover all edge cases or offer the same level of control as writing raw SQL queries. In certain scenarios, developers may prefer using other ORMs or query builders.</li>
<li><strong class="bold">Version upgrades</strong>: Upgrading between major versions of Django can sometimes be challenging, especially for older projects heavily reliant on deprecated features. This can lead to maintenance issues and additional development efforts.</li>
<li><strong class="bold">Customization complexity</strong>: While <a id="_idIndexMarker832"/>Django offers flexibility, some developers find it challenging to customize certain built-in components, such as the admin interface, to fit specific design requirements.</li>
<li><strong class="bold">Community and ecosystem</strong>: Although Django has a large and active community, it may not have as extensive an ecosystem or as many third-party packages available as some other web frameworks.</li>
</ul>
<p>It’s important to note that while<a id="_idIndexMarker833"/> these criticisms exist, Django has an extensive user base, and many developers appreciate its productivity, stability, and comprehensive feature set. Ultimately, the choice of a web framework depends on the specific needs and preferences of the project and development team.</p>
<h2 id="_idParaDest-243"><a id="_idTextAnchor247"/>Django framework components</h2>
<p>Django includes an inclusive set of components that<a id="_idIndexMarker834"/> make it a comprehensive and feature-rich framework for web development. Here are some of the key components:</p>
<ul>
<li><strong class="bold">URL dispatching (routing)</strong>: Django uses a URL dispatcher to route incoming HTTP requests to the appropriate view functions or class-based views. This enables clean and logical URL patterns for your web application.</li>
<li><strong class="bold">View functions and class-based views</strong>: Views in Django are responsible for processing user requests and returning HTTP responses. You can use simple functions as views or use Django’s class-based views for more organized and reusable code.</li>
<li><strong class="bold">Templates</strong>: Django’s template system allows you to define the structure and layout of your web pages using HTML templates with placeholders for dynamic content. This separation of concerns (logic and presentation) makes it easier to maintain and scale your web application.</li>
<li><strong class="bold">Model-View-Template (MVT) architecture</strong>: Similar to the <strong class="bold">Model-View-Controller</strong> (<strong class="bold">MVC</strong>) pattern, Django follows the MVT <a id="_idIndexMarker835"/>pattern. Models represent the data structures and the database schema, views handle the logic and processing, and templates take care of rendering the output.</li>
<li><strong class="bold">Object-Relational Mapping (ORM)</strong>: Django’s ORM is one of its defining features. It provides a high-level, Pythonic way to interact with databases without having to write raw SQL<a id="_idIndexMarker836"/> queries. It allows you to define models as Python classes, and the ORM handles the mapping of these models to the database tables.</li>
<li><strong class="bold">Forms</strong>: Django includes a form-handling system that simplifies form creation, data validation, and handling user input. It helps in processing HTML forms and converting user-submitted data into Python data types.</li>
<li><strong class="bold">Admin interface</strong>: Django’s admin interface is an automatic admin interface that can be used to manage your application’s data models. It provides an out-of-the-box solution for managing model data and is customizable to fit your specific needs.</li>
<li> <strong class="bold">Middleware</strong>: Middleware components in Django are hooks that allow you to process requests and responses globally before they reach the view or after they leave the view. It enables features including authentication, security checks, and request/response modification.</li>
<li> <strong class="bold">Static files</strong>: Django has built-in support for managing static files such as CSS, JavaScript, and images. It simplifies the process of serving static content during development and deployment.</li>
<li><strong class="bold">Authentication and authorization</strong>: Django provides a robust authentication system for managing user accounts, permissions, and groups. It makes it easy to add user registration, login, and password management functionalities to your application.</li>
<li>I<strong class="bold">nternationalization and localization</strong>: Django supports internationalization and localization, allowing you to create applications that can be translated into multiple languages and adapted to various regions.</li>
<li><strong class="bold">Testing framework</strong>: Django comes with a testing framework that facilitates unit testing and integration testing <a id="_idIndexMarker837"/>of your application. You can write test cases to ensure that your code works as expected and avoid regressions.</li>
</ul>
<p>With all that overhead, it’s a good thing we have such a capable tool in PyCharm. Let’s dive into creating a Django application.</p>
<h1 id="_idParaDest-244"><a id="_idTextAnchor248"/>Creating a Django project</h1>
<p>The process is no different than<a id="_idIndexMarker838"/> most other projects. Click <strong class="bold">File | New Project</strong> then click the <strong class="bold">Django</strong> option as shown in <em class="italic">Figure 10</em><em class="italic">.1</em>.</p>
<div><div><img alt="Figure 10.1: Creating a new Django project is much like any other project" src="img/B19644_10_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.1: Creating a new Django project is much like any other project</p>
<p>Be sure to twirl down the <strong class="bold">More Settings</strong> section. Here you can set the template language. You can use<a id="_idIndexMarker839"/> either the <strong class="bold">Django templating language</strong> or <strong class="bold">Jinja2</strong>, which was what we used in <a href="B19644_09.xhtml#_idTextAnchor223"><em class="italic">Chapter 9</em></a>, <em class="italic">Building a Dynamic Web Application with Flask</em>. Since we covered Jinja2 already, let’s<a id="_idIndexMarker840"/> stick with Django. You can set the name of the folder you’ll use for templates, and you absolutely should set a value for the <strong class="bold">Application name</strong> field as shown at the bottom of <em class="italic">Figure 10</em><em class="italic">.1</em>.</p>
<p class="callout-heading">Don’t skip the application name</p>
<p class="callout">If you skip the <code>manage.py</code> tooling we’ll cover later, but that’s probably not what you want most of the time when you are creating a new project. Furthermore, you should not name the application the same as the PyCharm project as it can cause confusion in PyCharm’s indexing, not to mention for the humans working on the project.</p>
<p>Django projects often have multiple applications within them, and the <strong class="bold">Application name</strong> setting here is used to create and name the first application within the project. We’re going to be building a single library <a id="_idIndexMarker841"/>application in our project. Since the term <em class="italic">library</em> is ambiguous in a programming book, I’ll clarify the name of the application so we understand the <em class="italic">library</em> is a place that serves books rather than a programming library.</p>
<p>The resulting newly created project is shown in <em class="italic">Figure 10</em><em class="italic">.2</em>.</p>
<div><div><img alt="Figure 10.2: The Django project has been created and PyCharm opens the urls.py and settings.py files as a starting point" src="img/B19644_10_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.2: The Django project has been created and PyCharm opens the urls.py and settings.py files as a starting point</p>
<p>Given the super long list of components, it is a little surprising how few files were created. PyCharm has automatically opened two as a starting point: <code>urls.py</code> and <code>settings.py</code>. Let’s take a look at what these and the rest of the files and folders are for in our newly created application.</p>
<h1 id="_idParaDest-245"><a id="_idTextAnchor249"/>Structure of a Django project</h1>
<p>The first thing you might notice is the project, which I just called <code>djangoProject</code>, has its own set of files distinct from the <a id="_idIndexMarker842"/>application, which is in the <code>TheGreatBookery</code> folder. All of the files inside of the <code>djangoProject</code> folder are used in the deployment of your application to production, as well as to run the built-in development server.</p>
<p>Inside the <code>TheGreatBookery</code> folder, we have a folder for database migrations. This is common for applications that use ORMs. You need a way to make changes to the production database as you roll new releases into production. You can’t simply drop the database and rebuild it since that would erase all your application’s data. There needs to be a system to migrate schema changes to the existing database while maintaining your existing production data. Django’s system for migrations utilizes migration scripts stored in this folder.</p>
<p>The templates folder, which is technically outside the application’s folder, is where we keep our HTML templates.</p>
<p>You might be able to guess the functions of the remaining files by their names:</p>
<ul>
<li><code>admin.py</code> is used to register modules, data models, and perhaps most obviously from the name, to control the admin user interface.</li>
<li><code>apps.py</code> provides a central place to customize and configure the behavior of your application within the Django project. It allows you to specify various settings and metadata for your application, such as the human-readable name, default app configuration, and signals.</li>
<li><code>models.py</code> will contain your data model, which is affected by the ORM.</li>
<li><code>tests.py</code> will house your application’s unit tests, which run using Django’s own testing framework.</li>
<li><code>views.py</code> will contain view functions. These are Python functions that take an HTTP request as an argument and return an HTTP response. Within these functions, you can handle the request, process data from the models or other sources, and generate an appropriate HTTP response, often by rendering a template with dynamic data.</li>
</ul>
<h2 id="_idParaDest-246"><a id="_idTextAnchor250"/>Initial configuration</h2>
<p>While this is not a book on Django, I would be remiss if I didn’t point out a few things in the <code>settings.py</code> file. Like Flask, Django has a built-in development web server that is not designed to be used in production. The <code>settings.py</code> file has some dangerous settings in it as hardcoded values<a id="_idIndexMarker843"/> that are appropriate for local development only. Open up <code>settings.py</code> and locate these lines:</p>
<pre class="source-code">
# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-39u&amp;w+cgs2t4*jwe3nuz4y4j^s!s65^xb7eqtb_a3bl!a_s%tn'
# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True</pre> <p>Something you should do early is make sure to draw these values from outside your code. You should never hardcode a secret in your application code, and you should never commit secrets to a revision control system! You can externalize these values using environment variables, <code>.ini</code> files, or <code>.env</code> files using libraries from <code>PyPi.org</code>. Leaving the <code>DEBUG</code> setting hardcoded can be dangerous because errors thrown may be plainly visible along with the stack trace and other details that bad actors might be able to exploit.</p>
<p>Another setting you might want to review is the database engine. You’ll find these lines toward the bottom of <code>settings.py</code>:</p>
<pre class="source-code">
# Database
# https://docs.djangoproject.com/en/4.2/ref/settings/#databases
DATABASES = {
  'default': {
    'ENGINE': 'django.db.backends.sqlite3',
    'NAME': BASE_DIR / 'db.sqlite3',
  }
}</pre> <p>PyCharm has defaulted us to SQLite3, which is not really suitable for a production application. SQLite3 is a file-based database, and using it for local development is advantageous because it doesn’t require the installation of a server. You shouldn’t serve a production app with SQLite3, and in my opinion, you should develop using the same database you’ll use in production.</p>
<p>That said, we won’t be taking this app to production so I’m going to leave the settings as they are. Your database will appear in the project directory as a file called <code>db.sqlite3</code>. We will learn about PyCharm’s database capabilities in <a href="B19644_11.xhtml#_idTextAnchor266"><em class="italic">Chapter 11</em></a>. Know that PyCharm has a rich set of tools for viewing and working with databases, including SQLite3, which can<a id="_idIndexMarker844"/> help during development.</p>
<h2 id="_idParaDest-247"><a id="_idTextAnchor251"/>Running the Django project</h2>
<p>When we created the project, PyCharm created a run configuration for us. We covered run configurations<a id="_idIndexMarker845"/> extensively in <a href="B19644_06.xhtml#_idTextAnchor145"><em class="italic">Chapter 6</em></a>. We simply want to run the one PyCharm generated, so simply click the green <strong class="bold">Run</strong> button shown in <em class="italic">Figure 10</em><em class="italic">.3</em>.</p>
<div><div><img alt="Figure 10.3: The Run button will start the development server" src="img/B19644_10_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.3: The Run button will start the development server</p>
<p>Running the project will open the <strong class="bold">Run</strong> panel at the bottom of the IDE window, as shown in <em class="italic">Figure 10</em><em class="italic">.4</em>.</p>
<div><div><img alt="Figure 10.4: Our project is running and being served on localhost port 8000" src="img/B19644_10_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.4: Our project is running and being served on localhost port 8000</p>
<p>We can see our project is <a id="_idIndexMarker846"/>running on port <code>8000</code>, and there’s a handy link that will open our default browser to the running app, as shown in <em class="italic">Figure 10</em><em class="italic">.5</em>.</p>
<div><div><img alt="Figure 10.5: Clicking the link opens the browser and displays a nice message letting you know everything is working" src="img/B19644_10_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.5: Clicking the link opens the browser and displays a nice message letting you know everything is working</p>
<p>PyCharm has effectively created a minimal working application for us. In a real projects, this is usually where I address deployment via <strong class="bold">continuous integration</strong> (<strong class="bold">CI</strong>) and <strong class="bold">continuous delivery </strong>(<strong class="bold">CD</strong>). One piece<a id="_idIndexMarker847"/> of advice I always give new web<a id="_idIndexMarker848"/> developers is to get the production mechanics in place as early as possible. If you do it right, you won’t have to mess with them<a id="_idIndexMarker849"/> again for quite a while.</p>
<p>JetBrains has a very good CI/CD server called TeamCity. I used it exclusively for the last 10 years, having only last year switched begrudgingly to Microsoft Azure DevOps. TeamCity is a much better system and its definitely worth your time and trouble if you’re looking for a CI/CD server. JetBrains even offers plugins for PyCharm that allow you to control and monitor builds right from the IDE.</p>
<p>This, though, is a chapter on Django, so let’s keep the party rolling and move on to working with data models.</p>
<h1 id="_idParaDest-248"><a id="_idTextAnchor252"/>Creating Django models</h1>
<p>In a Django application, models play<a id="_idIndexMarker850"/> a central and crucial role. They are the backbone of the application’s data structure and are responsible for defining the database schema and handling data operations. Models allow developers to interact with the underlying database in an object-oriented manner, making it easier to manage and manipulate data.</p>
<p>Models serve as an interface between the application and the database. They abstract away the complexities of SQL queries and provide a high-level API to perform <strong class="bold">Create, Read, Update, Delete</strong> (<strong class="bold">CRUD</strong>) operations. By<a id="_idIndexMarker851"/> using model methods and querysets, developers can interact with the database without having to write raw SQL code. Everything related to the database driving the application (including the things a lot of developers usually leave out, such as validation and constraints) can be found rolled into a Django model.</p>
<p>A prevalent anti-pattern that sometimes pops up with projects that forgo using ORMs is the use of the database to encapsulate business logic. The justification for this is usually that changing the database is quick, easy, and doesn’t require a new compilation or a new deployment. This is a foolish economy, and in a modern era that requires governance and documented<a id="_idIndexMarker852"/> change control, it becomes anathema. The senior database developer on my team, who is also a technical reviewer for <a href="B19644_11.xhtml#_idTextAnchor266"><em class="italic">Chapter 11</em></a>, describes this practice as changing the tires on a semi-truck while it is traveling down the highway at 100 mph. Django models, though, since they are technically objects, are able to handle business logic effectively and without taboo. This is because only the structure of the data model is translated into the database while the logic remains within the object.</p>
<p>The thing you need to remember about using an ORM, which is what we’re doing when we create and manipulate models, is that we are working with an abstraction of our database. When we manipulate instances of our models we are altering data in the database. Likewise, when we change the structure of our classes, we are altering the structure of the database. There are differences between the way data types in your programming language work and the way they work in the database. We’ll see this in action later, but right now I want you to think about the fact that Python is a dynamic language that uses duck typing. In Python, I can alter any structure or type in any way that suits me. Databases on the other hand are static and strongly typed. Django’s ORM has its work cut out for it given the differences in paradigm between the way Python works with classes, types, and variables versus the way the database works with tables.</p>
<p>Let’s look at creating an easy model. Locate the <code>models.py</code> file. You can find it displayed in <em class="italic">Figure 10</em><em class="italic">.6</em>, or you can use the navigation features in PyCharm by pressing <em class="italic">Ctrl</em> + <em class="italic">Shift</em> + <em class="italic">N</em> (<code>models.py</code>.</p>
<div><div><img alt="Figure 10.6: Open the models.py file so we can add a model" src="img/B19644_10_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.6: Open the models.py file so we can add a model</p>
<p>The generated code within will look like this:</p>
<pre class="source-code">
from django.db import models
# Create your models here.</pre> <p>We’re going to create two <a id="_idIndexMarker853"/>models for our Bookery application: <code>author</code> and <code>book</code>. To do this, let’s alter the code in <code>models.py</code> as follows:</p>
<pre class="source-code">
from django.db import models
import datetime
from django.utils import timezone</pre> <p>Here, we’ve added two imports<a id="_idIndexMarker854"/> both related to time and dates. We’re going to use these libraries in some business logic that we will attach to the book model. Let’s not get ahead of ourselves, though. Let’s make a simple model to represent book authors:</p>
<pre class="source-code">
# Create your models here.
class Author(models.Model):
  first_name = models.CharField(max_length=100)
  last_name = models.CharField(max_length=100)
  def __str__(self):
    return f'{self.last_name}, {self.first_name}'</pre> <p>The class is hopefully straightforward enough. The <code>Author</code> class inherits from Django’s <code>model.Model</code> class. There are two fields for the author’s first and last name and use the <code>models.CharField</code> type to represent what would be varchars in the database. Relational databases require to declare a strong type, and in the case of a varchar (a variable-length character field), we have to supply a maximum length. The dunder string method simply gives us a nice format should we request the contents of the model as a string. Here, we’ve elected to format the author’s name as last name, comma, space, and first name.</p>
<p>Every ORM, regardless of platform, works the same way. Its aim is to allow developers to work only with native language objects. With that said, they usually need their own type system to allow the ORM to translate between the type system of the language (Python) and the database. You’ll learn in <a href="B19644_11.xhtml#_idTextAnchor266"><em class="italic">Chapter 11</em></a> that database data types are not the same as in their programming language counterparts. At a minimum, differences such as calling strings as varchars are apparent, and types including int and float exist in both contexts. Sometimes they are even different between database platforms. There are datatypes in SQLite3 that are not present in MySQL, and vice versa.</p>
<p>An ORM has to work everywhere, so having its own type system for models allows for a single type system for the developer that can be adapted to any database platform. It is a classic implementation of the<a id="_idIndexMarker855"/> Gang of Four’s <strong class="bold">adapter pattern</strong>, which I cover in<a id="_idIndexMarker856"/> my book <em class="italic">Real-World Implementation of C# Design Patterns</em>, published by Packt.</p>
<p>The <code>author</code> class is not very fancy. Let’s do some more interesting code in the <code>Book</code> model code:</p>
<pre class="source-code">
class Book(models.Model):
  title = models.CharField(max_length=200)
  author = models.ForeignKey(Author, on_delete=models.CASCADE,)
  pub_date = models.DateTimeField('date published')</pre> <p>So far we have a <code>Book</code> class inheriting from <code>models.Model</code> as before. We have a title field with a maximum length of 200 characters. There is an <code>author</code> field, but rather than make this a string, we used the <code>Author</code> class to <a id="_idIndexMarker857"/>set up a <code>authors</code> table, which is controlled by the <code>Author</code> class we made a minute ago. A foreign key relationship specifies that any <code>Book</code> we add to the database must contain a related (it’s a relational database) database to an existing author. Operationally, this means we have to make sure the author exists in the database before we can add the author’s books to the database.</p>
<p>Foreign key constraints serve as a form of built-in data validation but they also help maintain data integrity in the database by enforcing rules. If I were to add an author to the database, and then add a bunch of books written by that author, we would have a nice relationship going on between the two tables. If I were to then delete the author from the <code>authors</code> table, we’d still have a bunch of book records without a related author. They would be orphan records. Orphan records are bad because they take up space in the database, and they break the integrity of the relationship between authors and books.</p>
<p>In this class, when we define the <code>author</code> field, we are defining it with a foreign key constraint with an actual rule covering what happens when you delete an author. The code that says <code>on_delete=models.CASCADE</code> tells the ORM that when an author is deleted, so are the records of the books they’ve written. It is called a cascading delete because the delete cascades from the author to the book records, which could in turn cascade to other tables that might have similar relationships to books. A well-constructed database can keep itself clean and devoid of orphan records regardless of how complex the database<a id="_idIndexMarker858"/> structure might be.</p>
<p>Lastly, we have a date to contain the publication date:</p>
<pre class="source-code">
pub_date = models.DateTimeField('date published')</pre> <p>If the <code>foreign key</code> field didn’t add enough spice for you, let’s add one more thing. Since we are dealing with an object, and since objects can contain both data and functional logic, let’s add a function to our <code>Book</code> model:</p>
<pre class="source-code">
  def was_published_recently(self):
    now = timezone.now()
    return now - datetime.timedelta(days=1) &lt;= self.pub_date &lt;= now</pre> <p>This adds a field to our model, but rather than this data being stored in the database, it is computed at the time the method is called. We’re taking the static field for the publication date and computing the difference (delta) of the time to the current date. We’re taking into account the time zone and we’re presenting it as the number of days since the book was published. This allows us to show our users how old the book is in days, which might be used to prompt authors to produce new and updated editions of their books.</p>
<h1 id="_idParaDest-249"><a id="_idTextAnchor253"/>Performing migrations using manage.py</h1>
<p>One of the files generated<a id="_idIndexMarker859"/> for your Django project is <code>manage.py</code>. You can see it in <em class="italic">Figure 10</em><em class="italic">.7</em>.</p>
<div><div><img alt="Figure 10.7: The manage.py file provides utilities for working with your Django project so you don’t have to type in long commands or remember full paths" src="img/B19644_10_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.7: The manage.py file provides utilities for working with your Django project so you don’t have to type in long commands or remember full paths</p>
<p>The purpose of the <code>manage.py</code> task is to<a id="_idIndexMarker860"/> allow you to run Django-specific commands from the command line without having to remember the full path to your Django project or manually set up the Python environment. By using <code>manage.py</code>, you ensure that the commands are executed within the correct Django project context.</p>
<p>Some common tasks you can perform with <code>manage.py</code> include the following:</p>
<ul>
<li><code>manage.py runserver</code>. This allows you to test your application locally during development. Earlier, we ran the Django project using the generated run configuration. We could have also used <code>manage.py</code> for this.</li>
<li><code>manage.py makemigrations</code> and <code>manage.py migrate</code>, you can create and apply database migrations, respectively. This helps you manage changes to your models and keep your database schema up to date.</li>
<li><code>manage.py createsuperuser</code>.</li>
<li><code>manage.py test</code> to ensure that your application functions as expected.</li>
<li><code>manage.py collectstatic</code>.</li>
<li><code>manage.py makemessages</code> and <code>manage.py compilemessages</code>.</li>
</ul>
<p>This is just a short list. There are many more utilities in <code>manage.py</code>. The <code>manage.py</code> file serves as an entry point to Django management commands, making it easy to perform administrative tasks without leaving your development environment. Before you head down to the terminal button in PyCharm, there is actually an easier way to work with <code>manage.py</code>. Click <strong class="bold">Tools | Run manage.py task...</strong> as shown in <em class="italic">Figure 10</em><em class="italic">.8</em>.</p>
<div><div><img alt="Figure 10.8: PyCharm has a dedicated tool panel for working with manage.py" src="img/B19644_10_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.8: PyCharm has a dedicated tool panel for working with manage.py</p>
<p>This gives you a new panel, <a id="_idIndexMarker862"/>as shown in <em class="italic">Figure 10</em><em class="italic">.9</em>.</p>
<div><div><img alt="Figure 10.9: The Run manage.py task panel is a dedicated command-line interface that lets you easily invoke commands specific to Django’s manage.py file" src="img/B19644_10_09.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.9: The Run manage.py task panel is a dedicated command-line interface that lets you easily invoke commands specific to Django’s manage.py file</p>
<p>The <code>manage.py</code> panel opens at the bottom of the IDE as many do. At first glance, it looks like a terminal window, but this one is specific to Django and the <code>manage.py</code> file. As you can see, the panel provides auto-completion to help with the commands.</p>
<p>In order to create our migrations, you should type this command into the panel:</p>
<pre class="source-code">
makemigrations TheGreatBookery</pre> <p>The result will resemble <em class="italic">Figure 10</em><em class="italic">.10</em>.</p>
<div><div><img alt="Figure 10.10: The result of the makemigrations command" src="img/B19644_10_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.10: The result of the makemigrations command</p>
<p>You’ll find some messages in the <a id="_idIndexMarker863"/><code>manage.py</code> panel as well as a new file in the <code>migrations</code> folder called something like <code>0001_initial.py</code>. The <code>makemigrations</code> command generated the code needed for the migration, but it hasn’t performed the migration yet. Performing the migration is what affects the changes to the database. In order to run the migration, type this into the <code>manage.py</code> task panel:</p>
<pre class="source-code">
sqlmigrate TheGreatBookery 0001</pre> <p>The output from the command, shown in <em class="italic">Figure 10</em><em class="italic">.11</em>, indicates the database structure has been updated to<a id="_idIndexMarker864"/> match the models.</p>
<div><div><img alt="Figure 10.11: The result of the migration is a set of messages and the appearance of our database file" src="img/B19644_10_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.11: The result of the migration is a set of messages and the appearance of our database file</p>
<p>We see a bunch of SQL statements that were generated to bring the database structure up to match the structure of the models. We also see a new file for our database. If you remember, we saw earlier that the name and path of this file were set in the <code>settings.py</code> file. Since SQLite3 is a file database, this is the actual database itself. This is the kind of thing you might want to exclude from revision control on a real project.</p>
<h1 id="_idParaDest-250"><a id="_idTextAnchor254"/>The Django admin interface</h1>
<p>This is one of the killer <a id="_idIndexMarker865"/>features of Django: it creates a web-based administrative panel for you. This means you don’t have to build an interface for dealing with users, handling logins, or creating screens for simple data entry into your model structure. The first thing every app needs is an administrative user or superuser. It is common for applications to have role-based user access, and the super-user is the user who can do everything, including adding new users. This kind of thing might take a developer two or<a id="_idIndexMarker866"/> three days to get working, but with Django, it’s already done.</p>
<h2 id="_idParaDest-251"><a id="_idTextAnchor255"/>Creating a superuser and logging in</h2>
<p>Before users, logins, or any <a id="_idIndexMarker867"/>of the other goodies we’re talking about here work, you <a id="_idIndexMarker868"/>need to apply a migration that was generated for you when you created the project.</p>
<p>Let’s head back to our <code>manage.py</code> task panel and type this command:</p>
<pre class="source-code">
migrate</pre> <p>Just like that, by itself. This adds all the base tables for the application. We probably should have done this first, but I didn’t want to break the flow of what we were working on. OK, really I forgot, but it sounded better the other way.</p>
<p>With that migration run we now have all the tables and structures in the database to support Django’s login and user administration feature. Next, let’s create the superuser. In the panel, type the following:</p>
<pre class="source-code">
createsuperuser</pre> <p>You are asked a set of questions designed to create a superuser for your application as shown in <em class="italic">Figure 10</em><em class="italic">.12</em>.</p>
<div><div><img alt="Figure 10.12: The manage.py panel interaction for creating a superuser" src="img/B19644_10_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.12: The manage.py panel interaction for creating a superuser</p>
<p>Let’s try out the management interface! While you could just use the run configuration, let’s see what it is like to run it from the <code>manage.py</code> task panel. Type the following:</p>
<pre class="source-code">
runserver</pre> <p>Then click the link in the panel message shown in <em class="italic">Figure 10</em><em class="italic">.13</em>.</p>
<div><div><img alt="Figure 10.13: This time, let’s run from the panel!" src="img/B19644_10_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.13: This time, let’s run from the panel!</p>
<p>In truth, it is the exact same thing you would have gotten by clicking the green run button as we did the first time we <a id="_idIndexMarker869"/>ran the app. After clicking the link, your browser opens to the same page we saw before. Change the URL in the <a id="_idIndexMarker870"/>browser to <a href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a>. This will take you to the administrative login page shown in <em class="italic">Figure 10</em><em class="italic">.14</em>.</p>
<div><div><img alt="Figure 10.14: The best kind of login system is the one you didn’t have to make yourself!" src="img/B19644_10_14.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.14: The best kind of login system is the one you didn’t have to make yourself!</p>
<p>Type in the superuser user name and password you specified in the task panel. <em class="italic">Figure</em> <em class="italic">10</em><em class="italic">.15 </em>shows the admin screen that should appear.</p>
<div><div><img alt="Figure 10.15: Without writing any code, we can add users and groups to the application" src="img/B19644_10_15.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.15: Without writing any code, we can add users and groups to the application</p>
<p>Click around to see everything Django has generated for us. You can add users and groups to the application despite not having<a id="_idIndexMarker871"/> written any code for this – Django handled it for us. The downside here is that it was <a id="_idIndexMarker872"/>generated based on the Django project’s ideas on what an admin panel should look like and how it should work. While it is possible to customize some of this functionality, remember that I keep saying that Django is <em class="italic">opinionated</em>. It has assumptions baked in. Less opinionated frameworks would require you to build this or use a plugin, but you would be in total control over how this feature was implemented.</p>
<h2 id="_idParaDest-252"><a id="_idTextAnchor256"/>Adding the Author and Book models to the admin interface</h2>
<p>While you get users and <a id="_idIndexMarker873"/>groups for free, you do have to do a tiny bit of work to get authors and books to show up in the admin interface. Let’s start with the <code>Author</code> model.</p>
<p>Open the <code>admin.py</code> file in <code>TheGreatBookery</code> folder and find a comment that says <code># Register your models here</code>. Add the following code:</p>
<pre class="source-code">
# Register your models here.
from .models import Author
admin.site.register(Author)</pre> <p>If your app stopped or crashed, go ahead and restart it, then navigate to the admin page as before. You should now see <strong class="bold">Authors</strong> appear on the admin page, as shown in <em class="italic">Figure 10</em><em class="italic">.16</em>.</p>
<div><div><img alt="Figure 10.16: With very little effort, we can now add, edit, and delete authors" src="img/B19644_10_16.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.16: With very little effort, we can now add, edit, and delete authors</p>
<p>We have the Author model; let’s add <code>Book</code>. This one is a little fancier. Remember, there is a relationship between Book and Author. Each Author can be related to many Books, or inversely, many Books are related to one Author.</p>
<p>Since this is so, we want the<a id="_idIndexMarker874"/> admin interface to not only reflect this relationship but enforce it at the UI layer. You can just slap an import for the book model in and expect it to work perfectly.</p>
<p>Go back to the <code>admin.py</code> file and add this code:</p>
<pre class="source-code">
from django.contrib import admin
# Register your models here.
<strong class="bold">from .models import Author, Book</strong>
<strong class="bold">class BookInLine(admin.TabularInline):</strong>
<strong class="bold">  model = Book</strong>
<strong class="bold">  extra = 1</strong>
<strong class="bold">  fieldsets = [</strong>
<strong class="bold">    (None, {'fields': ['title']}),</strong>
<strong class="bold">    </strong><strong class="bold">('Date information', {'fields': ['pub_date']})</strong>
<strong class="bold">  ]</strong>
<strong class="bold">class AuthorAdmin(admin.ModelAdmin):</strong>
<strong class="bold">  inlines = [BookInLine]</strong>
admin.site.register(Author, AuthorAdmin)</pre> <p>This code creates an addition to the <code>Author</code> UI that allows you to add books inline which is to say when you add an author, you will then have the opportunity to add books. You can’t have books<a id="_idIndexMarker875"/> without first adding authors. Because we defined the relationship and the UI this way, the ability to add and edit books is part of administering the author. You’ll never even have the chance to mess up by adding books before authors, or by somehow disassociating a book from an author.</p>
<p>Restart your server, and refresh your browser. Nothing changed! Hang on, that’s OK. We haven’t tried to add an author yet. Click <strong class="bold">Authors</strong> and then click <strong class="bold">Add</strong>, and you’ll find the interface shown in <em class="italic">Figure 10</em><em class="italic">.17</em>.</p>
<div><div><img alt="Figure 10.17: Our code added inline books to the UI for managing authors" src="img/B19644_10_17.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.17: Our code added inline books to the UI for managing authors</p>
<p>As you can see, the form for adding books is now attached inline to the form for working with authors.</p>
<h1 id="_idParaDest-253"><a id="_idTextAnchor257"/>Creating Django views</h1>
<p>The admin UI is pretty magical, but it is really only designed to create simple screens for managing data in <a id="_idIndexMarker876"/>a database. Sooner or later, you’re going to have to actually make some real screens for the app itself.</p>
<p>We need to be careful about terminology here because the word <em class="italic">views</em> doesn’t mean what you might expect if you are versed in more conventional web development design patterns. The prevailing industry pattern is called <strong class="bold">Model-View-Controller </strong>(<strong class="bold">MVC</strong>). The pattern employed by Django is called <strong class="bold">Model-View-Template </strong>(<strong class="bold">MVT</strong>). <em class="italic">View</em> doesn’t mean the same thing between the two patterns. Let’s compare the two.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">MVC</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">MVT</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Model refers to the data structure, usually from a database.</p>
</td>
<td class="No-Table-Style">
<p>Model means the same thing as it does in MVC.</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>View refers to the visual elements which is usually the user interface.</p>
</td>
<td class="No-Table-Style">
<p>View refers to the controller layer, which accepts incoming requests, performs logic, and returns content or data.</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Controller refers to a layer that accepts incoming requests, performs logic, and returns content or data</p>
</td>
<td class="No-Table-Style">
<p>Template refers to the View in MVC, which is the HTML or user interface elements in the application.</p>
</td>
</tr>
</tbody>
</table>
<p>In summary, the Django View is<a id="_idIndexMarker877"/> really the Controller, and the<a id="_idIndexMarker878"/> Django Template would be the View in an MVC app. So here, when we are about to make the View, we’re talking about the part of the app <a id="_idIndexMarker879"/>that receives requests, does something, then returns the response.</p>
<p>Open the <code>views.py</code> file in the <code>TheGreatBookery</code> folder. Change the code to this:</p>
<pre class="source-code">
from django.shortcuts import render
<strong class="bold">from .models import Book</strong>
# Create your views here.
<strong class="bold">def index(request):</strong>
<strong class="bold">  latest_books = Book.objects.order_by('-pub_date')[:5]</strong>
<strong class="bold">  context = {'latest_books': latest_books}</strong>
<code>Book</code> model, then defined a method designed to accept a request, retrieve all the books in the database, and order them by the <code>pub_date</code> field in descending order indicated by the minus sign next to <code>pub_date</code>. We’re only going to display the first five books we find as indicated by the slice <code>[:5]</code>.</p>
<p>Next, we create a variable called context ,which becomes a dictionary that will be used to pass data to the template during rendering. In this case, it creates a key-value pair where the key is <code>latest_books</code> and the value is the <code>QuerySet</code> of the latest books retrieved in the previous step.</p>
<p>The <code>return</code> line calls the <code>render</code> method imported at the top of the file. It passes the <code>request</code> object, a path to the template (which we have yet to create), and the <code>context</code> dictionary variable we just created.</p>
<p>This view function won’t do all the <a id="_idIndexMarker880"/>work by itself. Before it can be used, it must be registered in the <code>urls.py</code> file so we have a route to employ this function.</p>
<p>Open <code>urls.py</code> and change the code to this:</p>
<pre class="source-code">
from django.contrib import admin
from django.urls import path
<strong class="bold">from TheGreatBookery.views import index</strong>
urlpatterns = [
 path('admin/', admin.site.urls),
 <strong class="bold">path('', index, name='index')</strong>
]</pre> <p>We added an import to the <code>index</code> function we just created in the <code>views.py</code> file. Next, we added by way of the <code>path</code> function an empty string, which will map the root route for the app, a reference to the <code>index</code> function that will execute in response to requests at the root route, and a friendly name.</p>
<p>We’re almost done. There’s just one more thing. Go back to the <code>view.py</code> file and you’ll see some problematic yellow highlighting. See <em class="italic">Figure 10</em><em class="italic">.18</em>.</p>
<div><div><img alt="Figure 10.18: We have a view and a URL mapped, but we haven’t made the template yet" src="img/B19644_10_18.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.18: We have a view and a URL mapped, but we haven’t made the template yet</p>
<p>Hover your mouse over <code>index.html</code> and <a id="_idIndexMarker881"/>note that the tooltip has an action available to create the template for us. Either click the blue link text in the tool-tip window or use <em class="italic">Alt</em> + <em class="italic">Shift</em> + <em class="italic">Enter</em> as indicated. <em class="italic">Figure 10</em><em class="italic">.19</em> shows the ensuing dialog.</p>
<div><div><img alt="Figure 10.19: The dialog you get when you use the in-line action to create the missing template is automatically filled in based on some obvious assumptions" src="img/B19644_10_19.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.19: The dialog you get when you use the in-line action to create the missing template is automatically filled in based on some obvious assumptions</p>
<p>When you click <code>Templates</code> called <code>TheGreatBookery</code>. It is possible to have multiple apps in your Django project. Since that is the case, you might want to segregate your templates. Go ahead and let PyCharm create the folder for you. After it does, you get an empty file called <code>index.html</code>.</p>
<p>This isn’t a book on web page design, so we aren’t even going to try to make this pretty. Enter this code into your <code>index.html</code> page:</p>
<pre class="source-code">
{% if latest_books %}
  &lt;ul&gt;
    {% for book in latest_books %}
      &lt;li&gt;{{ book.title }} by {{ book.author }}&lt;/li&gt;
    {% endfor %}
  &lt;/ul&gt;
{% else %}
  &lt;p&gt;No books available.&lt;/p&gt;
{% endif %}</pre> <p>This looks a lot like Jinja2 code we saw in <a href="B19644_08.xhtml#_idTextAnchor203"><em class="italic">Chapter 8</em></a> with Flask. It is very similar. All this code does is check whether or not a dictionary key called <code>latest_books</code> exists on the data context that was passed in. If <a id="_idIndexMarker882"/>you go back and look at the <code>render</code> function we called in the view, it’s passing this in.</p>
<p>If the key is there, we render the contents using the templates for loop syntax. This isn’t exactly an amazing UI. It is just going to render an unordered list with each book as a list item. If the key were not there, then we’ll be rendering a paragraph that says <strong class="bold">No </strong><strong class="bold">books available</strong>.</p>
<h2 id="_idParaDest-254"><a id="_idTextAnchor258"/>What’s with the weird Python icon in the template gutter?</h2>
<p>You might have noticed a big, juicy Python icon in the gutter of the <code>index.html</code> file. Check out <em class="italic">Figure 18</em><em class="italic">.20</em>.</p>
<div><div><img alt="Figure 10.20: Look at that icon up there just begging to be clicked!" src="img/B19644_10_20.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.20: Look at that icon up there just begging to be clicked!</p>
<p>That Python icon is actually called a <em class="italic">Pythicon</em>.</p>
<p>OK, no it isn’t, I just made that up. Still, you really want to<a id="_idIndexMarker883"/> click it, don’t you? Go ahead, click it! It takes you to the Python code in <code>views.py</code> where we invoke it. Travel works both ways. In <code>views.py</code>, you’ll notice<a id="_idIndexMarker884"/> a more subtle icon in the gutter where the template is invoked. See <em class="italic">Figure 18</em><em class="italic">.21</em>.</p>
<div><div><img alt="Figure 10.21: Click the HTML icon to navigate to the template" src="img/B19644_10_21.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.21: Click the HTML icon to navigate to the template</p>
<p>Again, just click the html icon, er, I mean HTML icon, to go to the template. I wouldn’t blame you for clicking back and forth between the two while saying, <em class="italic">“Take that, vi </em><em class="italic">and emacs!”</em></p>
<h2 id="_idParaDest-255"><a id="_idTextAnchor259"/>Run it!</h2>
<p>Start or restart your server <a id="_idIndexMarker885"/>and check the results as seen in <em class="italic">Figure 18</em><em class="italic">.22</em>. </p>
<div><div><img alt="Figure 10.22: This might be the best website ever!" src="img/B19644_10_22.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.22: This might be the best website ever!</p>
<p>If you direct your browser to <a href="http://localhost:8000/">http://localhost:8000/</a> you should see either some books or a message stating there are no books. I added some obvious reading choices and so my run looks absolutely glorious!</p>
<p>Clearly, you could leverage the HTML tooling we learned in <a href="B19644_07.xhtml#_idTextAnchor172"><em class="italic">Chapter 7</em></a> to make this nicer, but we still have more ground to cover, so I’ll leave that up to you.</p>
<h1 id="_idParaDest-256"><a id="_idTextAnchor260"/>Building Pyramid applications with PyCharm</h1>
<p>We’ve seen three popular web frameworks so far. There is one left that is listed in PyCharm’s <strong class="bold">New Project</strong> menu: <strong class="bold">Pyramid</strong>. You can find details on Pyramid at <a href="https://trypyramid.com/">https://trypyramid.com/</a>.</p>
<p>The organization behind Pyramid bills it as a <a id="_idIndexMarker886"/>framework that allows you to start small, finish big, and stay finished. To my mind, this might be a little bit of a dig at its main competitors. Django is criticized as being overly opinionated, and for being overkill for small projects. This fits with the “start small” idea in Pyramid. You have more leeway in choosing the components for your application, and you can leave out what you don’t need. For example, you can choose from a couple of ORM libraries, or simply choose not to use one. Django really wants you to use theirs.</p>
<p>Flask, in contrast, doesn’t come with an ORM or anything really, besides Jinja2 for templating. Flask is criticized for not being performant in large applications. The “finish big” concept seems to speak to this criticism. I’m not sure what, if anything, the “stay finished” directive is criticizing. I think that’s something we all want.</p>
<p>Having seen the first-rate tooling for Django, switching to Pyramid now is going to seem underwhelming. Django is a good candidate for custom tooling because it is complex, and it makes a lot of technical decisions for you. We can consider the <code>manage.py</code> task panel as an example. There are tons of commands in <code>manage.py</code>, so having its own panel makes sense. It also helps that Django is wildly popular. Pyramid isn’t. So from a PyCharm perspective, this is a much simpler proposition in terms of tooling.</p>
<h2 id="_idParaDest-257"><a id="_idTextAnchor261"/>Creating a Pyramid project</h2>
<p>Creating a Pyramid project is no<a id="_idIndexMarker887"/> different from any other. Just use <strong class="bold">File | New Project</strong>, and pick the <strong class="bold">Pyramid</strong> template, as shown in <em class="italic">Figure 10</em><em class="italic">.23</em>.</p>
<div><div><img alt="Figure 10.23: PyCharm has a project template for Pyramid" src="img/B19644_10_23.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.23: PyCharm has a project template for Pyramid</p>
<p>As with Django, you should twirl <a id="_idIndexMarker888"/>down the advanced settings, as shown in <em class="italic">Figure 10</em><em class="italic">.23</em>. You are able to set a project name, as you were in Django. Be careful with this setting!</p>
<p class="callout-heading">Pyramid project name</p>
<p class="callout">Make sure the project name is different than the PyCharm project name entered in the <strong class="bold">Location</strong> box.</p>
<p>When working with Pyramid, it’s a best practice to have a PyCharm project name that is different from the project name you define within Pyramid. This separation of names is recommended to avoid potential conflicts and confusion between the two namespaced systems: PyCharm, an IDE, and Pyramid, a Python web framework.</p>
<p>Here’s why it’s advisable to keep them different:</p>
<ul>
<li><strong class="bold">Namespace clashes</strong>: If your PyCharm project name matches your Pyramid project name exactly, you may encounter namespace clashes or naming conflicts. These conflicts can make it challenging for PyCharm to distinguish between project-specific settings, configurations, and files, and the Pyramid framework-specific files and <a id="_idIndexMarker889"/>configurations. This can lead to confusion and potential errors in your development process.</li>
<li><strong class="bold">PyCharm project settings</strong>: PyCharm uses the project name for its internal settings and configurations, including virtual environments, code analysis, and project-specific settings. If your PyCharm project name is the same as your Pyramid project name, PyCharm might overwrite or interfere with Pyramid-specific configurations and settings.</li>
<li><strong class="bold">Clarity and maintainability</strong>: Keeping distinct names for your PyCharm project and Pyramid project helps maintain clarity and organization in your development environment. It makes it easier to understand which aspects of your development are controlled by PyCharm and which are specific to your Pyramid web application.</li>
<li><strong class="bold">Flexibility</strong>: Having different names provides flexibility, especially if you work on multiple projects with Pyramid or use PyCharm for various other Python projects. It prevents potential conflicts when switching between projects.</li>
</ul>
<p>I’m going to name my imaginary project <code>giza_application</code>, a nod to the location of the Great Pyramids of Egypt.</p>
<p>Having set the project name, you can select from two template engines: <strong class="bold">Jinja2</strong> and <strong class="bold">Chameleon</strong>. Finally, you have settings for the ORM, which here is specified as <strong class="bold">Backend</strong>. The two choices are <strong class="bold">SQLAlchemy</strong>, which is very popular, and <strong class="bold">ZODB</strong>, which is somewhat exotic.</p>
<p>SQL Alchemy is a straightforward ORM used for working with relational databases. You create models as we did with Django’s ORM, and through a migration process, you can apply your database schema changes to a new or existing database.</p>
<p>ZODB refers to the Zope database. Generally speaking, Zope is an open source web application server written in Python. Less generally speaking, it is used as a content management system similar to WordPress. The database component, ZODB, has some interesting features that distinguish it from typical relational databases. It’s a powerful tool that can be used in conjunction with the Pyramid web framework to manage data in a more Pythonic way. Here’s how ZODB<a id="_idIndexMarker890"/> integrates into a Pyramid project and some of its features:</p>
<ul>
<li><strong class="bold">Python native</strong>: ZODB lets you store Python objects without needing to serialize them into a different format. You can work with complex data structures directly, without having to <a id="_idIndexMarker891"/>map them to a relational database schema.</li>
<li><strong class="bold">ACID transactions</strong>: ZODB supports <strong class="bold">Atomicity, Consistency, Isolation, Durability</strong> (<strong class="bold">ACID</strong>) transactions. This ensures that <a id="_idIndexMarker892"/>your data remains consistent, even if something goes wrong during a transaction.</li>
<li><code>pyramid_zodbconn</code> package. This provides a smooth way to get a ZODB connection within Pyramid’s request handling.</li>
<li><strong class="bold">Hierarchical storage</strong>: ZODB allows you to organize your data in a tree-like structure. This can be particularly useful in a Pyramid application using traversal, where the URL structure often mirrors a hierarchical data structure.</li>
<li><strong class="bold">Scalability</strong>: ZODB can be scaled across multiple machines, allowing for more extensive and complex applications.</li>
<li><strong class="bold">Versioning</strong>: ZODB supports object versioning, allowing you to keep track of changes to objects over time. This can be useful for implementing features such as undo/redo.</li>
<li><code>repoze.catalog</code>.</li>
<li><strong class="bold">No schema required</strong>: Unlike relational databases, ZODB doesn’t require a fixed schema, offering flexibility in data modeling. You can modify the Python classes used for storage without needing to migrate data.</li>
<li><strong class="bold">Blob support</strong>: ZODB supports the storage of large binary objects (BLOBs), such as images or videos, alongside regular objects.</li>
<li><strong class="bold">Persistence</strong>: ZODB provides a straightforward persistence model. Any changes to persistent objects within a transaction are automatically saved to the database when the transaction is committed.</li>
<li><strong class="bold">Compatibility</strong>: ZODB works well with various WSGI servers and can be integrated into a Pyramid application running on different platforms.</li>
</ul>
<p>ZODB can be a compelling choice for Pyramid<a id="_idIndexMarker893"/> developers looking for a database that aligns closely with Python’s object-oriented paradigm. Its integration into a Pyramid project allows for intuitive data management without the need for complex SQL queries or ORM mapping, making it an attractive option for certain types of applications. If the hierarchical, object-oriented nature of ZODB fits the data model of your Pyramid application, it may be an excellent choice. From a PyCharm perspective though, there is no special tooling for this database.</p>
<p>Clicking the <strong class="bold">OK</strong> button will generate the project structure and the run configuration.</p>
<p>I really wish there was more to say here, but in truth, besides Djano, any other framework that could have been covered last would have the same problem. We’ve already covered PyCharm’s tools for developing web applications in an unopinionated framework. We have seen the support for Jinja2 templates, working with an ORM, and obviously general Python project work.</p>
<h1 id="_idParaDest-258"><a id="_idTextAnchor262"/>Summary</h1>
<p>In this chapter, we examined various PyCharm features regarding supporting and automating tasks in the process of web development with Django. While this list of features is in no way exhaustive, I hope it can offer you a solid starting point to continue discovering other powerful features for your web development process.</p>
<p>First, we see that, by specifying the PyCharm project type as Django, an extensive project skeleton will be generated with convenient boilerplate code already filled out. With the implementation of the <code>manage.py</code> panel inside the project window as well as its run/debug configuration, PyCharm additionally allows for a higher level of development, with various tasks traditionally achieved via the command line, such as running the server or making migrations. Finally, by acknowledging integrated views and templates in Django, PyCharm makes it as easy as possible for developers to work with them in the editor—be it generating a missing template, code completion even in HTML and Jinja, or even dynamically switching between views and templates.</p>
<p>We concluded with a short coverage of Pyramid. Pyramid is a framework that aims to be more flexible than Django but packs more features than Flask. It’s a happy medium between the two. Unfortunately for Pyramid, we covered it last. PyCharm doesn’t have any special tooling for Pyramid beyond the project template that creates the project structure. To be fair, if Flask had gone last, it would have suffered the same fate because most of PyCharm’s web development tools are useful regardless of which framework you choose. Pyramid has some great features and is worthy of consideration for any project.</p>
<p>In the next chapter, we will tackle the last major component of any web application: the database. Buckle up, because the tooling for databases in PyCharm is <a id="_idTextAnchor263"/>extensive!</p>
<h1 id="_idParaDest-259"><a id="_idTextAnchor264"/>Questions</h1>
<ol>
<li>What are the major characteristics of Django, and how do they set Django apart from another popular Python web framework, Flask?</li>
<li>What is the purpose of the PyCharm <code>manage.py</code> panel in a Django project, and how does one open and utilize it?</li>
<li>What is the purpose of the Django admin interface? How does one create an instance of a model (that is, a new entry in a database table) in this interface? How does the process change if the model references another model?</li>
<li>What is the purpose of the run/debug configuration in PyCharm in the context of running a Django server?</li>
<li>Does PyCharm’s code completion logic only apply to Python code in Django projects?</li>
<li>What is the significance of being able to switch between Django views and corresponding templates in PyCharm?</li>
<li>Describe the PyCharm tooling available for the Pyramid framework.</li>
</ol>
<h1 id="_idParaDest-260"><a id="_idTextAnchor265"/>Further reading</h1>
<p>Be sure to check out the companion website for the book at <a href="https://www.pycharm-book.com">https://www.pycharm-book.com</a>.</p>
<p>Check the following resources to expand on what was covered in this chapter:</p>
<ul>
<li><em class="italic">Web Development with Django, </em><em class="italic">Second Edition</em></li>
<li><em class="italic">Hands-On RESTful Python Web Services, </em><em class="italic">Second Edition</em></li>
</ul>
</div>
</body></html>