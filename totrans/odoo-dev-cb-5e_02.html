<html><head></head><body>
		<div><h1 id="_idParaDest-52" class="chapter-number"><a id="_idTextAnchor051"/>2</h1>
			<h1 id="_idParaDest-53"><a id="_idTextAnchor052"/>Managing Odoo Server Instances</h1>
			<p>In <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, we looked at how to set up an Odoo instance using only the standard core add-ons that are shipped with the source. As a standard practice to customize Odoo default features, we create a separate module and keep it in a different repository so that you can later upgrade Odoo default and your own repository to keep it clean. This chapter focuses on adding non-core or custom add-ons to an Odoo instance. In Odoo, you can load add-ons from multiple directories. In addition, it is recommended that you load your third-party add-ons or your own custom add-ons from separate folders to avoid conflicts with Odoo core modules. Even Odoo Enterprise Edition is a type of add-ons directory, and you need to load this just like a normal add-ons directory.</p>
			<p>In this chapter, we will cover the following recipes:</p>
			<ul>
				<li>Configuring the add-ons path</li>
				<li>Standardizing your instance directory layout</li>
				<li>Installing and upgrading local add-on modules</li>
				<li>Installing add-on modules from GitHub</li>
				<li>Applying changes to add-ons</li>
				<li>Applying <a id="_idIndexMarker080"/>and trying proposed <strong class="bold">pull </strong><strong class="bold">requests</strong> (<strong class="bold">PRs</strong>)</li>
			</ul>
			<p class="callout-heading">About the terminology</p>
			<p class="callout">In this book, we will use the terms <code> </code><strong class="bold">module</strong> interchangeably. All of them refer to the Odoo app or extension app that can be installed in Odoo from the user interface.</p>
			<h1 id="_idParaDest-54"><a id="_idTextAnchor053"/>Configuring the add-ons path</h1>
			<p>With the help of the <code>addons_path</code> parameter, you can load your own add-on modules into Odoo. When Odoo initializes a new database, it will search for add-on modules within <a id="_idIndexMarker081"/>directories that have been provided in the <code>addons_path</code> configuration parameter. Odoo will search in these directories for the potential add-on module.</p>
			<p>Directories listed in <code>addons_path</code> are expected to contain subdirectories, each of which is an add-on module. Following the initialization of the database, you will be able to install modules that are given in these directories.</p>
			<h2 id="_idParaDest-55"><a id="_idTextAnchor054"/>Getting ready</h2>
			<p>This recipe assumes that you have an instance ready with a configuration file generated, as described in the <em class="italic">Storing the instance configuration in a file</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>,<em class="italic"> Installing the Odoo Development Environment</em>. Note that the source code of Odoo is available in <code>~/odoo-dev/odoo</code>, and the configuration file in <code>~/odoo-dev/odoo/myodoo.cfg</code>.</p>
			<h2 id="_idParaDest-56"><a id="_idTextAnchor055"/>How to do it…</h2>
			<p>To add the <code>~/odoo-dev/local-addons</code> directory to the <code>addons_path</code> parameter of the instance, perform the following steps:</p>
			<ol>
				<li>Edit the configuration file for your instance; that is, <code>~/odoo-dev/myodoo.cfg</code>.</li>
				<li>Locate the line starting with <code>addons_path=</code>. By default, this should look like the following:<pre class="source-code">
addons_path = ~/odoo-dev/odoo/odoo/addons,~/odoo-dev/odoo/addons</pre></li>				<li>Modify the line by appending a comma, followed by the name of the directory you want to add to <code>addons_path</code>, as shown in the following code:<pre class="source-code">
addons_path = ~odoo-dev/odoo/odoo/addons,~odoo-dev/odoo/addons,~/odoo-dev/local-addons</pre></li>				<li>Restart your instance from the terminal:<pre class="source-code">
<strong class="bold">$ ~/odoo-dev/odoo/odoo-bin -c myodoo.cfg</strong></pre></li>			</ol>
			<h2 id="_idParaDest-57"><a id="_idTextAnchor056"/>How it works…</h2>
			<p>When Odoo is restarted, the configuration file is read. The value of the <code>addons_path</code> variable is expected to be a comma-separated list of directories. Relative paths are accepted, but they are relative to the current working directory and therefore should <a id="_idIndexMarker082"/>be avoided in the configuration file.</p>
			<p>At this point, we have only listed the add-ons directory in Odoo, but no add-on modules are present in <code>~/odoo-dev/local-addons</code>. And even if you add a new add-on module to this directory, Odoo does not show this module in the user interface. For this, you need to perform an extra operation, as explained in the previous chapter’s <em class="italic">Updating the add-on modules </em><em class="italic">list</em> recipe.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The reason behind this is that when you initialize a new database, Odoo automatically lists your custom modules in available modules, but if you add new modules following database initialization, you then need to manually update the list of available modules, as shown in the <em class="italic">Updating the add-on modules list</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo </em><em class="italic">Development Environment</em>.</p>
			<h2 id="_idParaDest-58"><a id="_idTextAnchor057"/>There’s more…</h2>
			<p>When you call the <code>odoo-bin</code> script for the first time to initialize a new database, you can pass the <code>--addons-path</code> command-line argument with a comma-separated list of directories. This will <a id="_idIndexMarker083"/>initialize the list of available add-on modules with all of the add-ons found in the supplied add-ons path. When you do this, you have to explicitly include the base add-ons directory (<code>odoo/odoo/addons</code>) as well as the core add-ons directory (<code>odoo/addons</code>). A small difference with the preceding recipe is that the local add-ons must not be empty; they must contain at least one subdirectory, which has the minimal structure of an add-on module.</p>
			<p>In <a href="B20997_03.xhtml#_idTextAnchor083"><em class="italic">Chapter 3</em></a>, <em class="italic">Creating Odoo Add-on Modules</em>, we will look at how to write your own modules. In the meantime, here’s a quick hack to produce something that will make Odoo happy:</p>
			<pre class="console">
$ mkdir -p ~/odoo-dev/local-addons/dummy
$ touch ~/odoo-dev/local-addons/dummy/__init__.py
$ echo '{"name": "dummy", "installable": False}' &gt; \
~/odoo-dev/local-addons/dummy/__manifest__.py</pre>			<p>You can use the <code>--save</code> option to save the path to the configuration file:</p>
			<pre class="console">
$ odoo/odoo-bin -d odoo-test \
--addons-path="odoo/odoo/addons,odoo/addons,~/odoo-dev/local-addons" \
--save -c ~/odoo-dev/myodoo.cfg --stop-after-init</pre>			<p>In this case, using relative <a id="_idIndexMarker084"/>paths is OK since they will be converted into absolute paths in the configuration file.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Since Odoo only checks directories in the add-ons path for the presence of add-ons when the path is set from the command line, not when the path is loaded from a configuration file, the dummy module is no longer necessary. You may, therefore, remove it (or keep it until you’re sure that you won’t need to create a new configuration file).</p>
			<h1 id="_idParaDest-59"><a id="_idTextAnchor058"/>Standardizing your instance directory layout</h1>
			<p>We recommend <a id="_idIndexMarker085"/>that your development and production environments all use a similar directory layout. This standardization will prove helpful when you have to perform maintenance operations, and it will also ease your day-to-day work.</p>
			<p>This recipe creates a directory structure that groups files with similar life cycles or similar purposes in standardized subdirectories.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">This recipe is only useful if you want to manage similar folder structure development and production environments. If you do not want this, you can skip this recipe.</p>
			<p class="callout">Also, it is not compulsory to observe the same folder structure as in this recipe. Feel free to alter this structure to suit your needs.</p>
			<p>We generate a clean directory structure with clearly labeled directories and dedicated roles. We are <a id="_idIndexMarker086"/>using different directories to store the following:</p>
			<ul>
				<li>Code maintained by other people (in <code>src/</code>)</li>
				<li>Local-specific code</li>
				<li>The file store of the instance</li>
			</ul>
			<h2 id="_idParaDest-60"><a id="_idTextAnchor059"/>How to do it…</h2>
			<p>To create the proposed instance layout, you need to perform the following steps:</p>
			<ol>
				<li>Create one directory per instance:<pre class="source-code">
<strong class="bold">$ mkdir ~/odoo-dev/projectname</strong>
<code>virtualenv</code> object in a subdirectory called <code>env/</code>:<pre class="source-code">
<strong class="bold">$ python3 -m venv env</strong></pre></li>				<li>Create some subdirectories, as follows:<pre class="source-code">
<code>src/</code>: This contains the clone of Odoo itself, as well as various third-party add-on projects (we have added Odoo source code to the next step in this recipe)</li><li><code>local/</code>: This is used to save your instance-specific add-ons</li><li><code>bin/</code>: This includes various helper executable shell scripts</li><li><code>filestore/</code>: This is used as a file store</li><li><code>logs/</code> (<em class="italic">optional</em>): This is used to store the server log files</li></ul></li>
				<li>Clone Odoo and install the requirements (refer to <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, for details on this):<pre class="source-code">
<strong class="bold">$ git clone -b 17.0 --single-branch --depth 1 https://github.com/odoo/odoo.git src/odoo</strong>
<code>bin/odoo</code>:<pre class="source-code">
#!/bin/sh ROOT=$(dirname $0)/..
PYTHON=$ROOT/env/bin/python3 ODOO=$ROOT/src/odoo/odoo-bin
$PYTHON $ODOO -c $ROOT/projectname.cfg "$@" exit $?</pre></li>				<li>Make the script executable:<pre class="source-code">
<strong class="bold">$ chmod +x bin/odoo</strong></pre></li>				<li>Create an empty dummy local module:<pre class="source-code">
<strong class="bold">$ mkdir -p local/dummy</strong>
<strong class="bold">$ touch local/dummy/  init  .py</strong>
<strong class="bold">$ echo '{"name": "dummy", "installable": False}' &gt;\ local/dummy/  manifest  .py</strong></pre></li>				<li>Generate a configuration file for your instance:<pre class="source-code">
<strong class="bold">$ bin/odoo --stop-after-init --save \</strong>
<strong class="bold">--addons-path src/odoo/odoo/addons,src/odoo/addons,local \</strong>
<code>.gitignore</code> file, which is used to tell GitHub to exclude given directories so that Git will ignore these directories when you commit the code; for example, <code>filestore/</code>, <code>env/</code>, <code>logs/</code>, and <code>src/</code>:<pre class="source-code">
# dotfiles, with exceptions:
.*
!.gitignore
# python compiled files
*.py[co]
# emacs backup files
*~
# not tracked subdirectories
/env/
/src/
/filestore/
/logs/</pre></li>				<li>Create a Git <a id="_idIndexMarker088"/>repository for this instance and add the files you’ve added to Git:<pre class="source-code">
<strong class="bold">$ git init</strong>
<strong class="bold">$ git add .</strong>
<strong class="bold">$ git commit -m "initial version of projectname"</strong></pre></li>			</ol>
			<h2 id="_idParaDest-61"><a id="_idTextAnchor060"/>How it works…</h2>
			<p>By having one <code>virtualenv</code> environment per project, we are sure that the project’s dependencies will not interfere with the dependencies of other projects that may be running a different version of Odoo or will use different third-party add-on modules that require different versions of Python dependencies. This comes at the cost of a little disk space.</p>
			<p>In a similar way, by using separate clones of Odoo and third-party add-on modules for our different projects, we are able to let each of these evolve independently and only install updates on instances that need them, hence reducing the risk of introducing regressions.</p>
			<p>The <code>bin/odoo</code> script allows us to run the server without having to remember the various paths or activate the <code>virtualenv</code> environment. This also sets the configuration file for us. You can add extra scripts in there to help you in your day-to-day work. For instance, you can add a script to check out the different third-party projects that you need to run your instance.</p>
			<p>Regarding the <a id="_idIndexMarker089"/>configuration file, we have only demonstrated the bare minimum options to set up here, but you can obviously set up more, such as the database name, the database filter, or the port on which the project listens. Refer to <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, for more information on this topic.</p>
			<p>Finally, by managing all of this in a Git repository, it becomes quite easy to replicate the setup on a different computer and share the development among a team.</p>
			<p class="callout-heading">Speedup tip</p>
			<p class="callout">To facilitate project creation, you can create a template repository containing the empty structure and <a id="_idIndexMarker090"/>fork that repository for each new project. This will save you from retyping the <code>bin/odoo</code> script, the <code>.gitignore</code> file, and any other template file you need (<code>README.md</code>, changelog, and so on).</p>
			<h2 id="_idParaDest-62"><a id="_idTextAnchor061"/>There’s more...</h2>
			<p>The development of complex modules requires various configuration options, which leads to updating the configuration file whenever you want to try any configuration option. Updating the configuration file frequently can be a headache, and to avoid this, an alternative way is to pass all configuration options from the command line, as follows:</p>
			<ol>
				<li>Activate <code>virtualenv</code> manually:<pre class="source-code">
<strong class="bold">$ source env/bin/activate</strong></pre></li>				<li>Go to the Odoo source directory:<pre class="source-code">
<strong class="bold">$ cd src/odoo</strong></pre></li>				<li>Run the server:<pre class="source-code">
<strong class="bold">./odoo-bin --addons-path=addons,../../local -d test-16 -i account,sale,purchase --log-level=debug</strong></pre></li>			</ol>
			<p>In <em class="italic">step 3</em>, we passed a few configuration options directly from the command line. The first is <code>--addons-path</code>, which loads Odoo’s core add-ons directory, <code>addons</code>, and your add-ons directory, <code>local</code>, in which you will put your own add-on modules. The <code>-d</code> option will <a id="_idIndexMarker091"/>use the <code>test-16</code> database or create a new database if it isn’t present. The <code>-i</code> option will install the <code>account</code>, <code>sale</code>, and <code>purchase</code> modules. Next, we passed the <code>log-level</code> option and increased the log level to <code>debug</code> so that it would display more information in the log.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">By using the command line, you can quickly change the configuration options. You can also see live logs in the terminal. For all available options, refer to <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, or use the <code>--help</code> command to view a list of all options and a description of each option.</p>
			<h1 id="_idParaDest-63"><a id="_idTextAnchor062"/>Installing and upgrading local add-on modules</h1>
			<p>The core functionality of Odoo comes from its add-on modules. You have a wealth of add-ons available <a id="_idIndexMarker092"/>as part of Odoo itself, as well as add-on <a id="_idIndexMarker093"/>modules that you can download from the app store or that have been written by yourself.</p>
			<p>In this recipe, we will demonstrate how to install and upgrade add-on modules through the web interface and from the command line.</p>
			<p>The main benefits of using the command line for these operations include being able to act on more than one add-on at a time and having a clear view of the server logs as the installation or update progresses, which is very useful when in development mode or when scripting the installation of an instance.</p>
			<h2 id="_idParaDest-64"><a id="_idTextAnchor063"/>Getting ready</h2>
			<p>Make sure that you have a running Odoo instance with its database initialized and the add-ons path properly set. In this recipe, we will install/upgrade a few add-on modules.</p>
			<h2 id="_idParaDest-65"><a id="_idTextAnchor064"/>How to do it…</h2>
			<p>There are two <a id="_idIndexMarker094"/>possible methods to install or update <a id="_idIndexMarker095"/>add-ons—you can use the web interface or the command line.</p>
			<h3>From the web interface</h3>
			<p>To install a new <a id="_idIndexMarker096"/>add-on module in <a id="_idIndexMarker097"/>your database using the web interface, perform the following steps:</p>
			<ol>
				<li>Connect to the instance using the <strong class="bold">Administrator</strong> account and open the <strong class="bold">Apps</strong> menu:</li>
			</ol>
			<div><div><img src="img/B20997_02_1.jpg" alt="Figure 2.1 – List of Odoo apps"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.1 – List of Odoo apps</p>
			<ol>
				<li value="2">Use the search box to locate the add-on you want to install. Here are a few instructions to help you with this task:<ol><li class="lower-roman">Activate the <strong class="bold">Not </strong><strong class="bold">Installed</strong> filter.</li><li class="lower-roman">If you’re looking for a specific functionality add-on rather than a broad functionality add-on, remove the <strong class="bold">Apps</strong> filter.</li><li class="lower-roman">Type a part of the module name in the search box and use this as a <strong class="bold">Module</strong> filter.</li><li class="lower-roman">You may find that using the list view gives something more readable.</li></ol></li>
				<li>Click on the <strong class="bold">Install</strong> button under the module name on the card.</li>
			</ol>
			<p>Note that <a id="_idIndexMarker098"/>some Odoo add-on modules <a id="_idIndexMarker099"/>have external Python dependencies. If Python dependencies are not installed in your system, then Odoo will abort the installation, and it will show the following dialog:</p>
			<div><div><img src="img/B20997_02_2.jpg" alt="Figure 2.2 – Warning for external library dependency"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.2 – Warning for external library dependency</p>
			<p>To fix this, just install the relevant Python dependencies on your system.</p>
			<p>To update a pre-installed module in your database, perform the following steps:</p>
			<ol>
				<li>Connect to the instance using the <strong class="bold">Administrator</strong> account.</li>
				<li>Open the <strong class="bold">Apps</strong> menu.</li>
				<li>Click on <strong class="bold">Apps</strong>:</li>
			</ol>
			<div><div><img src="img/B20997_02_3.jpg" alt="Figure 2.3 – Odoo apps list"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.3 – Odoo apps list</p>
			<ol>
				<li value="4">Use the <a id="_idIndexMarker100"/>search box to locate <a id="_idIndexMarker101"/>the add-on you want to install. Here are a few tips:<ol><li class="lower-roman">Activate the <code>crm</code> and press <em class="italic">Enter</em> to search CRM apps.</li><li class="lower-roman">You may find that using the list view gives you something more readable.</li></ol></li>
				<li>Click on the three dots in the top-right corner of the card and click on the <strong class="bold">Upgrade</strong> option:</li>
			</ol>
			<div><div><img src="img/B20997_02_4.jpg" alt="Figure 2.4 – Drop-down link for upgrading the module"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.4 – Drop-down link for upgrading the module</p>
			<p>Activate <strong class="bold">Developer</strong> mode <a id="_idIndexMarker102"/>to see the <a id="_idIndexMarker103"/>technical name of the module. See <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>,<em class="italic"> Installing the Odoo Development Environment</em>, if you don’t know how to activate<a id="_idTextAnchor065"/> developer mode:</p>
			<div><div><img src="img/B20997_02_5.jpg" alt="Figure 2.5 – Application’s technical names"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.5 – Application’s technical names</p>
			<p>After activating developer mode, it will show the module’s technical name in red. If you are using Odoo Community Edition, you will see some extra apps with the <strong class="bold">Upgrade</strong> button. Those apps are Odoo Enterprise Edition apps, and in order to install/use them, you need to purchase a license.</p>
			<h3>From the command line</h3>
			<p>To install new <a id="_idIndexMarker104"/>add-ons in your database, perform <a id="_idIndexMarker105"/>the following steps:</p>
			<ol>
				<li>Find the names of the add-ons. This is the name of the directory containing the <code>__manifest__.py</code> file, without the leading path.</li>
				<li>Stop the instance. If you are working on a production database, make a backup.</li>
				<li>Run the following command:<pre class="source-code">
<strong class="bold">$ odoo/odoo-bin -c instance.cfg -d dbname -i addon1,addon2 \</strong>
<strong class="bold">--stop-after-init</strong></pre></li>			</ol>
			<p>You may omit <code>-d dbname</code> if this is set in your configuration file.</p>
			<ol>
				<li>Restart the instance.</li>
			</ol>
			<p>To update <a id="_idIndexMarker106"/>an already installed add-on <a id="_idIndexMarker107"/>module in your database, perform the following steps:</p>
			<ol>
				<li>Find the name of the add-on module to update; this is the name of the directory containing the <code>__manifest__.py</code> file, without the leading path.</li>
				<li>Stop the instance. If you are working on a production database, make a backup.</li>
				<li>Run the following command:<pre class="source-code">
<strong class="bold">$ odoo/odoo-bin -c instance.cfg -d dbname -u addon1 \</strong>
<strong class="bold">--stop-after-init</strong></pre></li>			</ol>
			<p>You may omit <code>-d dbname</code> if this is set in your configuration file.</p>
			<ol>
				<li>Restart the instance.</li>
			</ol>
			<h2 id="_idParaDest-66"><a id="_idTextAnchor066"/>How it works…</h2>
			<p>The add-on module installation and update are two closely related processes, but there are some important differences, as highlighted in the following two sections.</p>
			<h3>Add-on installation</h3>
			<p>When you install an add-on, Odoo checks its list of available add-ons for an uninstalled add-on with the supplied name. It also checks for the dependencies of that add-on and, if there are any, it will recursively install them before installing the add-on.</p>
			<p>The installation process of a single module consists of the following steps:</p>
			<ol>
				<li>If there are any dependencies, run the <code>preinit</code> add-on hook.</li>
				<li>Load the <a id="_idIndexMarker108"/>model definitions from the Python source code and update the database structure, if necessary (refer to <a href="B20997_04.xhtml#_idTextAnchor118"><em class="italic">Chapter 4</em></a>, <em class="italic">Application Models</em>, for details).</li>
				<li>Load the data files of the add-on and update the database contents, if necessary (refer to <a href="B20997_06.xhtml#_idTextAnchor319"><em class="italic">Chapter 6</em></a>, <em class="italic">Managing Module Data</em>, for details).</li>
				<li>Install the add-on demo data if demo data has been enabled in the instance.</li>
				<li>If there are any dependencies, run the add-on <code>postinit</code> hook.</li>
				<li>Run a validation of the view definitions of the add-on.</li>
				<li>If demo data is enabled and a test is enabled, run the tests of the add-on (refer to <a href="B20997_18.xhtml#_idTextAnchor990"><em class="italic">Chapter 18</em></a>, <em class="italic">Automated Test Cases</em>, for details).</li>
				<li>Update the module state in the database.</li>
				<li>Update the translations in the database from the add-on’s translations (refer to <a href="B20997_11.xhtml#_idTextAnchor595"><em class="italic">Chapter 11</em></a>, <em class="italic">Internationalization</em>, for details).</li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">The <code>preinit</code> and <code>postinit</code> hooks are defined in the <code>__manifest__.py</code> file using the <code>pre_init_hook</code> and <code>post_init_hook</code> keys, respectively. These hooks are used to invoke Python functions before and after the installation of an add-on module. To learn more about <code>init</code> hooks, refer to <a href="B20997_03.xhtml#_idTextAnchor083"><em class="italic">Chapter 3</em></a>, <em class="italic">Creating Odoo </em><em class="italic">Add-on Modules</em>.</p>
			<h3>Add-on update</h3>
			<p>When you update an add-on, Odoo checks in its list of available add-on modules for an installed add-on with the given name. It also checks for the reverse dependencies of that add-on (these are add-ons that depend on the updated add-on). If any, it will recursively update them, too.</p>
			<p>The update process of a single add-on module consists of the following steps:</p>
			<ol>
				<li>Run the add-on module’s pre-migration steps, if any (refer to <a href="B20997_06.xhtml#_idTextAnchor319"><em class="italic">Chapter 6</em></a>, <em class="italic">Managing Module Data</em>, for details).</li>
				<li>Load the model definitions from the Python source code and update the database <a id="_idIndexMarker109"/>structure if necessary (refer to <a href="B20997_04.xhtml#_idTextAnchor118"><em class="italic">Chapter 4</em></a>, <em class="italic">Application Models</em>, for details).</li>
				<li>Load the data files of the add-on and update the database’s contents if necessary (refer to <a href="B20997_06.xhtml#_idTextAnchor319"><em class="italic">Chapter 6</em></a>, <em class="italic">Managing Module Data</em>, for details).</li>
				<li>Update the add-on’s demo data if demo data is enabled in the instance.</li>
				<li>If your module has any migration methods, run the add-on post-migration steps (refer to <a href="B20997_06.xhtml#_idTextAnchor319"><em class="italic">Chapter 6</em></a>, <em class="italic">Managing Module Data</em>, for details).</li>
				<li>Run a validation of the view definitions of the add-on.</li>
				<li>If demo data is enabled and a test is enabled, run the tests of the add-on (refer to <a href="B20997_18.xhtml#_idTextAnchor990"><em class="italic">Chapter 18</em></a>, <em class="italic">Automated Test Cases</em>, for details).</li>
				<li>Update the module state in the database.</li>
				<li>Update the translations in the database from the add-on’s translations (refer to <a href="B20997_11.xhtml#_idTextAnchor595"><em class="italic">Chapter 11</em></a>, <em class="italic">Internationalization</em>, for details).</li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">Note that updating an add-on module that is not installed does nothing at all. However, installing an add-on module that is already installed reinstalls the add-on, which can have some unintended effects on some data files that contain data that is supposed to be updated by the user and not updated during the normal module update process (refer to the <em class="italic">Using the noupdate and forcecreate flags</em> recipe in <a href="B20997_06.xhtml#_idTextAnchor319"><em class="italic">Chapter 6</em></a>, <em class="italic">Managing Module Data</em>). There is no risk of error from the user interface, but this can happen from the command line.</p>
			<h2 id="_idParaDest-67"><a id="_idTextAnchor067"/>There’s more…</h2>
			<p>Be careful with dependency handling. Consider an instance where you want to have the <code>sale</code>, <code>sale_stock</code>, and <code>sale_specific</code> add-ons installed, with <code>sale_specific</code> depending on <code>sale_stock</code>, and <code>sale_stock</code> depending on <code>sale</code>. To install <a id="_idIndexMarker110"/>all three, you only need to install <code>sale_specific</code>, as it will recursively install the <code>sale_stock</code> and <code>sale</code> dependencies. To update all three, you need to update <code>sale</code> as this will recursively update the reverse dependencies, <code>sale_stock</code> and <code>sale_specific</code>.</p>
			<p>Another tricky part with managing dependencies is when you add a dependency to an add-on that already has a version installed. Let’s understand this by continuing with the previous example. Imagine that you add a dependency on <code>stock_dropshipping</code> in <code>sale_specific</code>. Updating the <code>sale_specific</code> add-on will not automatically install the new dependency, and neither will requesting the installation of <code>sale_specific</code>. In this situation, you can get very nasty error messages because the Python code of the add-on is not successfully loaded, but the data of the add-on and the models’ tables in the database are present. To resolve this, you need to stop the instance and manually install the new dependency.</p>
			<h1 id="_idParaDest-68"><a id="_idTextAnchor068"/>Installing add-on modules from GitHub</h1>
			<p>GitHub is a <a id="_idIndexMarker111"/>great source of third-party add-ons. A lot <a id="_idIndexMarker112"/>of Odoo partners use GitHub to share the add-ons they maintain internally, and the <strong class="bold">Odoo Community Association</strong> (<strong class="bold">OCA</strong>) collectively <a id="_idIndexMarker113"/>maintains several hundred add-ons on GitHub. Before you start writing your own add-on, ensure you check that nothing already exists that you can use as is or as a starting point.</p>
			<p>This recipe will show you how to clone the <code>partner-contact</code> project of the OCA from GitHub and make the add-on modules it contains available in your instance.</p>
			<h2 id="_idParaDest-69"><a id="_idTextAnchor069"/>Getting ready</h2>
			<p>Suppose you want to add new fields to the customer (partner) form. By default, the Odoo customer model doesn’t have a <code>gender</code> field. If you want to add a <code>gender</code> field, you need <a id="_idIndexMarker114"/>to create a new module. Fortunately, someone <a id="_idIndexMarker115"/>on a mailing list tells you about the <code>partner_contact_gender</code> add-on module, which is maintained by the OCA as part of the <code>partner-contact</code> project.</p>
			<p>The paths that are used in this recipe reflect the layout that was proposed in the <em class="italic">Standardizing your instance directory </em><em class="italic">layout</em> recipe.</p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor070"/>How to do it…</h2>
			<p>To install <code>partner_contact_gender</code>, perform the following steps:</p>
			<ol>
				<li>Go to your project’s directory:<pre class="source-code">
<code>17.0</code> branch of the <code>partner-contact</code> project in the <code>src/</code> directory:<pre class="source-code">
<strong class="bold">$ git clone --branch 17.0 \</strong>
<code>add-ons_path</code> line of <code>instance.cfg</code> should look like this:<pre class="source-code">
addons_path = ~/odoo-dev/my-odoo/src/odoo/odoo/addons, \
~/odoo-dev/my-odoo/src/odoo/addons, \
~/odoo-dev/my-odoo/src/partner-contact, \
~/odoo-dev/local-addons</pre></li>				<li>Install the <code>partner_contact_gender</code> add-on (if you don’t know how to install the module, take a look at the previous recipe, <em class="italic">Installing and upgrading local </em><em class="italic">add-on modules</em>).</li>
			</ol>
			<h2 id="_idParaDest-71"><a id="_idTextAnchor071"/>How it works…</h2>
			<p>All OCA code repositories have their add-ons contained in separate subdirectories, which is <a id="_idIndexMarker116"/>coherent per what is expected by Odoo <a id="_idIndexMarker117"/>regarding the directories in the add-ons path. Consequently, just cloning the repository somewhere and adding that location in the add-ons path is enough.</p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor072"/>There’s more…</h2>
			<p>Some maintainers follow a different approach and have one add-on module per repository, living at the root of the repository. In that case, you need to create a new directory, which you will add to the add-ons path, and clone all of the add-ons from the maintainer you need in this directory. Remember to update the add-on modules list each time you add a new repository clone.</p>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor073"/>Applying changes to add-ons</h1>
			<p>Most add-ons that are available on GitHub are subject to change and do not follow the rules that Odoo <a id="_idIndexMarker118"/>enforces for its stable release. They may receive bug fixes or enhancements, including issues or feature requests that you have submitted, and these changes may introduce database schema changes or updates in data files and views. This recipe explains how to install the updated versions.</p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor074"/>Getting ready</h2>
			<p>Suppose you reported an issue with <code>partner_contact_gender</code> and received a notification that the issue was solved in the last revision of the <code>17.0</code> branch of the <code>partner-contact</code> project. In this case, you would want to update your instance with this latest version.</p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor075"/>How to do it…</h2>
			<p>To apply a source modification to your add-on from GitHub, you need to perform the following steps:</p>
			<ol>
				<li>Stop the instance using that add-on.</li>
				<li>Make a backup if it is a production instance (refer to the <em class="italic">Managing Odoo server databases</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo </em><em class="italic">Development Environment</em>).</li>
				<li>Go to the <a id="_idIndexMarker119"/>directory where <code>partner-contact</code> was cloned:<pre class="source-code">
<strong class="bold">$ cd ~/odoo-dev/my-odoo/src/partner-contact</strong></pre></li>				<li>Create a local tag for the project so that you can revert to that version in case things break:<pre class="source-code">
<strong class="bold">$ git checkout 17.0</strong>
<strong class="bold">$ git tag 17.0-before-update-$(date --iso)</strong></pre></li>				<li>Get the latest version of the source code:<pre class="source-code">
<code>partner_address_street3</code> add-on in your databases (refer to the <em class="italic">Installing and upgrading local add-on </em><em class="italic">modules</em> recipe).</li>
				<li>Restart the instance.</li>
			</ol>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor076"/>How it works…</h2>
			<p>Usually, the developer of the add-on module occasionally releases the newest version of the add-on. This update typically contains bug fixes and new features. Here, we will get a new version of the add-on and update it in our instances.</p>
			<p>If <code>git pull --ff-only</code> fails, you can revert to the previous version using the following command:</p>
			<pre class="console">
$ git reset --hard 17.0-before-update-$(date --iso)</pre>			<p>Then, you can try <code>git pull</code> (without <code>--ff-only</code>), which will cause a merge, but this means that you have local changes on the add-on.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor077"/>See also</h2>
			<p>If the update step breaks, refer to the <em class="italic">Updating Odoo from source</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo Development Environment</em>, for recovery instructions. Remember to always test an update on a copy of a database production first.</p>
			<h1 id="_idParaDest-78"><a id="_idTextAnchor078"/>Applying and trying proposed PRs</h1>
			<p>In the GitHub world, a PR is a request that’s made by a developer so that the maintainers <a id="_idIndexMarker120"/>of a project can include some new developments. Such a PR may contain a bug fix or a new feature. These requests are reviewed and <a id="_idIndexMarker121"/>tested before being pulled into the <code>main</code> branch.</p>
			<p>This recipe explains how to apply a PR to your Odoo project in order to test an improvement or a bug fix.</p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor079"/>Getting ready</h2>
			<p>As in the previous recipe, suppose you reported an issue with <code>partner_address_street3</code> and received a notification that the issue was solved in a PR, which hasn’t been merged in the <code>17.0</code> branch of the project. The developer asks you to validate the fix in PR <em class="italic">#123</em>. You need to update a test instance with this branch.</p>
			<p>You should not try out such branches directly on a production database, so first create a test environment with a copy of the production database (refer to <a href="B20997_01.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a>, <em class="italic">Installing the Odoo </em><em class="italic">Development Environment</em>).</p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor080"/>How to do it…</h2>
			<p>To apply and try out a GitHub PR for an add-on, you need to perform the following steps:</p>
			<ol>
				<li>Stop the instance.</li>
				<li>Go to the directory where <code>partner-contact</code> was cloned:<pre class="source-code">
<strong class="bold">$ cd ~/odoo-dev/my-odoo/src/partner-contact</strong></pre></li>				<li>Create a local tag for the project so that you can revert to that version in case things break:<pre class="source-code">
<strong class="bold">$ git checkout 17.0</strong>
<code>123</code>:<pre class="source-code">
<code>partner_contact_gender1</code> add-on module in your database and restart the instance (refer to the <em class="italic">Installing and upgrading local add-on modules</em> recipe if you don’t know how to update the module).</li>
				<li>Test the update—try to reproduce your issue, or try out the feature you wanted.</li>
			</ol>
			<p>If this doesn’t work, comment on the PR page of GitHub, explaining what you did and what didn’t work so that the developer can update the PR.</p>
			<p>If it works, say so on the PR page too; this is an essential part of the PR validation process, and it will speed up merging in the <code>main</code> branch.</p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor081"/>How it works…</h2>
			<p>We are using a GitHub feature that enables PRs to be pulled by number using the <code>pull/nnnn/head</code> branch name, where <code>nnnn</code> is the number of the PR. The <code>git pull</code> command will merge the remote branch in ours, applying the changes in our code base. After this, we update the add-on module, test it, and report back to the author of the change with regard to any failures or successes.</p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor082"/>There’s more…</h2>
			<p>You can repeat <em class="italic">step 4</em> of this recipe for different PRs in the same repository if you want to test <a id="_idIndexMarker124"/>them simultaneously. If you are really happy with the <a id="_idIndexMarker125"/>result, you can create a branch to keep a reference to the result of the applied changes:</p>
			<pre class="console">
$ git checkout -b 17.0-custom</pre>			<p>Using a different branch will help you remember that you are not using the version from GitHub, but a custom one.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <code>git branch</code> command can be used to list all local branches you have in your repository.</p>
			<p>From then on, if you need to apply the latest revision of the <code>17.0</code> branch from GitHub, you will need to pull it without using <code>--ff-only</code>:</p>
			<pre class="console">
$ git pull origin 17.0</pre>		</div>
	</body></html>