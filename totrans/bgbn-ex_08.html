<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Home Security Systems Using BeagleBone Black"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Home Security Systems Using BeagleBone Black</h1></div></div></div><p>In this chapter, we will focus on building a real-time Internet-connected home security surveillance system using the BeagleBone board. Similar to previous chapters, we will use OpenCV and Python on BeagleBone with a camera connected to it. But to take the project to an advanced level, we will add a PIR sensor to the BeagleBone board and write code on it to interact with the physical world. We will get started with motion detection using PIR sensors, followed by sending e-mails from BeagleBone boards using Python. We will finish the chapter with a project, in which we will build a motion-detection security camera that will send e-mail alerts with images captured whenever motion is detected by the PIR sensor.</p><p>The contents of this chapter are divided into the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Prerequisites</li><li class="listitem" style="list-style-type: disc">PIR sensors</li><li class="listitem" style="list-style-type: disc">Motion detection using PIR sensors</li><li class="listitem" style="list-style-type: disc">Sending e-mails with attachments</li><li class="listitem" style="list-style-type: disc">Advanced project – motion detection, image capture, and alert system</li></ul></div><div class="section" title="Prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec54"/>Prerequisites</h1></div></div></div><p>Here<a id="id364" class="indexterm"/> are the requirements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A BeagleBone Black</li><li class="listitem" style="list-style-type: disc">A microSD Card with the latest version of Debian flashed on it to boot the BeagleBone board</li><li class="listitem" style="list-style-type: disc">A 5V DC, 2A power supply</li><li class="listitem" style="list-style-type: disc">An Ethernet cable</li><li class="listitem" style="list-style-type: disc">A USB<a id="id365" class="indexterm"/> camera</li><li class="listitem" style="list-style-type: disc">A PIR sensor</li></ul></div></div></div>
<div class="section" title="PIR sensors"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec55"/>PIR sensors</h1></div></div></div><p>A <span class="strong"><strong>PIR</strong></span> (short for <span class="strong"><strong>passive infrared</strong></span>) sensor is an electronic sensor that measures <span class="strong"><strong>infrared</strong></span> (<span class="strong"><strong>IR</strong></span>) light <a id="id366" class="indexterm"/>radiating from objects present in its field of view. Mostly, these sensors are used in PIR-based motion detectors.</p><div class="mediaobject"><img src="graphics/4602_08_01.jpg" alt="PIR sensors"/></div><div class="section" title="How PIR sensors work"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec16"/>How PIR sensors work</h2></div></div></div><p>If you look<a id="id367" class="indexterm"/> at the following diagram picture, a PIR sensor has two slots in it, and each slot is prepared with the help of special materials that are IR sensitive. The Fresnel lens helps the two slots in the sensor to widen the detecting area of the sensor as well as its distance, that is, the sensitivity of the sensor. Both slots detect the same amount of IR when there is no movement in front of the sensor or the detection area; we call this the idle state of the sensor, during which the slots detect the ambient amount of IR radiated from the room or outdoors. The sensor calibrates itself and waits for<a id="id368" class="indexterm"/> the movement of a warm body.</p><div class="mediaobject"><img src="graphics/4602_08_02.jpg" alt="How PIR sensors work"/></div><p>When half of the PIR sensor intercepts any warm body, such as a human or animal, it causes a positive differential change between the two halves of the PIR sensor. Similarly, a negative differential change is generated when the warm body leaves the sensing area, which is nothing but the reverse of the generation of a positive differential change. So, basically, the output we obtain is in the form of rising and falling pulses from the sensor output pin, using which we infer whether there was any movement in front of the PIR.</p><p>You might be wondering why there is a difference between the preceding diagram and the actual image of it, shown in the first image. Actually, the first image is to make you understand how the PIR sensor works. It shows the sensor available in market, which we will be using. In order to make the sensor work with a wide detection area, its lens is in the shape of a hemisphere, if you take a look at the following image, you can see that slots have been made at various angles on the lens to have a wide area of detection and for mounting at various places, such as ceilings and walls, to detect the motion of a moving body.</p><div class="mediaobject"><img src="graphics/4602_08_03.jpg" alt="How PIR sensors work"/></div><p>Most of these hobby-grade PIR sensors available in the market have a detection area 90 degrees wide, but<a id="id369" class="indexterm"/> some have one up to 110 degrees and 5 to 6 meters length. You can chose and buy whichever one you prefer.</p><div class="mediaobject"><img src="graphics/4602_08_04.jpg" alt="How PIR sensors work"/></div></div></div>
<div class="section" title="Motion detection using PIR sensors"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec56"/>Motion detection using PIR sensors</h1></div></div></div><p>Now that <a id="id370" class="indexterm"/>we know how a PIR sensors <a id="id371" class="indexterm"/>works, let's go ahead and hook it up with our BeagleBone board to detect motion.</p><p>First of all, take three berg wires and connect the PIR sensor to the BeagleBone board, as per the following circuit diagram:</p><div class="mediaobject"><img src="graphics/4602_08_05.jpg" alt="Motion detection using PIR sensors"/></div><p>As shown in<a id="id372" class="indexterm"/> the preceding<a id="id373" class="indexterm"/> circuit diagram, connect the PIR sensor's Vcc to the 5V pin on the BeagleBone board, the output pin of PIR to GPIO60 on the BeagleBone board, and the ground pins on both with each other.</p><p>Then, we will turn on the BeagleBone board and log in to the Linux shell to start coding it.</p><p>Create a new Python program using <code class="literal">sudo nano TestPIR.py</code>:</p><div class="mediaobject"><img src="graphics/4602_08_06.jpg" alt="Motion detection using PIR sensors"/></div><p>Type in the code shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_08_07.jpg" alt="Motion detection using PIR sensors"/></div><p>Once <a id="id374" class="indexterm"/>you have typed in the <a id="id375" class="indexterm"/>code, you can go ahead and save it using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>X</em></span>.</p><p>Have a look at the comments in the code to get an idea of how it works. We are setting up <code class="literal">GPIO_60</code> as <code class="literal">INPUT PIN</code>, reading the RISING edge from the output coming from the PIR sensor, and printing out text saying <span class="strong"><strong>Movement Detected</strong></span> every time we read a RISING edge from the sensor on GPIO pin <code class="literal">60</code>.</p><p>When you run the command, you should see the following output:</p><div class="mediaobject"><img src="graphics/4602_08_08.jpg" alt="Motion detection using PIR sensors"/></div><p>You can place your hand or make any movement in front of the sensor, as shown in the following picture:</p><div class="mediaobject"><img src="graphics/4602_08_09.jpg" alt="Motion detection using PIR sensors"/></div><p>There is <a id="id376" class="indexterm"/>an option to set the <a id="id377" class="indexterm"/>sensitivity, that is, the range of the detection area, by varying the potentiometer on the sensor. Have a look at the following figure to get a better idea. You also have another potentiometer to vary the trigger time, which is nothing but the time period until which the pulse will be high and get back to low during the auto reset mode of the sensor. When it is set to no reset mode, the pulse will stay HIGH forever until another movement is detected. Usually, the preferred method is auto reset.</p><div class="mediaobject"><img src="graphics/4602_08_10.jpg" alt="Motion detection using PIR sensors"/></div><p>Now<a id="id378" class="indexterm"/> that we have tested the <a id="id379" class="indexterm"/>PIR sensors, let's move ahead to sending an e-mail with an attachment using Python from BeagleBone Black.</p></div>
<div class="section" title="Sending e-mail with an attachment from BeagleBone Black"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec57"/>Sending e-mail with an attachment from BeagleBone Black</h1></div></div></div><p>Like the OpenCV library to work with images and camera on BeagleBone Black with Python, we have<a id="id380" class="indexterm"/> many other wonderful libraries<a id="id381" class="indexterm"/> that are developed and are built in Python. One such library is the SMTP e-mail library, which we will be using in this section.</p><p>To test this, we will use the image we captured in the project in the previous chapter, available inside the <code class="literal">ImageCapture</code> folder.</p><p>We will change our working directory to the <code class="literal">ImageCapture</code> directory first, as shown in the following screenshot, using <code class="literal">cd ImageCapture</code>:</p><div class="mediaobject"><img src="graphics/4602_08_11.jpg" alt="Sending e-mail with an attachment from BeagleBone Black"/></div><p>Then, we will go ahead and create a Python file with code to send an e-mail with an attachment in it. To do that, first create a new file named <code class="literal">sendemail.py</code>, using <code class="literal">sudo nano sendemail.py</code>:</p><div class="mediaobject"><img src="graphics/4602_08_12.jpg" alt="Sending e-mail with an attachment from BeagleBone Black"/></div><p>Now, type in <a id="id382" class="indexterm"/>the code shown in the following<a id="id383" class="indexterm"/> screenshot and save the file inside the <code class="literal">ImageCapture</code> folder itself. The code has been written with comments on most of the lines for you to get a clear idea of how it works.</p><div class="mediaobject"><img src="graphics/4602_08_13.jpg" alt="Sending e-mail with an attachment from BeagleBone Black"/></div><p>You'll see that the <code class="literal">Photo.jpg</code> file that we captured in our previous project is still available inside the <code class="literal">ImageCapture</code> folder, and it's the same image that we will be attaching in the e-mail that is going to be sent while executing this program:</p><div class="mediaobject"><img src="graphics/4602_08_14.jpg" alt="Sending e-mail with an attachment from BeagleBone Black"/></div><p>When you<a id="id384" class="indexterm"/> execute the program, you<a id="id385" class="indexterm"/> should get an e-mail on the receiver's e-mail address you mentioned in the <code class="literal">sendemail.py</code> code file, and the output the terminal will look like this:</p><div class="mediaobject"><img src="graphics/4602_08_15.jpg" alt="Sending e-mail with an attachment from BeagleBone Black"/></div><p>As it prints on the Linux shell that the e-mail was sent, you will have received the e-mail on your e-mail account; check out these screenshots of the e-mail I got:</p><div class="mediaobject"><img src="graphics/4602_08_16.jpg" alt="Sending e-mail with an attachment from BeagleBone Black"/></div><p>So, like this, you can attach any attachment to the e-mail and send it from BeagleBone. As we now know how to detect motion using a PIR sensor connected to the BeagleBone board as well as how to send an e-mail with a photo as an attachment, let's go ahead and merge the previous chapter's camera image-capture project with whatever we have learned so<a id="id386" class="indexterm"/> far in this chapter to build<a id="id387" class="indexterm"/> an advanced project.</p></div>
<div class="section" title="Advanced project &#x2013; Motion-based home security alert system"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec58"/>Advanced project – Motion-based home security alert system</h1></div></div></div><p>In this section, we will build a home surveillance security alert system, where we will have a<a id="id388" class="indexterm"/> BeagleBone board to which a PIR sensor is connected. A USB camera is connected to it, and the BeagleBone board is connected to the Internet. So basically, the system will capture an image from the camera whenever some movement is detected in front of the PIR sensor. </p><p>Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set up the PIR sensor with the BeagleBone board, just like we did in the motion-detection topic of this chapter, connect the USB web camera to the BeagleBone board and, log in into the system. The setup looks as shown in the following picture:<div class="mediaobject"><img src="graphics/4602_08_17.jpg" alt="Advanced project – Motion-based home security alert system"/></div></li><li class="listitem">Create a new directory for this project with <code class="literal">sudo mkdir HomeSecurity</code>:<div class="mediaobject"><img src="graphics/4602_08_18.jpg" alt="Advanced project – Motion-based home security alert system"/></div><p>Use <code class="literal">cd HomeSecurity</code>:</p><div class="mediaobject"><img src="graphics/4602_08_19.jpg" alt="Advanced project – Motion-based home security alert system"/></div></li><li class="listitem">Create the<a id="id389" class="indexterm"/> Python script for the project using <code class="literal">sudo nano EmailAlert.py</code>:<div class="mediaobject"><img src="graphics/4602_08_20.jpg" alt="Advanced project – Motion-based home security alert system"/></div></li></ol></div><p>Type the following code into the file. The code contains comments on most of the lines to give you a clear explanation of how it works.</p><div class="mediaobject"><img src="graphics/4602_08_21.jpg" alt="Advanced project – Motion-based home security alert system"/></div><p>Once you have typed the code, go ahead and save it. When you run it, you should see the output in<a id="id390" class="indexterm"/> the Linux shell, as shown in the following screenshot, whenever there is movement in front of the PIR sensor:</p><div class="mediaobject"><img src="graphics/4602_08_22.jpg" alt="Advanced project – Motion-based home security alert system"/></div><p>The following image shows how I waved my hand in front of the PIR sensor, keeping my finger in<a id="id391" class="indexterm"/> front of it and taking it away:</p><div class="mediaobject"><img src="graphics/4602_08_23.jpg" alt="Advanced project – Motion-based home security alert system"/></div><p>And the screenshots of the e-mail I got are shown in the following series of images:</p><div class="mediaobject"><img src="graphics/4602_08_24.jpg" alt="Advanced project – Motion-based home security alert system"/></div><p>Like this, you can use Python, OpenCV, and the e-mail library of Python together to click pictures<a id="id392" class="indexterm"/> and send an e-mail alert every time some movement is detected by the PIR sensor.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec59"/>Summary</h1></div></div></div><p>In this chapter, we used our knowledge from the previous chapter about OpenCV with what we learned in this chapter about PIR sensor interfacing using the BeagleBone board and sending e-mail using Python from the BeagleBone board to build a motion-detection camera surveillance security e-mail alert system. Instead of stopping this project here, I recommend you to try out other methods of motion detection and build the same system without a PIR sensor. There are lots of resources online on motion detection using OpenCV in real time using Python. Try setting up a system where without the PIR sensor, motion detection is performed using just the camera and an e-mail alert is sent.</p></div></body></html>