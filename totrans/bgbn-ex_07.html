<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Working with Images Using Computer Vision"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working with Images Using Computer Vision</h1></div></div></div><p>In this chapter, we will be getting started on interfacing a USB camera with a BeagleBone board and capturing images from the camera using OpenCV. We will start by installing OpenCV first and then move ahead with capturing images using OpenCV and Python.</p><p>We will look deeply into the topics given in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Prerequisites</li><li class="listitem" style="list-style-type: disc">Adding a USB camera to BeagleBone Black</li><li class="listitem" style="list-style-type: disc">An introduction to OpenCV</li><li class="listitem" style="list-style-type: disc">Using Python and OpenCV together</li><li class="listitem" style="list-style-type: disc">Image capture from a camera using Python and OpenCV</li></ul></div><div class="section" title="Prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec49"/>Prerequisites</h1></div></div></div><p>This<a id="id340" class="indexterm"/> topic will cover what parts you will need in this chapter. These can be bought online.</p><p>We will need the following materials to begin:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">1x BeagleBone Black</li><li class="listitem" style="list-style-type: disc">1x microSD card with the latest version of Debian flashed on it to boot the BeagleBone board from a microSD card</li><li class="listitem" style="list-style-type: disc">1x 5V DC, 2A power supply</li><li class="listitem" style="list-style-type: disc">1x Ethernet cable</li><li class="listitem" style="list-style-type: disc">1x USB camera</li></ul></div><div class="section" title="Materials needed"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec14"/>Materials needed</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">1x BeagleBone Black</li><li class="listitem" style="list-style-type: disc">1x microSD card<a id="id341" class="indexterm"/> with latest version of Debian flashed on it to boot the BeagleBone board from an microSD card</li><li class="listitem" style="list-style-type: disc">1x 5V DC, 2A power supply</li><li class="listitem" style="list-style-type: disc">1x Ethernet cable</li><li class="listitem" style="list-style-type: disc">1x USB camera</li></ul></div></div></div></div>
<div class="section" title="Adding a USB camera to a BeagleBone board"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Adding a USB camera to a BeagleBone board</h1></div></div></div><p>Adding<a id="id342" class="indexterm"/> a USB camera to a BeagleBone board is pretty straightforward. All you need to do is get a USB camera that is compatible with Linux, so one which has drivers for Linux. These days almost all USB web cameras come with this support. If you have a very old USB web camera that you want to interface with a BeagleBone board, you might have to add some additional steps to install the device drivers to see your video camera element on the Linux devices list on the BeagleBone board. For this topic explanation, I used a Logitech C270 HD webcam, as shown in the following figure:</p><div class="mediaobject"><img src="graphics/4602_07_01.jpg" alt="Adding a USB camera to a BeagleBone board"/></div><p>You can use the USB port available on the BeagleBone board to connect the USB camera as shown in the following picture:</p><div class="mediaobject"><img src="graphics/4602_07_02.jpg" alt="Adding a USB camera to a BeagleBone board"/></div><p>Boot the <a id="id343" class="indexterm"/>BeagleBone board using Debian on the MicroSD Card that we flashed earlier, and login into the BeagleBone board via SSH. Now type the command <code class="literal">Lsusb </code>as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_03.jpg" alt="Adding a USB camera to a BeagleBone board"/></div><p>If you are able to see the webcam listed on the device list, it means the camera is connected properly to the BeagleBone board, via USB.</p><p>Then, check <a id="id344" class="indexterm"/>whether the drivers are available for the camera in the Linux kernel and if it has successfully interfaced, and created a video input element in the list of devices in Debian. Let's change the directory to dev directory <code class="literal">cd /dev</code>, and then <code class="literal">ls</code>. If you see the <span class="strong"><strong>video0</strong></span> listed on the list, then you can assume that everything went well and the USB web camera was interfaced with the BeagleBone board successfully. We now have a video0 element that we can use in OpenCV or in any other software that we will be installing in BeagleBone board to get a video input from the camera.</p><div class="mediaobject"><img src="graphics/4602_07_04.jpg" alt="Adding a USB camera to a BeagleBone board"/></div><p>Now that we have a video component available in our BeagleBone board, we can go ahead and install OpenCV to get started with capturing images from the USB web camera and store them on the microSD card available on our BeagleBone board.</p></div>
<div class="section" title="OpenCV &#x2013; introduction and setting up on the BeagleBone board"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>OpenCV – introduction and setting up on the BeagleBone board</h1></div></div></div><p>In this topic <a id="id345" class="indexterm"/>you will learn about what OpenCV is and how we can use it to capture images from a web camera that is connected to the BeagleBone board.</p><p>OpenCV<a id="id346" class="indexterm"/> stands for Open Source Computer Vision. It is mainly designed for real-time computer visualization. So, this library will basically help us to use commonly used programming languages like C, C++ and Python to capture images from the camera connected to our computer  – in our case, using the BeagleBone board. When we go to the project section of this chapter to capture an image from the USB camera using Python, you will understand how simple the OpenCV library makes it to code in getting inputs from the camera, generate outputs as image files, and much more in image processing.</p><div class="section" title="Installing OpenCV on Debian on a BeagleBone board"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec15"/>Installing OpenCV on Debian on a BeagleBone board</h2></div></div></div><p>Follow<a id="id347" class="indexterm"/> the steps to install OpenCV on Debian on a BeagleBone board:</p><p>Step 1: Install compiler:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get -y install build-essential cmake pkg-config</strong></span>
</pre></div><p>These compilers are very important to build packages from source codes and then install them. Installing them will be useful for us in future, particularly during the robot project:</p><div class="mediaobject"><img src="graphics/4602_07_05.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Step 2: Install the other required packages that are needed before compiling compulsorily:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</strong></span>
</pre></div><p>In Linux, most of the software written will use other open source packages in them to build their software, so these packages are the ones that OpenCV use in their software to give us a beautiful and easy to code/use library.</p><div class="mediaobject"><img src="graphics/4602_07_06.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>When you <a id="id348" class="indexterm"/>install the packages, if it prompts you to use additional disk space, go ahead and hit <span class="emphasis"><em>Y</em></span> and then <span class="emphasis"><em>Enter</em></span> to get started installing the required packages.</p><p>There are some more software packages you will have to install before compiling, which are listed following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install libjpeg62-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install libtiff4-dev libjasper-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install  libgtk2.0-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install libdc1394-22-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install libxine-dev libgstreamer0.10-dev libgstreamer-plugins-base0.10-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install python-dev python-numpy</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get -y install libqt4-dev</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get install unzip</code></li></ul></div><p>Step 3: Install a few other optional softwares that might come in handy in the future while working with OpenCV. These are recommended by OpenCV:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">sudo apt-get install python-dev python-numpy libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev</code></li></ul></div><p>These softwares are not compulsory to for OpenCV to work, but when you connect a display to a BeagleBone board in the future and want to use graphics, these will surely come in <a id="id349" class="indexterm"/>handy. It's better to install them now instead of getting frustrated in the future with errors popping up when you write codes with display elements and GUI.</p><div class="mediaobject"><img src="graphics/4602_07_07.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>By this stage, we have installed all the necessary packages needed to compile and install OpenCV on BeagleBone Black. So, now let's go ahead and download the source code files of OpenCV and then compile and install them. Let's create a new directory and save all the files inside it while building the OpenCV library:</p><p>Step 4: Create an OpenCVdirectory with the following commands:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mkdir OCV</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">cd OCV</code></li></ul></div><p>It will look like this:</p><div class="mediaobject"><img src="graphics/4602_07_08.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Step 5: Clone the OpenCV source code into our working directory:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">wget https://sourceforge.net/projects/opencvlibrary/files/opencv-unix/2.4.9/opencv-2.4.9.zip</code></li></ul></div><p>The <code class="literal">wget</code> command will download the file from the URL that follows it and save it in the present working directory. You can see the percentage of the download status as it happens in the Linux shell, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_09.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>You <a id="id350" class="indexterm"/>need to wait until the download completes and check whether you received the zip file by using the <code class="literal">ls</code> command. If you see the file, as shown in the following screenshot, you can proceed to the next step:</p><div class="mediaobject"><img src="graphics/4602_07_10.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Step 6: Building OpenCV from source files using cmake:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">unzip opencv-2.4.9.zip –d opencv</code></li></ul></div><p>First we need to unzip the <code class="literal">.zip</code> file we downloaded to extract the contents of the file.</p><div class="mediaobject"><img src="graphics/4602_07_11.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Then we compile the files inside it wait until unzipping process is completed:</p><div class="mediaobject"><img src="graphics/4602_07_12.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Then<a id="id351" class="indexterm"/> use the <code class="literal">ls</code> command to check whether an <code class="literal">opencv</code> folder is created and the contents of the <code class="literal">.zip</code> have been extracted inside it:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ls</code></li></ul></div><p>You can see the <code class="literal">opencv</code> folder has been created, inside which the files have been unzipped: <code class="literal">cd opencv</code>:</p><div class="mediaobject"><img src="graphics/4602_07_13.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>This is how the <code class="literal">ls</code> and <code class="literal">cd opencv-2.4.9</code> will look like in the command:</p><div class="mediaobject"><img src="graphics/4602_07_14.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Now we need to create a folder inside which we will compile and build the files for installation from the source files available inside the <code class="literal">opencv-2.4.9</code> folder. You need to execute the commands <code class="literal">mkdir build</code> and <code class="literal">cd build</code> in order to do that:</p><div class="mediaobject"><img src="graphics/4602_07_15.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D WITH_TBB=ON -D BUILD_NEW_PYTHON_SUPPORT=ON -D WITH_V4L=ON -D INSTALL_C_EXAMPLES=ON -D INSTALL_PYTHON_EXAMPLES=ON -D BUILD_EXAMPLES=ON -D WITH_QT=OFF -D WITH_OPENGL=ON</code></li></ul></div><p>This is how it looks:</p><div class="mediaobject"><img src="graphics/4602_07_16.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Now, wait <a id="id352" class="indexterm"/>until the configuration is finished:</p><div class="mediaobject"><img src="graphics/4602_07_17.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Once it has finished, you should see something like the preceding screenshot.</p><p>Now we can go ahead and compile the files:</p><p>Step 7: Compile <code class="literal">make</code> and it will look like this:</p><div class="mediaobject"><img src="graphics/4602_07_18.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Wait until the program is compiled and ready to install:</p><div class="mediaobject"><img src="graphics/4602_07_19.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Once the files are compiled and built, we can install OpenCV libraries to our system using the next step:</p><p>Step 8: Install <code class="literal">sudo make install</code>:</p><div class="mediaobject"><img src="graphics/4602_07_20.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Wait <a id="id353" class="indexterm"/>until the program is installed.</p><div class="mediaobject"><img src="graphics/4602_07_21.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>Once installed let's go ahead and test whether everything was installed properly with the following command:</p><p>Step 9: Validate the installation</p><p>Since we will be using Python and OpenCV together, lets validate whether the Python library of OpenCV was installed properly or not, using the following command:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">sudo python</code></li></ul></div><p>Inside the Python interactive shell enter the <code class="literal">from cv2 import_version_</code> command to import the library, and then to print the version execute the following command:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">_version_</code></li></ul></div><p>You should see something like the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_22.jpg" alt="Installing OpenCV on Debian on a BeagleBone board"/></div><p>If it prints the version without any errors, everything is fine, you can see that its <span class="strong"><strong>2.4.9</strong></span>, and that is the same version you downloaded as a zip file in step 5.</p><p>Now that we have the OpenCV library successfully installed we can go ahead to our next topic where we will be using Python and OpenCV together to capture an image from the USB video <a id="id354" class="indexterm"/>camera that we have plugged into our BeagleBone board.</p></div></div>
<div class="section" title="Project: Image capture from a camera using Python and OpenCV"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Project: Image capture from a camera using Python and OpenCV</h1></div></div></div><p>In this<a id="id355" class="indexterm"/> chapter we will be writing a code to capture an image from a camera and saving it in <code class="literal">.jpg</code> format using Python.</p><p>Let's first create a directory named <code class="literal">ImageCapture</code> inside which we can save the Python file in which we write the code, and where we can also save the image file that we capture:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mkdir ImageCapture</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">cd ImageCapture</code></li></ul></div><p>It will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_23.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">sudo nano TakePhoto.py</code><p>Refer to the following image:</p><div class="mediaobject"><img src="graphics/4602_07_24.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div></li></ul></div><p>Now we can go ahead and start writing the code to capture an image from the camera and save it on the BeagleBone Black:</p><p>The simplest code possible to do this is given in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_25.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>Save it <a id="id356" class="indexterm"/>and run it to capture an image from the camera and save it.</p><p>The output you will see when you run the code <code class="literal">sudo python TakePhoto.py</code> is as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_26.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>If you don't get any errors and the program ends printing the <span class="strong"><strong>Saving Image</strong></span> text, everything should have happened properly. To check this let's see whether the <code class="literal">Photo.jpg</code> file has been created inside the folder or not. You can use the <code class="literal">ls</code> command to do it and you should see the <code class="literal">Photo.jpg</code> file created as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_27.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>Since we are working on BeagleBone Black via SSH we don't have the option to view the image directly on the GUI now – we will need a <a id="id357" class="indexterm"/>
<span class="strong"><strong>File Transfer Protocol</strong></span> (<span class="strong"><strong>FTP</strong></span>) client software to <a id="id358" class="indexterm"/>download the image that was captured. So, let's go ahead and install one on our Windows PC now.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>FileZilla is my favourite, so I will be using it in this tutorial, you can use the ones you are familiar with or install FileZilla if you don't have it.</p></div></div><p>Once you have opened the FTP software, it will ask you for the IP address of the device, username, password, and port number:</p><div class="mediaobject"><img src="graphics/4602_07_28.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>This is how the software looks. You can see on the top left corner a space for entering the host's IP address, username, password, and port number. Below that you can see the directory selection of where you want the files to be downloaded and uploaded from, and at the bottom, you can see the log of data transfers.</p><p>Now lets go ahead and connect our PC to the BeagleBone Black via FTP to transfer the image file we captured and see how it looks. The details you need to enter are the IP address assigned to the BeagleBone board, using which you connect to it via SSH, the same IP address and user name as <code class="literal">debian</code> and password <code class="literal">temppwd</code> which is default, if you have changed your username and password, then use them here and the port number is <code class="literal">22</code>. Then click on the Quick connect button and you should see the files on the BeagleBone Black, as<a id="id359" class="indexterm"/> shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_29.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>You can click on the <span class="strong"><strong>+</strong></span> symbol next to the <code class="literal">Debian</code> folder shown in the picture and navigate to the <code class="literal">ImageCapture</code> folder inside which the <code class="literal">Photo.jpg</code> file that we captured and saved is present. You will see something like the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_30.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>Now you can<a id="id360" class="indexterm"/> go ahead and download the file. Once you click on <span class="strong"><strong>Download</strong></span>, the file will be downloaded to the FTP folder or the folder which you have selected on the PC fpr where the files will be downloaded. You can see in the following screenshot that the <code class="literal">Photo.jpg</code> file is now inside the FTP folder which was empty before on your PC:</p><div class="mediaobject"><img src="graphics/4602_07_31.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>So, now <a id="id361" class="indexterm"/>that you have the photo that you captured, downloaded to your PC, you can go ahead and open it to see it with the image viewer software you have set up on your PC.</p><div class="mediaobject"><img src="graphics/4602_07_32.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>The <a id="id362" class="indexterm"/>image captured is as shown in the previous screenshot and the arrangement of the camera while taking this picture was as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4602_07_33.jpg" alt="Project: Image capture from a camera using Python and OpenCV"/></div><p>In the <a id="id363" class="indexterm"/>preceding picture you can see that the camera has been placed pointing towards the BeagleBone Black and at a distance, so the image that we captured was showing the side view of the BeagleBone Black, showing the USB connected to it, and the background. </p><p>So, in this way, you can use Python and OpenCV together to take pictures and save them for use in many applications.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec53"/>Summary</h1></div></div></div><p>This chapter was just a start for you get to know what open OpenCV is, to set it up on BeagleBone Black and to understand a little bit of what you can do with it using Python by writing just a few lines of code. In this chapter, the image capture project is just a simple thing we did – you can play around and do a lot more like capturing videos and saving them, changing a color image to black and white, and other image processing using OpenCV and Python. Now we know how to click a picture and save it.</p><p>In the next chapter, we will build a home security application project using a sensor to detect motion and click a picture whenever a motion is detected. In this way, we will be building a real-time application using OpenCV, BeagleBone Black and Python where the system will interact with the physical world.</p></div></body></html>