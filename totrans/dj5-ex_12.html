<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer365">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">12</span></h1>
<h1 class="chapterTitle" id="_idParaDest-332"><span class="koboSpan" id="kobo.2.1">Building an E-Learning Platform</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, you learned the basics of the internationalization and localization of Django projects, adapting your project to meet the local formats and languages for your users.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, you will start a new Django project that will consist of an e-learning platform with your own </span><strong class="keyWord"><span class="koboSpan" id="kobo.5.1">content management system</span></strong><span class="koboSpan" id="kobo.6.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.7.1">CMS</span></strong><span class="koboSpan" id="kobo.8.1">). </span><span class="koboSpan" id="kobo.8.2">Online learning platforms are a great example of applications that require tools for advanced content handling. </span><span class="koboSpan" id="kobo.8.3">You will learn how to create flexible data models that accommodate diverse data types and discover how to implement custom model functionalities that you can apply to your future Django projects.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.9.1">In this chapter, you will learn how to:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Create models for the CMS</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Create fixtures for your models and apply them</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Use model inheritance to create data models for polymorphic content</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Create custom model fields</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Order course contents and modules</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1">Build authentication views for the CMS</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-333"><span class="koboSpan" id="kobo.16.1">Functional overview</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.17.1">In previous chapters, diagrams at the start represented views, templates, and end-to-end functionalities. </span><span class="koboSpan" id="kobo.17.2">This chapter, however, shifts the focus to implementing model inheritance and creating custom model fields, topics not easily captured in our usual diagrams. </span><span class="koboSpan" id="kobo.17.3">Instead, you will see specific diagrams to illustrate these concepts throughout the chapter.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">The source code for this chapter can be found at </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter12"><span class="url"><span class="koboSpan" id="kobo.19.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter12</span></span></a><span class="koboSpan" id="kobo.20.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.21.1">All the Python modules used in this chapter are included in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.22.1">requirements.txt</span></code><span class="koboSpan" id="kobo.23.1"> file in the source code that comes with this chapter. </span><span class="koboSpan" id="kobo.23.2">You can follow the instructions to install each Python module below, or you can install all the requirements at once with the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.24.1">python</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.25.1">-m</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.26.1">pip</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.27.1">install</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.28.1">-r requirements.txt</span></code><span class="koboSpan" id="kobo.29.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-334"><span class="koboSpan" id="kobo.30.1">Setting up the e-learning project</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.31.1">Your final practical project</span><a id="_idIndexMarker1091"/><span class="koboSpan" id="kobo.32.1"> will be an e-learning platform. </span><span class="koboSpan" id="kobo.32.2">First, create a virtual environment for your new project within the </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">env/</span></code><span class="koboSpan" id="kobo.34.1"> directory with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.35.1">python -m venv env/educa
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.36.1">If you are using Linux or macOS, run the following command to activate your virtual environment:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.37.1">source env/educa/bin/activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.38.1">If you are using Windows, use the following command instead:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.39.1">.\env\educa\Scripts\activate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.40.1">Install Django in your virtual environment with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.41.1">python -m pip install Django~=5.0.4
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.42.1">You are going to manage image uploads in your project, so you also need to install </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">Pillow</span></code><span class="koboSpan" id="kobo.44.1"> with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.45.1">python -m pip install Pillow==10.3.0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.46.1">Create a new project using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.47.1">django-admin startproject educa
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.48.1">Enter the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.49.1">educa</span></code><span class="koboSpan" id="kobo.50.1"> directory and create a new application using the following commands:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.51.1">cd educa
django-admin startapp courses
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.52.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.53.1">settings.py</span></code><span class="koboSpan" id="kobo.54.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.55.1">educa</span></code><span class="koboSpan" id="kobo.56.1"> project and add </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">courses</span></code><span class="koboSpan" id="kobo.58.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.59.1">INSTALLED_APPS</span></code><span class="koboSpan" id="kobo.60.1"> setting, as follows. </span><span class="koboSpan" id="kobo.60.2">The </span><a id="_idIndexMarker1092"/><span class="koboSpan" id="kobo.61.1">new line is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.62.1">INSTALLED_APPS = [
    </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.63.1">'courses.apps.CoursesConfig'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.64.1">,</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.65.1">'django.contrib.admin'</span></span><span class="koboSpan" id="kobo.66.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.67.1">'django.contrib.auth'</span></span><span class="koboSpan" id="kobo.68.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.69.1">'django.contrib.contenttypes'</span></span><span class="koboSpan" id="kobo.70.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.71.1">'django.contrib.sessions'</span></span><span class="koboSpan" id="kobo.72.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.73.1">'django.contrib.messages'</span></span><span class="koboSpan" id="kobo.74.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.75.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.76.1">django.contrib.staticfiles'</span></span><span class="koboSpan" id="kobo.77.1">,
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.78.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.79.1">courses</span></code><span class="koboSpan" id="kobo.80.1"> application is now active for the project. </span><span class="koboSpan" id="kobo.80.2">Next, we are going to prepare our project to serve media files and we will define the models for the courses and course contents.</span></p>
<h1 class="heading-1" id="_idParaDest-335"><span class="koboSpan" id="kobo.81.1">Serving media files</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.82.1">Before creating the models for courses and</span><a id="_idIndexMarker1093"/><span class="koboSpan" id="kobo.83.1"> course contents, we will prepare the project to serve media files. </span><span class="koboSpan" id="kobo.83.2">Course instructors will be able to upload media files to course content using the CMS that we will build. </span><span class="koboSpan" id="kobo.83.3">Therefore, we will configure the project to serve media files.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.84.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">settings.py</span></code><span class="koboSpan" id="kobo.86.1"> file of the project and add the following lines:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.87.1">MEDIA_URL = </span><span class="hljs-string"><span class="koboSpan" id="kobo.88.1">'media/'</span></span><span class="koboSpan" id="kobo.89.1">
MEDIA_ROOT = BASE_DIR / </span><span class="hljs-string"><span class="koboSpan" id="kobo.90.1">'media'</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.91.1">This will enable Django to manage file uploads and serve media files. </span><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">MEDIA_URL</span></code><span class="koboSpan" id="kobo.93.1"> is the base URL used to serve the media files uploaded by users. </span><code class="inlineCode"><span class="koboSpan" id="kobo.94.1">MEDIA_ROOT</span></code><span class="koboSpan" id="kobo.95.1"> is the local path where they reside. </span><span class="koboSpan" id="kobo.95.2">Paths and URLs for files are built dynamically by prepending the project path or the media URL to them for portability.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.96.1">Now, edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.97.1">urls.py</span></code><span class="koboSpan" id="kobo.98.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.99.1">educa</span></code><span class="koboSpan" id="kobo.100.1"> project and modify the code, as follows. </span><span class="koboSpan" id="kobo.100.2">New lines are highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.101.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.102.1"> django.conf </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.103.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.104.1"> settings</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.105.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.106.1"> django.conf.urls.static </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.107.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.108.1"> static</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.109.1">from</span></span><span class="koboSpan" id="kobo.110.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.111.1">import</span></span><span class="koboSpan" id="kobo.112.1"> admin
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.113.1">from</span></span><span class="koboSpan" id="kobo.114.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.115.1">import</span></span><span class="koboSpan" id="kobo.116.1"> path
urlpatterns = [
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.117.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.118.1">admin/'</span></span><span class="koboSpan" id="kobo.119.1">, admin.site.urls),
]
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.120.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.121.1"> settings.DEBUG:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.122.1">    urlpatterns += static(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.123.1">        settings.MEDIA_URL, document_root=settings.MEDIA_ROOT</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.124.1">    )</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.125.1">We have added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.126.1">static()</span></code><span class="koboSpan" id="kobo.127.1"> helper </span><a id="_idIndexMarker1094"/><span class="koboSpan" id="kobo.128.1">function to serve media files with the Django development server during development (that is, when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">DEBUG</span></code><span class="koboSpan" id="kobo.130.1"> setting is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">True</span></code><span class="koboSpan" id="kobo.132.1">).</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.133.1">Remember that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.134.1">static()</span></code><span class="koboSpan" id="kobo.135.1"> helper function is suitable for development but not for production use. </span><span class="koboSpan" id="kobo.135.2">Django is inefficient at serving static files. </span><span class="koboSpan" id="kobo.135.3">Never serve your static files with the Django development server in a production environment. </span><span class="koboSpan" id="kobo.135.4">You will learn how to serve static files in a production environment in </span><em class="italic"><span class="koboSpan" id="kobo.136.1">Chapter 17</span></em><span class="koboSpan" id="kobo.137.1">, </span><em class="italic"><span class="koboSpan" id="kobo.138.1">Going Live</span></em><span class="koboSpan" id="kobo.139.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.140.1">The project is now ready to serve media files. </span><span class="koboSpan" id="kobo.140.2">Let’s create the models for the courses and course contents.</span></p>
<h1 class="heading-1" id="_idParaDest-336"><span class="koboSpan" id="kobo.141.1">Building the course models</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.142.1">Your e-learning platform will </span><a id="_idIndexMarker1095"/><span class="koboSpan" id="kobo.143.1">offer courses on various subjects. </span><span class="koboSpan" id="kobo.143.2">Each course will be divided into a configurable number of modules, and each module will contain a configurable number of contents. </span><span class="koboSpan" id="kobo.143.3">The contents will be of various types: text, files, images, or videos. </span><span class="koboSpan" id="kobo.143.4">The following example shows what the data structure of your course </span><a id="_idIndexMarker1096"/><span class="koboSpan" id="kobo.144.1">catalog will look like:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.145.1">Subject 1
  Course 1
    Module 1
      Content 1 (image)
      Content 2 (text)
    Module 2
      Content 3 (text)
      Content 4 (file)
      Content 5 (video)
      ...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.146.1">Let’s build the course models. </span><span class="koboSpan" id="kobo.146.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.147.1">models.py</span></code><span class="koboSpan" id="kobo.148.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1">courses</span></code><span class="koboSpan" id="kobo.150.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.151.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.152.1"> django.contrib.auth.models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.153.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.154.1"> User</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.155.1">from</span></span><span class="koboSpan" id="kobo.156.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.157.1">import</span></span><span class="koboSpan" id="kobo.158.1"> models
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.159.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.160.1">Subject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.161.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.162.1">    title = models.CharField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.163.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.164.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.165.1">    slug = models.SlugField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.166.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.167.1">, unique=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.168.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.169.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.170.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.171.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.172.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.173.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.174.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.175.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.176.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.177.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.178.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.179.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.180.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.181.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.182.1"> self.title</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.183.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.184.1">Course</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.185.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.186.1">    owner = models.ForeignKey(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.187.1">        User,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.188.1">        related_name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.189.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.190.1">courses_created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.191.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.192.1">        on_delete=models.CASCADE</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.193.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.194.1">    subject = models.ForeignKey(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.195.1">        Subject,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.196.1">        related_name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.197.1">'courses'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.198.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.199.1">        on_delete=models.CASCADE</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.200.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.201.1">    title = models.CharField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.202.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.203.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.204.1">    slug = models.SlugField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.205.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.206.1">, unique=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.207.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.208.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.209.1">    overview = models.TextField()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.210.1">    created = models.DateTimeField(auto_now_add=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.211.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.212.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.213.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.214.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.215.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.216.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.217.1">'-created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.218.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.219.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.220.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.221.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.222.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.223.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.224.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.225.1"> self.title</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.226.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.227.1">Module</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.228.1">(models.Model):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.229.1">    course = models.ForeignKey(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.230.1">        Course, related_name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.231.1">'modules'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.232.1">, on_delete=models.CASCADE</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.233.1">    )</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.234.1">    title = models.CharField(max_length=</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.235.1">200</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.236.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.237.1">    description = models.TextField(blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.238.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.239.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.240.1">def</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.241.1">__str__</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.242.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.243.1">self</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.244.1">):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.245.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.246.1"> self.title</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.247.1">These are the initial </span><code class="inlineCode"><span class="koboSpan" id="kobo.248.1">Subject</span></code><span class="koboSpan" id="kobo.249.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.250.1">Course</span></code><span class="koboSpan" id="kobo.251.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">Module</span></code><span class="koboSpan" id="kobo.253.1"> models. </span><span class="koboSpan" id="kobo.253.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.254.1">Course</span></code><span class="koboSpan" id="kobo.255.1"> model fields are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">owner</span></code><span class="koboSpan" id="kobo.257.1">: The instructor who created this course.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">subject</span></code><span class="koboSpan" id="kobo.259.1">: The subject that this course belongs to. </span><span class="koboSpan" id="kobo.259.2">It is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">ForeignKey</span></code><span class="koboSpan" id="kobo.261.1"> field that points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">Subject</span></code><span class="koboSpan" id="kobo.263.1"> model.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.264.1">title</span></code><span class="koboSpan" id="kobo.265.1">: The title of the course.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.266.1">slug</span></code><span class="koboSpan" id="kobo.267.1">: The slug of the course. </span><span class="koboSpan" id="kobo.267.2">This will be used in URLs later.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.268.1">overview</span></code><span class="koboSpan" id="kobo.269.1">: A </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1">TextField</span></code><span class="koboSpan" id="kobo.271.1"> column to store an overview of the course.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.272.1">created</span></code><span class="koboSpan" id="kobo.273.1">: The date and time when the course was created. </span><span class="koboSpan" id="kobo.273.2">It will be automatically set by </span><a id="_idIndexMarker1097"/><span class="koboSpan" id="kobo.274.1">Django when creating new objects because of </span><code class="inlineCode"><span class="koboSpan" id="kobo.275.1">auto_now_add=True</span></code><span class="koboSpan" id="kobo.276.1">.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.277.1">Each course is divided into several modules. </span><span class="koboSpan" id="kobo.277.2">Therefore, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.278.1">Module</span></code><span class="koboSpan" id="kobo.279.1"> model contains a </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">ForeignKey</span></code><span class="koboSpan" id="kobo.281.1"> field that points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">Course</span></code><span class="koboSpan" id="kobo.283.1"> model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.284.1">Open the shell and run the following command to create the initial migration for this application:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.285.1">python manage.py makemigrations
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.286.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.287.1">Migrations for 'courses':
  courses/migrations/0001_initial.py:
    - Create model Course
    - Create model Module
    - Create model Subject
    - Add field subject to course
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.288.1">Then, run the following command to apply all migrations to the database:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.289.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.290.1">You should see output that includes all applied migrations, including those of Django. </span><span class="koboSpan" id="kobo.290.2">The output will contain the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.291.1">Applying courses.0001_initial... </span><span class="koboSpan" id="kobo.291.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.292.1">The models of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">courses</span></code><span class="koboSpan" id="kobo.294.1"> application have been synced with the database. </span><span class="koboSpan" id="kobo.294.2">Next, we are going to add the course</span><a id="_idIndexMarker1098"/><span class="koboSpan" id="kobo.295.1"> models to the administration site.</span></p>
<h2 class="heading-2" id="_idParaDest-337"><span class="koboSpan" id="kobo.296.1">Registering the models in the administration site</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.297.1">Let’s register the course models on the </span><a id="_idIndexMarker1099"/><span class="koboSpan" id="kobo.298.1">administration site so that we can manage the data easily. </span><span class="koboSpan" id="kobo.298.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.299.1">admin.py</span></code><span class="koboSpan" id="kobo.300.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.301.1">courses</span></code><span class="koboSpan" id="kobo.302.1"> application directory and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.303.1">from</span></span><span class="koboSpan" id="kobo.304.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.305.1">import</span></span><span class="koboSpan" id="kobo.306.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.307.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.308.1"> .models </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.309.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.310.1"> Subject, Course, Module</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.311.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.312.1">Subject</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.313.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.314.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.315.1">SubjectAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.316.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.317.1">    list_display = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.318.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.319.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.320.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.321.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.322.1">    prepopulated_fields = {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.323.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.324.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.325.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.326.1">,)}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.327.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.328.1">ModuleInline</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.329.1">(admin.StackedInline):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.330.1">    model = Module</span></strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.331.1">@admin.register(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.332.1">Course</span></strong><strong class="hljs-meta-slc"><span class="koboSpan" id="kobo.333.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.334.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.335.1">CourseAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.336.1">(admin.ModelAdmin):</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.337.1">    list_display = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.338.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.339.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.340.1">'subject'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.341.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.342.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.343.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.344.1">    list_filter = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.345.1">'created'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.346.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.347.1">'subject'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.348.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.349.1">    search_fields = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.350.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.351.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.352.1">'overview'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.353.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.354.1">    prepopulated_fields = {</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.355.1">'slug'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.356.1">: (</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.357.1">'title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.358.1">,)}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.359.1">    inlines = [ModuleInline]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.360.1">The models for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.361.1">courses</span></code><span class="koboSpan" id="kobo.362.1"> application are now registered on the administration site. </span><span class="koboSpan" id="kobo.362.2">Remember that you use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.363.1">@admin.register()</span></code><span class="koboSpan" id="kobo.364.1"> decorator to register models on the administration site.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.365.1">In the next section, you will learn </span><a id="_idIndexMarker1100"/><span class="koboSpan" id="kobo.366.1">how to create initial data to populate your models.</span></p>
<h2 class="heading-2" id="_idParaDest-338"><span class="koboSpan" id="kobo.367.1">Using fixtures to provide initial data for models</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.368.1">Sometimes, you might want to prepopulate your database with hardcoded data. </span><span class="koboSpan" id="kobo.368.2">This is useful for automatically including initial </span><a id="_idIndexMarker1101"/><span class="koboSpan" id="kobo.369.1">data in the project setup, instead of having to add it manually. </span><span class="koboSpan" id="kobo.369.2">Django comes with a simple way to load and dump data from the database into files that are called </span><strong class="keyWord"><span class="koboSpan" id="kobo.370.1">fixtures</span></strong><span class="koboSpan" id="kobo.371.1">. </span><span class="koboSpan" id="kobo.371.2">Django supports</span><a id="_idIndexMarker1102"/><span class="koboSpan" id="kobo.372.1"> fixtures in JSON, XML, or YAML formats. </span><span class="koboSpan" id="kobo.372.2">The structure of a fixture closely resembles the API representation of a model, making it straightforward to translate data between internal database formats and external applications. </span><span class="koboSpan" id="kobo.372.3">You are going to create a fixture to include several initial </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">Subject</span></code><span class="koboSpan" id="kobo.374.1"> objects for your project.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.375.1">First, create a superuser using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.376.1">python manage.py createsuperuser
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.377.1">Then, run the development server using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.378.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.379.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.380.1">http://127.0.0.1:8000/admin/courses/subject/</span></code><span class="koboSpan" id="kobo.381.1"> in your browser. </span><span class="koboSpan" id="kobo.381.2">Create several subjects using the administration site. </span><span class="koboSpan" id="kobo.381.3">The change list page should look as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.382.1"><img alt="" role="presentation" src="../Images/B21088_12_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.383.1">Figure 12.1: The subject change list view on the administration site</span></p>
<p class="normal"><span class="koboSpan" id="kobo.384.1">Run the following </span><a id="_idIndexMarker1103"/><span class="koboSpan" id="kobo.385.1">command from</span><a id="_idIndexMarker1104"/><span class="koboSpan" id="kobo.386.1"> the shell:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.387.1">python manage.py dumpdata courses --indent=2
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.388.1">You will see an output similar to the following:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.389.1">[
{
  "model": "courses.subject",
  "pk": 1,
  "fields": {
    "title": "Mathematics",
    "slug": "mathematics"
  }
},
{
  "model": "courses.subject",
  "pk": 2,
  "fields": {
    "title": "Music",
    "slug": "music"
  }
},
{
  "model": "courses.subject",
  "pk": 3,
  "fields": {
    "title": "Physics",
    "slug": "physics"
  }
},
{
  "model": "courses.subject",
  "pk": 4,
  "fields": {
    "title": "Programming",
    "slug": "programming"
  }
}
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.390.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">dumpdata</span></code><span class="koboSpan" id="kobo.392.1"> command dumps data from the database into the standard output, serialized in JSON format by</span><a id="_idIndexMarker1105"/><span class="koboSpan" id="kobo.393.1"> default. </span><span class="koboSpan" id="kobo.393.2">The resulting data structure includes information about the model and its fields for Django to be able to load it into the database.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.394.1">You can limit the output </span><a id="_idIndexMarker1106"/><span class="koboSpan" id="kobo.395.1">to the models of an application by providing the application names to the command or specifying single models for outputting data using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.396.1">app.Model</span></code><span class="koboSpan" id="kobo.397.1"> format. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.398.1">You can also specify the format using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.399.1">--format</span></code><span class="koboSpan" id="kobo.400.1"> flag. </span><span class="koboSpan" id="kobo.400.2">By default, </span><code class="inlineCode"><span class="koboSpan" id="kobo.401.1">dumpdata</span></code><span class="koboSpan" id="kobo.402.1"> outputs the serialized data to the standard output. </span><span class="koboSpan" id="kobo.402.2">However, you can indicate an output file using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.403.1">--output</span></code><span class="koboSpan" id="kobo.404.1"> flag, which allows you to store the output. </span><span class="koboSpan" id="kobo.404.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.405.1">--indent</span></code><span class="koboSpan" id="kobo.406.1"> flag allows you to specify indentations. </span><span class="koboSpan" id="kobo.406.2">For more information on </span><code class="inlineCode"><span class="koboSpan" id="kobo.407.1">dumpdata</span></code><span class="koboSpan" id="kobo.408.1"> parameters, run </span><code class="inlineCode"><span class="koboSpan" id="kobo.409.1">python manage.py dumpdata --help</span></code><span class="koboSpan" id="kobo.410.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.411.1">Save this dump to a fixtures file in a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.412.1">fixtures/</span></code><span class="koboSpan" id="kobo.413.1"> directory in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1">courses</span></code><span class="koboSpan" id="kobo.415.1"> application using the following commands:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.416.1">mkdir courses/fixtures
python manage.py dumpdata courses --indent=2 --output=courses/fixtures/subjects.json
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.417.1">Run the development server and use the administration site to remove the subjects you created, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.418.1">Figure 12.2</span></em><span class="koboSpan" id="kobo.419.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.420.1"><img alt="" role="presentation" src="../Images/B21088_12_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.421.1">Figure 12.2: Deleting all existing subjects</span></p>
<p class="normal"><span class="koboSpan" id="kobo.422.1">After deleting all subjects, load </span><a id="_idIndexMarker1107"/><span class="koboSpan" id="kobo.423.1">the fixture into</span><a id="_idIndexMarker1108"/><span class="koboSpan" id="kobo.424.1"> the database using the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.425.1">python manage.py loaddata subjects.json
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.426.1">All </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">Subject</span></code><span class="koboSpan" id="kobo.428.1"> objects included in the fixture are loaded into the database again:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.429.1"><img alt="" role="presentation" src="../Images/B21088_12_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.430.1">Figure 12.3: Subjects from the fixture are now loaded into the database</span></p>
<p class="normal"><span class="koboSpan" id="kobo.431.1">By default, Django looks for files in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.432.1">fixtures/</span></code><span class="koboSpan" id="kobo.433.1"> directory of each application, but you can specify the complete path to the fixture file for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.434.1">loaddata</span></code><span class="koboSpan" id="kobo.435.1"> command. </span><span class="koboSpan" id="kobo.435.2">You can also use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.436.1">FIXTURE_DIRS</span></code><span class="koboSpan" id="kobo.437.1"> setting to tell Django about additional directories to look in for fixtures.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.438.1">Fixtures are not only useful for setting up initial data but also for providing sample data for your application or data required for your tests. </span><span class="koboSpan" id="kobo.438.2">You can also use fixtures to populate necessary data for production environments.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.439.1">You can read about how to use fixtures for testing at </span><a href="https://docs.djangoproject.com/en/5.0/topics/testing/tools/#fixture-loading"><span class="url"><span class="koboSpan" id="kobo.440.1">https://docs.djangoproject.com/en/5.0/topics/testing/tools/#fixture-loading</span></span></a><span class="koboSpan" id="kobo.441.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.442.1">If you want to load fixtures</span><a id="_idIndexMarker1109"/><span class="koboSpan" id="kobo.443.1"> in model migrations, look at Django’s documentation about data migrations. </span><span class="koboSpan" id="kobo.443.2">You can find the documentation for migrating data at </span><a href="https://docs.djangoproject.com/en/5.0/topics/migrations/#data-migrations"><span class="url"><span class="koboSpan" id="kobo.444.1">https://docs.djangoproject.com/en/5.0/topics/migrations/#data-migrations</span></span></a><span class="koboSpan" id="kobo.445.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.446.1">You have created the models to </span><a id="_idIndexMarker1110"/><span class="koboSpan" id="kobo.447.1">manage course subjects, courses, and course modules. </span><span class="koboSpan" id="kobo.447.2">Next, you will create models to manage different types of module content.</span></p>
<h1 class="heading-1" id="_idParaDest-339"><span class="koboSpan" id="kobo.448.1">Creating models for polymorphic content</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.449.1">You plan to add different types of content to the course modules, such as text, images, files, and videos. </span><strong class="keyWord"><span class="koboSpan" id="kobo.450.1">Polymorphism</span></strong><span class="koboSpan" id="kobo.451.1"> is the provision of a single interface to entities of different types. </span><span class="koboSpan" id="kobo.451.2">You need a versatile </span><a id="_idIndexMarker1111"/><span class="koboSpan" id="kobo.452.1">data model that allows you to store diverse content</span><a id="_idIndexMarker1112"/><span class="koboSpan" id="kobo.453.1"> that is accessible through a single interface. </span><span class="koboSpan" id="kobo.453.2">In </span><em class="italic"><span class="koboSpan" id="kobo.454.1">Chapter 7</span></em><span class="koboSpan" id="kobo.455.1">, </span><em class="italic"><span class="koboSpan" id="kobo.456.1">Tracking User Actions</span></em><span class="koboSpan" id="kobo.457.1">, you learned about the convenience of using generic relations to create foreign keys that can point to the objects of any model. </span><span class="koboSpan" id="kobo.457.2">You are going to create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.458.1">Content</span></code><span class="koboSpan" id="kobo.459.1"> model that represents the modules’ contents and define a generic relation to associate any object with the content object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.460.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">models.py</span></code><span class="koboSpan" id="kobo.462.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.463.1">courses</span></code><span class="koboSpan" id="kobo.464.1"> application and add the following imports:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.465.1">from</span></span><span class="koboSpan" id="kobo.466.1"> django.contrib.contenttypes.fields </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.467.1">import</span></span><span class="koboSpan" id="kobo.468.1"> GenericForeignKey
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.469.1">from</span></span><span class="koboSpan" id="kobo.470.1"> django.contrib.contenttypes.models </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.471.1">import</span></span><span class="koboSpan" id="kobo.472.1"> ContentType
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.473.1">Then, add the following code to the end of the file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.474.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.475.1">Content</span></span><span class="koboSpan" id="kobo.476.1">(models.Model):
    module = models.ForeignKey(
        Module,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.477.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.478.1">contents'</span></span><span class="koboSpan" id="kobo.479.1">,
        on_delete=models.CASCADE
    )
    content_type = models.ForeignKey(
        ContentType,
        on_delete=models.CASCADE
    )
    object_id = models.PositiveIntegerField()
    item = GenericForeignKey(</span><span class="hljs-string"><span class="koboSpan" id="kobo.480.1">'content_type'</span></span><span class="koboSpan" id="kobo.481.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.482.1">'object_id'</span></span><span class="koboSpan" id="kobo.483.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.484.1">This is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.485.1">Content</span></code><span class="koboSpan" id="kobo.486.1"> model. </span><span class="koboSpan" id="kobo.486.2">A module contains multiple contents, so you define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">ForeignKey</span></code><span class="koboSpan" id="kobo.488.1"> field that points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">Module</span></code><span class="koboSpan" id="kobo.490.1"> model. </span><span class="koboSpan" id="kobo.490.2">You can also set up a generic relation to associate objects from different </span><a id="_idIndexMarker1113"/><span class="koboSpan" id="kobo.491.1">models that represent different types of content. </span><span class="koboSpan" id="kobo.491.2">Remember that you need three different fields to set up a generic relation. </span><span class="koboSpan" id="kobo.491.3">In your </span><code class="inlineCode"><span class="koboSpan" id="kobo.492.1">Content</span></code><span class="koboSpan" id="kobo.493.1"> model, these are:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.494.1">content_type</span></code><span class="koboSpan" id="kobo.495.1">: A </span><code class="inlineCode"><span class="koboSpan" id="kobo.496.1">ForeignKey</span></code><span class="koboSpan" id="kobo.497.1"> field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">ContentType</span></code><span class="koboSpan" id="kobo.499.1"> model</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.500.1">object_id</span></code><span class="koboSpan" id="kobo.501.1">: A </span><code class="inlineCode"><span class="koboSpan" id="kobo.502.1">PositiveIntegerField</span></code><span class="koboSpan" id="kobo.503.1"> to store the primary key of the related object</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.504.1">item</span></code><span class="koboSpan" id="kobo.505.1">: A </span><code class="inlineCode"><span class="koboSpan" id="kobo.506.1">GenericForeignKey</span></code><span class="koboSpan" id="kobo.507.1"> field to the related object combining the two previous fields</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.508.1">Only the </span><code class="inlineCode"><span class="koboSpan" id="kobo.509.1">content_type</span></code><span class="koboSpan" id="kobo.510.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.511.1">object_id</span></code><span class="koboSpan" id="kobo.512.1"> fields have a corresponding column in the database table of this model. </span><span class="koboSpan" id="kobo.512.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.513.1">item</span></code><span class="koboSpan" id="kobo.514.1"> field allows you to retrieve or set the related object directly, and its functionality is built on top of the other two fields.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.515.1">You are going to use a distinct model for each type of content; text, image, video, and document. </span><span class="koboSpan" id="kobo.515.2">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.516.1">Content</span></code><span class="koboSpan" id="kobo.517.1"> models will share some common fields but they will vary in the specific data that they store. </span><span class="koboSpan" id="kobo.517.2">For example, for text content, you will store the actual text, but for video content, you will store the video URL. </span><span class="koboSpan" id="kobo.517.3">To accomplish this, you will need to employ model inheritance. </span><span class="koboSpan" id="kobo.517.4">We will dive into the options that Django offers for model inheritance before building our </span><code class="inlineCode"><span class="koboSpan" id="kobo.518.1">Content</span></code><span class="koboSpan" id="kobo.519.1"> models.</span></p>
<h2 class="heading-2" id="_idParaDest-340"><span class="koboSpan" id="kobo.520.1">Using model inheritance</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.521.1">Django supports model inheritance. </span><span class="koboSpan" id="kobo.521.2">It works in a similar way to standard class inheritance in Python. </span><span class="koboSpan" id="kobo.521.3">If you are</span><a id="_idIndexMarker1114"/><span class="koboSpan" id="kobo.522.1"> not familiar with class inheritance, it involves defining a new class that inherits methods and properties </span><a id="_idIndexMarker1115"/><span class="koboSpan" id="kobo.523.1">from an existing class. </span><span class="koboSpan" id="kobo.523.2">This facilitates code reusability and can simplify the creation of related classes. </span><span class="koboSpan" id="kobo.523.3">You can read more about class inheritance at </span><a href="https://docs.python.org/3/tutorial/classes.html#inheritance"><span class="url"><span class="koboSpan" id="kobo.524.1">https://docs.python.org/3/tutorial/classes.html#inheritance</span></span></a><span class="koboSpan" id="kobo.525.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.526.1">Django offers the following three options to use model inheritance:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.527.1">Abstract models</span></strong><span class="koboSpan" id="kobo.528.1">: Useful when you want to put some common information into several models</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.529.1">Multi-table model inheritance</span></strong><span class="koboSpan" id="kobo.530.1">: Applicable when each model in the hierarchy is considered a complete model by itself</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.531.1">Proxy models</span></strong><span class="koboSpan" id="kobo.532.1">: Useful when you need to change the behavior of a model, for example, by including additional methods, changing the default manager, or using different meta options</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.533.1">Let’s take a closer look at</span><a id="_idIndexMarker1116"/><span class="koboSpan" id="kobo.534.1"> each of them.</span></p>
<h3 class="heading-3" id="_idParaDest-341"><span class="koboSpan" id="kobo.535.1">Abstract models</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.536.1">An abstract model is a base class in</span><a id="_idIndexMarker1117"/><span class="koboSpan" id="kobo.537.1"> which you define the fields you want to include in all child models. </span><span class="koboSpan" id="kobo.537.2">Django doesn’t create any database tables for abstract models. </span><span class="koboSpan" id="kobo.537.3">A database table is created for each child model, including the fields inherited from the </span><a id="_idIndexMarker1118"/><span class="koboSpan" id="kobo.538.1">abstract class and the ones defined in the child model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.539.1">To mark a model as abstract, you need to include </span><code class="inlineCode"><span class="koboSpan" id="kobo.540.1">abstract=True</span></code><span class="koboSpan" id="kobo.541.1"> in its </span><code class="inlineCode"><span class="koboSpan" id="kobo.542.1">Meta</span></code><span class="koboSpan" id="kobo.543.1"> class. </span><span class="koboSpan" id="kobo.543.2">Django will recognize that it is an abstract model and will not create a database table for it. </span><span class="koboSpan" id="kobo.543.3">To create child models, you just need to subclass the abstract model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.544.1">The following example shows an abstract </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">BaseContent</span></code><span class="koboSpan" id="kobo.546.1"> model and a child </span><code class="inlineCode"><span class="koboSpan" id="kobo.547.1">Text</span></code><span class="koboSpan" id="kobo.548.1"> model:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.549.1">from</span></span><span class="koboSpan" id="kobo.550.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.551.1">import</span></span><span class="koboSpan" id="kobo.552.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.553.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.554.1">BaseContent</span></span><span class="koboSpan" id="kobo.555.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.556.1">100</span></span><span class="koboSpan" id="kobo.557.1">)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.558.1">True</span></span><span class="koboSpan" id="kobo.559.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.560.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.561.1">Meta</span></span><span class="koboSpan" id="kobo.562.1">:
        abstract = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.563.1">True</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.564.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.565.1">Text</span></span><span class="koboSpan" id="kobo.566.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.567.1">BaseContent</span></span><span class="koboSpan" id="kobo.568.1">):
    body = models.TextField()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.569.1">In this case, Django would create a table for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.570.1">Text</span></code><span class="koboSpan" id="kobo.571.1"> model only, including the </span><code class="inlineCode"><span class="koboSpan" id="kobo.572.1">title</span></code><span class="koboSpan" id="kobo.573.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.574.1">created</span></code><span class="koboSpan" id="kobo.575.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.576.1">body</span></code><span class="koboSpan" id="kobo.577.1"> fields.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.578.1">Figure 12.4</span></em><span class="koboSpan" id="kobo.579.1"> shows the models and associated database tables for the code example provided:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.580.1"><img alt="" role="presentation" src="../Images/B21088_12_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.581.1">Figure 12.4: Sample models and database tables for inheritance using abstract models</span></p>
<p class="normal"><span class="koboSpan" id="kobo.582.1">Next, we are going to learn </span><a id="_idIndexMarker1119"/><span class="koboSpan" id="kobo.583.1">about a different model inheritance approach, where </span><a id="_idIndexMarker1120"/><span class="koboSpan" id="kobo.584.1">multiple database tables are created.</span></p>
<h3 class="heading-3" id="_idParaDest-342"><span class="koboSpan" id="kobo.585.1">Multi-table model inheritance</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.586.1">In multi-table inheritance, each model </span><a id="_idIndexMarker1121"/><span class="koboSpan" id="kobo.587.1">corresponds to a database table. </span><span class="koboSpan" id="kobo.587.2">Django creates a </span><code class="inlineCode"><span class="koboSpan" id="kobo.588.1">OneToOneField</span></code><span class="koboSpan" id="kobo.589.1"> field for the relationship between the child model and its parent model. </span><span class="koboSpan" id="kobo.589.2">To use multi-table inheritance, you have to subclass an existing model. </span><span class="koboSpan" id="kobo.589.3">Django will create a database table for both the original model and the sub-model. </span><span class="koboSpan" id="kobo.589.4">The following example shows multi-table inheritance:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.590.1">from</span></span><span class="koboSpan" id="kobo.591.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.592.1">import</span></span><span class="koboSpan" id="kobo.593.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.594.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.595.1">BaseContent</span></span><span class="koboSpan" id="kobo.596.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.597.1">100</span></span><span class="koboSpan" id="kobo.598.1">)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.599.1">True</span></span><span class="koboSpan" id="kobo.600.1">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.601.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.602.1">Text</span></span><span class="koboSpan" id="kobo.603.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.604.1">BaseContent</span></span><span class="koboSpan" id="kobo.605.1">):
    body = models.TextField()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.606.1">Django will include an automatically generated </span><code class="inlineCode"><span class="koboSpan" id="kobo.607.1">OneToOneField</span></code><span class="koboSpan" id="kobo.608.1"> field in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.609.1">Text</span></code><span class="koboSpan" id="kobo.610.1"> model that points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.611.1">BaseContent</span></code><span class="koboSpan" id="kobo.612.1"> model. </span><span class="koboSpan" id="kobo.612.2">The name for this field is </span><code class="inlineCode"><span class="koboSpan" id="kobo.613.1">basecontent_ptr</span></code><span class="koboSpan" id="kobo.614.1">, where </span><code class="inlineCode"><span class="koboSpan" id="kobo.615.1">ptr</span></code><span class="koboSpan" id="kobo.616.1"> stands for </span><em class="italic"><span class="koboSpan" id="kobo.617.1">pointer</span></em><span class="koboSpan" id="kobo.618.1">. </span><span class="koboSpan" id="kobo.618.2">A database table is created for each model.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.619.1">Figure 12.5</span></em><span class="koboSpan" id="kobo.620.1"> shows the models and </span><a id="_idIndexMarker1122"/><span class="koboSpan" id="kobo.621.1">associated database tables for the multi-table model inheritance code example provided:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.622.1"><img alt="" role="presentation" src="../Images/B21088_12_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.623.1">Figure 12.5: Sample models and database tables for multi-table model inheritance</span></p>
<p class="normal"><span class="koboSpan" id="kobo.624.1">Next, we are going to learn about another model inheritance approach, where multiple models serve as a proxy to a single database table.</span></p>
<h3 class="heading-3" id="_idParaDest-343"><span class="koboSpan" id="kobo.625.1">Proxy models</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.626.1">A proxy model changes the behavior</span><a id="_idIndexMarker1123"/><span class="koboSpan" id="kobo.627.1"> of a model. </span><span class="koboSpan" id="kobo.627.2">Both models operate on the database table of</span><a id="_idIndexMarker1124"/><span class="koboSpan" id="kobo.628.1"> the original model. </span><span class="koboSpan" id="kobo.628.2">This allows you to customize behavior for different models without creating a new database table, creating different versions of the same model that are tailored for different purposes. </span><span class="koboSpan" id="kobo.628.3">To create a proxy model, add </span><code class="inlineCode"><span class="koboSpan" id="kobo.629.1">proxy=True</span></code><span class="koboSpan" id="kobo.630.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.631.1">Meta</span></code><span class="koboSpan" id="kobo.632.1"> class of the model. </span><span class="koboSpan" id="kobo.632.2">The following example illustrates how to create a proxy model:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.633.1">from</span></span><span class="koboSpan" id="kobo.634.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.635.1">import</span></span><span class="koboSpan" id="kobo.636.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.637.1">from</span></span><span class="koboSpan" id="kobo.638.1"> django.utils </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.639.1">import</span></span><span class="koboSpan" id="kobo.640.1"> timezone
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.641.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.642.1">BaseContent</span></span><span class="koboSpan" id="kobo.643.1">(models.Model):
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.644.1">100</span></span><span class="koboSpan" id="kobo.645.1">)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.646.1">True</span></span><span class="koboSpan" id="kobo.647.1">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.648.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.649.1">OrderedContent</span></span><span class="koboSpan" id="kobo.650.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.651.1">BaseContent</span></span><span class="koboSpan" id="kobo.652.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.653.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.654.1">Meta</span></span><span class="koboSpan" id="kobo.655.1">:
        proxy = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.656.1">True</span></span><span class="koboSpan" id="kobo.657.1">
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.658.1">'created'</span></span><span class="koboSpan" id="kobo.659.1">]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.660.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.661.1">created_delta</span></span><span class="koboSpan" id="kobo.662.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.663.1">self</span></span><span class="koboSpan" id="kobo.664.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.665.1">return</span></span><span class="koboSpan" id="kobo.666.1"> timezone.now() - self.created
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.667.1">Here, you define an </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">OrderedContent</span></code><span class="koboSpan" id="kobo.669.1"> model that is a proxy model for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.670.1">Content</span></code><span class="koboSpan" id="kobo.671.1"> model. </span><span class="koboSpan" id="kobo.671.2">This model provides a default ordering for QuerySets and an additional </span><code class="inlineCode"><span class="koboSpan" id="kobo.672.1">created_delta()</span></code><span class="koboSpan" id="kobo.673.1"> method. </span><span class="koboSpan" id="kobo.673.2">Both</span><a id="_idIndexMarker1125"/><span class="koboSpan" id="kobo.674.1"> models, </span><code class="inlineCode"><span class="koboSpan" id="kobo.675.1">Content</span></code><span class="koboSpan" id="kobo.676.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.677.1">OrderedContent</span></code><span class="koboSpan" id="kobo.678.1">, operate on the same database table, and objects are accessible via the ORM through either model.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.679.1">Figure 12.6</span></em><span class="koboSpan" id="kobo.680.1"> shows the models </span><a id="_idIndexMarker1126"/><span class="koboSpan" id="kobo.681.1">and associated database tables for the proxy model inheritance code example provided:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.682.1"><img alt="" role="presentation" src="../Images/B21088_12_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.683.1">Figure 12.6: Sample models and database tables for inheritance using proxy models</span></p>
<p class="normal"><span class="koboSpan" id="kobo.684.1">You have now become familiar with the three types of model inheritance. </span><span class="koboSpan" id="kobo.684.2">For additional information on model</span><a id="_idIndexMarker1127"/><span class="koboSpan" id="kobo.685.1"> inheritance, you can visit </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/models/#model-inheritance"><span class="url"><span class="koboSpan" id="kobo.686.1">https://docs.djangoproject.com/en/5.0/topics/db/models/#model-inheritance</span></span></a><span class="koboSpan" id="kobo.687.1">. </span><span class="koboSpan" id="kobo.687.2">Now, we will apply model inheritance in practice by using a base abstract model to develop models for </span><a id="_idIndexMarker1128"/><span class="koboSpan" id="kobo.688.1">various content types.</span></p>
<h2 class="heading-2" id="_idParaDest-344"><span class="koboSpan" id="kobo.689.1">Creating the Content models</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.690.1">Let’s use model inheritance to implement polymorphic models. </span><span class="koboSpan" id="kobo.690.2">You will create a versatile data model that</span><a id="_idIndexMarker1129"/><span class="koboSpan" id="kobo.691.1"> enables storing diverse content accessible through a unified interface. </span><span class="koboSpan" id="kobo.691.2">The ideal approach for this use case is to create </span><a id="_idIndexMarker1130"/><span class="koboSpan" id="kobo.692.1">an abstract base model that is then extended by models – each designed to store a particular type of data: text, image, video, and file. </span><span class="koboSpan" id="kobo.692.2">This flexible approach will equip you with the tools needed for scenarios where polymorphism is required.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.693.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.694.1">Content</span></code><span class="koboSpan" id="kobo.695.1"> model of your </span><code class="inlineCode"><span class="koboSpan" id="kobo.696.1">courses</span></code><span class="koboSpan" id="kobo.697.1"> application contains a generic relation to associate different types of content with it. </span><span class="koboSpan" id="kobo.697.2">You will create a different model for each type of content. </span><span class="koboSpan" id="kobo.697.3">All </span><code class="inlineCode"><span class="koboSpan" id="kobo.698.1">Content</span></code><span class="koboSpan" id="kobo.699.1"> models will have some fields in common and additional fields to store custom data. </span><span class="koboSpan" id="kobo.699.2">You are going to create an abstract model that provides the common fields for all </span><code class="inlineCode"><span class="koboSpan" id="kobo.700.1">Content</span></code><span class="koboSpan" id="kobo.701.1"> models.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.702.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.703.1">models.py</span></code><span class="koboSpan" id="kobo.704.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.705.1">courses</span></code><span class="koboSpan" id="kobo.706.1"> application and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.707.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.708.1">ItemBase</span></span><span class="koboSpan" id="kobo.709.1">(models.Model):
    owner = models.ForeignKey(User,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.710.1">'%(class)s_related'</span></span><span class="koboSpan" id="kobo.711.1">,
        on_delete=models.CASCADE
    )
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.712.1">250</span></span><span class="koboSpan" id="kobo.713.1">)
    created = models.DateTimeField(auto_now_add=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.714.1">True</span></span><span class="koboSpan" id="kobo.715.1">)
    updated = models.DateTimeField(auto_now=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.716.1">True</span></span><span class="koboSpan" id="kobo.717.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.718.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.719.1">Meta</span></span><span class="koboSpan" id="kobo.720.1">:
        abstract = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.721.1">True</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.722.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.723.1">__str__</span></span><span class="koboSpan" id="kobo.724.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.725.1">self</span></span><span class="koboSpan" id="kobo.726.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.727.1">return</span></span><span class="koboSpan" id="kobo.728.1"> self.title
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.729.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.730.1">Text</span></span><span class="koboSpan" id="kobo.731.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.732.1">ItemBase</span></span><span class="koboSpan" id="kobo.733.1">):
    content = models.TextField()
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.734.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.735.1">File</span></span><span class="koboSpan" id="kobo.736.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.737.1">ItemBase</span></span><span class="koboSpan" id="kobo.738.1">):
    file = models.FileField(upload_to=</span><span class="hljs-string"><span class="koboSpan" id="kobo.739.1">'files'</span></span><span class="koboSpan" id="kobo.740.1">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.742.1">Image</span></span><span class="koboSpan" id="kobo.743.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.744.1">ItemBase</span></span><span class="koboSpan" id="kobo.745.1">):
    file = models.FileField(upload_to=</span><span class="hljs-string"><span class="koboSpan" id="kobo.746.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.747.1">images'</span></span><span class="koboSpan" id="kobo.748.1">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.749.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.750.1">Video</span></span><span class="koboSpan" id="kobo.751.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.752.1">ItemBase</span></span><span class="koboSpan" id="kobo.753.1">):
    url = models.URLField()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.754.1">In this code, you define an abstract model named </span><code class="inlineCode"><span class="koboSpan" id="kobo.755.1">ItemBase</span></code><span class="koboSpan" id="kobo.756.1">. </span><span class="koboSpan" id="kobo.756.2">Therefore, you set </span><code class="inlineCode"><span class="koboSpan" id="kobo.757.1">abstract=True</span></code><span class="koboSpan" id="kobo.758.1"> in its </span><code class="inlineCode"><span class="koboSpan" id="kobo.759.1">Meta</span></code><span class="koboSpan" id="kobo.760.1"> class.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.761.1">In this model, you define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.762.1">owner</span></code><span class="koboSpan" id="kobo.763.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.764.1">title</span></code><span class="koboSpan" id="kobo.765.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.766.1">created</span></code><span class="koboSpan" id="kobo.767.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.768.1">updated</span></code><span class="koboSpan" id="kobo.769.1"> fields. </span><span class="koboSpan" id="kobo.769.2">These common fields will be used for all types of content.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.770.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.771.1">owner</span></code><span class="koboSpan" id="kobo.772.1"> field allows</span><a id="_idIndexMarker1131"/><span class="koboSpan" id="kobo.773.1"> you to store which user created the </span><a id="_idIndexMarker1132"/><span class="koboSpan" id="kobo.774.1">content. </span><span class="koboSpan" id="kobo.774.2">Since this field is defined in an abstract class, you need a different </span><code class="inlineCode"><span class="koboSpan" id="kobo.775.1">related_name</span></code><span class="koboSpan" id="kobo.776.1"> for each sub-model. </span><span class="koboSpan" id="kobo.776.2">Django allows you to specify a placeholder for the model class name in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.777.1">related_name</span></code><span class="koboSpan" id="kobo.778.1"> attribute as </span><code class="inlineCode"><span class="koboSpan" id="kobo.779.1">%(class)s</span></code><span class="koboSpan" id="kobo.780.1">. </span><span class="koboSpan" id="kobo.780.2">By doing so, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.781.1">related_name</span></code><span class="koboSpan" id="kobo.782.1"> for each child model will be generated automatically. </span><span class="koboSpan" id="kobo.782.2">Since you are using </span><code class="inlineCode"><span class="koboSpan" id="kobo.783.1">'%(class)s_related'</span></code><span class="koboSpan" id="kobo.784.1"> as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1">related_name</span></code><span class="koboSpan" id="kobo.786.1">, the reverse relationship for child models will be </span><code class="inlineCode"><span class="koboSpan" id="kobo.787.1">text_related</span></code><span class="koboSpan" id="kobo.788.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.789.1">file_related</span></code><span class="koboSpan" id="kobo.790.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.791.1">image_related</span></code><span class="koboSpan" id="kobo.792.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.793.1">video_related</span></code><span class="koboSpan" id="kobo.794.1">, respectively.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.795.1">You have defined four different </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">Content</span></code><span class="koboSpan" id="kobo.797.1"> models that inherit from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.798.1">ItemBase</span></code><span class="koboSpan" id="kobo.799.1"> abstract model. </span><span class="koboSpan" id="kobo.799.2">They are as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.800.1">Text</span></code><span class="koboSpan" id="kobo.801.1">: To store text content</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.802.1">File</span></code><span class="koboSpan" id="kobo.803.1">: To store files, such as PDFs</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.804.1">Image</span></code><span class="koboSpan" id="kobo.805.1">: To store image files</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.806.1">Video</span></code><span class="koboSpan" id="kobo.807.1">: To store videos; you use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.808.1">URLField</span></code><span class="koboSpan" id="kobo.809.1"> field to provide a video URL in order to embed it</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.810.1">Each child model contains the fields defined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">ItemBase</span></code><span class="koboSpan" id="kobo.812.1"> class in addition to its own fields. </span><span class="koboSpan" id="kobo.812.2">A database table will be </span><a id="_idIndexMarker1133"/><span class="koboSpan" id="kobo.813.1">created for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1">Text</span></code><span class="koboSpan" id="kobo.815.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1">File</span></code><span class="koboSpan" id="kobo.817.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.818.1">Image</span></code><span class="koboSpan" id="kobo.819.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.820.1">Video</span></code><span class="koboSpan" id="kobo.821.1"> models, respectively. </span><span class="koboSpan" id="kobo.821.2">There will be no database table associated with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.822.1">ItemBase</span></code><span class="koboSpan" id="kobo.823.1"> model since it is an abstract model.</span></p>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.824.1">Figure 12.7</span></em><span class="koboSpan" id="kobo.825.1"> shows the </span><code class="inlineCode"><span class="koboSpan" id="kobo.826.1">Content</span></code><span class="koboSpan" id="kobo.827.1"> models and the associated database tables:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.828.1"><img alt="" role="presentation" src="../Images/B21088_12_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.829.1">Figure 12.7: Content models and associated database tables</span></p>
<p class="normal"><span class="koboSpan" id="kobo.830.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.831.1">Content</span></code><span class="koboSpan" id="kobo.832.1"> model you created previously and modify its </span><code class="inlineCode"><span class="koboSpan" id="kobo.833.1">content_type</span></code><span class="koboSpan" id="kobo.834.1"> field, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.835.1">content_type = models.ForeignKey(
        ContentType,
        on_delete=models.CASCADE,
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.836.1">        limit_choices_to={</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.837.1">'model__in'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.838.1">:(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.839.1">'text'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.840.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.841.1">'video'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.842.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.843.1">'image'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.844.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.845.1">'file'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.846.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.847.1">        }</span></strong></span><span class="koboSpan" id="kobo.848.1">
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.849.1">You add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.850.1">limit_choices_to</span></code><span class="koboSpan" id="kobo.851.1"> argument to</span><a id="_idIndexMarker1134"/><span class="koboSpan" id="kobo.852.1"> limit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.853.1">ContentType</span></code><span class="koboSpan" id="kobo.854.1"> objects that can be used for the generic relation. </span><span class="koboSpan" id="kobo.854.2">You use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.855.1">model__in</span></code><span class="koboSpan" id="kobo.856.1"> field lookup to filter the query to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.857.1">ContentType</span></code><span class="koboSpan" id="kobo.858.1"> objects </span><a id="_idIndexMarker1135"/><span class="koboSpan" id="kobo.859.1">with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.860.1">model</span></code><span class="koboSpan" id="kobo.861.1"> attribute that is </span><code class="inlineCode"><span class="koboSpan" id="kobo.862.1">'text'</span></code><span class="koboSpan" id="kobo.863.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.864.1">'video'</span></code><span class="koboSpan" id="kobo.865.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.866.1">'image'</span></code><span class="koboSpan" id="kobo.867.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1">'file'</span></code><span class="koboSpan" id="kobo.869.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.870.1">Let’s create a migration to include the new models you have added. </span><span class="koboSpan" id="kobo.870.2">Run the following command from the command line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.871.1">python manage.py makemigrations
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.872.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.873.1">Migrations for 'courses':
  courses/migrations/0002_video_text_image_file_content.py
    - Create model Video
    - Create model Text
    - Create model Image
    - Create model File
    - Create model Content
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.874.1">Then, run the following command to apply the new migration:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.875.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.876.1">The output you see should end with the following line:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.877.1">Applying courses.0002_video_text_image_file_content... </span><span class="koboSpan" id="kobo.877.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.878.1">You have created models that are suitable for adding diverse content to the course modules. </span><span class="koboSpan" id="kobo.878.2">However, there is still something missing in your models: the course modules and contents should</span><a id="_idIndexMarker1136"/><span class="koboSpan" id="kobo.879.1"> follow a particular order. </span><span class="koboSpan" id="kobo.879.2">You need a field that allows you to order them easily.</span></p>
<h2 class="heading-2" id="_idParaDest-345"><span class="koboSpan" id="kobo.880.1">Creating custom model fields</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.881.1">Django comes with a complete collection of model fields that you can use to build your models. </span><span class="koboSpan" id="kobo.881.2">However, you can</span><a id="_idIndexMarker1137"/><span class="koboSpan" id="kobo.882.1"> also create your own model fields to store custom data or alter the behavior of existing fields. </span><span class="koboSpan" id="kobo.882.2">Custom fields allow </span><a id="_idIndexMarker1138"/><span class="koboSpan" id="kobo.883.1">you to store unique data types, implement custom validations, encapsulate complex data logic related to the field, or define specific rendering forms using custom widgets.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.884.1">You need a field that allows you to define an order for the objects. </span><span class="koboSpan" id="kobo.884.2">An easy way to specify an order for objects using existing Django fields is by adding a </span><code class="inlineCode"><span class="koboSpan" id="kobo.885.1">PositiveIntegerField</span></code><span class="koboSpan" id="kobo.886.1"> to your models. </span><span class="koboSpan" id="kobo.886.2">Using integers, you can easily specify the order of the objects. </span><span class="koboSpan" id="kobo.886.3">You can create a custom order field that inherits from </span><code class="inlineCode"><span class="koboSpan" id="kobo.887.1">PositiveIntegerField</span></code><span class="koboSpan" id="kobo.888.1"> and provides additional behavior.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.889.1">There are two relevant functionalities that you will build into your order field:</span></p>
<ul>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.890.1">Automatically assign an order value when no specific order is provided</span></strong><span class="koboSpan" id="kobo.891.1">: When saving a new object with no specific order, your field should automatically assign the number that comes after the last existing ordered object. </span><span class="koboSpan" id="kobo.891.2">If there are two objects with orders </span><code class="inlineCode"><span class="koboSpan" id="kobo.892.1">1</span></code><span class="koboSpan" id="kobo.893.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.894.1">2</span></code><span class="koboSpan" id="kobo.895.1"> respectively, when saving a third object, you should automatically assign order </span><code class="inlineCode"><span class="koboSpan" id="kobo.896.1">3</span></code><span class="koboSpan" id="kobo.897.1"> to it if no specific order has been provided.</span></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.898.1">Order objects with respect to other fields</span></strong><span class="koboSpan" id="kobo.899.1">: Course modules will be ordered with respect to the course they belong to and module contents with respect to the module they belong to.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.900.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">fields.py</span></code><span class="koboSpan" id="kobo.902.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">courses</span></code><span class="koboSpan" id="kobo.904.1"> application directory and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.905.1">from</span></span><span class="koboSpan" id="kobo.906.1"> django.core.exceptions </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">import</span></span><span class="koboSpan" id="kobo.908.1"> ObjectDoesNotExist
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.909.1">from</span></span><span class="koboSpan" id="kobo.910.1"> django.db </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.911.1">import</span></span><span class="koboSpan" id="kobo.912.1"> models
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.913.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.914.1">OrderField</span></span><span class="koboSpan" id="kobo.915.1">(models.PositiveIntegerField):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.916.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.917.1">__init__</span></span><span class="koboSpan" id="kobo.918.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.919.1">self, for_fields=</span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.920.1">None</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.921.1">, *args, **kwargs</span></span><span class="koboSpan" id="kobo.922.1">):
        self.for_fields = for_fields
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.923.1">super</span></span><span class="koboSpan" id="kobo.924.1">().__init__(*args, **kwargs)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.925.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.926.1">pre_save</span></span><span class="koboSpan" id="kobo.927.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.928.1">self, model_instance, add</span></span><span class="koboSpan" id="kobo.929.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.930.1">if</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.931.1">getattr</span></span><span class="koboSpan" id="kobo.932.1">(model_instance, self.attname) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.933.1">is</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.934.1">None</span></span><span class="koboSpan" id="kobo.935.1">:
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.936.1"># no current value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.937.1">try</span></span><span class="koboSpan" id="kobo.938.1">:
                qs = self.model.objects.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.939.1">all</span></span><span class="koboSpan" id="kobo.940.1">()
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.941.1">if</span></span><span class="koboSpan" id="kobo.942.1"> self.for_fields:
                    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.943.1"># filter by objects with the same field values</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.944.1"># for the fields in "for_fields"</span></span><span class="koboSpan" id="kobo.945.1">
                    query = {
                        field: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.946.1">getattr</span></span><span class="koboSpan" id="kobo.947.1">(model_instance, field)
                        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.948.1">for</span></span><span class="koboSpan" id="kobo.949.1"> field </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.950.1">in</span></span><span class="koboSpan" id="kobo.951.1"> self.for_fields
                    }
                    qs = qs.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.952.1">filter</span></span><span class="koboSpan" id="kobo.953.1">(**query)
                </span><span class="hljs-comment"><span class="koboSpan" id="kobo.954.1"># get the order of the last item</span></span><span class="koboSpan" id="kobo.955.1">
                last_item = qs.latest(self.attname)
                value = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.956.1">getattr</span></span><span class="koboSpan" id="kobo.957.1">(last_item, self.attname) + </span><span class="hljs-number"><span class="koboSpan" id="kobo.958.1">1</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.959.1">except</span></span><span class="koboSpan" id="kobo.960.1"> ObjectDoesNotExist:
                value = </span><span class="hljs-number"><span class="koboSpan" id="kobo.961.1">0</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.962.1">setattr</span></span><span class="koboSpan" id="kobo.963.1">(model_instance, self.attname, value)
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.964.1">return</span></span><span class="koboSpan" id="kobo.965.1"> value
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.966.1">else</span></span><span class="koboSpan" id="kobo.967.1">:
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.968.1">return</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.969.1">super</span></span><span class="koboSpan" id="kobo.970.1">().pre_save(model_instance, add)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.971.1">This is the custom </span><code class="inlineCode"><span class="koboSpan" id="kobo.972.1">OrderField</span></code><span class="koboSpan" id="kobo.973.1">. </span><span class="koboSpan" id="kobo.973.2">It inherits from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.974.1">PositiveIntegerField</span></code><span class="koboSpan" id="kobo.975.1"> field provided by Django. </span><span class="koboSpan" id="kobo.975.2">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.976.1">OrderField</span></code><span class="koboSpan" id="kobo.977.1"> field takes an optional </span><code class="inlineCode"><span class="koboSpan" id="kobo.978.1">for_fields</span></code><span class="koboSpan" id="kobo.979.1"> parameter, which allows you to indicate the</span><a id="_idIndexMarker1139"/><span class="koboSpan" id="kobo.980.1"> fields used to order the data.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.981.1">Your field overrides the </span><code class="inlineCode"><span class="koboSpan" id="kobo.982.1">pre_save()</span></code><span class="koboSpan" id="kobo.983.1"> method of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.984.1">PositiveIntegerField</span></code><span class="koboSpan" id="kobo.985.1"> field, which is executed before saving</span><a id="_idIndexMarker1140"/><span class="koboSpan" id="kobo.986.1"> the field to the database. </span><span class="koboSpan" id="kobo.986.2">In this method, you perform the following actions:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.987.1">You check whether a value already exists for this field in the model instance. </span><span class="koboSpan" id="kobo.987.2">You use </span><code class="inlineCode"><span class="koboSpan" id="kobo.988.1">self.attname</span></code><span class="koboSpan" id="kobo.989.1">, which is the attribute name given to the field in the model. </span><span class="koboSpan" id="kobo.989.2">If the attribute’s value is different from </span><code class="inlineCode"><span class="koboSpan" id="kobo.990.1">None</span></code><span class="koboSpan" id="kobo.991.1">, you calculate the order you should give it as follows:</span><ol class="alphabeticList" style="list-style-type: lower-alpha;">
<li class="alphabeticList" value="1"><span class="koboSpan" id="kobo.992.1">You build a QuerySet to retrieve all objects for the field’s model. </span><span class="koboSpan" id="kobo.992.2">You retrieve the model class the field belongs to by accessing </span><code class="inlineCode"><span class="koboSpan" id="kobo.993.1">self.model</span></code><span class="koboSpan" id="kobo.994.1">.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.995.1">If there are any field names in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.996.1">for_fields</span></code><span class="koboSpan" id="kobo.997.1"> attribute of the field, you filter the QuerySet by the current value of the model fields in </span><code class="inlineCode"><span class="koboSpan" id="kobo.998.1">for_fields</span></code><span class="koboSpan" id="kobo.999.1">. </span><span class="koboSpan" id="kobo.999.2">By doing so, you calculate the order with respect to the given fields.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1000.1">You retrieve the object with the highest order with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1001.1">last_item = qs.latest(self.attname)</span></code><span class="koboSpan" id="kobo.1002.1"> from the database. </span><span class="koboSpan" id="kobo.1002.2">If no object is found, you assume this object is the first one and assign order </span><code class="inlineCode"><span class="koboSpan" id="kobo.1003.1">0</span></code><span class="koboSpan" id="kobo.1004.1"> to it.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1005.1">If an object is found, you add </span><code class="inlineCode"><span class="koboSpan" id="kobo.1006.1">1</span></code><span class="koboSpan" id="kobo.1007.1"> to the highest order found.</span></li>
<li class="alphabeticList"><span class="koboSpan" id="kobo.1008.1">You assign the calculated order to the field’s value in the model instance using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1009.1">setattr()</span></code><span class="koboSpan" id="kobo.1010.1"> and return it.</span></li>
</ol>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1011.1">If the model instance </span><a id="_idIndexMarker1141"/><span class="koboSpan" id="kobo.1012.1">has a value for</span><a id="_idIndexMarker1142"/><span class="koboSpan" id="kobo.1013.1"> the current field, you use it instead of calculating it.</span></li>
</ol>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.1014.1">When you create custom model fields, make them generic. </span><span class="koboSpan" id="kobo.1014.2">Avoid hardcoding data that depends on a specific model or field. </span><span class="koboSpan" id="kobo.1014.3">Your field should work in any model.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1015.1">You can find more information about writing custom model fields at </span><a href="https://docs.djangoproject.com/en/5.0/howto/custom-model-fields/"><span class="url"><span class="koboSpan" id="kobo.1016.1">https://docs.djangoproject.com/en/5.0/howto/custom-model-fields/</span></span></a><span class="koboSpan" id="kobo.1017.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1018.1">Next, we are going to use the custom field we have created.</span></p>
<h2 class="heading-2" id="_idParaDest-346"><span class="koboSpan" id="kobo.1019.1">Adding ordering to Module and Content objects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1020.1">Let’s add the new field to your </span><a id="_idIndexMarker1143"/><span class="koboSpan" id="kobo.1021.1">models. </span><span class="koboSpan" id="kobo.1021.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1022.1">models.py</span></code><span class="koboSpan" id="kobo.1023.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1024.1">courses</span></code><span class="koboSpan" id="kobo.1025.1"> application, and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1026.1">OrderField</span></code><span class="koboSpan" id="kobo.1027.1"> class and a field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1028.1">Module</span></code><span class="koboSpan" id="kobo.1029.1"> model, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1030.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1031.1"> .fields </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1032.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1033.1"> OrderField</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1034.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1035.1">Module</span></span><span class="koboSpan" id="kobo.1036.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1037.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1038.1">    order = OrderField(blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1039.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1040.1">, for_fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1041.1">'course'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1042.1">])</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1043.1">You name the new field </span><code class="inlineCode"><span class="koboSpan" id="kobo.1044.1">order</span></code><span class="koboSpan" id="kobo.1045.1"> and specify that the ordering is calculated with respect to the course by setting </span><code class="inlineCode"><span class="koboSpan" id="kobo.1046.1">for_fields=['course']</span></code><span class="koboSpan" id="kobo.1047.1">. </span><span class="koboSpan" id="kobo.1047.2">This means that the order for a new module will be assigned by adding </span><code class="inlineCode"><span class="koboSpan" id="kobo.1048.1">1</span></code><span class="koboSpan" id="kobo.1049.1"> to the last module of the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.1050.1">Course</span></code><span class="koboSpan" id="kobo.1051.1"> object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1052.1">Now, you can edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1053.1">__str__()</span></code><span class="koboSpan" id="kobo.1054.1"> method of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1055.1">Module</span></code><span class="koboSpan" id="kobo.1056.1"> model to include its order, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1057.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1058.1">Module</span></span><span class="koboSpan" id="kobo.1059.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1060.1"># ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1061.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1062.1">__str__</span></span><span class="koboSpan" id="kobo.1063.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1064.1">self</span></span><span class="koboSpan" id="kobo.1065.1">):
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1066.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1067.1">f'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1068.1">{self.order}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1069.1">. </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1070.1">{self.title}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1071.1">'</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1072.1">Module contents also need to follow a particular order. </span><span class="koboSpan" id="kobo.1072.2">Add an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1073.1">OrderField</span></code><span class="koboSpan" id="kobo.1074.1"> field to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1075.1">Content</span></code><span class="koboSpan" id="kobo.1076.1"> model, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1077.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1078.1">Content</span></span><span class="koboSpan" id="kobo.1079.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1080.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1081.1">    order = OrderField(blank=</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1082.1">True</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1083.1">, for_fields=[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1084.1">'module'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1085.1">])</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1086.1">This time, you specify that the order is calculated with respect to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1087.1">module</span></code><span class="koboSpan" id="kobo.1088.1"> field.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1089.1">Finally, let’s add a default </span><a id="_idIndexMarker1144"/><span class="koboSpan" id="kobo.1090.1">ordering for both models. </span><span class="koboSpan" id="kobo.1090.2">Add the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1091.1">Meta</span></code><span class="koboSpan" id="kobo.1092.1"> class to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1093.1">Module</span></code><span class="koboSpan" id="kobo.1094.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1095.1">Content</span></code><span class="koboSpan" id="kobo.1096.1"> models:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1097.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1098.1">Module</span></span><span class="koboSpan" id="kobo.1099.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1100.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1101.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1102.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1103.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1104.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1105.1">'order'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1106.1">]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1107.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1108.1">Content</span></span><span class="koboSpan" id="kobo.1109.1">(models.Model):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1110.1"># ...</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1111.1">class</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1112.1">Meta</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1113.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1114.1">        ordering = [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1115.1">'order'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1116.1">]</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1117.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">Module</span></code><span class="koboSpan" id="kobo.1119.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1120.1">Content</span></code><span class="koboSpan" id="kobo.1121.1"> models should now look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1122.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1123.1">Module</span></span><span class="koboSpan" id="kobo.1124.1">(models.Model):
    course = models.ForeignKey(
        Course, related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1125.1">'modules'</span></span><span class="koboSpan" id="kobo.1126.1">, on_delete=models.CASCADE
    )
    title = models.CharField(max_length=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1127.1">200</span></span><span class="koboSpan" id="kobo.1128.1">)
    description = models.TextField(blank=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1129.1">True</span></span><span class="koboSpan" id="kobo.1130.1">)
    order = OrderField(blank=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1131.1">True</span></span><span class="koboSpan" id="kobo.1132.1">, for_fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1133.1">'course'</span></span><span class="koboSpan" id="kobo.1134.1">])
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1135.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1136.1">Meta</span></span><span class="koboSpan" id="kobo.1137.1">:
        ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1138.1">'order'</span></span><span class="koboSpan" id="kobo.1139.1">]
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1140.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1141.1">__str__</span></span><span class="koboSpan" id="kobo.1142.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1143.1">self</span></span><span class="koboSpan" id="kobo.1144.1">):
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1145.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1146.1">f'</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1147.1">{self.order}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1148.1">. </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1149.1">{self.title}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1150.1">'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1151.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1152.1">Content</span></span><span class="koboSpan" id="kobo.1153.1">(models.Model):
    module = models.ForeignKey(
        Module,
        related_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1154.1">'contents'</span></span><span class="koboSpan" id="kobo.1155.1">,
        on_delete=models.CASCADE
    )
    content_type = models.ForeignKey(
        ContentType,
        on_delete=models.CASCADE,
        limit_choices_to={
            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1156.1">'model__in'</span></span><span class="koboSpan" id="kobo.1157.1">:(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1158.1">'text'</span></span><span class="koboSpan" id="kobo.1159.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1160.1">'video'</span></span><span class="koboSpan" id="kobo.1161.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1162.1">'image'</span></span><span class="koboSpan" id="kobo.1163.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1164.1">'file'</span></span><span class="koboSpan" id="kobo.1165.1">)
        }
    )
    object_id = models.PositiveIntegerField()
    item = GenericForeignKey(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1166.1">'content_type'</span></span><span class="koboSpan" id="kobo.1167.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1168.1">'object_id'</span></span><span class="koboSpan" id="kobo.1169.1">)
    order = OrderField(blank=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1170.1">True</span></span><span class="koboSpan" id="kobo.1171.1">, for_fields=[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1172.1">'module'</span></span><span class="koboSpan" id="kobo.1173.1">])
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1174.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1175.1">Meta</span></span><span class="koboSpan" id="kobo.1176.1">:
            ordering = [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1177.1">'order'</span></span><span class="koboSpan" id="kobo.1178.1">]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1179.1">Let’s create a new </span><a id="_idIndexMarker1145"/><span class="koboSpan" id="kobo.1180.1">model migration that reflects the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1181.1">order</span></code><span class="koboSpan" id="kobo.1182.1"> fields. </span><span class="koboSpan" id="kobo.1182.2">Open the shell and run the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1183.1">python manage.py makemigrations courses
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1184.1">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1185.1">It is impossible to add a non-nullable field 'order' to content without specifying a default. </span><span class="koboSpan" id="kobo.1185.2">This is because the database needs something to populate existing rows.
</span><span class="koboSpan" id="kobo.1185.3">Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
 2) Quit and manually define a default value in models.py.
</span><span class="koboSpan" id="kobo.1185.4">Select an option:
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1186.1">Django is telling you that you have to provide a default value for the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1187.1">order</span></code><span class="koboSpan" id="kobo.1188.1"> field for existing rows in the database. </span><span class="koboSpan" id="kobo.1188.2">If the field includes </span><code class="inlineCode"><span class="koboSpan" id="kobo.1189.1">null=True</span></code><span class="koboSpan" id="kobo.1190.1">, it accepts null values and Django creates the migration automatically instead of asking for a default value. </span><span class="koboSpan" id="kobo.1190.2">You can specify a default value or cancel the migration and add a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1191.1">default</span></code><span class="koboSpan" id="kobo.1192.1"> attribute to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1193.1">order</span></code><span class="koboSpan" id="kobo.1194.1"> field in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1195.1">models.py</span></code><span class="koboSpan" id="kobo.1196.1"> file </span><a id="_idIndexMarker1146"/><span class="koboSpan" id="kobo.1197.1">before creating the migration.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1198.1">Enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1199.1">1</span></code><span class="koboSpan" id="kobo.1200.1"> and press </span><em class="italic"><span class="koboSpan" id="kobo.1201.1">Enter</span></em><span class="koboSpan" id="kobo.1202.1"> to provide a default value for existing records. </span><span class="koboSpan" id="kobo.1202.2">You will see the following output:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1203.1">Please enter the default value as valid Python.
</span><span class="koboSpan" id="kobo.1203.2">The datetime and django.utils.timezone modules are available, so it is possible to provide e.g. </span><span class="koboSpan" id="kobo.1203.3">timezone.now as a value.
</span><span class="koboSpan" id="kobo.1203.4">Type 'exit' to exit this prompt
</span><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1204.1">&gt;&gt;&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1205.1">Enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1206.1">0</span></code><span class="koboSpan" id="kobo.1207.1"> so that this is the default value for existing records and press </span><em class="italic"><span class="koboSpan" id="kobo.1208.1">Enter</span></em><span class="koboSpan" id="kobo.1209.1">. </span><span class="koboSpan" id="kobo.1209.2">Django will ask you for a default value for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1210.1">Module</span></code><span class="koboSpan" id="kobo.1211.1"> model, too. </span><span class="koboSpan" id="kobo.1211.2">Choose the first option and enter </span><code class="inlineCode"><span class="koboSpan" id="kobo.1212.1">0</span></code><span class="koboSpan" id="kobo.1213.1"> as the default value again. </span><span class="koboSpan" id="kobo.1213.2">Finally, you will see an output similar to the following one:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1214.1">Migrations for 'courses':
courses/migrations/0003_alter_content_options_alter_module_options_and_more.py
    - Change Meta options on content
    - Change Meta options on module
    - Add field order to content
    - Add field order to module
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1215.1">Then, apply the new migrations with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1216.1">python manage.py migrate
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1217.1">The output of the command will inform you that the migration was successfully applied, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1218.1">Applying courses.0003_alter_content_options_alter_module_options_and_more... </span><span class="koboSpan" id="kobo.1218.2">OK
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1219.1">Let’s test your new field. </span><span class="koboSpan" id="kobo.1219.2">Open the shell with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1220.1">python manage.py shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1221.1">Create a new course, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1222.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1223.1">from</span></span><span class="language-python"><span class="koboSpan" id="kobo.1224.1"> django.contrib.auth.models </span></span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1225.1">import</span></span><span class="language-python"><span class="koboSpan" id="kobo.1226.1"> User</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1227.1">&gt;&gt;&gt;</span></span> <span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1228.1">from</span></span><span class="language-python"><span class="koboSpan" id="kobo.1229.1"> courses.models </span></span><span class="hljs-con-keyword"><span class="koboSpan" id="kobo.1230.1">import</span></span><span class="language-python"><span class="koboSpan" id="kobo.1231.1"> Subject, Course, Module</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1232.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1233.1">user = User.objects.last()</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1234.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1235.1">subject = Subject.objects.last()</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1236.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1237.1">c1 = Course.objects.create(subject=subject, owner=user, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1238.1">'Course 1'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1239.1">, slug=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1240.1">'course1'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1241.1">)</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1242.1">You have created a course in the database. </span><span class="koboSpan" id="kobo.1242.2">Now, you will add modules to the course and see how their order is automatically calculated. </span><span class="koboSpan" id="kobo.1242.3">You create an initial module and check its order:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1243.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1244.1">m1 = Module.objects.create(course=c1, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1245.1">'Module 1'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1246.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1247.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1248.1">m1.order</span></span><span class="koboSpan" id="kobo.1249.1">
0
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1250.1">OrderField</span></code><span class="koboSpan" id="kobo.1251.1"> sets its value to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1252.1">0</span></code><span class="koboSpan" id="kobo.1253.1"> since</span><a id="_idIndexMarker1147"/><span class="koboSpan" id="kobo.1254.1"> this is the first </span><code class="inlineCode"><span class="koboSpan" id="kobo.1255.1">Module</span></code><span class="koboSpan" id="kobo.1256.1"> object created for the given course. </span><span class="koboSpan" id="kobo.1256.2">You can create a second module for the same course:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1257.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1258.1">m2 = Module.objects.create(course=c1, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1259.1">'</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1260.1">Module 2'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1261.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1262.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1263.1">m2.order</span></span><span class="koboSpan" id="kobo.1264.1">
1
</span></code></pre>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.1265.1">OrderField</span></code><span class="koboSpan" id="kobo.1266.1"> calculates the next order value, adding </span><code class="inlineCode"><span class="koboSpan" id="kobo.1267.1">1</span></code><span class="koboSpan" id="kobo.1268.1"> to the highest order for existing objects. </span><span class="koboSpan" id="kobo.1268.2">Let’s create a third module, forcing a specific order:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1269.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1270.1">m3 = Module.objects.create(course=c1, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1271.1">'Module 3'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1272.1">, order=</span></span><span class="hljs-con-number"><span class="koboSpan" id="kobo.1273.1">5</span></span><span class="language-python"><span class="koboSpan" id="kobo.1274.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1275.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1276.1">m3.order</span></span><span class="koboSpan" id="kobo.1277.1">
5
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1278.1">If you provide a custom order when creating or saving an object, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1279.1">OrderField</span></code><span class="koboSpan" id="kobo.1280.1"> will use that value instead of calculating the order.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1281.1">Let’s add a fourth module:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1282.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1283.1">m4 = Module.objects.create(course=c1, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1284.1">'Module 4'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1285.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1286.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1287.1">m4.order</span></span><span class="koboSpan" id="kobo.1288.1">
6
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1289.1">The order for this module has been automatically set. </span><span class="koboSpan" id="kobo.1289.2">Your </span><code class="inlineCode"><span class="koboSpan" id="kobo.1290.1">OrderField</span></code><span class="koboSpan" id="kobo.1291.1"> field does not guarantee that all order values are consecutive. </span><span class="koboSpan" id="kobo.1291.2">However, it respects existing order values and always assigns the next order based on the highest existing order.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1292.1">Let’s create a second</span><a id="_idIndexMarker1148"/><span class="koboSpan" id="kobo.1293.1"> course and add a module to it:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"><span class="koboSpan" id="kobo.1294.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1295.1">c2 = Course.objects.create(subject=subject, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1296.1">'Course 2'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1297.1">, slug=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1298.1">'course2'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1299.1">, owner=user)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1300.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1301.1">m5 = Module.objects.create(course=c2, title=</span></span><span class="hljs-con-string"><span class="koboSpan" id="kobo.1302.1">'Module 1'</span></span><span class="language-python"><span class="koboSpan" id="kobo.1303.1">)</span></span>
<span class="hljs-con-meta"><span class="koboSpan" id="kobo.1304.1">&gt;&gt;&gt;</span></span> <span class="language-python"><span class="koboSpan" id="kobo.1305.1">m5.order</span></span><span class="koboSpan" id="kobo.1306.1">
0
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1307.1">To calculate the new module’s order, the field only takes into consideration existing modules that belong to the same course. </span><span class="koboSpan" id="kobo.1307.2">Since this is the first module of the second course, the resulting order is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1308.1">0</span></code><span class="koboSpan" id="kobo.1309.1">. </span><span class="koboSpan" id="kobo.1309.2">This is because you specified </span><code class="inlineCode"><span class="koboSpan" id="kobo.1310.1">for_fields=['course']</span></code><span class="koboSpan" id="kobo.1311.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1312.1">order</span></code><span class="koboSpan" id="kobo.1313.1"> field of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1314.1">Module</span></code><span class="koboSpan" id="kobo.1315.1"> model.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1316.1">Congratulations! </span><span class="koboSpan" id="kobo.1316.2">You have successfully created your first custom model field. </span><span class="koboSpan" id="kobo.1316.3">Next, you are going to create an authentication system for the CMS.</span></p>
<h1 class="heading-1" id="_idParaDest-347"><span class="koboSpan" id="kobo.1317.1">Adding authentication views</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1318.1">Now that you have </span><a id="_idIndexMarker1149"/><span class="koboSpan" id="kobo.1319.1">created a polymorphic data model, you are going to build a CMS to manage the courses and their contents. </span><span class="koboSpan" id="kobo.1319.2">The first step is to add an authentication system for the CMS.</span></p>
<h2 class="heading-2" id="_idParaDest-348"><span class="koboSpan" id="kobo.1320.1">Adding an authentication system</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1321.1">You are going to use Django’s authentication </span><a id="_idIndexMarker1150"/><span class="koboSpan" id="kobo.1322.1">framework for users to authenticate to the e-learning platform. </span><span class="koboSpan" id="kobo.1322.2">You learned how to use the Django authentication views in </span><em class="italic"><span class="koboSpan" id="kobo.1323.1">Chapter 4, Building a Social Website</span></em><span class="koboSpan" id="kobo.1324.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1325.1">Both instructors and students will</span><a id="_idIndexMarker1151"/><span class="koboSpan" id="kobo.1326.1"> be instances of Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1327.1">User</span></code><span class="koboSpan" id="kobo.1328.1"> model, so they will be able to log in to the site using the authentication views of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1329.1">django.contrib.auth</span></code><span class="koboSpan" id="kobo.1330.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1331.1">Edit the main </span><code class="inlineCode"><span class="koboSpan" id="kobo.1332.1">urls.py</span></code><span class="koboSpan" id="kobo.1333.1"> file of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1334.1">educa</span></code><span class="koboSpan" id="kobo.1335.1"> project and include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1336.1">login</span></code><span class="koboSpan" id="kobo.1337.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1338.1">logout</span></code><span class="koboSpan" id="kobo.1339.1"> views of Django’s authentication framework:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1340.1">from</span></span><span class="koboSpan" id="kobo.1341.1"> django.conf </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1342.1">import</span></span><span class="koboSpan" id="kobo.1343.1"> settings
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1344.1">from</span></span><span class="koboSpan" id="kobo.1345.1"> django.conf.urls.static </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1346.1">import</span></span><span class="koboSpan" id="kobo.1347.1"> static
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1348.1">from</span></span><span class="koboSpan" id="kobo.1349.1"> django.contrib </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1350.1">import</span></span><span class="koboSpan" id="kobo.1351.1"> admin
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1352.1">from</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1353.1"> django.contrib.auth </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1354.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1355.1"> views </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1356.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1357.1"> auth_views</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1358.1">from</span></span><span class="koboSpan" id="kobo.1359.1"> django.urls </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1360.1">import</span></span><span class="koboSpan" id="kobo.1361.1"> path
urlpatterns = [
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1362.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1363.1">'accounts/login/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1364.1">, auth_views.LoginView.as_view(), name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1365.1">'login'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1366.1">    ),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1367.1">    path(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1368.1">'accounts/logout/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1369.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1370.1">        auth_views.LogoutView.as_view(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1371.1">        name=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1372.1">'logout'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1373.1">    ),</span></strong></span><span class="koboSpan" id="kobo.1374.1">
    path(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1375.1">'admin/'</span></span><span class="koboSpan" id="kobo.1376.1">, admin.site.urls),
]
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1377.1">if</span></span><span class="koboSpan" id="kobo.1378.1"> settings.DEBUG:
    urlpatterns += static(
        settings.MEDIA_URL, document_root=settings.MEDIA_ROOT
    )
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1379.1">Next, we are going to create</span><a id="_idIndexMarker1152"/><span class="koboSpan" id="kobo.1380.1"> the authentication templates for </span><a id="_idIndexMarker1153"/><span class="koboSpan" id="kobo.1381.1">the Django authentication views.</span></p>
<h2 class="heading-2" id="_idParaDest-349"><span class="koboSpan" id="kobo.1382.1">Creating the authentication templates</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1383.1">Create the following file </span><a id="_idIndexMarker1154"/><span class="koboSpan" id="kobo.1384.1">structure inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1385.1">courses</span></code><span class="koboSpan" id="kobo.1386.1"> application </span><a id="_idIndexMarker1155"/><span class="koboSpan" id="kobo.1387.1">directory:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1388.1">templates/
    base.html
    registration/
        login.html
        logged_out.html
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1389.1">Before building the authentication templates, you need to prepare the base template for your project. </span><span class="koboSpan" id="kobo.1389.2">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1390.1">base.html</span></code><span class="koboSpan" id="kobo.1391.1"> template file and add the following content to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1392.1">{% load static %}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1393.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1394.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.1395.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1396.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1397.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1398.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1399.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1400.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1401.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1402.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1403.1">meta</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1404.1">charset</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1405.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1406.1">"utf-8"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1407.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1408.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1409.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1410.1">&gt;</span></span><span class="koboSpan" id="kobo.1411.1">{% block title %}Educa{% endblock %}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1412.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1413.1">title</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1414.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1415.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1416.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1417.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1418.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1419.1">"{% static "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1420.1">css</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1421.1">/</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1422.1">base.css</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1423.1">" %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1424.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1425.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1426.1">"stylesheet"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1427.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1428.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1429.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1430.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1431.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1432.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1433.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1434.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1435.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1436.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1437.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1438.1">"header"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1439.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1440.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1441.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1442.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1443.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1444.1">"/"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1445.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1446.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1447.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1448.1">logo"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1449.1">&gt;</span></span><span class="koboSpan" id="kobo.1450.1">Educa</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1451.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1452.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1453.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1454.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1455.1">ul</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1456.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1457.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1458.1">"menu"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1459.1">&gt;</span></span><span class="koboSpan" id="kobo.1460.1">
        {% if request.user.is_authenticated %}
          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1461.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1462.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1463.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1464.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1465.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1466.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1467.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1468.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1469.1">logout</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1470.1">" %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1471.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1472.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1473.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1474.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1475.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1476.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1477.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1478.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1479.1">"submit"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1480.1">&gt;</span></span><span class="koboSpan" id="kobo.1481.1">Sign out</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1482.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1483.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1484.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1485.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1486.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1487.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1488.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1489.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1490.1">&gt;</span></span><span class="koboSpan" id="kobo.1491.1">
        {% else %}
          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1492.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1493.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1494.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1495.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1496.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1497.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1498.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1499.1">login</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1500.1">" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1501.1">&gt;</span></span><span class="koboSpan" id="kobo.1502.1">Sign in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1503.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1504.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1505.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1506.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1507.1">&gt;</span></span><span class="koboSpan" id="kobo.1508.1">
        {% endif %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1509.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1510.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1511.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1512.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1513.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1514.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1515.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1516.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1517.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1518.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1519.1">"content"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1520.1">&gt;</span></span><span class="koboSpan" id="kobo.1521.1">
      {% block content %}
      {% endblock %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1522.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1523.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1524.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1525.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1526.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1527.1">&gt;</span></span>
<span class="language-javascript"> </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1528.1">document</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.1529.1">.</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1530.1">addEventListener</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.1531.1">(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1532.1">'DOMContentLoaded'</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.1533.1">, </span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1534.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1535.1">event</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1536.1">) =&gt;</span></span><span class="language-javascript"><span class="koboSpan" id="kobo.1537.1"> {</span></span>
<span class="language-javascript"> </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1538.1">// DOM loaded</span></span>
<span class="language-javascript"><span class="koboSpan" id="kobo.1539.1">        {% block domready %}</span></span>
<span class="language-javascript"><span class="koboSpan" id="kobo.1540.1">        {% endblock %}</span></span>
<span class="language-javascript"><span class="koboSpan" id="kobo.1541.1">      })</span></span>
<span class="language-javascript"> </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1542.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1543.1">script</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1544.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1545.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1546.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1547.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1548.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1549.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1550.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1551.1">This is the base template</span><a id="_idIndexMarker1156"/><span class="koboSpan" id="kobo.1552.1"> that will be extended by the rest of the templates. </span><span class="koboSpan" id="kobo.1552.2">In this template, you define the following </span><a id="_idIndexMarker1157"/><span class="koboSpan" id="kobo.1553.1">blocks:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1554.1">title</span></code><span class="koboSpan" id="kobo.1555.1">: The block for other templates to add a custom title for each page.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1556.1">content</span></code><span class="koboSpan" id="kobo.1557.1">: The main block for content. </span><span class="koboSpan" id="kobo.1557.2">All templates that extend the base template should add content to this block.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1558.1">domready</span></code><span class="koboSpan" id="kobo.1559.1">: Located inside the JavaScript event listener for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1560.1">DOMContentLoaded</span></code><span class="koboSpan" id="kobo.1561.1"> event. </span><span class="koboSpan" id="kobo.1561.2">This allows you to execute code when the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1562.1">Document Object Model</span></strong><span class="koboSpan" id="kobo.1563.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1564.1">DOM</span></strong><span class="koboSpan" id="kobo.1565.1">) has finished</span><a id="_idIndexMarker1158"/><span class="koboSpan" id="kobo.1566.1"> loading.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1567.1">The CSS styles used in this template are located in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1568.1">static/</span></code><span class="koboSpan" id="kobo.1569.1"> directory of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1570.1">courses</span></code><span class="koboSpan" id="kobo.1571.1"> application in the code that comes</span><a id="_idIndexMarker1159"/><span class="koboSpan" id="kobo.1572.1"> with this chapter. </span><span class="koboSpan" id="kobo.1572.2">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1573.1">static/</span></code><span class="koboSpan" id="kobo.1574.1"> directory into the same directory of your project to use them. </span><span class="koboSpan" id="kobo.1574.2">You can find the contents of the directory at </span><a href="https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter12/educa/courses/static"><span class="url"><span class="koboSpan" id="kobo.1575.1">https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter12/educa/courses/static</span></span></a><span class="koboSpan" id="kobo.1576.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1577.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1578.1">registration/login.html</span></code><span class="koboSpan" id="kobo.1579.1"> template </span><a id="_idIndexMarker1160"/><span class="koboSpan" id="kobo.1580.1">and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1581.1">{% extends "base.html" %}
{% block title %}Log-in{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1582.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1583.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1584.1">&gt;</span></span><span class="koboSpan" id="kobo.1585.1">Log-in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1586.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1587.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1588.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1589.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1590.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1591.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1592.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1593.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1594.1">&gt;</span></span><span class="koboSpan" id="kobo.1595.1">
    {% if form.errors %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1596.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1597.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1598.1">&gt;</span></span><span class="koboSpan" id="kobo.1599.1">Your username and password didn't match. </span><span class="koboSpan" id="kobo.1599.2">Please try again.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1600.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1601.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1602.1">&gt;</span></span><span class="koboSpan" id="kobo.1603.1">
    {% else %}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1604.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1605.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1606.1">&gt;</span></span><span class="koboSpan" id="kobo.1607.1">Please, use the following form to log-in:</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1608.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1609.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1610.1">&gt;</span></span><span class="koboSpan" id="kobo.1611.1">
    {% endif %}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1612.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1613.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1614.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1615.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1616.1">"login-form"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1617.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1618.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1619.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1620.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1621.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1622.1">"{% url 'login' %}"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1623.1">method</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1624.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1625.1">"post"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1626.1">&gt;</span></span><span class="koboSpan" id="kobo.1627.1">
        {{ form.as_p }}
        {% csrf_token %}
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1628.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1629.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1630.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1631.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1632.1">"hidden"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1633.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1634.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1635.1">"next"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1636.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1637.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1638.1">"{{ next }}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1639.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1640.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1641.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1642.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1643.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1644.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1645.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1646.1">"submit"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1647.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1648.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1649.1">"Log-in"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1650.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1651.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1652.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1653.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1654.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1655.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1656.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1657.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1658.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1659.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1660.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1661.1">&gt;</span></span><span class="koboSpan" id="kobo.1662.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1663.1">This is a standard login template for Django’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1664.1">login</span></code><span class="koboSpan" id="kobo.1665.1"> view.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1666.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1667.1">registration/logged_out.html</span></code><span class="koboSpan" id="kobo.1668.1"> template and add the following code to it:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1669.1">{% extends "base.html" %}
{% block title %}Logged out{% endblock %}
{% block content %}
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1670.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1671.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1672.1">&gt;</span></span><span class="koboSpan" id="kobo.1673.1">Logged out</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1674.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1675.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1676.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1677.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1678.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1679.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1680.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1681.1">"module"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1682.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1683.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1684.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1685.1">&gt;</span></span><span class="koboSpan" id="kobo.1686.1">
      You have been successfully logged out.
      </span><span class="koboSpan" id="kobo.1686.2">You can </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1687.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1688.1">a</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1689.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1690.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1691.1">"{% url "</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1692.1">login</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1693.1">" %}"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1694.1">&gt;</span></span><span class="koboSpan" id="kobo.1695.1">log-in again</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1696.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1697.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1698.1">&gt;</span></span><span class="koboSpan" id="kobo.1699.1">.
     </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1700.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1701.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1702.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1703.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1704.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1705.1">&gt;</span></span><span class="koboSpan" id="kobo.1706.1">
{% endblock %}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1707.1">This is the template that</span><a id="_idIndexMarker1161"/><span class="koboSpan" id="kobo.1708.1"> will be displayed to the user after logging out. </span><span class="koboSpan" id="kobo.1708.2">Run the development server with the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1709.1">python manage.py runserver
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1710.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1711.1">http://127.0.0.1:8000/accounts/login/</span></code><span class="koboSpan" id="kobo.1712.1"> in your browser. </span><span class="koboSpan" id="kobo.1712.2">You should see the login page:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1713.1"><img alt="Graphical user interface, application  Description automatically generated" src="../Images/B21088_12_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1714.1">Figure 12.8: The account login page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1715.1">Log in with the superuser credentials. </span><span class="koboSpan" id="kobo.1715.2">You will be redirected to the URL </span><code class="inlineCode"><span class="koboSpan" id="kobo.1716.1">http://127.0.0.1:8000/accounts/profile/</span></code><span class="koboSpan" id="kobo.1717.1">, which is the default redirect URL for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1718.1">auth</span></code><span class="koboSpan" id="kobo.1719.1"> module. </span><span class="koboSpan" id="kobo.1719.2">You will get an HTTP </span><code class="inlineCode"><span class="koboSpan" id="kobo.1720.1">404</span></code><span class="koboSpan" id="kobo.1721.1"> response because the given URL doesn’t exist yet. </span><span class="koboSpan" id="kobo.1721.2">The URL to redirect users after a successful login is defined in the setting </span><code class="inlineCode"><span class="koboSpan" id="kobo.1722.1">LOGIN_REDIRECT_URL</span></code><span class="koboSpan" id="kobo.1723.1">. </span><span class="koboSpan" id="kobo.1723.2">You will define a custom redirect URL in </span><em class="italic"><span class="koboSpan" id="kobo.1724.1">Chapter 14, Rendering and Caching Content</span></em><span class="koboSpan" id="kobo.1725.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1726.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1727.1">http://127.0.0.1:8000/accounts/login/</span></code><span class="koboSpan" id="kobo.1728.1"> again in your browser. </span><span class="koboSpan" id="kobo.1728.2">Now, you should see the </span><strong class="screenText"><span class="koboSpan" id="kobo.1729.1">Sign out</span></strong><span class="koboSpan" id="kobo.1730.1"> button</span><a id="_idIndexMarker1162"/><span class="koboSpan" id="kobo.1731.1"> in the header of the page. </span><span class="koboSpan" id="kobo.1731.2">Click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1732.1">Sign out</span></strong><span class="koboSpan" id="kobo.1733.1"> button. </span><span class="koboSpan" id="kobo.1733.2">You should see the </span><strong class="screenText"><span class="koboSpan" id="kobo.1734.1">Logged out</span></strong><span class="koboSpan" id="kobo.1735.1"> page now, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1736.1">Figure 12.9</span></em><span class="koboSpan" id="kobo.1737.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1738.1"><img alt="Text  Description automatically generated" src="../Images/B21088_12_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1739.1">Figure 12.9: The account Logged out page</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1740.1">You have successfully </span><a id="_idIndexMarker1163"/><span class="koboSpan" id="kobo.1741.1">created an authentication system for the CMS.</span></p>
<h1 class="heading-1" id="_idParaDest-350"><span class="koboSpan" id="kobo.1742.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1743.1">In this chapter, you learned how to use fixtures to provide initial data for models. </span><span class="koboSpan" id="kobo.1743.2">By using model inheritance, you created a flexible system to manage different types of content for the course modules. </span><span class="koboSpan" id="kobo.1743.3">You also implemented a custom model field on order objects and created an authentication system for the e-learning platform.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1744.1">In the next chapter, you will implement the CMS functionality to manage course contents using class-based views. </span><span class="koboSpan" id="kobo.1744.2">You will use the Django groups and permissions system to restrict access to views, and you will implement formsets to edit the content of courses. </span><span class="koboSpan" id="kobo.1744.3">You will also create a drag-and-drop functionality to reorder course modules and their content using JavaScript and Django.</span></p>
<h1 class="heading-1" id="_idParaDest-351"><span class="koboSpan" id="kobo.1745.1">Additional resources</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1746.1">The following resources provide additional information related to the topics covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1747.1">Source code for this chapter: </span><a href="https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter12"><span class="url"><span class="koboSpan" id="kobo.1748.1">https://github.com/PacktPublishing/Django-5-by-example/tree/main/Chapter12</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1749.1">Using Django fixtures for testing: </span><a href="https://docs.djangoproject.com/en/5.0/topics/testing/tools/#fixture-loading"><span class="url"><span class="koboSpan" id="kobo.1750.1">https://docs.djangoproject.com/en/5.0/topics/testing/tools/#fixture-loading</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1751.1">Data migrations: </span><a href="https://docs.djangoproject.com/en/5.0/topics/migrations/#data-migrations"><span class="url"><span class="koboSpan" id="kobo.1752.1">https://docs.djangoproject.com/en/5.0/topics/migrations/#data-migrations</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1753.1">Class inheritance in Python: </span><a href="https://docs.python.org/3/tutorial/classes.html#inheritance "><span class="url"><span class="koboSpan" id="kobo.1754.1">https://docs.python.org/3/tutorial/classes.html#inheritance</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1755.1">Django model inheritance: </span><a href="https://docs.djangoproject.com/en/5.0/topics/db/models/#model-inheritance"><span class="url"><span class="koboSpan" id="kobo.1756.1">https://docs.djangoproject.com/en/5.0/topics/db/models/#model-inheritance</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1757.1">Creating custom model fields: </span><a href="https://docs.djangoproject.com/en/5.0/howto/custom-model-fields/"><span class="url"><span class="koboSpan" id="kobo.1758.1">https://docs.djangoproject.com/en/5.0/howto/custom-model-fields/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1759.1">Static directory for the e-learning project: </span><a href="https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter12/educa/courses/static "><span class="url"><span class="koboSpan" id="kobo.1760.1">https://github.com/PacktPublishing/Django-5-by-Example/tree/main/Chapter12/educa/courses/static</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-352"><span class="koboSpan" id="kobo.1761.1">Join us on Discord!</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1762.1">Read this book alongside other users, Django development experts, and the author himself. </span><span class="koboSpan" id="kobo.1762.2">Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more.Scan the QR code or visit the link to join the community.</span></p>
<p class="normal"><a href="https://packt.link/Django5ByExample"><span class="url"><span class="koboSpan" id="kobo.1763.1">https://packt.link/Django5ByExample</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1764.1"><img alt="" role="presentation" src="../Images/QR_Code287089408934129031.png"/></span></p>
</div>
</body></html>