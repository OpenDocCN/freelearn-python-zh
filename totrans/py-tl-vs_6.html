<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. IPython and IronPython in PTVS</h1></div></div></div><p>In this chapter, we will see how PTVS interacts with two particularly useful Python extensions: IPython and IronPython.</p><p>Despite their names, they are very different from each other. IPython is more oriented toward extending the REPL interface in a way that can help you have a more interactive approach to the code, providing you with features such as on-the-fly graph plotting. IronPython provides .NET class access to your Python code and integrates Python in .NET applications.</p><div><div><div><div><h1 class="title"><a id="ch06lvl1sec33"/>IPython in PTVS</h1></div></div></div><p>IPython<a id="id220" class="indexterm"/> is a command shell for interactive computing for Python (also <a id="id221" class="indexterm"/>available for other language integrations) that offers enhanced type<a id="id222" class="indexterm"/> introspection—the possibility to examine the type or properties of an object at runtime—rich media, and REPL extensions.</p><p>As an interactive shell tool used for data analysis and math graph plotting, IPython comes from an academic-scientific computing background, but appeals to data scientists through the power of graphing integration.</p><p>An interesting feature of IPython is its ability to plot mathematical graphs of expressions in an interactive way, much like MATLAB.</p><p>PTVS supports IPython libraries and provides the ability to integrate the graph that is generated inside REPL.</p><p>We need to install IPython and its supporting dependencies such as matplotlib from a distribution that has all the code already compiled for Windows OS. The distribution of this<a id="id223" class="indexterm"/> package can be downloaded from <a class="ulink" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#scipy-stack">http://www.lfd.uci.edu/~gohlke/pythonlibs/#scipy-stack</a>. This web page, from the University of California in Irivine, contains an unofficial repository of Windows binaries for a large number of Python packages. There are different packages that are available, which depend on the version of the Python interpreter and the operating system you are using. For our proposal, we are going to install Python 2.7 for Windows 32-bit.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>As an alternative, you can use the Python (x, y) distribution that contains a whole range of Python libraries for scientific and engineering software. The installer can be downloaded <a id="id224" class="indexterm"/>from <a class="ulink" href="https://code.google.com/p/pythonxy/">https://code.google.com/p/pythonxy/</a>.</p></div></div><p>Running the installer gives you the ability to choose the libraries it offers; for our scope, ensure that you include the SciPy libraries and IPython.</p><p>Once you have the libraries from the source of your choice, we can test the whole installation by executing the following command from the command prompt:</p><div><pre class="programlisting">ipython --pylab</pre></div><p>This<a id="id225" class="indexterm"/> command <a id="id226" class="indexterm"/>executes the IPython environment with the <code class="literal">pylab</code> extension. Also, it permits you to use the matplotlib library to plot graphs; this is a Python-plotting library that can be used with Python to plot graphs using mathematical functions. As an example, let's try to plot a histogram out of 10,000 random numbers that are clustered in 100 samples:</p><div><pre class="programlisting">x = randn(10000)
hist(x, 100)</pre></div><p>Typing the preceding code into the IPython shell will display the following result:</p><div><img src="img/8687OS_06_01.jpg" alt="IPython in PTVS"/></div><p>For more <a id="id227" class="indexterm"/>details on what the matplotlib library can do, refer to the library website at <a class="ulink" href="http://matplotlib.org/">http://matplotlib.org/</a>.</p><p>Now<a id="id228" class="indexterm"/> that IPython is up and working, let's instruct PTVS in a way<a id="id229" class="indexterm"/> that will allow REPL to talk to IPython to extend it along with its plotting capabilities. First, we need to find the Python interpreter's REPL options. You can quickly locate this from the <strong>Python Environments</strong> window by clicking on the <strong>Interactive Options</strong> label in the Python environment that is being used.</p><p> </p><div><img src="img/8687OS_06_02.jpg" alt="IPython in PTVS"/></div><p>
</p><p>This will bring up the <strong>Options</strong> dialog box, as shown in the following screenshot:</p><div><img src="img/8687OS_06_03.jpg" alt="IPython in PTVS"/></div><p>In the <strong>Interactive Mode</strong> drop-down menu, the different modes of the PTVS REPL tool are<a id="id230" class="indexterm"/> listed as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Standard</strong>: This mode offers the default REPL interactive window in which we can execute the Python code</li><li class="listitem" style="list-style-type: disc"><strong>IPython</strong>: This mode permits us to see the graphs directly inside REPL when REPL interacts with the PyLab library directly</li><li class="listitem" style="list-style-type: disc"><strong>IPython w/o PyLab</strong>: This mode permits us to see the graphs that are rendered in an independent window</li></ul></div><p>For our <a id="id231" class="indexterm"/>example, we are choosing the IPython mode. Now that we have set up <strong>Interactive Window</strong>, let's see how Visual Studio acts. Instead of writing the code of our previous example inside <strong>Interactive Window</strong>, you can write it in the code editor and then execute it in REPL through the <strong>Send to Interactive Window</strong> option in the contextual menu. As we have seen in <a class="link" href="ch02.html" title="Chapter 2. Python Tools in Visual Studio">Chapter 2</a>, <em>Python Tools in Visual Studio</em>, the following is the result to be expected:</p><div><img src="img/8687OS_06_04.jpg" alt="IPython in PTVS"/></div><p>We can<a id="id232" class="indexterm"/> also execute the code in the file in a way through which we'll <a id="id233" class="indexterm"/>only see the resulting graph in an external window. However, before we can do this, we need to add some other code as follows:</p><div><img src="img/8687OS_06_05.jpg" alt="IPython in PTVS"/></div><p>The first line in the preceding screenshot will reference the <code class="literal">pylab</code> libraries, and the last line will render the plot. To run the code in an external window, right-click on the file node<a id="id234" class="indexterm"/> in<a id="id235" class="indexterm"/> the <strong>Solution Explorer</strong> window and select the <strong>Start without debugging</strong> command as shown in the following screenshot:</p><div><img src="img/8687OS_06_06.jpg" alt="IPython in PTVS"/></div><p>This will execute the code in the console, and the resulting rendering window will appear at the end of the execution:</p><div><img src="img/8687OS_06_07.jpg" alt="IPython in PTVS"/></div><p>The<a id="id236" class="indexterm"/> matplotlib library also offers the possibility to save the resulting<a id="id237" class="indexterm"/> plot into a file with just a line of code by adding the <code class="literal">savefig</code> command<a id="id238" class="indexterm"/> as follows:</p><div><img src="img/8687OS_06_08.jpg" alt="IPython in PTVS"/></div><p>In this example, the resulting graph will be saved as a <code class="literal">plot.png</code> file in the root of the project folder.</p><p>For more in-depth functionalities and to dig deeper into the plotting functionalities offered by the<a id="id239" class="indexterm"/> IPython integration, please refer to the IPython website at <a class="ulink" href="http://ipython.org/">http://ipython.org/</a>. You can also refer to the matplotlib website at <a class="ulink" href="http://matplotlib.org/">http://matplotlib.org/</a>, which contains great documentation on this subject that are correlated with examples.</p><p>The<a id="id240" class="indexterm"/> only limitation of IPython is the fact that it cannot be used with<a id="id241" class="indexterm"/> the other library, IronPython, that we are going to explore right now. IronPython currently does not support IPython, despite the fact that you can select it on the <strong>Interactive Options</strong> form.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec34"/>IronPython</h1></div></div></div><p>IronPython<a id="id242" class="indexterm"/> is an open source implementation of the Python language which is tightly integrated with the Microsoft .NET framework. This means that you can use the .NET libraries through IronPython in your Python applications or use Python scripts inside .NET languages.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec20"/>Using .NET classes in Python code with IronPython</h2></div></div></div><p>To <a id="id243" class="indexterm"/>set<a id="id244" class="indexterm"/> up IronPython<a id="id245" class="indexterm"/> in PTVS, first we need to download the IronPython installer from the<a id="id246" class="indexterm"/> official website, <a class="ulink" href="http://ironpython.net/">http://ironpython.net/</a>.</p><p>Once you download the version of the package for your operating system, install the package by double-clicking on it. After the installation is complete, you will see that a new interpreter is available in the <strong>Python Environments</strong> window as follows:</p><div><img src="img/8687OS_06_09.jpg" alt="Using .NET classes in Python code with IronPython"/></div><p>In the example shown in the preceding screenshot, there are actually two interpreters. This is because the 64-bit version of IronPython is installed, which results in the installation of both the 32-bit and 64-bit versions on the machine.</p><p>Let's<a id="id247" class="indexterm"/> try<a id="id248" class="indexterm"/> to create <a id="id249" class="indexterm"/>a new IronPython project to learn how to interact with the .NET libraries from Python. Navigate to <strong>File</strong> | <strong>New</strong> | <strong>Project</strong> to create a new project:</p><div><img src="img/8687OS_06_10.jpg" alt="Using .NET classes in Python code with IronPython"/></div><p>This will open the <strong>New Project</strong> dialog box. Select the <strong>IronPython Application</strong> template and assign a project name to it:</p><div><img src="img/8687OS_06_11.jpg" alt="Using .NET classes in Python code with IronPython"/></div><p>This <a id="id250" class="indexterm"/>will <a id="id251" class="indexterm"/>create a <a id="id252" class="indexterm"/>normal Python project, except that the environment for the project will be IronPython instead of Python.</p><div><img src="img/8687OS_06_12.jpg" alt="Using .NET classes in Python code with IronPython"/><div><p>You can find IronPython indicated as the environment in Solution Explorer</p></div></div><p>Now you can access .NET libraries from inside the Python applications. The system's .NET namespace is referenced by default, so we can start using the elements inside it to see how to interact with the base classes in Python.</p><p>As an<a id="id253" class="indexterm"/> example, let's see how to create a <strong>Globally Unique Identifier</strong> (<strong>GUID</strong>), play<a id="id254" class="indexterm"/> with the <code class="literal">date</code> function, and then print them out to the console; we're doing all of this using Python<a id="id255" class="indexterm"/> by <a id="id256" class="indexterm"/>accessing<a id="id257" class="indexterm"/> the .NET classes.</p><div><img src="img/8687OS_06_13.jpg" alt="Using .NET classes in Python code with IronPython"/><div><p>Example of using .NET classes inside Python</p></div></div><p>As shown, we imported the <code class="literal">Console</code>, <code class="literal">Guid</code>, and <code class="literal">DateTime</code> .NET objects and used them in the code to create a new GUID object (line <strong>3</strong>), get the current UTC date and time (line <strong>4</strong>), and add 100 days to it (line <strong>5</strong>). After this, we used the .NET console object to print out the result (line <strong>7</strong> to <strong>11</strong>) and waited for the user to press the <em>Enter</em> key to close the application. Obviously, we could have used the normal Python <code class="literal">print</code> command instead of<a id="id258" class="indexterm"/> the <code class="literal">Console</code> object to print out the result. However, since there is no distinction between Python and the .NET code with IronPython, we used the <code class="literal">Console</code> object for the sake of seeing different object integrations in action.</p><p>The execution of the code will provide us with the following result:</p><div><img src="img/8687OS_06_14.jpg" alt="Using .NET classes in Python code with IronPython"/></div><p>We <a id="id259" class="indexterm"/>can <a id="id260" class="indexterm"/>also take <a id="id261" class="indexterm"/>advantage of other .NET namespaces outside of the Core System assembly. For example, if we want to use the <code class="literal">System.Xml</code> assembly, which is a .NET core library<a id="id262" class="indexterm"/> that is installed in the <strong>Global Assembly Cache</strong> (<strong>GAC</strong>) of the system, all we need to do is to load it in our code using the load functionality of the <code class="literal">clr</code> module as follows:</p><div><pre class="programlisting">import clr
clr.AddReference('System.Xml')</pre></div><p>Now it can be referenced in the code, and the IntelliSense functionalities become available:</p><div><img src="img/8687OS_06_15.jpg" alt="Using .NET classes in Python code with IronPython"/></div><p>.NET types are exposed as Python classes, and you can do many of the same operations on .NET types as with Python classes. In either case, you create an instance by calling the type. Even for complex types, <code class="literal">XmlDocument</code> for example, you don't need to instantiate it as<a id="id263" class="indexterm"/> you<a id="id264" class="indexterm"/> do in .NET; it will be done by the IronPython runtime under the hood.</p><div><img src="img/8687OS_06_16.jpg" alt="Using .NET classes in Python code with IronPython"/><div><p>An example of using the XmlDocument class in Python</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec21"/>Using the Python code in .NET with IronPython</h2></div></div></div><p>So far, we<a id="id265" class="indexterm"/> have learned how we can interact<a id="id266" class="indexterm"/> with .NET classes from the Python<a id="id267" class="indexterm"/> code; now let's take a look at how to use Python inside our .NET code.</p><p>To start, let's create a new C# console application. To be able to run the Python code from your .NET code, you need to reference two assemblies that are necessary to add the integration functionality for our .NET application: <code class="literal">IronPython</code> and <code class="literal">Microsoft.Scripting</code>. To add a reference to an assembly in a .NET application, right-click on the <strong>Reference</strong> node of the <strong>Solution Explorer</strong> window and select the <strong>Add Reference</strong> menu item:</p><div><img src="img/8687OS_06_17.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>This will open the <strong>Reference Manager</strong> dialog window. The two assemblies that we need are located in the <strong>Extensions</strong> list, which can be activated by clicking on the tree view on the left-hand side:</p><div><img src="img/8687OS_06_18.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>Once<a id="id268" class="indexterm"/> the<a id="id269" class="indexterm"/> two assemblies are selected from<a id="id270" class="indexterm"/> the list by placing a tick in the checkboxes next to them, click on <strong>OK</strong>. The references to these assemblies are made in the project.</p><p>You will see them listed in the <strong>Reference</strong> list in the <strong>Solution Explorer</strong> window as shown in the following screenshot:</p><div><img src="img/8687OS_06_19.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>Now<a id="id271" class="indexterm"/> let's <a id="id272" class="indexterm"/>create <a id="id273" class="indexterm"/>a new class in our project that contains the code for our Python integration:</p><div><img src="img/8687OS_06_20.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>This<a id="id274" class="indexterm"/> code will create <code class="literal">scripting engine</code> for<a id="id275" class="indexterm"/> Python (line <strong>8</strong>), define the string<a id="id276" class="indexterm"/> that contains the Python code to be executed (lines <strong>12</strong>-<strong>18</strong>), and then execute the Python script. Pay special attention to the string that contains the Python code. It has to be indented correctly; otherwise, the interpreter will return an indentation error.</p><p>To run the code and see the result in the console, add the following code into the <code class="literal">Program.cs</code> file:</p><div><img src="img/8687OS_06_21.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>This <a id="id277" class="indexterm"/>will <a id="id278" class="indexterm"/>execute our function defined earlier<a id="id279" class="indexterm"/> and expect the user to press <em>Enter</em>. Run the application to see the following result:</p><div><img src="img/8687OS_06_22.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>You can also call variables and functions defined in .NET applications and use them inside the Python code. To do this, we need to define a scope and pass it as an argument to the <code class="literal">Execute</code> method<a id="id280" class="indexterm"/> in a way that the interpreter can pass those elements to the Python code.</p><p>Extend<a id="id281" class="indexterm"/> our previous <code class="literal">Execute</code> method by adding a scope that contains an <code class="literal">Add</code> function:</p><div><img src="img/8687OS_06_23.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>We <a id="id282" class="indexterm"/>created <a id="id283" class="indexterm"/>a scope and the <code class="literal">Add</code> function with<a id="id284" class="indexterm"/> a lambda function (lines <strong>13</strong> and <strong>14</strong>); then, we added a new Python command (line <strong>23</strong>) that invokes this function. Finally, we executed the Python code and passed the scope variable to the script (line <strong>27</strong>). Executing the program will display the following result:</p><div><img src="img/8687OS_06_24.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>In <a id="id285" class="indexterm"/>our <a id="id286" class="indexterm"/>last example, we will see how to<a id="id287" class="indexterm"/> execute a code that comes from an external file. Let's say that we have a Python file that contains the following code, which is actually the code we had as a string in our last example:</p><div><img src="img/8687OS_06_25.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>This is how we can execute the file from inside our .NET application:</p><div><img src="img/8687OS_06_26.jpg" alt="Using the Python code in .NET with IronPython"/></div><p>In<a id="id288" class="indexterm"/> the example, we define the scripting <a id="id289" class="indexterm"/>engine and the scope. Instead of <a id="id290" class="indexterm"/>defining and executing the Python code from inside the .NET code, we are loading it from an external file, passing the scope to the interpreter, and executing it (line <strong>40</strong>).</p><p>The possibilities offered by integrating Python code into .NET applications are really endless. Sharing the scope variables with the interpreter opens up a possibility to use existent Python libraries from inside the .NET applications or use Python as a scripting language inside our application.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec35"/>Summary</h1></div></div></div><p>In this chapter, we looked at two ways to extend PTVS and Python in Visual Studio in general along with two powerful tools: IPython and IronPython. IPython is more related to plain Python language and IronPython is more integrated with the Microsoft .NET framework.</p><p>Both tools show new ways to use and interact with Python, providing new frontiers to explore with this powerful language; all made possible from inside Visual Studio and PTVS.</p><p>With this chapter, our voyage to explore the Python tools in Visual Studio ends. We tried to show Python developers the power of Visual Studio and the amount of automatism and help that the Microsoft IDE offers; we also explored and learned the possibility of using Python as a language to create new powerful applications.</p><p>Besides the tools themselves, we also went through the possible problems and workarounds of using Python libraries on the Microsoft Windows operating system. We also looked at the topic of exploring Django in Visual Studio and also some of the powerful libraries it offers to accelerate and manage the application's life cycle.</p><p>We have only scratched the surface, but we hope that this book has provided you with a deep insight into PTVS and has sparked the curiosity for you to go deeper and explore more.</p><p>Happy coding!</p></div></body></html>