<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 1. GUI Basics – Building an Interface"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. GUI Basics – Building an Interface</h1></div></div></div><p>Kivy is <a id="id0" class="indexterm"/>a free, open source Python library that allows for quick and easy development of highly interactive multiplatform applications. Kivy's execution speed is comparable to the native mobile alternative, Java for Android or Objective C for iOS. Moreover, Kivy has the huge advantage of being able to run on multiple platforms, just as HTML5 does; in which case, Kivy performs better because it doesn't rely on a heavy browser, and many of its components are implemented in C using the Cython library in such a way that most of the graphics processing runs directly in the GPU. Kivy strikes a great balance between performance and portability across various hardware and software environments. Kivy emerges with a simple but ambitious goal in mind:</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>"… same code for every platform, at least what we use every day: Linux/Windows/Mac OS X/Android/iOS"</em></span></p></blockquote></div><p>Mathieu Virbel (<a class="ulink" href="http://txzone.net/2011/01/kivy-next-pymt-on-android-step-1-done/">http://txzone.net/2011/01/kivy-next-pymt-on-android-step-1-done/</a>)</p><p>This<a id="id1" class="indexterm"/> support has being extended to Raspberry Pi, thanks to a crowd funding campaign started by Mathieu Virbel, the creator of Kivy. Kivy was introduced for the first time at EuroPython 2011 as a Python framework designed for creating natural user interfaces. Since then, it has grown bigger and attracted an enthusiastic community.</p><p>This <a id="id2" class="indexterm"/>book requires some knowledge of Python, and very basic terminal skills, but also it requires some understanding of <span class="strong"><strong>Object-Oriented Programming</strong></span> (<span class="strong"><strong>OOP</strong></span>) concepts. In particular, it is assumed that you understand the concept<a id="id3" class="indexterm"/> of <span class="strong"><strong>inheritance</strong></span> and the difference between<a id="id4" class="indexterm"/> <span class="strong"><strong>instances</strong></span> and <span class="strong"><strong>classes</strong></span>. Refer to the following table to review<a id="id5" class="indexterm"/> some of these concepts:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Concept</p>
</th><th style="text-align: left" valign="bottom">
<p>URL</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>OOP</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Object-oriented_programming">http://en.wikipedia.org/wiki/Object-oriented_programming</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Inheritance</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)">http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Instance</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Instance_(computer_science)">http://en.wikipedia.org/wiki/Instance_(computer_science)</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Class</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Class_(computer_science)">http://en.wikipedia.org/wiki/Class_(computer_science)</a>
</p>
</td></tr></tbody></table></div><p>Before <a id="id6" class="indexterm"/>we start, you will need to install<a id="id7" class="indexterm"/> Kivy. The<a id="id8" class="indexterm"/> installation process for all <a id="id9" class="indexterm"/>different platforms is documented and regularly updated on the Kivy<a id="id10" class="indexterm"/> website: <a class="ulink" href="http://kivy.org/docs/installation/installation.html">http://kivy.org/docs/installation/installation.html</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>All code in this book has been tested with Kivy 1.9.0 and both Python 2.7 and Python 3.4 (but 3.3 should work fine as well).</p><p>Note that packaging support for mobile is not yet complete for Python 3.3+. For now, if we want to create mobile apps for Android or iOS, we should use Python 2.7. If you want to know your Python version, you can execute <code class="literal">python -V</code> in a terminal to check your installed Python version.</p></div></div><p>In this chapter, we start by creating user interfaces using one of Kivy's most fun and powerful <a id="id11" class="indexterm"/>components – the Kivy language (<code class="literal">.kv</code>). The Kivy Language separates logic from presentation in order to keep an easy and intuitive code; it also links components at an interface level. In future chapters, you will also learn how to build and modify interfaces dynamically using pure Python code and Kivy as a library.</p><p>Here is a list <a id="id12" class="indexterm"/>of all the skills that you are about to learn:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Launching a Kivy application</li><li class="listitem" style="list-style-type: disc">Using the Kivy language</li><li class="listitem" style="list-style-type: disc">Instantiating and personalizing widgets (GUI components) through basic properties and variables</li><li class="listitem" style="list-style-type: disc">Differentiating between fixed, proportional, absolute, and relative coordinates</li><li class="listitem" style="list-style-type: disc">Creating responsive GUIs through layouts</li><li class="listitem" style="list-style-type: disc">Modularizing code in different files</li></ul></div><p>This chapter covers all the basics for building a <span class="strong"><strong>Graphical User Interface</strong></span> (<span class="strong"><strong>GUI</strong></span>) in Kivy. First, we<a id="id13" class="indexterm"/> will learn techniques to run an application and how to use and integrate widgets. After that, we will introduce the main project of the book, the <span class="emphasis"><em>Comic Creator</em></span>, and program the main structure of the GUI that we will continue using in the following two chapters. At the end of this chapter, you will be able to build a GUI starting from a pencil and paper sketch, and also learn some techniques to make the GUI responsive to the size of the window.</p><div class="section" title="Basic interface – Hello World!"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Basic interface – Hello World!</h1></div></div></div><p>Let's <a id="id14" class="indexterm"/>put our hands on our first code.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><p>The following is a Hello World program:</p><div class="informalexample"><pre class="programlisting">1. # File name: hello.py
2. import kivy
3. kivy.require('1.9.0')
4. 
5. from kivy.app import App
6. from kivy.uix.button import Label
7. 
8. class HelloApp(App):
9.     def build(self):
10.         return Label(text='Hello World!')
11. 
12. if __name__=="__main__":
13.         HelloApp().run()</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>This is merely Python code. Launching a Kivy program is not any different from launching any other Python application.</p></div></div><p>In order to run the code, you open a terminal (line of commands or console) and specify the following command in Windows or Linux: <code class="literal">python hello.py --size=150x100</code> (<code class="literal">--size</code> is a parameter to specify the screen size).</p><p>On a Mac, you must type in <code class="literal">kivy</code> instead of <code class="literal">python</code> after installing <code class="literal">Kivy.app</code> in <code class="literal">/Applications</code>. Lines 2 and 3 verify that we have the appropriate version of Kivy installed on our computer.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>If you try to launch our application with an older Kivy version (say 1.8.0) than the specified version, then line 3 will raise an <code class="literal">Exception</code> error. This <code class="literal">Exception</code> is not raised if we have a more recent version.</p></div></div><p>We omit<a id="id15" class="indexterm"/> the call to <code class="literal">kivy.require</code> in most of the examples in the book, but you will find it in the code that you download online (<a class="ulink" href="https://www.packtpub.com">https://www.packtpub.com</a>/), and its use is strongly encouraged in real-life projects. The program uses two classes from the Kivy library (lines 5 and 6) – <code class="literal">App</code> and <code class="literal">Label</code>. The class <span class="strong"><strong><code class="literal">App</code></strong></span> is<a id="id16" class="indexterm"/> the starting point of any Kivy application. Consider <code class="literal">App</code> as the empty window where we will add other Kivy components.</p><p>We use the <code class="literal">App</code> class <a id="id17" class="indexterm"/>through <span class="strong"><strong>inheritance</strong></span>; the <code class="literal">App</code> class becomes the base class of the <code class="literal">HelloApp</code> subclass or child class (line 8). In practice, this means that the <code class="literal">HelloApp</code> class has all the variables and methods of <code class="literal">App</code>, plus whatever we define in the body (lines 9 and 10) of the <code class="literal">HelloApp</code> class. Most importantly, <code class="literal">App</code> is the starting point of any Kivy application. We can see that line 13 creates an instance of <code class="literal">HelloApp</code> and runs it.</p><p>Now the <code class="literal">HelloApp</code> class's body just overrides one of the existing <code class="literal">App</code> class's methods, the <code class="literal">build(self)</code> method. This method has to return the window content. In our case, a <span class="strong"><strong><code class="literal">Label</code></strong></span> that <a id="id18" class="indexterm"/>holds the text <span class="strong"><strong>Hello World</strong></span><code class="literal">!</code> (line 10). A <span class="strong"><strong>Label</strong></span> is a <span class="strong"><strong>widget</strong></span> that <a id="id19" class="indexterm"/>allows you to display some text on the screen.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>A <span class="strong"><strong>widget</strong></span> is a Kivy GUI component. Widgets are the minimal graphical units that we put together in order to create user interfaces.</p></div></div><p>The following screenshot shows the resulting screen after executing the <code class="literal">hello.py</code> code:</p><div class="mediaobject"><img src="images/B04244_01_01.jpg" alt="Basic interface – Hello World!"/></div><p>So, is Kivy just another library for Python? Well, yes. But as part of the library, Kivy offers its own language in order to separate the logic from the presentation and to link elements of the interface. Moreover, remember that this library will allow you to port your applications to many platforms.</p><p>Let's start to<a id="id20" class="indexterm"/> explore the Kivy language. We will separate the previous Python code into two files, one for the presentation (interface), and another for the logic. The first file includes the Python lines:</p><div class="informalexample"><pre class="programlisting">14. # File name: hello2.py
15. from kivy.app import App
16. from kivy.uix.button import Label
17. 
18. class Hello2App(App):
19.     def build(self):
20.         return Label()
21. 
22. if __name__=="__main__":
23.     Hello2App().run()</pre></div><p>The <code class="literal">hello2.py</code> code is very similar to <code class="literal">hello.py</code>. The difference is that the method <code class="literal">build(self)</code> doesn't have the <span class="strong"><strong>Hello World!</strong></span> message. Instead, the message has been moved to the <code class="literal">text</code> property in the Kivy language file (<code class="literal">hello2.kv</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>A <span class="strong"><strong>property</strong></span> is<a id="id21" class="indexterm"/> an attribute that can be used to change the content, appearance, or behavior of a widget.</p></div></div><p>The following is the code (rules) of <code class="literal">hello2.kv</code>, which shows how we modify the <code class="literal">Label</code> content with the <code class="literal">text</code> property (line 27):</p><div class="informalexample"><pre class="programlisting">24. # File name: hello2.kv
25. #:kivy 1.9.0
26. &lt;Label&gt;:
27.     text: 'Hello World!'</pre></div><p>You might wonder how Python or Kivy knows that these two files (<code class="literal">hello2.py</code> and <code class="literal">hello2.kv</code>) are related. This tends to be confusing at the beginning. The key is in the name of the subclass of <code class="literal">App</code>, which in this case is <code class="literal">HelloApp</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>The beginning part of the <code class="literal">App</code> class's subclass name must coincide with the name of the Kivy file. For example, if the definition of the class is <code class="literal">class FooApp(App)</code>, then the name of the file has to be <code class="literal">foo.kv</code> and in the same directory of the main file (the one that executes the <code class="literal">run()</code> method of <code class="literal">App</code>).</p></div></div><p>Once that consideration is included, this example can be run in the same way we ran the previous one. We just need to be sure we are calling the main file – <code class="literal">python hello2.py -–size=150x100</code>.</p><p>This is our first<a id="id22" class="indexterm"/> contact with the Kivy language, so we should have an in-depth look at it. Line 25 (<code class="literal">hello2.kv</code>) tells Python the minimal version of Kivy that should be used. It does the same thing as the previous lines 2 and 3 do in <code class="literal">hello.py</code>. The instructions that start with <code class="literal">#:</code> in the header of a Kivy language are called <span class="strong"><strong>directives</strong></span>. We <a id="id23" class="indexterm"/>will also be omitting the version directive throughout the rest of this book, but remember to include it in your own projects.</p><p>The <code class="literal">&lt;Label&gt;:</code> rule (line 26) indicates that we are going to modify the <code class="literal">Label</code> class.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>The Kivy <a id="id24" class="indexterm"/>language is expressed as a sequence of rules. A <span class="strong"><strong>rule</strong></span> is a piece of code that defines the content, behavior, and appearance of a Kivy widget class. A rule always starts with a widget class name in angle brackets followed by a colon, like this, <code class="literal">&lt;Widget Class&gt;:</code>
</p></div></div><p>Inside the rule, we set the <code class="literal">text</code> property with <code class="literal">'Hello World!'</code> (line 27). The code in this section will generate the same output screen as before. In general, everything in Kivy can be done using pure Python and importing the necessary classes from the Kivy library, as we did in the first example (<code class="literal">hello.py</code>). However, there are many advantages of using the Kivy language and therefore this book explains all the presentation programming in the Kivy language, unless we need to add dynamic components, in which case using Kivy as a traditional Python library is more appropriate.</p><p>If you are an experienced programmer, you might have worried that modifying the <code class="literal">Label</code> class affects all the instances we could potentially create from <code class="literal">Label</code>, and therefore they will all contain the same <code class="literal">Hello World</code> text. That is true, and we are going to study a better approach to doing this in the following section.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Basic widgets – labels and buttons"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Basic widgets – labels and buttons</h1></div></div></div><p>In the <a id="id25" class="indexterm"/>last <a id="id26" class="indexterm"/>section, we used the <code class="literal">Label</code> class, which is one of the multiple widgets that Kivy provides. You can think of widgets as interface blocks that we use to set up a GUI. Kivy has a complete set of widgets – buttons, labels, checkboxes, dropdowns, and many more. You can find them all in the API of Kivy under the<a id="id27" class="indexterm"/> package <code class="literal">kivy.uix</code> (<a class="ulink" href="http://kivy.org/docs/api-kivy.html">http://kivy.org/docs/api-kivy.html</a>).</p><p>We are going to learn the basics of how to create our own personalized widget without affecting the default configuration of Kivy widgets. In order to do that, we will use inheritance to create the <code class="literal">MyWidget</code> class in the <code class="literal">widgets.py</code> file:</p><div class="informalexample"><pre class="programlisting">28.# File name: widgets.py
29. from kivy.app import App
30. from kivy.uix.widget import Widget
31. 
32. class MyWidget(Widget):
33.     pass
34. 
35. class WidgetsApp(App):
36.     def build(self):
37.         return MyWidget()
38. 
39. if __name__=="__main__":
40.     WidgetsApp().run()</pre></div><p>In line 32, we<a id="id28" class="indexterm"/> inherit from the base class <span class="strong"><strong><code class="literal">Widget</code></strong></span> and create the subclass <code class="literal">MyWidget</code>. It is a <a id="id29" class="indexterm"/>general practice to create your own <code class="literal">Widget</code> for your applications<a id="id30" class="indexterm"/> instead of using the Kivy classes directly, because we want to avoid applying our changes to all future instances of the widget Kivy class. In the case of our previous example (<code class="literal">hello2.kv</code>), modifying the <code class="literal">Label</code> class (line 26) would affect all of its future instances. In line 37, we instantiated <code class="literal">MyWidget</code> instead of <code class="literal">Label</code> directly (as we did in <code class="literal">hello2.py</code>), so we can now distinguish between our widget (<code class="literal">MyWidget</code>) and the Kivy widget (<code class="literal">Widget</code>). The rest of the code is analogous to what we covered before. </p><p>The following is the corresponding Kivy language code (<code class="literal">widgets.kv</code>):</p><div class="informalexample"><pre class="programlisting">41. # File name: widgets.kv
42. &lt;MyWidget&gt;:
43.     Button:
44.         text: 'Hello'
45.         font_size: 32
46.         color: .8,.9,0,1
47.         pos: 0, 100
48.         size: 100, 50
49.     Button:
50.         text: 'World!'
51.         font_size: 32
52.         color: .8,.9,0,1
53.         pos: 100,0
54.         size: 100, 50</pre></div><p>Note that now we are using <span class="strong"><strong>buttons</strong></span> instead of labels. Most of the basic widgets in Kivy work in similar ways. In fact, <span class="strong"><strong><code class="literal">Button</code></strong></span> is just a subclass of <code class="literal">Label</code> that incorporates more properties <a id="id31" class="indexterm"/>such as background color.</p><p>Compare the notation of line 26 (<code class="literal">&lt;Label&gt;:</code>) in <code class="literal">hello2.kv</code> with line 43 (<code class="literal">Button:</code>) of the preceding code (<code class="literal">widgets.kv</code>). We used the rule class notation (<code class="literal">&lt;Class&gt;:</code>) for the <code class="literal">Label</code> (and <code class="literal">MyWidget</code>) class, but a different notation (<code class="literal">Instance:</code>) for <code class="literal">Button</code>. In this way, we defined that <code class="literal">MyWidget</code> has two instances of <code class="literal">Button</code> (line 43 and 49).</p><p>Finally, we<a id="id32" class="indexterm"/> set <a id="id33" class="indexterm"/>the properties of the <code class="literal">Button</code> instances. The <span class="strong"><strong><code class="literal">font_size</code></strong></span> property sets the size of the text. The <span class="strong"><strong><code class="literal">color</code></strong></span> property sets<a id="id34" class="indexterm"/> the <a id="id35" class="indexterm"/>text color and is specified in RGBA format (red, green, blue, and alpha/transparency). The properties <span class="strong"><strong><code class="literal">size</code></strong></span> and <span class="strong"><strong><code class="literal">pos</code></strong></span> set the size and position of the widget and consist of a pair of <span class="strong"><strong>fixed coordinates</strong></span> (x for<a id="id36" class="indexterm"/> horizontal and y for vertical), the exact pixels on the window.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Note that the coordinate (0, 0) is located at the bottom-left corner, the Cartesian origin. Many other languages (including CSS) use the top-left corner as the (0, 0) coordinate, so take note!</p></div></div><p>The following screenshot shows the output of <code class="literal">widgets.py</code> and <code class="literal">widgets.kv</code> with some helpful annotations:</p><div class="mediaobject"><img src="images/B04244_01_02.jpg" alt="Basic widgets – labels and buttons"/></div><p>A couple of things can be improved in the previous code (<code class="literal">widgets.kv</code>). First, there are some repeated properties for both buttons: <code class="literal">pos</code>, <code class="literal">color</code>, and <code class="literal">font_size</code>. Instead of that, let's create our own <code class="literal">Button</code> as we did with <code class="literal">MyWidget</code> so it will be easy to keep the buttons' design consistent. Second, the fixed position is quite annoying because the widgets don't adjust when the screen is resized. Let's make it responsive to the screen size in the <code class="literal">widgets2.kv</code> file:</p><div class="informalexample"><pre class="programlisting">55. # File name: widgets2.kv
56. &lt;MyButton@Button&gt;:
57.     color: .8,.9,0,1
58.     font_size: 32
59.     size: 100, 50
60. 
61. &lt;MyWidget&gt;:
62.     MyButton:
63.         text: 'Hello'
64.         pos: root.x, root.top - self.height
65.     MyButton:
66.         text: 'World!'
67.         pos: root.right - self.width, root.y</pre></div><p>In this code (<code class="literal">widgets2.kv</code>), we create (<code class="literal">&lt;MyButton@Button&gt;:</code>) and customize the <code class="literal">MyButton</code> class (lines 56 to 59) and instances (line 62 to 67). Note the differences in the manner we defined <code class="literal">MyWidget</code> and <code class="literal">MyButton</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>Because we did not define the <code class="literal">MyButton</code> base class in <code class="literal">widgets.py</code> as we did with <code class="literal">MyWidget</code> (line 32 of <code class="literal">widgets.py</code>), we have to specify <code class="literal">@Class</code> in the Kivy language rule (line 56). In the <code class="literal">MyWidget</code> class case, we also needed to define its class from the Python side because we instantiated it directly (line 37 of <code class="literal">widgets.py</code>).</p></div></div><p>In this <a id="id37" class="indexterm"/>example, each <code class="literal">Button</code> class's position is responsive in the sense<a id="id38" class="indexterm"/> that they are always in the corners of the screen, no matter what the window size is. In order to achieve that, we need to use two internal variables – <span class="strong"><strong><code class="literal">self</code></strong></span> and <span class="strong"><strong><code class="literal">root</code></strong></span>. You <a id="id39" class="indexterm"/>might be familiar with the variable <span class="strong"><strong><code class="literal">self</code></strong></span>. As you have<a id="id40" class="indexterm"/> probably guessed, it is just a reference to the <code class="literal">Widget</code> itself. For example, <code class="literal">self.height</code> (line 64) has a value of <code class="literal">50</code> because that is the height of that particular <code class="literal">MyButton</code> class. The variable <span class="strong"><strong><code class="literal">root</code></strong></span> is a reference to the <code class="literal">Widget</code> class at the top of the hierarchy. For example, the <code class="literal">root.x</code> (line 64) has a value of <code class="literal">0</code> because that is the position in X-axis of the <code class="literal">MyWidget</code> instance created on line 37 of <code class="literal">widgets.py</code>.</p><p>
<code class="literal">MyWidget</code> uses<a id="id41" class="indexterm"/> all<a id="id42" class="indexterm"/> of the window's space by<a id="id43" class="indexterm"/> default; therefore, the origin is (0, 0). The <span class="strong"><strong><code class="literal">x</code></strong></span> and <span class="strong"><strong><code class="literal">y</code></strong></span> and <span class="strong"><strong><code class="literal">width</code></strong></span> and <span class="strong"><strong><code class="literal">height</code></strong></span> are<a id="id44" class="indexterm"/> also widget properties, which we can use to disjoint <code class="literal">pos</code> and <code class="literal">size</code> respectively.</p><p>Fixed coordinates are still a laborious way to organize widgets and elements in the window. Let's move on to something smarter – layouts.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="Layouts"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Layouts</h1></div></div></div><p>No <a id="id45" class="indexterm"/>doubt, fixed coordinates are the most flexible way to organize elements in an n-dimensional space; however, it is very time consuming. Instead, Kivy provides a set of layouts that will facilitate the work of organizing widgets. A <span class="strong"><strong><code class="literal">Layout</code></strong></span> is a <code class="literal">Widget</code> subclass that implements different strategies to organize embedded widgets. For example, one strategy could be organizing widgets in a grid (<code class="literal">GridLayout</code>).</p><p>Let's start <a id="id46" class="indexterm"/>with a simple <span class="strong"><strong><code class="literal">FloatLayout</code></strong></span> example. It works in a very similar manner to the way we organize widgets directly inside of another <code class="literal">Widget</code> subclass, except that now we can use <span class="strong"><strong>proportional coordinates</strong></span> ("percentages" of the total size of the window) rather than fixed <a id="id47" class="indexterm"/>coordinates (exact pixels). </p><p>That <a id="id48" class="indexterm"/>means that we won't need the calculations we did in the previous section with <code class="literal">self</code> and <code class="literal">root</code>. Here is the Python code of an example that resembles the previous one:</p><div class="informalexample"><pre class="programlisting">68. # File name: floatlayout.py
69. 
70. from kivy.app import App
71. from kivy.uix.floatlayout import FloatLayout
72. 
73. class FloatLayoutApp(App):
74.     def build(self):
75.         return FloatLayout()
76. 
77. if __name__=="__main__":
78.     FloatLayoutApp().run()</pre></div><p>There is nothing really new in the preceding code (<code class="literal">floatlayout.py</code>), except the use of <code class="literal">FloatLayout</code> (line 75). The interesting parts are in the corresponding Kivy language (<code class="literal">floatlayout.kv</code>):</p><div class="informalexample"><pre class="programlisting">79. # File name: floatlayout.py
80. &lt;Button&gt;:
81.     color: .8,.9,0,1
82.     font_size: 32
83.     size_hint: .4, .3
84. 
85. &lt;FloatLayout&gt;:
86.     Button:
87.         text: 'Hello'
88.         pos_hint: {'x': 0, 'top': 1}
89.     Button:
90.         text: 'World!'
91.         pos_hint: {'right': 1, 'y': 0}</pre></div><p>In <code class="literal">floatlayout.kv</code>, we<a id="id49" class="indexterm"/> use two new properties – <span class="strong"><strong><code class="literal">size_hint</code></strong></span> (line 83) and <span class="strong"><strong><code class="literal">pos_hint</code></strong></span> (lines 88 and 91) .They<a id="id50" class="indexterm"/> are similar to <code class="literal">size</code> and <code class="literal">pos</code> but receive proportional coordinates with values ranging from <code class="literal">0</code> to <code class="literal">1</code>; (0, 0) is the bottom-left corner and (1, 1) is the top-right corner. For example, the <code class="literal">size_hint</code> property on line 83 sets the width to 40 percent of the window width and the height to 30 percent of the current window height. Something similar happens to the <code class="literal">pos_hint</code> property (lines 88 and 91 but the notation is different – a Python dictionary where the keys (for example, <code class="literal">'x'</code> or <code class="literal">'top'</code>) indicate which part of the widget is referenced. For example, <code class="literal">'x'</code> is the left border.</p><p>Note that we use the <code class="literal">top</code> key instead of the <code class="literal">y</code> one on line 88 and the <code class="literal">right</code> key instead of the <code class="literal">x</code> one <a id="id51" class="indexterm"/>on line 91. The <span class="strong"><strong><code class="literal">top</code></strong></span> and <span class="strong"><strong><code class="literal">right</code></strong></span> keys respectively reference the top and right edges of <code class="literal">Button</code>. In <a id="id52" class="indexterm"/>this case, we could have<a id="id53" class="indexterm"/> also used <code class="literal">x</code> and <code class="literal">y</code> for both axes; for example, we could have written <code class="literal">pos_hint: {'x': .85, 'y': 0}</code> as line 91. However, the <span class="strong"><strong><code class="literal">right</code></strong></span> and <span class="strong"><strong><code class="literal">top</code></strong></span> keys avoid us some calculations, making the code clearer.</p><p>The next screenshot shows the result, and the available keys for the <code class="literal">pos_hint</code> dictionary:</p><div class="mediaobject"><img src="images/B04244_01_03.jpg" alt="Layouts"/></div><p>The available <code class="literal">pos_hint</code> keys (<code class="literal">x</code>, <span class="strong"><strong><code class="literal">center_x</code></strong></span>, <code class="literal">right</code>, <code class="literal">y</code>, <span class="strong"><strong><code class="literal">center_y</code></strong></span>, and <code class="literal">top</code>) are useful to align the edges or for centering. For example, <code class="literal">pos_hint: {'center_x':.5, 'center_y':.5}</code> would align a widget in the middle no matter the size of the window.</p><p>We could have used the <code class="literal">top</code> and <code class="literal">right</code> properties with the fixed positioning of <code class="literal">widgets2.kv</code> (line 64 and 67), but note that <code class="literal">pos</code> doesn't accept Python dictionaries (<code class="literal">{'x':0,'y':0}</code>), just pairs of values exclusively corresponding to (<code class="literal">x</code>, <code class="literal">y</code>). Therefore, instead of using the <code class="literal">pos</code> property, we should use the <code class="literal">x</code>, <code class="literal">center_x</code>, <code class="literal">right</code>, <code class="literal">y</code>, <code class="literal">center_y</code>, and <code class="literal">top</code> properties directly (not dictionary keys). For example, instead of <code class="literal">pos: root.x, root.top - self.height</code> (line 64), we should have used:</p><div class="informalexample"><pre class="programlisting">x: 0
top: root.height</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>The<a id="id54" class="indexterm"/> properties <code class="literal">x</code>, <code class="literal">center_x</code>, <code class="literal">right</code>, <code class="literal">y</code>, <code class="literal">center_y</code>, and <code class="literal">top</code> always specify <span class="strong"><strong>fixed coordinates</strong></span> (pixels), and not proportional<a id="id55" class="indexterm"/> ones. If we want to use <span class="strong"><strong>proportional coordinates</strong></span>, we have to be inside a <code class="literal">Layout</code> (or an <code class="literal">App</code>) and use the <code class="literal">pos_hint</code> property.</p></div></div><p>We can<a id="id56" class="indexterm"/> also force a <code class="literal">Layout</code> to use fixed values, but there can be conflicts if we are not careful with the properties. If we use any <code class="literal">Layout</code>; <code class="literal">pos_hint</code> and <code class="literal">size_hint</code> take priority. If we want to use fixed positioning properties (<code class="literal">pos</code>, <code class="literal">x</code>, <code class="literal">center_x</code>, <code class="literal">right</code>, <code class="literal">y</code>, <code class="literal">center_y</code>, <code class="literal">top</code>), we have to ensure that we are not using the <code class="literal">pos_hint</code> property. Second, if we want to use the <code class="literal">size</code>, <code class="literal">height</code>, or <code class="literal">width</code> properties, then we need to set a <code class="literal">None</code> value to the <code class="literal">size_hint</code> axis we want to use with absolute values. For example, <code class="literal">size_hint: (None, .10)</code> allows us to use height property, but it keeps the width of 10 percent for the window's size.</p><p>The following table summarizes what we have seen about the positioning and sizing properties. The first and second columns indicate the name of the property and its respective value. The third and fourth column indicate whether it is available for layouts and for widgets.</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Property</p>
</th><th style="text-align: left" valign="bottom">
<p>Value</p>
</th><th style="text-align: left" valign="bottom">
<p>For layouts</p>
</th><th style="text-align: left" valign="bottom">
<p>For widgets</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">size_hint</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>A<a id="id57" class="indexterm"/> pair <code class="literal">w</code>, <code class="literal">h</code>: <code class="literal">w</code>, and <code class="literal">h</code> express a proportion (from <code class="literal">0</code> to <code class="literal">1</code> or <code class="literal">None</code>).</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">size_hint_x</code></strong></span>
</p>
<p>
<span class="strong"><strong><code class="literal">size_hint_y</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>A <a id="id58" class="indexterm"/>proportion from <code class="literal">0</code> to <code class="literal">1</code> or <code class="literal">None</code>, indicating width (<code class="literal">size_hint_x</code>) or <a id="id59" class="indexterm"/>height (<code class="literal">size_hint_y</code>).</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">pos_hint</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Dictionary<a id="id60" class="indexterm"/> with one x-axis key (<code class="literal">x</code>, <code class="literal">center_x</code>, or <code class="literal">right</code>) and one y-axis key (<code class="literal">y</code>, <code class="literal">center_y</code>, or <code class="literal">top</code>). The values are proportions from <code class="literal">0</code> to <code class="literal">1</code>.</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">size</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>A <a id="id61" class="indexterm"/>pair <code class="literal">w</code>, <code class="literal">h</code>: <code class="literal">w</code> and <code class="literal">h</code> indicating fixed width and height in pixels.</p>
</td><td style="text-align: left" valign="top">
<p>Yes, but set <code class="literal">size_hint: (None, None)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">width</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Fixed<a id="id62" class="indexterm"/> number of pixels.</p>
</td><td style="text-align: left" valign="top">
<p>Yes, but set <code class="literal">size_hint_x: None</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">height</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Fixed<a id="id63" class="indexterm"/> number of pixels.</p>
</td><td style="text-align: left" valign="top">
<p>Yes, but set <code class="literal">size_hint_y: None</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">pos</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>A pair <code class="literal">x</code>, <code class="literal">y</code> indicating <a id="id64" class="indexterm"/>a fixed coordinate (<code class="literal">x</code>, <code class="literal">y</code>) in pixels.</p>
</td><td style="text-align: left" valign="top">
<p>Yes, but don't use <code class="literal">pos_hint</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">x, right or center_x</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Fixed<a id="id65" class="indexterm"/> number of pixels.</p>
</td><td style="text-align: left" valign="top">
<p>Yes, but don't use <code class="literal">x, right</code> or <code class="literal">center_x</code> in <code class="literal">pos_hint</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">y, top or center_y</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Fixed<a id="id66" class="indexterm"/> number of pixels.</p>
</td><td style="text-align: left" valign="top">
<p>Yes, but don't use <code class="literal">y, top</code> or <code class="literal">center_y</code> in <code class="literal">pos_hint</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr></tbody></table></div><p>We have<a id="id67" class="indexterm"/> to be careful because some of the properties behave differently depending on the layout we are using. Kivy currently has eight different layouts, which are described in the following table. The left-hand side column shows the name of the Kivy layout class. The right-hand side column describes briefly how they work.</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Layout</p>
</th><th style="text-align: left" valign="bottom">
<p>Details</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">FloatLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Organizes<a id="id68" class="indexterm"/> the widgets with proportional coordinates by the <code class="literal">size_hint</code> and <code class="literal">pos_hint</code> properties. The values are numbers between 0 and 1, indicating a proportion to the window size.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">RelativeLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Operates<a id="id69" class="indexterm"/> in the same way that <code class="literal">FloatLayout</code> does, but the positioning properties (<code class="literal">pos</code>, <code class="literal">x</code>, <code class="literal">center_x</code>, <code class="literal">right</code>, <code class="literal">y</code>, <code class="literal">center_y</code>, <code class="literal">top</code>) are relative to the <code class="literal">Layout</code> size and not the window size.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">GridLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Organizes <a id="id70" class="indexterm"/>widgets in a grid. You have to specify at least one of two properties – <code class="literal">cols</code> (for columns) or <code class="literal">rows</code> (for rows).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">BoxLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Organizes<a id="id71" class="indexterm"/> widgets in one row or one column depending on whether the value of the <code class="literal">orientation</code> property is <code class="literal">horizontal</code> or <code class="literal">vertical</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">StackLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Similar<a id="id72" class="indexterm"/> to <code class="literal">BoxLayout</code>, but it goes to the next row or column when it runs out of space. There is more flexibility to set the <code class="literal">orientation</code>. For example, <code class="literal">rl-bt</code> organizes the widgets in right-to-left, bottom-to-top order. Any combination of <code class="literal">lr</code> (left to right), <code class="literal">rl</code> (right to left), <code class="literal">tb</code> (top to bottom), and <code class="literal">bt</code> (bottom to top) is allowed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">ScatterLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Works<a id="id73" class="indexterm"/> in a similar manner to <code class="literal">RelativeLayout</code> but allows multitouch gesturing for rotating, scaling, and translating. It is slightly different in its implementation, so we will review it later on.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong><code class="literal">PageLayout</code></strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>Stacks<a id="id74" class="indexterm"/> widgets on top of each other, creating a multipage effect that allows flipping of pages using side borders. Very often, we will use another layout to organize elements inside each of the pages, which are simply widgets.</p>
</td></tr></tbody></table></div><p>The Kivy API (<a class="ulink" href="http://kivy.org/docs/api-kivy.html">http://kivy.org/docs/api-kivy.html</a>) offers a detailed explanation and good<a id="id75" class="indexterm"/> examples of each of the layouts. The behavioral difference <a id="id76" class="indexterm"/>of the properties depends on the layout, and it is sometimes unexpected. Here <a id="id77" class="indexterm"/>are some hints that will help us in the GUI building process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">size_hint</code>, <code class="literal">size_hint_x</code>, and <code class="literal">size_hint_y</code> work on all the layouts (except <code class="literal">PageLayout</code>), but the behavior might be different. For example, <code class="literal">GridLayout</code> will try to take an average of the x hints and y hints on the same row or column respectively.</li><li class="listitem" style="list-style-type: disc">You<a id="id78" class="indexterm"/> should use values from 0 to 1 with <code class="literal">size_hint</code>, <code class="literal">size_hint_x</code>, and <code class="literal">size_hint_y</code>. However, you can use values higher than 1. Depending on the layout, Kivy makes the widget bigger than the container or tries to recalculate a proportion based on the sum of the hints on the same axis.</li><li class="listitem" style="list-style-type: disc"><code class="literal">pos_hint</code> only works for <code class="literal">FloatLayout</code>, <code class="literal">RelativeLayout</code>, and <code class="literal">BoxLayout</code>. In <code class="literal">BoxLayout</code>, only the axis-x keys (<code class="literal">x</code>, <code class="literal">center_x</code>, <code class="literal">right</code>) work in the <code class="literal">vertical</code> orientation and vice-versa for the <code class="literal">horizontal</code> orientation. An analogous rule applies for the fixed positioning properties (<code class="literal">pos</code>, <code class="literal">x</code>, <code class="literal">center_x</code>, <code class="literal">right</code>, <code class="literal">y</code>, <code class="literal">center_y</code>, and <code class="literal">top</code>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">size_hint</code>, <code class="literal">size_hint_x</code>, and <code class="literal">size_hint_y</code> can always be set as <code class="literal">None</code> in favor of <code class="literal">size</code>, <code class="literal">width</code>, and <code class="literal">height</code>.</li></ul></div><p>There are more properties and particularities of each layout, but with the ones covered, we will be able to build almost any GUI. In general, the recommendation is to use the layout as it is and, instead of forcing it with the properties we are using, it is better to have more layouts and combine them to reach our goals. The next section will teach us how to embed layouts and will offer more comprehensive examples.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="Embedding layouts"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Embedding layouts</h1></div></div></div><p>Layouts<a id="id79" class="indexterm"/> are subclasses of widgets. We have already been embedding widgets inside widgets since the beginning (line 43) and it won't matter if the widgets we are embedding are also layouts. In this section, we will work with a comprehensive example to explore the effect of the position properties discussed in the previous section. The example is not visually appealing, but it will be useful to illustrate some concepts and to provide some code that you can use to test different properties. The following is the Python code (<code class="literal">layouts.py</code>) for the example:</p><div class="informalexample"><pre class="programlisting">92. # File name: layouts.py
93. from kivy.app import App
94. from kivy.uix.gridlayout import GridLayout
95. 
96. class MyGridLayout(GridLayout):
97.     pass
98. 
99. class LayoutsApp(App):
100. def build(self):
101.      return MyGridLayout()
102. 
103. if __name__=="__main__":
104.     LayoutsApp().run()</pre></div><p>Nothing new in the<a id="id80" class="indexterm"/> preceding code – we just created <code class="literal">MyGridLayout</code>. The final output is shown in the next screenshot, with some indications about the different layouts:</p><div class="mediaobject"><img src="images/B04244_01_04.jpg" alt="Embedding layouts"/><div class="caption"><p>Embedding layouts</p></div></div><p>In this <a id="id81" class="indexterm"/>screenshot, six different Kivy layouts are embedded into a <span class="strong"><strong><code class="literal">GridLayout</code></strong></span> of two rows (line 107) in order to show the behavior of different widget properties. The code is straightforward, although extensive. Therefore, we are going to study the corresponding Kivy language code (<code class="literal">layouts.kv</code>) in five fragments. The following is fragment 1:</p><div class="informalexample"><pre class="programlisting">105. # File name: layouts.kv (Fragment 1)
106. &lt;MyGridLayout&gt;:
107.     rows: 2
108.     FloatLayout:
109.         Button:
110.             text: 'F1'
111.             size_hint: .3, .3
112.             pos: 0, 0
113.     RelativeLayout:
114.         Button:
115.             text: 'R1'
116.             size_hint: .3, .3
117.             pos: 0, 0</pre></div><p>In this<a id="id82" class="indexterm"/> code, <code class="literal">MyGridLayout</code> is defined by the number of rows with<a id="id83" class="indexterm"/> the <span class="strong"><strong><code class="literal">rows</code></strong></span> property (line 107). Then we add the first two layouts – <code class="literal">FloatLayout</code> and <span class="strong"><strong><code class="literal">RelativeLayout</code></strong></span> with one <code class="literal">Button</code> each. Both buttons have <a id="id84" class="indexterm"/>a defined property of <code class="literal">pos: 0, 0</code> (lines 112 and 117) but note in the previous screenshot that the <code class="literal">Button</code> <span class="strong"><strong>F1</strong></span> (line 109) is in the bottom-left corner of the whole window, whereas the <code class="literal">Button</code> <span class="strong"><strong>R1</strong></span> (line 114) is in the bottom-left corner of <code class="literal">RelativeLayout</code>. The reason is that the <code class="literal">pos</code> coordinates in <code class="literal">FloatLayout</code> are not relative to the position of the layout.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>Note that <code class="literal">pos_hint</code> always uses relative coordinates, no matter the layout we are using. In other words, the previous example wouldn't have worked if we were using <code class="literal">pos_hint</code> instead of <code class="literal">pos</code>.</p></div></div><p>In fragment 2, one<a id="id85" class="indexterm"/> <span class="strong"><strong><code class="literal">GridLayout</code></strong></span> is added to <code class="literal">MyGridLayout</code>:</p><div class="informalexample"><pre class="programlisting">118. # File name: layouts.kv (Fragment 2)
119. GridLayout:
120.     cols: 2
121.     spacing: 10
122.     Button:
123.         text: 'G1'
124.         size_hint_x: None
125.         width: 50
126.     Button:
127.         text: 'G2'
126.     Button:
128.         text: 'G3'
129.         size_hint_x: None
130.         width: 50</pre></div><p>In this case, we <a id="id86" class="indexterm"/>use the <span class="strong"><strong><code class="literal">cols</code></strong></span> property to define two columns (line 120) and the <code class="literal">spacing</code> property to separate the internal widgets by 10 pixels from each other (line 121). Also, note in the<a id="id87" class="indexterm"/> previous screenshot that the first column is thinner than the second. We achieved this by setting the <code class="literal">size_hint_x</code> to <code class="literal">None</code> and <code class="literal">width</code> to <code class="literal">50</code> of the buttons <span class="strong"><strong>G1</strong></span> (line 122) and <span class="strong"><strong>G3</strong></span> (line 128).</p><p>In fragment 3, an <a id="id88" class="indexterm"/>
<span class="strong"><strong><code class="literal">AnchorLayout</code></strong></span> is added:</p><div class="informalexample"><pre class="programlisting">131. # File name: layouts.kv (Fragment 3)
132. AnchorLayout:
133.     anchor_x: 'right'
135.     anchor_y: 'top'
136.     Button:
137.         text: 'A1'
138.         size_hint: .5, .5
139.     Button:
140.         text: 'A2'
141.         size_hint: .2, .2 </pre></div><p>We have <a id="id89" class="indexterm"/>specified the <span class="strong"><strong><code class="literal">anchor_x</code></strong></span> property to <code class="literal">right</code> and the <span class="strong"><strong><code class="literal">anchor_y</code></strong></span> property<a id="id90" class="indexterm"/> to <code class="literal">top</code> (line 134 and 135) in order to arrange elements in the top-right corner of the window as shown in the previous screenshot with both buttons (lines 136 and 139). This layout is very useful to embed other layouts inside it, for example, top menu bars or side bars.</p><p>In fragment 4, a <span class="strong"><strong><code class="literal">BoxLayout</code></strong></span> is added:</p><div class="informalexample"><pre class="programlisting">142. # File name: layouts.kv (Fragment 4)
143. BoxLayout:
144.     orientation: 'horizontal'
145.     Button:
146.         text: 'B1'
147.     Button:
148.         text: 'B2'
149.         size_hint: 2, .3
150.         pos_hint: {'y': .4}
151.     Button:
152.         text: 'B3' </pre></div><p>The preceding<a id="id91" class="indexterm"/> code illustrates the use of <code class="literal">BoxLayout</code> with the <span class="strong"><strong><code class="literal">orientation</code></strong></span> property set to <code class="literal">horizontal</code>. Also, the lines 149 and 150 show how to use <code class="literal">size_hint</code> and <code class="literal">pos_hint</code> to move the button <span class="strong"><strong>B2</strong></span> further up.</p><p>Finally, fragment 5 adds a <span class="strong"><strong><code class="literal">StackLayout</code></strong></span>:</p><div class="informalexample"><pre class="programlisting">153. # File name: layouts.kv (Fragment 5)
154. StackLayout:
155.     orientation: 'rl-tb'
156.     padding: 10
157.     Button:
158.         text: 'S1'
159.         size_hint: .6, .2
160.     Button:
161.         text: 'S2'
162.         size_hint: .4, .4
163.     Button:
164.         text: 'S3'
165.         size_hint: .3, .2
166.     Button:
167.         text: 'S4'
168.         size_hint: .4, .3 </pre></div><p>In this<a id="id92" class="indexterm"/> case, we added four buttons of different sizes. It is important to pay attention to the previous screenshot on embedding layouts to understand the rules that we <a id="id93" class="indexterm"/>applied to organize the widgets with the <span class="strong"><strong><code class="literal">orientation</code></strong></span> property set to <code class="literal">rl-tb</code> (right to left, top to bottom, line 155). Also note that<a id="id94" class="indexterm"/> the <span class="strong"><strong><code class="literal">padding</code></strong></span> property (line 156) adds 10 pixels of space between the widgets and the border of <code class="literal">StackLayout</code>.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="PageLayout – swiping pages"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>PageLayout – swiping pages</h1></div></div></div><p>The <span class="strong"><strong><code class="literal">PageLayout</code></strong></span> works in a different manner from other layouts. It is a dynamic layout, in the <a id="id95" class="indexterm"/>sense that it allows flipping through pages using its borders. The<a id="id96" class="indexterm"/> idea is that its components are stacked in front of each other, and we can just see the one that is on top. </p><p>The following example illustrates its use, taking advantage of the example from the previous section. The Python code (<code class="literal">pagelayout.py</code>) is presented here:</p><div class="informalexample"><pre class="programlisting">169. # File name: pagelayout.py
170. import kivy
171. 
172. from kivy.app import App
173. from kivy.uix.pagelayout import PageLayout
174. 
175. class MyPageLayout(PageLayout):
176.     pass
177. 
178. class PageLayoutApp(App):
179.     def build(self):
180.         return MyPageLayout()
181. 
182. if __name__=="__main__":
183.     PageLayoutApp().run()</pre></div><p>There is nothing new in this code except the use of the <code class="literal">PageLayout</code> class. For the Kivy language code (<code class="literal">pagelayout.kv</code>), we will study the properties of <code class="literal">PageLayout</code>. We have simply modified the <code class="literal">layouts.kv</code> studied in the previous section by changing the header of the file (lines 105 to 107), now called <code class="literal">pagelayout.kv</code>:</p><div class="informalexample"><pre class="programlisting">184. # File name: pagelayout.kv
185. &lt;Layout&gt;:
186.     canvas:
187.         Color:
188.             rgba: 1, 1, 1, 1
189.         Rectangle:
190.             pos: self.pos
191.             size: self.size
192. 
193. &lt;MyPageLayout&gt;:
194.     page: 3
195.     border: 120 
196.     swipe_threshold: .4
197.     FloatLay...</pre></div><p>All the <a id="id97" class="indexterm"/>layouts inherit from a base class called <code class="literal">Layout</code>. In line 185, we <a id="id98" class="indexterm"/>are modifying this base class in the same way we did earlier with the <code class="literal">Button</code> class (line 80).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>If we want to apply changes to all the child widgets that have a common base class (such as <code class="literal">Layout</code>), we can introduce those changes in the base class. Kivy will apply the changes to all the classes that derive from it.</p></div></div><p>By default, layouts don't have a background color, which is not convenient when <code class="literal">PageLayout</code> stacks them on top of each other, because we can see the elements of the layouts on the bottom. Lines 186 to 191 will draw a white (line 187 and 188) rectangle of the size (line 190) and position (line 191) of the <code class="literal">Layout</code>. In order to do this, we need to use the <span class="strong"><strong><code class="literal">canvas</code></strong></span>, which<a id="id99" class="indexterm"/> allows us to draw shapes directly on the screen. This topic will be explained in-depth in the next chapter (<a class="link" href="ch02.html" title="Chapter 2. Graphics – the Canvas">Chapter 2</a>, <span class="emphasis"><em>Graphics - The Canvas</em></span>). You can see the result in the following screenshot:</p><div class="mediaobject"><img src="images/B04244_01_05.jpg" alt="PageLayout – swiping pages"/></div><p>If you run the code on your computer, you will notice that it will take you to the page corresponding to <code class="literal">AnchorLayout</code> in the example of the previous section. The reason is that we set the <span class="strong"><strong><code class="literal">page</code></strong></span> property to value <code class="literal">3</code> (line 194). Counting from <code class="literal">0</code>, this property tells Kivy <a id="id100" class="indexterm"/>which page to display first. The <span class="strong"><strong><code class="literal">border</code></strong></span> property tells Kivy how <a id="id101" class="indexterm"/> wide the side borders are (for sliding to the previous<a id="id102" class="indexterm"/> or the next screen). Finally, <span class="strong"><strong><code class="literal">swipe_threshold</code></strong></span> tells the<a id="id103" class="indexterm"/> percentage of the screen that we have to slide over, in <a id="id104" class="indexterm"/>order to change the page. The next section will use some of the layouts and properties learned so far to display a more professional screen.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="Our project – Comic Creator"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Our project – Comic Creator</h1></div></div></div><p>We now <a id="id105" class="indexterm"/>have all the necessary concepts to be able to create any interface we want. This section describes the project that we will improve on, as we go through the following three chapters – the <span class="emphasis"><em>Comic Creator</em></span>. The basic idea of the project is a simple <a id="id106" class="indexterm"/>application to draw a stickman. The following screenshot is a sketch (wireframe) of the GUI we are aiming for:</p><div class="mediaobject"><img src="images/B04244_01_06.jpg" alt="Our project – Comic Creator"/></div><p>We can distinguish several areas in the sketch. First, we need a <span class="emphasis"><em>drawing space</em></span> (top-right) for our comics. We need a <span class="emphasis"><em>tool box</em></span> (top-left) with some drawing tools to draw our figures and also some <span class="emphasis"><em>general options</em></span> (second from bottom to top) – clear the screen, remove the last element, group <a id="id107" class="indexterm"/>elements, change color, and use the gestures mode. Finally, it would be useful to have a <span class="emphasis"><em>status bar</em></span> (center-bottom) to provide some information to the user – number of figures and last action performed. According to what we have learned in this chapter, there are multiple solutions to organize this <a id="id108" class="indexterm"/>screen. We will use the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AnchorLayout</code> for the <span class="emphasis"><em>tool box</em></span> area in the top-left corner. Inside it will be a <code class="literal">GridLayout</code> of two columns for the <span class="emphasis"><em>drawing tools</em></span>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">AnchorLayout</code> for the <span class="emphasis"><em>drawing space</em></span> in the top-right corner. Inside it will be a <code class="literal">RelativeLayout</code> to have a relative space to draw in.</li><li class="listitem" style="list-style-type: disc"><code class="literal">AnchorLayout</code> for the <span class="emphasis"><em>general options</em></span> and <span class="emphasis"><em>status bar</em></span> area at the bottom. Inside it will be a <code class="literal">BoxLayout</code> with vertical orientation to organize the <span class="emphasis"><em>general options</em></span> on top of the <span class="emphasis"><em>status bar</em></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">BoxLayout</code> with <a id="id109" class="indexterm"/>horizontal orientation for the buttons of the <span class="emphasis"><em>general options</em></span>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">BoxLayout</code> with horizontal orientation for the labels of the <span class="emphasis"><em>status bar</em></span>.</li></ul></div></li></ul></div><p>We are going to use that structure by creating different files for each area – <code class="literal">comiccreator.py</code>, <code class="literal">comiccreator.kv</code>, <code class="literal">toolbox.kv</code>, <code class="literal">generaltools.kv</code>, <code class="literal">drawingspace.kv</code>, and <code class="literal">statusbar.kv</code>. Let's start with <code class="literal">comiccreator.py</code>:</p><div class="informalexample"><pre class="programlisting">198. # File name: comiccreator.py
199. from kivy.app import App
200. from kivy.lang import Builder
201. from kivy.uix.anchorlayout import AnchorLayout
200. 
201. Builder.load_file('toolbox.kv')
202. Builder.load_file('drawingspace.kv')
203. Builder.load_file('generaloptions.kv')
204. Builder.load_file('statusbar.kv')
205. 
206. class ComicCreator(AnchorLayout):
207.     pass
208. 
209. class ComicCreatorApp(App):
210. def build(self):
211.         return ComicCreator()
212. 
213. if __name__=="__main__":
214.     ComicCreatorApp().run()</pre></div><p>Note that <a id="id110" class="indexterm"/>we are explicitly loading some of the files with the <code class="literal">Builder.load_file</code> instruction (lines 203 to 206). There is no need to explicitly load <code class="literal">comiccreator.kv</code> because Kivy automatically loads it by extracting the first part of the <code class="literal">ComicCreatorApp</code> name. For <code class="literal">ComicCreator</code>, we choose <code class="literal">AnchorLayout</code>. It is not the only option, but it gives clarity to the code, because the second level<a id="id111" class="indexterm"/> is also composed of <code class="literal">AnchorLayout</code> instances.</p><p>Even though using a simple widget would have been clear, it is not possible, because the <code class="literal">Widget</code> class doesn't honor the <code class="literal">size_hint</code> and <code class="literal">pos_hint</code> properties that are necessary in the <code class="literal">AnchorLayout</code> internals.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>Remember that only layouts honor the <code class="literal">size_hint</code> and <code class="literal">pos_hint</code> properties.</p></div></div><p>Here is the code for <code class="literal">comiccreator.kv</code>:</p><div class="informalexample"><pre class="programlisting">216. # File name: comiccreator.kv
217. &lt;ComicCreator&gt;:
218.     AnchorLayout:
219.         anchor_x: 'left'
220.         anchor_y: 'top'
221.         ToolBox:
222.             id: _tool_box
223.             size_hint: None, None
224.             width: 100
225.     AnchorLayout:
226.         anchor_x: 'right'
227.         anchor_y: 'top'
228.         DrawingSpace:
229.             size_hint: None, None
230.             width: root.width - _tool_box.width
231.             height: root.height - _general_options.height - _status_bar.height
232.     AnchorLayout:
233.         anchor_x: 'center'
234.         anchor_y: 'bottom'
235.         BoxLayout:
236.             orientation: 'vertical'
237.             GeneralOptions:
238.                 id: _general_options
239.                 size_hint: 1,None
240.                 height: 48
241.             StatusBar:
242.                 id: _status_bar
243.                 size_hint: 1,None
244.                 height: 24</pre></div><p>This code <a id="id112" class="indexterm"/>follows the previously presented structure for the <span class="emphasis"><em>Comic Creator</em></span>. There are basically three <code class="literal">AnchorLayout</code> instances in the first level (lines 219, 226, and 233) and a <code class="literal">BoxLayout</code> that organizes the <span class="emphasis"><em>general options</em></span> and the <span class="emphasis"><em>status bar</em></span> (line 236).</p><p>We set the width of the <code class="literal">ToolBox</code> to 100 pixels and the height of the <code class="literal">GeneralOptions</code> and <code class="literal">StatusBar</code> to 48 and 24 pixels respectively (lines 241 and 245). This brings with it an interesting problem – the <span class="emphasis"><em>drawing space</em></span> should use the remaining width and height of the screen (no matter the screen size). In order to achieve this, we will take advantage of the Kivy <span class="strong"><strong>id</strong></span> (lines 223, 239, and 243), which allows us to refer to other components inside the Kivy language. On lines 231 and 232, we subtract <code class="literal">tool_box.width</code> from <code class="literal">root.width</code> (line 231) and <code class="literal">general_options.height</code> and <code class="literal">status_bar.height</code> from <code class="literal">root.height</code> (line 232).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>A Kivy <span class="strong"><strong>id</strong></span> allows<a id="id113" class="indexterm"/> us to create internal variables in order to access properties of other widgets inside the Kivy language rules.</p></div></div><p>For now, let's continue exploring the Kivy language in the <code class="literal">toolbox.kv</code>:</p><div class="informalexample"><pre class="programlisting">245. # File name: toolbox.kv
246. &lt;ToolButton@ToggleButton&gt;:
247.     size_hint: None, None
248.     size: 48,48
249.     group: 'tool'
250. 
251. &lt;ToolBox@GridLayout&gt;:
252.     cols: 2
253.     padding: 2
254.     ToolButton:
255.         text: 'O'
256.     ToolButton:
257.         text: '/'
258.     ToolButton:
259.         text: '?'</pre></div><p>We <a id="id114" class="indexterm"/>created a <code class="literal">ToolButton</code> class that defines the size of the drawing tools and also introduces a new Kivy widget – <span class="strong"><strong><code class="literal">ToggleButton</code></strong></span>. The difference with the normal <code class="literal">Button</code> is that it stays pressed until we click on it again. The following is an example of the <span class="emphasis"><em>tool box</em></span> with a <code class="literal">ToolButton</code> activated:</p><div class="mediaobject"><img src="images/B04244_01_07.jpg" alt="Our project – Comic Creator"/></div><p>A <code class="literal">ToggleButton</code> instance can be associated with other <code class="literal">ToggleButton</code> instances, so just one of <a id="id115" class="indexterm"/>them is clicked on at a time. We can achieve this <a id="id116" class="indexterm"/>by assigning the same <span class="strong"><strong><code class="literal">group</code></strong></span> property (line 250) to the <code class="literal">ToggleButton</code> instances that we want to react together. In this case, we want all the instances of <code class="literal">ToolButton</code> belonging to the same group, because we want to draw just one figure at a time; we make it part of the class definition (line 247).</p><p>On line 252, we implement <code class="literal">ToolBox</code> as a subclass of <code class="literal">GridLayout</code> and we add some character placeholders (<code class="literal">'O'</code>, <code class="literal">'/'</code>, and <code class="literal">'?'</code>) to the <code class="literal">ToolButton</code> instances that we will substitute for something more appropriate in the following chapters.</p><p>The following is the code for <code class="literal">generaloptions.kv</code>:</p><div class="informalexample"><pre class="programlisting">260. # File name: generaloptions.kv
261. &lt;GeneralOptions@BoxLayout&gt;:
262.     orientation: 'horizontal'
263.     padding: 2
264.     Button:
265.         text: 'Clear'
266.     Button:
267.         text: 'Remove'
268.     ToggleButton:
269.         text: 'Group'
268.     Button:
270.         text: 'Color'
271.     ToggleButton:
272.         text: 'Gestures'</pre></div><p>Here is an example of how inheritance can help us separate our components. We are using <code class="literal">ToggleButton</code> instances (lines 269 and 273), and they are not affected by the previous <code class="literal">ToolButton</code> implementation. Also, we didn't associate them to any <code class="literal">group</code>, so they are independent of each other and will just keep a mode or state. The code only defines the <code class="literal">GeneralOptions</code> class following our initial structure. The following is the resulting screenshot:</p><div class="mediaobject"><img src="images/B04244_01_08.jpg" alt="Our project – Comic Creator"/></div><p>The <code class="literal">statusbar.kv</code> file is<a id="id117" class="indexterm"/> very similar in the way it uses <code class="literal">BoxLayout</code>:</p><div class="informalexample"><pre class="programlisting">274. # File name: statusbar.kv
275. &lt;StatusBar@BoxLayout&gt;:
276.     orientation: 'horizontal'
277.     Label:
278.         text: 'Total Figures: ?'
279.     Label:
280.         text: "Kivy started"</pre></div><p>The difference is that it organizes labels and not buttons. The following is the screenshot:</p><div class="mediaobject"><img src="images/B04244_01_09.jpg" alt="Our project – Comic Creator"/></div><p>Finally, the code for <code class="literal">drawingspace.kv</code>:</p><div class="informalexample"><pre class="programlisting">281. # File name: drawingspace.kv
282. &lt;DrawingSpace@RelativeLayout&gt;:
283.     Label:
284.         markup: True
285.         text: '[size=32px][color=#3e6643]The[/color] [sub]Comic[/sub] [i][b]Creator[/b][/i][/size]'</pre></div><p>Apart from defining that <code class="literal">DrawingSpace</code> is a subclass of <code class="literal">RelativeLayout</code>, we introduce the Kivy <span class="strong"><strong><code class="literal">markup</code></strong></span>, a <a id="id118" class="indexterm"/>nice feature for styling the text of the <code class="literal">Label</code> class. It works in a similar manner to XML-based languages. For example, in HTML, <code class="literal">&lt;b&gt;I am bold&lt;/b&gt;</code> would specify bold text. First, you have to activate it (line 285) and then you just embed the text you want to style between <code class="literal">[tag]</code> and <code class="literal">[/tag]</code> (line 286). You can <a id="id119" class="indexterm"/>find the complete tag list and description in the Kivy API, in the documentation for <code class="literal">Label</code> (<a class="ulink" href="http://kivy.org/docs/api-kivy.uix.label.html">http://kivy.org/docs/api-kivy.uix.label.html</a>). In the previous example, <code class="literal">size</code> and <code class="literal">color</code> are self-explanatory; <code class="literal">sub</code> refers to subindexed text; <code class="literal">b</code> to bold; and <code class="literal">i</code> to italics. </p><p>Here is the screenshot that shows the GUI of our project:</p><div class="mediaobject"><img src="images/B04244_01_10.jpg" alt="Our project – Comic Creator"/></div><p>In the <a id="id120" class="indexterm"/>following chapters, we are going to add the respective functionality to this interface that, for now, consists of placeholder widgets. However, it is exciting what we got with just a few lines of code. Our GUI is ready to go and we will be working on its logic from now on.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Summary</h1></div></div></div><p>This chapter covered all the basics and introduced some not-so-basic concepts of Kivy. We covered how to configure classes, instances, and templates. Here is a list of Kivy elements we have learned to use in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Basic widgets – <code class="literal">Widget</code>, <code class="literal">Button</code>, <code class="literal">ToggleButton</code>, and <code class="literal">Label</code></li><li class="listitem" style="list-style-type: disc">Layouts – <code class="literal">FloatLayout</code>, <code class="literal">RelativeLayout</code>, <code class="literal">BoxLayout</code>, <code class="literal">GridLayout</code>, <code class="literal">StackLayout</code>, <code class="literal">AnchorLayout</code>, and <code class="literal">PageLayout</code></li><li class="listitem" style="list-style-type: disc">Properties – <code class="literal">pos</code>, <code class="literal">x</code>, <code class="literal">y</code>, <code class="literal">center_x</code>, <code class="literal">center_y</code>, <code class="literal">top</code>, <code class="literal">right</code>, <code class="literal">size</code>, <code class="literal">height</code>, <code class="literal">width</code>, <code class="literal">pos_hint</code>, <code class="literal">size_hint</code>, <code class="literal">group</code>, <code class="literal">spacing</code>, <code class="literal">padding</code>, <code class="literal">color</code>, <code class="literal">text</code>, <code class="literal">font_size</code>, <code class="literal">cols</code>, <code class="literal">rows</code>, <code class="literal">orientation</code>, <code class="literal">anchor_x</code>, and <code class="literal">anchor_y</code></li><li class="listitem" style="list-style-type: disc">Variables – <code class="literal">self</code> and <code class="literal">root</code></li><li class="listitem" style="list-style-type: disc">Others – <code class="literal">id</code> and the markup tags <code class="literal">size</code>, <code class="literal">color</code>, <code class="literal">b</code>, <code class="literal">i</code>, and <code class="literal">sub</code></li></ul></div><p>There are many more elements from the Kivy language that we can use, but with this chapter, we have understood the general idea of how to organize elements. With the help of the Kivy API, we should be able to display most of the elements available for GUI design. There is, however, a very important element we need to study separately – the <code class="literal">canvas</code>, which allows us to draw vector shapes inside widgets, such as the white rectangle we draw as background in the <code class="literal">PageLayout</code> example. It is a very important topic to master in Kivy, and the entire next chapter, <span class="emphasis"><em>Graphics - The Canvas</em></span>, will be dedicated to it.</p></div></div>
</body></html>