<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Storing Data in Our MySQL Database via Our GUI</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will learn how to install and use a MySQL database and connect it to our GUI.</p>
<p>MySQL is a full-fledged <strong>Structured<span> Query </span>Language</strong> (<strong>SQL</strong>) database server and comes with a very nice GUI of its own so that we can view and work with the data. We will create a database, insert data into our database, and then see how we can modify, read, and delete data.</p>
<p>Data storage in a SQL database is essential for software programs written in Python. All of our data currently only exists in memory and we want to make it persistent so that we do not lose our data once we close our running Python program.</p>
<p>Here, you will learn how to increase your programming skills by adding SQL to your programming toolbox.</p>
<div class="packt_infobox">The first recipe in this chapter will show you how to install the free MySQL Community Edition.</div>
<p class="mce-root">After successfully connecting to a running instance of our MySQL server, we will design and create a database that will accept a book title, which could be our own journal or a quote we found somewhere on the internet. We will require a page number for the book, which could be blank (<kbd>NULL</kbd> in SQL terms), and then we will <kbd>insert</kbd> the quote we like from a book, journal, website, or a friend into our MySQL database using our GUI, which we built using Python 3.7 or later.</p>
<p>We will insert, modify, delete, and display our favorite quotes using our Python GUI to issue these SQL commands and to display the data.</p>
<div class="packt_infobox"><strong>CRUD</strong> is a database term you may have come across before that is an abbreviation for the four basic SQL commands, that is, <strong>Create</strong>, <strong>Read</strong>, <strong>Update</strong>, and <strong>Delete</strong>.</div>
<p>Here is an overview of the Python modules for this chapter:</p>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="Images/091c7ddf-a884-48d2-9c64-6a1670500746.png" style="width:17.25em;height:18.33em;" width="223" height="236"/></div>
<p>In this chapter, we will enhance our Python GUI by connecting the GUI to a MySQL database. We will cover the following recipes:</p>
<ul>
<li>Installing and connecting to a MySQL server from Python</li>
<li>Configuring the MySQL database connection</li>
<li>Designing the Python GUI database</li>
<li>Using the SQL INSERT command</li>
<li>Using the SQL UPDATE command</li>
<li>Using the SQL DELETE command</li>
<li>Storing and retrieving data from our MySQL database</li>
<li>Using MySQL Workbench</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Installing and connecting to a MySQL server from Python </h1>
                </header>
            
            <article>
                
<p>Before we can connect to a MySQL database, we have to connect to the <em>MySQL server</em>. In order to do this, we need to know the IP address of the MySQL server as well as the port it is listening on.</p>
<p>We also have to be a registered user with a password in order to be <em>authenticated</em> by the MySQL server.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You will need to have access to a running MySQL server instance, as well as have administrator privileges in order to create databases and tables. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p><span>Let's look at how to install and c</span>onnect to a MySQL s<span>erver</span><span> </span>from Python:</p>
<ol>
<li><span>Download the MySQL Installer.</span></li>
</ol>
<div class="packt_infobox">There is a free MySQL Community Edition available from the official MySQL website. You can download and install it on your local PC from <a href="http://dev.mysql.com/downloads/windows/installer/">http://dev.mysql.com/downloads/windows/installer/</a>.</div>
<p class="mce-root"/>
<ol start="2">
<li>Run the installation:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="Images/6bd7fce8-d50d-4c4f-bab1-3cb1945e0e29.png" style="width:48.83em;height:32.08em;" width="951" height="626"/></div>
<ol start="3">
<li>Choose a password for the <kbd>root</kbd> user and, optionally, add more users:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="Images/db517531-4e77-4790-8d75-fcb2631d2f56.png" style="width:36.17em;height:26.42em;" width="556" height="407"/></div>
<ol start="4">
<li>Verify that you have the <kbd>\Python37\Lib\site-packages\mysql\connector</kbd> folder:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/d083fd30-4b6b-46c9-9a0a-6ff232363cfa.png" style="width:31.83em;height:14.50em;" width="457" height="208"/></div>
<ol start="5">
<li>Open the <kbd>mysqlsh.exe</kbd> executable and double-click on it to run it:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1bea928e-099f-48f6-a50d-2f50385a75d9.png" style="width:40.08em;height:19.50em;" width="766" height="372"/></p>
<ol start="6">
<li>Type <kbd>\sql</kbd> in<span> the prompt to get into</span> <kbd>SQL</kbd> <span>mode.</span></li>
<li>In the <kbd>MySql&gt;</kbd> prompt, type <kbd>SHOW DATABASES</kbd>. Then, press <em>Enter</em>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/c82df31f-8056-439b-9bfc-ea9814ecddf9.png" style="width:34.83em;height:27.75em;" width="610" height="486"/></div>
<ol start="8">
<li>Create a new Python module and save it as <kbd>MySQL_connect.py</kbd>:</li>
</ol>
<pre style="padding-left: 60px">import mysql <br/>conn = mysql.connector.connect(user=&lt;adminUser&gt;, password=&lt;adminPwd&gt;, host='127.0.0.1') <br/>print(conn) <br/>conn.close()</pre>
<ol start="9">
<li>If running the preceding code results in the following output, then we have successfully connected:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/20469916-e961-456b-b486-3ece472ff007.png" width="573" height="77"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>First, we downloaded and then installed the MySQL version that matches our operating system.</p>
<div class="packt_tip"><span>During the installation process, you will choose a password for the </span><kbd>root</kbd><span> user, and you can also add more users. I recommend that you add yourself as a </span><span class="packt_screen">DB Admin</span><span> and choose a password as well.</span></div>
<p>In this chapter, we are using the latest MySQL Community Server release, that is, 8.0.16.</p>
<div class="packt_infobox"><strong>SQL</strong><span> stands for </span><strong>Structured Query Language</strong><span> and is sometimes pronounced </span><strong>sequel</strong><span>. </span><span>It uses a <strong>Set</strong> mathematical approach, which is based on mathematics and <strong>set theory</strong>. You can find out more at <a href="https://en.wikipedia.org/wiki/Set_theory">https://en.wikipedia.org/wiki/Set_theory</a>.</span></div>
<p>In order to connect to MySQL, we may need to install a special Python connector driver. This driver will allow us to talk to the MySQL server from Python. There is a freely available driver on the MySQL website (<a href="http://dev.mysql.com/doc/connector-python/en/index.html">http://dev.mysql.com/doc/connector-python/en/index.html</a>) and it comes with a very nice online tutorial.</p>
<div class="packt_tip">When I did a brand new installation of the latest version of MySQL, the Python connector was automatically installed. Therefore, you may not have to install it after all. It is good to know, though, just in case you run into any issues and need to install it yourself.</div>
<p>One way to verify that we have installed the correct driver and that it lets Python talk to MySQL is by looking into the Python<span> </span><kbd>site-packages</kbd><span> </span>directory. If your<span> </span><kbd>site-packages</kbd><span> </span>directory has a new<strong> <kbd>MySQL</kbd></strong> folder that contains a <kbd>connector</kbd> subfolder, the installation was successful. We did this in <em>step 4</em>.</p>
<p><span>In <em>step 5</em>, we verified that our MySQL server installation actually worked by using the</span> MySQL Shell<em>.</em></p>
<div class="packt_infobox"><span>Your path might be different, especially if you are on macOS or Linux: <kbd>&lt;path to&gt;\Program Files\MySQL\MySQL Shell 8.0\bin</kbd></span><span>.</span></div>
<p>Next, we verified that we can achieve the same results using Python 3.7.</p>
<div class="packt_infobox">Replace the placeholder bracketed names, that is,<span> </span><kbd>&lt;adminUser&gt;</kbd><span> </span>and<span> </span><kbd>&lt;adminPwd&gt;</kbd><span>, </span>with the real credentials you are using in your MySQL installation.</div>
<p>We have to be able to connect to the MySQL server. By default, we are in JavaScript <kbd>JS</kbd> mode. We can change that by typing <kbd>\sql</kbd> in the prompt to get into <kbd>SQL</kbd> mode. Now, we can use <kbd>SQL</kbd> commands. <span>We did this in <em>steps 6</em> and <em>7</em>.</span></p>
<p>If you are unable to connect to the MySQL server via the<span> </span><em>Command Shell</em><span> </span>or the Python<span> </span><kbd>mysqlclient</kbd>, then something probably went wrong during the installation. If this is the case, try uninstalling MySQL, rebooting your PC, and then running the installation again.</p>
<p>In order to connect our GUI to a MySQL server, we need to be able to connect to the server with administrative privileges. We also need to do this if we want to create our own database. If the database already exists, then we just need the authorization rights to connect, insert, update, and delete data. We will create a new database on a MySQL server in the next recipe.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring the MySQL database connection</h1>
                </header>
            
            <article>
                
<p>In the previous recipe, we used the shortest way to connect to a MySQL server, that is, by hardcoding the credentials that are required for authentication in the <kbd>connect</kbd> method. While this is a fast approach for early development, we definitely do not want to expose our MySQL server credentials to anyone. Instead, we want to <em>grant</em> permission to specific users so that they can access databases, tables, views, and related database commands.</p>
<p>A much safer way to be authenticated by a MySQL server is by storing the credentials in a configuration file, which is what we will do in this recipe. We will use our configuration file to connect to the MySQL server and then create our own database on the MySQL server.</p>
<div class="packt_infobox">We will use this database in all of the recipes in this chapter.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Access to a running MySQL server with administrator privileges is required to run the code shown in this recipe.</p>
<div class="packt_infobox">The previous recipe shows how <span class="InformationBoxPACKTChar">to</span> install the free <em>Community Edition</em> of <span class="InformationBoxPACKTChar">MySQL</span> server. The administrator privileges will allow you to implement this recipe.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p>Let's look at how to perform this recipe:</p>
<ol>
<li class="mce-root">First, we will create a dictionary in the same module where the <kbd>MySQL_connect<span><span>.py</span></span></kbd> code is. Sequentially, we will do the following:
<ol>
<li class="mce-root">Open <kbd>MySQL_connect.py</kbd> and save it as <kbd>MySQL_connect_with_dict.py</kbd>.</li>
<li>Add the following code to the module:</li>
</ol>
</li>
</ol>
<pre style="padding-left: 120px"># create dictionary to hold connection info <br/>dbConfig = { <br/>    'user': &lt;adminName&gt;,      # use your admin name<br/>    'password': &lt;adminPwd&gt;,   # use your real password <br/>    'host': '127.0.0.1',      # IP address of localhost <br/>}</pre>
<ol start="2">
<li>Write the following code below <kbd>dbConfig</kbd>:</li>
</ol>
<pre style="padding-left: 60px">import mysql.connector <br/># unpack dictionary credentials<br/>conn = mysql.connector.connect(**dbConfig) <br/>print(conn)</pre>
<ol start="3">
<li>Run the code to make sure it works.</li>
<li>Create a new module, <kbd>GuiDBConfig.py</kbd>, and place the following code in it:</li>
</ol>
<pre style="padding-left: 60px"># create dictionary to hold connection info<br/>dbConfig = {<br/>            'user': &lt;adminUser&gt;,       # your user name<br/>            'password': &lt;adminPwd&gt;,    # your password<br/>            'host': '127.0.0.1',       # IP address<br/> }</pre>
<ol start="5">
<li>Now, open <kbd>MySQL_connect_with_dict.py</kbd><span> </span><span>and save it as </span><kbd>MySQL_connect_import_dict.py</kbd><span>.</span></li>
<li>Import <kbd><span>GuiDBConfig</span></kbd> and unpack the dictionary, as shown here:</li>
</ol>
<pre style="padding-left: 60px">import GuiDBConfig as guiConf <br/># unpack dictionary credentials<br/>conn = mysql.connector.connect(**guiConf.dbConfig) <br/>print(conn)</pre>
<ol start="7">
<li>Create a new Python module and save it as <kbd>MySQL_create_DB.py</kbd>. Next, a<span>dd the following code:</span></li>
</ol>
<pre style="padding-left: 60px">import mysql.connector <br/>import Ch07_Code.GuiDBConfig as guiConf <br/><br/>GUIDB = 'GuiDB' <br/><br/># unpack dictionary credentials<br/>conn = mysql.connector.connect(**guiConf.dbConfig) <br/><br/>cursor = conn.cursor() <br/><br/>try: <br/>    cursor.execute("CREATE DATABASE {} <br/>                    DEFAULT CHARACTER SET 'utf8'".format(GUIDB)) <br/>except mysql.connector.Error as err: <br/>    print("Failed to create DB: {}".format(err)) <br/><br/>conn.close()</pre>
<ol start="8">
<li>Execute <kbd>MySQL_create_DB.py</kbd> twice:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="Images/e64575b2-bc11-4b77-bbcc-dc9b4bb8ae77.png" style="width:38.92em;height:5.42em;" width="589" height="82"/></div>
<ol start="9">
<li>Create a new Python module and save it as <kbd>MySQL_show_DBs.py</kbd>. Then, add the following code:</li>
</ol>
<pre style="padding-left: 60px">import mysql.connector <br/>import GuiDBConfig as guiConf <br/><br/># unpack dictionary credentials<br/>conn = mysql.connector.connect(**guiConf.dbConfig) <br/><br/>cursor = conn.cursor() <br/><br/>cursor.execute("SHOW DATABASES") <br/>print(cursor.fetchall()) <br/><br/>conn.close()</pre>
<ol start="10">
<li>Running the preceding code gives us the following output:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/7fbef986-163d-4f9e-83e3-7a344e6aa673.png" style="width:49.08em;height:5.08em;" width="793" height="82"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p><span>First, we created a dictionary and saved our connection credentials in the Python dictionary.</span></p>
<p>Next, in the <kbd>connect</kbd> method, we unpacked the dictionary values. Take a look at the following code:</p>
<pre>mysql.connector.connect('user': &lt;adminName&gt;, 'password': &lt;adminPwd&gt;, 'host': '127.0.0.1')</pre>
<p>Instead of using this code, we use<span> </span><kbd>(**dbConfig)</kbd>, which achieves the same thing but is shorter.</p>
<p>This results in the same successful connection to the MySQL server, but the difference is that the connection method no longer exposes any mission-critical information.</p>
<div class="packt_infobox">A database server is critical to your mission. You will realize this once you have lost your valuable data and can't find any recent backup!</div>
<p>Please note that placing the same username, password, database, and so on into a dictionary in the same Python module does not eliminate the risk of having the credentials seen by anyone perusing the code.</p>
<p>In order to increase database security, we had to move the dictionary into its own Python module. We called the new Python module<span> </span><kbd>GuiDBConfig.py</kbd>.</p>
<p>We then imported this module and unpacked the credentials, as we did previously. </p>
<div class="packt_infobox">Once we placed this module into a secure place, separated from the rest of the code, we achieved a better level of security for our MySQL data.</div>
<p>Now that we know how to connect to MySQL and have administrator privileges, we could create our own database by issuing SQL commands.</p>
<p>In order to execute commands to MySQL, we created a cursor object from the connection object.</p>
<p>A cursor is usually a pointer to a specific row in a database table that we can move up or down the table, but here, we used it to create the database itself. We wrapped the Python code into a<span> </span><kbd>try...except</kbd><span> </span>block and used the built-in error codes of MySQL to tell us if anything went wrong.</p>
<p>We can verify that this block works by executing the database-creating code twice. The first time, it will create a new database in MySQL, and the second time, it will print out an error message stating that this database already exists.</p>
<p><span>We can verify which databases exist by executing the <kbd>SHOW DATABASES</kbd> command using the very same cursor object syntax. Instead of issuing the </span><kbd>CREATE DATABASE</kbd><span> command, we create a cursor and use it to execute the </span><kbd>SHOW DATABASES</kbd><span> command, the result of which we fetch and print to the console output.</span></p>
<div class="packt_infobox">We retrieve the results by calling the<span> </span><kbd>fetchall</kbd><span> </span>method on the cursor object.</div>
<p>Running the <kbd><span>MySQL_show_DBs.py</span></kbd> code shows us which databases currently exist in our MySQL server instance. As we saw from the output, MySQL ships with several built-in databases, such as<span> </span><kbd>information_schema</kbd>. We successfully created our own<span> </span><kbd>guidb</kbd><span> </span>database, which is shown in the output. All of the other databases that were illustrated come shipped with MySQL.</p>
<p><span>Note how, even though we specified the database when we created it in mixed-case letters as</span> GuiDB<span>, the </span><kbd>SHOW DATABASES</kbd><span> command shows all the existing databases in MySQL in lowercase and displays our database as </span><kbd>guidb</kbd><span>.</span></p>
<div class="packt_infobox">The physical MySQL files are stored on the hard drive according to the <kbd>my.ini</kbd> file, which, on a Windows 10 installation, may be located at <kbd>C:\ProgramData\MySQL\MySQL Server 8.0</kbd>. Within this <kbd>.ini</kbd> file, you can find the following configuration path to the <kbd>Data</kbd> folder: <br/>
<br/>
<kbd># Path to the database root</kbd><br/>
<kbd>datadir=C:/ProgramData/MySQL/MySQL Server 8.0/Data</kbd></div>
<p class="mce-root">Let's move on to the next recipe.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing the Python GUI database</h1>
                </header>
            
            <article>
                
<p>Before we start creating tables and inserting data into them, we have to design the database. Unlike changing local Python variable names, changing a database <kbd>schema</kbd> once it has been created and loaded with data is not that easy.</p>
<p>We would have to <kbd>DROP</kbd> the table, which means we would lose all the data that was in the table. So, before dropping a table, we would have to extract the data, save the data in a temporary table or other data format, and then <kbd>DROP</kbd> the table, recreate it, and finally reimport the original data.</p>
<p>I hope you are getting the picture of how tedious this could be.</p>
<p>Designing our GUI MySQL database means that we need to think about what we want our Python application to do with it and then choose names for our tables that match the intended purpose.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We will be working with the MySQL database we created in the previous recipe, <em>Configuring the MySQL database connection</em>. A running instance of MySQL is necessary and the two previous recipes show you how to install MySQL, all the necessary additional drivers, and how to create the database we are using in this chapter.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p><span><span>In this recipe, we</span></span> are starting with the <span><kbd>GUI_TCP_IP.py</kbd> file from the previous chapter.</span> We will move the widgets from our Python GUI between the two tabs we created in the previous recipes in order to organize our Python GUI so that it can connect to a MySQL database. <span>Let's take a look at how can we complete this recipe:</span></p>
<ol>
<li>Open <kbd>GUI_TCP_IP.py</kbd> and save it as <kbd><span>GUI_MySQL.py</span></kbd><span>.</span></li>
<li>Download the full code from the Packt website. </li>
<li>Use a tool such as WinMerge to compare the two versions of the GUI:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/1f6f6a0a-d639-42c8-a600-072efa9f2606.png" width="1366" height="513"/></p>
<ol start="4">
<li>Run the code located in <kbd>GUI_MySQL.py</kbd>. You will observe the following output:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="Images/7c3cd175-f427-43e6-9563-28e8e4b672da.png" style="width:23.83em;height:24.58em;" width="367" height="378"/></div>
<ul>
<li style="list-style-type: none">
<ol>
<li>Now, open <kbd>MySQL_create_DB.py</kbd> and save it as <kbd>M<span>ySQL_show_DB.py</span></kbd><span>.</span></li>
<li>Replace the <kbd>try...catch</kbd> block with the following code:</li>
</ol>
</li>
</ul>
<pre style="padding-left: 150px"># unpack dictionary credentials<br/>conn = mysql.connect(**guiConf.dbConfig) <br/># create cursor<br/>cursor = conn.cursor() <br/># execute command <br/>cursor.execute("SHOW TABLES FROM guidb") <br/>print(cursor.fetchall()) <br/><br/># close connection to MySQL <br/>conn.close()</pre>
<ol start="5">
<li>Run the code and observe the output:</li>
</ol>
<p class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/a6f5483e-7c1d-49af-afea-0e86089212ff.png" style="width:29.25em;height:10.75em;" width="439" height="161"/></p>
<ul>
<li style="list-style-type: none">
<ol>
<li>Create a module similar to <kbd><span>GUI_MySQL_class.py</span></kbd>.</li>
<li>Add and run the following code:</li>
</ol>
</li>
</ul>
<pre style="padding-left: 150px"># connect by unpacking dictionary credentials <br/>conn = mysql.connect(**guiConf.dbConfig) <br/><br/># create cursor<br/>cursor = conn.cursor() <br/><br/># select DB <br/>cursor.execute("USE guidb") <br/><br/># create Table inside DB <br/>cursor.execute("CREATE TABLE Books (<br/>      Book_ID INT NOT NULL AUTO_INCREMENT,<br/>      Book_Title VARCHAR(25) NOT NULL,<br/>      Book_Page INT NOT NULL,<br/>      PRIMARY KEY (Book_ID)<br/>    ) ENGINE=InnoDB") <br/><br/># close connection to MySQL <br/>conn.close()</pre>
<p class="mce-root"/>
<ol start="6">
<li>Run the following code, which is located in <kbd><span>GUI_MySQL_class.py</span></kbd><span>:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/ab793279-6230-47b1-9cc3-36c8bba03fb0.png" style="width:26.75em;height:10.58em;" width="442" height="175"/></div>
<ol start="7">
<li>Open Command Prompt and navigate to <kbd>mysql.exe</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="Images/febf4679-11a0-432b-ac52-8dd229220fa0.png" style="width:44.25em;height:9.08em;" width="710" height="146"/></p>
<ol start="8">
<li>Run <kbd>mysql.exe</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/2d4ab9b4-4c92-4b96-a679-a37e00d17c1a.png" style="width:40.75em;height:19.92em;" width="667" height="326"/></div>
<ol start="9">
<li>Enter <span>the </span><kbd>SHOW COLUMNS FROM books;</kbd><span> command:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/28969003-6ce6-491b-a714-63118f960a67.png" style="width:32.58em;height:12.00em;" width="583" height="215"/></div>
<ol start="10">
<li>Create a second table by running the following code:</li>
</ol>
<pre style="padding-left: 60px"># select DB <br/>cursor.execute("USE guidb") <br/><br/># create second Table inside DB <br/>cursor.execute("CREATE TABLE Quotations (<br/>        Quote_ID INT,<br/>        Quotation VARCHAR(250),<br/>        Books_Book_ID INT,<br/>        FOREIGN KEY (Books_Book_ID)<br/>        REFERENCES Books(Book_ID)<br/>        ON DELETE CASCADE<br/>    ) ENGINE=InnoDB")</pre>
<ol start="11">
<li>Execute the <kbd>SHOW TABLES</kbd> command: </li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/ac9e3ca0-c47c-4cb8-8776-8bfc68d305bb.png" style="width:27.00em;height:10.75em;" width="438" height="174"/></div>
<ol start="12">
<li>Execute the<span> </span><kbd>SHOW COLUMNS</kbd><span> command:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/87dd9c12-e39f-453e-b0d4-cfc4a8dc62fa.png" style="width:42.83em;height:9.50em;" width="708" height="157"/></div>
<ol start="13">
<li>Execute <kbd>SHOW COLUMNS</kbd> again with <kbd>pprint</kbd>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="Images/de29f1b3-2496-400b-a30c-400908c4774c.png" style="width:31.83em;height:14.33em;" width="520" height="235"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>We started <span>with the </span><span><kbd>GUI_TCP_IP.py</kbd> file from the previous chapter and reorganized the widgets. </span></p>
<p>We renamed several widgets and separated the code that accesses the MySQL data to what used to be named<span> </span><strong>Tab 1</strong>, and we moved the unrelated widgets to what we named <strong>Tab 2</strong><span> </span>in the previous recipes. We also adjusted some internal Python variable names so that we can understand our code better.</p>
<div class="packt_infobox">Code readability is a coding virtue and not a waste of time.</div>
<p>The refactored module is close to 400 lines of Python code and it would take too many pages to show the entire code here. On Windows, we can use a tool called<span> </span><strong>WinMerge</strong> to compare different Python code modules. I am sure there are similar tools for macOS and Linux.</p>
<div class="packt_tip">WinMerge is a great tool for comparing different Python (and other) code modules on Windows. We can use it to look at the differences between code modules. You can download it for free from <a href="https://sourceforge.net/projects/winmerge/">https://sourceforge.net/projects/winmerge</a>.</div>
<p>   Our refactored Python GUI now looks as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/eeef71d3-13ca-461c-8c63-8fbfd0182aa3.png" style="width:24.50em;height:25.17em;" width="367" height="377"/></p>
<p>We renamed the first tab <span class="packt_screen">MySQL</span><span> </span>and created two<span> </span><kbd>LabelFrame</kbd><span> </span>widgets of<span> <kbd>tkinter</kbd></span>. We labeled the one on the top<span> </span><kbd>Python Database</kbd>, which contains two labels and six <kbd>tkinter</kbd> Entry widgets, as well as three buttons, which we aligned in four rows and three columns using the <kbd>tkinter</kbd> grid layout manager. We will enter book titles and pages into the Entry widgets. Clicking the buttons will result in either inserting, retrieving, or modifying book quotations. The<span> </span><kbd>LabelFrame</kbd><span> widget </span>at the bottom has a label of<span> </span><span class="packt_screen">Book Quotation</span><span> </span>and the<span> </span><kbd>ScrolledText</kbd><span> </span>widget that is part of this frame will display our books and quotations.</p>
<p>Then, we created two SQL tables to hold our data. The first will hold the data for the book title and book page, which will then join with the second table, which will hold the book quote. We will link the two tables together via <em>primary key to foreign key relationships</em>.</p>
<p>So, let's create the first database table now. Before we do that, let's verify that our database does, indeed, have no tables. According to the online MySQL documentation, the command to view the tables that exist in a database is as follows:</p>
<pre><strong><span>13.7.6.37 SHOW TABLES Syntax</span></strong><br/><strong>SHOW [FULL] TABLES [{FROM | IN} db_name] </strong><br/><strong> [LIKE 'pattern' | WHERE expr]</strong></pre>
<p>It is important to note that, in the preceding syntax, arguments in square brackets, such as <kbd>FULL</kbd>,<span> </span><span>are optional, while arguments in curly braces, such as </span><kbd>FROM</kbd><span>, are required for the </span><kbd>SHOW TABLES</kbd><span> command. The pipe symbol between </span><kbd>FROM</kbd><span> and </span><kbd>IN</kbd><span> means that the MySQL syntax requires one or the other.</span></p>
<p><span>When we execute the SQL command in <kbd>MySQL_show_DB.py</kbd>, we get the expected result, which is an empty tuple showing us that our database currently has no tables.</span></p>
<p>We can also select the database by executing the<span> </span><kbd>USE &lt;DB&gt;</kbd><span> </span>command. By doing this, we don't have to pass it into the<span> </span><kbd>SHOW TABLES</kbd><span> </span>command because we have already selected the database we want to talk to. </p>
<div class="packt_infobox">All the SQL code is located in <kbd>GUI_MySQL_class.py</kbd> and we import this into <span><kbd>GUI_MySQL.py</kbd>.</span></div>
<p>Now that we know how to verify that our database has no tables, we create some. After creating two tables, we verify that they have truly made it into our database by using the same<span> commands as before.</span></p>
<p>Doing this, we created the first table, named<span> </span><kbd>Books</kbd>.</p>
<p><span>We can verify that the table has been created in our database by executing the <kbd>cursor.execute("SHOW TABLES FROM guidb")</kbd> command.</span></p>
<p>The result is no longer an empty tuple but a tuple that contains a tuple, showing the<span> </span><kbd>books</kbd><span> </span>table we just created.</p>
<p>We can use the MySQL command-line client to view the columns in our table. In order to do this, we have to log in as the <em>root</em> user. We also have to append a<span> </span><strong>semicolon</strong><span> </span>to the end of the command.</p>
<p class="mce-root"/>
<div class="packt_infobox">On Windows, you simply double-click the MySQL command-line client shortcut, which is automatically installed during the MySQL installation.</div>
<p>If you don't have a shortcut on your desktop, you can find the executable at the following path for a typical default installation:</p>
<pre>C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe</pre>
<p>Without a shortcut to run the MySQL client, you have to pass it some parameters:</p>
<ul>
<li><kbd>C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe</kbd></li>
<li><kbd>-u root</kbd></li>
<li><kbd>-p</kbd></li>
</ul>
<div class="packt_tip">If double-clicking creates an error, make sure you use the <kbd>-u</kbd> and <kbd>-p</kbd> options.</div>
<p><span>Either double-clicking the shortcut or using the command line with the full path to the executable and passing in the required parameters will bring up the MySQL command-line client, which prompts you to enter the password for the root user.</span></p>
<p><span>If you remember the password you assigned to the root user during the installation, you can then run the </span><kbd>SHOW COLUMNS FROM books;</kbd><span> command. This will display the columns of our </span><kbd>books</kbd><span> table from our <kbd>guidb</kbd> database.</span></p>
<div class="packt_infobox">When executing commands in the MySQL client, the syntax is not Pythonic, as it requires a trailing semicolon to complete the statement.</div>
<p class="mce-root">Next, we created the second table, which will store the book and journal quotations. We created it by writing similar code to what we used to create the first table. We verified that we now have two tables by running the same SQL command.</p>
<p>We can see the columns by executing the SQL command using Python:</p>
<pre><strong>cursor.execute("SHOW COLUMNS FROM quotations")</strong></pre>
<p><span>Using the MySQL client might present the data in a better format than Command Prompt. We can also use Python's pretty print (</span><kbd>pprint</kbd><span>) feature for this. </span></p>
<p><span>The MySQL client still shows our columns in a clearer format, which can be seen when you run this client.</span></p>
<p>We designed our Python GUI database and refactored our GUI in preparation to use our new database. Then, we created a MySQL database and created two tables within it.</p>
<p>We verified that the tables made it into our database by using both Python and the MySQL client that ships with the MySQL server.</p>
<p>In the next recipe, we will insert data into our tables.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the SQL INSERT command</h1>
                </header>
            
            <article>
                
<p>This recipe presents the entire Python code that shows you how to create and drop MySQL databases and tables, as well as how to display the existing databases, tables, columns, and data of our MySQL instance.</p>
<p>After creating the database and tables, we will insert data into the two tables we will create in this recipe.</p>
<div class="packt_infobox">We are using a <em>primary key</em> to <em>foreign key</em> relationship to connect the data of the two tables.</div>
<p>We will go into detail about how this works in the following two recipes, where we will modify and delete the data in our MySQL database.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe builds on the MySQL database we created in the previous recipe, <em>Designing the Python GUI database</em>, and also shows you how to drop and recreate the GuiDB.</p>
<div class="packt_infobox">Dropping the database, of course, deletes all the data the database has in its tables, so we'll show you how to reinsert that data as well.</div>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p>The entire code in the <kbd><span>GUI_MySQL_class.py</span></kbd> module is present in the code folder for this chapter, which you can download from <a href="https://github.com/PacktPublishing/Python-GUI-Programming-Cookbook-Third-Edition">https://github.com/PacktPublishing/Python-GUI-Programming-Cookbook-Third-Edition</a>. Let's go through these steps sequentially:</p>
<ol>
<li>Download the code for this chapter.</li>
<li>Open <kbd><span>GUI_MySQL_class.py</span></kbd> and look at the class methods:</li>
</ol>
<pre style="padding-left: 60px">import mysql.connector<br/>import Ch07_Code.GuiDBConfig as guiConf<br/><br/>class MySQL(): <br/>    # class variable <br/>    GUIDB  = 'GuiDB'<br/>    #------------------------------------------------------ <br/>    def connect(self): <br/>        # connect by unpacking dictionary credentials <br/>        # create cursor<br/>    #------------------------------------------------------ <br/>    def close(self, cursor, conn): <br/>        # close cursor <br/>    #------------------------------------------------------ <br/>    def showDBs(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def createGuiDB(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def dropGuiDB(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def useGuiDB(self, cursor): <br/>        '''Expects open connection.''' <br/>        # select DB <br/>    #------------------------------------------------------ <br/>    def createTables(self): <br/>        # connect to MySQL <br/>        # create Table inside DB <br/>    #------------------------------------------------------ <br/>    def dropTables(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def showTables(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def insertBooks(self, title, page, bookQuote): <br/>        # connect to MySQL <br/>        # insert data <br/>    #------------------------------------------------------ <br/>    def insertBooksExample(self): <br/>        # connect to MySQL <br/>        # insert hard-coded data <br/>    #------------------------------------------------------ <br/>    def showBooks(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def showColumns(self): <br/>        # connect to MySQL <br/>    #------------------------------------------------------ <br/>    def showData(self): <br/>        # connect to MySQL<br/>#------------------------------------------------------ <br/>if __name__ == '__main__':<br/>    # Create class instance <br/>    mySQL = MySQL()</pre>
<ol start="3">
<li>Running the preceding code (including the full implementation of the code) creates the following tables and data in the database we created.</li>
<li>Open Command Prompt and execute the two <kbd>SELECT *</kbd> statements:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="Images/6c11fa1e-274e-4a1d-b81f-80fabcf857c6.png" style="width:41.67em;height:21.92em;" width="677" height="357"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>The <kbd><span>GUI_MySQL_class.py</span></kbd> code creates the database, adds tables to it, and then inserts data into the two tables we created.</p>
<div class="packt_infobox">Here, we outline the code without showing all the implementation details in order to preserve space because it would take too many pages to show the entire code.</div>
<p>We created a MySQL database, connected to it, and then created two tables that hold the data for a favorite book or journal quotation.</p>
<p>We distributed the data between two tables because the quotations tend to be rather large, while the book titles and book page numbers are very short. By doing this, we can increase the efficiency of our database.</p>
<div class="packt_infobox">In SQL database language, separating data into separate tables is called <em>normalization</em>. One of the most important things you need to do while using a SQL database is to segregate data into related tables, also known as <strong>relationships</strong>.</div>
<p>Let's move on to the next recipe.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the SQL UPDATE command</h1>
                </header>
            
            <article>
                
<p>This recipe will use the code from the previous recipe, <em>Using the SQL INSERT command</em>, explain it in more detail, and then extend the code to update the data.</p>
<p>In order to update the data that we previously inserted into our MySQL database tables, we need to use the SQL <kbd>UPDATE</kbd> command.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe builds on the previous recipe, <em>Using the SQL INSERT command</em><span>, </span>so read and study the previous recipe in order to follow the code in this recipe, where we will modify the existing data.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p>Let's take a look at how we can u<span>se the <kbd>SQL UPDATE</kbd> command:</span></p>
<ol>
<li>First, we will display the data to be modified by running the following Python to the MySQL command. Sequentially, we perform the following steps:
<ol>
<li>Open <kbd><span>GUI_MySQL_class.py</span></kbd><span>.</span></li>
<li>Look at the <kbd>showData</kbd> method:</li>
</ol>
</li>
</ol>
<pre style="padding-left: 120px">import mysql.connector <br/>import Ch07_Code.GuiDBConfig as guiConf <br/><br/>class MySQL(): <br/>    # class variable <br/>    GUIDB  = 'GuiDB' <br/>    #------------------------------------------------------ <br/>    def showData(self): <br/>        # connect to MySQL <br/>        conn, cursor = self.connect()<br/><br/>        self.useGuiDB(cursor)<br/><br/>        # execute command <br/>        cursor.execute("SELECT * FROM books") <br/>        print(cursor.fetchall()) <br/><br/>        cursor.execute("SELECT * FROM quotations") <br/>        print(cursor.fetchall()) <br/><br/>        # close cursor and connection <br/>        self.close(cursor, conn) <br/>#========================================================== <br/>if __name__ == '__main__':<br/>    # Create class instance <br/>    mySQL = MySQL() <br/>    mySQL.showData()</pre>
<ol start="2">
<li>Running the preceding code gives us the following output:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/0c766ac7-e8b1-4826-9b52-f1f83830152a.png" width="786" height="101"/></div>
<ol start="3">
<li>Look at the <kbd>updateGOF</kbd> method:</li>
</ol>
<pre style="padding-left: 60px">#------------------------------------------------------ <br/>def updateGOF(self): <br/>    # connect to MySQL <br/>    conn, cursor = self.connect()    <br/>    self.useGuiDB(cursor)       <br/>    # execute command <br/>    cursor.execute("SELECT Book_ID FROM books WHERE Book_Title = <br/>    'Design Patterns'") <br/>    primKey = cursor.fetchall()[0][0] <br/>    print("Primary key=" + str(primKey)) <br/>    cursor.execute("SELECT * FROM quotations WHERE Books_Book_ID = <br/>    (%s)", (primKey,)) <br/>    print(cursor.fetchall()) <br/>    # close cursor and connection <br/>        self.close(cursor, conn)  <br/>#========================================================== <br/>if __name__ == '__main__':  <br/>    mySQL = MySQL()          # Create class instance <br/>    mySQL.updateGOF()</pre>
<ol start="4">
<li class="mce-root">Run the method located in <kbd><span>GUI_MySQL_class.py</span></kbd><span>:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/dab36cb7-f38f-4f70-9ad2-855665695ffc.png" style="width:49.17em;height:16.42em;" width="696" height="232"/></div>
<ol start="5">
<li>Add the following code and run it:</li>
</ol>
<pre style="padding-left: 60px">#------------------------------------------------------ <br/>def showDataWithReturn(self): <br/>    # connect to MySQL <br/>    conn, cursor = self.connect()    <br/><br/>    self.useGuiDB(cursor)       <br/><br/>    # execute command <br/>    cursor.execute("SELECT Book_ID FROM books WHERE Book_Title = <br/>    'Design Patterns'") <br/>    primKey = cursor.fetchall()[0][0] <br/>    print(primKey) <br/><br/>    cursor.execute("SELECT * FROM quotations WHERE Books_Book_ID = <br/>    (%s)", (primKey,)) <br/>    print(cursor.fetchall()) <br/><br/>    cursor.execute("UPDATE quotations SET Quotation = <br/>    (%s) WHERE Books_Book_ID = (%s)",  <br/>    ("Pythonic Duck Typing: If it walks like a duck and <br/>    talks like a duck it probably is a duck...", <br/>    primKey)) <br/><br/>    # commit transaction <br/>    conn.commit () <br/><br/>    cursor.execute("SELECT * FROM quotations WHERE Books_Book_ID = <br/>    (%s)", (primKey,)) <br/>    print(cursor.fetchall()) <br/><br/>    # close cursor and connection <br/>    self.close(cursor, conn) <br/><br/>#========================================================== <br/>if __name__ == '__main__':  <br/>    # Create class instance <br/>    mySQL = MySQL() <br/>    #------------------------ <br/>    mySQL.updateGOF() <br/>    book, quote = mySQL.showDataWithReturn()     <br/>    print(book, quote)</pre>
<p class="mce-root"/>
<ol start="6">
<li>Open a MySQL client window and run the <kbd>SELECT *</kbd> statements:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/61f1631f-cf20-4237-a2b8-d3ba0d17f5b8.png" style="width:49.75em;height:41.58em;" width="728" height="609"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>First, we opened <kbd><span>GUI_MySQL_class.py</span></kbd> or typed the code that was shown in our own module and ran it. </p>
<p>We may not agree with the<span> </span><em>Gang of Four</em>, so let's change their famous programming quote.</p>
<div class="packt_infobox">The Gang of Four are the four authors who created the world-famous book called<span> </span><em>Design Patterns</em>, which strongly influenced our entire software industry to recognize, think, and code using software<span> </span><em>design patterns</em>.</div>
<p>We did this by updating our database of favorite quotes. First, we retrieved the primary key value by searching for the book title. Then, we passed that value into our search for the quote.</p>
<p><span>Now that we know the primary key of the quote, we can update the quote by executing the SQL <kbd>UPDATE</kbd> command.</span></p>
<p>Before we ran the code, our title with<span> </span><kbd>Book_ID = 1</kbd> was related via a<span> </span><em>primary</em><span> <em>key</em> </span>to<span> </span><em>foreign key</em><span> </span>relationship to the quotation in the<span> </span><kbd>Books_Book_ID</kbd><span> </span>column of the quotation table. This is the original quotation from the<span> </span><em>Design Patterns</em><span> </span>book.</p>
<p>In <em>step 5</em>, we updated the quotation related to this ID via the SQL<span> </span><kbd>UPDATE</kbd><span> </span>command.</p>
<p>None of the IDs have changed, but the quotation that is now associated with<span> </span><kbd>Book_ID = 1</kbd><span> </span>has changed, as can be seen in the second MySQL client <span>window.</span></p>
<p>In this recipe, we retrieved the existing data from our database and database tables that we created in the previous recipes. We inserted data into the tables and updated our data using the SQL <kbd>UPDATE</kbd> command.</p>
<p>Let's move on to the next recipe.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the SQL DELETE command</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will use the SQL <kbd>DELETE</kbd> command to delete the data we created in the previous recipe, <em>Using the SQL UPDATE command</em>.</p>
<p>While deleting data might sound trivial at first, once we get a rather large database design in production, things might not be that easy any more.</p>
<p class="mce-root"/>
<p>Because we have designed our GUI database by <em>relating</em> two tables via a <em>primary</em> to <em>foreign key relation</em>, when we delete certain data, we do not end up with <em>orphan records</em> because this database design takes care of <em>cascading</em> deletes.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe uses the MySQL database, tables, and the data that was inserted into those tables from the previous recipe, <em>Using the SQL UPDATE command</em>. In order to demonstrate how to create orphan records, we will have to change the design of one of our database tables.</p>
<div class="packt_infobox">Changing the design to intentionally create a poor design is for demonstration purposes only and is not the recommended way of designing a database.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p>If we create our <kbd>quotations</kbd> table without a <em>foreign key relationship</em> to the <kbd>books</kbd> table, we can end up with orphan records. Take a look at the following steps:</p>
<ol>
<li>Open <kbd><span>GUI_MySQL_class.py</span></kbd> and look at <kbd>def createTablesNoFK(self): ...</kbd><span>:</span></li>
</ol>
<pre style="padding-left: 60px"># create second Table inside DB --  <br/># No FOREIGN KEY relation to Books Table <br/>cursor.execute("CREATE TABLE Quotations (  <br/>    Quote_ID INT AUTO_INCREMENT,       <br/>    Quotation VARCHAR(250),            <br/>    Books_Book_ID INT,                 <br/>    PRIMARY KEY (Quote_ID)             <br/>) ENGINE=InnoDB")</pre>
<ol start="2">
<li>Run the SQL command: </li>
</ol>
<pre style="padding-left: 60px"><strong>cursor.execute("DELETE FROM books WHERE Book_ID = 1")</strong></pre>
<p class="mce-root"/>
<ol start="3">
<li>Run the two <kbd>SELECT *</kbd> <span>commands:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="Images/407b6af1-6518-472b-bcd3-dcc64502cb1f.png" style="width:41.25em;height:18.75em;" width="681" height="310"/></div>
<ol start="4">
<li>Open <kbd><span>GUI_MySQL_class.py</span></kbd><span> </span>and look at <kbd>def createTables(self): ...</kbd>:</li>
</ol>
<pre style="padding-left: 60px"># create second Table inside DB <br/>cursor.execute("CREATE TABLE Quotations (  <br/>    Quote_ID INT AUTO_INCREMENT,       <br/>    Quotation VARCHAR(250),            <br/>    Books_Book_ID INT,                 <br/>    PRIMARY KEY (Quote_ID),            <br/>    FOREIGN KEY (Books_Book_ID)        <br/>    REFERENCES Books(Book_ID)      <br/>    ON DELETE CASCADE              <br/>) ENGINE=InnoDB")<br/><br/>#========================================================== <br/>if __name__ == '__main__':  <br/>    # Create class instance <br/>    mySQL = MySQL() <br/>    mySQL.showData()</pre>
<ol start="5">
<li>Run t<span>he </span><kbd>showData()</kbd><span> method:</span><span> </span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/e4e60106-2a4c-4b52-95f4-35c92fa93afd.png" style="width:50.42em;height:6.75em;" width="742" height="99"/></div>
<ol start="6">
<li>Run th<span>e <kbd>deleteRecord()</kbd> method, followed by the </span><kbd>showData()</kbd><span> method:</span></li>
</ol>
<pre style="padding-left: 60px">import mysql.connector<br/>import Ch07_Code.GuiDBConfig as guiConf <br/><br/>class MySQL(): <br/>    #------------------------------------------------------ <br/>    def deleteRecord(self): <br/>        # connect to MySQL <br/>        conn, cursor = self.connect()    <br/><br/>        self.useGuiDB(cursor)       <br/><br/>        # execute command <br/>        cursor.execute("SELECT Book_ID FROM books WHERE Book_Title = <br/>        'Design Patterns'") <br/>        primKey = cursor.fetchall()[0][0] <br/>        # print(primKey) <br/><br/>        cursor.execute("DELETE FROM books WHERE Book_ID = (%s)",<br/>        (primKey,)) <br/><br/>        # commit transaction <br/>        conn.commit () <br/><br/>        # close cursor and connection <br/>        self.close(cursor, conn)     <br/>#========================================================== <br/>if __name__ == '__main__':  <br/>    # Create class instance <br/>    mySQL = MySQL() <br/>    #------------------------ <br/>    mySQL.deleteRecord() <br/>    mySQL.showData()</pre>
<ol start="7">
<li>The preceding code results in the following output:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/76aba897-d5dd-46a6-ae17-9ce02a0c9364.png" style="width:42.92em;height:11.75em;" width="686" height="188"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>We kept our database design simple by using only two database tables.</p>
<p>While this works when we delete data, there is always a chance of us ending up with orphan records. What this means is that we delete data in one table but somehow do not delete the related data in another SQL table. Here, we started by intentionally showing how <strong>orphan records</strong> can be created.</p>
<p><span>After inserting data into the </span><kbd>books</kbd><span> and </span><kbd>quotations</kbd><span> tables, if we execute a </span><kbd>DELETE</kbd><span> statement, we are only deleting the book with </span><kbd>Book_ID = 1</kbd><span>, while the related quotation with</span> <kbd>Books_Book_ID = 1</kbd><span> is left behind.</span></p>
<p><span>This is an </span><strong>orphaned record</strong><span>. A book record that has a </span><kbd>Book_ID</kbd><span> of </span><kbd>1</kbd> no longer exists.</p>
<div class="packt_infobox">This situation can cause <strong>data corruption</strong>, which we can avoid by using<span> </span><em>cascading</em><span> </span>deletes.</div>
<p>We prevented this in the creation of the tables by adding certain database<span> </span><em>constraints</em>. When we created the table that holds the quotations in a previous recipe, we created our<span> </span><kbd>quotations</kbd><span> </span>table with a<span> </span><em>foreign</em><span> </span><em>key</em><span> </span><strong>constraint</strong><span> </span>that explicitly references the<span> </span><em>primary key</em><span> </span>of the books table, linking the two.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="packt_infobox">The<span> </span><kbd>FOREIGN KEY</kbd><span> </span>relationship includes the<span> </span><kbd>ON DELETE CASCADE</kbd><span> </span>attribute, which basically tells our MySQL server to delete the related records in this table when the records that this foreign key relates to are deleted.</div>
<p>Because of this design, no<span> </span><em>orphan</em><span> </span>records will be left behind, which is what we want.</p>
<div class="packt_infobox">In MySQL, we have to specify<span> </span><kbd>ENGINE=InnoDB</kbd> on both of the related tables in order to use<span> </span><em>primary key</em><span> </span>to<span> </span><em>foreign key</em><span> </span>relationships.</div>
<p><span>The </span><kbd>showData()</kbd><span> method </span>shows us that we have two records that are related via<span> </span><em>primary key</em><span> </span>to<span> </span><em>foreign key</em><span> </span>relationships.</p>
<p>When we now delete a record in the<span> </span><kbd>books</kbd><span> </span>table, we expect the related record in the<span> </span><kbd>quotations</kbd><span> </span>table to also be deleted by a cascading delete. </p>
<p><span>After executing the commands to delete and show records, we got the new results.</span></p>
<div class="packt_infobox"><span>The famous</span> <span>d</span>esign patterns<span> are gone from our database of favorite quotations. This is meant as a joke—I personally highly value the famous design patterns. However, Python's </span><em>duck typing</em><span> is a very cool feature indeed!</span></div>
<p>We triggered <em>cascading</em> deletes in this recipe by designing our database in a solid fashion via <em>primary key</em> to <em>foreign key</em> relationships with <em>cascading</em> deletes.</p>
<p>This keeps our data sane and integral.</p>
<p>In the next recipe, we will use the code of our<span><span> <kbd>GUI_MySQL_class.py</kbd></span></span> module from our Python GUI.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Storing and retrieving data from our MySQL database</h1>
                </header>
            
            <article>
                
<p>We will use our Python GUI to insert data into our MySQL database tables. We already refactored the GUI we built in the previous recipes in preparation for connecting and using a database.</p>
<p>We will use two textbox Entry widgets, into which we can type the book or journal title and the page number. We will also use a <kbd>ScrolledText</kbd> widget to type our favorite book quotations into, which we will then store in our MySQL database.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe will build on the MySQL database and tables we created in the previous recipes of this chapter.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p>We will insert, retrieve, and modify our favorite quotations using our Python GUI. We refactored the MySQL tab of our GUI in preparation for this. <span>Let's look at how we can deal with this:</span></p>
<ol>
<li>Open <kbd>GUI_MySQL.py</kbd>.</li>
<li>Running the code in this file shows us our GUI:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="Images/078657a7-58ac-4f94-b2a1-612d22ff8584.png" style="width:24.42em;height:24.92em;" width="368" height="376"/></div>
<ol start="3">
<li>Open <kbd>GUI_MySQL.py</kbd>.</li>
<li>Notice the <kbd>insertQuote()</kbd> <span>method, as shown here: </span></li>
</ol>
<pre style="padding-left: 60px">    # Adding a Button <br/>    self.action = ttk.Button(self.mySQL, text="Insert Quote", <br/>    command=self.insertQuote)    <br/>    self.action.grid(column=2, row=1) <br/><br/># Button callback <br/>def insertQuote(self): <br/>    title = self.bookTitle.get() <br/>    page = self.pageNumber.get() <br/>    quote = self.quote.get(1.0, tk.END) <br/>    print(title) <br/>    print(quote) <br/>    self.mySQL.insertBooks(title, page, quote)</pre>
<ol start="5">
<li>Run <kbd>GUI_MySQL.py</kbd>, enter a quotation, and click the <span class="packt_screen">Insert Quote</span> button:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="Images/fe1f64c5-5902-46f4-8fa1-0d22868b7fca.png" style="width:25.33em;height:26.00em;" width="366" height="376"/></div>
<ol start="6">
<li>Click <span class="packt_screen">Get Quotes</span><span>:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="Images/8e3e3a20-018e-41ab-b8dc-48f3000ae4a2.png" style="width:27.17em;height:28.00em;" width="382" height="393"/></div>
<ol start="7">
<li>Open <kbd>GUI_MySQL.py</kbd> and look at the <kbd>getQuote</kbd> method and button:</li>
</ol>
<pre style="padding-left: 60px"># Adding a Button <br/>    self.action1 = ttk.Button(self.mySQL, text="Get Quotes", <br/>    command=self.getQuote)    <br/>    self.action1.grid(column=2, row=2) <br/><br/># Button callback <br/>def getQuote(self): <br/>    allBooks = self.mySQL.showBooks()   <br/>    print(allBooks) <br/>    self.quote.insert(tk.INSERT, allBooks)</pre>
<ol start="8">
<li><span>Open </span><kbd>GUI_MySQL.py</kbd><span> and look at <kbd>self.mySQL</kbd> and <kbd>showBooks()</kbd></span><span>:</span></li>
</ol>
<pre style="padding-left: 60px">from Ch07_Code.GUI_MySQL_class import MySQL<br/>class OOP(): <br/>    def __init__(self): <br/>        # create MySQL instance <br/>        self.mySQL = MySQL() <br/><br/>class MySQL(): <br/>    #------------------------------------------------------ <br/>    def showBooks(self): <br/>        # connect to MySQL <br/>        conn, cursor = self.connect()     <br/><br/>        self.useGuiDB(cursor)     <br/><br/>        # print results <br/>        cursor.execute("SELECT * FROM Books") <br/>        allBooks = cursor.fetchall() <br/>        print(allBooks) <br/><br/>        # close cursor and connection <br/>        self.close(cursor, conn)    <br/><br/>        return allBooks</pre>
<p class="mce-root">Let's go over how this recipe works.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>In order to make the buttons in <span><kbd>GUI_MySQL.py</kbd> </span>do something, we connect them to<span> </span><em>callback functions</em><span>, like</span> we have done many times in this book. We display the data in the<span> </span><kbd>ScrolledText</kbd><span> </span>widget, below the buttons.</p>
<p>In order to do this, we import the<span> </span><kbd>GUI_MySQL_class.py</kbd> module. The entire code that talks to our MySQL server instance and database resides in this module, which is a form of<span> </span><em>encapsulating</em><span> </span>the code in the spirit of<span> </span><strong>object-oriented programming</strong> (<strong>OOP</strong>).</p>
<p>We connect the<span> </span><span class="packt_screen">Insert Quote</span><span> </span>button to the <kbd>insertQuote()</kbd><span> method</span> callback.</p>
<p><span>When we run our code, we can insert data from our Python GUI into our MySQL database.</span></p>
<p>After entering a book title and book page, as well as a quote from the book, we<span> </span><em>insert</em><span> </span>the data into our database by clicking the<span> </span><span class="packt_screen">Insert Quote</span><span> </span>button.</p>
<div class="packt_tip">Our current design allows for titles, pages, and a quotation. We can also insert our favorite quotations from movies. While a movie does not have pages, we can use the page column to insert the approximate time when the quotation occurred within the movie.</div>
<div>
<p>After inserting the data, we verified that it made it into our two MySQL tables by clicking the<span> </span><span class="packt_screen">Get Quotes</span><span> </span>button, which then displayed the data we inserted into our two MySQL database tables, as shown in the screenshot in <em>step 6</em>.</p>
<p>Clicking the<span> </span><span class="packt_screen">Get<span> </span></span><span class="packt_screen">Quotes</span><span> </span>button invokes the callback method we associated with the button click event. This gives us the data that we display in our<span> </span><kbd>ScrolledText</kbd><span> </span>widget.</p>
<p><span>We used the </span><kbd>self.mySQL</kbd><span> class instance attribute to invoke the </span><kbd>showBooks()</kbd><span> method, which is a part of the </span><kbd>MySQL</kbd><span> class we imported.</span></p>
</div>
<p>In this recipe, we imported the Python module we wrote, which contains all of the coding logic that we need so that we can connect to our MySQL database. It also knows how to insert, update, and delete data.</p>
<p>Now, we have connected our Python GUI to this SQL logic.</p>
<p>Let's move on to the next recipe.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using MySQL Workbench</h1>
                </header>
            
            <article>
                
<p>MySQL has a very nice GUI that we can download for free. It's called <strong>MySQL Workbench</strong>.</p>
<p>In this recipe, we will successfully install Workbench and then use it to run SQL queries against the GuiDB we created in the previous recipes.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>In order to use this recipe, you will need MySQL database we developed in the previous recipes. You will also need a running MySQL server.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<p>We can download <span>MySQL Workbench</span> from the official MySQL website: <a href="https://dev.mysql.com/downloads/workbench/">https://dev.mysql.com/downloads/workbench/</a>.</p>
<p>Let's look at how we can perform this recipe:</p>
<ol>
<li>Download the <span>MySQL Workbench installer.</span></li>
<li>C<span>lick the </span><span class="packt_screen">Download</span><span> button:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/f2444dbf-254f-4edd-9a21-cc857d41ac3f.png" style="width:40.75em;height:31.83em;" width="614" height="481"/><br/></div>
<ol start="3">
<li>Run <span>the installation: </span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="Images/37eb643e-43c6-4508-9bc0-dca474c08265.png" style="width:31.58em;height:23.33em;" width="565" height="417"/></div>
<p class="mce-root"/>
<ol start="4">
<li>Click <span class="packt_screen">Next &gt;</span> until the installation is complete:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/917bc1d4-303f-46db-80c2-bd5e7d348a28.png" style="width:32.00em;height:24.33em;" width="497" height="379"/></div>
<ol start="5">
<li>Open MySQL Workbench:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/694dd086-b49f-48b4-a201-41021583c02a.png" width="961" height="590"/></div>
<ol start="6">
<li class="CDPAlignLeft CDPAlign">Select our <kbd>guidb</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/d63470b9-0344-49b5-b3d7-aaaf7eeb4f32.png" style="width:40.75em;height:40.00em;" width="595" height="585"/></div>
<ol start="7">
<li class="CDPAlignLeft CDPAlign">Write and execute some SQL commands:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/d238e2d0-41f7-41d9-85f8-41ab0d700229.png" width="821" height="534"/></div>
<p><span>Let's go behind the scenes to understand the code better.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>When you installed MySQL, if you had the required components already installed on your PC, you may already have MySQL Workbench installed. If you do not<span> </span>have Workbench installed, <em>steps 1</em> to <em>3</em> show you how to install MySQL Workbench.</p>
<div class="packt_infobox">MySQL Workbench <span>is a GUI in itself, very similar to the one we developed in the previous recipes. It does come with some additional features that are specific to working with MySQL</span><span>. <kbd>8.0 CE</kbd> in the installer window is an abbreviation for version <strong>8.0 Community Edition</strong>.</span></div>
<p class="mce-root"/>
<p class="CDPAlignLeft CDPAlign">When you start up MySQL Workbench, it will prompt you to connect. Use the <strong>root</strong> user and password you created for it. MySQL Workbench is smart enough to recognize that you're running a MySQL server and the port it is listening on.</p>
<p><span>Once you are successfully logged in to your MySQL server instance, you can select the <kbd>guidb</kbd> we created.</span></p>
<p class="CDPAlignLeft CDPAlign">We can find our <kbd>guidb</kbd> underneath the<span> </span><span class="packt_screen">SCHEMAS</span><span> </span>label.</p>
<div class="CDPAlignLeft CDPAlign packt_infobox">In some literature and products, databases are often called <strong>SCHEMAS</strong>. Schematics refer to the structure and layout of a database. Personally, coming from Microsoft SQL Server, I am used to referring to them simply as<span> </span><em>databases</em>.</div>
<p class="CDPAlignLeft CDPAlign">We can type SQL commands into the <span class="packt_screen">Query Editor</span> and execute our commands by clicking the lightning bolt icon. It is the button toward the top right, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="image-border" src="Images/06581eae-e542-4c78-ad53-83cab2248d5e.png" width="101" height="55"/></p>
<p>We can see the results in the <span class="packt_screen">Result Grid</span>. We can click on the different tabs to see the different results.</p>
<p>Now, we can connect to our MySQL database via the MySQL Workbench GUI. We can execute the same SQL commands we issued before and get the same results that we did when we executed them in our Python GUI.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">There's more…</h1>
                </header>
            
            <article>
                
<p>With the knowledge we have gained throughout the recipes within this and the preceding chapters, we are now well positioned to create our own GUIs written in Python, all of which can connect and talk to MySQL databases.</p>


            </article>

            
        </section>
    </div>



  </body></html>