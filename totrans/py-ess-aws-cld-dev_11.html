<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-103"><a id="_idTextAnchor015"/>11</h1>
<h1 id="_idParaDest-104">Using Python with Glue</h1>
<p>In this chapter, we are going to learn how to create a data integration pipeline with AWS Glue. <strong class="bold">AWS Glue</strong> is <a id="_idIndexMarker368"/>a data integration service that is<a id="_idIndexMarker369"/> used for the <strong class="bold">Extract, Transform, and Load</strong> (<strong class="bold">ETL</strong>) process. Glue is a serverless data integration service; therefore, you don’t need to create and manage a server, as the infrastructure is managed by AWS. With Glue, you can collect data from different data sources, such as S3, databases, or filesystems, to process and transform the data. The result is stored in S3 or the database, or you can call an API.</p>
<p>The chapter covers the following topics:</p>
<ul>
<li>What is the AWS Glue service?</li>
<li>AWS Glue service creation</li>
<li>Creating a simple Python application with AWS Glue</li>
</ul>
<h1 id="_idParaDest-105">What is the AWS Glue service?</h1>
<p>AWS <a id="_idIndexMarker370"/>has more than 100 services. When you integrate data between AWS and other sources, you might need to load data from the source, manipulate it with some transformations, and store it in a service. AWS Glue meets these requirements and provides a service that allows the preparation of data. In the following figure, you can see a very high-level overview of Glue. As you can see, Glue extracts the data from different sources, carries out some transformation, and loads the data in another source:</p>
<div><div><img alt="" height="437" src="img/Figure_11.1_B19195.jpg" width="762"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – AWS Glue</p>
<p>For example, let us assume <a id="_idIndexMarker371"/>you have data in S3 that is loaded by a batch process. To make it searchable, you have a requirement to store it in DynamoDB. Between these processes, one requirement is to filter, clean, and manipulate the data with some transformations. For that requirement, AWS Glue is a good option for data integration with some data manipulation.</p>
<h2 id="_idParaDest-106">Features of AWS Glue</h2>
<p>AWS Glue has the <a id="_idIndexMarker372"/>following features:</p>
<ul>
<li>It automatically scales based on the transformation workload.</li>
<li>It has wider integration with other services to load data, such as S3, RDS, and DynamoDB. Hence, you can easily read data with these services. </li>
<li>You can schedule the pipeline; hence, the ETL process can be performed regularly based on the scheduled time.</li>
<li>It has a data catalog feature that allows you to store metadata information for the data structure.</li>
<li>It is able to generate code for the ETL pipeline. For example, you need to read CSV data from S3 to load another S3 location in JSON format. Glue automatically generates the code.</li>
<li>There is Git integration, so you can easily pull code from Git to run the ETL pipeline.</li>
<li>It provides<a id="_idIndexMarker373"/> a visual interface with a drag-and-drop code implementation feature.</li>
</ul>
<p>In this section, we looked at AWS Glue's features. To understand them better, we are going to convert a CSV file to JSON using the AWS Glue service.</p>
<h1 id="_idParaDest-107">Creating an S3 sample file</h1>
<p>In this section, we are going to<a id="_idIndexMarker374"/> create a simple S3 bucket that stores a CSV file. Let’s follow the instructions step by step:</p>
<ol>
<li>Open the AWS S3 service.</li>
<li>Click the <strong class="bold">Create </strong><strong class="bold">bucket</strong> button:</li>
</ol>
<div><div><img alt="" height="351" src="img/Figure_11.2_B19195.jpg" width="1094"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Create bucket</p>
<ol>
<li value="3">Give a<a id="_idIndexMarker375"/> unique <strong class="bold">bucket name</strong> and click <strong class="bold">Create bucket</strong> at the end of the panel:</li>
</ol>
<div><div><img alt="" height="245" src="img/Figure_11.3_B19195.jpg" width="472"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Input bucket</p>
<p>The bucket is created:</p>
<div><div><img alt="" height="181" src="img/Figure_11.4_B19195.jpg" width="1045"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Bucket list</p>
<ol>
<li value="4">Create an <code>addresses.csv</code> file on your computer with the following content and upload it to the S3 bucket. Please save the file in the <code>UTF-8</code> format; otherwise, there might be an issue in some Glue versions:<pre class="console">
id,location_id,address_1,city,state_province
1,1,2600 Middlefield Road,Redwood City,CA
2,2,24 Second Avenue,San Mateo,CA
3,3,24 Second Avenue,San Mateo,CA
4,4,24 Second Avenue,San Mateo,CA
5,5,24 Second Avenue,San Mateo,CA
6,6,800 Middle Avenue,Menlo Park,CA
7,7,500 Arbor Road,Menlo Park,CA
8,8,800 Middle Avenue,Menlo Park,CA
9,9,2510 Middlefield Road,Redwood City,CA
10,10,1044 Middlefield Road,Redwood City,CA</pre></li>
<li>Click<a id="_idIndexMarker376"/> the <strong class="bold">Upload</strong> button within the bucket to upload the content:</li>
</ol>
<div><div><img alt="" height="627" src="img/Figure_11.5_B19195.jpg" width="536"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Uploading the CSV</p>
<p>After the<a id="_idIndexMarker377"/> upload, the bucket will include the CSV file:</p>
<div><div><img alt="" height="380" src="img/Figure_11.6_B19195.jpg" width="748"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – S3 content</p>
<p>We have <a id="_idIndexMarker378"/>successfully uploaded the file. In the next step, we will create the required permissions in order to create a Glue job.</p>
<h1 id="_idParaDest-108">Defining the permissions for a Glue job</h1>
<p>In <a id="_idIndexMarker379"/>this section, we are going to define the required <a id="_idIndexMarker380"/>permissions for a Glue job:</p>
<ol>
<li>Open the AWS IAM service.</li>
<li>Click <strong class="bold">Roles</strong> on the left-hand side:</li>
</ol>
<div><div><img alt="" height="401" src="img/Figure_11.7_B19195.jpg" width="483"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – List of IAM services</p>
<ol>
<li value="3">Click <strong class="bold">Create role</strong>:</li>
</ol>
<div><div><img alt="" height="377" src="img/Figure_11.8_B19195.jpg" width="613"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – Create role</p>
<ol>
<li value="4">Under <strong class="bold">Use case</strong>, select <strong class="bold">Glue</strong>:</li>
</ol>
<div><div><img alt="" height="579" src="img/Figure_11.9_B19195.jpg" width="940"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – Selecting Glue</p>
<ol>
<li value="5">On <a id="_idIndexMarker381"/>the next <a id="_idIndexMarker382"/>page, select <strong class="bold">AmazonS3FullAccess</strong> and <strong class="bold">CloudWatchFullAccess</strong> under <strong class="bold">Policy name</strong>:</li>
</ol>
<p class="IMG---Figure"> </p>
<div><div><img alt="" height="467" src="img/Figure_11.10_B19195.jpg" width="606"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">(a)</p>
<div><div><img alt="" height="475" src="img/Figure_11.11_B19195.jpg" width="654"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">(b)</p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – S3 and CloudWatch access</p>
<ol>
<li value="6">Give a <a id="_idIndexMarker383"/>name for the role that we are creating, then <a id="_idIndexMarker384"/>you can click <strong class="bold">Create role</strong> to finish the role creation:</li>
</ol>
<div><div><img alt="" height="355" src="img/Figure_11.12_B19195.jpg" width="530"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">(a)</p>
<div><div><img alt="" height="83" src="img/Figure_11.13_B19195.jpg" width="641"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">(b)</p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – Role name and creation</p>
<p>We have created the required role for an AWS Glue job. In the next step, we will create a simple AWS Glue job by using roles and the S3 bucket.</p>
<h1 id="_idParaDest-109">Creating an AWS Glue service</h1>
<p>In this section, we are<a id="_idIndexMarker385"/> going to create an AWS Glue service. Let’s follow the instructions step by step:</p>
<ol>
<li>Type <code>AWS Glue</code> in the AWS Management Console search bar and click the <strong class="bold">AWS Glue</strong> result that appears:</li>
</ol>
<div><div><img alt="" height="437" src="img/Figure_11.14_B19195.jpg" width="1018"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Console search</p>
<ol>
<li value="2">Click <strong class="bold">Jobs</strong> on the left-hand side:</li>
</ol>
<div><div><img alt="" height="173" src="img/Figure_11.15_B19195.jpg" width="245"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – Glue job</p>
<ol>
<li value="3">In<a id="_idIndexMarker386"/> the <strong class="bold">Create job</strong> section, select <strong class="bold">Visual with a source and target</strong>. This will create a visual interface and predefined script in order to convert from a CSV to a JSON file:</li>
</ol>
<div><div><img alt="" height="761" src="img/Figure_11.16_B19195.jpg" width="692"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Create job</p>
<ol>
<li value="4">After clicking <strong class="bold">Create</strong> on the right side of the panel, you will see the visual editor:</li>
</ol>
<div><div><img alt="" height="642" src="img/Figure_11.17_B19195.jpg" width="399"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15 – Visual editor</p>
<ol>
<li value="5">Click <strong class="bold">S3 bucket</strong> under <strong class="bold">Data source - S3 bucket</strong> and you will see the data source<a id="_idIndexMarker387"/> details on the right side. It consists of some details on how to parse the source data. As you can see in the following figure, we set <strong class="bold">S3 location</strong> as a data path, <strong class="bold">Data format</strong> is <strong class="bold">CSV</strong>, and <strong class="bold">Delimiter</strong> is comma-separated:</li>
</ol>
<div><div><img alt="" height="711" src="img/Figure_11.18_B19195.jpg" width="550"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.16 – Data source</p>
<ol>
<li value="6">Select the <strong class="bold">Transform</strong> tab from the panel and you will see the following data mapping. This <a id="_idIndexMarker388"/>mapping is generated by Glue:</li>
</ol>
<div><div><img alt="" height="788" src="img/Figure_11.19_B19195.jpg" width="999"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.17 – Mapping</p>
<ol>
<li value="7">Select<a id="_idIndexMarker389"/> the <strong class="bold">Data target properties - S3</strong> tab from the panel and fill out the panel with target details. Since we are converting to JSON, the format will be <strong class="bold">JSON</strong>. The target location could also be another S3 bucket; in this example, I will give the same S3 location for input and output:</li>
</ol>
<div><div><img alt="" height="740" src="img/Figure_11.20_B19195.jpg" width="759"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.18 – Data target</p>
<ol>
<li value="8">Select<a id="_idIndexMarker390"/> the <strong class="bold">Job details</strong> tab in order to fill out other information such as the job name and script. You can see these details in <em class="italic">steps 9</em> and <em class="italic">10</em>:</li>
</ol>
<div><div><img alt="" height="700" src="img/Figure_11.21_B19195.jpg" width="932"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.19 – Job details</p>
<ol>
<li value="9">Fill in<a id="_idIndexMarker391"/> the job’s <strong class="bold">Name</strong> and <strong class="bold">IAM Role</strong> fields to run the Glue job:</li>
</ol>
<div><div><img alt="" height="705" src="img/Figure_11.22_B19195.jpg" width="645"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.20 – Name and role</p>
<ol>
<li value="10">There is one <a id="_idIndexMarker392"/>more configuration left. Scroll down and fill in the <strong class="bold">Script filename</strong> and <strong class="bold">Script path</strong> details that Glue will create:</li>
</ol>
<div><div><img alt="" height="406" src="img/Figure_11.23_B19195.jpg" width="808"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.21 – Script filename and path</p>
<ol>
<li value="11">Click <strong class="bold">Save</strong>. As you <a id="_idIndexMarker393"/>can see, Glue has created a Python Spark script that is going to convert CSV to JSON. <strong class="bold">PySpark</strong> is a data processing library that can also be used in the<a id="_idIndexMarker394"/> AWS Glue job:</li>
</ol>
<div><div><img alt="" height="964" src="img/Figure_11.24_B19195.jpg" width="772"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.22 – Code generation</p>
<ol>
<li value="12">Click <strong class="bold">Run</strong> on the<a id="_idIndexMarker395"/> right side of the panel:</li>
</ol>
<div><div><img alt="" height="80" src="img/Figure_11.25_B19195.jpg" width="571"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.23 – Button panel for Run</p>
<p>After some time, you can check the job status from the <strong class="bold">Runs</strong> tab:</p>
<div><div><img alt="" height="435" src="img/Figure_11.26_B19195.jpg" width="732"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.24 – Runs tab</p>
<p>When you check the<a id="_idIndexMarker396"/> S3 folder, the file is converted to JSON. Here is some sample output:</p>
<pre class="console">
{"id":"1","location_id":"1","address_1":"2600 Middlefield Road","city":"Redwood City","state_province":"CA"}
{"id":"2","location_id":"2","address_1":"24 Second Avenue","city":"San Mateo","state_province":"CA"}
{"id":"3","location_id":"3","address_1":"24 Second Avenue","city":"San Mateo","state_province":"CA"}</pre>
<p>Congrats! You are able to convert a CSV file to a JSON file. As you can see, AWS Glue created a predefined script to make some ETL jobs.</p>
<h1 id="_idParaDest-110">Summary</h1>
<p>In this chapter, we learned about the AWS Glue service and how to create an ETL pipeline with AWS Glue. Glue is very efficient when you need to create data pipelines. One cool feature of Glue is the visual flow generator, which allows you to create a flow with drag and drop. It makes it easy to create and generate the flow, which saves lots of time. In addition to that, for people who don’t have that much code experience, Glue’s visual flow facilitates their tasks. Hence, if you work with data, Glue is one of the best services within AWS. In the next chapter, we will create a sample project within AWS using the Python programming language.</p>
</div>
</div></body></html>