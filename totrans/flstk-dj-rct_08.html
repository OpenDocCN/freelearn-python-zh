<html><head></head><body>
		<div><h1 id="_idParaDest-158" class="chapter-number"><a id="_idTextAnchor164"/>8</h1>
			<h1 id="_idParaDest-159"><a id="_idTextAnchor165"/>Social Media Posts</h1>
			<p>Social media already has authentication added on the frontend side. We can now authenticate the user through registration or login, fetch the user data, and show it. Now that we can store JWT tokens, we can make requests to the API for any protected resources, and we will start with the <code>post</code> resource.</p>
			<p>In this chapter, we’ll focus on <strong class="bold">CRUD</strong> operations on posts. We’ll implement listing, creating, updating, and deleting post features. You will learn how to create and manage a Modal in React, how to handle a form from validation to submission, and how to design and integrate components into a React page.</p>
			<p>This chapter will cover the following topics:</p>
			<ul>
				<li>Listing posts in a feed</li>
				<li>Creating a post using a form</li>
				<li>Editing and deleting a post</li>
				<li>Liking a post</li>
			</ul>
			<h1 id="_idParaDest-160"><a id="_idTextAnchor166"/>Technical requirements</h1>
			<p>Make sure to have VS Code and an updated browser installed and configured on your machine. You can find the code of this chapter at <a href="https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap8">https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap8</a>.</p>
			<h1 id="_idParaDest-161"><a id="_idTextAnchor167"/>Creating the UI</h1>
			<p>The REST API is ready to<a id="_idIndexMarker479"/> accept requests and list the API. For the next steps, ensure that the Django server is running on the machine at port <code>localhost:8000</code>. The first step is implementing a post feed with a ready design and UI. Before coding the components for reading, creating, updating, and deleting a component, we need to analyze the UI and also make sure we have the right configurations and components to ease the development with React. We will mostly build the navigation bar and the layout.</p>
			<p>Here’s the feed UI of the home page:</p>
			<div><div><img src="img/Figure_8.01_B18221.jpg" alt="Figure 8.1 – Feed UI wireframe"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Feed UI wireframe</p>
			<p>In the following figure, we<a id="_idIndexMarker480"/> have another illustration representing the UI and the page’s structure. We are using flex columns, and we’ll use Bootstrap flex components to design the page:</p>
			<div><div><img src="img/Figure_8.02_B18221.jpg" alt="Figure 8.2 – Wireframe"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – Wireframe</p>
			<p>The navigation bar will <a id="_idIndexMarker481"/>be available on other pages of the React application, and by making the navigation bar a component, it’ll be reused. We can make the integration of the navigation bar easier by having a <code>Layout</code> component that will be used when building the pages. Let’s start by adding the navigation bar component.</p>
			<h2 id="_idParaDest-162"><a id="_idTextAnchor168"/>Adding the NavBar component</h2>
			<p>The <code>NavBar</code> component, or <a id="_idIndexMarker482"/>the navigation bar component, should<a id="_idIndexMarker483"/> help to quickly navigate the UI. Here’s an screenshot of the <code>NavBar</code> component:</p>
			<div><div><img src="img/Figure_8.03_B18221.jpg" alt="Figure 8.3 – Navbar"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – Navbar</p>
			<p>The <code>NavBar</code> will have three links:</p>
			<ul>
				<li>A link to redirect to the feed page (<strong class="bold">1</strong>)</li>
				<li>A link to redirect to the profile page (<strong class="bold">2</strong>)</li>
				<li>A link to log out (<strong class="bold">3</strong>)</li>
			</ul>
			<p>Here’s a simple wireframe to better illustrate where the links will go.</p>
			<div><div><img src="img/Figure_8.04_B18221.jpg" alt="Figure 8.4 – Wireframe of the navbar"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – Wireframe of the navbar</p>
			<p>Let’s add the <a id="_idIndexMarker484"/>component. Follow these steps to do so:</p>
			<ol>
				<li>Inside the <code>src/components/</code> directory, add a new file called <code>Navbar.jsx</code>. This file will contain the <a id="_idIndexMarker485"/>code for the <code>NavBar</code> component. Bootstrap already provides a <code>NavBar</code> component we can use. Let’s start with the component definition and the necessary imports:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Navbar.jsx</p>
			<pre class="source-code">
import React from "react";
import { randomAvatar } from "../utils";
import { Navbar, Container, Image, NavDropdown, Nav } from "react-bootstrap";
import { useNavigate } from "react-router-dom";
...</pre>
			<ol>
				<li value="2">With the already written function, we can add the <code>NavBar</code> component and style it. <code>react-bootstrap</code> provides components that we can use to make the coding of our components faster. The props that the components require make the customization of these components easier:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Navbar.jsx</p>
			<pre class="source-code">
...
function Navigationbar() {
 return (
   &lt;Navbar bg="primary" variant="dark"&gt;
     &lt;Container&gt;
       &lt;Navbar.Brand className="fw-bold" href="#home"&gt;
         Postagram
       &lt;/Navbar.Brand&gt;
       &lt;Navbar.Collapse
         className="justify-content-end"&gt;
         &lt;Nav&gt;
           &lt;NavDropdown
             title={
               &lt;Image
                 src={randomAvatar()}
                 roundedCircle
                 width={36}
                 height={36}
               /&gt;
             }
           &gt;
             &lt;NavDropdown.Item href="#"&gt;Profile
             &lt;/NavDropdown.Item&gt;
             &lt;NavDropdown.Item onClick={handleLogout}&gt;
               Logout&lt;/NavDropdown.Item&gt;
           &lt;/NavDropdown&gt;
         &lt;/Nav&gt;
       &lt;/Navbar.Collapse&gt;
     &lt;/Container&gt;
   &lt;/Navbar&gt;
 );
}
export default Navigationbar;</pre>
			<ol>
				<li value="3">Let’s add the<a id="_idIndexMarker486"/> function that handles the<a id="_idIndexMarker487"/> logout:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Navbar.jsx</p>
			<pre class="source-code">
...
function Navigationbar() {
 const navigate = useNavigate();
 const handleLogout = () =&gt; {
   localStorage.removeItem("auth");
   navigate("/login/");
 };
...</pre>
			<p>I will use a website that generates random avatars for the avatar. In the next chapter, we’ll do a little exercise to add an upload profile picture feature, but the image generator will do the work for the moment.</p>
			<ol>
				<li value="4">In the <code>src</code> directory, add a new file called <code>utils.js</code>. This file will contain functions that we’ll reuse in the React application:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/utils.js</p>
			<pre class="source-code">
export const randomAvatar = () =&gt;
 `https://i.pravatar.cc/300?img=${Math.floor(Math.random() * 60) + 1}`;</pre>
			<p>The <code>pravatar</code> service supports<a id="_idIndexMarker488"/> parameters in the URL and has over 60 images. We are using the Math library to generate a random number<a id="_idIndexMarker489"/> representing the image’s ID. We can now write the <code>Layout</code> component.</p>
			<h2 id="_idParaDest-163"><a id="_idTextAnchor169"/>Adding the Layout component</h2>
			<p>A good React project has visual<a id="_idIndexMarker490"/> consistency but should also come with less repetition of code. For example, the navigation bar on this React project will be <a id="_idIndexMarker491"/>present on the home page but also on the profile page. When developing in HTML and CSS directly, we would have repeated the same piece of code for the navigation bar, but we can avoid the repetition using React by creating a <code>Layout</code> component.</p>
			<p>In the <code>src/components</code> directory, add a file called <code>Layout.jsx</code>. This file will contain the code for the <code>Layout</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Layout.jsx</p>
			<pre class="source-code">
import React from "react";
import Navigationbar from "./Navbar";
function Layout(props) {
 return (
   &lt;div&gt;
     &lt;Navigationbar /&gt;
     &lt;div className="container m-5"&gt;{props.children}&lt;/div&gt;
   &lt;/div&gt;
 );
}
export default Layout;</pre>
			<p>We have a new syntax here: <code>children</code>. In React, <code>children</code> is used for displaying whatever you include between<a id="_idIndexMarker492"/> the opening and closing tags when<a id="_idIndexMarker493"/> invoking a component. Here’s a simple example with an image component:</p>
			<pre class="console">
const Picture = (props) =&gt; {
  return (
    &lt;div&gt;
      &lt;img src=""/&gt;
      {props.children}
    &lt;/div&gt;
  )
}</pre>
			<p>The component can then be used, and we can add content or other components:</p>
			<pre class="console">
render () {
  return (
    &lt;div className='container'&gt;
      &lt;Picture&gt;
          &lt;p&gt;This a children element.&lt;/p&gt;
      &lt;/Picture&gt;
    &lt;/div&gt;
  )
}</pre>
			<p>Whenever the <code>Picture</code> component is invoked, <code>props.children</code> will also be displayed, which is just a reference to the component’s opening and closing tags. In our context, <code>props.children</code> will contain mostly the content of the pages of the React application.</p>
			<p>For example, on the home<a id="_idIndexMarker494"/> page, we have posts and profiles listed; these elements will be children of the <code>Layout</code> component. Without further ado, let’s<a id="_idIndexMarker495"/> use the <code>Layout</code> component.</p>
			<h2 id="_idParaDest-164"><a id="_idTextAnchor170"/>Using the Layout component on the home page</h2>
			<p>Inside <code>Home.jsx</code>, we’ll rewrite the<a id="_idIndexMarker496"/> code to <a id="_idIndexMarker497"/>use the <code>Layout</code> component. Here’s the <a id="_idIndexMarker498"/>new code:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
import React from "react";
import Layout from "../components/Layout";
function Home() {
 return (
   &lt;Layout&gt;
   &lt;/Layout&gt;
 );
}
export default Home;</pre>
			<p>Great. Let’s start by adding the input to create a new post, as shown in <em class="italic">Figure 8</em><em class="italic">.2</em>.</p>
			<h2 id="_idParaDest-165"><a id="_idTextAnchor171"/>Creating a post</h2>
			<p>To create and add posts, follow these steps:</p>
			<ol>
				<li value="1">In <code>src/components</code>, add a new directory called <code>posts</code>. This directory will contain all <a id="_idIndexMarker499"/>components used for the post feature. We’ll have components to create a post, display a post, and update a post.</li>
				<li>Inside the newly<a id="_idIndexMarker500"/> created directory, add a file called <code>CreatePost.jsx</code>. This file will contain the code for the logic and the UI to make a post.</li>
				<li>What we have here is a UI component called <code>Modal</code>. <code>react-bootstrap</code> provides a modal-ready element that we can easily customize for our needs. Let’s start by adding the needed imports and defining the component function:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/CreatePost.jsx</p>
			<pre class="source-code">
import React, { useState } from "react";
import { Button, Modal, Form } from "react-bootstrap";
import axiosService from "../../helpers/axios";
import { getUser } from "../../hooks/user.actions";
function CreatePost()
  return ()
};
export default CreatePost;</pre>
			<ol>
				<li value="4">The input for the post creation will be within the <code>Modal</code> component. As we did earlier, we will also add methods and state management for the form. But first, let’s write the modal and the clickable input:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/CreatePost.jsx</p>
			<pre class="source-code">
…
function CreatePost() {
 const [show, setShow] = useState(false);
 const handleClose = () =&gt; setShow(false);
 const handleShow = () =&gt; setShow(true);
 return (
   &lt;&gt;
     &lt;Form.Group className="my-3 w-75"&gt;
       &lt;Form.Control
         className="py-2 rounded-pill border-primary
                    text-primary"
         type="text"
         placeholder="Write a post"
         onClick={handleShow}
       /&gt;
     &lt;/Form.Group&gt;
     {/*Add modal code here*/}
   &lt;/&gt;
 );
}
export default CreatePost;</pre>
			<ol>
				<li value="5">We are first adding the<a id="_idIndexMarker501"/> input that will trigger the Modal to be displayed. A click on the modal will set the <code>show</code> state to <code>True</code>, the state that is used for opening the modal. Let’s add<a id="_idIndexMarker502"/> the code for the modal:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/CreatePost.jsx</p>
			<pre class="source-code">
...
     &lt;Modal show={show} onHide={handleClose}&gt;
       &lt;Modal.Header closeButton className="border-0"&gt;
         &lt;Modal.Title&gt;Create Post&lt;/Modal.Title&gt;
       &lt;/Modal.Header&gt;
       &lt;Modal.Body className="border-0"&gt;
         &lt;Form noValidate validated={validated}
           onSubmit={handleSubmit}&gt;
           &lt;Form.Group className="mb-3"&gt;
             &lt;Form.Control
               name="body"
               value={form.body}
               onChange={(e) =&gt; setForm({ ...form,
                 body: e.target.value })}
               as="textarea"
               rows={3}
             /&gt;
           &lt;/Form.Group&gt;
         &lt;/Form&gt;
       &lt;/Modal.Body&gt;
       &lt;Modal.Footer&gt;
         &lt;Button variant="primary"
           onClick={handleSubmit}
           disabled={form.body === undefined}&gt;
           Post
         &lt;/Button&gt;
       &lt;/Modal.Footer&gt;
     &lt;/Modal&gt;
...</pre>
			<ol>
				<li value="6">The UI for the <a id="_idIndexMarker503"/>modal is created. We need now to add the <code>handleSubmit</code> function and the other<a id="_idIndexMarker504"/> logic for the form handling:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/CreatePost.jsx</p>
			<pre class="source-code">
function CreatePost() {
...
 const [validated, setValidated] = useState(false);
 const [form, setForm] = useState({});
 const user = getUser();
...
 const handleSubmit = (event) =&gt; {
   event.preventDefault();
   const createPostForm = event.currentTarget;
   if (createPostForm.checkValidity() === false) {
     event.stopPropagation();
   }
   setValidated(true);
   const data = {
     author: user.id,
     body: form.body,
   };
   axiosService
     .post("/post/", data)
     .then(() =&gt; {
       handleClose();
       setForm({});
     })
     .catch((error) =&gt; {
       console.log(error);
     });
 };
...</pre>
			<div><div><img src="img/Figure_8.05_B18221.jpg" alt="Figure 8.5 – Create Post component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – Create Post component</p>
			<p>We are nearly done, but we<a id="_idIndexMarker505"/> need an essential feature for every action, such as form handling. We need to send feedback to the user to tell them whether their request <a id="_idIndexMarker506"/>has passed. In our context, when a user creates a post, we’ll show a success toast or an error toast:</p>
			<div><div><img src="img/Figure_8.06_B18221.jpg" alt="Figure 8.6 – A successful toast"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – A successful toast</p>
			<p>The toast will be reused for post deletion and also updating. It will also be used for comment creation, modification, and deletion, as well as the profile modification that we will add later. We will add the <code>Toast</code> component in the next section.</p>
			<h2 id="_idParaDest-166"><a id="_idTextAnchor172"/>Adding the Toast component</h2>
			<p>Let’s quickly create a <a id="_idIndexMarker507"/>component called <code>Toaster</code> that we will use show toast in the React application.</p>
			<p>In <code>src/components</code>, create a<a id="_idIndexMarker508"/> new file called <code>Toaster.jsx</code>. This file will contain the code for the <code>Toaster</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Toaster.jsx</p>
			<pre class="source-code">
import React from "react";
import { Toast, ToastContainer } from "react-bootstrap";
function Toaster(props) {
 const { showToast, title, message, onClose, type } =
   props;
 return (
   &lt;ToastContainer position="top-center"&gt;
     &lt;Toast onClose={onClose} show={showToast} delay={3000}
       autohide bg={type}&gt;
       &lt;Toast.Header&gt;
         &lt;strong className="me-auto"&gt;{title}&lt;/strong&gt;
       &lt;/Toast.Header&gt;
       &lt;Toast.Body&gt;
         &lt;p className="text-white"&gt;{message}&lt;/p&gt;
       &lt;/Toast.Body&gt;
     &lt;/Toast&gt;
   &lt;/ToastContainer&gt;
 );
}
export default Toaster;</pre>
			<p>The <code>Toaster</code> component takes some props:</p>
			<ul>
				<li><code>showToast</code>: The Boolean that is used to show the toast or not. Ideally, depending on the output we receive from a request on the server, we’ll set the state to <code>true</code>, which<a id="_idIndexMarker509"/> will show the toast.</li>
				<li><code>title</code>: This represents the title of the toast.</li>
				<li><code>message</code>: This conveys the message we’ll be showing in the toast.</li>
				<li><code>onClose</code>: The function that handles the closing of the toast. This function is essential; otherwise, the toast will never disappear.</li>
				<li><code>type</code>: This represents the type of toast to show. In our context, we’ll either use <code>success</code> or <code>danger</code>.</li>
			</ul>
			<p>Let’s import this component in <code>CreatePost.jsx</code> and use it.</p>
			<h2 id="_idParaDest-167"><a id="_idTextAnchor173"/>Adding toaster to post creation</h2>
			<p>In the <code>CreatePost.jsx</code> file, we will add new <a id="_idIndexMarker510"/>states that we will pass as props to the <code>Toaster</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/CreatePost.jsx</p>
			<pre class="source-code">
…
import Toaster from "../Toaster";
function CreatePost() {
...
 const [showToast, setShowToast] = useState(false);
 const [toastMessage, setToastMessage] = useState("");
 const [toastType, setToastType] = useState("");
...
 const handleSubmit = (event) =&gt; {
   ...
   axiosService
     .post("/post/", data)
     .then(() =&gt; {
       handleClose();
       setToastMessage("Post created 🚀");
       setToastType("success");
       setForm({});
       setShowToast(true);
     })
     .catch(() =&gt; {
       setToastMessage("An error occurred.");
       setToastType("danger");
     });
 };</pre>
			<p>We can import the <code>Toaster</code> component<a id="_idIndexMarker511"/> and pass the newly added states as props:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/CreatePost.jsx</p>
			<pre class="source-code">
...
   &lt;/Modal&gt;
     &lt;Toaster
       title="Post!"
       message={toastMessage}
       showToast={showToast}
       type={toastType}
       onClose={() =&gt; setShowToast(false)}
     /&gt;
   &lt;/&gt;
...</pre>
			<p>And we are done writing the <code>CreatePost</code> component. For the next step, we need to integrate it into the<a id="_idIndexMarker512"/> home page.</p>
			<h2 id="_idParaDest-168"><a id="_idTextAnchor174"/>Adding the CreatePost component to the home page</h2>
			<p>The <code>CreatePost</code> component is<a id="_idIndexMarker513"/> ready now, and we <a id="_idIndexMarker514"/>can use it. First, import it<a id="_idIndexMarker515"/> into the <code>Home.jsx</code> file and modify the UI.</p>
			<p>The home page will have two parts:</p>
			<ul>
				<li>The first part will contain the list of posts (<strong class="bold">1</strong> in <em class="italic">Figure 8</em><em class="italic">.7</em>)</li>
				<li>The second part will include a list of five profiles (<strong class="bold">2</strong> in <em class="italic">Figure 8</em><em class="italic">.7</em>)</li>
			</ul>
			<div><div><img src="img/Figure_8.07_B18221.jpg" alt="Figure 8.7 – Structure of the home page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7 – Structure of the home page</p>
			<p>We can achieve the result quickly by using rows and columns components provided by <code>react-bootstrap</code>. We won’t <a id="_idIndexMarker516"/>focus on the<a id="_idIndexMarker517"/> second part (listing the profiles) for the moment. Let’s ensure we have all <strong class="bold">CRUD</strong> operations for<a id="_idIndexMarker518"/> the post feature:</p>
			<ol>
				<li value="1">Inside the <code>Home.jsx</code> file, add the following content. We’ll start by importing and adding the rows:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
import React from "react";
import Layout from "../components/Layout";
import { Row, Col, Image } from "react-bootstrap";
import { randomAvatar } from "../utils";
import useSWR from "swr";
import { fetcher } from "../helpers/axios";
import { getUser } from "../hooks/user.actions";
import CreatePost from "../components/posts/CreatePost";
function Home() {
 const user = getUser();
 if (!user) {
   return &lt;div&gt;Loading!&lt;/div&gt;;
 }
 return (
   &lt;Layout&gt;
     &lt;Row className="justify-content-evenly"&gt;
       &lt;Col sm={7}&gt;
         &lt;Row className="border rounded
           align-items-center"&gt;
           &lt;Col className="flex-shrink-1"&gt;
             &lt;Image
               src={randomAvatar()}
               roundedCircle
               width={52}
               height={52}
               className="my-2"
             /&gt;
           &lt;/Col&gt;
           &lt;Col sm={10} className="flex-grow-1"&gt;
             &lt;CreatePost /&gt;
           &lt;/Col&gt;
         &lt;/Row&gt;
       &lt;/Col&gt;
     &lt;/Row&gt;
   &lt;/Layout&gt;
 );
}
export default Home;</pre>
			<ol>
				<li value="2">Great! Make sure<a id="_idIndexMarker519"/> to save the<a id="_idIndexMarker520"/> changes, start the<a id="_idIndexMarker521"/> server, and go to the home page. You’ll have something similar to this:</li>
			</ol>
			<div><div><img src="img/Figure_8.08_B18221.jpg" alt="Figure 8.8 – Create Post UI"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.8 – Create Post UI</p>
			<ol>
				<li value="3">Click on the<a id="_idIndexMarker522"/> input, and a modal will show up. Type anything you want in the input and submit it. The <a id="_idIndexMarker523"/>modal will close, and<a id="_idIndexMarker524"/> you’ll have a toast appearing at the top center of the page:</li>
			</ol>
			<div><div><img src="img/Figure_8.09_B18221.jpg" alt="Figure 8.9 – Toast after successful post creation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.9 – Toast after successful post creation</p>
			<p>Great! We can now create posts using our React application. To make it possible, we have created a <code>Modal</code> component and a form with React Bootstrap to handle data validation and submission. And because feedback is an important aspect of user experience, we have added a toaster with React Bootstrap and integrated it with the <code>useContext</code> Hook to notify the user of the result of the requests.</p>
			<p>The next step is to list all the<a id="_idIndexMarker525"/> posts and add actions such as deletion and modification.</p>
			<h1 id="_idParaDest-169"><a id="_idTextAnchor175"/>Listing posts on the home page</h1>
			<p>Now that users can create posts, we need to list the posts on the home page but also allow the user to access them. This<a id="_idIndexMarker526"/> will require the creation of a component to display information about a post. As shown in <em class="italic">Figure 8</em><em class="italic">.1</em>, under the <strong class="bold">Write a post</strong> input, we have a list of posts. The home page structure is already added, so we need to add a component that will handle the logic behind showing information about a post.</p>
			<p>Here’s the flow to list the posts on the home page:</p>
			<ul>
				<li>We use the <code>swr</code> library to fetch a list of posts</li>
				<li>We loop through the list of posts and then pass a post as props to a component called <code>Post</code>, which will show data about a post</li>
			</ul>
			<p>Before starting to fetch data, let’s create the <code>Post</code> component.</p>
			<h2 id="_idParaDest-170"><a id="_idTextAnchor176"/>Writing the Post component</h2>
			<p>To create a <code>Post</code> component, follow these<a id="_idIndexMarker527"/> steps:</p>
			<ol>
				<li value="1">Inside the <code>src/components/post/</code> directory, create a new file called <code>Post.jsx</code>. This file will contain the logic to show post data and logic such as like or remove like, deletion, and modification. Here’s a wireframe of the <code>Post</code> component:</li>
			</ol>
			<div><div><img src="img/Figure_8.10_B18221.jpg" alt="Figure 8.10 – Post component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.10 – Post component</p>
			<ol>
				<li value="2">To make things faster, we will work with<a id="_idIndexMarker528"/> the <code>Card</code> component provided by <code>react-bootstrap</code>. The <code>Card</code> component comes with a structure containing a title, body, and footer:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
import React, { useState } from "react";
import { format } from "timeago.js";
import {
 LikeFilled,
 CommentOutlined,
 LikeOutlined,
} from "@ant-design/icons";
import { Image, Card, Dropdown } from "react-bootstrap";
import { randomAvatar } from "../../utils";
function Post(props) {
 const { post, refresh } = props;
 const handleLikeClick = (action) =&gt; {
   axiosService
     .post(`/post/${post.id}/${action}/`)
     .then(() =&gt; {
       refresh();
     })
     .catch((err) =&gt; console.error(err));
 };
 return (
   &lt;&gt;
     &lt;Card className="rounded-3 my-4"&gt;
      {/* Add card body here*/}
     &lt;/Card&gt;
   &lt;/&gt;
 );
}
export default Post;</pre>
			<p>The <code>Post</code> component <a id="_idIndexMarker529"/>accepts two props:</p>
			<ul>
				<li>The <code>post</code> object containing data about a post.</li>
				<li>The <code>refresh</code> function. This function will come from the SWR <code>posts</code> object, and SWR returns an object with a <code>mutate</code> method that can be used to trigger the fetching of data.</li>
			</ul>
			<ol>
				<li value="3">We also profited from adding the <code>handleLikeClick</code> function. Two actions can be passed to the function: either <code>like</code> or <code>remove_like</code>. If the request succeeds, we can refresh the posts. Great! Let’s start by adding the <code>Card</code> body. It’ll contain the avatar<a id="_idIndexMarker530"/> of the author of the post, the name, and the time elapsed since the creation of the post:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
…
&lt;Card.Body&gt;
         &lt;Card.Title className="d-flex flex-row
           justify-content-between"&gt;
           &lt;div className="d-flex flex-row"&gt;
             &lt;Image
               src={randomAvatar()}
               roundedCircle
               width={48}
               height={48}
               className="me-2 border border-primary
                          border-2"
             /&gt;
             &lt;div className="d-flex flex-column
               justify-content-start
               align-self-center mt-2"&gt;
               &lt;p className="fs-6 m-0"&gt;
                 {post.author.name}&lt;/p&gt;
               &lt;p className="fs-6 fw-lighter"&gt;
                 &lt;small&gt;{format(post.created)}&lt;/small&gt;
               &lt;/p&gt;
             &lt;/div&gt;
           &lt;/div&gt;
         &lt;/Card.Title&gt;
       &lt;/Card.Body&gt;
...</pre>
			<ol>
				<li value="4">Go ahead and add the body<a id="_idIndexMarker531"/> of the post and the likes count:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
…
         &lt;/Card.Title&gt;
         &lt;Card.Text&gt;{post.body}&lt;/Card.Text&gt;
         &lt;div className="d-flex flex-row"&gt;
           &lt;LikeFilled
             style={{
               color: "#fff",
               backgroundColor: "#0D6EFD",
               borderRadius: "50%",
               width: "18px",
               height: "18px",
               fontSize: "75%",
               padding: "2px",
               margin: "3px",
             }}
           /&gt;
           &lt;p className="ms-1 fs-6"&gt;
             &lt;small&gt;{post.likes_count} like&lt;/small&gt;
           &lt;/p&gt;
         &lt;/div&gt;
       &lt;/Card.Body&gt;
...</pre>
			<ol>
				<li value="5">We can now move to the <code>Card</code> footer containing the like and comment UI. Let’s start by adding the <strong class="bold">Like </strong>icon followed <a id="_idIndexMarker532"/>by text:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
...
       &lt;/Card.Body&gt;
       &lt;Card.Footer className="d-flex bg-white w-50
         justify-content-between border-0"&gt;
         &lt;div className="d-flex flex-row"&gt;
           &lt;LikeOutlined
             style={{
               width: "24px",
               height: "24px",
               padding: "2px",
               fontSize: "20px",
               color: post.liked ? "#0D6EFD" :
                 "#C4C4C4",
             }}
             onClick={() =&gt; {
               if (post.liked) {
                 handleLikeClick("remove_like");
               } else {
                 handleLikeClick("like");
               }
             }}
           /&gt;
           &lt;p className="ms-1"&gt;
             &lt;small&gt;Like&lt;/small&gt;
           &lt;/p&gt;
         &lt;/div&gt;
 {/* Add comment icon here*/}
       &lt;/Card.Footer&gt;
     &lt;/Card&gt;
...</pre>
			<ol>
				<li value="6">Now go ahead and <a id="_idIndexMarker533"/>add the <strong class="bold">Comment</strong> icon followed by the text:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
...
         &lt;div className="d-flex flex-row"&gt;
           &lt;CommentOutlined
             style={{
               width: "24px",
               height: "24px",
               padding: "2px",
               fontSize: "20px",
               color: "#C4C4C4",
             }}
           /&gt;
           &lt;p className="ms-1 mb-0"&gt;
             &lt;small&gt;Comment&lt;/small&gt;
           &lt;/p&gt;
         &lt;/div&gt;
       &lt;/Card.Footer&gt;
...</pre>
			<p>The <code>Post</code> component is entirely <a id="_idIndexMarker534"/>written; we can use it on the home page now.</p>
			<h2 id="_idParaDest-171"><a id="_idTextAnchor177"/>Adding the Post component to the home page</h2>
			<p>Let’s now<a id="_idIndexMarker535"/> add our <code>Post</code> component to <a id="_idIndexMarker536"/>the home page.</p>
			<p>In the <code>Home.jsx</code> file, import the <code>Post</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
...
import { Post } from "../components/posts";
...</pre>
			<p>We can now use the components in the code by first fetching posts from the server:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
...
function Home() {
 const posts = useSWR("/post/", fetcher, {
   refreshInterval: 10000,
 });
...</pre>
			<p>The <code>useSWR</code> Hook can accept some parameters, such as <code>refreshInterval</code>. Here, the returned data is<a id="_idIndexMarker537"/> refreshed every 10 seconds. We can now use these objects in the UI:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
...
           &lt;Col sm={10} className="flex-grow-1"&gt;
             &lt;CreatePost /&gt;
           &lt;/Col&gt;
         &lt;/Row&gt;
         &lt;Row className="my-4"&gt;
           {posts.data?.results.map((post, index) =&gt; (
             &lt;Post key={index} post={post}
               refresh={posts.mutate} /&gt;
           ))}
         &lt;/Row&gt;
       &lt;/Col&gt;
...</pre>
			<p>Great! After adding the <code>Post</code> component to the home page, you should have a similar result to this:</p>
			<div><div><img src="img/Figure_8.11_B18221.jpg" alt="Figure 8.11 – List of posts"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.11 – List of posts</p>
			<p>You can click on the <code>Post</code> component has a <strong class="bold">More</strong> dropdown in the top-right corner:</p>
			<div><div><img src="img/Figure_8.12_B18221.jpg" alt="Figure 8.12 – Adding the more dropdown"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.12 – Adding the more dropdown</p>
			<p><code>react-bootstrap</code> provides a <code>Dropdown</code> component we can use to achieve the same result. In the <code>Post.jsx</code> file, import the <code>Dropdown</code> component from <code>react-bootstrap</code>. As we will add the logic for post deletion, let’s also import the <code>Toaster</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
import { Button, Modal, Form, Dropdown } from "react-bootstrap";
import Toaster from "../Toaster";
...</pre>
			<p>We then have to write the<a id="_idIndexMarker539"/> component we will pass to the <code>Dropdown</code> component as the title:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
…
const MoreToggleIcon = React.forwardRef(({ onClick }, ref) =&gt; (
 &lt;Link
   to="#"
   ref={ref}
   onClick={(e) =&gt; {
     e.preventDefault();
     onClick(e);
   }}
 &gt;
   &lt;MoreOutlined /&gt;
 &lt;/Link&gt;
));
function Post(props) {
...</pre>
			<p>We can now add the <code>Dropdown</code> component to the UI. We need to make it conditional so that only the author of the post can access these options. We will just retrieve the user from <code>localStorage</code> and<a id="_idIndexMarker540"/> compare <code>user.id</code> to <code>author.id</code>:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
...
function Post(props) {
...
 const [showToast, setShowToast] = useState(false);
 const user = getUser();
...
 const handleDelete = () =&gt; {
   axiosService
     .delete(`/post/${post.id}/`)
     .then(() =&gt; {
       setShowToast(true);
       refresh();
     })
     .catch((err) =&gt; console.error(err));
 };
 return (
 ...</pre>
			<p>Let’s add the component UI and the <code>Toaster</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
...
     &lt;Card className="rounded-3 my-4"&gt;
       &lt;Card.Body&gt;
         &lt;Card.Title className="d-flex flex-row
           justify-content-between"&gt;
           ...
           {user.name === post.author.name &amp;&amp; (
             &lt;div&gt;
               &lt;Dropdown&gt;
                 &lt;Dropdown.Toggle as={MoreToggleIcon}&gt;
                 &lt;/Dropdown.Toggle&gt;
                 &lt;Dropdown.Menu&gt;
                   &lt;Dropdown.Item&gt;Update&lt;/&gt;
                   &lt;Dropdown.Item
                     onClick={handleDelete}
                     className="text-danger"
                   &gt;
                     Delete
                   &lt;/Dropdown.Item&gt;
                 &lt;/Dropdown.Menu&gt;
               &lt;/Dropdown&gt;
             &lt;/div&gt;
           )}
         &lt;/Card.Title&gt;
         ...
     &lt;/Card&gt;
     &lt;Toaster
       title="Post!"
       message="Post deleted"
       type="danger"
       showToast={showToast}
       onClose={() =&gt; setShowToast(false)}
     /&gt;
   &lt;/&gt;
 );
}
export default Post;</pre>
			<p>The <code>Dropdown</code> component is<a id="_idIndexMarker541"/> also added to the toaster. Each time a post is deleted, a red toaster will pop up at the top center of the page:</p>
			<div><div><img src="img/Figure_8.13_B18221.jpg" alt="Figure 8.13 – Deleting a post"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.13 – Deleting a post</p>
			<p>The user can now delete their own post and the functionality is accessible directly from the <code>Post</code> component. We have explored how to use the <code>UseContex</code> Hook again and also how to create a dropdown using <code>react-bootstrap</code>.</p>
			<p>The <strong class="bold">CRUD</strong> operations on the post feature are nearly done and only the update feature remains. It’s easy, and you will implement it as a small exercise, but I’ll add the necessary code and instructions to<a id="_idIndexMarker542"/> follow.</p>
			<h1 id="_idParaDest-172"><a id="_idTextAnchor178"/>Updating a post</h1>
			<p>As mentioned earlier, the implementation of this<a id="_idIndexMarker543"/> feature is a simple exercise. Here’s the flow the user will typically follow when modifying a post:</p>
			<ol>
				<li value="1">Click on the <strong class="bold">More</strong> dropdown menu.</li>
				<li>Select the <strong class="bold">Modify</strong> option.</li>
				<li>A modal is shown with the body of the post, and the user can modify it.</li>
				<li>Once it’s done, the user saves, and the modal is closed.</li>
				<li>A toast will pop up with the content <strong class="bold">Post </strong><strong class="bold">updated </strong><strong class="bold">🚀</strong>.</li>
			</ol>
			<p>The feature is similar to <code>CreatePost.jsx</code>; the difference is that the <code>UpdatePost</code> component will receive a <code>post</code> object as props. Here’s the skeleton of the code:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/UpdatePost.jsx</p>
			<pre class="source-code">
import React, { useState } from "react";
import { Button, Modal, Form, Dropdown } from "react-bootstrap";
import axiosService from "../../helpers/axios";
import Toaster from "../Toaster";
function UpdatePost(props) {
 const { post, refresh } = props;
 const [show, setShow] = useState(false);
 const handleClose = () =&gt; setShow(false);
 const handleShow = () =&gt; setShow(true);
 // Add form handling logic here
 return (
   &lt;&gt;
     &lt;Dropdown.Item onClick={handleShow}&gt;Modify
     &lt;/Dropdown.Item&gt;
     &lt;Modal show={show} onHide={handleClose}&gt;
     {/*Add UI code here*/}
     &lt;/Modal&gt;
   &lt;/&gt;
 );
}
export default UpdatePost;</pre>
			<p>The component is <a id="_idIndexMarker544"/>called in the <code>Post.jsx</code> file and used like this:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/post/Post.jsx</p>
			<pre class="source-code">
...
import UpdatePost from "./UpdatePost";
...
           &lt;/div&gt;
           {user.name === post.author.name &amp;&amp; (
             &lt;div&gt;
               &lt;Dropdown&gt;
                 &lt;Dropdown.Toggle as={MoreToggleIcon}&gt;
                 &lt;/Dropdown.Toggle&gt;
                 &lt;Dropdown.Menu&gt;
                   &lt;UpdatePost post={post}
                     refresh={refresh} /&gt;
                   &lt;Dropdown.Item
                     onClick={handleDelete}
                     className="text-danger"
                   &gt;
                     Delete
                   &lt;/Dropdown.Item&gt;
                 &lt;/Dropdown.Menu&gt;
               &lt;/Dropdown&gt;
             &lt;/div&gt;
           )}
...</pre>
			<p>Good luck with the exercise. You can find the solution at <a href="https://github.com/PacktPublishing/Full-stack-Django-and-React/blob/main/social-media-react/src/components/posts/UpdatePost.jsx">https://github.com/PacktPublishing/Full-stack-Django-and-React/blob/main/social-media-react/src/components/posts/UpdatePost.jsx</a>.</p>
			<h1 id="_idParaDest-173"><a id="_idTextAnchor179"/>Minor refactoring</h1>
			<p>Firstly, there is no refresh made when a new post is created. As we did for the <code>UpdatePost.jsx</code> component, we can also pass some props to the <code>CreatePost</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Home.jsx</p>
			<pre class="source-code">
...
           &lt;Col sm={10} className="flex-grow-1"&gt;
             &lt;CreatePost refresh={posts.mutate} /&gt;
           &lt;/Col&gt;
...</pre>
			<p>And, we can call the <code>refresh</code> method when a post is successfully created:. </p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/posts/CreatePost.jsx</p>
			<pre class="source-code">
function CreatePost(props) {
  const { refresh } = props;
  ...
    axiosService
      .post("/post/", data)
      .then(() =&gt; {
     ...
        setForm({});
        setShowToast(true);
        refresh();
      })
...</pre>
			<p>Now, every time a user adds a post, he will see the newly created post on the Home page without the need of reloading the page.</p>
			<p>Secondly, the <code>Toaster</code> component is created <a id="_idIndexMarker545"/>but we need to think about how to call the component in the project. Let’s not forget that this component is created to return feedback to the user about a successful or failed request, thus the component should be reusable in the whole project, which is what we've actually done, right?</p>
			<p>Well, no, and this is not desirable as it will violate the <code>Toaster</code> component higher in the component hierarchy and then be able to call or show the toaster from any child component?</p>
			<div><div><img src="img/Figure_8.14_B18221.jpg" alt="Figure 8.14 – Parent and child components"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.14 – Parent and child components</p>
			<p>In the preceding figure, we will be<a id="_idIndexMarker546"/> able to trigger the display of a toaster in the project directly in a parent component from a child component (<code>CreatePost</code>). React provides an interesting way to manage state across parents and child components and this is called context. <code>Layout.jsx</code> file, create a new context using the <code>createContext</code> method:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Layout.jsx</p>
			<pre class="source-code">
import React, { createContext, useMemo, useState } from "react";
export const Context = createContext("unknown");
function Layout(props) {</pre>
			<p>Then in the <code>Layout</code> component scope, let’s define the state containing the data that the toaster will use to display information. We<a id="_idIndexMarker548"/> will also wrap the component JSX content inside the <code>Context</code> component and add a method to modify the state from any child components of the <code>Layout</code> component:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/Layout.jsx</p>
			<pre class="source-code">
function Layout(props) {
  ...
  const [toaster, setToaster] = useState({
   title: "",
   show: false,
   message: "",
   type: "",
 });
 const value = useMemo(() =&gt; ({ toaster, setToaster }),
                                [toaster]);
 ...
 return (
   &lt;Context.Provider value={value}&gt;
     &lt;div&gt;
       &lt;NavigationBar /&gt;
       {hasNavigationBack &amp;&amp; (
         &lt;ArrowLeftOutlined
           style={{
             color: "#0D6EFD",
             fontSize: "24px",
             marginLeft: "5%",
             marginTop: "1%",
           }}
           onClick={() =&gt; navigate(-1)}
         /&gt;
       )}
       &lt;div className="container my-2"&gt;
         {props.children}&lt;/div&gt;
     &lt;/div&gt;
     &lt;Toaster
       title={toaster.title}
       message={toaster.message}
       type={toaster.type}
       showToast={toaster.show}
       onClose={() =&gt; setToaster({ ...toaster, show: false
         })}
     /&gt;
   &lt;/Context.Provider&gt;
 );
}
export default Layout;</pre>
			<p>In the preceding code, we have introduced a new function Hook called <code>useMemo</code>, which helps to memorize the<a id="_idIndexMarker549"/> context value (caching the value of the context) and avoid the creation of new objects every time there is a re-rendering of the <code>Layout</code> component.</p>
			<p>We will then be able to access the <code>toaster</code> state and call the <code>setToaster</code> function from any child component:</p>
			<pre class="source-code">
 const { toaster, setToaster } = useContext(Context);</pre>
			<h1 id="_idParaDest-174"><a id="_idTextAnchor180"/>Summary</h1>
			<p>In this chapter, we’ve gone deeper into React programming by creating the components needed for the CRUD operations used in the post feature. We have covered concepts such as props passing, parent-children component creation, UI component customization, and modal creation. That led to the partial completion of the home page of the <code>Postagram</code> project. We also learned more about the <code>useState</code> and <code>useContext</code> Hooks and how they affect state in React. We have also learned how to create a <code>Dropdown</code> component, how to create a custom toaster, and the importance of layout in a React project.</p>
			<p>In the next chapter, we’ll focus on the CRUD operations of the comment feature. This will lead us to add a <strong class="bold">Profile</strong> page and a <strong class="bold">Post</strong> page to display comments. We’ll also make simple and quick assessments to add Like features to the comments too.</p>
			<h1 id="_idParaDest-175"><a id="_idTextAnchor181"/>Questions</h1>
			<ol>
				<li value="1">What is a modal?</li>
				<li>What is a prop?</li>
				<li>What is a children element in React?</li>
				<li>What is a wireframe?</li>
				<li>What is the map method used in JSX?</li>
				<li>What is the usage of the <code>mutate</code> method on SWR objects?</li>
			</ol>
		</div>
		<div><div></div>
		</div>
	</body></html>