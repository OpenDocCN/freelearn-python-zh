<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer311">
    <h1 class="chapterNumber">16</h1>
    <h1 class="chapterTitle" id="_idParaDest-315">Test-Driven Development for Networks</h1>
    <p class="normal">In the previous chapters, we used Python to communicate with network devices, monitor and secure a network, automate processes, and extend an on-premises network to public cloud providers. We have come a long way from having to exclusively use a terminal window and manage the network with a CLI. When working together, the services we have built function like a well-oiled machine that gives us a beautiful, automated, programmable network. However, the network is never static and is constantly changing to meet the demands of the business. What happens when the services we build are not working optimally? As we have done with monitoring and source control systems, we are actively trying to detect faults.</p>
    <p class="normal">In this chapter, we are extending the active detection concept with <strong class="keyWord">test-driven development</strong> (<strong class="keyWord">TDD</strong>). We will cover the following topics:</p>
    <ul>
      <li class="bulletList">An overview of TDD</li>
      <li class="bulletList">Topology as code</li>
      <li class="bulletList">Writing tests for networking</li>
      <li class="bulletList">pyATS and Genie</li>
    </ul>
    <p class="normal">We’ll begin this chapter with an overview of TDD before diving into its applications within networks. We will look at examples of using Python with TDD and gradually move from specific tests to larger network-based tests.</p>
    <h1 class="heading-1" id="_idParaDest-316">Test-driven development overview</h1>
    <p class="normal">The idea of TDD<a id="_idIndexMarker1163"/> has been around for a while. American software engineer Kent Beck, among others, is credited with leading the TDD movement, along with agile software development. Agile software development requires very short build-test-deploy development cycles; all software requirements are turned into test cases. These test cases are usually written before the code is written, and the software code is only accepted when the test passes.</p>
    <p class="normal">The same idea can be drawn in parallel with network engineering. For example, when we face the challenge of designing a modern network, we can break the process down into the following steps, from high-level design requirements to the network tests that we can deploy:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">We start with the overall requirement for the new network. Why do we need to design a new network or part of a new network? Maybe it is for new server hardware, a new storage network, or new microservice software architecture.</li>
      <li class="numberedList">The new requirements are broken down into smaller, more specific requirements. This could be evaluating a new switch platform, testing a possibly more efficient routing protocol, or a new network topology (for example, fat-tree). Each of the smaller requirements can be broken down into the categories of <strong class="keyWord">required</strong> or <strong class="keyWord">optional</strong>.</li>
      <li class="numberedList">We draw out the test plan and evaluate it against the potential candidates for solutions.</li>
      <li class="numberedList">The test plan will work in reverse order; we will start by testing the features, then integrate the new feature into a bigger topology. Finally, we will try to run our test close to a production environment.</li>
    </ol>
    <p class="normal">What I am trying to get at is that, even without realizing it, we might already be adopting some of the TDD methodologies in the normal network engineering process. This was part of my revelation when I was studying the TDD mindset. We are already implicitly following this best practice without formalizing the method.</p>
    <p class="normal">By gradually moving parts of the network to code, we can use TDD for the network even more. If our network topology is described in a hierarchical format in XML or JSON, each component can be correctly mapped and expressed in the desired state, which some might call “the source of truth.” This is the desired state that we can write test cases against to test production deviation from this state. For example, if our desired state calls for a full mesh of iBGP neighbors, we can always write a test case to check against our production devices for the number of iBGP neighbors it has.</p>
    <p class="normal">The sequence<a id="_idIndexMarker1164"/> of TDD is loosely based on the following six steps:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Write a test with the result in mind</li>
      <li class="numberedList">Run all tests and see whether the new test fails</li>
      <li class="numberedList">Write the code</li>
      <li class="numberedList">Run the test again</li>
      <li class="numberedList">Make the necessary changes if the test fails</li>
      <li class="numberedList">Repeat</li>
    </ol>
    <p class="normal">As with any process, how closely we follow the guideline is a judgment call. I prefer to treat these guidelines as goals and follow them somewhat loosely. For example, the TDD process calls for writing test cases before writing any code or, in our instance, before any network components are built. As a personal preference, I always like to see a working version of the network or code before writing test cases. It gives me a higher level of confidence, so if anybody is judging my TDD process, I might just get a big fat “F.” I also like to jump around between different levels of testing; sometimes, I test a small portion of the network, Other times, I conduct a system-level end-to-end test, such as a ping or traceroute test.</p>
    <p class="normal">The point is I do not believe<a id="_idIndexMarker1165"/> there is a one-size-fits-all approach to testing. It depends on personal preference and the scope of the project. This is true for most of the engineers I have worked with. It is a good idea to keep the framework in mind so we have a working blueprint to follow, but you are the best judge of your problem-solving style.</p>
    <p class="normal">Before we delve further into TDD, let’s cover some of the most common terminologies in the following section so that we have a good conceptual grounding before getting into more details.</p>
    <h2 class="heading-2" id="_idParaDest-317">Test definitions</h2>
    <p class="normal">Let’s look at some of the terms<a id="_idIndexMarker1166"/> commonly used in TDD:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Unit test</strong>: Checks a small piece of code. This<a id="_idIndexMarker1167"/> is a test that is run against a single function or class.</li>
      <li class="bulletList"><strong class="keyWord">Integration test</strong>: Checks multiple components<a id="_idIndexMarker1168"/> of a code base; multiple units are combined and tested as a group. This can be a test that checks against a Python module or multiple modules.</li>
      <li class="bulletList"><strong class="keyWord">System test</strong>: Checks from end to end. This is a test <a id="_idIndexMarker1169"/>that runs as close to what an end user would see as possible.</li>
      <li class="bulletList"><strong class="keyWord">Functional test</strong>: Checks against a single<a id="_idIndexMarker1170"/> function.</li>
      <li class="bulletList"><strong class="keyWord">Test coverage</strong>: A term defined as the determination<a id="_idIndexMarker1171"/> of whether our test cases cover the application code. This is typically done by examining how much code is exercised when we run the test cases.</li>
      <li class="bulletList"><strong class="keyWord">Test fixtures</strong>: A fixed state that forms a baseline<a id="_idIndexMarker1172"/> for running our tests. The purpose of a test fixture is to ensure there is a well-known and fixed environment in which tests are run so they are repeatable.</li>
      <li class="bulletList"><strong class="keyWord">Setup and teardown</strong>: All the prerequisite steps<a id="_idIndexMarker1173"/> are added in the setup and cleaned up in the teardown.</li>
    </ul>
    <p class="normal">The terms might seem very software development-centric, and some might not be relevant to network engineering. Remember that the terms are a way for us to communicate a concept or step. We will be using these terms in the rest of this chapter. As we use the terms more in the network engineering context, they might become clearer. With that covered, let’s dive into treating network topology as code.</p>
    <h1 class="heading-1" id="_idParaDest-318">Topology as code</h1>
    <p class="normal">When we discuss topology as code, an engineer<a id="_idIndexMarker1174"/> might jump up and declare: “The network is too complex. It is impossible to summarize it into code!” From personal experience, this has happened in some of the meetings I have been in. In the meeting, we would have a group of software engineers who want to treat infrastructure as code, but the traditional network engineers in the room would declare that it was impossible. Before you do the same and yell at me across the pages of this book, let’s keep an open mind. Would it help if I told you we have been using code to describe our topology in this book already?</p>
    <p class="normal">If you take a look at any of the lab topology files that we have been using in this book, they are simply YAML files that include a description of the relationship between nodes. For example, in this chapter, we will use same topology we have been using for the last few chapters:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B18403_16_01.png"/></figure>
    <p class="packt_figref">Figure 16.1: Lab Topology</p>
    <p class="normal">If we open<a id="_idIndexMarker1175"/> up the topology file, <code class="inlineCode">chapter16_topology.yaml</code>, with a text editor, we will see that the file is a YAML file describing the node and the links between the nodes:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">lab:</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Imported</span> <span class="hljs-string">from</span> <span class="hljs-string">2_DC_Topology.virl</span>
  <span class="hljs-attr">notes:</span> <span class="hljs-string">|-</span>
    <span class="hljs-comment">## Import Progress</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">processing</span> <span class="hljs-string">node</span> <span class="hljs-string">/lax-edg-r1</span> <span class="hljs-string">(iosv)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">processing</span> <span class="hljs-string">node</span> <span class="hljs-string">/lax-edg-r2</span> <span class="hljs-string">(iosv)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">processing</span> <span class="hljs-string">node</span> <span class="hljs-string">/nyc-edg-r1</span> <span class="hljs-string">(iosv)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">processing</span> <span class="hljs-string">node</span> <span class="hljs-string">/nyc-edg-r2</span> <span class="hljs-string">(iosv)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">processing</span> <span class="hljs-string">node</span> <span class="hljs-string">/lax-cor-r1</span> <span class="hljs-string">(nxosv)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">processing</span> <span class="hljs-string">node</span> <span class="hljs-string">/nyc-cor-r1</span> <span class="hljs-string">(nxosv)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">link</span> <span class="hljs-string">GigabitEthernet0/1.lax-edg-r1</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Ethernet2/1.lax-cor-r1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">link</span> <span class="hljs-string">GigabitEthernet0/1.lax-edg-r2</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Ethernet2/2.lax-cor-r1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">link</span> <span class="hljs-string">GigabitEthernet0/1.nyc-edg-r1</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Ethernet2/1.nyc-cor-r1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">link</span> <span class="hljs-string">GigabitEthernet0/1.nyc-edg-r2</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Ethernet2/2.nyc-cor-r1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">link</span> <span class="hljs-string">Ethernet2/3.lax-cor-r1</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Ethernet2/3.nyc-cor-r1</span>
  <span class="hljs-attr">timestamp:</span> <span class="hljs-number">1615749425.6802542</span>
  <span class="hljs-attr">title:</span> <span class="hljs-string">2_DC_Topology.yaml</span>
  <span class="hljs-attr">version:</span> <span class="hljs-number">0.0.4</span> 
</code></pre>
    <p class="normal">The node section include each of the node’s id, label, definition, and configurations: </p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">nodes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">n0</span>
    <span class="hljs-attr">label:</span> <span class="hljs-string">lax-edg-r1</span>
    <span class="hljs-attr">node_definition:</span> <span class="hljs-string">iosv</span>
    <span class="hljs-attr">x:</span> <span class="hljs-number">-100</span>
    <span class="hljs-attr">y:</span> <span class="hljs-number">200</span>
    <span class="hljs-attr">configuration:</span> <span class="hljs-string">|-</span>
      <span class="hljs-string">!</span>
      <span class="hljs-string">!</span> <span class="hljs-string">Last</span> <span class="hljs-string">configuration</span> <span class="hljs-string">change</span> <span class="hljs-string">at</span> <span class="hljs-number">02</span><span class="hljs-string">:26:08</span> <span class="hljs-string">UTC</span> <span class="hljs-string">Fri</span> <span class="hljs-string">Apr</span> <span class="hljs-number">17</span> <span class="hljs-number">2020 </span><span class="hljs-string">by</span> <span class="hljs-string">cisco</span>
      <span class="hljs-string">!</span>
      <span class="hljs-string">version</span> <span class="hljs-number">15.6</span>
      <span class="hljs-string">service</span> <span class="hljs-string">timestamps</span> <span class="hljs-string">debug</span> <span class="hljs-string">datetime</span> <span class="hljs-string">msec</span>
      <span class="hljs-string">service</span> <span class="hljs-string">timestamps</span> <span class="hljs-string">log</span> <span class="hljs-string">datetime</span> <span class="hljs-string">msec</span>
      <span class="hljs-literal">no</span> <span class="hljs-string">service</span> <span class="hljs-string">password-encryption</span>
      <span class="hljs-string">!</span>
      <span class="hljs-string">hostname</span> <span class="hljs-string">lax-edg-r1</span>
      <span class="hljs-string">!</span>
      <span class="hljs-string">boot-start-marker</span>
      <span class="hljs-string">boot-end-marker</span>
      <span class="hljs-string">!</span>
      <span class="hljs-string">!</span>
      <span class="hljs-string">vrf</span> <span class="hljs-string">definition</span> <span class="hljs-string">Mgmt-intf</span>
       <span class="hljs-string">!</span>
       <span class="hljs-string">address-family</span> <span class="hljs-string">ipv4</span>
       <span class="hljs-string">exit-address-family</span>
       <span class="hljs-string">!</span>
<span class="hljs-string">&lt;skip&gt;</span>
</code></pre>
    <p class="normal">If we open up the previous chapter’s lab topology file, which contain Linux nodes, we can see the Linux host nodes can be described the same way as the network nodes:</p>
    <pre class="programlisting code"><code class="hljs-code">  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">n5</span>
    <span class="hljs-attr">label:</span> <span class="hljs-string">Client</span>
    <span class="hljs-attr">node_definition:</span> <span class="hljs-string">server</span>
    <span class="hljs-attr">x:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">y:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">configuration:</span> <span class="hljs-string">|-</span>
      <span class="hljs-comment"># converted cloud-config</span>
      <span class="hljs-string">hostname</span> <span class="hljs-string">Client</span>
      <span class="hljs-string">ifconfig</span> <span class="hljs-string">eth1</span> <span class="hljs-string">up</span> <span class="hljs-number">10.0.0.9</span> <span class="hljs-string">netmask</span> <span class="hljs-number">255.255.255.252</span>
      <span class="hljs-string">route</span> <span class="hljs-string">add</span> <span class="hljs-string">-net</span> <span class="hljs-number">10.0.0.0</span><span class="hljs-string">/8</span> <span class="hljs-string">gw</span> <span class="hljs-number">10.0.0.10</span> <span class="hljs-string">dev</span> <span class="hljs-string">eth1</span>
      <span class="hljs-string">route</span> <span class="hljs-string">add</span> <span class="hljs-string">-net</span> <span class="hljs-number">192.168.0.0</span><span class="hljs-string">/28</span> <span class="hljs-string">gw</span> <span class="hljs-number">10.0.0.10</span> <span class="hljs-string">dev</span> <span class="hljs-string">eth1</span>
      <span class="hljs-comment"># original cloud-config</span>
      <span class="hljs-comment"># #cloud-config</span>
      <span class="hljs-comment"># bootcmd:</span>
      <span class="hljs-comment"># - ln -s -t /etc/rc.d /etc/rc.local</span>
      <span class="hljs-comment"># hostname: Client</span>
      <span class="hljs-comment"># manage_etc_hosts: true</span>
      <span class="hljs-comment"># runcmd:</span>
      <span class="hljs-comment"># - start ttyS0</span>
      <span class="hljs-comment"># - systemctl start getty@ttyS0.service</span>
      <span class="hljs-comment"># - systemctl start rc-local</span>
      <span class="hljs-comment"># - sed -i '/^\s*PasswordAuthentication\s\+no/d' /etc/ssh/sshd_config</span>
      <span class="hljs-comment"># - echo "UseDNS no" &gt;&gt; /etc/ssh/sshd_config</span>
      <span class="hljs-comment"># - service ssh restart</span>
      <span class="hljs-comment"># - service sshd restart</span>
</code></pre>
    <p class="normal">By expressing the network<a id="_idIndexMarker1176"/> as code, we can declare a source of truth for our network. We can write test code to compare the actual production value against this blueprint. We will use this topology file as the base and compare the production network value against it.</p>
    <h2 class="heading-2" id="_idParaDest-319">XML parsing example</h2>
    <p class="normal">Besides YAML, another popular<a id="_idIndexMarker1177"/> way to express<a id="_idIndexMarker1178"/> topology as code is XML. In fact, that was the format that the predecessor of CML 2, Cisco VIRL used. From previous editions of the book, I have provided an example of a two-host, two-network node example file named <code class="inlineCode">chapter15_topology.virl</code> for our parsing example. </p>
    <p class="normal">To work with XML files, we can use Python to extract the element from this topology file and store it as a Python data type so we can work with it. In <code class="inlineCode">chapter16_1_xml.py</code>, we will use <code class="inlineCode">ElementTree</code> to parse the <code class="inlineCode">virl</code> topology file and construct a dictionary consisting of the information of our devices:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/env/bin python3</span>
<span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET
<span class="hljs-keyword">import</span> pprint
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'</span><span class="hljs-string">chapter15_topology.virl'</span>, <span class="hljs-string">'rt'</span>) <span class="hljs-keyword">as</span> f: 
    tree = ET.parse(f)
devices = {}
<span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> tree.findall(<span class="hljs-string">'./{http://www.cisco.com/VIRL}node'</span>):
    name = node.attrib.get(<span class="hljs-string">'name'</span>)
    devices[name] = {}
    <span class="hljs-keyword">for</span> attr_name, attr_value <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(node.attrib.items()):
        devices[name][attr_name] = attr_value
<span class="hljs-comment"># Custom attributes</span>
devices[<span class="hljs-string">'iosv-1'</span>][<span class="hljs-string">'os'</span>] = <span class="hljs-string">'15.6(3)M2'</span>
devices[<span class="hljs-string">'nx-osv-1'</span>][<span class="hljs-string">'os'</span>] = <span class="hljs-string">'7.3(0)D1(1)'</span>
devices[<span class="hljs-string">'host1'</span>][<span class="hljs-string">'os'</span>] = <span class="hljs-string">'16.04'</span>
devices[<span class="hljs-string">'</span><span class="hljs-string">host2'</span>][<span class="hljs-string">'os'</span>] = <span class="hljs-string">'16.04'</span>
pprint.pprint(devices)
</code></pre>
    <p class="normal">The result is a Python dictionary<a id="_idIndexMarker1179"/> that consists of the devices according<a id="_idIndexMarker1180"/> to our topology file.</p>
    <p class="normal">We can also add customary items to the dictionary:</p>
    <pre class="programlisting con"><code class="hljs-con">(venv) $ python chapter16_1_xml.py
{'host1': {'location': '117,58',
           'name': 'host1',
           'os': '16.04',
           'subtype': 'server',
           'type': 'SIMPLE'},
 'host2': {'location': '347,66',
           'name': 'host2',
           'os': '16.04',
           'subtype': 'server',
           'type': 'SIMPLE'},
 'iosv-1': {'ipv4': '192.168.0.3',
            'location': '182,162',
            'name': 'iosv-1',
            'os': '15.6(3)M2',
            'subtype': 'IOSv',
            'type': 'SIMPLE'},
 'nx-osv-1': {'ipv4': '192.168.0.1',
              'location': '281,161',
              'name': 'nx-osv-1',
              'os': '7.3(0)D1(1)',
              'subtype': 'NX-OSv',
             'type': 'SIMPLE'}}
</code></pre>
    <p class="normal">If we want to compare this “source of truth” to the production device version, we can use our script from <em class="chapterRef">Chapter 3</em>, <em class="italic">APIs and Intent-Driven Networking</em>, <code class="inlineCode">cisco_nxapi_2.py</code>, to retrieve the production NX-OSv device’s software version. We can then compare the value we received from our topology file with the production device’s information. Later, we can use Python’s built-in <code class="inlineCode">unittest</code> module to write test cases.</p>
    <p class="normal">We will discuss the <code class="inlineCode">unittest</code> module in just a bit. Feel free to skip ahead and come back to this example if you’d like.</p>
    <p class="normal">Here is the relevant <code class="inlineCode">unittest</code> code in <code class="inlineCode">chapter16_2_validation.py</code>:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> unittest
&lt;skip&gt;
<span class="hljs-comment"># Unittest Test case</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">TestNXOSVersion</span>(unittest.TestCase):
    <span class="hljs-keyword">def</span> <span class="hljs-title">test_version</span>(<span class="hljs-params">self</span>):
        self.assertEqual(nxos_version, devices[<span class="hljs-string">'nx-osv-1'</span>][<span class="hljs-string">'os'</span>])
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    unittest.main()
</code></pre>
    <p class="normal">When we run the validation test, we can see that the test passes because the software version in production matches what we expected:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python chapter16_2_validation.py
.
----------------------------------------------------------------------
Ran 1 test in 0.000s
OK
</code></pre>
    <p class="normal">If we manually change the expected NX-OSv version value to introduce a failure case, we will see the following failed output:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python chapter16_3_test_fail.py
F
======================================================================
FAIL: test_version (__main__.TestNXOSVersion)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "chapter15_3_test_fail.py", line 50, in test_version
    self.assertEqual(nxos_version, devices['nx-osv-1']['os'])
AssertionError: '7.3(0)D1(1)' != '7.4(0)D1(1)'
- 7.3(0)D1(1)
?   ^
+ 7.4(0)D1(1)
?   ^
----------------------------------------------------------------------
Ran 1 test in 0.001s
FAILED (failures=1)
</code></pre>
    <p class="normal">We can see that the test case<a id="_idIndexMarker1181"/> result returned as failed; the reason for the failure was the version<a id="_idIndexMarker1182"/> mismatch between the two values. As we saw in the last example, the Python <code class="inlineCode">unittest</code> module is a great way to test our existing code based on our expected results. Let’s take a deeper look at the module.</p>
    <h2 class="heading-2" id="_idParaDest-320">Python’s unittest module</h2>
    <p class="normal">The Python<a id="_idIndexMarker1183"/> standard library<a id="_idIndexMarker1184"/> includes a module named <code class="inlineCode">unittest</code>, which handles test cases where we can compare two values to determine whether a test passes. In the previous example, we saw how to use the <code class="inlineCode">assertEqual()</code> method to compare two values to return either <code class="inlineCode">True</code> or <code class="inlineCode">False</code>. Here is an example, <code class="inlineCode">chapter16_4_unittest.py</code>, that uses the built-in <code class="inlineCode">unittest</code> module to compare two values:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">class</span> <span class="hljs-title">SimpleTest</span>(unittest.TestCase):
    <span class="hljs-keyword">def</span> <span class="hljs-title">test</span>(<span class="hljs-params">self</span>):
        one = <span class="hljs-string">'a'</span>
        two = <span class="hljs-string">'a'</span>
        self.assertEqual(one, two)
</code></pre>
    <p class="normal">Using the <code class="inlineCode">python3</code> command-line interface, the <code class="inlineCode">unittest</code> module can automatically discover the test cases in the script:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python -m unittest chapter16_4_unittest.py
.
----------------------------------------------------------------------
Ran 1 test in 0.000s
OK
</code></pre>
    <p class="normal">Besides comparing<a id="_idIndexMarker1185"/> two values, here are more examples of testing<a id="_idIndexMarker1186"/> whether the expected value is <code class="inlineCode">True</code> or <code class="inlineCode">False</code>. We can also generate custom failure messages when a failure occurs:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Examples from https://pymotw.com/3/unittest/index.html#module-unittest</span>
<span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">class</span> <span class="hljs-title">Output</span>(unittest.TestCase):
    <span class="hljs-keyword">def</span> <span class="hljs-title">testPass</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title">testFail</span>(<span class="hljs-params">self</span>):
        self.assertFalse(<span class="hljs-literal">True</span>, <span class="hljs-string">'this is a failed message'</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-title">testError</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">'Test error!'</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-title">testAssesrtTrue</span>(<span class="hljs-params">self</span>):
        self.assertTrue(<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-title">testAssertFalse</span>(<span class="hljs-params">self</span>):
        self.assertFalse(<span class="hljs-literal">False</span>)
</code></pre>
    <p class="normal">We can use <code class="inlineCode">-v</code> for the option to display a more detailed output:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python -m unittest -v chapter16_5_more_unittest
testAssertFalse (chapter16_5_more_unittest.Output) ... ok
testAssesrtTrue (chapter16_5_more_unittest.Output) ... ok
testError (chapter16_5_more_unittest.Output) ... ERROR
testFail (chapter16_5_more_unittest.Output) ... FAIL
testPass (chapter16_5_more_unittest.Output) ... ok
======================================================================
ERROR: testError (chapter16_5_more_unittest.Output)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16/chapter16_5_more_unittest.py", line 14, in testError
    raise RuntimeError('Test error!')
RuntimeError: Test error!
======================================================================
FAIL: testFail (chapter16_5_more_unittest.Output)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16/chapter16_5_more_unittest.py", line 11, in testFail
    self.assertFalse(True, 'this is a failed message')
AssertionError: True is not false : this is a failed message
----------------------------------------------------------------------
Ran 5 tests in 0.001s
FAILED (failures=1, errors=1)
</code></pre>
    <p class="normal">Starting from Python 3.3, the <code class="inlineCode">unittest</code> module<a id="_idIndexMarker1187"/> includes the <code class="inlineCode">mock</code> object library by default (<a href="https://docs.python.org/3/library/unittest.mock.html"><span class="url">https://docs.python.org/3/library/unittest.mock.html</span></a>). This is a very useful module that you can use to make a fake HTTP API call to a remote resource without actually making the call. For example, we have seen<a id="_idIndexMarker1188"/> using NX-API to retrieve the NX-OS version<a id="_idIndexMarker1189"/> number. What if we want to run our test, but we do not have an NX-OS device available? We can use the <code class="inlineCode">unittest</code> mock object.</p>
    <p class="normal">In <code class="inlineCode">chapter16_5_more_unittest_mocks.py</code>, we created a class with a method to make HTTP API calls and expect a JSON response:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># Our class making API Call using requests</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title">fetch_json</span>(<span class="hljs-params">self, url</span>):
        response = requests.get(url)
        <span class="hljs-keyword">return</span> response.json()
</code></pre>
    <p class="normal">We also created a function that mocks two URL calls:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># This method will be used by the mock to replace requests.get</span>
<span class="hljs-keyword">def</span> <span class="hljs-title">mocked_requests_get</span>(<span class="hljs-params">*args, **kwargs</span>):
    <span class="hljs-keyword">class</span> <span class="hljs-title">MockResponse</span>:
        <span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, json_data, status_code</span>):
            self.json_data = json_data
            self.status_code = status_code
        <span class="hljs-keyword">def</span> <span class="hljs-title">json</span>(<span class="hljs-params">self</span>):
            <span class="hljs-keyword">return</span> self.json_data
    <span class="hljs-keyword">if</span> args[<span class="hljs-number">0</span>] == <span class="hljs-string">'http://url-1.com/test.json'</span>:
        <span class="hljs-keyword">return</span> MockResponse({<span class="hljs-string">"key1"</span>: <span class="hljs-string">"value1"</span>}, <span class="hljs-number">200</span>)
    <span class="hljs-keyword">elif</span> args[<span class="hljs-number">0</span>] == <span class="hljs-string">'http://url-2.com/test.json'</span>:
        <span class="hljs-keyword">return</span> MockResponse({<span class="hljs-string">"key2"</span>: <span class="hljs-string">"value2"</span>}, <span class="hljs-number">200</span>)
    <span class="hljs-keyword">return</span> MockResponse(<span class="hljs-literal">None</span>, <span class="hljs-number">404</span>)
</code></pre>
    <p class="normal">Finally, we make the API call to the two URLs in our test case. However, we are using the <code class="inlineCode">mock.patch</code> decorator to intercept the API calls:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># Our test case class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">MyClassTestCase</span>(unittest.TestCase):
    <span class="hljs-comment"># We patch 'requests.get' with our own method. The mock object is passed in to our test case method.</span>
<span class="hljs-meta">    @mock.patch(</span><span class="hljs-string">'requests.get'</span><span class="hljs-params">, side_effect=mocked_requests_get</span><span class="hljs-meta">)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title">test_fetch</span>(<span class="hljs-params">self, mock_get</span>):
        <span class="hljs-comment"># Assert requests.get calls</span>
        my_class = MyClass()
        <span class="hljs-comment"># call to url-1</span>
        json_data = my_class.fetch_json(<span class="hljs-string">'http://url-1.com/test.json'</span>)
        self.assertEqual(json_data, {<span class="hljs-string">"key1"</span>: <span class="hljs-string">"value1"</span>})
        <span class="hljs-comment"># call to url-2</span>
        json_data = my_class.fetch_json(<span class="hljs-string">'http://url-2.com/test.json'</span>)
        self.assertEqual(json_data, {<span class="hljs-string">"key2"</span>: <span class="hljs-string">"value2"</span>})
        <span class="hljs-comment"># call to url-3 that we did not mock</span>
        json_data = my_class.fetch_json(<span class="hljs-string">'http://url-3.com/test.json'</span>)
        self.assertIsNone(json_data)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    unittest.main()
</code></pre>
    <p class="normal">When we run the test, we will see that the test passes without needing to make an actual API call to the remote endpoint. Neat, huh?</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python chapter16_5_more_unittest_mocks.py
.
----------------------------------------------------------------------
Ran 1 test in 0.000s
OK
</code></pre>
    <p class="normal">For more <a id="_idIndexMarker1190"/>information<a id="_idIndexMarker1191"/> on the <code class="inlineCode">unittest</code> module, Doug Hellmann’s Python<a id="_idIndexMarker1192"/> module of the week (<a href="https://pymotw.com/3/unittest/index.html#module-unittest"><span class="url">https://pymotw.com/3/unittest/index.html#module-unittest</span></a>) is an excellent source of short and precise examples on the <code class="inlineCode">unittest</code> module. As always, the Python documentation<a id="_idIndexMarker1193"/> is a good source of information as well: <a href="https://docs.python.org/3/library/unittest.html"><span class="url">https://docs.python.org/3/library/unittest.html</span></a>.</p>
    <h2 class="heading-2" id="_idParaDest-321">More on Python testing</h2>
    <p class="normal">In addition<a id="_idIndexMarker1194"/> to the built-in <code class="inlineCode">unittest</code> library, there<a id="_idIndexMarker1195"/> are lots of other testing frameworks from the Python community. <code class="inlineCode">pytest</code> is one of the most robust, intuitive Python testing frameworks and is worth a look. <code class="inlineCode">pytest</code> can be used for all types and levels of software testing. It can be used by developers, QA engineers, individuals practicing TDD, and open source projects.</p>
    <p class="normal">Many large-scale open source projects have switched from <code class="inlineCode">unittest</code> or <code class="inlineCode">nose</code> (another Python test framework) to <code class="inlineCode">pytest</code>, including Mozilla and Dropbox. The attractive features of <code class="inlineCode">pytest</code> include the third-party plugin model, a simple fixture model, and assert rewriting.</p>
    <p class="normal">If you want to learn more about the <code class="inlineCode">pytest</code> framework, I highly recommend <em class="italic">Python Testing with pytest</em> by Brian Okken (ISBN 978-1-68050-240-4). Another great source<a id="_idIndexMarker1196"/> is the pytest documentation: <a href="https://docs.pytest.org/en/latest/"><span class="url">https://docs.pytest.org/en/latest/</span></a>.</p>
    <p class="normal"><code class="inlineCode">pytest</code> is command line-driven; it can find the tests we have written automatically and run them by appending the <code class="inlineCode">test</code> prefix in our function. We will need to install <code class="inlineCode">pytest</code> before we can use it:</p>
    <pre class="programlisting con"><code class="hljs-con">$ pip install pytest
$ python
Python 3.10.6 (main, Aug 10 2022, 11:40:04) [GCC 11.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">import</span> pytest
<span class="hljs-con-meta">&gt;&gt;&gt;</span> pytest.__version__
'7.1.3'
<span class="hljs-con-meta">&gt;&gt;&gt;</span>
</code></pre>
    <p class="normal">Let’s look at some examples using <code class="inlineCode">pytest</code>.</p>
    <h2 class="heading-2" id="_idParaDest-322">pytest examples</h2>
    <p class="normal">The first <code class="inlineCode">pytest</code> example, <code class="inlineCode">chapter16_6_pytest_1.py</code>, will be a simple<a id="_idIndexMarker1197"/> assert for two<a id="_idIndexMarker1198"/> values:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">def</span> <span class="hljs-title">test_passing</span>():
    <span class="hljs-keyword">assert</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) == (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
<span class="hljs-keyword">def</span> <span class="hljs-title">test_failing</span>():
    <span class="hljs-keyword">assert</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) == (<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)
</code></pre>
    <p class="normal">When we run <code class="inlineCode">pytest</code> with the <code class="inlineCode">-v</code> option, <code class="inlineCode">pytest</code> will give us a pretty robust answer for a reason for the failure. The verbose output is one of the reasons people like <code class="inlineCode">pytest</code>:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>pytest -v chapter16_6_pytest_1.py 
================================ test session starts =================================
platform linux -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0 -- /home/echou/Mastering_Python_Networking_Fourth_Edition/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16
collected 2 items                                                                    
chapter16_6_pytest_1.py::test_passing PASSED                                   [ 50%]
chapter16_6_pytest_1.py::test_failing FAILED                                   [100%]
====================================== FAILURES ======================================
____________________________________ test_failing ____________________________________
    def test_failing():
<span class="hljs-con-meta">&gt; </span>      assert(1, 2, 3) == (3, 2, 1)
E       assert (1, 2, 3) == (3, 2, 1)
E         At index 0 diff: 1 != 3
E         Full diff:
E         - (3, 2, 1)
E         ?  ^     ^
E         + (1, 2, 3)
E         ?  ^     ^
chapter16_6_pytest_1.py:7: AssertionError
============================== short test summary info ===============================
FAILED chapter16_6_pytest_1.py::test_failing - assert (1, 2, 3) == (3, 2, 1)
============================ 1 failed, 1 passed in 0.03s =============================
</code></pre>
    <p class="normal">In the second <code class="inlineCode">pytest</code> example, <code class="inlineCode">chapter16_7_pytest_2.py</code>, we will create a <code class="inlineCode">router</code> object. The <code class="inlineCode">router</code> object will be initiated with some values of <code class="inlineCode">None</code> and some with default values. We will use <code class="inlineCode">pytest</code> to test one instance with the default and one instance without:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">router</span>(<span class="hljs-title">object</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, hostname=</span><span class="hljs-literal">None</span><span class="hljs-params">, os=</span><span class="hljs-literal">None</span><span class="hljs-params">, device_type=</span><span class="hljs-string">'cisco_ios'</span>):
        self.hostname = hostname
        self.os = os
        self.device_type = device_type
        self.interfaces = <span class="hljs-number">24</span>
<span class="hljs-keyword">def</span> <span class="hljs-title">test_defaults</span>():
    r1 = router()
    <span class="hljs-keyword">assert</span> r1.hostname == <span class="hljs-literal">None</span>
    <span class="hljs-keyword">assert</span> r1.os == <span class="hljs-literal">None</span>
    <span class="hljs-keyword">assert</span> r1.device_type == <span class="hljs-string">'cisco_ios'</span>
    <span class="hljs-keyword">assert</span> r1.interfaces == <span class="hljs-number">24</span>
<span class="hljs-keyword">def</span> <span class="hljs-title">test_non_defaults</span>():
    r2 = router(hostname=<span class="hljs-string">'lax-r2'</span>, os=<span class="hljs-string">'nxos'</span>, device_type=<span class="hljs-string">'cisco_nxos'</span>)
    <span class="hljs-keyword">assert</span> r2.hostname == <span class="hljs-string">'lax-r2'</span>
    <span class="hljs-keyword">assert</span> r2.os == <span class="hljs-string">'nxos'</span>
    <span class="hljs-keyword">assert</span> r2.device_type == <span class="hljs-string">'cisco_nxos'</span>
    <span class="hljs-keyword">assert</span> r2.interfaces == <span class="hljs-number">24</span>
</code></pre>
    <p class="normal">When we run the test, we will see whether<a id="_idIndexMarker1199"/> the instance was accurately applied<a id="_idIndexMarker1200"/> with the default values:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>pytest chapter16_7_pytest_2.py 
================================ test session starts =================================
platform linux -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0
rootdir: /home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16
collected 2 items                                                                    
chapter16_7_pytest_2.py ..                                                     [100%]
================================= 2 passed in 0.01s ==================================
</code></pre>
    <p class="normal">If we were to replace the previous <code class="inlineCode">unittest</code> example with <code class="inlineCode">pytest</code>, in <code class="inlineCode">chapter16_8_pytest_3.py</code>, we can see the syntax with <code class="inlineCode">pytest</code> is simpler:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"># pytest test case</span>
<span class="hljs-keyword">def</span> <span class="hljs-title">test_version</span>():
    <span class="hljs-keyword">assert</span> devices[<span class="hljs-string">'nx-osv-1'</span>][<span class="hljs-string">'os'</span>] ==  nxos_version
</code></pre>
    <p class="normal">Then we run the test with the <code class="inlineCode">pytest</code> command line:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>pytest chapter16_8_pytest_3.py 
================================ test session starts =================================
platform linux -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0
rootdir: /home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16
collected 1 item                                                                     
chapter16_8_pytest_3.py .                                                      [100%]
================================= 1 passed in 3.80s ==================================
</code></pre>
    <p class="normal">Between <code class="inlineCode">unittest</code> and <code class="inlineCode">pytest</code>, I find <code class="inlineCode">pytest</code> more intuitive to use. However, since <code class="inlineCode">unittest</code> is included in the standard library, many teams might prefer using the <code class="inlineCode">unittest</code> module for their testing.</p>
    <p class="normal">Besides doing tests<a id="_idIndexMarker1201"/> on code, we can also write tests to test our network as a whole. After all, users<a id="_idIndexMarker1202"/> care more about their services and applications functioning properly and less about individual pieces. We will look at writing tests for the network in the next section.</p>
    <h1 class="heading-1" id="_idParaDest-323">Writing tests for networking</h1>
    <p class="normal">So far, we have been mostly writing tests<a id="_idIndexMarker1203"/> for our Python<a id="_idIndexMarker1204"/> code. We have used both the <code class="inlineCode">unittest</code> and <code class="inlineCode">pytest</code> libraries to assert <code class="inlineCode">True</code>/<code class="inlineCode">False</code> and <code class="inlineCode">equal/non-equal</code> values. We were also able to write mocks to intercept our API calls when we do not have an actual API-capable device but still want to run our tests.</p>
    <p class="normal">In this section, let’s look at how we can write tests relevant to the networking world. There is no shortage of commercial products regarding network monitoring and testing. Over the years, I have come across many of them. However, in this section, I prefer to use simple, open source tools for my tests.</p>
    <h2 class="heading-2" id="_idParaDest-324">Testing for reachability</h2>
    <p class="normal">Often, the first step of troubleshooting<a id="_idIndexMarker1205"/> is to conduct a small reachability test. For network engineers, <code class="inlineCode">ping</code> is our best friend when it comes to network reachability tests. It is a way to test the reachability of a host on an IP network by sending a small package across the network to the destination.</p>
    <p class="normal">We can automate the <code class="inlineCode">ping</code> test via the <code class="inlineCode">OS</code> module or the <code class="inlineCode">subprocess</code> module:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">import</span> os
<span class="hljs-con-meta">&gt;&gt;&gt;</span> host_list = [<span class="hljs-con-string">'</span><span class="hljs-con-string">www.cisco.com'</span>, <span class="hljs-con-string">'www.google.com'</span>]
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">for</span> host <span class="hljs-con-keyword">in</span> host_list:
<span class="hljs-con-meta">...</span>     os.system(<span class="hljs-con-string">'ping -c 1 '</span> + host)
<span class="hljs-con-meta">...</span>
PING www.cisco.com(2001:559:19:289b::b33 (2001:559:19:289b::b33)) 56 data bytes
64 bytes from 2001:559:19:289b::b33 (2001:559:19:289b::b33): icmp_seq=1 ttl=60 time=11.3 ms
--- www.cisco.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 11.399/11.399/11.399/0.000 ms
0
PING www.google.com(sea15s11-in-x04.1e100.net (2607:f8b0:400a:808::2004)) 56 data bytes
64 bytes from sea15s11-in-x04.1e100.net (2607:f8b0:400a:808::2004): icmp_seq=1 ttl=54 time=10.8 ms
--- www.google.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 10.858/10.858/10.858/0.000 ms
0
</code></pre>
    <p class="normal">The <code class="inlineCode">subprocess</code> module offers the additional benefit of catching the output:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">import</span> subprocess
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">for</span> host <span class="hljs-con-keyword">in</span> host_list:
<span class="hljs-con-meta">...</span>     <span class="hljs-con-built_in">print</span>(<span class="hljs-con-string">'</span><span class="hljs-con-string">host: '</span> + host)
<span class="hljs-con-meta">...</span>     p = subprocess.Popen([<span class="hljs-con-string">'ping'</span>, <span class="hljs-con-string">'-c'</span>, <span class="hljs-con-string">'1'</span>, host], stdout=subprocess.PIPE)
<span class="hljs-con-meta">...</span>
host: www.cisco.com
host: www.google.com
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-built_in">print</span>(p.communicate())
(b'PING www.google.com(sea15s11-in-x04.1e100.net (2607:f8b0:400a:808::2004)) 56 data bytes\n64 bytes from sea15s11-in-x04.1e100.net (2607:f8b0:400a:808::2004): icmp_seq=1 ttl=54 time=16.9 ms\n\n--- www.google.com ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 16.913/16.913/16.913/0.000 ms\n', None)
<span class="hljs-con-meta">&gt;&gt;&gt;</span>
</code></pre>
    <p class="normal">These two modules prove<a id="_idIndexMarker1206"/> to be very useful in many situations. Any command we can execute in the Linux and Unix environments can be executed via the <code class="inlineCode">OS</code> or <code class="inlineCode">subprocess</code> module.</p>
    <h2 class="heading-2" id="_idParaDest-325">Testing for network latency</h2>
    <p class="normal">The topic of network latency<a id="_idIndexMarker1207"/> can sometimes be subjective. Working as network engineers, we are often faced with the user saying that the network is slow. However, “slow” is a very subjective term.</p>
    <p class="normal">If we could construct tests that turn subjective terms into objective values, it would be very helpful. We should do this consistently to compare the values over a time series of data.</p>
    <p class="normal">This can sometimes be difficult since the network is stateless by design. Just because one packet is successful does not guarantee success for the next packet. The best approach I have seen over the years is to use <code class="inlineCode">ping</code> across many hosts frequently and log the data, conducting a ping-mesh graph. We can leverage the same tools we used in the previous example, catch the return-result time, and keep a record. We do this in <code class="inlineCode">chapter16_10_ping.py</code>:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">import</span> subprocess
host_list = [<span class="hljs-string">'www.cisco.com'</span>, <span class="hljs-string">'www.google.com'</span>]
ping_time = []
<span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> host_list:
    p = subprocess.Popen([<span class="hljs-string">'ping'</span>, <span class="hljs-string">'-c'</span>, <span class="hljs-string">'1'</span>, host], stdout=subprocess.PIPE)
    result = p.communicate()[<span class="hljs-number">0</span>]
    host = result.split()[<span class="hljs-number">1</span>]
    time = result.split()[<span class="hljs-number">13</span>]
    ping_time.append((host, time))
<span class="hljs-built_in">print</span>(ping_time)
</code></pre>
    <p class="normal">In this case, the result is kept in a <code class="inlineCode">tuple</code> and put into a <code class="inlineCode">list</code>:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python chapter16_10_ping.py 
[(b'e2867.dsca.akamaiedge.net', b'ttl=54'), (b'www.google.com', b'ttl=58')]
</code></pre>
    <p class="normal">This is not perfect and is merely a starting point for monitoring and troubleshooting. However, in the absence of other tools, this offers<a id="_idIndexMarker1208"/> some baseline of objective values.</p>
    <h2 class="heading-2" id="_idParaDest-326">Testing for security</h2>
    <p class="normal">We saw one of the best tools<a id="_idIndexMarker1209"/> for security testing in <em class="chapterRef">Chapter 6</em>, <em class="italic">Network Security with Python</em>, which was Scapy. There are lots of open source tools for security, but none offer the flexibility that comes with constructing our packets.</p>
    <p class="normal">Another great tool<a id="_idIndexMarker1210"/> for network security testing is <code class="inlineCode">hping3</code> (<a href="https://docs.python-cerberus.org/en/stable/"><span class="url">https://docs.python-cerberus.org/en/stable/</span></a>). It offers a simple way to generate a lot of packets at once. For example, you can use the following one-liner to generate a TCP SYN flood:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta"># </span>DON<span class="hljs-con-string">'</span><span class="hljs-con-string">T DO THIS IN PRODUCTION #</span>
echou@ubuntu:/var/log$ sudo hping3 -S -p 80 --flood 192.168.1.202
HPING 192.168.1.202 (eth0 192.168.1.202): S set, 40 headers + 0 data bytes hping in flood mode, no replies will be shown
^C
--- 192.168.1.202 hping statistic ---
2281304 packets transmitted, 0 packets received, 100% packet loss round-trip min/avg/max = 0.0/0.0/0.0 ms
echou@ubuntu:/var/log$
</code></pre>
    <p class="normal">Again, since this is a command-line tool, we can use the <code class="inlineCode">subprocess</code> module to automate any <code class="inlineCode">hping3</code> tests that we want.</p>
    <h2 class="heading-2" id="_idParaDest-327">Testing for transactions</h2>
    <p class="normal">The network is a crucial part<a id="_idIndexMarker1211"/> of the infrastructure, but it is only a part of it. What the users care about is often the service that runs on top of the network. If the user is trying to watch a YouTube video or listen to a podcast but cannot, in their opinion, the service is broken. We might know that the network transport is not at fault, but that doesn’t comfort the user.</p>
    <p class="normal">For this reason, we should implement tests that are as similar to the user’s experience as possible. In the example of a YouTube video, we might not be able to duplicate the YouTube experience 100% (unless you work for Google). </p>
    <p class="normal">Still, we can implement a layer-7 service as close to the network edge as possible. We can then simulate the transaction from a client at a regular interval as a transactional test.</p>
    <p class="normal">The Python <code class="inlineCode">HTTP</code> standard library module is a module that I often use when I need to test layer-7 reachability on a web service quickly. We already saw how to use it when we were performing network monitoring in <em class="chapterRef">Chapter 4</em>, <em class="italic">The Python Automation Framework – Ansible</em>, but it’s worth seeing again:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python3 -m http.server 8080
Serving HTTP on 0.0.0.0 port 8080 ...
127.0.0.1 - - [25/Jul/2018 10:15:23] "GET / HTTP/1.1" 200 -
</code></pre>
    <p class="normal">If we can simulate a full transaction for the expected service, that is even better. But Python’s simple <code class="inlineCode">HTTP</code> server module in the standard library is always a great one for running some ad hoc web service tests.</p>
    <h2 class="heading-2" id="_idParaDest-328">Testing for network configuration</h2>
    <p class="normal">In my opinion, the best test for network<a id="_idIndexMarker1212"/> configuration is using standardized templates to generate the configuration and back up the production configuration often. We have seen how we can use the Jinja2 template to standardize our configuration per device type or role. This will eliminate many of the mistakes caused by human error, such as copy and paste.</p>
    <p class="normal">Once the configuration is generated, we can write tests against the configuration for known characteristics that we would expect before we push the configuration to production devices. For example, there should be no overlap of IP addresses in all of the network when it comes to loopback IP, so we can write a test to see whether the new configuration contains a loopback IP that is unique across our devices.</p>
    <h2 class="heading-2" id="_idParaDest-329">Testing for Ansible</h2>
    <p class="normal">For the time I have been using Ansible, I cannot<a id="_idIndexMarker1213"/> recall using a <code class="inlineCode">unittest</code>-like tool to test<a id="_idIndexMarker1214"/> a playbook. For the most part, the playbooks use modules that were tested by module developers.</p>
    <div class="packt_tip">
      <p class="normal">If you want a lightweight data<a id="_idIndexMarker1215"/> validation tool, please check out Cerberus (<a href="https://docs.python-cerberus.org/en/stable/"><span class="url">https://docs.python-cerberus.org/en/stable/</span></a>).</p>
    </div>
    <p class="normal">Ansible provides unit tests for their library of modules. Unit tests in Ansible are currently the only way to drive tests from Python within Ansible’s continuous-integration process. The unit tests that are run today can be found under <code class="inlineCode">/test/units</code> (<a href="https://github.com/ansible/ansible/tree/devel/test/units"><span class="url">https://github.com/ansible/ansible/tree/devel/test/units</span></a>).</p>
    <p class="normal">The Ansible testing<a id="_idIndexMarker1216"/> strategy<a id="_idIndexMarker1217"/> can be found<a id="_idIndexMarker1218"/> in the following documents:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Testing Ansible</strong>: <a href="https://docs.ansible.com/ansible/latest/dev_guide/testing.html"><span class="url">https://docs.ansible.com/ansible/latest/dev_guide/testing.html</span></a></li>
      <li class="bulletList"><strong class="keyWord">Unit tests</strong>: <a href="https://docs.ansible.com/ansible/latest/dev_guide/testing_units.html"><span class="url">https://docs.ansible.com/ansible/latest/dev_guide/testing_units.html</span></a> </li>
      <li class="bulletList"><strong class="keyWord">Unit testing Ansible modules</strong>: <a href="https://docs.ansible.com/ansible/latest/dev_guide/testing_units_modules.html"><span class="url">https://docs.ansible.com/ansible/latest/dev_guide/testing_units_modules.html</span></a></li>
    </ul>
    <p class="normal">One of the interesting Ansible testing frameworks<a id="_idIndexMarker1219"/> is Molecule (<a href="https://pypi.org/project/molecule/"><span class="url">https://pypi.org/project/molecule/</span></a>). It intends to aid in the development and testing of Ansible roles. Molecule supports testing with multiple instances, operating systems, and distributions. I have not used this tool, but it is where I would start if I wanted to perform more testing on my Ansible roles.</p>
    <p class="normal">We should now know how to write tests for our network, whether testing for reachability, latency, security, transaction, or network configuration. </p>
    <p class="normal">In the next section, we will take a look at an extensive testing framework developed by Cisco (and recently released as open source) called <code class="inlineCode">pyATS</code>. Much to their credit, releasing such an extensive framework as open source for the benefit of the community was a great gesture by Cisco.</p>
    <h1 class="heading-1" id="_idParaDest-330">pyATS and Genie</h1>
    <p class="normal">pyATS (<a href="https://developer.cisco.com/pyats/"><span class="url">https://developer.cisco.com/pyats/</span></a>) is an end-to-end testing<a id="_idIndexMarker1220"/> ecosystem originally developed<a id="_idIndexMarker1221"/> by Cisco and made available to the public in late 2017. The pyATS library was formerly known as Genie; they will often be referred to in the same context. Because of its roots, the framework is very focused on network testing.</p>
    <p class="normal">pyATS, and the pyATS library (also known as Genie), was the winner<a id="_idIndexMarker1222"/> of the 2018 Cisco Pioneer Award. We should all applaud Cisco for making the framework<a id="_idIndexMarker1223"/> open source and available to the public. Good job, Cisco DevNet!</p>
    <p class="normal">The framework is available on PyPI:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>pip install pyats
</code></pre>
    <p class="normal">To get started, we can look at some of the example scripts on the GitHub repository, <a href="https://github.com/CiscoDevNet/pyats-sample-scripts"><span class="url">https://github.com/CiscoDevNet/pyats-sample-scripts</span></a>. The tests start with creating a testbed file in YAML format. We will create a simple <code class="inlineCode">chapter16_pyats_testbed_1.yml</code> testbed file for our <code class="inlineCode">lax-edge-r1-edg-r1</code> device. The file should look similar to the Ansible inventory file that we have seen before:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">testbed:</span> 
    <span class="hljs-attr">name:</span> <span class="hljs-string">Chapter_16_pyATS</span>
    <span class="hljs-attr">tacacs:</span> 
      <span class="hljs-attr">username:</span> <span class="hljs-string">cisco</span>
    <span class="hljs-attr">passwords:</span>
      <span class="hljs-attr">tacacs:</span> <span class="hljs-string">cisco</span> 
      <span class="hljs-attr">enable:</span> <span class="hljs-string">cisco</span>
<span class="hljs-attr">devices:</span>
   <span class="hljs-attr">lax-edg-r1:</span> 
       <span class="hljs-attr">alias:</span> <span class="hljs-string">lax-edg-r1</span>
       <span class="hljs-attr">type:</span> <span class="hljs-string">ios</span>
       <span class="hljs-attr">connections:</span>
         <span class="hljs-attr">defaults:</span>
           <span class="hljs-attr">class:</span> <span class="hljs-string">unicon.Unicon</span>  
         <span class="hljs-attr">management:</span>
           <span class="hljs-attr">ip:</span> <span class="hljs-number">192.168.2.51</span>
           <span class="hljs-attr">protocol:</span> <span class="hljs-string">ssh</span>
<span class="hljs-attr">topology:</span> 
    <span class="hljs-attr">lax-edg-r1:</span>
        <span class="hljs-attr">interfaces:</span>
            <span class="hljs-attr">GigabitEthernet0/1:</span>
                <span class="hljs-attr">ipv4:</span> <span class="hljs-number">10.0.0.1</span><span class="hljs-string">/30</span>
                <span class="hljs-attr">link:</span> <span class="hljs-string">link-1</span>
                <span class="hljs-attr">type:</span> <span class="hljs-string">ethernet</span>
            <span class="hljs-attr">Loopback0:</span>
                <span class="hljs-attr">ipv4:</span> <span class="hljs-number">192.168.0.10</span><span class="hljs-string">/32</span>
                <span class="hljs-attr">link:</span> <span class="hljs-string">iosv-1_Loopback0</span>
                <span class="hljs-attr">type:</span> <span class="hljs-string">loopback</span>
</code></pre>
    <p class="normal">In our first script, <code class="inlineCode">chapter16_11_pyats_1.py</code>, we will load the testbed file, connect to the device, issue a <code class="inlineCode">show version</code> command, then disconnect from the device:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># derived from https://devnet-pubhub-site.s3.amazonaws.com/media/pyats/docs/getting_started/index.html</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">from</span> pyats.topology <span class="hljs-keyword">import</span> loader
<span class="hljs-comment"># load testbed</span>
testbed = loader.load(<span class="hljs-string">'chapter16_pyats_testbed_1.yml'</span>)
<span class="hljs-comment"># access the device</span>
testbed.devices
lax_edg_r1 = testbed.devices[<span class="hljs-string">'lax-edg-r1'</span>]
<span class="hljs-comment"># establish connectivity</span>
lax_edg_r1.connect()
<span class="hljs-comment"># issue command</span>
<span class="hljs-built_in">print</span>(lax_edg_r1.execute(<span class="hljs-string">'show version'</span>))
<span class="hljs-comment"># disconnect</span>
lax_edg_r1.disconnect()
</code></pre>
    <p class="normal">When we execute the command, we can see the output <a id="_idIndexMarker1224"/>is a mixture of the <code class="inlineCode">pyATS</code> setup as well as the actual output<a id="_idIndexMarker1225"/> of the device. This is similar to the Paramiko scripts we have seen before but note that <code class="inlineCode">pyATS</code> took care of the underlying connection for us:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python chapter16_11_pyats_1.py 
/home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16/pyATS/chapter16_11_pyats_1.py:8: DeprecationWarning: 'tacacs.username' is deprecated in the testbed YAML.  This key has been moved to 'credentials'.
  testbed = loader.load('chapter16_pyats_testbed_1.yml')
/home/echou/Mastering_Python_Networking_Fourth_Edition/Chapter16/pyATS/chapter16_11_pyats_1.py:8: DeprecationWarning: 'passwords.tacacs' is  deprecated in the testbed YAML.  Use 'credentials' instead.
  testbed = loader.load('chapter16_pyats_testbed_1.yml')
device's os is not provided, unicon may not use correct plugins
2022-09-25 17:03:08,615: %UNICON-INFO: +++ lax-edg-r1 logfile /tmp/lax-edg-r1-cli-20220925T170308615.log +++
&lt;skip&gt;
2022-09-25 17:03:09,275: %UNICON-INFO: +++ connection to spawn: ssh -l cisco 192.168.2.51, id: 140685765498848 +++
2022-09-25 17:03:09,276: %UNICON-INFO: connection to lax-edg-r1
cisco@192.168.2.51's password: 
**************************************************************************
* IOSv is strictly limited to use for evaluation, demonstration and IOS  *
* education. IOSv is provided as-is and is not supported by Cisco's      *
* Technical Advisory Center. Any use or disclosure, in whole or in part, *
* of the IOSv Software or Documentation to any third party for any       *
* purposes is expressly prohibited except as otherwise authorized by     *
* Cisco in writing.                                                      *
**************************************************************************
<span class="hljs-con-meta">lax-edg-r1#</span>
2022-09-25 17:03:09,364: %UNICON-INFO: +++ initializing handle +++
2022-09-25 17:03:09,427: %UNICON-INFO: +++ lax-edg-r1 with via 'management': executing command 'term length 0' +++
term length 0
<span class="hljs-con-meta">lax-edg-r1#</span>
2022-09-25 17:03:09,617: %UNICON-INFO: +++ lax-edg-r1 with via 'management': executing command 'term width 0' +++
term width 0
<span class="hljs-con-meta">lax-edg-r1#</span>
2022-09-25 17:03:09,821: %UNICON-INFO: +++ lax-edg-r1 with via 'management': executing command 'show version' +++
show version
Cisco IOS Software, IOSv Software (VIOS-ADVENTERPRISEK9-M), Version 15.8(3)M2, RELEASE SOFTWARE (fc2)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2019 by Cisco Systems, Inc.
Compiled Thu 28-Mar-19 14:06 by prod_rel_team
</code></pre>
    <p class="normal">In the second example, we will see a full example<a id="_idIndexMarker1226"/> of connection setup, test cases, then connection<a id="_idIndexMarker1227"/> teardown. First, we will add the <code class="inlineCode">lax-cor-r1</code> device to our testbed in <code class="inlineCode">chapter16_pyats_testbed_2.yml</code>. The additional device is needed as the connected device to <code class="inlineCode">iosv-1</code> for our ping test:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attribute">testbed</span><span class="hljs-punctuation">: </span>
    <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Chapter_16_pyATS</span>
    <span class="hljs-attribute">tacacs</span><span class="hljs-punctuation">: </span>
      <span class="hljs-attribute">username</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cisco</span>
    <span class="hljs-attribute">passwords</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">tacacs</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cisco </span>
      <span class="hljs-attribute">enable</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cisco</span>
<span class="hljs-attribute">devices</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">lax-edg-r1</span><span class="hljs-punctuation">: </span>
       <span class="hljs-attribute">alias</span><span class="hljs-punctuation">:</span> <span class="hljs-string">iosv-1</span>
       <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ios</span>
       <span class="hljs-attribute">connections</span><span class="hljs-punctuation">:</span>
         <span class="hljs-attribute">defaults</span><span class="hljs-punctuation">:</span>
           <span class="hljs-attribute">class</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unicon.Unicon  </span>
         <span class="hljs-attribute">vty</span><span class="hljs-punctuation">:</span>
           <span class="hljs-attribute">ip</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.2.50</span>
           <span class="hljs-attribute">protocol</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ssh</span>
    <span class="hljs-attribute">lax-cor-r1</span><span class="hljs-punctuation">:</span>
        <span class="hljs-attribute">alias</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nxosv-1</span>
        <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ios </span>
        <span class="hljs-attribute">connections</span><span class="hljs-punctuation">:</span>
          <span class="hljs-attribute">defaults</span><span class="hljs-punctuation">:</span>
            <span class="hljs-attribute">class</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unicon.Unicon</span>
          <span class="hljs-attribute">vty</span><span class="hljs-punctuation">:</span>
            <span class="hljs-attribute">ip</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.2.51</span>
            <span class="hljs-attribute">protocol</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ssh</span>
<span class="hljs-attribute">topology</span><span class="hljs-punctuation">: </span>
    <span class="hljs-attribute">lax-edg-r1</span><span class="hljs-punctuation">:</span>
        <span class="hljs-attribute">interfaces</span><span class="hljs-punctuation">:</span>
            <span class="hljs-attribute">GigabitEthernet0/1</span><span class="hljs-punctuation">:</span>
                <span class="hljs-attribute">ipv4</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10.0.0.1/30</span>
                <span class="hljs-attribute">link</span><span class="hljs-punctuation">:</span> <span class="hljs-string">link-1</span>
                <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ethernet</span>
            <span class="hljs-attribute">Loopback0</span><span class="hljs-punctuation">:</span>
                <span class="hljs-attribute">ipv4</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.0.10/32</span>
                <span class="hljs-attribute">link</span><span class="hljs-punctuation">:</span> <span class="hljs-string">lax-edg-r1_Loopback0</span>
                <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">loopback</span>
    <span class="hljs-attribute">lax-cor-r1</span><span class="hljs-punctuation">:</span>
        <span class="hljs-attribute">interfaces</span><span class="hljs-punctuation">:</span>
            <span class="hljs-attribute">Eth2/1</span><span class="hljs-punctuation">:</span>
                <span class="hljs-attribute">ipv4</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10.0.0.2/30</span>
                <span class="hljs-attribute">link</span><span class="hljs-punctuation">:</span> <span class="hljs-string">link-1</span>
                <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ethernet</span>
            <span class="hljs-attribute">Loopback0</span><span class="hljs-punctuation">:</span>
                <span class="hljs-attribute">ipv4</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.0.100/32</span>
                <span class="hljs-attribute">link</span><span class="hljs-punctuation">:</span> <span class="hljs-string">lax-cor-r1_Loopback0</span>
                <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">loopback</span>
     
</code></pre>
    <p class="normal">In <code class="inlineCode">chapter16_12_pyats_2.py</code>, we will use the <code class="inlineCode">aest</code> module<a id="_idIndexMarker1228"/> from <code class="inlineCode">pyATS</code> with various decorators. Besides setup<a id="_idIndexMarker1229"/> and cleanup, the <code class="inlineCode">ping</code> test is in the <code class="inlineCode">PingTestCase</code> class:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">@aetest.loop(</span><span class="hljs-params">device = (</span><span class="hljs-string">'ios1'</span><span class="hljs-params">,)</span><span class="hljs-meta">)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">PingTestcase</span>(aetest.Testcase):
<span class="hljs-meta">    @aetest.test.loop(</span><span class="hljs-params">destination = (</span><span class="hljs-string">'10.0.0.1'</span><span class="hljs-params">, </span><span class="hljs-string">'10.0.0.2'</span><span class="hljs-params">)</span><span class="hljs-meta">)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title">ping</span>(<span class="hljs-params">self, device, destination</span>):
        <span class="hljs-keyword">try</span>:
            result = self.parameters[device].ping(destination)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.failed(<span class="hljs-string">'Ping {} from device {} failed with error: {}'</span>.<span class="hljs-built_in">format</span>(
                                destination,
                                device,
                                <span class="hljs-built_in">str</span>(e),
                            ),
                        goto = [<span class="hljs-string">'exit'</span>])
        <span class="hljs-keyword">else</span>:
            match = re.search(<span class="hljs-string">r'Success rate is (?P&lt;rate&gt;\d+) percent'</span>, result)
            success_rate = match.group(<span class="hljs-string">'rate'</span>)
</code></pre>
    <p class="normal">It is best practice to reference the testbed file at the command line during runtime:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>python chapter16_12_pyats_2.py --testbed chapter16_pyats_testbed_2.yml
</code></pre>
    <p class="normal">The output is similar to our first example, with the additions of <code class="inlineCode">STEPS Report</code> and <code class="inlineCode">Detailed Results</code> with each test case. </p>
    <pre class="programlisting con"><code class="hljs-con">2022-09-25T17:14:13: %AETEST-INFO: +------------------------------------------------------------------------------+
2022-09-25T17:14:13: %AETEST-INFO: |                            Starting common setup                             |
2022-09-25T17:14:13: %AETEST-INFO: +------------------------------------------------------------------------------+
2022-09-25T17:14:13: %AETEST-INFO: +------------------------------------------------------------------------------+
2022-09-25T17:14:13: %AETEST-INFO: |                      Starting subsection check_topology                      |
2022-09-25T17:14:13: %AETEST-INFO: +------------------------------------------------------------------------------+
2022-09-25T17:14:13: %AETEST-INFO: The result of subsection check_topology is =&gt; PASSED
2022-09-25T17:14:13: %AETEST-INFO: +------------------------------------------------------------------------------+
2022-09-25T17:14:13: %AETEST-INFO: |                  Starting subsection establish_connections                   |
2022-09-25T17:14:13: %AETEST-INFO: +------------------------------------------------------------------------------+
2022-09-25T17:14:13: %AETEST-INFO: +..............................................................................+
2022-09-25T17:14:13: %AETEST-INFO: :                  Starting STEP 1: Connecting to lax-edg-r1                   :
2022-09-25T17:14:13: %AETEST-INFO: +..............................................................................+
2022-09-25T17:14:13: %UNICON-WARNING: device's os is not provided, unicon may not use correct plugins
</code></pre>
    <p class="normal">The output also indicates<a id="_idIndexMarker1230"/> the log filename<a id="_idIndexMarker1231"/> that is written to the <code class="inlineCode">/tmp</code> directory:</p>
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">ls</span> /tmp/lax*
/tmp/lax-edg-r1-cli-20220925T170012042.log
/tmp/lax-edg-r1-cli-20220925T170030754.log
/tmp/lax-edg-r1-cli-20220925T170308615.log
/tmp/lax-edg-r1-cli-20220925T171145090.log
/tmp/lax-edg-r1-cli-20220925T171413444.log
<span class="hljs-con-meta">$ </span><span class="hljs-con-built_in">head</span> -20 /tmp/lax-edg-r1-cli-20220925T170012042.<span class="hljs-con-built_in">log</span>
2022-09-25 17:00:12,043: %UNICON-INFO: +++ lax-edg-r1 logfile /tmp/lax-edg-r1-cli-20220925T170012042.log +++
2022-09-25 17:00:12,043: %UNICON-INFO: +++ Unicon plugin generic (unicon.plugins.generic) +++
**************************************************************************
* IOSv is strictly limited to use for evaluation, demonstration and IOS  *
* education. IOSv is provided as-is and is not supported by Cisco's      *
* Technical Advisory Center. Any use or disclosure, in whole or in part, *
* of the IOSv Software or Documentation to any third party for any       *
* purposes is expressly prohibited except as otherwise authorized by     *
* Cisco in writing.                                                      *
**************************************************************************
2022-09-25 17:00:12,705: %UNICON-INFO: +++ connection to spawn: ssh -l cisco 192.168.2.51, id: 140482828326976 +++
2022-09-25 17:00:12,706: %UNICON-INFO: connection to lax-edg-r1
cisco@192.168.2.51's password: 
**************************************************************************
</code></pre>
    <p class="normal">The pyATS framework is a great framework for automated testing. However, because of its origin, the support for vendors outside of Cisco is a bit lacking.</p>
    <p class="normal">One open source tool for network validation to take note of is Batfish, <a href="https://github.com/batfish/batfish"><span class="url">https://github.com/batfish/batfish</span></a>, from the folks at Intentionet. A primary use case for Batfish is to validate configuration changes before deployment. Another<a id="_idIndexMarker1232"/> open source project is Suzieq (<a href="https://suzieq.readthedocs.io/en/latest/"><span class="url">https://suzieq.readthedocs.io/en/latest/</span></a>). Suzieq is the first<a id="_idIndexMarker1233"/> open source, multi-vendor network observability platform application. </p>
    <p class="normal">There is a bit of a learning curve involved with <code class="inlineCode">pyATS</code>; it basically has its own way of performing tests that takes some getting used to. Understandably, it is also heavily focused on Cisco platforms in its current iteration. The <code class="inlineCode">pyATS</code> core is closed sourced and released in a binary form. The packages that are developed to be used with <code class="inlineCode">pyATS</code>, such as the parser libraries, YANG connectors, and various plugins are open sourced. For the open source portion, we are all encouraged<a id="_idIndexMarker1234"/> to make contributions if we would like to add<a id="_idIndexMarker1235"/> additional vendor support or make syntax or process changes. </p>
    <p class="normal">We are near the end of the chapter, so let’s go over what we have done in this chapter.</p>
    <h1 class="heading-1" id="_idParaDest-331">Summary</h1>
    <p class="normal">In this chapter, we looked at TDD and how it can be applied to network engineering. We started with an overview of TDD; then, we looked at examples using the <code class="inlineCode">unittest</code> and <code class="inlineCode">pytest</code> Python modules. Python and simple Linux command-line tools can be used to construct tests for network reachability, configuration, and security.</p>
    <p class="normal">pyATS is a tool that Cisco released. It is a network-centric automated testing framework that we can leverage.</p>
    <p class="normal">Simply put, if it is not tested, it is not trusted. Everything in our network should be programmatically tested as much as possible. As with many software concepts, TDD is a never-ending service wheel. We strive to have as much test coverage as possible, but even at 100% test coverage, we can always find new ways and test cases to implement. This is especially true in networking, where the network is often the internet, and 100% test coverage of the internet is impossible.</p>
    <p class="normal">We are at the end of the book. I hope you have found the book as much a joy to read as it was a joy for me to write. I want to say a sincere “thank you” for taking the time to read this book. I wish you success and happiness on your Python network journey!</p>
    <h1 class="heading-1">Join our book community</h1>
    <p class="normal">To join our community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/networkautomationcommunity"><span class="url">https://packt.link/networkautomationcommunity</span></a></p>
    <p class="normal"><img alt="" src="../Images/QR_Code2903617220506617062.png"/></p>
  </div>
</body></html>