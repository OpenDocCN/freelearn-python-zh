<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer087">&#13;&#13;
    <h1 class="chapterNumber">2</h1>&#13;&#13;
    <h1 id="_idParaDest-23" class="chapterTitle">API Design</h1>&#13;&#13;
    <p class="normal">In this chapter, we will talk about the basic <strong class="keyword">application programming interface </strong>(<strong class="keyword">API</strong>)<strong class="keyword"> </strong>design principles. We will see how to start our design by defining useful abstractions that will create the foundation for the design.</p>&#13;&#13;
    <p class="normal">We will then <a id="_idIndexMarker029"/>present the principles for RESTful interfaces, covering both the <a id="_idIndexMarker030"/>strict, academic definition and a more practical definition to help when making designs. We will look at design approaches and techniques to help create a useful API based on standard practices. We will also spend some time talking about authentication, as this is a critical element for most APIs.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">We will focus in this book on RESTful interfaces, as they are the most common right now. Before <a id="_idIndexMarker031"/>that, there were other alternatives, including <strong class="keyword">Remote Procedure Call </strong>(<strong class="keyword">RPC</strong>) in the 80s, a way to make a remote function call, or <strong class="keyword">Single Object Access Protocol </strong>(<strong class="keyword">SOAP</strong>) in the early 2000s, which <a id="_idIndexMarker032"/>standardized the format of the remote call. Current RESTful interfaces are easier to read and take advantage of the already established usage of HTTP more strongly, although, in essence, they could potentially be integrated via these older specifications. </p>&#13;&#13;
      <p class="Information-Box--PACKT-">They are still available nowadays, although predominantly in older systems.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">We will cover how to create a versioning system for the API, attending to the different use cases that can be affected.</p>&#13;&#13;
    <p class="normal">We will see the difference between the frontend and the backend, and its interaction. Although the main objective of the chapter is to talk about API interfaces, we will also talk about HTML interfaces to see the differences and how they interact with other APIs.</p>&#13;&#13;
    <p class="normal">Finally, we will describe the design for the example that we will use later in the book.</p>&#13;&#13;
    <p class="normal">In this chapter, we'll cover the following topics:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">Abstractions</li>&#13;&#13;
      <li class="bullet">RESTful interfaces</li>&#13;&#13;
      <li class="bullet">Authentication</li>&#13;&#13;
      <li class="bullet">Versioning the API</li>&#13;&#13;
      <li class="bullet">Frontend and backend</li>&#13;&#13;
      <li class="bullet">HTML interfaces</li>&#13;&#13;
      <li class="bullet">Designing the API for the example</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">Let's take a look at abstractions first.</p>&#13;&#13;
    <h1 id="_idParaDest-24" class="title">Abstractions</h1>&#13;&#13;
    <p class="normal">An API allows us to use a piece of software without totally understanding all the different steps that <a id="_idIndexMarker033"/>are involved. It presents a clear menu of actions that can be performed, enabling an external user, who doesn't necessarily understand the complexities of the operation, to perform them efficiently. It presents a simplification of the process.</p>&#13;&#13;
    <p class="normal">These actions can be purely functional, where the output is only related to the input; for example, a mathematical function that calculates the barycenter of a planet and a star, given their orbits and masses. </p>&#13;&#13;
    <p class="normal">Alternatively, they can deal with state, as the same action repeated twice may have different effects; for example, retrieving the time in the system. Perhaps even a call allows the time zone of the computer to be set, and two subsequent calls to retrieve the time may return very different results.</p>&#13;&#13;
    <p class="normal">In both cases, the APIs are defining <strong class="keyword">abstractions</strong>. Retrieving the time of the system in a single operation is simple enough, but perhaps the details of doing so are not so easy. It may involve reading in a certain way some piece of hardware that keeps track of time. </p>&#13;&#13;
    <p class="normal">Different hardware may report the time differently, but the result should always be translated in a standard format. Time zones and time savings need to be applied. All this complexity is handled by the developers of the module that exposes the API and provides a clear and understandable contract with any user. "Call this function, and the time in ISO format will be returned."</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">While we are mainly talking about APIs, and throughout the book we will describe mostly ones related to online services, the concept of abstractions really can be applied to anything. A web page to manage a user is an abstraction, as it defines the concept of "user account" and the associated parameters. Another omnipresent example is the "Shopping cart" for e-commerce. It's good to create a clear mental image, as it helps to create a clearer and more consistent interface for the user.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">This is, of course, a simple example, but APIs can hide a tremendous amount of complexity under their interfaces. A good example to think about is a program like <code class="Code-In-Text--PACKT-">curl</code>. Even when <em class="italic">just</em> sending an HTTP request to a URL and printing the returned headers, there is a huge <a id="_idIndexMarker034"/>amount of complexity associated with this:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span><span class="bash"> curl -IL http://google.com</span>&#13;&#13;
HTTP/1.1 301 Moved Permanently&#13;&#13;
Location: http://www.google.com/&#13;&#13;
Content-Type: text/html; charset=UTF-8&#13;&#13;
Date: Tue, 09 Mar 2021 20:39:09 GMT&#13;&#13;
Expires: Thu, 08 Apr 2021 20:39:09 GMT&#13;&#13;
Cache-Control: public, max-age=2592000&#13;&#13;
Server: gws&#13;&#13;
Content-Length: 219&#13;&#13;
X-XSS-Protection: 0&#13;&#13;
X-Frame-Options: SAMEORIGIN&#13;&#13;
HTTP/1.1 200 OK&#13;&#13;
Content-Type: text/html; charset=ISO-8859-1&#13;&#13;
P3P: CP="This is not a P3P policy! See g.co/p3phelp for more info."&#13;&#13;
Date: Tue, 09 Mar 2021 20:39:09 GMT&#13;&#13;
Server: gws&#13;&#13;
X-XSS-Protection: 0&#13;&#13;
X-Frame-Options: SAMEORIGIN&#13;&#13;
Transfer-Encoding: chunked&#13;&#13;
Expires: Tue, 09 Mar 2021 20:39:09 GMT&#13;&#13;
Cache-Control: private&#13;&#13;
Set-Cookie: NID=211=V-jsXV6z9PIpszplstSzABT9mOSk7wyucnPzeCz-TUSfOH9_F-07V6-fJ5t9L2eeS1WI-p2G_1_zKa2Tl6nztNH-ur0xF4yIk7iT5CxCTSDsjAaasn4c6mfp3fyYXMp7q1wA2qgmT_hlYScdeAMFkgXt1KaMFKIYmp0RGvpJ-jc; expires=Wed, 08-Sep-2021 20:39:09 GMT; path=/; domain=.google.com; HttpOnly&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">This makes a call to <code class="Code-In-Text--PACKT-">www.google.com</code> and displays the headers of the response using the <code class="Code-In-Text--PACKT-">-I</code> flag. The <code class="Code-In-Text--PACKT-">-L</code> flag is added to automatically redirect any request which is what is happening here.</p>&#13;&#13;
    <p class="normal">Making a remote connection to a server requires a lot of different moving parts:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">DNS access to translate the server address <code class="Code-In-Text--PACKT-">www.google.com </code>to an actual IP address.</li>&#13;&#13;
      <li class="bullet">The communication between both servers, which involves using the TCP protocol to generate a persistent connection and guarantee the reception of the data.</li>&#13;&#13;
      <li class="bullet">Redirection based on the result from the first request, as the server returns a code pointing to another URL. This was done owing to the usage of the <code class="Code-In-Text--PACKT-">-L</code> flag.</li>&#13;&#13;
      <li class="bullet">The redirection points to an HTTPS URL, which requires adding a verification and encryption layer on top of that.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">Each of these steps also makes use of other APIs to perform smaller actions, which could involve the functionality of the operating system or even calling remote servers such as the DNS one to obtain data from there.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">Here, the <code class="Code-In-Text--PACKT-">curl</code> interface is used from the command line. While the strict definition of an API discard stipulates that the end user is a human, there's not really a big change. Good APIs should be easily testable by human users. Command-line interfaces can also be easily automated by bash scripts or other languages.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">But, from the <a id="_idIndexMarker035"/>point of view of the user of <code class="Code-In-Text--PACKT-">curl</code>, this is not very relevant. It is simplified to the point where a single command line with a few flags can perform aÂ well-defined operation without worrying about the format to get data from the DNS or how to encrypt a request using SSL.</p>&#13;&#13;
    <h2 id="_idParaDest-25" class="title">Using the right abstractions</h2>&#13;&#13;
    <p class="normal">For a successful interface, the root is to create a series of abstractions and present them to the user so <a id="_idIndexMarker036"/>that they can perform actions. The most important question when designing a new API is, therefore, to decide which are the best abstractions.</p>&#13;&#13;
    <p class="normal">When the process happens organically, the abstractions are decided mostly on the go. There is an initial idea, acknowledged as an understanding of the problem, that then gets tweaked. </p>&#13;&#13;
    <p class="normal">For example, it's very common to start a user management system by adding different flags to the users. So, a user has permission to perform action A, and then a parameter to perform action B, and so on. By adding one flag at a time, come the tenth flag, the process becomes very confusing.</p>&#13;&#13;
    <p class="normal">Then, a new abstraction can be used; roles and permissions. Certain kinds of users can perform different actions, such as admin roles. A user can have a role, and the role is the one that describes the related permissions.</p>&#13;&#13;
    <p class="normal">Note that this simplifies the problem, as it's easy to understand and manage. However, moving from "an individual collection of flags" to "several roles" can be aÂ complicated process. There is a reduction in the number of possible options. Perhaps some existing users have a peculiar combination of flags. All this needs to beÂ handled carefully.</p>&#13;&#13;
    <p class="normal">While designing a new API, it is good to try to explicitly describe the inherent abstractions <a id="_idIndexMarker037"/>that the API uses to clarify them, at least at a high level. This also has theÂ advantage of being able to think about that as a user of the API and see if things add up.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">One of the most useful viewpoints in the work of software developers is to detach yourself from your "internal view" and take the position of the actual user of the software. This is more difficult than it sounds, but it's certainly a skill worth developing. This will make you a better designer. Don't be afraid to ask a friend or coworker to detect blind spots in your design.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">However, every abstraction has its limits.</p>&#13;&#13;
    <h2 id="_idParaDest-26" class="title">Leaking abstractions</h2>&#13;&#13;
    <p class="normal">When an <a id="_idIndexMarker038"/>abstraction is leaking details from the implementation, and not presenting a perfectly opaque image, it's called a leaky abstraction.</p>&#13;&#13;
    <p class="normal">While a good <a id="_idIndexMarker039"/>API should try to avoid this, sometimes it happens. This can be caused by underlying bugs in the code serving the API, or sometimes directly from the way the code operates in certain operations.</p>&#13;&#13;
    <p class="normal">A common case for this is relational databases. SQL abstracts the process of searching data from how it is actually stored in the database. You can search with complex queries and get the result, and you don't need to know how the data is structured. But sometimes, you'll find out that a particular query is slow, and reorganizing the parameters of the query has a big impact on how this happens. This is a leaky abstraction.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This is very common, and the reason why there are significant tools to help ascertain what is going on when running a SQL query, which is very detached from the implementation. The main one is the <code class="Code-In-Text--PACKT-">EXPLAIN</code> command. </p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Operating systems are good examples of a system that generates good abstractions that don't leak the majority of the time. There are lots of examples. Not being able to read or write a file due to a lack of space (a less common problem now than three decades ago); breaking a <a id="_idIndexMarker040"/>connection with a remote server due to a network problem; or not being able to create a new connection due to reaching a limit in terms of the number of open file descriptors.</p>&#13;&#13;
    <p class="normal">Leaky abstractions are, to a certain degree, unavoidable. They are the result of not living in a perfect world. Software is fallible. Understanding and preparing for that is critical.</p>&#13;&#13;
    <blockquote class="packt_quote">"All non-trivial abstractions, to some degree, are leaky."&#13;&#13;
    <p class="normal" style="text-align: right;">â Joel Spolsky's Law of Leaky Abstractions</p></blockquote>&#13;&#13;
    <p class="normal">When designing an API, it is important to take this fact into account for several reasons:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><strong class="keyword">To present clear errors and hints externally</strong>. A good design will always include cases for things going wrong and try to present them clearly with proper error codes or error handling.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">To deal with errors that could come from dependent services internally</strong>. Dependent services can fail or have other kinds of problems. The API should abstract this to a certain degree, recovering from the problem if possible, failing gracefully if not, and returning a proper result if recovery isÂ impossible.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">The best design is the one that not only designs things when they work as expected, but also prepares for unexpected problems and is sure that they can be analyzed andÂ corrected.</p>&#13;&#13;
    <h2 id="_idParaDest-27" class="title">Resources and action abstractions</h2>&#13;&#13;
    <p class="normal">A very useful <a id="_idIndexMarker041"/>pattern to consider when designing an API is to produce a set of resources that can <a id="_idIndexMarker042"/>perform actions. This pattern uses two kinds of elements: <strong class="keyword">resources</strong> and <strong class="keyword">actions</strong>. </p>&#13;&#13;
    <p class="normal">Resources are passive elements that are referenced, while actions are performed on resources.</p>&#13;&#13;
    <p class="normal">For example, let's define a very simple interface to play a simple game guessing coin tosses. This is a game consisting of three guesses for three coin tosses, and the user wins if at <a id="_idIndexMarker043"/>least two of these guesses are correct.</p>&#13;&#13;
    <p class="normal">The resource <a id="_idIndexMarker044"/>and actions may be as follows:</p>&#13;&#13;
    <table id="table001" class="No-Table-Style _idGenTablePara-1">&#13;&#13;
      <colgroup>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
      </colgroup>&#13;&#13;
      <tbody>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Resource</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Actions</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Details</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">HEADS</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">None</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">A coin toss result.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">TAILS</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">None</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">A coin toss result.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">GAME</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">START</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">Start a new GAME.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">READ</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">Returns the current round (1 to 3) and the current correct guesses.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">COIN_TOSS</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">TOSS</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">Toss the coin. If the GUESS hasn't been produced, it returns an error.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">GUESS</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">Accepts HEADS or TAILS as the guess.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">RESULT</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Content--PACKT-">It returns HEADS or TAILS and whether the GUESS was correct.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
      </tbody>&#13;&#13;
    </table>&#13;&#13;
    <p class="normal">A possible sequence for a single game could be:</p>&#13;&#13;
    <pre class="programlisting code"><code class="hljs-code">GAME START&#13;&#13;
&gt; (GAME 1)&#13;&#13;
GAME 1 COIN_TOSS GUESS HEAD&#13;&#13;
GAME 1 COIN_TOSS TOSS&#13;&#13;
GAME 1 COIN_TOSS RESULT&#13;&#13;
&gt; (TAILS, INCORRECT)&#13;&#13;
GAME 1 COIN_TOSS GUESS HEAD&#13;&#13;
GAME 1 COIN_TOSS TOSS&#13;&#13;
GAME 1 COIN_TOSS RESULT&#13;&#13;
&gt; (HEAD, CORRECT)&#13;&#13;
GAME 1 READ&#13;&#13;
&gt; (ROUND 2, 1 CORRECT, IN PROCESS)&#13;&#13;
GAME 1 COIN_TOSS GUESS HEAD&#13;&#13;
GAME 1 COIN_TOSS TOSS&#13;&#13;
GAME 1 COIN_TOSS RESULT&#13;&#13;
&gt; (HEAD, CORRECT)&#13;&#13;
GAME 1 READ&#13;&#13;
&gt; (ROUND 3, 2 CORRECT, YOU WIN)&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">Note how each resource has its own set of actions that can be performed. Actions can be repeated if that's convenient, but it's not required. Resources can be combined into a hierarchical representation (like here, where <code class="Code-In-Text--PACKT-">COIN_TOSS</code> depends on a higher <code class="Code-In-Text--PACKT-">GAME</code> resource). Actions can require parameters that can be other resources.</p>&#13;&#13;
    <p class="normal">However, the <a id="_idIndexMarker045"/>abstractions are organized around having a consistent <a id="_idIndexMarker046"/>set of resources and actions. This way of explicitly organizing an API is useful as it clarifies what is passive and what's active in the system.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-"><strong class="keyword">Object-oriented programming</strong> (<strong class="keyword">OOP</strong>) uses these abstractions, as everything is an <a id="_idIndexMarker047"/>object that can receive messages to perform some actions. Functional programming, on the other hand, doesn't fit neatly into this structure, as "actions" can work like resources.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">This is a common pattern, and it's used in RESTful interfaces, as we will see next.</p>&#13;&#13;
    <h1 id="_idParaDest-28" class="title">RESTful interfaces</h1>&#13;&#13;
    <p class="normal">RESTful interfaces are incredibly common these days, and for good reason. They've become <a id="_idIndexMarker048"/>the de facto standard in web services that serve other applications.</p>&#13;&#13;
    <p class="normal"><strong class="keyword">Representational State Transfer</strong> (<strong class="keyword">REST</strong>) was <a id="_idIndexMarker049"/>defined in 2000 in a Ph.D. dissertation by Roy Fielding, and it uses HTTP standards as a basis to create a definition of a software architecture style. </p>&#13;&#13;
    <p class="normal">For a system <a id="_idIndexMarker050"/>to be considered RESTful, it should follow certain rules:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><strong class="keyword">Client-server architecture</strong>. It works through remote calling.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Stateless</strong>. All the information related to a particular request should be contained in the request itself, making it independent from the specific serverÂ serving the request.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Cacheability</strong>. The cacheability of the responses should be clear, either to say they are cacheable or not.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Layered system</strong>.<strong class="keyword"> </strong>The client cannot tell if they are connected to a final server or if there's an intermediate server.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Uniform interface</strong>, with <a id="_idIndexMarker051"/>four prerequisites:<ul>&#13;&#13;
          <li class="bullet-l2"><strong class="keyword">Resource identification in requests</strong>, meaning a resource is unequivocally represented, and its representation is independent</li>&#13;&#13;
          <li class="bullet-l2"><strong class="keyword">Resource manipulation through representations</strong>, allowing clients to have all the required information to make changes when they have the representation</li>&#13;&#13;
          <li class="bullet-l2"><strong class="keyword">Self-descriptive messages</strong>, meaning<strong class="keyword"> </strong>messages are complete in themselves</li>&#13;&#13;
          <li class="bullet-l2"><strong class="keyword">Hypermedia as the Engine of Application State</strong>, meaning the client can walk through the system using referenced hyperlinks</li>&#13;&#13;
        </ul>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Code on demand</strong>. This is an optional requirement, and it's normally not used. Servers can <a id="_idIndexMarker052"/>submit code in response to help perform operations or improve the client; for example, submitting JavaScript to be executed in the browser.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">This is the <a id="_idIndexMarker053"/>most formal definition. As you can see, it's not necessarily based on HTTPÂ requests. For more convenient usage, we need to limit the possibilities somewhat and set a common framework.</p>&#13;&#13;
    <h2 id="_idParaDest-29" class="title">A more practical definition</h2>&#13;&#13;
    <p class="normal">When people talk colloquially about RESTful interfaces, normally they are understood as interfaces <a id="_idIndexMarker054"/>based on HTTP resources using JSON formatted requests. This is wholly compatible with the definition that we've seen before, but taking some key elements into consideration.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">These key elements are sometimes ignored, leading to pseudo-RESTful interfaces, which don't have the same properties.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">The main <a id="_idIndexMarker055"/>one is that <strong class="keyword">URIs (Uniform Resource Identifiers)</strong> should describe clear resources, as well as HTTP methods and actions to perform <a id="_idIndexMarker056"/>on them, using the <strong class="keyword">CRUD (Create Retrieve Update Delete)</strong> approach.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">CRUD interfaces facilitate the performance of those actions: Create (save a new entry), Retrieve (read), Update (overwrite), and Delete entries. These are the basic operations for any persistent storage system.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">There are two kinds of URIs, whether they describe a single resource or a collection of resources, as can be seen in the following table:</p>&#13;&#13;
    <table id="table002" class="No-Table-Style _idGenTablePara-1">&#13;&#13;
      <colgroup>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
      </colgroup>&#13;&#13;
      <tbody>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Resource</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Example</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Method</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Description</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Collection</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">/books</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">GET</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">List operation. Returns all the available elements of the collection, for example, all books.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">POST</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Create operation. Creates a new element of the collection. Returns the newly created resource.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Single</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">/books/1</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">GET</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Retrieve operation. Returns the data from the resource, for example, the book with an ID of 1.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">PUT</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Set (Update) operation. Sends the new data for the resource. If it doesn't exist, it will be created. If it does, it will be overwritten.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">PATCH</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Partial update operation. Overwrites only the partial values for the resource, for example, sends and writes only the email for the user object.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">DELETE</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Delete operation. It deletes the resource.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
      </tbody>&#13;&#13;
    </table>&#13;&#13;
    <p class="normal">The key element of this design is the definition of everything as a resource, as we saw before. Resources <a id="_idIndexMarker057"/>are defined by their URIs, which contain a hierarchical view of the resources, for example:</p>&#13;&#13;
    <p class="normal"><code class="Code-In-Text--PACKT-">/books/1/cover</code> defines the resource of the cover image from the book with an ID ofÂ 1.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">For simplicity, we will use integer IDs to identify the resources in this chapter. In real-world operations, this is not recommended. They have no meaning at all, and, even worse, they can sometimes leak information about the number of elements in the system or their internal order. For example, a competitor could estimate how many new entries are being added each week. To detach from whatever internal representation, try to always use a natural key externally, if available, such as the ISBN number for books, or create a random <strong class="keyword">Universally Unique Identifier </strong>(<strong class="keyword">UUID</strong>).</p>&#13;&#13;
      <p class="Tip--PACKT-">Another problem with sequential integers is that, at high rates, the system may struggle to create them correctly, as it won't be possible to create two at the same time. This can limit the growth of a system.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Most of the input and output of the resources will be represented in JSON format. For example, this could be an example of a request and response to retrieve a user:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">GET /books/1&#13;&#13;
HTTP/1.1 200 OK&#13;&#13;
Content-Type: application/json&#13;&#13;
{"name": "Frankenstein", "author": "Mary Shelley", "cover": "http://library.lbr/books/1/cover"}&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">The response is formatted in JSON, as specified in <code class="Code-In-Text--PACKT-">Content-Type</code>. This makes it easy to parse and analyze automatically. Note that the <code class="Code-In-Text--PACKT-">avatar</code> field returns a hyperlink to another resource. This makes the interface walkable and reduces the amount of information that the client requires beforehand.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This is one of the most forgotten properties when designing RESTful interfaces. It is preferable to return full URIs to resources instead of indirect references, such as no-context IDs.</p>&#13;&#13;
      <p class="Tip--PACKT-">For example, when creating a new resource, include the new URI in the response, in the <code class="Code-In-Text--PACKT-">Location</code> header.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">To send new <a id="_idIndexMarker058"/>values to overwrite, the same format should be used. Note that some elements may be read-only, such as <code class="Code-In-Text--PACKT-">cover</code>, and aren't required:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">PUT /books/1&#13;&#13;
Content-Type: application/json&#13;&#13;
{"name": "Frankenstein or The Modern Prometheus", "author": "Mary Shelley"}&#13;&#13;
HTTP/1.1 200 OK&#13;&#13;
Content-Type: application/json&#13;&#13;
{"name": "Frankenstein or The Modern Prometheus", "author": "Mary Shelley", "cover": "http://library.com/books/1/cover"}&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">The <strong class="keyword">same representation should be used for input and output</strong>, making it easy for the client to retrieve a resource, modify it, and then resubmit it.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">This is really handy and creates a level of consistency that's very much appreciated when implementing a client. While testing, try to ensure that retrieving a value and resubmitting it is valid and doesn't create a problem.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">When the resource will be directly represented by binary content, it can return the proper format, specified in the <code class="Code-In-Text--PACKT-">Content-Type</code> header. For example, retrieving the avatar resource may return an image file:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">GET /books/1/cover&#13;&#13;
HTTP/1.1 200 OK&#13;&#13;
Content-Type: image/png&#13;&#13;
... &#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">In the same way, when creating or updating a new avatar, it should be sent in the proper format. </p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">While the original intention of RESTful interfaces was to make use of multiple formats, for example, accepting XML and JSON, this is not very common in practice. JSON is, by and large, the most standard format these days. Some systems may benefit from using multiple formats, though. </p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Another important property is ensuring that some actions are <strong class="keyword">idempotent</strong>, and others are not. Idempotent actions can be repeated multiple times, producing the same result, while repeating <a id="_idIndexMarker059"/>not-idempotent actions will generate different results. Evidently, the action should be identical.</p>&#13;&#13;
    <p class="normal">A clear case of this is the creation of a new element. If we submit two identical <code class="Code-In-Text--PACKT-">POST</code> creations of a new element of a resource list, it will create two new elements. For example, submitting two books with the same name and author will create two identical books.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This is assuming that there's no limitation to the content of the resource. If they are, the second request will fail, which will produce a different result to the first in any case.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">On the other hand, two <code class="Code-In-Text--PACKT-">GET</code> requests will produce the same result. The same is true for <code class="Code-In-Text--PACKT-">PUT</code> or <code class="Code-In-Text--PACKT-">DELETE</code>, as they'll overwrite or "delete again" the resource. </p>&#13;&#13;
    <p class="normal">The fact that the only non-idempotent requests are <code class="Code-In-Text--PACKT-">POST</code> actions simplifies significantly the design of measures to deal with problems when there's the question of whether it should be retried. Idempotent requests are safe to retry at any time, thereby simplifying the handling of errors such as network problems.</p>&#13;&#13;
    <h2 id="_idParaDest-30" class="title">Headers and statuses</h2>&#13;&#13;
    <p class="normal">An important detail of the HTTP protocol that can sometimes be overlooked is the different <a id="_idIndexMarker060"/>headers and status codes.</p>&#13;&#13;
    <p class="normal">Headers include metadata information about the request or response. Some of it is added automatically, like the size of the body of the request or response. Some interesting headers to consider are the following:</p>&#13;&#13;
    <table id="table003" class="No-Table-Style _idGenTablePara-1">&#13;&#13;
      <colgroup>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
      </colgroup>&#13;&#13;
      <tbody>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Header</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Type</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Details</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">Authorization</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Standard</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Credentials to authenticate the request.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">Content-Type</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Standard</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The type of the body of the request, like <code class="Code-In-Text--PACKT-">application/json</code> or <code class="Code-In-Text--PACKT-">text/html</code>. </p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">Date</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Standard</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">When the message was created.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">If-Modified-Since</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Standard</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The sender has a copy of the resource at this time. If it hasn't changed since then, a <code class="Code-In-Text--PACKT-">304 Not Modified</code> response (with an empty body) can be returned. This allows the caching of data and saves time and bandwidth by not returning duplicated info. This can be used in <code class="Code-In-Text--PACKT-">GET </code>requests.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">X-Forwarded-From</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">De facto standard</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Stores the IP where the message was originated, and the different proxies it went through.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">Forwarded</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Standard</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Same as <code class="Code-In-Text--PACKT-">X-Forwarded-From</code>. This is a newer header and less common still than <code class="Code-In-Text--PACKT-">X-Forwarded-From</code>.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
      </tbody>&#13;&#13;
    </table>&#13;&#13;
    <p class="normal">A well-designed API will make use of headers to communicate proper information, for example, setting <code class="Code-In-Text--PACKT-">Content-Type</code> correctly or accepting cache parameters if possible.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">A comprehensive <a id="_idIndexMarker061"/>list of headers can be found at <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers"><span class="url">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers</span></a>.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Another <a id="_idIndexMarker062"/>important detail is to make good use of available status codes. Status codes provide significant information about what happened, and using the most detailed information possible for each situation will provide a better interface.</p>&#13;&#13;
    <p class="normal"><strong class="keyword">Some common status codes are as follows:</strong></p>&#13;&#13;
    <table id="table004" class="No-Table-Style _idGenTablePara-1">&#13;&#13;
      <colgroup>&#13;&#13;
        <col/>&#13;&#13;
        <col/>&#13;&#13;
      </colgroup>&#13;&#13;
      <tbody>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Status code</p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="Table-Column-Heading--PACKT-">Description</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">200 OK</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">A successful resource access or modification. It should return a body; if it doesn't, use <code class="Code-In-Text--PACKT-">204 No Content</code>.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">201 Created</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">A successful <code class="Code-In-Text--PACKT-">POST</code> request that creates a new resource.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">204 No Content</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">A successful request that doesn't return a body, for example, a successful <code class="Code-In-Text--PACKT-">DELETE</code> request.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">301 Moved Permanently</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The accessed resource is now permanently located in a different URI. It should return a <code class="Code-In-Text--PACKT-">Location</code> header with the new URI. Most libraries will follow up automatically for <code class="Code-In-Text--PACKT-">GET</code> accesses. For example, the API is only accessible in <code class="Code-In-Text--PACKT-">HTTPS</code>, but it was accessed in <code class="Code-In-Text--PACKT-">HTTP</code>.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">302 Found</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The accessed resource is temporarily located in a different URI. A typical example is being redirected to a login page if authenticated.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">304 Not Modified</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">A cached resource is still valid. The body should be empty. This status code is only returned if the client requested cached information, for example, using the <code class="Code-In-Text--PACKT-">If-Modified-Since</code> header.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">400 Bad Request</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">A generic error in the request. This is the server saying, "something went wrong on your end." A more descriptive message should be added to the body. If a more descriptive status code is possible, it should be preferred.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">401 Unauthorized</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The request is not allowed, as the request is not properly authenticated. The request may lack valid headers for authentication.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">403 Forbidden</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The request is authenticated, but it can't access this resource. This is different from the <code class="Code-In-Text--PACKT-">401 Unauthorized</code> status in that the request is already correctly authenticated but doesn't have access.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">404 Not Found</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Probably the most famous status code! The resource described by the URI cannot be found.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">405 Method Not Allowed </code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The requested method cannot be used; for example, the resource cannot be deleted.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">429 Too Many Requests</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The server should return this status code if there's a limit to the number of requests the client can do. It should return a description or more info in the body, and ideally, a <code class="Code-In-Text--PACKT-">Retry-After</code> header indicating the time in seconds to the next retry. </p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">500 Server Error</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">A generic error in the server. This status should only be used if an unexpected error happened in the server.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">502 Bad Gateway</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The server is redirecting the request to a different server, and the communication was incorrect. This error normally appears when some backend service is unavailable or incorrectly configured.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">503 Service Unavailable</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">The server is currently unable to handle requests. Normally, this is a temporary situation, such as a load problem. It could be used to mark maintenance downtime, but this is generally rare.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
        <tr class="No-Table-Style">&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal"><code class="Code-In-Text--PACKT-">504 Gateway Timeout</code></p>&#13;&#13;
          </td>&#13;&#13;
          <td class="No-Table-Style">&#13;&#13;
            <p class="normal">Similar to <code class="Code-In-Text--PACKT-">502 Bad Gateway</code>, but in this case, the backend service didn't respond, provoking a timeout.</p>&#13;&#13;
          </td>&#13;&#13;
        </tr>&#13;&#13;
      </tbody>&#13;&#13;
    </table>&#13;&#13;
    <p class="normal">In general, non-descriptive error codes such as <code class="Code-In-Text--PACKT-">400 Bad Request</code> and <code class="Code-In-Text--PACKT-">500 Server Error</code> should be <a id="_idIndexMarker063"/>left for general situations. However, if there is a better, more descriptive status code, this should be used instead.</p>&#13;&#13;
    <p class="normal">For example, a <code class="Code-In-Text--PACKT-">PATCH</code> request to overwrite a parameter should return <code class="Code-In-Text--PACKT-">400 Bad Request</code> if the parameter is incorrect for any reason, but <code class="Code-In-Text--PACKT-">404 Not Found</code> if the resource URI is not found.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">There are other status codes. You can check a comprehensive list, including details on each one, here: <a href="https://httpstatuses.com/"><span class="url">https://httpstatuses.com/</span></a>.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">In any error, please include some extra feedback to the user with a reason. A general descriptor can help the handling of unexpected cases and simplify debugging issues.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This is especially useful for <code class="Code-In-Text--PACKT-">4XX</code> errors as they will help users of the API to fix their own bugs and iteratively improve their integration.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">For example, the mentioned <code class="Code-In-Text--PACKT-">PATCH</code> may return this body:</p>&#13;&#13;
    <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Field 'address' is unknown"</span>&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">This will give specific details about the problem. Other options include returning error codes, multiple messages in case there are multiple possible errors, and also duplicating the status code in the body.</p>&#13;&#13;
    <h2 id="_idParaDest-31" class="title">Designing resources</h2>&#13;&#13;
    <p class="normal">The available actions in a RESTful API are limited to CRUD operations. Therefore, resources <a id="_idIndexMarker064"/>are the basic construction blocks for the API. </p>&#13;&#13;
    <p class="normal">Making everything a resource helps to create very explicit APIs and helps with the stateless requirement for RESTful interfaces.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">A stateless service means that all the information required to fulfill a request is either provided by the caller or retrieved externally, normally from a database. This excludes other ways of keeping information, such as storing information locally in the same server's hard drive. This makes any server capable of handling every single request, and it's critical in achieving scalability.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Elements that could be activated by creating different actions could be separated into different resources. For example, an interface simulating a pen could require the following elements:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">Opening and closing the pen.</li>&#13;&#13;
      <li class="bullet">Writing something. Only an open pen can write.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">In some APIs, like an object-oriented one, this could involve creating a pen object and changing its state:</p>&#13;&#13;
    <pre class="programlisting code"><code class="hljs-code">pen = Pen()&#13;&#13;
pen.open()&#13;&#13;
pen.write("Something")&#13;&#13;
pen.close()&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">In a RESTful API, we need to create different resources for both the pen and its status:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">#</span><span class="bash"> Create a new pen with id 1</span>&#13;&#13;
POST /pens&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Create a new open pen for pen 1</span>&#13;&#13;
POST /pens/1/open&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Update the new open text for the open pen 1</span>&#13;&#13;
PUT /pens/1/open/1/text&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Delete the open pen, closing the pen</span>&#13;&#13;
DELETE /pens/1/open/1&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">This may look a bit cumbersome, but RESTful APIs should aim to be higher level than the typical object-oriented one. Either create the text directly, or create a pen and then the text, without having to perform the open/close operation.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Keep in mind that RESTful APIs are used in the context of remote calls. This means that they can't be low level, as each call is a big investment compared with a local API, as the time per call will be a sensible part of the operation.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Note also that every single aspect and step gets registered and has its own set of identifiers <a id="_idIndexMarker065"/>and is addressable. This is more explicit than the internal state that can be found in OOP. As we've seen, we want it to be stateless, while objects are very much stateful.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Keep in mind that a resource doesn't need to be translated directly into a database object. That's thinking backward, from the storage to the API. Remember that you are not limited to that, and can compose resources that obtain information from multiple sources or that don't fit into a direct translation. We will see examples in the next chapter.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Dealing only with resources can require certain adaptations if coming from a more traditional OOP environment, but they are a pretty flexible tool and can allocate multiple ways of performing actions.</p>&#13;&#13;
    <h2 id="_idParaDest-32" class="title">Resources and parameters</h2>&#13;&#13;
    <p class="normal">While everything is a resource, some elements make more sense as a parameter that interacts <a id="_idIndexMarker066"/>with the resource. This is very natural when modifying the resource. Any change needs to be submitted to update the resource. But, in other cases, some resources could be modified for other causes. The most common case is searches.</p>&#13;&#13;
    <p class="normal">A typical search endpoint will define a <code class="Code-In-Text--PACKT-">search</code> resource and retrieve its results. However, a search without parameters to filter is not really useful, so extra parameters will be required to define the search, for example:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">#</span><span class="bash"> Return every pen in the system</span>&#13;&#13;
GET /pens/search&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Return only red pens</span>&#13;&#13;
GET /pens/search?color=red&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Return only red pens, sorted by creation date</span>&#13;&#13;
GET /pens/search?color=red&amp;sort=creation_date&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">These parameters are stored in query parameters, which are natural extensions to retrieve them.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">As a general rule, only <code class="Code-In-Text--PACKT-">GET</code> requests should have query parameters. Other kinds of request methods should provide any parameters as part of the body.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal"><code class="Code-In-Text--PACKT-">GET</code> requests are also easy to cache if including the query parameters. If the search is returning the same values for each request, given that that's an idempotent request, the full URI, including the query parameters, can be cached even externally from the service.</p>&#13;&#13;
    <p class="normal">By convention, all logs that store <code class="Code-In-Text--PACKT-">GET</code> requests will also store the query params, while any parameter sent as a header or in the body of the request won't be logged. This has security <a id="_idIndexMarker067"/>implications, as any sensible parameter, such as a password, shouldn't be sent as a query parameter.</p>&#13;&#13;
    <p class="normal">Sometimes, that's the reason to create <code class="Code-In-Text--PACKT-">POST</code> operations that typically would be a <code class="Code-In-Text--PACKT-">GET</code> request, but prefer to set parameters in the body of the request instead of query parameters. While it is possible in the HTTP protocol to set the body in a <code class="Code-In-Text--PACKT-">GET</code> request, it's definitely very unusual.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">An example of this could be searching by phone number, email, or other personal information, so a middle-man agent could intercept and learn about them.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Another reason to use <code class="Code-In-Text--PACKT-">POST</code> requests is to allow a bigger space for parameters, as the full URL, including query parameters, is normally limited to 2K in size, while bodies are much less restricted in size.</p>&#13;&#13;
    <h2 id="_idParaDest-33" class="title">Pagination</h2>&#13;&#13;
    <p class="normal">In a RESTful interface, any <code class="Code-In-Text--PACKT-">LIST</code> request that returns a sensible number of elements should <a id="_idIndexMarker068"/>be paginated.</p>&#13;&#13;
    <p class="normal">This means that the number of elements and pages can be tweaked from the request, returning only a specific page of elements. This limits the scope of the request and avoids very slow response times and waste transmission bytes.</p>&#13;&#13;
    <p class="normal">An example could involve using the parameters <code class="Code-In-Text--PACKT-">page</code> and <code class="Code-In-Text--PACKT-">size</code>, for example:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">#</span><span class="bash"> Return only first 10 elements</span>&#13;&#13;
GET /pens/search?page=1&amp;size=10&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">A well-constructed response will have a similar format to this:</p>&#13;&#13;
    <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"next"</span>: <span class="hljs-string">"http://pens.pns/pens/search?page=2&amp;size=10"</span>,&#13;&#13;
    <span class="hljs-attr">"previous"</span>: <span class="hljs-literal">null</span>,&#13;&#13;
    <span class="hljs-attr">"result"</span>: [&#13;&#13;
        # elements&#13;&#13;
    ]&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">It contains a <code class="Code-In-Text--PACKT-">result</code> field with the resulting list and <code class="Code-In-Text--PACKT-">next</code> and <code class="Code-In-Text--PACKT-">previous</code> fields that are hyperlinks to the next and previous page, with a value of <code class="Code-In-Text--PACKT-">null</code> if it is not available. This makes it easy to walk through all the results.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">A <code class="Code-In-Text--PACKT-">sort</code> parameter could also be useful to ensure consistency in pages.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">This technique also allows multiple pages to be retrieved in parallel, which can speed up the downloading <a id="_idIndexMarker069"/>of information, doing several small requests instead of one big one. The objective, though, is to provide sufficient filter parameters for generally returning not too much information, being able to retrieve only the relevant information.</p>&#13;&#13;
    <p class="normal">Pagination has a problem, which is that the data in the collection may change between multiple requests, especially if retrieving many pages. The problem is as follows:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">#</span><span class="bash"> Obtain first page</span>&#13;&#13;
GET /pens/search?page=1&amp;size=10&amp;sort=name&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Create a new resource that is added to the first page</span>&#13;&#13;
POST /pens&#13;&#13;
<span class="hljs-con-meta">#</span><span class="bash"> Obtain second page</span>&#13;&#13;
GET /pens/search?page=2&amp;size=10&amp;sort=name&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">The second page now has a repeated element that used to be on the first page but has now moved to the second, and then there's one element that's not returned. Normally, the non-return of the new resource is not that much of a problem, as, after all, the retrieval of information started before its creation. However, the return of the same resource twice can be.</p>&#13;&#13;
    <p class="normal">To avoid this kind of problem, there's the possibility of sorting by default the values by creation date or something analogous. This way, any new resource will be added at the end of pagination and will be consistently retrieved.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">For resources that return inherently "new" elements, like notifications or similar, add an <code class="Code-In-Text--PACKT-">updated_since</code> parameter to retrieve only the new resources since the most recent access. This speeds up access in a practical way and retrieves only the relevant information.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Creating a <a id="_idIndexMarker070"/>flexible pagination system increases the usefulness of any API. Be sure that your pagination definition is consistent across any different resources.</p>&#13;&#13;
    <h2 id="_idParaDest-34" class="title">Designing a RESTful API process</h2>&#13;&#13;
    <p class="normal">The best <a id="_idIndexMarker071"/>way to start designing a RESTful API is to clearly state the resources and then describe them, including the following details:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Description of the action</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: Note that this may be shared for several actions, differentiated by the method (for example, GET to retrieve and DELETE to delete)</li>&#13;&#13;
      <li class="bullet"><em class="italic">Methods applicable</em>: The HTTP method to use for the action defined in this endpoint</li>&#13;&#13;
      <li class="bullet"><em class="italic">(Only if relevant) Input body</em>: The input body of the request</li>&#13;&#13;
      <li class="bullet"><em class="italic">Expected result in the body</em>: Result</li>&#13;&#13;
      <li class="bullet"><em class="italic">Possible expected errors</em>: Returning status codes depending on specific errors</li>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Description of the action</li>&#13;&#13;
      <li class="bullet"><em class="italic">(Only if relevant) Input query parameters</em>: Query parameters to add to the URI for extra functionality</li>&#13;&#13;
      <li class="bullet">(<em class="italic">Only if relevant) Relevant headers</em>: Any supported header</li>&#13;&#13;
      <li class="bullet"><em class="italic">(Only if relevant) Returning status codes out of the ordinary (200 and 201)</em>: Different from errors, in case there's a status code that's considered a success but it's not the usual case; for example, a success returns a redirection</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">This will be enough to create a design document that can be understood by other engineers and allow them to work on the interface.</p>&#13;&#13;
    <p class="normal">It is good practice, though, to start with a quick draft of the different URIs and methods, and to have a quick look at all the different resources that the system has without getting into too much detail, such as a body description or errors. This helpsÂ to detect missing resource gaps or other kinds of inconsistencies in the API.</p>&#13;&#13;
    <p class="normal">For example, the API described in this chapter has the following actions:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">GET    /pens&#13;&#13;
POST   /pens&#13;&#13;
POST   /pens/&lt;pen_id&gt;/open&#13;&#13;
PUT    /pens/&lt;pen_id&gt;/open/&lt;open_pen_id&gt;/text&#13;&#13;
DELETE /pens/&lt;pen_id&gt;/open/&lt;open_pen_id&gt;&#13;&#13;
GET    /pens/search&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">There <a id="_idIndexMarker072"/>are a couple of details that can be tweaked and improved here:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">It looks like we forgot to add the action to remove a pen, once created</li>&#13;&#13;
      <li class="bullet">There are a couple of <code class="Code-In-Text--PACKT-">GET</code> actions for retrieving information about the created resource that should be added</li>&#13;&#13;
      <li class="bullet">In the <code class="Code-In-Text--PACKT-">PUT</code> action, it feels a bit redundant to have to add <code class="Code-In-Text--PACKT-">/text</code></li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">With this feedback, we can again describe the API as follows (modifications have an arrow):</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">GET    /pens&#13;&#13;
POST   /pens&#13;&#13;
GET    /pens/&lt;pen_id&gt; &#13;&#13;
DELETE /pens/&lt;pen_id&gt; â&#13;&#13;
POST   /pens/&lt;pen_id&gt;/open&#13;&#13;
GET    /pens/&lt;pen_id&gt;/open/&lt;open_pen_id&gt; â&#13;&#13;
PUT    /pens/&lt;pen_id&gt;/open/&lt;open_pen_id&gt; â&#13;&#13;
DELETE /pens/&lt;pen_id&gt;/open/&lt;open_pen_id&gt;&#13;&#13;
GET    /pens/search&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">Note how the organization in the hierarchical structure helps to take a good look at all the elements and find either gaps or relations that may not be obvious at first glance.</p>&#13;&#13;
    <p class="normal">After that, we can get into details. We can use the template described at the start of the section, or any other one that works for you. For example, we can define the endpoints to create a new pen and read a pen in the system:</p>&#13;&#13;
    <p class="normal"><strong class="keyword">Creating a new pen:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Creates a new pen, specifying the color.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/pens</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>: <code class="Code-In-Text--PACKT-">POST</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Input body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"name"</span>: &lt;pen name&gt;,&#13;&#13;
    <span class="hljs-attr">"color"</span>: (black|blue|red)&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">400 Bad Request &#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">Error in the body, such as an unrecognized color, a duplicated name, or a bad format.</p>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieving an existing pen:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Retrieves an existing pen.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/pens/&lt;pen id&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>: <code class="Code-In-Text--PACKT-">GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"name"</span>: &lt;pen name&gt;,&#13;&#13;
    <span class="hljs-attr">"color"</span>: (black|blue|red)&#13;&#13;
    }&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">404 Not Found &#13;&#13;
The pen ID is not found.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">The main <a id="_idIndexMarker073"/>objective is that these small templates are useful and to the point. Feel free to tweak them as expected, and don't worry about being too completist with the errors or details. The most important part is that they are <strong class="keyword">useful</strong>; for example, adding a <code class="Code-In-Text--PACKT-">405 Method Not Allowed</code> message could be redundant.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">The API can also be <a id="_idIndexMarker074"/>designed using tools such as Postman (<a href="https://www.postman.com"><span class="url">www.postman.com</span></a>), which is an API platform that can be used to either design or test/debug existing APIs. While useful, it is good to be able to design an API without external tools, in case that's required, and because it forces you to think about the design and not necessarily the tool itself. We will also see how to use Open API, which is based more on the definition, and not so much on providing a test environment.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Designing and <a id="_idIndexMarker075"/>defining an API can also enable it to be structured in a standard manner afterward to take advantage of tools.</p>&#13;&#13;
    <h2 id="_idParaDest-35" class="title">Using the Open API specification</h2>&#13;&#13;
    <p class="normal">A more structured <a id="_idIndexMarker076"/>alternative is to use a tool such as Open API (<a href="https://www.openapis.org/"><span class="url">https://www.openapis.org/</span></a>). Open API is a specification for defining a RESTful API through <a id="_idIndexMarker077"/>a YAML or JSON document. This allows this definition to interact with other tools to generate automatic documentation for the API.</p>&#13;&#13;
    <p class="normal">It allows the definition of different components that can be repeated, both as input and output. This makes it easy to build consistent reusable objects. There are also ways of inheriting or composing from one another, thereby creating a rich interface.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">Describing the whole Open API specification in detail is beyond the scope of this book. Most common web frameworks allow integration with it, generating the YAML file <a id="_idIndexMarker078"/>automatically or the web documentation that we'll <a id="_idIndexMarker079"/>see later. It was previously called Swagger and its web page (<a href="https://swagger.io/"><span class="url">https://swagger.io/</span></a>) has a very useful editor and other resources. </p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">For example, this is a YAML file that describes the two endpoints described above. The file is available on GitHub: <a href="https://github.com/PacktPublishing/Python-Architecture-Patterns/blob/main/pen_example.yaml"><span class="url">https://github.com/PacktPublishing/Python-Architecture-Patterns/blob/main/pen_example.yaml</span></a>:</p>&#13;&#13;
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">openapi:</span> <span class="hljs-number">3.0.0</span>&#13;&#13;
<span class="hljs-attr">info:</span>&#13;&#13;
  <span class="hljs-attr">version:</span> <span class="hljs-string">"1.0.0"</span>&#13;&#13;
  <span class="hljs-attr">title:</span> <span class="hljs-string">"Swagger Pens"</span>&#13;&#13;
<span class="hljs-attr">paths:</span>&#13;&#13;
  <span class="hljs-string">/pens:</span>&#13;&#13;
    <span class="hljs-attr">post:</span>&#13;&#13;
      <span class="hljs-attr">tags:</span>&#13;&#13;
      <span class="hljs-bullet">-</span> <span class="hljs-string">"pens"</span>&#13;&#13;
      <span class="hljs-attr">summary:</span> <span class="hljs-string">"Add a new pen"</span>&#13;&#13;
      <span class="hljs-attr">requestBody:</span>&#13;&#13;
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Pen object that needs to be added to the store"</span>&#13;&#13;
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>&#13;&#13;
        <span class="hljs-attr">content:</span>&#13;&#13;
          <span class="hljs-attr">application/json:</span>&#13;&#13;
            <span class="hljs-attr">schema:</span>&#13;&#13;
              <span class="hljs-string">$ref:</span> <span class="hljs-string">"#/components/schemas/Pen"</span>&#13;&#13;
      <span class="hljs-attr">responses:</span>&#13;&#13;
        <span class="hljs-attr">"201":</span>&#13;&#13;
          <span class="hljs-attr">description:</span> <span class="hljs-string">"Created"</span>&#13;&#13;
        <span class="hljs-attr">"400":</span>&#13;&#13;
          <span class="hljs-attr">description:</span> <span class="hljs-string">"Invalid input"</span>&#13;&#13;
  <span class="hljs-string">/pens/{pen_id}:</span>&#13;&#13;
    <span class="hljs-attr">get:</span>&#13;&#13;
      <span class="hljs-attr">tags:</span>&#13;&#13;
      <span class="hljs-bullet">-</span> <span class="hljs-string">"pens"</span>&#13;&#13;
      <span class="hljs-attr">summary:</span> <span class="hljs-string">"Retrieve an existing pen"</span>&#13;&#13;
      <span class="hljs-attr">parameters:</span>&#13;&#13;
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"pen_id"</span>&#13;&#13;
        <span class="hljs-attr">in:</span> <span class="hljs-string">path</span>&#13;&#13;
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Pen ID"</span>&#13;&#13;
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>&#13;&#13;
        <span class="hljs-attr">schema:</span>&#13;&#13;
          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span>&#13;&#13;
          <span class="hljs-attr">format:</span> <span class="hljs-string">int64</span>&#13;&#13;
      <span class="hljs-attr">responses:</span>&#13;&#13;
        <span class="hljs-attr">"200":</span>&#13;&#13;
          <span class="hljs-attr">description:</span> <span class="hljs-string">"OK"</span>&#13;&#13;
          <span class="hljs-attr">content:</span>&#13;&#13;
            <span class="hljs-attr">application/json:</span>&#13;&#13;
              <span class="hljs-attr">schema:</span>&#13;&#13;
                <span class="hljs-string">$ref:</span> <span class="hljs-string">"#/components/schemas/Pen"</span>&#13;&#13;
        <span class="hljs-attr">"404":</span>&#13;&#13;
          <span class="hljs-attr">description:</span> <span class="hljs-string">"Not Found"</span>&#13;&#13;
<span class="hljs-attr">components:</span>&#13;&#13;
  <span class="hljs-attr">schemas:</span>&#13;&#13;
    <span class="hljs-attr">Pen:</span>&#13;&#13;
      <span class="hljs-attr">type:</span> <span class="hljs-string">"object"</span>&#13;&#13;
      <span class="hljs-attr">properties:</span>&#13;&#13;
        <span class="hljs-attr">name:</span>&#13;&#13;
          <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>&#13;&#13;
        <span class="hljs-attr">color:</span>&#13;&#13;
          <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>&#13;&#13;
          <span class="hljs-attr">enum:</span>&#13;&#13;
            <span class="hljs-bullet">-</span> <span class="hljs-string">black</span>&#13;&#13;
            <span class="hljs-bullet">-</span> <span class="hljs-string">blue</span>&#13;&#13;
            <span class="hljs-bullet">-</span> <span class="hljs-string">red</span>&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">In the <code class="Code-In-Text--PACKT-">components</code> part, the <code class="Code-In-Text--PACKT-">Pen</code> object gets defined, and then is used in both endpoints. You can <a id="_idIndexMarker080"/>see how both endpoints, <code class="Code-In-Text--PACKT-">POST /pens</code> and <code class="Code-In-Text--PACKT-">GET /pens/{pen_id}</code>, are defined and describe the expected input and output, taking into account the different errors that can be produced.</p>&#13;&#13;
    <p class="normal">One of the most interesting aspects of Open API is the ability to automatically generate a documentation page with all the information to help any possible implementation. The generated documentation looks like this:</p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_01.png" alt="Graphical user interface, text, application, email&#13;&#10;&#13;&#10;Description automatically generated" width="826" height="638"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.1: Swagger Pens documentation</p>&#13;&#13;
    <p class="normal">If the YAML file describes your interface correctly and fully, this can be really useful. In some <a id="_idIndexMarker081"/>cases, it could be advantageous to work from the YAML to the API. This first generates the YAML file and allows work in both directions from there, both in the frontend direction and the backend direction. For an API-first approach, it may make sense. It's even possible to automatically create skeletons of clients and servers in multiple languages, for example, servers in Python Flask or Spring, and clients in Java or Angular.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Keep in mind that it's up to you to make the implementation match the definition closely. These skeletons will still require enough work to make them work correctly. Open API will simplify the process, but it won't magically solve all integration problems.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Each of <a id="_idIndexMarker082"/>the endpoints contains further information and can even be tested in the same documentation, thereby significantly helping an external developer who wants to use the API, as we can see in the next graphic:</p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_02.png" alt="Graphical user interface, application&#13;&#10;&#13;&#10;Description automatically generated" width="829" height="832"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.2: Swagger Pens expanded documentation</p>&#13;&#13;
    <p class="normal">Given that it's very easy to ensure that the server can generate this automatic documentation, even if the design is not started from an Open API YAML file, it's a good idea to <a id="_idIndexMarker083"/>generate it so as to create self-generating documentation.</p>&#13;&#13;
    <h1 id="_idParaDest-36" class="title">Authentication</h1>&#13;&#13;
    <p class="normal">A critical part of virtually any API is the ability to distinguish between authorized and unauthorized <a id="_idIndexMarker084"/>access. Being able to log the user properly is critical, and a headache from the point of view of security.</p>&#13;&#13;
    <p class="normal">Security is hard, so it's better to rely on standards to simplify the operation.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">As we said before, these are just general tips, but in no way a comprehensive set of secure practices. This book is not focused on security. Please keep up with security issues and solutions, as this is a field that is always evolving.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">The most important security issue regarding authentication is <strong class="keyword">to always use HTTPS endpoints</strong> <strong class="keyword">in production</strong>. This allows the channel to be protected against eavesdropping and makes communication private. Note that an HTTP website just means that the communication is private; you could be talking with the devil. But it's the bare minimum required to allow users of your API to send you passwords and other sensitive information without the fear that an external user is going to receive this information.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Normally, most architectures use HTTPS until the request reaches the data center or secure network, and then use HTTP internally. This permits a check on the data flowing internally but also protects data that is traveling across the internet. While less important these days, it also improves efficiency, as encoding requests in HTTPS require extra processing power.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">HTTPS endpoints are valid for all access, but other details are specific depending on whether they are HTML interfaces or RESTful ones.</p>&#13;&#13;
    <h2 id="_idParaDest-37" class="title">Authenticating HTML interfaces</h2>&#13;&#13;
    <p class="normal">In HTML <a id="_idIndexMarker085"/>web pages, normally, the flow to authenticate is as follows:</p>&#13;&#13;
    <ol>&#13;&#13;
      <li class="numbered" value="1">A login screen gets presented to the user.</li>&#13;&#13;
      <li class="numbered">The user enters their login and password and sends them to the server.</li>&#13;&#13;
      <li class="numbered">The server verifies the password. If correct, it returns a cookie with a session ID.</li>&#13;&#13;
      <li class="numbered">The browser receives the response and stores the cookie.</li>&#13;&#13;
      <li class="numbered">All new requests will send the cookie. The server will verify the cookie and properly identify the user.</li>&#13;&#13;
      <li class="numbered">The user can log out, removing the cookie. If this is done explicitly, a request will be sent to the server to delete the session ID. Typically, the session ID will have an expiry time for cleaning itself. This expiry can renew itself on each access or force the user to log in again from time to time.</li>&#13;&#13;
    </ol>&#13;&#13;
    <p class="normal">It's important to set up the cookie as <code class="Code-In-Text--PACKT-">Secure</code>, <code class="Code-In-Text--PACKT-">HttpOnly</code>, and <code class="Code-In-Text--PACKT-">SameSite</code>. <code class="Code-In-Text--PACKT-">Secure</code> ensures that the cookie is only sent to HTTPS endpoints, and not to HTTP ones. <code class="Code-In-Text--PACKT-">HttpOnly</code> renders the cookie <a id="_idIndexMarker086"/>inaccessible by JavaScript, which makes it more difficult to obtain the cookie via malicious code. The cookie will be sent automatically to the host that sets it. <code class="Code-In-Text--PACKT-">SameSite</code> ensures that cookies are only sent when the origin of the source is a page from the same host. It can be set to <code class="Code-In-Text--PACKT-">Strict</code>, <code class="Code-In-Text--PACKT-">Lax</code>, and <code class="Code-In-Text--PACKT-">None</code>. <code class="Code-In-Text--PACKT-">Lax</code> allows you to navigate to the page from a different site, thereby sending the cookie, while <code class="Code-In-Text--PACKT-">Strict</code> doesn't allow it.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">You can <a id="_idIndexMarker087"/>obtain more information at the Mozilla SameSite Cookie page: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite"><span class="url">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite</span></a>.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Possible bad usage of the cookie is through XSS (cross-site scripting) attacks. A compromised script reads that cookie, and then forges bad requests authenticated as the user.</p>&#13;&#13;
    <p class="normal">Another important kind of security problem is <strong class="keyword">cross-site request forgery </strong>(<strong class="keyword">CSRF</strong>). In this case, the fact that the user is logged in on an external service is exploited by presenting a URL that will be automatically executed in a different, compromised website.</p>&#13;&#13;
    <p class="normal">For example, while accessing a forum, a URL from a common bank is called, presented as an image, for example. If the user is logged in to this bank, the operation will be executed.</p>&#13;&#13;
    <p class="normal">The <code class="Code-In-Text--PACKT-">SameSite</code> attribute greatly reduces the risk of CSRF, but in case the attribute is not understood by older browsers, operations presented to the user by the bank should present a random token, making the user send both the authenticated request with the cookie and a valid token. An external page won't know a valid random token, making this exploit much more difficult. </p>&#13;&#13;
    <p class="normal">The session ID that the cookie contains can either be stored in the database, being just a random unique identifier, or a rich token.</p>&#13;&#13;
    <p class="normal">A random identifier is just that, a random number that stores the related information in the database, mainly, who is accessing and when the session expires. With every access, this session ID is queried to the server and the related information is retrieved. On very big deployments, with many accesses, this can create problems asÂ it's less scalable. The database where the session ID is stored needs to be accessed by all workers, which can create a bottleneck.</p>&#13;&#13;
    <p class="normal">One possible solution is to create a rich data token. This works by adding all the required information directly to the cookie; for example, storing the user ID, expiry, and so on, directly. This avoids database access, but makes the cookie possible to forge, as all information is in the open. To fix it, the cookie is signed.</p>&#13;&#13;
    <p class="normal">The signature <a id="_idIndexMarker088"/>proves that the data was originated by a trusted login server and can be verified independently by any other server. This is more scalable and avoids bottlenecks. Optionally, the content can also be encrypted to avoid being read.</p>&#13;&#13;
    <p class="normal">Another advantage of this system is that the generation of the token can be independent of the general system. If the token can be validated independently, there's no need for the login server to be the same as the general server.</p>&#13;&#13;
    <p class="normal">Even more so, a single token signer can issue tokens for multiple services. This is the basis for <strong class="keyword">SSO</strong> (<strong class="keyword">Single Sign-On</strong>): log in to an auth provider and then use the same account in several <a id="_idIndexMarker089"/>related services. This is very common in common services such as Google, Facebook or GitHub, to avoid having to create a specific login for some web pages.</p>&#13;&#13;
    <p class="normal">That operation mode, having a token authority, is the basis of the OAuth authorization framework.</p>&#13;&#13;
    <h2 id="_idParaDest-38" class="title">Authenticating RESTful interfaces</h2>&#13;&#13;
    <p class="normal">OAuth has <a id="_idIndexMarker090"/>become a common standard for authenticating access for APIs, and RESTful APIs in particular.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">There's a <a id="_idIndexMarker091"/>difference between authenticating <a id="_idIndexMarker092"/>and authorizing, and in essence, OAuth is <a id="_idIndexMarker093"/>an authorization system. Authenticating is determining who the user is, while authorizing is what the user is capable of doing. OAuth uses the concept of <code class="Code-In-Text--PACKT-">scope</code> to return what the capabilities of a user are.</p>&#13;&#13;
      <p class="Information-Box--PACKT-">Most implementations of OAuth, such as OpenID Connect, also include the user information in the returning token to also authenticate the user, returning who the user is.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">It is based on the idea that there's an authorizer who can check the identity of the user and provide <a id="_idIndexMarker094"/>them with a token with information allowing the user to log in. TheÂ service will receive this token and will log the user:</p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_03.png" alt="Diagram&#13;&#10;&#13;&#10;Description automatically generated" width="825" height="455"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.3: Authentication flow</p>&#13;&#13;
    <p class="normal">The most common version at the moment is OAuth 2.0, which allows flexibility in terms of logging in and flow. Keep in mind that OAuth is not exactly a protocol, but provides certain ideas that can be tweaked to the specific use case.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">This means that there are different ways in which you can implement OAuth, and, crucially, that different authorizers will implement it differently. Please verify their documentation with care when implementing the integration. </p>&#13;&#13;
      <p class="Information-Box--PACKT-">Generally, authorizers use the OpenID Connect protocol, which is based on OAuth.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">There's an important difference in terms of whether the system accessing the API is the final user directly, or whether it accesses it on behalf of a user. An example of the latter could be a smartphone app to access a service like Twitter, or a service that needs to access the <a id="_idIndexMarker095"/>data stored for the user in GitHub, such as a code analysis tool. The app itself is not the one that performs the actions but transfers the actions of a user.</p>&#13;&#13;
    <p class="normal">This flow is <a id="_idIndexMarker096"/>called the Authorization Code grant. The main characteristic is that the auth provider will present a login page to the user and redirect them with the authentication token. </p>&#13;&#13;
    <p class="normal">For example, this could be the sequence of calls for the Authorization Code grant:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">GET https://myservice.com/login&#13;&#13;
    Return a page with a form to initiate the login with authorizer.com&#13;&#13;
Follow the flow in the external authorize until login, with something like.&#13;&#13;
POST https://authorizer.com/authorize&#13;&#13;
  grant_type=authorization_code&#13;&#13;
  redirect_uri=https://myservice.com/redirect&#13;&#13;
  user=myuser&#13;&#13;
  password=mypassword&#13;&#13;
    Return 302 Found to https://myservice.com/redirect?code=XXXXX&#13;&#13;
GET https://myservice.com/redirect?code=XXXXX&#13;&#13;
<span class="hljs-con-meta">-&gt;</span><span class="bash"> Login into the system and </span><span class="hljs-con-built_in">set</span><span class="bash"> proper cookie,</span> &#13;&#13;
   return 302 to https://myservice.com&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">If the system accessing the API is from the end user directly, the Client Credentials grant type flow can be used instead. In this case, the first call will send <code class="Code-In-Text--PACKT-">client_id</code> (user ID) and <code class="Code-In-Text--PACKT-">client_secret</code> (password) to retrieve the authentication token directly. This token will be set in new calls as a header, authenticating the request. </p>&#13;&#13;
    <p class="normal">Note that this skips a step, and is easier to automate:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">POST /token HTTP/1.1&#13;&#13;
  grant_type=authorization_code&#13;&#13;
  &amp;client_id=XXXX&#13;&#13;
  &amp;client_secret=YYYY&#13;&#13;
    Returns a JSON body with&#13;&#13;
    {&#13;&#13;
  "access_token":"ZZZZ",&#13;&#13;
  "token_type":"bearer",&#13;&#13;
  "expires_in":86400,&#13;&#13;
}&#13;&#13;
Make new requests setting the header&#13;&#13;
Authorization: "Bearer ZZZZ"&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">While OAuth <a id="_idIndexMarker097"/>allows you to use an external server to retrieve the access token, that's not strictly required. It can be the same server as the rest. This is useful for this last flow, where the ability to log in with an external provider such as Facebook or Google is not as useful. Our example system will use the Client Credentials flow.</p>&#13;&#13;
    <h3 id="_idParaDest-39" class="title">Self-encoded tokens</h3>&#13;&#13;
    <p class="normal">The returned tokens from the authorization server can contain sufficient information such that <a id="_idIndexMarker098"/>no external check with the authorizer is required.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">As we've seen, including the user information in the token is important to determine who the user is. If not, we will end with a request that is capable of doing the work, but without information on behalf of who.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">To do so, the token is typically encoded in a <strong class="keyword">JSON Web Token </strong>(<strong class="keyword">JWT</strong>). A JWT is a standard that encodes a JSON object in a URL-safe sequence of characters.</p>&#13;&#13;
    <p class="normal">A JWT <a id="_idIndexMarker099"/>has the following elements:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">A header. This contains information on how the token is encoded.</li>&#13;&#13;
      <li class="bullet">A payload. The body of the token. Some of the fields in this object, called claims, are standard, but it can allocate custom claims as well. Standard claims are not required and can describe elements such as the issuer (<code class="Code-In-Text--PACKT-">iss</code>), orÂ the expiration time of the token as Unix Epoch (<code class="Code-In-Text--PACKT-">exp</code>).</li>&#13;&#13;
      <li class="bullet">A signature. This verifies that the token was generated by the proper source. This uses different algorithms, based on the information in the header.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">In general, a JWT is encoded, but it's not encrypted. A standard JWT library will decode its parts and verify that the signature is correct.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">You can test the different fields and systems in the interactive tool: <a href="https://jwt.io/"><span class="url">https://jwt.io/</span></a>.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">For example, to generate <a id="_idIndexMarker100"/>a token using <code class="Code-In-Text--PACKT-">pyjwt</code> (<a href="https://pypi.org/project/PyJWT/"><span class="url">https://pypi.org/project/PyJWT/</span></a>), you'll need to install PyJWT using pip if not previously installed:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$</span><span class="bash"> pip install PyJWT</span>&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">Then, while <a id="_idIndexMarker101"/>opening a Python interpreter, to create a token with a payload with a user ID and an HS256 algorithm to sign it with the <code class="Code-In-Text--PACKT-">"secret"</code> secret, you use the following code:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="hljs-con-keyword">import</span><span class="python"> jwt</span>&#13;&#13;
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">token = jwt.encode({</span><span class="hljs-con-string">"user_id"</span><span class="python">: </span><span class="hljs-con-string">"1234"</span><span class="python">}, </span><span class="hljs-con-string">"secret"</span><span class="python">, algorithm=</span><span class="hljs-con-string">"HS256"</span><span class="python">)</span>&#13;&#13;
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">token</span>&#13;&#13;
'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCJ9.vFn0prsLvRu00Kgy6M8s6S2Ddnuvz-FgtQ7nWz6NoC0'&#13;&#13;
</code></pre>&#13;&#13;
    <p class="normal">The JWT token can then be decoded and the payload extracted. If the secret is incorrect, it will produce an error:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">jwt.decode(token,</span><span class="hljs-con-string">"secret"</span><span class="python">, algorithms=[</span><span class="hljs-con-string">'HS256'</span><span class="python">])</span>&#13;&#13;
{'user_id': '1234'}&#13;&#13;
<span class="hljs-con-meta">&gt;&gt;&gt;</span> <span class="python">jwt.decode(token,</span><span class="hljs-con-string">"badsecret"</span><span class="python">, algorithms=[</span><span class="hljs-con-string">'HS256'</span><span class="python">])</span>&#13;&#13;
Traceback (most recent call last):&#13;&#13;
 â¦&#13;&#13;
  jwt.exceptions.InvalidSignatureError: Signature verification failed&#13;&#13;
</code></pre>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">The algorithm to be used is stored in the headers, but it's a good idea, for reasons of security, to only validate the token with the expected algorithm and not rely on the header. In the past, there have been some security problems with certain JWT implementations and forgery of the tokens, as you can read here: <a href="https://www.chosenplaintext.ca/2015/03/31/jwt-algorithm-confusion.html"><span class="url">https://www.chosenplaintext.ca/2015/03/31/jwt-algorithm-confusion.html</span></a>.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">The most interesting algorithms, though, are not symmetrical ones like <code class="Code-In-Text--PACKT-">HS256</code>, where the same value is added for encoding and decoding, but public-private keys like RSA-256 (<code class="Code-In-Text--PACKT-">RS256</code>). This allows the token to be encoded with the private key and verified with the public key.</p>&#13;&#13;
    <p class="normal">This schema <a id="_idIndexMarker102"/>is very common, as the public key can be distributed widely, but only the proper authorizer who has the private key can be the source of the tokens.</p>&#13;&#13;
    <p class="normal">Including the payload information that can be used to identify the user allows authentication of the requests using just the information in the payload, once verified, as we discussed earlier.</p>&#13;&#13;
    <h1 id="_idParaDest-40" class="title">Versioning the API</h1>&#13;&#13;
    <p class="normal">Interfaces are rarely created fully formed from scratch. They are constantly being tweaked, with <a id="_idIndexMarker103"/>new features added, and bugs or inconsistencies fixed. To better communicate these changes, it's useful to create some sort of versioning to transmit this information.</p>&#13;&#13;
    <h2 id="_idParaDest-41" class="title">Why versioning?</h2>&#13;&#13;
    <p class="normal">The main advantage of versioning is to shape the conversation about what things are included <a id="_idIndexMarker104"/>when. This can be bug fixes, new features, or even newly introduced bugs.</p>&#13;&#13;
    <p class="normal">If we know that the current interface released is version <code class="Code-In-Text--PACKT-">v1.2.3</code>, and we are about toÂ release version <code class="Code-In-Text--PACKT-">v1.2.4</code>, which fixes bug X, we can talk about it more easily, as well as creating release notes informing users of that fact.</p>&#13;&#13;
    <h2 id="_idParaDest-42" class="title">Internal versus external versioning</h2>&#13;&#13;
    <p class="normal">There are two kinds of versions that can get a bit confused. One is the internal version, which is something <a id="_idIndexMarker105"/>that makes sense for the <a id="_idIndexMarker106"/>developers of a project. This is normally related to the version of the software, usually with some help from version control, such asÂ Git.</p>&#13;&#13;
    <p class="normal">This version is very detailed and can cover very small changes, including small bug fixes. The aim of it is to be able to detect even minimal changes between software toÂ allow the detection of bugs or the introduction of code.</p>&#13;&#13;
    <p class="normal">The other is the external version. The external version is the version that people using the external service are going to be able to perceive. While this can be as detailed as the internal one, that is normally not that helpful to users and can provideÂ a confusing message.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This largely depends on the kind of system and who their expected users are. A highly technical user will appreciate the extra details, but a more casual one will not.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">For example, an internal version may distinguish between two different bug fixes, as this is useful to replicate. An externally communicated version can combine them both in "multiple bug fixes and improvements."</p>&#13;&#13;
    <p class="normal">Another good example of when it's useful to make a difference is when the interface changes <a id="_idIndexMarker107"/>massively. For example, a brand-new revamp of the look and feel of a site could use "Version 2 interface," but this can <a id="_idIndexMarker108"/>happen over multiple internal new versions, to be tested internally or by a selected group (for example, beta testers). Finally, when the "Version 2 interface" is ready, it can be activated for all users.</p>&#13;&#13;
    <p class="normal">One way of describing the external version could be to call it a "marketing version."</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Note that here we are avoiding the term "release version" as it could be misleading. This version is only used to communicate information externally.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">This version will be more dependent on marketing efforts than technical implementation.</p>&#13;&#13;
    <h2 id="_idParaDest-43" class="title">Semantic versioning</h2>&#13;&#13;
    <p class="normal">A common <a id="_idIndexMarker109"/>pattern for defining versions is to use semantic versioning. Semantic versioning describes a method with three increasing integers that carry different meanings, in descending order of incompatibility: </p>&#13;&#13;
    <p class="normal"><code class="Code-In-Text--PACKT-">vX.Y.Z</code></p>&#13;&#13;
    <p class="normal">X is called the <strong class="keyword">major</strong> version. Any change in the major version will mean backward-incompatible changes.</p>&#13;&#13;
    <p class="normal">Y is the <strong class="keyword">minor</strong> version. Minor changes may add new features, but any change will be backward compatible.</p>&#13;&#13;
    <p class="normal">Z is the <strong class="keyword">patch</strong> version. It will only make small changes such as bug fixes and security patches, but it doesn't change the interface itself.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">The <code class="Code-In-Text--PACKT-">v</code> at the start is optional but helps to indicate that it's a version number.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">This means that software designed to work with <code class="Code-In-Text--PACKT-">v1.2.15</code> will work with versions <code class="Code-In-Text--PACKT-">v1.2.35</code> and <code class="Code-In-Text--PACKT-">v1.3.5</code>, but it won't work with version <code class="Code-In-Text--PACKT-">v2.1.3</code> or version <code class="Code-In-Text--PACKT-">v1.1.4</code>. It may work with version <code class="Code-In-Text--PACKT-">v1.2.14</code>, but it may have some bug that was corrected later.</p>&#13;&#13;
    <p class="normal">Sometimes, extra details can be added to describe interfaces that are not ready, for example, <code class="Code-In-Text--PACKT-">v1.2.3-rc1</code> (release candidate) or <code class="Code-In-Text--PACKT-">v1.2.3-dev0</code> (development version).</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Normally, before the software is ready for release, the major number is set to zero (for example, <code class="Code-In-Text--PACKT-">v0.1.3</code>), making version <code class="Code-In-Text--PACKT-">v1.0.0</code> the first one to be publicly available.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">This semantic <a id="_idIndexMarker110"/>versioning is very easy to understand and gives good information about changes. It is widely used, but it has some problems in certain cases:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">Strictly adopting the major version for systems that don't have clear backward compatibility can be difficult. This was the reason why the Linux kernel stopped using proper semantic versioning, because they will never update the major version, as every single release needed to be backward compatible. In that case, a major version can be frozen for years and years and stops being a useful reference. In the Linux kernel, that happened with version 2.6.X, which remained for 8 years until version 3.0 was released in 2011 without any backward-incompatible change.</li>&#13;&#13;
      <li class="bullet">Semantic versioning requires a pretty strict definition of the interface. If the interface changes often with new features, as happens typically with online services, the minor version increases quickly, and the patch version is of almost no use.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">For online services, the combination of both will make only a single number useful, which is not a great use of it. Semantic versioning works better for cases that require multiple API versions working at the same time, for example:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">The API is very stable and changes very rarely, though there are regular security updates. Every couple of years, there's a major update. A good example is databases, such as MySQL. Operative systems are another example.</li>&#13;&#13;
      <li class="bullet">The API belongs to a software library that can be used by multiple supported environments; for example, a Python library compatible with Python 2 for version v4 and Python 3 for v5. This can allow several versions to be kept alive if required.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">If the system <a id="_idIndexMarker111"/>effectively has a single version running at the same time, it is better to not add the extra effort to keep proper semantic versioning in place as the effort is not worth the reward in terms of the kind of investment required.</p>&#13;&#13;
    <h2 id="_idParaDest-44" class="title">Simple versioning</h2>&#13;&#13;
    <p class="normal">Instead of doing strict semantic versioning, a simplified version can be done instead. This won't <a id="_idIndexMarker112"/>carry the same kind of meaning, but it will be a constantly increasing counter. This will work to coordinate teams, although it won't require the same kind of commitment.</p>&#13;&#13;
    <p class="normal">This is the same idea as the build number that can be created automatically by compilers, an increasing number to distinguish one version from another and work as a reference. However, a plain build number can be a bit dry to use.</p>&#13;&#13;
    <p class="normal">It is better to use a similar structure to semantic versioning, as it will be understandable by everyone; but instead of using it with specific rules, it is looser than that: </p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">Normally, for a new version, increase the patch version.</li>&#13;&#13;
      <li class="bullet">If either the patch version gets too high (in other words, 100, 10, or another arbitrary number), increase the minor version and set the patch version to zero.</li>&#13;&#13;
      <li class="bullet">Alternatively, if there's any special milestone for the project, as defined by the people working on it, increase the minor number earlier.</li>&#13;&#13;
      <li class="bullet">Do the same with the major version number.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">This will allow the numbers to be increased in a consistent way without worrying too much about meaning.</p>&#13;&#13;
    <p class="normal">This structure works very well for things like online cloud services, which, in essence, require an increasing counter, as they have a single version deployed at the same time. In this case, the most important use of the version is internal usage and won't require the maintenance that strict semantic versioning requires.</p>&#13;&#13;
    <h1 id="_idParaDest-45" class="title">Frontend and backend</h1>&#13;&#13;
    <p class="normal">The usual way of dividing different services is by talking about the "frontend" and the "backend." They describe <a id="_idIndexMarker113"/>the layers of software, where the layer closer to the end <a id="_idIndexMarker114"/>user is the frontend, and the one behind is the backend. </p>&#13;&#13;
    <p class="normal">Traditionally, the frontend is the layer that takes care of the presentation layer, next to the user, and the backend is the data access layer, which serves the business logic. In a client-server architecture, the client is the frontend and the server is the backend:</p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_04.png" alt="Diagram&#13;&#10;&#13;&#10;Description automatically generated" width="826" height="208"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.4: Client-Server architecture</p>&#13;&#13;
    <p class="normal">As architectures grow more complex, these terms become somewhat polysemic, and they are usually understood depending on the context. While <em class="italic">frontend</em> is almost always understood as the user interface directly, <em class="italic">backend</em> can be applied to multiple layers, meaning the next layer that gives support to whatever system is being discussed. For example, in a cloud application, the web application may use a database such as MySQL as the storage backend, or in-memory storage such as Redis as the cache backend.</p>&#13;&#13;
    <p class="normal">The general approach for the frontend and backend is quite different. </p>&#13;&#13;
    <p class="normal">The frontend focuses on the user experience, so the most important elements are usability, pleasing design, responsiveness, and so on. A lot of that requires an eye for the "final look" and how to make things easy to use. Frontend code is executed in the final user, so compatibility between different types of hardware can be important. At the same time, it distributes the load, so performance is most important from the point of view of the user interface.</p>&#13;&#13;
    <p class="normal">The backend focuses more on stability. Here, the hardware is under strict control, but the load is not distributed, making performance important in terms of controlling the total resources used. Modifying the backend is also easier, as changing it once changes it for all the <a id="_idIndexMarker115"/>users at the same time. But it's riskier, as a problem here may affect <a id="_idIndexMarker116"/>every single user. This environment primes more to focus on solid engineering practices and replicability.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">The term full stack engineer is commonly used to describe someone who is comfortable <a id="_idIndexMarker117"/>doing both kinds of work. While this can work in certain aspects, it's actually quite difficult to find someone who is equally comfortable or who is inclined to work on both elements in the longer term. </p>&#13;&#13;
      <p class="Tip--PACKT-">Most engineers will naturally tend toward one of the sides, and most companies will have different teams working on both aspects. In a certain way, the personality traits for each work are different, with frontend work requiring more of an eye for design, and backend users being comfortable with stability and reliability practices.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">In general, some <a id="_idIndexMarker118"/>common technologies used for the frontend are as follows:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">HTML and associated technologies such as CSS </li>&#13;&#13;
      <li class="bullet">JavaScript and libraries or frameworks to add interactivity, such as jQuery or React</li>&#13;&#13;
      <li class="bullet">Design tools</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">Backend technologies, as they are under more direct control, can be more varied, for example:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">Multiple programming languages, either scripting languages such as Python, PHP, Ruby, or even JavaScript using Node.js, or compiled languages such as Java or C#. They can even be mixed, making different elements in different languages.</li>&#13;&#13;
      <li class="bullet">Databases, either relational databases such as MySQL or PostgreSQL, or non-relational ones such as MongoDB, Riak, or Cassandra.</li>&#13;&#13;
      <li class="bullet">Web servers, such as Nginx or Apache.</li>&#13;&#13;
      <li class="bullet">Scalability and high-availability tools, such as load balancers.</li>&#13;&#13;
      <li class="bullet">Infrastructure and cloud technologies, such as AWS services.</li>&#13;&#13;
      <li class="bullet">Container-related <a id="_idIndexMarker119"/>tech, like Docker or Kubernetes.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">The frontend will make use of interfaces defined by the backend to present the actions in a user-friendly way. There can be several frontends for the same backend, a typical example being multiple smartphone interfaces for different platforms, but that use the same API to communicate with the backend.</p>&#13;&#13;
    <p class="normal">Keep in mind that <a id="_idIndexMarker120"/>frontend and backend are conceptual divisions, but they don't necessarily need to be divided into different processes or repositories. A common case <a id="_idIndexMarker121"/>where the frontend and backend live together are web frameworks such as Ruby on Rails or Django, where you can define the frontend HTML interface at the same time as the backend controllers that handle the data access and business logic. In this case, the HTML code is served directly from the same process that performs access to the data. This process separates the concerns using the Model View Controller structure.</p>&#13;&#13;
    <h2 id="_idParaDest-46" class="title">Model View Controller structure</h2>&#13;&#13;
    <p class="normal">The Model <a id="_idIndexMarker122"/>View Controller, or MVC, is a design that separates the logic of a program into three distinct components.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">The Model View Controller pattern started very early in the design of graphic user interfaces and has been used in that area since the first full graphic interactive interfaces in the 80s. In the 90s, it started being introduced as a way of handling web applications.</p>&#13;&#13;
    </div>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">This structure is really successful as it creates a clear separation of concepts:</li>&#13;&#13;
      <li class="bullet">The Model manages the data</li>&#13;&#13;
      <li class="bullet">The Controller accepts input from the user and transforms it into the manipulation of the model</li>&#13;&#13;
      <li class="bullet">The View represents the information for the user to understand</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">In essence, the Model is the core of the system, as it deals with the manipulation of the data. The Controller represents the input, and the View represents the output of the operations.</p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_05.png" alt="Shape&#13;&#10;&#13;&#10;Description automatically generated" width="829" height="246"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.5: The Model View Controller pattern</p>&#13;&#13;
    <p class="normal">The MVC structure can be considered at different levels, and it can be regarded as fractal. If several elements interact, they can have their own MVC structure, and the model part of a system can talk to a backend that provides information.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">The MVC pattern can be implemented in different ways. For example, Django claims it is a Model View <em class="italic">Template</em>, as the controller is more the framework itself. However, these are minor details that don't contradict the general design.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">The Model is <a id="_idIndexMarker123"/>arguably the most important element of the three as it's the core part of it. It contains the data access, but also the business logic. A rich Model component works as a way of abstracting the logic of the application from the input and output.</p>&#13;&#13;
    <p class="normal">Commonly, some of the barriers between controllers get a bit blurry. Different inputs may be dealt with in the Controller, producing different calls to the Model. At the same time, the output can be tweaked in the Controller before being passed to the view. While it's always difficult to enforce clear, strict boundaries, it's good to keep inÂ mind what the main objective of each component is so as to provide clarity.</p>&#13;&#13;
    <h1 id="_idParaDest-47" class="title">HTML interfaces</h1>&#13;&#13;
    <p class="normal">While the <a id="_idIndexMarker124"/>strict definition of APIs works for interfaces that are designed to be accessed by other programs, it's good to spend a bit of time talking about the basics of how to create a successful human interface. For this purpose, we will talk mainly about HTML interfaces, aimed at being used by the end user in a browser.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">Most of the concepts that we will deal with apply to other kinds of human interfaces, such as GUIs or mobile applications.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">HTML technologies <a id="_idIndexMarker125"/>are highly related to RESTful ones because they were developed in parallel during the early days of the internet. Typically, they are presented intertwined in modern web applications.</p>&#13;&#13;
    <h2 id="_idParaDest-48" class="title">Traditional HTML interfaces</h2>&#13;&#13;
    <p class="normal">The way <a id="_idIndexMarker126"/>traditional web interfaces work is through HTTP requests, only using the <code class="Code-In-Text--PACKT-">GET</code> and <code class="Code-In-Text--PACKT-">POST</code> methods. <code class="Code-In-Text--PACKT-">GET</code> retrieves a page from the server, while <code class="Code-In-Text--PACKT-">POST</code> is paired withÂ some form that submits data to the server.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">This was a prerequisite, as browsers only implemented these methods. While, nowadays, most modern browsers can use all HTTP methods in requests, it's still a common requirement to allow compatibility with older browsers.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">While this is certainly more restrictive than all the available options, it can work well for simple website interfaces.</p>&#13;&#13;
    <p class="normal">For example, a blog is read way more often than is written, so readers make use of a lot of <code class="Code-In-Text--PACKT-">GET</code> requests to get the information, and perhaps some <code class="Code-In-Text--PACKT-">POST</code> requests to send back some comments. The need to remove or change a comment was traditionally small, although it can be allocated with other URLs where <code class="Code-In-Text--PACKT-">POST</code> is used.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Note that browsers will ask you before retrying a <code class="Code-In-Text--PACKT-">POST</code> request as they are not idempotent.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">An HTML interface doesn't work in the same way as a RESTful interface because of these limitations, but it can also improve with a design that takes the abstractions and resources approach in mind.</p>&#13;&#13;
    <p class="normal">For example, some common abstractions for a blog are as follows:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">Each post, with associated comments</li>&#13;&#13;
      <li class="bullet">A main page with the latest posts</li>&#13;&#13;
      <li class="bullet">A search page that can return posts that contain a certain word or tag</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">This is very similar to the interface in resources, where only the two resources of "comment" and "post,", which will be separated in a RESTful way, will be joined in the same concept.</p>&#13;&#13;
    <p class="normal">The main limitation of <a id="_idIndexMarker127"/>traditional HTML interfaces is that every change needs to refresh the whole page. For simple applications like a blog, this can work quite well, but more complex applications may require a more dynamic approach.</p>&#13;&#13;
    <h2 id="_idParaDest-49" class="title">Dynamic pages</h2>&#13;&#13;
    <p class="normal">To add interactivity to the browser, we can add some JavaScript code that will perform actions to <a id="_idIndexMarker128"/>change the page directly on the browser representation; for example, selecting the color of the interface from a drop-down selector.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This is <a id="_idIndexMarker129"/>called manipulating the <strong class="keyword">Document Object Model </strong>(<strong class="keyword">DOM</strong>), which contains the representation of the document as defined by the HTML and possibly the CSS. JavaScript can access this representation and change it by editing any parameters or even adding or removing elements.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">From JavaScript, independent HTTP requests can also be done, so we can use that to make specific calls to retrieve details that can be added to improve the experience of the user.</p>&#13;&#13;
    <p class="normal">For example, for a form to input an address, a dropdown may select the country. Once selected, a call to the server will retrieve the proper regions to incorporate the input. If the user selects <strong class="keyword">United States</strong>, the list of all states will be retrieved and be available in the next dropdown. If the user selects <strong class="keyword">Canada</strong>, the list of territories and provinces will be used instead:</p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_06.png" alt="Graphical user interface&#13;&#10;&#13;&#10;Description automatically generated" width="826" height="364"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.5: Improving user experience with appropriate dropdowns</p>&#13;&#13;
    <p class="normal">Another <a id="_idIndexMarker130"/>example, that reverses the interface somewhat, could be to use the ZIP code to determine the state automatically.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">There is actually a service to retrieve this information called <a href="https://zippopotam.us/"><span class="url">https://zippopotam.us/</span></a>. It can be called and returns not only the state but further information, in JSON format.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">These <a id="_idIndexMarker131"/>kinds of calls are called <strong class="keyword">Asynchronous JavaScript And XML </strong>(<strong class="keyword">AJAX</strong>). Although the name mentions XML, it's not required, and any format can be retrieved. At the moment, it is very common to use JSON or even plain text. One possibility is to use HTML, so an area of the page can be replaced with snippets that come from the server: </p>&#13;&#13;
    <figure class="mediaobject"><img src="Images/B17580_02_07.png" alt="Shape, rectangle&#13;&#10;&#13;&#10;Description automatically generated" width="826" height="269"/></figure>&#13;&#13;
    <p class="packt_figref">Figure 2.6: Using HTML to replace areas of the page</p>&#13;&#13;
    <p class="normal">Raw HTML, although somewhat inelegant, can be effective, so it's very common to use a RESTful API returning JSON to retrieve the expected data for these small elements and then modify the DOM with it through JavaScript code. Given that the objective of this API is not to <a id="_idIndexMarker132"/>replace the HTML interface in its entirety, but complement it, this RESTful API will likely be incomplete. It won't be possible to create a full experience using only these RESTful calls.</p>&#13;&#13;
    <p class="normal">Other applications go directly to the point of creating an API-first approach and create the browser experience from there.</p>&#13;&#13;
    <h2 id="_idParaDest-50" class="title">Single-page apps</h2>&#13;&#13;
    <p class="normal">The idea behind a single-page app is easy. Let's open a single HTML page and change its content <a id="_idIndexMarker133"/>dynamically. If there's any new data to be required, it will be accessed through a specific (typically RESTful) API.</p>&#13;&#13;
    <p class="normal">This completely detaches the human interface, understood as the elements that have the responsibility of displaying the information to a human, from the service. The service serves a RESTful API exclusively, without worrying about the representation of the data.</p>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">This kind of <a id="_idIndexMarker134"/>approach is sometimes called API-first as it designs a system from the API to the representation, instead of creating it the other way around, which is the natural way in which it is created in an organic service.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Although there are specific frameworks and tools designed with this objective in mind, such as React or AngularJS, there are two main challenges with this kind of approach:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">The technical skill required to create a successful human interface on a single page is quite high, even with the help of tools. Any non-trivial representation of a valid interface will require keeping a lot of state and dealing with multiple calls. This is prone to have errors that compromise the stability of the page. The traditional approach for browser pages works with independent pages that limit the scope of each step, which is easier to handle.</li>&#13;&#13;
    </ul>&#13;&#13;
    <div class="packt_tip">&#13;&#13;
      <p class="Tip--PACKT-">Keep in mind that there are interface expectations carried by the browser that can be difficult to avoid or replace, for example, hitting the back button.</p>&#13;&#13;
    </div>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">The need to design and prepare the API beforehand can result in a slow startÂ for the project. It requires more planification and upfront commitment, even if both sides are developed in parallel, which also has its challenges.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">These issues ensure that this approach is not usually done for new applications starting from scratch. However, if the application started with another kind of user interface, like a smartphone <a id="_idIndexMarker135"/>application, it could leverage the already existing REST API to generate an HTML interface that replicates the functionality.</p>&#13;&#13;
    <p class="normal">The main advantage of this approach is detaching the application from the user interface. Where an application starts its development as a small project with a regular HTML interface, the risk is that any other user interface will tend to conform to the HTML interface. This can quickly add up to a lot of technical debt and compromise the design of the API, as the abstractions that are used will likely be derived from the existing interface, instead of the most adequate ones.</p>&#13;&#13;
    <p class="normal">A whole API-first approach greatly separates the interface, so creating a new interface is as easy to use as the already existing API. For applications that require multiple interfaces, such as an HTML interface, but also different smartphones applications for iOS and Android, that could be a good solution.</p>&#13;&#13;
    <p class="normal">A single-page application can also be quite innovative in terms of presenting a full interface. This can create rich and complex interfaces that deviate from what could be understood as a "web page," as in the case of a game or an interactive application. </p>&#13;&#13;
    <h2 id="_idParaDest-51" class="title">Hybrid approach</h2>&#13;&#13;
    <p class="normal">Going all-in with <a id="_idIndexMarker136"/>a single-page application, as we've seen, can be quite challenging. To a certain degree, it is using a browser to overwrite its usage. </p>&#13;&#13;
    <p class="normal">That's why normally the design doesn't go that far and creates a more traditional web interface. This interface is still recognizable as a web application but relies heavily on JavaScript to obtain information using a RESTful interface. This can happen as a natural step to migrating from a traditional HTML interface to a single-page app, but it may also be a conscious decision.</p>&#13;&#13;
    <p class="normal">This approach combines the previous two. On the one hand, it still requires an HTML interface for the general approach of the interface, with clear pages to navigate. On the other, it creates <a id="_idIndexMarker137"/>a RESTful API that fills most of the information and uses JavaScript to make use of this API.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">This approach is similar to the dynamic page one, but there is an important difference, which is the intention to create a coherent API that can be used without being totally tailored to the HTML interface. That changes the approach significantly.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">In practice, this tends to create a less complete RESTful API, as some of the elements may be added directly to the HTML part of it. But, at the same time, it allows the iterative migration of elements into the API, starting with certain elements, but adding more as time goes by. This stage is very flexible.</p>&#13;&#13;
    <h1 id="_idParaDest-52" class="title">Designing the API for the example</h1>&#13;&#13;
    <p class="normal">As we described in the first chapter, <em class="italic">General Overview of the Example</em>, we need to set the definition for the different interfaces that we will be working on in the example. Remember <a id="_idIndexMarker138"/>that the example is a microblogging application that will allow users to write their own text microposts so that they are available for others to read.</p>&#13;&#13;
    <p class="normal">There are two main interfaces in the example:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet">An HTML interface for allowing users to interact with the service using a browser</li>&#13;&#13;
      <li class="bullet">A RESTful interface for allowing the creation of other clients like a smartphone app</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">In this chapter, we will describe the design of the second interface. We will start with a description of the different basic definitions and resources that we will use:</p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><strong class="keyword">User</strong>: A representation of the user of the application. It will be defined by a username and a password to be able to login. </li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Micropost</strong>: A small text of up to 255 characters posted by a <em class="italic">User</em>. A <em class="italic">Micropost</em> can be optionally addressed to a <em class="italic">User</em>. It has also the time it was created.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Collection</strong>: The display of <em class="italic">Microposts</em> from a <em class="italic">User</em>.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Follower</strong>: A <em class="italic">User</em> can follow another <em class="italic">User</em>.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Timeline</strong>: An ordered list of the <em class="italic">Microposts</em> by the followed <em class="italic">Users</em>.</li>&#13;&#13;
      <li class="bullet"><strong class="keyword">Search</strong>: Allow a search by <em class="italic">User</em> or by text contained in <em class="italic">Microposts</em>.</li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal">We can <a id="_idIndexMarker139"/>define these elements as resources in a RESTful way, in the way introduced earlier in the chapter, first as a quick description of the URIs:</p>&#13;&#13;
    <pre class="programlisting con"><code class="hljs-con">POST   /api/token&#13;&#13;
DELETE /api/token&#13;&#13;
GET    /api/user/&lt;username&gt;&#13;&#13;
GET    /api/user/&lt;username&gt;/collection&#13;&#13;
POST   /api/user/&lt;username&gt;/collection&#13;&#13;
GET    /api/user/&lt;username&gt;/collection/&lt;micropost_id&gt;&#13;&#13;
PUT    /api/user/&lt;username&gt;/collection/&lt;micropost_id&gt;&#13;&#13;
PATCH  /api/user/&lt;username&gt;/collection/&lt;micropost_id&gt;&#13;&#13;
DELETE /api/user/&lt;username&gt;/collection/&lt;micropost_id&gt;&#13;&#13;
GET    /api/user/&lt;username&gt;/timeline&#13;&#13;
GET    /api/user/&lt;username&gt;/following&#13;&#13;
POST   /api/user/&lt;username&gt;/following&#13;&#13;
DELETE /api/user/&lt;username&gt;/following/&lt;username&gt;&#13;&#13;
GET    /api/user/&lt;username&gt;/followers&#13;&#13;
GET    /api/search&#13;&#13;
</code></pre>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Note that we added <code class="Code-In-Text--PACKT-">POST</code> and <code class="Code-In-Text--PACKT-">DELETE</code> resources for <code class="Code-In-Text--PACKT-">/token</code> to deal with login and logout.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">Once this brief design is complete, we can flesh out the definition of each endpoint.</p>&#13;&#13;
    <h2 id="_idParaDest-53" class="title">Endpoints</h2>&#13;&#13;
    <p class="normal">We will <a id="_idIndexMarker140"/>describe all the API endpoints in a bit more detail, following the template introduced previously in this chapter.</p>&#13;&#13;
    <p class="normal"><strong class="keyword">Login:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Using the proper authentication credentials, return a valid access token. The token needs to be included in the requests as the <code class="Code-In-Text--PACKT-">Authorization</code> header.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/token</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> POST</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Request body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{  &#13;&#13;
 <span class="hljs-attr">"grant_type"</span>: <span class="hljs-string">"authorization_code"</span>&#13;&#13;
    <span class="hljs-string">"client_id"</span>: &lt;client id&gt;,&#13;&#13;
    <span class="hljs-attr">"client_secret"</span>: &lt;client secret&gt;&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
  <span class="hljs-attr">"access_token"</span>: &lt;access token&gt;,&#13;&#13;
  <span class="hljs-attr">"token_type"</span>:<span class="hljs-string">"bearer"</span>,&#13;&#13;
  <span class="hljs-attr">"expires_in"</span>:<span class="hljs-number">86400</span>,&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">400 Bad Request Incorrect body.&#13;&#13;
400 Bad Request Bad credentials.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Logout:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Invalidate the <a id="_idIndexMarker141"/>bearer token. If successful, it will return a <code class="Code-In-Text--PACKT-">204 No Content</code> error.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/token</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> DELETE</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being properly authenticated.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieve user:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns the username resource.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Query Parameters</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">size Page size.&#13;&#13;
page Page number.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"username"</span>: &lt;username&gt;,&#13;&#13;
    <span class="hljs-attr">"collection"</span>: /users/&lt;username&gt;/collection,&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieve user's collection:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns the <a id="_idIndexMarker142"/>collection of all microposts from a user, in paginated form.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/collection</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"next"</span>: &lt;next page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"previous"</span>: &lt;previous page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"result"</span>: [&#13;&#13;
        {&#13;&#13;
            <span class="hljs-attr">"id"</span>: &lt;micropost id&gt;,&#13;&#13;
            <span class="hljs-attr">"href"</span>: &lt;micropost url&gt;,&#13;&#13;
            <span class="hljs-attr">"user"</span>: &lt;user url&gt;,&#13;&#13;
            <span class="hljs-attr">"text"</span>: &lt;Micropost text&gt;,&#13;&#13;
            <span class="hljs-attr">"timestamp"</span>: &lt;timestamp for micropost in ISO <span class="hljs-number">8601</span>&gt;&#13;&#13;
        },&#13;&#13;
        ...&#13;&#13;
    ]&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Create new micropost:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Create a <a id="_idIndexMarker143"/>new micropost. </li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource</em> <em class="italic">URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/collection</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> POST</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Request body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"text"</span>: &lt;Micropost text&gt;,&#13;&#13;
    <span class="hljs-attr">"referenced"</span>: &lt;optional username of referenced user&gt;&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">400 Bad Request Incorrect body.&#13;&#13;
400 Bad Request Invalid text (for example, more than 255 characters).&#13;&#13;
400 Bad Request Referenced user not found.&#13;&#13;
401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
403 Forbidden Trying to create a micropost of a different user to the one logged in.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieve micropost:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns a single micropost.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource</em> <em class="italic">URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/collection/&lt;micropost_id&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">        {&#13;&#13;
            <span class="hljs-attr">"id"</span>: &lt;micropost id&gt;,&#13;&#13;
            <span class="hljs-attr">"href"</span>: &lt;micropost url&gt;,&#13;&#13;
            <span class="hljs-attr">"user"</span>: &lt;user url&gt;,&#13;&#13;
            <span class="hljs-attr">"text"</span>: &lt;Micropost text&gt;,&#13;&#13;
            <span class="hljs-attr">"timestamp"</span>: &lt;timestamp for micropost in ISO <span class="hljs-number">8601</span>&gt;,&#13;&#13;
      <span class="hljs-attr">"referenced"</span>: &lt;optional username of referenced user&gt;&#13;&#13;
        }&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
404 Not Found Micropost ID does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Update micropost:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Update <a id="_idIndexMarker144"/>the text for a micropost.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource</em> <em class="italic">URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/collection/&lt;micropost_id&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> PUT, PATCH</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Request body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">        {&#13;&#13;
            <span class="hljs-attr">"text"</span>: &lt;Micropost text&gt;,&#13;&#13;
      <span class="hljs-attr">"referenced"</span>: &lt;optional username of referenced user&gt;&#13;&#13;
        }&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">400 Bad Request Incorrect body.&#13;&#13;
400 Bad Request Invalid text (for example, more than 255 characters).&#13;&#13;
400 Bad Request Referenced user not found.&#13;&#13;
401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
403 Forbidden Trying to update a micropost of a different user to the one logged in.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
404 Not Found Micropost ID does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Delete micropost:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Delete <a id="_idIndexMarker145"/>a micropost. If successful, it will return a <code class="Code-In-Text--PACKT-">204 No Content</code> error.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource</em> <em class="italic">URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/collection/&lt;micropost_id&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> DELETE</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
403 Forbidden Trying to delete a micropost of a different user to the one logged in.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
404 Not Found Micropost ID does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieve user's timeline:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns the collection of all microposts from the timeline of a user, in paginated form. The microposts will be returned by timestamp order, with the oldest being returned first.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource</em> <em class="italic">URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/timeline</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Return</em> <em class="italic">body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"next"</span>: &lt;next page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"previous"</span>: &lt;previous page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"result"</span>: [&#13;&#13;
        {&#13;&#13;
            <span class="hljs-attr">"id"</span>: &lt;micropost id&gt;,&#13;&#13;
            <span class="hljs-attr">"href"</span>: &lt;micropost url&gt;,&#13;&#13;
            <span class="hljs-attr">"user"</span>: &lt;user url&gt;,&#13;&#13;
            <span class="hljs-attr">"text"</span>: &lt;Micropost text&gt;,&#13;&#13;
            <span class="hljs-attr">"timestamp"</span>: &lt;timestamp for micropost in ISO <span class="hljs-number">8601</span>&gt;,&#13;&#13;
            <span class="hljs-attr">"referenced"</span>: &lt;optional username of referenced user&gt;&#13;&#13;
        },&#13;&#13;
        ...&#13;&#13;
    ]&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieve the users a user is following:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns <a id="_idIndexMarker146"/>a collection of all users that the selected user is following.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource</em> <em class="italic">URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/following</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Return</em> <em class="italic">body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"next"</span>: &lt;next page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"previous"</span>: &lt;previous page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"result"</span>: [&#13;&#13;
        {&#13;&#13;
            <span class="hljs-attr">"username"</span>: &lt;username&gt;,&#13;&#13;
            <span class="hljs-attr">"collection"</span>: /users/&lt;username&gt;/collection,&#13;&#13;
        },&#13;&#13;
        ...&#13;&#13;
    ]&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Follow a user:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Causes the selected user to follow a different user.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/following</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> POST</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Request body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{    &#13;&#13;
    <span class="hljs-attr">"username"</span>: &lt;username&gt;&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">400 Bad Request The username to follow is incorrect or does not exist.&#13;&#13;
400 Bad Request Bad body.&#13;&#13;
401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Stop following a user:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Stops <a id="_idIndexMarker147"/>following a user. If successful, it will return a <code class="Code-In-Text--PACKT-">204 No Content</code> error.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/following/&lt;username&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> DELETE</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
403 Forbidden Trying to stop following a user who is not the authenticated one.&#13;&#13;
404 Not Found Username to stop following does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Retrieve a user's followers:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns, in paginated form, all followers of this user.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/users/&lt;username&gt;/followers</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>:<code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"next"</span>: &lt;next page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"previous"</span>: &lt;previous page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"result"</span>: [&#13;&#13;
        {&#13;&#13;
            <span class="hljs-attr">"username"</span>: &lt;username&gt;,&#13;&#13;
            <span class="hljs-attr">"collection"</span>: /users/&lt;username&gt;/collection,&#13;&#13;
        },&#13;&#13;
        ...&#13;&#13;
    ]&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
404 Not Found Username does not exist.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <p class="normal"><strong class="keyword">Search microposts:</strong></p>&#13;&#13;
    <ul>&#13;&#13;
      <li class="bullet"><em class="italic">Description</em>: Returns, in <a id="_idIndexMarker148"/>paginated form, microposts that fulfill the search query.</li>&#13;&#13;
      <li class="bullet"><em class="italic">Resource URI</em>: <code class="Code-In-Text--PACKT-">/api/search</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Method</em>:<code class="Code-In-Text--PACKT-"> GET</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Headers</em>: <code class="Code-In-Text--PACKT-">Authentication: Bearer: &lt;token&gt;</code></li>&#13;&#13;
      <li class="bullet"><em class="italic">Query parameters</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">username: Optional username to search. Partial matches will be returned.&#13;&#13;
text: Mandatory text to search, with a minimum of three characters. Partial matches will be returned.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Return body</em>:&#13;&#13;
        <pre class="programlisting code"><code class="hljs-code">{&#13;&#13;
    <span class="hljs-attr">"next"</span>: &lt;next page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"previous"</span>: &lt;previous page or <span class="hljs-literal">null</span>&gt;,&#13;&#13;
    <span class="hljs-attr">"result"</span>: [&#13;&#13;
        {&#13;&#13;
            <span class="hljs-attr">"id"</span>: &lt;micropost id&gt;,&#13;&#13;
            <span class="hljs-attr">"href"</span>: &lt;micropost url&gt;,&#13;&#13;
            <span class="hljs-attr">"user"</span>: &lt;user url&gt;,&#13;&#13;
            <span class="hljs-attr">"text"</span>: &lt;Micropost text&gt;,&#13;&#13;
            <span class="hljs-attr">"timestamp"</span>: &lt;timestamp for micropost in ISO <span class="hljs-number">8601</span>&gt;,&#13;&#13;
            <span class="hljs-attr">"referenced"</span>: &lt;optional username of referenced user&gt;&#13;&#13;
        },&#13;&#13;
    ]&#13;&#13;
}&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
      <li class="bullet"><em class="italic">Errors</em>:&#13;&#13;
        <pre class="programlisting con"><code class="hljs-con">400 Bad Request No mandatory query parameters.&#13;&#13;
400 Bad Request Incorrect value in query parameters.&#13;&#13;
401 Unauthorized Trying to access this URI without being authenticated.&#13;&#13;
</code></pre>&#13;&#13;
      </li>&#13;&#13;
    </ul>&#13;&#13;
    <h2 id="_idParaDest-54" class="title">Review of the design and implementation</h2>&#13;&#13;
    <p class="normal">This two-step approach of presenting and designing a new API enables you to quickly see <a id="_idIndexMarker149"/>whether something <a id="_idIndexMarker150"/>is out of place as regards the design. Then, it can be iterated over until fixed. The next step is to start with the implementation, as we will see in forthcoming chapters.</p>&#13;&#13;
    <h1 id="_idParaDest-55" class="title">Summary</h1>&#13;&#13;
    <p class="normal">In this chapter, we described how the basics of API design are to create a set of useful abstractions that allow users to perform actions without having to care about the internal details. This led to describing how to define an API with resources and actions.</p>&#13;&#13;
    <p class="normal">This definition of an API has evolved to cover RESTful interfaces that follow certain properties that make them very interesting for web server design. We described a bunch of useful standards and techniques when designing RESTful interfaces to create consistent and complete interfaces, including the OpenAPI tools. We went through authentication details as it's a very important element for APIs.</p>&#13;&#13;
    <div class="note">&#13;&#13;
      <p class="Information-Box--PACKT-">Remember that extra care should be advised when securing APIs that have external usage. We went through some general ideas and common strategies, but note that this book does not focus on security. This is a critical aspect of the design of any API and should be done carefully.</p>&#13;&#13;
    </div>&#13;&#13;
    <p class="normal">We covered the ideas behind versioning and how to create a proper versioning schema that's tailored to the specific use case for the API. We also covered the differences between the frontend and the backend and how this can be generalized. We also covered the MVC pattern, which is a very common way to structure software.</p>&#13;&#13;
    <p class="normal">We described the different options for HTML interfaces to provide a complete overview of the different interfaces in web services. We covered different options in terms of how an HTML service can be constructed and interact with other APIs.</p>&#13;&#13;
    <p class="normal">Finally, we presented the design for the RESTful interface for the example, while reviewing the general design and endpoints. </p>&#13;&#13;
    <p class="normal">Another critical element of design is the data structure. We will cover this next.</p>&#13;&#13;
  </div>&#13;&#13;
</div></body></html>