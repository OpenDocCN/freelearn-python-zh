<html><head></head><body>
		<div><h1 id="_idParaDest-139" class="chapter-number"><a id="_idTextAnchor144"/>7</h1>
			<h1 id="_idParaDest-140"><a id="_idTextAnchor145"/>Building Login and Registration Forms</h1>
			<p>Registration and login are essential features of web applications that have users. Even if an authentication flow can be handled directly with simple requests, there is also a need to have logic working behind the UI to manage the authentication and session, especially if we are using a <strong class="bold">JSON web </strong><strong class="bold">token</strong> (<strong class="bold">JWT</strong>).</p>
			<p>In this chapter, we’ll create login and registration forms with React. There is a lot to do and learn here, but here’s what this chapter will cover:</p>
			<ul>
				<li>Configuration of a CSS framework in a React project</li>
				<li>Adding protected and public pages to an application</li>
				<li>Creating a page for registration</li>
				<li>Creating a page for login</li>
				<li>Creating a welcome page after the login or registration is successful</li>
			</ul>
			<p>By the end of the chapter, you will be able to build registration and login pages using React, and you will know how to manage JWT authentication from the frontend.</p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor146"/>Technical requirements</h1>
			<p>Make sure to have VS Code installed and configured on your machine.</p>
			<p>You can find the code for this chapter at <a href="https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap7">https://github.com/PacktPublishing/Full-stack-Django-and-React/tree/chap7</a>.</p>
			<h1 id="_idParaDest-142"><a id="_idTextAnchor147"/>Understanding the authentication flow</h1>
			<p>We’ve already explored <a id="_idIndexMarker429"/>authentication on a social media project from a backend perspective in <a href="B18221_02.xhtml#_idTextAnchor036"><em class="italic">Chapter 2</em></a>, <em class="italic">Authentication and Authorization Using JWTs</em>. But how does this manifest in the React application?</p>
			<p>Well, things will be a little bit different. To quickly recapitulate, we have a registration and a login endpoint. These endpoints return the user objects with two tokens:</p>
			<ul>
				<li><strong class="bold">An access token with a lifetime of 5 minutes</strong>: This token helps with authenticating on the<a id="_idIndexMarker430"/> server side when requesting without the need to log in again. Then, we can access resources and perform actions on these resources.</li>
				<li><strong class="bold">A refresh token</strong>: This token<a id="_idIndexMarker431"/> helps you to retrieve another access token if one has already expired.</li>
			</ul>
			<p>With this data coming from the server, we can manage authentication from the React application side like so. When a registration or a login is successful, we store the returned response in the client’s browser; we’ll use <code>localStorage</code> for this.</p>
			<p>The <code>localStorage</code> property helps us to work with the browser storage, enabling browsers to store key-value pairs in the browser. Two methods will be used with <code>localStorage</code>: <code>setItem()</code> to set a key-value pair and <code>getItem()</code> to access the values.</p>
			<p>Then, for each request sent to the server, we add the Authorization header to the request containing the access token retrieved from <code>localStorage</code>. If the request returns a <code>401</code> error, it means that the token has expired. If this happens, we send a request to the refresh endpoint to get a new access token, using the refresh token also retrieved from <code>localStorage</code>. And with this access token, we resend the failed request.</p>
			<p>If we receive a <code>401</code> error again, it means that the refresh token has expired. Then, the user will be sent to the login page to log in again, retrieve new tokens, and store them in <code>localStorage</code>.</p>
			<p>Now that we understand the authentication flow from the frontend side, let’s write the requests service we will use for data fetching and performing CRUD action<a id="_idTextAnchor148"/>s.</p>
			<h1 id="_idParaDest-143"><a id="_idTextAnchor149"/>Writing the requests service</h1>
			<p>Making <a id="_idIndexMarker432"/>requests in JavaScript is relatively easy. The node environment and the browser provide native packages such as <code>fetch</code> to allow you to request a server. However, this project will use the <code>axios</code> package for HTTP requests.</p>
			<p>Axios is a popular library mainly used to send asynchronous HTTP requests to REST endpoints. Axios is the perfect library for CRUD operations. However, we will also install <code>axios-auth-refresh</code>. This simple library assists with an automatic refresh of tokens via <code>axios</code> interceptors. To install the <code>axios</code> and <code>axios-auth-refresh</code> packages, follow these steps:</p>
			<ol>
				<li>In the <code>social-media-app</code> directory, add the <code>axios</code> and <code>axios-auth-refresh</code> packages by running the following command:<pre class="source-code">
<strong class="bold">yarn add axios axios-auth-refresh</strong></pre></li>
				<li>Once it’s installed, create a directory called <code>helpers</code> in the <code>src</code> folder of the React project, and once it’s done, add a file called <code>axios.js</code>:</li>
			</ol>
			<div><div><img src="img/Figure_7.01_B18221.jpg" alt="Figure 7.1 – The path of the helper.js file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – The path of the helper.js file</p>
			<p>Now, let’s make the import and write the basic configurations, such as the URL and some headers. Take a look at the following code block:</p>
			<pre class="source-code">
import axios from "axios";
import createAuthRefreshInterceptor from "axios-auth-refresh";
const axiosService = axios.create({
 baseURL: "http://localhost:8000",
 headers: {
   "Content-Type": "application/json",
 },
});</pre>
			<p>In the preceding code <a id="_idIndexMarker433"/>block, we have added the <code>Content-Type</code> header for the <code>POST</code> requests. The following figure shows the authentication flow we’ll follow in this book:</p>
			<div><div><img src="img/Figure_7.02_B18221.jpg" alt="Figure 7.2 – Authentication flow with access/refresh tokens"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Authentication flow with access/refresh tokens</p>
			<p>In the preceding figure, note the following points:</p>
			<ul>
				<li>Every time we are requesting with <code>axiosService</code>, we retrieve the access token from <code>localStorage</code> and create a new header authorization using the access token</li>
				<li>The access token will expire if the request is made and a <code>400</code> status code is returned</li>
				<li>We retrieve the refresh token from <code>localStorage</code> and make a request to retrieve a new access token</li>
				<li>Once done, we register the new access token in <code>localStorage</code> and restart the previously failed request</li>
				<li>Yet, if the refresh token request has failed too, we simply remove <code>auth</code> from <code>localStorage</code> and send the user to the login screen</li>
			</ul>
			<p>Let’s implement the<a id="_idIndexMarker434"/> previously described flow in the <code>axios.js</code> file by following these steps:</p>
			<ol>
				<li value="1">First we will write a request interceptor to add headers to the request:<pre class="source-code">
axiosService.interceptors.request.use(async (config) =&gt; {</pre><pre class="source-code">
 /**</pre><pre class="source-code">
  * Retrieving the access token from the localStorage</pre><pre class="source-code">
    and adding it to the headers of the request</pre><pre class="source-code">
  */</pre><pre class="source-code">
 const { access } =</pre><pre class="source-code">
   JSON.parse(localStorage.getItem("auth"));</pre><pre class="source-code">
 config.headers.Authorization = `Bearer ${access}`;</pre><pre class="source-code">
 return config;</pre><pre class="source-code">
});</pre></li>
			</ol>
			<p>Note that we can use the object-destructuring syntax to extract property values from an object in JavaScript. In pre-ES2015 code, it probably goes like this:</p>
			<pre class="source-code">
var fruit = {
 name: 'Banana',
 scientificName: 'Musa'
};
var name     = fruit.name;
var scientificName = fruit.scientificName;</pre>
			<p>If you have a lot of properties to extract from an object, it can quickly become long. That’s where <a id="_idIndexMarker435"/>object destructuring comes in handy:</p>
			<pre class="source-code">
var fruit = {
 name: 'Banana',
 scientificName: 'Musa'
};
var  { name, scientificName } = fruit;</pre>
			<p>You can learn more about the syntax at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment</a>.</p>
			<ol>
				<li value="2">After that, we will resolve the requests and return a resolved or rejected promise:<pre class="source-code">
axiosService.interceptors.response.use(</pre><pre class="source-code">
 (res) =&gt; Promise.resolve(res),</pre><pre class="source-code">
 (err) =&gt; Promise.reject(err),</pre><pre class="source-code">
);</pre></li>
				<li>This last step is the icing on the cake. Create a function that contains the refresh <code>auth</code> logic. This function will be called whenever the failed request returns a <code>401</code> error:<pre class="source-code">
const refreshAuthLogic = async (failedRequest) =&gt; {</pre><pre class="source-code">
 const { refresh } =</pre><pre class="source-code">
   JSON.parse(localStorage.getItem("auth"));</pre><pre class="source-code">
 return axios</pre><pre class="source-code">
   .post("/refresh/token/", null, {</pre><pre class="source-code">
     baseURL: "http://localhost:8000",</pre><pre class="source-code">
     headers: {</pre><pre class="source-code">
       Authorization: `Bearer ${refresh}`,</pre><pre class="source-code">
     },</pre><pre class="source-code">
   })</pre><pre class="source-code">
   .then((resp) =&gt; {</pre><pre class="source-code">
     const { access, refresh } = resp.data;</pre><pre class="source-code">
     failedRequest.response.config.headers[</pre><pre class="source-code">
       "Authorization"] = "Bearer " + access;</pre><pre class="source-code">
     localStorage.setItem("auth", JSON.stringify({</pre><pre class="source-code">
                           access, refresh }));</pre><pre class="source-code">
   })</pre><pre class="source-code">
   .catch(() =&gt; {</pre><pre class="source-code">
     localStorage.removeItem("auth");</pre><pre class="source-code">
   });</pre><pre class="source-code">
};</pre></li>
				<li>And finally, initialize the<a id="_idIndexMarker436"/> authentication interceptor and create a custom fetcher too:<pre class="source-code">
createAuthRefreshInterceptor(axiosService, refreshAuthLogic);</pre><pre class="source-code">
export function fetcher(url) {</pre><pre class="source-code">
 return axiosService.get(url).then((res) =&gt; res.data);</pre><pre class="source-code">
}</pre><pre class="source-code">
export default axiosService;</pre></li>
			</ol>
			<p>The fetcher will be used to make <code>GET</code> requests on the API resources. Great! The fetching logic is implemented, and we can move on to registering a user. But before that, we need to<a id="_idIndexMarker437"/> define protected routes in the project.</p>
			<h1 id="_idParaDest-144"><a id="_idTextAnchor150"/>Protected routes</h1>
			<p>Routing with the <a id="_idIndexMarker438"/>condition on a frontend application is a big plus, as it helps with a better user experience. For example, if you are not logged in to Twitter and want to check a profile or comment, you will be redirected to the login page. These are protected pages or actions, so you must log in before accessing these resources. In this section, we’ll write a <code>ProtectedRoute</code> component using <code>React-Router</code> components.</p>
			<h2 id="_idParaDest-145"><a id="_idTextAnchor151"/>Creating a protected route wrapper</h2>
			<p>To create a <a id="_idIndexMarker439"/>protected route wrapper, follow these steps:</p>
			<ol>
				<li value="1">Create a new directory in the <code>src</code> directory called <code>routes</code>.</li>
				<li>Inside the newly created directory, create a file called <code>ProtectedRoute.jsx</code>.</li>
				<li>Once the file is created, import the needed libraries:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/routes/ProtectedRoute.jsx</p>
			<pre class="source-code">
import React from "react";
import { Navigate } from "react-router-dom";
...</pre>
			<ol>
				<li value="4">Write the following logic for the protected routes:<pre class="source-code">
...</pre><pre class="source-code">
function ProtectedRoute({ children }) {</pre><pre class="source-code">
 const { user } =</pre><pre class="source-code">
   JSON.parse(localStorage.getItem("auth"));</pre><pre class="source-code">
 return auth.account ? &lt;&gt;{children}&lt;/&gt; : &lt;Navigate</pre><pre class="source-code">
   to="/login/" /&gt;;</pre><pre class="source-code">
}</pre><pre class="source-code">
export default ProtectedRoute;</pre><pre class="source-code">
...</pre></li>
			</ol>
			<p>In the preceding<a id="_idIndexMarker440"/> code snippet, we are retrieving the user property from <code>localStorage</code>.</p>
			<p>We then use this property to check whether we should redirect the user to the login page or render the page (<code>children</code>). If <strong class="bold">user</strong> is null or undefined, it means that the user has not logged in, so we redirect the user to the login page, otherwise, we give access to the asked page.</p>
			<ol>
				<li value="5">Then, inside the <code>App.js</code> file, let’s rewrite the content:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.js</p>
			<pre class="source-code">
import React from "react";
import {
 Route,
 Routes
} from "react-router-dom";
import ProtectedRoute from "./routes/ProtectedRoute";
import Home from "./pages/Home";
function App() {
 return (
   &lt;Routes&gt;
     &lt;Route path="/" element={
       &lt;ProtectedRoute&gt;
         &lt;Home /&gt;
       &lt;/ProtectedRoute&gt;
     } /&gt;
     &lt;Route path="/login/" element={&lt;div&gt;Login&lt;/div&gt;} /&gt;
   &lt;/Routes&gt;
 );
}
export default App;</pre>
			<p>Now, the default location will be the profile page. However, with no credentials in the store, the user will be redirected to the login page.</p>
			<p>Great! We’ve now<a id="_idIndexMarker441"/> implemented the first step of the authentication flow. In the next section, we will write a page for registration before writing the page for login.</p>
			<h1 id="_idParaDest-146"><a id="_idTextAnchor152"/>Creating the registration page</h1>
			<p>If a user needs login<a id="_idIndexMarker442"/> credentials, they will need to register first. In this section, we will create a registration form while also handling the necessary requests.</p>
			<h2 id="_idParaDest-147">Adding a regist<a id="_idTextAnchor153"/>ration page</h2>
			<p>Let’s start by <a id="_idIndexMarker443"/>writing code for the form page. We’ll start by writing the registration <code>form</code> component:</p>
			<ol>
				<li value="1">Inside the <code>src</code> directory, create a new directory called <code>components</code> and then create a new directory called <code>authentication</code> inside the newly created directory.</li>
			</ol>
			<p>This directory will contain the registration and login forms.</p>
			<ol>
				<li value="2">Once that’s done, create a file called <code>RegistrationForm.jsx</code> inside the <code>authentication</code> directory:</li>
			</ol>
			<div><div><img src="img/Figure_7.03_B18221.jpg" alt="Figure 7.3 – The registration file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – The registration file</p>
			<p>React Bootstrap provides <code>form</code> components that we can use quickly to create a form and make basic validation. In this component, we’ll also have to make a request to the API, register the user details and tokens in the store, and redirect the user to the home page if the request is successful.</p>
			<ol>
				<li value="3">Next, we will add the needed imports:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
import React, { useState } from "react";
import { Form, Button } from "react-bootstrap";
import axios from "axios";
import { useNavigate } from "react-router-dom";
...</pre>
			<ol>
				<li value="4">Now, declare the states and functions we’ll use in the component:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
function RegistrationForm() {
 const navigate = useNavigate();
 const [validated, setValidated] = useState(false);
 const [form, setForm] = useState({});
 const [error, setError] = useState(null);
...</pre>
			<p>Let’s quickly explain what we are doing in the preceding code snippet.</p>
			<p>The <code>navigate</code> Hook will help us navigate to the home page if the request is successful.</p>
			<p>The <code>validated</code>, <code>form</code>, and <code>error</code> states are respectively used to check whether the<a id="_idIndexMarker444"/> form is valid or not, the values of each field in the form, and the error message to display if the request doesn’t pass.</p>
			<ol>
				<li value="5">Great! Let’s write the function that will handle the form submission:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
const handleSubmit = (event) =&gt; {
   event.preventDefault();
   const registrationForm = event.currentTarget;
   if (registrationForm.checkValidity() === false) {
     event.stopPropagation();
   }
   setValidated(true);
   const data = {
     username: form.username,
     password: form.password,
     email: form.email,
     first_name: form.first_name,
     last_name: form.last_name,
     bio: form.bio,
   };
 ...</pre>
			<ol>
				<li value="6">The next step is<a id="_idIndexMarker445"/> to use <code>axios</code> to make a <code>POST</code> request to the API:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
   axios
     .post("http://localhost:8000/api/auth/register/",
            data)
     .then((res) =&gt; {
       // Registering the account and tokens in the
       // store
       localStorage.setItem("auth", JSON.stringify({
         access: res.data.access,
         refresh: res.data.refresh,
         user: res.data.user,
       }));
       navigate("/");
     })
     .catch((err) =&gt; {
       if (err.message) {
         setError(err.request.response);
       }
     });
 };</pre>
			<p>In the preceding code block, we are first blocking the default form submission behavior with <code>event.preventDefault()</code> – that is, reloading the page. Next, we are <a id="_idIndexMarker446"/>checking whether the basic validations for the fields are done. With the validation successfully done, we can easily make a request with <code>axios</code> and store tokens and user details in <code>localStorage</code>.</p>
			<p>This way, the user is navigated to the home page.</p>
			<ol>
				<li value="7">Now, let’s add the basic UI components:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
return (
   &lt;Form
     id="registration-form"
     className="border p-4 rounded"
     noValidate
     validated={validated}
     onSubmit={handleSubmit}
   &gt;
     &lt;Form.Group className="mb-3"&gt;
       &lt;Form.Label&gt;First Name&lt;/Form.Label&gt;
       &lt;Form.Control
         value={form.first_name}
         onChange={(e) =&gt; setForm({ ...form,
           first_name: e.target.value })}
         required
         type="text"
         placeholder="Enter first name"
       /&gt;
       &lt;Form.Control.Feedback type="invalid"&gt;
         This file is required.
       &lt;/Form.Control.Feedback&gt;
     &lt;/Form.Group&gt;
...</pre>
			<p>There is more<a id="_idIndexMarker447"/> code after this, but let’s grasp the logic here first; the other will be significantly easier.</p>
			<p>React Bootstrap provides a <code>Form</code> component that we can use to create fields.</p>
			<p><code>Form.Control</code> is a component input and it takes as props (<code>name</code>, <code>type</code>, etc.) attributes any input can take. <code>Form.Control.Feedback</code> will show errors when the fields are not valid.</p>
			<ol>
				<li value="8">Let’s do the<a id="_idIndexMarker448"/> same for the <code>last_name</code> and the <code>username</code> fields:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
     &lt;Form.Group className="mb-3"&gt;
       &lt;Form.Label&gt;Last name&lt;/Form.Label&gt;
       &lt;Form.Control
         value={form.last_name}
         onChange={(e) =&gt; setForm({ ...form,
           last_name: e.target.value })}
         required
         type="text"
         placeholder="Enter last name"
       /&gt;
       &lt;Form.Control.Feedback type="invalid"&gt;
         This file is required.
       &lt;/Form.Control.Feedback&gt;
     &lt;/Form.Group&gt;
     &lt;Form.Group className="mb-3"&gt;
       &lt;Form.Label&gt;Username&lt;/Form.Label&gt;
       &lt;Form.Control
         value={form.username}
         onChange={(e) =&gt; setForm({ ...form, username:
           e.target.value })}
         required
         type="text"
         placeholder="Enter username"
       /&gt;
       &lt;Form.Control.Feedback type="invalid"&gt;
         This file is required.
       &lt;/Form.Control.Feedback&gt;
     &lt;/Form.Group&gt;
...</pre>
			<ol>
				<li value="9">Let’s also add <a id="_idIndexMarker449"/>a field for email:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
     &lt;Form.Group className="mb-3"&gt;
       &lt;Form.Label&gt;Email address&lt;/Form.Label&gt;
       &lt;Form.Control
         value={form.email}
         onChange={(e) =&gt; setForm({ ...form, email:
           e.target.value })}
         required
         type="email"
         placeholder="Enter email"
       /&gt;
       &lt;Form.Control.Feedback type="invalid"&gt;
         Please provide a valid email.
       &lt;/Form.Control.Feedback&gt;
     &lt;/Form.Group&gt;
...</pre>
			<ol>
				<li value="10">Let’s also add a <a id="_idIndexMarker450"/>field for the password:<pre class="source-code">
...</pre><pre class="source-code">
     &lt;Form.Group className="mb-3"&gt;</pre><pre class="source-code">
       &lt;Form.Label&gt;Password&lt;/Form.Label&gt;</pre><pre class="source-code">
       &lt;Form.Control</pre><pre class="source-code">
         value={form.password}</pre><pre class="source-code">
         minLength="8"</pre><pre class="source-code">
         onChange={(e) =&gt; setForm({ ...form, password:</pre><pre class="source-code">
           e.target.value })}</pre><pre class="source-code">
         required</pre><pre class="source-code">
         type="password"</pre><pre class="source-code">
         placeholder="Password"</pre><pre class="source-code">
       /&gt;</pre><pre class="source-code">
       &lt;Form.Control.Feedback type="invalid"&gt;</pre><pre class="source-code">
         Please provide a valid password.</pre><pre class="source-code">
       &lt;/Form.Control.Feedback&gt;</pre><pre class="source-code">
     &lt;/Form.Group&gt;</pre><pre class="source-code">
...</pre></li>
				<li>Let’s add the bio field too. We’ll use the <code>Textarea</code> field type here:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
     &lt;Form.Group className="mb-3"&gt;
       &lt;Form.Label&gt;Bio&lt;/Form.Label&gt;
       &lt;Form.Control
         value={form.bio}
         onChange={(e) =&gt; setForm({ ...form, bio:
           e.target.value })}
         as="textarea"
         rows={3}
         placeholder="A simple bio ... (Optional)"
       /&gt;
     &lt;/Form.Group&gt;
...</pre>
			<ol>
				<li value="12">Finally, add the<a id="_idIndexMarker451"/> submit button and export the component:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/forms/RegistrationForm.js</p>
			<pre class="source-code">
...
     &lt;div className="text-content text-danger"&gt;
         {error &amp;&amp; &lt;p&gt;{error}&lt;/p&gt;}
     &lt;/div&gt;
     &lt;Button variant="primary" type="submit"&gt;
       Submit
     &lt;/Button&gt;
   &lt;/Form&gt;
 );
}
export default RegistrationForm;</pre>
			<p><code>RegistrationForm</code> is now created with the required fields and the logic to handle the form submission.</p>
			<p>In the next section, we<a id="_idIndexMarker452"/> will add this registration form component to a page and register this page in our application route.</p>
			<h2 id="_idParaDest-148"><a id="_idTextAnchor154"/>Registering the registration page route</h2>
			<p>Follow these<a id="_idIndexMarker453"/> steps to register the registration page route:</p>
			<ol>
				<li value="1">Inside the <code>src/pages</code> directory, create a file called <code>Registration.jsx</code>:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Registration.js</p>
			<pre class="source-code">
import React from "react";
import { Link } from "react-router-dom";
import RegistrationForm from "../components/forms/RegistrationForm";
function Registration() {
 return (
   &lt;div className="container"&gt;
     &lt;div className="row"&gt;
       &lt;div className="col-md-6 d-flex align-items-center"&gt;
         &lt;div className="content text-center px-4"&gt;
           &lt;h1 className="text-primary"&gt;
             Welcome to Postman!
           &lt;/h1&gt;
           &lt;p className="content"&gt;
             This is a new social media site that will
             allow you to share your thoughts and
             experiences with your friends. Register now
             and start enjoying! &lt;br /&gt;
             Or if you already have an account, please{" "}
             &lt;Link to="/login/"&gt;login&lt;/Link&gt;.
           &lt;/p&gt;
         &lt;/div&gt;
       &lt;/div&gt;
       &lt;div className="col-md-6 p-5"&gt;
         &lt;RegistrationForm /&gt;
       &lt;/div&gt;
     &lt;/div&gt;
   &lt;/div&gt;
 );
}
export default Registration;</pre>
			<p>We’ve added <a id="_idIndexMarker454"/>simple introduction text to the page and imported the <code>LoginForm</code> component.</p>
			<ol>
				<li value="2">Next, open <code>App.js</code> and register the page:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.js</p>
			<pre class="source-code">
...
import Registration from "./pages/Registration";
function App() {
 return (
   &lt;Routes&gt;
     ...
     &lt;Route path="/register/" element={&lt;Registration /&gt;} /&gt;
   &lt;/Routes&gt;
 );
}
...</pre>
			<ol>
				<li value="3">Great! Now, go to <code>http://localhost:3000/register/</code>, and you should have a similar result to this:</li>
			</ol>
			<div><div><img src="img/Figure_7.04_B18221.jpg" alt="Figure 7.4 – The registration page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – The registration page</p>
			<ol>
				<li value="4">Test it and register with an account. You’ll be redirected to the home page:</li>
			</ol>
			<div><div><img src="img/Figure_7.05_B18221.jpg" alt="Figure 7.5 – The home page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – The home page</p>
			<p>Great! We’ve just <a id="_idIndexMarker455"/>written the registration page.</p>
			<p>In the next section, we will create the login page.</p>
			<h1 id="_idParaDest-149"><a id="_idTextAnchor155"/>Creating the login page</h1>
			<p>As we have already<a id="_idIndexMarker456"/> created the registration page, the logic for login will be pretty similar but with fewer fields.</p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor156"/>Adding the login page</h2>
			<p>Follow these <a id="_idIndexMarker457"/>steps to add a login page:</p>
			<ol>
				<li value="1">Inside the <code>src/components/authentication</code> directory, add a new file called <code>LoginForm.jsx</code>. This file will contain the form component to log in a user.</li>
				<li>Next, add the imports:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/authentication/LoginForm.jsx</p>
			<pre class="source-code">
import React, { useState } from "react";
import { Form, Button } from "react-bootstrap";
import axios from "axios";
import { useNavigate } from "react-router-dom";
...</pre>
			<ol>
				<li value="3">Write the logic to handle the login:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/authentication/LoginForm.jsx</p>
			<pre class="source-code">
...
function LoginForm() {
 const navigate = useNavigate();
 const [validated, setValidated] = useState(false);
 const [form, setForm] = useState({});
 const [error, setError] = useState(null);
 const handleSubmit = (event) =&gt; {
   event.preventDefault();
   const loginForm = event.currentTarget;
   if (loginForm.checkValidity() === false) {
     event.stopPropagation();
   }
   setValidated(true);
   const data = {
     username: form.username,
     password: form.password,
   };
...</pre>
			<ol>
				<li value="4">As we did for the<a id="_idIndexMarker458"/> registration process, we will now make a request on the login endpoint:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/authentication/LoginForm.jsx</p>
			<pre class="source-code">
...
   axios
     .post("http://localhost:8000/api/auth/login/",
            data)
     .then((res) =&gt; {
       // Registering the account and tokens in the
       // store
       localStorage.setItem("auth", JSON.stringify({
         access: res.data.access,
         refresh: res.data.refresh,
         user: res.data.user,
       }));
       navigate("/");
     })
     .catch((err) =&gt; {
       if (err.message) {
         setError(err.request.response);
       }
     });
...</pre>
			<p>This is nearly the same logic as the registration, but here, we are only working with the username and the password.</p>
			<ol>
				<li value="5">With the logic ready to<a id="_idIndexMarker459"/> handle the request made for login, let’s add the UI:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/components/authentication/LoginForm.jsx</p>
			<pre class="source-code">
...
return (
   &lt;Form
     id="registration-form"
     className="border p-4 rounded"
     noValidate
     validated={validated}
     onSubmit={handleSubmit}
   &gt;
     &lt;Form.Group className="mb-3"&gt;
       &lt;Form.Label&gt;Username&lt;/Form.Label&gt;
       &lt;Form.Control
         value={form.username}
         onChange={(e) =&gt; setForm({ ...form, username:
                    e.target.value })}
         required
         type="text"
         placeholder="Enter username"
       /&gt;
       &lt;Form.Control.Feedback type="invalid"&gt;
         This file is required.
       &lt;/Form.Control.Feedback&gt;
     &lt;/Form.Group&gt;
     ...</pre>
			<p>In the preceding code, we are creating the form and adding the first input of the form, the<a id="_idIndexMarker460"/> username input.</p>
			<ol>
				<li value="6">Let’s also add the password form input and the submit button:<pre class="source-code">
     ...</pre><pre class="source-code">
     &lt;Form.Group className="mb-3"&gt;</pre><pre class="source-code">
       &lt;Form.Label&gt;Password&lt;/Form.Label&gt;</pre><pre class="source-code">
       &lt;Form.Control</pre><pre class="source-code">
         value={form.password}</pre><pre class="source-code">
         minLength="8"</pre><pre class="source-code">
         onChange={(e) =&gt; setForm({ ...form, password:</pre><pre class="source-code">
                    e.target.value })}</pre><pre class="source-code">
         required</pre><pre class="source-code">
         type="password"</pre><pre class="source-code">
         placeholder="Password"</pre><pre class="source-code">
       /&gt;</pre><pre class="source-code">
       &lt;Form.Control.Feedback type="invalid"&gt;</pre><pre class="source-code">
         Please provide a valid password.</pre><pre class="source-code">
       &lt;/Form.Control.Feedback&gt;</pre><pre class="source-code">
     &lt;/Form.Group&gt;</pre><pre class="source-code">
     &lt;div className="text-content text-danger"&gt;</pre><pre class="source-code">
       {error &amp;&amp; &lt;p&gt;{error}&lt;/p&gt;}&lt;/div&gt;</pre><pre class="source-code">
     &lt;Button variant="primary" type="submit"&gt;</pre><pre class="source-code">
       Submit</pre><pre class="source-code">
     &lt;/Button&gt;</pre><pre class="source-code">
   &lt;/Form&gt;</pre><pre class="source-code">
 );</pre><pre class="source-code">
}</pre><pre class="source-code">
export default LoginForm;</pre><pre class="source-code">
...</pre></li>
			</ol>
			<p>We have created the <code>LoginForm</code> component with the required fields and logic to handle data<a id="_idIndexMarker461"/> submission.</p>
			<p>In the next section, we will add <code>LoginForm</code> to a page and register this page in the application routes.</p>
			<h2 id="_idParaDest-151"><a id="_idTextAnchor157"/>Registering the login page</h2>
			<p>Follow these<a id="_idIndexMarker462"/> steps to register the login page:</p>
			<ol>
				<li value="1">Inside the <code>src/pages</code> directory, create a file called <code>Login.jsx</code>:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Login.jsx</p>
			<pre class="source-code">
import React from "react";
import { Link } from "react-router-dom";
import LoginForm from "../components/forms/LoginForm";
...</pre>
			<ol>
				<li value="2">Next, let’s add the UI:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/pages/Login.jsx</p>
			<pre class="source-code">
...
function Login() {
 return (
   &lt;div className="container"&gt;
     &lt;div className="row"&gt;
       &lt;div className="col-md-6 d-flex
         align-items-center"&gt;
         &lt;div className="content text-center px-4"&gt;
           &lt;h1 className="text-primary"&gt;
             Welcome to Postagram!&lt;/h1&gt;
           &lt;p className="content"&gt;
             Login now and start enjoying! &lt;br /&gt;
             Or if you don't have an account, please{" "}
             &lt;Link to="/register/"&gt;register&lt;/Link&gt;.
           &lt;/p&gt;
         &lt;/div&gt;
       &lt;/div&gt;
       &lt;div className="col-md-6 p-5"&gt;
         &lt;LoginForm /&gt;
       &lt;/div&gt;
     &lt;/div&gt;
   &lt;/div&gt;
 );
}
export default Login;</pre>
			<p>This is also quite<a id="_idIndexMarker463"/> similar to the registration page.</p>
			<ol>
				<li value="3">Register the page in the routes of the application in the <code>App.js</code> file:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/App.js</p>
			<pre class="source-code">
...
     &lt;Route path="/login/" element={&lt;Login /&gt;} /&gt;
...</pre>
			<ol>
				<li value="4">Visit <code>http://localhost:3000/login/</code>, and you should have a similar page to this:</li>
			</ol>
			<div><div><img src="img/Figure_7.06_B18221.jpg" alt="`Figure 7.6 – The login page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">`Figure 7.6 – The login page</p>
			<ol>
				<li value="5">Test it again, and you should be redirected to the home page.</li>
			</ol>
			<p>The authentication flow is working like a charm, but we have some repeated code in our project. Let’s do some<a id="_idIndexMarker464"/> refactoring by doing a little exercise in the next section.</p>
			<h1 id="_idParaDest-152"><a id="_idTextAnchor158"/>Refactoring the authentication flow code</h1>
			<p>Instead of repeating the same code across the code base, we can follow the <code>LoginForm</code> and <code>RegistrationForm</code> components. In this section, we will <a id="_idIndexMarker466"/>write a custom React Hook to handle this logic, but before doing that, let’s understand what a Hook is.</p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor159"/>What is a Hook?</h2>
			<p>Hooks were first<a id="_idIndexMarker467"/> introduced in React 16.8, allowing developers to use more of React’s features without writing a class. An interesting example of a React Hook is <code>useState</code>.</p>
			<p><code>useState</code> is a replacement for <code>setState</code>, used inside functional components to manage the internal state of a component. In <code>LoginForm</code>, we used <code>useState</code> to handle the form values. We also used <code>useState</code> to set the message error if the login request returns an error. For a simple test, go to the login page and enter the wrong credentials, and you’ll likely get a similar error to this:</p>
			<div><div><img src="img/Figure_7.07_B18221.jpg" alt="Figure 7.7 – The login form"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – The login form</p>
			<p>The logic from this<a id="_idIndexMarker468"/> comes from the following lines in <code>LoginForm.jsx</code>:</p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/authentication/LoginForm.jsx</p>
			<pre class="source-code">
<strong class="bold"> const [error, setError] = useState(null);</strong>
...
     .catch((err) =&gt; {
<strong class="bold">       if (err.message) {</strong>
<strong class="bold">         setError(err.request.response);</strong>
<strong class="bold">       }</strong>
     });</pre>
			<p>This is an example of the <code>useState</code> Hook, and not every Hook works the same way. For example, you can check the usage of the <code>useNavigate</code> Hook in the <code>LoginForm</code> component. There are a few rules for using Hooks as per the React documentation:</p>
			<ul>
				<li><strong class="bold">Only call Hooks at the top level</strong>: Don’t call Hooks inside loops, conditions, or nested <a id="_idIndexMarker469"/>routes</li>
				<li><strong class="bold">Only call Hooks from React functions</strong>: Call Hooks from React function components and custom Hooks</li>
			</ul>
			<p>React allows us to<a id="_idIndexMarker470"/> write custom Hooks. Let’s write a custom Hook to handle user authentication. Inside a new file, we’ll write functions that make it easier to retrieve and manipulate the <code>auth</code> object in <code>localStorage</code>.</p>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor160"/>Writing code for a custom Hook</h2>
			<p>Follow these<a id="_idIndexMarker471"/> steps to create a custom Hook:</p>
			<ol>
				<li value="1">Inside the <code>src</code> directory, create a new directory called <code>hooks</code>. This directory will contain all the Hooks that we’ll write in this book.</li>
				<li>Inside the newly created directory, add a file called <code>user.actions.js</code>.</li>
				<li>Let’s add all the necessary content, starting with the imports:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
import axios from "axios";
import { useNavigate } from "react-router-dom";</pre>
			<ol>
				<li value="4">Next, let’s add a function called <code>useUserActions</code>. A custom Hook is a JavaScript function whose name starts with <code>use</code>:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
function useUserActions() {
 const navigate = useNavigate();
 const baseURL = "http://localhost:8000/api";
 return {
   login,
   register,
   logout,
 };
}</pre>
			<p>We can now add the <code>login</code> and <code>logout</code> functions. These functions will return <code>Promise</code>, which, if successful, will register the user data in <code>localStorage</code> and redirect the user to the home page, or allow us to catch and handle errors.</p>
			<ol>
				<li value="5">We will now <a id="_idIndexMarker472"/>write the <code>register</code> function as a bit of exercise, but it’s not that different from the <code>login</code> function:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
...
 // Login the user
 function login(data) {
   return axios.post(`${baseURL}/auth/login/`,
                      data).then((res) =&gt; {
     // Registering the account and tokens in the
     // store
     setUserData(data);
     navigate("/");
   });
 }
...</pre>
			<ol>
				<li value="6">Next, write the <code>logout</code> function. This function will remove the <code>auth</code> item from <code>localStorage</code> and <a id="_idIndexMarker473"/>redirect the user to the login page:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
...
 // Logout the user
 function logout() {
   localStorage.removeItem("auth");
   navigate("/login");
 }
...</pre>
			<p>Note that we are using a method called <code>setUserData</code>, which we have not declared yet.</p>
			<ol>
				<li value="7">After the <code>useUserActions</code> function, let’s add other utils functions that can be used across the project. These functions will help us to retrieve access tokens, refresh tokens, user information, or set user data:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
// Get the user
function getUser() {
 const auth =
   JSON.parse(localStorage.getItem("auth"));
 return auth.user;
}
// Get the access token
function getAccessToken() {
 const auth =
   JSON.parse(localStorage.getItem("auth"));
 return auth.access;
}
// Get the refresh token
function getRefreshToken() {
 const auth =
   JSON.parse(localStorage.getItem("auth"));
 return auth.refresh;
}
// Set the access, token and user property
function setUserData(data) {
 localStorage.setItem(
   "auth",
   JSON.stringify({
     access: res.data.access,
     refresh: res.data.refresh,
     user: res.data.user,
   })
 );
}</pre>
			<p class="callout-heading">Important note</p>
			<p class="callout">You might find it confusing to declare functions after calling them. Writing functions in JavaScript using the <code>function</code> keyword allows hoisting, meaning that functions declaration is moved to the top of their scope before code execution. You can learn more at <a href="https://developer.mozilla.org/en-US/docs/Glossary/Hoisting">https://developer.mozilla.org/en-US/docs/Glossary/Hoisting</a>.</p>
			<p>With the functions<a id="_idIndexMarker474"/> for retrieving a user, the access and refresh tokens, and the function to set user data in <code>localStorage</code>, we can now call the function in the <code>LoginForm</code> and <code>RegisterForm</code> components.</p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor161"/>Using the functions in code</h2>
			<p>We have a<a id="_idIndexMarker475"/> useful Hook, <code>useUserActions</code>, in the <code>user.actions.js</code> file. We will use this Hook to call the <code>login</code> method, thus replacing the old login logic in the <code>LoginForm.js</code> file. Let’s start by using the newly written custom Hook in the <code>LoginForm</code> component. Follow these steps:</p>
			<ol>
				<li value="1">First, import the Hooks and declare a new variable:<pre class="source-code">
...</pre><pre class="source-code">
<strong class="bold">import { useUserActions } from "../../hooks/user.actions";</strong></pre><pre class="source-code">
function LoginForm() {</pre><pre class="source-code">
 const [validated, setValidated] = useState(false);</pre><pre class="source-code">
 const [form, setForm] = useState({});</pre><pre class="source-code">
 const [error, setError] = useState(null);</pre><pre class="source-code">
<strong class="bold"> const userActions = useUserActions();</strong></pre><pre class="source-code">
...</pre></li>
				<li>Now, we can make some changes to the <code>handleSubmit</code> function concerning the login request on the API:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/hooks/user.actions.js</p>
			<pre class="source-code">
const data = {
     username: form.username,
     password: form.password,
   };
<strong class="bold">   userActions.login(data)</strong>
     .catch((err) =&gt; {
       if (err.message) {
         setError(err.request.response);
       }
     });
 };</pre>
			<p>In the preceding <a id="_idIndexMarker476"/>code block, we did some quick refactoring by removing the old logic for login and setting user data in <code>localStorage</code>. The same logic can be applied to <code>RegistrationForm</code> (the <code>register</code> method is already available in the <code>useUserActions</code> Hook). You can modify the <code>RegistrationForm</code> component as a small exercise. Feel free to check the code at <a href="https://github.com/PacktPublishing/Full-stack-Django-and-React/blob/chap7/social-media-react/src/components/authentication/RegistrationForm.jsx">https://github.com/PacktPublishing/Full-stack-Django-and-React/blob/chap7/social-media-react/src/components/authentication/RegistrationForm.jsx</a> to make sure your solution is valid.</p>
			<ol>
				<li value="3">Great! Let’s now use the other utils functions in the <code>axios</code> helper and the <code>ProtectedRoute</code> component:</li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/routes/ProtectedRoute.jsx</p>
			<pre class="source-code">
...
function ProtectedRoute({ children }) {
 const user = getUser();
 return user ? &lt;&gt;{children}&lt;/&gt; : &lt;Navigate
   to="/login/" /&gt;;
...</pre>
			<ol>
				<li value="4">Next, let’s do <a id="_idIndexMarker477"/>some tweaks in the <code>axios</code> helper:<pre class="source-code">
...</pre><pre class="source-code">
import { getAccessToken, getRefreshToken } from "../hooks/user.actions";</pre><pre class="source-code">
...</pre><pre class="source-code">
 config.headers.Authorization = `Bearer ${getAccessToken()}`;</pre><pre class="source-code">
...</pre><pre class="source-code">
   .post("/refresh/token/", null, {</pre><pre class="source-code">
     baseURL: "http://localhost:8000",</pre><pre class="source-code">
     headers: {</pre><pre class="source-code">
       Authorization: `Bearer ${getRefreshToken()}`,</pre><pre class="source-code">
...</pre><pre class="source-code">
     const { access, refresh, user } = resp.data;</pre><pre class="source-code">
     failedRequest.response.config.headers[</pre><pre class="source-code">
       "Authorization"] =</pre><pre class="source-code">
       "Bearer " + access;</pre><pre class="source-code">
     localStorage.setItem("auth", JSON.stringify({</pre><pre class="source-code">
       access, refresh, user }));</pre><pre class="source-code">
   })</pre><pre class="source-code">
   .catch(() =&gt; {</pre><pre class="source-code">
     localStorage.removeItem("auth");</pre><pre class="source-code">
   });</pre><pre class="source-code">
...</pre></li>
			</ol>
			<p>In the preceding code block, we used the <code>getAccessToken</code> and <code>getRefreshToken</code> functions to retrieve the access token and the refresh token from <code>localStorage</code> for the requests. We just replaced the old logic to retrieve the access and refresh tokens.</p>
			<p>And we are done. We<a id="_idIndexMarker478"/> have a pure React logic for the authentication flow, which will help us manage the CRUD operations for the posts and comments in the following chapters.</p>
			<h1 id="_idParaDest-156"><a id="_idTextAnchor162"/>Summary</h1>
			<p>In this chapter, we dived deeper into more concepts, such as authentication in a React application. We implemented a clean logic for requests on the Django API with access tokens and also implemented the refresh logic if the access token has expired. We also had the chance to use more of the Bootstrap components to not only style login and registration forms but also to create login and register pages. Finally, we implemented a custom React Hook to handle everything concerning authentication on the frontend, with methods for registration and login, and some utilities to retrieve tokens from <code>localStorage</code> and also set tokens and user data in <code>localStorage</code>. The creation of the custom Hook helped us make some refactoring in the code base according to the DRY principle.</p>
			<p>In the next chapter, we will allow users to create posts from the React application. We will learn how to make requests to the backend using the custom-written <code>axiosService</code>, display modals, handle more complex React states, and also use the <code>useContext</code> React Hook to handle pop-up displays.</p>
			<h1 id="_idParaDest-157"><a id="_idTextAnchor163"/>Questions</h1>
			<ol>
				<li value="1">What is <code>localStorage</code>?</li>
				<li>What is React-Router?</li>
				<li>How do you configure a protected route in React?</li>
				<li>What is a React Hook?</li>
				<li>Give three examples of React Hooks.</li>
				<li>What are the two rules of React Hooks?</li>
			</ol>
		</div>
		<div><div></div>
		</div>
	</body></html>