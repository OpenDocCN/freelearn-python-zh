<html><head></head><body>
		<div id="_idContainer108">
			<h1 id="_idParaDest-547" class="chapter-number"><a id="_idTextAnchor628"/>12</h1>
			<h1 id="_idParaDest-548"><a id="_idTextAnchor629"/>Automation, Workflows, Emails, and Printing</h1>
			<p>Business applications are expected not only to store records but also to manage business workflows. Some objects, such as leads or project tasks, have a lot of records that run in parallel. Having too many records for an object makes it harder to have a clear picture of the business. Odoo has several techniques that can deal with this problem. In this chapter, we will look at how we can set a business workflow with dynamic stages and Kanban groups. This will help the user understand how their business <span class="No-Break">is running.</span></p>
			<p>We will also look at techniques, such as server actions and automated actions, that can be used by power users or functional consultants to add simpler process automation without the need to create custom add-ons. Finally, we will create <strong class="bold">QWeb-based PDF reports</strong> and print <span class="No-Break">them out.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>Managing dynamic <span class="No-Break">record stages</span></li>
				<li>Managing <span class="No-Break">Kanban stages</span></li>
				<li>Adding a quick create form to a <span class="No-Break">Kanban card</span></li>
				<li>Creating interactive <span class="No-Break">Kanban cards</span></li>
				<li>Adding a progress bar to <span class="No-Break">Kanban views</span></li>
				<li>Creating <span class="No-Break">server actions</span></li>
				<li>Using Python code <span class="No-Break">server actions</span></li>
				<li>Using automated actions on <span class="No-Break">time conditions</span></li>
				<li>Using automated actions on <span class="No-Break">event conditions</span></li>
				<li>Creating QWeb-based <span class="No-Break">PDF reports</span></li>
				<li>Managing activities from a <span class="No-Break">Kanban card</span></li>
				<li>Adding a stat button to a <span class="No-Break">form view</span></li>
				<li>Enabling the archive option <span class="No-Break">for records</span></li>
			</ul>
			<h1 id="_idParaDest-549"><a id="_idTextAnchor630"/>Technical requirements</h1>
			<p>The technical requirement for this chapter is having an online <span class="No-Break">Odoo platform.</span></p>
			<p>All the code that will be used in this chapter can be downloaded from this book’s GitHub repository <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter12"><span class="No-Break">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter12</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-550"><a id="_idTextAnchor631"/>Managing dynamic record stages</h1>
			<p>In <strong class="source-inline">my_hostel</strong>, we have a <strong class="source-inline">state</strong> field to indicate the current status of a hostel room record. This <strong class="source-inline">state</strong> field is limited to the <strong class="source-inline">Draft</strong> or <strong class="source-inline">Available</strong> statuses and it is not possible to add a new <a id="_idIndexMarker809"/>state to the business process. To avoid this, we can use the <strong class="source-inline">many2one</strong> field to give flexibility when designing the Kanban workflow of a user’s choice, and you can add/remove a new state at <span class="No-Break">any time.</span></p>
			<h2 id="_idParaDest-551"><a id="_idTextAnchor632"/>Getting ready</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from <a href="B20997_08.xhtml#_idTextAnchor388"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Advanced Server-Side Development Techniques</em>. This module manages the hostel and students. It also records rooms. We added an initial module, <strong class="source-inline">Chapter12/00_initial_module/my_hostel</strong>, to the GitHub repository for this book to help you get <span class="No-Break">started: </span><a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter12"><span class="No-Break">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter12</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-552"><a id="_idTextAnchor633"/>How to do it...</h2>
			<p>Follow these simple steps to add stages to the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span></p>
			<ol>
				<li>Add a new model called <strong class="source-inline">hostel.room.stage</strong>, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">class HostelRoomStage(models.Model):</strong>
<strong class="bold">    _name = 'hostel.room.stage'</strong>
<strong class="bold">    _order = 'sequence,name'</strong>
<strong class="bold">    name = fields.Char("Name")</strong>
<strong class="bold">    sequence = fields.Integer("Sequence")</strong>
<strong class="bold">    fold = fields.Boolean("Fold?")</strong></pre></li>				<li>Add<a id="_idIndexMarker810"/> access rights for this new module in the <strong class="source-inline">security/ir.model.access.csv</strong> file, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">my_hostel.access_hostel_room_stage,access_hostel_room_stage,my_hostel.model_hostel_room_stage,base.group_user,1,1,1,1</strong></pre></li>				<li>Remove the <strong class="source-inline">state</strong> field from the <strong class="source-inline">hostel.room</strong> model and replace it with a new <strong class="source-inline">stage_id</strong> field, which is a <strong class="source-inline">many2one</strong> field, and its methods, as shown in the <span class="No-Break">following example:</span><pre class="source-code">
<strong class="bold">@api.model</strong>
<strong class="bold">def _default_room_stage(self):</strong>
<strong class="bold">    Stage = self.env['hostel.room.stage']</strong>
<strong class="bold">    return Stage.search([], limit=1)</strong></pre></li>				<li>Replace the <strong class="source-inline">state</strong> field in the form view with the <strong class="source-inline">stage_id</strong> field, as shown in the <span class="No-Break">following example:</span><pre class="source-code">
<strong class="bold">&lt;header&gt;</strong>
<strong class="bold">    &lt;field name="stage_id" widget="statusbar"</strong>
<strong class="bold">          options="{'clickable': '1', 'fold_field': 'fold'}"/&gt;</strong>
<strong class="bold">&lt;/header&gt;</strong></pre></li>				<li>Replace the <strong class="source-inline">state</strong> field in the tree view with the <strong class="source-inline">stage_id</strong> field, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">&lt;tree string="Room"&gt;</strong>
<strong class="bold">    &lt;field name="name"/&gt;</strong>
<strong class="bold">    &lt;field name="room_no"/&gt;</strong>
<strong class="bold">    &lt;field name="floor_no"/&gt;</strong>
<strong class="bold">    &lt;field name="stage_id"/&gt;</strong>
<strong class="bold">&lt;/tree&gt;</strong></pre></li>				<li>Add <a id="_idIndexMarker811"/>some initial stages from the <strong class="source-inline">data/room_stages.xml</strong> file. Don’t forget to add this file to the manifest, as shown in the <span class="No-Break">following example:</span><pre class="source-code">
<strong class="bold">&lt;?xml version="1.0" encoding="utf-8"?&gt;</strong>
<strong class="bold">&lt;odoo noupdate="1"&gt;</strong>
<strong class="bold">    &lt;record id="stage_draft" model="hostel.room.stage"&gt;</strong>
<strong class="bold">        &lt;field name="name"&gt;Draft&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="sequence"&gt;1&lt;/field&gt;</strong>
<strong class="bold">    &lt;/record&gt;</strong>
<strong class="bold">    &lt;record id="stage_available" model="hostel.room.stage"&gt;</strong>
<strong class="bold">        &lt;field name="name"&gt;Available&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="sequence"&gt;15&lt;/field&gt;</strong>
<strong class="bold">    &lt;/record&gt;</strong>
<strong class="bold">    &lt;record id="stage_reserved" model="hostel.room.stage"&gt;</strong>
<strong class="bold">        &lt;field name="name"&gt;Reserved&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="sequence"&gt;5&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="fold"&gt;True&lt;/field&gt;</strong>
<strong class="bold">    &lt;/record&gt;</strong>
<strong class="bold">&lt;/odoo&gt;</strong></pre></li>			</ol>
			<p>After <a id="_idIndexMarker812"/>installing the module, you will see stages in the form view, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer090" class="IMG---Figure">
					<img src="image/B20997_12_1.jpg" alt="Figure 12.1 – Stage selector in the form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.1 – Stage selector in the form view</p>
			<p>Here, you’ll notice the stages outlined on the hostel record. These stages are clickable, so you will be able to change the stage by clicking on it. Folded stages will be displayed under the <span class="No-Break"><strong class="bold">More</strong></span><span class="No-Break"> dropdown.</span></p>
			<h2 id="_idParaDest-553"><a id="_idTextAnchor634"/>How it works...</h2>
			<p>Since we <a id="_idIndexMarker813"/>want to manage the record stages dynamically, we need to create a new model. In <em class="italic">Step 1</em>, we created a new model called <strong class="source-inline">hostel.room.stage</strong> to store the dynamic stages. In this model, we added a few fields. One of these was the <strong class="source-inline">sequence</strong> field, which is used to determine the order of the stages. We also added the <strong class="source-inline">fold</strong> Boolean field, which is used to collapse the stages and put them in a drop-down list. This is very helpful when your business process has lots of stages because it means that you can hide insignificant stages in the drop-down menu by setting <span class="No-Break">this field.</span></p>
			<p>The <strong class="source-inline">fold</strong> field is also used in Kanban views to display folded Kanban columns. Usually, <strong class="bold">Reserved</strong> items are expected to be in the <strong class="bold">Unfolded</strong> stage, and terminated items that are marked as either <strong class="bold">Done</strong> or <strong class="bold">Cancelled</strong> should be in the <span class="No-Break"><strong class="bold">Folded</strong></span><span class="No-Break"> stage.</span></p>
			<p>By default, <strong class="source-inline">fold</strong> is the name of the field that is used to hold the value of the stage fold. You can change this by adding the <strong class="source-inline">_fold_name = 'is_fold'</strong> <span class="No-Break">class attribute.</span></p>
			<p>In <em class="italic">Step 2</em>, we added the basic access rights rules for the <span class="No-Break">new model.</span></p>
			<p>In <em class="italic">Step 3</em>, we added the <strong class="source-inline">stage_id</strong> <strong class="source-inline">many2one</strong> field to the <strong class="source-inline">hostel.room</strong> model. While creating a new room record, we wanted to set the default stage value to <strong class="source-inline">Draft</strong>. To accomplish <a id="_idIndexMarker814"/>this, we added a <strong class="source-inline">_default_room_stage()</strong> method. This method will fetch the record of the <strong class="source-inline">hostel.room.stage</strong> model with the lowest sequence number, so, while creating a new record, the stage with the lowest sequence will be displayed as active in the <span class="No-Break">form view.</span></p>
			<p>In <em class="italic">Step 4</em>, we added the <strong class="source-inline">stage_id</strong> field to the form view. By adding the <strong class="source-inline">clickable</strong> option, we made the status bar clickable. We also added an option for the <strong class="source-inline">fold</strong> field, which will allow us to display insignificant stages in the <span class="No-Break">drop-down menu.</span></p>
			<p>In <em class="italic">Step 5</em>, we added <strong class="source-inline">stage_id</strong> to the <span class="No-Break">tree view.</span></p>
			<p>In <em class="italic">Step 6</em>, we added the default data for the stages. Users will see these basic stages after installing our module. If you want to learn more about XML data syntax, refer to the <em class="italic">Loading data using XML files</em> recipe in <a href="B20997_06.xhtml#_idTextAnchor319"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">Managing </em><span class="No-Break"><em class="italic">Module Data</em></span><span class="No-Break">.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">With this implementation, the user can define new stages on the fly. You will need to add views and menus for <strong class="source-inline">hostel.room.stage</strong> so that you can add new stages from the user interface. Refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, if you don’t know how to add views <span class="No-Break">and menus.</span></p>
			<p class="callout">If you don’t want to do this, the Kanban view provides inbuilt features for adding, removing, or modifying stages from the Kanban view itself. We’ll look at this in the <span class="No-Break">next recipe.</span></p>
			<h2 id="_idParaDest-554"><a id="_idTextAnchor635"/>See also</h2>
			<ul>
				<li>Refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>, to learn about adding views <span class="No-Break">and menus.</span></li>
			</ul>
			<h1 id="_idParaDest-555"><a id="_idTextAnchor636"/>Managing Kanban stages</h1>
			<p>Using a <strong class="bold">Kanban board</strong> is a simple way to manage workflows. It is organized into columns, each <a id="_idIndexMarker815"/>corresponding to stages, and the work items progress from left to right until they are finished. A Kanban view, with these stages, provides flexibility because it allows users to choose their own workflows. It provides a full overview of the records on a <span class="No-Break">single screen.</span></p>
			<h2 id="_idParaDest-556"><a id="_idTextAnchor637"/>Getting started</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the previous recipe. We will add Kanban to the <strong class="source-inline">hostel.room</strong> model and we will group Kanban cards <span class="No-Break">by stage.</span></p>
			<h2 id="_idParaDest-557"><a id="_idTextAnchor638"/>How to do it...</h2>
			<p>Perform the following steps to enable workflows such as Kanban for the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span></p>
			<ol>
				<li>Add a Kanban view for <strong class="source-inline">hostel.room</strong>, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">&lt;record id="hostel_room_view_kanban" model="ir.ui.view"&gt;</strong>
<strong class="bold">    &lt;field name="name"&gt;Hostel room Kanban&lt;/field&gt;</strong>
<strong class="bold">    &lt;field name="model"&gt;hostel.room&lt;/field&gt;</strong>
<strong class="bold">    &lt;field name="arch" type="xml"&gt;</strong>
<strong class="bold">        &lt;kanban default_group_by="stage_id"&gt;</strong>
<strong class="bold">            &lt;field name="stage_id" /&gt;</strong>
<strong class="bold">            &lt;templates&gt;</strong>
<strong class="bold">                &lt;t t-name="kanban-box"&gt;</strong>
<strong class="bold">                    &lt;div class="oe_kanban_global_click"&gt;</strong>
<strong class="bold">                        &lt;div class="oe_kanban_content"&gt;</strong>
<strong class="bold">                            &lt;div class="oe_kanban_card"&gt;</strong>
<strong class="bold">                                &lt;div&gt;</strong>
<strong class="bold">                                    &lt;b&gt;</strong>
<strong class="bold">                                        &lt;field name="name" /&gt;</strong>
<strong class="bold">                                    &lt;/b&gt;</strong>
<strong class="bold">                                &lt;/div&gt;</strong>
<strong class="bold">                                &lt;div class="text-muted"&gt;</strong>
<strong class="bold">                                    &lt;i class="fa fa-building"/&gt;</strong>
<strong class="bold">                                    &lt;field name="hostel_id" /&gt;</strong>
<strong class="bold">                                &lt;/div&gt;</strong>
<strong class="bold">                            &lt;/div&gt;</strong>
<strong class="bold">                        &lt;/div&gt;</strong>
<strong class="bold">                    &lt;/div&gt;</strong>
<strong class="bold">                &lt;/t&gt;</strong>
<strong class="bold">            &lt;/templates&gt;</strong>
<strong class="bold">        &lt;/kanban&gt;</strong>
<strong class="bold">    &lt;/field&gt;</strong>
<strong class="bold">&lt;/record&gt;</strong></pre></li>				<li>Add Kanban to the <strong class="source-inline">action_hostel_room</strong> action, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">...</strong>
<strong class="bold">&lt;field name="view_mode"&gt;kanban,tree,form&lt;/field&gt;</strong>
<strong class="bold">...</strong></pre></li>				<li>Add<a id="_idIndexMarker816"/> the <strong class="source-inline">_group_expand_stages()</strong> method and the <strong class="source-inline">group_expand</strong> attribute to the <strong class="source-inline">stage_id</strong> field, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">@api.model</strong>
<strong class="bold">def _group_expand_stages(self, stages, domain, order):</strong>
<strong class="bold">    return stages.search([], order=order)</strong>
<strong class="bold">stage_id = fields.Many2one(</strong>
<strong class="bold">        'hostel.room.stage',</strong>
<strong class="bold">        default=_default_room_stage,</strong>
<strong class="bold">        group_expand='_group_expand_stages'</strong>
<strong class="bold">    )</strong></pre></li>			</ol>
			<p>Restart the server and update the module to apply the changes. This will enable a Kanban board, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer091" class="IMG---Figure">
					<img src="image/B20997_12_2.jpg" alt="Figure 12.2 – Kanban view with groups by stage"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.2 – Kanban view with groups by stage</p>
			<p>As shown<a id="_idIndexMarker817"/> in the preceding screenshot, the Kanban view will show the room records grouped by stage. You will be able to drag and drop cards to another stage column. Moving cards to another column will change the stage value in the <span class="No-Break">database too.</span></p>
			<h2 id="_idParaDest-558"><a id="_idTextAnchor639"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we <a id="_idIndexMarker818"/>added a Kanban view for the <strong class="source-inline">hostel.room.stage</strong> model. Note that we used <strong class="source-inline">stage_id</strong> as the default group for Kanban so that when the user opens Kanban, the Kanban cards will be grouped by stage. To find out more about Kanban, please refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Step 2</em>, we added the <strong class="source-inline">kanban</strong> keyword to the <span class="No-Break">existing action.</span></p>
			<p>In <em class="italic">Step 3</em>, we added the <strong class="source-inline">group_expand</strong> attribute to the <strong class="source-inline">stage_id</strong> field. We also added a new <strong class="source-inline">_group_expand_stages()</strong> method. <strong class="source-inline">group_expand</strong> changes the behavior of the field grouping. By default, field grouping shows the stages that are being used. For example, if no rooms record has the <strong class="source-inline">Reserved</strong> stage, the grouping will not return that stage, so Kanban will not display the <strong class="source-inline">Reserved</strong> column. But in our case, we want to display all of the stages, regardless of whether or not they are <span class="No-Break">being used.</span></p>
			<p>The <strong class="source-inline">_group_expand_stages()</strong> function is used to return all the records for the stages. Because of this, the Kanban view will display all the stages and you will be able to use workflows by dragging and <span class="No-Break">dropping them.</span></p>
			<h2 id="_idParaDest-559"><a id="_idTextAnchor640"/>There’s more...</h2>
			<p>If you <a id="_idIndexMarker819"/>play around with the Kanban board you created in this recipe, you will find lots of different features. Some of these are <span class="No-Break">as follows:</span></p>
			<ul>
				<li>You can create a new stage by clicking on the <strong class="bold">Add new column</strong> option. The <strong class="source-inline">group_create</strong> option can be used to disable the <strong class="bold">Add column</strong> option from the <span class="No-Break">Kanban board.</span></li>
				<li>You can arrange columns in a different order by dragging them by their headers. This will update the sequence field of the <span class="No-Break"><strong class="source-inline">hostel.room.stage</strong></span><span class="No-Break"> model.</span></li>
				<li>You can edit or delete columns with the gear icon in the header of a Kanban column. The <strong class="source-inline">group_edit</strong> and <strong class="source-inline">group_delete</strong> options can be used to disable <span class="No-Break">this feature.</span></li>
				<li>The stages that have a <strong class="source-inline">true</strong> value in the <strong class="source-inline">fold</strong> field will collapse and the column will be displayed as a slim bar. If you click on this slim bar, it will expand and display the <span class="No-Break">Kanban cards.</span></li>
				<li>If the model has an <strong class="source-inline">active</strong> Boolean field, it will display the option to archive and unarchive records in the Kanban column. The <strong class="source-inline">archivable</strong> option can be used to disable <span class="No-Break">this feature.</span></li>
				<li>The plus icon on the Kanban column can be used to create records directly from the Kanban view. The <strong class="source-inline">quick_create</strong> option can be used to disable this feature. For the moment, this feature will not work in our example. This will be solved in the <span class="No-Break">next recipe.</span></li>
			</ul>
			<h2 id="_idParaDest-560"><a id="_idTextAnchor641"/>See also</h2>
			<ul>
				<li>To learn more about Kanban, please refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></li>
			</ul>
			<h1 id="_idParaDest-561"><a id="_idTextAnchor642"/>Adding a quick create form to a Kanban card</h1>
			<p>Grouped<a id="_idIndexMarker820"/> Kanban<a id="_idIndexMarker821"/> views provide the quick create feature, which allows us to generate records directly from the Kanban view. The plus icon on a column will display an editable Kanban card on the column, using which you can create a record. In this recipe, we will learn how to design a quick create Kanban form of <span class="No-Break">our choice.</span></p>
			<h2 id="_idParaDest-562"><a id="_idTextAnchor643"/>Getting started</h2>
			<p>For this<a id="_idIndexMarker822"/> recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the previous recipe. We will use the quick create option in Kanban for the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model.</span></p>
			<h2 id="_idParaDest-563"><a id="_idTextAnchor644"/>How to do it...</h2>
			<p>Follow these<a id="_idIndexMarker823"/> steps to add a custom quick create form <span class="No-Break">for Kanban:</span></p>
			<ol>
				<li>Create a new minimal form view for the <strong class="source-inline">hostel.room</strong> model, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">&lt;record id="hostel_room_view_form_minimal" model="ir.ui.view"&gt;</strong>
<strong class="bold">    &lt;field name="name"&gt;Hostel room Form&lt;/field&gt;</strong>
<strong class="bold">    &lt;field name="model"&gt;hostel.room&lt;/field&gt;</strong>
<strong class="bold">    &lt;field name="arch" type="xml"&gt;</strong>
<strong class="bold">        &lt;form&gt;</strong>
<strong class="bold">            &lt;group&gt;</strong>
<strong class="bold">                &lt;field name="name"/&gt;</strong>
<strong class="bold">                &lt;field name="room_no"/&gt;</strong>
<strong class="bold">                &lt;field name="hostel_id" required="1"/&gt;</strong>
<strong class="bold">                </strong><strong class="bold">&lt;field name="floor_no"/&gt;</strong>
<strong class="bold">                &lt;field name="student_per_room"/&gt;</strong>
<strong class="bold">            &lt;/group&gt;</strong>
<strong class="bold">        &lt;/form&gt;</strong>
<strong class="bold">    &lt;/field&gt;</strong>
<strong class="bold">&lt;/record&gt;</strong></pre></li>				<li>Add quick create options to the <strong class="source-inline">&lt;kanban&gt;</strong> tag, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">&lt;kanban default_group_by="stage_id" on_create="quick_create" quick_create_view="my_hostel.hostel_room_view_form_minimal"&gt;</strong></pre></li>				<li>Restart <a id="_idIndexMarker824"/>the server and update the module<a id="_idIndexMarker825"/> to apply the changes. Then, click on the plus icon in the column. This will enable Kanban forms, as shown in the <span class="No-Break">following screenshot:</span></li>
			</ol>
			<div>
				<div id="_idContainer092" class="IMG---Figure">
					<img src="image/B20997_12_3.jpg" alt="Figure 12.3 – Quickly creating a record directly from the Kanban view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.3 – Quickly creating a record directly from the Kanban view</p>
			<p>When you click on the <strong class="bold">Create</strong> button in the Kanban view, you will see a small card with input instead of being redirected to the form view. You can fill in the values and click on <strong class="bold">Add</strong>, which will create a <span class="No-Break">room record.</span></p>
			<h2 id="_idParaDest-564"><a id="_idTextAnchor645"/>How it works...</h2>
			<p>To create a custom <a id="_idIndexMarker826"/>quick create option, we need to create a minimal form view. We did this in <em class="italic">Step 1</em>. We added two required fields because you cannot create a record without filling in the required fields. If you do so, Odoo will generate an error and open the default form view in the dialogue so that you can enter all the <span class="No-Break">required values.</span></p>
			<p>In <em class="italic">Step 2</em>, we added this new form view to the Kanban view. Using the <strong class="source-inline">quick_create_view</strong> option, you can map the custom form view to the Kanban view. We<a id="_idIndexMarker827"/> also added one extra option – <strong class="source-inline">on_create="quick_create"</strong>. This option will display a quick create form in the first column when you click on the <strong class="bold">Create</strong> button in the control panel. Without this option, the <strong class="bold">Create</strong> button will open a form view in <span class="No-Break">edit mode.</span></p>
			<p>You can disable the quick create feature by adding <strong class="source-inline">quick_create="false"</strong> to the <span class="No-Break">Kanban tag.</span></p>
			<h1 id="_idParaDest-565"><a id="_idTextAnchor646"/>Creating interactive Kanban cards</h1>
			<p>Kanban<a id="_idIndexMarker828"/> cards support all HTML tags, which means you can design them however you like. Odoo provides some built-in ways to make Kanban cards more interactive. In this recipe, we will add color options, the star widget, and <strong class="source-inline">many2many</strong> tags to the <span class="No-Break">Kanban card.</span></p>
			<h2 id="_idParaDest-566"><a id="_idTextAnchor647"/>Getting started</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-567"><a id="_idTextAnchor648"/>How to do it...</h2>
			<p>Follow these steps to create an attractive <span class="No-Break">Kanban card:</span></p>
			<ol>
				<li>Add a new model to manage the tags for the <strong class="source-inline">hostel.room</strong> model, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">class HostelAmenities(models.Model):</strong>
<strong class="bold">    _name = "hostel.amenities"</strong>
<strong class="bold">    _description = "Hostel Amenities"</strong>
<strong class="bold">    name = fields.Char("Name", help="Provided Hostel Amenity")</strong>
<strong class="bold">    active = fields.Boolean("Active", default=True,</strong>
<strong class="bold">        help="Activate/Deactivate whether the amenity should be given or not")</strong>
<strong class="bold">    color = fields.Integer()</strong></pre></li>				<li>Add basic access rights for the <strong class="source-inline">hostel.amenities</strong> model, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">access_hostel_amenities_manager_id,access.hostel.amenities.manager,my_hostel.model_hostel_amenities,my_hostel.group_hostel_manager,1,1,1,1</strong>
<strong class="bold">access_hostel_amenities_user_id,access.hostel.amenities.user,my_hostel.model_hostel_amenities,my_hostel.group_hostel_user,1,0,0,0</strong></pre></li>				<li>Add <a id="_idIndexMarker829"/>new fields to the <strong class="source-inline">hostel.room</strong> model, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">color = fields.Integer()</strong>
<strong class="bold">    popularity = fields.Selection([('no', 'No Demand'), ('low', 'Low Demand'), ('medium', 'Average Demand'), ('high', 'High Demand'),])</strong>
<strong class="bold">hostel_amenities_ids = fields.Many2many(</strong>
<strong class="bold">    "hostel.amenities",</strong>
<strong class="bold">    "hostel_room_amenities_rel", "room_id", "amenitiy_id",</strong>
<strong class="bold">    </strong><strong class="bold">string="Amenities", domain="[('active', '=', True)]",</strong>
<strong class="bold">    help="Select hostel room amenities")</strong></pre></li>				<li>Add fields to the form view, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">&lt;field name="popularity" widget="priority"/&gt;</strong>
<strong class="bold">&lt;field name="hostel_amenities_ids" widget="many2many_tags"</strong>
<strong class="bold">    options="{'color_field': 'color', 'no_create_edit': True}"/&gt;</strong></pre><p class="list-inset">In the <a id="_idIndexMarker830"/>next few steps, we will update an existing Kanban view. The code in bold text is newly <span class="No-Break">added code.</span></p></li>				<li>Add a <strong class="source-inline">color</strong> field to the <span class="No-Break">Kanban view:</span><pre class="source-code">
<strong class="bold">&lt;field name="stage_id" /&gt;</strong>
<strong class="bold">&lt;field name="color" /&gt;</strong></pre></li>				<li>Add a dropdown to choose a color on the <span class="No-Break">Kanban view:</span><pre class="source-code">
<strong class="bold">&lt;t t-name="kanban-box"&gt;</strong>
<strong class="bold">    &lt;div t-attf-class="#{kanban_color(record.color)} oe_kanban_global_click"&gt;</strong>
<strong class="bold">        &lt;div class="o_dropdown_kanban dropdown"&gt;</strong>
<strong class="bold">            &lt;a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown"&gt;</strong>
<strong class="bold">                &lt;span class="fa fa-ellipsis-v"&gt; &lt;/span&gt;</strong>
<strong class="bold">            &lt;/a&gt;</strong>
<strong class="bold">            &lt;div class="dropdown-menu" role="menu"&gt;</strong>
<strong class="bold">                &lt;t t-if="widget.editable"&gt;</strong>
<strong class="bold">                    &lt;a role="menuitem" type="edit" class="dropdown-item"&gt;Edit&lt;/a&gt;</strong>
<strong class="bold">                &lt;/t&gt;</strong>
<strong class="bold">                &lt;t t-if="widget.deletable"&gt;</strong>
<strong class="bold">                    &lt;a role="menuitem" type="delete" class="dropdown-item"&gt;Delete&lt;/a&gt;</strong>
<strong class="bold">                &lt;/t&gt;</strong>
<strong class="bold">                &lt;ul class="oe_kanban_colorpicker" data-field="color"/&gt;</strong>
<strong class="bold">            &lt;/div&gt;</strong>
<strong class="bold">        &lt;/div&gt;</strong>
<strong class="bold">        &lt;div class="oe_kanban_content"&gt;</strong>
<strong class="bold">            &lt;div class="oe_kanban_card oe_kanban_global_click"&gt;</strong>
<strong class="bold">                &lt;div&gt;</strong>
<strong class="bold">                    &lt;i class="fa fa-bed"&gt;  &lt;/i&gt;</strong>
<strong class="bold">                    &lt;b&gt;</strong>
<strong class="bold">                        &lt;field name="name" /&gt;</strong>
<strong class="bold">                    &lt;/b&gt;</strong>
<strong class="bold">                &lt;/div&gt;</strong>
<strong class="bold">                &lt;div class="text-muted"&gt;</strong>
<strong class="bold">                    &lt;i class="fa fa-building"&gt;    &lt;/i&gt;</strong>
<strong class="bold">                    &lt;field name="hostel_id" /&gt;</strong>
<strong class="bold">                &lt;/div&gt;</strong>
<strong class="bold">                &lt;span class="oe_kanban_list_many2many"&gt;</strong>
<strong class="bold">                    &lt;field name="hostel_amenities_ids" widget="many2many_tags" options="{'color_field': 'color'}"/&gt;</strong>
<strong class="bold">                &lt;/span&gt;</strong>
<strong class="bold">                &lt;div&gt;</strong>
<strong class="bold">                    &lt;field name="popularity" widget="priority"/&gt;</strong>
<strong class="bold">                &lt;/div&gt;</strong>
<strong class="bold">            &lt;/div&gt;</strong>
<strong class="bold">        &lt;/div&gt;</strong>
<strong class="bold">    &lt;/div&gt;</strong>
<strong class="bold">&lt;/t&gt;</strong>
<strong class="bold">...</strong></pre></li>				<li>Add <a id="_idIndexMarker831"/>tags and a <strong class="source-inline">popularity</strong> field to the <span class="No-Break">Kanban view:</span><pre class="source-code">
<strong class="bold">...</strong>
<strong class="bold">&lt;div class="text-muted"&gt;</strong>
<strong class="bold">    &lt;i class="fa fa-building"/&gt;</strong>
<strong class="bold">    &lt;field name="hostel_id" /&gt;</strong>
<strong class="bold">&lt;/div&gt;</strong>
<strong class="bold">&lt;span class="oe_kanban_list_many2many"&gt;</strong>
<strong class="bold">    </strong><strong class="bold">&lt;field name="hostel_amenities_ids" widget="many2many_tags" options="{'color_field': 'color'}"/&gt;</strong>
<strong class="bold">&lt;/span&gt;</strong>
<strong class="bold">&lt;div&gt;</strong>
<strong class="bold">    &lt;field name="popularity" widget="priority"/&gt;</strong>
<strong class="bold">&lt;/div&gt;</strong></pre></li>			</ol>
			<p class="callout-heading">Important note</p>
			<p class="callout">The code in bold should be added to the existing <span class="No-Break">Kanban view.</span></p>
			<p class="callout">Restart the server and update the module to apply the changes. Then, click on the plus icon on a column. It will display the Kanban, as shown in the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer093" class="IMG---Figure">
					<img src="image/B20997_12_4.jpg" alt="Figure 12.4 – Kanban cards with new options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.4 – Kanban cards with new options</p>
			<p>Our changes in the <a id="_idIndexMarker832"/>Kanban structure will enable extra options in the Kanban card. Now, you will be able to choose the color on the Kanban itself. You will also be able to prioritize cards <span class="No-Break">with stars.</span></p>
			<h2 id="_idParaDest-568"><a id="_idTextAnchor649"/>How it works...</h2>
			<p>In <em class="italic">Steps 1</em> and <em class="italic">2</em>, we added a new model and security rules for tags. In <em class="italic">Step 3</em>, we added a few fields to the <span class="No-Break">rooms model.</span></p>
			<p>In <em class="italic">Step 4</em>, we added those fields to the form view. Note that we used the <strong class="source-inline">priority</strong> widget on the <strong class="source-inline">popularity</strong> field, which displays the selection field with star icons. In the <strong class="source-inline">hostel_amenities_ids</strong> field, we used the <strong class="source-inline">many2many_tags</strong> widget, which displays the <strong class="source-inline">many2many</strong> field in the form of tags. The <strong class="source-inline">color_field</strong> option is passed to enable the color feature on tags. The value of this option is the field name where the color index is stored. The <strong class="source-inline">no_create_edit</strong> option will disable the feature of creating new tags via the <span class="No-Break">form view.</span></p>
			<p>In <em class="italic">Step 5</em>, we improved lots of things. Fisrt, we added <strong class="source-inline">t-attf-class="#{kanban_color(record.color.raw_value)}</strong> to the Kanban card. This will be used to display the color of the Kanban card. It uses the value of the <strong class="source-inline">color</strong> field and generates a class based on that value. For example, if a Kanban record has a value of <strong class="source-inline">2</strong> in the <strong class="source-inline">color</strong> field, it will add <strong class="source-inline">kanban_color_2</strong> to the class. After that, we added a drop-down menu to add options such as <strong class="bold">Edit</strong>, <strong class="bold">Delete</strong>, and the Kanban color picker. The <strong class="bold">Edit</strong> and <strong class="bold">Delete</strong> options are only displayed if the user has proper <span class="No-Break">access rights.</span></p>
			<p>Finally, we added<a id="_idIndexMarker833"/> tags and priority to the Kanban card. After adding all of this, the Kanban card will look <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer094" class="IMG---Figure">
					<img src="image/B20997_12_5.jpg" alt="Figure 12.5 – Kanban card options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.5 – Kanban card options</p>
			<p>With this card design, you will be able to set popularity stars and colors directly from the <span class="No-Break">Kanban card.</span></p>
			<h1 id="_idParaDest-569"><a id="_idTextAnchor650"/>Adding a progress bar to Kanban views</h1>
			<p>Sometimes, you<a id="_idIndexMarker834"/> have tons of records in columns <a id="_idIndexMarker835"/>and it is very difficult to get a clear picture of the particular stages. A progress bar can be used to display the status of any column. In this recipe, we will display a progress bar on Kanban based on the <span class="No-Break"><strong class="source-inline">popularity</strong></span><span class="No-Break"> field.</span></p>
			<h2 id="_idParaDest-570"><a id="_idTextAnchor651"/>Getting started</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-571"><a id="_idTextAnchor652"/>How to do it...</h2>
			<p>To add a <a id="_idIndexMarker836"/>progress bar to the Kanban columns, you will need to add a <strong class="source-inline">progressbar</strong> tag to the Kanban view definition, <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
&lt;progressbar
    field="popularity"
    colors='{"low": "success", "medium": "warning", "high": "danger"}'/&gt;</pre>			<p>Note that Kanban column progress bars were introduced in Odoo version 11. Versions before that will not display column <span class="No-Break">progress bars.</span></p>
			<p>Restart <a id="_idIndexMarker837"/>the server and update the module to apply the changes. Then, click on the plus icon on a column. This will display the progress bar on the Kanban columns, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer095" class="IMG---Figure">
					<img src="image/B20997_12_6.jpg" alt="Figure 12.6 – Kanban view with a progress bar"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.6 – Kanban view with a progress bar</p>
			<p>Upon updating the module, you will have added a progress bar to the Kanban columns. The color of the progress bar shows the number of records based on the record state. You will be able to click on one of the progress bars to filter records based on <span class="No-Break">that state.</span></p>
			<h2 id="_idParaDest-572"><a id="_idTextAnchor653"/>How it works...</h2>
			<p>Progress bars<a id="_idIndexMarker838"/> on Kanban columns are displayed based on the values of the field. Progress bars support four colors, so you cannot <a id="_idIndexMarker839"/>display more than four states. The available colors are green (success), blue (information), red (danger), and yellow (warning). Then, you need to map colors to the field states. In our example, we mapped three states of the <strong class="source-inline">priority</strong> field because we didn’t want any progress bars for the rooms that were not <span class="No-Break">in demand.</span></p>
			<p>By default, progress bars show a count of the records on the side. You can see the total of a particular state by clicking on it in the progress bar. Clicking on the progress bar will also highlight the cards for that state. Instead of the count of records, you can also display the sum of the integer or float field. To do this, you need to add the <strong class="source-inline">sum_field</strong> attribute with the field value, such <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">sum_field="field_name"</strong></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-573"><a id="_idTextAnchor654"/>Creating server actions</h1>
			<p>Server actions <a id="_idIndexMarker840"/>underpin Odoo’s automation tools. They allow us to describe the <a id="_idIndexMarker841"/>actions to perform. These actions are then available to be called by <strong class="bold">event triggers</strong> or to be triggered automatically when certain time conditions <span class="No-Break">are met.</span></p>
			<p>The simplest case is to let the end user perform an action on a document by selecting it from the <strong class="bold">More</strong> button. We will create this kind of action for project tasks so that we can <strong class="bold">Set Priority</strong> by starring the currently selected task and setting a deadline on it for 3 days <span class="No-Break">from now.</span></p>
			<h2 id="_idParaDest-574"><a id="_idTextAnchor655"/>Getting ready</h2>
			<p>We will need an Odoo instance with the Project app installed. We will also need <strong class="bold">Developer Mode</strong> activated. If it’s not already activated, activate it in the Odoo <span class="No-Break"><strong class="bold">Settings</strong></span><span class="No-Break"> dashboard.</span></p>
			<h2 id="_idParaDest-575"><a id="_idTextAnchor656"/>How to do it...</h2>
			<p>To create a server action and use it from the <strong class="bold">More</strong> menu, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>From the <strong class="bold">Settings</strong> top menu, select the <strong class="bold">Technical</strong> | <strong class="bold">Actions</strong> | <strong class="bold">Server Actions</strong> menu item and click on the <strong class="bold">Create Contextual Action</strong> button at the top of the record list, as shown in the <span class="No-Break">following screenshot:</span></li>
			</ol>
			<div>
				<div id="_idContainer096" class="IMG---Figure">
					<img src="image/B20997_12_7.jpg" alt="Figure 12.7 – Server action form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.7 – Server action form view</p>
			<ol>
				<li value="2">Fill <a id="_idIndexMarker842"/>out the server action form with <span class="No-Break">these values:</span><ul><li><strong class="bold">Action Name</strong>: <strong class="bold">Set </strong><span class="No-Break"><strong class="bold">as Priority</strong></span></li><li><span class="No-Break"><strong class="bold">Model</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="bold">Task</strong></span></li><li><strong class="bold">Type</strong>: <span class="No-Break"><strong class="bold">Update Record</strong></span></li></ul></li>
				<li>In the server action, under the <strong class="bold">Data to Write</strong> tab, go to the <strong class="bold">Update</strong> section. Enter the <span class="No-Break">following parameters:</span><ul><li><span class="No-Break"><strong class="bold">Field</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="source-inline">Priority</strong></span></li><li><strong class="bold">Evaluation </strong><span class="No-Break"><strong class="bold">Type</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="source-inline">Value</strong></span></li><li><span class="No-Break"><strong class="bold">Value</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="source-inline">Low</strong></span></li></ul></li>
			</ol>
			<p>The following screenshot shows the <span class="No-Break">entered values:</span></p>
			<div>
				<div id="_idContainer097" class="IMG---Figure">
					<img src="image/B20997_12_8.jpg" alt="Figure 12.8 – Set lines to write"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.8 – Set lines to write</p>
			<ol>
				<li>Save <a id="_idIndexMarker843"/>the server action and click on the <strong class="bold">Create Contextual Action</strong> button at the top left to make it available under the project task’s <span class="No-Break"><strong class="bold">More</strong></span><span class="No-Break"> button.</span></li>
				<li>To try it out, go to the <strong class="bold">Projects</strong> top menu, open the <strong class="bold">Project</strong>, and open a random task. By clicking on the action, we should see the <strong class="bold">Set Priority</strong> option, as shown in the following screenshot. Selecting this will star the task and change the deadline date to 3 days <span class="No-Break">from now:</span></li>
			</ol>
			<div>
				<div id="_idContainer098" class="IMG---Figure">
					<img src="image/B20997_12_9.jpg" alt="Figure 12.9 – The Set Priority server action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.9 – The Set Priority server action</p>
			<p>Once you <a id="_idIndexMarker844"/>add the server action, you will have set the priority option on the task. Upon clicking on it, the server action star will turn yellow, meaning the priority of the task has increased. Also, the server action will change <span class="No-Break">the deadline.</span></p>
			<h2 id="_idParaDest-576"><a id="_idTextAnchor657"/>How it works...</h2>
			<p>Server actions work <a id="_idIndexMarker845"/>on a model, so one of the first things we must do is pick the model we want to work with. In our example, we used <span class="No-Break">project tasks.</span></p>
			<p>Next, we should select the type of action to perform. There are a few <span class="No-Break">options available:</span></p>
			<ul>
				<li><strong class="bold">Update Record</strong> allows you to set values on the current record or <span class="No-Break">another record.</span></li>
				<li><strong class="bold">Create activity</strong> allows you to create activity on the <span class="No-Break">selected records</span></li>
				<li><strong class="bold">Execute Code</strong> allows you to write arbitrary code to execute when none of the other options are flexible enough for what <span class="No-Break">we need.</span></li>
				<li><strong class="bold">Create Record</strong> allows you to create a new record on the current model or <span class="No-Break">another model.</span></li>
				<li><strong class="bold">Send Email</strong> allows you to choose an email template. This will be used to send out an email when the action <span class="No-Break">is triggered.</span></li>
				<li><strong class="bold">Execute Existing actions</strong> can be used to trigger a client or window action, just like when a menu item is <span class="No-Break">clicked on.</span></li>
				<li><strong class="bold">Add Followers</strong> allows users or channels to subscribe to <span class="No-Break">the record.</span></li>
				<li><strong class="bold">Create Next Activity</strong> allows you to create a new activity. This will be displayed in <span class="No-Break">the chatter.</span></li>
				<li><strong class="bold">Send SMS</strong> allows<a id="_idIndexMarker846"/> you to send an SMS. You need to select the <span class="No-Break">SMS template.</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout"><strong class="bold">Send SMS Text Message</strong> is a chargeable service from Odoo. You need to purchase credit for SMS if you want to send <span class="No-Break">an SMS.</span></p>
			<p>For our example, we used <strong class="bold">Update the Record</strong> to set some values on the current record. We set <strong class="bold">Priority</strong> to <strong class="source-inline">1</strong> to star the task and set a value on the <strong class="bold">Deadline</strong> field. This one is more interesting because the value to use is evaluated from a Python expression. Our example makes use of the <strong class="source-inline">datetime</strong> Python module (<a href="https://docs.python.org/2/library/datetime.html">https://docs.python.org/2/library/datetime.html</a>) to compute the date 3 days <span class="No-Break">from today.</span></p>
			<p>Arbitrary Python expressions can be used there, as well as in several of the other action types available. For security reasons, the code is checked by the <strong class="source-inline">safe_eval</strong> function implemented in the <strong class="source-inline">odoo/tools/safe_eval.py</strong> file. This means that some Python operations may not be allowed, but this rarely proves to be <span class="No-Break">a problem.</span></p>
			<p>When you add a drop-down option to the server action, usually, it is available for all internal users. But if you just want to show this option to selected users, you can assign a group to the server action. This is available under the <strong class="bold">Security</strong> tab in the server action <span class="No-Break">form view.</span></p>
			<h2 id="_idParaDest-577"><a id="_idTextAnchor658"/>There’s more...</h2>
			<p>The Python code is evaluated in a restricted context, where the following objects are available <span class="No-Break">to use:</span></p>
			<ul>
				<li><strong class="source-inline">env</strong>: This is a reference for the <strong class="source-inline">Environment</strong> object, just like <strong class="source-inline">self.env</strong> in a <span class="No-Break">class method.</span></li>
				<li><strong class="source-inline">model</strong>: This is a reference to the <strong class="source-inline">model</strong> class that the server action acts upon. In our example, it is equivalent <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">self.env['project.task]</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">ValidationError</strong>: This is a reference to <strong class="source-inline">from odoo.exceptions import ValidationError</strong>, allowing validations that block unintended actions. It can be used as <span class="No-Break"><strong class="source-inline">raise Warning('Message!')</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">Record</strong> or <strong class="source-inline">records</strong>: This provides references to the current record or records, allowing you to access their field values <span class="No-Break">and methods.</span></li>
				<li><strong class="source-inline">log</strong>: This is a function that’s used to log messages in the <strong class="source-inline">ir.logging</strong> model, allowing database-side <span class="No-Break">logging-on actions.</span></li>
				<li><strong class="source-inline">datetime</strong>, <strong class="source-inline">dateutil</strong>, and <strong class="source-inline">time</strong>: These provide access to the <span class="No-Break">Python libraries.</span></li>
			</ul>
			<h1 id="_idParaDest-578"><a id="_idTextAnchor659"/>Using Python code server actions</h1>
			<p>Server actions <a id="_idIndexMarker847"/>have several types available, but executing arbitrary Python code is the most flexible option. When used wisely, it empowers users with the capability to implement advanced business rules from the user interface, without the need to create specific add-on modules to install <span class="No-Break">that code.</span></p>
			<p>We will demonstrate using this type of server action by implementing a server action that sends reminder notifications to the followers of a <span class="No-Break">project task.</span></p>
			<h2 id="_idParaDest-579"><a id="_idTextAnchor660"/>Getting ready</h2>
			<p>We will need an Odoo instance with the Project <span class="No-Break">app installed.</span></p>
			<h2 id="_idParaDest-580"><a id="_idTextAnchor661"/>How to do it...</h2>
			<p>To create a<a id="_idIndexMarker848"/> Python code server action, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Create a new server action. In the <strong class="bold">Settings</strong> menu, select the <strong class="bold">Technical</strong> | <strong class="bold">Actions</strong> | <strong class="bold">Server Actions</strong> menu item, and click on the <strong class="bold">Create</strong> button at the top of the <span class="No-Break">record list.</span></li>
				<li>Fill out the <strong class="bold">Server Action</strong> form with the <span class="No-Break">following values:</span><ul><li><strong class="bold">Action Name</strong>: <span class="No-Break"><strong class="bold">Send Reminder</strong></span></li><li><strong class="bold">Base </strong><span class="No-Break"><strong class="bold">Model</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="bold">Task</strong></span></li><li><strong class="bold">Action To Do</strong>: <span class="No-Break"><strong class="bold">Execute Code</strong></span></li></ul></li>
				<li>In the <strong class="bold">Python Code</strong> text area, remove the default text and replace it with the <span class="No-Break">following code:</span><pre class="source-code">
<strong class="bold">if not record.date_deadline:</strong>
<strong class="bold">    raise ValidationError('Task has no deadline!')</strong>
<strong class="bold">delta = record.date_deadline - datetime.date.today()</strong>
<strong class="bold">days = delta.days</strong>
<strong class="bold">if days==0:</strong>
<strong class="bold">    msg = 'Task is due today.'</strong>
<strong class="bold">elif days &lt; 0:</strong>
<strong class="bold">    msg = 'Task is %d day(s) late.' % abs(days)</strong>
<strong class="bold">else:</strong>
<strong class="bold">    msg = 'Task will be due in %d day(s).' % days</strong>
<strong class="bold">record.message_post(body=msg, subject='Reminder', subtype_xmlid='mail.mt_comment')</strong></pre><p class="list-inset">The following screenshot shows the <span class="No-Break">entered values:</span></p></li>			</ol>
			<div>
				<div id="_idContainer099" class="IMG---Figure">
					<img src="image/B20997_12_10.jpg" alt="Figure 12.10 – Python code with the values entered"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.10 – Python code with the values entered</p>
			<ol>
				<li value="4">Save<a id="_idIndexMarker849"/> the server action and click on <strong class="bold">Create Contextual Action</strong> at the top left to make it available under the project task’s <span class="No-Break"><strong class="bold">More</strong></span><span class="No-Break"> button.</span></li>
				<li>Now, click on the <strong class="bold">Project</strong> top menu and select the <strong class="bold">Search</strong> | <strong class="bold">Tasks</strong> menu item. Pick a random task, set a deadline date on it, and then try the <strong class="bold">Send Reminder</strong> option under the <span class="No-Break"><strong class="bold">More</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<p>This works just like the previous recipe; the only difference is that this server action will run your Python code. Once you run the server action on a task, it will put a message in <span class="No-Break">the chatter.</span></p>
			<h2 id="_idParaDest-581"><a id="_idTextAnchor662"/>How it works...</h2>
			<p>The <em class="italic">Creating server actions</em> recipe<a id="_idIndexMarker850"/> of this chapter provides a detailed explanation of how to create a server action in general. For this particular type of action, we need to pick the <strong class="bold">Execute Code</strong> option and then write the code to run the <span class="No-Break">text area.</span></p>
			<p>The code can have multiple lines, as is the case in our recipe, and it runs in a context that has references to objects such as the current record object or the session user. The available references were described in the <em class="italic">Creating server </em><span class="No-Break"><em class="italic">actions</em></span><span class="No-Break"> recipe.</span></p>
			<p>The code <a id="_idIndexMarker851"/>we used computes the number of days from the current date until the deadline date and uses that to prepare an appropriate notification message. The last line does the actual posting of the message in the task’s message wall. The <strong class="source-inline">subtype='mt_comment'</strong> argument is needed for email notifications to be sent to the followers, just like when we use the <strong class="bold">New Message</strong> button. If no subtype is given, <strong class="source-inline">mt_note</strong> is used by default, posting an internal note without notification, as if we had used the <strong class="bold">Log an internal note</strong> button. Refer to <a href="B20997_23.xhtml#_idTextAnchor1210"><span class="No-Break"><em class="italic">Chapter 23</em></span></a>, <em class="italic">Managing Emails in Odoo</em>, to learn more about mailing <span class="No-Break">in Odoo.</span></p>
			<h2 id="_idParaDest-582"><a id="_idTextAnchor663"/>There’s more...</h2>
			<p>Python code server actions are a powerful and flexible resource, but they do have some limitations compared to the custom <span class="No-Break">add-on modules.</span></p>
			<p>Because the Python code is evaluated at runtime, if an error occurs, the stack trace is not as informative and can be harder to debug. It is also not possible to insert a breakpoint in the code of a server action using the techniques shown in <a href="B20997_07.xhtml#_idTextAnchor363"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Debugging Modules</em>, so debugging needs to be done using logging statements. Another concern is that, when trying to track down the cause of behavior in the module code, you may not find anything relevant. In this case, it’s probably caused by a <span class="No-Break">server action.</span></p>
			<p>When carrying out a more intensive use of server actions, the interactions can be quite complex, so it is advisable to plan properly and keep <span class="No-Break">them organized.</span></p>
			<h2 id="_idParaDest-583"><a id="_idTextAnchor664"/>See also</h2>
			<ul>
				<li>Refer to <a href="B20997_23.xhtml#_idTextAnchor1210"><span class="No-Break"><em class="italic">Chapter 23</em></span></a>, <em class="italic">Managing Emails in Odoo</em>, to learn more about mailing <span class="No-Break">in Odoo.</span></li>
			</ul>
			<h1 id="_idParaDest-584"><a id="_idTextAnchor665"/>Using automated actions on time conditions</h1>
			<p><strong class="bold">Automated actions</strong> can be used <a id="_idIndexMarker852"/>to automatically <a id="_idIndexMarker853"/>trigger actions based on time conditions. We can use them to automatically perform some operations on records that meet <a id="_idIndexMarker854"/>certain criteria and <span class="No-Break">time conditions.</span></p>
			<p>As an example, we can trigger a reminder notification for project tasks one day before their deadline, if they have one. Let’s see how this can <span class="No-Break">be done.</span></p>
			<h2 id="_idParaDest-585"><a id="_idTextAnchor666"/>Getting ready</h2>
			<p>To follow this <a id="_idIndexMarker855"/>recipe, we will need to have both the <em class="italic">project management</em> app (which has the technical name <strong class="source-inline">project</strong>) and the <strong class="bold">Automated Action Rules</strong> add-on (which has the technical name <strong class="source-inline">base_automation</strong>) already installed, and have <strong class="bold">Developer Mode</strong> activated. We will also need the server action we created in the <em class="italic">Using Python code server actions</em> recipe of <span class="No-Break">this chapter.</span></p>
			<h2 id="_idParaDest-586"><a id="_idTextAnchor667"/>How to do it...</h2>
			<p>To create an<a id="_idIndexMarker856"/> automated action with a timed condition on tasks, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>In the <strong class="bold">Settings</strong> menu, select the <strong class="bold">Technical</strong> | <strong class="bold">Automation</strong> | <strong class="bold">Automated Actions</strong> menu item, and click on the <span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break"> button.</span></li>
				<li>Fill out the basic information on the <strong class="bold">Automated </strong><span class="No-Break"><strong class="bold">Actions</strong></span><span class="No-Break"> form:</span><ul><li><strong class="bold">Rule Name</strong>: <strong class="source-inline">Send notification </strong><span class="No-Break"><strong class="source-inline">near deadline</strong></span></li><li><span class="No-Break"><strong class="bold">Model</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="bold">Task</strong></span></li><li>Select <strong class="bold">Based on Time Condition</strong> in the <span class="No-Break"><strong class="bold">Trigger</strong></span><span class="No-Break"> field</span></li><li>For <strong class="bold">Action To Do</strong>, select <strong class="bold">Execute </strong><span class="No-Break"><strong class="bold">Existing actions</strong></span></li></ul></li>
				<li>To set the record criteria, click on the <strong class="bold">Edit Domain</strong> button in the <strong class="bold">Apply on </strong>section. In the pop-up dialogue, set a valid domain expression in the code editor, <strong class="source-inline">["&amp;",["date_deadline","!=",False],["stage_id.fold","=",False]]</strong>, and click on the <strong class="bold">Save</strong> button. When changing to another field, the information on the number of records meeting the criteria will be updated and display <strong class="bold">Record(s)</strong> buttons. By clicking on the <strong class="bold">Records</strong> button, we can check the records list of the records meeting the <span class="No-Break">domain expression.</span></li>
				<li>To set the time condition for <strong class="bold">Trigger Date</strong>, select the field to use, which is <strong class="bold">Deadline</strong>, and set <strong class="bold">Delay after trigger date</strong> to <strong class="source-inline">-</strong><span class="No-Break"><strong class="source-inline">1</strong></span><span class="No-Break"> </span><span class="No-Break"><strong class="bold">Days</strong></span><span class="No-Break">.</span></li>
				<li>On the <strong class="bold">Actions</strong> tab, under <strong class="bold">Server actions to run</strong>, click on <strong class="bold">Add an item</strong> and pick <strong class="bold">Send Reminder</strong> from the list; this should have been created previously. Refer to <a id="_idIndexMarker857"/>the <span class="No-Break">following screenshot:</span></li>
			</ol>
			<div>
				<div id="_idContainer100" class="IMG---Figure">
					<img src="image/B20997_12_11.jpg" alt="Figure 12.11 – Automated action form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.11 – Automated action form view</p>
			<p class="list-inset">If not, we can still create the server action to run using the <span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break"> button.</span></p>
			<ol>
				<li value="6">Click<a id="_idIndexMarker858"/> on <strong class="bold">Save</strong> to save the <span class="No-Break">automated action.</span></li>
				<li>Perform the following steps to try <span class="No-Break">it out:</span><ol><li class="lower-roman">Go to the <strong class="bold">Project</strong> menu, go to <strong class="bold">Search</strong> | <strong class="bold">Tasks</strong>, and set a deadline on a task with the date in <span class="No-Break">the past.</span></li><li class="lower-roman">Go to the <strong class="bold">Settings</strong> menu, click on the <strong class="bold">Technical</strong> | <strong class="bold">Automation</strong> | <strong class="bold">Scheduled</strong> <strong class="bold">Actions</strong> menu item, find the <strong class="bold">Base Action Rule: check and execute</strong> action in the list, open its form view, and press on the <strong class="bold">Run Manually</strong> button at the top left. This <a id="_idIndexMarker859"/>forces timed automated actions to be checked. This is shown in the following screenshot. Note that this should work on a newly created demo<a id="_idIndexMarker860"/> database, but it might not work this way in an <span class="No-Break">existing database:</span></li></ol></li>
			</ol>
			<div>
				<div id="_idContainer101" class="IMG---Figure">
					<img src="image/B20997_12_12.jpg" alt="Figure 12.12 – Running an automated action (for test)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.12 – Running an automated action (for test)</p>
			<ol>
				<li value="8">Again, go to the <strong class="bold">Project</strong> menu and open the same task you previously set a deadline date on. Check the message board; you should see the notification generated by the server action triggered by our <span class="No-Break">automated action.</span><p class="list-inset">After adding the time-based automated action for the deadline, a reminder message will be added to the task 1 day before <span class="No-Break">the deadline.</span></p></li>
			</ol>
			<h2 id="_idParaDest-587"><a id="_idTextAnchor668"/>How it works...</h2>
			<p>Automated actions act on a model, and can be triggered either by events or time conditions. First, we must set the <strong class="bold">Model</strong> and <strong class="bold">When to </strong><span class="No-Break"><strong class="bold">Run</strong></span><span class="No-Break"> values.</span></p>
			<p>Both methods can <a id="_idIndexMarker861"/>use a filter to narrow down the records that we can perform the action on. We can use a domain expression for this. You can find further information about writing domain expressions in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Backend Views</em>. Alternatively, you can create and save a filter on project tasks by using the user interface features and then copy the automatically generated domain expression, selecting it from the <strong class="bold">Set</strong> selection based on a search <span class="No-Break">filter list.</span></p>
			<p>The domain <a id="_idIndexMarker862"/>expression we used selects all the records with a non-empty <strong class="bold">Deadline</strong> date, in a stage where the <strong class="source-inline">Fold</strong> flag is not checked. Stages without the <strong class="source-inline">Fold</strong> flag are considered to be work-in-progress. This way, we avoid triggering notifications on tasks that are in the <strong class="bold">Done</strong>, <strong class="bold">Canceled</strong>, or <span class="No-Break"><strong class="bold">Closed</strong></span><span class="No-Break"> stages.</span></p>
			<p>Then, we should define the time condition – the date field to use and when the action should be triggered. The period can be in minutes, hours, days, or months, and the number set for the period can be positive, indicating the time after the date, or negative, indicating the time before the date. When using a period in days, we can provide a resource calendar that defines the working days and that can be used by the <span class="No-Break">day count.</span></p>
			<p>These actions are checked by the <strong class="bold">Check Action Rules</strong> scheduled job. Note that, by default, this is run every 4 hours. This is appropriate for actions that work on a day or month scale, but if you need actions that work on smaller timescales, you need to change the running interval to a <span class="No-Break">smaller value.</span></p>
			<p>Actions will be triggered for records that meet all the criteria and whose triggering date condition (the field date plus the interval) is after the last action execution. This is to avoid repeatedly triggering the same action. Also, this is why manually running the preceding action will work in a database in which the scheduled action has not yet been triggered, but why it might not work immediately in a database where it has already been run by <span class="No-Break">the scheduler.</span></p>
			<p>Once an automated action is triggered, the <strong class="bold">Actions</strong> tab tells you what should happen. This might be a list of server actions that do things such as changing values on the record, posting notifications, or sending <span class="No-Break">out emails.</span></p>
			<h2 id="_idParaDest-588"><a id="_idTextAnchor669"/>There’s more...</h2>
			<p>These types of automated actions are triggered once a certain time condition is reached. This is not the same as regularly repeating an action while a condition is still true. For example, an <a id="_idIndexMarker863"/>automated action will not be capable of posting a reminder for every day after the deadline has <span class="No-Break">been exceeded.</span></p>
			<p>This type of action can, instead, be<a id="_idIndexMarker864"/> performed by scheduled actions, which are stored in the <strong class="source-inline">ir.cron</strong> model. However, scheduled actions do not support server actions; they can only call an existing method of a model object. So, to implement a custom action, we need to write an add-on module, adding the underlying <span class="No-Break">Python method.</span></p>
			<p>For reference, the technical name for the model <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">base.action.rule</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-589"><a id="_idTextAnchor670"/>See also</h2>
			<ul>
				<li>For further details about writing domain expressions, refer to <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></li>
			</ul>
			<h1 id="_idParaDest-590"><a id="_idTextAnchor671"/>Using automated actions on event conditions</h1>
			<p>Business <a id="_idIndexMarker865"/>applications provide systems with<a id="_idIndexMarker866"/> records for business operations but are also expected to support dynamic business rules that are specific to the organization’s <span class="No-Break">use cases.</span></p>
			<p>Carving these rules into custom add-on modules can be inflexible and out of the reach of functional users. Automated actions triggered by event conditions can bridge this gap and provide a powerful tool to automate or enforce the organization’s procedures. As an example, we will enforce validation on project tasks so that only the project manager can change tasks to the <span class="No-Break"><strong class="bold">Done</strong></span><span class="No-Break"> stage.</span></p>
			<h2 id="_idParaDest-591"><a id="_idTextAnchor672"/>Getting ready</h2>
			<p>To follow this recipe, you will need to have the project management app already installed. You also need to have <strong class="bold">Developer Mode</strong> activated. If it’s not activated already, activate it in the Odoo <span class="No-Break"><strong class="bold">About</strong></span><span class="No-Break"> dialogue.</span></p>
			<h2 id="_idParaDest-592"><a id="_idTextAnchor673"/>How to do it...</h2>
			<p>To create an <a id="_idIndexMarker867"/>automated action with an event condition on tasks, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>In the <strong class="bold">Settings</strong> menu, select the <strong class="bold">Technical</strong> | <strong class="bold">Automation</strong> |<strong class="bold">Automated Actions</strong> menu item, and click on the <span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break"> button.</span></li>
				<li>Fill out the basic information in the <strong class="bold">Automated </strong><span class="No-Break"><strong class="bold">Actions</strong></span><span class="No-Break"> form:</span><ul><li><strong class="bold">Action Name</strong>: <strong class="source-inline">Validate </strong><span class="No-Break"><strong class="source-inline">Closing Tasks</strong></span></li><li><span class="No-Break"><strong class="bold">Model</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="bold">Task</strong></span></li><li><strong class="bold">Trigger</strong>: <span class="No-Break"><strong class="bold">On Save</strong></span></li><li><strong class="bold">Action To Do</strong>: <strong class="bold">Execute </strong><span class="No-Break"><strong class="bold">Existing actions</strong></span></li><li><strong class="bold">Watched fields</strong>: <span class="No-Break"><strong class="source-inline">Stage id</strong></span></li></ul></li>
				<li>The <strong class="bold">When updating</strong> rules allow you to set two record filters, before and after the <a id="_idIndexMarker868"/><span class="No-Break">update operation:</span><ul><li>For the <strong class="bold">Before Update Filter</strong> field, click on the <strong class="bold">Edit Domain</strong> button, set a valid domain expression – <strong class="source-inline">[('stage_id.name', '!=', 'Done')]</strong> – in the code editor, <span class="No-Break">and save</span></li><li>For the <strong class="bold">Apply on</strong> field, click on the <strong class="bold">Edit Domain</strong> button, set the <strong class="source-inline">[('stage_id.name', '=', 'Done')]</strong> domain in the code editor, and save, as shown in the <span class="No-Break">following screenshot:</span></li></ul></li>
			</ol>
			<div>
				<div id="_idContainer102" class="IMG---Figure">
					<img src="image/B20997_12_13.jpg" alt="Figure 12.13 – Automated action form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.13 – Automated action form view</p>
			<ol>
				<li value="4">In the <strong class="bold">Actions</strong> tab, click on <strong class="bold">Add an item</strong>. In the list dialogue, click on the <strong class="bold">Create</strong> button to create a new <span class="No-Break">server action.</span></li>
				<li>Fill out<a id="_idIndexMarker869"/> the<a id="_idIndexMarker870"/> server action form with the following values, and then click on the <span class="No-Break"><strong class="bold">Save</strong></span><span class="No-Break"> button:</span><ul><li><strong class="bold">Action Name</strong>: <strong class="source-inline">Validate </strong><span class="No-Break"><strong class="source-inline">Closing tasks</strong></span></li><li><span class="No-Break"><strong class="bold">Model</strong></span><span class="No-Break">: </span><span class="No-Break"><strong class="bold">Task</strong></span></li><li><strong class="bold">Action To Do</strong>: <span class="No-Break"><strong class="bold">Execute Code</strong></span></li><li><strong class="bold">Python Code</strong>: Enter the <span class="No-Break">following code:</span><pre class="source-code">
<strong class="bold">if user != record.project_id.user_id:</strong>
<strong class="bold">    raise Warning('Only the Project Manager can close Tasks')</strong></pre></li></ul><p class="list-inset">The following screenshot shows the <span class="No-Break">entered values:</span></p></li>			</ol>
			<div>
				<div id="_idContainer103" class="IMG---Figure">
					<img src="image/B20997_12_14.jpg" alt="Figure 12.14 – Adding a child action"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.14 – Adding a child action</p>
			<ol>
				<li value="6">Click on <strong class="bold">Save &amp; Close</strong> to <a id="_idIndexMarker871"/>save the <a id="_idIndexMarker872"/>automated action and try <span class="No-Break">it out:</span><ol><li class="lower-roman">On a database with demo data and where you’re logged in as an administrator, go to the <strong class="bold">Project</strong> menu and click on the project to open the Kanban view of <span class="No-Break">the tasks.</span></li><li class="lower-roman">Then, try dragging one of the tasks into the <strong class="bold">Done</strong> stage column. Since this project’s manager is the <strong class="source-inline">Demo</strong> user and we are working with the <strong class="source-inline">Administrator</strong> user, our automated action should be triggered, and our warning message should block <span class="No-Break">the change.</span></li></ol></li>
			</ol>
			<h2 id="_idParaDest-593"><a id="_idTextAnchor674"/>How it works...</h2>
			<p>We start by giving a name to our automated actions and setting the model it should work with. For the type of action we require, we should choose <strong class="bold">On Save</strong>, but the <strong class="bold">On Creation</strong>, <strong class="bold">On Creation &amp; Update</strong>, <strong class="bold">On Deletion</strong>, and <strong class="bold">Based On Form Modification</strong> options are <span class="No-Break">also available.</span></p>
			<p>Next, we define the filters to determine when our action should be triggered. The <strong class="bold">On Save</strong> actions allow<a id="_idIndexMarker873"/> us to define two filters – one to check before and the other after the changes are made to the record. This can be used to express transitions – to detect when a record changes from <em class="italic">state A</em> to <em class="italic">state B</em>. In our example, we want to trigger the action when a <em class="italic">not-done</em> task changes to the <em class="italic">done</em> stage. The <strong class="bold">On Save</strong> action is the only one that<a id="_idIndexMarker874"/> allows these two filters; the other action types only allow <span class="No-Break">one filter.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">It is important to note that our example condition will only work correctly for English language users. This is because <strong class="bold">Stage Name</strong> is a translatable field that can have different values for different languages. So, the filters on the translatable fields should be avoided or used <span class="No-Break">with care.</span></p>
			<p>Finally, we create and add one (or more) server actions with whatever we want to be done when the automated action is triggered. In this case, we chose to demonstrate how to implement custom validation, making use of a Python code server action that used the <strong class="source-inline">Warning</strong> exception to block the <span class="No-Break">user’s changes.</span></p>
			<h2 id="_idParaDest-594"><a id="_idTextAnchor675"/>There’s more...</h2>
			<p>In <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic Server-Side Development</em>, we saw how to redefine the <strong class="source-inline">write()</strong> methods of a model to perform actions on record updates. Automated actions on record updates provide another way to achieve this, with some benefits <span class="No-Break">and drawbacks.</span></p>
			<p>Among the benefits, it is easy to define an action that’s triggered by the update of a stored computed field, which is tricky to do in pure code. It is also possible to define filters on records and have different rules for different records or for records matching different conditions that can be expressed with <span class="No-Break">search domains.</span></p>
			<p>However, automated actions can have disadvantages compared to Python business logic code inside modules. With poor planning, the flexibility provided can lead to complex interactions that are difficult to maintain and debug. Also, the before-and-after write filter operations bring some overhead, which can be an issue if you are performing <span class="No-Break">sensitive actions.</span></p>
			<h1 id="_idParaDest-595"><a id="_idTextAnchor676"/>Creating QWeb-based PDF reports</h1>
			<p>When <a id="_idIndexMarker875"/>communicating with the outside world, it is often necessary to produce a PDF document from a record in the database. Odoo uses the same template language that’s used for form <span class="No-Break">views: QWeb.</span></p>
			<p>In this recipe, we will create a QWeb report to print information about a room that is currently being borrowed by a student. This recipe will reuse the models presented in the <em class="italic">Adding a progress bar in Kanban views</em> recipe from earlier in <span class="No-Break">this chapter.</span></p>
			<h2 id="_idParaDest-596"><a id="_idTextAnchor677"/>Getting ready</h2>
			<p>If you haven’t done so already, install <strong class="source-inline">wkhtmltopdf</strong>, as described in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment</em>; otherwise, you won’t get shiny PDFs as a result of <span class="No-Break">your efforts.</span></p>
			<p>Also, double-check that the <strong class="source-inline">web.base.url</strong> configuration parameter (or <strong class="source-inline">report.url</strong>) is a URL that is accessible from your Odoo instance; otherwise, the report will take a long time to generate and the result will <span class="No-Break">look strange.</span></p>
			<h2 id="_idParaDest-597"><a id="_idTextAnchor678"/>How to do it...</h2>
			<p>Follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>In this recipe, we will add a report to <strong class="source-inline">hostel.student</strong> that prints a list of students that the student borrowed. We need to add a <strong class="source-inline">one2many</strong> field to the student model concerning the <strong class="source-inline">hostel.room</strong> model, as shown in the <span class="No-Break">following example:</span><pre class="source-code">
<strong class="bold">class HostelStudent(models.Model):</strong>
<strong class="bold">    _name = "hostel.student"</strong>
<strong class="bold">    _description = "Hostel Student Information"</strong>
<strong class="bold">    name = fields.Char("Student Name")</strong>
<strong class="bold">    gender = fields.Selection([("male", "Male"),</strong>
<strong class="bold">        ("female", "Female"), ("other", "Other")],</strong>
<strong class="bold">        string="Gender", help="Student gender")</strong>
<strong class="bold">    active = fields.Boolean("Active", default=True,</strong>
<strong class="bold">        </strong><strong class="bold">help="Activate/Deactivate hostel record")</strong></pre></li>				<li>Define<a id="_idIndexMarker876"/> a view for your report in <strong class="source-inline">reports/hostel_room_detail_report_template.xml</strong>, <span class="No-Break">as follows:</span><pre class="source-code">
<strong class="bold">&lt;?xml version="1.0" encoding="utf-8"?&gt;</strong>
<strong class="bold">&lt;odoo&gt;</strong>
<strong class="bold">&lt;template id="hostel_room_detail_reports_template"&gt;</strong>
<strong class="bold">    &lt;t t-call="web.html_container"&gt;</strong>
<strong class="bold">        &lt;t t-foreach="docs" t-as="doc"&gt;</strong>
<strong class="bold">            &lt;t t-call="web.internal_layout"&gt;</strong>
<strong class="bold">                &lt;div class="page"&gt;</strong>
<strong class="bold">                    &lt;h1&gt;Room name: &lt;t t-esc="doc.name"/&gt;&lt;/h1&gt;</strong>
<strong class="bold">                    &lt;h1&gt;Room No: &lt;t t-esc="doc.name"/&gt;&lt;/h1&gt;</strong>
<strong class="bold">                    &lt;table class="table table-condensed"&gt;</strong>
<strong class="bold">                        </strong><strong class="bold">&lt;thead&gt;</strong>
<strong class="bold">                            &lt;tr&gt;</strong>
<strong class="bold">                                &lt;th&gt;Student Name&lt;/th&gt;</strong>
<strong class="bold">                                &lt;th&gt;Gender&lt;/th&gt;</strong>
<strong class="bold">                            &lt;/tr&gt;</strong>
<strong class="bold">                        &lt;/thead&gt;</strong>
<strong class="bold">                        &lt;tbody&gt;</strong>
<strong class="bold">                            &lt;tr t-foreach="doc.student_ids" t-as="student" &gt;</strong>
<strong class="bold">                                &lt;td&gt;&lt;t t-esc="student.name" /&gt;&lt;/td&gt;</strong>
<strong class="bold">                                &lt;td&gt;&lt;t t-esc="student.gender" /&gt;&lt;/td&gt;</strong>
<strong class="bold">                            </strong><strong class="bold">&lt;/tr&gt;</strong>
<strong class="bold">                        &lt;/tbody&gt;</strong>
<strong class="bold">                    &lt;/table&gt;</strong>
<strong class="bold">                &lt;/div&gt;</strong>
<strong class="bold">            &lt;/t&gt;</strong>
<strong class="bold">        &lt;/t&gt;</strong>
<strong class="bold">    &lt;/t&gt;</strong>
<strong class="bold">&lt;/template&gt;</strong>
<strong class="bold">&lt;/odoo&gt;</strong></pre></li>				<li>Add a tag in <strong class="source-inline">reports/hostel_room_detail_report.xml</strong>, as shown in the<a id="_idIndexMarker877"/> <span class="No-Break">following example:</span><pre class="source-code">
<strong class="bold">&lt;?xml version="1.0" encoding="utf-8"?&gt;</strong>
<strong class="bold">&lt;odoo&gt;</strong>
<strong class="bold">    &lt;record id="report_hostel_room_detail" model="ir.actions.report"&gt;</strong>
<strong class="bold">        &lt;field name="name"&gt;Room detail report&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="model"&gt;hostel.room&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="report_type"&gt;qweb-pdf&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="binding_model_id" ref="model_hostel_room"/&gt;</strong>
<strong class="bold">        &lt;field name="report_name"&gt;my_hostel.hostel_room_detail_reports_template&lt;/field&gt;</strong>
<strong class="bold">        &lt;field name="report_file"&gt;my_hostel.hostel_room_detail_reports_template&lt;/field&gt;</strong>
<strong class="bold">    &lt;/record&gt;</strong>
<strong class="bold">&lt;/odoo&gt;</strong></pre></li>				<li>Add<a id="_idIndexMarker878"/> both files to the manifest of the add-on, as shown in the <span class="No-Break">following example:</span><pre class="source-code">
<strong class="bold">...</strong>
<strong class="bold">"depends": ["base"],</strong>
<strong class="bold">    "data": [</strong>
<strong class="bold">        "security/hostel_security.xml",</strong>
<strong class="bold">        "security/ir.model.access.csv",</strong>
<strong class="bold">        "data/room_stages.xml",</strong>
<strong class="bold">        "views/hostel.xml",</strong>
<strong class="bold">        "views/hostel_amenities.xml",</strong>
<strong class="bold">        "views/hostel_room.xml",</strong>
<strong class="bold">        "views/hostel_room_stages_views.xml",</strong>
<strong class="bold">        "views/hostel_student.xml",</strong>
<strong class="bold">        "views/hostel_categ.xml",</strong>
<strong class="bold">        "reports/hostel_room_detail_report_template.xml",</strong>
<strong class="bold">        "reports/hostel_room_detail_report.xml",</strong>
<strong class="bold">    ],</strong></pre></li>			</ol>
			<p>Now, when opening the room form view, or when selecting students in the list view, you should be offered the option to print the rooms detail report in a drop-down menu, as shown in the<a id="_idIndexMarker879"/> <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer104" class="IMG---Figure">
					<img src="image/B20997_12_15.jpg" alt="Figure 12.15 – Print action for report"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.15 – Print action for report</p>
			<h2 id="_idParaDest-598"><a id="_idTextAnchor679"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we added a <strong class="source-inline">one2many</strong> <strong class="source-inline">hostel_student_ids</strong> field. This field will contain rooms records for the student. We will use it in the QWeb report to list the rooms that the student <span class="No-Break">has reserved.</span></p>
			<p>In <em class="italic">Step 2</em>, we defined the QWeb template. The content of the template will be used to generate the PDF. In our example, we used some basic HTML structure. We also used some attributes such as <strong class="source-inline">t-esc</strong> and <strong class="source-inline">t-foreach</strong>, which are used to generate dynamic content in the report. Don’t worry about this syntax within the <strong class="source-inline">template</strong> element for now. This topic will be addressed extensively in the <em class="italic">Creating or modifying templates – QWeb</em> recipe in <a href="B20997_14.xhtml#_idTextAnchor734"><span class="No-Break"><em class="italic">Chapter 14</em></span></a>, <em class="italic">CMS Website Development</em>. Another important thing to notice in the template is the layout. In our example, we have used <strong class="source-inline">web.internal_layout</strong> in our template, which will generate the final PDF with a minimal header and footer. If you want an informative header and footer that uses the company logo and company information, use the <strong class="source-inline">web.external_layout</strong> layout. We also added one <strong class="source-inline">for</strong> loop to the <strong class="source-inline">docs</strong> parameter that will be used to generate a report for multiple records when the user prints it from the <span class="No-Break">list view.</span></p>
			<p>In <em class="italic">Step 3</em>, we <a id="_idIndexMarker880"/>declared the report in another XML file via the <strong class="source-inline">&lt;record&gt;</strong> tag. It will register the report’s <strong class="source-inline">ir.actions.report</strong> model. The crucial part here is that you set the <strong class="source-inline">report_name</strong> field to the complete XML ID (that is, <strong class="source-inline">modulename.record_id</strong>) of the template you defined; otherwise, the report generation process will fail. The <strong class="source-inline">model</strong> field determines which type of record the report operates, and the <strong class="source-inline">name</strong> field is the name shown to the user in the <span class="No-Break">print menu.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">In previous versions of Odoo, a <strong class="source-inline">&lt;report&gt;</strong> tag was used to register a report. But from version v14, it is deprecated and you need to create a record of <strong class="source-inline">ir.actions.report</strong> with the <strong class="source-inline">&lt;record&gt;</strong> tag. The <strong class="source-inline">&lt;report&gt;</strong> tag is still supported in Odoo v14 for backward compatibility but using it will show a warning in <span class="No-Break">the log.</span></p>
			<p>By setting <strong class="source-inline">report_type</strong> to <strong class="source-inline">qweb-pdf</strong>, we requested that the HTML generated by our view is run through <strong class="source-inline">wkhtmltopdf</strong>  to deliver a PDF to the user. In some cases, you may want to use <strong class="source-inline">qweb-html</strong> to render the HTML within <span class="No-Break">the browser.</span></p>
			<h2 id="_idParaDest-599"><a id="_idTextAnchor680"/>There’s more...</h2>
			<p>There are some marker classes in a report’s HTML that are crucial for the layout. Ensure that you wrap all your content in an element with the <strong class="source-inline">page</strong> class set. If you forget that, you’ll see nothing at all. To add a header or footer to your record, use the <strong class="source-inline">header</strong> or <span class="No-Break"><strong class="source-inline">footer</strong></span><span class="No-Break"> class.</span></p>
			<p>Also, remember that this is HTML, so make use of <em class="italic">CSS attributes</em> such as <strong class="source-inline">page-break-before</strong>, <strong class="source-inline">page-break-after</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">page-break-inside</strong></span><span class="No-Break">.</span></p>
			<p>You’ll have noted that all of our template body is wrapped in two elements with the <strong class="source-inline">t-call</strong> attribute set. We’ll examine the mechanics of this attribute later in <a href="B20997_14.xhtml#_idTextAnchor734"><span class="No-Break"><em class="italic">Chapter 14</em></span></a>, <em class="italic">CMS Website Development</em>, but you must do the same in your reports. These elements ensure that the HTML generates links to all the necessary CSS files and contains some other data that is needed for report generation. While <strong class="source-inline">web.html_container</strong> doesn’t have an alternative, the second <strong class="source-inline">t-call</strong> can be <strong class="source-inline">web.external_layout</strong>. The difference is that the external layout already comes with a header and footer displaying the company logo, the company’s name, and some other<a id="_idIndexMarker881"/> information you expect from a company’s external communication, while the internal layout just gives you a header with pagination, the print date, and the company’s name. For the sake of consistency, always use one of <span class="No-Break">the two.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Note that <strong class="source-inline">web.internal_layout</strong>, <strong class="source-inline">web.external_layout</strong>, <strong class="source-inline">web.external_layout_header</strong>, and <strong class="source-inline">web.external_layout_footer</strong> (the last two are called by the external layout) are just views by themselves, and you already know how to change them via inheritance. To inherit with the template element, use the <span class="No-Break"><strong class="source-inline">inherit_id</strong></span><span class="No-Break"> attribute.</span></p>
			<h1 id="_idParaDest-600"><a id="_idTextAnchor681"/>Managing activities from a Kanban card</h1>
			<p>Odoo uses activities<a id="_idIndexMarker882"/> to schedule actions on records. These <a id="_idIndexMarker883"/>activities can be managed in the form view and the Kanban view. In this recipe, we will learn how to manage activities from the Kanban view card. We will add an activity widget to the cards of the <span class="No-Break">rooms Kanban.</span></p>
			<h2 id="_idParaDest-601"><a id="_idTextAnchor682"/>Getting started</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-602"><a id="_idTextAnchor683"/>How to do it...</h2>
			<p>Follow these steps to add and manage activity from the <span class="No-Break">Kanban view:</span></p>
			<ol>
				<li>Add mail dependencies to the <span class="No-Break"><strong class="source-inline">manifest</strong></span><span class="No-Break"> file:</span><pre class="source-code">
'depends': ['base', 'mail'],</pre></li>				<li>Inherit an activity mixin in the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span><pre class="source-code">
<strong class="bold">class HostelRoom(models.Model):</strong>
<strong class="bold">    _name = "hostel.room"</strong>
<strong class="bold">    _description = "Hostel Room Information"</strong>
<strong class="bold">    _rec_name = "room_no"</strong>
<strong class="bold">    _inherit = ['mail.thread', 'mail.activity.mixin']</strong></pre></li>				<li>Add<a id="_idIndexMarker884"/> the <strong class="source-inline">activity_state</strong> field to the <a id="_idIndexMarker885"/>Kanban view under the <span class="No-Break"><strong class="source-inline">color</strong></span><span class="No-Break"> field:</span><pre class="source-code">
<strong class="bold">&lt;field name="color" /&gt;</strong>
<strong class="bold">&lt;field name="activity_state"/&gt;</strong></pre></li>				<li>Add the <strong class="source-inline">activity_ids</strong> field inside the Kanban template. Add this field under the <strong class="source-inline">popularity</strong> field, as <span class="No-Break">shown here:</span><pre class="source-code">
<strong class="bold">&lt;div&gt;</strong>
<strong class="bold">    &lt;field name="popularity" widget="priority"/&gt;</strong>
<strong class="bold">&lt;/div&gt;</strong>
<strong class="bold">&lt;div&gt;</strong>
<strong class="bold">    &lt;field name="activity_ids" widget="kanban_activity"/&gt;</strong>
<strong class="bold">&lt;/div&gt;</strong></pre><p class="list-inset">Update the <strong class="source-inline">my_hostel</strong> module to apply the change. Open the <strong class="bold">Rooms</strong> Kanban view; you will see the activity manager on the Kanban card, as shown in the <span class="No-Break">following screenshot:</span></p></li>			</ol>
			<div>
				<div id="_idContainer105" class="IMG---Figure">
					<img src="image/B20997_12_16.jpg" alt="Figure 12.16 – Activity manager in a Kanban card"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.16 – Activity manager in a Kanban card</p>
			<p>As you <a id="_idIndexMarker886"/>can see, after applying the code from this recipe, you<a id="_idIndexMarker887"/> will be able to manage activity from a Kanban card. You can now also process or create an activity from a <span class="No-Break">Kanban card.</span></p>
			<h2 id="_idParaDest-603"><a id="_idTextAnchor684"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we added a dependency to the manifest of our module. We did this because all the implementation associated with the activity is part of the <strong class="source-inline">mail</strong> module. Without installing <strong class="source-inline">mail</strong>, we cannot use activities in <span class="No-Break">our model.</span></p>
			<p>In <em class="italic">Step 2</em>, we added <strong class="source-inline">activity mixin</strong> to the <strong class="source-inline">hostel.room</strong> model. This will enable activities for the rooms records. Adding <strong class="source-inline">mail.activity.mixin</strong> will add all the fields and methods required for activities. We also added the <strong class="source-inline">mail.thread</strong> mixin because the activity logs the message when the user processes the activity. If you want to learn more about this activity, please refer to the <em class="italic">Managing activities on documents</em> recipe of <a href="B20997_23.xhtml#_idTextAnchor1210"><span class="No-Break"><em class="italic">Chapter 23</em></span></a>, <em class="italic">Managing Emails </em><span class="No-Break"><em class="italic">in Odoo</em></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Step 3</em>, we added the <strong class="source-inline">activity_state</strong> field to the Kanban view. This field is used by the activity widget to display the color widget. The color will represent the current state of the <span class="No-Break">upcoming activity.</span></p>
			<p>In <em class="italic">Step 4</em>, we added the activity widget itself. It uses the <strong class="source-inline">activity_ids</strong> field. In our example, we added the activity widget in a separate <strong class="source-inline">&lt;div&gt;</strong> tag, but you can put it anywhere according to your design requirements. With the activity widget, you can schedule, edit, and process the activity directly from the <span class="No-Break">Kanban card.</span></p>
			<h2 id="_idParaDest-604"><a id="_idTextAnchor685"/>There’s more…</h2>
			<p>In the <em class="italic">Adding a progress bar in Kanban views</em> recipe of this chapter, we displayed a Kanban <a id="_idIndexMarker888"/>progress bar based on the <strong class="source-inline">popularity</strong> field. But <a id="_idIndexMarker889"/>we can also show a progress bar based on the state of the <span class="No-Break">upcoming activity:</span></p>
			<pre class="source-code">
&lt;progressbar field="activity_state"
    colors='{"planned": "success",
             "today": "warning",
             "overdue": "danger"}'/&gt;</pre>			<p>This will show the progress bar based on the state of the upcoming activity. A state-based progress bar is used in several views <span class="No-Break">in Odoo.</span></p>
			<h2 id="_idParaDest-605"><a id="_idTextAnchor686"/>See also</h2>
			<ul>
				<li>If you want to learn more about the mail thread, refer to the <em class="italic">Managing chatter on documents</em> recipe of <a href="B20997_23.xhtml#_idTextAnchor1210"><span class="No-Break"><em class="italic">Chapter 23</em></span></a>, <em class="italic">Managing Emails </em><span class="No-Break"><em class="italic">in Odoo</em></span><span class="No-Break">.</span></li>
				<li>If you want to learn more about activities, refer to the <em class="italic">Managing activities on documents</em> recipe of <a href="B20997_23.xhtml#_idTextAnchor1210"><span class="No-Break"><em class="italic">Chapter 23</em></span></a>, <em class="italic">Managing Emails </em><span class="No-Break"><em class="italic">in Odoo</em></span><span class="No-Break">.</span></li>
			</ul>
			<h1 id="_idParaDest-606"><a id="_idTextAnchor687"/>Adding a stat button to a form view</h1>
			<p>Odoo uses<a id="_idIndexMarker890"/> a stat button to relate two different objects visually on the form view. It is used to show some basic KPIs for related records. It is also used to <a id="_idIndexMarker891"/>redirect and open another view. In this recipe, we will add a stat button to the form view of a room. This stat button will display the count of room records and on clicking it, we will be redirected to the list of <span class="No-Break">Kanban views.</span></p>
			<h2 id="_idParaDest-607"><a id="_idTextAnchor688"/>Getting started</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-608"><a id="_idTextAnchor689"/>How to do it...</h2>
			<p>Follow these <a id="_idIndexMarker892"/>steps to add a stat button to the hostel’s<a id="_idIndexMarker893"/> <span class="No-Break">form view:</span></p>
			<ol>
				<li>Add the <strong class="source-inline">rooms_count</strong> compute field to the <strong class="source-inline">hostel.hostel</strong> model. This field will count the number of active rooms in <span class="No-Break">the hostel:</span><pre class="source-code">
<strong class="bold">rooms_count = fields.Integer(compute="_compute_rooms_count")</strong>
<strong class="bold">def _compute_rooms_count(self):</strong>
<strong class="bold">        room_obj = self.env['hostel.room']</strong>
<strong class="bold">        for hostel in self:</strong>
<strong class="bold">            hostel.rooms_count = room_obj.search_count([('hostel_id', '=', hostel.id)])</strong></pre></li>				<li>Add a stat button to the form view of the <strong class="source-inline">hostel.hostel</strong> model. Prepend it just inside the <strong class="source-inline">&lt;</strong><span class="No-Break"><strong class="source-inline">sheet&gt;</strong></span><span class="No-Break"> tag:</span><pre class="source-code">
<strong class="bold">&lt;div class="oe_button_box" name="button_box"&gt;</strong>
<strong class="bold">    &lt;button class="oe_stat_button" name="%(action_hostel_room)d" type="action" icon="fa-building" context="{'search_default_hostel_id': active_id}"&gt;</strong>
<strong class="bold">        &lt;field string="Rooms" name="rooms_count" widget="statinfo"/&gt;</strong>
<strong class="bold">    &lt;/button&gt;</strong>
<strong class="bold">&lt;/div&gt;</strong></pre><p class="list-inset">Update the <strong class="source-inline">my_hostel</strong> module to apply the changes. Open the form view of any hostel; you will find the stat button, as shown in the <span class="No-Break">following screenshot:</span></p></li>			</ol>
			<div>
				<div id="_idContainer106" class="IMG---Figure">
					<img src="image/B20997_12_17.jpg" alt="Figure 12.17 – Stat button in a hostel’s form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.17 – Stat button in a hostel’s form view</p>
			<p>On clicking<a id="_idIndexMarker894"/> the stat button, you will be redirected<a id="_idIndexMarker895"/> to the <strong class="bold">Rooms</strong> Kanban view. Here, you will see orders only from the <span class="No-Break">current hostel.</span></p>
			<h2 id="_idParaDest-609"><a id="_idTextAnchor690"/>How it works...</h2>
			<p>In <em class="italic">Step 1</em>, we added a compute field that calculates the number of rooms records for the current hostel. The value of this field will be used for a stat button to show the count. If you want to learn more about compute, refer to the <em class="italic">Adding computed fields to a model</em> recipe in <a href="B20997_04.xhtml#_idTextAnchor118"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <span class="No-Break"><em class="italic">Application Models</em></span><span class="No-Break">.</span></p>
			<p>In <em class="italic">Step 2</em>, we added the stat button in the form view of the <strong class="source-inline">hostel.hostel</strong> model. There are a specific syntax and location for the stat button. All the stat button needs to do is wrap under <strong class="source-inline">&lt;div&gt;</strong> with the <strong class="source-inline">oe_button_box</strong> class. The stat button box needs to be placed inside the <strong class="source-inline">&lt;sheet&gt;</strong> tag. Note that we used a <strong class="source-inline">name</strong> attribute on the button box. This <strong class="source-inline">name</strong> attribute is useful when you want to add a new stat, but then you will need to add a stat button with the <strong class="source-inline">&lt;button&gt;</strong> tag with the <strong class="source-inline">oe_stat_button</strong> class. Internally, the stat button is just a form view button with a different user interface. This means it supports all of the attributes that are supported by a normal button, such as an action, icon, <span class="No-Break">and context.</span></p>
			<p>In our example, we used the action of rooms orders, which means that when the user clicks on the stat button, they will be redirected to the rooms records but it will show all the rooms records. We only want to show the rooms records for the current room. To do so, we have to pass <strong class="source-inline">search_default_hostel_id</strong>. This will apply a default filter for the current room. Note that <strong class="source-inline">hostel_id</strong> is the <strong class="source-inline">many2one</strong> field on the <strong class="source-inline">hostel.room</strong> model. If you want to filter by another field, use it by prefixing it with <strong class="source-inline">search_default_</strong> <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">context</strong></span><span class="No-Break">.</span></p>
			<p>Stat buttons <a id="_idIndexMarker896"/>are used often as they are very useful and show the<a id="_idIndexMarker897"/> overall statistics related to a record. You could use them to show all the information that relates to the current record. For example, on the contact record, Odoo shows stat buttons that show information related to the current contact total of the invoice, the number of leads, the number of orders, and <span class="No-Break">so on.</span></p>
			<h2 id="_idParaDest-610"><a id="_idTextAnchor691"/>See also</h2>
			<ul>
				<li>To learn more about buttons, refer to the <em class="italic">Adding buttons to forms</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></li>
				<li>To learn more about actions, refer to the <em class="italic">Adding a menu item and window action</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></li>
			</ul>
			<h1 id="_idParaDest-611"><a id="_idTextAnchor692"/>Enabling the archive option for records</h1>
			<p>Odoo provides<a id="_idIndexMarker898"/> inbuilt features to enable archive and <a id="_idIndexMarker899"/>unarchive options for records. This will help the user hide records that are no longer important. In this recipe, we will add an archive/unarchive option for a room. We can archive a room once it is <span class="No-Break">not available.</span></p>
			<h2 id="_idParaDest-612"><a id="_idTextAnchor693"/>Getting started</h2>
			<p>For this recipe, we will be using the <strong class="source-inline">my_hostel</strong> module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-613"><a id="_idTextAnchor694"/>How to do it...</h2>
			<p>Archive and unarchive mostly work automatically. The options are available on a record if the model <a id="_idIndexMarker900"/>has a Boolean field named <strong class="source-inline">active</strong>. We already have an <strong class="source-inline">active</strong> field in the <strong class="source-inline">hostel.room</strong> model. But if you have not added it, follow these steps to add the <span class="No-Break"><strong class="source-inline">active</strong></span><span class="No-Break"> field:</span></p>
			<ol>
				<li>Add an <strong class="source-inline">active</strong> Boolean field to the <strong class="source-inline">hostel.room</strong> model, <span class="No-Break">like this:</span><pre class="source-code">
<strong class="bold">active = fields.Boolean(default=True)</strong></pre></li>				<li>Add an <strong class="source-inline">active</strong> field to the <span class="No-Break">form view:</span><pre class="source-code">
<strong class="bold">&lt;field name="active" invisible="1"/&gt;</strong></pre></li>			</ol>
			<p>Update<a id="_idIndexMarker901"/> the <strong class="source-inline">my_hostel</strong> module to apply the changes. Now, you will be able to archive rooms. The <strong class="bold">Archive</strong> option is available in the <strong class="bold">Action</strong> dropdown, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer107" class="IMG---Figure">
					<img src="image/B20997_12_18.jpg" alt="Figure 12.18 – Archive option on the form view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.18 – Archive option on the form view</p>
			<p>Once you archive a record, you’ll want to see that record anywhere in Odoo. To see it, you need to apply a filter from the <span class="No-Break">search view.</span></p>
			<h2 id="_idParaDest-614"><a id="_idTextAnchor695"/>How it works...</h2>
			<p>A Boolean <a id="_idIndexMarker902"/>field named <strong class="source-inline">active</strong> has a special purpose in Odoo. If you add an <strong class="source-inline">active</strong> field to your model, records with a <strong class="source-inline">false</strong> value in the <strong class="source-inline">active</strong> field won’t be displayed anywhere <span class="No-Break">in Odoo.</span></p>
			<p>In <em class="italic">Step 1</em>, we added an <strong class="source-inline">active</strong> field to the <strong class="source-inline">hostel.room</strong> model. Note that we kept the default value of <strong class="source-inline">True</strong> here. If we don’t add this default value, the new records will be created in archive mode by default and won’t be displayed in views, even if we have recently <span class="No-Break">created them.</span></p>
			<p>In <em class="italic">Step 2</em>, we <a id="_idIndexMarker903"/>added the <strong class="source-inline">active</strong> field in the form view. If you don’t add an <strong class="source-inline">active</strong> field in the form view, the archive/unarchive option won’t be displayed in the <strong class="bold">Action</strong> drop-down menu. If you don’t want to show the field in the form view, you can use the <strong class="source-inline">invisible</strong> attribute to hide it from the <span class="No-Break">form view.</span></p>
			<p>In our example, once you archive a room, that room will not be displayed in the tree view or any other view. The room won’t even be displayed in the <strong class="source-inline">many2one</strong> dropdown in the hostel record. If you want to unarchive that room, then you need to apply a filter to display archived records from the search view, and then restore <span class="No-Break">the room.</span></p>
			<h2 id="_idParaDest-615"><a id="_idTextAnchor696"/>There’s more…</h2>
			<p>If your model has an <strong class="source-inline">active</strong> Boolean field, the <strong class="source-inline">search</strong> method will not return an archived record. If you want to search all the records, whether they are archived or not, then pass <strong class="source-inline">active_test</strong> in a context, <span class="No-Break">like this:</span></p>
			<pre class="console">
self.env['hostel.room'].with_context(active_test=False).search([])</pre>			<p>Note that if the archive record is linked to another record, it will be displayed in the related form view. For example, say you have <em class="italic">Room 1</em>. Then, you archive <em class="italic">Room 1</em>, which means from now on, you cannot select <em class="italic">Room 1</em> in the room. But if you open <em class="italic">Order 1</em>, you will see the archived <span class="No-Break"><em class="italic">Room 1</em></span><span class="No-Break">.</span></p>
		</div>
	</body></html>