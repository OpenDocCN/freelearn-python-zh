<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Django in PTVS"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Django in PTVS</h1></div></div></div><p>Django is a high-level Python Web framework based on the <span class="strong"><strong>Model View Controller</strong></span> (<span class="strong"><strong>MVC</strong></span>) pattern; it provides a series of tools and helpers to create a rapid development environment for the Web. There are plenty of successful websites that are based on Django, such as Instagram, Pinterest, Disqus, and some parts of Dropbox. It has been in development since 2006, making it a rock-solid choice for web projects, especially when using Python<a id="id120" class="indexterm"/> as the language of choice. For more information about Django, refer to its official project website at <a class="ulink" href="https://www.djangoproject.com/">https://www.djangoproject.com/</a>.</p><p>In this chapter, we will go deeper into Django framework integration in Visual Studio. We will see how to start a Django project, taking advantage of Visual Studio tools and setting up the development environment for it.</p><p>Once we have a basic working website, we will learn how to create a connection to the database and set up the admin interface to create a new Django application within Visual Studio.</p><div class="section" title="Django project template and tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec23"/>Django project template and tools</h1></div></div></div><p>Let's take <a id="id121" class="indexterm"/>a look at Django-related tools and templates available in PTVS, starting with the Django project template. Project templates in Visual Studio are boilerplate helpers that create a project's outline based on the specific type of the project. To start a new Django project, open the <span class="strong"><strong>New Project</strong></span> window under the <span class="strong"><strong>File</strong></span> menu. Once it's open, select <span class="strong"><strong>Python</strong></span> from the list on the left-hand side. This displays the installed project types available in the system. Here is what the window looks like:</p><div class="mediaobject"><img src="graphics/8687OS_04_01.jpg" alt="Django project template and tools"/></div><p>Click<a id="id122" class="indexterm"/> on the <span class="strong"><strong>Django Project</strong></span> option in the right-hand panel to define the project name in the bottom of the window. We perform this action while specifying where the file should be saved. You can also define the solution name for the Visual Studio solution for the project. Once these properties are defined, clicking on <span class="strong"><strong>OK</strong></span> creates the Django project.</p><div class="mediaobject"><img src="graphics/8687OS_04_02.jpg" alt="Django project template and tools"/><div class="caption"><p>Example default Django project structure shown in Solution Explorer</p></div></div><div class="section" title="Installing a Python package"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec14"/>Installing a Python package</h2></div></div></div><p>The basic<a id="id123" class="indexterm"/> Django project file structure is shown in the <span class="strong"><strong>Solution Explorer</strong></span> window. With the project structure in place, the next step is to install the Python package required. We have to instruct our solution about either the Django framework's whereabouts or the location where we need to install it. To begin, add a Python interpreter to the project—we are going to use Python 2.7—then install the Django packages by right-clicking on the installed <span class="strong"><strong>Python</strong></span> entry in the <span class="strong"><strong>Python Environments</strong></span> node of the <span class="strong"><strong>Solution Explorer</strong></span> window, and finally select the <span class="strong"><strong>Install Python Package</strong></span> entry:</p><div class="mediaobject"><img src="graphics/8687OS_04_04.jpg" alt="Installing a Python package"/></div><p>The <span class="strong"><strong>Install Python Package</strong></span> window will open; here, insert the name of the <code class="literal">pip</code> Python package that is required to start referencing the framework in our environment, which is <code class="literal">django</code>. You can even choose a specific version of the framework by naming the version of the package in the <code class="literal">django==x.x.x</code> format. The <code class="literal">x.x.x</code> indicates the complete version label. If no version number is supplied, the latest available version of the package will be installed.</p><div class="mediaobject"><img src="graphics/8687OS_04_03.jpg" alt="Installing a Python package"/></div><p>Click <a id="id124" class="indexterm"/>on <span class="strong"><strong>OK</strong></span> to begin the Django package installation by downloading it from the <code class="literal">pip</code> repository. Make sure to check your system settings on the system agreement to give Visual Studio the privileges of a system administrator.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>The <span class="strong"><strong>Run as Administrator</strong></span> checkbox should only be checked when the previous installation has failed. It ensures that <code class="literal">pip</code> has the necessary privileges on the system to install the package.</p></div></div><div class="mediaobject"><img src="graphics/8687OS_04_05.jpg" alt="Installing a Python package"/></div><p>The installation process can be viewed in the output window as shown in preceding screenshot. If you are using <span class="strong"><strong>Run as Administrator</strong></span>, the real-time download progress is not available. In this scenario, <span class="strong"><strong>Installing 'django'</strong></span> is displayed in the output window for a period of time, as this indicates that <code class="literal">pip</code> is still downloading.</p><div class="mediaobject"><img src="graphics/8687OS_04_06.jpg" alt="Installing a Python package"/></div><p>Once<a id="id125" class="indexterm"/> the downloading process finishes, a more detailed view is available as shown in preceding screenshot. It'll keep you informed about the installation process and whether it is successful. If everything happens without a hitch, a <span class="strong"><strong>'django' was installed successfully</strong></span> message is shown at the end of the <code class="literal">pip</code> log in the <span class="strong"><strong>Output</strong></span> window.</p></div><div class="section" title="Running the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec15"/>Running the application</h2></div></div></div><p>Now that<a id="id126" class="indexterm"/> the Django framework is successfully installed in the system and is referenced in the project, let's make sure it works and all the workflows are running correctly. Run the application by pressing <span class="emphasis"><em>F5</em></span> or by clicking on the <span class="strong"><strong>Run</strong></span> icon in the toolbar. Since Visual Studio understands that the current project is a website, it will run the output in a browser instance. You can see the <span class="strong"><strong>Run</strong></span> button<a id="id127" class="indexterm"/> followed by the name of the default system browser that will be started. It's possible to select the browser in which we'll run the project by clicking on the drop-down button that shows all possible choices:</p><div class="mediaobject"><img src="graphics/8687OS_04_07.jpg" alt="Running the application"/></div><p>The <a id="id128" class="indexterm"/>following two things happen when you run the application:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">PTVS <a id="id129" class="indexterm"/>runs the Django <code class="literal">manage.py</code> command</li><li class="listitem" style="list-style-type: disc">A browser instance with the output of the website is shown</li></ul></div><p>The first one is shown in a command-prompt window that informs us about the result of the execution. It indicates whether there was any problem in the settings. It is the equivalent of launching the <code class="literal">python manage.py runserver</code> command<a id="id130" class="indexterm"/> from the command line.</p><div class="mediaobject"><img src="graphics/8687OS_04_08.jpg" alt="Running the application"/></div><p>At the<a id="id131" class="indexterm"/> same time, a new instance of the browser is created with our website's home page. In a new classical Django installation, you will see the following <span class="strong"><strong>It worked!</strong></span> page:</p><div class="mediaobject"><img src="graphics/8687OS_04_09.jpg" alt="Running the application"/></div><p>If you're able to see the preceding screen, it means that the setup of the Django project has been<a id="id132" class="indexterm"/> successfully completed. Now we can continue with the development of the website.</p></div><div class="section" title="IntelliSense in Django templates"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec16"/>IntelliSense in Django templates</h2></div></div></div><p>We have<a id="id133" class="indexterm"/> already talked about the power of IntelliSense in Visual Studio in Python code. IntelliSense supports even the Django template editor, providing it with access to all the template tags of Django; it also provides access to the context defined by the calling view.</p><p>IntelliSense offers help with the HTML part as follows:</p><div class="mediaobject"><img src="graphics/8687OS_04_10.jpg" alt="IntelliSense in Django templates"/></div><p>Additionally, when in a Django block tag, <code class="literal">("{% … %}")</code>, it shows Django-specific tags and view context objects. IntelliSense also helps with filters:</p><div class="mediaobject"><img src="graphics/8687OS_04_11.jpg" alt="IntelliSense in Django templates"/></div></div></div></div>
<div class="section" title="Setting up and managing a database for a Django project"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Setting up and managing a database for a Django project</h1></div></div></div><p>Once a <a id="id134" class="indexterm"/>working <a id="id135" class="indexterm"/>Django<a id="id136" class="indexterm"/> project<a id="id137" class="indexterm"/> is set up, we will need to attach a database in order to have a place to store the website data and the overall configuration of the Django admin console. For the purpose of this book, we are going to use a SQLite database, which is easy to manage, to connect to the project. It's a file-based database and can be easily managed by Django. For more information on SQLite, refer to its website<a id="id138" class="indexterm"/> at <a class="ulink" href="http://www.sqlite.org/">http://www.sqlite.org/</a>.</p><p>Attaching a database to Django is really easy. You just have to tell Django which database to use and how to connect to it. This has to be done in the Django <code class="literal">settings.py</code> file. To connect to and create a SQLite database, the database section of code should look like the following:</p><div class="mediaobject"><img src="graphics/8687OS_04_12.jpg" alt="Setting up and managing a database for a Django project"/></div><p>Since SQLite is a file-based database, the <code class="literal">Name</code> property should be the path of the database file. We <a id="id139" class="indexterm"/>are using a constant that contains the project's root path, <code class="literal">Project_Root</code>, which has to be defined first with the following two lines of code:</p><div class="mediaobject"><img src="graphics/8687OS_04_13.jpg" alt="Setting up and managing a database for a Django project"/></div><p>The <a id="id140" class="indexterm"/>database is now connected to the Django <a id="id141" class="indexterm"/>project. To create the configuration<a id="id142" class="indexterm"/> tables in the database, use the Django<a id="id143" class="indexterm"/> sync DB command. Visual Studio provides a command, which starts this process from inside the IDE. To access the <code class="literal">sync</code> command<a id="id144" class="indexterm"/>, right-click on the project node of the <span class="strong"><strong>Solution Explorer</strong></span> window and select the <span class="strong"><strong>Django Sync DB</strong></span> entry to start the process:</p><div class="mediaobject"><img src="graphics/8687OS_04_14.jpg" alt="Setting up and managing a database for a Django project"/></div><p>Once you click on <span class="strong"><strong>Django Sync DB</strong></span>, the synchronizing starts. The <span class="strong"><strong>Django Management Console</strong></span> option displays a detailed log of activities as follows:</p><div class="mediaobject"><img src="graphics/8687OS_04_15.jpg" alt="Setting up and managing a database for a Django project"/></div><p>When<a id="id145" class="indexterm"/> the command is first executed, Django <a id="id146" class="indexterm"/>creates<a id="id147" class="indexterm"/> the actual database and also the authentication entries to be used<a id="id148" class="indexterm"/> for the Django administration console. The preferred username and password are asked to be entered. Once the information is provided, the process ends with the database created.</p><p>We can also see the result of the process in the <span class="strong"><strong>Solution Explorer</strong></span> window since we have instructed Django to use SQLite and indicated the location to create the database file. To view this information, enable the <span class="strong"><strong>View all files</strong></span> option in the solution folder by clicking on the <span class="strong"><strong>View all files</strong></span> command<a id="id149" class="indexterm"/> in the <span class="strong"><strong>Solution Explorer</strong></span> toolbar.</p><div class="mediaobject"><img src="graphics/8687OS_04_16.jpg" alt="Setting up and managing a database for a Django project"/><div class="caption"><p>Find the "View all files" option in the toolbar</p></div></div><p>Once<a id="id150" class="indexterm"/> the <a id="id151" class="indexterm"/>view<a id="id152" class="indexterm"/> is active, the file <code class="literal">db.sqlite3</code> can <a id="id153" class="indexterm"/>be found in the solution folder. It can be included in the solution files by right-clicking on it and selecting the <span class="strong"><strong>Include in Project</strong></span> command<a id="id154" class="indexterm"/>. The SQLite file is then included in the list of files that are managed by Visual Studio.</p><div class="mediaobject"><img src="graphics/8687OS_04_17.jpg" alt="Setting up and managing a database for a Django project"/></div></div>
<div class="section" title="Setting up the admin interface"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Setting up the admin interface</h1></div></div></div><p>Now<a id="id155" class="indexterm"/> that a database is attached to the project, we can activate the administration interface of Django in it. The process is really simple at this point; you just need to uncomment a couple of lines of code in the project settings file and the main URL manager.</p><p>First, activate the Django application <code class="literal">django.contrib.admin</code> in the <code class="literal">Installed_Apps</code> section of the settings file:</p><div class="mediaobject"><img src="graphics/8687OS_04_18.jpg" alt="Setting up the admin interface"/></div><p>Second, go to the <code class="literal">urls.py</code> file and uncomment the section that imports the <code class="literal">admin</code> class and that enables the admin's discovery of the models inside the project. Besides this, it is also necessary that we uncomment the last line of the URL pattern that manages the <code class="literal">/admin/</code> path:</p><div class="mediaobject"><img src="graphics/8687OS_04_19.jpg" alt="Setting up the admin interface"/></div><p>Now the <a id="id156" class="indexterm"/>Django administration application is activated in the project. If the operation is successful, you will be presented with the admin login page. After launching the application, navigate to the <code class="literal">/admin/</code> page:</p><div class="mediaobject"><img src="graphics/8687OS_04_20.jpg" alt="Setting up the admin interface"/></div><p>Insert the credentials created during the database setup to access the administration section:</p><div class="mediaobject"><img src="graphics/8687OS_04_21.jpg" alt="Setting up the admin interface"/></div><p>Now we <a id="id157" class="indexterm"/>have a fully set up and working Django environment. Let's go ahead and create a new Django application in Visual Studio.</p></div>
<div class="section" title="Creating a new Django application"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Creating a new Django application</h1></div></div></div><p>A<a id="id158" class="indexterm"/> Django application is a submodule of the project which is self-contained and not intertwined with other applications. In theory, you could copy it and put it in another project without much, or any, change.</p><p>Typically, to start a Django app, you have to run the <code class="literal">manage.py startapp</code> command in the command line, which will create a new folder in your projectwhere you can find a view, a model, an admin, and a test Python file.</p><p>Visual Studio provides an easy way of creating a new Django app right in the IDE, automating<a id="id159" class="indexterm"/> the whole process; furthermore, the command is also in the process of creating a template folder. To create a new Django application, just right-click on the project node in the <span class="strong"><strong>Solution Explorer</strong></span> window and select <a id="id160" class="indexterm"/>the <span class="strong"><strong>Django app</strong></span> command in the <span class="strong"><strong>Add</strong></span> menu:</p><div class="mediaobject"><img src="graphics/8687OS_04_22.jpg" alt="Creating a new Django application"/></div><p>This opens the <span class="strong"><strong>Add Django App</strong></span> window in which you can assign the name of the Django app to be created:</p><div class="mediaobject"><img src="graphics/8687OS_04_23.jpg" alt="Creating a new Django application"/></div><p>By <a id="id161" class="indexterm"/>clicking on <span class="strong"><strong>OK</strong></span>, the Django app is created in the project, and a list of added files can be found in the <span class="strong"><strong>Solution Explorer</strong></span> window:</p><div class="mediaobject"><img src="graphics/8687OS_04_24.jpg" alt="Creating a new Django application"/></div><p>Now you can create the code for the app as we usually do for Django. Take into account that even if Visual Studio automates the creation of the Django application, it doesn't necessarily create the entry in the settings file. This has to be done manually as usual, adding the reference into the <code class="literal">Installed_Apps</code> section; to do this, just open the main <code class="literal">settings.py</code> file and add the newly created application in the <code class="literal">Installed_Apps</code> section:</p><div class="mediaobject"><img src="graphics/8687OS_04_25.jpg" alt="Creating a new Django application"/></div></div>
<div class="section" title="Deploying a Django project on Microsoft Azure"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Deploying a Django project on Microsoft Azure</h1></div></div></div><p>Cloud<a id="id162" class="indexterm"/> platforms are complex systems<a id="id163" class="indexterm"/> that provide ways to scale web applications across multiple server instances based on the traffic the application is receiving. They also offer an abstraction of the server environment in a way that developers do not need to deal with the hardware and software architecture of the system, but only with the resources and services. This is an advantage because with this in place, the developer does not actually need to configure and manage the server; however, at the same time, it also proves to be a disadvantage, since not all software components are able to work in such systems.</p><p>Azure is a cloud-hosting platform by Microsoft that enables developers to quickly build, deploy, and manage applications across a global network of Microsoft-managed data centers. It is tightly integrated in Visual Studio; also, the Python language is covered by this service.</p><p>We are going to see how to deploy a Django project on Azure by using the tools that Visual Studio provides.</p><p>To use<a id="id164" class="indexterm"/> Microsoft Windows Azure, first we need to create an Azure account via <a class="ulink" href="http://www.windowsazure.com/">http://www.windowsazure.com/</a>.</p><p>After the account is created, you can access the <span class="strong"><strong>Portal</strong></span> section that brings you to your Azure services portal in which you can find all the services available on the left-hand side menu. Now we'll create a website:</p><div class="mediaobject"><img src="graphics/8687OS_04_26.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>To <a id="id165" class="indexterm"/>create<a id="id166" class="indexterm"/> a new website, click on the <span class="strong"><strong>CREATE A WEB SITE</strong></span> link; this will open the <span class="strong"><strong>NEW</strong></span> tab at the bottom of the page:</p><div class="mediaobject"><img src="graphics/8687OS_04_27.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>Just insert the name of the website that you want to create in the <span class="strong"><strong>URL</strong></span> textbox; if the name is available, click on the <span class="strong"><strong>CREATE WEB SITE</strong></span> button to create the website. This will initiate<a id="id167" class="indexterm"/> the website generation process, at the end of which you will see the created website:</p><div class="mediaobject"><img src="graphics/8687OS_04_28.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>Besides <a id="id168" class="indexterm"/>the website service, we also<a id="id169" class="indexterm"/> need to create a storage entry where the website files can be uploaded to. To create a storage entry, click on the <span class="strong"><strong>Storage</strong></span> item on the left-hand side menu and click on <span class="strong"><strong>NEW</strong></span>:</p><div class="mediaobject"><img src="graphics/8687OS_04_29.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>This will open the storage creation area at the bottom of the page:</p><div class="mediaobject"><img src="graphics/8687OS_04_30.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>As for the website service, we just need the name of the storage service in the <span class="strong"><strong>URL</strong></span> textbox; once you have this, click on the <span class="strong"><strong>CREATE STORAGE ACCOUNT</strong></span> button to create<a id="id170" class="indexterm"/> the storage service instance.</p><p>Now we have all the elements needed to deploy our Django project to Azure. However, before going ahead, we need to ensure that our project is ready for it. Azure needs all the files <a id="id171" class="indexterm"/>related to the project that reside in<a id="id172" class="indexterm"/> the project folder, since it needs to ensure that all the Python libraries are present. To ensure that these requirements are met, the Django project needs to be created in a virtual environment. This will keep all the files to be included in the project folder; otherwise, the libraries just reside in the site-packages folder of the system.</p><p>A virtual environment is an isolated working copy of the Python environment, which allows you to work on a specific project without worrying about affecting other projects. At the same time, it keeps together all the dependencies in the same folder structure. Creating a virtual environment is easy in PTVS; you can do this by selecting the <span class="strong"><strong>Add Virtual Environment</strong></span> command<a id="id173" class="indexterm"/> from the <span class="strong"><strong>Python Environments</strong></span> contextual menu, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/8687OS_04_31.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>This<a id="id174" class="indexterm"/> will open the <span class="strong"><strong>Add Virtual Environment</strong></span> window:</p><div class="mediaobject"><img src="graphics/8687OS_04_32.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>Once <a id="id175" class="indexterm"/>you enter the name of the virtual environment and click on the <span class="strong"><strong>Create</strong></span> button, the virtual environment is created in the project. Now, all<a id="id176" class="indexterm"/> the packages that you include in the project will be copied into it, so all the dependencies will be available inside the project folder, which doesn't rely on the system's site-packages folder:</p><div class="mediaobject"><img src="graphics/8687OS_04_33.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>Once we have ensured that our project is contained in a virtual environment, we can go ahead and<a id="id177" class="indexterm"/> configure Visual Studio in a way to be ready to deploy our Django project to Azure.</p><p>The <a id="id178" class="indexterm"/>deployment procedure starts by invoking the <span class="strong"><strong>Publish</strong></span> command<a id="id179" class="indexterm"/> from the contextual menu of the Django website node in the <span class="strong"><strong>Solution Explorer</strong></span> tree view:</p><div class="mediaobject"><img src="graphics/8687OS_04_34.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>This will open the <span class="strong"><strong>Publish Web</strong></span> wizard window, which will guide you through the deployment process of the Django project:</p><div class="mediaobject"><img src="graphics/8687OS_04_35.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>To link <a id="id180" class="indexterm"/>Visual Studio to the Azure<a id="id181" class="indexterm"/> website we created earlier, click on the <span class="strong"><strong>Import</strong></span> button<a id="id182" class="indexterm"/>; once you are certain about being able to log in with your Azure account, select the name of the website you want the Django application to be deployed to:</p><div class="mediaobject"><img src="graphics/8687OS_04_36.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>At this <a id="id183" class="indexterm"/>point, follow the other wizard<a id="id184" class="indexterm"/> entries and click on <span class="strong"><strong>Publish</strong></span>. With this, Visual Studio will start the process of deploying all the files to the Azure platform; you can follow the deployment process from the <span class="strong"><strong>Output</strong></span> window:</p><div class="mediaobject"><img src="graphics/8687OS_04_37.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>Once<a id="id185" class="indexterm"/> the <a id="id186" class="indexterm"/>deployment process finishes, Visual Studio will open in the default browser of the deployed website on Azure:</p><div class="mediaobject"><img src="graphics/8687OS_04_38.jpg" alt="Deploying a Django project on Microsoft Azure"/></div><p>For further<a id="id187" class="indexterm"/> documentation about Python on Windows Azure, refer to the Windows Azure website at <a class="ulink" href="http://www.windowsazure.com/en-us/develop/python/">http://www.windowsazure.com/en-us/develop/python/</a>.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Summary</h1></div></div></div><p>In this chapter, we learned how to create a Django project in Visual Studio and set up the environment. We also learned about deploying a Django project on Microsoft Azure.</p><p>In the next chapter, we are going to learn how to manage Python libraries inside Visual Studio. Also, we'll learn how to use some of the most powerful Python libraries for the Django framework to manage deployments, the synchronization of databases between environments, and a library that helps us use and manage images successfully and dynamically in our website.</p></div></body></html>