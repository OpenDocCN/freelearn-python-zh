["```py\nfrom celery import Celery\n\napp = Celery('tasks', broker='redis://localhost') \n```", "```py\n$ docker run -d -p 6379:6379 redis \n```", "```py\nfrom celery import Celery\n\nimport requests\n\nfrom collections import defaultdict\n\napp = Celery('tasks', broker='redis://localhost')\n\nlogger = app.log.get_default_logger()\n\nBASE_URL = 'https://jsonplaceholder.typicode.com' \n```", "```py\n@app.task\n\ndef obtain_info():\n\n    logger.info('Stating task')\n\n    users = {}\n\n    task_reminders = defaultdict(list)\n\n    # Call the /todos endpoint to retrieve all the tasks\n\n    response = requests.get(f'{BASE_URL}/todos')\n\n    for task in response.json():\n\n        # Skip completed tasks\n\n        if task['completed'] is True:\n\n            continue\n\n        # Retrieve user info. The info is cached to only ask\n\n        # once per user\n\n        user_id = task['userId']\n\n        if user_id not in users:\n\n            users[user_id] = obtain_user_info(user_id)\n\n        info = users[user_id]\n\n        # Append the task information to task_reminders, that\n\n        # aggregates them per user\n\n        task_data = (info, task)\n\n        task_reminders[user_id].append(task_data)\n\n    # The data is ready to process, create an email per\n\n    # each user\n\n    for user_id, reminders in task_reminders.items():\n\n        compose_email(reminders)\n\n    logger.info('End task') \n```", "```py\n response = requests.get(f'{BASE_URL}/todos')\n\n    for task in response.json():\n\n        if task['completed'] is True:\n\n            continue \n```", "```py\n user_id = task['userId']\n\n        if user_id not in users:\n\n            users[user_id] = obtain_user_info(user_id)\n\n        info = users[user_id] \n```", "```py\n task_data = (info, task)\n\n        task_reminders[user_id].append(task_data) \n```", "```py\n for user_id, reminders in task_reminders.items():\n\n        compose_email(reminders) \n```", "```py\ndef obtain_user_info(user_id):\n\n    logger.info(f'Retrieving info for user {user_id}')\n\n    response = requests.get(f'{BASE_URL}/users/{user_id}')\n\n    data = response.json()\n\n    logger.info(f'Info for user {user_id} retrieved')\n\n    return data \n```", "```py\ndef compose_email(remainders):\n\n    # remainders is a list of (user_info, task_info)\n\n    # Retrieve all the titles from each task_info\n\n    titles = [task['title'] for _, task in remainders]\n\n    # Obtain the user_info from the first element\n\n    # The user_info is repeated and the same on each element\n\n    user_info, _ = remainders[0]\n\n    email = user_info['email']\n\n    # Start the task send_email with the proper info\n\n    send_email.delay(email, titles) \n```", "```py\n@app.task\n\ndef send_email(email, remainders):\n\n    logger.info(f'Send an email to {email}')\n\n    logger.info(f'Reminders {remainders}') \n```", "```py\nfrom celery_tasks import obtain_info\n\nobtain_info.delay() \n```", "```py\n$ celery -A celery_tasks worker --loglevel=INFO -c 3 \n```", "```py\n$ celery -A celery_tasks worker --loglevel=INFO -c 3\n\n   v5.1.1 (sun-harmonics)\n\nmacOS-10.15.7-x86_64-i386-64bit 2021-06-22 20:14:09\n\n[config]\n\n.> app:         tasks:0x110b45760\n\n.> transport:   redis://localhost:6379//\n\n.> results:     disabled://\n\n.> concurrency: 3 (prefork)\n\n.> task events: OFF (enable -E to monitor tasks in this worker)\n\n[queues]\n\n.> celery           exchange=celery(direct) key=celery\n\n[tasks]\n\n  . celery_tasks.obtain_info\n\n  . celery_tasks.send_email\n\n[2021-06-22 20:14:09,613: INFO/MainProcess] Connected to redis://localhost:6379//\n\n[2021-06-22 20:14:09,628: INFO/MainProcess] mingle: searching for neighbors\n\n[2021-06-22 20:14:10,666: INFO/MainProcess] mingle: all alone \n```", "```py\n$ python3 start_task.py \n```", "```py\n[2021-06-22 20:30:52,627: INFO/MainProcess] Task celery_tasks.obtain_info[5f6c9441-9dda-40df-b456-91100a92d42c] received\n\n[2021-06-22 20:30:52,632: INFO/ForkPoolWorker-2] Stating task\n\n[2021-06-22 20:30:52,899: INFO/ForkPoolWorker-2] Retrieving info for user 1\n\n...\n\n[2021-06-22 20:30:54,128: INFO/MainProcess] Task celery_tasks.send_email[08b9ed75-0f33-48f8-8b55-1f917cfdeae8] received\n\n[2021-06-22 20:30:54,133: INFO/MainProcess] Task celery_tasks.send_email[d1f6c6a0-a416-4565-b085-6b0a180cad37] received\n\n[2021-06-22 20:30:54,132: INFO/ForkPoolWorker-1] Send an email to Sincere@april.biz\n\n[2021-06-22 20:30:54,134: INFO/ForkPoolWorker-1] Reminders ['delectus aut autem', 'quis ut nam facilis et officia qui', 'fugiat veniam minus', 'laboriosam mollitia et enim quasi adipisci quia provident illum', 'qui ullam ratione quibusdam voluptatem quia omnis', 'illo expedita consequatur quia in', 'molestiae perspiciatis ipsa', 'et doloremque nulla', 'dolorum est consequatur ea mollitia in culpa']\n\n[2021-06-22 20:30:54,135: INFO/ForkPoolWorker-1] Task celery_tasks.send_email[08b9ed75-0f33-48f8-8b55-1f917cfdeae8] succeeded in 0.004046451000021989s: None\n\n[2021-06-22 20:30:54,137: INFO/ForkPoolWorker-3] Send an email to Shanna@melissa.tv\n\n[2021-06-22 20:30:54,181: INFO/ForkPoolWorker-2] Task celery_tasks.obtain_info[5f6c9441-9dda-40df-b456-91100a92d42c] succeeded in 1.5507660419999638s: None\n\n...\n\n[2021-06-22 20:30:54,141: INFO/ForkPoolWorker-3] Task celery_tasks.send_email[d1f6c6a0-a416-4565-b085-6b0a180cad37] succeeded in 0.004405897999959052s: None\n\n[2021-06-22 20:30:54,192: INFO/ForkPoolWorker-2] Task celery_tasks.send_email[aff6dfc9-3e9d-4c2d-9aa0-9f91f2b35f87] succeeded in 0.0012900159999844618s: None \n```", "```py\n[2021-06-22 20:30:52,627: INFO/MainProcess] Task celery_tasks.obtain_info[5f6c9441-9dda-40df-b456-91100a92d42c] received\n\n[2021-06-22 20:30:52,632: INFO/ForkPoolWorker-2] Stating task\n\n[2021-06-22 20:30:52,899: INFO/ForkPoolWorker-2] Retrieving info for user 1\n\n...\n\n[2021-06-22 20:30:54,181: INFO/ForkPoolWorker-2] Task celery_tasks.obtain_info[5f6c9441-9dda-40df-b456-91100a92d42c] succeeded in 1.5507660419999638s: None \n```", "```py\n[2021-06-22 20:30:54,133: INFO/MainProcess] Task celery_tasks.send_email[d1f6c6a0-a416-4565-b085-6b0a180cad37] received\n\n[2021-06-22 20:30:54,132: INFO/ForkPoolWorker-1] Send an email to Sincere@april.biz\n\n[2021-06-22 20:30:54,134: INFO/ForkPoolWorker-1] Reminders ['delectus aut autem', 'quis ut nam facilis et officia qui', 'fugiat veniam minus', 'laboriosam mollitia et enim quasi adipisci quia provident illum', 'qui ullam ratione quibusdam voluptatem quia omnis', 'illo expedita consequatur quia in', 'molestiae perspiciatis ipsa', 'et doloremque nulla', 'dolorum est consequatur ea mollitia in culpa']\n\n[2021-06-22 20:30:54,135: INFO/ForkPoolWorker-1] Task celery_tasks.send_email[08b9ed75-0f33-48f8-8b55-1f917cfdeae8] succeeded in 0.004046451000021989s: None \n```", "```py\nfrom celery import Celery\n\nfrom celery.schedules import crontab\n\napp = Celery('tasks', broker='redis://localhost')\n\nlogger = app.log.get_default_logger()\n\n@app.task\n\ndef scheduled_task(timing):\n\n    logger.info(f'Scheduled task executed {timing}')\n\napp.conf.beat_schedule = {\n\n    # Executes every 15 seconds\n\n    'every-15-seconds': {\n\n        'task': 'celery_scheduled_tasks.scheduled_task',\n\n        'schedule': 15,\n\n        'args': ('every 15 seconds',),\n\n    },\n\n    # Executes following crontab\n\n    'every-2-minutes': {\n\n        'task': 'celery_scheduled_tasks.scheduled_task',\n\n        'schedule': crontab(minute='*/2'),\n\n        'args': ('crontab every 2 minutes',),\n\n    },\n\n} \n```", "```py\n@app.task\n\ndef scheduled_task(timing):\n\n    logger.info(f'Scheduled task executed {timing}') \n```", "```py\napp.conf.beat_schedule = {\n\n    # Executes every 15 seconds\n\n    'every-15-seconds': {\n\n        'task': 'celery_scheduled_tasks.scheduled_task',\n\n        'schedule': 15,\n\n        'args': ('every 15 seconds',),\n\n    }, \n```", "```py\n # Executes following crontab\n\n    'every-2-minutes': {\n\n        'task': 'celery_scheduled_tasks.scheduled_task',\n\n        'schedule': crontab(minute='*/2'),\n\n        'args': ('crontab every 2 minutes',),\n\n    }, \n```", "```py\n$ celery -A celery_scheduled_tasks beat\n\ncelery beat v4.4.7 (cliffs) is starting.\n\n__    -    ... __   -        _\n\nLocalTime -> 2021-06-28 13:53:23\n\nConfiguration ->\n\n    . broker -> redis://localhost:6379//\n\n    . loader -> celery.loaders.app.AppLoader\n\n    . scheduler -> celery.beat.PersistentScheduler\n\n    . db -> celerybeat-schedule\n\n    . logfile -> [stderr]@%WARNING\n\n    . maxinterval -> 5.00 minutes (300s) \n```", "```py\n$ celery -A celery_scheduled_tasks worker --loglevel=INFO -c 3 \n```", "```py\n$ celery -A celery_scheduled_tasks beat\n\ncelery beat v4.4.7 (cliffs) is starting.\n\n__    -    ... __   -        _\n\nLocalTime -> 2021-06-28 15:13:06\n\nConfiguration ->\n\n    . broker -> redis://localhost:6379//\n\n    . loader -> celery.loaders.app.AppLoader\n\n    . scheduler -> celery.beat.PersistentScheduler\n\n    . db -> celerybeat-schedule\n\n    . logfile -> [stderr]@%WARNING\n\n    . maxinterval -> 5.00 minutes (300s) \n```", "```py\n[2021-06-28 15:13:06,504: INFO/MainProcess] Received task: celery_scheduled_tasks.scheduled_task[42ed6155-4978-4c39-b307-852561fdafa8]\n\n[2021-06-28 15:13:06,509: INFO/MainProcess] Received task: celery_scheduled_tasks.scheduled_task[517d38b0-f276-4c42-9738-80ca844b8e77]\n\n[2021-06-28 15:13:06,510: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:06,510: INFO/ForkPoolWorker-1] Scheduled task executed crontab every 2 minutes\n\n[2021-06-28 15:13:06,511: INFO/ForkPoolWorker-2] Task celery_scheduled_tasks.scheduled_task[42ed6155-4978-4c39-b307-852561fdafa8] succeeded in 0.0016690909999965697s: None\n\n[2021-06-28 15:13:06,512: INFO/ForkPoolWorker-1] Task celery_scheduled_tasks.scheduled_task[517d38b0-f276-4c42-9738-80ca844b8e77] succeeded in 0.0014504210000154671s: None\n\n[2021-06-28 15:13:21,486: INFO/MainProcess] Received task: celery_scheduled_tasks.scheduled_task[4d77b138-283c-44c8-a8ce-9183cf0480a7]\n\n[2021-06-28 15:13:21,488: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:21,489: INFO/ForkPoolWorker-2] Task celery_scheduled_tasks.scheduled_task[4d77b138-283c-44c8-a8ce-9183cf0480a7] succeeded in 0.0005252540000242334s: None\n\n[2021-06-28 15:13:36,486: INFO/MainProcess] Received task: celery_scheduled_tasks.scheduled_task[2eb2ee30-2bcd-45af-8ee2-437868be22e4]\n\n[2021-06-28 15:13:36,489: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:36,489: INFO/ForkPoolWorker-2] Task celery_scheduled_tasks.scheduled_task[2eb2ee30-2bcd-45af-8ee2-437868be22e4] succeeded in 0.000493534999975509s: None\n\n[2021-06-28 15:13:51,486: INFO/MainProcess] Received task: celery_scheduled_tasks.scheduled_task[c7c0616c-857a-4f7b-ae7a-dd967f9498fb]\n\n[2021-06-28 15:13:51,488: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:51,489: INFO/ForkPoolWorker-2] Task celery_scheduled_tasks.scheduled_task[c7c0616c-857a-4f7b-ae7a-dd967f9498fb] succeeded in 0.0004461000000333115s: None\n\n[2021-06-28 15:14:00,004: INFO/MainProcess] Received task: celery_scheduled_tasks.scheduled_task[59f6a323-4d9f-4ac4-b831-39ca6b342296]\n\n[2021-06-28 15:14:00,006: INFO/ForkPoolWorker-2] Scheduled task executed crontab every 2 minutes\n\n[2021-06-28 15:14:00,006: INFO/ForkPoolWorker-2] Task celery_scheduled_tasks.scheduled_task[59f6a323-4d9f-4ac4-b831-39ca6b342296] succeeded in 0.0004902660000425385s: None \n```", "```py\n[2021-06-28 15:13:06,510: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:21,488: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:36,489: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds\n\n[2021-06-28 15:13:51,488: INFO/ForkPoolWorker-2] Scheduled task executed every 15 seconds \n```", "```py\n[2021-06-28 15:13:06,510: INFO/ForkPoolWorker-1] Scheduled task executed crontab every 2 minutes\n\n[2021-06-28 15:14:00,006: INFO/ForkPoolWorker-2] Scheduled task executed crontab every 2 minutes \n```", "```py\n$ pip3 install flower \n```", "```py\n$ celery --broker=redis://localhost flower -A celery_tasks  --port=5555\n\n[I 210624 19:23:01 command:135] Visit me at http://localhost:5555\n\n[I 210624 19:23:01 command:142] Broker: redis://localhost:6379//\n\n[I 210624 19:23:01 command:143] Registered tasks:\n\n    ['celery.accumulate',\n\n     'celery.backend_cleanup',\n\n     'celery.chain',\n\n     'celery.chord',\n\n     'celery.chord_unlock',\n\n     'celery.chunks',\n\n     'celery.group',\n\n     'celery.map',\n\n     'celery.starmap',\n\n     'celery_tasks.obtain_info',\n\n     'celery_tasks.send_email']\n\n[I 210624 19:23:01 mixins:229] Connected to redis://localhost:6379// \n```", "```py\nPOST /api/task/async-apply/{task} \n```", "```py\n$ curl -X POST -d '{\"args\":[\"example@email.com\",[\"msg1\", \"msg2\"]]}' http://localhost:5555/api/task/async-apply/celery_tasks.send_email\n\n{\"task-id\": \"79258153-0bdf-4d67-882c-30405d9a36f0\"} \n```", "```py\n[2021-06-24 22:35:33,052: INFO/MainProcess] Received task: celery_tasks.send_email[79258153-0bdf-4d67-882c-30405d9a36f0]\n\n[2021-06-24 22:35:33,054: INFO/ForkPoolWorker-2] Send an email to example@email.com\n\n[2021-06-24 22:35:33,055: INFO/ForkPoolWorker-2] Reminders ['msg1', 'msg2']\n\n[2021-06-24 22:35:33,056: INFO/ForkPoolWorker-2] Task celery_tasks.send_email[79258153-0bdf-4d67-882c-30405d9a36f0] succeeded in 0.0021811629999999305s: None \n```", "```py\nGET /api/task/info/{task_id} \n```", "```py\n$ curl  http://localhost:5555/api/task/info/79258153-0bdf-4d67-882c-30405d9a36f0\n\n{\"uuid\": \"79258153-0bdf-4d67-882c-30405d9a36f0\", \"name\": \"celery_tasks.send_email\", \"state\": \"SUCCESS\", \"received\": 1624571191.674537, \"sent\": null, \"started\": 1624571191.676534, \"rejected\": null, \"succeeded\": 1624571191.679662, \"failed\": null, \"retried\": null, \"revoked\": null, \"args\": \"['example@email.com', ['msg1', 'msg2']]\", \"kwargs\": \"{}\", \"eta\": null, \"expires\": null, \"retries\": 0, \"worker\": \"celery@Jaimes-iMac-5K.local\", \"result\": \"None\", \"exception\": null, \"timestamp\": 1624571191.679662, \"runtime\": 0.0007789200000161145, \"traceback\": null, \"exchange\": null, \"routing_key\": null, \"clock\": 807, \"client\": null, \"root\": \"79258153-0bdf-4d67-882c-30405d9a36f0\", \"root_id\": \"79258153-0bdf-4d67-882c-30405d9a36f0\", \"parent\": null, \"parent_id\": null, \"children\": []} \n```"]