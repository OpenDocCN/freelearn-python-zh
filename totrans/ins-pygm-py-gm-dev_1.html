<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Instant Pygame for Python Game Development How-to"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Instant Pygame for Python Game Development How-to</h1></div></div></div><p>Welcome to <span class="emphasis"><em>Pygame for Python Game Development How-to</em></span>. This book is for developers who want to create games with Pygame quickly and easily and get familiar with the important aspects of it. The typical things you would learn are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Pygame basics</li><li class="listitem" style="list-style-type: disc">Sprites</li><li class="listitem" style="list-style-type: disc">OpenGL</li></ul></div><p>Pygame is part of the Python framework, originally written by Pete Shinners, that as its name suggests can be used to create video games. Pygame is free and open source since 2004 and licensed under the GPL license, which means that you are allowed to basically make any type of game. Pygame is built on top of the <span class="strong"><strong>Simple DirectMedia Layer</strong></span> (<span class="strong"><strong>SDL</strong></span>). SDL is a C framework that gives access to graphics, sound, keyboard, and other input devices on various operating systems including Linux, Mac OS X, and Windows.</p><div class="section" title="Preparing your development environment (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Preparing your development environment (Simple)</h1></div></div></div><p>We will install Python, Pygame, and other software we will need.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Getting ready</h2></div></div></div><p>Before we install Pygame, we need to have Python installed. On some operating systems Python is already installed. Pygame should be compatible with all Python versions. We will also need the NumPy numerical library. I am the author of two books published by Packt Publishing about NumPy – <span class="emphasis"><em>NumPy Beginner's Guide</em></span> and <span class="emphasis"><em>NumPy Cookbook</em></span>. Please refer to these books for more info about NumPy.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How to do it...</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing on Debian and Ubuntu<p>Python might be already installed on Debian and Ubuntu, but the development headers are usually not. On Debian and Ubuntu, install python and python-dev with these commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install python</strong></span>
<span class="strong"><strong>sudo apt-get install python-dev</strong></span>
</pre></div><p>Pygame can be found in the Debian archives <a class="ulink" href="http://packages.qa.debian.org/p/pygame.html">http://packages.qa.debian.org/p/pygame.html</a>. We can install NumPy with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install python-numpy</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">Installing on Windows<p>The Windows Python installer can be found on <a class="ulink" href="http://www.python.org/download">www.python.org/download</a>. On this website we can also find installers for Mac OS X and source tarballs for Linux, Unix, and Mac OS X.</p><p>From the Pygame website (<a class="ulink" href="http://www.pygame.org/download.shtml">http://www.pygame.org/download.shtml</a>), we can download the appropriate binary installer for the Python version we are using.</p><p>Download a NumPy installer for Windows from the SourceForge website (<a class="ulink" href="http://sourceforge.net/projects/numpy/files/">http://sourceforge.net/projects/numpy/files/</a>).</p></li><li class="listitem" style="list-style-type: disc">Installing Python on the Mac<p>Python comes preinstalled on Mac OS X. We can also get Python via MacPorts, Fink, or similar projects. We can install for instance the Python 2.6 port by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo port install python26</strong></span>
</pre></div><p>Binary Pygame packages for Mac OS X 10.3 and up can be found on <a class="ulink" href="http://www.pygame.org/download.shtml">http://www.pygame.org/download.shtml</a>. We can get a NumPy installer from the SourceForge website (<a class="ulink" href="http://sourceforge.net/projects/numpy/files/">http://sourceforge.net/projects/numpy/files/</a>). Download the appropriate <code class="literal">.DMG</code> file. Usually the latest one is the best.</p></li><li class="listitem" style="list-style-type: disc">Installing from source<p>Pygame is using the <code class="literal">distutils</code> system for compiling and installing. To start installing Pygame with the default options, simply run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python setup.py</strong></span>
</pre></div><p>If you need more information about the available options, type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python setup.py help</strong></span>
</pre></div><p>In order to compile the code, you need to have a compiler for your operating system. Setting this up is beyond the scope of this book. More information about compiling Pygame on Windows can be found on <a class="ulink" href="http://pygame.org/wiki/CompileWindows">http://pygame.org/wiki/CompileWindows</a>. More information about compiling Pygame on Mac OS X can be found at <a class="ulink" href="http://pygame.org/wiki/MacCompile">http://pygame.org/wiki/MacCompile</a>.</p></li></ul></div></div></div></div>
<div class="section" title="Running a simple game (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Running a simple game (Simple)</h1></div></div></div><p>We will create a simple game that we will improve on further in the book. As is traditional in books about programming, we will start with a Hello World! example. It's not a game per se. It's important to notice the so-called main game loop where all the action happens and the usage of the <code class="literal">Font</code> module to render text. In this program we will manipulate a Pygame's <code class="literal">Surface</code> object, that is used for drawing and we will handle a quit event.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Imports</strong></span>: First we will import the required Pygame modules. If Pygame is installed properly, we should get no errors, otherwise please return to the <span class="emphasis"><em>Preparing your development environment (Simple)</em></span> recipe:<div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *</pre></div></li><li class="listitem"><span class="strong"><strong>Initialization</strong></span>: We will initialize Pygame by creating a display of 400 by 300 pixels and setting the window title to <code class="literal">Hello world</code>:<div class="informalexample"><pre class="programlisting">pygame.init()
screen = pygame.display.set_mode((400, 300))

pygame.display.set_caption('Hello World!')</pre></div></li><li class="listitem"><span class="strong"><strong>The main game loop</strong></span>: Games usually have a game loop, which runs forever until, for instance, a quit event occurs. In this example, we will only set a label with the text <code class="literal">Hello world</code> at coordinates (100, 100). The text has a font size of 19, red color, and falls back to the default font:<div class="informalexample"><pre class="programlisting">while True: 
   sys_font = pygame.font.SysFont("None", 19)
   rendered = sys_font.render('Hello World', 0, (255, 100, 100))
   screen.blit(rendered, (100, 100))

   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div><p>We get the following screenshot as the end result:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_01.jpg"/></div><p>The following is the complete code for the Hello World example:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *

pygame.init()
screen = pygame.display.set_mode((400, 300))

pygame.display.set_caption('Hello World!')

while True: 
   sysFont = pygame.font.SysFont("None", 19)
   rendered = sysFont.render('Hello World', 0, (255, 100, 100))
   screen.blit(rendered, (100, 100))
   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>How it works...</h2></div></div></div><p>It might not seem like much, but we learned a lot in this recipe. The functions that passed the review are summarized in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.init()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function performs the initialization and needs to be called before any other Pygame functions are called.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.display.set_mode((400, 300))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a so-called <code class="literal">Surface</code> object to draw on. We give this function a tuple representing the width and height of the surface.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.display.set_caption('Hello World!')</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function sets the window title to a specified string value.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.font.SysFont("None", 19)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a system font from a comma-separated list of fonts (in this case none) and a font size parameter.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">sysFont.render('Hello World', 0, (255, 100, 100))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function draws text on a surface. The second parameter indicates whether anti-aliasing is used. The last parameter is a tuple representing the RGB values of a color.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">screen.blit(rendered, (100, 100))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function draws on a surface.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.event.get()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function gets a list of <code class="literal">Event</code> objects. Events represent some special occurrence in the system, such as a user quitting the game.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.quit()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function cleans up resources used by Pygame. Call this function before exiting the game.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.display.update()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function refreshes the surface.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Drawing with Pygame (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Drawing with Pygame (Simple)</h1></div></div></div><p>Before we start creating cool games, we need an introduction to the drawing functionality of Pygame. As we noticed in the previous recipe, in Pygame we draw on the <code class="literal">Surface</code> objects. There is a myriad of drawing options—different colors, rectangles, polygons, lines, circles, ellipses, animation, and different fonts.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>How to do it...</h2></div></div></div><p>The following steps will help you diverge into the different drawing options you can use with Pygame:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Imports</strong></span>: We will need the NumPy library to randomly generate RGB values for the colors, so we will add an extra import for that:<div class="informalexample"><pre class="programlisting">import numpy </pre></div></li><li class="listitem"><span class="strong"><strong>Initializing colors</strong></span>: Generate four tuples containing three RGB values each with NumPy:<div class="informalexample"><pre class="programlisting">colors = numpy.random.randint(0, 255, size=(4, 3))</pre></div><p>Then define the white color as a variable:</p><div class="informalexample"><pre class="programlisting">WHITE = (255, 255, 255)</pre></div></li><li class="listitem"><span class="strong"><strong>Set the background color</strong></span>: We can make the whole screen white with the following code:<div class="informalexample"><pre class="programlisting">screen.fill(WHITE)</pre></div></li><li class="listitem"><span class="strong"><strong>Drawing a circle</strong></span>: Draw a circle in the center with the window using the first color we generated:<div class="informalexample"><pre class="programlisting">pygame.draw.circle(screen, colors[0], (200, 200), 25, 0)</pre></div></li><li class="listitem"><span class="strong"><strong>Drawing a line</strong></span>: To draw a line we need a start point and an end point. We will use the second random color and give the line a thickness of <code class="literal">3</code>:<div class="informalexample"><pre class="programlisting">pygame.draw.line(screen, colors[1], (0, 0), (200, 200), 3)</pre></div></li><li class="listitem"><span class="strong"><strong>Drawing a rectangle</strong></span>: When drawing a rectangle, we are required to specify a color, the coordinates of the upper-left corner of the rectangle, and its dimensions:<div class="informalexample"><pre class="programlisting">pygame.draw.rect(screen, colors[2], (200, 0, 100, 100))</pre></div></li><li class="listitem"><span class="strong"><strong>Drawing an ellipse</strong></span>: You might be surprised to discover that drawing an ellipse requires similar parameters as for rectangles. The parameters actually describe an imaginary rectangle that can be drawn around the ellipse:<div class="informalexample"><pre class="programlisting">pygame.draw.ellipse(screen, colors[3], (100, 300, 100, 50), 2)</pre></div><p>The resulting window with a circle, line, rectangle, and ellipse using random colors:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2685OS_02.jpg"/></div><p>The code for the drawing demo is as follows:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import numpy 

pygame.init()
screen = pygame.display.set_mode((400, 400))

pygame.display.set_caption('Drawing with Pygame')
colors = numpy.random.randint(0, 255, size=(4, 3))

WHITE = (255, 255, 255)

#Make screen white
screen.fill(WHITE)

#Circle in the center of the window
pygame.draw.circle(screen, colors[0], (200, 200), 25, 0)

# Half diagonal from the upper-left corner to the center
pygame.draw.line(screen, colors[1], (0, 0), (200, 200), 3)

pygame.draw.rect(screen, colors[2], (200, 0, 100, 100))

pygame.draw.ellipse(screen, colors[3], (100, 300, 100, 50), 2)

while True: 
   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div></li></ol></div></div></div>
<div class="section" title="Animating objects (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Animating objects (Simple)</h1></div></div></div><p>Now that we know how to draw with Pygame, it's time to try something more dynamic. Most games, even the most static ones, have some level of animation. From a programmer's standpoint, animation is nothing more than displaying an object at a different place at a different time, thus simulating movement.</p><p>Pygame offers a <code class="literal">Clock</code> object that manages how many frames are drawn per second. This ensures that animation is independent of how fast the user's CPU is.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How to do it...</h2></div></div></div><p>We will load an image and use NumPy again to define a clockwise path around the screen:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we need to create a clock as follows:<div class="informalexample"><pre class="programlisting">clock = pygame.time.Clock()</pre></div></li><li class="listitem"><span class="strong"><strong>Loading an image</strong></span>: As part of the source code accompanying this book, there should be a picture of a head. We will load this image and move it around on the screen:<div class="informalexample"><pre class="programlisting">img = pygame.image.load('head.jpg')</pre></div></li><li class="listitem"><span class="strong"><strong>Initializing arrays</strong></span>: We will define some arrays to hold the coordinates of the positions, where we would like to put the image during the animation. Since the object will be moved, there are four logical sections of the path: right, down, left, and up. Each of these sections will have 40 equidistant steps. We will initialize all the values in the sections to 0:<div class="informalexample"><pre class="programlisting">steps = numpy.linspace(20, 360, 40).astype(int)
right = numpy.zeros((2, len(steps)))
down = numpy.zeros((2, len(steps)))
left = numpy.zeros((2, len(steps)))
up = numpy.zeros((2, len(steps)))</pre></div></li><li class="listitem"><span class="strong"><strong>Setting the coordinates of the positions</strong></span>: It's trivial to set the coordinates of the positions of the image. However, there is one tricky bit to notice, the <code class="literal">[::-1]</code> notation leads to reversing the order of the array elements:<div class="informalexample"><pre class="programlisting">right[0] = steps
right[1] = 20
down[0] = 360
down[1] = steps

left[0] = steps[::-1]
left[1] = 360

up[0] = 20
up[1] = steps[::-1]</pre></div></li><li class="listitem"><span class="strong"><strong>Joining the sections</strong></span>: The path sections can be joined, but before we can do this, the arrays have to be transposed with the <code class="literal">T</code> operator:<div class="informalexample"><pre class="programlisting">pos = numpy.concatenate((right.T, down.T, left.T, up.T))</pre></div></li><li class="listitem"><span class="strong"><strong>Setting the clock rate</strong></span>: In the main event loop, we will let the clock tick at a rate of 30 frames per second:<div class="informalexample"><pre class="programlisting">   clock.tick(30)</pre></div><p>The following screenshot is of the moving head:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_03.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>You should be able to watch a movie of this animation on <a class="ulink" href="https://www.youtube.com/watch?v=m2TagGiq1fs">https://www.youtube.com/watch?v=m2TagGiq1fs</a>.</p></div></div><p>The code of this example uses almost everything we learned so far, but should still be simple enough to understand:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import numpy

pygame.init()
clock = pygame.time.Clock()
screen = pygame.display.set_mode((400, 400))

pygame.display.set_caption('Animating Objects')
img = pygame.image.load('head.jpg')

steps = numpy.linspace(20, 360, 40).astype(int)
right = numpy.zeros((2, len(steps)))
down = numpy.zeros((2, len(steps)))
left = numpy.zeros((2, len(steps)))
up = numpy.zeros((2, len(steps)))

right[0] = steps
right[1] = 20

down[0] = 360
down[1] = steps

left[0] = steps[::-1]
left[1] = 360

up[0] = 20
up[1] = steps[::-1]

pos = numpy.concatenate((right.T, down.T, left.T, up.T))
i = 0

while True: 
   # Erase screen
   screen.fill((255, 255, 255))

   if i &gt;= len(pos):
      i = 0

   screen.blit(img, pos[i])
   i += 1

   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()
   clock.tick(30)</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How it works...</h2></div></div></div><p>We learned a bit about animation in this recipe. The most important concept we learned is the clock. The new functions that we used are described in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.time.Clock()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a game clock</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.linspace(20, 360, 40)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates an array with 40 equidistant values between 20 and 360</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.zeros((2, len(steps)))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates an array of the specified dimensions filled with zeroes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.concatenate((right.T, down.T, left.T, up.T))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function concatenates arrays to form a new array</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">clock.tick(30)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function executes a tick of the game clock, where 30 is the number of frames per second</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Using fonts (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Using fonts (Simple)</h1></div></div></div><p>Frequently there is a need to display some text, for instance, a counter or a message.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How to do it...</h2></div></div></div><p>Pygame has a <code class="literal">font</code> module that can help us to show text.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Creating a font</strong></span>: We can create a font by specifying, the font filename, and font size as constructor parameters:<div class="informalexample"><pre class="programlisting">font = pygame.font.Font('freesansbold.ttf', 32)</pre></div></li><li class="listitem"><span class="strong"><strong>Displaying text</strong></span>: Since we made an image move around the edge in the previous recipe, it would be great to display a counter and the position of the image in the center of the screen with a blue background and red letters. The following code snippet accomplishes this:<div class="informalexample"><pre class="programlisting">text = "%d %d %d" % (i, pos[i][0], pos[i][1])
rendered = font.render(text, True, RED, BLUE)
screen.blit(rendered, (150, 200))</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>A screenshot of the animation is shown as follows and should be on YouTube too at <a class="ulink" href="https://www.youtube.com/watch?v=xhjfcFhaXN0">https://www.youtube.com/watch?v=xhjfcFhaXN0</a>.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_04.jpg"/></div><p>The code is almost the same as for the previous recipe, with the addition of code for the creation and display of fonts:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import numpy

pygame.init()
clock = pygame.time.Clock()
screen = pygame.display.set_mode((400, 400))

pygame.display.set_caption('Animating Objects')
img = pygame.image.load('head.jpg')

steps = numpy.linspace(20, 360, 40).astype(int)
right = numpy.zeros((2, len(steps)))
down = numpy.zeros((2, len(steps)))
left = numpy.zeros((2, len(steps)))
up = numpy.zeros((2, len(steps)))

right[0] = steps
right[1] = 20

down[0] = 360
down[1] = steps
left[0] = steps[::-1]
left[1] = 360

up[0] = 20
up[1] = steps[::-1]

pos = numpy.concatenate((right.T, down.T, left.T, up.T))
i = 0

# create a font
font = pygame.font.Font('freesansbold.ttf', 32)
RED = (255, 0, 0)
BLUE = (0, 0, 255)

while True: 
   # Erase screen
   screen.fill((255, 255, 255))

   if i &gt;= len(pos):
      i = 0

   screen.blit(img, pos[i])

   # displaying text in the center of the screen
   text = "%d %d %d" % (i, pos[i][0], pos[i][1])
   rendered = font.render(text, True, RED, BLUE)
   screen.blit(rendered, (150, 200))
   i += 1

   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()
   clock.tick(30)</pre></div></li></ol></div></div></div>
<div class="section" title="Using Matplotlib with Pygame (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Using Matplotlib with Pygame (Simple)</h1></div></div></div><p>Matplotlib is an open source library for easy plotting. We can integrate Matplotlib into Pygame game and create various plots. You can find the Matplotlib installation instructions at <a class="ulink" href="http://matplotlib.org/users/installing.html">http://matplotlib.org/users/installing.html</a>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>How to do it...</h2></div></div></div><p>In this recipe we will take the position coordinates of the previous recipe and make a graph of them:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Using a non-interactive backend</strong></span>: In order to integrate Matplotlib with Pygame, we need to use a non-interactive backend, otherwise Matplotlib will present us with a GUI window by default. We will import the main Matplotlib module and call the <code class="literal">use</code> function. This function has to be called immediately after importing the main <code class="literal">matplotlib</code> module and before other <code class="literal">matplotlib</code> modules are imported:<div class="informalexample"><pre class="programlisting">import matplotlib
   
matplotlib.use("Agg")</pre></div></li><li class="listitem"><span class="strong"><strong>Creating a Matplotlib canvas</strong></span>: Non-interactive plots can be drawn on a Matplotlib canvas. Creating this canvas requires imports, a figure, and a subplot. We will specify the figure to be 3 by 3 inches large. More details can be found at the end of this recipe:<div class="informalexample"><pre class="programlisting">import matplotlib.pyplot as plt
import matplotlib.backends.backend_agg as agg

fig = plt.figure(figsize=[3, 3])
ax = fig.add_subplot(111)
canvas = agg.FigureCanvasAgg(fig)</pre></div></li><li class="listitem"><span class="strong"><strong>Plotting data</strong></span>: In a non-interactive mode, plotting data is a bit more complicated than in the default mode. Since we need to plot repeatedly, it makes sense to organize the plotting code in a function. The plot is eventually drawn on the canvas. The canvas adds a bit of complexity to our setup. At the end of this example, you can find more detailed explanation of the functions:<div class="informalexample"><pre class="programlisting">def plot(data):
   ax.plot(data)
   canvas.draw()
   renderer = canvas.get_renderer()

   raw_data = renderer.tostring_rgb()
   size = canvas.get_width_height()

   return pygame.image.fromstring(raw_data, size, "RGB")</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>The following screenshot shows the animation in action. You can also view a screencast on YouTube at <a class="ulink" href="https://www.youtube.com/watch?v=t6qTeXxtnl4">https://www.youtube.com/watch?v=t6qTeXxtnl4</a>.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_05.jpg"/></div><p>We get the following code after the changes:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import numpy
import matplotlib

matplotlib.use("Agg")

import matplotlib.pyplot as plt
import matplotlib.backends.backend_agg as agg

fig = plt.figure(figsize=[3, 3])
ax = fig.add_subplot(111)
canvas = agg.FigureCanvasAgg(fig)

def plot(data):
   ax.plot(data)
   canvas.draw()
   renderer = canvas.get_renderer()

   raw_data = renderer.tostring_rgb()
   size = canvas.get_width_height()

   return pygame.image.fromstring(raw_data, size, "RGB")

pygame.init()
clock = pygame.time.Clock()
screen = pygame.display.set_mode((400, 400))

pygame.display.set_caption('Animating Objects')
img = pygame.image.load('head.jpg')

steps = numpy.linspace(20, 360, 40).astype(int)
right = numpy.zeros((2, len(steps)))
down = numpy.zeros((2, len(steps)))
left = numpy.zeros((2, len(steps)))
up = numpy.zeros((2, len(steps)))

right[0] = steps
right[1] = 20

down[0] = 360
down[1] = steps

left[0] = steps[::-1]
left[1] = 360

up[0] = 20
up[1] = steps[::-1]

pos = numpy.concatenate((right.T, down.T, left.T, up.T))
i = 0
history = numpy.array([])
surf = plot(history)

while True: 
   # Erase screen
   screen.fill((255, 255, 255))

   if i &gt;= len(pos):
      i = 0
      surf = plot(history)


   screen.blit(img, pos[i])
   history = numpy.append(history, pos[i])
   screen.blit(surf, (100, 100))

   i += 1

   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()
   clock.tick(30)</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How it works...</h2></div></div></div><p>The plotting-related functions are explained in this table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">matplotlib.use("Agg")</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function specifies to use the non-interactive backend</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">plt.figure(figsize=[3, 3])</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a figure of 3 by 3 inches</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">fig.add_subplot(111)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a subplot (in this case we only need 1 subplot)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">agg.FigureCanvasAgg(fig)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a canvas in non-interactive mode</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">ax.plot(data)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a plot using specified data</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">canvas.draw()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function draws on the canvas</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">canvas.get_renderer()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function gets a renderer for the canvas</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Accessing surface pixel data (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Accessing surface pixel data (Intermediate)</h1></div></div></div><p>The Pygame <code class="literal">surfarray</code> module handles the conversion between Pygame <code class="literal">Surface</code> objects and NumPy arrays. As you may recall, NumPy can manipulate big arrays in a fast and efficient manner.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How to do it...</h2></div></div></div><p>In this recipe we will tile a small image to fill the game screen.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Copying pixels to array</strong></span>: The <code class="literal">array2d</code> function copies pixels into a two-dimensional array. There is a similar function for three-dimensional arrays. We will copy the pixels from the avatar image into an array:<div class="informalexample"><pre class="programlisting">pixels = pygame.surfarray.array2d(img)</pre></div></li><li class="listitem"><span class="strong"><strong>Creating the game screen</strong></span>: A NumPy array has a shape attribute that corresponds to the dimensions of the array. This attribute is a tuple. A two-dimensional array for instance, will have a two-element shape tuple. Let's create the game screen from the shape of the pixels array using the <code class="literal">shape</code> attribute of the array. The screen will be seven times larger in both directions:<div class="informalexample"><pre class="programlisting">X = pixels.shape[0] * 7
Y = pixels.shape[1] * 7
screen = pygame.display.set_mode((X, Y))</pre></div></li><li class="listitem"><span class="strong"><strong>Tiling the image</strong></span>: Tiling the image is easy with the NumPy <code class="literal">tile</code> function. The data needs to be converted to integer values, since colors are defined as integers:<div class="informalexample"><pre class="programlisting">new_pixels = numpy.tile(pixels, (7, 7)).astype(int)</pre></div></li><li class="listitem"><span class="strong"><strong>Displaying the array</strong></span>: The <code class="literal">surfarray</code> module has the following special function (<code class="literal">blit_array</code>) to display the array on the screen:<div class="informalexample"><pre class="programlisting">pygame.surfarray.blit_array(screen, new_pixels)</pre></div><p>The following screenshot displays the result of the code:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_06.jpg"/></div><p>The following code does the tiling of the image:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import numpy

pygame.init()
img = pygame.image.load('head.jpg')
pixels = pygame.surfarray.array2d(img)
X = pixels.shape[0] * 7
Y = pixels.shape[1] * 7
screen = pygame.display.set_mode((X, Y))
pygame.display.set_caption('Surfarray Demo')
new_pixels = numpy.tile(pixels, (7, 7)).astype(int)


while True: 
   screen.fill((255, 255, 255))
   pygame.surfarray.blit_array(screen, new_pixels)

   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>How it works...</h2></div></div></div><p>The following table gives us a brief description of the new functions and attributes we used:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.surfarray.array2d(img)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This copies pixel data into a 2D array</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pixels.shape[0]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The <code class="literal">shape</code> attribute holds the dimensions of a NumPy array as a tuple</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.tile(pixels, (7, 7))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This tiles an array the given dimensions specified as a tuple</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.surfarray.blit_array(screen, new_pixels)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This displays array values on the screen</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Accessing sound data (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Accessing sound data (Simple)</h1></div></div></div><p>A good game needs to have great music and sound effects. The Pygame <code class="literal">mixer</code> module lets us play a sound or any audio for that matter.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>How to do it...</h2></div></div></div><p>We will download a WAV audio file using standard Python. We will play this sound when the game quits. This example requires you to actually execute the example code, because this book has no audio support.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Creating a sound object</strong></span>: We can create a Pygame <code class="literal">Sound</code> object after specifying the name of the audio file. This class as you would expect embodies the concept of sounds:<div class="informalexample"><pre class="programlisting">audio = pygame.mixer.Sound(WAV_FILE)</pre></div></li><li class="listitem"><span class="strong"><strong>Playing the sound</strong></span>: The <code class="literal">Sound</code> object has a <code class="literal">play</code> method, which has a number of loops parameters. If the value of this parameter is set to -1, the sound will loop indefinitely:<div class="informalexample"><pre class="programlisting">audio.play(-1)</pre></div></li><li class="listitem"><span class="strong"><strong>Pausing the game</strong></span>: Sometimes we need to pause the execution of a game, as in our case in order to be able to hear a sound. We can do this with the following code snippet:<div class="informalexample"><pre class="programlisting">pygame.time.delay(TIMEOUT * 1000)</pre></div><p>The delay is specified in milliseconds, that's why we are multiplying by 1000.</p></li><li class="listitem"><span class="strong"><strong>Stopping the sound</strong></span>: After a while we need to stop the sound with the corresponding <code class="literal">stop</code> method:<div class="informalexample"><pre class="programlisting">audio.stop()</pre></div><p>The audio demo code is listed as follows:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import numpy
import urllib2
import time

WAV_FILE = 'smashingbaby.wav'

def play():
    audio = pygame.mixer.Sound(WAV_FILE)
    audio.play(-1)
    TIMEOUT = 1
    pygame.time.delay(TIMEOUT * 1000)
    audio.stop()
    time.sleep(TIMEOUT)

pygame.init()
pygame.display.set_caption('Sound Demo')
response = urllib2.urlopen('http://www.thesoundarchive.com/austinpowers/smashingbaby.wav')
filehandle = open(WAV_FILE, 'w')
filehandle.write(response.read())
filehandle.close()
screen = pygame.display.set_mode((400, 400))

while True: 
   sys_font = pygame.font.SysFont("None", 19)
   rendered = sys_font.render('Smashing Baby', 0, (255, 100, 100))
   screen.blit(rendered, (100, 100))

   for event in pygame.event.get():
      if event.type == QUIT:
         play()
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How it works...</h2></div></div></div><p>The most important functions of this demo are summed up in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.mixer.Sound(WAV_FILE)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a <code class="literal">Sound</code> object given a filename.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">audio.play(-1)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function plays and loops indefinitely (-1 means indefinitely). By default the sound is played only once. This corresponds with 0 loops. If the value is 2, the sound will be played once and then repeated 2 more times.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.time.delay(TIMEOUT * 1000)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function pauses the game for a specified number of milliseconds.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">audio.stop()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function stops audio playback.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Playing a movie (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Playing a movie (Intermediate)</h1></div></div></div><p>Most commercial games these days have small movie clips that try to explain the plot to us. For instance, a first-person shooter could have a movie showing a briefing about the next mission. Movie playback is a cool feature to have. Pygame offers limited support for MPEG movies.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Getting ready</h2></div></div></div><p>We need to have a MPEG movie for this demo. Once you have a movie you can convert it to be used in a Pygame game with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ffmpeg -i &lt;infile&gt; -vcodec mpeg1video -acodec libmp3lame -intra &lt;outfile.mpg&gt;</strong></span>
</pre></div><p>Installing <code class="literal">ffmpeg</code> and the command-line options are outside the scope of this book, but shouldn't be too difficult (see <a class="ulink" href="http://ffmpeg.org/">http://ffmpeg.org/</a>).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How to do it...</h2></div></div></div><p>The movie playback is set up similarly to the audio playback that we covered in the previous recipe. The following code demonstrates playing a MPEG video. Pay particular attention to the <code class="literal">play</code> function:</p><div class="informalexample"><pre class="programlisting">import pygame, sys
from pygame.locals import *
import time

pygame.init()
screen = pygame.display.set_mode((400, 400))
pygame.display.set_caption('Movie Demo')

def play():
    movie = pygame.movie.Movie('out.mpg')
    movie.play()
    TIMEOUT = 7
    pygame.time.delay(TIMEOUT * 1000)
    movie.stop()

while True: 
   screen.fill((255, 255, 255))

   for event in pygame.event.get():
      if event.type == QUIT:
         play()
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>How it works...</h2></div></div></div><p>The relevant functions for the movie playback can found in this table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.movie.Movie('out.mpg')</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function creates a <code class="literal">Movie</code> object given the filename of the MPEG movie</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">movie.play()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function starts playing the movie</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">movie.stop()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function stops playback of the movie</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Pygame on Android (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Pygame on Android (Intermediate)</h1></div></div></div><p>Android is an open source smartphone operating system initially developed by Google. Most of the Android apps are written in the Java programming language and run on a Java-based virtual machine. Fortunately, we can create Pygame games for Android phones. This is not a trivial matter and we will only cover the bare basics.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>Getting ready</h2></div></div></div><p>We will install the <span class="strong"><strong>Pygame Subset For Android</strong></span> (<span class="strong"><strong>PGS4A</strong></span>). You will need to have the JDK, Python 2.7 or a later version installed before we start. Download the appropriate software for your operating system from <a class="ulink" href="http://pygame.renpy.org/dl">http://pygame.renpy.org/dl</a>.</p><p>To install the necessary software, we will require an Internet connection and quite a lot of room on your hard drive. If you don't have a couple of gigabytes to spare, you may need to make more space. We can install the Android SDK and other software we will need such as Apache Ant by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>android.py installsdk</strong></span>
</pre></div><p>This will start a wizard that will guide you through the installation. It's safe to accept all the default options during the installation procedure, but you do have to generate a key. Unless you are really serious about creating apps, you don't have to worry how secure this key is.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How to do it...</h2></div></div></div><p>We will create a simple game that prints "Hello World From Android!" and call it <code class="literal">mygame</code>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Setting up the game</strong></span>: Create a directory with the same name as the name of the game and place a <code class="literal">main.py</code> file in there with the following contents:<div class="informalexample"><pre class="programlisting">import pygame

# Import the android module. If we can't import it, set it to None - this
# lets us test it, and check to see if we want android-specific # behavior.
try:
    import android
except ImportError:
    android = None

# Event constant.
TIMEREVENT = pygame.USEREVENT

# The FPS the game runs at.
FPS = 30

def main():
    pygame.init()

    # Set the screen size.
    screen = pygame.display.set_mode((480, 800))

    # Map the back button to the escape key.
    if android:
        android.init()
        android.map_key(android.KEYCODE_BACK, pygame.K_ESCAPE)

    # Use a timer to control FPS.
    pygame.time.set_timer(TIMEREVENT, 1000 / FPS)

    while True:
        ev = pygame.event.wait()

        # Android-specific:
        if android:
            if android.check_pause():
                android.wait_for_resume()

        # Draw the screen based on the timer.
        if ev.type == TIMEREVENT:
            screen.fill((255, 255, 255))
            font = pygame.font.Font('freesansbold.ttf', 32)
            rendered = font.render('Hello From Android!', 0, (255, 100, 100))
            screen.blit(rendered, (100, 100))
            pygame.display.flip()

        # When the user hits back, ESCAPE is sent. Handle it and
        # end the game.
        elif ev.type == pygame.KEYDOWN and ev.key == pygame.K_ESCAPE:
            break

# This isn't run on Android.
if __name__ == "__main__":
    main()</pre></div><p>This is basically the code from the PGS4A website changed to print a welcome message. A more thorough explanation will be given at the end of the recipe.</p></li><li class="listitem"><span class="strong"><strong>Configuring the game</strong></span>: We can configure the game with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>android.py configure mygame</strong></span>
</pre></div><p>We will accept all the defaults and set the storage setting to internal.</p></li><li class="listitem"><span class="strong"><strong>Building, installing, and running the game</strong></span>: Android is essentially a Java framework, so there is a lot of compiling involved. This is a bit different than in the Python world. Since this game is simple, building will not take that long. First we will start the emulator—this is an application that mimics the behavior of an actual phone. Find the <code class="literal">android</code> executable that is part of the Android SDK. Launch it and choose <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Manage AVDs…</strong></span> | <span class="strong"><strong>New…</strong></span> in the GUI application that opens. Create an <span class="strong"><strong>Android Virtual Device</strong></span> (<span class="strong"><strong>AVD</strong></span>) and give it a name. Hit the <span class="strong"><strong>Launch…</strong></span> button. A phone emulator will start. If it is locked, you can unlock it by pressing <span class="emphasis"><em>F2</em></span>.<p>We can now build and install the game with the command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>android.py build mygame release install</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>How it works...</h2></div></div></div><p>The relevant functions used in this code are described as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">android.init()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function initializes Android</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">android.map_key(android.KEYCODE_BACK, pygame.K_ESCAPE)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function maps the Android back button to the Pygame escape button</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.time.set_timer(TIMEREVENT, 1000 / FPS)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function fires events at specified time intervals given in milliseconds</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">android.check_pause()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function checks for a pause request</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">android.wait_for_resume()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This function puts the game in sleep mode</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Artificial intelligence (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Artificial intelligence (Intermediate)</h1></div></div></div><p>Often we need to mimic intelligent behavior within a game. The <code class="literal">scikits-learn</code> project aims to provide an API for Machine Learning. What I like most about it is the amazing documentation.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>Getting ready</h2></div></div></div><p>We can install <code class="literal">scikit-learn</code> by typing the following command at the command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>pip install -U scikit-learn</strong></span>
</pre></div><p>Or:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>easy_install -U scikit-learn</strong></span>
</pre></div><p>This might not work because of permissions, so you might need to put <code class="literal">sudo</code> in front of the commands or log in as admin.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How to do it...</h2></div></div></div><p>We will generate some random points and cluster them, which means that points that are close to each other are put in the same cluster. This is only one of the many techniques that you can apply with <code class="literal">scikits-learn</code>. <span class="strong"><strong>Clustering</strong></span> is a type of machine learning algorithm that aims to group items based on similarities.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Generating random points</strong></span>: We will generate 30 random point positions within a square of 400 by 400 pixels:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>positions = numpy.random.randint(0, 400, size=(30, 2))</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Calculating the affinity matrix</strong></span>: We will use the Euclidean distance to the origin as the <span class="strong"><strong>affinity metric</strong></span>. The affinity matrix is a matrix holding affinity scores, in this case distances:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>positions_norms = numpy.sum(positions ** 2, axis=1)</strong></span>
<span class="strong"><strong>S = - positions_norms[:, numpy.newaxis] - positions_norms[numpy.newaxis, :] + 2 * numpy.dot(positions, positions.T)</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Clustering the points</strong></span>: Give the <code class="literal">AffinityPropagation</code> class the result from the previous step. This class labels the points with the appropriate cluster number:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>aff_pro = sklearn.cluster.AffinityPropagation().fit(S)</strong></span>
<span class="strong"><strong>labels = aff_pro.labels_</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Drawing polygons</strong></span>: We will draw polygons for each cluster. The function involved requires a list of points, a color (let's paint it red), and a surface:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>pygame.draw.polygon(screen, (255, 0, 0), polygon_points[i])</strong></span>
</pre></div><p>The result is a bunch of polygons for each cluster as shown in the following screenshot:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_08.jpg"/></div><p>The clustering example code is shown as follows:</p><div class="informalexample"><pre class="programlisting">import numpy
import sklearn.cluster
import pygame, sys
from pygame.locals import *


positions = numpy.random.randint(0, 400, size=(30, 2))

positions_norms = numpy.sum(positions ** 2, axis=1)
S = - positions_norms[:, numpy.newaxis] - positions_norms[numpy.newaxis, :] + 2 * numpy.dot(positions, positions.T)

aff_pro = sklearn.cluster.AffinityPropagation().fit(S)
labels = aff_pro.labels_

polygon_points = []

for i in xrange(max(labels) + 1):
   polygon_points.append([])


# Sorting points by cluster
for i, l in enumerate(labels):
   polygon_points[l].append(positions[i])

pygame.init()
screen = pygame.display.set_mode((400, 400))


while True: 
   for point in polygon_points:
      pygame.draw.polygon(screen, (255, 0, 0), point)

   for event in pygame.event.get():
      if event.type == QUIT:
         pygame.quit()
         sys.exit()

   pygame.display.update()</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How it works...</h2></div></div></div><p>The most important lines in the artificial intelligence recipe are described in more detail in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.random.randint(0, 400, size=(30, 2))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates an array of 30 by 2 random integers. This corresponds to 30 points in two-dimensional space. The values are between 0 and 400.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.sum(positions ** 2, axis=1)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This sums an array of the square of the positions array.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.dot(positions, positions.T)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This computes the dot product of the positions array and its transpose.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">sklearn.cluster.AffinityPropagation().fit(S)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates an <code class="literal">AffinityPropagation</code> object and performs a fit using an affinity matrix.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.draw.polygon(screen, (255, 0, 0), polygon_points[i])</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This draws a polygon given a surface, a color (red in this case), and a list of points.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Drawing sprites (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Drawing sprites (Intermediate)</h1></div></div></div><p>
<span class="strong"><strong>Sprite</strong></span> is a term from computer graphics meaning a two-dimensional visible object, that has been optimized for rendering. Pygame offers the <code class="literal">Sprite</code> class that deals with sprites. It can draw sprites on a <code class="literal">Surface</code> object. It also has collision functions. For complex games, we can group sprites together for easy management. Sprites are not thread safe, so you should take care when using multiple threads.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>How to do it...</h2></div></div></div><p>We will redo the animation demo, but this time with sprites and using <code class="literal">Rect</code> objects, which represent rectangles. A <code class="literal">Rect</code> object has <code class="literal">left</code>, <code class="literal">top</code>, <code class="literal">width</code>, and <code class="literal">height</code> attributes. We will use these and other attributes throughout the example. Also we will let the avatar spin when the mouse button is clicked. However, we will not care for now where we click exactly.</p><p>We will create a class that extends the <code class="literal">Sprite</code> class. Sprite classes have an <code class="literal">update</code> method which fires for each frame. All logic involving the movement of the sprite should be placed here.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Constructor</strong></span>: First, we need to create the sprite and perform subclassing. All the initialization logic goes here. Further details for the functions can be found in the next section. We define an image, rectangle, and variables tracking the movement of the avatar:<div class="informalexample"><pre class="programlisting">class Head(pygame.sprite.Sprite):
    def __init__(self):
        pygame.sprite.Sprite.__init__(self) 
        self.image, self.rect = load_image('head.jpg', -1)
        screen = pygame.display.get_surface()
        self.area = screen.get_rect()
        self.STEP = 9
        self.MARGIN = 12
        self.xstep = self.STEP 
        self.ystep = 0
        self.dizzy = 0
        self.direction = 'right'</pre></div></li><li class="listitem"><span class="strong"><strong>The update method</strong></span>: The <code class="literal">update</code> method calls helper methods that either cause the head to spin or move it in clockwise direction. The movement is achieved with this line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>newpos = self.rect.move((self.xstep, self.ystep))</strong></span>
</pre></div><p>The following line take care of the rotation:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>self.image = pygame.transform.rotate(self.original, self.degrees)</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>You can find a short clip of the game on YouTube (<a class="ulink" href="https://www.youtube.com/watch?v=EFQlc_siPrI">https://www.youtube.com/watch?v=EFQlc_siPrI</a>). A screenshot of the game is shown as follows:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_09.jpg"/></div></div></div><p>The complete code of the Sprite demo is listed as follows:</p><div class="informalexample"><pre class="programlisting">import os, pygame
from pygame.locals import *

def load_image(name, colorkey=None):
    try:
        image = pygame.image.load(name)
    except pygame.error, message:
        print 'Cannot load image:', name

    image = image.convert()

    return image, image.get_rect()

class Head(pygame.sprite.Sprite):
    def __init__(self):
        pygame.sprite.Sprite.__init__(self) 
        self.image, self.rect = load_image('head.jpg', -1)
        screen = pygame.display.get_surface()
        self.area = screen.get_rect()
        self.STEP = 9
        self.MARGIN = 12
        self.xstep = self.STEP 
        self.ystep = 0
        self.degrees = 0
        self.direction = 'right'

    def update(self):
        if self.degrees:
            self._spin()
        else:
            self._move()

    def _move(self):
        newpos = self.rect.move((self.xstep, self.ystep))

        if self.direction == 'right' and self.rect.right &gt; self.area.right - self.MARGIN:
            self.xstep = 0
            self.ystep = self.STEP 
            self.direction = 'down'

        if self.direction == 'down' and self.rect.bottom &gt; self.area.bottom - self.MARGIN:
            self.xstep = -self.STEP
            self.ystep = 0
            self.direction = 'left'

        if self.direction == 'left' and self.rect.left &lt; self.area.left + self.MARGIN:
            self.xstep = 0
            self.ystep = -self.STEP
            self.direction = 'up'

        if self.direction == 'up' and self.rect.top &lt; self.area.top + self.MARGIN:
            self.xstep = self.STEP
            self.ystep = 0
            self.direction = 'right'

        self.rect = newpos

    def _spin(self):
        center = self.rect.center
        self.degrees = self.degrees + 12
        if self.degrees &gt;= 360:
            self.degrees = 0
            self.image = self.original
        else:
            self.image = pygame.transform.rotate(self.original, self.degrees)
        self.rect = self.image.get_rect(center=center)

    def hit(self):
        if not self.degrees:
            self.degrees = 1
            self.original = self.image


def main():
    pygame.init()
    screen = pygame.display.set_mode((400, 400))
    pygame.display.set_caption('Sprite Demo')

    background = pygame.Surface(screen.get_size())
    background = background.convert()
    background.fill((250, 250, 250))

    if pygame.font:
        font = pygame.font.Font(None, 36)
        text = font.render("Hit the avatar!", 1, (0, 0, 200))
        textpos = text.get_rect(centerx = background.get_width()/2, centery = background.get_height()/2)
        background.blit(text, textpos)

    screen.blit(background, (0, 0))
    pygame.display.flip()

    clock = pygame.time.Clock()
    head = Head()
    sprite = pygame.sprite.RenderPlain(head)

    while True:
        clock.tick(60)

        for event in pygame.event.get():
            if event.type == QUIT:
                return
            elif event.type == MOUSEBUTTONDOWN:
               head.hit()

        sprite.update()

        screen.blit(background, (0, 0))
        sprite.draw(screen)
        pygame.display.flip()



if __name__ == '__main__': 
   main()</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>How it works...</h2></div></div></div><p>A more in-depth description of the various functions used in this demo is given as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.sprite.Sprite.__init__(self)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates sprites.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">screen.get_rect()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This gets a <code class="literal">Rect</code> object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.display.get_surface()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This gets a <code class="literal">Surface</code> object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.rect.move((self.xstep, self.ystep))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This moves a rectangle given a <code class="literal">x</code> and <code class="literal">y</code> coordinate.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.transform.rotate(self.original, self.degrees)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This rotates an image given a <code class="literal">Surface</code> object and angle in degrees. Positive values correspond with counter clockwise rotation, negative with clockwise rotation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.image.get_rect(center=center)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This gets the rectangle for the image given its center coordinates.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.sprite.RenderPlain(head)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This renders the sprite.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Using OpenGL with Pygame (Advanced)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec20"/>Using OpenGL with Pygame (Advanced)</h1></div></div></div><p>OpenGL specifies an API for 2D and 3D computer graphics. The API consists of functions and constants. We will be concentrating on the Python implementation called <span class="strong"><strong>PyOpenGL</strong></span>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>Getting ready</h2></div></div></div><p>Install PyOpenGL with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>pip install PyOpenGL PyOpenGL_accelerate</strong></span>
</pre></div><p>You might need to have root access to execute this command. The corresponding <code class="literal">easy_install</code> command is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>easy_install PyOpenGL PyOpenGL_accelerate</strong></span>
</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>How to do it...</h2></div></div></div><p>For the purpose of demonstration we will draw a Sierpinski gasket with OpenGL. This is a fractal pattern in the shape of a triangle created by the mathematician Waclaw Sierpinski. The triangle is obtained via a recursive and in principle infinite procedure.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>OpenGL Initialization</strong></span>: First, we will start out by initializing some of the OpenGL-related primitives. This includes setting the display mode and background color. A line-by-line explanation is given at the end of the recipe:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>def display_openGL(w, h):</strong></span>
<span class="strong"><strong>  pygame.display.set_mode((w,h), pygame.OPENGL|pygame.DOUBLEBUF)</strong></span>

<span class="strong"><strong>  glClearColor(0.0, 0.0, 0.0, 1.0)</strong></span>
<span class="strong"><strong>  glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT)</strong></span>


<span class="strong"><strong> </strong></span>
<span class="strong"><strong>  gluOrtho2D(0, w, 0, h)</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Displaying points</strong></span>: The algorithm requires us to display points, the more the better. First, we set the drawing color to red. Second, we define the vertices (I call them points myself) of a triangle. Then we define random indices, which are to be used to choose one of the three triangle vertices. We pick a random point somewhere in the middle, it doesn't really matter where. After that we draw points halfway between the previous point and one of the vertices picked at random. Finally, we "flush" the result:<div class="informalexample"><pre class="programlisting">    glColor3f(1.0, 0, 0)
    vertices = numpy.array([[0, 0], [DIM/2, DIM], [DIM, 0]])
    NPOINTS = 9000
    indices = numpy.random.random_integers(0, 2, NPOINTS)
    point = [175.0, 150.0]

    for index in indices:
       glBegin(GL_POINTS)
       point = (point + vertices[index])/2.0
       glVertex2fv(point)
       glEnd()

    glFlush()</pre></div><p>The Sierpinski triangle looks like this:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_10.jpg"/></div><p>The full Sierpinski gasket demo code with all the imports is shown as follows:</p><div class="informalexample"><pre class="programlisting">import pygame
from pygame.locals import *
import numpy
     
from OpenGL.GL import *
from OpenGL.GLU import *

def display_openGL(w, h):
  pygame.display.set_mode((w,h), pygame.OPENGL|pygame.DOUBLEBUF)

  glClearColor(0.0, 0.0, 0.0, 1.0)
  glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT)

  
  gluOrtho2D(0, w, 0, h)


def main():
    pygame.init()
    pygame.display.set_caption('OpenGL Demo')
    DIM = 400
    display_openGL(DIM, DIM)
    glColor3f(1.0, 0, 0)
    vertices = numpy.array([[0, 0], [DIM/2, DIM], [DIM, 0]])
    NPOINTS = 9000
    indices = numpy.random.random_integers(0, 2, NPOINTS)
    point = [175.0, 150.0]

    for index in indices:
       glBegin(GL_POINTS)
       point = (point + vertices[index])/2.0
       glVertex2fv(point)
       glEnd()

    glFlush()
    pygame.display.flip()
     
    while True:
        for event in pygame.event.get():
            if event.type == QUIT:
                return

    
if __name__ == '__main__':
  main()</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>How it works...</h2></div></div></div><p>As promised here is a line-by-line explanation of the most important parts of the example:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.display.set_mode((w,h), pygame.OPENGL|pygame.DOUBLEBUF)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This sets the display mode to the required width, height, and OpenGL display.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This clears the buffers using a mask. Here we clear the color buffer and depth buffer bits.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">gluOrtho2D(0, w, 0, h)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This defines a 2D orthographic projection matrix with the coordinates of the left, right, top, and bottom clipping planes.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">glColor3f(1.0, 0, 0)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This defines the current drawing color using three float values for RGB (0-1 instead of 0-255 that is usual for Pygame). In this case we will be painting in red.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">glBegin(GL_POINTS)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This delimits the vertices of primitives or a group of primitives. Here the primitives are points.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">glVertex2fv(point)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This renders a point given a vertex.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">glEnd()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This closes a section of code started with <code class="literal">glBegin</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">glFlush()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This forces execution of GL commands.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Detecting collisions (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec21"/>Detecting collisions (Intermediate)</h1></div></div></div><p>In the sprite demo, we left out the collision detection bit. Pygame has a number of useful collision detection functions in the <code class="literal">Rect</code> class. For instance, we can check whether a point is in a rectangle or whether two rectangles overlap.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>How to do it...</h2></div></div></div><p>Beside the collision detection we will replace the mouse cursor with an image of a hammer that we created. It's not a very pretty image, but it beats the boring old cursor.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Updating the hit method</strong></span>: We will update the <code class="literal">hit</code> method of the sprite demo code. In the new version, we check whether the mouse cursor is within the avatar sprite. Actually to make it easier to hit the head, we create a slightly bigger rectangle:<div class="informalexample"><pre class="programlisting">def hit(self):
         mouse_x, mouse_y = pygame.mouse.get_pos()
         collided = False
         bigger_rect = self.rect.inflate(40, 40)

         if bigger_rect.collidepoint(mouse_x, mouse_y):
            collided = True

         if not self.degrees and collided:
            self.degrees = 1
            self.original = self.image
            self.nhits += 1
         else:                                  
            self.nmisses += 1 </pre></div></li><li class="listitem"><span class="strong"><strong>Replacing the mouse cursor</strong></span>: All the steps necessary to replace the mouse cursor were already covered. Except making the mouse cursor invisible:<div class="informalexample"><pre class="programlisting">pygame.mouse.set_visible(False)</pre></div><p>A screenshot of the game is shown as follows:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_11.jpg"/></div></li></ol></div><p>The complete code for this example can be found in the code bundle of this book. </p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec36"/>How it works...</h2></div></div></div><p>We learned a bit about collision detection, the mouse cursor, and rectangles in this recipe:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.mouse.get_pos()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This gets the mouse position as a tuple.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.rect.inflate(40, 40)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates a bigger rectangle based on an offset. If the offset is negative this results in a smaller rectangle.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">bigger_rect.collidepoint(mouse_x, mouse_y)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This checks whether a point is within a rectangle.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pygame.mouse.set_visible(False)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This hides the mouse cursor.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Adding networking functionality (Advanced)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec22"/>Adding networking functionality (Advanced)</h1></div></div></div><p>Games become more engaging when you are able to play against other people. Usually this means playing over the Internet using some sort of client-server architecture. In the Python world, Twisted is commonly used for this kind of architecture.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec37"/>Getting ready</h2></div></div></div><p>Twisted can be installed in several ways depending on your operating system. For more information see <a class="ulink" href="https://twistedmatrix.com/trac/wiki/Downloads">https://twistedmatrix.com/trac/wiki/Downloads</a>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec38"/>How to do it...</h2></div></div></div><p>Unfortunately, we cannot create a massive multiplayer game in this tutorial, but we can create a simple client-server setup, which will lay the foundations for a puzzle we will create in a later recipe.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>The server</strong></span>: First, we will set up the server, which will echo the message from the client and prepend it with a sequence number:<div class="informalexample"><pre class="programlisting">from twisted.internet import reactor, protocol

class Server(protocol.Protocol):
    def __init__(self):
       self.count = 0

    def dataReceived(self, msg):
         self. count += 1
         self.transport.write("%d %s" % (self.count, msg))


def main():
    factory = protocol.ServerFactory()
    factory.protocol = Server
    reactor.listenTCP(8888,factory)
    reactor.run()

if __name__ == '__main__':
    main()</pre></div><p>As you can see the server runs on port 8888 over TCP (see <a class="ulink" href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol">http://en.wikipedia.org/wiki/Transmission_Control_Protocol</a>).</p></li><li class="listitem"><span class="strong"><strong>Client setup</strong></span>: The client sends messages over the same port as the server and also shows the messages from the server in a Pygame GUI. We will go over the details in the next section. In a later example we will do more interesting things with this code:<div class="informalexample"><pre class="programlisting">from twisted.internet import reactor, protocol
from pygame.locals import *
import pygame

class Client(protocol.Protocol):
    def __init__(self):
       self.msg = 'Hello'
       self.end_msg = False

    def sendMessage(self, msg):
        self.transport.write(msg)
        self.update(msg)

    def dataReceived(self, msg):
       self.msg = msg

       if msg.startswith("19"):
          self.end_msg = True
    
    def update(self, msg):
        screen = pygame.display.get_surface()

        screen.fill((255, 255, 255))
        font = pygame.font.Font(None, 36)
        text = font.render(self.msg, 1, (200, 200, 200))
        textpos = text.get_rect(centerx=screen.get_width()/2, centery=screen.get_height()/2)
        screen.blit(text, textpos)
        pygame.display.flip()

        if self.end_msg:
           reactor.stop()
    
def send(p):
    p.sendMessage("Hello!")

    for i in xrange(1, 20):
      reactor.callLater(i * .1, p.sendMessage, "IMPORTANT MESSAGE!")

def main():
    pygame.init()
    screen = pygame.display.set_mode((400, 400))
    pygame.display.set_caption('Network Demo')

    c = protocol.ClientCreator(reactor, Client)
    c.connectTCP("localhost", 8888).addCallback(send)
    reactor.run()


    while True:
       for event in pygame.event.get():
         if event.type == QUIT:
             return

if __name__ == '__main__':
    main()</pre></div><p>We need to start the server, before we can start the client. In the game GUI, you should see <span class="strong"><strong>Hello</strong></span> being displayed followed by <span class="strong"><strong>1 IMPORTANT MESSAGE!</strong></span> to <span class="strong"><strong>19 IMPORTANT MESSAGE!</strong></span> as shown in the following screenshot:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_12.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec39"/>How it works...</h2></div></div></div><p>We saw in this example how to create a simple server and client with a Pygame GUI. In principle, we can now extend this setup to create a multiplayer game. The details of the Twisted client and server setup are given as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">self.transport.write("%d %s" % (self.count, msg))</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This writes a message. In this case we are prepending a sequence number to the message.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">factory = protocol.ServerFactory()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates a Twisted server factory, which itself creates Twisted servers.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">reactor.listenTCP(8888,factory)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This listens to port 8888 using the given factory.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">reactor.run()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This starts the server or client.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">reactor.stop()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This stops the client or server.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">reactor.callLater(i * .1, p.sendMessage, "IMPORTANT MESSAGE!")</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This registers a callback function with a parameter to be executed after a specified time in seconds.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">protocol.ClientCreator(reactor, Client)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates a Twisted client.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">c.connectTCP("localhost", 8888).addCallback(send)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This connects the client via TCP on port 8888 and registers a callback function.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Debugging your game (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec23"/>Debugging your game (Intermediate)</h1></div></div></div><p>Debugging is one of those things that nobody really likes, but is very important to master. It can take hours, and because of Murphy's law you, most likely, don't have that time. Therefore, it is important to be systematic and know your tools well. After you are done finding the bug and implementing a fix, you should have a test in place. This way at least you will not have to go through the hell of debugging again.</p><p>PuDB is a visual full screen, console-based Python debugger that is easy to install. PuDB supports cursor keys and vi commands. The debugger can also be integrated with IPython, if required.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec40"/>Getting ready</h2></div></div></div><p>In order to install puDB, we only need to execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo easy_install pudb</strong></span>
</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec41"/>How to do it...</h2></div></div></div><p>To debug the collision demo code, type the following command on the command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python -m pudb collision_demo.py</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>The source code should be available for download from the Packt Publishing website.</p></div></div><p>The following screenshot shows the most important debugging commands at the top:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_13.jpg"/></div><p>We can also see the code being debugged, variables, the stack, and the defined breakpoints. Typing <code class="literal">q</code> exits most menus. Typing <code class="literal">n</code> moves the debugger to the next line. We can also move with the cursor keys or vi <span class="emphasis"><em>J</em></span> and <span class="emphasis"><em>K</em></span> keys to, for instance, set a breakpoint by typing <code class="literal">b</code>.
</p></div></div>
<div class="section" title="Profiling your code (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec24"/>Profiling your code (Intermediate)</h1></div></div></div><p>Performance is important for games, luckily there are many Python profiling tools. Profiling is about building a profile of a software program in order to collect information about memory usage or time complexity.</p><p>
<code class="literal">cProfile</code> is a C extension introduced in Python 2.5. It can be used for <span class="strong"><strong>deterministic profiling</strong></span>. Deterministic profiling means that the time measurements are precise and no sampling is used. Contrast this with statistical profiling, where measurements come from random samples.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec42"/>How to do it...</h2></div></div></div><p>The following steps will help you profile your code:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Creating a profile file</strong></span>: We will profile the collision demo code and store the profile output in a file as follows:<div class="informalexample"><pre class="programlisting">python -m cProfile -o collision_demo.profile collision_demo.py</pre></div></li><li class="listitem"><span class="strong"><strong>The pstats browser</strong></span>: After creating the file, we can view and sort the data in a special command-line browser:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>python -m pstats collision_demo.profile </strong></span>
<span class="strong"><strong>Welcome to the profile statistics browser.</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Getting help</strong></span>: Being able to get help is always a good thing, just type the following commands at the command line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>collision_demo.profile% help</strong></span>

<span class="strong"><strong>Documented commands (type help &lt;topic&gt;):</strong></span>
<span class="strong"><strong>========================================</strong></span>
<span class="strong"><strong>EOF  add  callees  callers  help  quit  read  reverse  sort  stats  strip</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Sorting</strong></span>: We can sort with the following <code class="literal">sort</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>collision_demo.profile% sort</strong></span>
<span class="strong"><strong>Valid sort keys (unique prefixes are accepted):</strong></span>
<span class="strong"><strong>stdname -- standard name</strong></span>
<span class="strong"><strong>nfl -- name/file/line</strong></span>
<span class="strong"><strong>pcalls -- call count</strong></span>
<span class="strong"><strong>file -- file name</strong></span>
<span class="strong"><strong>calls -- call count</strong></span>
<span class="strong"><strong>time -- internal time</strong></span>
<span class="strong"><strong>line -- line number</strong></span>
<span class="strong"><strong>cumulative -- cumulative time</strong></span>
<span class="strong"><strong>module -- file name</strong></span>
<span class="strong"><strong>name -- function name</strong></span>
</pre></div></li><li class="listitem"><span class="strong"><strong>Top 3 called functions</strong></span>: We can get the top 3 called functions by sorting and calling <code class="literal">stats</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>collision_demo.profile% sort calls</strong></span>
<span class="strong"><strong>collision_demo.profile% stats 3</strong></span>

<span class="strong"><strong>         380943 function calls (380200 primitive calls) in 18.056 seconds</strong></span>

<span class="strong"><strong>   Ordered by: call count</strong></span>
<span class="strong"><strong>   List reduced from 801 to 3 due to restriction &lt;3&gt;</strong></span>

<span class="strong"><strong>   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</strong></span>
<span class="strong"><strong>    52156    0.013    0.000    0.013    0.000 {method 'endswith' of 'str' objects}</strong></span>
<span class="strong"><strong>31505/31368    0.003    0.000    0.003    0.000 {len}</strong></span>
<span class="strong"><strong>    27573    0.022    0.000    0.022    0.000 {method 'lower' of 'str' objects}</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec43"/>How it works...</h2></div></div></div><p>We profiled the collision demo. The following table summarizes the profiler output:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Column</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Ncalls</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Number of calls</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Tottime</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Total time spent in a function</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Percall</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Time per call, calculated by dividing the total time by the calls count</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Cumtime</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Cumulative time spent in function and functions called by the function, including recursive calls</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Puzzle game with Pygame (Advanced)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec25"/>Puzzle game with Pygame (Advanced)</h1></div></div></div><p>We will pick up where we left in the networking example. This time we will create a puzzle game that lets us guess a word. This is just a prototype mind you. It still needs a lot of polishing.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec44"/>How to do it...</h2></div></div></div><p>The following steps will help you to create the intended puzzle game:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Server changes</strong></span>: The changes in the server are pretty trivial. We just check whether we guessed the correct word:<div class="informalexample"><pre class="programlisting">from twisted.internet import reactor, protocol

class Server(protocol.Protocol):
    def dataReceived(self, msg):
         resp = '*' * 20
         print msg

         if msg == 'secret':
            resp = msg

         self.transport.write(resp)



def main():
    factory = protocol.ServerFactory()
    factory.protocol = Server
    reactor.listenTCP(8888,factory)
    reactor.run()

if __name__ == '__main__':
    main()</pre></div></li><li class="listitem"><span class="strong"><strong>Client changes</strong></span>: The most important changes are the handling of key presses in an input box and handling of the response from the server. The input box lets us type text, edit it with the <span class="emphasis"><em>Backspace</em></span> key, and submit with the <span class="emphasis"><em>Enter</em></span> key. A label above the textbox displays the number of attempts and the game status. We use a Twisted looping callback to update the GUI every 30 milliseconds:<div class="informalexample"><pre class="programlisting">from twisted.internet import reactor, protocol
from pygame.locals import *
import pygame
from twisted.internet.task import LoopingCall

class Client(protocol.Protocol):
    def __init__(self):
       self.STARS = '*' * 20
       self.msg = self.STARS
       self.font = pygame.font.Font(None, 22)
       self.screen = pygame.display.get_surface()
       self.label = 'Guess the word:'
       self.attempts = 0


    def sendMessage(self, msg):
        self.transport.write(msg)

    def dataReceived(self, msg):
       self.msg = msg 

       if self.msg != self.STARS:
         self.label = 'YOU WIN!!!!'

       self.update_prompt()

    def update_prompt(self):
        self.screen.fill((255, 255, 255))
        BG = (0, 255, 0)
        FG = (0, 0, 0)

        pygame.draw.rect(self.screen, BG, (100, 200, 200, 20))

        self.screen.blit(self.font.render(self.msg, 1, FG), (100, 200))
        self.screen.blit(self.font.render("%d %s" % (self.attempts, self.label), 1, FG), 
              (140, 180))
        pygame.display.flip()
    
def handle_events(p):
   while True:
      for event in pygame.event.get():
         if event.type == QUIT:
            reactor.stop()
            return
         elif event.type == KEYDOWN:
            key = event.key

            if p.msg == '*' * 20:
               p.msg = ''

            if key == K_BACKSPACE:
               p.msg = p.msg[0:-1]
               p.update_prompt()
            elif key == K_RETURN:
               p.attempts += 1
               p.sendMessage(p.msg)
               return
            elif ord('a') &lt;= key &lt;= ord('z'):
               p.msg += chr(key)
               p.update_prompt()

def send(p):
   p.update_prompt()
   tick = LoopingCall(handle_events, p)
   tick.start(.03)


def main():
    pygame.init()
    screen = pygame.display.set_mode((400, 400))
    pygame.display.set_caption('Puzzle Demo')

    c = protocol.ClientCreator(reactor, Client)
    c.connectTCP("localhost", 8888).addCallback(send)
    reactor.run()

if __name__ == '__main__':
    main()</pre></div><p>The following screenshot was taken after guessing the word:</p></li></ol></div><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_14.jpg"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec45"/>How it works...</h2></div></div></div><p>Although this seems to be a pretty extensive recipe, only a few lines of the code might require some explanation:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">LoopingCall(handle_events, p)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates a looping callback. A callback function that is called periodically.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tick.start(.03)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This starts the looping callback with a period of 30 milliseconds.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Simulating with Pygame (Advanced)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec26"/>Simulating with Pygame (Advanced)</h1></div></div></div><p>As the last example, we will simulate life with Conway's Game of Life. The original game of life is based on a few basic rules. We start out with a random configuration on a two-dimensional square grid. Each cell in the grid can be either dead or alive. This state depends on the eight neighbors of the cell. Convolution can be used to evaluate the basic rules of the game. We will need the SciPy package for the convolution bit.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec46"/>Getting ready</h2></div></div></div><p>Install SciPy with either of the following two commands:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">sudo pip install scipy</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">easy_install scipy</code></li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec47"/>How to do it...</h2></div></div></div><p>The following code is an implementation of Game of Life with some modifications:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Clicking once with the mouse draws a cross until we click again</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>R</em></span> key resets the grid to a random state</li><li class="listitem" style="list-style-type: disc">Pressing <span class="emphasis"><em>B</em></span> creates blocks based on the mouse position</li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>G</em></span> creates gliders</li></ul></div><p>The most important data structure in the code is a two-dimensional array holding the color values of the pixels on the game screen. This array is initialized with random values and then recalculated in the game loop. More information about the involved functions can be found in the next section. As previously mentioned, the following is the code:</p><div class="informalexample"><pre class="programlisting">import os, pygame
from pygame.locals import *
import numpy
from scipy import ndimage

def get_pixar(arr, weights):
  states = ndimage.convolve(arr, weights, mode='wrap')

  bools = (states == 13) | (states == 12 ) | (states == 3)

  return bools.astype(int)

def draw_cross(pixar):
   (posx, posy) = pygame.mouse.get_pos()
   pixar[posx, :] = 1
   pixar[:, posy] = 1

def random_init(n):
   return numpy.random.random_integers(0, 1, (n, n))

def draw_pattern(pixar, pattern):
     print pattern

     if pattern == 'glider':
      coords = [(0,1), (1,2), (2,0), (2,1), (2,2)]
     elif pattern == 'block':
      coords = [(3,3), (3,2), (2,3), (2,2)]
     elif pattern == 'exploder':
      coords = [(0,1), (1,2), (2,0), (2,1), (2,2), (3,3)]
     elif pattern == 'fpentomino':
      coords = [(2,3),(3,2),(4,2),(3,3),(3,4)]


     pos = pygame.mouse.get_pos()

     xs = numpy.arange(0, pos[0], 10)
     ys = numpy.arange(0, pos[1], 10)

     for x in xs:
        for y in ys:
           for i, j in coords:
               pixar[x + i, y + j] = 1


def main():
    pygame.init ()

    N = 400
    pygame.display.set_mode((N, N))
    pygame.display.set_caption("Life Demo")

    screen = pygame.display.get_surface()

    pixar = random_init(N)
    weights = numpy.array([[1,1,1], [1,10,1], [1,1,1]])

    cross_on = False

    while True:
       pixar = get_pixar(pixar, weights)

       if cross_on:
          draw_cross(pixar)

       pygame.surfarray.blit_array(screen, pixar * 255 ** 3)
       pygame.display.flip()

       for event in pygame.event.get():
         if event.type == QUIT:
             return
         if event.type == MOUSEBUTTONDOWN:
            cross_on = not cross_on
         if event.type == KEYDOWN:
            if event.key == ord('r'):
               pixar = random_init(N)
               print "Random init"
            if event.key == ord('g'):
               draw_pattern(pixar, 'glider')
            if event.key == ord('b'):
               draw_pattern(pixar, 'block')
            if event.key == ord('e'):
               draw_pattern(pixar, 'exploder')
            if event.key == ord('f'):
               draw_pattern(pixar, 'fpentomino')


if __name__ == '__main__':
    main()</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>You should be able to view a screencast on YouTube at <a class="ulink" href="https://www.youtube.com/watch?v=NNsU-yWTkXM">https://www.youtube.com/watch?v=NNsU-yWTkXM</a>.</p></div></div><p>A screenshot of the game in action is shown as follows:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/2865OS_15.jpg"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec48"/>How it works...</h2></div></div></div><p>We used some NumPy and SciPy functions that need explaining:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">ndimage.convolve(arr, weights, mode='wrap')</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This applies the convolve operation on the given array, using weights in wrap mode. The mode has to do with the array borders. See <a class="ulink" href="http://en.wikipedia.org/wiki/Convolution">http://en.wikipedia.org/wiki/Convolution</a> for the mathematical details.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">bools.astype(int)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This converts the array of Booleans to integers.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">numpy.arange(0, pos[0], 10)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates an array from <code class="literal">0</code> to <code class="literal">pos[0]</code> in steps of 10. So if <code class="literal">pos[0]</code> is equal to 1000, we will get 0, 10, 20 … 990.</p>
</td></tr></tbody></table></div></div></div></body></html>