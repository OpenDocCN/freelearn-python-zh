<html><head></head><body>
<section data-number="0.7" id="chapter-4-built-in-data-structures-part-1-lists-and-sets">
<h2 class="likechapterhead" data-number="0.7"><span><span class="kobospan" id="kobo.1.1">4</span></span><br class="tipbox1"/> <span id="x1-2240004"/><span class="kobospan" id="kobo.2.1">Built-In Data Structures Part 1: Lists and Sets</span></h2>
<p class="normal"><span class="kobospan" id="kobo.3.1">Python has a rich collection of built-in data structures. </span><span class="kobospan" id="kobo.3.2">These data</span><span id="dx1-224001"/><span class="kobospan" id="kobo.4.1"> structures are sometimes</span><span id="dx1-224002"/><span class="kobospan" id="kobo.5.1"> called ”containers” or ”collections” because they contain a collection of individual items. </span><span class="kobospan" id="kobo.5.2">These structures cover a wide variety of common programming situations.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.6.1">We’ll look at an overview of the various collections that are built in and what problems they solve. </span><span class="kobospan" id="kobo.6.2">After the overview, we will look at the list and set collections in detail.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.7.1">The built-in tuple and string types were part of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.8.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.9.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.10.1">1</span></span></a><span class="cmti-10x-x"><span class="kobospan" id="kobo.11.1">, </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.12.1">Numbers,</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.13.1">Strings, and Tuples</span></span></a><span class="kobospan" id="kobo.14.1">. </span><span class="kobospan" id="kobo.14.2">These structures are sequences, making them similar in many ways to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.15.1">list</span></span></span></span><span class="kobospan" id="kobo.16.1"> collection. </span><span class="kobospan" id="kobo.16.2">However, strings and tuples seem to have more in common with immutable numbers.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.17.1">The next chapter, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.18.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.19.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.20.1">5</span></span></a><span class="kobospan" id="kobo.21.1">, will look at dictionaries, as well as some more advanced topics also related to lists and sets. </span><span class="kobospan" id="kobo.21.2">In particular, it will look at how Python handles references to mutable collection objects. </span><span class="kobospan" id="kobo.21.3">This has consequences in the way functions need to be defined that accept lists or sets as parameters.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.22.1">In this chapter, we’ll look at the following recipes, all related to Python’s built-in data structures:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><a href="ch008_split_000.xhtml#x1-2250001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.23.1">Choosing a data structure</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.24.1">Building lists – literals, appending, and comprehensions</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.25.1">Slicing and dicing a list</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_000.xhtml#x1-2460004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.26.1">Shrinking lists – deleting, removing, and popping</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_001.xhtml#x1-2560005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.27.1">Writing list-related type hints</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_001.xhtml#x1-2620006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.28.1">Reversing a copy of a list</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_001.xhtml#x1-2670007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.29.1">Building sets – literals, adding, comprehensions, and operators</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_001.xhtml#x1-2750008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.30.1">Shrinking sets – remove(), pop(), and difference</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch008_split_001.xhtml#x1-2800009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.31.1">Writing set-related type hints</span></span></a></p></li>
</ul>
<p class="normal1"><span id="x1-224003r421"/></p>
<section data-number="0.7.1" id="choosing-a-data-structure">
<h1 class="unnumbered" data-number="0.7.1"><span><span class="kobospan" id="kobo.32.1">4.1 </span></span> <span id="x1-2250001"/><span class="kobospan" id="kobo.33.1">Choosing a data structure</span></h1>
<p class="normal"><span class="kobospan" id="kobo.34.1">Python offers a number of built-in data structures</span><span id="dx1-225001"/><span class="kobospan" id="kobo.35.1"> to help us work with collections of data. </span><span class="kobospan" id="kobo.35.2">It can be confusing to match the data structure features with the problem we’re trying to solve.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.36.1">How do we choose which structure to use? </span><span id="x1-225002r419"/></p>
<section data-number="0.7.1.1" id="getting-ready-30">
<h2 class="likechapterhead" data-number="0.7.1.1"><span><span class="kobospan" id="kobo.37.1">4.1.1 </span></span> <span id="x1-2260001"/><span class="kobospan" id="kobo.38.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.39.1">Before we put data into a collection, we’ll need to consider how we’ll gather the data, and what we’ll do with the collection once we have it. </span><span class="kobospan" id="kobo.39.2">One big question is how to identify a particular item within the collection. </span><span class="kobospan" id="kobo.39.3">Python offers a variety of choices. </span><span id="x1-226001r425"/></p>
</section>
<section data-number="0.7.1.2" id="how-to-do-it...-30">
<h2 class="likechapterhead" data-number="0.7.1.2"><span><span class="kobospan" id="kobo.40.1">4.1.2 </span></span> <span id="x1-2270002"/><span class="kobospan" id="kobo.41.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-227002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.42.1">Is the programming focused on the existence of a value? </span><span class="kobospan" id="kobo.42.2">An example of this is validating an input value. </span><span class="kobospan" id="kobo.42.3">When the user enters something that’s in a collection, their input is valid; otherwise, the entry is invalid. </span><span class="kobospan" id="kobo.42.4">Simple membership tests suggest using a set:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.43.1">def confirm() -&gt; bool: 
 
    yes = {"yes", "y"} 
 
    no = {"no", "n"} 
 
    while (answer := input("Confirm: ")).lower() not in (yes | no): 
 
        print("Please respond with yes or no") 
 
    return answer in yes</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.44.1">A set holds items in no particular order. </span><span class="kobospan" id="kobo.44.2">If order matters, then a list is more appropriate.</span></p>
</div></li>
<li class="calibre7"><div id="x1-227011x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.45.1">Are we going to identify items</span><span id="dx1-227012"/><span class="kobospan" id="kobo.46.1"> by their position in the collection? </span><span class="kobospan" id="kobo.46.2">An example includes the lines in an input file—the line number is its position in the collection. </span><span class="kobospan" id="kobo.46.3">When we identify an item using an index or position, we must use a list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.47.1">&gt;&gt;&gt; month_name_list = ["Jan", "Feb", "Mar", "Apr", 
 
... </span><span class="kobospan" id="kobo.47.2">"May", "Jun", "Jul", "Aug", 
 
... </span><span class="kobospan" id="kobo.47.3">"Sep", "Oct", "Nov", "Dec"] 
 
&gt;&gt;&gt; month_name_list[8] 
 
’Sep’ 
 
&gt;&gt;&gt; month_name_list.index("Feb") 
 
1</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.48.1">We have created a list, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.49.1">month_name_list</span></span></span></span><span class="kobospan" id="kobo.50.1">, with 12 string items in a specific order. </span><span class="kobospan" id="kobo.50.2">We can pick an item by providing the index position. </span><span class="kobospan" id="kobo.50.3">We can also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.51.1">index()</span></span></span></span><span class="kobospan" id="kobo.52.1"> method to return the index position of an item in the list. </span><span class="kobospan" id="kobo.52.2">List index values in Python always start with zero. </span><span class="kobospan" id="kobo.52.3">While a list has a simple membership test, the test can be slow for a very large list, and a set might be a better idea if many such tests will be needed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.53.1">If the number of items in the collection is fixed—for example, RGB colors have three values—this suggests a tuple instead of a list. </span><span class="kobospan" id="kobo.53.2">If the number of items will grow and change, then the list collection is a better choice than the tuple collection.</span></p>
</div></li>
<li class="calibre7"><div id="x1-227022x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.54.1">Are we going to identify the items in a collection by a key value that’s distinct from the item’s index? </span><span class="kobospan" id="kobo.54.2">An example might include a mapping between strings of characters—words, for example—and integers that represent the frequencies of those words. </span><span class="kobospan" id="kobo.54.3">Another example might be a mapping between a color name and the RGB tuple for that color. </span><span class="kobospan" id="kobo.54.4">We’ll look at mappings and dictionaries in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.55.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.56.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.57.1">5</span></span></a><span class="cmti-10x-x"><span class="kobospan" id="kobo.58.1">, </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.59.1">Built-In Data</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.60.1">Structures Part 2: Dictionaries</span></span></a><span class="kobospan" id="kobo.61.1">. </span><span class="kobospan" id="kobo.61.2">The important distinction is mappings do not locate items by a numerical index position the way lists do.</span></p>
</div></li>
<li class="calibre7"><div id="x1-227024x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.62.1">Consider the mutability of items</span><span id="dx1-227025"/><span class="kobospan" id="kobo.63.1"> in a set collection (and the keys in a dictionary). </span><span class="kobospan" id="kobo.63.2">Each item in a set must be an immutable object. </span><span class="kobospan" id="kobo.63.3">Numbers, strings, and tuples are all immutable and can be collected into sets. </span><span class="kobospan" id="kobo.63.4">Since list, dictionary, and set objects are mutable, they can’t be used as items in a set. </span><span class="kobospan" id="kobo.63.5">It’s impossible to build a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.64.1">set</span></span></span></span><span class="kobospan" id="kobo.65.1"> of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.66.1">list</span></span></span></span><span class="kobospan" id="kobo.67.1"> objects, for example.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.68.1">Rather than create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.69.1">set</span></span></span></span><span class="kobospan" id="kobo.70.1"> of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.71.1">list</span></span></span></span><span class="kobospan" id="kobo.72.1"> items, we can transform each item into an immutable </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.73.1">tuple</span></span></span></span><span class="kobospan" id="kobo.74.1"> object. </span><span class="kobospan" id="kobo.74.2">Similarly, dictionary keys must be immutable. </span><span class="kobospan" id="kobo.74.3">We can use a number, a string, or a tuple as a dictionary key. </span><span class="kobospan" id="kobo.74.4">We can’t use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.75.1">list</span></span></span></span><span class="kobospan" id="kobo.76.1">, or a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.77.1">set</span></span></span></span><span class="kobospan" id="kobo.78.1">, or any other mutable object as a dictionary key.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-227026r426"/></p>
</section>
<section data-number="0.7.1.3" id="how-it-works...-30">
<h2 class="likechapterhead" data-number="0.7.1.3"><span><span class="kobospan" id="kobo.79.1">4.1.3 </span></span> <span id="x1-2280003"/><span class="kobospan" id="kobo.80.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.81.1">Each of Python’s built-in collections offers a specific set of unique features. </span><span class="kobospan" id="kobo.81.2">The collections also offer a large number of overlapping features. </span><span class="kobospan" id="kobo.81.3">The challenge for programmers new to Python is to map the unique features of each collection to the problem they are trying to solve.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.82.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.83.1">collections.abc</span></span></span></span><span class="kobospan" id="kobo.84.1"> module provides a kind of road map through the built-in container classes. </span><span class="kobospan" id="kobo.84.2">This module defines the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.85.1">Abstract Base Classes </span></span><span class="kobospan" id="kobo.86.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.87.1">ABC</span></span><span class="kobospan" id="kobo.88.1">s) underlying the concrete classes we use. </span><span class="kobospan" id="kobo.88.2">We’ll use the names from this set of definitions to guide us through the features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.89.1">From the ABCs, we can see that there are places for a total of three general kinds of collections with six implementation choices:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.90.1">Set</span></span><span class="kobospan" id="kobo.91.1">: Its unique feature is that items</span><span id="dx1-228001"/><span class="kobospan" id="kobo.92.1"> are either members or not. </span><span class="kobospan" id="kobo.92.2">This means duplicates are ignored:</span></p>
<ul class="calibre25">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.93.1">Mutable set</span></span><span class="kobospan" id="kobo.94.1">: The built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.95.1">set</span></span></span></span><span id="dx1-228002"/><span class="kobospan" id="kobo.96.1"> collection</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.97.1">Immutable set</span></span><span class="kobospan" id="kobo.98.1">: The built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.99.1">frozenset</span></span></span></span><span id="dx1-228003"/><span class="kobospan" id="kobo.100.1"> collection</span></p></li>
</ul></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.101.1">Sequence</span></span><span class="kobospan" id="kobo.102.1">: Its unique feature is that items</span><span id="dx1-228004"/><span class="kobospan" id="kobo.103.1"> are provided</span><span id="dx1-228005"/><span class="kobospan" id="kobo.104.1"> with an index position:</span></p>
<ul class="calibre25">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.105.1">Mutable sequence</span></span><span class="kobospan" id="kobo.106.1">: The built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.107.1">list</span></span></span></span><span class="kobospan" id="kobo.108.1"> collection</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.109.1">Immutable sequence</span></span><span class="kobospan" id="kobo.110.1">: The built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.111.1">tuple</span></span></span></span><span class="kobospan" id="kobo.112.1"> collection. </span><span class="kobospan" id="kobo.112.2">This is the subject</span><span id="dx1-228006"/><span class="kobospan" id="kobo.113.1"> of some recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.114.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.115.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.116.1">1</span></span></a><span class="kobospan" id="kobo.117.1">.</span></p></li>
</ul></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.118.1">Mapping</span></span><span class="kobospan" id="kobo.119.1">: Its unique feature is that each item has a key that refers to a value:</span></p>
<ul class="calibre25">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.120.1">Mutable mapping</span></span><span class="kobospan" id="kobo.121.1">: The built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.122.1">dict</span></span></span></span><span class="kobospan" id="kobo.123.1"> collection. </span><span class="kobospan" id="kobo.123.2">This is the subject</span><span id="dx1-228007"/><span class="kobospan" id="kobo.124.1"> of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.125.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.126.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.127.1">5</span></span></a><span class="kobospan" id="kobo.128.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.129.1">Immutable mapping</span></span><span class="kobospan" id="kobo.130.1">: Interestingly, there’s no built-in frozen</span><span id="dx1-228008"/><span class="kobospan" id="kobo.131.1"> mapping.</span></p></li>
</ul></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.132.1">Python’s libraries offer additional implementations</span><span id="dx1-228009"/><span class="kobospan" id="kobo.133.1"> of these core collection types. </span><span class="kobospan" id="kobo.133.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.134.1">collections</span></span></span></span><span class="kobospan" id="kobo.135.1"> module include:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.136.1">namedtuple</span></span></span></span><span class="kobospan" id="kobo.137.1">: A tuple that offers names for each item in a tuple. </span><span class="kobospan" id="kobo.137.2">It’s slightly clearer to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.138.1">rgb_color.red</span></span></span></span><span class="kobospan" id="kobo.139.1"> than </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.140.1">rgb_color[0]</span></span></span></span><span class="kobospan" id="kobo.141.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.142.1">deque</span></span></span></span><span class="kobospan" id="kobo.143.1">: A double-ended queue. </span><span class="kobospan" id="kobo.143.2">It’s a mutable sequence with optimizations for pushing and popping from each end. </span><span class="kobospan" id="kobo.143.3">We can do similar things with a list, but deque is more efficient when changes at both ends are needed.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.144.1">defaultdict</span></span></span></span><span class="kobospan" id="kobo.145.1">: A dict that can provide a default value for a missing key.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.146.1">Counter</span></span></span></span><span class="kobospan" id="kobo.147.1">: A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.148.1">dict</span></span></span></span><span class="kobospan" id="kobo.149.1"> that is designed to count occurrences of a key. </span><span class="kobospan" id="kobo.149.2">This is sometimes</span><span id="dx1-228010"/><span id="dx1-228011"/><span class="kobospan" id="kobo.150.1"> called a multiset or a bag.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.151.1">ChainMap</span></span></span></span><span class="kobospan" id="kobo.152.1">: A dict that combines several dictionaries into a single mapping.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.153.1">Additionally, there’s an older </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.154.1">OrderedDict</span></span></span></span><span class="kobospan" id="kobo.155.1"> class. </span><span class="kobospan" id="kobo.155.2">This class retains the keys in the order in which they were created. </span><span class="kobospan" id="kobo.155.3">Starting with Python 3.7, the dictionary keys for an ordinary dictionary are retained in the order they were created, making</span><span id="dx1-228012"/><span class="kobospan" id="kobo.156.1"> the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.157.1">OrderedDict</span></span></span></span><span class="kobospan" id="kobo.158.1"> class redundant. </span><span id="x1-228013r429"/></p>
</section>
<section data-number="0.7.1.4" id="theres-more...-24">
<h2 class="likechapterhead" data-number="0.7.1.4"><span><span class="kobospan" id="kobo.159.1">4.1.4 </span></span> <span id="x1-2290004"/><span class="kobospan" id="kobo.160.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.161.1">There’s still more in the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.162.1">Python Standard Library</span></span><span class="kobospan" id="kobo.163.1">. </span><span class="kobospan" id="kobo.163.2">We can also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.164.1">heapq</span></span></span></span><span class="kobospan" id="kobo.165.1"> module, which defines a kind of list that acts as a high-performance priority queue. </span><span class="kobospan" id="kobo.165.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.166.1">bisect</span></span></span></span><span class="kobospan" id="kobo.167.1"> module includes methods for searching a sorted list very quickly. </span><span class="kobospan" id="kobo.167.2">This lets us create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.168.1">list</span></span></span></span><span class="kobospan" id="kobo.169.1"> object, which can have performance that is a little closer to the very fast lookups of a dictionary.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.170.1">We can find descriptions of data structures</span><span id="dx1-229001"/><span class="kobospan" id="kobo.171.1"> on summary web pages, like this one: </span><a class="url" href="https://thealgorist.com"><span class="url1"><span class="kobospan" id="kobo.172.1">https://thealgorist.com</span></span></a><span class="kobospan" id="kobo.173.1">. </span><span class="kobospan" id="kobo.173.2">We’ll take a quick look at four additional families of data structures:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.174.1">Arrays</span></span><span class="kobospan" id="kobo.175.1">: The Python </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.176.1">array</span></span></span></span><span class="kobospan" id="kobo.177.1"> module supports</span><span id="dx1-229002"/><span class="kobospan" id="kobo.178.1"> densely packed arrays of values. </span><span class="kobospan" id="kobo.178.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.179.1">numpy</span></span></span></span><span class="kobospan" id="kobo.180.1"> module also offers very sophisticated array processing.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.181.1">Trees</span></span><span class="kobospan" id="kobo.182.1">: Generally, tree structures</span><span id="dx1-229003"/><span class="kobospan" id="kobo.183.1"> can be used to create sets, sequential lists, or key-value mappings. </span><span class="kobospan" id="kobo.183.2">We can look at a tree as an implementation technique for building sets or dictionaries. </span><span class="kobospan" id="kobo.183.3">We often build tree structures using objects and class definitions.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.184.1">Hashes</span></span><span class="kobospan" id="kobo.185.1">: Python uses hashes to implement</span><span id="dx1-229004"/><span class="kobospan" id="kobo.186.1"> dictionaries and sets. </span><span class="kobospan" id="kobo.186.2">This leads to good speed but potentially large memory consumption.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.187.1">Graphs</span></span><span class="kobospan" id="kobo.188.1">: Python doesn’t have a built-in graph</span><span id="dx1-229005"/><span class="kobospan" id="kobo.189.1"> data structure. </span><span class="kobospan" id="kobo.189.2">However, we can easily represent a graph structure with a dictionary where each node</span><span id="dx1-229006"/><span class="kobospan" id="kobo.190.1"> has a list</span><span id="dx1-229007"/><span class="kobospan" id="kobo.191.1"> of adjacent</span><span id="dx1-229008"/><span class="kobospan" id="kobo.192.1"> nodes. </span><span class="kobospan" id="kobo.192.2">External libraries like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.193.1">NetworkX</span></span><span class="kobospan" id="kobo.194.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.195.1">Pyoxigraph</span></span><span class="kobospan" id="kobo.196.1">, and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.197.1">RDFLib </span></span><span class="kobospan" id="kobo.198.1">support sophisticated graph databases.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.199.1">We can—with a little cleverness—implement almost any kind of data structure in Python. </span><span class="kobospan" id="kobo.199.2">While it’s often the case that the built-in structures have the essential we may be able to locate a built-in structure that can be pressed into service. </span><span class="kobospan" id="kobo.199.3">We’ll look at mappings and dictionaries in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.200.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.201.1"> </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.202.1">5</span></span></a><span class="cmti-10x-x"><span class="kobospan" id="kobo.203.1">, </span></span><a href="ch009.xhtml#x1-2890005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.204.1">Built-In Data Structures</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.205.1">Part 2: Dictionaries</span></span></a><span class="kobospan" id="kobo.206.1">. </span><span id="x1-229009r430"/></p>
</section>
<section data-number="0.7.1.5" id="see-also-30">
<h2 class="likechapterhead" data-number="0.7.1.5"><span><span class="kobospan" id="kobo.207.1">4.1.5 </span></span> <span id="x1-2300005"/><span class="kobospan" id="kobo.208.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.209.1">For high-performance array</span><span id="dx1-230001"/><span class="kobospan" id="kobo.210.1"> processing, see </span><a class="url" href="https://numpy.org"><span class="url1"><span class="kobospan" id="kobo.211.1">https://numpy.org</span></span></a><span class="kobospan" id="kobo.212.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.213.1">For advanced graph</span><span id="dx1-230002"/><span class="kobospan" id="kobo.214.1"> analysis, see </span><a class="url" href="https://networkx.github.io"><span class="url1"><span class="kobospan" id="kobo.215.1">https://networkx.github.io</span></span></a><span class="kobospan" id="kobo.216.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.217.1">For graph manipulation</span><span id="dx1-230003"/><span class="kobospan" id="kobo.218.1"> and storage, see </span><a class="url" href="https://pyoxigraph.readthedocs.io/en/stable/"><span class="url1"><span class="kobospan" id="kobo.219.1">https://pyoxigraph.readthedocs.io/en/stable/</span></span></a><span class="kobospan" id="kobo.220.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.221.1">For graph</span><span id="dx1-230004"/><span class="kobospan" id="kobo.222.1"> manipulation, see </span><a class="url" href="https://rdflib.readthedocs.io/en/stable/"><span class="url1"><span class="kobospan" id="kobo.223.1">https://rdflib.readthedocs.io/en/stable/</span></span></a><span class="kobospan" id="kobo.224.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-230005r424"/></p>
</section>
</section>
<section data-number="0.7.2" id="building-lists-literals-appending-and-comprehensions">
<h1 class="unnumbered" data-number="0.7.2"><span><span class="kobospan" id="kobo.225.1">4.2 </span></span> <span id="x1-2310002"/><span class="kobospan" id="kobo.226.1">Building lists – literals, appending, and comprehensions</span></h1>
<p class="normal"><span class="kobospan" id="kobo.227.1">If we’ve decided to create a collection</span><span id="dx1-231001"/><span class="kobospan" id="kobo.228.1"> based on each item’s position in the container—a list—we have several ways of building this structure. </span><span class="kobospan" id="kobo.228.2">We’ll look at a number of ways we can assemble a list object from the individual items.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.229.1">In some cases, we’ll need a list because it allows duplicate values, unlike a set. </span><span class="kobospan" id="kobo.229.2">This is common in statistical work. </span><span class="kobospan" id="kobo.229.3">A different</span><span id="dx1-231002"/><span class="kobospan" id="kobo.230.1"> structure, called a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.231.1">multiset</span></span><span class="kobospan" id="kobo.232.1">, can also be useful for a statistically oriented collection that permits duplicates. </span><span class="kobospan" id="kobo.232.2">This collection is available in the standard library as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.233.1">collections.Counter</span></span></span></span><span class="kobospan" id="kobo.234.1">. </span><span id="x1-231003r431"/></p>
<section data-number="0.7.2.1" id="getting-ready-31">
<h2 class="likechapterhead" data-number="0.7.2.1"><span><span class="kobospan" id="kobo.235.1">4.2.1 </span></span> <span id="x1-2320001"/><span class="kobospan" id="kobo.236.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.237.1">Let’s say we need to do some statistical analyses of some file sizes. </span><span class="kobospan" id="kobo.237.2">Here’s a short script that will provide us with the sizes of some files:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.238.1">&gt;&gt;&gt; from pathlib import Path 
 
&gt;&gt;&gt; home = Path.cwd() / "data" 
 
&gt;&gt;&gt; for path in sorted(home.glob(’*.csv’)): 
 
... </span><span class="kobospan" id="kobo.238.2">    print(path.stat().st_size, path.name) 
 
260 binned.csv 
 
250 ch14_r03.csv 
 
2060 ch14_r04.csv 
 
45 craps.csv 
 
225 fuel.csv 
 
156 fuel2.csv 
 
28 output.csv 
 
19760 output_0.csv 
 
19860 output_1.csv 
 
19645 output_2.csv 
 
19971 output_3.csv 
 
19588 output_4.csv 
 
...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.239.1">We’ve used a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.240.1">pathlib.Path</span></span></span></span><span class="kobospan" id="kobo.241.1"> object to represent a directory in our filesystem. </span><span class="kobospan" id="kobo.241.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.242.1">glob()</span></span></span></span><span class="kobospan" id="kobo.243.1"> method expands all names that match a given pattern.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.244.1">We’d like to accumulate a list object</span><span id="dx1-232019"/><span class="kobospan" id="kobo.245.1"> that has the various file sizes. </span><span class="kobospan" id="kobo.245.2">From that list, we can compute the total size and average size. </span><span id="x1-232020r433"/></p>
</section>
<section data-number="0.7.2.2" id="how-to-do-it...-31">
<h2 class="likechapterhead" data-number="0.7.2.2"><span><span class="kobospan" id="kobo.246.1">4.2.2 </span></span> <span id="x1-2330002"/><span class="kobospan" id="kobo.247.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.248.1">We have many ways to create list objects:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.249.1">Literal</span></span><span class="kobospan" id="kobo.250.1">: We can create a literal</span><span id="dx1-233001"/><span class="kobospan" id="kobo.251.1"> display of a list using a sequence of values surrounded by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.252.1">[]</span></span></span></span><span class="kobospan" id="kobo.253.1"> characters. </span><span class="kobospan" id="kobo.253.2">For example, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.254.1">[1,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.255.1"> 2,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.256.1"> 3]</span></span></span></span><span class="kobospan" id="kobo.257.1">. </span><span class="kobospan" id="kobo.257.2">Python needs to match an opening </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.258.1">[</span></span></span></span><span class="kobospan" id="kobo.259.1"> and a closing </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.260.1">]</span></span></span></span><span class="kobospan" id="kobo.261.1"> to see a complete logical line, so the literal can span physical lines. </span><span class="kobospan" id="kobo.261.2">For more information, refer to the </span><a href="ch006_split_000.xhtml#x1-910002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.262.1">Writing long lines of code</span></span></a><span class="kobospan" id="kobo.263.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.264.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.265.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.266.1">2</span></span></a><span class="kobospan" id="kobo.267.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.268.1">Conversion function</span></span><span class="kobospan" id="kobo.269.1">: We can convert some other data</span><span id="dx1-233002"/><span class="kobospan" id="kobo.270.1"> collection into a list using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.271.1">list()</span></span></span></span><span class="kobospan" id="kobo.272.1"> function.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.273.1">Append method</span></span><span class="kobospan" id="kobo.274.1">: We have list methods that allow</span><span id="dx1-233003"/><span class="kobospan" id="kobo.275.1"> us to build a list one item at a time. </span><span class="kobospan" id="kobo.275.2">These methods include </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.276.1">append()</span></span></span></span><span class="kobospan" id="kobo.277.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.278.1">extend()</span></span></span></span><span class="kobospan" id="kobo.279.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.280.1">insert()</span></span></span></span><span class="kobospan" id="kobo.281.1">. </span><span class="kobospan" id="kobo.281.2">We’ll look at the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.282.1">append()</span></span></span></span><span class="kobospan" id="kobo.283.1"> method in the </span><a href="ch008_split_000.xhtml#x1-2340002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.284.1">Building a list</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.285.1">with the append() method</span></span></a><span class="kobospan" id="kobo.286.1"> section of this recipe.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.287.1">Comprehension</span></span><span class="kobospan" id="kobo.288.1">: A comprehension is a specialized</span><span id="dx1-233004"/><span class="kobospan" id="kobo.289.1"> generator expression that computes a list from a source object. </span><span class="kobospan" id="kobo.289.2">We’ll look at this in detail in the </span><a href="ch008_split_000.xhtml#x1-2350002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.290.1">Writing a list comprehension</span></span></a><span class="kobospan" id="kobo.291.1"> section of this recipe.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.292.1">The first two ways to create a list are single Python expressions. </span><span class="kobospan" id="kobo.292.2">The last two are more complex, and we’ll show recipes for each of them.</span></p>
<section data-number="0.7.2.2.1" id="building-a-list-with-the-append-method">
<h3 class="likesubsubsectionhead" data-number="0.7.2.2.1"><span id="x1-2340002"/><span class="kobospan" id="kobo.293.1">Building a list with the append() method</span></h3>
<ol class="calibre2">
<li class="calibre7"><div id="x1-234002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.294.1">Create an empty</span><span id="dx1-234003"/><span class="kobospan" id="kobo.295.1"> list using</span><span id="dx1-234004"/><span class="kobospan" id="kobo.296.1"> literal syntax, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.297.1">[]</span></span></span></span><span class="kobospan" id="kobo.298.1">, or the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.299.1">list()</span></span></span></span><span class="kobospan" id="kobo.300.1"> function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.301.1">&gt;&gt;&gt; file_sizes = []</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-234008x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.302.1">Iterate through some source of data. </span><span class="kobospan" id="kobo.302.2">Append the items to the list using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.303.1">append()</span></span></span></span><span class="kobospan" id="kobo.304.1"> method:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.305.1">&gt;&gt;&gt; home = Path.cwd() / "data" 
 
&gt;&gt;&gt; for path in sorted(home.glob(’*.csv’)): 
 
... </span><span class="kobospan" id="kobo.305.2">    file_sizes.append(path.stat().st_size) 
 
 
 
&gt;&gt;&gt; print(file_sizes) 
 
[260, 250, 2060, 45, 225, 156, 28, 19760, 19860, 19645, 19971, 19588, 19999, 20000, 20035, 19739, 19941, 215, 412, 28, 166, 0, 1810, 0, 0, 16437, 20295] 
 
&gt;&gt;&gt; print(sum(file_sizes)) 
 
240925</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.306.1">When we print the list, Python displays it in literal notation. </span><span class="kobospan" id="kobo.306.2">This is handy if we ever need to copy and paste the list into another script.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.307.1">It’s very important to note</span><span id="dx1-234018"/><span class="kobospan" id="kobo.308.1"> that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.309.1">append()</span></span></span></span><span class="kobospan" id="kobo.310.1"> method does not return</span><span id="dx1-234019"/><span class="kobospan" id="kobo.311.1"> a value. </span><span class="kobospan" id="kobo.311.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.312.1">append()</span></span></span></span><span class="kobospan" id="kobo.313.1"> method mutates the list object, and does not return anything.</span></p>
</section>
<section data-number="0.7.2.2.2" id="writing-a-list-comprehension">
<h3 class="likesubsubsectionhead" data-number="0.7.2.2.2"><span id="x1-2350002"/><span class="kobospan" id="kobo.314.1">Writing a list comprehension</span></h3>
<p class="normal"><span class="kobospan" id="kobo.315.1">The goal of a list comprehension</span><span id="dx1-235001"/><span class="kobospan" id="kobo.316.1"> is to create an object that occupies the syntax role of a literal:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-235003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.317.1">Write the wrapping </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.318.1">[]</span></span></span></span><span class="kobospan" id="kobo.319.1"> brackets that surround the list object to be built.</span></p>
</div></li>
<li class="calibre7"><div id="x1-235005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.320.1">Write the source of the data. </span><span class="kobospan" id="kobo.320.2">This will include the target variable. </span><span class="kobospan" id="kobo.320.3">Note that there’s no </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.321.1">:</span></span></span></span><span class="kobospan" id="kobo.322.1"> at the end of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.323.1">for</span></span></span></span><span class="kobospan" id="kobo.324.1"> clause because we’re not writing a complete statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.325.1">[... </span><span class="kobospan" id="kobo.325.2">for path in home.glob(’*.csv’)]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-235009x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.326.1">Prefix the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.327.1">for</span></span></span></span><span class="kobospan" id="kobo.328.1"> clause with an expression to evaluate to create each value that goes into the sequence from the value of target variable. </span><span class="kobospan" id="kobo.328.2">Again, since this is only a single expression, we cannot use complex statements here:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.329.1">[path.stat().st_size 
 
  for path in home.glob(’*.csv’)]</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.330.1">Here’s an example of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.331.1">list</span></span></span></span><span class="kobospan" id="kobo.332.1"> object construction:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.333.1">&gt;&gt;&gt; [path.stat().st_size 
 
... </span><span class="kobospan" id="kobo.333.2">    for path in sorted(home.glob(’*.csv’))] 
 
[260, 250, 2060, 45, 225, 156, 28, 19760, 19860, 19645, 19971, 19588, 19999, 20000, 20035, 19739, 19941, 215, 412, 28, 166, 0, 1810, 0, 0, 16437, 20295]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.334.1">Now that we’ve created a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.335.1">list</span></span></span></span><span class="kobospan" id="kobo.336.1"> object, we can assign it to a variable and do other calculations and summaries on the data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.337.1">The list comprehension is built around a central generator</span><span id="dx1-235017"/><span class="kobospan" id="kobo.338.1"> expression, called a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.339.1">comprehension </span></span><span class="kobospan" id="kobo.340.1">in the language manual. </span><span class="kobospan" id="kobo.340.2">The comprehension has two parts: the data expression clause and a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.341.1">for</span></span></span></span><span class="kobospan" id="kobo.342.1"> clause. </span><span class="kobospan" id="kobo.342.2">The data expression clause is evaluated repeatedly, driven by the variables assigned in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.343.1">for</span></span></span></span><span class="kobospan" id="kobo.344.1"> clause.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.345.1">We can replace the enclosing </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.346.1">[</span></span></span></span><span class="kobospan" id="kobo.347.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.348.1">]</span></span></span></span><span class="kobospan" id="kobo.349.1"> with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.350.1">list()</span></span></span></span><span class="kobospan" id="kobo.351.1"> function. </span><span class="kobospan" id="kobo.351.2">Using the explicit </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.352.1">list()</span></span></span></span><span class="kobospan" id="kobo.353.1"> function had an advantage</span><span id="dx1-235018"/><span class="kobospan" id="kobo.354.1"> when we consider the possibility of changing the data structure. </span><span class="kobospan" id="kobo.354.2">We can easily replace </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.355.1">list()</span></span></span></span><span class="kobospan" id="kobo.356.1"> with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.357.1">set()</span></span></span></span><span class="kobospan" id="kobo.358.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.359.1">Counter()</span></span></span></span><span class="kobospan" id="kobo.360.1"> to make use of the core generator, but creating a distinct collection type. </span><span id="x1-235019r435"/></p>
</section>
</section>
<section data-number="0.7.2.3" id="how-it-works...-31">
<h2 class="likechapterhead" data-number="0.7.2.3"><span><span class="kobospan" id="kobo.361.1">4.2.3 </span></span> <span id="x1-2360003"/><span class="kobospan" id="kobo.362.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.363.1">A Python </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.364.1">list</span></span></span></span><span class="kobospan" id="kobo.365.1"> object has a dynamic</span><span id="dx1-236001"/><span class="kobospan" id="kobo.366.1"> size. </span><span class="kobospan" id="kobo.366.2">The size is adjusted when items are appended or inserted, or the list is extended with items from another sequence. </span><span class="kobospan" id="kobo.366.3">Similarly, the size shrinks when items are popped or deleted.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.367.1">In rare cases, we might want to create a list with a given initial size, and then set the values of the items separately. </span><span class="kobospan" id="kobo.367.2">We can do this with a list comprehension, like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.368.1">&gt;&gt;&gt; sieve = [True for i in range(100)]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.369.1">This will create a list with an initial size of 100 items, each of which is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.370.1">True</span></span></span></span><span class="kobospan" id="kobo.371.1">. </span><span class="kobospan" id="kobo.371.2">We might need this kind of initialization to implement the </span><a href="https://math.libretexts.org/Bookshelves/Combinatorics_and_Discrete_Mathematics/Elementary_Number_Theory_(Raji)/02%3A_Prime_Numbers/2.01%3A_The_Sieve_of_Eratosthenes" class="url"><span class="kobospan" id="kobo.372.1">Sieve of Eratosthenes</span></a><span class="kobospan" id="kobo.373.1"> algorithm:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.374.1">&gt;&gt;&gt; sieve[0] = sieve[1] = False 
 
&gt;&gt;&gt; for p in range(100): 
 
... </span><span class="kobospan" id="kobo.374.2">    if sieve[p]: 
 
... </span><span class="kobospan" id="kobo.374.3">        for n in range(p*2, 100, p): 
 
... </span><span class="kobospan" id="kobo.374.4">            sieve[n] = False 
 
&gt;&gt;&gt; prime = [p for p in range(100) if sieve[p]]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.375.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.376.1">sieve</span></span></span></span><span class="kobospan" id="kobo.377.1"> collection has a sequence of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.378.1">True</span></span></span></span><span class="kobospan" id="kobo.379.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.380.1">False</span></span></span></span><span class="kobospan" id="kobo.381.1"> values. </span><span class="kobospan" id="kobo.381.2">The index position of each </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.382.1">True</span></span></span></span><span class="kobospan" id="kobo.383.1"> is a prime number. </span><span class="kobospan" id="kobo.383.2">Multiples of each prime, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.384.1">p</span></span><span class="kobospan" id="kobo.385.1">, starting with </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.386.1">p</span></span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.387.1">2</span></span></sup><span class="kobospan" id="kobo.388.1">, are set to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.389.1">False</span></span></span></span><span class="kobospan" id="kobo.390.1">. </span><span class="kobospan" id="kobo.390.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.391.1">prime</span></span></span></span><span class="kobospan" id="kobo.392.1"> collection is a sequence</span><span id="dx1-236011"/><span class="kobospan" id="kobo.393.1"> of values, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.394.1">p</span></span></span></span><span class="kobospan" id="kobo.395.1"> for which the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.396.1">sieve[p]</span></span></span></span><span class="kobospan" id="kobo.397.1"> is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.398.1">True</span></span></span></span><span class="kobospan" id="kobo.399.1">. </span><span id="x1-236012r443"/></p>
</section>
<section data-number="0.7.2.4" id="theres-more...-25">
<h2 class="likechapterhead" data-number="0.7.2.4"><span><span class="kobospan" id="kobo.400.1">4.2.4 </span></span> <span id="x1-2370004"/><span class="kobospan" id="kobo.401.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.402.1">A common goal for creating a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.403.1">list</span></span></span></span><span class="kobospan" id="kobo.404.1"> object is to be able to summarize it. </span><span class="kobospan" id="kobo.404.2">We can use a variety of Python functions for this. </span><span class="kobospan" id="kobo.404.3">Here are some examples:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.405.1">&gt;&gt;&gt; sizes = list(path.stat().st_size 
 
... </span><span class="kobospan" id="kobo.405.2">    for path in home.glob(’*.csv’)) 
 
&gt;&gt;&gt; sum(sizes) 
 
240925 
 
&gt;&gt;&gt; max(sizes) 
 
20295 
 
&gt;&gt;&gt; min(sizes) 
 
0 
 
&gt;&gt;&gt; from statistics import mean 
 
&gt;&gt;&gt; round(mean(sizes), 3) 
 
8923.148</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.406.1">We’ve used the built-in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.407.1">sum()</span></span></span></span><span class="kobospan" id="kobo.408.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.409.1">min()</span></span></span></span><span class="kobospan" id="kobo.410.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.411.1">max()</span></span></span></span><span class="kobospan" id="kobo.412.1"> methods to produce some descriptive statistics of these document sizes. </span><span class="kobospan" id="kobo.412.2">Which of these index files is the smallest? </span><span class="kobospan" id="kobo.412.3">We want to know the position of the minimum in the list of values. </span><span class="kobospan" id="kobo.412.4">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.413.1">index()</span></span></span></span><span class="kobospan" id="kobo.414.1"> method for this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.415.1">&gt;&gt;&gt; sizes.index(min(sizes)) 
 
1</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.416.1">We found the minimum, and then used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.417.1">index()</span></span></span></span><span class="kobospan" id="kobo.418.1"> method to locate the position of that minimal value.</span></p>
<section data-number="0.7.2.4.1" id="other-ways-to-extend-a-list">
<h3 class="likesubsubsectionhead" data-number="0.7.2.4.1"><span id="x1-2380004"/><span class="kobospan" id="kobo.419.1">Other ways to extend a list</span></h3>
<p class="normal"><span class="kobospan" id="kobo.420.1">We can extend a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.421.1">list</span></span></span></span><span class="kobospan" id="kobo.422.1"> object, as well as insert</span><span id="dx1-238001"/><span class="kobospan" id="kobo.423.1"> one into the middle or beginning of a list. </span><span class="kobospan" id="kobo.423.2">We have two ways to extend a list: we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.424.1">+</span></span></span></span><span class="kobospan" id="kobo.425.1"> operator or we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.426.1">extend()</span></span></span></span><span class="kobospan" id="kobo.427.1"> method. </span><span class="kobospan" id="kobo.427.2">Here’s an example of creating two lists and putting them together with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.428.1">+</span></span></span></span><span class="kobospan" id="kobo.429.1"> operator:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.430.1">&gt;&gt;&gt; home = Path.cwd() / "src" 
 
&gt;&gt;&gt; ch3 = list(path.stat().st_size 
 
... </span><span class="kobospan" id="kobo.430.2">    for path in home.glob(’ch03/*.py’)) 
 
&gt;&gt;&gt; ch4 = list(path.stat().st_size 
 
... </span><span class="kobospan" id="kobo.430.3">    for path in home.glob(’ch04/*.py’)) 
 
 
 
&gt;&gt;&gt; len(ch3) 
 
16 
 
&gt;&gt;&gt; len(ch4) 
 
6 
 
&gt;&gt;&gt; final = ch3 + ch4 
 
&gt;&gt;&gt; len(final) 
 
22 
 
&gt;&gt;&gt; sum(final) 
 
34853</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.431.1">We have created a list of sizes of documents with names like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.432.1">Chapter_03/*.py</span></span></span></span><span class="kobospan" id="kobo.433.1">. </span><span class="kobospan" id="kobo.433.2">We then created a second list of sizes of documents with a slightly different name pattern, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.434.1">Chapter_04/*.py</span></span></span></span><span class="kobospan" id="kobo.435.1">. </span><span class="kobospan" id="kobo.435.2">We then combined the two lists into a final list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.436.1">We can insert a value prior to any particular position in a list. </span><span class="kobospan" id="kobo.436.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.437.1">insert()</span></span></span></span><span class="kobospan" id="kobo.438.1"> method accepts the position of an item; the new value will be before the given position:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.439.1">&gt;&gt;&gt; p = [3, 5, 11, 13] 
 
&gt;&gt;&gt; p.insert(0, 2) 
 
&gt;&gt;&gt; p 
 
[2, 3, 5, 11, 13] 
 
 
 
&gt;&gt;&gt; p.insert(3, 7) 
 
&gt;&gt;&gt; p 
 
[2, 3, 5, 7, 11, 13]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.440.1">We’ve inserted two new values</span><span id="dx1-238027"/><span class="kobospan" id="kobo.441.1"> into a list object. </span><span class="kobospan" id="kobo.441.2">As with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.442.1">append()</span></span></span></span><span class="kobospan" id="kobo.443.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.444.1">extend()</span></span></span></span><span class="kobospan" id="kobo.445.1"> methods, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.446.1">insert()</span></span></span></span><span class="kobospan" id="kobo.447.1"> method does not return a value. </span><span class="kobospan" id="kobo.447.2">It mutates the list object. </span><span id="x1-238028r446"/></p>
</section>
</section>
<section data-number="0.7.2.5" id="see-also-31">
<h2 class="likechapterhead" data-number="0.7.2.5"><span><span class="kobospan" id="kobo.448.1">4.2.5 </span></span> <span id="x1-2390005"/><span class="kobospan" id="kobo.449.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.450.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.451.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.452.1"> recipe for ways to copy lists and pick sublists from a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.453.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2460004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.454.1">Shrinking lists – deleting, removing, and popping</span></span></a><span class="kobospan" id="kobo.455.1"> recipe for other ways to remove items from a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.456.1">In the </span><a href="ch008_split_001.xhtml#x1-2620006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.457.1">Reversing a copy of a list</span></span></a><span class="kobospan" id="kobo.458.1"> recipe, we’ll look at reversing a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.459.1">This article provides</span><span id="dx1-239001"/><span class="kobospan" id="kobo.460.1"> some insights into how Python collections work internally: </span><a class="url" href="https://wiki.python.org/moin/TimeComplexity"><span class="url1"><span class="kobospan" id="kobo.461.1">https://wiki.python.org/moin/TimeComplexity</span></span></a><span class="kobospan" id="kobo.462.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.463.1">When looking at the tables, it’s important to note the expression </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.464.1">O</span></span><span class="kobospan" id="kobo.465.1">(1) means that the cost is essentially constant. </span><span class="kobospan" id="kobo.465.2">The expression </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.466.1">O</span></span><span class="kobospan" id="kobo.467.1">(</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.468.1">n</span></span><span class="kobospan" id="kobo.469.1">) means the cost grows as the size of the collection grows.</span></p></li>
</ul>
<p class="normal1"><span id="x1-239002r432"/></p>
</section>
</section>
<section data-number="0.7.3" id="slicing-and-dicing-a-list">
<h1 class="unnumbered" data-number="0.7.3"><span><span class="kobospan" id="kobo.470.1">4.3 </span></span> <span id="x1-2400003"/><span class="kobospan" id="kobo.471.1">Slicing and dicing a list</span></h1>
<p class="normal"><span class="kobospan" id="kobo.472.1">There are many times when</span><span id="dx1-240001"/><span class="kobospan" id="kobo.473.1"> we’ll want to pick items</span><span id="dx1-240002"/><span class="kobospan" id="kobo.474.1"> from a list. </span><span class="kobospan" id="kobo.474.2">One of the most common kinds of processing is to treat the first item of a list as a special case. </span><span class="kobospan" id="kobo.474.3">This leads to a kind of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.475.1">head-tail </span></span><span class="kobospan" id="kobo.476.1">processing where we treat the head of a list differently from the items in the tail of a list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.477.1">We can use these techniques to make a copy of a list too. </span><span id="x1-240003r452"/></p>
<section data-number="0.7.3.1" id="getting-ready-32">
<h2 class="likechapterhead" data-number="0.7.3.1"><span><span class="kobospan" id="kobo.478.1">4.3.1 </span></span> <span id="x1-2410001"/><span class="kobospan" id="kobo.479.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.480.1">We have a spreadsheet that was used to record fuel consumption on a large sailboat. </span><span class="kobospan" id="kobo.480.2">It has rows that look like this:</span></p>
<div class="center">
<div class="tabular">
<table class="tabular1" id="TBL-3">
<tbody class="calibre19">
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-3-1-">
<td class="td1" id="TBL-3-1-1"><span class="kobospan2" id="kobo.481.1">
                    date
                  </span></td>
<td class="td1" id="TBL-3-1-2"><span class="kobospan2" id="kobo.482.1">
                    engine on
                  </span></td>
<td class="td1" id="TBL-3-1-3"><span class="kobospan2" id="kobo.483.1">
                    fuel height
                  </span></td>
<td class="calibre23"/>
</tr>
<tr class="even" id="TBL-3-2-">
<td class="td1" id="TBL-3-2-1"/>
<td class="td1" id="TBL-3-2-2"><span class="kobospan2" id="kobo.484.1">
                    engine off
                  </span></td>
<td class="td1" id="TBL-3-2-3"><span class="kobospan2" id="kobo.485.1">
                    fuel height
                  </span></td>
<td class="calibre23"/>
</tr>
<tr class="even" id="TBL-3-3-">
<td class="td1" id="TBL-3-3-1"/>
<td class="td1" id="TBL-3-3-2"><span class="kobospan2" id="kobo.486.1">
                    Other notes
                  </span></td>
<td class="td1" id="TBL-3-3-3"/>
<td class="calibre23"/>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-3-4-">
<td class="td1" id="TBL-3-4-1"><span class="kobospan2" id="kobo.487.1">
                    10/25/2013
                  </span></td>
<td class="td1" id="TBL-3-4-2"><span class="kobospan2" id="kobo.488.1">
                    08:24:00 AM
                  </span></td>
<td class="td1" id="TBL-3-4-3"><span class="kobospan2" id="kobo.489.1">
                    29
                  </span></td>
<td class="calibre23"/>
</tr>
<tr class="even" id="TBL-3-5-">
<td class="td1" id="TBL-3-5-1"/>
<td class="td1" id="TBL-3-5-2"><span class="kobospan2" id="kobo.490.1">
                    01:15:00 PM
                  </span></td>
<td class="td1" id="TBL-3-5-3"><span class="kobospan2" id="kobo.491.1">
                    27
                  </span></td>
<td class="calibre23"/>
</tr>
<tr class="even" id="TBL-3-6-">
<td class="td1" id="TBL-3-6-1"/>
<td class="td1" id="TBL-3-6-2"><span class="kobospan2" id="kobo.492.1">
                    calm seas – anchor solomon’s island
                  </span></td>
<td class="td1" id="TBL-3-6-3"/>
<td class="calibre23"/>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-3-7-">
<td class="td1" id="TBL-3-7-1"><span class="kobospan2" id="kobo.493.1">
                    10/26/2013
                  </span></td>
<td class="td1" id="TBL-3-7-2"><span class="kobospan2" id="kobo.494.1">
                    09:12:00 AM
                  </span></td>
<td class="td1" id="TBL-3-7-3"><span class="kobospan2" id="kobo.495.1">
                    27
                  </span></td>
<td class="calibre23"/>
</tr>
<tr class="even" id="TBL-3-8-">
<td class="td1" id="TBL-3-8-1"/>
<td class="td1" id="TBL-3-8-2"><span class="kobospan2" id="kobo.496.1">
                    06:25:00 PM
                  </span></td>
<td class="td1" id="TBL-3-8-3"><span class="kobospan2" id="kobo.497.1">
                    22
                  </span></td>
<td class="calibre23"/>
</tr>
<tr class="even" id="TBL-3-9-">
<td class="td1" id="TBL-3-9-1"/>
<td class="td1" id="TBL-3-9-2"><span class="kobospan2" id="kobo.498.1">
                    choppy – anchor in jackson’s creek
                  </span></td>
<td class="td1" id="TBL-3-9-3"/>
<td class="calibre23"/>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-3-10-">
<td class="td1" id="TBL-3-10-1"/>
<td class="calibre23"/>
<td class="calibre23"/>
<td class="calibre23"/>
</tr>
</tbody>
</table>
</div>
<span id="x1-241001r1"/> <span id="x1-241002"/> <span><span class="kobospan" id="kobo.499.1">Table 4.1: </span></span><span><span class="kobospan" id="kobo.500.1">Example of sailboat fuel use </span></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.501.1">In this dataset, fuel is measured</span><span id="dx1-241003"/><span class="kobospan" id="kobo.502.1"> by height. </span><span class="kobospan" id="kobo.502.2">This is</span><span id="dx1-241004"/><span class="kobospan" id="kobo.503.1"> because a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.504.1">sight-gauge </span></span><span class="kobospan" id="kobo.505.1">is used, calibrated</span><span id="dx1-241005"/><span class="kobospan" id="kobo.506.1"> in inches of depth. </span><span class="kobospan" id="kobo.506.2">For all practical purposes, the tank is rectangular, so the depth shown can be converted into volume since we know 31 inches of depth is about 75 gallons.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.507.1">This example of spreadsheet data is not properly normalized. </span><span class="kobospan" id="kobo.507.2">Ideally, all rows</span><span id="dx1-241006"/><span class="kobospan" id="kobo.508.1"> follow the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.509.1">First Normal Form </span></span><span class="kobospan" id="kobo.510.1">for data: a row should have identical content, and each cell should have only atomic values. </span><span class="kobospan" id="kobo.510.2">In this data, there are three subtypes of row:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-241008x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.511.1">The first row of a three-row group has engine on date, time, and a measurement.</span></p>
</div></li>
<li class="calibre7"><div id="x1-241010x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.512.1">The second row of a group has engine off time and a measurement.</span></p>
</div></li>
<li class="calibre7"><div id="x1-241012x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.513.1">The third row has some notes that aren’t too useful.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.514.1">This kind of denormalized data includes the following two problems:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.515.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.516.1">.csv</span></span></span></span><span class="kobospan" id="kobo.517.1"> file has four rows of headings. </span><span class="kobospan" id="kobo.517.2">(The fourth row is a blank line that’s not shown here in this nicely formatted book.) This is something the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.518.1">csv</span></span></span></span><span class="kobospan" id="kobo.519.1"> module can’t deal with directly.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.520.1">Each day’s travel is spread across three rows. </span><span class="kobospan" id="kobo.520.2">These rows must be combined to make it easier to compute an elapsed time and the number of inches of fuel used.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.521.1">We can read the data with a function defined like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.522.1">import csv 
 
from pathlib import Path 
 
 
 
def get_fuel_use(path: Path) -&gt; list[list[str]]: 
 
    with path.open() as source_file: 
 
        reader = csv.reader(source_file) 
 
        log_rows = list(reader) 
 
    return log_rows</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.523.1">We’ve used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.524.1">csv</span></span></span></span><span class="kobospan" id="kobo.525.1"> module to read the log details. </span><span class="kobospan" id="kobo.525.2">The object returned by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.526.1">csv.reader()</span></span></span></span><span class="kobospan" id="kobo.527.1"> function is iterable. </span><span class="kobospan" id="kobo.527.2">In order to collect the items into a single list, we applied the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.528.1">list()</span></span></span></span><span class="kobospan" id="kobo.529.1"> function to the iterable; this creates a list object from the reader.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.530.1">Each row of the original</span><span id="dx1-241022"/><span class="kobospan" id="kobo.531.1"> CSV file</span><span id="dx1-241023"/><span class="kobospan" id="kobo.532.1"> is a list. </span><span class="kobospan" id="kobo.532.2">Here’s what the first and last rows look like:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.533.1">&gt;&gt;&gt; log_rows[0] 
 
[’date’, ’engine on’, ’fuel height’] 
 
 
 
&gt;&gt;&gt; log_rows[-1] 
 
[’’, "choppy -- anchor in jackson’s creek", ’’]
                                                                     

                                                                     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.534.1">For this recipe, we’ll use an extension of a list index expression to slice items from the list of rows. </span><span class="kobospan" id="kobo.534.2">The slice, like an index expression, follows the list object in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.535.1">[]</span></span></span></span><span class="kobospan" id="kobo.536.1"> characters. </span><span class="kobospan" id="kobo.536.2">Python offers several variations of the slice expression so that we can extract useful subsets of the list of rows. </span><span id="x1-241030r454"/></p>
</section>
<section data-number="0.7.3.2" id="how-to-do-it...-32">
<h2 class="likechapterhead" data-number="0.7.3.2"><span><span class="kobospan" id="kobo.537.1">4.3.2 </span></span> <span id="x1-2420002"/><span class="kobospan" id="kobo.538.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-242002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.539.1">The first thing we need to do is remove the four lines of headings from the list of rows. </span><span class="kobospan" id="kobo.539.2">We’ll use two partial slice expressions to divide the list by the fourth row:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.540.1">&gt;&gt;&gt; head, tail = log_rows[:4], log_rows[4:] 
 
&gt;&gt;&gt; head[0] 
 
[’date’, ’engine on’, ’fuel height’] 
 
&gt;&gt;&gt; head[-1] 
 
[’’, ’’, ’’] 
 
&gt;&gt;&gt; tail[0] 
 
[’10/25/13’, ’08:24:00 AM’, ’29’] 
 
&gt;&gt;&gt; tail[-1] 
 
[’’, "choppy -- anchor in jackson’s creek", ’’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.541.1">We’ve sliced the list into two sections using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.542.1">log_rows[:4]</span></span></span></span><span class="kobospan" id="kobo.543.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.544.1">log_rows[4:]</span></span></span></span><span class="kobospan" id="kobo.545.1">. </span><span class="kobospan" id="kobo.545.2">The first slice expression selects the first four lines; this is assigned to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.546.1">head</span></span></span></span><span class="kobospan" id="kobo.547.1"> variable. </span><span class="kobospan" id="kobo.547.2">The second slice expression selects rows from 4 to the end of the list. </span><span class="kobospan" id="kobo.547.3">This is assigned to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.548.1">tail</span></span></span></span><span class="kobospan" id="kobo.549.1"> variable. </span><span class="kobospan" id="kobo.549.2">These are the rows of the sheet we care about.</span></p>
</div></li>
<li class="calibre7"><div id="x1-242014x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.550.1">We’ll use slices with steps</span><span id="dx1-242015"/><span class="kobospan" id="kobo.551.1"> to pick the interesting</span><span id="dx1-242016"/><span class="kobospan" id="kobo.552.1"> rows. </span><span class="kobospan" id="kobo.552.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.553.1">[start:stop:step]</span></span></span></span><span class="kobospan" id="kobo.554.1"> version of a slice will pick rows in groups based on the step value. </span><span class="kobospan" id="kobo.554.2">In our case, we’ll take two slices. </span><span class="kobospan" id="kobo.554.3">One slice starts on row zero—the “engine on” lines—and the other slice starts on row one—the “engine off” lines.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.555.1">Here’s a slice of every third row, starting with row zero:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.556.1">&gt;&gt;&gt; pprint(tail[0::3], width=64) 
 
[[’10/25/13’, ’08:24:00 AM’, ’29’], 
 
 [’10/26/13’, ’09:12:00 AM’, ’27’]]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.557.1">We’ve used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.558.1">pprint()</span></span></span></span><span class="kobospan" id="kobo.559.1"> function from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.560.1">pprint</span></span></span></span><span class="kobospan" id="kobo.561.1"> module to make the output much easier to read.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.562.1">There’s additional data in every third row, starting with row one:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.563.1">&gt;&gt;&gt; pprint(tail[1::3], width=48) 
 
[[’’, ’01:15:00 PM’, ’27’], 
 
 [’’, ’06:25:00 PM’, ’22’]]</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-242026x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.564.1">These two slices can then be zipped together to create a list of pairs:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.565.1">&gt;&gt;&gt; paired_rows = list(zip(tail[0::3], tail[1::3])) 
 
&gt;&gt;&gt; pprint(paired_rows) 
 
[([’10/25/13’, ’08:24:00 AM’, ’29’], [’’, ’01:15:00 PM’, ’27’]), 
 
 ([’10/26/13’, ’09:12:00 AM’, ’27’], [’’, ’06:25:00 PM’, ’22’])]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.566.1">This gives us a sequence that consists of pairs of three tuples. </span><span class="kobospan" id="kobo.566.2">This is very close to something we can work with.</span></p>
</div></li>
<li class="calibre7"><div id="x1-242033x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.567.1">Flatten the results:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.568.1">
&gt;&gt;&gt; paired_rows = list(zip(tail[0::3], tail[1::3])) 
 
&gt;&gt;&gt; combined = [a+b for a, b in paired_rows] 
 
&gt;&gt;&gt; pprint(combined) 
 
[[’10/25/13’, ’08:24:00 AM’, ’29’, ’’, ’01:15:00 PM’, ’27’], 
 
 [’10/26/13’, ’09:12:00 AM’, ’27’, ’’, ’06:25:00 PM’, ’22’]]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.569.1">We’ve used a list comprehension from the </span><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.570.1">Building lists – literals,</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.571.1">appending, and comprehensions</span></span></a><span class="kobospan" id="kobo.572.1"> recipe to combine the two elements in each pair of rows to create a single row. </span><span class="kobospan" id="kobo.572.2">This has more properly normalized data describing each leg of the voyage.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.573.1">From the resulting list, we can now compute the difference in times to get the running time for the boat. </span><span class="kobospan" id="kobo.573.2">We can compute the difference in heights to estimate the fuel consumed during each leg of the journey. </span><span class="kobospan" id="kobo.573.3">This flat list with five useful items—date, time, height, time, and height—has all the needed data</span><span id="dx1-242040"/><span class="kobospan" id="kobo.574.1"> in a single row. </span><span class="kobospan" id="kobo.574.2">It also has a column</span><span id="dx1-242041"/><span class="kobospan" id="kobo.575.1"> that will generally contain an empty string. </span><span id="x1-242042r458"/></p>
</section>
<section data-number="0.7.3.3" id="how-it-works...-32">
<h2 class="likechapterhead" data-number="0.7.3.3"><span><span class="kobospan" id="kobo.576.1">4.3.3 </span></span> <span id="x1-2430003"/><span class="kobospan" id="kobo.577.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.578.1">The slice operator has</span><span id="dx1-243001"/><span class="kobospan" id="kobo.579.1"> several different forms:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.580.1">[:]</span></span></span></span><span class="kobospan" id="kobo.581.1">: The start and stop are implied. </span><span class="kobospan" id="kobo.581.2">The expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.582.1">S[:]</span></span></span></span><span class="kobospan" id="kobo.583.1"> will create a copy of sequence </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.584.1">S</span></span></span></span><span class="kobospan" id="kobo.585.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.586.1">[:stop]</span></span></span></span><span class="kobospan" id="kobo.587.1">: This makes a new list from the beginning to just before the stop index.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.588.1">[start:]</span></span></span></span><span class="kobospan" id="kobo.589.1">: This makes a new list from the given start to the end of the sequence.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.590.1">[start:stop]</span></span></span></span><span class="kobospan" id="kobo.591.1">: This picks a sublist, starting from the start index and stopping just before the stop index. </span><span class="kobospan" id="kobo.591.2">Python works with half-open intervals. </span><span class="kobospan" id="kobo.591.3">The start is included, while the stop index is not included.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.592.1">[::step]</span></span></span></span><span class="kobospan" id="kobo.593.1">: The start and stop are implied and include the entire sequence. </span><span class="kobospan" id="kobo.593.2">The step—generally not equal to one—means we’ll skip through the list from the start using the step. </span><span class="kobospan" id="kobo.593.3">For a given step, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.594.1">s</span></span><span class="kobospan" id="kobo.595.1">, and a list of size </span><span><span class="kobospan" id="kobo.596.1">|</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.597.1">L</span></span><span><span class="kobospan" id="kobo.598.1">|</span></span><span class="kobospan" id="kobo.599.1">, the index values are </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.600.1">i </span></span><span><span class="kobospan" id="kobo.601.1">∈{</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.602.1">s</span></span><span><span class="kobospan" id="kobo.603.1">×</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.604.1">n</span></span><span><span class="kobospan" id="kobo.605.1">∣</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.606.1">n </span></span><span><span class="kobospan" id="kobo.607.1">∈</span></span><span><span class="kobospan" id="kobo.608.1">ℕ</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.609.1">and</span></span><span class="kobospan" id="kobo.610.1"> 0 </span><span><span class="kobospan" id="kobo.611.1">≤ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.612.1">s</span></span><span><span class="kobospan" id="kobo.613.1">×</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.614.1">n &lt;</span></span> <span><span class="kobospan" id="kobo.615.1">|</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.616.1">L</span></span><span><span class="kobospan" id="kobo.617.1">|}</span></span><span class="kobospan" id="kobo.618.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.619.1">[start::step]</span></span></span></span><span class="kobospan" id="kobo.620.1">: The start is given, but the stop is implied. </span><span class="kobospan" id="kobo.620.2">The idea is that the start is an offset, and the step applies to that offset. </span><span class="kobospan" id="kobo.620.3">For a given start, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.621.1">a</span></span><span class="kobospan" id="kobo.622.1">, step, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.623.1">s</span></span><span class="kobospan" id="kobo.624.1">, and a list of size </span><span><span class="kobospan" id="kobo.625.1">|</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.626.1">L</span></span><span><span class="kobospan" id="kobo.627.1">|</span></span><span class="kobospan" id="kobo.628.1">, the index values are </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.629.1">i </span></span><span><span class="kobospan" id="kobo.630.1">∈{</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.631.1">s </span></span><span><span class="kobospan" id="kobo.632.1">× </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.633.1">n </span></span><span class="kobospan" id="kobo.634.1">+ </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.635.1">a</span></span><span><span class="kobospan" id="kobo.636.1">∣</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.637.1">n </span></span><span><span class="kobospan" id="kobo.638.1">∈</span></span><span><span class="kobospan" id="kobo.639.1">ℕ</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.640.1">and</span></span><span class="kobospan" id="kobo.641.1"> 0 </span><span><span class="kobospan" id="kobo.642.1">≤ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.643.1">s </span></span><span><span class="kobospan" id="kobo.644.1">× </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.645.1">n </span></span><span class="kobospan" id="kobo.646.1">+ </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.647.1">a &lt; </span></span><span><span class="kobospan" id="kobo.648.1">|</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.649.1">L</span></span><span><span class="kobospan" id="kobo.650.1">|}</span></span><span class="kobospan" id="kobo.651.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.652.1">[:stop:step]</span></span></span></span><span class="kobospan" id="kobo.653.1">: This is used to prevent processing the last few items in a list. </span><span class="kobospan" id="kobo.653.2">Since the step is given, processing begins with element zero.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.654.1">[start:stop:step]</span></span></span></span><span class="kobospan" id="kobo.655.1">: This will pick elements from a subset of the sequence. </span><span class="kobospan" id="kobo.655.2">Items prior to start and from stop</span><span id="dx1-243002"/><span class="kobospan" id="kobo.656.1"> to the end will not be used.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.657.1">The slicing technique works for lists, tuples, strings, and any other kind of sequence. </span><span class="kobospan" id="kobo.657.2">Slicing does not cause the collection to be mutated; rather, slicing will make a copy of some part of the sequence. </span><span class="kobospan" id="kobo.657.3">The items within</span><span id="dx1-243003"/><span class="kobospan" id="kobo.658.1"> the source collection</span><span id="dx1-243004"/><span class="kobospan" id="kobo.659.1"> are now shared between collections. </span><span id="x1-243005r464"/></p>
</section>
<section data-number="0.7.3.4" id="theres-more...-26">
<h2 class="likechapterhead" data-number="0.7.3.4"><span><span class="kobospan" id="kobo.660.1">4.3.4 </span></span> <span id="x1-2440004"/><span class="kobospan" id="kobo.661.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.662.1">In the </span><a href="ch008_split_001.xhtml#x1-2620006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.663.1">Reversing a copy of a list</span></span></a><span class="kobospan" id="kobo.664.1"> recipe, we’ll look at an even more sophisticated use of slice expressions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.665.1">The copy of a sequence</span><span id="dx1-244001"/><span class="kobospan" id="kobo.666.1"> is called a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.667.1">shallow copy </span></span><span class="kobospan" id="kobo.668.1">because there will be two collections that each contain references to the same underlying objects. </span><span class="kobospan" id="kobo.668.2">We’ll look at this in detail in the </span><a href="ch009.xhtml#x1-3160005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.669.1">Making shallow and deep copies of objects</span></span></a><span class="kobospan" id="kobo.670.1"> recipe.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.671.1">For this specific example, we have another way of restructuring multiple rows of data into single rows of data: we can use a generator function. </span><span class="kobospan" id="kobo.671.2">We’ll look at functional programming techniques online in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.672.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.673.1"> </span></span><a href="ch013_split_000.xhtml#x1-5020009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.674.1">9</span></span></a><span class="kobospan" id="kobo.675.1">. </span><span id="x1-244002r465"/></p>
</section>
<section data-number="0.7.3.5" id="see-also-32">
<h2 class="likechapterhead" data-number="0.7.3.5"><span><span class="kobospan" id="kobo.676.1">4.3.5 </span></span> <span id="x1-2450005"/><span class="kobospan" id="kobo.677.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.678.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.679.1">Building lists – literals, appending, and comprehensions</span></span></a><span class="kobospan" id="kobo.680.1"> recipe for ways to create lists.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.681.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2460004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.682.1">Shrinking lists – deleting, removing, and popping</span></span></a><span class="kobospan" id="kobo.683.1"> recipe for other ways to remove items from a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.684.1">In the </span><a href="ch008_split_001.xhtml#x1-2620006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.685.1">Reversing a copy of a list</span></span></a><span class="kobospan" id="kobo.686.1"> recipe, we’ll look at reversing a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.687.1">The </span><a href="https://pandas.pydata.org" class="url"><span class="kobospan" id="kobo.688.1">pandas</span></a><span class="kobospan" id="kobo.689.1"> package offers some additional ways to work with CSV files.</span></p></li>
</ul>
<p class="normal1"><span id="x1-245001r453"/></p>
</section>
</section>
<section data-number="0.7.4" id="shrinking-lists-deleting-removing-and-popping">
<h1 class="unnumbered" data-number="0.7.4"><span><span class="kobospan" id="kobo.690.1">4.4 </span></span> <span id="x1-2460004"/><span class="kobospan" id="kobo.691.1">Shrinking lists – deleting, removing, and popping</span></h1>
<p class="normal"><span class="kobospan" id="kobo.692.1">There will be many times</span><span id="dx1-246001"/><span class="kobospan" id="kobo.693.1"> when we’ll want to remove items from a list collection. </span><span class="kobospan" id="kobo.693.2">We might delete items from a list, and then process the items that are left over.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.694.1">Removing unneeded items has a similar effect to using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.695.1">filter()</span></span></span></span><span class="kobospan" id="kobo.696.1"> to create a copy that has only the needed items. </span><span class="kobospan" id="kobo.696.2">The distinction is that a filtered copy will use more memory than deleting items from a list. </span><span class="kobospan" id="kobo.696.3">We’ll show both techniques for removing unwanted items from a mutable list. </span><span id="x1-246002r466"/></p>
<section data-number="0.7.4.1" id="getting-ready-33">
<h2 class="likechapterhead" data-number="0.7.4.1"><span><span class="kobospan" id="kobo.697.1">4.4.1 </span></span> <span id="x1-2470001"/><span class="kobospan" id="kobo.698.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.699.1">We have a spreadsheet that is used to record fuel consumption on a large sailboat. </span><span class="kobospan" id="kobo.699.2">See </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.700.1">Table</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.701.1"> </span></span><a href="ch008_split_000.xhtml#x1-241001r1" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.702.1">4.1</span></span></a><span class="kobospan" id="kobo.703.1"> for the data.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.704.1">For more background on this data, refer to the </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.705.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.706.1"> recipe earlier in this chapter. </span><span class="kobospan" id="kobo.706.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.707.1">get_fuel_use()</span></span></span></span><span class="kobospan" id="kobo.708.1"> function will collect the raw data. </span><span class="kobospan" id="kobo.708.2">It’s important to note that the structure of this data—each fact spread among three separate rows—is perfectly awful and requires considerable care to reconstruct something more useful.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.709.1">Each row of the original CSV file is a list. </span><span class="kobospan" id="kobo.709.2">Each of those lists contains three items. </span><span class="kobospan" id="kobo.709.3">It’s essential to remove some rows with titles and uninformative data. </span><span id="x1-247001r468"/></p>
</section>
<section data-number="0.7.4.2" id="how-to-do-it...-33">
<h2 class="likechapterhead" data-number="0.7.4.2"><span><span class="kobospan" id="kobo.710.1">4.4.2 </span></span> <span id="x1-2480002"/><span class="kobospan" id="kobo.711.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.712.1">We’ll look at several ways to remove items from a list:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.713.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.714.1">del</span></span></span></span><span class="kobospan" id="kobo.715.1"> statement.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.716.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.717.1">remove()</span></span></span></span><span class="kobospan" id="kobo.718.1"> method.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.719.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.720.1">pop()</span></span></span></span><span class="kobospan" id="kobo.721.1"> method.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.722.1">We can also replace items</span><span id="dx1-248001"/><span class="kobospan" id="kobo.723.1"> in a list using slice assignment.</span></p></li>
</ul>
<section data-number="0.7.4.2.1" id="the-del-statement">
<h3 class="likesubsubsectionhead" data-number="0.7.4.2.1"><span id="x1-2490002"/><span class="kobospan" id="kobo.724.1">The del statement</span></h3>
<p class="normal"><span class="kobospan" id="kobo.725.1">We can remove items from</span><span id="dx1-249001"/><span class="kobospan" id="kobo.726.1"> a list using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.727.1">del</span></span></span></span><span class="kobospan" id="kobo.728.1"> statement. </span><span class="kobospan" id="kobo.728.2">We can provide an object and a slice to remove a group of rows from the list object. </span><span class="kobospan" id="kobo.728.3">Here’s how the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.729.1">del</span></span></span></span><span class="kobospan" id="kobo.730.1"> statement looks:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.731.1">&gt;&gt;&gt; del log_rows[:4] 
 
&gt;&gt;&gt; log_rows[0] 
 
[’10/25/13’, ’08:24:00 AM’, ’29’] 
 
 
 
&gt;&gt;&gt; log_rows[-1] 
 
[’’, "choppy -- anchor in jackson’s creek", ’’]
                                                                     

                                                                     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.732.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.733.1">del</span></span></span></span><span class="kobospan" id="kobo.734.1"> statement removed the first four rows, leaving behind the rows that we really need to process. </span><span class="kobospan" id="kobo.734.2">We can then combine these rows and summarize them using the </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.735.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.736.1"> recipe.</span></p>
</section>
<section data-number="0.7.4.2.2" id="the-remove-method">
<h3 class="likesubsubsectionhead" data-number="0.7.4.2.2"><span id="x1-2500002"/><span class="kobospan" id="kobo.737.1">The remove() method</span></h3>
<p class="normal"><span class="kobospan" id="kobo.738.1">We can remove items from a list</span><span id="dx1-250001"/><span class="kobospan" id="kobo.739.1"> using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.740.1">remove()</span></span></span></span><span class="kobospan" id="kobo.741.1"> method. </span><span class="kobospan" id="kobo.741.2">Given a specific value, this removes matching items from a list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.742.1">We might have a list that looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.743.1">
 
 
&gt;&gt;&gt; row = [’10/25/13’, ’08:24:00 AM’, ’29’, ’’, ’01:15:00 PM’, ’27’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.744.1">We can remove the useless </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.745.1">’’</span></span></span></span><span class="kobospan" id="kobo.746.1"> item from the list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.747.1">&gt;&gt;&gt; row.remove(’’) 
 
&gt;&gt;&gt; row 
 
[’10/25/13’, ’08:24:00 AM’, ’29’, ’01:15:00 PM’, ’27’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.748.1">Note that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.749.1">remove()</span></span></span></span><span class="kobospan" id="kobo.750.1"> method does not return a value. </span><span class="kobospan" id="kobo.750.2">It mutates the list in place.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.751.1">As noted in the </span><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.752.1">Building lists – literals, appending, and comprehensions</span></span></a><span class="kobospan" id="kobo.753.1"> recipe, the following code is incorrect:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.754.1">a = [’some’, ’data’] 
 
a = a.remove(’data’)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.755.1">This is emphatically</span><span id="dx1-250011"/><span class="kobospan" id="kobo.756.1"> wrong. </span><span class="kobospan" id="kobo.756.2">This will set </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.757.1">a</span></span></span></span><span class="kobospan" id="kobo.758.1"> to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.759.1">None</span></span></span></span><span class="kobospan" id="kobo.760.1">.</span></p>
</section>
<section data-number="0.7.4.2.3" id="the-pop-method">
<h3 class="likesubsubsectionhead" data-number="0.7.4.2.3"><span id="x1-2510002"/><span class="kobospan" id="kobo.761.1">The pop() method</span></h3>
<p class="normal"><span class="kobospan" id="kobo.762.1">We can remove items from a list</span><span id="dx1-251001"/><span class="kobospan" id="kobo.763.1"> using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.764.1">pop()</span></span></span></span><span class="kobospan" id="kobo.765.1"> method. </span><span class="kobospan" id="kobo.765.2">This removes items from a list based on their index.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.766.1">We might have a list that looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.767.1">&gt;&gt;&gt; row = [’10/25/13’, ’08:24:00 AM’, ’29’, ’’, ’01:15:00 PM’, ’27’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.768.1">This has a useless </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.769.1">’’</span></span></span></span><span class="kobospan" id="kobo.770.1"> string in it. </span><span class="kobospan" id="kobo.770.2">We can find the index of the item to pop and then remove it. </span><span class="kobospan" id="kobo.770.3">The code for this has been broken down into separate steps in the following example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.771.1">&gt;&gt;&gt; target_position = row.index(’’) 
 
&gt;&gt;&gt; target_position 
 
3 
 
 
 
&gt;&gt;&gt; row.pop(target_position) 
 
’’ 
 
&gt;&gt;&gt; row 
 
[’10/25/13’, ’08:24:00 AM’, ’29’, ’01:15:00 PM’, ’27’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.772.1">Note that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.773.1">pop()</span></span></span></span><span class="kobospan" id="kobo.774.1"> method does two things:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.775.1">It mutates the list object to remove an item.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.776.1">It also returns the item that was removed.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.777.1">This combination of mutation and returning a value is rare, making this method distinctive.</span></p>
</section>
<section data-number="0.7.4.2.4" id="slice-assignment">
<h3 class="likesubsubsectionhead" data-number="0.7.4.2.4"><span id="x1-2520002"/><span class="kobospan" id="kobo.778.1">Slice assignment</span></h3>
<p class="normal"><span class="kobospan" id="kobo.779.1">We can replace items in a list by using</span><span id="dx1-252001"/><span class="kobospan" id="kobo.780.1"> a slice expression on the left-hand side of the assignment statement. </span><span class="kobospan" id="kobo.780.2">This lets us replace items in a list. </span><span class="kobospan" id="kobo.780.3">When the replacement is a different size, it lets us expand or contract a list. </span><span class="kobospan" id="kobo.780.4">This leads to a technique for removing items from a list using slice assignment.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.781.1">We’ll start with a row that has an empty value in position 3. </span><span class="kobospan" id="kobo.781.2">This looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.782.1">&gt;&gt;&gt; row = [’10/25/13’, ’08:24:00 AM’, ’29’, ’’, ’01:15:00 PM’, ’27’] 
 
 
 
&gt;&gt;&gt; target_position = row.index(’’) 
 
&gt;&gt;&gt; target_position 
 
3</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.783.1">We can assign an empty list to the slice that starts at index position 3 and ends just before index position 4. </span><span class="kobospan" id="kobo.783.2">This will replace a one-item slice with a zero-item slice, removing the item from the list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.784.1">&gt;&gt;&gt; row[3:4] = [] 
 
&gt;&gt;&gt; row 
 
[’10/25/13’, ’08:24:00 AM’, ’29’, ’01:15:00 PM’, ’27’]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.785.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.786.1">del</span></span></span></span><span class="kobospan" id="kobo.787.1"> statement and methods like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.788.1">remove()</span></span></span></span><span class="kobospan" id="kobo.789.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.790.1">pop()</span></span></span></span><span class="kobospan" id="kobo.791.1"> seem to clearly state the intent to eliminate an item from the collection. </span><span class="kobospan" id="kobo.791.2">The slice assignment can be less clear because it doesn’t have an obvious method name. </span><span class="kobospan" id="kobo.791.3">It does work well, however, for removing a number of items that can be described</span><span id="dx1-252012"/><span class="kobospan" id="kobo.792.1"> by a slice expression. </span><span id="x1-252013r469"/></p>
</section>
</section>
<section data-number="0.7.4.3" id="how-it-works...-33">
<h2 class="likechapterhead" data-number="0.7.4.3"><span><span class="kobospan" id="kobo.793.1">4.4.3 </span></span> <span id="x1-2530003"/><span class="kobospan" id="kobo.794.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.795.1">Because a list is a mutable</span><span id="dx1-253001"/><span class="kobospan" id="kobo.796.1"> object, we can remove items from the list. </span><span class="kobospan" id="kobo.796.2">This technique doesn’t work for tuples or strings, because they are immutable.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.797.1">We can only remove items with an index that’s present in the list. </span><span class="kobospan" id="kobo.797.2">If we attempt to remove an item with an index outside the allowed range, we’ll get an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.798.1">IndexError</span></span></span></span><span class="kobospan" id="kobo.799.1"> exception.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.800.1">The following example tries to delete an item with an index of three from a list where the index values are zero, one, and two:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.801.1">&gt;&gt;&gt; row = [’’, ’06:25:00 PM’, ’22’] 
 
 
 
&gt;&gt;&gt; del row[3] 
 
Traceback (most recent call last): 
 
... 
 
IndexError: list assignment index out of range</span></code></pre>
<p class="normal1"><span id="x1-253009r482"/></p>
</section>
<section data-number="0.7.4.4" id="theres-more...-27">
<h2 class="likechapterhead" data-number="0.7.4.4"><span><span class="kobospan" id="kobo.802.1">4.4.4 </span></span> <span id="x1-2540004"/><span class="kobospan" id="kobo.803.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.804.1">There are a few places in Python where deleting from a list object may become complicated. </span><span class="kobospan" id="kobo.804.2">If we use a list object in a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.805.1">for</span></span></span></span><span class="kobospan" id="kobo.806.1"> statement, we can’t delete items from the list. </span><span class="kobospan" id="kobo.806.2">Doing so will lead to unexpected conflicts between the iteration control and the underlying object’s internal state.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.807.1">Let’s say we want to remove all even items from a list. </span><span class="kobospan" id="kobo.807.2">Here’s an example that does not work properly:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.808.1">&gt;&gt;&gt; data_items = [1, 1, 2, 3, 5, 8, 10, 
 
... </span><span class="kobospan" id="kobo.808.2">13, 21, 34, 36, 55] 
 
 
 
&gt;&gt;&gt; for f in data_items: 
 
... </span><span class="kobospan" id="kobo.808.3">    if f % 2 == 0: 
 
... </span><span class="kobospan" id="kobo.808.4">        data_items.remove(f) 
 
&gt;&gt;&gt; data_items 
 
[1, 1, 3, 5, 10, 13, 21, 36, 55]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.809.1">The source list had several even values. </span><span class="kobospan" id="kobo.809.2">The result is clearly not correct; the values of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.810.1">10</span></span></span></span><span class="kobospan" id="kobo.811.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.812.1">36</span></span></span></span><span class="kobospan" id="kobo.813.1"> remained in the list. </span><span class="kobospan" id="kobo.813.2">Why are some even-valued items left in the list?</span></p>
<p class="normal1"><span class="kobospan" id="kobo.814.1">Let’s look at what happens when processing </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.815.1">data_items[5]</span></span></span></span><span class="kobospan" id="kobo.816.1">; it has a value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.817.1">8</span></span></span></span><span class="kobospan" id="kobo.818.1">. </span><span class="kobospan" id="kobo.818.2">When the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.819.1">remove(8)</span></span></span></span><span class="kobospan" id="kobo.820.1"> method is evaluated, the value will be removed, and all the subsequent values will slide forward one position in the list. </span><span class="kobospan" id="kobo.820.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.821.1">10</span></span></span></span><span class="kobospan" id="kobo.822.1"> value will be moved into position 5, the position formerly occupied by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.823.1">8</span></span></span></span><span class="kobospan" id="kobo.824.1"> value. </span><span class="kobospan" id="kobo.824.2">The iterator control value will advance to the next position, which will have </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.825.1">13</span></span></span></span><span class="kobospan" id="kobo.826.1"> in it. </span><span class="kobospan" id="kobo.826.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.827.1">10</span></span></span></span><span class="kobospan" id="kobo.828.1"> value will never be processed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.829.1">We have several ways to avoid</span><span id="dx1-254010"/><span class="kobospan" id="kobo.830.1"> the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.831.1">skip-when-delete </span></span><span class="kobospan" id="kobo.832.1">problem:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.833.1">Make a copy of the list:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.834.1">&gt;&gt;&gt; for f in data_items[:]: 
 
... </span><span class="kobospan" id="kobo.834.2">    if f % 2 == 0: 
 
... </span><span class="kobospan" id="kobo.834.3">        data_items.remove(f)</span></code></pre></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.835.1">Use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.836.1">while</span></span></span></span><span class="kobospan" id="kobo.837.1"> statement and maintain the index value explicitly:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.838.1">&gt;&gt;&gt; position = 0 
 
&gt;&gt;&gt; while position != len(data_items): 
 
... </span><span class="kobospan" id="kobo.838.2">    f = data_items[position] 
 
... </span><span class="kobospan" id="kobo.838.3">    if f % 2 == 0: 
 
... </span><span class="kobospan" id="kobo.838.4">        data_items.remove(f) 
 
... </span><span class="kobospan" id="kobo.838.5">    else: 
 
... </span><span class="kobospan" id="kobo.838.6">        position += 1</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.839.1">We’ve designed a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.840.1">while</span></span></span></span><span class="kobospan" id="kobo.841.1"> statement to only increment the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.842.1">position</span></span></span></span><span class="kobospan" id="kobo.843.1"> variable if the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.844.1">data_items[position]</span></span></span></span><span class="kobospan" id="kobo.845.1"> is odd. </span><span class="kobospan" id="kobo.845.2">If the value is even, then the value is removed, which also means the other items are moved forward one position in the list; it’s essential the value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.846.1">position</span></span></span></span><span class="kobospan" id="kobo.847.1"> variable is left unchanged.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.848.1">We can also traverse the list</span><span id="dx1-254023"/><span class="kobospan" id="kobo.849.1"> in reverse order. </span><span class="kobospan" id="kobo.849.2">The expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.850.1">range(len(row)-1,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.851.1"> -1,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.852.1"> -1)</span></span></span></span><span class="kobospan" id="kobo.853.1"> will produce index descending from -1. </span><span class="kobospan" id="kobo.853.2">This works because negative index values work forward from the end of the list. </span><span class="kobospan" id="kobo.853.3">The value </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.854.1">row[-1]</span></span></span></span><span class="kobospan" id="kobo.855.1"> is the last item.</span></p></li>
</ul>
<p class="normal1"><span id="x1-254024r484"/></p>
</section>
</section>
</section>


<section data-number="0.7" id="chapter-4-built-in-data-structures-part-1-lists-and-sets">
<section data-number="0.7.4" id="shrinking-lists-deleting-removing-and-popping">
<section data-number="0.7.4.5" id="see-also-33">
<h2 class="likechapterhead" data-number="0.7.4.5"><span><span class="kobospan" id="kobo.856.1">4.4.5 </span></span> <span id="x1-2550005"/><span class="kobospan" id="kobo.857.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.858.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.859.1">Building lists – literals, appending, and comprehensions</span></span></a><span class="kobospan" id="kobo.860.1"> recipe for ways to create lists.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.861.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.862.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.863.1"> recipe for ways to copy lists and pick sublists from a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.864.1">In the </span><a href="ch008_split_001.xhtml#x1-2620006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.865.1">Reversing a copy of a list</span></span></a><span class="kobospan" id="kobo.866.1"> recipe, we’ll look at reversing a list.</span></p></li>
</ul>
<p class="normal1"><span id="x1-255001r467"/></p>
</section>
</section>
<section data-number="0.7.5" id="writing-list-related-type-hints">
<h1 class="unnumbered" data-number="0.7.5"><span><span class="kobospan" id="kobo.867.1">4.5 </span></span> <span id="x1-2560005"/><span class="kobospan" id="kobo.868.1">Writing list-related type hints</span></h1>
<p class="normal"><span class="kobospan" id="kobo.869.1">The typing module provides</span><span id="dx1-256001"/><span class="kobospan" id="kobo.870.1"> a few essential type definitions for describing the contents of a list object. </span><span class="kobospan" id="kobo.870.2">The primary type definition is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.871.1">list</span></span></span></span><span class="kobospan" id="kobo.872.1">, which we can parameterize with the types of items in the list. </span><span class="kobospan" id="kobo.872.2">It often looks like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.873.1">list[int]</span></span></span></span><span class="kobospan" id="kobo.874.1">. </span><span id="x1-256002r488"/></p>
<section data-number="0.7.5.1" id="getting-ready-34">
<h2 class="likechapterhead" data-number="0.7.5.1"><span><span class="kobospan" id="kobo.875.1">4.5.1 </span></span> <span id="x1-2570001"/><span class="kobospan" id="kobo.876.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.877.1">We’ll look at a list that has two kinds of tuples. </span><span class="kobospan" id="kobo.877.2">Some tuples are simple RGB colors. </span><span class="kobospan" id="kobo.877.3">Other tuples are RGB colors that are the result of some computations. </span><span class="kobospan" id="kobo.877.4">These are built from float values instead of integers. </span><span class="kobospan" id="kobo.877.5">We might have a heterogenous list structure that looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.878.1">(’ Brick_Red’, (198, 45, 66)), 
 
(’ color1’, (198.00, 100.50, 45.00)), 
 
(’ color2’, (198.00, 45.00, 142.50)), 
 
]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.879.1">Each item in the list is a two-tuple with a color name, and a tuple of RGB values. </span><span class="kobospan" id="kobo.879.2">The RGB values are represented as a three-tuple of either integer or float values. </span><span class="kobospan" id="kobo.879.3">This is potentially difficult to describe with type hints.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.880.1">We have two related functions that work with this data. </span><span class="kobospan" id="kobo.880.2">The first creates a color code from RGB values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.881.1">The essential rule is to treat each component, red, green, or blue, as an 8-bit number, a value between 0 and 255. </span><span class="kobospan" id="kobo.881.2">These three are combined by shifting the red value by 16 bits and shifting the green value by 8 bits. </span><span class="kobospan" id="kobo.881.3">The Python </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.882.1">&lt;&lt;</span></span></span></span><span class="kobospan" id="kobo.883.1"> operator does the necessary bit shifting. </span><span class="kobospan" id="kobo.883.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.884.1">|</span></span></span></span><span class="kobospan" id="kobo.885.1"> operator performs an “or” operation, combining the shifted bits to create a new integer value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.886.1">The hints for this function aren’t very complicated:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.887.1">def hexify(r: float, g: float, b: float) -&gt; str: 
 
    return f’#{int(r) &lt;&lt; 16 | int(g) &lt;&lt; 8 | int(b):06X}’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.888.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.889.1">:06X</span></span></span></span><span class="kobospan" id="kobo.890.1"> format specification produces a 6-position hexadecimal value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.891.1">An alternative is to treat each color as a separate pair of hex digits with an expression like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.892.1">f"#{int(r):02X}{int(g):02X}{int(b):02X}"</span></span></span></span><span class="kobospan" id="kobo.893.1">. </span><span class="kobospan" id="kobo.893.2">This uses three copies of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.894.1">:02X</span></span></span></span><span class="kobospan" id="kobo.895.1"> format specification to produce 2-position hexadecimal values for each color component.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.896.1">When we use this function to create a color string from an RGB number, it looks like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.897.1">&gt;&gt;&gt; hexify(198, 45, 66) 
 
’#C62D42’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.898.1">The other function, however, is potentially confusing. </span><span class="kobospan" id="kobo.898.2">This function</span><span id="dx1-257013"/><span class="kobospan" id="kobo.899.1"> transforms a complex list of colors into another list with the hexadecimal color codes:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.900.1">def source_to_hex_0(src): 
 
    return [ 
 
        (n, hexify(*color)) for n, color in src 
 
    ]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.901.1">We need to add type hints to be sure this function properly transforms a list of colors from numeric form into string code form.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.902.1">We’ve included a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.903.1">_0</span></span></span></span><span class="kobospan" id="kobo.904.1"> suffix on the function name to distinguish it from the examples that follow. </span><span class="kobospan" id="kobo.904.2">This is not a best practice in general, but we find it helps clarify the code presented in a book like this. </span><span id="x1-257019r490"/></p>
</section>
<section data-number="0.7.5.2" id="how-to-do-it...-34">
<h2 class="likechapterhead" data-number="0.7.5.2"><span><span class="kobospan" id="kobo.905.1">4.5.2 </span></span> <span id="x1-2580002"/><span class="kobospan" id="kobo.906.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.907.1">We’ll start by adding type hints to describe the individual items of the input list, exemplified by the scheme variable, shown previously:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-258002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.908.1">Define the resulting type first. </span><span class="kobospan" id="kobo.908.2">It often helps to focus on the outcomes and work backward toward the source data required to produce the expected results. </span><span class="kobospan" id="kobo.908.3">In this case, the result is a list of two-tuples with the color name and the hexadecimal code for the color. </span><span class="kobospan" id="kobo.908.4">We could describe this as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.909.1">list[tuple[str,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.910.1"> str]]</span></span></span></span><span class="kobospan" id="kobo.911.1">, but that kind of summary hides some important details. </span><span class="kobospan" id="kobo.911.2">We prefer to expose the details as follows:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.912.1">ColorCode = tuple[str, str] 
 
ColorCodeList = list[ColorCode]                                                                

                                                                     
     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.913.1">This list can be seen as being homogeneous; each item will match the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.914.1">ColorCode</span></span></span></span><span class="kobospan" id="kobo.915.1"> type definition.</span></p>
</div></li>
<li class="calibre7"><div id="x1-258007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.916.1">Define the source type. </span><span class="kobospan" id="kobo.916.2">In this case, we have two slightly</span><span id="dx1-258008"/><span class="kobospan" id="kobo.917.1"> different kinds of color definitions. </span><span class="kobospan" id="kobo.917.2">While they tend to overlap, they have different origins, and the processing history is sometimes helpful as part of a type hint:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.918.1">from typing import Union 
 
RGB_I = tuple[int, int, int] 
 
RGB_F = tuple[float, float, float] 
 
ColorRGB = tuple[str, Union[RGB_I, RGB_F]] 
 
ColorRGBList = list[ColorRGB]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.919.1">We’ve defined the two integer-based RGB three-tuple as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.920.1">RGB_I</span></span></span></span><span class="kobospan" id="kobo.921.1">, and the float-based RGB three-tuple as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.922.1">RGB_F</span></span></span></span><span class="kobospan" id="kobo.923.1">. </span><span class="kobospan" id="kobo.923.2">These two alternative types are combined into the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.924.1">ColorRGB</span></span></span></span><span class="kobospan" id="kobo.925.1"> tuple definition. </span><span class="kobospan" id="kobo.925.2">This is a two-tuple; the second element may be an instance of either the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.926.1">RGB_I</span></span></span></span><span class="kobospan" id="kobo.927.1"> type or the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.928.1">RGB_F</span></span></span></span><span class="kobospan" id="kobo.929.1"> type. </span><span class="kobospan" id="kobo.929.2">The presence of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.930.1">Union</span></span></span></span><span class="kobospan" id="kobo.931.1"> type means that this list is heterogenous.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.932.1">We could also use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.933.1">RGB_I</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.934.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.935.1"> RGB_F</span></span></span></span><span class="kobospan" id="kobo.936.1"> instead of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.937.1">Union[RGB_I,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.938.1"> RGB_F]</span></span></span></span><span class="kobospan" id="kobo.939.1">.</span></p>
</div></li>
<li class="calibre7"><div id="x1-258016x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.940.1">Update the function to include the type hints. </span><span class="kobospan" id="kobo.940.2">The input will be a list like the schema object, shown previously. </span><span class="kobospan" id="kobo.940.3">The result will be a list that matches the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.941.1">ColorCodeList</span></span></span></span><span class="kobospan" id="kobo.942.1"> type description:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.943.1">def source_to_hex(src: ColorRGBList) -&gt; ColorCodeList: 
    return [ 
 
        (n, hexify(*color)) for n, color in src 
 
    ]</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span id="x1-258022r495"/></p>
</section>
<section data-number="0.7.5.3" id="how-it-works...-34">
<h2 class="likechapterhead" data-number="0.7.5.3"><span><span class="kobospan" id="kobo.944.1">4.5.3 </span></span> <span id="x1-2590003"/><span class="kobospan" id="kobo.945.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.946.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.947.1">list[T]</span></span></span></span><span class="kobospan" id="kobo.948.1"> type hint requires a single value, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.949.1">T</span></span></span></span><span class="kobospan" id="kobo.950.1">, to describe all of the object types that can be part of this list. </span><span class="kobospan" id="kobo.950.2">For homogeneous lists, the type is stated directly. </span><span class="kobospan" id="kobo.950.3">For heterogeneous lists, a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.951.1">Union</span></span></span></span><span class="kobospan" id="kobo.952.1"> must be used to define the various kinds of types that may be present.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.953.1">The approach we’ve taken breaks type hinting down into two layers:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.954.1">A ”foundation” layer that describes the individual</span><span id="dx1-259001"/><span class="kobospan" id="kobo.955.1"> items in a collection. </span><span class="kobospan" id="kobo.955.2">We’ve defined three types of primitive items: the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.956.1">RGB_I</span></span></span></span><span class="kobospan" id="kobo.957.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.958.1">RGB_F</span></span></span></span><span class="kobospan" id="kobo.959.1"> types, as well as the resulting </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.960.1">ColorCode</span></span></span></span><span class="kobospan" id="kobo.961.1"> type.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.962.1">A number of ”composition” layers that combine</span><span id="dx1-259002"/><span class="kobospan" id="kobo.963.1"> foundational types into descriptions of composite objects. </span><span class="kobospan" id="kobo.963.2">In this case, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.964.1">ColorRGB</span></span></span></span><span class="kobospan" id="kobo.965.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.966.1">ColorRGBList</span></span></span></span><span class="kobospan" id="kobo.967.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.968.1">ColorCodeList</span></span></span></span><span class="kobospan" id="kobo.969.1"> are all composite type definitions.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.970.1">Once the types have been named, then the names are used with definition functions, classes, and methods.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.971.1">It’s important to define types in stages to avoid long, complex type hints that don’t provide any useful insight into the objects being processed. </span><span class="kobospan" id="kobo.971.2">It’s good to avoid type descriptions like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.972.1">list[tuple[str, Union[tuple[int, int, int], tuple[float, float, float]]]]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.973.1">While this is technically</span><span id="dx1-259005"/><span class="kobospan" id="kobo.974.1"> correct, it’s difficult to understand because of its complexity. </span><span class="kobospan" id="kobo.974.2">It helps to decompose complex types into useful component descriptions. </span><span id="x1-259006r499"/></p>
</section>
<section data-number="0.7.5.4" id="theres-more...-28">
<h2 class="likechapterhead" data-number="0.7.5.4"><span><span class="kobospan" id="kobo.975.1">4.5.4 </span></span> <span id="x1-2600004"/><span class="kobospan" id="kobo.976.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.977.1">The type hints assume a single type for each item in the list. </span><span class="kobospan" id="kobo.977.2">The syntax </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.978.1">list[T]</span></span></span></span><span class="kobospan" id="kobo.979.1"> states that all items are of type </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.980.1">T</span></span></span></span><span class="kobospan" id="kobo.981.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.982.1">In the case of a heterogeneous list, with a number of distinct types, we need to define a union of types. </span><span class="kobospan" id="kobo.982.2">We can import the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.983.1">Union</span></span></span></span><span class="kobospan" id="kobo.984.1"> type from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.985.1">typing</span></span></span></span><span class="kobospan" id="kobo.986.1"> module. </span><span class="kobospan" id="kobo.986.2">Or we can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.987.1">|</span></span></span></span><span class="kobospan" id="kobo.988.1"> to provide the alternative types for a list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.989.1">Using a construct like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.990.1">list[RGB_I</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.991.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.992.1"> RGB_F]</span></span></span></span><span class="kobospan" id="kobo.993.1"> describes a list that contains items with a mixture of types. </span><span id="x1-260001r501"/></p>
</section>
<section data-number="0.7.5.5" id="see-also-34">
<h2 class="likechapterhead" data-number="0.7.5.5"><span><span class="kobospan" id="kobo.994.1">4.5.5 </span></span> <span id="x1-2610005"/><span class="kobospan" id="kobo.995.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.996.1">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.997.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.998.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.999.1">1</span></span></a><span class="kobospan" id="kobo.1000.1">, the </span><a href="ch005_split_001.xhtml#x1-7500010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1001.1">Using NamedTuples to simplify item access in tuples</span></span></a><span class="kobospan" id="kobo.1002.1"> recipe provides some alternative ways to clarify types hints for tuples.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1003.1">The </span><a href="ch008_split_001.xhtml#x1-2800009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1004.1">Writing set-related type hints</span></span></a><span class="kobospan" id="kobo.1005.1"> recipe covers this from the view of set types.</span></p></li>
</ul>
<p class="normal1"><span id="x1-261001r489"/></p>
</section>
</section>
<section data-number="0.7.6" id="reversing-a-copy-of-a-list">
<h1 class="unnumbered" data-number="0.7.6"><span><span class="kobospan" id="kobo.1006.1">4.6 </span></span> <span id="x1-2620006"/><span class="kobospan" id="kobo.1007.1">Reversing a copy of a list</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1008.1">Some algorithms produce results</span><span id="dx1-262001"/><span class="kobospan" id="kobo.1009.1"> in a reversed order. </span><span class="kobospan" id="kobo.1009.2">It’s common to collect the output in a list and then reverse the list. </span><span class="kobospan" id="kobo.1009.3">As an example, we’ll look at the way numbers converted into a specific base are often generated from least-significant to most-significant digit. </span><span class="kobospan" id="kobo.1009.4">We generally want to display the values with the most-significant digit first. </span><span class="kobospan" id="kobo.1009.5">This leads to a need to reverse the sequence of digits in a list. </span><span id="x1-262002r502"/></p>
<section data-number="0.7.6.1" id="getting-ready-35">
<h2 class="likechapterhead" data-number="0.7.6.1"><span><span class="kobospan" id="kobo.1010.1">4.6.1 </span></span> <span id="x1-2630001"/><span class="kobospan" id="kobo.1011.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1012.1">Let’s say we’re doing a conversion among number bases. </span><span class="kobospan" id="kobo.1012.2">We’ll look at how a number is represented in a base, and how we can compute that representation from a number.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1013.1">Any value, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1014.1">v</span></span><span class="kobospan" id="kobo.1015.1">, can be defined as a polynomial function of the various digits, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1016.1">d</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.1017.1">n</span></span></sub><span class="kobospan" id="kobo.1018.1">, in a given base, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1019.1">b</span></span><span class="kobospan" id="kobo.1020.1">. </span><span class="kobospan" id="kobo.1020.2">A four-digit number would have </span><span><span class="kobospan" id="kobo.1021.1">⟨</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1022.1">d</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1023.1">3</span></span></sub><span class="cmti-10x-x"><span class="kobospan" id="kobo.1024.1">,d</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1025.1">2</span></span></sub><span class="cmti-10x-x"><span class="kobospan" id="kobo.1026.1">,d</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1027.1">1</span></span></sub><span class="cmti-10x-x"><span class="kobospan" id="kobo.1028.1">,d</span></span><sub class="calibre24"><span class="cmr1"><span class="kobospan" id="kobo.1029.1">0</span></span></sub><span><span class="kobospan" id="kobo.1030.1">⟩ </span></span><span class="kobospan" id="kobo.1031.1">as the sequence of digits.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1032.1">Note that the order we’re using here is reversed from the usual order of items in a Python list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1033.1">The value, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1034.1">v</span></span><span class="kobospan" id="kobo.1035.1">, of this sequence of digits is given by the following polynomial:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1036.1"><img alt="v = dn × bn + dn−1 × bn− 1 + dn− 2 × bn−2 + ⋅⋅⋅+ d1 × b+ d0 " class="calibre9" src="../media/file48.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1037.1">For example, the hexadecimal number </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1038.1">0xBEEF</span></span></span></span><span class="kobospan" id="kobo.1039.1"> has the following digits: </span><span><span class="kobospan" id="kobo.1040.1">⟨</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1041.1">B </span></span><span class="kobospan" id="kobo.1042.1">= 11</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1043.1">,E </span></span><span class="kobospan" id="kobo.1044.1">= 14</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1045.1">,E </span></span><span class="kobospan" id="kobo.1046.1">= 14</span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1047.1">,F </span></span><span class="kobospan" id="kobo.1048.1">= 15</span><span><span class="kobospan" id="kobo.1049.1">⟩</span></span><span class="kobospan" id="kobo.1050.1">, with base </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1051.1">b </span></span><span class="kobospan" id="kobo.1052.1">= 16:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1053.1"><img alt="48879 = 11 × 163 + 14 × 162 + 14× 16 + 15 " class="calibre9" src="../media/file49.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1054.1">There are many cases where the base isn’t a consistent power of some number. </span><span class="kobospan" id="kobo.1054.2">The ISO date format, for example, has a mixed base that involves 7 days per week, 24 hours per day, 60 minutes per hour, and 60 seconds per minute.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1055.1">Instead of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1056.1">b</span></span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.1057.1">4</span></span></sup><span class="kobospan" id="kobo.1058.1">, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1059.1">b</span></span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.1060.1">3</span></span></sup><span class="kobospan" id="kobo.1061.1">, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1062.1">b</span></span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.1063.1">2</span></span></sup><span class="kobospan" id="kobo.1064.1">, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1065.1">b</span></span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.1066.1">1</span></span></sup><span class="kobospan" id="kobo.1067.1"> = </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1068.1">b</span></span><span class="kobospan" id="kobo.1069.1">, and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1070.1">b</span></span><sup class="calibre15"><span class="cmr1"><span class="kobospan" id="kobo.1071.1">0</span></span></sup><span class="kobospan" id="kobo.1072.1"> = 1, we have 7 </span><span><span class="kobospan" id="kobo.1073.1">× </span></span><span class="kobospan" id="kobo.1074.1">24 </span><span><span class="kobospan" id="kobo.1075.1">× </span></span><span class="kobospan" id="kobo.1076.1">60 </span><span><span class="kobospan" id="kobo.1077.1">× </span></span><span class="kobospan" id="kobo.1078.1">60, 24 </span><span><span class="kobospan" id="kobo.1079.1">× </span></span><span class="kobospan" id="kobo.1080.1">60 </span><span><span class="kobospan" id="kobo.1081.1">× </span></span><span class="kobospan" id="kobo.1082.1">60, 60 </span><span><span class="kobospan" id="kobo.1083.1">× </span></span><span class="kobospan" id="kobo.1084.1">60, and 60 as the various values used to compute the polynomial.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1085.1">Given a week number, a day</span><span id="dx1-263001"/><span class="kobospan" id="kobo.1086.1"> of the week, an hour, a minute, and a second, we can compute a timestamp of seconds, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1087.1">t</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.1088.1">s</span></span></sub><span class="kobospan" id="kobo.1089.1">, within the given year:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1090.1"><img alt="ts = (((w × 7 + d)× 24 + h)× 60 + m )× 60 + s " class="calibre9" src="../media/file50.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1091.1">For example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1092.1">&gt;&gt;&gt; week = 13 
 
&gt;&gt;&gt; day = 2 
 
&gt;&gt;&gt; hour = 7 
 
&gt;&gt;&gt; minute = 53 
 
&gt;&gt;&gt; second = 19 
 
 
 
&gt;&gt;&gt; t_s = (((week*7+day)*24+hour)*60+minute)*60+second 
 
&gt;&gt;&gt; t_s 
 
8063599</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1093.1">This shows how we convert from the given moment into a timestamp. </span><span class="kobospan" id="kobo.1093.2">How do we invert this calculation? </span><span class="kobospan" id="kobo.1093.3">How do we get the various fields from the overall timestamp?</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1094.1">We’ll need to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1095.1">divmod</span></span></span></span><span class="kobospan" id="kobo.1096.1"> style division. </span><span class="kobospan" id="kobo.1096.2">For some background, refer to the </span><a href="ch005_split_000.xhtml#x1-270002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1097.1">Choosing between true division and floor division</span></span></a><span class="kobospan" id="kobo.1098.1"> recipe.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1099.1">The algorithm for converting a timestamp in seconds, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1100.1">t</span></span><sub class="calibre24"><span class="cmmi"><span class="kobospan" id="kobo.1101.1">s</span></span></sub><span class="kobospan" id="kobo.1102.1">, into individual week, day, and time fields looks like this:</span></p>
<table class="align-star">
<tbody class="calibre19">
<tr class="odd1">
<td class="align-odd">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.1103.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1104.1">m</span></span></sub><span class="kobospan" id="kobo.1105.1">; </span><span class="cmmi-10x-x"><span class="kobospan2" id="kobo.1106.1">s</span></span>
</td>
<td class="align-even"><span class="kobospan3" id="kobo.1107.1">
                = </span><span><span class="kobospan2" id="kobo.1108.1">⌊</span></span><span class="kobospan" id="kobo.1109.1"><img alt="ts- 60" src="../media/file51.png" class="calibre26"/></span><span><span class="kobospan2" id="kobo.1110.1">⌋</span></span><span class="kobospan" id="kobo.1111.1">; </span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.1112.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1113.1">s</span></span></sub><span class="kobospan4" id="kobo.1114.1"> mod 60
              </span></td>
<td class="align-label"/>
<td class="align-label"/>
</tr>
<tr class="odd1">
<td class="align-odd">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.1115.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1116.1">h</span></span></sub><span class="kobospan" id="kobo.1117.1">; </span><span class="cmmi-10x-x"><span class="kobospan2" id="kobo.1118.1">m</span></span>
</td>
<td class="align-even"><span class="kobospan3" id="kobo.1119.1">
                = </span><span><span class="kobospan2" id="kobo.1120.1">⌊</span></span><span class="kobospan" id="kobo.1121.1"><img alt="tm- 60" src="../media/file52.png" class="calibre26"/></span><span><span class="kobospan2" id="kobo.1122.1">⌋</span></span><span class="kobospan" id="kobo.1123.1">; </span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.1124.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1125.1">m</span></span></sub><span class="kobospan4" id="kobo.1126.1"> mod 60
              </span></td>
<td class="align-label"/>
<td class="align-label"/>
</tr>
<tr class="odd1">
<td class="align-odd">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.1127.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1128.1">d</span></span></sub><span class="kobospan" id="kobo.1129.1">; </span><span class="cmmi-10x-x"><span class="kobospan2" id="kobo.1130.1">h</span></span>
</td>
<td class="align-even"><span class="kobospan3" id="kobo.1131.1">
                = </span><span><span class="kobospan2" id="kobo.1132.1">⌊</span></span><span class="kobospan" id="kobo.1133.1"><img alt="th24" src="../media/file53.png" class="calibre26"/></span><span><span class="kobospan2" id="kobo.1134.1">⌋</span></span><span class="kobospan" id="kobo.1135.1">; </span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.1136.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1137.1">h</span></span></sub><span class="kobospan4" id="kobo.1138.1"> mod 24
              </span></td>
<td class="align-label"/>
<td class="align-label"/>
</tr>
<tr class="odd1">
<td class="align-odd">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.1139.1">w</span></span><span class="kobospan" id="kobo.1140.1">; </span><span class="cmmi-10x-x"><span class="kobospan2" id="kobo.1141.1">d</span></span>
</td>
<td class="align-even"><span class="kobospan3" id="kobo.1142.1">
                = </span><span><span class="kobospan2" id="kobo.1143.1">⌊</span></span><span class="kobospan" id="kobo.1144.1"><img alt="td7-" src="../media/file54.png" class="calibre26"/></span><span><span class="kobospan2" id="kobo.1145.1">⌋</span></span><span class="kobospan" id="kobo.1146.1">; </span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.1147.1">t</span></span><sub class="calibre24"><span class="cmmi1"><span class="kobospan2" id="kobo.1148.1">d</span></span></sub><span class="kobospan4" id="kobo.1149.1"> mod 7
              </span></td>
<td class="align-label"/>
<td class="align-label"/>
</tr>
</tbody>
</table>
<p class="normal1"><span class="kobospan" id="kobo.1150.1">This has a handy pattern that leads to an implementation. </span><span class="kobospan" id="kobo.1150.2">It has the consequence of producing the values in reverse order:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1151.1">&gt;&gt;&gt; t_s = 8063599 
 
&gt;&gt;&gt; fields = [] 
 
&gt;&gt;&gt; for base in 60, 60, 24, 7: 
 
... </span><span class="kobospan" id="kobo.1151.2">    t_s, f = divmod(t_s, base) 
 
... </span><span class="kobospan" id="kobo.1151.3">    fields.append(f) 
 
&gt;&gt;&gt; fields.append(t_s) 
 
&gt;&gt;&gt; fields 
 
[19, 53, 7, 2, 13]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1152.1">We’ve applied the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1153.1">divmod()</span></span></span></span><span class="kobospan" id="kobo.1154.1"> function</span><span id="dx1-263021"/><span class="kobospan" id="kobo.1155.1"> four times to extract seconds, minutes, hours, days, and weeks from a timestamp, given in seconds. </span><span class="kobospan" id="kobo.1155.2">These are in the wrong order. </span><span class="kobospan" id="kobo.1155.3">How can we reverse them? </span><span id="x1-263022r504"/></p>
</section>
<section data-number="0.7.6.2" id="how-to-do-it...-35">
<h2 class="likechapterhead" data-number="0.7.6.2"><span><span class="kobospan" id="kobo.1156.1">4.6.2 </span></span> <span id="x1-2640002"/><span class="kobospan" id="kobo.1157.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1158.1">We have three approaches: we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1159.1">reverse()</span></span></span></span><span class="kobospan" id="kobo.1160.1"> method, we can use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1161.1">[::-1]</span></span></span></span><span class="kobospan" id="kobo.1162.1"> slice expression, or we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1163.1">reversed()</span></span></span></span><span class="kobospan" id="kobo.1164.1"> built-in function. </span><span class="kobospan" id="kobo.1164.2">Here’s the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1165.1">reverse()</span></span></span></span><span class="kobospan" id="kobo.1166.1"> method:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1167.1">&gt;&gt;&gt; fields_copy1 = fields.copy() 
 
&gt;&gt;&gt; fields_copy1.reverse() 
 
&gt;&gt;&gt; fields_copy1 
 
[13, 2, 7, 53, 19]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1168.1">We made a copy of the original list so that we could keep an unmutated copy to compare with the mutated copy. </span><span class="kobospan" id="kobo.1168.2">This makes it easier to follow the examples. </span><span class="kobospan" id="kobo.1168.3">We applied the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1169.1">reverse()</span></span></span></span><span class="kobospan" id="kobo.1170.1"> method to reverse a copy of the list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1171.1">This will mutate the list. </span><span class="kobospan" id="kobo.1171.2">As with other mutating methods, it does not return a useful value. </span><span class="kobospan" id="kobo.1171.3">It’s incorrect to use a statement like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1172.1">a</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1173.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1174.1"> b.reverse()</span></span></span></span><span class="kobospan" id="kobo.1175.1">; the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1176.1">a</span></span></span></span><span class="kobospan" id="kobo.1177.1"> will always be </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1178.1">None</span></span></span></span><span class="kobospan" id="kobo.1179.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1180.1">Here’s a slice expression</span><span id="dx1-264006"/><span class="kobospan" id="kobo.1181.1"> with a negative step:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1182.1">&gt;&gt;&gt; fields_copy2 = fields[::-1] 
 
&gt;&gt;&gt; fields_copy2 
 
[13, 2, 7, 53, 19]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1183.1">In this example, we made a slice </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1184.1">[::-1]</span></span></span></span><span class="kobospan" id="kobo.1185.1"> that uses an implied start and stop, and a step of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1186.1">-1</span></span></span></span><span class="kobospan" id="kobo.1187.1">. </span><span class="kobospan" id="kobo.1187.2">This picks all the items in the list in reverse order to create a new list.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1188.1">The original list is emphatically </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1189.1">not </span></span><span class="kobospan" id="kobo.1190.1">mutated by this slice operation. </span><span class="kobospan" id="kobo.1190.2">This creates a copy. </span><span class="kobospan" id="kobo.1190.3">Check the value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1191.1">fields</span></span></span></span><span class="kobospan" id="kobo.1192.1"> variable to see that it’s unchanged.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1193.1">Here’s how we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1194.1">reversed()</span></span></span></span><span class="kobospan" id="kobo.1195.1"> function to create a reversed copy of a list of values:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1196.1">&gt;&gt;&gt; fields_copy3 = list(reversed(fields)) 
 
&gt;&gt;&gt; fields_copy3 
 
[13, 2, 7, 53, 19]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1197.1">It’s important to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1198.1">list()</span></span></span></span><span class="kobospan" id="kobo.1199.1"> function in this example. </span><span class="kobospan" id="kobo.1199.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1200.1">reversed()</span></span></span></span><span class="kobospan" id="kobo.1201.1"> function is a generator, and we need to consume the items from the generator to create a new list. </span><span id="x1-264015r507"/></p>
</section>
<section data-number="0.7.6.3" id="how-it-works...-35">
<h2 class="likechapterhead" data-number="0.7.6.3"><span><span class="kobospan" id="kobo.1202.1">4.6.3 </span></span> <span id="x1-2650003"/><span class="kobospan" id="kobo.1203.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1204.1">As we noted in the </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1205.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.1206.1"> recipe, the slice notation is quite sophisticated. </span><span class="kobospan" id="kobo.1206.2">Using a slice with a negative step size will create a copy (or a subset) with items processed in right to left order, instead of the default left to right order.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1207.1">It’s important to distinguish between these three methods:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1208.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1209.1">reverse()</span></span></span></span><span class="kobospan" id="kobo.1210.1"> method modifies the list object itself. </span><span class="kobospan" id="kobo.1210.2">As with methods like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1211.1">append()</span></span></span></span><span class="kobospan" id="kobo.1212.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1213.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1214.1">, there is no return value from this method. </span><span class="kobospan" id="kobo.1214.2">Because it changes the list, it doesn’t return a value.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1215.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1216.1">[::-1]</span></span></span></span><span class="kobospan" id="kobo.1217.1"> slice expression creates a new list. </span><span class="kobospan" id="kobo.1217.2">This is a shallow copy of the original list, with the order reversed.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1218.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1219.1">reversed()</span></span></span></span><span class="kobospan" id="kobo.1220.1"> function is a generator that yields the values in reverse order. </span><span class="kobospan" id="kobo.1220.2">When the values are consumed</span><span id="dx1-265001"/><span class="kobospan" id="kobo.1221.1"> by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1222.1">list()</span></span></span></span><span class="kobospan" id="kobo.1223.1"> function, it creates a copy of the list.</span></p></li>
</ul>
<p class="normal1"><span id="x1-265002r511"/></p>
</section>
<section data-number="0.7.6.4" id="see-also-35">
<h2 class="likechapterhead" data-number="0.7.6.4"><span><span class="kobospan" id="kobo.1224.1">4.6.4 </span></span> <span id="x1-2660004"/><span class="kobospan" id="kobo.1225.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1226.1">Refer to the </span><a href="ch009.xhtml#x1-3160005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1227.1">Making shallow and deep copies of objects</span></span></a><span class="kobospan" id="kobo.1228.1"> recipe for more information on what a shallow copy is and why we might want to make a deep copy.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1229.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2310002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1230.1">Building lists – literals, appending, and comprehensions</span></span></a><span class="kobospan" id="kobo.1231.1"> recipe for ways to create lists.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1232.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2400003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1233.1">Slicing and dicing a list</span></span></a><span class="kobospan" id="kobo.1234.1"> recipe for ways to copy lists and pick sublists from a list.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1235.1">Refer to the </span><a href="ch008_split_000.xhtml#x1-2460004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1236.1">Shrinking lists – deleting, removing, and popping</span></span></a><span class="kobospan" id="kobo.1237.1"> recipe for other ways to remove items from a list.</span></p></li>
</ul>
<p class="normal1"><span id="x1-266001r503"/></p>
</section>
</section>
<section data-number="0.7.7" id="building-sets-literals-adding-comprehensions-and-operators">
<h1 class="unnumbered" data-number="0.7.7"><span><span class="kobospan" id="kobo.1238.1">4.7 </span></span> <span id="x1-2670007"/><span class="kobospan" id="kobo.1239.1">Building sets – literals, adding, comprehensions, and operators</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1240.1">If we’ve decided to create a collection</span><span id="dx1-267001"/><span class="kobospan" id="kobo.1241.1"> based on only an item being present—a set—we have several ways of building this structure. </span><span class="kobospan" id="kobo.1241.2">Because of the narrow focus of sets, there’s no ordering to the items—no relative positions—and items cannot be duplicated. </span><span class="kobospan" id="kobo.1241.3">We’ll look at a number of ways we can assemble a set collection from a source of individual items.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1242.1">The set operators parallel the operators defined by the mathematics of set theory. </span><span class="kobospan" id="kobo.1242.2">These can be helpful for doing bulk comparisons between sets. </span><span class="kobospan" id="kobo.1242.3">We’ll look at these in addition to the methods of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1243.1">set</span></span></span></span><span class="kobospan" id="kobo.1244.1"> class.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1245.1">Sets have an important constraint: they only contain immutable objects. </span><span class="kobospan" id="kobo.1245.2">Informally, immutable objects have no internal state that can be changed. </span><span class="kobospan" id="kobo.1245.3">Numbers are immutable, as are strings, and tuples of immutable objects. </span><span class="kobospan" id="kobo.1245.4">Formally, immutable objects have an internal hash value, and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1246.1">hash()</span></span></span></span><span class="kobospan" id="kobo.1247.1"> function will show this value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1248.1">Here’s how this looks in practice:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1249.1">&gt;&gt;&gt; a = "string" 
 
&gt;&gt;&gt; hash(a) 
 
... </span><span class="kobospan" id="kobo.1249.2"># doctest: +SKIP 
 
4964286962312962439 
 
 
 
&gt;&gt;&gt; b = ["list", "of", "strings"] 
 
&gt;&gt;&gt; hash(b) 
 
Traceback (most recent call last): 
 
... 
 
TypeError: unhashable type: ’list’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1250.1">The value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1251.1">a</span></span></span></span><span class="kobospan" id="kobo.1252.1"> variable is an immutable</span><span id="dx1-267013"/><span class="kobospan" id="kobo.1253.1"> string, which has a hash value. </span><span class="kobospan" id="kobo.1253.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1254.1">b</span></span></span></span><span class="kobospan" id="kobo.1255.1"> variable, on the other hand, is a mutable list, and doesn’t have a hash value. </span><span class="kobospan" id="kobo.1255.2">We can create sets of immutable objects like strings, but the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1256.1">TypeError</span></span></span></span><span class="kobospan" id="kobo.1257.1"> exception will be raised if we try to put mutable objects into a set. </span><span id="x1-267014r512"/></p>
<section data-number="0.7.7.1" id="getting-ready-36">
<h2 class="likechapterhead" data-number="0.7.7.1"><span><span class="kobospan" id="kobo.1258.1">4.7.1 </span></span> <span id="x1-2680001"/><span class="kobospan" id="kobo.1259.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1260.1">Let’s say we need to do some analysis of the dependencies among modules in a complex application. </span><span class="kobospan" id="kobo.1260.2">Here’s one part of the available data:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1261.1">&gt;&gt;&gt; import_details = [ 
 
... </span><span class="kobospan" id="kobo.1261.2">(’Chapter_12.ch12_r01’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.3">(’Chapter_12.ch12_r02’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.4">(’Chapter_12.ch12_r03’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.5">(’Chapter_12.ch12_r04’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.6">(’Chapter_12.ch12_r05’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.7">(’Chapter_12.ch12_r06’, [’typing’, ’textwrap’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.8">(’Chapter_12.ch12_r07’, [’typing’, ’Chapter_12.ch12_r06’, ’Chapter_12.ch12_r05’, ’concurrent’]), 
 
... </span><span class="kobospan" id="kobo.1261.9">(’Chapter_12.ch12_r08’, [’typing’, ’argparse’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.10">(’Chapter_12.ch12_r09’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.11">(’Chapter_12.ch12_r10’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.12">(’Chapter_12.ch12_r11’, [’typing’, ’pathlib’]), 
 
... </span><span class="kobospan" id="kobo.1261.13">(’Chapter_12.ch12_r12’, [’typing’, ’argparse’])</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1262.1">Each item in this list names a module and a list of modules that it imports. </span><span class="kobospan" id="kobo.1262.2">There are a number of questions we can ask about this collection of relationships among modules. </span><span class="kobospan" id="kobo.1262.3">We’d like to compute the short list</span><span id="dx1-268015"/><span class="kobospan" id="kobo.1263.1"> of dependencies, thereby removing duplicates from this list. </span><span id="x1-268016r515"/></p>
</section>
<section data-number="0.7.7.2" id="how-to-do-it...-36">
<h2 class="likechapterhead" data-number="0.7.7.2"><span><span class="kobospan" id="kobo.1264.1">4.7.2 </span></span> <span id="x1-2690002"/><span class="kobospan" id="kobo.1265.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1266.1">We have many ways to create set objects:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1267.1">Literal</span></span><span class="kobospan" id="kobo.1268.1">: We can create literal</span><span id="dx1-269001"/><span class="kobospan" id="kobo.1269.1"> display of a set using a sequence of values surrounded by characters. </span><span class="kobospan" id="kobo.1269.2">It looks like this: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1270.1">{value,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1271.1"> ...</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1272.1"> }</span></span></span></span><span class="kobospan" id="kobo.1273.1">. </span><span class="kobospan" id="kobo.1273.2">Python needs to match the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1274.1">{</span></span></span></span><span class="kobospan" id="kobo.1275.1"> at the start of the literal and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1276.1">}</span></span></span></span><span class="kobospan" id="kobo.1277.1"> at the end of the literal to see a complete logical line, so the literal can span physical lines. </span><span class="kobospan" id="kobo.1277.2">For more information, refer to the </span><a href="ch006_split_000.xhtml#x1-910002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1278.1">Writing long lines of</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1279.1">code</span></span></a><span class="kobospan" id="kobo.1280.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1281.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1282.1"> </span></span><a href="ch006_split_000.xhtml#x1-840002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1283.1">2</span></span></a><span class="kobospan" id="kobo.1284.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1285.1">Note that we can’t create an empty set with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1286.1">{}</span></span></span></span><span class="kobospan" id="kobo.1287.1">; this is an empty dictionary. </span><span class="kobospan" id="kobo.1287.2">We must use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1288.1">set()</span></span></span></span><span class="kobospan" id="kobo.1289.1"> to create an empty set.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1290.1">Conversion function</span></span><span class="kobospan" id="kobo.1291.1">: We can convert some other data collection</span><span id="dx1-269002"/><span class="kobospan" id="kobo.1292.1"> into a set using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1293.1">set()</span></span></span></span><span class="kobospan" id="kobo.1294.1"> function. </span><span class="kobospan" id="kobo.1294.2">We can convert a list of immutable items, or the keys of a dict, or a tuple of immutable items.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1295.1">Add method</span></span><span class="kobospan" id="kobo.1296.1">: The set method </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1297.1">add()</span></span></span></span><span class="kobospan" id="kobo.1298.1"> will add an item</span><span id="dx1-269003"/><span class="kobospan" id="kobo.1299.1"> to a set. </span><span class="kobospan" id="kobo.1299.2">Additionally, sets can be created by a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1300.1">union()</span></span></span></span><span class="kobospan" id="kobo.1301.1"> method or the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1302.1">|</span></span></span></span><span class="kobospan" id="kobo.1303.1"> operator.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1304.1">Comprehension</span></span><span class="kobospan" id="kobo.1305.1">: A comprehension is a specialized generator expression</span><span id="dx1-269004"/><span class="kobospan" id="kobo.1306.1"> that describes the items in a set using an expression to define membership. </span><span class="kobospan" id="kobo.1306.2">We’ll look at this in detail in the </span><a href="ch008_split_001.xhtml#x1-2710002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1307.1">Writing a set</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1308.1">comprehension</span></span></a><span class="kobospan" id="kobo.1309.1"> section of this recipe.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1310.1">The first two ways to create sets are single Python expressions. </span><span class="kobospan" id="kobo.1310.2">The last two are more complex, and we’ll show recipes for each of them.</span></p>
<section data-number="0.7.7.2.1" id="building-a-set-with-the-add-method">
<h3 class="likesubsubsectionhead" data-number="0.7.7.2.1"><span id="x1-2700002"/><span class="kobospan" id="kobo.1311.1">Building a set with the add method</span></h3>
<p class="normal"><span class="kobospan" id="kobo.1312.1">Our source collection of data</span><span id="dx1-270001"/><span class="kobospan" id="kobo.1313.1"> is a list</span><span id="dx1-270002"/><span class="kobospan" id="kobo.1314.1"> with sublists. </span><span class="kobospan" id="kobo.1314.2">We want to summarize the items inside each of the sublists:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-270004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1315.1">Create an empty set into which items can be added. </span><span class="kobospan" id="kobo.1315.2">Unlike lists, there’s no abbreviated syntax for an empty set, so we must use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1316.1">set()</span></span></span></span><span class="kobospan" id="kobo.1317.1"> function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1318.1">                                                                     &gt;&gt;&gt; all_imports = set()</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-270008x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1319.1">Write a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1320.1">for</span></span></span></span><span class="kobospan" id="kobo.1321.1"> statement to iterate through each two-tuple in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1322.1">import_details</span></span></span></span><span class="kobospan" id="kobo.1323.1"> collection. </span><span class="kobospan" id="kobo.1323.2">This needs a nested </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1324.1">for</span></span></span></span><span class="kobospan" id="kobo.1325.1"> statement to iterate through each name in the list of imports in each pair. </span><span class="kobospan" id="kobo.1325.2">Use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1326.1">add()</span></span></span></span><span class="kobospan" id="kobo.1327.1"> method of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1328.1">all_imports</span></span></span></span><span class="kobospan" id="kobo.1329.1"> set to create a complete set with duplicates removed:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1330.1">
&gt;&gt;&gt; for item, import_list in import_details: 
 
... </span><span class="kobospan" id="kobo.1330.2">    for name in import_list: 
 
... </span><span class="kobospan" id="kobo.1330.3">        all_imports.add(name) 
 
&gt;&gt;&gt; all_imports == {’Chapter_12.ch12_r06’, ’textwrap’, 
 
... </span><span class="kobospan" id="kobo.1330.4">    ’Chapter_12.ch12_r05’, ’pathlib’, ’concurrent’, 
 
... </span><span class="kobospan" id="kobo.1330.5">    ’argparse’, ’typing’} 
 
True</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1331.1">This result summarizes many lines of details, showing the set of distinct items imported. </span><span class="kobospan" id="kobo.1331.2">Note that the order here is arbitrary and can vary each time the example is executed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1332.1">The arbitrary ordering</span><span id="dx1-270017"/><span class="kobospan" id="kobo.1333.1"> means a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1334.1">doctest </span></span><span class="kobospan" id="kobo.1335.1">example to confirm</span><span id="dx1-270018"/><span class="kobospan" id="kobo.1336.1"> the correctness of this code can’t simply show the expected</span><span id="dx1-270019"/><span class="kobospan" id="kobo.1337.1"> result. </span><span class="kobospan" id="kobo.1337.2">See the </span><a href="ch019_split_000.xhtml#x1-8100003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1338.1">Handling</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1339.1">common doctest issues</span></span></a><span class="kobospan" id="kobo.1340.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1341.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1342.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1343.1">15</span></span></a> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1344.1">for more advice on using</span></span> <span class="cmbxti-10x-x"><span class="kobospan" id="kobo.1345.1">doctest</span></span><span class="kobospan" id="kobo.1346.1">.</span></p>
</section>
<section data-number="0.7.7.2.2" id="writing-a-set-comprehension">
<h3 class="likesubsubsectionhead" data-number="0.7.7.2.2"><span id="x1-2710002"/><span class="kobospan" id="kobo.1347.1">Writing a set comprehension</span></h3>
<p class="normal"><span class="kobospan" id="kobo.1348.1">The goal of a set comprehension</span><span id="dx1-271001"/><span class="kobospan" id="kobo.1349.1"> is to create an object that occupies a syntax role, similar to a set literal:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-271003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1350.1">Write the wrapping braces that surround the set object to be built:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1351.1">&gt;&gt;&gt; {} 
 
{}</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-271008x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1352.1">Write the source of the data. </span><span class="kobospan" id="kobo.1352.2">This will include the target variable. </span><span class="kobospan" id="kobo.1352.3">We have two nested lists, so we’ll need to use two </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1353.1">for</span></span></span></span><span class="kobospan" id="kobo.1354.1"> clauses. </span><span class="kobospan" id="kobo.1354.2">Note that there’s no </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1355.1">:</span></span></span></span><span class="kobospan" id="kobo.1356.1"> at the end of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1357.1">for</span></span></span></span><span class="kobospan" id="kobo.1358.1"> clause because we’re not writing a complete statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1359.1">&gt;&gt;&gt; {... 
 
... </span><span class="kobospan" id="kobo.1359.2">    for item, import_list in import_details 
 
... </span><span class="kobospan" id="kobo.1359.3">        for name in import_list 
 
... </span><span class="kobospan" id="kobo.1359.4">} 
 
{Ellipsis}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1360.1">For now, we’ve written the result of the expression as the special </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1361.1">Ellipsis</span></span></span></span><span class="kobospan" id="kobo.1362.1"> object. </span><span class="kobospan" id="kobo.1362.2">Once we finish this expression, we will replace it with something more useful.</span></p>
</div></li>
<li class="calibre7"><div id="x1-271016x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1363.1">Prefix the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1364.1">for</span></span></span></span><span class="kobospan" id="kobo.1365.1"> clause with the expression to evaluate that creates each value of the target collection. </span><span class="kobospan" id="kobo.1365.2">In this case, we only want the name from the import list within each pair of items in the overall import details list-of-lists:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1366.1">&gt;&gt;&gt; names = {name 
 
... </span><span class="kobospan" id="kobo.1366.2">    for item, import_list in import_details 
 
... </span><span class="kobospan" id="kobo.1366.3">        for name in import_list} 
 
&gt;&gt;&gt; names ==  {’Chapter_12.ch12_r06’, ’Chapter_12.ch12_r05’, 
 
... </span><span class="kobospan" id="kobo.1366.4">    ’typing’, ’concurrent’, ’argparse’, ’textwrap’, ’pathlib’} 
 
True</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1367.1">A set comprehension cannot have duplicates, so this will always have distinct values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1368.1">As with the list comprehension, a set comprehension is built around a central generator expression. </span><span class="kobospan" id="kobo.1368.2">The generator expression at the heart of the comprehension has a data expression clause and a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1369.1">for</span></span></span></span><span class="kobospan" id="kobo.1370.1"> clause.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1371.1">We can replace the enclosing </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1372.1">{</span></span></span></span><span class="kobospan" id="kobo.1373.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1374.1">}</span></span></span></span><span class="kobospan" id="kobo.1375.1"> syntax with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1376.1">set()</span></span></span></span><span class="kobospan" id="kobo.1377.1"> function. </span><span class="kobospan" id="kobo.1377.2">Using the explicit </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1378.1">set()</span></span></span></span><span class="kobospan" id="kobo.1379.1"> function had an advantage when we consider the possibility of changing the data structure. </span><span class="kobospan" id="kobo.1379.2">We can easily replace</span><span id="dx1-271024"/> <span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1380.1">set()</span></span></span></span><span class="kobospan" id="kobo.1381.1"> with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1382.1">frozenset()</span></span></span></span><span class="kobospan" id="kobo.1383.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1384.1">list()</span></span></span></span><span class="kobospan" id="kobo.1385.1">, or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1386.1">Counter()</span></span></span></span><span class="kobospan" id="kobo.1387.1">. </span><span id="x1-271025r517"/></p>
</section>
</section>
<section data-number="0.7.7.3" id="how-it-works...-36">
<h2 class="likechapterhead" data-number="0.7.7.3"><span><span class="kobospan" id="kobo.1388.1">4.7.3 </span></span> <span id="x1-2720003"/><span class="kobospan" id="kobo.1389.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1390.1">A set is a collection of immutable</span><span id="dx1-272001"/><span class="kobospan" id="kobo.1391.1"> objects. </span><span class="kobospan" id="kobo.1391.2">Each immutable Python object has a hash value, and these numeric hash codes are used to optimize locating items in a set. </span><span class="kobospan" id="kobo.1391.3">We can imagine the implementation relies on an array of buckets, and the numeric hash value directs us to a bucket to see if the item is present in that bucket or not.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1392.1">Hash values are not necessarily unique. </span><span class="kobospan" id="kobo.1392.2">The array of hash buckets is finite, meaning hash collisions are possible. </span><span class="kobospan" id="kobo.1392.3">A collision occurs when two distinct objects both have the same hash value. </span><span class="kobospan" id="kobo.1392.4">This leads to some overhead to handle any collisions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1393.1">We can create two integers that will have a hash collision:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1394.1">&gt;&gt;&gt; import sys 
 
&gt;&gt;&gt; v1 = 7 
 
&gt;&gt;&gt; v2 = 7+sys.hash_info.modulus 
 
&gt;&gt;&gt; v1 
 
7 
 
&gt;&gt;&gt; v2 
 
2305843009213693958 
 
 
 
&gt;&gt;&gt; hash(v1) 
 
7 
 
&gt;&gt;&gt; hash(v2) 
 
7</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1395.1">In spite of these two objects having the same hash value, hash collision processing will keep these two objects separate</span><span id="dx1-272015"/><span class="kobospan" id="kobo.1396.1"> from each other in a set. </span><span id="x1-272016r525"/></p>
</section>
<section data-number="0.7.7.4" id="theres-more...-29">
<h2 class="likechapterhead" data-number="0.7.7.4"><span><span class="kobospan" id="kobo.1397.1">4.7.4 </span></span> <span id="x1-2730004"/><span class="kobospan" id="kobo.1398.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1399.1">We have several ways to add items</span><span id="dx1-273001"/><span class="kobospan" id="kobo.1400.1"> to a set:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1401.1">The example used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1402.1">add()</span></span></span></span><span class="kobospan" id="kobo.1403.1"> method. </span><span class="kobospan" id="kobo.1403.2">This works with a single item.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1404.1">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1405.1">union()</span></span></span></span><span class="kobospan" id="kobo.1406.1"> method. </span><span class="kobospan" id="kobo.1406.2">This method is like an operator—it creates a new result set. </span><span class="kobospan" id="kobo.1406.3">It does not mutate either of the operand sets.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1407.1">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1408.1">update()</span></span></span></span><span class="kobospan" id="kobo.1409.1"> method to update one set with items from another set. </span><span class="kobospan" id="kobo.1409.2">This mutates a set and does not return a value.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1410.1">For most of these techniques, we’ll need to create a singleton set from the item we’re going to add. </span><span class="kobospan" id="kobo.1410.2">Here are some examples:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1411.1">&gt;&gt;&gt; collection = {1} 
 
&gt;&gt;&gt; collection 
 
{1} 
 
 
 
&gt;&gt;&gt; item = 3 
 
&gt;&gt;&gt; collection.union({item}) 
 
{1, 3} 
 
 
 
&gt;&gt;&gt; collection 
 
{1}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1412.1">In the preceding example, we’ve created a singleton set, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1413.1">{item}</span></span></span></span><span class="kobospan" id="kobo.1414.1">, from the value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1415.1">item</span></span></span></span><span class="kobospan" id="kobo.1416.1"> variable. </span><span class="kobospan" id="kobo.1416.2">We then used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1417.1">union()</span></span></span></span><span class="kobospan" id="kobo.1418.1"> method to compute a new set, which is the union of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1419.1">collection</span></span></span></span><span class="kobospan" id="kobo.1420.1"> set and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1421.1">{item}</span></span></span></span><span class="kobospan" id="kobo.1422.1"> set.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1423.1">Note that </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1424.1">union()</span></span></span></span><span class="kobospan" id="kobo.1425.1"> creates a new object and leaves the original collection untouched. </span><span class="kobospan" id="kobo.1425.2">Here is yet another alternative that uses the union operator, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1426.1">|</span></span></span></span><span class="kobospan" id="kobo.1427.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1428.1">&gt;&gt;&gt; collection = collection | {item} 
 
&gt;&gt;&gt; collection 
 
{1, 3}
                                                                     

                                                                     </span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1429.1">We can also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1430.1">update()</span></span></span></span><span class="kobospan" id="kobo.1431.1"> method to mutate the set:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1432.1">&gt;&gt;&gt; collection.update({4}) 
 
&gt;&gt;&gt; collection 
 
{1, 3, 4}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1433.1">Methods like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1434.1">update()</span></span></span></span><span class="kobospan" id="kobo.1435.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1436.1">add()</span></span></span></span><span class="kobospan" id="kobo.1437.1"> mutate the set</span><span id="dx1-273021"/><span class="kobospan" id="kobo.1438.1"> object. </span><span class="kobospan" id="kobo.1438.2">Because they mutate the set, they do not return a value. </span><span class="kobospan" id="kobo.1438.3">This is similar to the way methods of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1439.1">list</span></span></span></span><span class="kobospan" id="kobo.1440.1"> collection work. </span><span class="kobospan" id="kobo.1440.2">Generally, a method that mutates the collection does not return a value. </span><span class="kobospan" id="kobo.1440.3">The only exception to this pattern is the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1441.1">pop()</span></span></span></span><span class="kobospan" id="kobo.1442.1"> method, which both mutates the set object and returns the popped value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1443.1">Python has a number of set operators. </span><span class="kobospan" id="kobo.1443.2">These are ordinary operator symbols</span><span id="dx1-273022"/><span class="kobospan" id="kobo.1444.1"> that we can use in complex set expressions:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1445.1">|</span></span></span></span><span class="kobospan" id="kobo.1446.1"> for set union, often typeset as </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1447.1">A </span></span><span><span class="kobospan" id="kobo.1448.1">∪ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1449.1">B</span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1450.1">&amp;</span></span></span></span><span class="kobospan" id="kobo.1451.1"> for set intersection, often typeset as </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1452.1">A </span></span><span><span class="kobospan" id="kobo.1453.1">∩ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1454.1">B</span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1455.1">^</span></span></span></span><span class="kobospan" id="kobo.1456.1"> for set symmetric difference, often typeset as </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1457.1">A </span></span><span><span class="kobospan" id="kobo.1458.1">△ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1459.1">B</span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1460.1">-</span></span></span></span><span class="kobospan" id="kobo.1461.1"> for set</span><span id="dx1-273023"/><span class="kobospan" id="kobo.1462.1"> subtraction, often typeset as </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1463.1">A </span></span><span><span class="kobospan" id="kobo.1464.1">∖ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1465.1">B</span></span></p></li>
</ul>
<p class="normal1"><span id="x1-273024r527"/></p>
</section>
<section data-number="0.7.7.5" id="see-also-36">
<h2 class="likechapterhead" data-number="0.7.7.5"><span><span class="kobospan" id="kobo.1466.1">4.7.5 </span></span> <span id="x1-2740005"/><span class="kobospan" id="kobo.1467.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1468.1">In the </span><a href="ch008_split_001.xhtml#x1-2750008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1469.1">Shrinking sets – remove(), pop(), and difference</span></span></a><span class="kobospan" id="kobo.1470.1"> recipe, we’ll look at how we can update a set by removing or replacing items.</span></p></li>
</ul>
<p class="normal1"><span id="x1-274001r513"/></p>
</section>
</section>
<section data-number="0.7.8" id="shrinking-sets-remove-pop-and-difference">
<h1 class="unnumbered" data-number="0.7.8"><span><span class="kobospan" id="kobo.1471.1">4.8 </span></span> <span id="x1-2750008"/><span class="kobospan" id="kobo.1472.1">Shrinking sets – remove(), pop(), and difference</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1473.1">Python gives us several</span><span id="dx1-275001"/><span class="kobospan" id="kobo.1474.1"> ways to remove items from a set collection. </span><span class="kobospan" id="kobo.1474.2">We can</span><span id="dx1-275002"/><span class="kobospan" id="kobo.1475.1"> use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1476.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1477.1"> method to remove a specific item. </span><span class="kobospan" id="kobo.1477.2">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1478.1">pop()</span></span></span></span><span class="kobospan" id="kobo.1479.1"> method to remove</span><span id="dx1-275003"/><span class="kobospan" id="kobo.1480.1"> (and return) an arbitrary item.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1481.1">Additionally, we can compute a new set using the set intersection, difference, and symmetric difference operators: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1482.1">&amp;</span></span></span></span><span class="kobospan" id="kobo.1483.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1484.1">-</span></span></span></span><span class="kobospan" id="kobo.1485.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1486.1">^</span></span></span></span><span class="kobospan" id="kobo.1487.1">. </span><span class="kobospan" id="kobo.1487.2">These will produce a new set that is a subset of a given input set. </span><span id="x1-275004r531"/></p>
<section data-number="0.7.8.1" id="getting-ready-37">
<h2 class="likechapterhead" data-number="0.7.8.1"><span><span class="kobospan" id="kobo.1488.1">4.8.1 </span></span> <span id="x1-2760001"/><span class="kobospan" id="kobo.1489.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1490.1">Sometimes, we’ll have log files that contain lines with complex and varied formats. </span><span class="kobospan" id="kobo.1490.2">Here’s a small snippet from a long, complex log:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1491.1">&gt;&gt;&gt; log = """ 
 
... </span><span class="kobospan" id="kobo.1491.2">[2016-03-05T09:29:31-05:00] INFO: Processing ruby_block[print IP] action run (@recipe_files::/home/slott/ch4/deploy.rb line 9) 
 
... </span><span class="kobospan" id="kobo.1491.3">[2016-03-05T09:29:31-05:00] INFO: Installed IP: 111.222.111.222 
 
... </span><span class="kobospan" id="kobo.1491.4">[2016-03-05T09:29:31-05:00] INFO: ruby_block[print IP] called 
 
...</span></code></pre>
<div class="tipbox1" id="tcolobox-9">
<span id="x1-276008x1"/>
<div class="note">
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1492.1"> 
 
... </span><span class="kobospan" id="kobo.1492.2">(Skipping some details)</span></code></pre>
</div>
</div>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1493.1">
 
 
... </span><span class="kobospan" id="kobo.1493.2">"""</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1494.1">We need to find all of the text similar to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1495.1">IP:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1496.1"> 111.222.111.222</span></span></span></span><span class="kobospan" id="kobo.1497.1"> in this log. </span><span class="kobospan" id="kobo.1497.2">These are IPv4 addresses with 4 numeric fields.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1498.1">Here’s how we can create</span><span id="dx1-276011"/><span class="kobospan" id="kobo.1499.1"> a set of matches:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1500.1">&gt;&gt;&gt; import re 
 
&gt;&gt;&gt; pattern = re.compile(r"IP: \d+\.\d+\.\d+\.\d+") 
 
&gt;&gt;&gt; matches = set(pattern.findall(log)) 
 
&gt;&gt;&gt; matches 
 
{’IP: 111.222.111.222’}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1501.1">The problem we have with this log is extraneous matches. </span><span class="kobospan" id="kobo.1501.2">The log file also has text that looks similar but are dummy or placeholder values we need to ignore. </span><span class="kobospan" id="kobo.1501.3">In the full log, we’ll also find lines containing text like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1502.1">IP:</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1503.1"> 1.2.3.4</span></span></span></span><span class="kobospan" id="kobo.1504.1">, which is a placeholder, not a meaningful address. </span><span class="kobospan" id="kobo.1504.2">It turns out that there is a small set of irrelevant values.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1505.1">This is a place where set intersection and set subtraction can be very helpful. </span><span id="x1-276018r533"/></p>
</section>
<section data-number="0.7.8.2" id="how-to-do-it...-37">
<h2 class="likechapterhead" data-number="0.7.8.2"><span><span class="kobospan" id="kobo.1506.1">4.8.2 </span></span> <span id="x1-2770002"/><span class="kobospan" id="kobo.1507.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-277002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1508.1">Create a set of items we’d like to ignore as a set literal:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1509.1">&gt;&gt;&gt; to_be_ignored = {’IP: 0.0.0.0’, ’IP: 1.2.3.4’}</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-277006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1510.1">Collect all entries from the log. </span><span class="kobospan" id="kobo.1510.2">We’ll use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1511.1">re</span></span></span></span><span class="kobospan" id="kobo.1512.1"> module for this, as shown earlier. </span><span class="kobospan" id="kobo.1512.2">We’ll see results like the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1513.1">&gt;&gt;&gt; matches = {’IP: 111.222.111.222’, ’IP: 1.2.3.4’}                                                                

                                                                     
     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-277010x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1514.1">Remove items from the set of matches using set subtraction. </span><span class="kobospan" id="kobo.1514.2">Here are two examples:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1515.1">&gt;&gt;&gt; matches - to_be_ignored 
 
{’IP: 111.222.111.222’} 
 
&gt;&gt;&gt; matches.difference(to_be_ignored) 
 
{’IP: 111.222.111.222’}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1516.1">Both of these are operators that return new sets as their results. </span><span class="kobospan" id="kobo.1516.2">Neither of these will mutate the underlying set objects.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1517.1">It turns out the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1518.1">difference()</span></span></span></span><span class="kobospan" id="kobo.1519.1"> method can work</span><span id="dx1-277016"/><span class="kobospan" id="kobo.1520.1"> with any iterable</span><span id="dx1-277017"/><span class="kobospan" id="kobo.1521.1"> collection, including lists and tuples. </span><span class="kobospan" id="kobo.1521.2">While permitted, mixing sets and lists can be confusing, and it can be challenging to write type hints for them.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1522.1">We’ll often use these in statements, like this example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1523.1">&gt;&gt;&gt; valid_matches = matches - to_be_ignored 
 
&gt;&gt;&gt; valid_matches 
 
{’IP: 111.222.111.222’}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1524.1">This will assign the resulting set to a new variable, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1525.1">valid_matches</span></span></span></span><span class="kobospan" id="kobo.1526.1">, so that we can do the required processing on this new set.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1527.1">We can also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1528.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1529.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1530.1">pop()</span></span></span></span><span class="kobospan" id="kobo.1531.1"> methods to remove specific</span><span id="dx1-277022"/><span class="kobospan" id="kobo.1532.1"> items. </span><span class="kobospan" id="kobo.1532.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1533.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1534.1"> method raises</span><span id="dx1-277023"/><span class="kobospan" id="kobo.1535.1"> an exception when an item cannot be removed. </span><span class="kobospan" id="kobo.1535.2">We can use this behavior to both confirm that an item is in the set and remove it. </span><span id="x1-277024r537"/></p>
</section>
<section data-number="0.7.8.3" id="how-it-works...-37">
<h2 class="likechapterhead" data-number="0.7.8.3"><span><span class="kobospan" id="kobo.1536.1">4.8.3 </span></span> <span id="x1-2780003"/><span class="kobospan" id="kobo.1537.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1538.1">A set object tracks membership of items. </span><span class="kobospan" id="kobo.1538.2">An item is either in the set or not. </span><span class="kobospan" id="kobo.1538.3">We specify the item we want to remove. </span><span class="kobospan" id="kobo.1538.4">Removing an item doesn’t depend on an index position or a key value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1539.1">The set operators permit sophisticated set computations. </span><span class="kobospan" id="kobo.1539.2">We can remove any of the items in one set from a target set computing set difference or set subtraction. </span><span id="x1-278001r542"/></p>
</section>
<section data-number="0.7.8.4" id="theres-more...-30">
<h2 class="likechapterhead" data-number="0.7.8.4"><span><span class="kobospan" id="kobo.1540.1">4.8.4 </span></span> <span id="x1-2790004"/><span class="kobospan" id="kobo.1541.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1542.1">We have several other ways to remove items</span><span id="dx1-279001"/><span class="kobospan" id="kobo.1543.1"> from a set:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1544.1">In this example, we used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1545.1">difference()</span></span></span></span><span class="kobospan" id="kobo.1546.1"> method and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1547.1">-</span></span></span></span><span class="kobospan" id="kobo.1548.1"> operator. </span><span class="kobospan" id="kobo.1548.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1549.1">difference()</span></span></span></span><span class="kobospan" id="kobo.1550.1"> method behaves like an operator and creates a new set.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1551.1">We can also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1552.1">difference_update()</span></span></span></span><span class="kobospan" id="kobo.1553.1"> method. </span><span class="kobospan" id="kobo.1553.2">This will mutate a set in place. </span><span class="kobospan" id="kobo.1553.3">It does not return a value.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1554.1">We can remove an individual item with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1555.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1556.1"> method.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1557.1">We can also remove an arbitrary item with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1558.1">pop()</span></span></span></span><span class="kobospan" id="kobo.1559.1"> method. </span><span class="kobospan" id="kobo.1559.2">This doesn’t apply to this example very well because</span><span id="dx1-279002"/><span class="kobospan" id="kobo.1560.1"> we can’t control which item is popped from a set.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1561.1">Here’s how the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1562.1">difference_update()</span></span></span></span><span class="kobospan" id="kobo.1563.1"> method looks:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1564.1">&gt;&gt;&gt; valid_matches = matches.copy() 
 
&gt;&gt;&gt; valid_matches.difference_update(to_be_ignored) 
 
&gt;&gt;&gt; valid_matches 
 
{’IP: 111.222.111.222’}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1565.1">We applied the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1566.1">difference_update()</span></span></span></span><span class="kobospan" id="kobo.1567.1"> method to remove the undesirable items from the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1568.1">valid_matches</span></span></span></span><span class="kobospan" id="kobo.1569.1"> set. </span><span class="kobospan" id="kobo.1569.2">Since the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1570.1">valid_matches</span></span></span></span><span class="kobospan" id="kobo.1571.1"> set was mutated, no value is returned. </span><span class="kobospan" id="kobo.1571.2">Also, since the set is a copy, this operation doesn’t modify the original matches set.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1572.1">We could do something like the following example</span><span id="dx1-279008"/><span class="kobospan" id="kobo.1573.1"> to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1574.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1575.1"> method. </span><span class="kobospan" id="kobo.1575.2">Note that </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1576.1">remove()</span></span></span></span><span class="kobospan" id="kobo.1577.1"> will raise an exception if an item is not present in the set:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1578.1">&gt;&gt;&gt; valid_matches = matches.copy() 
 
&gt;&gt;&gt; for item in to_be_ignored: 
 
... </span><span class="kobospan" id="kobo.1578.2">    if item in valid_matches: 
 
... </span><span class="kobospan" id="kobo.1578.3">        valid_matches.remove(item) 
 
 
 
&gt;&gt;&gt; valid_matches 
 
{’IP: 111.222.111.222’}</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1579.1">We tested to see if the item was in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1580.1">valid_matches</span></span></span></span><span class="kobospan" id="kobo.1581.1"> set before attempting to remove it. </span><span class="kobospan" id="kobo.1581.2">Using an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1582.1">if</span></span></span></span><span class="kobospan" id="kobo.1583.1"> statement is one way to avoid raising a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1584.1">KeyError</span></span></span></span><span class="kobospan" id="kobo.1585.1"> exception. </span><span class="kobospan" id="kobo.1585.2">An alternative is to use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1586.1">try:</span></span></span></span><span class="kobospan" id="kobo.1587.1"> statement to silence the exception that’s raised when an item is not present.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1588.1">We can also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1589.1">pop()</span></span></span></span><span class="kobospan" id="kobo.1590.1"> method to remove</span><span id="dx1-279017"/><span class="kobospan" id="kobo.1591.1"> an arbitrary item. </span><span class="kobospan" id="kobo.1591.2">This method is unusual in that it both mutates the set and returns the item that was removed. </span><span class="kobospan" id="kobo.1591.3">However, we can’t control which item is popped, making it inappropriate for this example. </span><span id="x1-279018r532"/></p>
</section>
</section>
<section data-number="0.7.9" id="writing-set-related-type-hints">
<h1 class="unnumbered" data-number="0.7.9"><span><span class="kobospan" id="kobo.1592.1">4.9 </span></span> <span id="x1-2800009"/><span class="kobospan" id="kobo.1593.1">Writing set-related type hints</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1594.1">The typing module provides</span><span id="dx1-280001"/><span class="kobospan" id="kobo.1595.1"> a few essential type definitions for describing the contents of a set object. </span><span class="kobospan" id="kobo.1595.2">The primary type definition is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1596.1">set</span></span></span></span><span class="kobospan" id="kobo.1597.1">, which we can parameterize with the types of items in the set. </span><span class="kobospan" id="kobo.1597.2">We’ll use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1598.1">set[int]</span></span></span></span><span class="kobospan" id="kobo.1599.1"> to describe a set composed of integers. </span><span class="kobospan" id="kobo.1599.2">This parallels the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1600.1">Writing list-related type hints</span></span><span class="kobospan" id="kobo.1601.1"> recipe. </span><span id="x1-280002r543"/></p>
<section data-number="0.7.9.1" id="getting-ready-38">
<h2 class="likechapterhead" data-number="0.7.9.1"><span><span class="kobospan" id="kobo.1602.1">4.9.1 </span></span> <span id="x1-2810001"/><span class="kobospan" id="kobo.1603.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1604.1">A dice game like </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1605.1">Zonk </span></span><span class="kobospan" id="kobo.1606.1">(also called </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1607.1">10,000 </span></span><span class="kobospan" id="kobo.1608.1">or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1609.1">Greed</span></span><span class="kobospan" id="kobo.1610.1">) requires a random collection of dice to be grouped into ”hands.” </span><span class="kobospan" id="kobo.1610.2">While rules vary, there a several patterns for hands, including:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1611.1">Three of a kind.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1612.1">A “small straight” of five ascending dice (1-2-3-4-5 or 2-3-4-5-6 are the two combinations).</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1613.1">A “large straight” of six ascending dice.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1614.1">An “ace” hand. </span><span class="kobospan" id="kobo.1614.2">This has at least one 1 die that’s not part of a three of a kind or straight.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1615.1">Six of a kind. </span><span class="kobospan" id="kobo.1615.2">While rare, it’s not impossible.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1616.1">We’ll use the following class and function definitions to create the hands of dice:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1617.1">import random 
 
 
 
class Die(str, Enum): 
 
    d_1 = "\u2680" 
 
    d_2 = "\u2681" 
 
    d_3 = "\u2682" 
 
    d_4 = "\u2683" 
 
    d_5 = "\u2684" 
 
    d_6 = "\u2685" 
 
 
 
def zonk(n: int = 6) -&gt; tuple[Die, ...]: 
 
    faces = list(Die) 
 
    return tuple(random.choice(faces) for _ in range(n))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1618.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1619.1">Die</span></span></span></span><span class="kobospan" id="kobo.1620.1"> class definition enumerates the six faces of a standard die by providing the Unicode character with the appropriate value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1621.1">When we evaluate the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1622.1">zonk()</span></span></span></span><span class="kobospan" id="kobo.1623.1"> function, it looks like this.</span></p>
<pre class="programlisting" id="listing-31"><code class="calibre13"><span class="kobospan" id="kobo.1624.1">&gt;&gt;&gt; zonk() 
 
(&lt;Die.d_6: ’’&gt;, &lt;Die.d_1: ’’&gt;, &lt;Die.d_1: ’’&gt;, 
 
 &lt;Die.d_6: ’’&gt;, &lt;Die.d_3: ’’&gt;, &lt;Die.d_2: ’’&gt;)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1625.1">This shows us a hand with two sixes, two ones, a two, and a three. </span><span class="kobospan" id="kobo.1625.2">When examining the hand for patterns, we will often create complex sets of objects. </span><span id="x1-281018r547"/></p>
</section>
<section data-number="0.7.9.2" id="how-to-do-it...-38">
<h2 class="likechapterhead" data-number="0.7.9.2"><span><span class="kobospan" id="kobo.1626.1">4.9.2 </span></span> <span id="x1-2820002"/><span class="kobospan" id="kobo.1627.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1628.1">A function to do analysis</span><span id="dx1-282001"/><span class="kobospan" id="kobo.1629.1"> of the patterns of dice works by creating a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1630.1">set[Die]</span></span></span></span><span class="kobospan" id="kobo.1631.1"> object from the six dice instances. </span><span class="kobospan" id="kobo.1631.2">This set reveals a great deal of information:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1632.1">When there is one die in the set of unique values, then all six dice have the same value.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1633.1">When there are five distinct dice in the set of unique values, then this could be a small straight. </span><span class="kobospan" id="kobo.1633.2">This requires an additional check to see if the set of unique values is 1-5 or 2-6, which are the two valid small straights.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1634.1">When there are six distinct items in the set of unique values, then this must be a large straight.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1635.1">For two unique dice values there will be at least one three of a kind. </span><span class="kobospan" id="kobo.1635.2">There may be a four or five of a kind, but these are scored as a three of a kind and the remaining dice are non-scoring.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1636.1">For three or four unique dice in the set, there may be a three of a kind. </span><span class="kobospan" id="kobo.1636.2">More detailed analysis of the set is required to see the exact pattern.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1637.1">We can distinguish many of the patterns by looking at the cardinality of the set of distinct dice. </span><span class="kobospan" id="kobo.1637.2">The remaining distinctions can be made by looking at the pattern of counts. </span><span class="kobospan" id="kobo.1637.3">For this, a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1638.1">collections.Counter</span></span></span></span><span class="kobospan" id="kobo.1639.1"> object will be useful.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1640.1">Here’s how to write this set-based analysis:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-282003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1641.1">Define the type for each item in the set. </span><span class="kobospan" id="kobo.1641.2">In this example, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1642.1">Die</span></span></span></span><span class="kobospan" id="kobo.1643.1"> class is the item class. </span><span class="kobospan" id="kobo.1643.2">We’ll work with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1644.1">set[Die]</span></span></span></span><span class="kobospan" id="kobo.1645.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1646.1">Counter[Die]</span></span></span></span><span class="kobospan" id="kobo.1647.1"> types.</span></p>
</div></li>
<li class="calibre7"><div id="x1-282005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1648.1">Create the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1649.1">set</span></span></span></span><span class="kobospan" id="kobo.1650.1"> object</span><span id="dx1-282006"/><span class="kobospan" id="kobo.1651.1"> with the unique values from the hand of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1652.1">Die</span></span></span></span><span class="kobospan" id="kobo.1653.1"> instances. </span><span class="kobospan" id="kobo.1653.2">Here’s how the evaluation function can begin:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1654.1">import collections 
 
 
 
def eval_zonk_6(hand: tuple[Die, ...]) -&gt; str: 
 
    assert len(hand) == 6, "Only works for 6-dice zonk." 
 
    unique: set[Die] = set(hand)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-282014x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1655.1">There are two small straight definitions: 1-5 and 2-6:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1656.1">
    faces = list(Die) 
 
    small_straights = [ 
 
        set(faces[:-1]), set(faces[1:]) 
 
    ]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1657.1">We can build these two sets in the body of the analysis function to show how they’re used. </span><span class="kobospan" id="kobo.1657.2">Pragmatically, the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1658.1">small_straights</span></span></span></span><span class="kobospan" id="kobo.1659.1"> should be computed only once.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1660.1">We can’t build a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1661.1">set</span></span></span></span><span class="kobospan" id="kobo.1662.1"> of these two </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1663.1">set</span></span></span></span><span class="kobospan" id="kobo.1664.1"> instances because </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1665.1">set</span></span></span></span><span class="kobospan" id="kobo.1666.1"> objects are mutable. </span><span class="kobospan" id="kobo.1666.2">We could build a set of two </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1667.1">frozenset</span></span></span></span><span class="kobospan" id="kobo.1668.1"> objects instead of building a list.</span></p>
</div></li>
<li class="calibre7"><div id="x1-282021x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1669.1">Examine the simple cases. </span><span class="kobospan" id="kobo.1669.2">The number of distinct elements in the set identifies several kinds of hands directly:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1670.1">
    if len(unique) == 6: 
 
        return "large straight" 
 
    elif len(unique) == 5 and unique in small_straights: 
 
        return "small straight" 
 
    elif len(unique) == 2: 
 
        return "three of a kind" 
 
    elif len(unique) == 1: 
 
        return "six of a kind"</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-282032x5" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1671.1">When there are three or four distinct values, the patterns can be summarized using the counts. </span><span class="kobospan" id="kobo.1671.2">This pattern of frequency counts can be summarized as a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1672.1">set[int]</span></span></span></span><span class="kobospan" id="kobo.1673.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1674.1">
    elif len(unique) in {3, 4}: 
 
        # 4 unique: wwwxyz (good) or wwxxyz (bad) 
 
        # 3 unique: xxxxyz, xxxyyz (good) or xxyyzz (bad) 
 
        frequencies: set[int] = set( 
 
            collections.Counter(hand).values())</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-282040x6" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1675.1">For the cases of three or four distinct </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1676.1">Die</span></span></span></span><span class="kobospan" id="kobo.1677.1"> values, these can form</span><span id="dx1-282041"/><span class="kobospan" id="kobo.1678.1"> a variety of patterns. </span><span class="kobospan" id="kobo.1678.2">If at least one of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1679.1">Die</span></span></span></span><span class="kobospan" id="kobo.1680.1"> has a frequency of three or four, that’s a scoring combination. </span><span class="kobospan" id="kobo.1680.2">If nothing else matches and there’s a die showing a one, that’s a minimal score:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1681.1">
        if 3 in frequencies or 4 in frequencies: 
 
            return "three of a kind" 
 
        elif Die.d_1 in unique: 
 
            return "ace"                                                                

                                                                     
     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-282048x7" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1682.1">Are there any conditions left over? </span><span class="kobospan" id="kobo.1682.2">Does this cover all the possible cardinalities of dice and frequencies of dice? </span><span class="kobospan" id="kobo.1682.3">The remaining cases includes collections of pairs and singletons without any ”one” showing. </span><span class="kobospan" id="kobo.1682.4">After the above </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1683.1">if</span></span></span></span><span class="kobospan" id="kobo.1684.1"> statement, we can provide a single </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1685.1">return</span></span></span></span><span class="kobospan" id="kobo.1686.1"> statement to collect all other cases into a single, non-scoring </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1687.1">Zonk</span></span><span class="kobospan" id="kobo.1688.1">:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1689.1">
    return "Zonk!"</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1690.1">This shows two ways of using sets to evaluate the pattern of a collection of data items. </span><span class="kobospan" id="kobo.1690.2">The first set, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1691.1">set[Die]</span></span></span></span><span class="kobospan" id="kobo.1692.1">, looked at the overall pattern of unique </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1693.1">Die</span></span></span></span><span class="kobospan" id="kobo.1694.1"> values. </span><span class="kobospan" id="kobo.1694.2">The second set, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1695.1">set[int]</span></span></span></span><span class="kobospan" id="kobo.1696.1">, looked at the pattern of frequencies of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1697.1">Die</span></span></span></span><span class="kobospan" id="kobo.1698.1"> values. </span><span id="x1-282051r549"/></p>
</section>
<section data-number="0.7.9.3" id="how-it-works...-38">
<h2 class="likechapterhead" data-number="0.7.9.3"><span><span class="kobospan" id="kobo.1699.1">4.9.3 </span></span> <span id="x1-2830003"/><span class="kobospan" id="kobo.1700.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1701.1">The essential property of a set is membership. </span><span class="kobospan" id="kobo.1701.2">When we compute a set from a collection of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1702.1">Die</span></span></span></span><span class="kobospan" id="kobo.1703.1"> instances, we used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1704.1">set[Die]</span></span></span></span><span class="kobospan" id="kobo.1705.1"> type hint to describe this structure.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1706.1">Similarly, when we look at the distribution of frequencies, there are only a few distinct patterns. </span><span class="kobospan" id="kobo.1706.2">Transforming the counts into a set of values into a collection with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1707.1">set[int]</span></span></span></span><span class="kobospan" id="kobo.1708.1"> type hint</span><span id="dx1-283001"/><span class="kobospan" id="kobo.1709.1"> described this additional structure. </span><span id="x1-283002r556"/></p>
</section>
<section data-number="0.7.9.4" id="theres-more...-31">
<h2 class="likechapterhead" data-number="0.7.9.4"><span><span class="kobospan" id="kobo.1710.1">4.9.4 </span></span> <span id="x1-2840004"/><span class="kobospan" id="kobo.1711.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1712.1">A set of items that don’t have a single, uniform type is potentially confusing. </span><span class="kobospan" id="kobo.1712.2">We can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1713.1">set[T1</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1714.1"> |</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1715.1"> T2]</span></span></span></span><span class="kobospan" id="kobo.1716.1"> to describe a set where items can be any of the types </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1717.1">T1</span></span></span></span><span class="kobospan" id="kobo.1718.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1719.1">T2</span></span></span></span><span class="kobospan" id="kobo.1720.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1721.1">Computing the score of the hand of dice depends on which dice were part of the winning pattern. </span><span class="kobospan" id="kobo.1721.2">This means the evaluation function needs to return a more complex result when the outcome is a three of a kind. </span><span class="kobospan" id="kobo.1721.3">To determine the points, there are three cases we need to consider:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1722.1">Which value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1723.1">Dice</span></span></span></span><span class="kobospan" id="kobo.1724.1"> class occurred three or six times. </span><span class="kobospan" id="kobo.1724.2">This determines the base score. </span><span class="kobospan" id="kobo.1724.3">Often, 1s are given 1,000 points, and 2 through 6 are given 200 through 600 points.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1725.1">It’s possible to roll two triples; this pattern must be distinguished, too. </span><span class="kobospan" id="kobo.1725.2">This often scores 2,000 points, irrespective of the numbers shown.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1726.1">For the straights and the “ace” hand, simple fixed scores are assigned. </span><span class="kobospan" id="kobo.1726.2">A small straight might be 1,000 points. </span><span class="kobospan" id="kobo.1726.3">A large straight 2,000. </span><span class="kobospan" id="kobo.1726.4">A lone 1 might score only 50 points.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1727.1">We have two separate conditions to identify the patterns of unique values indicating a three-of-a-kind pattern. </span><span class="kobospan" id="kobo.1727.2">The function needs some refactoring to properly identify the values of the dice occurring three or more times and the values of the dice which were ignored. </span><span class="kobospan" id="kobo.1727.3">We’ve left this additional design as an exercise for the reader. </span><span id="x1-284001r557"/></p>
</section>
<section data-number="0.7.9.5" id="see-also-37">
<h2 class="likechapterhead" data-number="0.7.9.5"><span><span class="kobospan" id="kobo.1728.1">4.9.5 </span></span> <span id="x1-2850005"/><span class="kobospan" id="kobo.1729.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1730.1">Refer to the </span><a href="ch008_split_001.xhtml#x1-2560005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1731.1">Writing list-related type hints</span></span></a><span class="kobospan" id="kobo.1732.1"> recipe in this chapter for more about type hints for lists.</span></p></li>
</ul>
<p class="normal1"><span id="x1-285001r546"/></p>
</section>
</section>
<section data-number="0.7.12" id="join-our-community-discord-space-4">
<h1 class="unnumbered" data-number="0.7.12"><span id="x1-28800011"/><span class="kobospan" id="kobo.1733.1">Join our community Discord space</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1734.1">Join our Python Discord workspace to discuss and find out more about the book: </span><a href="https://packt.link/dHrHU" class="url"><span class="url1"><span class="kobospan" id="kobo.1735.1">https://packt.link/dHrHU</span></span></a></p>
<p class="normal1"><span class="kobospan" id="kobo.1736.1"><img alt="PIC" src="../media/file1.png" class="calibre9"/></span> <span id="x1-288001r423"/></p>
</section>
</section>
</body></html>